// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/handleUtils ../../core/lang ../../core/mathUtils ../../core/maybe ../../core/screenUtils ../../geometry/support/webMercatorUtils ../draw/support/drawUtils".split(" "),function(B,f,k,x,y,p,h,z,n,A){function q(b,e){var a=null,c=null;return function(d){if("cancel"===d.action)h.isSome(c)&&(c.execute({action:"cancel"}),c=a=null);else{var g={action:d.action,screenStart:d.start,screenEnd:d.screenPoint};"start"===d.action&&h.isNone(a)&&(a=new l,c=new l,e(b,a,c,g));
h.isSome(a)&&a.execute(g);"end"===d.action&&h.isSome(a)&&(c=a=null)}}}function r(b,e){return b.events.on("drag",q(b,e))}function t(b,e){var a=null,c=h.isSome(b[e])?b[e].spatialReference:null;return function(d){if("start"===d.action&&h.isSome(b[e])){var g=b[e],m=d.mapStart.spatialReference;a=h.isNone(g)||"mesh"===g.type?null:g.spatialReference.equals(m)?g.clone():n.canProject(g,m)?n.project(g,m):null}if(h.isNone(a))return null;var g=d.mapEnd.x-d.mapStart.x,m=d.mapEnd.y-d.mapStart.y,f=d.mapEnd.z-d.mapStart.z,
l=A.move(a.clone(),g,m,f);l.spatialReference.equals(c)?b[e]=l:b[e]=n.project(l,c);return k.__assign(k.__assign({},d),{translationX:g,translationY:m,translationZ:f})}}function u(b){return t(b,"geometry")}function v(b,e){for(var a=new Map,c=0;c<e.length;c++){var d=e[c];a.set(d,y.clone(b[d]))}return function(c){a.forEach(function(a,c){b[c]=a});return c}}function w(b){return v(b,["geometry"])}Object.defineProperty(f,"__esModule",{value:!0});f.createDragEventPipelineCallback=q;f.createManipulatorDragEventPipeline=
r;f.createManipulatorDragEventPipelineMany=function(b,e){for(var a=[],c=0;c<b.length;c++)a.push(r(b[c],e));return x.handlesGroup(a)};f.constrainToMapAxis=function(b,e){var a=[b.x,b.y,b.z],c=[Math.cos(e),Math.sin(e)];b=Math.sqrt(c[0]*c[0]+c[1]*c[1]);if(0===b)return null;c[0]/=b;c[1]/=b;var d=function(b){var d=(b.x-a[0])*c[0]+(b.y-a[1])*c[1];b.x=a[0]+d*c[0];b.y=a[1]+d*c[1]};return function(a){d(a.mapStart);d(a.mapEnd);return a}};f.dragGeometry=t;f.dragGraphic=u;f.screenToMap=function(b,e,a){void 0===
e&&(e=null);var c=null,d=h.isSome(e)&&!b.spatialReference.equals(e)?function(a){return h.isSome(a)?n.project(a,e):a}:function(a){return a},g=k.__assign({exclude:[]},a);return function(a){"start"===a.action&&(c=d(b.toMap(a.screenStart,g)));if(h.isNone(c))return null;var e=d(b.toMap(a.screenEnd,g));return h.isSome(e)?k.__assign(k.__assign({},a),{mapStart:c,mapEnd:e}):null}};f.dragGraphicMany=function(b){var e=b.map(function(a){return h.unwrap(u(a))}).filter(function(a){return h.isSome(a)});return function(a){var b=
a.mapEnd.x-a.mapStart.x,d=a.mapEnd.y-a.mapStart.y,g=a.mapEnd.z-a.mapStart.z;e.forEach(function(b){return b(a)});return k.__assign(k.__assign({},a),{translationX:b,translationY:d,translationZ:g})}};f.resetProperties=v;f.resetGraphic=w;f.resetGraphicMany=function(b){var e=b.map(function(a){return h.unwrap(w(a))}).filter(function(a){return h.isSome(a)});return function(a){e.forEach(function(b){return b(a)});return a}};f.resetSymbol=function(b){var e=h.isSome(b.symbol)?b.symbol.clone():null;return function(a){b.symbol=
e;return a}};f.horizontalDegreesOfFreedom=3;f.verticalDegreesOfFreedom=4;f.allDegreesOfFreedom=7;f.addMapDelta=function(b){void 0===b&&(b=f.allDegreesOfFreedom);var e=0,a=0,c=0;return function(d){"start"===d.action&&(e=d.mapStart.x,a=d.mapStart.y,c=d.mapStart.z);var g=b&1?d.mapEnd.x-e:0,f=b&2?d.mapEnd.y-a:0,h=b&4?d.mapEnd.z-c:0;e=d.mapEnd.x;a=d.mapEnd.y;c=d.mapEnd.z;return k.__assign(k.__assign({},d),{mapDeltaX:g,mapDeltaY:f,mapDeltaZ:h,mapDeltaSpatialReference:d.mapStart.spatialReference})}};f.addScreenDelta=
function(b){void 0===b&&(b=f.allDegreesOfFreedom);var e=0,a=0;return function(c){"start"===c.action&&(e=c.screenStart.x,a=c.screenStart.y);var d=b&1?c.screenEnd.x-e:0,g=b&2?c.screenEnd.y-a:0;e=c.screenEnd.x;a=c.screenEnd.y;return k.__assign(k.__assign({},c),{screenDeltaX:d,screenDeltaY:g})}};f.dragAtLocation=function(b,e){var a=null,c=0,d=0;return function(g){"start"===g.action&&(a=b.toScreen(e),0>a.x||a.x>b.width||0>a.y||a.y>b.height?a=null:(c=g.screenStart.x-a.x,d=g.screenStart.y-a.y));if(null==
a)return null;var f=p.clamp(g.screenEnd.x-c,0,b.width),h=p.clamp(g.screenEnd.y-d,0,b.height),f=z.createScreenPoint(f,h);g.screenStart=a;g.screenEnd=f;return g}};var l=function(){function b(){this.execute=function(){}}b.prototype.next=function(e,a){void 0===a&&(a=new b);h.isSome(e)&&(this.execute=function(b){b=e(b);h.isSome(b)&&a.execute(b)});return a};return b}();f.EventPipeline=l});