// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ./earthUtils ../webgl-engine/lib/BufferVectorMath".split(" "),function(ra,f,P,C,ma,L,M,N,aa,ba,na,oa,n,pa){function V(a,b,c,e){if(2>a.length)return!1;2===
a.length&&(d[0]=a[0],d[1]=a[1],d[2]=0,a=d);return l(a,b,0,c,e,0,1)}function W(a,b,c,e,Q,d,m){void 0===m&&(m=0);for(var g=[],f=0;f<a.length;f++)for(var k=a[f],p=0,h=k;p<h.length;p++)k=h[p],g.push(k[0],k[1],b?k[2]:m);if(!l(g,e,0,g,d,0,g.length/3))return!1;e=0;for(d=Q.length=0;d<a.length;d++){k=a[d];m=[];f=0;for(p=k;f<p.length;f++)k=p[f],b&&c?m.push([g[e++],g[e++],g[e++],k[3]]):b?m.push([g[e++],g[e++],g[e++]]):(c?m.push([g[e++],g[e++],k[2]]):m.push([g[e++],g[e++]]),e++);Q.push(m)}return!0}function l(a,
b,c,e,Q,d,m){void 0===m&&(m=1);b=R(b,Q,X);if(C.isNone(b))return!1;if(b===h){if(a===e&&c===d)return!0;for(b=c+3*m;c<b;c++,d++)e[d]=a[c];return!0}for(m=c+3*m;c<m;c+=3,d+=3)b(a,c,e,d);return!0}function t(a,b){if(b.spatialReference===a)return b.spatialReferenceId;b.spatialReference=a;"metersPerUnit"in b&&(b.metersPerUnit=ma.getMetersPerUnitForSR(a,1));return a.wkt===f.SphericalECEFSpatialReference.wkt?b.spatialReferenceId=1:a.isWGS84?b.spatialReferenceId=2:a.isWebMercator?b.spatialReferenceId=3:a.wkt===
f.WGS84ECEFSpatialReference.wkt?b.spatialReferenceId=4:4490===a.wkid?b.spatialReferenceId=5:b.spatialReferenceId=0}function h(a,b,c,e){a!==c&&(c[e++]=a[b++],c[e++]=a[b++],c[e]=a[b])}function O(a,b,c,e){c[e++]=E*(a[b++]/n.earthRadius);c[e++]=E*(Math.PI/2-2*Math.atan(Math.exp(-1*a[b++]/n.earthRadius)));c[e]=a[b]}function ca(a,b,c,e){O(a,b,c,e);F(c,e,c,e)}function da(a,b,c,e){O(a,b,c,e);G(c,e,c,e)}function H(a,b,c,e){var d=.4999999*Math.PI,d=P.clamp(q*a[b+1],-d,d),d=Math.sin(d);c[e++]=q*a[b]*n.earthRadius;
c[e++]=n.halfEarthRadius*Math.log((1+d)/(1-d));c[e]=a[b+2]}function ea(a,b,c){b=t(b,S);b=D[b][6];if(C.isNone(b))return!1;b(a,0,d,0);c!==d&&(c[0]=d[0],c[1]=d[1],2<c.length&&(c[2]=d[2]));return!0}function fa(a,b){d[0]=a.x;d[1]=a.y;d[2]=a.hasZ?a.z:0;return ea(d,a.spatialReference,b)}function F(a,b,c,e){var d=n.earthRadius+a[b+2],g=q*a[b+1];a=q*a[b];b=Math.cos(g);c[e++]=Math.cos(a)*b*d;c[e++]=Math.sin(a)*b*d;c[e]=Math.sin(g)*d}function I(a,b,c,e){var d=pa.Vec3Compact.length(a,b),g=P.asinClamped(a[b+2]/
(0===d?1:d));a=Math.atan2(a[b+1],a[b]);c[e++]=E*a;c[e++]=E*g;c[e]=d-n.earthRadius}function ga(a,b,c,e){I(a,b,c,e);H(c,e,c,e)}function ha(a,b,c,e){I(a,b,c,e);G(c,e,c,e)}function G(a,b,c,e){var d=ia,g=q*a[b],m=q*a[b+1];a=a[b+2];b=Math.sin(m);var m=Math.cos(m),f=d.a/Math.sqrt(1-d.e2*b*b);c[e++]=(f+a)*m*Math.cos(g);c[e++]=(f+a)*m*Math.sin(g);c[e++]=(f*(1-d.e2)+a)*b}function J(a,b,c,e){var d=ia,g=a[b],f=a[b+1];a=a[b+2];var h,n,k,p,l,q;b=Math.abs(a);h=g*g+f*f;n=Math.sqrt(h);k=h+a*a;p=Math.sqrt(k);g=Math.atan2(f,
g);l=a*a/k;k=h/k;f=d.a2/p;h=d.a3-d.a4/p;.3<k?(l=b/p*(1+k*(d.a1+f+l*h)/p),p=Math.asin(l),f=l*l,k=Math.sqrt(1-f)):(k=n/p*(1-l*(d.a5-f-k*h)/p),p=Math.acos(k),f=1-k*k,l=Math.sqrt(f));q=1-d.e2*f;f=d.a/Math.sqrt(q);d=d.a6*f;f=n-f*k;h=b-d*l;b=k*f+l*h;n=k*h-l*f;d=n/(d/q+b);p+=d;0>a&&(p=-p);c[e++]=E*g;c[e++]=E*p;c[e]=b+n*d/2}function ja(a,b,c,e){J(a,b,c,e);F(c,e,c,e)}function ka(a,b,c,e){J(a,b,c,e);H(c,e,c,e)}function R(a,b,c){void 0===c&&(c=Y());return la(a,b,c).projector}function la(a,b,c){if(c.source.spatialReference===
a&&c.dest.spatialReference===b)return c;var e=t(a,c.source),d=t(b,c.dest);0===e&&0===d?a.equals(b)?c.projector=h:c.projector=null:c.projector=D[e][d];return c}function Y(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:h}}var u,v,w,x,y,z,A,B;Object.defineProperty(f,"__esModule",{value:!0});f.SphericalECEFSpatialReference=new ba({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",\' + earthUtils.earthRadius + \',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});
f.WGS84ECEFSpatialReference=new ba({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});f.canProject=function(a,b){return!!R(a,b,X)};f.getProjectorName=function(a,b){a=
R(a,b,X);return a===h?"copy3":a===F?"wgs84ToSphericalECEF":a===H?"wgs84ToWebMercator":a===G?"wgs84ToWGS84ECEF":a===O?"webMercatorToWGS84":a===ca?"webMercatorToSphericalECEF":a===da?"webMercatorToWGS84ECEF":a===J?"wgs84ECEFToWGS84":a===ja?"wgs84ECEFToSphericalECEF":a===ka?"wgs84ECEFToWebMercator":a===I?"sphericalECEFToWGS84":a===ga?"sphericalECEFToWebMercator":a===ha?"sphericalECEFToWGS84ECEF":null};f.vectorToVector=V;f.polygonToPolygon=function(a,b,c,e){void 0===c&&(c=b.spatialReference);void 0===
e&&(e=0);var d=[];if(!W(a.rings,a.hasZ,a.hasM,a.spatialReference,d,c,e))return!1;b.rings=d;b.spatialReference=c;b.hasZ=a.hasZ;b.hasM=a.hasM;return!0};f.polylineToPolyline=function(a,b,c,e){void 0===c&&(c=b.spatialReference);void 0===e&&(e=0);var d=[];if(!W(a.paths,a.hasZ,a.hasM,a.spatialReference,d,c,e))return!1;b.paths=d;b.spatialReference=c;b.hasZ=a.hasZ;b.hasM=a.hasM;return!0};f.multipointToMultipoint=function(a,b,c,e){void 0===c&&(c=b.spatialReference);void 0===e&&(e=0);var d=[];if(!W([a.points],
a.hasZ,a.hasM,a.spatialReference,d,c,e))return!1;b.points=d[0];b.spatialReference=c;b.hasZ=a.hasZ;b.hasM=a.hasM;return!0};f.pointToPoint=function(a,b,c,e){void 0===c&&(c=b.spatialReference);void 0===e&&(e=0);d[0]=a.x;d[1]=a.y;var f=a.z;d[2]=void 0!==f?f:e;if(!l(d,a.spatialReference,0,d,c,0,1))return!1;b.x=d[0];b.y=d[1];b.spatialReference=c;void 0!==f?(b.z=d[2],b.hasZ=!0):(b.z=void 0,b.hasZ=!1);return!0};f.pointToVector=function(a,b,c,e){void 0===e&&(e=0);d[0]=a.x;d[1]=a.y;var f=a.z;d[2]=void 0!==
f?f:e;return l(d,a.spatialReference,0,b,c,0,1)};f.vectorToPoint=function(a,b,c,e){c instanceof aa?e=e||c.spatialReference:oa.isPoint(c)?(c.hasZ=!0,e=e||c.spatialReference):(e=c,c=new aa({spatialReference:e}));return l(a,b,0,d,e,0,1)?(c.x=d[0],c.y=d[1],c.z=d[2],c.spatialReference=e,c):null};f.xyzToVector=function(a,b,c,e,f,g){d[0]=a;d[1]=b;d[2]=c;return l(d,e,0,f,g,0,1)};f.bufferToBuffer=l;f.localLinearScaleFactors=function(a,b,c,e){var d=t(b,S),f=t(e,Z);if(d===f&&0!==d||b.equals(e))return c[0]=1,
c[1]=1,c[2]=1,!0;if(1===d){b=M.vec3.length(a);a=b/Math.sqrt(a[0]*a[0]+a[1]*a[1]);b/=n.earthRadius;if(3===f)return c[0]=a*b,c[1]=a*b,c[2]=1,!0;if(2===f||5===f)return f=180/(n.earthRadius*Math.PI),c[0]=f*a*b,c[1]=f*b,c[2]=1,!0}return!1};f.computeLinearTransformation=function(a,b,c,e){var d=t(a,S),f=t(e,Z);if(d===f&&1!==f&&(0!==d||a.equals(e)))return L.mat4.identity(c),L.mat4.translate(c,c,b),!0;if(1===f){a=D[d][6];f=D[6][f];if(C.isNone(a)||C.isNone(f))return!1;a(b,0,r,0);f(r,0,K,0);a=q*r[0];f=q*r[1];
b=Math.sin(a);a=Math.cos(a);e=Math.sin(f);f=Math.cos(f);c[0]=-b;c[4]=-e*a;c[8]=f*a;c[12]=K[0];c[1]=a;c[5]=-e*b;c[9]=f*b;c[13]=K[1];c[2]=0;c[6]=f;c[10]=e;c[14]=K[2];c[3]=0;c[7]=0;c[11]=0;c[15]=1;return!0}if(3===f&&(2===d||1===d)){a=D[d][6];if(C.isNone(a))return!1;a(b,0,r,0);b=q*r[1];H(r,0,K,0);L.mat4.identity(c);L.mat4.translate(c,c,K);b=1/Math.cos(b);L.mat4.scale(c,c,[b,b,1]);return!0}return!1};f.transformDirection=function(a,b,c,e,d){M.vec3.copy(T,a);M.vec3.add(U,a,b);V(T,c,T,d);V(U,c,U,d);M.vec3.subtract(e,
U,T);M.vec3.normalize(e,e)};f.mbsToMbs=function(a,b,c,d){b=la(b,d,qa);if(b.projector===h)return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],!0;if(C.isNone(b.projector))return!1;d=b.source;var e=b.dest;if(3===e.spatialReferenceId){b=D[d.spatialReferenceId][2];if(C.isNone(b))return!1;b(a,0,r,0);b=Math.abs(q*r[1])+Math.asin(a[3]/(n.earthRadius+a[2]));H(r,0,c,0);c[3]=b>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(b)*a[3];return!0}b.projector(a,0,c,0);c[3]=a[3]*d.metersPerUnit/e.metersPerUnit;return!0};f.extentToBoundingBox=
function(a,b,c){if(null==a)return!1;var e;d[0]=null!=a.xmin?a.xmin:0;d[1]=null!=a.ymin?a.ymin:0;d[2]=null!=a.zmin?a.zmin:0;e=l(d,a.spatialReference,0,b,c,0,1);d[0]=null!=a.xmax?a.xmax:0;d[1]=null!=a.ymax?a.ymax:0;d[2]=null!=a.zmax?a.zmax:0;e=e&&l(d,a.spatialReference,0,b,c,3,1);null==a.xmin&&(b[0]=-Infinity);null==a.ymin&&(b[1]=-Infinity);null==a.zmin&&(b[2]=-Infinity);null==a.xmax&&(b[3]=Infinity);null==a.ymax&&(b[4]=Infinity);null==a.zmax&&(b[5]=Infinity);return e};f.extentToBoundingRect=function(a,
b,c){if(null==a)return!1;var e;d[0]=null!=a.xmin?a.xmin:0;d[1]=null!=a.ymin?a.ymin:0;d[2]=null!=a.zmin?a.zmin:0;e=l(d,a.spatialReference,0,d,c,0,1);b[0]=d[0];b[1]=d[1];d[0]=null!=a.xmax?a.xmax:0;d[1]=null!=a.ymax?a.ymax:0;d[2]=null!=a.zmax?a.zmax:0;e=e&&l(d,a.spatialReference,0,d,c,0,1);b[2]=d[0];b[3]=d[1];null==a.xmin&&(b[0]=-Infinity);null==a.ymin&&(b[1]=-Infinity);null==a.xmax&&(b[2]=Infinity);null==a.ymax&&(b[3]=Infinity);return e};f.boundingRectToBoundingRect=function(a,b,c,e){if(null==a)return!1;
if(b.equals(e))return na.set(c,a),!0;d[0]=a[0];d[1]=a[1];d[2]=0;if(!l(d,b,0,d,e,0,1))return!1;c[0]=d[0];c[1]=d[1];d[0]=a[2];d[1]=a[3];d[2]=0;if(!l(d,b,0,d,e,0,1))return!1;c[2]=d[0];c[3]=d[1];return!0};(function(a){a.x2lon=function(a){return a/n.earthRadius};a.y2lat=function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/n.earthRadius))};a.lon2x=function(a){return a*n.earthRadius};a.lat2y=function(a){a=Math.sin(a);return n.earthRadius/2*Math.log((1+a)/(1-a))}})(f.webMercator||(f.webMercator={}));f.canProjectToWGS84ComparableLonLat=
function(a){a=t(a,S);return!!D[a][6]};f.vectorToWGS84ComparableLonLat=ea;f.pointToWGS84ComparableLonLat=fa;f.pointToWGS84ComparableLonLatPoint=function(a,b){var c=t(b.spatialReference,Z);return C.isNone(D[6][c])?!1:fa(a,d)?(b.x=d[0],b.y=d[1],b.z=d[2],!0):!1};f.wgs84ComparableLonLatToECEF=function(a,b,c,d){void 0===d&&(d=0);d=n.earthRadius+d;var e=Math.cos(c);a[0]=Math.cos(b)*e*d;a[1]=Math.sin(b)*e*d;a[2]=Math.sin(c)*d};var D=(u={},u[2]=(v={},v[5]=null,v[6]=h,v[1]=F,v[0]=null,v[3]=H,v[2]=h,v[4]=G,
v),u[5]=(w={},w[5]=h,w[6]=h,w[1]=F,w[0]=null,w[3]=null,w[2]=null,w[4]=G,w),u[3]=(x={},x[5]=null,x[6]=O,x[1]=ca,x[0]=null,x[3]=h,x[2]=O,x[4]=da,x),u[4]=(y={},y[5]=J,y[6]=J,y[1]=ja,y[0]=null,y[3]=ka,y[2]=J,y[4]=h,y),u[1]=(z={},z[5]=I,z[6]=I,z[1]=h,z[0]=null,z[3]=ga,z[2]=I,z[4]=ha,z),u[0]=(A={},A[5]=null,A[6]=null,A[1]=null,A[0]=h,A[3]=null,A[2]=null,A[4]=null,A),u[6]=(B={},B[5]=null,B[6]=h,B[1]=F,B[0]=null,B[3]=null,B[2]=h,B[4]=G,B),u);f.getProjector=R;var S={spatialReference:null,spatialReferenceId:0},
Z={spatialReference:null,spatialReferenceId:0},X=Y(),qa=Y(),q=P.deg2rad(1),E=P.rad2deg(1),ia={a:6378137,e2:.006694379990137799,a1:42697.67270715754,a2:1.8230912546075456E9,a3:142.91722289812412,a4:4.557728136518864E9,a5:42840.589930055656,a6:.9933056200098622},d=N.vec3f64.create(),r=N.vec3f64.create(),K=N.vec3f64.create(),T=N.vec3f64.create(),U=N.vec3f64.create()});