// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../../core/maybe ../../../../../../core/libs/gl-matrix-2/vec3 ../../../../../../core/libs/gl-matrix-2/vec3f32 ../../../../../../core/libs/gl-matrix-2/vec4 ../../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../../../core/libs/gl-matrix-2/vec4f64 ./ComponentTechnique ./shader/ComponentShader.glsl ../../../core/material/MaterialBase ../../../core/shaderLibrary/util/AlphaDiscard.glsl".split(" "),function(l,k,c,f,m,n,h,p,q,r,v,a,w){function x(c){switch(c){case 0:return 0;
case 1:return 1;case 2:return 2;case 3:return 7}}Object.defineProperty(k,"__esModule",{value:!0});l=function(e){function b(){var d=e.call(this)||this;d.baseColor=p.vec4f32.fromValues(1,1,1,1);d.usePBR=!1;d.mrrFactors=n.vec3f32.fromValues(1,1,.5);d.emissiveFactor=n.vec3f32.fromValues(0,0,0);d.baseColorTexture=null;d.metallicRoughnessTexture=null;d.emissionTexture=null;d.occlusionTexture=null;d.normalTexture=null;d.overlayTexOffset=q.vec4f64.fromValues(-1,-1,-1,-1);d.overlayTexScale=q.vec4f64.fromValues(0,
0,0,0);d.overlayColorInner=null;d.overlayColorOuter=null;d.overlayHighlightInner=null;d.overlayHighlightOuter=null;d.overlayNormalInner=null;d.overlayNormalOuter=null;d.objectOpacity=1;d.commonMaterialParameters=new t;d.componentParameters=new u;d.alphaCutoff=w.defaultMaskAlphaCutoff;d.alphaDiscardMode=1;d.isIntegratedMesh=!1;d.polygonOffsetEnabled=!1;d.sceneHasOcludees=!1;d._techniqueConfig=new r.ComponentTechniqueConfiguration;return d}c.__extends(b,e);b.prototype.dispose=function(d){this._technique&&
(d.release(this._technique),this._technique=void 0);this.baseColorTexture=null};b.prototype.getTechnique=function(d,b,c){var a=this._techniqueConfig;a.hasVertexColors=c.colors;a.hasNormals=c.normals;a.vertexTextureCoordinates=c.textureCoordinates;a.usePBR=this.usePBR;a.hasMetalnessAndRoughnessTexture=f.isSome(this.metallicRoughnessTexture);a.hasEmissionTexture=f.isSome(this.emissionTexture);a.hasOcclusionTexture=f.isSome(this.occlusionTexture);a.hasNormalTexture=f.isSome(this.normalTexture);this.dirty&&
(a.componentData=this.componentParameters.type,a.cullFace=this.commonMaterialParameters.cullFace,a.doubleSidedMode=this.commonMaterialParameters.doubleSided?1:0,a.baseColorTexture=f.isSome(this.baseColorTexture),c=this._computeWhichMaterialPass(),a.blendingEnabled=1===c||2===c,a.alphaDiscardMode=this.alphaDiscardMode,a.integratedMeshMode=this.isIntegratedMesh?this.overlayColorInner||this.overlayColorOuter?this.overlayNormalInner||this.overlayNormalOuter?3:2:1:0,a.polygonOffsetEnabled=this.polygonOffsetEnabled,
this._setClean());a.slicePlaneEnabled=b.slicePlaneEnabled&&this.commonMaterialParameters.slicePlaneEnabled;1===b.identifier?(a.output=3,a.vertexDiscardMode=0):2===b.identifier?(a.output=4,a.vertexDiscardMode=0):(2===this._computeWhichMaterialPass()?a.vertexDiscardMode=b.transparent?2:1:a.vertexDiscardMode=0,a.output=x(b.subPass),0===b.subPass?(a.receiveAmbientOcclusion=b.ambientOcclusionEnabled,a.sceneHasOcludees=b.sceneHasOcludees,a.receiveShadows=b.shadowsEnabled,a.ssrEnabled=b.ssrParams.ssrEnabled):
(a.receiveAmbientOcclusion=!1,a.receiveShadows=!1));return this._technique=d.repository.acquireAndReleaseExisting(r.ComponentTechnique,a,this._technique)};b.prototype.submit=function(a,b){var c=b.renderable.geometry,d=b.components,e=b.renderable.drawParameters;b=b.renderable.meta.cameraDepthSquared;var g=d.geometryRanges,d=d.highlightRanges;switch(this._computeWhichMaterialPass()){case 0:a.materialOpaque.submitDraw(this,c,g,e,b);break;case 1:a.materialTransparent.submitDraw(this,c,g,e,b);break;case 2:a.materialOpaque.submitDraw(this,
c,g,e,b);a.materialTransparent.submitDraw(this,c,g,e,b);break;case 3:a.materialIntegratedMesh.submitDraw(this,c,g,e,b),(this.overlayHighlightInner||this.overlayHighlightOuter)&&a.highlightIntegratedMesh.submitDraw(this,c,g,e,b)}f.isSome(a.shadowMap)&&2!==this.componentParameters.castShadows&&a.shadowMap.submitDraw(this,c,g,e,b);f.isSome(a.highlight)&&f.isSome(d)&&a.highlight.submitDraw(this,c,d,e,b)};Object.defineProperty(b.prototype,"attributeLocations",{get:function(){return v.attributeLocations},
enumerable:!0,configurable:!0});b.prototype._computeWhichMaterialPass=function(){return this.isIntegratedMesh?3:1>this.objectOpacity?1:0===this.componentParameters.opaqueOverride?0:1>this.baseColor[3]||0===this.alphaDiscardMode||3===this.alphaDiscardMode?1:2===this.componentParameters.transparent?0:0===this.componentParameters.transparent?1:2};c.__decorate([a.parameter({vectorOps:h.vec4})],b.prototype,"baseColor",void 0);c.__decorate([a.parameter()],b.prototype,"usePBR",void 0);c.__decorate([a.parameter({vectorOps:m.vec3})],
b.prototype,"mrrFactors",void 0);c.__decorate([a.parameter({vectorOps:m.vec3})],b.prototype,"emissiveFactor",void 0);c.__decorate([a.parameter({dispose:!0})],b.prototype,"baseColorTexture",void 0);c.__decorate([a.parameter({dispose:!0})],b.prototype,"metallicRoughnessTexture",void 0);c.__decorate([a.parameter({dispose:!0})],b.prototype,"emissionTexture",void 0);c.__decorate([a.parameter({dispose:!0})],b.prototype,"occlusionTexture",void 0);c.__decorate([a.parameter({dispose:!0})],b.prototype,"normalTexture",
void 0);c.__decorate([a.parameter({vectorOps:{equals:h.vec4.exactEquals,copy:h.vec4.copy}})],b.prototype,"overlayTexOffset",void 0);c.__decorate([a.parameter({vectorOps:{equals:h.vec4.exactEquals,copy:h.vec4.copy}})],b.prototype,"overlayTexScale",void 0);c.__decorate([a.parameter()],b.prototype,"overlayColorInner",void 0);c.__decorate([a.parameter()],b.prototype,"overlayColorOuter",void 0);c.__decorate([a.parameter()],b.prototype,"overlayHighlightInner",void 0);c.__decorate([a.parameter()],b.prototype,
"overlayHighlightOuter",void 0);c.__decorate([a.parameter()],b.prototype,"overlayNormalInner",void 0);c.__decorate([a.parameter()],b.prototype,"overlayNormalOuter",void 0);c.__decorate([a.parameter()],b.prototype,"objectOpacity",void 0);c.__decorate([a.parameterBlock()],b.prototype,"commonMaterialParameters",void 0);c.__decorate([a.parameterBlock()],b.prototype,"componentParameters",void 0);c.__decorate([a.parameter()],b.prototype,"alphaCutoff",void 0);c.__decorate([a.parameter()],b.prototype,"alphaDiscardMode",
void 0);c.__decorate([a.parameter()],b.prototype,"isIntegratedMesh",void 0);c.__decorate([a.parameter()],b.prototype,"polygonOffsetEnabled",void 0);c.__decorate([a.parameter()],b.prototype,"sceneHasOcludees",void 0);return b}(a.MaterialBase);k.ComponentMaterial=l;var t=function(e){function b(){var a=null!==e&&e.apply(this,arguments)||this;a.doubleSided=!1;a.cullFace=2;a.slicePlaneEnabled=!0;return a}c.__extends(b,e);c.__decorate([a.parameter()],b.prototype,"doubleSided",void 0);c.__decorate([a.parameter()],
b.prototype,"cullFace",void 0);c.__decorate([a.parameter()],b.prototype,"slicePlaneEnabled",void 0);return b}(a.MaterialParameterBlock);k.CommonMaterialParameters=t;var u=function(e){function b(){var a=null!==e&&e.apply(this,arguments)||this;a.externalColor=p.vec4f32.fromValues(1,1,1,1);a.externalColorMixMode=1;a.castShadows=0;return a}c.__extends(b,e);Object.defineProperty(b.prototype,"transparent",{get:function(){return 1>this.externalColor[3]?0:2},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"opaqueOverride",{get:function(){return 3===this.externalColorMixMode&&1===this.externalColor[3]?0:2},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"visible",{get:function(){return 0<this.externalColor[3]?0:2},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"type",{get:function(){return 0},enumerable:!0,configurable:!0});c.__decorate([a.parameter({vectorOps:h.vec4})],b.prototype,"externalColor",void 0);c.__decorate([a.parameter()],b.prototype,"externalColorMixMode",
void 0);c.__decorate([a.parameter()],b.prototype,"castShadows",void 0);return b}(a.MaterialParameterBlock);k.ComponentParametersUniform=u;l=function(e){function b(){var a=null!==e&&e.apply(this,arguments)||this;a.texture=null;a.transparent=2;a.opaqueOverride=2;a.castShadows=2;return a}c.__extends(b,e);Object.defineProperty(b.prototype,"type",{get:function(){return 1},enumerable:!0,configurable:!0});c.__decorate([a.parameter()],b.prototype,"texture",void 0);c.__decorate([a.parameter()],b.prototype,
"transparent",void 0);c.__decorate([a.parameter()],b.prototype,"opaqueOverride",void 0);c.__decorate([a.parameter()],b.prototype,"castShadows",void 0);return b}(a.MaterialParameterBlock);k.ComponentParametersVarying=l});