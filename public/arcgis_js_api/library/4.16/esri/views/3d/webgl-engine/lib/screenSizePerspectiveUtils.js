// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../core/mathUtils","../../support/earthUtils"],function(w,f,d,h){function t(a,b,c){var g=c.parameters;c=c.paddingPixelsOverride;k.scale=Math.min(g.divisor/(b-g.offset),1);k.factor=Math.abs(a*a*a);k.minPixelSize=g.minPixelSize;k.paddingPixels=c;return k}function p(a,b){return 0===a?b.minPixelSize:b.minPixelSize*(1+2*b.paddingPixels/a)}function q(a,b){return Math.max(d.lerp(a*b.scale,a,b.factor),p(a,b))}Object.defineProperty(f,"__esModule",{value:!0});f.getSettings=
function(a){return new u(a,n)};f.getLabelSettings=function(a){var b=n.curvatureDependent;return new u(a,{curvatureDependent:{min:{curvature:b.min.curvature,tiltAngle:b.min.tiltAngle,scaleFallOffFactor:r.curvatureDependent.min.scaleFallOffFactor},max:{curvature:b.max.curvature,tiltAngle:b.max.tiltAngle,scaleFallOffFactor:r.curvatureDependent.max.scaleFallOffFactor}},scaleStart:n.scaleStart,scaleFallOffRange:n.scaleFallOffRange,minPixelSize:r.minPixelSize})};f.applyScaleFactor=q;f.applyScaleFactorVec2=
function(a,b,c){void 0===c&&(c=[0,0]);var g=Math.min(Math.max(b.scale,p(a[1],b)/a[1]),1);c[0]=d.lerp(a[0]*g,a[0],b.factor);c[1]=d.lerp(a[1]*g,a[1],b.factor);return c};f.precomputeScaleFactor=function(a,b,c,g){a=t(a,b,c);a.minPixelSize=0;a.paddingPixels=0;a=q(1,a);g.scale=a;g.factor=0;g.minPixelSize=c.parameters.minPixelSize;g.paddingPixels=c.paddingPixelsOverride};f.applyPrecomputedScaleFactor=function(a,b,c){void 0===c&&(c=[0,0]);b=Math.min(Math.max(b.scale,p(a[1],b)/a[1]),1);c[0]=a[0]*b;c[1]=a[1]*
b;return c};f.scale=function(a,b,c,g){return q(a,t(b,c,g))};var u=function(){function a(b,c,a,e){void 0===a&&(a={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0});this.viewingMode=b;this.description=c;this.parameters=a;this._paddingPixelsOverride=e;"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,
this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}Object.defineProperty(a.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!0,configurable:!0});a.prototype.update=function(b){if(this.parameters&&this.parameters.camera.fovY===b.fovY&&this.parameters.camera.distance===b.distance)return!1;this.calculateParameters(b,this.parameters);return!0};a.prototype.overridePadding=function(b){return b!==
this.paddingPixelsOverride?new a(this.viewingMode,this.description,this.parameters,b):this};a.prototype.calculateParameters=function(b,a){var c=this.description,e=c.scaleStart,d=c.scaleFallOffRange,c=c.minPixelSize,f=b.fovY,h=b.distance,l=this.calculateCurvatureDependentParameters(b),k=this.coverageCompensation(b,l),m=l.tiltAngle,l=l.scaleFallOffFactor,h=Math.sin(m)*h,m=.5*Math.PI-m-f*(.5-e*k),e=h/Math.cos(m),d=(e-h/Math.cos(m+f*d*k)*l)/(1-l);a.camera.fovY=b.fovY;a.camera.distance=b.distance;a.offset=
d;a.divisor=e-d;a.minPixelSize=c;return a};a.prototype.calculateCurvatureDependentParametersLocal=function(b,a){void 0===a&&(a=v);a.tiltAngle=this.description.curvatureDependent.min.tiltAngle;a.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;return a};a.prototype.calculateCurvatureDependentParametersGlobal=function(b,a){void 0===a&&(a=v);var c=this.description.curvatureDependent;b=1+b.distance/h.earthRadius;var e=[c.min.curvature,c.max.curvature],f=e[0];b=d.clamp((Math.sqrt(b*
b-1)-f)/(e[1]-f),0,1);e=[c.min,c.max];c=e[0];e=e[1];a.tiltAngle=d.lerp(c.tiltAngle,e.tiltAngle,b);a.scaleFallOffFactor=d.lerp(c.scaleFallOffFactor,e.scaleFallOffFactor,b);return a};a.prototype.surfaceCoverageCompensationLocal=function(a,c){return(a.fovY-c.tiltAngle)/a.fovY};a.prototype.surfaceCoverageCompensationGlobal=function(a,c){var b=h.earthRadius*h.earthRadius;c=c.tiltAngle+.5*Math.PI;var e=a.fovY;a=a.distance;a=a*a+b-2*Math.cos(c)*a*h.earthRadius;var d=Math.sqrt(a);return(Math.acos(Math.sqrt(a-
b)/d)-Math.asin(h.earthRadius/(d/Math.sin(c)))+.5*e)/e};return a}(),n={curvatureDependent:{min:{curvature:d.deg2rad(10),tiltAngle:d.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:d.deg2rad(70),tiltAngle:d.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},r={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14},k={scale:0,factor:0,minPixelSize:0,paddingPixels:0},v={tiltAngle:0,scaleFallOffFactor:0}});