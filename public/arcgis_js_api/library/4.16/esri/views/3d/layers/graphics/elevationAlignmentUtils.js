// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ./graphicUtils ../../support/ElevationProvider ../../support/projectionUtils".split(" "),function(H,f,A,B,C,D,E,u,w){function y(a,b,c,d,e){var g=a.z||0;switch(c.mode){case "on-the-ground":return a=u.getElevationAtPoint(b,a,"ground")||0,e&&(e.verticalDistanceToGround=0,e.sampledElevation=a),a;case "relative-to-ground":return a=
u.getElevationAtPoint(b,a,"ground")||0,c=c.geometryZWithOffset(g,d),e&&(e.verticalDistanceToGround=c,e.sampledElevation=a),c+a;case "relative-to-scene":return a=u.getElevationAtPoint(b,a,"scene")||0,c=c.geometryZWithOffset(g,d),e&&(e.verticalDistanceToGround=c,e.sampledElevation=a),c+a;case "absolute-height":return c=c.geometryZWithOffset(g,d),e&&(a=u.getElevationAtPoint(b,a,"ground")||0,e.verticalDistanceToGround=c-a,e.sampledElevation=a),c;default:return A.neverReached(c.mode),0}}Object.defineProperty(f,
"__esModule",{value:!0});f.applyPerVertexElevationAlignment=function(a,b,c,d,e,g,h,k,n,q,l){var m=F[l.mode],f=0;if(w.bufferToBuffer(a,b,c,d,n.spatialReference,e,k)&&(m.requiresAlignment(l)?(f=m.applyElevationAlignmentBuffer(d,e,g,h,k,n,q,l),a=g,e=h):a=d,w.bufferToBuffer(a,n.spatialReference,e,g,q.spatialReference,h,k)))return f};f.evaluateElevationAlignmentAtPoint=y;f.elevationModeChangeUpdateType=function(a,b,c){return null==b||null==c?a.definedChanged:"on-the-ground"===b&&"on-the-ground"===c?a.staysOnTheGround:
b===c||"on-the-ground"!==b&&"on-the-ground"!==c?z.UPDATE:a.onTheGroundChanged};f.needsElevationUpdates2D=function(a){return"relative-to-ground"===a||"relative-to-scene"===a};f.needsElevationUpdates3D=function(a){return"absolute-height"!==a};f.applyElevationAlignmentForHUD=function(a,b,c,d,e){c=y(b,c,e,d,x);E.updateVertexAttributeAuxpos1w(a,x.verticalDistanceToGround);e=x.sampledElevation;var g=B.mat4.copy(G,a.objectTransformation);v[0]=b.x;v[1]=b.y;v[2]=c;w.computeLinearTransformation(b.spatialReference,
v,g,d.spatialReference)?a.objectTransformation=g:console.warn("Could not locate symbol object properly, it might be misplaced");return e};var z;(function(a){a[a.NONE=0]="NONE";a[a.UPDATE=1]="UPDATE";a[a.RECREATE=2]="RECREATE"})(z=f.SymbolUpdateType||(f.SymbolUpdateType={}));var F={"absolute-height":{applyElevationAlignmentBuffer:function(a,b,c,d,e,g,h,k){g=k.calculateOffsetRenderUnits(h);k=k.featureExpressionInfoContext;b*=3;d*=3;for(h=0;h<e;++h){var n=a[b+1],f=a[b+2];c[d+0]=a[b+0];c[d+1]=n;c[d+2]=
null==k?f+g:g;b+=3;d+=3}return 0},requiresAlignment:function(a){var b=a.featureExpressionInfoContext;return 0!==a.meterUnitOffset||null!=b}},"on-the-ground":{applyElevationAlignmentBuffer:function(a,b,c,d,e,g){var h=0,k=g.spatialReference;b*=3;d*=3;for(var n=0;n<e;++n){var f=a[b+0],l=a[b+1],m=g.getElevation(f,l,a[b+2],k,"ground")||0,h=h+m;c[d+0]=f;c[d+1]=l;c[d+2]=m;b+=3;d+=3}return h/e},requiresAlignment:function(){return!0}},"relative-to-ground":{applyElevationAlignmentBuffer:function(a,b,c,d,e,
g,h,k){var f=0;h=k.calculateOffsetRenderUnits(h);k=k.featureExpressionInfoContext;var q=g.spatialReference;b*=3;d*=3;for(var l=0;l<e;++l){var m=a[b+0],r=a[b+1],t=a[b+2],p=g.getElevation(m,r,t,q,"ground")||0,f=f+p;c[d+0]=m;c[d+1]=r;c[d+2]=null==k?t+p+h:p+h;b+=3;d+=3}return f/e},requiresAlignment:function(){return!0}},"relative-to-scene":{applyElevationAlignmentBuffer:function(a,b,c,d,e,g,h,f){var k=0;h=f.calculateOffsetRenderUnits(h);f=f.featureExpressionInfoContext;var q=g.spatialReference;b*=3;d*=
3;for(var l=0;l<e;++l){var m=a[b+0],r=a[b+1],t=a[b+2],p=g.getElevation(m,r,t,q,"scene")||0,k=k+p;c[d+0]=m;c[d+1]=r;c[d+2]=null==f?t+p+h:p+h;b+=3;d+=3}return k/e},requiresAlignment:function(){return!0}}},G=C.mat4f64.create(),x={verticalDistanceToGround:0,sampledElevation:0},v=D.vec3f64.create()});