// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../geometry ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/scheduling".split(" "),function(h,l,c,u,v,w,r,k,x){Object.defineProperty(l,"__esModule",{value:!0});h=function(){function b(a,d){this.spatialReference=a;this.view=d}b.prototype.getElevation=function(a,d,e){return this.view.elevationProvider.getElevation(a,d,0,this.spatialReference,e)};b.prototype.queryElevation=function(a,
d,e,b,f){return c.__awaiter(this,void 0,void 0,function(){return c.__generator(this,function(c){return[2,this.view.elevationProvider.queryElevation(a,d,0,this.spatialReference,e,b,f)]})})};return b}();l.ViewElevationProvider=h;h=function(){function b(a,d,e){this.spatialReference=a;this._getElevationQueryProvider=d;this._queries=[];this._isScheduled=!1;this._queryOptions=c.__assign(c.__assign({},e),{ignoreInvisibleLayers:!0})}b.prototype.queryElevation=function(a,d,e,b){void 0===b&&(b=0);return c.__awaiter(this,
void 0,void 0,function(){var f=this;return c.__generator(this,function(c){return[2,k.create(function(c,m){var g={x:a,y:d,minDemResolution:b,result:{resolve:c,reject:m},signal:e};f._queries.push(g);k.onAbort(e,function(){v.remove(f._queries,g);m(k.createAbortError())});f._scheduleDoQuery()})]})})};b.prototype._scheduleDoQuery=function(){var a=this;this._isScheduled||(x.schedule(function(){return a._doQuery()}),this._isScheduled=!0)};b.prototype._doQuery=function(){return c.__awaiter(this,void 0,void 0,
function(){var a,b,e,h,f,g,l,m,t,q,p,n;return c.__generator(this,function(d){switch(d.label){case 0:this._isScheduled=!1;a=this._queries;this._queries=[];if(0===a.length)return[2];b=a.map(function(a){return[a.x,a.y]});e=a.reduce(function(a,b){return Math.min(a,b.minDemResolution)},Infinity);h=new u.Multipoint({points:b,spatialReference:this.spatialReference});f=this._getElevationQueryProvider();if(!f)return a.forEach(function(a){return a.result.reject()}),[2];g=1<a.length&&a.some(function(a){return!!a.signal})?
k.createAbortController():null;l=r.isSome(g)?g.signal:a[0].signal;r.isSome(g)&&(m=0,a.forEach(function(b){return k.onAbort(b.signal,function(){m++;b.result.reject(k.createAbortError());m===a.length&&g.abort()})}));t=c.__assign(c.__assign({},this._queryOptions),{minDemResolution:e,signal:l});return[4,w.result(f.queryElevation(h,t))];case 1:q=d.sent();for(p=0;p<a.length;p++)n=a[p],r.isSome(n.signal)&&n.signal.aborted?n.result.reject(k.createAbortError()):!1===q.ok?n.result.reject(q.error):n.result.resolve(q.value.geometry.points[p][2]);
return[2]}})})};return b}();l.ElevationQuery=h});