// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../layers/graphics/dehydratedFeatures ../../../../tasks/operations/query ../../support/PBFDecoder".split(" "),function(r,h,c,e,f,g,d,k,l,m){Object.defineProperty(h,"__esModule",{value:!0});var n=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}c.__extends(a,b);Object.defineProperty(a.prototype,"queryFeaturesDehydrated",
{get:function(){var a=this,b=this.layer.capabilities;if((b=b&&b.query)&&b.supportsFormatPBF){f.isNone(this._decoder)&&(this._decoder=new m.PBFDecoder(this.scheduler));var c={type:"dehydrated",sourceSpatialReference:this.layer.spatialReference?this.layer.spatialReference.toJSON():null,applyTransform:!0,maxStringAttributeLength:1024};return function(b,d){return l.runQuery(a.layer.parsedUrl,b,"pbf",d).then(function(b){g.throwIfAborted(d);return f.isSome(a._decoder)?a._decoder.invoke({buffer:b.data,options:c}):
g.reject(g.createAbortError())})}}return function(b,c){return l.executeQuery(a.layer.parsedUrl,b,a.layer.spatialReference,c).then(function(a){return k.fromFeatureSetJSON(a.data)})}},enumerable:!0,configurable:!0});a.prototype.queryFeatureCount=function(a,b){return this.layer.queryFeatureCount(a,b)};a.prototype.destroy=function(){this._decoder=f.destroyMaybe(this._decoder)};c.__decorate([d.property({constructOnly:!0})],a.prototype,"layer",void 0);c.__decorate([d.property({constructOnly:!0})],a.prototype,
"scheduler",void 0);c.__decorate([d.property({readOnly:!0,dependsOn:["layer.capabilities.query.supportsFormatPBF"]})],a.prototype,"queryFeaturesDehydrated",null);return a=c.__decorate([d.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],a)}(e),p=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}c.__extends(a,b);a.prototype.queryFeaturesDehydrated=function(a,b){return this.layer.queryFeatures(a,b)};c.__decorate([d.property({constructOnly:!0})],
a.prototype,"layer",void 0);return a=c.__decorate([d.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],a)}(e),q=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}c.__extends(a,b);a.prototype.destroy=function(){};a.prototype.queryFeaturesDehydrated=function(a,b){var c=this;return this.source.queryFeaturesJSON(a,b).then(k.fromFeatureSetJSON,function(d){if(d&&"query-features-json:unsupported"===d.name)return c.layer.queryFeatures(a,b);throw d;
})};a.prototype.queryFeatureCount=function(a,b){return this.layer.queryFeatureCount(a,b)};c.__decorate([d.property({constructOnly:!0})],a.prototype,"layer",void 0);c.__decorate([d.aliasOf("layer.source")],a.prototype,"source",void 0);return a=c.__decorate([d.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],a)}(e);h.createFeatureTileQuery3D=function(b,a){switch(b.source.type){case "feature-layer":return new n({layer:b,scheduler:a});case "memory":case "csv":case "geojson":return new q({layer:b});
case "ogc-feature":return new p({layer:b});case "stream-layer":throw Error("Tile based queries unsupported for stream sources");}}});