// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/accessorSupport/watch ../../../core/libs/gl-matrix-2/vec3f64 ../../ViewAnimation ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/earthUtils ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),function(f,l,c,r,t,m,d,u,g,v,w,x,k,n,y,h){Object.defineProperty(l,"__esModule",{value:!0});f=function(f){function b(a){a=
f.call(this,a)||this;a.propertiesPool=new y.default({camera:h.default},a);a.lastSeenCameraProjectionValues=new h.default;a.events=new t;a._cameraChanged=!1;a.updateQueue=[];a.processingUpdates=!1;return a}c.__extends(b,f);b.prototype.destroy=function(){this.cameraController=null;this.propertiesPool=m.destroyMaybe(this.propertiesPool)};b.prototype.normalizeCtorArgs=function(a){return{camera:this.createInitialCamera(a.viewingMode),mode:a.viewingMode,spatialReference:a.spatialReference,constraints:new w.default({mode:a.viewingMode})}};
Object.defineProperty(b.prototype,"animation",{get:function(){return this.cameraController instanceof x.AnimationController&&m.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"camera",{get:function(){return this._get("camera")},set:function(a){var b=this;a!==e&&e.copyFrom(a);e.markViewDirty();e.computeUp(this.mode);p.camera=e;this.events.emit("before-camera-change",p);a=this._get("camera");this.cameraProjectionChanged(this.lastSeenCameraProjectionValues,
e)&&(this.lastSeenCameraProjectionValues.copyFrom(e),q.camera=this.lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",q));if(!a||!a.equals(e))if(this._set("camera",this.propertiesPool.get("camera").copyFrom(e)),this._cameraChanged=!a||!a.almostEquals(e))var c=u.afterDispatch(function(){b._cameraChanged=!1;c.remove()})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"isLocal",{get:function(){return"local"===this.mode},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"navigating",{get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"stationary",{get:function(){return!this._cameraChanged&&!this.navigating},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"cameraController",{get:function(){return this._get("cameraController")},set:function(a){var b=
this;this.stopActiveCameraController()?(a&&(a.watch("state",function(c){if(c===k.State.Finished||c===k.State.Stopped)b._set("cameraController",null),b.updateCamera(function(b){return a.onControllerEnd(b)})},!0),a.onControllerStart(this.camera)),this._set("cameraController",a)):a&&(a.state=k.State.Rejected)},enumerable:!0,configurable:!0});b.prototype.switchCameraController=function(a){this.cameraController=a;return a.state!==k.State.Rejected};b.prototype.stopActiveCameraController=function(){return this.cameraController&&
!this.cameraController.stopController()?!1:!0};b.prototype.updateCamera=function(a){this.updateQueue.push(a);this.processUpdateQueue()};b.prototype.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var a=this.updateQueue.shift();e.copyFrom(this._get("camera"));a(e);this.camera=e;this.processingUpdates=!1;this.processUpdateQueue()}};b.prototype.createInitialCamera=function(a){return"global"===a?new h.default(g.vec3f64.fromValues(4*n.earthRadius,
0,0),g.vec3f64.fromValues(n.earthRadius,0,0),g.vec3f64.fromValues(0,0,1)):new h.default(g.vec3f64.fromValues(0,0,100),g.vec3f64.fromValues(0,0,0),g.vec3f64.fromValues(0,1,0))};b.prototype.cameraProjectionChanged=function(a,b){return a.fov!==b.fov||a.fullViewport[0]!==b.fullViewport[0]||a.fullViewport[1]!==b.fullViewport[1]||a.fullViewport[2]!==b.fullViewport[2]||a.fullViewport[3]!==b.fullViewport[3]||a.padding[0]!==b.padding[0]||a.padding[1]!==b.padding[1]||a.padding[2]!==b.padding[2]||a.padding[3]!==
b.padding[3]?!0:!1};c.__decorate([d.property({readOnly:!0,type:v,dependsOn:["cameraController"]})],b.prototype,"animation",null);c.__decorate([d.property({type:h.default})],b.prototype,"camera",null);c.__decorate([d.property({constructOnly:!0})],b.prototype,"constraints",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"events",void 0);c.__decorate([d.property({readOnly:!0,dependsOn:["isLocal"]})],b.prototype,"isGlobal",null);c.__decorate([d.property({readOnly:!0,dependsOn:["mode"]})],
b.prototype,"isLocal",null);c.__decorate([d.property({constructOnly:!0})],b.prototype,"mode",void 0);c.__decorate([d.property({constructOnly:!0})],b.prototype,"spatialReference",void 0);c.__decorate([d.property({readOnly:!0,dependsOn:["cameraController"]})],b.prototype,"navigating",null);c.__decorate([d.property({readOnly:!0,dependsOn:["navigating","_cameraChanged"]})],b.prototype,"stationary",null);c.__decorate([d.property()],b.prototype,"_cameraChanged",void 0);c.__decorate([d.property()],b.prototype,
"cameraController",null);return b=c.__decorate([d.subclass("esri.views.3d.state.ViewState")],b)}(r);l.ViewState=f;var e=new h.default,p={camera:null},q={camera:null};l.default=f});