// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../../../core/maybe","./util"],function(K,t,I,x){function y(a){return a.length-1}function F(a){for(var g=0,d=0;d<y(a);d++)g+=J(a,d);return g}function J(a,g,d){void 0===d&&(d=1);g=a[g+1];a=g[0];g=g[1];return Math.sqrt(a*a+g*g)*d}function G(a,g,d,b,m){if(!(d<g)){var c=b.clone().seek(d/2);I.isNone(c)||(a(c.clone(),d,m),d=(d-g)/2,c=I.unwrap(c.seek(g/2)),G(a,g,d,b,m+1),G(a,g,d,c,m+1))}}Object.defineProperty(t,"__esModule",{value:!0});t.segmentAt=function(a,g){return a[g+
1]};t.segmentCount=y;t.pathLength=F;t.segmentLength=J;var H=function(){function a(a,d,b,m,c){this._segments=a;this._index=d;this._distance=b;this._xStart=m;this._yStart=c;this._done=!1}a.create=function(g){return new a(g,0,0,g[0][0],g[0][1])};a.prototype.clone=function(){return new a(this._segments,this._index,this._distance,this.xStart,this.yStart)};a.prototype.equals=function(a){return this._index===a._index||a._index===this._index-1&&(0===this._distance||1===a._distance)||a._index===this._index+
1&&(1===this._distance||0===a._distance)};a.prototype.leq=function(a){return this._index<a._index||this._index===a._index&&this._distance<=a._distance};a.prototype.geq=function(a){return this._index>a._index||this._index===a._index&&this._distance>=a._distance};Object.defineProperty(a.prototype,"_segment",{get:function(){return this._segments[this._index+1]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"angle",{get:function(){var a=this.dy,d=Math.acos((0*a+-1*-this.dx)/(1*this.length));
0<a&&(d=2*Math.PI-d);return d},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"xStart",{get:function(){return this._xStart},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"yStart",{get:function(){return this._yStart},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"x",{get:function(){return this.xStart+this.distance*this.dx},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"y",{get:function(){return this.yStart+this.distance*
this.dy},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"dx",{get:function(){return this._segment[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"dy",{get:function(){return this._segment[1]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"xMidpoint",{get:function(){return this.xStart+.5*this.dx},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"yMidpoint",{get:function(){return this.yStart+.5*this.dy},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"xEnd",{get:function(){return this.xStart+this.dx},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"yEnd",{get:function(){return this.yStart+this.dy},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"length",{get:function(){var a=this.dx,d=this.dy;return Math.sqrt(a*a+d*d)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"remainingLength",{get:function(){return this.length*(1-this._distance)},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"backwardLength",{get:function(){return this.length*this._distance},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"done",{get:function(){return this._done},enumerable:!0,configurable:!0});a.prototype.hasPrev=function(){return 0<=this._index-1};a.prototype.hasNext=function(){return this._index+1<y(this._segments)};a.prototype.next=
function(){if(!this.hasNext())return null;this._xStart+=this.dx;this._yStart+=this.dy;this._distance=0;this._index+=1;return this};a.prototype.prev=function(){if(!this.hasPrev())return this._done=!0,null;--this._index;this._xStart-=this.dx;this._yStart-=this.dy;this._distance=1;return this};a.prototype._seekBackwards=function(a,d){var b=this.backwardLength;if(a<=b)return this._distance=(b-a)/this.length,this;for(b=this.backwardLength;this.prev();){if(b+this.length>a)return this._seekBackwards(a-b);
b+=this.length}this._distance=0;return d?this:null};a.prototype.seek=function(a,d){void 0===d&&(d=!1);if(0>a)return this._seekBackwards(Math.abs(a),d);if(a<=this.remainingLength)return this._distance=(this.backwardLength+a)/this.length,this;for(var b=this.remainingLength;this.next();){if(b+this.length>a)return this.seek(a-b,d);b+=this.length}this._distance=1;return d?this:null};return a}();t.SegmentCursor=H;t.pathDivide=function(a,g,d){var b=F(a);a=H.create(a);var m=b/2,c=Math.floor((b-g)/2/g);a.seek(m-
c*g);for(var h=-c;h<=c;h++)512>a.x&&0<=a.x&&512>a.y&&0<=a.y&&d(a.clone(),h,m+h*g,b),a.seek(g)};t.pathSubdivide=function(a,g,d){G(d,g,F(a),H.create(a),0)};t.smoothPaths=function(a,g){for(var d=0;d<a.length;d++){var b=a[d],m=[];m.push(b[0]);for(var c=1;c<b.length;c++){var h=m[c-1],e=h[0],h=h[1],e=e+b[c][0],h=h+b[c][1];m.push([e,h])}e=m;h=g;if(!(0>=h||(b=e.length,3>b))){var c=[],p=0;c.push(0);for(var f=1;f<b;f++)p+=x.dist(e[f],e[f-1]),c.push(p);h=Math.min(h,.2*p);p=[];p.push(e[0][0]);p.push(e[0][1]);
var t=e[b-1][0],y=e[b-1][1],f=x.sub([0,0],e[0],e[1]);x.normalize(f);e[0][0]+=h*f[0];e[0][1]+=h*f[1];x.sub(f,e[b-1],e[b-2]);x.normalize(f);e[b-1][0]+=h*f[0];e[b-1][1]+=h*f[1];for(f=1;f<b;f++)c[f]+=h;c[b-1]+=h;for(var w=.5*h,f=1;f<b-1;f++){for(var D=0,E=0,z=0,k=f-1;0<=k&&!(c[k+1]<c[f]-w);k--){var q=w+c[k+1]-c[f],n=c[k+1]-c[k],l=c[f]-c[k]<w?1:q/n;if(1E-6>Math.abs(l))break;var u=l*l,A=l*q-.5*u*n,v=l*n/h,r=e[k+1],B=e[k][0]-r[0],C=e[k][1]-r[1],D=D+v/A*(r[0]*l*q+.5*u*(q*B-n*r[0])-u*l*n*B/3),E=E+v/A*(r[1]*
l*q+.5*u*(q*C-n*r[1])-u*l*n*C/3),z=z+v}for(k=f+1;k<b&&!(c[k-1]>c[f]+w);k++){q=w-c[k-1]+c[f];n=c[k]-c[k-1];l=c[k]-c[f]<w?1:q/n;if(1E-6>Math.abs(l))break;u=l*l;A=l*q-.5*u*n;v=l*n/h;r=e[k-1];B=e[k][0]-r[0];C=e[k][1]-r[1];D+=v/A*(r[0]*l*q+.5*u*(q*B-n*r[0])-u*l*n*B/3);E+=v/A*(r[1]*l*q+.5*u*(q*C-n*r[1])-u*l*n*C/3);z+=v}p.push(D/z);p.push(E/z)}p.push(t);p.push(y);for(k=f=0;f<b;f++)e[f][0]=p[k++],e[f][1]=p[k++]}b=[];b.push(m[0]);for(c=1;c<m.length;c++)e=m[c-1],f=e[0],p=e[1],h=m[c],e=h[0],h=h[1],b.push([Math.round(e-
f),Math.round(h-p)]);a[d]=b}return a}});