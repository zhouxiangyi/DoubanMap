// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../core/MapUtils ../../../../../core/maybe ../definitions ./Effect".split(" "),function(e,f,n,t,p,u,v){Object.defineProperty(f,"__esModule",{value:!0});e=function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.name=a.constructor.name;a.defines=["id"];a._lastSize=0;return a}n.__extends(b,c);b.prototype.dispose=function(){p.isSome(this._fbo)&&this._fbo.dispose()};b.prototype.bind=function(a){var g=a.context;a=a.painter;var b=g.getViewport();
a=a.getFbos(b.width,b.height).effect0;g.bindFramebuffer(a);g.setClearColor(0,0,0,0);g.clear(g.gl.COLOR_BUFFER_BIT)};b.prototype.unbind=function(){};b.prototype.draw=function(a,b,c){var g=this,e=a.context,f=a.state,m=a.pixelRatio;void 0===c&&(c=u.HITTEST_SEARCH_SIZE);var n=e.getBoundFramebufferObject(),p=f.size[1]*m,d=Math.round(c*m),q=d/2,r=d/2;this._ensureBuffer(d);b.forEach(function(a,c){var h=new Map;n.readPixels(Math.floor(c[0]*m-d/2),Math.floor(p-c[1]*m-d/2),d,d,6408,5121,g._buf);for(var k=0;k<
g._buf32.length;k++){var l=g._buf32[k];if(4294967295!==l&&0!==l){var e=k%d,f=d-Math.floor(k/d),e=(q-e)*(q-e)+(r-f)*(r-f),f=h.has(l)?h.get(l):4294967295;h.set(l,Math.min(e,f))}}h=t.pairsOfMap(h).sort(function(a,b){return a[1]-b[1]}).map(function(a){return a[0]});a.resolve(h);b.delete(c)})};b.prototype._ensureBuffer=function(a){this._lastSize!==a&&(this._lastSize=a,this._buf=new Uint8Array(4*a*a),this._buf32=new Uint32Array(this._buf.buffer))};return b}(v.Effect);f.HittestEffect=e});