// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f32 ../../../core/libs/gl-matrix-2/vec2f32 ../../webgl ./DisplayObject ./ImageryBitmapSource".split(" "),function(f,l,n,e,p,g,q,r,t){function u(d){var a=document.createElement("canvas");a.width=d.width;a.height=d.height;d.render(a.getContext("2d"));return a}function m(d,a,c){var h={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};a&&c&&(h.width=a,h.height=c);return new q.Texture(d,
h)}Object.defineProperty(l,"__esModule",{value:!0});f=function(d){function a(c,a){void 0===c&&(c=null);void 0===a&&(a=!0);var b=d.call(this)||this;b.requestRenderOnSourceChangedEnabled=a;b.stencilRef=0;b.coordScale=[1,1];b._height=void 0;b.pixelRatio=1;b.resolution=0;b.rotation=0;b._source=null;b._width=void 0;b.x=0;b.y=0;b.transforms={dvs:p.mat3f32.create()};b.source=c;b.requestRender=b.requestRender.bind(b);return b}n.__extends(a,d);Object.defineProperty(a.prototype,"isSourceScaled",{get:function(){return this.width!==
this.sourceWidth||this.height!==this.sourceHeight},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return void 0!==this._height?this._height:this.sourceHeight},set:function(c){this._height=c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"source",{get:function(){return this._source},set:function(c){this._source=c;this.invalidateTexture()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sourceHeight",{get:function(){return this._source instanceof
HTMLImageElement?this._source.naturalHeight:this._source.height},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sourceWidth",{get:function(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return void 0!==this._width?this._width:this.sourceWidth},set:function(c){this._width=c},enumerable:!0,configurable:!0});a.prototype.invalidateTexture=function(){this._updateTexture()};
a.prototype.setTransform=function(c){var a=e.mat3.identity(this.transforms.dvs),b=c.toScreenNoRotation([0,0],this.x,this.y),d=this.resolution/this.pixelRatio/c.resolution,k=d*this.width,d=d*this.height,f=Math.PI*this.rotation/180;e.mat3.translate(a,a,g.vec2f32.fromValues(b[0],b[1]));e.mat3.translate(a,a,g.vec2f32.fromValues(k/2,d/2));e.mat3.rotate(a,a,-f);e.mat3.translate(a,a,g.vec2f32.fromValues(-k/2,-d/2));e.mat3.scaleByVec2(a,a,g.vec2f32.fromValues(k,d));e.mat3.multiply(this.transforms.dvs,c.displayViewMat3,
a)};a.prototype.setSamplingProfile=function(a){this._texture&&(a.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(a.samplingMode))};a.prototype.bind=function(a){this._texture&&this.stage.context.bindTexture(this._texture,a)};a.prototype.onAttach=function(){this.invalidateTexture()};a.prototype.onDetach=function(){this.invalidateTexture()};a.prototype._updateTexture=function(){var a;this.stage?(this._texture||(this._texture=this.source?m(this.stage.context,
this.sourceWidth,this.sourceHeight):m(this.stage.context)),(a=this.source)?(this._texture.resize(this.sourceWidth,this.sourceHeight),a&&"render"in a?a instanceof t.default?(a=a.getRenderedRasterPixels(),this._texture.setData(a.renderedRasterPixels)):this._texture.setData(u(a)):!a||"render"in a||this._texture.setData(a),this.ready(),this.requestRenderOnSourceChangedEnabled&&this.requestRender()):this._texture.setData(null)):(null===(a=this._texture)||void 0===a?void 0:a.dispose(),this._texture=null)};
return a}(r.DisplayObject);l.Bitmap=f});