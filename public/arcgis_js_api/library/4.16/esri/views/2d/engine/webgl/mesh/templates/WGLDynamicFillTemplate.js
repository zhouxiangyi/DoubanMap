// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../../core/mathUtils ../../../../../../core/screenUtils ../../color ../../GeometryUtils ../../number ../../materialKey/MaterialKey ./util ./WGLBaseFillTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),function(n,q,x,t,p,u,v,l,w,f,y,z,A){Object.defineProperty(q,"__esModule",{value:!0});n=function(n){function m(B,a){var c=n.call(this,a)||this;if(f.isFunction(a.color))c._dynamicPropertyMap.set("_fillColor",function(d,b,c){return(d=a.color(d,b,c))&&
u.premultiplyAlphaRGBA(d)||0});else{var l=a.color;c.fillColor=l&&u.premultiplyAlphaRGBA(l)||0}var k=0;f.isFunction(a.height)||(k=a.height||0);c._dynamicPropertyMap.set("_height",function(d,b,c){return f.isFunction(a.height)?a.height(d,b,c):k});var e=0;f.isFunction(a.offsetX)||(e=p.pt2px(a.offsetX||0)+128,255<e&&(e=255));c._dynamicPropertyMap.set("_offsetX",function(d,b,c){return f.isFunction(a.offsetX)?(d=p.pt2px(a.offsetX(d,b,c))+128,255<d&&(d=255),d):e});var b=1;f.isFunction(a.scaleX)||(b=a.scaleX||
1);c._dynamicPropertyMap.set("_scaleX",function(d,c,e){return f.isFunction(a.scaleX)?a.scaleX(d,c,e):b});var g=0;f.isFunction(a.offsetY)||(g=p.pt2px(-a.offsetY||0)+128,255<g&&(g=255));c._dynamicPropertyMap.set("_offsetY",function(d,c,b){return f.isFunction(a.offsetY)?(d=p.pt2px(-a.offsetY(d,c,b))+128,255<d&&(d=255),d):g});var h=0;f.isFunction(a.angle)||(h=v.radToByte(a.angle)||0);c._dynamicPropertyMap.set("_angle",function(c,b,e){return f.isFunction(a.angle)?v.radToByte(a.angle(c,b,e)):h});c.isBFS=
!1;c.effects=a.effects;c._cimFillLayer=a;c._fillMaterialKey=w.FillMaterialKey.load(w.createMaterialKey(c.geometryType,B,!1));return c}x.__extends(m,n);m.fromCIMFill=function(f,a){return new m(f,a)};m.prototype.bindFeature=function(f,a,c){var n=this;this._dynamicPropertyMap.forEach(function(b,d){n[d]=b(f,a,c)});var k=this._fillMaterialKey,e=this._materialCache,b=this._cimFillLayer;this.aux3=l.i8888to32(0,0,this._angle,b.colorLocked?1:0);b=b.materialHash;b=b(f,a,c);b=e.get(b);e=null;b&&A.ok(b.spriteMosaicItem)&&
(e=b.spriteMosaicItem);if(e){var g=e.rect,h=e.width,d=e.height,b=g.x+1,g=g.y+1,m=b+h,q=g+d,r=t.nextHighestPowerOfTwo(p.pt2px(this._height));255<r?r=255:0>=r&&(r=t.nextHighestPowerOfTwo(q-g));h=t.nextHighestPowerOfTwo(p.pt2px(this._height/d*h||0));255<h?h=255:0>=h&&(h=t.nextHighestPowerOfTwo(m-b));d=this._scaleX;this.tl=l.i1616to32(b,g);this.br=l.i1616to32(m,q);this.aux1=l.i8888to32(h,r,this._offsetX,this._offsetY);this.aux2=l.i1616to32(128*d,128);k.sdf=e.sdf;k.pattern=!0;k.textureBinding=e.textureBinding}else this.aux2=
this.aux1=this.br=this.tl=0,k.sdf=!1,k.pattern=!1,k.textureBinding=0;this._materialKey=k.data};return m}(y.default(z.default));q.default=n});