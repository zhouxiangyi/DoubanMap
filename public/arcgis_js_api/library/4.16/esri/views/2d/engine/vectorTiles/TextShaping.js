// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","./ScriptUtils","../webgl/Rect"],function(w,m,B,A){Object.defineProperty(m,"__esModule",{value:!0});m.SDF_GLYPH_SIZE=24;m.SDF_GLYPH_BASELINE=17;w=function(){function n(b,e,d,f,c,g,h){this._glyphItems=b;this._maxWidth=e;this._lineHeight=d;this._letterSpacing=f;this._hAnchor=c;this._vAnchor=g;this._justify=h}n.prototype.getShaping=function(b,e,d){for(var f=this._letterSpacing,c=this._lineHeight,g=this._justify,h=this._maxWidth,a=[],k=0,l=0,x=0,r=0,t=-1,u=0,m=-1,n=b.length,
z=0;z<n;z++){var y=b.charCodeAt(z),v=d&&B.hasVerticalOrientation(y);if(10===y)z!==n-1&&(t>=r&&(k=a[t],v=k.x+k.glyphMosaicItem.metrics.advance,u=Math.max(v,u),g&&this._applyJustification(a,r,t),r=a.length),l=e?l-c:l+c,k=0,++x);else{for(var q=void 0,p=0,w=this._glyphItems;p<w.length&&!(q=w[p][y]);p++);if(q){a.push({codePoint:y,x:k,y:l,vertical:v,glyphMosaicItem:q});k+=q.metrics.advance+f;if(0<h&&k>h&&0<=m){q=m+1;v=a[q].x;u=Math.max(v,u);for(p=q;p<a.length;p++)a[p].y=e?a[p].y-c:a[p].y+c,a[p].x-=v;g&&
this._applyJustification(a,r,m);l=e?l-c:l+c;k-=v;++x;r=q;m=-1}++t;32===y&&(m=a.length-1)}}}t>=r&&(k=a[t],u=Math.max(u,k.x+k.glyphMosaicItem.metrics.advance),g&&this._applyJustification(a,r,t));if(0<a.length)for(b=(g-this._hAnchor)*u,d=(-this._vAnchor*(x+1)+.5)*c,e&&x&&(d+=x*c),e=0;e<a.length;e++)c=a[e],c.x+=b,c.y+=d;return a};n.getTextBox=function(b,e){if(!b.length)return null;for(var d=Infinity,f=Infinity,c=0,g=0,h=0;h<b.length;h++)var a=b[h],k=a.x,l=a.y-m.SDF_GLYPH_BASELINE,a=k+a.glyphMosaicItem.metrics.advance,
n=l+e,d=Math.min(d,k),c=Math.max(c,a),f=Math.min(f,l),g=Math.max(g,n);return{x:d,y:f,width:c-d,height:g-f}};n.getBox=function(b){if(!b.length)return null;for(var e=Infinity,d=Infinity,f=0,c=0,g=0;g<b.length;g++)var h=b[g],a=h.glyphMosaicItem.metrics,k=a.height,l=h.x,h=h.y-(k-Math.abs(a.top)),a=l+a.width+a.left,k=h+k,e=Math.min(e,l),f=Math.max(f,a),d=Math.min(d,h),c=Math.max(c,k);return{x:e,y:d,width:f-e,height:c-d}};n.addDecoration=function(b,e){var d=b.length;if(0!==d){for(var f=b[0].x+b[0].glyphMosaicItem.metrics.left,
c=b[0].y,g=1;g<d;g++){var h=b[g];if(h.y!==c){var a=b[g-1].x+b[g-1].glyphMosaicItem.metrics.left+b[g-1].glyphMosaicItem.metrics.width;b.push({codePoint:0,x:f,y:c+e-3,vertical:!1,glyphMosaicItem:{sdf:!0,rect:new A.default(4,0,4,8),metrics:{width:a-f,height:8,left:0,top:0,advance:0},page:0,code:0}});c=h.y;f=h.x+h.glyphMosaicItem.metrics.left}}d=b[d-1].x+b[d-1].glyphMosaicItem.metrics.left+b[d-1].glyphMosaicItem.metrics.width;b.push({codePoint:0,x:f,y:c+e-3,vertical:!1,glyphMosaicItem:{sdf:!0,rect:new A.default(4,
0,4,8),metrics:{width:d-f,height:8,left:0,top:0,advance:0},page:0,code:0}})}};n.prototype._applyJustification=function(b,e,d){for(var f=b[d],f=(f.x+(f.vertical?m.SDF_GLYPH_SIZE:f.glyphMosaicItem.metrics.advance))*this._justify;e<=d;e++)b[e].x-=f};return n}();m.TextShaping=w});