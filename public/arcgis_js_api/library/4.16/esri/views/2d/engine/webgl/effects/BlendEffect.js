// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/Error ../../../../../core/Logger ../../../../webgl ../VertexStream ../shaders/BlendPrograms".split(" "),function(g,h,l,q,m,r,n){Object.defineProperty(h,"__esModule",{value:!0});var p=q.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect");g=function(){function b(){this._size=[0,0]}b.prototype.dispose=function(a){this._backBufferTexture&&(this._backBufferTexture.dispose(),this._backBufferTexture=null);this._programCache&&(this._programCache.dispose(),
this._programCache=null);this._quad&&(this._quad.dispose(),this._quad=null)};b.prototype.draw=function(a,d,f,e,b){var c=a.context;this._setupShader(c);e&&"normal"!==e?this._drawBlended(a,d,f,e,b):(a=this._programCache.getProgram(n.blend,"normal"))?(c.bindProgram(a),d.setSamplingMode(f),c.bindTexture(d,0),a.setUniform1i("u_layerTexture",0),a.setUniform1f("u_opacity",b),c.setBlendingEnabled(!0),c.setBlendFunction(1,771),d=this._quad,d.draw(),d.unbind()):p.error(new l("mapview-BlendEffect",'Error creating shader program for blend mode "normal"'))};
b.prototype._drawBlended=function(a,d,f,b,g){var c=a.context,e=a.pixelRatio,k=a.state.size;this._createOrResizeTexture(a);a=e*k[0];var k=e*k[1],h=c.getBoundFramebufferObject(),e=this._backBufferTexture;h.copyToTexture(0,0,a,k,0,0,e);c.setStencilTestEnabled(!1);c.setStencilWriteMask(0);c.setBlendingEnabled(!0);c.setDepthTestEnabled(!1);c.setDepthWriteEnabled(!1);(a=this._programCache.getProgram(n.blend,b))?(c.bindProgram(a),e.setSamplingMode(f),c.bindTexture(e,0),a.setUniform1i("u_backbufferTexture",
0),d.setSamplingMode(f),c.bindTexture(d,1),a.setUniform1i("u_layerTexture",1),a.setUniform1f("u_opacity",g),c.setBlendFunction(1,0),d=this._quad,d.draw(),d.unbind(),c.setBlendFunction(1,771)):p.error(new l("mapview-BlendEffect","Error creating shader program for blend mode "+b))};b.prototype._setupShader=function(a){this._programCache||(this._programCache=new m.ProgramCache(a),this._quad||(this._quad=new r(a,[-1,-1,1,-1,-1,1,1,1])))};b.prototype._createOrResizeTexture=function(a){var d=a.context,
b=a.pixelRatio,e=a.state.size;a=b*e[0];b*=e[1];if(null===this._backBufferTexture||a!==this._size[0]||b!==this._size[1])this._backBufferTexture?this._backBufferTexture.resize(a,b):this._backBufferTexture=new m.Texture(d,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:a,height:b}),this._size[0]=a,this._size[1]=b};return b}();h.BlendEffect=g});