// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../../core/Logger ../../../../../../core/libs/earcut/earcut ../../definitions ../../enums ../../number ../../TileClipper ../../WGLDisplayRecord ../../materialKey/MaterialKey ../Tesselator".split(" "),function(O,u,H,I,D,E,J,F,K,G,L,M){Object.defineProperty(u,"__esModule",{value:!0});var N=I.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLBaseFillTemplate"),w=[],x=[];u.default=function(u){return function(u){function g(){for(var c=[],a=0;a<arguments.length;a++)c[a]=
arguments[a];c=u.apply(this,c)||this;c.forceLibtess=!1;c.geometryType=J.WGLGeometryType.FILL;c._tesselator=new M.default;c._tileClipper=new K.TileClipper(0,0,0,1,8);c._tileClipper.setExtent(E.TILE_SIZE);return c}H.__extends(g,u);g.prototype.writeMeshWithGeometry=function(c,a,e,b,f,d){w.length=0;if("esriGeometryPolygon"!==e)"esriGeometryPolyline"!==e&&N.error("Unable to handle geometryType: "+e);else{e=L.FillMaterialKey.load(this._materialKey);var h=(f=this._isClippingRequired(d))?this._clip(d,!1):
d.rings;if(e.dotDensity){d=d.rings;for(var k=0,B=0;B<d.length;B++)for(var q=d[B],g=q[0],r=g[0],g=g[1],l=1;l<q.length;l++)var p=q[l],m=r+p[0],p=g+p[1],k=k-(m-r)*(p+g)/2,r=m,g=p;d=k}else d=0;this.forceLibtess?this._writeMeshLibtess(c,a,b,h,f,e,d):this._writeMeshEarcut(c,a,b,h,f,e,d)||this._writeMeshLibtess(c,a,b,h,f,e,d)}};g.prototype._isClippingRequired=function(c){var a=E.TILE_SIZE+8,e=0;for(c=c.rings;e<c.length;e++){var b=c[e],f=b.length;if(!(3>f)){var d=b[0][0],h=b[0][1];if(-8>d||d>a||-8>h||h>a)return!0;
for(var k=1;k<f;++k)if(d+=b[k][0],h+=b[k][1],-8>d||d>a||-8>h||h>a)return!0}}return!1};g.prototype._clip=function(c,a){var e;this._tileClipper.reset(3);for(var b=0,f=c.rings;b<f.length;b++){var d=f[b],h=d.length;if(!(3>h)){c=d[0][0];e=d[0][1];this._tileClipper.moveTo(c,e);for(var k=1;k<h;++k)c+=d[k][0],e+=d[k][1],this._tileClipper.lineTo(c,e);this._tileClipper.close()}}return this._tileClipper.result(a)};g.prototype._writeMeshLibtess=function(c,a,e,b,f,d,h){if(b&&b.length){var k=[],g=a.indexVector;
a=a.getVector("geometry");var q=new G(e,this.geometryType,this._materialKey),u=a.vertexCount;q.vertexFrom=u;q.indexFrom=g.length;this._tesselator.beginPolygon(w,k);for(var r=0;r<b.length;r++){var l=b[r];if(!(3>l.length)){this._tesselator.beginContour();var p=void 0,m=void 0;f?(p=l[0].x,m=l[0].y):(p=l[0][0],m=l[0][1]);var n=[p,m,0];this._tesselator.addVertex(n,n);for(n=1;n<l.length-1;n++){var t=void 0,v=void 0;f?(p=l[n].x,m=l[n].y):(t=l[n][0],v=l[n][1],p+=t,m+=v);t=[p,m,0];this._tesselator.addVertex(t,
t)}this._tesselator.endContour()}}this._tesselator.endPolygon();this._writeVerticesLibTess(q,a,e,w,d,h);this._writeIndicesLibTess(q,g,u,k);0<q.indexCount&&c.push(q)}};g.prototype._writeMeshEarcut=function(c,a,e,b,f,d,h){if(b&&b.length){var k=a.indexVector;a=a.getVector("geometry");var g=new G(e,this.geometryType,this._materialKey),q=k.length,u=a.data.length;g.vertexFrom=a.vertexCount;g.indexFrom=k.length;for(var r=0,l=0,p=0;p<b.length;p++){var m=b[p],n=l,t=void 0,v=void 0;f?(t=m[0].x,v=m[0].y):(t=
m[0][0],v=m[0][1]);w[l++]=t;w[l++]=v;for(var C=0,y=1;y<m.length;++y){var z=void 0,A=void 0;f?(z=t,A=v,t=m[y].x,v=m[y].y,z=t-z,A=v-A):(z=m[y][0],A=m[y][1],t+=z,v+=A);C-=z*(v+v-A);w[l++]=t;w[l++]=v}if(0<C){if(0<n-r){if(!this._write(g,k,a,e,w,x,r,n,d,h))return k.seek(q),a.data.seek(u),w.length=x.length=0,!1;r=n}x.length=0}else 0>C?0<n-r?x.push(.5*(n-r)):l=n:l=n}if(0<l-r&&!this._write(g,k,a,e,w,x,r,l,d,h))return k.seek(q),a.data.seek(u),w.length=x.length=0,!1;w.length=x.length=0;c.push(g);return!0}};
g.prototype._write=function(c,a,e,b,f,d,h,k,g,q){f=f.slice(h,k);h=D.earcut(f,d,2);if(0<D.deviation(f,d,2,h))return!1;if(h.length)return d=e.vertexCount,this._writeVertices(c,e,b,f,g,q),this._writeIndices(c,a,d,h),!0};g.prototype._writeVertices=function(c,a,e,b,f,d){for(var h=0;h<b.length;h+=2){var g=F.i1616to32(8*b[h],8*b[h+1]);a.data.push(g);a.data.push(e);f.dotDensity?a.data.writeF32(1/d):(a.data.push(this.fillColor),a.data.push(this.tl),a.data.push(this.br),a.data.push(this.aux1),a.data.push(this.aux2),
a.data.push(this.aux3));c.vertexCount++}};g.prototype._writeIndices=function(c,a,e,b){for(var f=0;f<b.length;f+=3)a.push(e+b[f]),a.push(e+b[f+1]),a.push(e+b[f+2]),c.indexCount+=3};g.prototype._writeVerticesLibTess=function(c,a,e,b,f,d){for(var h=0;h<b.length;h+=2){var g=F.i1616to32(8*b[h],8*b[h+1]);a.data.push(g);a.data.push(e);f.dotDensity?a.data.writeF32(1/d):(a.data.push(this.fillColor),a.data.push(this.tl),a.data.push(this.br),a.data.push(this.aux1),a.data.push(this.aux2),a.data.push(this.aux3));
c.vertexCount++}};g.prototype._writeIndicesLibTess=function(c,a,e,b){for(var f=0;f<b.length;f++)a.push(e+b[f]),c.indexCount++};return g}(u)}});