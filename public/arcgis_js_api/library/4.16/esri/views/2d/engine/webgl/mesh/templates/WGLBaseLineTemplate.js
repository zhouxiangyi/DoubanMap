// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../../../../core/has ../../definitions ../../enums ../../number ../../TileClipper ../../TurboLine ../../WGLDisplayRecord ../../materialKey/MaterialKey ./util".split(" "),function(J,x,A,K,w,B,d,C,q,D,E,y){Object.defineProperty(x,"__esModule",{value:!0});var u=w.TILE_SIZE+16,z=1/3.8,r=new C.TileClipper(0,0,0,1,16);r.setExtent(w.TILE_SIZE);var e=new Uint32Array(9),b=new Uint32Array(36),n=new Uint32Array(3),m=new Uint32Array(6),F=function(a){return function(c){var v=
Math.ceil(1024*a._halfWidth),h=Math.ceil(1024*a._halfReferenceWidth);c.entry0=a.offset+a.vertexCount++;var f=d.i1616to32(c.distance,v),l=d.i8888to32(Math.round(31*c.prevNormal.x),Math.round(31*c.prevNormal.y),Math.round(0),Math.round(-31)),p=d.i8888to32(0,0,0,a._bitset);b[0]=d.i1616to32(8*c.currentVertex.x,8*c.currentVertex.y);b[1]=a.id;b[2]=a._fillColor;b[3]=l;b[4]=f;b[5]=a._tl;b[6]=a._br;b[7]=p;b[8]=d.i1616to32(h,0);c.entry2=a.offset+a.vertexCount++;f=d.i1616to32(c.distance,v);l=d.i8888to32(Math.round(31*
-c.prevNormal.x),Math.round(31*-c.prevNormal.y),Math.round(0),Math.round(31));p=d.i8888to32(0,0,0,a._bitset);b[9]=d.i1616to32(8*c.currentVertex.x,8*c.currentVertex.y);b[10]=a.id;b[11]=a._fillColor;b[12]=l;b[13]=f;b[14]=a._tl;b[15]=a._br;b[16]=p;b[17]=d.i1616to32(h,0);c.exit0=a.offset+a.vertexCount++;f=d.i1616to32(c.distance,v);l=d.i8888to32(Math.round(31*c.nextNormal.x),Math.round(31*c.nextNormal.y),Math.round(0),Math.round(-31));p=d.i8888to32(0,0,0,a._bitset);b[18]=d.i1616to32(8*c.currentVertex.x,
8*c.currentVertex.y);b[19]=a.id;b[20]=a._fillColor;b[21]=l;b[22]=f;b[23]=a._tl;b[24]=a._br;b[25]=p;b[26]=d.i1616to32(h,0);c.exit2=a.offset+a.vertexCount++;f=d.i1616to32(c.distance,v);l=d.i8888to32(Math.round(31*-c.nextNormal.x),Math.round(31*-c.nextNormal.y),Math.round(0),Math.round(31));p=d.i8888to32(0,0,0,a._bitset);b[27]=d.i1616to32(8*c.currentVertex.x,8*c.currentVertex.y);b[28]=a.id;b[29]=a._fillColor;b[30]=l;b[31]=f;b[32]=a._tl;b[33]=a._br;b[34]=p;b[35]=d.i1616to32(h,0);a.geometryBuf.writeRegion(b)}},
G=function(a){return function(c){m[0]=c.leftExit0;m[1]=c.rightEntry0;m[2]=c.leftExit2;m[3]=c.rightEntry0;m[4]=c.rightEntry2;m[5]=c.leftExit2;a.indexCount+=6;a.indexBuf.writeRegion(m)}},H=function(a){return function(c,b,h,f,l,p,t,g,k){k=d.i1616to32(k,Math.ceil(1024*a._halfWidth));l=d.i8888to32(Math.round(31*l),Math.round(31*p),Math.round(31*t),Math.round(31*g));h=d.i8888to32(31*h,31*f,0,a._bitset);e[0]=d.i1616to32(8*c,8*b);e[1]=a.id;e[2]=a._fillColor;e[3]=l;e[4]=k;e[5]=a._tl;e[6]=a._br;e[7]=h;e[8]=
d.i1616to32(Math.ceil(1024*a._halfReferenceWidth),0);a.geometryBuf.writeRegion(e);return a.offset+a.vertexCount++}},I=function(a){return function(b,d,h){n[0]=b;n[1]=d;n[2]=h;a.indexCount+=3;a.indexBuf.writeRegion(n)}};x.default=function(a){return function(a){function b(){for(var b=[],f=0;f<arguments.length;f++)b[f]=arguments[f];b=a.apply(this,b)||this;b.tessellationProperties={_fillColor:null,_tl:null,_br:null,_halfWidth:null,_bitset:null,_halfReferenceWidth:null,id:null,indexBuf:null,indexCount:null,
geometryBuf:null,vertexCount:null,offset:null};b._tessellationOptions={};b.geometryType=B.WGLGeometryType.LINE;return b}A.__extends(b,a);b.prototype.writeMeshWithGeometry=function(b,a,c,d,t,g){c=a.indexVector;t=a.get("geometry");var f=new D(d,this.geometryType,this._materialKey);a=a.getVector("geometry").vertexCount;f.vertexFrom=a;f.indexFrom=c.length;y.isPolyline(g)?(g=this._clipLines(g.paths),0!==g.length&&(this._write(f,c,t,a,d,g),b.push(f))):y.isPolygon(g)&&(g=this._clipLines(g.rings),0!==g.length&&
(this._write(f,c,t,a,d,g),b.push(f)))};b.prototype._clipLines=function(a){for(var b=[],c=!1,d=0;d<a.length;){var h=[],g=a[d];r.reset(2);var k=g[0],e=k[0],k=k[1];if(c)r.moveTo(e,k);else{if(-16>e||e>u||-16>k||k>u){c=!0;continue}h.push({x:e,y:k})}for(var m=!1,q=g.length,n=1;n<q;++n)if(e+=g[n][0],k+=g[n][1],c)r.lineTo(e,k);else{if(-16>e||e>u||-16>k||k>u){m=!0;break}h.push({x:e,y:k})}if(m)c=!0;else{if(c){if(h=r.resultWithStarts())for(c=0;c<h.length;c++)b.push(h[c])}else b.push({line:h,start:0});d++;c=
!1}}return b};b.prototype._write=function(a,b,c,d,e,g){this.tessellationProperties.id=e;this.tessellationProperties.indexBuf=b;this.tessellationProperties.indexCount=0;this.tessellationProperties.geometryBuf=c;this.tessellationProperties.vertexCount=0;this.tessellationProperties.offset=d;for(b=0;b<g.length;b++)c=g[b],d=c.line,2>d.length||(this._tessellationOptions.initialDistance=c.start%65535,this._tessellationCallbacks instanceof q.StandardTessellationCallbacks&&(this._tessellationCallbacks.capType=
this._capType,this._tessellationCallbacks.joinType=this._joinType),q.tessellate(d,this._tessellationOptions,this._tessellationCallbacks),q.cleanup());a.vertexCount=this.tessellationProperties.vertexCount;a.indexCount=this.tessellationProperties.indexCount;a.zOrder=this._zOrder};b.prototype._initializeTessellator=function(a){var b=E.LineMaterialKey.load(this._materialKey);this._tessellationOptions.trackDistance=this._isDashed||this._hasPattern;this._tessellationOptions.thin=!a&&this.tessellationProperties._halfWidth<
w.THIN_LINE_THRESHOLD/2&&!(b.vvSizeFieldStops||b.vvSizeMinMaxValue||b.vvSizeScaleStops||b.vvSizeUnitValue);this._tessellationOptions.wrapDistance=65535;this._tessellationOptions.outerBisectorAutoSplitThreshold=z;this._tessellationOptions.enableOuterBisectorSplit=this._isDashed||this._hasPattern;this._tessellationOptions.innerBisectorAutoSplitThreshold=z;this._tessellationOptions.enableInnerBisectorSplit=this._isDashed||this._hasPattern;this._tessellationOptions.thin?this._tessellationCallbacks={vertex:F(this.tessellationProperties),
bridge:G(this.tessellationProperties)}:(a=new q.StandardTessellationCallbacks(H(this.tessellationProperties),I(this.tessellationProperties)),a.miterLimitCosine=this._miterLimitCosine,a.textured=this._isDashed||this._hasPattern,a.joinOnUTurn=this._joinOnUTurn,this._tessellationCallbacks=a)};return b}(a)}});