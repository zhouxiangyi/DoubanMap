// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/vectorTiles/TileHandler":function(){define("require exports tslib ../../../../request ../../../../core/has ../../../../core/ItemCache ../../../../core/maybe ../../../../core/MemCache ../../../../core/promiseUtils ../../../../core/workers ../../../../geometry/support/aaBoundingRect ../vectorTiles/VectorTile ./GeometryUtils ./GlyphMosaic ./GlyphSource ./SpriteMosaic ./TileIndex ../../tiling/TileKey".split(" "),function(r,m,e,g,k,d,a,c,b,f,h,z,y,D,x,t,q,p){Object.defineProperty(m,
"__esModule",{value:!0});var u=new d(10),w=new Map;r=function(){function l(a,b,h,f,c,l){this._vectorTileLayer=a;this.devicePixelRatio=b;this.allowUpdates=h;this._container=f;this._memCache=c;this._enableCachingWorkerTiles=l;this._connection=this._glyphMosaic=this._spriteMosaic=null;this._updateToAbortController=new Map;this._ongoingTileRequests=new Map;this._ongoingRequestToController=new Map}l.prototype.destroy=function(){this._updateToAbortController&&this._updateToAbortController.forEach(function(a){return a.abort()});
this._ongoingTileRequests&&this.abortAll();this._connection&&(this._connection.close(),this._connection=null);this._vectorTileLayer=null;this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null);this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null)};Object.defineProperty(l.prototype,"spriteMosaic",{get:function(){var a=this;return this._spriteSourcePromise.then(function(){return a._spriteMosaic})},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,
"glyphMosaic",{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0});l.prototype.start=function(a){return e.__awaiter(this,void 0,void 0,function(){var h,n,c,l,d,p=this;return e.__generator(this,function(v){h=this._vectorTileLayer.sourceNameToSource;n=[];for(c in h)n.push(this._fetchTileMap(h[c],a));this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,a);this._spriteSourcePromise.then(function(a){p._spriteMosaic=new t(1024,1024,250);p._spriteMosaic.setSpriteSource(a)});
l=this._vectorTileLayer.styleRepository;d=new x(l.glyphs);this._glyphMosaic=new D(1024,1024,d);this._broadcastPromise=f.open("WorkerTileHandler",{client:this,scheduler:a.scheduler,signal:a.signal}).then(function(h){p._connection=h;return b.all(p._connection.broadcast("setLayers",{style:l.styleJSON,enableCachingTiles:p._enableCachingWorkerTiles},e.__assign({},a)))});return[2,b.all(n)]})})};l.prototype.updateStyle=function(){return e.__awaiter(this,void 0,void 0,function(){var a,h=this;return e.__generator(this,
function(n){switch(n.label){case 0:return[4,this._broadcastPromise];case 1:return n.sent(),this._updateToAbortController.forEach(function(a){return a.abort()}),this._updateToAbortController.clear(),a=this._vectorTileLayer.styleRepository,this._broadcastPromise=b.create(function(n,f){b.all(h._connection.broadcast("updateStyle",a.styleJSON)).then(n,f)}),[2,this._broadcastPromise]}})})};l.prototype.abortTileUpdate=function(a){this._updateToAbortController.has(a)&&(this._updateToAbortController.get(a).abort(),
this._updateToAbortController.delete(a))};l.prototype.updateTile=function(a,h){return e.__awaiter(this,void 0,void 0,function(){var f,n,c,v,l=this;return e.__generator(this,function(d){switch(d.label){case 0:return this.allowUpdates&&a.isReady?[4,this._broadcastPromise]:[2];case 1:d.sent();f=Math.round(y.degToByte(h.state.rotation));if(a.rotation===f)return[2,null];c=a.key;this._updateToAbortController.has(c.id)&&(n=this._updateToAbortController.get(c.id),n.abort(),this._updateToAbortController.delete(c.id));
n=b.createAbortController();a.rotation=f;v=a.client.invoke("updateSymbols",{key:a.id,rotation:f},{signal:n.signal}).then(function(h){l._updateToAbortController.delete(c.id);a.isReady&&a.updateSymbolData(h)}).catch(function(a){b.isAbortError(a)||l._updateToAbortController.delete(c.id)});this._updateToAbortController.set(a.id,n);return[2,v]}})})};l.prototype.updateTileData=function(a){for(var h=a.tileId,b=this._container.children,f,n=0;n<b.length;n++)if(f=b[n],f.id===h){f.updateTileData(a.tileData);
break}};l.prototype.getVectorTile=function(f,v,l,d){return e.__awaiter(this,void 0,void 0,function(){var n,k,u,y,q,t,B;return e.__generator(this,function(e){switch(e.label){case 0:return n=new p(f,v,l,0),a.isSome(this._memCache)&&(k=this._memCache.get(n.id),a.isSome(k))?(k.reference(),[2,k]):[4,this._getVectorTileData(n)];case 1:u=e.sent();b.throwIfAborted(d);if(a.isSome(this._memCache)&&(y=this._memCache.get(n.id),a.isSome(y)))return y.reference(),[2,y];if(!this._vectorTileLayer)return[2,null];q=
this._vectorTileLayer.tileInfo;t=q.getTileBounds(h.create(),n);B=new z.VectorTile(n,this._vectorTileLayer.styleRepository,t,[512,512],0,!1);u&&u.tileData?(B.setData(u.tileData,u.client),a.isSome(this._memCache)&&(B.reference(),this._memCache.put(B.key.id,B,B.getMemoryUsage()*B.referenced,c.MIN_PRIORITY))):B.setData(null,null);return[2,B]}})})};l.prototype.releaseVectorTile=function(h){a.isNone(this._memCache)||h.release()||this._memCache.updateSize(h.key.id,h,h.getMemoryUsage()*h.referenced)};l.prototype.fetchTileData=
function(a,h){return e.__awaiter(this,void 0,void 0,function(){var b,f,n,c;return e.__generator(this,function(l){switch(l.label){case 0:return[4,this._getRefKeys(a,h)];case 1:b=l.sent();f=this._vectorTileLayer.sourceNameToSource;n=[];for(c in f)n.push(c);return[2,this._getSourcesData(n,b,h)]}})})};l.prototype.parseTileData=function(a,h,b){return e.__awaiter(this,void 0,void 0,function(){var f,n,c,l,v,d,p,u,z=this;return e.__generator(this,function(q){switch(q.label){case 0:f=a&&a.data;if(!f)return[2,
null];n=f.sourceName2DataAndRefKey;c=f.transferList;return 0===Object.keys(n).length?[2,null]:[4,this._broadcastPromise];case 1:return q.sent(),l=Math.round(y.degToByte(h)),[4,this._connection.getAvailableClient()];case 2:return v=q.sent(),[4,v.invoke("createTileAndParse",{key:a.key.id,rotation:l,cacheTile:this.allowUpdates,sourceName2DataAndRefKey:n},e.__assign(e.__assign({},b),{transferList:c})).catch(function(){z._enableCachingWorkerTiles&&v.invoke("destructTileData",a.key.id).catch(function(){});
return null})];case 3:d=q.sent();if(k("esri-vector-tiles-debug")){p={};for(u in n)p[u]=n[u].refKey;return[2,{tileData:d,client:v,refKeys:p}]}return[2,{tileData:d,client:v}]}})})};Object.defineProperty(l.prototype,"updating",{get:function(){return 0<this._ongoingTileRequests.size},enumerable:!0,configurable:!0});l.prototype.abortAll=function(){this._ongoingRequestToController.forEach(function(a){return a.abort()});this._ongoingRequestToController.clear();this._ongoingTileRequests.clear()};l.prototype.getSprites=
function(a){return e.__awaiter(this,void 0,void 0,function(){return e.__generator(this,function(h){switch(h.label){case 0:return[4,this._spriteSourcePromise];case 1:return h.sent(),[2,this._spriteMosaic.getSpriteItems(a)]}})})};l.prototype.getGlyphs=function(a){return this._glyphMosaic.getGlyphItems(a.font,a.codePoints)};l.prototype.getStyleRepository=function(){return this._vectorTileLayer.styleRepository};l.prototype._getTilePayload=function(a,h,b){return e.__awaiter(this,void 0,void 0,function(){var f,
n,c,l,v;return e.__generator(this,function(d){switch(d.label){case 0:return f=p.pool.acquire(a.id),n=this._vectorTileLayer.sourceNameToSource,c=n[h],l=c.getSourceTileUrl(f.level,f.row,f.col),p.pool.release(f),[4,g(l,e.__assign({responseType:"array-buffer"},b))];case 1:return v=d.sent(),[2,{protobuff:v.data,sourceName:h}]}})})};l.prototype._fetchTileMap=function(a,h){if(a.capabilities.operations.supportsTileMap&&a.tileIndex||!a.tileMapURL)return b.resolve();var f=u.get(a.tileMapURL);if(f)return a.tileIndex=
f,b.resolve();if(w.has(a.tileMapURL))return w.get(a.tileMapURL).then(function(h){a.tileIndex=new q(h.data)});h=g(a.tileMapURL,h);h.then(function(h){a.tileIndex=new q(h.data);w["delete"](a.tileMapURL);u.put(a.tileMapURL,a.tileIndex)});w.set(a.tileMapURL,h);return h};l.prototype._getRefKeys=function(a,h){return e.__awaiter(this,void 0,void 0,function(){var f,c,n,l,d;return e.__generator(this,function(v){f=this._vectorTileLayer.sourceNameToSource;c=[];for(n in f)l=f[n],d=l.getRefKey(a,h),c.push(d);return[2,
b.eachAlways(c)]})})};l.prototype._getSourcesData=function(a,h,f){return e.__awaiter(this,void 0,void 0,function(){var c,n,l,d,p,v,k;return e.__generator(this,function(e){switch(e.label){case 0:c=[];for(n=0;n<h.length;n++)null==h[n].value||null==a[n]?c.push(null):(l=this._getTilePayload(h[n].value,a[n],f),c.push(l));return[4,b.eachAlways(c)];case 1:d=e.sent();p={};v=[];for(n=0;n<d.length;n++)d[n].value&&d[n].value&&d[n].value.protobuff&&0<d[n].value.protobuff.byteLength&&(k=h[n].value.id,p[d[n].value.sourceName]=
{refKey:k,protobuff:d[n].value.protobuff},v.push(d[n].value.protobuff));return[2,{sourceName2DataAndRefKey:p,transferList:v}]}})})};l.prototype._getVectorTileData=function(a){return e.__awaiter(this,void 0,void 0,function(){var h,b,f,n,c=this;return e.__generator(this,function(l){h=a.id;if(this._ongoingTileRequests.has(h))return[2,this._ongoingTileRequests.get(h)];b=new AbortController;f={signal:b.signal};n=this._getParsedVectorTileData(a,f).then(function(a){c._ongoingTileRequests.delete(h);c._ongoingRequestToController.delete(h);
return a}).catch(function(){c._ongoingTileRequests.delete(h);c._ongoingRequestToController.delete(h);return null});this._ongoingTileRequests.set(h,n);this._ongoingRequestToController.set(h,b);return[2,n]})})};l.prototype._getParsedVectorTileData=function(a,h){return e.__awaiter(this,void 0,void 0,function(){var b;return e.__generator(this,function(f){switch(f.label){case 0:return[4,this.fetchTileData(a,h)];case 1:return b=f.sent(),[2,this.parseTileData({key:a,data:b},0,h)]}})})};return l}();m.TileHandler=
r})},"esri/core/ItemCache":function(){define(["require","exports","./MemCache"],function(r,m,e){return function(){function g(k,d){this._storage=new e.MemCacheStorage;this._storage.maxSize=k;d&&this._storage.registerRemoveFunc("",d)}g.prototype.put=function(e,d){this._storage.put(e,d,1,1)};g.prototype.pop=function(e){return this._storage.pop(e)};g.prototype.get=function(e){return this._storage.get(e)};g.prototype.clear=function(){this._storage.clearAll()};g.prototype.destroy=function(){this._storage.clearAll()};
return g}()})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("require exports tslib ../../../webgl ./RenderBucket ../webgl/TiledDisplayObject".split(" "),function(r,m,e,g,k,d){Object.defineProperty(m,"__esModule",{value:!0});r=function(b){function f(h,f,c,d,e,k){c=b.call(this,h,c,d,[4096,4096])||this;c._referenced=0;c._symbolFadeHold=null;c._vectorTileData=null;c._symbolUpdateData=null;c._memoryUsed=a;c.rotation=0;c.layerData={};c.status="loading";c._referenced=1;c.styleLayers=f;
c.id=h.id;c.rotation=e;c._cacheWorkerTiles=k;return c}e.__extends(f,b);Object.defineProperty(f.prototype,"hasSymbolBuckets",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"isHoldingForFade",{get:function(){return null!==this._symbolFadeHold},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"isSymbolFadeDone",{get:function(){return!this._symbolFadeHold||this._symbolFadeHold<performance.now()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"wasRequested",{get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status},enumerable:!0,configurable:!0});f.prototype.setData=function(h,b,f){this._vectorTileData=h;this.client=b;this.refKeys=f;this._memoryUsed=a;this.ready()};f.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())};f.prototype.updateTileData=function(h){this._vectorTileData=h;this.stage.requestRender();this._memoryUsed=a};f.prototype.clearSymbolFadeHold=function(){this._symbolFadeHold=
null};f.prototype.setSymbolHoldDuration=function(a){this._symbolFadeHold=performance.now()+a};f.prototype.hasData=function(){return 0<Object.keys(this.layerData).length};f.prototype.dispose=function(){this._cacheWorkerTiles&&this.client&&this.client.invoke("destructTileData",this.id).catch(function(){});this._deleteBufferMemory();this.destroy();this._memoryUsed=a};f.prototype.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};f.prototype.reference=function(){++this._referenced};
Object.defineProperty(f.prototype,"referenced",{get:function(){return this._referenced},enumerable:!0,configurable:!0});f.prototype.getMemoryUsage=function(){var h=this;this._memoryUsed===a&&(this._memoryUsed=c.reduce(function(a,b){return h[b]?a+h[b].size:a},0),this.texture&&(this._memoryUsed+=this.texture.descriptor.width*this.texture.descriptor.height*4),this._vectorTileData&&this._vectorTileData.bufferData&&(this._memoryUsed+=this._vectorTileData.bufferData.reduce(function(a,h){return a+h.byteLength},
this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength)));return this._memoryUsed/(this._referenced||1)};f.prototype.commitChanges=function(){if(this._vectorTileData||this._symbolUpdateData)this._vectorTileData?(this._deleteBufferMemory(),this._createRenderBuckets(),this._createBufferObjects(),this._vectorTileData=null):this._symbolUpdateData&&(this._updateSymbolData(this._symbolUpdateData),this._symbolUpdateData=null)};f.prototype._deleteBufferMemory=function(){for(var a=
0,b="fillVertexArrayObject fillDDVertexArrayObject outlineVertexArrayObject lineVertexArrayObject lineDDVertexArrayObject iconVertexArrayObject iconDDVertexArrayObject textVertexArrayObject textDDVertexArrayObject circleVertexArrayObject fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer texture".split(" ");a<
b.length;a++){var f=b[a];this[f]&&(this[f].dispose(),this[f]=null)}this.layerData={};this.triangleCount=0};f.prototype._createRenderBuckets=function(){for(var a=new Uint32Array(this._vectorTileData.bucketDataInfo),b=a.length,f=0;f<b;){var c=a[f];switch(a[f+1]){case 0:(new k.BackgroundRenderBucket).layerID=c;f+=2;break;case 1:var d=new k.FillRenderBucket;d.layerID=c;d.triangleElementStart=a[f+2];d.triangleElementCount=a[f+3];d.outlineElementStart=a[f+4];d.outlineElementCount=a[f+5];if(0!==d.triangleElementCount||
0!==d.outlineElementCount)this.layerData[c]=d;f+=6;break;case 2:d=new k.LineRenderBucket;d.layerID=c;d.triangleElementStart=a[f+2];d.triangleElementCount=a[f+3];0<d.triangleElementCount&&(this.layerData[c]=d);f+=4;break;case 3:d=new k.SymbolRenderBucket;d.layerID=c;d.isSDF=0!==a[f+2];var e=f+3,q=a[e];e++;for(var p=0;p<q;p++){var u=a[e],g=a[e+1],l=a[e+2];d.iconPerPageElementsMap.set(u,[g,l]);e+=3}var n=a[e];e++;for(p=0;p<n;p++)u=a[e],g=a[e+1],l=a[e+2],d.glyphPerPageElementsMap.set(u,[g,l]),e+=3;if(0<
d.iconPerPageElementsMap.size||0<d.glyphPerPageElementsMap.size)this.layerData[c]=d;f+=5+3*q+3*n;break;case 4:d=new k.CircleRenderBucket;d.layerID=c;d.triangleElementStart=a[f+2];d.triangleElementCount=a[f+3];0<d.triangleElementCount&&(this.layerData[c]=d);f+=4;break;default:console.error("Bad bucket type!"),f+=2}}};f.prototype.attachWithContext=function(a){this.stage={context:a,trashDisplayObject:function(a){a.processDetach()},untrashDisplayObject:function(){return!1}}};f.prototype._updateSymbolData=
function(a){if(!a||!a.bucketDataInfo)return!0;var f=new Uint32Array(a.bucketDataInfo),b=f.length;if(0===b)return!0;if(!this.isReady)return this.requestRender(),!1;for(var h=this.stage.context,c=new Uint32Array(a.bufferDataInfo),d=c.length,e=0,p=0;p<d;p+=2,e++)switch(c[p]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=g.BufferObject.createVertex(h,35044,a.bufferData[e]);break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),
this.iconDDVertexBuffer=null);this.iconDDVertexBuffer=g.BufferObject.createVertex(h,35044,a.bufferData[e]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);this.iconIndexBuffer=g.BufferObject.createIndex(h,35044,a.bufferData[e]);break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=g.BufferObject.createVertex(h,35044,a.bufferData[e]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),
this.textDDVertexBuffer=null);this.textDDVertexBuffer=g.BufferObject.createVertex(h,35044,a.bufferData[e]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=g.BufferObject.createIndex(h,35044,a.bufferData[e])}a={};for(var u in this.layerData)3!==this.layerData[u].type&&(a[u]=this.layerData[u]);this.layerData=a;h=this.styleLayers.layers;for(c=0;c<b;){u=f[c];d=new k.SymbolRenderBucket;d.layerID=u;d.isSDF=0!==f[c+2];h.length>d.layerID&&
h[d.layerID].type===d.type&&(a[d.layerID]=d);var w=c+3;u=f[w];w++;for(e=0;e<u;e++){var p=f[w],l=f[w+1],n=f[w+2];d.iconPerPageElementsMap.set(p,[l,n]);w+=3}var v=f[w];w++;for(e=0;e<v;e++)p=f[w],l=f[w+1],n=f[w+2],d.glyphPerPageElementsMap.set(p,[l,n]),w+=3;c+=5+3*u+3*v}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),
this.textVertexArrayObject=null);this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);return!0};f._createBufferToObject=function(){var a=[];a[1]={create:g.BufferObject.createVertex,var:"fillVertexBuffer"};a[2]={create:g.BufferObject.createVertex,var:"fillDDVertexBuffer"};a[3]={create:g.BufferObject.createIndex,var:"fillIndexBuffer"};a[4]={create:g.BufferObject.createVertex,var:"outlineVertexBuffer"};a[5]={create:g.BufferObject.createVertex,var:"outlineDDVertexBuffer"};
a[6]={create:g.BufferObject.createIndex,var:"outlineIndexBuffer"};a[7]={create:g.BufferObject.createVertex,var:"lineVertexBuffer"};a[8]={create:g.BufferObject.createVertex,var:"lineDDVertexBuffer"};a[9]={create:g.BufferObject.createIndex,var:"lineIndexBuffer"};a[10]={create:g.BufferObject.createVertex,var:"iconVertexBuffer"};a[11]={create:g.BufferObject.createVertex,var:"iconDDVertexBuffer"};a[12]={create:g.BufferObject.createIndex,var:"iconIndexBuffer"};a[13]={create:g.BufferObject.createVertex,
var:"textVertexBuffer"};a[14]={create:g.BufferObject.createVertex,var:"textDDVertexBuffer"};a[15]={create:g.BufferObject.createIndex,var:"textIndexBuffer"};a[16]={create:g.BufferObject.createVertex,var:"circleVertexBuffer"};a[17]={create:g.BufferObject.createIndex,var:"circleIndexBuffer"};return a};f.prototype._createBufferObjects=function(){for(var a=this.stage.context,b=new Uint32Array(this._vectorTileData.bufferDataInfo),c=b.length,d=0;d<c;d+=2){var e=d/2;if(!(0>=b[d+1]||0===this._vectorTileData.bufferData[e].byteLength)){var k=
b[d],g=f.bufferToObject[k];g?this[g.var]?this[g.var].setData(this._vectorTileData.bufferData[e]):this[g.var]=g.create(a,35044,this._vectorTileData.bufferData[e]):console.error("Bad buffer type "+k)}}};f.bufferToObject=f._createBufferToObject();return f}(d.TiledDisplayObject);m.VectorTile=r;var a=-1,c="fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer".split(" ")})},
"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define(["require","exports","tslib"],function(r,m,e){Object.defineProperty(m,"__esModule",{value:!0});r=function(){return function(e){this.type=e}}();m.RenderBucket=r;var g=function(k){function d(){var a=k.call(this,2)||this;a.triangleElementStart=0;a.triangleElementCount=0;return a}e.__extends(d,k);d.prototype.hasData=function(){return 0<this.triangleElementCount};d.prototype.triangleCount=function(){return this.triangleElementCount/3};return d}(r);
m.LineRenderBucket=g;g=function(k){function d(){var a=k.call(this,1)||this;a.triangleElementStart=0;a.triangleElementCount=0;a.outlineElementStart=0;a.outlineElementCount=0;return a}e.__extends(d,k);d.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.outlineElementCount};d.prototype.triangleCount=function(){return(this.triangleElementCount+this.outlineElementCount)/3};return d}(r);m.FillRenderBucket=g;g=function(k){function d(){var a=k.call(this,3)||this;a.iconPerPageElementsMap=
new Map;a.glyphPerPageElementsMap=new Map;a.isSDF=!1;return a}e.__extends(d,k);d.prototype.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};d.prototype.triangleCount=function(){var a=0;this.iconPerPageElementsMap.forEach(function(c){a+=c[1]});this.glyphPerPageElementsMap.forEach(function(c){a+=c[1]});return a/3};return d}(r);m.SymbolRenderBucket=g;g=function(k){function d(){var a=k.call(this,4)||this;a.triangleElementStart=0;a.triangleElementCount=
0;return a}e.__extends(d,k);d.prototype.hasData=function(){return 0<this.triangleElementCount};d.prototype.triangleCount=function(){return this.triangleElementCount/3};return d}(r);m.CircleRenderBucket=g;r=function(k){function d(){return k.call(this,0)||this}e.__extends(d,k);d.prototype.hasData=function(){return!0};d.prototype.triangleCount=function(){return 2};return d}(r);m.BackgroundRenderBucket=r})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["require","exports"],function(r,
m){function e(e,d){e%=d;return 0<=e?e:e+d}Object.defineProperty(m,"__esModule",{value:!0});m.C_INFINITY=Number.POSITIVE_INFINITY;m.C_PI=Math.PI;m.C_2PI=2*m.C_PI;m.C_PI_BY_2=m.C_PI/2;m.C_RAD_TO_256=128/m.C_PI;m.C_256_TO_RAD=m.C_PI/128;m.C_DEG_TO_256=256/360;m.C_DEG_TO_RAD=m.C_PI/180;m.C_SQRT2=1.414213562;m.C_SQRT2_INV=1/m.C_SQRT2;var g=1/Math.LN2;m.positiveMod=e;m.radToByte=function(k){return e(k*m.C_RAD_TO_256,256)};m.degToByte=function(k){return e(k*m.C_DEG_TO_256,256)};m.log2=function(e){return Math.log(e)*
g};m.sqr=function(e){return e*e};m.interpolate=function(e,d,a){return e*(1-a)+d*a};m.between=function(e,d,a){return e>=d&&e<=a||e>=a&&e<=d}})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define("require exports ../../../../core/has ../../../../core/promiseUtils ../../../webgl ./RectangleBinPack ../webgl/Rect".split(" "),function(r,m,e,g,k,d,a){return function(){function c(a,f,h){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=
[];this._rangePromises=new Map;this.width=a;this.height=f;this._glyphSource=h;this._binPack=new d(a-4,f-4);this._glyphData.push(new Uint8Array(a*f));this._dirties.push(!0);this._textures.push(void 0)}c.prototype.getGlyphItems=function(b,f){for(var h=this,c=[],e=this._glyphSource,k=new Set,m=1/256,t=0;t<f.length;t++)k.add(Math.floor(f[t]*m));var q=[];k.forEach(function(a){if(256>=a){var f=b+a;h._rangePromises.has(f)?q.push(h._rangePromises.get(f)):(a=e.getRange(b,a).then(function(){h._rangePromises["delete"](f)},
function(){h._rangePromises["delete"](f)}),h._rangePromises.set(f,a),q.push(a))}});return g.all(q).then(function(){var p,u=h._glyphIndex[b];u||(u={},h._glyphIndex[b]=u);for(var k=0;k<f.length;k++){p=f[k];var l=u[p];if(l)c[p]={sdf:!0,rect:l.rect,metrics:l.metrics,page:l.page,code:p};else{var n=e.getGlyph(b,p);if(n&&n.metrics){var l=n.metrics,v=void 0;if(0===l.width)v=new a.default(0,0,0,0);else{var g=l.width+6,q=l.height+6,z=g%4?4-g%4:4,t=q%4?4-q%4:4;1===z&&(z=5);1===t&&(t=5);v=h._binPack.allocate(g+
z,q+t);v.isEmpty&&(h._dirties[h._currentPage]||(h._glyphData[h._currentPage]=null),h._currentPage=h._glyphData.length,h._glyphData.push(new Uint8Array(h.width*h.height)),h._dirties.push(!0),h._textures.push(void 0),h._binPack=new d(h.width-4,h.height-4),v=h._binPack.allocate(g+z,q+t));var z=h._glyphData[h._currentPage],n=n.bitmap,y=t=void 0;if(n)for(var m=0;m<q;m++)for(var t=g*m,y=h.width*(v.y+m+1)+v.x,x=0;x<g;x++)z[y+x+1]=n[t+x]}u[p]={rect:v,metrics:l,tileIDs:null,page:h._currentPage};c[p]={sdf:!0,
rect:v,metrics:l,page:h._currentPage,code:p};h._dirties[h._currentPage]=!0}}}return c})};c.prototype.removeGlyphs=function(a){for(var f in this._glyphIndex){var b=this._glyphIndex[f];if(b){var c=void 0,d;for(d in b)if(c=b[d],c.tileIDs["delete"](a),0===c.tileIDs.size){for(var e=this._glyphData[c.page],k=c.rect,g=void 0,q=void 0,p=0;p<k.height;p++)for(g=this.width*(k.y+p)+k.x,q=0;q<k.width;q++)e[g+q]=0;delete b[d];this._dirties[c.page]=!0}}}};c.prototype.bind=function(a,f,c,d){void 0===d&&(d=0);this._textures[c]||
(this._textures[c]=new k.Texture(a,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var b=this._textures[c];b.setSamplingMode(f);this._dirties[c]&&b.setData(this._glyphData[c]);a.bindTexture(b,d);this._dirties[c]=!1};c.prototype.dispose=function(){this._binPack=null;for(var a=0,f=this._textures;a<f.length;a++){var c=f[a];c&&c.dispose()}this._textures.length=0};return c}()})},"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["require",
"exports","../webgl/Rect"],function(r,m,e){return function(){function g(k,d){this._height=this._width=0;this._free=[];this._width=k;this._height=d;this._free.push(new e.default(0,0,k,d))}Object.defineProperty(g.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0});g.prototype.allocate=function(k,d){if(k>this._width||d>this._height)return new e.default;for(var a=
null,c=-1,b=0;b<this._free.length;++b){var f=this._free[b];k<=f.width&&d<=f.height&&(null===a||f.y<=a.y&&f.x<=a.x)&&(a=f,c=b)}if(null===a)return new e.default;this._free.splice(c,1);a.width<a.height?(a.width>k&&this._free.push(new e.default(a.x+k,a.y,a.width-k,d)),a.height>d&&this._free.push(new e.default(a.x,a.y+d,a.width,a.height-d))):(a.width>k&&this._free.push(new e.default(a.x+k,a.y,a.width-k,a.height)),a.height>d&&this._free.push(new e.default(a.x,a.y+d,k,a.height-d)));return new e.default(a.x,
a.y,k,d)};g.prototype.release=function(e){for(var d=0;d<this._free.length;++d){var a=this._free[d];if(a.y===e.y&&a.height===e.height&&a.x+a.width===e.x)a.width+=e.width;else if(a.x===e.x&&a.width===e.width&&a.y+a.height===e.y)a.height+=e.height;else if(e.y===a.y&&e.height===a.height&&e.x+e.width===a.x)a.x=e.x,a.width+=e.width;else if(e.x===a.x&&e.width===a.width&&e.y+e.height===a.y)a.y=e.y,a.height+=e.height;else continue;this._free.splice(d,1);this.release(e)}this._free.push(e)};return g}()})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define("require exports ../../../../request ../../../../core/has ../../../../core/pbf ../../../../core/promiseUtils".split(" "),
function(r,m,e,g,k,d){var a=function(){function a(a){this._metrics=[];this._bitmaps=[];if(a)for(;a.next();)switch(a.tag()){case 1:for(var f=a.getMessage();f.next();)switch(f.tag()){case 3:for(var b=f.getMessage(),c=void 0,d=void 0,e=void 0,g=void 0,k=void 0,p=void 0,u=void 0;b.next();)switch(b.tag()){case 1:c=b.getUInt32();break;case 2:d=b.getBytes();break;case 3:e=b.getUInt32();break;case 4:g=b.getUInt32();break;case 5:k=b.getSInt32();break;case 6:p=b.getSInt32();break;case 7:u=b.getUInt32();break;
default:b.skip()}b.release();c&&(this._metrics[c]={width:e,height:g,left:k,top:p,advance:u},this._bitmaps[c]=d);break;default:f.skip()}f.release();break;default:a.skip()}}a.prototype.getMetrics=function(a){return this._metrics[a]};a.prototype.getBitmap=function(a){return this._bitmaps[a]};return a}(),c=function(){function a(){this._ranges=[]}a.prototype.getRange=function(a){return this._ranges[a]};a.prototype.addRange=function(a,b){this._ranges[a]=b};return a}();return function(){function b(a){this._glyphInfo=
{};this._baseURL=a}b.prototype.getRange=function(b,c){var f=this._getFontStack(b);if(f.getRange(c))return d.resolve();var h=256*c,g=h+255;b=this._baseURL.replace("{fontstack}",b).replace("{range}",h+"-"+g);return e(b,{responseType:"array-buffer"}).then(function(b){f.addRange(c,new a(new k(new Uint8Array(b.data),new DataView(b.data))))}).catch(function(){f.addRange(c,new a)})};b.prototype.getGlyph=function(a,b){if(a=this._getFontStack(a)){var f=Math.floor(b/256);if(!(256<f)&&(a=a.getRange(f)))return{metrics:a.getMetrics(b),
bitmap:a.getBitmap(b)}}};b.prototype._getFontStack=function(a){var b=this._glyphInfo[a];b||(b=this._glyphInfo[a]=new c);return b};return b}()})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define(["require","exports","../../../webgl","./RectangleBinPack","../webgl/Rect"],function(r,m,e,g,k){return function(){function d(a,c,b){void 0===b&&(b=0);this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;
this._mosaicRects={};this.pixelRatio=1;(0>=a||0>=c)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=a;this._pageHeight=c;0<b&&(this._maxItemSize=b);this._binPack=new g(a-4,c-4)}d.prototype.getWidth=function(a){return a>=this._size.length?-1:this._size[a][0]};d.prototype.getHeight=function(a){return a>=this._size.length?-1:this._size[a][1]};d.prototype.setSpriteSource=function(a){this.dispose();this.pixelRatio=a.devicePixelRatio;if(0===this._mosaicsData.length){this._binPack=
new g(this._pageWidth-4,this._pageHeight-4);var c=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));this._mosaicsData[0]=c;this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}this._sprites=a};d.prototype.getSpriteItem=function(a,c){void 0===c&&(c=!1);var b=this._mosaicRects[a];if(b)return b;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;b=this._sprites.getSpriteInfo(a);if(!b||!b.width||!b.height||0>b.width||
0>b.height)return null;var f=b.width,d=b.height,e=this._allocateImage(f,d),g=e[0],k=e[1];if(0>=g.width)return null;this._copy(g,b,k,e[2],c);b={rect:g,width:f,height:d,sdf:b.sdf,simplePattern:!1,pixelRatio:b.pixelRatio,page:k};return this._mosaicRects[a]=b};d.prototype.preloadSpriteItems=function(){for(var a=0,c=this._sprites.spriteNames;a<c.length;a++)this.getSpriteItem(c[a],!0)};d.prototype.getSpriteItems=function(a){for(var c={},b=0;b<a.length;b++){var f=a[b];c[f]=this.getSpriteItem(f)}return c};
d.prototype.getMosaicItemPosition=function(a,c){c=(a=this.getSpriteItem(a,c))&&a.rect;if(!c)return null;c.width=a.width;c.height=a.height;return{size:[a.width,a.height],tl:[(c.x+2)/this._size[a.page][0],(c.y+2)/this._size[a.page][1]],br:[(c.x+2+a.width)/this._size[a.page][0],(c.y+2+a.height)/this._size[a.page][1]],page:a.page}};d.prototype.bind=function(a,c,b,f){void 0===b&&(b=0);void 0===f&&(f=0);this._textures[b]||(this._textures[b]=new e.Texture(a,{pixelFormat:6408,dataType:5121,wrapMode:33071,
width:this._size[b][0],height:this._size[b][1]},new Uint8Array(this._mosaicsData[b].buffer)));var d=this._textures[b];d.setSamplingMode(c);this._dirties[b]&&d.setData(new Uint8Array(this._mosaicsData[b].buffer));a.bindTexture(d,f);this._dirties[b]=!1};d._copyBits=function(a,c,b,f,d,e,g,k,m,t,q){var h=f*c+b;g=k*e+g;if(q)for(g-=e,q=-1;q<=t;q++,h=((q+t)%t+f)*c+b,g+=e)for(k=-1;k<=m;k++)d[g+k]=a[h+(k+m)%m];else for(q=0;q<t;q++){for(k=0;k<m;k++)d[g+k]=a[h+k];h+=c;g+=e}};d.prototype._copy=function(a,c,b,
f,e,g){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(b>=this._mosaicsData.length)){var h=new Uint32Array(g?g.buffer:this._sprites.image.buffer),k=this._mosaicsData[b];k&&h||console.error("Source or target images are uninitialized!");d._copyBits(h,g?c.width:this._sprites.width,c.x,c.y,k,f[0],a.x+2,a.y+2,c.width,c.height,e);this._dirties[b]=!0}};d.prototype._allocateImage=function(a,c){a+=2;c+=2;var b=Math.max(a,c);if(this._maxItemSize&&this._maxItemSize<b)return b=new k.default(0,0,a,c),
this._mosaicsData.push(new Uint32Array(a*c)),this._dirties.push(!0),this._size.push([a,c]),this._textures.push(void 0),[b,this._mosaicsData.length-1,[a,c]];var b=a%4?4-a%4:4,f=c%4?4-c%4:4;1===b&&(b=5);1===f&&(f=5);b=this._binPack.allocate(a+b,c+f);return 0>=b.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,
this._pageHeight]),this._textures.push(void 0),this._binPack=new g(this._pageWidth-4,this._pageHeight-4),this._allocateImage(a,c)):[b,this._currentPage,[this._pageWidth,this._pageHeight]]};d.prototype.dispose=function(){this._binPack=null;this._mosaicRects={};for(var a=0,c=this._textures;a<c.length;a++){var b=c[a];b&&b.dispose()}this._textures.length=0};return d}()})},"esri/views/2d/engine/vectorTiles/TileIndex":function(){define(["require","exports","../../../../core/promiseUtils","../../../../layers/support/TilemapCache",
"../../tiling/TileKey"],function(r,m,e,g,k){return function(){function d(a){if(a instanceof g.TilemapCache)this._tilemapCache=a;else if(a&&"index"in a)this._tilemap=a.index;else throw Error("Invalid tilemap!");}d.prototype.dataKey=function(a,c){if(this._tilemapCache){var b=a.level,f=a.row,d=a.col,g=new k(a);return this._tilemapCache.fetchAvailabilityUpsample(b,f,d,g,c).then(function(){return g}).catch(function(a){if(e.isAbortError(a))throw a;return null})}return this._getIndexedDataKey(a)};d.prototype.forEach=
function(a,c,b,f,d){this._callback=d;this._maxLevel=c+a;this._forEach(this._tilemap,c,b,f)};d.prototype._forEach=function(a,c,b,f){0!==a&&(this._callback(c,b,f),c!==this._maxLevel&&"object"===typeof a&&(this._forEach(a[0],c+1,2*b,2*f),this._forEach(a[1],c+1,2*b,2*f+1),this._forEach(a[2],c+1,2*b+1,2*f),this._forEach(a[3],c+1,2*b+1,2*f+1)))};d.prototype._getIndexedDataKey=function(a){var c=[a];if(0>a.level||0>a.row||0>a.col||0<a.row>>a.level||0<a.col>>a.level)return e.resolve(null);for(;0!==a.level;)a=
new k(a.level-1,a.row>>1,a.col>>1,a.world),c.push(a);a=this._tilemap;var b=c.pop(),f,d;if(1===a)return e.resolve(b);for(;c.length;)if(f=c.pop(),d=(f.col&1)+((f.row&1)<<1),a){if(0===a[d]){b=null;break}if(1===a[d]){b=f;break}b=f;a=a[d]}return e.resolve(b)};return d}()})},"esri/layers/support/TilemapCache":function(){define("require exports tslib ../../request ../../core/Accessor ../../core/Error ../../core/Handles ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/urlUtils ../../core/watchUtils ../../core/accessorSupport/decorators ./Tilemap".split(" "),
function(r,m,e,g,k,d,a,c,b,f,h,z,y,D,x,t){Object.defineProperty(m,"__esModule",{value:!0});var q=c.getLogger("esri.layers.support.TilemapCache");r=function(c){function p(b){b=c.call(this,b)||this;b._handles=new a;b._pendingTilemapRequests={};b._availableLevels={};b.levels=5;b.cacheByteSize=2097152;b.request=g;b._prefetchingEnabled=!0;return b}e.__extends(p,c);k=p;p.prototype.initialize=function(){var a=this;this._tilemapCache=new b(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl",
"layer.tileServers?"],function(){return a._initializeTilemapDefinition()}),D.init(this,"layer.tileInfo.lods",function(b){return a._initializeAvailableLevels(b)},!0)]);this._initializeTilemapDefinition()};p.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};p.prototype.castLevels=function(a){return 2>=a?(q.error("Minimum levels for Tilemap is 3, but got ",a),3):a};Object.defineProperty(p.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0});
p.prototype.fetchTilemap=function(a,b,f,c){var n=this;if(!this._availableLevels[a])return h.reject(new d("tilemap-cache:level-unavailable","Level "+a+" is unavailable in the service"));var p=this._tmpTilemapDefinition;if(a=this._tilemapFromCache(a,b,f,p))return h.resolve(a);var l=c&&c.signal;c=e.__assign(e.__assign({},c),{signal:null});return h.create(function(a,b){h.onAbort(l,function(){return b(h.createAbortError())});var f=t.tilemapDefinitionId(p),d=n._pendingTilemapRequests[f];if(!d){var d=t.Tilemap.fromDefinition(p,
c).then(function(a){n._tilemapCache.put(f,a,a.byteSize);return a}),e=function(){return delete n._pendingTilemapRequests[f]};n._pendingTilemapRequests[f]=d;d.then(e,e)}d.then(a,b)})};p.prototype.getAvailability=function(a,b,f){return this._availableLevels[a]?(a=this._tilemapFromCache(a,b,f,this._tmpTilemapDefinition))?a.getAvailability(b,f):"unknown":"unavailable"};p.prototype.getAvailabilityUpsample=function(a,b,f,c){c.level=a;c.row=b;c.col=f;a=this.layer.tileInfo;for(a.updateTileInfo(c);;)if(b=this.getAvailability(c.level,
c.row,c.col),"unavailable"===b){if(!a.upsampleTile(c))return"unavailable"}else return b};p.prototype.fetchAvailability=function(a,b,c,f){return this._availableLevels[a]?this.fetchTilemap(a,b,c,f).catch(function(a){return a}).then(function(f){if(f instanceof t.Tilemap)return f=f.getAvailability(b,c),"unavailable"===f?h.reject(new d("tile-map:tile-unavailable","Tile is not available",{level:a,row:b,col:c})):f;if(h.isAbortError(f))throw f;return"unknown"}):h.reject(new d("tilemap-cache:level-unavailable",
"Level "+a+" is unavailable in the service"))};p.prototype.fetchAvailabilityUpsample=function(a,b,f,c,d){var e=this;c.level=a;c.row=b;c.col=f;var n=this.layer.tileInfo;n.updateTileInfo(c);var p=this.fetchAvailability(a,b,f,d).catch(function(a){if(h.isAbortError(a))throw a;if(n.upsampleTile(c))return e.fetchAvailabilityUpsample(c.level,c.row,c.col,c);throw a;});this._fetchAvailabilityUpsamplePrefetch(c.id,a,b,f,d,p);return p};p.prototype._fetchAvailabilityUpsamplePrefetch=function(a,b,c,f,d,p){return e.__awaiter(this,
void 0,void 0,function(){var n,g,l,v,u,q,m,t,w,B;return e.__generator(this,function(r){switch(r.label){case 0:if(!this._prefetchingEnabled)return[2];n="prefetch-"+a;if(this._handles.has(n))return[2];g=h.createAbortController();p.then(function(){return g.abort()},function(){return g.abort()});l=!1;v={remove:function(){l||(l=!0,g.abort())}};this._handles.add(v,n);r.label=1;case 1:return r.trys.push([1,3,,4]),[4,z.waitTicks(10,g.signal)];case 2:return r.sent(),[3,4];case 3:return r.sent(),[3,4];case 4:l||
(l=!0,this._handles.remove(n));if(h.isAborted(g))return[2];u={id:a,level:b,row:c,col:f};q=e.__assign(e.__assign({},d),{signal:g.signal});m=this.layer.tileInfo;t=function(a){var b=w.fetchAvailability(u.level,u.row,u.col,q);k._prefetches.push(b);a=function(){k._prefetches.removeUnordered(b)};b.then(a,a)};w=this;for(B=0;k._prefetches.length<k._maxPrefetch&&m.upsampleTile(u);++B)t(B);return[2]}})})};p.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var a=this.layer.parsedUrl,
b=a.query;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:a.path,query:b?y.objectToQuery(b):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};p.prototype._tilemapFromCache=function(a,b,c,f){f.level=a;f.row=b-b%this.size;f.col=c-c%this.size;a=t.tilemapDefinitionId(f);return this._tilemapCache.get(a)};p.prototype._initializeAvailableLevels=function(a){var b=this;this._availableLevels={};a&&a.forEach(function(a){return b._availableLevels[a.level]=
!0})};Object.defineProperty(p.prototype,"test",{get:function(){var a=this;return{get prefetchingEnabled(){return a._prefetchingEnabled},set prefetchingEnabled(b){a._prefetchingEnabled=b},hasTilemap:function(b,f,c){return!!a._tilemapFromCache(b,f,c,a._tmpTilemapDefinition)}}},enumerable:!0,configurable:!0});var k;p._maxPrefetch=4;p._prefetches=new f({initialSize:k._maxPrefetch});e.__decorate([x.property({constructOnly:!0,type:Number})],p.prototype,"levels",void 0);e.__decorate([x.cast("levels")],p.prototype,
"castLevels",null);e.__decorate([x.property({readOnly:!0,dependsOn:["levels"],type:Number})],p.prototype,"size",null);e.__decorate([x.property({constructOnly:!0,type:Number})],p.prototype,"cacheByteSize",void 0);e.__decorate([x.property({constructOnly:!0})],p.prototype,"layer",void 0);e.__decorate([x.property({constructOnly:!0})],p.prototype,"request",void 0);return p=k=e.__decorate([x.subclass("esri.layers.support.TilemapCache")],p)}(k);m.TilemapCache=r})},"esri/layers/support/Tilemap":function(){define("require exports tslib ../../request ../../core/arrayUtils ../../core/Error ../../core/lang".split(" "),
function(r,m,e,g,k,d,a){function c(a){var b;"vector-tile"===a.service.type?b=a.service.url+"/tilemap/"+a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height:(b=a.service.tileServers,b=(b&&b.length?b[a.row%b.length]:a.service.url)+"/tilemap/"+a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height);(a=a.service.query)&&(b=b+"?"+a);return b}Object.defineProperty(m,"__esModule",{value:!0});r=function(){function b(){this.location={left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=
40}b.prototype.getAvailability=function(a,b){if("unknown"!==this._allAvailability)return this._allAvailability;a=(a-this.location.top)*this.location.width+(b-this.location.left);b=a>>3;var c=this._tileAvailabilityBitSet;return 0>b||b>c.length?"unknown":c[b]&1<<a%8?"available":"unavailable"};b.prototype._updateFromData=function(a){for(var b=!0,c=!0,f=new Uint8Array(Math.ceil(this.location.width*this.location.height/8)),d=0,e=0;e<a.length;e++){var g=e%8;a[e]?(c=!1,f[d]|=1<<g):b=!1;7===g&&++d}c?this._allAvailability=
"unavailable":b?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=f,this.byteSize+=f.length)};b.fromDefinition=function(a,h){var f=a.service.request||g,m=a.row,r=a.col,x=a.width,t=a.height,q={query:{f:"json"}};h=h?e.__assign(e.__assign({},q),h):q;return f(c(a),h).then(function(a){return a.data}).catch(function(a){if(a&&a.details&&422===a.details.httpStatus)return{location:{top:m,left:r,width:x,height:t},valid:!0,data:k.constant(x*t,0)};throw a;}).then(function(a){if(a.location&&
(a.location.top!==m||a.location.left!==r||a.location.width!==x||a.location.height!==t))throw new d("tilemap:location-mismatch","Tilemap response for different location than requested",{response:a,definition:{top:m,left:r,width:x,height:t}});return b.fromJSON(a)})};b.fromJSON=function(c){b.validateJSON(c);var f=new b;f.location=Object.freeze(a.clone(c.location));f._updateFromData(c.data);return Object.freeze(f)};b.validateJSON=function(a){if(!a||!a.location)throw new d("tilemap:missing-location","Location missing from tilemap response");
if(!1===a.valid)throw new d("tilemap:invalid","Tilemap response was marked as invalid");if(!a.data)throw new d("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(a.data))throw new d("tilemap:data-mismatch","Data must be an array of numbers");if(a.data.length!==a.location.width*a.location.height)throw new d("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");};return b}();m.Tilemap=r;m.tilemapDefinitionId=function(a){return a.level+"/"+
a.row+"/"+a.col+"/"+a.width+"/"+a.height};m.tilemapDefinitionUrl=c;m.default=r})},"esri/views/2d/engine/vectorTiles/TileManager":function(){define(["require","exports","../../../../core/LRUCache","../../tiling/TileCoverage","../../tiling/TileKey"],function(r,m,e,g,k){Object.defineProperty(m,"__esModule",{value:!0});var d=function(a,c){return a+1/(1<<2*c)};r=function(){function a(a,b){this._tiles=new Map;this._tileCache=new e(40,function(a){return a.dispose()});this._viewSize=[0,0];this.fadeDuration=
300;this.acquireTile=a.acquireTile;this.releaseTile=a.releaseTile;this.tileInfoView=a.tileInfoView;a.fadeDuration&&(this.fadeDuration=a.fadeDuration);this._container=b}a.prototype.destroy=function(){this._tiles.clear();this._tiles=null;this._tileCache.clear();this._tileCache=null};a.prototype.update=function(a){var b=this;this._updateCacheSize(a);a=this.tileInfoView.getTileCoverage(a.state,0,"smallest");for(var c=a.spans,d=a.lodInfo,e=d.level,m=new Set,r=new Set,x=0;x<c.length;x++)for(var t=c[x],
q=t.row,p=t.colTo,u=t.colFrom;u<=p;u++){var t=k.getId(e,q,d.normalizeCol(u),d.getWorldForColumn(u)),w=this._getOrAcquireTile(t);m.add(t);w.hasData()?this._container.addChild(w):r.add(new k(t))}r.forEach(function(a){return b._findPlaceholdersForMissingTiles(a,m)});m.forEach(function(a){b._tiles.get(a).clearSymbolFadeHold()});var l=[];this._tiles.forEach(function(a,b){m.has(b)||l.push(b)});for(c=0;c<l.length;c++)t=l[c],w=this._tiles.get(t),w.hasSymbolBuckets&&!w.isHoldingForFade?w.setSymbolHoldDuration(this.fadeDuration):
w.hasSymbolBuckets&&!w.isSymbolFadeDone||this._releaseTile(t);g.pool.release(a)};a.prototype._findPlaceholdersForMissingTiles=function(a,b){var c=this,e=[];this._tiles.forEach(function(f){c._addPlaceholderChild(e,f,a,b)});var g=e.reduce(d,0);1E-6>Math.abs(1-g)||this._addPlaceholderParent(a.id,b)};a.prototype._addPlaceholderChild=function(a,b,f,d){if(!(b.key.level<=f.level)&&b.hasData()){var c=b.key,e=c.level-f.level;f.row===c.row>>e&&f.col===c.col>>e&&f.world===c.world&&(this._container.addChild(b),
d.add(b.id),a.push(b.key.level-f.level))}};a.prototype._addPlaceholderParent=function(a,b){for(;;){var c=a.split("/");a=c[1];var d=c[2],e=c[3],c=parseInt(c[0],10);a=0===c?null:c-1+"/"+(parseInt(a,10)>>1)+"/"+(parseInt(d,10)>>1)+"/"+parseInt(e,10);if(!a||b.has(a))break;if((d=this._getTile(a))&&d.hasData()){this._container.addChild(d);b.add(d.id);break}}};a.prototype._getOrAcquireTile=function(a){var b=this._tiles.get(a);if(b)return b;(b=this._tileCache.pop(a))||(b=this.acquireTile(new k(a)));this._tiles.set(a,
b);return b};a.prototype._getTile=function(a){var b=this._tiles.get(a);if(b)return b;(b=this._tileCache.pop(a))&&this._tiles.set(a,b);return b};a.prototype._releaseTile=function(a){var b=this._tiles.get(a);this.releaseTile(b);this._container.removeChild(b);this._tiles.delete(a);b.hasData()?this._tileCache.put(a,b,1):b.dispose()};a.prototype._updateCacheSize=function(a){a=a.state.size;if(a[0]!==this._viewSize[0]||a[1]!==this._viewSize[1]){var b=Math.ceil(a[0]/512)+1,c=Math.ceil(a[1]/512)+1;this._viewSize[0]=
a[0];this._viewSize[1]=a[1];this._tileCache.maxSize=5*b*c}};return a}();m.TileManager=r})},"esri/views/2d/engine/vectorTiles/VectorTileContainer":function(){define("require exports tslib ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../geometry/support/aaBoundingRect ../../engine ./FadeRecorder ../webgl/definitions ../webgl/enums ../webgl/TiledDisplayObject ../../tiling/TileCoverage ../../tiling/TileKey".split(" "),function(r,m,e,g,k,d,a,c,b,f,h,z,y,D){function x(a,
b){if(a){var c=a.getLayoutProperty("visibility");if(!c||"none"!==c.getValue()&&(void 0===a.minzoom||a.minzoom<b+1E-6)&&(void 0===a.maxzoom||a.maxzoom>=b-1E-6))return!0}return!1}Object.defineProperty(m,"__esModule",{value:!0});r=function(c){function q(){var a=null!==c&&c.apply(this,arguments)||this;a._backgroundTiles=[];a._fadeRecorder=new b.FadeRecorder(400);a._pointToCallbacks=new Map;a._parsedDataQueue=new Map;return a}e.__extends(q,c);q.prototype.destroy=function(){this.removeAllChildren();this.children.forEach(function(a){return a.destroy()});
this._spriteMosaic&&this._spriteMosaic.dispose();this._glyphMosaic&&this._glyphMosaic.dispose()};Object.defineProperty(q.prototype,"updating",{get:function(){return 0<this._parsedDataQueue.size},enumerable:!0,configurable:!0});q.prototype.setStyleResources=function(a,b,c){this._spriteMosaic=a;this._glyphMosaic=b;this._styleRepository=c};q.prototype.hitTest=function(a,b){return e.__awaiter(this,void 0,void 0,function(){var c,f;return e.__generator(this,function(e){c=[a,b];f=d.createResolver();this._pointToCallbacks.set(c,
f);this.requestRender();return[2,f.promise]})})};q.prototype.setTileData=function(a,b){var c=this.stage;c.dataUploadCounter<f.MAX_GPU_UPLOADS_PER_FRAME&&b?(a.setData(b.tileData,b.client,b.refKeys),c.dataUploadCounter++):b?(this._parsedDataQueue.set(a,b),this.emit("updating-change")):a.setData(null,null)};q.prototype.createRenderParams=function(a){return e.__assign(e.__assign({},c.prototype.createRenderParams.call(this,a)),{renderPass:null,styleLayer:null,styleLayerId:-1,glyphMosaic:this._glyphMosaic,
spriteMosaic:this._spriteMosaic,fadeRecorder:this._fadeRecorder,hasClipping:!!this._clippingInfos})};q.prototype.doRender=function(a){!this.visible||a.drawPhase!==h.WGLDrawPhase.MAP&&a.drawPhase!==h.WGLDrawPhase.DEBUG||void 0===this._spriteMosaic||c.prototype.doRender.call(this,a)};q.prototype.removeChild=function(a){this._parsedDataQueue.has(a)&&(this._parsedDataQueue.delete(a),this.emit("updating-change"));return c.prototype.removeChild.call(this,a)};q.prototype.renderChildren=function(a){if(a.drawPhase===
h.WGLDrawPhase.DEBUG)c.prototype.renderChildren.call(this,a);else{var b=this.stage;if(0<this._parsedDataQueue.size&&b.dataUploadCounter<f.MAX_GPU_UPLOADS_PER_FRAME){for(var d=g.pairsOfMap(this._parsedDataQueue),e=0;e<d.length&&b.dataUploadCounter<f.MAX_GPU_UPLOADS_PER_FRAME;e++){var n=d[e][0],k=d[e][1];n.setData(k.tileData,k.client,k.refKeys);this._parsedDataQueue.delete(n);b.dataUploadCounter++}this.emit("updating-change")}this._fadeRecorder.recordLevel(a.displayLevel);this._doRender(a);(0<this._parsedDataQueue.size||
this._fadeRecorder.needsRedraw())&&this.requestRender();0<this._pointToCallbacks.size&&(b=a.context,d=b.getBoundFramebufferObject(),a.drawPhase=h.WGLDrawPhase.HITTEST,e=a.painter.effects.hittest,e.bind(a),this._doRender(a),e.draw(a,this._pointToCallbacks,6),b.bindFramebuffer(d))}};q.prototype.removeAllChildren=function(){this._parsedDataQueue.clear();for(var a=0;a<this.children.length;a++)this.children[a].dispose();c.prototype.removeAllChildren.call(this)};q.prototype._doRender=function(a){var b=
a.context,d=this._styleRepository,f=d.layers,e=!0;a.drawPhase===h.WGLDrawPhase.HITTEST&&(e=!1);0<d.backgroundBucketIds.length&&(a.renderPass="background",this._renderBackgroundLayers(a,d.backgroundBucketIds));c.prototype.renderChildren.call(this,a);for(var d=this.children.filter(function(a){return a.visible}),g=0;g<d.length;g++){var k=d[g];k.triangleCount=0;k.commitChanges()}b.setStencilWriteMask(0);b.setColorMask(!0,!0,!0,!0);b.setStencilOp(7680,7680,7681);b.setStencilTestEnabled(!0);b.setBlendingEnabled(!1);
b.setDepthTestEnabled(!0);b.setDepthWriteEnabled(!0);b.setDepthFunction(515);b.setClearDepth(1);b.clear(b.gl.DEPTH_BUFFER_BIT);a.renderPass="opaque";for(g=f.length-1;0<=g;g--)this._renderStyleLayer(g,a,d);b.setDepthWriteEnabled(!1);b.setBlendingEnabled(e);b.setBlendFunctionSeparate(1,771,1,771);a.renderPass="translucent";for(g=0;g<f.length;g++)this._renderStyleLayer(g,a,d);b.setDepthTestEnabled(!1);a.renderPass="symbol";for(g=0;g<f.length;g++)this._renderStyleLayer(g,a,d);b.bindVAO();b.setStencilTestEnabled(!0);
b.setBlendingEnabled(!0)};q.prototype._renderStyleLayer=function(a,b,c){var d=b.painter,f=b.renderPass,e=this._styleRepository.layers[a];if(void 0!==e){var h;switch(e.type){case 0:return;case 1:if("opaque"!==f&&"translucent"!==b.renderPass)return;h="vtlFill";break;case 2:if("translucent"!==f)return;h="vtlLine";break;case 4:if("symbol"!==f)return;h="vtlCircle";break;case 3:if("symbol"!==f)return;h="vtlSymbol"}f=b.displayLevel;if(!(0===c.length||void 0!==e.minzoom&&e.minzoom>=f+1E-6||void 0!==e.maxzoom&&
e.maxzoom<f-1E-6))for(b.styleLayerId=a,b.styleLayer=e,e=0;e<c.length;e++)if(c[e].layerData[a]){d.renderObjects(b,c,h);break}}};q.prototype._renderBackgroundLayers=function(b,c){for(var d=b.context,e=b.displayLevel,f=b.painter,g=b.state,q=this._styleRepository,m=!1,p=0;p<c.length;p++){var t=c[p];if(x(q.layers[t],e)){m=!0;break}}if(m){var m=this._tileInfoView.getTileCoverage(b.state,0,"smallest"),t=m.spans,u=m.lodInfo,r=u.level,F=a.create(),p=[];if(this._renderPasses){var E=this._renderPasses[0];k.isSome(this._clippingInfos)&&
(E.brushes[0].prepareState(b,this._clippingInfos[0]),E.brushes[0].drawMany(b,this._clippingInfos))}for(var E=this._backgroundTiles,G=0,A,H=0;H<t.length;H++)for(var C=t[H],I=C.row,J=C.colTo,C=C.colFrom;C<=J;C++)G<E.length?(A=E[G],A.key.set(r,I,u.normalizeCol(C),u.getWorldForColumn(C)),this._tileInfoView.getTileBounds(F,A.key,!1),A.bounds=F,A.coords[0]=F[0],A.coords[1]=F[3]):(A=new D(r,I,u.normalizeCol(C),u.getWorldForColumn(C)),A=new z.TiledDisplayObject(A,this._tileInfoView.getTileBounds(a.create(),
A),[512,512],[4096,4096]),E.push(A)),A.setTransform(g,this._tileInfoView.getTileResolution(A.key)),p.push(A),G++;d.setStencilWriteMask(0);d.setColorMask(!0,!0,!0,!0);d.setStencilOp(7680,7680,7681);d.setStencilFunction(514,0,255);g=!0;b.drawPhase===h.WGLDrawPhase.HITTEST&&(g=!1);d.setStencilTestEnabled(g);for(d=0;d<c.length;d++)t=c[d],g=q.layers[t],x(g,e)&&(b.styleLayerId=t,b.styleLayer=g,f.renderObjects(b,p,"vtlBackground"));y.pool.release(m)}};return q}(c.TileContainer);m.VectorTileContainer=r})},
"esri/views/2d/engine/vectorTiles/FadeRecorder":function(){define(["require","exports"],function(r,m){Object.defineProperty(m,"__esModule",{value:!0});(function(){return function(e,g){this.level=e;this.now=g}})();r=function(){return function(e,g,k,d){this.fadeSpeed=e;this.minfadeLevel=g;this.maxfadeLevel=k;this.fadeChange=d}}();m.FadeProperties=r;r=function(){function e(e,k){void 0===e&&(e=300);void 0===k&&(k=!1);this._levelSnapshots=[];this._duration=e;this._ignoreSpeed=k}e.prototype.recordLevel=
function(e){var g=performance.now(),d=this._levelSnapshots;0===d.length&&(d.push({level:e,now:0}),d.push({level:e,now:0}));2!==d.length&&d[0].level===e||d.push({level:e,now:g})};e.prototype.needsRedraw=function(){if(0===this._levelSnapshots.length)return!1;for(var e=this._duration,k=this._levelSnapshots,d=k.length,a=k[d-1],c=-1;d>c+1&&k[c+1].now+e<a.now;)c++;for(0>c&&(c=0);c<d;c++)if(k[c].level!==a.level)return!0;return!1};e.prototype.getFadeValues=function(){for(var e=this._duration,k=performance.now(),
d=this._levelSnapshots;3<d.length&&d[1].now+e<k;)d.shift();d[1].now+e<k&&(d[0].level=d[1].level);var a=d[0].level,c=d[d.length-1],b=c.level,f=Math.min(a,b),a=Math.max(a,b),d=(c.level-d[1].level)/((c.now-d[1].now)/e);return this._ignoreSpeed?{fadeSpeed:0,minfadeLevel:f,maxfadeLevel:a,fadeChange:0}:{fadeSpeed:d,minfadeLevel:f,maxfadeLevel:a,fadeChange:(k-c.now)/e*d}};return e}();m.FadeRecorder=r})},"esri/views/2d/layers/LayerView2D":function(){define("require exports tslib ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../engine ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(r,m,e,g,k,d,a,c,b,f,h,z){Object.defineProperty(m,"__esModule",{value:!0});var y=g.ofType({key:"type",base:b,typeMap:{rect:f,path:z,geometry:h}});m.LayerView2DMixin=function(b){return function(b){function f(){var a=null!==b&&b.apply(this,arguments)||this;a.clips=new y;a.moving=!1;a.attached=!1;a.lastUpdateId=-1;a.updateRequested=!1;return a}e.__extends(f,b);f.prototype.initialize=function(){var a=this,b;this.container||(this.container=new c.Container);this.handles.add([d.init(this,"suspended",
function(b){a.container&&(a.container.visible=!b);a.view&&!b&&a.updateRequested&&a.view.requestUpdate()},!0),d.init(this,["layer.opacity","container"],function(){var b,c;a.container&&(a.container.opacity=null!==(c=null===(b=a.layer)||void 0===b?void 0:b.opacity)&&void 0!==c?c:1)},!0),d.init(this,["layer.blendMode"],function(b){a.container&&(a.container.blendMode=b)},!0),this.clips.on("change",function(){a.container.clips=a.clips;a.notifyChange("clips")})]);this.container.clips=this.clips;(null===
(b=this.view)||void 0===b?0:b.whenLayerView)?this.view.whenLayerView(this.layer).then(function(b){b!==a||a.attached||a.destroyed||(a.attach(),a.requestUpdate(),a.attached=!0)},function(){}):this.when().then(function(){a.attached||a.destroyed||(a.attach(),a.requestUpdate(),a.attached=!0)},function(){})};f.prototype.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1;this.view=this.layer=null};Object.defineProperty(f.prototype,
"updating",{get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0});f.prototype.isVisibleAtScale=function(a){var b=!0,c=this.layer,f=c.minScale,c=c.maxScale;if(null!=f&&null!=c){var b=!f,d=!c;!b&&a<=f&&(b=!0);!d&&a>=c&&(d=!0);b=b&&d}return b};f.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};f.prototype.processUpdate=function(a){this.isFulfilled()&&
!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))};f.prototype.isUpdating=function(){return!1};f.prototype.isRendering=function(){return!1};f.prototype.canResume=function(){return b.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};e.__decorate([a.property({type:y,set:function(a){a=k.referenceSetter(a,this._get("clips"),y);this._set("clips",a)}})],f.prototype,"clips",
void 0);e.__decorate([a.property()],f.prototype,"moving",void 0);e.__decorate([a.property()],f.prototype,"attached",void 0);e.__decorate([a.property()],f.prototype,"container",void 0);e.__decorate([a.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],f.prototype,"suspended",void 0);e.__decorate([a.property({readOnly:!0})],f.prototype,"updateParameters",void 0);e.__decorate([a.property()],f.prototype,"updateRequested",void 0);e.__decorate([a.property({dependsOn:["attached","updateRequested",
"suspended"]})],f.prototype,"updating",null);e.__decorate([a.property()],f.prototype,"view",void 0);return f=e.__decorate([a.subclass("esri.views.2d.layers.LayerView2D")],f)}(b)}})},"esri/views/layers/support/ClipArea":function(){define(["require","exports","tslib","../../../core/JSONSupport","../../../core/accessorSupport/decorators"],function(r,m,e,g,k){return function(d){function a(){return null!==d&&d.apply(this,arguments)||this}e.__extends(a,d);return a=e.__decorate([k.subclass("esri.views.layers.support.ClipArea")],
a)}(g.JSONSupport)})},"esri/views/layers/support/ClipRect":function(){define(["require","exports","tslib","../../../core/accessorSupport/decorators","./ClipArea"],function(r,m,e,g,k){return function(d){function a(){var a=null!==d&&d.apply(this,arguments)||this;a.type="rect";a.left=null;a.right=null;a.top=null;a.bottom=null;return a}e.__extends(a,d);c=a;a.prototype.clone=function(){return new c({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};Object.defineProperty(a.prototype,"version",
{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});var c;e.__decorate([g.property({type:[Number,String],json:{write:!0}})],a.prototype,"left",void 0);e.__decorate([g.property({type:[Number,String],json:{write:!0}})],a.prototype,"right",void 0);e.__decorate([g.property({type:[Number,String],json:{write:!0}})],a.prototype,"top",void 0);e.__decorate([g.property({type:[Number,String],json:{write:!0}})],a.prototype,"bottom",void 0);e.__decorate([g.property({readOnly:!0,
dependsOn:["left","right","top","bottom"]})],a.prototype,"version",null);return a=c=e.__decorate([g.subclass("esri.views.layers.support.ClipRect")],a)}(k)})},"esri/views/layers/support/Geometry":function(){define("require exports tslib ../../../geometry ../../../core/accessorSupport/decorators ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea".split(" "),function(r,m,e,g,k,d,a,c){var b={base:d,key:"type",typeMap:{extent:g.Extent,polygon:g.Polygon}};return function(c){function d(){var a=
null!==c&&c.apply(this,arguments)||this;a.type="geometry";a.geometry=null;return a}e.__extends(d,c);f=d;Object.defineProperty(d.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});d.prototype.clone=function(){return new f({geometry:this.geometry.clone()})};var f;e.__decorate([k.property({types:b,json:{read:a.fromJSON,write:!0}})],d.prototype,"geometry",void 0);e.__decorate([k.property({readOnly:!0,dependsOn:["geometry"]})],d.prototype,"version",null);
return d=f=e.__decorate([k.subclass("esri.views.layers.support.Geometry")],d)}(c)})},"esri/views/layers/support/Path":function(){define(["require","exports","tslib","../../../core/accessorSupport/decorators","./ClipArea"],function(r,m,e,g,k){return function(d){function a(){var a=null!==d&&d.apply(this,arguments)||this;a.type="path";a.path=[];return a}e.__extends(a,d);Object.defineProperty(a.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});e.__decorate([g.property({type:[[[Number]]],
json:{write:!0}})],a.prototype,"path",void 0);e.__decorate([g.property({readOnly:!0,dependsOn:["path"]})],a.prototype,"version",null);return a=e.__decorate([g.subclass("esri.views.layers.support.Path")],a)}(k)})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define("require exports tslib ../../../layers/support/TileInfo ./TileInfoView ./TileKey".split(" "),function(r,m,e,g,k,d){return function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._fullCacheLodInfos=null;b._levelByScale=
{};return b}e.__extends(c,a);c.prototype.getTileParentId=function(a){a=d.pool.acquire(a);var b=0===a.level?null:d.getId(a.level-1,a.row>>1,a.col>>1,a.world);d.pool.release(a);return b};c.prototype.getTileCoverage=function(b,c,d){b=a.prototype.getTileCoverage.call(this,b,c,d);if(!b)return b;var f=1<<b.lodInfo.level;b.spans=b.spans.filter(function(a){return 0<=a.row&&a.row<f});return b};c.prototype.scaleToLevel=function(a){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[a])return this._levelByScale[a];
var b=this._fullCacheLodInfos;if(a>b[0].scale)return b[0].level;for(var c=void 0,d=void 0,c=0;c<b.length-1;c++)if(d=b[c+1],a>d.scale)return c=b[c],c.level+(c.scale-a)/(c.scale-d.scale);return b[b.length-1].level};c.prototype._initializeFullCacheLODs=function(a){a=0===a[0].level?a.map(function(a){return{level:a.level,resolution:a.resolution,scale:a.scale}}):g.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(function(a){return{level:a.level,resolution:a.resolution,
scale:a.scale}});for(var b=0;b<a.length;b++)this._levelByScale[a[b].scale]=a[b].level;this._fullCacheLodInfos=a};return c}(k)})},"*noref":1}});
define("require exports tslib ../../../Graphic ../../../core/Error ../../../core/Handles ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../engine/vectorTiles/TileHandler ../engine/vectorTiles/TileManager ../engine/vectorTiles/VectorTile ../engine/vectorTiles/VectorTileContainer ./LayerView2D ../tiling/TileInfoViewPOT ../tiling/TileQueue ../../layers/LayerView".split(" "),function(r,m,e,g,k,d,a,c,b,f,h,z,y,D,x,t,q,p){var u=
a.getLogger("esri.views.2d.layers.VectorTileLayerView2D");return function(a){function l(){var b=null!==a&&a.apply(this,arguments)||this;b._handles=new d;b._fetchQueue=null;b._parseQueue=null;b._isTileHandlerPromiseFulfilled=!1;b._invalidateStyle=!1;return b}e.__extends(l,a);l.prototype.initialize=function(){var a=this,b=this.layer.tileInfo,d=this.view.constraints.rotationEnabled;(b&&b.spatialReference).equals(this.view.spatialReference)?(this._tileInfoView=new t(this.layer.tileInfo,this.layer.fullExtent),
this._vectorTileView=new D.VectorTileContainer(this._tileInfoView),this._tileHandler=new h.TileHandler(this.layer,window.devicePixelRatio||1,!0,this._vectorTileView,null,d),this.container.visible=this.layer.visible,this.container.addChild(this._vectorTileView),this.handles.add([this._vectorTileView.on("updating-change",function(){return a.notifyChange("updating")}),this.watch("layer.currentStyleInfo",function(){return a._start()}),this.watch("layer.visible",function(){return a.container.visible=a.layer.visible})])):
this.addResolvingPromise(c.reject(new k("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer})))};l.prototype.destroy=function(){this._stop();this.container.removeAllChildren();this._vectorTileView.destroy();this._tileHandler&&(this._tileHandler.destroy(),this._tileHandler=null)};l.prototype.hitTest=function(a,b){return e.__awaiter(this,void 0,void 0,function(){var c,d,f,h,n;return e.__generator(this,function(e){switch(e.label){case 0:return this.suspended||
!this._tileHandlerPromise?[2,null]:[4,this._tileHandlerPromise];case 1:return e.sent(),[4,this._vectorTileView.hitTest(a,b)];case 2:c=e.sent();if(!c||0===c.length)return[2,null];d=c[0]-1;f=this._tileHandler.getStyleRepository().layers;if(d>=f.length)return[2,null];h=f[d];n=new g({attributes:{layerId:d,layerName:h.id}});n.layer=this.layer;n.sourceLayer=this.layer;return[2,n]}})})};l.prototype.update=function(a){var b=this,c=this._tileHandlerPromise;c&&c.then(function(){if(a.pixelRatio!==b._tileHandler.devicePixelRatio)b._start(),
b._tileHandler.devicePixelRatio=a.pixelRatio;else{b._invalidateStyle?(b._issueStyleInvalidation(),b._invalidateStyle=!1):(b._fetchQueue.pause(),b._parseQueue.pause(),b._fetchQueue.state=a.state,b._parseQueue.state=a.state,b._tileManager.update(a),b._parseQueue.resume(),b._fetchQueue.resume());for(var c=0,d=b._vectorTileView.children;c<d.length;c++)b._tileHandler.updateTile(d[c],a)}})};l.prototype.attach=function(){var a=this;this._start();this._handles.add(this.layer.on("paint-change",function(){return a._vectorTileView.requestRender()}));
this._handles.add(this.layer.on("layout-change",function(){a._invalidateStyle=!0;a.requestUpdate()}))};l.prototype.detach=function(){this._stop();this._handles.removeAll()};l.prototype.moveStart=function(){this.requestUpdate()};l.prototype.viewChange=function(){this.requestUpdate()};l.prototype.moveEnd=function(){this.requestUpdate()};l.prototype.canResume=function(){var b=a.prototype.canResume.call(this),c=this.layer;if(b&&c.currentStyleInfo){var d=this.view.scale;(c=c.currentStyleInfo)&&c.layerDefinition&&
(c=c.layerDefinition,c.minScale&&c.minScale<d&&(b=!1),c.maxScale&&c.maxScale>d&&(b=!1))}return b};l.prototype.isUpdating=function(){var a,b,c,d;return!this._isTileHandlerPromiseFulfilled||(null!==(b=null===(a=this._fetchQueue)||void 0===a?void 0:a.updating)&&void 0!==b?b:!1)||(null!==(d=null===(c=this._parseQueue)||void 0===c?void 0:c.updating)&&void 0!==d?d:!1)||this._vectorTileView.updating};l.prototype.acquireTile=function(a){var b=this,d=this._createVectorTile(a);this._tileHandlerPromise.then(function(){b._fetchQueue.push(d.key).then(function(a){return b._parseQueue.push(a)}).then(function(a){d.once("attach",
function(){return b.requestUpdate()});b._vectorTileView.setTileData(d,a);b._vectorTileView.addChild(d)}).catch(function(a){c.isAbortError(a)||u.error(a);d.destroy()})});return d};l.prototype.releaseTile=function(a){a=a.key.id;this._fetchQueue.abort(a);this._parseQueue.abort(a);this._tileHandler.abortTileUpdate(a);this.requestUpdate()};l.prototype._start=function(){var a=this;this._stop();this._tileManager=new z.TileManager({acquireTile:function(b){return a.acquireTile(b)},releaseTile:function(b){return a.releaseTile(b)},
tileInfoView:this._tileInfoView,fadeDuration:300},this._vectorTileView);if(this.layer.currentStyleInfo){var b=new AbortController,c=this._tileHandler.start({signal:b.signal}).then(function(){a._fetchQueue=new q({tileInfoView:a._tileInfoView,process:function(b,c){return a._getTileData(b,c)},concurrency:15});a._parseQueue=new q({tileInfoView:a._tileInfoView,process:function(b,c){return a._parseTileData(b,c)},concurrency:8});a.requestUpdate();a._isTileHandlerPromiseFulfilled=!0});this._tileHandler.spriteMosaic.then(function(b){a._vectorTileView.setStyleResources(b,
a._tileHandler.glyphMosaic,a.layer.styleRepository);a.requestUpdate()});this._tileHandlerAbortController=b;this._tileHandlerPromise=c}};l.prototype._stop=function(){if(this._tileHandlerAbortController){var a=this._tileHandlerAbortController;a&&a.abort();this._tileHandlerPromise=null;this._isTileHandlerPromiseFulfilled=!1;this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=null);this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null);this._tileManager&&(this._tileManager.destroy(),
this._tileManager=null);this._vectorTileView.removeAllChildren()}};l.prototype._getTileData=function(a,b){return e.__awaiter(this,void 0,void 0,function(){var c;return e.__generator(this,function(d){switch(d.label){case 0:return[4,this._tileHandler.fetchTileData(a,b)];case 1:return c=d.sent(),[2,{key:a,data:c}]}})})};l.prototype._parseTileData=function(a,b){return e.__awaiter(this,void 0,void 0,function(){return e.__generator(this,function(c){return[2,this._tileHandler.parseTileData(a,this.updateParameters.state.rotation,
b)]})})};l.prototype._issueStyleInvalidation=function(){var a=this;this._tileHandlerPromise=this._tileHandler.updateStyle().then(function(){a._tileHandler.spriteMosaic.then(function(b){return a._vectorTileView.setStyleResources(b,a._tileHandler.glyphMosaic,a.layer.styleRepository)});a._fetchQueue.pause();a._parseQueue.pause();a._fetchQueue.clear();a._parseQueue.clear();a._parseQueue.resume();a._fetchQueue.resume();a.requestUpdate()})};l.prototype._createVectorTile=function(a){var b=this.view.constraints.rotationEnabled,
c=this._tileInfoView.getTileBounds(f.create(),a);return new y.VectorTile(a,this.layer.styleRepository,c,[512,512],this.view.rotation,b)};e.__decorate([b.property()],l.prototype,"_fetchQueue",void 0);e.__decorate([b.property()],l.prototype,"_parseQueue",void 0);e.__decorate([b.property()],l.prototype,"_isTileHandlerPromiseFulfilled",void 0);e.__decorate([b.property({dependsOn:["view.scale","layer.currentStyleInfo"]})],l.prototype,"suspended",void 0);e.__decorate([b.property({dependsOn:["_isTileHandlerPromiseFulfilled",
"_parseQueue.updating","_parseQueue.updating"]})],l.prototype,"updating",void 0);return l=e.__decorate([b.subclass("esri.views.2d.layers.VectorTileLayerView2D")],l)}(x.LayerView2DMixin(p))});