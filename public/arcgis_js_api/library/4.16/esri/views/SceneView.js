// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
require({cache:{"esri/geometry/support/scaleUtils":function(){define(["require","exports","../../core/unitUtils"],function(n,b,a){function m(b,e){e=a.getMetersPerUnitForSR(e);return b/(e*a.inchesPerMeter*96)}Object.defineProperty(b,"__esModule",{value:!0});b.getScale=function(b,e){e=e||b.extent;b=b.width;var f=a.getMetersPerUnitForSR(e&&e.spatialReference);return e&&b?e.width/b*f*a.inchesPerMeter*96:0};b.getResolutionForScale=m;b.getScaleForResolution=function(b,e){e=a.getMetersPerUnitForSR(e);return b*
e*a.inchesPerMeter*96};b.getExtentForScale=function(a,e){var f=a.extent;a=a.width;e=m(e,f.spatialReference);return f.clone().expand(e*a/f.width)}})},"esri/layers/support/layerUtils":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.isTiledLayer=function(a){return a&&"base-tile"===a.type||"tile"===a.type||"elevation"===a.type||"imagery-tile"===a.type||"base-elevation"===a.type||"open-street-map"===a.type||"web-tile"===a.type||"wmts"===a.type||
"vector-tile"===a.type};b.isBaseLayer=function(a){return a.parent&&"esri.Basemap"===a.parent.declaredClass&&-1<a.parent.baseLayers.indexOf(a)};b.serializeLayerDefinitions=function(a){var b=/[:;]/,h=[],e=!1;if(a&&(a.forEach(function(a,d){h.push([d,a]);!e&&b.test(a)&&(e=!0)}),0<h.length)){a=void 0;if(e){var f={};h.forEach(function(a){f[a[0]]=a[1]});a=JSON.stringify(f)}else{var g=[];h.forEach(function(a){g.push(a[0]+":"+a[1])});a=g.join(";")}return a}return null};b.serializeTimeOptions=function(a){if(a){var b=
[];a.forEach(function(a,e){b.push('"'+e+'":'+JSON.stringify(a))});if(b.length)return"{"+b.join(",")+"}"}};b.getLayersForScale=function(a,b){var h=[];if(0<a&&b)for(var e=function(g){if(0<=b[g].parentLayerId&&-1===h.indexOf(b[g].parentLayerId)&&b.some(function(c){return c.id===b[g].parentLayerId}))return"continue";if(0<=b[g].id){var e=!0,d=b[g].maxScale,c=b[g].minScale;if(0<d||0<c)0<d&&0<c?e=d<=a&&a<=c:0<d?e=d<=a:0<c&&(e=a<=c);e&&h.push(b[g].id)}},f=0;f<b.length;f++)e(f);return h};b.areLabelsVisible=
function(a){return!0===a.labelsVisible&&null!=a.labelingInfo&&0<a.labelingInfo.length}})},"esri/views/BreakpointsOwner":function(){define("require exports tslib ../core/ArrayPool ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators".split(" "),function(n,b,a,m,h,e,f){function g(c,d){return d?l[c].valueToClassName[d].split(" "):[]}Object.defineProperty(b,"__esModule",{value:!0});var l={widthBreakpoint:{getValue:function(c){var d=c.viewSize[0];c=c.breakpoints;var a=this.values;return d<=
c.xsmall?a.xsmall:d<=c.small?a.small:d<=c.medium?a.medium:d<=c.large?a.large:a.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},
heightBreakpoint:{getValue:function(c){var d=c.viewSize[1];c=c.breakpoints;var a=this.values;return d<=c.xsmall?a.xsmall:d<=c.small?a.small:d<=c.medium?a.medium:d<=c.large?a.large:a.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},
orientation:{getValue:function(c){c=c.viewSize;var d=this.values;return c[1]>=c[0]?d.portrait:d.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},d={xsmall:544,small:768,medium:992,large:1200};b.BreakpointsOwner=function(c){return function(c){function k(){for(var k=[],a=0;a<arguments.length;a++)k[a]=arguments[a];k=c.apply(this,k)||this;k._breakpointsHandles=new h;k.orientation=null;
k.widthBreakpoint=null;k.heightBreakpoint=null;k.breakpoints=d;return k}a.__extends(k,c);k.prototype.initialize=function(){this._breakpointsHandles.add(e.init(this,["breakpoints","size"],this._updateClassNames))};k.prototype.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)};Object.defineProperty(k.prototype,"breakpoints",{set:function(c){var k=this._get("breakpoints");if(c!==k){k=(k=c)&&k.xsmall<k.small&&k.small<k.medium&&
k.medium<k.large;if(!k){var g=JSON.stringify(d,null,2);console.warn("provided breakpoints are not valid, using defaults:"+g)}c=k?c:d;this._set("breakpoints",a.__assign({},c))}},enumerable:!0,configurable:!0});k.prototype._updateClassNames=function(){if(this.container){var c=m.acquire(),d=m.acquire(),k=!1,a;for(a in l){var e=this[a],f=l[a].getValue({viewSize:this.size,breakpoints:this.breakpoints});e!==f&&(k=!0,this[a]=f,g(a,e).forEach(function(c){return d.push(c)}),g(a,f).forEach(function(d){return c.push(d)}))}k&&
(this._applyClassNameChanges(c,d),m.release(c),m.release(d))}};k.prototype._applyClassNameChanges=function(c,d){var k=this.container;k&&(d.forEach(function(c){return k.classList.remove(c)}),c.forEach(function(c){return k.classList.add(c)}))};k.prototype._removeActiveClassNames=function(){var c=this.container;if(c)for(var d in l)g(d,this[d]).forEach(function(d){return c.classList.remove(d)})};a.__decorate([f.property()],k.prototype,"breakpoints",null);a.__decorate([f.property()],k.prototype,"orientation",
void 0);a.__decorate([f.property()],k.prototype,"widthBreakpoint",void 0);a.__decorate([f.property()],k.prototype,"heightBreakpoint",void 0);return k=a.__decorate([f.subclass("esri.views.BreakpointsOwner")],k)}(c)}})},"esri/views/GroundView":function(){define("require exports tslib ../core/Accessor ../core/Collection ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./support/GroundViewElevationSampler".split(" "),function(n,b,a,m,h,e,f,g,l){return function(d){function c(c){c=
d.call(this,c)||this;c.handles=new e;c.view=null;c.layerViews=new h;return c}a.__extends(c,d);c.prototype.initialize=function(){var c=this;this.handles.add(f.when(this,"view.map.ground",function(c){return c.load()}));this.handles.add(this.layerViews.on("after-changes",function(){return c.layerViewsAfterChangesHandler()}))};c.prototype.destroy=function(){this._set("view",null);this.handles&&(this.handles.destroy(),this.handles=null)};Object.defineProperty(c.prototype,"elevationSampler",{get:function(){return this.view&&
"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new l({view:this.view}):null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"updating",{get:function(){return this.suspended?!1:this.layerViews.some(function(c){return c.updating})},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"suspended",{get:function(){return!this.view||this.view.suspended},enumerable:!0,configurable:!0});c.prototype.layerViewsAfterChangesHandler=
function(){var c=this;this.handles.remove("updating");this.handles.add(this.layerViews.map(function(d){return d.watch("updating",function(){return c.updateUpdating()},!0)}).toArray(),"updating");this.updateUpdating()};c.prototype.updateUpdating=function(){this.notifyChange("updating")};a.__decorate([g.property({readOnly:!0,dependsOn:["view.ready","view.basemapTerrain?.ready"]})],c.prototype,"elevationSampler",null);a.__decorate([g.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],c.prototype,
"updating",null);a.__decorate([g.property({constructOnly:!0})],c.prototype,"view",void 0);a.__decorate([g.property({type:h,readOnly:!0})],c.prototype,"layerViews",void 0);a.__decorate([g.property({readOnly:!0,dependsOn:["view.suspended"]})],c.prototype,"suspended",null);return c=a.__decorate([g.subclass("esri.views.GroundView")],c)}(m)})},"esri/views/support/GroundViewElevationSampler":function(){define("require exports tslib ../../core/Evented ../../core/Logger ../../core/accessorSupport/decorators ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../layers/support/ElevationSampler ../3d/support/ElevationProvider ../3d/terrain/TerrainConst".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k){var p=h.getLogger("esri.views.support.GroundViewElevationSampler");return function(b){function h(c){c=b.call(this,c)||this;c.demResolution={min:-1,max:-1};c.noDataValue=k.ELEVATION_NODATA_VALUE;return c}a.__extends(h,b);h.prototype.initialize=function(){var c=this;this.view.basemapTerrain.on("elevation-change",function(){return c.emit("changed",{})})};Object.defineProperty(h.prototype,"extent",{get:function(){var c=this.view.basemapTerrain;return c.extent&&c.spatialReference?
f.toExtent(c.extent,c.spatialReference):null},enumerable:!0,configurable:!0});h.prototype.elevationAt=function(d){var k=d.spatialReference,a=this.spatialReference;if(!l.canProject(k,a))return p.error("Cannot sample elevation at a location with spatial reference ("+(k?k.wkid:"unknown")+") different from the view ("+a.wkid+")"),null;g.extentContainsPoint(this.extent,d)||(k=this.extent,p.warn("#elevationAt()","Point used to sample elevation ("+d.x+", "+d.y+") is outside of the sampler extent ("+(k.xmin+
", "+k.ymin+", "+k.xmax+", "+k.ymax)+")"));return c.getElevationAtPoint(this.view.elevationProvider,d)};h.prototype.queryElevation=function(c){return d.updateGeometryElevation(c.clone(),this)};a.__decorate([e.property({readOnly:!0})],h.prototype,"demResolution",void 0);a.__decorate([e.property({readOnly:!0,dependsOn:["view.basemapTerrain.extent","view.basemapTerrain.spatialReference"]})],h.prototype,"extent",null);a.__decorate([e.property({readOnly:!0})],h.prototype,"noDataValue",void 0);a.__decorate([e.property({readOnly:!0,
aliasOf:"view.basemapTerrain.spatialReference"})],h.prototype,"spatialReference",void 0);a.__decorate([e.property({constructOnly:!0})],h.prototype,"view",void 0);return h=a.__decorate([e.subclass("esri.views.support.GroundViewElevationSampler")],h)}(m.EventedAccessor)})},"esri/layers/support/ElevationSampler":function(){define("require exports tslib ../../geometry ../../core/compilerUtils ../../core/Logger ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d){function c(c,d){var a=k(c,d.spatialReference);if(!a)return null;switch(c.type){case "point":c.z=d.elevationAt(a)||0;break;case "polyline":t.spatialReference=a.spatialReference;for(var g=c.hasM&&!c.hasZ,e=0;e<c.paths.length;e++)for(var f=c.paths[e],l=a.paths[e],p=0;p<f.length;p++){var b=f[p],r=l[p];t.x=r[0];t.y=r[1];r=d.elevationAt(t)||0;g&&(b[3]=b[2]);b[2]=r}c.hasZ=!0;break;case "multipoint":t.spatialReference=a.spatialReference;g=c.hasM&&!c.hasZ;for(e=0;e<c.points.length;e++)f=
c.points[e],l=a.points[e],t.x=l[0],t.y=l[1],l=d.elevationAt(t)||0,g&&(f[3]=f[2]),f[2]=l;c.hasZ=!0;break;default:h.neverReached(c)}return c}function k(c,k){var a=c.spatialReference;return a.equals(k)?c:d.canProject(a,k)?d.project(c,k):(p.error("Cannot project geometry spatial reference (wkid:"+a.wkid+") to elevation sampler spatial reference (wkid:"+k.wkid+")"),null)}Object.defineProperty(b,"__esModule",{value:!0});var p=e.getLogger("esri.layers.support.ElevationSampler");n=function(){function d(){}
d.prototype.queryElevation=function(d){return c(d.clone(),this)};d.prototype.on=function(){return u};d.prototype.projectIfRequired=function(c,d){return k(c,d)};return d}();b.ElevationSamplerBase=n;var r=function(c){function d(d,k,a){var e=c.call(this)||this;e.tile=d;e.noDataValue=a;e.extent=g.toExtent(d.tile.extent,k.spatialReference);a=f.getMetersPerUnitForSR(k.spatialReference);d=k.lodAt(d.tile.level).resolution*a;e.demResolution={min:d,max:d};return e}a.__extends(d,c);Object.defineProperty(d.prototype,
"spatialReference",{get:function(){return this.extent.spatialReference},enumerable:!0,configurable:!0});d.prototype.contains=function(c){c=this.projectIfRequired(c,this.spatialReference);return l.extentContainsPoint(this.extent,c)};d.prototype.elevationAt=function(c){var d=this.projectIfRequired(c,this.spatialReference);if(!d)return null;if(!this.contains(c)){var k=this.extent;p.warn("#elevationAt()","Point used to sample elevation ("+c.x+", "+c.y+") is outside of the sampler extent ("+(k.xmin+", "+
k.ymin+", "+k.xmax+", "+k.ymax)+")")}return this.tile.sample(d.x,d.y)};return d}(n);b.TileElevationSampler=r;n=function(c){function d(d,k,a){var e=c.call(this)||this,f;"number"===typeof k?(e.noDataValue=k,f=null):(f=k,e.noDataValue=a);e.samplers=f?d.map(function(c){return new r(c,f,e.noDataValue)}):d;if(d=e.samplers[0])for(e.extent=d.extent.clone(),d=d.demResolution,e.demResolution={min:d.min,max:d.max},d=1;d<e.samplers.length;d++)k=e.samplers[d],e.extent.union(k.extent),e.demResolution.min=Math.min(e.demResolution.min,
k.demResolution.min),e.demResolution.max=Math.max(e.demResolution.max,k.demResolution.max);else e.extent=g.toExtent(g.create(),f.spatialReference),e.demResolution={min:0,max:0};return e}a.__extends(d,c);Object.defineProperty(d.prototype,"spatialReference",{get:function(){return this.extent.spatialReference},enumerable:!0,configurable:!0});d.prototype.elevationAt=function(c){var d=this.projectIfRequired(c,this.spatialReference);if(!d)return null;for(var k=0,a=this.samplers;k<a.length;k++){var g=a[k];
if(g.contains(d))return g.elevationAt(d)}p.warn("#elevationAt()","Point used to sample elevation ("+c.x+", "+c.y+") is outside of the sampler");return null};return d}(n);b.MultiTileElevationSampler=n;b.updateGeometryElevation=c;var t=new m.Point,u={remove:function(){}}})},"esri/views/3d/support/ElevationProvider":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.getElevationAtPoint=function(a,b,h){return a.getElevation(b.x,b.y,b.z||0,b.spatialReference,
h)}})},"esri/views/3d/terrain/TerrainConst":function(){define(["require","exports","../../../core/mathUtils","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.TILE_LOADING_DEBUGLOG=!1;b.MAX_ROOT_TILES=64;b.MAX_PATCH_TESSELATION=512;b.MAX_MEMORY_LOD_BIAS=2.5;b.ELEVATION_NODATA_VALUE=a.clampFloat32(a.NUMBER_MAX_FLOAT32/10);b.LOADING_LEVEL_MODULO=2;b.ELEVATION_DESIRED_RESOLUTION_LEVEL=4;b.WEBMERCATOR_WORLD_EXTENT=m.create();
h.WebMercatorAuxiliarySphere.getExtent(0,0,0,b.WEBMERCATOR_WORLD_EXTENT);b.GEOGRAPHIC_WORLD_EXTENT=m.create([-180,-90,180,90]);b.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";b.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";b.DEFAULT_TILE_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC";
b.GEOMETRY_VERTEX_STRIDE=5})},"esri/views/3d/terrain/TilingScheme":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/mathUtils ../../../core/unitUtils ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/support/TileInfo ../support/projectionUtils".split(" "),function(n,b,a,m,h,e,f,g,l,d){var c=d.webMercator.x2lon,k=d.webMercator.y2lat;n=function(){function b(c){var k=b.checkUnsupported(c);if(k)throw k;this.spatialReference=
c.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isWGS84Comparable=d.canProjectToWGS84ComparableLonLat(this.spatialReference);this.origin=[c.origin.x,c.origin.y];this.pixelSize=c.size[0];this.dpi=c.dpi;var a=c.lods.reduce(function(c,d,k){d.level<c.min&&(c.min=d.level,c.minIndex=k);c.max=Math.max(c.max,d.level);return c},{min:Infinity,minIndex:0,max:-Infinity}),g=c.lods[a.minIndex],e=Math.pow(2,g.level),k=g.resolution*e,g=g.scale*e;this.levels=Array(a.max+1);for(a=0;a<
this.levels.length;a++)this.levels[a]={resolution:k,scale:g,tileSize:[k*c.size[0],k*c.size[1]]},k/=2,g/=2}b.prototype.clone=function(){return new b(this.toTileInfo())};b.prototype.toTileInfo=function(){return new l({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map(function(c,d){return{level:d,scale:c.scale,resolution:c.resolution}})})};b.prototype.getExtent=
function(d,a,e,f,l){void 0===f&&(f=g.create());var p=this.levels[d];d=p.tileSize[0];p=p.tileSize[1];f[0]=this.origin[0]+e*d;f[2]=f[0]+d;f[3]=this.origin[1]-a*p;f[1]=f[3]-p;l&&(this._isWebMercator?(l[0]=c(f[0]),l[1]=k(f[1]),l[2]=c(f[2]),l[3]=k(f[3])):this._isWGS84Comparable&&(l[0]=h.deg2rad(f[0]),l[1]=h.deg2rad(f[1]),l[2]=h.deg2rad(f[2]),l[3]=h.deg2rad(f[3])));return f};b.prototype.getExtentGeometry=function(c,d,k,g){void 0===g&&(g=new a.Extent);this.getExtent(c,d,k,p);g.spatialReference=this.spatialReference;
g.xmin=p[0];g.ymin=p[1];g.xmax=p[2];g.ymax=p[3];g.zmin=void 0;g.zmax=void 0;return g};b.prototype.ensureMaxLod=function(c){if(null==c)return!1;for(var d=!1;this.levels.length<=c;){var d=this.levels[this.levels.length-1],k=d.resolution/2;this.levels.push({resolution:k,scale:d.scale/2,tileSize:[k*this.pixelSize,k*this.pixelSize]});d=!0}return d};b.prototype.capMaxLod=function(c){this.levels.length>c+1&&(this.levels.length=c+1)};b.prototype.getMaxLod=function(){return this.levels.length-1};b.prototype.scaleAtLevel=
function(c){return this.levels[0].scale/Math.pow(2,c)};b.prototype.levelAtScale=function(c){var d=this.levels[0].scale;return c>=d?0:Math.log(d/c)*Math.LOG2E};b.prototype.resolutionAtLevel=function(c){return this.levels[0].resolution/Math.pow(2,c)};b.prototype.compatibleWith=function(c){if(!(c instanceof b)){if(b.checkUnsupported(c))return!1;c=new b(c)}if(!c.spatialReference.equals(this.spatialReference)||c.pixelSize!==this.pixelSize)return!1;var d=Math.min(this.levels.length,c.levels.length)-1,k=
this.levels[d].resolution,a=.5*k;if(!h.floatEqualAbsolute(c.origin[0],this.origin[0],a)||!h.floatEqualAbsolute(c.origin[1],this.origin[1],a))return!1;a=.5*k/Math.pow(2,d)/this.pixelSize*12;return h.floatEqualAbsolute(k,c.levels[d].resolution,a)};b.prototype.rootTilesInExtent=function(c,d,k){var a=this.levels[0].tileSize;if(0===a[0]||0===a[1])return[];b.computeRowColExtent(c,a,this.origin,p);c=p[1];var g=p[3],e=p[0],f=p[2],l=f-e,h=g-c;l*h>k&&(k=Math.floor(Math.sqrt(k)),h>k&&(c=c+Math.floor(.5*h)-Math.floor(.5*
k),g=c+k),l>k&&(e=e+Math.floor(.5*l)-Math.floor(.5*k),f=e+k));k=[];for(l=c;l<g;l++)for(h=e;h<f;h++)k.push([0,l,h]);d&&(d[0]=this.origin[0]+e*a[0],d[1]=this.origin[1]-g*a[1],d[2]=this.origin[0]+f*a[0],d[3]=this.origin[1]-c*a[1]);return k};b.computeRowColExtent=function(c,d,k,a){var g=.001*(c[2]-c[0]+(c[3]-c[1]));a[0]=Math.max(0,Math.floor((c[0]+g-k[0])/d[0]));a[2]=Math.max(0,Math.ceil((c[2]-g-k[0])/d[0]));a[1]=Math.max(0,Math.floor((k[1]-c[3]+g)/d[1]));a[3]=Math.max(0,Math.ceil((k[1]-c[1]-g)/d[1]))};
b.isPowerOfTwo=function(c){c=c.lods;var d=c[0].resolution*Math.pow(2,c[0].level);return!c.some(function(c){return!h.floatEqualRelative(c.resolution,d/Math.pow(2,c.level))})};b.hasGapInLevels=function(c){c=c.lods.map(function(c){return c.level});c.sort(function(c,d){return c-d});for(var d=1;d<c.length;d++)if(c[d]!==c[0]+d)return!0;return!1};b.tileSizeSupported=function(c){var d=c.size[1];return d===c.size[0]&&0===(d&d-1)&&128<=d&&512>=d};b.checkUnsupported=function(c){return c?1>c.lods.length?new m("tilingscheme:generic",
"Tiling scheme must have at least one level"):b.isPowerOfTwo(c)?b.hasGapInLevels(c)?new m("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):b.tileSizeSupported(c)?null:new m("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new m("tilingscheme:power-of-two","Tiling scheme must be power of two"):new m("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};b.fromExtent=function(c,d){var k=c[2]-c[0],
a=c[3]-c[1],g=e.getMetersPerUnitForSR(d),f=1.2*Math.max(k,a);c=new b(new l({size:[256,256],origin:{x:c[0]-.5*(f-k),y:c[3]+.5*(f-a)},lods:[{level:0,resolution:f/256,scale:1/(256/96*.0254/(f*g))}],spatialReference:d}));c.ensureMaxLod(20);return c};b.makeWebMercatorAuxiliarySphere=function(c){var d=new b(b.WebMercatorAuxiliarySphereTileInfo);d.ensureMaxLod(c);return d};b.makeGCSWithTileSize=function(c,d,k){void 0===d&&(d=256);void 0===k&&(k=16);var a=256/d;c=new b(new l({size:[d,d],origin:{x:-180,y:90,
spatialReference:c},spatialReference:c,lods:[{level:0,resolution:.703125*a,scale:2.95497598570834E8*a}]}));c.ensureMaxLod(k);return c};Object.defineProperty(b.prototype,"test",{get:function(){return{isWebMercator:this._isWebMercator,isWGS84:this._isWGS84Comparable}},enumerable:!0,configurable:!0});b.WebMercatorAuxiliarySphereTileInfo=new l({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:f.WebMercator},spatialReference:f.WebMercator,lods:[{level:0,resolution:156543.03392800014,
scale:5.91657527591555E8}]});b.WebMercatorAuxiliarySphere=b.makeWebMercatorAuxiliarySphere(19);return b}();var p=g.create();return n})},"esri/layers/support/TileInfo":function(){define("require exports tslib ../../geometry ../../core/jsonMap ../../core/JSONSupport ../../core/unitUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p){var r=new h.default({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});return function(e){function b(c){c=e.call(this,c)||this;c.dpi=96;c.format=null;c.origin=null;c.minScale=0;c.maxScale=0;c.size=null;c.spatialReference=null;return c}a.__extends(b,e);h=b;b.create=function(d){void 0===
d&&(d={size:256,spatialReference:m.SpatialReference.WebMercator});var k=d.resolutionFactor||1,a=d.scales,g=d.size||256,e=d.spatialReference||m.SpatialReference.WebMercator;if(!c.isValid(e)){k=[];if(a)for(d=0;d<a.length;d++){var l=a[d];k.push({level:d,scale:l,resolution:l})}else{var p=5E-4;for(d=23;0<=d;d--)k.unshift({level:d,scale:p,resolution:p}),p*=2}return new h({dpi:96,lods:k,origin:new m.Point(0,0,e),size:[g,g],spatialReference:e})}var l=c.getInfo(e),b=d.origin?new m.Point({x:d.origin.x,y:d.origin.y,
spatialReference:e}):l?new m.Point({x:l.origin[0],y:l.origin[1],spatialReference:e}):new m.Point({x:0,y:0,spatialReference:e}),r=1/(39.37*f.getMetersPerUnitForSR(e)*96),t=[];if(a)for(d=0;d<a.length;d++)l=a[d],p=l*r,t.push({level:d,scale:l,resolution:p});else for(l=c.isGeographic(e)?512/g*5.916575275917094E8:256/g*5.91657527591555E8,a=Math.ceil(24/k),t.push({level:0,scale:l,resolution:l*r}),d=1;d<a;d++)l/=Math.pow(2,k),p=l*r,t.push({level:d,scale:l,resolution:p});return new h({dpi:96,lods:t,origin:b,
size:[g,g],spatialReference:e})};Object.defineProperty(b.prototype,"isWrappable",{get:function(){var d=this.spatialReference,k=this.origin;if(d&&k){var a=c.getInfo(d);return d.isWrappable&&Math.abs(a.origin[0]-k.x)<=a.dx}return!1},enumerable:!0,configurable:!0});b.prototype.readOrigin=function(c,d){return m.Point.fromJSON(a.__assign({spatialReference:d.spatialReference},c))};Object.defineProperty(b.prototype,"lods",{set:function(c){var d=this,k=0,a=0,g=[];this._levelToLOD={};c&&(k=-Infinity,a=Infinity,
c.forEach(function(c){g.push(c.scale);k=c.scale>k?c.scale:k;a=c.scale<a?c.scale:a;d._levelToLOD[c.level]=c}));this._set("scales",g);this._set("minScale",k);this._set("maxScale",a);this._set("lods",c);this._initializeUpsampleLevels()},enumerable:!0,configurable:!0});b.prototype.readSize=function(c,d){return[d.cols,d.rows]};b.prototype.writeSize=function(c,d){d.cols=c[0];d.rows=c[0]};b.prototype.zoomToScale=function(c){var d=this.scales;if(0>=c)return d[0];if(c>=d.length)return d[d.length-1];var k=
Math.round(c);return d[k]+(k-c)*(d[Math.round(c-.5)]-d[k])};b.prototype.scaleToZoom=function(c){for(var d=this.scales,k=d.length-1,a=0;a<k;a++){var g=d[a],e=d[a+1];if(g<=c)break;if(e===c)return a+1;if(g>c&&e<c)return a+1-(c-e)/(g-e)}return a};b.prototype.snapScale=function(c,d){void 0===d&&(d=.95);c=this.scaleToZoom(c);return c%Math.floor(c)>=d?this.zoomToScale(Math.ceil(c)):this.zoomToScale(Math.floor(c))};b.prototype.tileAt=function(a,g,e,f){var l=this.lodAt(a);if(!l)return null;var p;if("number"===
typeof g)p=g,g=e;else{if(c.equals(g.spatialReference,this.spatialReference))p=g.x,g=g.y;else{f=k.project(g,this.spatialReference);if(!f)return null;p=f.x;g=f.y}f=e}e=l.resolution*this.size[0];l=l.resolution*this.size[1];f||(f={id:null,level:0,row:0,col:0,extent:d.create()});f.level=a;f.row=Math.floor((this.origin.y-g)/l+.001);f.col=Math.floor((p-this.origin.x)/e+.001);this.updateTileInfo(f);return f};b.prototype.updateTileInfo=function(c){var k=this.lodAt(c.level);if(k){var a=k.resolution*this.size[0],
k=k.resolution*this.size[1];c.id=c.level+"/"+c.row+"/"+c.col;c.extent||(c.extent=d.create());c.extent[0]=this.origin.x+c.col*a;c.extent[1]=this.origin.y-(c.row+1)*k;c.extent[2]=c.extent[0]+a;c.extent[3]=c.extent[1]+k}};b.prototype.upsampleTile=function(c){var d=this._upsampleLevels[c.level];if(!d||-1===d.parentLevel)return!1;c.level=d.parentLevel;c.row=Math.floor(c.row/d.factor+.001);c.col=Math.floor(c.col/d.factor+.001);this.updateTileInfo(c);return!0};b.prototype.getTileBounds=function(c,d){var k=
this.lodAt(d.level).resolution,a=k*this.size[0],k=k*this.size[1];c[0]=this.origin.x+d.col*a;c[1]=this.origin.y-(d.row+1)*k;c[2]=c[0]+a;c[3]=c[1]+k;return c};b.prototype.lodAt=function(c){return this._levelToLOD&&this._levelToLOD[c]||null};b.prototype.clone=function(){return h.fromJSON(this.write({}))};b.prototype._initializeUpsampleLevels=function(){var c=this.lods;this._upsampleLevels=[];for(var d=null,k=0;k<c.length;k++){var a=c[k];this._upsampleLevels[a.level]={parentLevel:d?d.level:-1,factor:d?
d.resolution/a.resolution:0};d=a}};var h;a.__decorate([g.property({type:Number,json:{write:!0}})],b.prototype,"compressionQuality",void 0);a.__decorate([g.property({type:Number,json:{write:!0}})],b.prototype,"dpi",void 0);a.__decorate([g.property({type:String,json:{read:r.read,write:r.write,origins:{"web-scene":{read:!1,write:!1}}}})],b.prototype,"format",void 0);a.__decorate([g.property({readOnly:!0,dependsOn:["spatialReference","origin"]})],b.prototype,"isWrappable",null);a.__decorate([g.property({type:m.Point,
json:{write:!0}})],b.prototype,"origin",void 0);a.__decorate([g.reader("origin")],b.prototype,"readOrigin",null);a.__decorate([g.property({type:[p],value:null,json:{write:!0}})],b.prototype,"lods",null);a.__decorate([g.property({readOnly:!0})],b.prototype,"minScale",void 0);a.__decorate([g.property({readOnly:!0})],b.prototype,"maxScale",void 0);a.__decorate([g.property({readOnly:!0})],b.prototype,"scales",void 0);a.__decorate([g.property({cast:function(c){return Array.isArray(c)?c:"number"===typeof c?
[c,c]:[256,256]}})],b.prototype,"size",void 0);a.__decorate([g.reader("size",["rows","cols"])],b.prototype,"readSize",null);a.__decorate([g.writer("size",{cols:{type:l.Integer},rows:{type:l.Integer}})],b.prototype,"writeSize",null);a.__decorate([g.property({type:m.SpatialReference,json:{write:!0}})],b.prototype,"spatialReference",void 0);return b=h=a.__decorate([g.subclass("esri.layers.support.TileInfo")],b)}(e.JSONSupport)})},"esri/layers/support/LOD":function(){define("require exports tslib ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),
function(n,b,a,m,h,e){return function(f){function g(d){d=f.call(this,d)||this;d.level=0;d.levelValue=null;d.resolution=0;d.scale=0;return d}a.__extends(g,f);l=g;g.prototype.clone=function(){return new l({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})};var l;a.__decorate([h.property({type:e.Integer,json:{write:!0}})],g.prototype,"level",void 0);a.__decorate([h.property({type:String,json:{write:!0}})],g.prototype,"levelValue",void 0);a.__decorate([h.property({type:Number,
json:{write:!0}})],g.prototype,"resolution",void 0);a.__decorate([h.property({type:Number,json:{write:!0}})],g.prototype,"scale",void 0);return g=l=a.__decorate([h.subclass("esri.layers.support.LOD")],g)}(m.JSONSupport)})},"esri/views/3d/support/projectionUtils":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ./earthUtils ../webgl-engine/lib/BufferVectorMath".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r){function t(c,d,k,a){if(2>c.length)return!1;2===c.length&&(aa[0]=c[0],aa[1]=c[1],aa[2]=0,c=aa);return v(c,d,0,k,a,0,1)}function u(c,d,k,a,g,e,f){void 0===f&&(f=0);for(var l=[],p=0;p<c.length;p++)for(var b=c[p],h=0,q=b;h<q.length;h++)b=q[h],l.push(b[0],b[1],d?b[2]:f);if(!v(l,a,0,l,e,0,l.length/3))return!1;a=0;for(e=g.length=0;e<c.length;e++){b=c[e];f=[];p=0;for(h=b;p<h.length;p++)b=h[p],d&&k?f.push([l[a++],l[a++],l[a++],b[3]]):d?f.push([l[a++],l[a++],l[a++]]):(k?
f.push([l[a++],l[a++],b[2]]):f.push([l[a++],l[a++]]),a++);g.push(f)}return!0}function v(c,d,k,a,g,e,f){void 0===f&&(f=1);d=Q(d,g,ka);if(m.isNone(d))return!1;if(d===w){if(c===a&&k===e)return!0;for(d=k+3*f;k<d;k++,e++)a[e]=c[k];return!0}for(f=k+3*f;k<f;k+=3,e+=3)d(c,k,a,e);return!0}function z(c,d){if(d.spatialReference===c)return d.spatialReferenceId;d.spatialReference=c;"metersPerUnit"in d&&(d.metersPerUnit=h.getMetersPerUnitForSR(c,1));return c.wkt===b.SphericalECEFSpatialReference.wkt?d.spatialReferenceId=
1:c.isWGS84?d.spatialReferenceId=2:c.isWebMercator?d.spatialReferenceId=3:c.wkt===b.WGS84ECEFSpatialReference.wkt?d.spatialReferenceId=4:4490===c.wkid?d.spatialReferenceId=5:d.spatialReferenceId=0}function w(c,d,k,a){c!==k&&(k[a++]=c[d++],k[a++]=c[d++],k[a]=c[d])}function q(c,d,k,a){k[a++]=Z*(c[d++]/p.earthRadius);k[a++]=Z*(Math.PI/2-2*Math.atan(Math.exp(-1*c[d++]/p.earthRadius)));k[a]=c[d]}function y(c,d,k,a){q(c,d,k,a);H(k,a,k,a)}function A(c,d,k,a){q(c,d,k,a);E(k,a,k,a)}function B(c,d,k,g){var e=
.4999999*Math.PI,e=a.clamp(ia*c[d+1],-e,e),e=Math.sin(e);k[g++]=ia*c[d]*p.earthRadius;k[g++]=p.halfEarthRadius*Math.log((1+e)/(1-e));k[g]=c[d+2]}function C(c,d,k){d=z(d,fa);d=da[d][6];if(m.isNone(d))return!1;d(c,0,aa,0);k!==aa&&(k[0]=aa[0],k[1]=aa[1],2<k.length&&(k[2]=aa[2]));return!0}function F(c,d){aa[0]=c.x;aa[1]=c.y;aa[2]=c.hasZ?c.z:0;return C(aa,c.spatialReference,d)}function H(c,d,k,a){var g=p.earthRadius+c[d+2],e=ia*c[d+1];c=ia*c[d];d=Math.cos(e);k[a++]=Math.cos(c)*d*g;k[a++]=Math.sin(c)*d*
g;k[a]=Math.sin(e)*g}function I(c,d,k,g){var e=r.Vec3Compact.length(c,d),f=a.asinClamped(c[d+2]/(0===e?1:e));c=Math.atan2(c[d+1],c[d]);k[g++]=Z*c;k[g++]=Z*f;k[g]=e-p.earthRadius}function G(c,d,k,a){I(c,d,k,a);B(k,a,k,a)}function J(c,d,k,a){I(c,d,k,a);E(k,a,k,a)}function E(c,d,k,a){var g=oa,e=ia*c[d],f=ia*c[d+1];c=c[d+2];d=Math.sin(f);var f=Math.cos(f),l=g.a/Math.sqrt(1-g.e2*d*d);k[a++]=(l+c)*f*Math.cos(e);k[a++]=(l+c)*f*Math.sin(e);k[a++]=(l*(1-g.e2)+c)*d}function L(c,d,k,a){var g=oa,e=c[d],f=c[d+
1];c=c[d+2];var l,p,b,h,q,r;d=Math.abs(c);l=e*e+f*f;p=Math.sqrt(l);b=l+c*c;h=Math.sqrt(b);e=Math.atan2(f,e);q=c*c/b;b=l/b;f=g.a2/h;l=g.a3-g.a4/h;.3<b?(q=d/h*(1+b*(g.a1+f+q*l)/h),h=Math.asin(q),f=q*q,b=Math.sqrt(1-f)):(b=p/h*(1-q*(g.a5-f-b*l)/h),h=Math.acos(b),f=1-b*b,q=Math.sqrt(f));r=1-g.e2*f;f=g.a/Math.sqrt(r);g=g.a6*f;f=p-f*b;l=d-g*q;d=b*f+q*l;p=b*l-q*f;g=p/(g/r+d);h+=g;0>c&&(h=-h);k[a++]=Z*e;k[a++]=Z*h;k[a]=d+p*g/2}function M(c,d,k,a){L(c,d,k,a);H(k,a,k,a)}function N(c,d,k,a){L(c,d,k,a);B(k,a,
k,a)}function Q(c,d,k){void 0===k&&(k=W());return R(c,d,k).projector}function R(c,d,k){if(k.source.spatialReference===c&&k.dest.spatialReference===d)return k;var a=z(c,k.source),g=z(d,k.dest);0===a&&0===g?c.equals(d)?k.projector=w:k.projector=null:k.projector=da[a][g];return k}function W(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:w}}var O,U,P,ba,V,T,X,Y;Object.defineProperty(b,"__esModule",
{value:!0});b.SphericalECEFSpatialReference=new d({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",\' + earthUtils.earthRadius + \',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});b.WGS84ECEFSpatialReference=new d({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});
b.canProject=function(c,d){return!!Q(c,d,ka)};b.getProjectorName=function(c,d){c=Q(c,d,ka);return c===w?"copy3":c===H?"wgs84ToSphericalECEF":c===B?"wgs84ToWebMercator":c===E?"wgs84ToWGS84ECEF":c===q?"webMercatorToWGS84":c===y?"webMercatorToSphericalECEF":c===A?"webMercatorToWGS84ECEF":c===L?"wgs84ECEFToWGS84":c===M?"wgs84ECEFToSphericalECEF":c===N?"wgs84ECEFToWebMercator":c===I?"sphericalECEFToWGS84":c===G?"sphericalECEFToWebMercator":c===J?"sphericalECEFToWGS84ECEF":null};b.vectorToVector=t;b.polygonToPolygon=
function(c,d,k,a){void 0===k&&(k=d.spatialReference);void 0===a&&(a=0);var g=[];if(!u(c.rings,c.hasZ,c.hasM,c.spatialReference,g,k,a))return!1;d.rings=g;d.spatialReference=k;d.hasZ=c.hasZ;d.hasM=c.hasM;return!0};b.polylineToPolyline=function(c,d,k,a){void 0===k&&(k=d.spatialReference);void 0===a&&(a=0);var g=[];if(!u(c.paths,c.hasZ,c.hasM,c.spatialReference,g,k,a))return!1;d.paths=g;d.spatialReference=k;d.hasZ=c.hasZ;d.hasM=c.hasM;return!0};b.multipointToMultipoint=function(c,d,k,a){void 0===k&&(k=
d.spatialReference);void 0===a&&(a=0);var g=[];if(!u([c.points],c.hasZ,c.hasM,c.spatialReference,g,k,a))return!1;d.points=g[0];d.spatialReference=k;d.hasZ=c.hasZ;d.hasM=c.hasM;return!0};b.pointToPoint=function(c,d,k,a){void 0===k&&(k=d.spatialReference);void 0===a&&(a=0);aa[0]=c.x;aa[1]=c.y;var g=c.z;aa[2]=void 0!==g?g:a;if(!v(aa,c.spatialReference,0,aa,k,0,1))return!1;d.x=aa[0];d.y=aa[1];d.spatialReference=k;void 0!==g?(d.z=aa[2],d.hasZ=!0):(d.z=void 0,d.hasZ=!1);return!0};b.pointToVector=function(c,
d,k,a){void 0===a&&(a=0);aa[0]=c.x;aa[1]=c.y;var g=c.z;aa[2]=void 0!==g?g:a;return v(aa,c.spatialReference,0,d,k,0,1)};b.vectorToPoint=function(c,d,a,g){a instanceof l?g=g||a.spatialReference:k.isPoint(a)?(a.hasZ=!0,g=g||a.spatialReference):(g=a,a=new l({spatialReference:g}));return v(c,d,0,aa,g,0,1)?(a.x=aa[0],a.y=aa[1],a.z=aa[2],a.spatialReference=g,a):null};b.xyzToVector=function(c,d,k,a,g,e){aa[0]=c;aa[1]=d;aa[2]=k;return v(aa,a,0,g,e,0,1)};b.bufferToBuffer=v;b.localLinearScaleFactors=function(c,
d,k,a){var g=z(d,fa),e=z(a,ga);if(g===e&&0!==g||d.equals(a))return k[0]=1,k[1]=1,k[2]=1,!0;if(1===g){d=f.vec3.length(c);c=d/Math.sqrt(c[0]*c[0]+c[1]*c[1]);d/=p.earthRadius;if(3===e)return k[0]=c*d,k[1]=c*d,k[2]=1,!0;if(2===e||5===e)return e=180/(p.earthRadius*Math.PI),k[0]=e*c*d,k[1]=e*d,k[2]=1,!0}return!1};b.computeLinearTransformation=function(c,d,k,a){var g=z(c,fa),f=z(a,ga);if(g===f&&1!==f&&(0!==g||c.equals(a)))return e.mat4.identity(k),e.mat4.translate(k,k,d),!0;if(1===f){c=da[g][6];f=da[6][f];
if(m.isNone(c)||m.isNone(f))return!1;c(d,0,na,0);f(na,0,ja,0);c=ia*na[0];f=ia*na[1];d=Math.sin(c);c=Math.cos(c);a=Math.sin(f);f=Math.cos(f);k[0]=-d;k[4]=-a*c;k[8]=f*c;k[12]=ja[0];k[1]=c;k[5]=-a*d;k[9]=f*d;k[13]=ja[1];k[2]=0;k[6]=f;k[10]=a;k[14]=ja[2];k[3]=0;k[7]=0;k[11]=0;k[15]=1;return!0}if(3===f&&(2===g||1===g)){c=da[g][6];if(m.isNone(c))return!1;c(d,0,na,0);d=ia*na[1];B(na,0,ja,0);e.mat4.identity(k);e.mat4.translate(k,k,ja);d=1/Math.cos(d);e.mat4.scale(k,k,[d,d,1]);return!0}return!1};b.transformDirection=
function(c,d,k,a,g){f.vec3.copy(ta,c);f.vec3.add(ra,c,d);t(ta,k,ta,g);t(ra,k,ra,g);f.vec3.subtract(a,ra,ta);f.vec3.normalize(a,a)};b.mbsToMbs=function(c,d,k,a){d=R(d,a,la);if(d.projector===w)return k[0]=c[0],k[1]=c[1],k[2]=c[2],k[3]=c[3],!0;if(m.isNone(d.projector))return!1;a=d.source;var g=d.dest;if(3===g.spatialReferenceId){d=da[a.spatialReferenceId][2];if(m.isNone(d))return!1;d(c,0,na,0);d=Math.abs(ia*na[1])+Math.asin(c[3]/(p.earthRadius+c[2]));B(na,0,k,0);k[3]=d>.9999*Math.PI?Number.MAX_VALUE:
1/Math.cos(d)*c[3];return!0}d.projector(c,0,k,0);k[3]=c[3]*a.metersPerUnit/g.metersPerUnit;return!0};b.extentToBoundingBox=function(c,d,k){if(null==c)return!1;var a;aa[0]=null!=c.xmin?c.xmin:0;aa[1]=null!=c.ymin?c.ymin:0;aa[2]=null!=c.zmin?c.zmin:0;a=v(aa,c.spatialReference,0,d,k,0,1);aa[0]=null!=c.xmax?c.xmax:0;aa[1]=null!=c.ymax?c.ymax:0;aa[2]=null!=c.zmax?c.zmax:0;a=a&&v(aa,c.spatialReference,0,d,k,3,1);null==c.xmin&&(d[0]=-Infinity);null==c.ymin&&(d[1]=-Infinity);null==c.zmin&&(d[2]=-Infinity);
null==c.xmax&&(d[3]=Infinity);null==c.ymax&&(d[4]=Infinity);null==c.zmax&&(d[5]=Infinity);return a};b.extentToBoundingRect=function(c,d,k){if(null==c)return!1;var a;aa[0]=null!=c.xmin?c.xmin:0;aa[1]=null!=c.ymin?c.ymin:0;aa[2]=null!=c.zmin?c.zmin:0;a=v(aa,c.spatialReference,0,aa,k,0,1);d[0]=aa[0];d[1]=aa[1];aa[0]=null!=c.xmax?c.xmax:0;aa[1]=null!=c.ymax?c.ymax:0;aa[2]=null!=c.zmax?c.zmax:0;a=a&&v(aa,c.spatialReference,0,aa,k,0,1);d[2]=aa[0];d[3]=aa[1];null==c.xmin&&(d[0]=-Infinity);null==c.ymin&&
(d[1]=-Infinity);null==c.xmax&&(d[2]=Infinity);null==c.ymax&&(d[3]=Infinity);return a};b.boundingRectToBoundingRect=function(d,k,a,g){if(null==d)return!1;if(k.equals(g))return c.set(a,d),!0;aa[0]=d[0];aa[1]=d[1];aa[2]=0;if(!v(aa,k,0,aa,g,0,1))return!1;a[0]=aa[0];a[1]=aa[1];aa[0]=d[2];aa[1]=d[3];aa[2]=0;if(!v(aa,k,0,aa,g,0,1))return!1;a[2]=aa[0];a[3]=aa[1];return!0};(function(c){c.x2lon=function(c){return c/p.earthRadius};c.y2lat=function(c){return Math.PI/2-2*Math.atan(Math.exp(-1*c/p.earthRadius))};
c.lon2x=function(c){return c*p.earthRadius};c.lat2y=function(c){c=Math.sin(c);return p.earthRadius/2*Math.log((1+c)/(1-c))}})(b.webMercator||(b.webMercator={}));b.canProjectToWGS84ComparableLonLat=function(c){c=z(c,fa);return!!da[c][6]};b.vectorToWGS84ComparableLonLat=C;b.pointToWGS84ComparableLonLat=F;b.pointToWGS84ComparableLonLatPoint=function(c,d){var k=z(d.spatialReference,ga);return m.isNone(da[6][k])?!1:F(c,aa)?(d.x=aa[0],d.y=aa[1],d.z=aa[2],!0):!1};b.wgs84ComparableLonLatToECEF=function(c,
d,k,a){void 0===a&&(a=0);a=p.earthRadius+a;var g=Math.cos(k);c[0]=Math.cos(d)*g*a;c[1]=Math.sin(d)*g*a;c[2]=Math.sin(k)*a};var da=(O={},O[2]=(U={},U[5]=null,U[6]=w,U[1]=H,U[0]=null,U[3]=B,U[2]=w,U[4]=E,U),O[5]=(P={},P[5]=w,P[6]=w,P[1]=H,P[0]=null,P[3]=null,P[2]=null,P[4]=E,P),O[3]=(ba={},ba[5]=null,ba[6]=q,ba[1]=y,ba[0]=null,ba[3]=w,ba[2]=q,ba[4]=A,ba),O[4]=(V={},V[5]=L,V[6]=L,V[1]=M,V[0]=null,V[3]=N,V[2]=L,V[4]=w,V),O[1]=(T={},T[5]=I,T[6]=I,T[1]=w,T[0]=null,T[3]=G,T[2]=I,T[4]=J,T),O[0]=(X={},X[5]=
null,X[6]=null,X[1]=null,X[0]=w,X[3]=null,X[2]=null,X[4]=null,X),O[6]=(Y={},Y[5]=null,Y[6]=w,Y[1]=H,Y[0]=null,Y[3]=null,Y[2]=w,Y[4]=E,Y),O);b.getProjector=Q;var fa={spatialReference:null,spatialReferenceId:0},ga={spatialReference:null,spatialReferenceId:0},ka=W(),la=W(),ia=a.deg2rad(1),Z=a.rad2deg(1),oa={a:6378137,e2:.006694379990137799,a1:42697.67270715754,a2:1.8230912546075456E9,a3:142.91722289812412,a4:4.557728136518864E9,a5:42840.589930055656,a6:.9933056200098622},aa=g.vec3f64.create(),na=g.vec3f64.create(),
ja=g.vec3f64.create(),ta=g.vec3f64.create(),ra=g.vec3f64.create()})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["require","exports","./math/mat4"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.mat4=a})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["require","exports","../factories/vec3f64","./common"],function(n,b,a,m){function h(d){d[0]=1;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=1;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=1;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d}
function e(d,c,k){var a=c[0],g=c[1],e=c[2],f=c[3],l=c[4],b=c[5],h=c[6],q=c[7],m=c[8],A=c[9],B=c[10],C=c[11],F=c[12],H=c[13],I=c[14];c=c[15];var G=k[0],J=k[1],E=k[2],L=k[3];d[0]=G*a+J*l+E*m+L*F;d[1]=G*g+J*b+E*A+L*H;d[2]=G*e+J*h+E*B+L*I;d[3]=G*f+J*q+E*C+L*c;G=k[4];J=k[5];E=k[6];L=k[7];d[4]=G*a+J*l+E*m+L*F;d[5]=G*g+J*b+E*A+L*H;d[6]=G*e+J*h+E*B+L*I;d[7]=G*f+J*q+E*C+L*c;G=k[8];J=k[9];E=k[10];L=k[11];d[8]=G*a+J*l+E*m+L*F;d[9]=G*g+J*b+E*A+L*H;d[10]=G*e+J*h+E*B+L*I;d[11]=G*f+J*q+E*C+L*c;G=k[12];J=k[13];E=
k[14];L=k[15];d[12]=G*a+J*l+E*m+L*F;d[13]=G*g+J*b+E*A+L*H;d[14]=G*e+J*h+E*B+L*I;d[15]=G*f+J*q+E*C+L*c;return d}function f(d,c,k){var a=c[0],g=c[1],e=c[2],f=c[3],l=a+a,b=g+g,h=e+e;c=a*l;var q=a*b,a=a*h,m=g*b,g=g*h,e=e*h,l=f*l,b=f*b,f=f*h;d[0]=1-(m+e);d[1]=q+f;d[2]=a-b;d[3]=0;d[4]=q-f;d[5]=1-(c+e);d[6]=g+l;d[7]=0;d[8]=a+b;d[9]=g-l;d[10]=1-(c+m);d[11]=0;d[12]=k[0];d[13]=k[1];d[14]=k[2];d[15]=1;return d}function g(d,c,k){d[0]=c[0]-k[0];d[1]=c[1]-k[1];d[2]=c[2]-k[2];d[3]=c[3]-k[3];d[4]=c[4]-k[4];d[5]=
c[5]-k[5];d[6]=c[6]-k[6];d[7]=c[7]-k[7];d[8]=c[8]-k[8];d[9]=c[9]-k[9];d[10]=c[10]-k[10];d[11]=c[11]-k[11];d[12]=c[12]-k[12];d[13]=c[13]-k[13];d[14]=c[14]-k[14];d[15]=c[15]-k[15];return d}Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(d,c){d[0]=c[0];d[1]=c[1];d[2]=c[2];d[3]=c[3];d[4]=c[4];d[5]=c[5];d[6]=c[6];d[7]=c[7];d[8]=c[8];d[9]=c[9];d[10]=c[10];d[11]=c[11];d[12]=c[12];d[13]=c[13];d[14]=c[14];d[15]=c[15];return d};b.set=function(d,c,k,a,g,e,f,l,b,h,q,m,A,B,C,F,H){d[0]=c;d[1]=
k;d[2]=a;d[3]=g;d[4]=e;d[5]=f;d[6]=l;d[7]=b;d[8]=h;d[9]=q;d[10]=m;d[11]=A;d[12]=B;d[13]=C;d[14]=F;d[15]=H;return d};b.identity=h;b.transpose=function(d,c){if(d===c){var k=c[1],a=c[2],g=c[3],e=c[6],f=c[7],l=c[11];d[1]=c[4];d[2]=c[8];d[3]=c[12];d[4]=k;d[6]=c[9];d[7]=c[13];d[8]=a;d[9]=e;d[11]=c[14];d[12]=g;d[13]=f;d[14]=l}else d[0]=c[0],d[1]=c[4],d[2]=c[8],d[3]=c[12],d[4]=c[1],d[5]=c[5],d[6]=c[9],d[7]=c[13],d[8]=c[2],d[9]=c[6],d[10]=c[10],d[11]=c[14],d[12]=c[3],d[13]=c[7],d[14]=c[11],d[15]=c[15];return d};
b.invert=function(d,c){var k=c[0],a=c[1],g=c[2],e=c[3],f=c[4],l=c[5],b=c[6],h=c[7],q=c[8],m=c[9],A=c[10],B=c[11],C=c[12],F=c[13],H=c[14];c=c[15];var I=k*l-a*f,G=k*b-g*f,J=k*h-e*f,E=a*b-g*l,L=a*h-e*l,M=g*h-e*b,N=q*F-m*C,Q=q*H-A*C,R=q*c-B*C,n=m*H-A*F,O=m*c-B*F,U=A*c-B*H,P=I*U-G*O+J*n+E*R-L*Q+M*N;if(!P)return null;P=1/P;d[0]=(l*U-b*O+h*n)*P;d[1]=(g*O-a*U-e*n)*P;d[2]=(F*M-H*L+c*E)*P;d[3]=(A*L-m*M-B*E)*P;d[4]=(b*R-f*U-h*Q)*P;d[5]=(k*U-g*R+e*Q)*P;d[6]=(H*J-C*M-c*G)*P;d[7]=(q*M-A*J+B*G)*P;d[8]=(f*O-l*R+
h*N)*P;d[9]=(a*R-k*O-e*N)*P;d[10]=(C*L-F*J+c*I)*P;d[11]=(m*J-q*L-B*I)*P;d[12]=(l*Q-f*n-b*N)*P;d[13]=(k*n-a*Q+g*N)*P;d[14]=(F*G-C*E-H*I)*P;d[15]=(q*E-m*G+A*I)*P;return d};b.adjoint=function(d,c){var k=c[0],a=c[1],g=c[2],e=c[3],f=c[4],l=c[5],b=c[6],h=c[7],q=c[8],m=c[9],A=c[10],B=c[11],C=c[12],F=c[13],H=c[14];c=c[15];d[0]=l*(A*c-B*H)-m*(b*c-h*H)+F*(b*B-h*A);d[1]=-(a*(A*c-B*H)-m*(g*c-e*H)+F*(g*B-e*A));d[2]=a*(b*c-h*H)-l*(g*c-e*H)+F*(g*h-e*b);d[3]=-(a*(b*B-h*A)-l*(g*B-e*A)+m*(g*h-e*b));d[4]=-(f*(A*c-B*
H)-q*(b*c-h*H)+C*(b*B-h*A));d[5]=k*(A*c-B*H)-q*(g*c-e*H)+C*(g*B-e*A);d[6]=-(k*(b*c-h*H)-f*(g*c-e*H)+C*(g*h-e*b));d[7]=k*(b*B-h*A)-f*(g*B-e*A)+q*(g*h-e*b);d[8]=f*(m*c-B*F)-q*(l*c-h*F)+C*(l*B-h*m);d[9]=-(k*(m*c-B*F)-q*(a*c-e*F)+C*(a*B-e*m));d[10]=k*(l*c-h*F)-f*(a*c-e*F)+C*(a*h-e*l);d[11]=-(k*(l*B-h*m)-f*(a*B-e*m)+q*(a*h-e*l));d[12]=-(f*(m*H-A*F)-q*(l*H-b*F)+C*(l*A-b*m));d[13]=k*(m*H-A*F)-q*(a*H-g*F)+C*(a*A-g*m);d[14]=-(k*(l*H-b*F)-f*(a*H-g*F)+C*(a*b-g*l));d[15]=k*(l*A-b*m)-f*(a*A-g*m)+q*(a*b-g*l);return d};
b.determinant=function(d){var c=d[0],k=d[1],a=d[2],g=d[3],e=d[4],f=d[5],l=d[6],b=d[7],h=d[8],q=d[9],m=d[10],A=d[11],B=d[12],C=d[13],F=d[14];d=d[15];return(c*f-k*e)*(m*d-A*F)-(c*l-a*e)*(q*d-A*C)+(c*b-g*e)*(q*F-m*C)+(k*l-a*f)*(h*d-A*B)-(k*b-g*f)*(h*F-m*B)+(a*b-g*l)*(h*C-q*B)};b.multiply=e;b.translate=function(d,c,k){var a=k[0],g=k[1];k=k[2];var e=void 0,f=void 0,l=void 0,b=void 0,h=void 0,q=void 0,m=void 0,A=void 0,B=void 0,C=void 0,F=void 0,H=void 0;c===d?(d[12]=c[0]*a+c[4]*g+c[8]*k+c[12],d[13]=c[1]*
a+c[5]*g+c[9]*k+c[13],d[14]=c[2]*a+c[6]*g+c[10]*k+c[14],d[15]=c[3]*a+c[7]*g+c[11]*k+c[15]):(e=c[0],f=c[1],l=c[2],b=c[3],h=c[4],q=c[5],m=c[6],A=c[7],B=c[8],C=c[9],F=c[10],H=c[11],d[0]=e,d[1]=f,d[2]=l,d[3]=b,d[4]=h,d[5]=q,d[6]=m,d[7]=A,d[8]=B,d[9]=C,d[10]=F,d[11]=H,d[12]=e*a+h*g+B*k+c[12],d[13]=f*a+q*g+C*k+c[13],d[14]=l*a+m*g+F*k+c[14],d[15]=b*a+A*g+H*k+c[15]);return d};b.scale=function(d,c,k){var a=k[0],g=k[1];k=k[2];d[0]=c[0]*a;d[1]=c[1]*a;d[2]=c[2]*a;d[3]=c[3]*a;d[4]=c[4]*g;d[5]=c[5]*g;d[6]=c[6]*
g;d[7]=c[7]*g;d[8]=c[8]*k;d[9]=c[9]*k;d[10]=c[10]*k;d[11]=c[11]*k;d[12]=c[12];d[13]=c[13];d[14]=c[14];d[15]=c[15];return d};b.rotate=function(d,c,k,a){var g=a[0],e=a[1];a=a[2];var f=Math.sqrt(g*g+e*e+a*a),l=void 0,p=void 0,b=void 0,h=void 0,y=void 0,A=void 0,B=void 0,C=void 0,F=void 0,H=void 0,I=void 0,G=void 0,J=void 0,E=void 0,L=void 0,M=void 0,N=void 0,Q=void 0,R=void 0,n=void 0,O=void 0,U=void 0,p=l=void 0;if(f<m.EPSILON)return null;f=1/f;g*=f;e*=f;a*=f;l=Math.sin(k);p=Math.cos(k);b=1-p;h=c[0];
y=c[1];A=c[2];B=c[3];C=c[4];F=c[5];H=c[6];I=c[7];G=c[8];J=c[9];E=c[10];L=c[11];M=g*g*b+p;N=e*g*b+a*l;Q=a*g*b-e*l;R=g*e*b-a*l;n=e*e*b+p;O=a*e*b+g*l;U=g*a*b+e*l;l=e*a*b-g*l;p=a*a*b+p;d[0]=h*M+C*N+G*Q;d[1]=y*M+F*N+J*Q;d[2]=A*M+H*N+E*Q;d[3]=B*M+I*N+L*Q;d[4]=h*R+C*n+G*O;d[5]=y*R+F*n+J*O;d[6]=A*R+H*n+E*O;d[7]=B*R+I*n+L*O;d[8]=h*U+C*l+G*p;d[9]=y*U+F*l+J*p;d[10]=A*U+H*l+E*p;d[11]=B*U+I*l+L*p;c!==d&&(d[12]=c[12],d[13]=c[13],d[14]=c[14],d[15]=c[15]);return d};b.rotateX=function(d,c,k){var a=Math.sin(k);k=Math.cos(k);
var g=c[4],e=c[5],f=c[6],l=c[7],b=c[8],h=c[9],q=c[10],m=c[11];c!==d&&(d[0]=c[0],d[1]=c[1],d[2]=c[2],d[3]=c[3],d[12]=c[12],d[13]=c[13],d[14]=c[14],d[15]=c[15]);d[4]=g*k+b*a;d[5]=e*k+h*a;d[6]=f*k+q*a;d[7]=l*k+m*a;d[8]=b*k-g*a;d[9]=h*k-e*a;d[10]=q*k-f*a;d[11]=m*k-l*a;return d};b.rotateY=function(d,c,k){var a=Math.sin(k);k=Math.cos(k);var g=c[0],e=c[1],f=c[2],l=c[3],b=c[8],h=c[9],q=c[10],m=c[11];c!==d&&(d[4]=c[4],d[5]=c[5],d[6]=c[6],d[7]=c[7],d[12]=c[12],d[13]=c[13],d[14]=c[14],d[15]=c[15]);d[0]=g*k-
b*a;d[1]=e*k-h*a;d[2]=f*k-q*a;d[3]=l*k-m*a;d[8]=g*a+b*k;d[9]=e*a+h*k;d[10]=f*a+q*k;d[11]=l*a+m*k;return d};b.rotateZ=function(d,c,k){var a=Math.sin(k);k=Math.cos(k);var g=c[0],e=c[1],f=c[2],l=c[3],b=c[4],h=c[5],q=c[6],m=c[7];c!==d&&(d[8]=c[8],d[9]=c[9],d[10]=c[10],d[11]=c[11],d[12]=c[12],d[13]=c[13],d[14]=c[14],d[15]=c[15]);d[0]=g*k+b*a;d[1]=e*k+h*a;d[2]=f*k+q*a;d[3]=l*k+m*a;d[4]=b*k-g*a;d[5]=h*k-e*a;d[6]=q*k-f*a;d[7]=m*k-l*a;return d};b.fromTranslation=function(d,c){d[0]=1;d[1]=0;d[2]=0;d[3]=0;d[4]=
0;d[5]=1;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=1;d[11]=0;d[12]=c[0];d[13]=c[1];d[14]=c[2];d[15]=1;return d};b.fromScaling=function(d,c){d[0]=c[0];d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=c[1];d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=c[2];d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};b.fromRotation=function(d,c,k){var a=k[0],g=k[1];k=k[2];var e=Math.sqrt(a*a+g*g+k*k),f=void 0,l=void 0,b=void 0;if(e<m.EPSILON)return null;e=1/e;a*=e;g*=e;k*=e;f=Math.sin(c);l=Math.cos(c);b=1-l;d[0]=a*a*b+l;d[1]=g*a*b+k*f;d[2]=k*a*b-
g*f;d[3]=0;d[4]=a*g*b-k*f;d[5]=g*g*b+l;d[6]=k*g*b+a*f;d[7]=0;d[8]=a*k*b+g*f;d[9]=g*k*b-a*f;d[10]=k*k*b+l;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};b.fromXRotation=function(d,c){var k=Math.sin(c);c=Math.cos(c);d[0]=1;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=c;d[6]=k;d[7]=0;d[8]=0;d[9]=-k;d[10]=c;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};b.fromYRotation=function(d,c){var k=Math.sin(c);c=Math.cos(c);d[0]=c;d[1]=0;d[2]=-k;d[3]=0;d[4]=0;d[5]=1;d[6]=0;d[7]=0;d[8]=k;d[9]=0;d[10]=c;d[11]=0;d[12]=
0;d[13]=0;d[14]=0;d[15]=1;return d};b.fromZRotation=function(d,c){var k=Math.sin(c);c=Math.cos(c);d[0]=c;d[1]=k;d[2]=0;d[3]=0;d[4]=-k;d[5]=c;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=1;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};b.fromRotationTranslation=f;b.fromQuat2=function(d,c){var k=l,a=-c[0],g=-c[1],e=-c[2],b=c[3],h=c[4],m=c[5],w=c[6],q=c[7],y=a*a+g*g+e*e+b*b;0<y?(k[0]=2*(h*b+q*a+m*e-w*g)/y,k[1]=2*(m*b+q*g+w*a-h*e)/y,k[2]=2*(w*b+q*e+h*g-m*a)/y):(k[0]=2*(h*b+q*a+m*e-w*g),k[1]=2*(m*b+q*g+w*a-h*
e),k[2]=2*(w*b+q*e+h*g-m*a));f(d,c,k);return d};var l=a.create();b.getTranslation=function(d,c){d[0]=c[12];d[1]=c[13];d[2]=c[14];return d};b.getScaling=function(d,c){var k=c[0],a=c[1],g=c[2],e=c[4],f=c[5],l=c[6],b=c[8],h=c[9];c=c[10];d[0]=Math.sqrt(k*k+a*a+g*g);d[1]=Math.sqrt(e*e+f*f+l*l);d[2]=Math.sqrt(b*b+h*h+c*c);return d};b.getRotation=function(d,c){var k=c[0]+c[5]+c[10],a=0;0<k?(a=2*Math.sqrt(k+1),d[3]=.25*a,d[0]=(c[6]-c[9])/a,d[1]=(c[8]-c[2])/a,d[2]=(c[1]-c[4])/a):c[0]>c[5]&&c[0]>c[10]?(a=2*
Math.sqrt(1+c[0]-c[5]-c[10]),d[3]=(c[6]-c[9])/a,d[0]=.25*a,d[1]=(c[1]+c[4])/a,d[2]=(c[8]+c[2])/a):c[5]>c[10]?(a=2*Math.sqrt(1+c[5]-c[0]-c[10]),d[3]=(c[8]-c[2])/a,d[0]=(c[1]+c[4])/a,d[1]=.25*a,d[2]=(c[6]+c[9])/a):(a=2*Math.sqrt(1+c[10]-c[0]-c[5]),d[3]=(c[1]-c[4])/a,d[0]=(c[8]+c[2])/a,d[1]=(c[6]+c[9])/a,d[2]=.25*a);return d};b.fromRotationTranslationScale=function(d,c,k,a){var g=c[0],e=c[1],f=c[2],l=c[3],b=g+g,p=e+e,h=f+f;c=g*b;var m=g*p,g=g*h,A=e*p,e=e*h,f=f*h,b=l*b,p=l*p,l=l*h,h=a[0],B=a[1];a=a[2];
d[0]=(1-(A+f))*h;d[1]=(m+l)*h;d[2]=(g-p)*h;d[3]=0;d[4]=(m-l)*B;d[5]=(1-(c+f))*B;d[6]=(e+b)*B;d[7]=0;d[8]=(g+p)*a;d[9]=(e-b)*a;d[10]=(1-(c+A))*a;d[11]=0;d[12]=k[0];d[13]=k[1];d[14]=k[2];d[15]=1;return d};b.fromRotationTranslationScaleOrigin=function(d,c,k,a,g){var e=c[0],f=c[1],l=c[2],b=c[3],p=e+e,h=f+f,r=l+l;c=e*p;var m=e*h,B=e*r,e=f*h,f=f*r,C=l*r,l=b*p,h=b*h,F=b*r,H=a[0],I=a[1],r=a[2];a=g[0];b=g[1];g=g[2];var p=(1-(e+C))*H,G=(m+F)*H,H=(B-h)*H,m=(m-F)*I,C=(1-(c+C))*I,I=(f+l)*I,B=(B+h)*r,f=(f-l)*r;
c=(1-(c+e))*r;d[0]=p;d[1]=G;d[2]=H;d[3]=0;d[4]=m;d[5]=C;d[6]=I;d[7]=0;d[8]=B;d[9]=f;d[10]=c;d[11]=0;d[12]=k[0]+a-(p*a+m*b+B*g);d[13]=k[1]+b-(G*a+C*b+f*g);d[14]=k[2]+g-(H*a+I*b+c*g);d[15]=1;return d};b.fromQuat=function(d,c){var k=c[0],a=c[1],g=c[2];c=c[3];var e=k+k,f=a+a,l=g+g,k=k*e,b=a*e,a=a*f,h=g*e,q=g*f,g=g*l,e=c*e,f=c*f;c*=l;d[0]=1-a-g;d[1]=b+c;d[2]=h-f;d[3]=0;d[4]=b-c;d[5]=1-k-g;d[6]=q+e;d[7]=0;d[8]=h+f;d[9]=q-e;d[10]=1-k-a;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};b.frustum=function(d,
c,k,a,g,e,f){var l=1/(k-c),b=1/(g-a),p=1/(e-f);d[0]=2*e*l;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=2*e*b;d[6]=0;d[7]=0;d[8]=(k+c)*l;d[9]=(g+a)*b;d[10]=(f+e)*p;d[11]=-1;d[12]=0;d[13]=0;d[14]=f*e*2*p;d[15]=0;return d};b.perspective=function(d,c,k,a,g){c=1/Math.tan(c/2);var e=void 0;d[0]=c/k;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=c;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[11]=-1;d[12]=0;d[13]=0;d[15]=0;null!=g&&Infinity!==g?(e=1/(a-g),d[10]=(g+a)*e,d[14]=2*g*a*e):(d[10]=-1,d[14]=-2*a);return d};b.perspectiveFromFieldOfView=
function(d,c,k,a){var g=Math.tan(c.upDegrees*Math.PI/180),e=Math.tan(c.downDegrees*Math.PI/180),f=Math.tan(c.leftDegrees*Math.PI/180);c=Math.tan(c.rightDegrees*Math.PI/180);var l=2/(f+c),b=2/(g+e);d[0]=l;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=b;d[6]=0;d[7]=0;d[8]=-((f-c)*l*.5);d[9]=(g-e)*b*.5;d[10]=a/(k-a);d[11]=-1;d[12]=0;d[13]=0;d[14]=a*k/(k-a);d[15]=0;return d};b.ortho=function(d,c,k,a,g,e,f){var l=1/(c-k),b=1/(a-g),p=1/(e-f);d[0]=-2*l;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=-2*b;d[6]=0;d[7]=0;d[8]=0;d[9]=
0;d[10]=2*p;d[11]=0;d[12]=(c+k)*l;d[13]=(g+a)*b;d[14]=(f+e)*p;d[15]=1;return d};b.lookAt=function(d,c,k,a){var g=void 0,e=void 0,f=void 0,l=void 0,b=void 0,p=void 0,q=void 0,y=void 0,A=void 0,B=void 0,C=c[0],F=c[1];c=c[2];f=a[0];l=a[1];a=a[2];q=k[0];y=k[1];k=k[2];if(Math.abs(C-q)<m.EPSILON&&Math.abs(F-y)<m.EPSILON&&Math.abs(c-k)<m.EPSILON)return h(d);q=C-q;y=F-y;A=c-k;B=1/Math.sqrt(q*q+y*y+A*A);q*=B;y*=B;A*=B;g=l*A-a*y;e=a*q-f*A;f=f*y-l*q;(B=Math.sqrt(g*g+e*e+f*f))?(B=1/B,g*=B,e*=B,f*=B):f=e=g=0;
l=y*f-A*e;b=A*g-q*f;p=q*e-y*g;(B=Math.sqrt(l*l+b*b+p*p))?(B=1/B,l*=B,b*=B,p*=B):p=b=l=0;d[0]=g;d[1]=l;d[2]=q;d[3]=0;d[4]=e;d[5]=b;d[6]=y;d[7]=0;d[8]=f;d[9]=p;d[10]=A;d[11]=0;d[12]=-(g*C+e*F+f*c);d[13]=-(l*C+b*F+p*c);d[14]=-(q*C+y*F+A*c);d[15]=1;return d};b.targetTo=function(d,c,k,a){var g=c[0],e=c[1];c=c[2];var f=a[0],l=a[1],b=a[2];a=g-k[0];var p=e-k[1];k=c-k[2];var h=a*a+p*p+k*k;0<h&&(h=1/Math.sqrt(h),a*=h,p*=h,k*=h);var m=l*k-b*p,b=b*a-f*k,f=f*p-l*a,h=m*m+b*b+f*f;0<h&&(h=1/Math.sqrt(h),m*=h,b*=
h,f*=h);d[0]=m;d[1]=b;d[2]=f;d[3]=0;d[4]=p*f-k*b;d[5]=k*m-a*f;d[6]=a*b-p*m;d[7]=0;d[8]=a;d[9]=p;d[10]=k;d[11]=0;d[12]=g;d[13]=e;d[14]=c;d[15]=1;return d};b.str=function(d){return"mat4("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+", "+d[4]+", "+d[5]+", "+d[6]+", "+d[7]+", "+d[8]+", "+d[9]+", "+d[10]+", "+d[11]+", "+d[12]+", "+d[13]+", "+d[14]+", "+d[15]+")"};b.frob=function(d){return Math.sqrt(Math.pow(d[0],2)+Math.pow(d[1],2)+Math.pow(d[2],2)+Math.pow(d[3],2)+Math.pow(d[4],2)+Math.pow(d[5],2)+Math.pow(d[6],
2)+Math.pow(d[7],2)+Math.pow(d[8],2)+Math.pow(d[9],2)+Math.pow(d[10],2)+Math.pow(d[11],2)+Math.pow(d[12],2)+Math.pow(d[13],2)+Math.pow(d[14],2)+Math.pow(d[15],2))};b.add=function(d,c,a){d[0]=c[0]+a[0];d[1]=c[1]+a[1];d[2]=c[2]+a[2];d[3]=c[3]+a[3];d[4]=c[4]+a[4];d[5]=c[5]+a[5];d[6]=c[6]+a[6];d[7]=c[7]+a[7];d[8]=c[8]+a[8];d[9]=c[9]+a[9];d[10]=c[10]+a[10];d[11]=c[11]+a[11];d[12]=c[12]+a[12];d[13]=c[13]+a[13];d[14]=c[14]+a[14];d[15]=c[15]+a[15];return d};b.subtract=g;b.multiplyScalar=function(d,c,a){d[0]=
c[0]*a;d[1]=c[1]*a;d[2]=c[2]*a;d[3]=c[3]*a;d[4]=c[4]*a;d[5]=c[5]*a;d[6]=c[6]*a;d[7]=c[7]*a;d[8]=c[8]*a;d[9]=c[9]*a;d[10]=c[10]*a;d[11]=c[11]*a;d[12]=c[12]*a;d[13]=c[13]*a;d[14]=c[14]*a;d[15]=c[15]*a;return d};b.multiplyScalarAndAdd=function(d,c,a,g){d[0]=c[0]+a[0]*g;d[1]=c[1]+a[1]*g;d[2]=c[2]+a[2]*g;d[3]=c[3]+a[3]*g;d[4]=c[4]+a[4]*g;d[5]=c[5]+a[5]*g;d[6]=c[6]+a[6]*g;d[7]=c[7]+a[7]*g;d[8]=c[8]+a[8]*g;d[9]=c[9]+a[9]*g;d[10]=c[10]+a[10]*g;d[11]=c[11]+a[11]*g;d[12]=c[12]+a[12]*g;d[13]=c[13]+a[13]*g;d[14]=
c[14]+a[14]*g;d[15]=c[15]+a[15]*g;return d};b.exactEquals=function(d,c){return d[0]===c[0]&&d[1]===c[1]&&d[2]===c[2]&&d[3]===c[3]&&d[4]===c[4]&&d[5]===c[5]&&d[6]===c[6]&&d[7]===c[7]&&d[8]===c[8]&&d[9]===c[9]&&d[10]===c[10]&&d[11]===c[11]&&d[12]===c[12]&&d[13]===c[13]&&d[14]===c[14]&&d[15]===c[15]};b.equals=function(d,c){var a=d[0],g=d[1],e=d[2],f=d[3],l=d[4],b=d[5],h=d[6],w=d[7],q=d[8],y=d[9],A=d[10],B=d[11],C=d[12],F=d[13],H=d[14];d=d[15];var I=c[0],G=c[1],J=c[2],E=c[3],L=c[4],M=c[5],N=c[6],Q=c[7],
R=c[8],n=c[9],O=c[10],U=c[11],P=c[12],ba=c[13],V=c[14];c=c[15];return Math.abs(a-I)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(I))&&Math.abs(g-G)<=m.EPSILON*Math.max(1,Math.abs(g),Math.abs(G))&&Math.abs(e-J)<=m.EPSILON*Math.max(1,Math.abs(e),Math.abs(J))&&Math.abs(f-E)<=m.EPSILON*Math.max(1,Math.abs(f),Math.abs(E))&&Math.abs(l-L)<=m.EPSILON*Math.max(1,Math.abs(l),Math.abs(L))&&Math.abs(b-M)<=m.EPSILON*Math.max(1,Math.abs(b),Math.abs(M))&&Math.abs(h-N)<=m.EPSILON*Math.max(1,Math.abs(h),Math.abs(N))&&
Math.abs(w-Q)<=m.EPSILON*Math.max(1,Math.abs(w),Math.abs(Q))&&Math.abs(q-R)<=m.EPSILON*Math.max(1,Math.abs(q),Math.abs(R))&&Math.abs(y-n)<=m.EPSILON*Math.max(1,Math.abs(y),Math.abs(n))&&Math.abs(A-O)<=m.EPSILON*Math.max(1,Math.abs(A),Math.abs(O))&&Math.abs(B-U)<=m.EPSILON*Math.max(1,Math.abs(B),Math.abs(U))&&Math.abs(C-P)<=m.EPSILON*Math.max(1,Math.abs(C),Math.abs(P))&&Math.abs(F-ba)<=m.EPSILON*Math.max(1,Math.abs(F),Math.abs(ba))&&Math.abs(H-V)<=m.EPSILON*Math.max(1,Math.abs(H),Math.abs(V))&&Math.abs(d-
c)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(c))};b.mul=e;b.sub=g})},"esri/views/3d/support/earthUtils":function(){define("require exports ../../../core/mathUtils ../../../core/wgs84Constants ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ./projectionUtils".split(" "),function(n,b,a,m,h,e,f,g){function l(c,d,k,g){var e,l;c instanceof f&&d instanceof f&&(k=d.longitude,g=d.latitude,l=c.latitude,e=c.longitude);c=a.deg2rad(l);g=a.deg2rad(g);e=a.deg2rad(e);
d=a.deg2rad(k);k=Math.sin((c-g)/2);e=Math.sin((e-d)/2);k=2*a.asinClamped(Math.sqrt(k*k+Math.cos(c)*Math.cos(g)*e*e))*b.earthRadius;return Math.round(1E4*k)/1E4}function d(c,d){c/=15;d||(c=Math.round(c));return c}Object.defineProperty(b,"__esModule",{value:!0});b.earthRadius=m.wgs84Radius;b.halfEarthRadius=b.earthRadius/2;b.halfEarthCircumference=Math.PI*b.earthRadius;b.earthCircumference=2*b.halfEarthCircumference;b.metersPerDegree=b.halfEarthCircumference/180;b.getGreatCircleDistance=l;b.getGreatCircleSpanAt=
function(c,d,a){var k=d.spatialReference,g=new f(d.x,c.y,k),e=new f(a.x,c.y,k);d=new f(c.x,d.y,k);c=new f(c.x,a.y,k);return{lon:l(g,e),lat:l(d,c)}};b.getLonDeltaForDistance=function(c,d){d/=b.earthRadius;c=a.deg2rad(c);d=Math.sin(d/2);c=Math.cos(c);c=2*a.asinClamped(Math.sqrt(d*d/(c*c)));return a.rad2deg(c)};b.getLatDeltaForDistance=function(c){return a.rad2deg(c/b.earthRadius)};b.getMaxCameraAltitude=function(c){c=a.deg2rad(c/2);return(1-Math.sin(c))*b.earthRadius/Math.sin(c)};b.getViewExtentDistance=
function(c,d){d=a.deg2rad(d/2);return 2*a.acosClamped((Math.pow(c+b.earthRadius,2)+Math.pow(b.earthRadius,2)-Math.pow((c+b.earthRadius)*Math.cos(d)-Math.sqrt(Math.pow(Math.cos(d)*(c+b.earthRadius),2)-c*c-2*c*b.earthRadius),2))/(2*(c+b.earthRadius)*b.earthRadius))*b.earthRadius};b.computeCartesianDistance=function(d,a){d=g.wgs84ComparableLonLatToECEF(c,d.longitude,d.latitude,d.z||0);a=g.wgs84ComparableLonLatToECEF(k,a.longitude,a.latitude,a.z||0);a=[a[0]-d[0],a[1]-d[1],a[2]-d[2]];return Math.sqrt(a[0]*
a[0]+a[1]*a[1]+a[2]*a[2])};b.longitudeToTimezone=d;b.positionToTimezone=function(c,a){a||(a={hours:0,minutes:0,seconds:0});a.hours=d(c[0],!0);c=a.hours%1;a.hours-=c;a.minutes=60*c;c=a.minutes%1;a.minutes-=c;a.seconds=Math.round(60*c);return a};b.distanceToIdealHorizon=function(c,d){d=d||b.earthRadius;c=h.vec3.dot(c,c);return Math.sqrt(Math.abs(c-d*d))};var c=e.vec3f64.create(),k=e.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["require","exports"],function(n,
b){Object.defineProperty(b,"__esModule",{value:!0});(function(a){a.length=function(a,b){var e=a[b],f=a[b+1];a=a[b+2];return Math.sqrt(e*e+f*f+a*a)};a.normalize=function(a,b){var e=a[b],f=a[b+1],g=a[b+2],e=1/Math.sqrt(e*e+f*f+g*g);a[b]*=e;a[b+1]*=e;a[b+2]*=e};a.scale=function(a,b,e){a[b]*=e;a[b+1]*=e;a[b+2]*=e};a.add=function(a,b,e,f,g,l){void 0===l&&(l=b);g=g||a;g[l]=a[b]+e[f];g[l+1]=a[b+1]+e[f+1];g[l+2]=a[b+2]+e[f+2]};a.subtract=function(a,b,e,f,g,l){void 0===l&&(l=b);g=g||a;g[l]=a[b]-e[f];g[l+1]=
a[b+1]-e[f+1];g[l+2]=a[b+2]-e[f+2]}})(b.Vec3Compact||(b.Vec3Compact={}))})},"esri/views/PopupView":function(){define("require exports tslib ../core/arrayUtils ../core/maybe ../core/promiseUtils ../core/accessorSupport/decorators".split(" "),function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});b.PopupView=function(g){return function(g){function d(){return null!==g&&g.apply(this,arguments)||this}a.__extends(d,g);d.prototype.fetchPopupFeatures=function(c,d){return a.__awaiter(this,
void 0,void 0,function(){var k,g,f,l,b,h,w,q,y;return a.__generator(this,function(p){switch(p.label){case 0:return[4,this.when()];case 1:return p.sent(),[4,this._prepareFetchPopupFeatures(c,d)];case 2:return k=p.sent(),g=k.location,f=k.queryArea,l=k.layerViewsAndGraphics,b=k.clientOnlyGraphics,h=e.resolve(b),w=this._queryLayerPopupFeatures({queryArea:f,layerViewsAndGraphics:l,options:d}),q=w.map(function(c){return c.promise}),y=e.eachAlwaysValues(a.__spreadArrays([h],q)).then(m.flatten),[2,{location:g,
clientOnlyGraphics:b,allGraphicsPromise:y,promisesPerLayerView:w}]}})})};d.prototype._queryLayerPopupFeatures=function(c){var d=c.queryArea,a=c.options;return c.layerViewsAndGraphics.map(function(c){var k=c.layerView;c={clientGraphics:c.graphics,event:h.isSome(a)?a.event:null,signal:h.isSome(a)?a.signal:null,defaultPopupTemplateEnabled:h.isSome(a)?!!a.defaultPopupTemplateEnabled:!1};c=k.fetchPopupFeatures(d,c);return{layerView:k,promise:c}})};d.prototype._isValidPopupGraphic=function(c,d){return c&&
!!c.getEffectivePopupTemplate(h.isSome(d)&&d.defaultPopupTemplateEnabled)};d.prototype._prepareFetchPopupFeatures=function(c,d){return a.__awaiter(this,void 0,void 0,function(){var k,g,e,f,l,b,h,q;return a.__generator(this,function(a){switch(a.label){case 0:return[4,this._popupHitTestGraphics(c,d)];case 1:return k=a.sent(),g=k.clientGraphics,e=k.queryArea,f=k.location,l=this._getFetchPopupLayerViews(),b=this._graphicsPerFetchPopupLayerView(g,l),h=b.layerViewsAndGraphics,q=b.clientOnlyGraphics,[2,
{clientOnlyGraphics:q,layerViewsAndGraphics:h,queryArea:e,location:f}]}})})};d.prototype._popupHitTestGraphics=function(c,d){return a.__awaiter(this,void 0,void 0,function(){var k,g,e,f,l,b,h=this;return a.__generator(this,function(a){switch(a.label){case 0:return[4,this.popupHitTest(c)];case 1:return k=a.sent(),g=k.results,e=k.mapPoint,f=g.filter(function(c){return h._isValidPopupGraphic(c.graphic,d)}),l=f.length?f[0].mapPoint:null,b=f.map(function(c){return c.graphic}),[2,{clientGraphics:b,queryArea:e,
location:e||l}]}})})};d.prototype._getFetchPopupLayerViews=function(){var c=this,d=[];this.allLayerViews.forEach(function(a){c._isValidPopupLayerView(a)&&d.push(a)});h.isSome(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&d.push(this.graphicsView);return d.reverse()};d.prototype._isValidPopupLayerView=function(c){return h.isSome(c)&&(!("layer"in c)||!c.suspended)&&"fetchPopupFeatures"in c};d.prototype._graphicsPerFetchPopupLayerView=function(c,d){var a=[],k=new Map;d=d.map(function(c){var d=
[];"layer"in c?k.set(c.layer,d):k.set(c.graphics,d);return{layerView:c,graphics:d}});for(var g=0;g<c.length;g++){var e=c[g],f=k.get(e.layer)||null;f?f.push(e):a.push(e)}return{layerViewsAndGraphics:d,clientOnlyGraphics:a}};return d=a.__decorate([f.subclass("esri.views.PopupView")],d)}(g)}})},"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error","../../core/maybe","@dojo/framework/shim/Promise"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});
var h=function(){return new Promise(function(a,d){n(["./layers/TileLayerView3D"],a,d)})},e=function(){return new Promise(function(a,d){n(["./layers/FeatureLayerView3D"],a,d)})},f=function(){return new Promise(function(a,d){n(["./layers/ElevationLayerView3D"],a,d)})},g={"base-dynamic":function(){return new Promise(function(a,d){n(["./layers/BaseDynamicLayerView3D"],a,d)})},"base-elevation":f,"base-tile":h,"bing-maps":h,"building-scene":function(){return new Promise(function(a,d){n(["./layers/BuildingSceneLayerView3D"],
a,d)})},csv:e,elevation:f,feature:e,geojson:e,graphics:function(){return new Promise(function(a,d){n(["./layers/GraphicsLayerView3D"],a,d)})},group:function(){return new Promise(function(a,d){n(["../layers/GroupLayerView"],a,d)})},imagery:function(){return new Promise(function(a,d){n(["./layers/ImageryLayerView3D"],a,d)})},"integrated-mesh":function(){return new Promise(function(a,d){n(["./layers/IntegratedMeshLayerView3D"],a,d)})},"map-image":function(){return new Promise(function(a,d){n(["./layers/MapImageLayerView3D"],
a,d)})},"ogc-feature":e,"open-street-map":h,"point-cloud":function(){return new Promise(function(a,d){n(["./layers/PointCloudLayerView3D"],a,d)})},scene:function(a){return null==a.profile||"mesh-pyramids"===a.profile?new Promise(function(d,c){n(["./layers/SceneLayerView3D"],d,c)}):new Promise(function(d,c){n(["./layers/SceneLayerGraphicsView3D"],d,c)})},stream:function(){return new Promise(function(a,d){n(["./layers/StreamLayerView3D"],a,d)})},tile:h,"imagery-tile":function(){return new Promise(function(a,
d){n(["./layers/ImageryTileLayerView3D"],a,d)})},"vector-tile":function(){return new Promise(function(a,d){n(["./layers/VectorTileLayerView3D"],a,d)})},"web-tile":h,wms:function(){return new Promise(function(a,d){n(["./layers/WMSLayerView3D"],a,d)})},wmts:function(){return new Promise(function(a,d){n(["./layers/WMTSLayerView3D"],a,d)})},"geo-rss":null,kml:null,"map-notes":null,route:null,unknown:null,unsupported:null};b.layerView3DImporter={hasLayerViewModule:function(a){return m.isSome(g[a.type])},
importLayerView:function(e){var d=g[e.type];if(!m.isSome(d))throw e=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",d=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),new a(d+":view-not-supported",e+" is not supported in 3D");return d(e)}}})},"esri/views/3d/constraints/Constraints":function(){define("require exports tslib ../../../core/Accessor ../../../core/accessorSupport/decorators ./AltitudeConstraint ./ClipDistanceConstraint ./CollisionConstraint ./TiltConstraint".split(" "),
function(n,b,a,m,h,e,f,g,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(d){function c(){var c=null!==d&&d.apply(this,arguments)||this;c.tilt=new l.default;c.altitude=new e.default;c.clipDistance=new f.default;c.collision=new g.default;return c}a.__extends(c,d);a.__decorate([h.property({type:l.default})],c.prototype,"tilt",void 0);a.__decorate([h.property({type:e.default})],c.prototype,"altitude",void 0);a.__decorate([h.property({type:f.default})],c.prototype,"clipDistance",void 0);
a.__decorate([h.property({type:g.default})],c.prototype,"collision",void 0);return c=a.__decorate([h.subclass("esri.views.3d.constraints.Constraints")],c)}(m);b.Constraints=n;b.default=n})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("require exports tslib ../../../core/Accessor ../../../core/deprecate ../../../core/Logger ../../../core/accessorSupport/decorators ../state/Constraints".split(" "),function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(l){function d(){var c=
null!==l&&l.apply(this,arguments)||this;c.min=g.AltitudeDefault.min;c.max=g.AltitudeDefault.max;return c}a.__extends(d,l);Object.defineProperty(d.prototype,"mode",{get:function(){h.deprecated(e.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"});return"manual"},set:function(c){h.deprecated(e.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",
{version:"4.6"})},enumerable:!0,configurable:!0});a.__decorate([f.property({type:Number})],d.prototype,"min",void 0);a.__decorate([f.property({type:Number})],d.prototype,"max",void 0);return d=a.__decorate([f.subclass("esri.views.3d.constraints.AltitudeConstraint")],d)}(m);b.AltitudeConstraint=n;b.default=n})},"esri/views/3d/state/Constraints":function(){define("require exports tslib ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/mathUtils ../../../core/accessorSupport/decorators ../support/earthUtils ../support/mathUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",{value:!0});var c=h.getLogger("esri.views.3d.state.Constraints");n=function(l){function h(c){c=l.call(this,c)||this;c.collision=new p;c.distance=Infinity;c.minimumPoiDistance=4;return c}a.__extends(h,l);Object.defineProperty(h.prototype,"altitude",{get:function(){return"local"===this.mode?null:this._get("altitude")||null},set:function(d){"local"===this.mode?c.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",
d)},enumerable:!0,configurable:!0});h.prototype.clampAltitude=function(c){return this.altitude?e.clamp(c,this.altitude.min,this.altitude.max):c};h.prototype.clampTilt=function(c,d){if(!this.tilt)return d;c=this.tilt(c);return e.clamp(d,c.min,c.max)};h.prototype.clampDistance=function(c){return Math.min(c,this.distance)};h.prototype.createDefaultTilt=function(){return"local"===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()};h.prototype.createConstantMaxTilt=function(c){return function(d,
a){void 0===a&&(a=k);a.min=b.TiltDefault.min;a.max=c;return a}};h.prototype.createDefaultTiltLocal=function(){var c=this.collision.enabled?d.makePiecewiseLinearFunction([[4E3,b.TiltDefault.max],[1E4,f.deg2rad(88)],[6E6,f.deg2rad(88)]]):function(){return b.TiltDefault.max};return function(d,a){void 0===a&&(a=k);a.min=b.TiltDefault.min;a.max=c(d);return a}};h.prototype.createDefaultTiltGlobal=function(){var c=this.collision.enabled?d.makePiecewiseLinearFunction([[4E3,b.TiltDefault.max],[5E4,f.deg2rad(88)],
[6E6,f.deg2rad(88)],[2E7,b.TiltDefault.min]]):d.makePiecewiseLinearFunction([[3E5,b.TiltDefault.max],[3E6,f.deg2rad(88)],[6E6,f.deg2rad(88)],[2E7,b.TiltDefault.min]]);return function(d,a){void 0===a&&(a=k);a.min=b.TiltDefault.min;a.max=c(d);return a}};a.__decorate([g.property()],h.prototype,"altitude",null);a.__decorate([g.property({readOnly:!0})],h.prototype,"collision",void 0);a.__decorate([g.property()],h.prototype,"distance",void 0);a.__decorate([g.property({readOnly:!0})],h.prototype,"minimumPoiDistance",
void 0);a.__decorate([g.property()],h.prototype,"tilt",void 0);a.__decorate([g.property({constructOnly:!0})],h.prototype,"mode",void 0);return h=a.__decorate([g.subclass("esri.views.3d.state.Constraints")],h)}(m);b.Constraints=n;b.AltitudeDefault={min:-2E5,max:4*l.earthRadius};b.TiltDefault={min:f.deg2rad(.5),max:f.deg2rad(179.5)};var k={min:0,max:0},p=function(c){function d(){var d=null!==c&&c.apply(this,arguments)||this;d.enabled=!0;d.elevationMargin=5;return d}a.__extends(d,c);a.__decorate([g.property({type:Boolean})],
d.prototype,"enabled",void 0);a.__decorate([g.property({type:Number})],d.prototype,"elevationMargin",void 0);return d=a.__decorate([g.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],d)}(m);b.default=n})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define(["require","exports","tslib","../../../core/Accessor","../../../core/accessorSupport/decorators"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(e){function f(){var a=null!==e&&e.apply(this,
arguments)||this;a.mode="auto";return a}a.__extends(f,e);Object.defineProperty(f.prototype,"near",{get:function(){return this._get("near")},set:function(a){this._set("near",a);a>=this._get("far")&&(this.far=a+1E-9);this.mode="manual"},enumerable:!0,configurable:!0});f.prototype.castNear=function(a){return Math.max(1E-8,a)};Object.defineProperty(f.prototype,"far",{get:function(){return this._get("far")},set:function(a){this._set("far",a);a<=this._get("near")&&(this.near=a-1E-9);this.mode="manual"},
enumerable:!0,configurable:!0});f.prototype.castFar=function(a){return Math.max(1E-8,a)};f.prototype.autoUpdate=function(a,e){"auto"===this.mode&&(this._get("near")!==a&&this._set("near",a),this._get("far")!==e&&this._set("far",e))};a.__decorate([h.property({type:Number,value:1E-8})],f.prototype,"near",null);a.__decorate([h.cast("near")],f.prototype,"castNear",null);a.__decorate([h.property({type:Number,value:1E-8})],f.prototype,"far",null);a.__decorate([h.cast("far")],f.prototype,"castFar",null);
a.__decorate([h.property({type:["auto","manual"]})],f.prototype,"mode",void 0);return f=a.__decorate([h.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],f)}(m);b.ClipDistanceConstraint=n;b.default=n})},"esri/views/3d/constraints/CollisionConstraint":function(){define("require exports tslib ../../../core/Accessor ../../../core/deprecate ../../../core/Logger ../../../core/accessorSupport/decorators".split(" "),function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(g){function l(){return null!==
g&&g.apply(this,arguments)||this}a.__extends(l,g);Object.defineProperty(l.prototype,"enabled",{set:function(a){h.deprecated(e.getLogger(this.declaredClass),"SceneView.constraint.collision.enabled",{replacement:"Map.ground.navigationConstraint",version:"4.8"});this._set("enabled",a)},enumerable:!0,configurable:!0});a.__decorate([f.property({value:!0})],l.prototype,"enabled",null);return l=a.__decorate([f.subclass("esri.views.3d.constraints.CollisionConstraint")],l)}(m);b.CollisionConstraint=n;b.default=
n})},"esri/views/3d/constraints/TiltConstraint":function(){define("require exports tslib ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators ../state/Constraints".split(" "),function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});var g=h.rad2deg(f.TiltDefault.min),l=h.rad2deg(f.TiltDefault.max);n=function(d){function c(){var c=null!==d&&d.apply(this,arguments)||this;c.mode="auto";return c}a.__extends(c,d);Object.defineProperty(c.prototype,"max",
{get:function(){return this._get("max")},set:function(c){this._set("max",c);this.mode="manual"},enumerable:!0,configurable:!0});c.prototype.castMax=function(c){return h.clamp(c,g,l)};c.prototype.autoUpdate=function(c){"auto"===this.mode&&this._get("max")!==c&&this._set("max",c)};a.__decorate([e.property({type:["auto","manual"]})],c.prototype,"mode",void 0);a.__decorate([e.property({type:Number,value:l})],c.prototype,"max",null);a.__decorate([e.cast("max")],c.prototype,"castMax",null);return c=a.__decorate([e.subclass("esri.views.3d.constraints.TiltConstraint")],
c)}(m);b.TiltConstraint=n;b.default=n})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("require exports tslib ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType ./SceneViewAtmosphere ./SceneViewLighting ../../../webscene/Environment ../../../webscene/Lighting".split(" "),function(n,b,a,m,h,e,f,g,l,d){return function(c){function k(a){a=c.call(this,a)||this;a.atmosphere=new f.default;return a}a.__extends(k,c);l=k;k.fromWebsceneEnvironment=
function(c){c=c.cloneConstructProperties();return new l(a.__assign(a.__assign({},c),{lighting:g.SceneViewLighting.fromWebsceneLighting(c.lighting)}))};k.prototype.castLighting=function(c){return this.convertLighting(c)};k.prototype.updateLighting=function(c){this.lighting=this.convertLighting(c)};k.prototype.convertLighting=function(c){return c?c instanceof g.SceneViewLighting?c:c instanceof d?this.lighting?this.lighting.cloneWithWebsceneLighting(c):g.SceneViewLighting.fromWebsceneLighting(c):e.ensureType(g.SceneViewLighting,
c):new g.SceneViewLighting};k.prototype.clone=function(){return new l({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:m.clone(this.background)})};var l;a.__decorate([h.property({type:f.default,json:{read:!1}})],k.prototype,"atmosphere",void 0);a.__decorate([h.property()],k.prototype,"lighting",void 0);a.__decorate([h.cast("lighting")],k.prototype,"castLighting",null);return k=l=a.__decorate([h.subclass("esri.views.3d.environment.SceneViewEnvironment")],
k)}(l)})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define(["require","exports","tslib","../../../core/Accessor","../../../core/accessorSupport/decorators"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(e){function f(){return null!==e&&e.apply(this,arguments)||this}a.__extends(f,e);g=f;Object.defineProperty(f.prototype,"quality",{set:function(a){-1!==["low","high"].indexOf(a)&&this._set("quality",a)},enumerable:!0,configurable:!0});f.prototype.clone=
function(){return new g({quality:this.quality})};var g;a.__decorate([h.property({type:["low","high"],value:"low"})],f.prototype,"quality",null);return f=g=a.__decorate([h.subclass("esri.views.3d.environment.SceneViewAtmosphere")],f)}(m);b.SceneViewAtmosphere=n;b.default=n})},"esri/views/3d/environment/SceneViewLighting":function(){define("require exports tslib ../../../core/Evented ../../../core/accessorSupport/decorators ../../../webscene/Lighting".split(" "),function(n,b,a,m,h,e){function f(a){return Math.round(a.hours+
a.minutes/60+a.seconds/3600)}Object.defineProperty(b,"__esModule",{value:!0});n=function(e){function d(c){c=e.call(this,c)||this;c.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};c.cameraTrackingEnabled=!0;c.ambientOcclusionEnabled=!1;c.waterReflectionEnabled=!1;var a=(new Date).getFullYear(),a=new Date("March 15, "+a+" 12:00:00 UTC");c._set("defaultDate",a);c._set("date",a);return c}a.__extends(d,e);c=d;d.fromWebsceneLighting=function(d){return new c(a.__assign({},d.cloneConstructProperties()))};
Object.defineProperty(d.prototype,"defaultDate",{get:function(){return new Date(this._get("defaultDate").getTime())},set:function(c){var a=this._get("date")===this._get("defaultDate");c=new Date(c.getTime());this._set("defaultDate",c);a&&this._set("date",c)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"date",{set:function(c){null!=c&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(c.getTime())))},enumerable:!0,configurable:!0});d.prototype.autoUpdate=function(c,
a){var d=f(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=a.hours;this.positionTimezoneInfo.minutes=a.minutes;this.positionTimezoneInfo.seconds=a.seconds;a=null;null!=c&&(this.positionTimezoneInfo.autoUpdated=!0,a=this.date&&this.date.getTime(),this._set("date",new Date(c.getTime())));var k=f(this.positionTimezoneInfo);d!==k&&(g.target=this,g.timezoneOffset=k,this.emit("timezone-will-change",g));if(null!=c)return a!==c.getTime()};d.prototype.clone=function(){var d=this._get("date")===
this._get("defaultDate"),g=new c(a.__assign(a.__assign({},this.cloneConstructProperties()),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled}));d&&g._set("date",g._get("defaultDate"));g.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;g.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;g.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;
g.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return g};d.prototype.cloneWithWebsceneLighting=function(c){var a=this.clone();null!=c.date&&(a.date=c.date);a.directShadowsEnabled=c.directShadowsEnabled;a.displayUTCOffset=c.displayUTCOffset;return a};var c;a.__decorate([h.property({type:Boolean})],d.prototype,"cameraTrackingEnabled",void 0);a.__decorate([h.property({type:Boolean})],d.prototype,"ambientOcclusionEnabled",void 0);a.__decorate([h.property({type:Boolean})],d.prototype,
"waterReflectionEnabled",void 0);a.__decorate([h.property({type:Date})],d.prototype,"defaultDate",null);a.__decorate([h.property({type:Date})],d.prototype,"date",null);return d=c=a.__decorate([h.subclass("esri.views.3d.environment.SceneViewLighting")],d)}(m.EventedMixin(e));b.SceneViewLighting=n;b.calculateTimezoneOffset=f;var g={target:null,timezoneOffset:0};b.default=n})},"esri/webscene/Lighting":function(){define(["require","exports","tslib","../core/JSONSupport","../core/accessorSupport/decorators"],
function(n,b,a,m,h){return function(e){function f(a){a=e.call(this,a)||this;a.date=null;a.directShadowsEnabled=!1;a.displayUTCOffset=null;return a}a.__extends(f,e);g=f;f.prototype.readDate=function(a,d){return null!=d.datetime&&new Date(d.datetime)||null};f.prototype.writeDate=function(a,d,c){d[c]=a.getTime()};f.prototype.readDirectShadowsEnabled=function(a,d){return!!d.directShadows};f.prototype.writedirectShadowsEnabled=function(a,d,c){a&&(d[c]=a)};f.prototype.writeDisplayUTCOffset=function(a,d){null!=
a&&(d.displayUTCOffset=a)};f.prototype.clone=function(){return new g(this.cloneConstructProperties())};f.prototype.cloneConstructProperties=function(){var a={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(a.date=new Date(this.date.getTime()));return a};var g;a.__decorate([h.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],f.prototype,"date",void 0);a.__decorate([h.reader("date",["datetime"])],
f.prototype,"readDate",null);a.__decorate([h.writer("date")],f.prototype,"writeDate",null);a.__decorate([h.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],f.prototype,"directShadowsEnabled",void 0);a.__decorate([h.reader("directShadowsEnabled",["directShadows"])],f.prototype,"readDirectShadowsEnabled",null);a.__decorate([h.writer("directShadowsEnabled")],f.prototype,"writedirectShadowsEnabled",null);a.__decorate([h.property({type:Number,json:{write:!0}})],f.prototype,"displayUTCOffset",
void 0);a.__decorate([h.writer("displayUTCOffset")],f.prototype,"writeDisplayUTCOffset",null);return f=g=a.__decorate([h.subclass("esri.webscene.Lighting")],f)}(m.JSONSupport)})},"esri/webscene/Environment":function(){define("require exports tslib ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),function(n,b,a,m,h,e,f,g){var l=function(a,c,k){return{enabled:!k||!k.isPresentation}};return function(d){function c(c){c=d.call(this,c)||this;
c.lighting=new f;c.background=null;c.atmosphereEnabled=!0;c.starsEnabled=!0;return c}a.__extends(c,d);k=c;c.prototype.clone=function(){return new k(this.cloneConstructProperties())};c.prototype.cloneConstructProperties=function(){return{lighting:f.prototype.clone.call(this.lighting),background:h.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};var k;a.__decorate([e.property({type:f,json:{write:!0}})],c.prototype,"lighting",void 0);a.__decorate([e.property(g.backgroundProperty)],
c.prototype,"background",void 0);a.__decorate([e.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:l}}})],c.prototype,"atmosphereEnabled",void 0);a.__decorate([e.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:l}}})],c.prototype,"starsEnabled",void 0);return c=k=a.__decorate([e.subclass("esri.webscene.Environment")],c)}(m.JSONSupport)})},"esri/webscene/background/utils":function(){define(["require","exports","./Background","./ColorBackground"],function(n,b,a,m){Object.defineProperty(b,
"__esModule",{value:!0});n={base:a,key:"type",typeMap:{color:m}};b.backgroundProperty={types:n,json:{read:function(a){return function(e,f,g){if(!e)return e;for(var l in a.typeMap)if(e.type===l)return f=new a.typeMap[l],f.read(e,g),f}}(n),write:{overridePolicy:function(a,e,f){return{enabled:!f||!f.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define("require exports tslib ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(n,
b,a,m,h,e){var f=m.strict()({color:"color"});return function(g){function l(a){return g.call(this,a)||this}a.__extends(l,g);l.prototype.normalizeCtorArgs=function(d){d&&d.type&&(d=a.__assign({},d),delete d.type);return d};l.prototype.clone=function(){};a.__decorate([e.property({type:f.apiValues,readOnly:!0,json:{type:f.jsonValues,read:!1,write:f.write}})],l.prototype,"type",void 0);return l=a.__decorate([e.subclass("esri.webscene.background.Background")],l)}(h.JSONSupport)})},"esri/webscene/background/ColorBackground":function(){define("require exports tslib ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),
function(n,b,a,m,h,e,f){var g=a.__assign(a.__assign({},e.colorAndTransparencyProperty),{nonNullable:!0});return function(e){function d(c){c=e.call(this,c)||this;c.type="color";c.color=new m([0,0,0,1]);return c}a.__extends(d,e);c=d;d.prototype.clone=function(){return new c(this.cloneProperties())};d.prototype.cloneProperties=function(){return{color:this.color.clone()}};var c;a.__decorate([h.enumeration({color:"color"})],d.prototype,"type",void 0);a.__decorate([h.property(g)],d.prototype,"color",void 0);
return d=c=a.__decorate([h.subclass("esri.webscene.background.ColorBackground")],d)}(f)})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("require exports tslib ../../../Color ../../../core/Evented ../../../core/Handles ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4f64 ./EnvironmentRenderer ../support/earthUtils ../support/projectionUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w){Object.defineProperty(b,"__esModule",{value:!0});var q=k.vec3f64.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);n=function(b){function h(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];c=b.apply(this,c)||this;c._referencePointUpdateDelay=200;c._referencePointUpdateInterval=3E3;c._referencePointUpdateDistThreshold=1E6;c._referencePosUpdateQuery=null;c._referencePosMapCoordsRequested=null;c._viewHandles=new e;c._preserveAbsoluteDateTime=
!1;c._trackingEnabled=!1;c._referencePosResetPreserveAbsoluteTime=!1;c.referencePosUpdateTimer=null;c._referencePosWGS84Comparable=null;c._referencePosMapCoords=null;c._mainLight=new z.MainLight;c._ambientLight=new z.AmbientLight;c._moonLight=new z.FillLight;c._renderer=null;c._resetReferencePosition();return c}a.__extends(h,b);h.prototype.destroy=function(){this.disconnectView();this._viewHandles.destroy()};Object.defineProperty(h.prototype,"updating",{get:function(){return!!(!this.disableQueries&&
(this._referencePosUpdateQuery||this._referencePosMapCoordsRequested)||this._renderer&&this._renderer.updating)},enumerable:!0,configurable:!0});h.prototype.connectView=function(c){var a=this;this._renderer||(this._view=c,this._renderer=new r({view:c}),this._viewHandles.add([c.watch("environment.lighting.date",function(c){return a._lightingDateHandler(c)},!0),c.watch("stationary",function(){return a._interactingStationaryHandler()}),c.watch(["environment.lighting.directShadowsEnabled","environment.lighting.ambientOcclusionEnabled",
"environment.lighting.waterReflectionEnabled","environment.background.color"],function(){return a._updateRenderParamsHandler()},!0),c.watch("spatialReference",function(){return a._resetReferencePosition()},!0),l.init(c,"viewingMode",function(){return a._resetReferencePosition()},!0),l.init(c,"environment.lighting.cameraTrackingEnabled",function(c){return a._updateCameraTracking(c)},!0),l.init(c,"state.camera",function(){return a._cameraHandler(null)},!0),this.watch("disableQueries",function(){return a._cameraHandler(null)})]),
this._updateRenderParamsHandler(),this._updateLightParams(),this._cameraHandler(),this.notifyChange("updating"))};h.prototype.disconnectView=function(){this._renderer&&(this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer.destroy(),this._view=this._renderer=null)};h.prototype._updateCameraTracking=function(c){if(this._trackingEnabled=c)this._cameraHandler();else if(c=this._view.environment.lighting)c.positionTimezoneInfo.autoUpdated=!1};h.prototype._lightingDateHandler=function(c){if(c){var a=
this._view.environment.lighting;if(!a.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!u.canProjectToWGS84ComparableLonLat(this._view.spatialReference)){var d=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(d)){this._requestReferencePositionUpdate(d);return}}this._preupdateTracking(c);this._referencePosWGS84Comparable&&(d=t.positionToTimezone(this._referencePosWGS84Comparable,A),f.isSome(d)&&(a.autoUpdate(null,d),this._trackingEnabled&&
(a.positionTimezoneInfo.autoUpdated=!0)))}this._updateLightParams(c)}};h.prototype._preupdateTracking=function(c){!this._trackingEnabled&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(c)};h.prototype._cameraHandler=function(c){void 0===c&&(c=null);if(this._view.ready){var a=this._view.camera;a&&(this._cameraHandlerClientSide(a,c)||this._cameraHandlerServerSide(a))}};h.prototype._cameraHandlerClientSide=function(c,a){if(!u.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return!1;
c=c.position;this._referencePosWGS84Comparable||(this._referencePosWGS84Comparable=k.vec3f64.create());u.pointToWGS84ComparableLonLat(c,this._referencePosWGS84Comparable);this._autoUpdateTimezone(this._referencePosWGS84Comparable,a)||this._updateLightParams(a);return!0};h.prototype._cameraHandlerServerSide=function(c){c=c.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(c))&&this._requestReferencePositionUpdate(c,!0);this._view.mapCoordsHelper&&
this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=c.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};h.prototype._interactingStationaryHandler=function(){this._view.stationary&&this._executePendingReferencePositionUpdate()};h.prototype._updateLightParams=function(a){var d=this._view.environment.lighting;a=a||d.date;var d=this._view._stage,k;this._referencePosWGS84Comparable?(k=v.computeColorAndIntensity(a,this._referencePosWGS84Comparable),v.computeDirection(a,
this._referencePosWGS84Comparable,this._view.viewingMode,k.diffuse.direction)):k={diffuse:{color:[1,1,1],intensity:.55,direction:q},ambient:{color:[1,1,1],intensity:.55},noonFactor:.5,globalFactor:0};c.vec3.scale(this._mainLight.intensity,k.diffuse.color,k.diffuse.intensity*Math.PI);c.vec3.negate(this._mainLight.direction,k.diffuse.direction);c.vec3.scale(this._ambientLight.intensity,k.ambient.color,k.ambient.intensity);c.vec3.lerp(this._moonLight.intensity,B,C,k.globalFactor);c.vec3.scale(this._moonLight.intensity,
this._moonLight.intensity,(1-.5*k.globalFactor)*(1-.4*k.noonFactor*(1-k.globalFactor)));c.vec3.copy(this._moonLight.direction,k.diffuse.direction);d.setLighting({lights:[this._mainLight,this._ambientLight,this._moonLight],globalFactor:k.globalFactor,groundLightingFactor:1-k.noonFactor});this._updateRenderParamsHandler()};h.prototype._autoUpdateTimezone=function(c,a){void 0===a&&(a=null);if(!this._view.environment.lighting.cameraTrackingEnabled)return!1;var d=y;d.setTime((a||this._view.environment.lighting.date).getTime());
c=t.positionToTimezone(c,A);if(f.isNone(c))return!1;var k=this._view.environment.lighting.positionTimezoneInfo;if(!k.autoUpdated)k=c;else if(k.hours===c.hours&&k.minutes===c.minutes&&k.seconds===c.seconds)return!1;var g=d.getUTCHours()-(c.hours-k.hours),e=d.getUTCMinutes()-(c.minutes-k.minutes),k=d.getUTCSeconds()-(c.seconds-k.seconds);d.setUTCHours(g);d.setUTCMinutes(e);d.setUTCSeconds(k);return a?!1:this._view.environment.lighting.autoUpdate(d,c)};h.prototype._updateRenderParamsHandler=function(){var c=
this._view._stage;if(c){var a=this._referencePosWGS84Comparable?v.computeShadowsEnabled(this._referencePosWGS84Comparable,this._view.viewingMode):!0,d=this._view.environment.background,d=d instanceof w?{type:"color",color:p.vec4f64.fromArray(m.toUnitRGBA(d.color))}:{type:"color",color:p.vec4f64.fromValues(0,0,0,1)};c.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&a,ssao:this._view.environment.lighting.ambientOcclusionEnabled,waterReflectionEnabled:this._view.environment.lighting.waterReflectionEnabled,
background:d})}};h.prototype._resetReferencePosition=function(){this._cancelReferencePosUpdates();this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;this.notifyChange("updating")};h.prototype._requestReferencePositionUpdate=function(c,a){var d=this;void 0===a&&(a=!1);if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(c):this._referencePosMapCoordsRequested=
c.clone(),this._referencePosResetPreserveAbsoluteTime=!!a,!this._referencePosUpdateQuery&&!this.referencePosUpdateTimer&&this._view.stationary)){var k=this._referencePosUpdateQuery=g.after(this._referencePointUpdateDelay).then(function(){if(d._referencePosUpdateQuery===k)return d._doReferencePositionUpdateQuery(function(){return d._referencePosUpdateQuery!==k})}).catch(function(c){"mapcoordshelper:missing-geometry-service"===c.name&&(d.disableQueries=!0)}).then(function(){d._referencePosUpdateQuery===
k&&(d._referencePosUpdateQuery=null,d.referencePosUpdateTimer||d._executePendingReferencePositionUpdate(),d.notifyChange("updating"))}),e=this.referencePosUpdateTimer=g.after(this._referencePointUpdateInterval).then(function(){d.referencePosUpdateTimer===e&&(d.referencePosUpdateTimer=null,d._referencePosUpdateQuery||d._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};h.prototype._doReferencePositionUpdateQuery=function(c){return a.__awaiter(this,void 0,void 0,function(){var d,
k;return a.__generator(this,function(a){switch(a.label){case 0:return this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null,[4,this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords)];case 1:return d=a.sent(),
c()||isNaN(d[0])||isNaN(d[1])||(k=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=d[0],this._referencePosWGS84Comparable[1]=d[1],this._referencePosWGS84Comparable[2]=k):this._referencePosWGS84Comparable=[d[0],d[1],k],this._referencePosChanged()),[2]}})})};h.prototype._executePendingReferencePositionUpdate=function(){var c=this._referencePosMapCoordsRequested;c&&this._requestReferencePositionUpdate(c,this._referencePosResetPreserveAbsoluteTime)};
h.prototype._referencePosChanged=function(){this._preserveAbsoluteDateTime?this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLightParams()};h.prototype._exceedsReferencePosDistThreshold=function(c){return this._referencePosMapCoords?(c=this._referencePosMapCoords.distance(c),this._view.mapCoordsHelper&&(c*=this._view.mapCoordsHelper.unitInMeters),c>this._referencePointUpdateDistThreshold):!0};h.prototype._cancelReferencePosUpdates=function(){this.referencePosUpdateTimer=
this._referencePosUpdateQuery=null};Object.defineProperty(h.prototype,"test",{get:function(){var c=this;return{renderer:this._renderer,set referencePointUpdateInterval(a){c._referencePointUpdateInterval=a},set referencePointUpdateDistThreshold(a){c._referencePointUpdateDistThreshold=a},set referencePosUpdateTimer(a){c.referencePosUpdateTimer=a},set referencePointUpdateDelay(a){c._referencePointUpdateDelay=a}}},enumerable:!0,configurable:!0});h.FIXED_LIGHT_DIRECTION=q;a.__decorate([d.property({type:Boolean,
dependsOn:["disableQueries","_renderer.updating"],readOnly:!0})],h.prototype,"updating",null);a.__decorate([d.property()],h.prototype,"disableQueries",void 0);a.__decorate([d.property()],h.prototype,"_renderer",void 0);return h=a.__decorate([d.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],h)}(h.EventedAccessor);b.SceneViewEnvironmentManager=n;var y=new Date,A={hours:0,minutes:0,seconds:0},B=k.vec3f64.fromValues(.22,.22,.33),C=k.vec3f64.fromValues(.22,.22,.22);b.default=n})},"esri/core/libs/gl-matrix-2/vec4f64":function(){define(["require",
"exports","./factories/vec4f64"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.vec4f64=a})},"esri/core/libs/gl-matrix-2/factories/vec4f64":function(){define(["require","exports"],function(n,b){function a(){return[0,0,0,0]}function m(){return[1,1,1,1]}function h(){return[1,0,0,0]}function e(){return[0,1,0,0]}function f(){return[0,0,1,0]}function g(){return[0,0,0,1]}Object.defineProperty(b,"__esModule",{value:!0});b.create=a;b.clone=function(a){return[a[0],a[1],a[2],a[3]]};b.fromValues=
function(a,d,c,k){return[a,d,c,k]};b.fromArray=function(g){for(var d=a(),c=Math.min(4,g.length),k=0;k<c;++k)d[k]=g[k];return d};b.createView=function(a,d){return new Float64Array(a,d,4)};b.zeros=function(){return a()};b.ones=m;b.unitX=h;b.unitY=e;b.unitZ=f;b.unitW=g;b.ZEROS=a();b.ONES=m();b.UNIT_X=h();b.UNIT_Y=e();b.UNIT_Z=f();b.UNIT_W=g()})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("require exports tslib ../../../core/Accessor ../../../core/compilerUtils ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k){var p=[14,15];return function(b){function r(){var c=null!==b&&b.apply(this,arguments)||this;c._handles=new e;c._initContext=null;c._pendingAtmosphere=null;c._atmosphere=null;c._stars=null;return c}a.__extends(r,b);Object.defineProperty(r.prototype,"canRender",{get:function(){return!(!this.view.basemapTerrain||!this.view.basemapTerrain.renderer.canRender)||"global"!==this.view.viewingMode},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"updating",
{get:function(){return null!=this._pendingAtmosphere},enumerable:!0,configurable:!0});r.prototype.initialize=function(){this.view._stage.addRenderPlugin(p,this)};r.prototype.destroy=function(){this._pendingAtmosphere&&(this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null);this._stars&&(this._stars.destroy(),this._stars=null);this._handles&&this._handles.removeAll();this.view&&(this.view._stage.removeRenderPlugin(this),
this._set("view",null))};r.prototype.initializeRenderContext=function(c){this._initContext=c;this._techniqueRepository=this._initContext.shaderTechniqueRep;this.setup()};r.prototype.setup=function(){var c=this;this._handles.add(f.when(this.view,"basemapTerrain",function(){return c._updateBasemapTerrain()},!0));this._handles.add([f.init(this.view,["viewingMode","environment.atmosphereEnabled","environment.atmosphere.quality"],function(){return c._updateAtmosphere()},!0),f.init(this.view,"environment.starsEnabled",
function(){return c._updateStars()},!0)])};r.prototype.uninitializeRenderContext=function(){this._stars&&(this._stars.uninitializeRenderContext(),this._stars.destroy(),this._stars=null);this._atmosphere&&(this._atmosphere.uninitializeRenderContext(),this._atmosphere.destroy(),this._atmosphere=null)};r.prototype.render=function(c){var a=!0;this._stars&&this._stars.canRender&&(a=this._stars.render(c)&&a);this._atmosphere&&this._atmosphere.canRender&&(a=this._atmosphere.render(c)&&a);return a};r.prototype._setNeedsRender=
function(){this._initContext&&this._initContext.requestRender()};r.prototype._updateStars=function(){var c=this.view.get("environment.starsEnabled")||!1;c&&!this._stars?(this._stars=new k(this.view),this._stars.initializeRenderContext(this._initContext),this._setNeedsRender()):!c&&this._stars&&(this._stars.destroy(),this._stars=null,this._setNeedsRender())};r.prototype._updateAtmosphere=function(){var c=this,a=this._getAtmosphereType();if(this.atmosphereType!==a)if(this.atmosphereType=a,this._pendingAtmosphere&&
(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null),a=this._getAtmosphereClass()){var d=new a(this.view,this._techniqueRepository);d.initializeRenderContext(this._initContext);null==this._atmosphere&&(this._atmosphere=d,this._setNeedsRender());this._pendingAtmosphere=d;d.when().then(function(){c._pendingAtmosphere!==c._atmosphere&&(c._atmosphere.destroy(),c._atmosphere=c._pendingAtmosphere);c._pendingAtmosphere=null;c._setNeedsRender();c._updateBasemapTerrain()}).catch(function(){c._pendingAtmosphere===
d&&(c._pendingAtmosphere=null)})}else this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),this._updateBasemapTerrain()};r.prototype._getAtmosphereClass=function(){var a=this._getAtmosphereType();if(this.atmosphereClassFromType)return this.atmosphereClassFromType(a);switch(a){case "none":return null;case "realistic":return d.RealisticAtmosphere;case "panoramic":return l;case "simple":return c;default:h.neverReached(a)}};r.prototype._getAtmosphereType=function(){var c=
this.view.get("environment.atmosphereEnabled"),a=this.view.get("environment.atmosphere.quality");return c&&null!=a?"local"===this.view.viewingMode?"panoramic":"high"===a&&d.RealisticAtmosphere.isSupported(this._initContext)?"realistic":"simple":"none"};r.prototype._updateBasemapTerrain=function(){var c=this.view.basemapTerrain;c&&(c.velvetOverground=null!=this._atmosphere&&"simple"===this.atmosphereType)};Object.defineProperty(r.prototype,"test",{get:function(){return{atmosphere:this._atmosphere}},
enumerable:!0,configurable:!0});a.__decorate([g.property({constructOnly:!0})],r.prototype,"view",void 0);a.__decorate([g.property({constructOnly:!0})],r.prototype,"atmosphereClassFromType",void 0);a.__decorate([g.property({dependsOn:["_pendingAtmosphere"]})],r.prototype,"updating",null);a.__decorate([g.property()],r.prototype,"_pendingAtmosphere",void 0);return r=a.__decorate([g.subclass("esri.views.3d.environment.EnvironmentRenderer")],r)}(m)})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("require exports ../../../core/Logger ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ./SimpleAtmosphereTechnique ./resources/SimpleAtmosphereTexture ../support/imageUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/Util ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z){var w=a.getLogger("esri.views.3d.environment.PanoramicAtmosphere");n=function(){function c(c,a){this.slot=14;this._readyResolver=m.createResolver();this._readyController=m.createAbortController();this.view=c;this._techniqueRepository=a;this._atmosphereTechniqueConfig=new f.SimpleAtmosphereTechniqueConfiguration}Object.defineProperty(c.prototype,"canRender",{get:function(){return null!=this._texture},enumerable:!0,configurable:!0});c.prototype.destroy=
function(){this._readyResolver.reject();this._texture&&(this._texture.dispose(),this._texture=null);this._readyController&&(this._readyController.abort(),this._readyController=null)};c.prototype.when=function(){return this._readyResolver.promise};c.prototype.initializeRenderContext=function(c){var a=this,d=c.rctx;this._atmosphereTechniqueConfig.geometry=1;this._atmosphereTechnique=this._techniqueRepository.acquireAndReleaseExisting(f.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereTechnique);
this._vao=this._createVertexArrayObject(d);this._vaoCount=v.vertexCount(this._vao,"geometry");l.requestImage(g,{signal:this._readyController.signal}).then(function(d){a._texture=new u(c.rctx,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},d);c.requestRender();a._readyController=null;a._readyResolver.resolve()}).catch(function(c){m.isAbortError(c)||w.error("Unable to initialize atmosphere: image request failed",c);a._readyResolver.reject()})};c.prototype.uninitializeRenderContext=
function(){this.destroy()};c.prototype.render=function(c){if(c.slot!==this.slot||0!==c.pass)return!1;var a=c.rctx,d=this._atmosphereTechnique.program;a.bindProgram(d);this._atmosphereTechnique.bindPipelineState(a);a.bindTexture(this._texture);d.setUniform1i("tex",0);d.setUniformMatrix4fv("proj",c.camera.projectionMatrix);var k=q;h.mat4.copy(k,c.camera.viewMatrix);k[12]=0;k[13]=0;k[14]=0;k[15]=1;d.setUniformMatrix4fv("view",q);d.setUniform4f("color",1,1,1,1);c.scenelightingData.setLightDirectionUniform(d);
a.bindVAO(this._vao);d.assertCompatibleVertexAttributeLocations(this._vao);a.drawArrays(4,0,this._vaoCount);return!0};c.prototype._createVertexArrayObject=function(c){for(var a=p.createPolySphereGeometry(1,2,!1),g=a.indices[r.VertexAttrConstants.POSITION],e=0;e<g.length;e+=3){var f=g[e];g[e]=g[e+2];g[e+2]=f}for(var a=a.vertexAttributes[r.VertexAttrConstants.POSITION].data,f=y.createBuffer(g.length),l=f.position,e=0;e<g.length;++e){var b=3*g[e];l.set(e,0,a[b]);l.set(e,1,a[b+1]);l.set(e,2,a[b+2])}return new z(c,
k.Default3D,{geometry:d.glLayout(y)},{geometry:t.createVertex(c,35044,f.buffer)})};return c}();var q=e.mat4f64.create(),y=c.newLayout().vec3f("position");return n})},"esri/core/libs/gl-matrix-2/mat4f64":function(){define(["require","exports","./factories/mat4f64"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.mat4f64=a})},"esri/core/libs/gl-matrix-2/factories/mat4f64":function(){define(["require","exports"],function(n,b){function a(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}Object.defineProperty(b,
"__esModule",{value:!0});b.create=a;b.clone=function(a){return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]};b.fromValues=function(a,b,e,f,g,l,d,c,k,p,r,t,u,v,z,w){return[a,b,e,f,g,l,d,c,k,p,r,t,u,v,z,w]};b.createView=function(a,b){return new Float64Array(a,b,16)};b.IDENTITY=a()})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports tslib ../environment/SimpleAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",{value:!0});e=function(c){function k(){return null!==c&&c.apply(this,arguments)||this}a.__extends(k,c);k.prototype.initializeProgram=function(c){var a=k.shader.get().build({geometry:this.configuration.geometry});return new l(c.rctx,a.generateSource("vertex"),a.generateSource("fragment"),g.Default3D)};k.prototype.initializePipeline=function(){return 1===this.configuration.geometry?d.makePipelineState({blending:d.separateBlendingParams(770,
1,771,771),culling:d.backFaceCullingParams,depthTest:{func:515},colorWrite:d.defaultColorWriteParams}):d.makePipelineState({blending:d.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:d.defaultColorWriteParams})};k.shader=new h.ReloadableShaderModule(m,function(){return new Promise(function(c,a){n(["../environment/SimpleAtmosphere.glsl"],c,a)})});return k}(e.ShaderTechnique);b.SimpleAtmosphereTechnique=e;e=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;
a.geometry=0;return a}a.__extends(d,c);a.__decorate([f.parameter({count:3})],d.prototype,"geometry",void 0);return d}(f.ShaderTechniqueConfiguration);b.SimpleAtmosphereTechniqueConfiguration=e})},"esri/views/3d/environment/SimpleAtmosphere.glsl":function(){define("require exports tslib ../webgl-engine/core/shaderLibrary/Transform.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderModules/ShaderBuilder".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",
{value:!0});b.build=function(b){var v=new e.ShaderBuilder;2===b.geometry?(v.attributes.add("position","vec2"),v.varyings.add("color","vec4"),v.vertex.uniforms.add("lightingMainDirection","vec3").add("cameraPosition","vec3").add("undergroundFadeAlpha","float"),v.vertex.code.add(h.glsl(f||(f=a.__makeTemplateObject(["\n      void main(void) {\n          float ndotl \x3d dot(normalize(cameraPosition), -lightingMainDirection);\n          float lighting \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n          color \x3d vec4(vec3(lighting), undergroundFadeAlpha);\n\n          gl_Position \x3d vec4(position.xy, 1.0, 1.0); // on the far plane\n      }\n  "],
["\n      void main(void) {\n          float ndotl \x3d dot(normalize(cameraPosition), -lightingMainDirection);\n          float lighting \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n          color \x3d vec4(vec3(lighting), undergroundFadeAlpha);\n\n          gl_Position \x3d vec4(position.xy, 1.0, 1.0); // on the far plane\n      }\n  "])))),v.fragment.code.add(h.glsl(g||(g=a.__makeTemplateObject(["\n      void main() {\n          gl_FragColor \x3d color;\n      }\n  "],["\n      void main() {\n          gl_FragColor \x3d color;\n      }\n  "]))))):
(v.include(m.Transform,{linearDepth:!1}),v.attributes.add("position","vec3"),v.varyings.add("vtc","vec2"),v.varyings.add("falloff","float"),1!==b.geometry&&v.varyings.add("innerFactor","float"),v.vertex.uniforms.add("proj","mat4").add("view","mat4").add("lightingMainDirection","vec3"),1!==b.geometry&&v.vertex.uniforms.add("silCircleCenter","vec3").add("silCircleV1","vec3").add("silCircleV2","vec3").add("texV","vec2").add("innerScale","float"),1!==b.geometry&&v.vertex.code.add(h.glsl(l||(l=a.__makeTemplateObject(["\n\t\t\tconst float TWICEPI \x3d 2.0*3.14159265;\n\t\t\tconst float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\n\t\t"],
["\n\t\t\tconst float TWICEPI \x3d 2.0*3.14159265;\n\t\t\tconst float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\n\t\t"])))),v.vertex.code.add(h.glsl(d||(d=a.__makeTemplateObject(["\n\t\tvoid main(void) {\n\t\t\tvec3 lightDirection \x3d -lightingMainDirection;\n\t"],["\n\t\tvoid main(void) {\n\t\t\tvec3 lightDirection \x3d -lightingMainDirection;\n\t"])))),1===b.geometry?v.vertex.code.add(h.glsl(c||(c=a.__makeTemplateObject(["\n\t\t\tvec3 pos \x3d position;\n\t\t\tfloat ndotl \x3d lightDirection.z;\n\t\t\tvtc \x3d vec2(0.0, position.z+0.05);\n\t\t\t"],
["\n\t\t\tvec3 pos \x3d position;\n\t\t\tfloat ndotl \x3d lightDirection.z;\n\t\t\tvtc \x3d vec2(0.0, position.z+0.05);\n\t\t\t"])))):v.vertex.code.add(h.glsl(k||(k=a.__makeTemplateObject(["\n\t\t\tinnerFactor \x3d clamp(-position.z, 0.0, 1.0);\n\t\t\tfloat scale \x3d position.y * (1.0 + innerFactor * innerScale);\n\t\t\tfloat phi \x3d position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\n\t\t\tvec3 pos \x3d  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\n\t\t\tfloat ndotl \x3d dot(normalize(position.y \x3e 0.0 ? pos: silCircleCenter), lightDirection);\n\n\t\t\tvtc.x \x3d position.x / ATMOSPHERE_RIM_SEGMENTS;\n\t\t\tvtc.y \x3d texV.x * (1.0 - position.z) + texV.y * position.z;\n\t\t"],
["\n\t\t\tinnerFactor \x3d clamp(-position.z, 0.0, 1.0);\n\t\t\tfloat scale \x3d position.y * (1.0 + innerFactor * innerScale);\n\t\t\tfloat phi \x3d position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\n\t\t\tvec3 pos \x3d  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\n\t\t\tfloat ndotl \x3d dot(normalize(position.y \x3e 0.0 ? pos: silCircleCenter), lightDirection);\n\n\t\t\tvtc.x \x3d position.x / ATMOSPHERE_RIM_SEGMENTS;\n\t\t\tvtc.y \x3d texV.x * (1.0 - position.z) + texV.y * position.z;\n\t\t"])))),
v.vertex.code.add(h.glsl(p||(p=a.__makeTemplateObject(["\n\t\tfalloff \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n\t\tgl_Position \x3d transformPosition(proj, view, pos);\n\t\tgl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\n\t\t\t}\n\t"],["\n\t\tfalloff \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n\t\tgl_Position \x3d transformPosition(proj, view, pos);\n\t\tgl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\n\t\t\t}\n\t"])))),
v.fragment.uniforms.add("tex","sampler2D"),1!==b.geometry&&v.fragment.uniforms.add("altitudeFade","float"),v.fragment.code.add(h.glsl(r||(r=a.__makeTemplateObject(["\n\t\tvoid main() {\n\t\t\tvec4 texColor \x3d texture2D(tex, vtc);\n\t"],["\n\t\tvoid main() {\n\t\t\tvec4 texColor \x3d texture2D(tex, vtc);\n\t"])))),1===b.geometry?v.fragment.code.add(h.glsl(t||(t=a.__makeTemplateObject(["\n\t\t\tgl_FragColor \x3d texColor * falloff;\n\t\t\t}\n\t\t"],["\n\t\t\tgl_FragColor \x3d texColor * falloff;\n\t\t\t}\n\t\t"])))):
v.fragment.code.add(h.glsl(u||(u=a.__makeTemplateObject(["\n\t\t\tvec4 atmosphereColor \x3d texColor * falloff;\n\t\t\tvec4 innerColor \x3d vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\n\t\t\tgl_FragColor \x3d mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\n\t\t}\n\t\t"],["\n\t\t\tvec4 atmosphereColor \x3d texColor * falloff;\n\t\t\tvec4 innerColor \x3d vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\n\t\t\tgl_FragColor \x3d mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\n\t\t}\n\t\t"])))));
return v};var f,g,l,d,c,k,p,r,t,u})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define("require exports tslib ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f32 ../shaderModules/interfaces".split(" "),function(n,b,a,m,h,e){function f(c,k){k.linearDepth?c.vertex.code.add(e.glsl(l||(l=a.__makeTemplateObject(["\n    vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\n      vec4 eye \x3d view * vec4(pos, 1.0);\n      depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n      return proj * eye;\n    }\n    "],
["\n    vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\n      vec4 eye \x3d view * vec4(pos, 1.0);\n      depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n      return proj * eye;\n    }\n    "])))):c.vertex.code.add(e.glsl(d||(d=a.__makeTemplateObject(["\n    vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\n      // Make sure the order of operations is the same as in transformPositionWithDepth.\n      return proj * (view * vec4(pos, 1.0));\n    }\n    "],
["\n    vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\n      // Make sure the order of operations is the same as in transformPositionWithDepth.\n      return proj * (view * vec4(pos, 1.0));\n    }\n    "]))))}Object.defineProperty(b,"__esModule",{value:!0});b.Transform=f;(function(c){function a(c,a,d){m.mat4.translate(g,d,a);c.setUniform3fv("localOrigin",a);c.setUniformMatrix4fv("view",g)}c.bindUniformsCustomOrigin=a;c.bindUniforms=function(c,d){a(c,d.origin,d.view)}})(f=b.Transform||(b.Transform=
{}));var g=h.mat4f32.create(),l,d})},"esri/core/libs/gl-matrix-2/mat4f32":function(){define(["require","exports","./factories/mat4f32"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.mat4f32=a})},"esri/core/libs/gl-matrix-2/factories/mat4f32":function(){define(["require","exports"],function(n,b){function a(){var a=new Float32Array(16);a[0]=1;a[5]=1;a[10]=1;a[15]=1;return a}Object.defineProperty(b,"__esModule",{value:!0});b.create=a;b.clone=function(a){var b=new Float32Array(16);
b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};b.fromValues=function(a,b,e,f,g,l,d,c,k,p,r,t,u,v,z,w){var h=new Float32Array(16);h[0]=a;h[1]=b;h[2]=e;h[3]=f;h[4]=g;h[5]=l;h[6]=d;h[7]=c;h[8]=k;h[9]=p;h[10]=r;h[11]=t;h[12]=u;h[13]=v;h[14]=z;h[15]=w;return h};b.createView=function(a,b){return new Float32Array(a,b,16)};b.IDENTITY=a()})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["require",
"exports"],function(n,b){function a(a){for(var b=[],e=1;e<arguments.length;e++)b[e-1]=arguments[e];for(var e="",f=0;f<b.length;f++)e+=a[f]+b[f];return e+=a[a.length-1]}Object.defineProperty(b,"__esModule",{value:!0});b.glsl=a;(function(a){a.int=function(a){return Math.round(a).toString()};a.float=function(a){return a.toPrecision(8)}})(a=b.glsl||(b.glsl={}))})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define(["require","exports","../../../../../core/Logger","../../../../../core/MapUtils",
"../../../../../core/SetUtils"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});var e=a.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");n=function(){function a(){this.vertex=new l;this.fragment=new l;this.attributes=new d;this.varyings=new c;this.extensions=new k;this.defines=new p;this._includedModules=new Map}a.prototype.include=function(c,a){this._includedModules.has(c)?this._includedModules.get(c)!==a&&e.error("Trying to include shader module multiple times with different sets of options."):
(this._includedModules.set(c,a),"shaderModule"in c?c.shaderModule(this,a):c(this,a))};a.prototype.generateSource=function(c){var a=this.extensions.generateSource(c),d=this.attributes.generateSource(c),k=this.varyings.generateSource(),g="vertex"===c?this.vertex:this.fragment,e=g.uniforms.generateSource(),f=g.code.generateSource();c="vertex"===c?t:r;g=this.defines.generateSource().concat(g.defines.generateSource());return"\n"+a.join("\n")+"\n\n"+g.join("\n")+"\n\n"+c+"\n\n"+e.join("\n")+"\n\n"+d.join("\n")+
"\n\n"+k.join("\n")+"\n\n"+f.join("\n")};return a}();b.ShaderBuilder=n;var f=function(){function c(){this._entries=[];this._set=new Set}c.prototype.add=function(c,a,d){var k=c+"_"+a+"_"+d;this._set.has(k)||(this._entries.push([c,a,d]),this._set.add(k));return this};c.prototype.generateSource=function(){return this._entries.map(function(c){var a=c[2];return"uniform "+c[1]+" "+c[0]+(a?"["+a+"]":"")+";"})};return c}(),g=function(){function c(){this._entries=[]}c.prototype.add=function(c){this._entries.push(c)};
c.prototype.generateSource=function(){return this._entries};return c}(),l=function(){return function(){this.uniforms=new f;this.code=new g;this.defines=new p}}(),d=function(){function c(){this._entries=[]}c.prototype.add=function(c,a){this._entries.push([c,a])};c.prototype.generateSource=function(c){return"fragment"===c?[]:this._entries.map(function(c){return"attribute "+c[1]+" "+c[0]+";"})};return c}(),c=function(){function c(){this._entries=[]}c.prototype.add=function(c,a){this._entries.push([c,
a])};c.prototype.generateSource=function(){return this._entries.map(function(c){return"varying "+c[1]+" "+c[0]+";"})};return c}(),k=function(){function c(){this._entries=new Set}c.prototype.add=function(c){this._entries.add(c)};c.prototype.generateSource=function(a){var d="vertex"===a?c.WHITELIST_VERTEX:c.WHITELIST_FRAGMENT;return h.valuesOfSet(this._entries).filter(function(c){return 0<=d.indexOf(c)}).map(function(c){return"#extension "+c+" : enable"})};c.WHITELIST_FRAGMENT=["GL_EXT_shader_texture_lod",
"GL_OES_standard_derivatives"];c.WHITELIST_VERTEX=[];return c}(),p=function(){function c(){this._entries=new Map}c.prototype.addInt=function(c,a){a=0===a%1?a.toFixed(0):a.toString();this._entries.set(c,a)};c.prototype.addFloat=function(c,a){a=0===a%1?a.toFixed(1):a.toString();this._entries.set(c,a)};c.prototype.generateSource=function(){return m.pairsOfMap(this._entries).map(function(c){return"#define "+c[0]+" "+c[1]})};return c}(),r="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",
t="precision highp float;\nprecision highp sampler2D;"})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["require","exports","tslib"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,e){this._module=a;this._loadModule=e}b.prototype.get=function(){return this._module};b.prototype.reload=function(){return a.__awaiter(this,void 0,void 0,function(){var b;return a.__generator(this,function(a){switch(a.label){case 0:return b=
this,[4,this._loadModule()];case 1:return b._module=a.sent(),[2,this._module]}})})};return b}();b.ReloadableShaderModule=n})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a,b){if(b){var e=b.__proto__.__configurationParameters||[],f={};f.key=b.key;for(var g=0;g<e.length;g++){var l=e[g];f[l]=b[l]}this._config=f}this._program=this.initializeProgram(a);a.commonUniformStore&&
(this._commonUniformStore=a.commonUniformStore,this._commonUniformStore.subscribeProgram(this._program));this._pipeline=this.initializePipeline(a)}a.prototype.dispose=function(){this._program&&(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose(),this._program=null)};a.prototype.reload=function(a){this._program&&(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose());this._program=this.initializeProgram(a);
this._commonUniformStore&&this._commonUniformStore.subscribeProgram(this._program)};Object.defineProperty(a.prototype,"program",{get:function(){return this._program},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"pipeline",{get:function(){return this._pipeline},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"key",{get:function(){return this._config.key},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"configuration",{get:function(){return this._config},
enumerable:!0,configurable:!0});a.prototype.bindPass=function(a,b,e){};a.prototype.bindMaterial=function(a,b,e){};a.prototype.bindDraw=function(a,b,e){};a.prototype.bindPipelineState=function(a){a.setPipelineState(this.pipeline)};a.prototype.ensureAttributeLocations=function(a){this.program.assertCompatibleVertexAttributeLocations(a)};Object.defineProperty(a.prototype,"primitiveType",{get:function(){return 4},enumerable:!0,configurable:!0});return a}();b.ShaderTechnique=n})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["require",
"exports","../../../../../core/mathUtils"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(){this.key=0}}();b.ShaderTechniqueConfiguration=n;b.parameter=function(b){void 0===b&&(b={});return function(h,e){h.__configurationParameters=h.__configurationParameters||[];h.__configurationParameters.push(e);var f="_"+e;void 0===h.__configurationParameters__offset&&(h.__configurationParameters__offset=0);var g=h.__configurationParameters__offset,l=Math.ceil(a.log2(b.count||
2)),d=(1<<l)-1<<g;h.__configurationParameters__offset+=l;if(32<=h.__configurationParameters__offset)throw Error("ShaderTechniqueConfiguration is too complex, requiring more than 32 bits to encode.\n      Either the configuration must be simplified, or this restriction must be relaxed.(Currently used: "+h.__configurationParameters__offset+")");Object.defineProperty(h,e,{get:function(){return this[f]},set:function(c){this.key=this.key&~d|c<<g&d;this[f]=c}})}}})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.Default3D={position:0,normal:1,uv0:2,color:3,size:4,tangent:4,auxpos1:5,symbolColor:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,instanceColor:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}})},"esri/views/webgl/Program":function(){define(["require","exports","../../core/has","../../core/maybe","./ShaderTranspiler"],function(n,b,a,m,h){function e(a,g){if(m.isNone(a)||a.length!==g.length)return!0;for(var e=
0;e<a.length;++e)if(a[e]!==g[e])return!0;return!1}return function(){function a(g,e,d,c,k){void 0===k&&(k={});this._glName=this._context=null;this._locations={};this._id=void 0;this._initialized=!1;this._fShader=this._vShader=null;this._defines={};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform1v={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4={};g||console.error("RenderingContext isn't initialized!");
0===e.length&&console.error("Shaders source should not be empty!");this._context=g;this._vertexShaderSource=e;this._fragmentShaderSource=d;if(Array.isArray(k))for(g=0;g<k.length;g++)this._defines[k[g]]="1";else this._defines=k;this._id=a._nextId++;this._locations=c}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});a.prototype.getDefine=function(a){return this._defines[a]};a.prototype.dispose=function(){if(this._context){var a=this._context.gl;this._vShader&&(a.deleteShader(this._vShader),this._vShader=null);this._fShader&&(a.deleteShader(this._fShader),this._fShader=null);this._glName&&(a.deleteProgram(this._glName),this._glName=null);this._context=null}};a.prototype.initialize=function(){if(!this._initialized){this._vShader=
this._loadShader(35633);this._fShader=this._loadShader(35632);this._vShader&&this._fShader||console.error("Error loading shaders!");var a=this._context.gl,e=a.createProgram();a.attachShader(e,this._vShader);a.attachShader(e,this._fShader);for(var d in this._locations)a.bindAttribLocation(e,this._locations[d],d);a.linkProgram(e);this._glName=e;this._initialized=!0}};a.prototype.getUniformLocation=function(a){this.initialize();void 0===this._nameToUniformLocation[a]&&(this._nameToUniformLocation[a]=
this._context.gl.getUniformLocation(this._glName,a));return this._nameToUniformLocation[a]};a.prototype.hasUniform=function(a){return null!==this.getUniformLocation(a)};a.prototype.getAttribLocation=function(a){this.initialize();void 0===this._nameToAttribLocation[a]&&(this._nameToAttribLocation[a]=this._context.gl.getAttribLocation(this._glName,a));return this._nameToAttribLocation[a]};a.prototype.setUniform1i=function(a,e){var d=this._nameToUniform1[a];if(void 0===d||e!==d)this._context.bindProgram(this),
this._context.gl.uniform1i(this.getUniformLocation(a),e),this._nameToUniform1[a]=e};a.prototype.setUniform1iv=function(g,f){var d=this._nameToUniform1v[g];e(d,f)&&(this._context.bindProgram(this),this._context.gl.uniform1iv(this.getUniformLocation(g),f),void 0===d?this._nameToUniform1v[g]=a._arrayCopy(f):a._arrayAssign(f,d))};a.prototype.setUniform2iv=function(g,f){var d=this._nameToUniform2[g];e(d,f)&&(this._context.bindProgram(this),this._context.gl.uniform2iv(this.getUniformLocation(g),f),void 0===
d?this._nameToUniform2[g]=a._arrayCopy(f):a._arrayAssign(f,d))};a.prototype.setUniform3iv=function(g,f){var d=this._nameToUniform3[g];e(d,f)&&(this._context.bindProgram(this),this._context.gl.uniform3iv(this.getUniformLocation(g),f),void 0===d?this._nameToUniform3[g]=a._arrayCopy(f):a._arrayAssign(f,d))};a.prototype.setUniform4iv=function(g,f){var d=this._nameToUniform4[g];e(d,f)&&(this._context.bindProgram(this),this._context.gl.uniform4iv(this.getUniformLocation(g),f),void 0===d?this._nameToUniform4[g]=
a._arrayCopy(f):a._arrayAssign(f,d))};a.prototype.setUniform1f=function(a,e){var d=this._nameToUniform1[a];if(void 0===d||e!==d)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(a),e),this._nameToUniform1[a]=e};a.prototype.setUniform1fv=function(g,f){var d=this._nameToUniform1v[g];e(d,f)&&(this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(g),f),void 0===d?this._nameToUniform1v[g]=a._arrayCopy(f):a._arrayAssign(f,d))};a.prototype.setUniform2f=
function(a,e,d){var c=this._nameToUniform2[a];if(void 0===c||e!==c[0]||d!==c[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(a),e,d),void 0===c?this._nameToUniform2[a]=[e,d]:(c[0]=e,c[1]=d)};a.prototype.setUniform2fv=function(g,f){var d=this._nameToUniform2[g];e(d,f)&&(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(g),f),void 0===d?this._nameToUniform2[g]=a._arrayCopy(f):a._arrayAssign(f,d))};a.prototype.setUniform3f=function(a,
e,d,c){var k=this._nameToUniform3[a];if(void 0===k||e!==k[0]||d!==k[1]||c!==k[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(a),e,d,c),void 0===k?this._nameToUniform3[a]=[e,d,c]:(k[0]=e,k[1]=d,k[2]=c)};a.prototype.setUniform3fv=function(g,f){var d=this._nameToUniform3[g];e(d,f)&&(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(g),f),void 0===d?this._nameToUniform3[g]=a._arrayCopy(f):a._arrayAssign(f,d))};a.prototype.setUniform4f=
function(a,e,d,c,k){var g=this._nameToUniform4[a];if(void 0===g||e!==g[0]||d!==g[1]||c!==g[2]||k!==g[3])this._context.bindProgram(this),this._context.gl.uniform4f(this.getUniformLocation(a),e,d,c,k),void 0===g?this._nameToUniform4[a]=[e,d,c,k]:(g[0]=e,g[1]=d,g[2]=c,g[3]=k)};a.prototype.setUniform4fv=function(g,f){var d=this._nameToUniform4[g];e(d,f)&&(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(g),f),void 0===d?this._nameToUniform4[g]=a._arrayCopy(f):a._arrayAssign(f,
d))};a.prototype.setUniformMatrix3fv=function(g,f,d){void 0===d&&(d=!1);var c=this._nameToUniformMatrix3[g],k;k=m.isNone(c)?!0:9!==c.length?e(c,f):9!==c.length||c[0]!==f[0]||c[1]!==f[1]||c[2]!==f[2]||c[3]!==f[3]||c[4]!==f[4]||c[5]!==f[5]||c[6]!==f[6]||c[7]!==f[7]||c[8]!==f[8];k&&(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(g),d,f),void 0===c?this._nameToUniformMatrix3[g]=a._arrayCopy(f):a._arrayAssign(f,c))};a.prototype.setUniformMatrix4fv=function(g,
f,d){void 0===d&&(d=!1);var c=this._nameToUniformMatrix4[g],k;k=m.isNone(c)?!0:16!==c.length?e(c,f):16!==c.length||c[0]!==f[0]||c[1]!==f[1]||c[2]!==f[2]||c[3]!==f[3]||c[4]!==f[4]||c[5]!==f[5]||c[6]!==f[6]||c[7]!==f[7]||c[8]!==f[8]||c[9]!==f[9]||c[10]!==f[10]||c[11]!==f[11]||c[12]!==f[12]||c[13]!==f[13]||c[14]!==f[14]||c[15]!==f[15];k&&(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(g),d,f),void 0===c?this._nameToUniformMatrix4[g]=a._arrayCopy(f):a._arrayAssign(f,
c))};a.prototype.assertCompatibleVertexAttributeLocations=function(a){(a=a.locations===this.locations)||console.error("VertexAttributeLocations are incompatible");return a};a._padToThree=function(a){var g=a.toString();1E3>a&&(g=("  "+a).slice(-3));return g};a.prototype._addLineNumbers=function(g){var e=2;return g.replace(/\n/g,function(){return"\n"+a._padToThree(e++)+":"})};a.prototype._loadShader=function(a){var g=35633===a,d=g?this._vertexShaderSource:this._fragmentShaderSource,c="",k;for(k in this._defines)c+=
"#define "+k+" "+this._defines[k]+"\n";d=c+d;"webgl2"===this._context.contextVersion&&(d=h.transpileShader(d,g?"vertex":"fragment"));g=this._context.gl;a=g.createShader(a);g.shaderSource(a,d);g.compileShader(a);return a};a._arrayCopy=function(a){for(var g=[],d=0;d<a.length;++d)g.push(a[d]);return g};a._arrayAssign=function(a,e){for(var d=0;d<a.length;++d)e[d]=a[d]};a._nextId=0;return a}()})},"esri/views/webgl/ShaderTranspiler":function(){define(["require","exports","./reservedWordsGLSL3","./lib/glsl-tokenizer/string"],
function(n,b,a,m){function h(a){return a.map(function(a){return"eof"!==a.type?a.data:""}).join("")}function e(a,d,c,k){k=k||c;for(var g=0;g<a.length;g++){var f=a[g];if("ident"===f.type&&f.data===c)return k in d?d[k]++:d[k]=0,e(a,d,k+"_"+d[k],k)}return c}function f(a,d,c){void 0===c&&(c="afterVersion");var k={data:"\n",type:"whitespace"},g=function(c){return c<a.length?/[^\r\n]$/.test(a[c].data):!1},e=function(a){for(var d=-1,k=0,g=-1,e=0;e<a.length;e++){var f=a[e];"preprocessor"===f.type&&(f.data.match(/\#(if|ifdef|ifndef)\s+.+/)?
++k:f.data.match(/\#endif\s*.*/)&&--k);("afterVersion"===c||"afterPrecision"===c)&&"preprocessor"===f.type&&/^#version/.test(f.data)&&(g=Math.max(g,e));if("afterPrecision"===c&&"keyword"===f.type&&"precision"===f.data){a:{for(f=e;f<a.length;f++){var l=a[f];if("operator"===l.type&&";"===l.data)break a}f=null}if(null===f)throw Error("precision statement not followed by any semicolons!");g=Math.max(g,f)}d<g&&0===k&&(d=e)}return d+1}(a);g(e-1)&&a.splice(e++,0,k);for(var f=0;f<d.length;f++){var l=d[f];
a.splice(e++,0,l)}g(e-1)&&g(e)&&a.splice(e,0,k)}Object.defineProperty(b,"__esModule",{value:!0});var g=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];b.transpileShader=function(l,d){l=m(l);var c;a:{c="100";var k="300 es";void 0===c&&(c="100");void 0===k&&(k="300 es");for(var b=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/,r=0;r<l.length;r++){var t=l[r];if("preprocessor"===t.type){var u=b.exec(t.data);if(u){b=u[1].replace(/\s\s+/g," ");if(b===k){c=
b;break a}if(b===c){t.data="#version "+k;break a}throw Error("unknown glsl version: "+b);}}}l.splice(0,0,{type:"preprocessor",data:"#version "+k},{type:"whitespace",data:"\n"});c=null}if("300 es"===c)throw Error("shader is already glsl 300 es");b=t=null;r={};u={};for(c=0;c<l.length;++c)switch(k=l[c],k.type){case "keyword":"vertex"===d&&"attribute"===k.data?k.data="in":"varying"===k.data&&(k.data="vertex"===d?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(k.data.trim())&&
(k.data=k.data.replace(/(2D|Cube|EXT)/g,""));if("fragment"===d&&"gl_FragColor"===k.data){if(!t){var t=e(l,r,"fragColor"),v=void 0;void 0===v&&(v="lowp");f(l,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:v},{type:"whitespace",data:" "},{type:"keyword",data:"vec4"},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}k.data=t}else"fragment"===d&&"gl_FragDepthEXT"===k.data&&(b||(b=e(l,r,"gl_FragDepth")),k.data=b);break;case "ident":if(0<=
a.indexOf(k.data)){if(v="vertex"===d)a:{for(v=c-1;0<=v;v--){var z=l[v];if("whitespace"!==z.type&&"block-comment"!==z.type)if("keyword"===z.type){if("attribute"===z.data||"in"===z.data){v=!0;break a}}else break}v=!1}if(v)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");k.data in u||(u[k.data]=e(l,r,k.data));k.data=u[k.data]}}for(c=l.length-1;0<=c;--c)k=l[c],"preprocessor"===k.type&&((d=k.data.match(/\#extension\s+(.*)\:/))&&d[1]&&0<=g.indexOf(d[1].trim())&&
(d=l[c+1],l.splice(c,d&&"whitespace"===d.type?2:1)),(d=k.data.match(/\#ifdef\s+(.*)/))&&d[1]&&0<=g.indexOf(d[1].trim())&&(k.data="#if 1"),(d=k.data.match(/\#ifndef\s+(.*)/))&&d[1]&&0<=g.indexOf(d[1].trim())&&(k.data="#if 0"));return h(l)}})},"esri/views/webgl/reservedWordsGLSL3":function(){define(["require","exports"],function(n,b){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/string":function(){define(["./index"],function(n){"use strict;";return function(b){var a=n(),m=[],m=m.concat(a(b));return m=m.concat(a(null))}})},"esri/views/webgl/lib/glsl-tokenizer/index":function(){define(["./lib/literals","./lib/operators","./lib/builtins"],function(n,b,a){"use strict;";var m="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");return function(){function h(c){c.length&&z.push({type:m[r],
data:c,position:y,line:w,column:q})}function e(){v=v.length?[]:v;if("/"===u&&"*"===t)return y=p+k-1,r=0,u=t,k+1;if("/"===u&&"/"===t)return y=p+k-1,r=1,u=t,k+1;if("#"===t)return r=2,y=p+k,k;if(/\s/.test(t))return r=9,y=p+k,k;A=/\d/.test(t);B=/[^\w_]/.test(t);y=p+k;r=A?4:B?3:9999;return k}function f(){if(("\r"===t||"\n"===t)&&"\\"!==u)return h(v.join("")),r=999,k;v.push(t);u=t;return k+1}function g(){if("."===u&&/\d/.test(t))return r=5,k;if("/"===u&&"*"===t)return r=0,k;if("/"===u&&"/"===t)return r=
1,k;if("."===t&&v.length){for(;l(v););r=5;return k}if(";"===t||")"===t||"("===t){if(v.length)for(;l(v););h(t);r=999;return k+1}var c=2===v.length&&"\x3d"!==t;if(/[\w_\d\s]/.test(t)||c){for(;l(v););r=999;return k}v.push(t);u=t;return k+1}function l(c){var a=0,d,k;do{d=b.indexOf(c.slice(0,c.length+a).join(""));k=b[d];if(-1===d){if(0<a--+c.length)continue;k=c.slice(0,1).join("")}h(k);y+=k.length;v=v.slice(k.length);return v.length}while(1)}function d(){if("."===t||/[eE]/.test(t))return v.push(t),r=5,
u=t,k+1;if("x"===t&&1===v.length&&"0"===v[0])return r=11,v.push(t),u=t,k+1;if(/[^\d]/.test(t))return h(v.join("")),r=999,k;v.push(t);u=t;return k+1}function c(){"f"===t&&(v.push(t),u=t,k+=1);if(/[eE]/.test(t)||"-"===t&&/[eE]/.test(u))return v.push(t),u=t,k+1;if(/[^\d]/.test(t))return h(v.join("")),r=999,k;v.push(t);u=t;return k+1}var k=0,p=0,r=999,t,u,v=[],z=[],w=1,q=0,y=0,A=!1,B=!1,C="",F;return function(l){z=[];if(null!==l){l=l.replace?l.replace(/\r\n/g,"\n"):l;k=0;C+=l;for(F=C.length;t=C[k],k<
F;){l=k;switch(r){case 0:"/"===t&&"*"===u?(v.push(t),h(v.join("")),r=999):(v.push(t),u=t);k+=1;break;case 1:k=f();break;case 2:k=f();break;case 3:k=g();break;case 4:k=d();break;case 11:/[^a-fA-F0-9]/.test(t)?(h(v.join("")),r=999):(v.push(t),u=t,k+=1);break;case 5:k=c();break;case 9999:if(/[^\d\w_]/.test(t)){var b=v.join("");r=-1<n.indexOf(b)?8:-1<a.indexOf(b)?7:6;h(v.join(""));r=999}else v.push(t),u=t,k+=1;break;case 9:/[^\s]/g.test(t)?(h(v.join("")),r=999):(v.push(t),u=t,k+=1);break;case 999:k=e()}if(l!==
k)switch(C[l]){case "\n":q=0;++w;break;default:++q}}p+=k;C=C.slice(k);return z}v.length&&h(v.join(""));r=10;h("(eof)");return z}}})},"esri/views/webgl/lib/glsl-tokenizer/lib/literals":function(){define([],function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/lib/operators":function(){define([],function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})},"esri/views/webgl/lib/glsl-tokenizer/lib/builtins":function(){define([],function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})},
"esri/views/webgl/renderState":function(){define(["require","exports","tslib"],function(n,b,a){function m(c){return y.intern(c)}function h(c){return A.intern(c)}function e(c){return B.intern(c)}function f(c){return C.intern(c)}function g(c){return F.intern(c)}function l(c){return H.intern(c)}function d(c){return I.intern(c)}function c(c){return G.intern(c)}function k(c){return"["+c.join(",")+"]"}function p(c){return c?k([c.srcRgb,c.srcAlpha,c.dstRgb,c.dstAlpha,c.opRgb,c.opAlpha,c.color.r,c.color.g,
c.color.b,c.color.a]):null}function r(c){return c?k([c.face,c.mode]):null}function t(c){return c?k([c.factor,c.units]):null}function u(c){return c?k([c.func]):null}function v(c){return c?k([c.function.func,c.function.ref,c.function.mask,c.operation.fail,c.operation.zFail,c.operation.zPass]):null}function z(c){return c?k([c.zNear,c.zFar]):null}function w(c){return c?k([c.r,c.g,c.b,c.a]):null}function q(c){return c?k([c.mask]):null}Object.defineProperty(b,"__esModule",{value:!0});b.simpleBlendingParams=
function(c,a,d,k){void 0===d&&(d=32774);void 0===k&&(k=[0,0,0,0]);return{srcRgb:c,srcAlpha:c,dstRgb:a,dstAlpha:a,opRgb:d,opAlpha:d,color:{r:k[0],g:k[1],b:k[2],a:k[3]}}};b.separateBlendingParams=function(c,a,d,k,g,e,f){void 0===g&&(g=32774);void 0===e&&(e=32774);void 0===f&&(f=[0,0,0,0]);return{srcRgb:c,srcAlpha:a,dstRgb:d,dstAlpha:k,opRgb:g,opAlpha:e,color:{r:f[0],g:f[1],b:f[2],a:f[3]}}};b.backFaceCullingParams={face:1029,mode:2305};b.defaultDepthWriteParams={zNear:0,zFar:1};b.defaultColorWriteParams=
{r:!0,g:!0,b:!0,a:!0};b.makeBlending=m;b.makeCulling=h;b.makePolygonOffset=e;b.makeDepthTest=f;b.makeStencilTest=g;b.makeDepthWrite=l;b.makeColorWrite=d;b.makeStencilWrite=c;b.makePipelineState=function(c){return J.intern(c)};n=function(){function c(c,a){this.makeKey=c;this.makeRef=a;this.interns=new Map}c.prototype.intern=function(c){if(!c)return null;var a=this.makeKey(c),d=this.interns;d.has(a)||d.set(a,this.makeRef(c));return d.get(a)};return c}();var y=new n(p,function(c){return a.__assign({__tag:"Blending"},
c)}),A=new n(r,function(c){return a.__assign({__tag:"Culling"},c)}),B=new n(t,function(c){return a.__assign({__tag:"PolygonOffset"},c)}),C=new n(u,function(c){return a.__assign({__tag:"DepthTest"},c)}),F=new n(v,function(c){return a.__assign({__tag:"StencilTest"},c)}),H=new n(z,function(c){return a.__assign({__tag:"DepthWrite"},c)}),I=new n(w,function(c){return a.__assign({__tag:"ColorWrite"},c)}),G=new n(q,function(c){return a.__assign({__tag:"StencilWrite"},c)}),J=new n(function(c){return c?k([p(c.blending),
r(c.culling),t(c.polygonOffset),u(c.depthTest),v(c.stencilTest),z(c.depthWrite),w(c.colorWrite),q(c.stencilWrite)]):null},function(a){return{blending:m(a.blending),culling:h(a.culling),polygonOffset:e(a.polygonOffset),depthTest:f(a.depthTest),stencilTest:g(a.stencilTest),depthWrite:l(a.depthWrite),colorWrite:d(a.colorWrite),stencilWrite:c(a.stencilWrite)}});n=function(){function c(c){this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=
this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=c}c.prototype.setPipeline=function(c){if(this._pipelineInvalid||c!==this._pipeline)this.setBlending(c.blending),this.setCulling(c.culling),this.setPolygonOffset(c.polygonOffset),this.setDepthTest(c.depthTest),this.setStencilTest(c.stencilTest),this.setDepthWrite(c.depthWrite),this.setColorWrite(c.colorWrite),this.setStencilWrite(c.stencilWrite),this._pipeline=c;this._pipelineInvalid=!1};
c.prototype.invalidateBlending=function(){this._pipelineInvalid=this._blendingInvalid=!0};c.prototype.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};c.prototype.invalidatePolygonOffset=function(){this._pipelineInvalid=this._polygonOffsetInvalid=!0};c.prototype.invalidateDepthTest=function(){this._pipelineInvalid=this._depthTestInvalid=!0};c.prototype.invalidateStencilTest=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};c.prototype.invalidateDepthWrite=function(){this._pipelineInvalid=
this._depthWriteInvalid=!0};c.prototype.invalidateColorWrite=function(){this._pipelineInvalid=this._colorWriteInvalid=!0};c.prototype.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};c.prototype.setBlending=function(c){this._blending=this.setSubState(c,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=!1};c.prototype.setCulling=function(c){this._culling=this.setSubState(c,this._culling,this._cullingInvalid,this._stateSetters.setCulling);
this._cullingInvalid=!1};c.prototype.setPolygonOffset=function(c){this._polygonOffset=this.setSubState(c,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};c.prototype.setDepthTest=function(c){this._depthTest=this.setSubState(c,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1};c.prototype.setStencilTest=function(c){this._stencilTest=this.setSubState(c,this._stencilTest,this._stencilTestInvalid,
this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};c.prototype.setDepthWrite=function(c){this._depthWrite=this.setSubState(c,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1};c.prototype.setColorWrite=function(c){this._colorWrite=this.setSubState(c,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1};c.prototype.setStencilWrite=function(c){this._stencilWrite=this.setSubState(c,this._stencilWrite,
this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};c.prototype.setSubState=function(c,a,d,k){if(d||c!==a)k(c),this._pipelineInvalid=!0;return c};return c}();b.StateTracker=n})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["require","exports"],function(n,b){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAAB3RJTUUH4QkLDx4bnqU2+QAAAd1JREFUSMd9lkmWxDAIQ/Xluv+V0wuDjaeuhV+IGQUoJUnNwGfAVvx+lsBCWJIsCaMpQn8nuhgqyyEzbAX1Ih0oHaQZN5X5jul581diaDVbSgAdZv1YLoCLyn/RruCsOdcqR7RS/jXkLMa9UddcDn9O7G8gwprzs6xbQl/Fns3BE90r9veQ/wzNrTM5p1yDF1yokLCosDX5kik1lxeSWxfWsihN/lZcHuPIOuhccZ4Ovt74qQK3USkFzsQx7Ki5NgqoMI1J5ILztr9UrGoGHN2qnSEwOHiD97ByDghs/KIVYp9DfdIIoJPcBkWWnM2O2s5ru3su+8GdPLhM5048r/09UDsZmJ3HRwe5MT/aA9Ul4cG74+lIvICYlZcFY42B6vAzuz/HEVn5VbP3DDgQ7xuAGZtnI76cEkbPczDDgSMDR8iFkfBMTQV728mnsx84GopNWZxQsWJxbI9pD0hmNAzWB8bun41hRk+3mNlRFvbY86mcMEVCWWAX+xJbERJHWVPP3Wkq91uyDtuKDLrYNKLl7bww6rZulo3jnafyePJ64ZZi67aEl0MkbJtTbE1h+2vIzVOU3JwWISrNyNtfi+9xqECIXZk87ODcEMeBhjj41GN1Xf+DzP9c9UmPd39C1BID2rDpAwAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/support/imageUtils":function(){define(["require","exports","tslib","../../../request"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.requestImage=function(b,e){return m(b,a.__assign({responseType:"image"},e)).then(function(a){return a.data})}})},"esri/views/3d/support/buffer/glUtil":function(){define(["require","exports","tslib"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});var m={divisor:0};b.glLayout=function(e,f){void 0===f&&(f={});f=a.__assign(a.__assign({},
m),f);var g=e.stride;return e.fieldNames.filter(function(a){a=e.fields.get(a).optional;return!(a&&a.glPadding)}).map(function(a){var d=e.fields.get(a),c=d.constructor.ElementCount;var k=h[d.constructor.ElementType];if(!k)throw Error("BufferType not supported in WebGL");return{name:a,stride:g,count:c,type:k,offset:d.offset,normalized:!(!d.optional||!d.optional.glNormalized),divisor:f.divisor}})};var h={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["require",
"exports","./BufferView","./types"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a,e){this.layout=a;this.buffer="number"===typeof e?new ArrayBuffer(e*a.stride):e;e=0;for(var d=a.fieldNames;e<d.length;e++){var c=d[e],k=a.fields.get(c);this[c]=new k.constructor(this.buffer,k.offset,this.stride)}}Object.defineProperty(a.prototype,"stride",{get:function(){return this.layout.stride},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"count",
{get:function(){return this.buffer.byteLength/this.stride},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"byteLength",{get:function(){return this.buffer.byteLength},enumerable:!0,configurable:!0});a.prototype.getField=function(a,e){return(a=this[a])&&a.elementCount===e.ElementCount&&a.elementType===e.ElementType?a:null};a.prototype.slice=function(g,e){return new a(this.layout,this.buffer.slice(g*this.stride,e*this.stride))};a.prototype.copyFrom=function(a,e,d,c){var k=this.stride;
0===k%4?(a=new Uint32Array(a.buffer,e*k,c*k/4),d=new Uint32Array(this.buffer,d*k,c*k/4)):(a=new Uint8Array(a.buffer,e*k,c*k),d=new Uint8Array(this.buffer,d*k,c*k));d.set(a)};return a}();b.InterleavedBuffer=h;var e=function(){function e(){this.stride=0;this.fields=new Map;this.fieldNames=[]}e.prototype.vec2f=function(e,f){this.appendField(e,a.BufferViewVec2f,f);return this};e.prototype.vec2f64=function(e,f){this.appendField(e,a.BufferViewVec2f64,f);return this};e.prototype.vec3f=function(e,f){this.appendField(e,
a.BufferViewVec3f,f);return this};e.prototype.vec3f64=function(e,f){this.appendField(e,a.BufferViewVec3f64,f);return this};e.prototype.vec4f=function(e,f){this.appendField(e,a.BufferViewVec4f,f);return this};e.prototype.vec4f64=function(e,f){this.appendField(e,a.BufferViewVec4f64,f);return this};e.prototype.mat3f=function(e,f){this.appendField(e,a.BufferViewMat3f,f);return this};e.prototype.mat3f64=function(e,f){this.appendField(e,a.BufferViewMat3f64,f);return this};e.prototype.mat4f=function(e,f){this.appendField(e,
a.BufferViewMat4f,f);return this};e.prototype.mat4f64=function(e,f){this.appendField(e,a.BufferViewMat4f64,f);return this};e.prototype.vec4u8=function(e,f){this.appendField(e,a.BufferViewVec4u8,f);return this};e.prototype.f32=function(e,f){this.appendField(e,a.BufferViewFloat,f);return this};e.prototype.f64=function(e,f){this.appendField(e,a.BufferViewFloat64,f);return this};e.prototype.u8=function(e,f){this.appendField(e,a.BufferViewUint8,f);return this};e.prototype.u16=function(e,f){this.appendField(e,
a.BufferViewUint16,f);return this};e.prototype.i8=function(e,f){this.appendField(e,a.BufferViewInt8,f);return this};e.prototype.vec2i8=function(e,f){this.appendField(e,a.BufferViewVec2i8,f);return this};e.prototype.vec2i16=function(e,f){this.appendField(e,a.BufferViewVec2i16,f);return this};e.prototype.vec2u8=function(e,f){this.appendField(e,a.BufferViewVec2u8,f);return this};e.prototype.vec4u16=function(e,f){this.appendField(e,a.BufferViewVec4u16,f);return this};e.prototype.u32=function(e,f){this.appendField(e,
a.BufferViewUint32,f);return this};e.prototype.appendField=function(a,e,d){var c=e.ElementCount*m.elementTypeSize(e.ElementType);this.fields.set(a,{size:c,constructor:e,offset:this.stride,optional:d});this.stride+=c;this.fieldNames.push(a)};e.prototype.alignTo=function(a){this.stride=Math.floor((this.stride+a-1)/a)*a;return this};e.prototype.hasField=function(a){return 0<=this.fieldNames.indexOf(a)};e.prototype.createBuffer=function(a){return new h(this,a)};e.prototype.createView=function(a){return new h(this,
a)};e.prototype.clone=function(){var a=new e;a.stride=this.stride;a.fields=new Map;this.fields.forEach(function(e,d){return a.fields.set(d,e)});a.fieldNames=this.fieldNames.slice();a.BufferType=this.BufferType;return a};return e}();b.InterleavedLayout=e;b.newLayout=function(){return new e}})},"esri/views/3d/support/buffer/BufferView":function(){define("require exports tslib ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(n,
b,a,m,h,e,f,g,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Float32Array,c,a,e,g)||this;c.elementType="f32";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f32";return c}(e.BufferViewScalarImpl);b.BufferViewFloat=n;n=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Float32Array,c,a,e,g)||this;c.elementType="f32";return c}a.__extends(c,
d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f32";return c}(f.BufferViewVec2Impl);b.BufferViewVec2f=n;n=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Float32Array,c,a,e,g)||this;c.elementType="f32";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f32";return c}(g.BufferViewVec3Impl);b.BufferViewVec3f=n;n=function(d){function c(c,
a,e,g){void 0===a&&(a=0);c=d.call(this,Float32Array,c,a,e,g)||this;c.elementType="f32";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f32";return c}(l.BufferViewVec4Impl);b.BufferViewVec4f=n;n=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Float32Array,c,a,e,g)||this;c.elementType="f32";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+
a.byteLength)};c.ElementType="f32";return c}(m.BufferViewMat3Impl);b.BufferViewMat3f=n;m=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Float64Array,c,a,e,g)||this;c.elementType="f64";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f64";return c}(m.BufferViewMat3Impl);b.BufferViewMat3f64=m;m=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Float32Array,c,a,e,g)||this;c.elementType=
"f32";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f32";return c}(h.BufferViewMat4Impl);b.BufferViewMat4f=m;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Float64Array,c,a,e,g)||this;c.elementType="f64";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f64";return c}(h.BufferViewMat4Impl);b.BufferViewMat4f64=
h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Float64Array,c,a,e,g)||this;c.elementType="f64";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f64";return c}(e.BufferViewScalarImpl);b.BufferViewFloat64=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Float64Array,c,a,e,g)||this;c.elementType="f64";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,
a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f64";return c}(f.BufferViewVec2Impl);b.BufferViewVec2f64=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Float64Array,c,a,e,g)||this;c.elementType="f64";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f64";return c}(g.BufferViewVec3Impl);b.BufferViewVec3f64=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Float64Array,
c,a,e,g)||this;c.elementType="f64";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f64";return c}(l.BufferViewVec4Impl);b.BufferViewVec4f64=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Uint8Array,c,a,e,g)||this;c.elementType="u8";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u8";return c}(e.BufferViewScalarImpl);
b.BufferViewUint8=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Uint8Array,c,a,e,g)||this;c.elementType="u8";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u8";return c}(f.BufferViewVec2Impl);b.BufferViewVec2u8=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Uint8Array,c,a,e,g)||this;c.elementType="u8";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,
a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u8";return c}(g.BufferViewVec3Impl);b.BufferViewVec3u8=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Uint8Array,c,a,e,g)||this;c.elementType="u8";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u8";return c}(l.BufferViewVec4Impl);b.BufferViewVec4u8=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Uint16Array,c,a,
e,g)||this;c.elementType="u16";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u16";return c}(e.BufferViewScalarImpl);b.BufferViewUint16=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Uint16Array,c,a,e,g)||this;c.elementType="u16";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u16";return c}(f.BufferViewVec2Impl);
b.BufferViewVec2u16=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Uint16Array,c,a,e,g)||this;c.elementType="u16";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u16";return c}(g.BufferViewVec3Impl);b.BufferViewVec3u16=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Uint16Array,c,a,e,g)||this;c.elementType="u16";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,
a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u16";return c}(l.BufferViewVec4Impl);b.BufferViewVec4u16=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Uint32Array,c,a,e,g)||this;c.elementType="u32";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u32";return c}(e.BufferViewScalarImpl);b.BufferViewUint32=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Uint32Array,
c,a,e,g)||this;c.elementType="u32";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u32";return c}(f.BufferViewVec2Impl);b.BufferViewVec2u32=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Uint32Array,c,a,e,g)||this;c.elementType="u32";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u32";return c}(g.BufferViewVec3Impl);
b.BufferViewVec3u32=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Uint32Array,c,a,e,g)||this;c.elementType="u32";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u32";return c}(l.BufferViewVec4Impl);b.BufferViewVec4u32=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Int8Array,c,a,e,g)||this;c.elementType="i8";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,
a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i8";return c}(e.BufferViewScalarImpl);b.BufferViewInt8=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Int8Array,c,a,e,g)||this;c.elementType="i8";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i8";return c}(f.BufferViewVec2Impl);b.BufferViewVec2i8=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Int8Array,c,a,e,
g)||this;c.elementType="i8";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i8";return c}(g.BufferViewVec3Impl);b.BufferViewVec3i8=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Int8Array,c,a,e,g)||this;c.elementType="i8";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i8";return c}(l.BufferViewVec4Impl);
b.BufferViewVec4i8=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Int16Array,c,a,e,g)||this;c.elementType="i16";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i16";return c}(e.BufferViewScalarImpl);b.BufferViewInt16=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Int16Array,c,a,e,g)||this;c.elementType="i16";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,
a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i16";return c}(f.BufferViewVec2Impl);b.BufferViewVec2i16=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Int16Array,c,a,e,g)||this;c.elementType="i16";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i16";return c}(g.BufferViewVec3Impl);b.BufferViewVec3i16=h;h=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Int16Array,
c,a,e,g)||this;c.elementType="i16";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i16";return c}(l.BufferViewVec4Impl);b.BufferViewVec4i16=h;e=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Int32Array,c,a,e,g)||this;c.elementType="i32";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i32";return c}(e.BufferViewScalarImpl);
b.BufferViewInt32=e;f=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Int32Array,c,a,e,g)||this;c.elementType="i32";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i32";return c}(f.BufferViewVec2Impl);b.BufferViewVec2i32=f;g=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Int32Array,c,a,e,g)||this;c.elementType="i32";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,
a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i32";return c}(g.BufferViewVec3Impl);b.BufferViewVec3i32=g;l=function(d){function c(c,a,e,g){void 0===a&&(a=0);c=d.call(this,Int32Array,c,a,e,g)||this;c.elementType="i32";return c}a.__extends(c,d);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i32";return c}(l.BufferViewVec4Impl);b.BufferViewVec4i32=l})},"esri/views/3d/support/buffer/internals/Mat3":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a,b,e,f,g){void 0===e&&(e=0);this.TypedArrayConstructor=a;this.elementCount=9;a=this.TypedArrayConstructor;void 0===f&&(f=9*a.BYTES_PER_ELEMENT);var l=0===b.byteLength?0:e;this.typedBuffer=null==g?new a(b,l):new a(b,l,(g-e)/a.BYTES_PER_ELEMENT);this.typedBufferStride=f/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}
a.prototype.getMat=function(a,b){a*=this.typedBufferStride;for(var e=0;9>e;e++)b[e]=this.typedBuffer[a+e];return b};a.prototype.setMat=function(a,b){a*=this.typedBufferStride;for(var e=0;9>e;e++)this.typedBuffer[a+e]=b[e]};a.prototype.get=function(a,b){return this.typedBuffer[a*this.typedBufferStride+b]};a.prototype.set=function(a,b,e){this.typedBuffer[a*this.typedBufferStride+b]=e};a.prototype.copyFrom=function(a,b,e){var f=this.typedBuffer,g=b.typedBuffer;a*=this.typedBufferStride;b=e*b.typedBufferStride;
for(e=0;9>e;++e)f[a+e]=g[b+e]};Object.defineProperty(a.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});a.ElementCount=9;return a}();b.BufferViewMat3Impl=n})},"esri/views/3d/support/buffer/internals/Mat4":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a,b,e,f,g){void 0===e&&(e=0);this.TypedArrayConstructor=a;this.elementCount=16;a=this.TypedArrayConstructor;void 0===f&&
(f=16*a.BYTES_PER_ELEMENT);var l=0===b.byteLength?0:e;this.typedBuffer=null==g?new a(b,l):new a(b,l,(g-e)/a.BYTES_PER_ELEMENT);this.typedBufferStride=f/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}a.prototype.getMat=function(a,b){a*=this.typedBufferStride;for(var e=0;16>e;e++)b[e]=this.typedBuffer[a+e];return b};a.prototype.setMat=function(a,b){a*=this.typedBufferStride;for(var e=
0;16>e;e++)this.typedBuffer[a+e]=b[e]};a.prototype.get=function(a,b){return this.typedBuffer[a*this.typedBufferStride+b]};a.prototype.set=function(a,b,e){this.typedBuffer[a*this.typedBufferStride+b]=e};a.prototype.copyFrom=function(a,b,e){var f=this.typedBuffer,g=b.typedBuffer;a*=this.typedBufferStride;b=e*b.typedBufferStride;for(e=0;16>e;++e)f[a+e]=g[b+e]};Object.defineProperty(a.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});a.ElementCount=16;
return a}();b.BufferViewMat4Impl=n})},"esri/views/3d/support/buffer/internals/Scalar":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a,b,e,f,g){void 0===e&&(e=0);this.TypedArrayConstructor=a;this.elementCount=1;a=this.TypedArrayConstructor;void 0===f&&(f=a.BYTES_PER_ELEMENT);var l=0===b.byteLength?0:e;this.typedBuffer=null==g?new a(b,l):new a(b,l,(g-e)/a.BYTES_PER_ELEMENT);this.typedBufferStride=f/a.BYTES_PER_ELEMENT;
this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}a.prototype.get=function(a){return this.typedBuffer[a*this.typedBufferStride]};a.prototype.set=function(a,b){this.typedBuffer[a*this.typedBufferStride]=b};Object.defineProperty(a.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});a.ElementCount=1;return a}();b.BufferViewScalarImpl=n})},"esri/views/3d/support/buffer/internals/Vec2":function(){define(["require",
"exports","../../../../../core/libs/gl-matrix-2/vec2"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,e,f,g,b){void 0===f&&(f=0);this.TypedArrayConstructor=a;this.elementCount=2;a=this.TypedArrayConstructor;void 0===g&&(g=2*a.BYTES_PER_ELEMENT);var d=0===e.byteLength?0:f;this.typedBuffer=null==b?new a(e,d):new a(e,d,(b-f)/a.BYTES_PER_ELEMENT);this.typedBufferStride=g/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);
this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.getVec=function(b,e){return a.vec2.set(e,this.typedBuffer[b*this.typedBufferStride],this.typedBuffer[b*this.typedBufferStride+1])};b.prototype.setVec=function(a,e){this.typedBuffer[a*this.typedBufferStride]=e[0];this.typedBuffer[a*this.typedBufferStride+1]=e[1]};b.prototype.get=function(a,e){return this.typedBuffer[a*this.typedBufferStride+e]};b.prototype.set=function(a,e,f){this.typedBuffer[a*this.typedBufferStride+
e]=f};b.prototype.setValues=function(a,e,f){this.typedBuffer[a*this.typedBufferStride]=e;this.typedBuffer[a*this.typedBufferStride+1]=f};b.prototype.copyFrom=function(a,e,f){var g=this.typedBuffer,b=e.typedBuffer;a*=this.typedBufferStride;e=f*e.typedBufferStride;g[a]=b[e];g[a+1]=b[e+1]};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=2;return b}();b.BufferViewVec2Impl=n})},"esri/core/libs/gl-matrix-2/vec2":function(){define(["require",
"exports","./math/vec2"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.vec2=a})},"esri/core/libs/gl-matrix-2/math/vec2":function(){define(["require","exports","./common"],function(n,b,a){function m(c,a,d){c[0]=a[0]-d[0];c[1]=a[1]-d[1];return c}function h(c,a,d){c[0]=a[0]*d[0];c[1]=a[1]*d[1];return c}function e(c,a,d){c[0]=a[0]/d[0];c[1]=a[1]/d[1];return c}function f(c,a){var d=a[0]-c[0];c=a[1]-c[1];return Math.sqrt(d*d+c*c)}function g(c,a){var d=a[0]-c[0];c=a[1]-c[1];return d*
d+c*c}function l(c){var a=c[0];c=c[1];return Math.sqrt(a*a+c*c)}function d(c){var a=c[0];c=c[1];return a*a+c*c}Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(c,a){c[0]=a[0];c[1]=a[1];return c};b.set=function(c,a,d){c[0]=a;c[1]=d;return c};b.add=function(c,a,d){c[0]=a[0]+d[0];c[1]=a[1]+d[1];return c};b.subtract=m;b.multiply=h;b.divide=e;b.ceil=function(c,a){c[0]=Math.ceil(a[0]);c[1]=Math.ceil(a[1]);return c};b.floor=function(c,a){c[0]=Math.floor(a[0]);c[1]=Math.floor(a[1]);return c};
b.min=function(c,a,d){c[0]=Math.min(a[0],d[0]);c[1]=Math.min(a[1],d[1]);return c};b.max=function(c,a,d){c[0]=Math.max(a[0],d[0]);c[1]=Math.max(a[1],d[1]);return c};b.round=function(c,a){c[0]=Math.round(a[0]);c[1]=Math.round(a[1]);return c};b.scale=function(c,a,d){c[0]=a[0]*d;c[1]=a[1]*d;return c};b.scaleAndAdd=function(c,a,d,e){c[0]=a[0]+d[0]*e;c[1]=a[1]+d[1]*e;return c};b.distance=f;b.squaredDistance=g;b.length=l;b.squaredLength=d;b.negate=function(c,a){c[0]=-a[0];c[1]=-a[1];return c};b.inverse=
function(c,a){c[0]=1/a[0];c[1]=1/a[1];return c};b.normalize=function(c,a){var d=a[0],e=a[1],d=d*d+e*e;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d);return c};b.dot=function(c,a){return c[0]*a[0]+c[1]*a[1]};b.cross=function(c,a,d){a=a[0]*d[1]-a[1]*d[0];c[0]=c[1]=0;c[2]=a;return c};b.lerp=function(c,a,d,e){var g=a[0];a=a[1];c[0]=g+e*(d[0]-g);c[1]=a+e*(d[1]-a);return c};b.random=function(c,d){d=d||1;var e=2*a.RANDOM()*Math.PI;c[0]=Math.cos(e)*d;c[1]=Math.sin(e)*d;return c};b.transformMat2=function(c,
a,d){var e=a[0];a=a[1];c[0]=d[0]*e+d[2]*a;c[1]=d[1]*e+d[3]*a;return c};b.transformMat2d=function(c,a,d){var e=a[0];a=a[1];c[0]=d[0]*e+d[2]*a+d[4];c[1]=d[1]*e+d[3]*a+d[5];return c};b.transformMat3=function(c,a,d){var e=a[0];a=a[1];c[0]=d[0]*e+d[3]*a+d[6];c[1]=d[1]*e+d[4]*a+d[7];return c};b.transformMat4=function(c,a,d){var e=a[0];a=a[1];c[0]=d[0]*e+d[4]*a+d[12];c[1]=d[1]*e+d[5]*a+d[13];return c};b.rotate=function(c,a,d,e){var g=a[0]-d[0];a=a[1]-d[1];var k=Math.sin(e);e=Math.cos(e);c[0]=g*e-a*k+d[0];
c[1]=g*k+a*e+d[1];return c};b.angle=function(c,a){var d=c[0];c=c[1];var e=a[0];a=a[1];var g=d*d+c*c;0<g&&(g=1/Math.sqrt(g));var f=e*e+a*a;0<f&&(f=1/Math.sqrt(f));d=(d*e+c*a)*g*f;return 1<d?0:-1>d?Math.PI:Math.acos(d)};b.str=function(c){return"vec2("+c[0]+", "+c[1]+")"};b.exactEquals=function(c,a){return c[0]===a[0]&&c[1]===a[1]};b.equals=function(c,d){var e=c[0];c=c[1];var g=d[0];d=d[1];return Math.abs(e-g)<=a.EPSILON*Math.max(1,Math.abs(e),Math.abs(g))&&Math.abs(c-d)<=a.EPSILON*Math.max(1,Math.abs(c),
Math.abs(d))};b.len=l;b.sub=m;b.mul=h;b.div=e;b.dist=f;b.sqrDist=g;b.sqrLen=d})},"esri/views/3d/support/buffer/internals/Vec3":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec3"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,e,f,g,b){void 0===f&&(f=0);this.TypedArrayConstructor=a;this.elementCount=3;a=this.TypedArrayConstructor;void 0===g&&(g=3*a.BYTES_PER_ELEMENT);var d=0===e.byteLength?0:f;this.typedBuffer=null==b?new a(e,
d):new a(e,d,(b-f)/a.BYTES_PER_ELEMENT);this.typedBufferStride=g/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.getVec=function(b,e){return a.vec3.set(e,this.typedBuffer[b*this.typedBufferStride],this.typedBuffer[b*this.typedBufferStride+1],this.typedBuffer[b*this.typedBufferStride+2])};b.prototype.setVec=function(a,e){this.typedBuffer[a*this.typedBufferStride]=e[0];
this.typedBuffer[a*this.typedBufferStride+1]=e[1];this.typedBuffer[a*this.typedBufferStride+2]=e[2]};b.prototype.get=function(a,e){return this.typedBuffer[a*this.typedBufferStride+e]};b.prototype.set=function(a,e,f){this.typedBuffer[a*this.typedBufferStride+e]=f};b.prototype.setValues=function(a,e,f,g){this.typedBuffer[a*this.typedBufferStride]=e;this.typedBuffer[a*this.typedBufferStride+1]=f;this.typedBuffer[a*this.typedBufferStride+2]=g};b.prototype.copyFrom=function(a,e,f){var g=this.typedBuffer,
b=e.typedBuffer;a*=this.typedBufferStride;e=f*e.typedBufferStride;g[a]=b[e];g[a+1]=b[e+1];g[a+2]=b[e+2]};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=3;return b}();b.BufferViewVec3Impl=n})},"esri/views/3d/support/buffer/internals/Vec4":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec4"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,
e,f,g,b){void 0===f&&(f=0);this.TypedArrayConstructor=a;this.elementCount=4;a=this.TypedArrayConstructor;void 0===g&&(g=4*a.BYTES_PER_ELEMENT);var d=0===e.byteLength?0:f;this.typedBuffer=null==b?new a(e,d):new a(e,d,(b-f)/a.BYTES_PER_ELEMENT);this.typedBufferStride=g/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.getVec=function(b,e){return a.vec4.set(e,this.typedBuffer[b*
this.typedBufferStride],this.typedBuffer[b*this.typedBufferStride+1],this.typedBuffer[b*this.typedBufferStride+2],this.typedBuffer[b*this.typedBufferStride+3])};b.prototype.setVec=function(a,e){this.typedBuffer[a*this.typedBufferStride]=e[0];this.typedBuffer[a*this.typedBufferStride+1]=e[1];this.typedBuffer[a*this.typedBufferStride+2]=e[2];this.typedBuffer[a*this.typedBufferStride+3]=e[3]};b.prototype.get=function(a,e){return this.typedBuffer[a*this.typedBufferStride+e]};b.prototype.set=function(a,
e,f){this.typedBuffer[a*this.typedBufferStride+e]=f};b.prototype.setValues=function(a,e,f,g,b){this.typedBuffer[a*this.typedBufferStride]=e;this.typedBuffer[a*this.typedBufferStride+1]=f;this.typedBuffer[a*this.typedBufferStride+2]=g;this.typedBuffer[a*this.typedBufferStride+3]=b};b.prototype.copyFrom=function(a,e,f){var g=this.typedBuffer,b=e.typedBuffer;a*=this.typedBufferStride;e=f*e.typedBufferStride;g[a]=b[e];g[a+1]=b[e+1];g[a+2]=b[e+2];g[a+3]=b[e+3]};Object.defineProperty(b.prototype,"buffer",
{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=4;return b}();b.BufferViewVec4Impl=n})},"esri/core/libs/gl-matrix-2/vec4":function(){define(["require","exports","./math/vec4"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.vec4=a})},"esri/core/libs/gl-matrix-2/math/vec4":function(){define(["require","exports","./common"],function(n,b,a){function m(c,a,d){c[0]=a[0]-d[0];c[1]=a[1]-d[1];c[2]=a[2]-d[2];c[3]=a[3]-d[3];return c}function h(c,
a,d){c[0]=a[0]*d[0];c[1]=a[1]*d[1];c[2]=a[2]*d[2];c[3]=a[3]*d[3];return c}function e(c,a,d){c[0]=a[0]/d[0];c[1]=a[1]/d[1];c[2]=a[2]/d[2];c[3]=a[3]/d[3];return c}function f(c,a){var d=a[0]-c[0],e=a[1]-c[1],g=a[2]-c[2];c=a[3]-c[3];return Math.sqrt(d*d+e*e+g*g+c*c)}function g(c,a){var d=a[0]-c[0],e=a[1]-c[1],g=a[2]-c[2];c=a[3]-c[3];return d*d+e*e+g*g+c*c}function l(c){var a=c[0],d=c[1],e=c[2];c=c[3];return Math.sqrt(a*a+d*d+e*e+c*c)}function d(c){var a=c[0],d=c[1],e=c[2];c=c[3];return a*a+d*d+e*e+c*
c}Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(c,a){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};b.set=function(c,a,d,e,g){c[0]=a;c[1]=d;c[2]=e;c[3]=g;return c};b.add=function(c,a,d){c[0]=a[0]+d[0];c[1]=a[1]+d[1];c[2]=a[2]+d[2];c[3]=a[3]+d[3];return c};b.subtract=m;b.multiply=h;b.divide=e;b.ceil=function(c,a){c[0]=Math.ceil(a[0]);c[1]=Math.ceil(a[1]);c[2]=Math.ceil(a[2]);c[3]=Math.ceil(a[3]);return c};b.floor=function(c,a){c[0]=Math.floor(a[0]);c[1]=Math.floor(a[1]);c[2]=
Math.floor(a[2]);c[3]=Math.floor(a[3]);return c};b.min=function(c,a,d){c[0]=Math.min(a[0],d[0]);c[1]=Math.min(a[1],d[1]);c[2]=Math.min(a[2],d[2]);c[3]=Math.min(a[3],d[3]);return c};b.max=function(c,a,d){c[0]=Math.max(a[0],d[0]);c[1]=Math.max(a[1],d[1]);c[2]=Math.max(a[2],d[2]);c[3]=Math.max(a[3],d[3]);return c};b.round=function(c,a){c[0]=Math.round(a[0]);c[1]=Math.round(a[1]);c[2]=Math.round(a[2]);c[3]=Math.round(a[3]);return c};b.scale=function(c,a,d){c[0]=a[0]*d;c[1]=a[1]*d;c[2]=a[2]*d;c[3]=a[3]*
d;return c};b.scaleAndAdd=function(c,a,d,e){c[0]=a[0]+d[0]*e;c[1]=a[1]+d[1]*e;c[2]=a[2]+d[2]*e;c[3]=a[3]+d[3]*e;return c};b.distance=f;b.squaredDistance=g;b.length=l;b.squaredLength=d;b.negate=function(c,a){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c};b.inverse=function(c,a){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];c[3]=1/a[3];return c};b.normalize=function(c,a){var d=a[0],e=a[1],g=a[2];a=a[3];var f=d*d+e*e+g*g+a*a;0<f&&(f=1/Math.sqrt(f),c[0]=d*f,c[1]=e*f,c[2]=g*f,c[3]=a*f);return c};b.dot=function(c,
a){return c[0]*a[0]+c[1]*a[1]+c[2]*a[2]+c[3]*a[3]};b.lerp=function(c,a,d,e){var g=a[0],f=a[1],k=a[2];a=a[3];c[0]=g+e*(d[0]-g);c[1]=f+e*(d[1]-f);c[2]=k+e*(d[2]-k);c[3]=a+e*(d[3]-a);return c};b.random=function(c,d){d=d||1;var e,g,f,k,b,l;do e=2*a.RANDOM()-1,g=2*a.RANDOM()-1,b=e*e+g*g;while(1<=b);do f=2*a.RANDOM()-1,k=2*a.RANDOM()-1,l=f*f+k*k;while(1<=l);b=Math.sqrt((1-b)/l);c[0]=d*e;c[1]=d*g;c[2]=d*f*b;c[3]=d*k*b;return c};b.transformMat4=function(c,a,d){var e=a[0],g=a[1],f=a[2];a=a[3];c[0]=d[0]*e+
d[4]*g+d[8]*f+d[12]*a;c[1]=d[1]*e+d[5]*g+d[9]*f+d[13]*a;c[2]=d[2]*e+d[6]*g+d[10]*f+d[14]*a;c[3]=d[3]*e+d[7]*g+d[11]*f+d[15]*a;return c};b.transformQuat=function(c,a,d){var e=a[0],g=a[1],f=a[2],k=d[0],b=d[1],l=d[2];d=d[3];var h=d*e+b*f-l*g,p=d*g+l*e-k*f,m=d*f+k*g-b*e,e=-k*e-b*g-l*f;c[0]=h*d+e*-k+p*-l-m*-b;c[1]=p*d+e*-b+m*-k-h*-l;c[2]=m*d+e*-l+h*-b-p*-k;c[3]=a[3];return c};b.str=function(c){return"vec4("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+")"};b.exactEquals=function(c,a){return c[0]===a[0]&&c[1]===
a[1]&&c[2]===a[2]&&c[3]===a[3]};b.equals=function(c,d){var e=c[0],g=c[1],f=c[2];c=c[3];var k=d[0],b=d[1],l=d[2];d=d[3];return Math.abs(e-k)<=a.EPSILON*Math.max(1,Math.abs(e),Math.abs(k))&&Math.abs(g-b)<=a.EPSILON*Math.max(1,Math.abs(g),Math.abs(b))&&Math.abs(f-l)<=a.EPSILON*Math.max(1,Math.abs(f),Math.abs(l))&&Math.abs(c-d)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(d))};b.sub=m;b.mul=h;b.div=e;b.dist=f;b.sqrDist=g;b.len=l;b.sqrLen=d})},"esri/views/3d/support/buffer/types":function(){define(["require",
"exports","../../../../core/compilerUtils"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.elementTypeSize=function(b){switch(b){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8;default:a.neverReached(b)}};b.isSigned=function(b){switch(b){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0;default:a.neverReached(b)}};b.isInteger=
function(b){switch(b){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1;default:a.neverReached(b)}};b.maximumValue=function(b){switch(b){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308;default:a.neverReached(b)}}})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./BufferVectorMath ./GeometryData ./Util".split(" "),
function(n,b,a,m,h,e,f,g,l){var d=f.Vec3Compact,c;(function(c){for(var a=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],d=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],e=[0,0,1,0,1,1,0,1],f=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],k=Array(36),b=0;6>b;b++)for(var h=0;6>h;h++)k[6*b+h]=b;for(var p=Array(36),b=0;6>b;b++)p[6*b+0]=0,p[6*b+1]=1,p[6*b+2]=2,p[6*b+3]=2,p[6*b+4]=3,p[6*b+5]=0;c.createGeometry=function(c){Array.isArray(c)||
(c=[c,c,c]);for(var b=new Float32Array(24),h=0;8>h;h++)b[3*h]=a[h][0]*c[0],b[3*h+1]=a[h][1]*c[1],b[3*h+2]=a[h][2]*c[2];c={};c[l.VertexAttrConstants.POSITION]=new Uint32Array(f);c[l.VertexAttrConstants.NORMAL]=new Uint32Array(k);c[l.VertexAttrConstants.UV0]=new Uint32Array(p);h={};h[l.VertexAttrConstants.POSITION]={size:3,data:b};h[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(d)};h[l.VertexAttrConstants.UV0]={size:2,data:new Float32Array(e)};return new g.GeometryData(h,c)}})(c||(c={}));
var k;(function(c){var a=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],d=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],e=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],f=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];c.createGeometry=function(c){Array.isArray(c)||(c=[c,c,c]);for(var k=new Float32Array(18),b=0;6>b;b++)k[3*b]=a[b][0]*c[0],k[3*b+1]=a[b][1]*c[1],k[3*b+2]=a[b][2]*c[2];c={};c[l.VertexAttrConstants.POSITION]=new Uint32Array(e);c[l.VertexAttrConstants.NORMAL]=
new Uint32Array(f);b={};b[l.VertexAttrConstants.POSITION]={size:3,data:k};b[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(d)};return new g.GeometryData(b,c)}})(k||(k={}));var p;(function(c){var d=m.vec3f32.fromValues(-.5,0,-.5),e=m.vec3f32.fromValues(.5,0,-.5),f=m.vec3f32.fromValues(0,0,.5),k=m.vec3f32.fromValues(0,.5,0),b=m.vec3f32.create(),h=m.vec3f32.create(),p=m.vec3f32.create(),t=m.vec3f32.create(),r=m.vec3f32.create();a.vec3.subtract(b,d,k);a.vec3.subtract(h,d,e);a.vec3.cross(p,
b,h);a.vec3.normalize(p,p);a.vec3.subtract(b,e,k);a.vec3.subtract(h,e,f);a.vec3.cross(t,b,h);a.vec3.normalize(t,t);a.vec3.subtract(b,f,k);a.vec3.subtract(h,f,d);a.vec3.cross(r,b,h);a.vec3.normalize(r,r);var u=[d,e,f,k],v=[0,-1,0,p[0],p[1],p[2],t[0],t[1],t[2],r[0],r[1],r[2]],z=[0,1,2,3,1,0,3,2,1,3,0,2],L=[0,0,0,1,1,1,2,2,2,3,3,3];c.createGeometry=function(c){Array.isArray(c)||(c=[c,c,c]);for(var a=new Float32Array(12),d=0;4>d;d++)a[3*d]=u[d][0]*c[0],a[3*d+1]=u[d][1]*c[1],a[3*d+2]=u[d][2]*c[2];c={};
c[l.VertexAttrConstants.POSITION]=new Uint32Array(z);c[l.VertexAttrConstants.NORMAL]=new Uint32Array(L);d={};d[l.VertexAttrConstants.POSITION]={size:3,data:a};d[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(v)};return new g.GeometryData(d,c)}})(p||(p={}));var r;(function(b){function r(c,d,e,g,f){if(Math.abs(a.vec3.dot(d,c))>f)return!1;a.vec3.cross(e,c,d);a.vec3.normalize(e,e);a.vec3.cross(g,e,c);a.vec3.normalize(g,g);return!0}function q(c,a,d,e,g,f,k){return r(c,a,g,f,k)||r(c,d,g,f,
k)||r(c,e,g,f,k)}b.createBoxGeometry=c.createGeometry;b.createDiamondGeometry=k.createGeometry;b.createTetrahedronGeometry=p.createGeometry;b.createSphereGeometry=function(c,a,d,e,f,k,b){c=c||50;e=void 0!==e?e:-Math.PI;f=void 0!==f?f:2*Math.PI;k=void 0!==k?k:.5*-Math.PI;b=void 0!==b?b:Math.PI;var h=Math.max(3,Math.floor(a)||8),q=Math.max(2,Math.floor(d)||6),p=(h+1)*(q+1);d=new Float32Array(3*p);a=new Float32Array(3*p);for(var p=new Float32Array(2*p),r=[],t=0,u=0;u<=q;u++){for(var w=[],m=u/q,v=k+m*
b,A=Math.cos(v),y=0;y<=h;y++){var z=y/h,B=e+z*f,C=Math.cos(B)*A,F=Math.sin(v),B=-Math.sin(B)*A;d[3*t]=C*c;d[3*t+1]=F*c;d[3*t+2]=B*c;a[3*t]=C;a[3*t+1]=F;a[3*t+2]=B;p[2*t]=z;p[2*t+1]=m;w.push(t);++t}r.push(w)}c=new Uint32Array(2*h*(q-1)*3);for(u=t=0;u<q;u++)for(y=0;y<h;y++)e=r[u][y],f=r[u][y+1],k=r[u+1][y+1],b=r[u+1][y],0===u?(c[t++]=e,c[t++]=k,c[t++]=b):u===q-1?(c[t++]=e,c[t++]=f,c[t++]=k):(c[t++]=e,c[t++]=f,c[t++]=k,c[t++]=k,c[t++]=b,c[t++]=e);l.assert(t===c.length);h={};h[l.VertexAttrConstants.POSITION]=
c;h[l.VertexAttrConstants.NORMAL]=c;h[l.VertexAttrConstants.UV0]=c;q={};q[l.VertexAttrConstants.POSITION]={size:3,data:d};q[l.VertexAttrConstants.NORMAL]={size:3,data:a};q[l.VertexAttrConstants.UV0]={size:2,data:p};return new g.GeometryData(q,h)};b.createPolySphereGeometry=function(c,a,e){function f(a,e){a>e&&(e=[e,a],a=e[0],e=e[1]);var g=a.toString()+"."+e.toString();if(h[g])return h[g];var f=k.length;k.length+=3;d.add(k,3*a,k,3*e,k,f);d.scale(k,f,c/d.length(k,f));f/=3;return h[g]=f}var k;e?(k=[0,
-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],e=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1])):(e=c*(1+Math.sqrt(5))/2,k=[-c,e,0,c,e,0,-c,-e,0,c,-e,0,0,-c,e,0,c,e,0,-c,-e,0,c,-e,e,0,-c,e,0,c,-e,0,-c,-e,0,c],e=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var b=0;b<k.length;b+=3)d.scale(k,b,c/d.length(k,b));for(var h={},b=0;b<a;b++){for(var q=e.length,p=new Uint32Array(4*q),t=0;t<
q;t+=3){var r=e[t],u=e[t+1],w=e[t+2],m=f(r,u),v=f(u,w),A=f(w,r),y=4*t;p[y]=r;p[y+1]=m;p[y+2]=A;p[y+3]=u;p[y+4]=v;p[y+5]=m;p[y+6]=w;p[y+7]=A;p[y+8]=v;p[y+9]=m;p[y+10]=v;p[y+11]=A}e=p;h={}}a=new Float32Array(k);for(b=0;b<a.length;b+=3)d.normalize(a,b);b={};b[l.VertexAttrConstants.POSITION]=e;b[l.VertexAttrConstants.NORMAL]=e;e={};e[l.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(k)};e[l.VertexAttrConstants.NORMAL]={size:3,data:a};return new g.GeometryData(e,b)};b.createPointGeometry=function(c,
a,d,e,f,k,b,h){a=a?new Float64Array([a[0],a[1],a[2]]):new Float32Array([0,0,0]);c=c?new Float32Array([c[0],c[1],c[2]]):new Float32Array([0,0,1]);k=k?new Float32Array(k):new Float32Array([0,0]);d=d?new Uint8Array([255*d[0],255*d[1],255*d[2],3<d.length?255*d[3]:255]):new Uint8Array([255,255,255,255]);var q=null!=e&&2===e.length?new Float32Array(e):new Float32Array([1,1]);e={};e[l.VertexAttrConstants.POSITION]={size:3,data:a};e[l.VertexAttrConstants.NORMAL]={size:3,data:c};e[l.VertexAttrConstants.UV0]=
{size:k.length,data:k};e[l.VertexAttrConstants.COLOR]={size:4,data:d};e[l.VertexAttrConstants.SIZE]={size:2,data:q};null!=f&&(f=new Float32Array([f[0],f[1],f[2],f[3]]),e[l.VertexAttrConstants.AUXPOS1]={size:4,data:f});null!=b&&(b=new Float32Array([b[0],b[1],b[2],b[3]]),e[l.VertexAttrConstants.AUXPOS2]={size:4,data:b});return null!=h?(g.GeometryData.call(h,e,g.GeometryData.DefaultIndices,"point"),h):new g.GeometryData(e,g.GeometryData.DefaultIndices,"point")};b.updatePointGeometry=function(c,a,d,e,
g,f,k,b){var h=b.vertexAttributes;if(null!=c){var q=h[l.VertexAttrConstants.NORMAL].data;q[0]=c[0];q[1]=c[1];q[2]=c[2]}null!=a&&(q=h[l.VertexAttrConstants.POSITION].data,q[0]=a[0],q[1]=a[1],q[2]=a[2]);null!=d&&(q=h[l.VertexAttrConstants.COLOR].data,q[0]=d[0],q[1]=d[1],q[2]=d[2],q[3]=d[3]);null!=e&&(q=h[l.VertexAttrConstants.SIZE].data,q[0]=e[0],q[1]=e[1]);null!=g&&(q=h[l.VertexAttrConstants.AUXPOS1].data,q[0]=g[0],q[1]=g[1],q[2]=g[2],q[3]=g[3]);null!=f&&(q=h[l.VertexAttrConstants.UV0].data,q[0]=f[0],
q[1]=f[1]);null!=k&&(q=h[l.VertexAttrConstants.AUXPOS2].data,q[0]=k[0],q[1]=k[1],q[2]=k[2],q[3]=k[3]);return b};b.createPointArrayGeometry=function(c,a){for(var d=new Float32Array(3*c.length),e=new Float32Array(a?3*c.length:3),f=new Uint32Array(c.length),k=new Uint32Array(c.length),b=0;b<c.length;b++)d[3*b]=c[b][0],d[3*b+1]=c[b][1],d[3*b+2]=c[b][2],a&&(e[3*b]=a[b][0],e[3*b+1]=a[b][1],e[3*b+2]=a[b][2]),f[b]=b,k[b]=0;a||(e[0]=0,e[1]=1,e[2]=0);c=new Float32Array(2);c[0]=0;c[1]=0;b={};b[l.VertexAttrConstants.POSITION]=
f;b[l.VertexAttrConstants.NORMAL]=a?f:k;b[l.VertexAttrConstants.UV0]=k;a={};a[l.VertexAttrConstants.POSITION]={size:3,data:d};a[l.VertexAttrConstants.NORMAL]={size:3,data:e};a[l.VertexAttrConstants.UV0]={size:2,data:c};return new g.GeometryData(a,b,"point")};b.createTriangleGeometry=function(){var c=new Float32Array([0,0,0,0,0,100,100,0,0]),a=new Uint32Array([0,1,2]),d=new Float32Array([0,1,0]),e=new Uint32Array([0,0,0]),f=new Float32Array([0,0]),k=new Uint32Array([0,0,0]),b={};b[l.VertexAttrConstants.POSITION]=
a;b[l.VertexAttrConstants.NORMAL]=e;b[l.VertexAttrConstants.UV0]=k;a={};a[l.VertexAttrConstants.POSITION]={size:3,data:c};a[l.VertexAttrConstants.NORMAL]={size:3,data:d};a[l.VertexAttrConstants.UV0]={size:2,data:f};return new g.GeometryData(a,b)};var y=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];b.createSquareGeometry=function(c){var a,d;void 0===c&&(c=y);for(var e=new Float64Array(12),f=0;4>f;f++)for(var k=0;3>k;k++)e[3*f+k]=c[f][k];var b=new Uint32Array([0,1,2,2,3,0]);c=new Float32Array([0,0,1]);var h=
new Uint32Array([0,0,0,0,0,0]),f=new Float32Array([0,0,1,0,1,1,0,1]),k=new Uint8Array([255,255,255,255]),b=(a={},a[l.VertexAttrConstants.POSITION]=b,a[l.VertexAttrConstants.NORMAL]=h,a[l.VertexAttrConstants.UV0]=b,a[l.VertexAttrConstants.COLOR]=h,a);a=(d={},d[l.VertexAttrConstants.POSITION]={size:3,data:e},d[l.VertexAttrConstants.NORMAL]={size:3,data:c},d[l.VertexAttrConstants.UV0]={size:2,data:f},d[l.VertexAttrConstants.COLOR]={size:4,data:k},d);return new g.GeometryData(a,b)};b.createConeGeometry=
function(c,a,d,e,f,k){void 0===f&&(f=!0);void 0===k&&(k=!0);var b=0,h=m.vec3f32.fromValues(0,b,0),q=m.vec3f32.fromValues(0,b+c,0),p=m.vec3f32.fromValues(0,-1,0),t=m.vec3f32.fromValues(0,1,0);e&&(b=c,q=m.vec3f32.fromValues(0,0,0),h=m.vec3f32.fromValues(0,b,0),p=m.vec3f32.fromValues(0,1,0),t=m.vec3f32.fromValues(0,-1,0));h=[q,h];p=[p,t];t=d+2;q=Math.sqrt(c*c+a*a);if(e)for(e=d-1;0<=e;e--)r=2*Math.PI/d*e,u=m.vec3f32.fromValues(Math.cos(r)*a,b,Math.sin(r)*a),h.push(u),r=m.vec3f32.fromValues(c*Math.cos(r)/
q,-a/q,c*Math.sin(r)/q),p.push(r);else for(e=0;e<d;e++){var r=2*Math.PI/d*e,u=m.vec3f32.fromValues(Math.cos(r)*a,b,Math.sin(r)*a);h.push(u);r=m.vec3f32.fromValues(c*Math.cos(r)/q,a/q,c*Math.sin(r)/q);p.push(r)}c=new Uint32Array(6*(d+2));d=new Uint32Array(6*(d+2));b=a=0;if(f){for(e=3;e<h.length;e++)c[a++]=1,c[a++]=e-1,c[a++]=e,d[b++]=0,d[b++]=0,d[b++]=0;c[a++]=h.length-1;c[a++]=2;c[a++]=1;d[b++]=0;d[b++]=0;d[b++]=0}if(k){for(e=3;e<h.length;e++)c[a++]=e,c[a++]=e-1,c[a++]=0,d[b++]=e,d[b++]=e-1,d[b++]=
1;c[a++]=0;c[a++]=2;c[a++]=h.length-1;d[b++]=1;d[b++]=2;d[b++]=p.length-1}f=new Float32Array(3*t);for(e=0;e<t;e++)f[3*e]=h[e][0],f[3*e+1]=h[e][1],f[3*e+2]=h[e][2];k=new Float32Array(3*t);for(e=0;e<t;e++)k[3*e]=p[e][0],k[3*e+1]=p[e][1],k[3*e+2]=p[e][2];h={};h[l.VertexAttrConstants.POSITION]=c;h[l.VertexAttrConstants.NORMAL]=d;p={};p[l.VertexAttrConstants.POSITION]={size:3,data:f};p[l.VertexAttrConstants.NORMAL]={size:3,data:k};return new g.GeometryData(p,h)};b.createCylinderGeometry=function(c,d,e,
f,k,b){f=f?m.vec3f32.clone(f):m.vec3f32.fromValues(1,0,0);k=k?m.vec3f32.clone(k):m.vec3f32.fromValues(0,0,0);b=void 0===b?!0:b;var h=m.vec3f32.create();a.vec3.normalize(h,f);f=m.vec3f32.create();a.vec3.scale(f,h,Math.abs(c));var q=m.vec3f32.create();a.vec3.scale(q,f,-.5);a.vec3.add(q,q,k);var p=m.vec3f32.fromValues(0,1,0);.2>Math.abs(1-a.vec3.dot(h,p))&&a.vec3.set(p,0,0,1);var t=m.vec3f32.create();a.vec3.cross(t,h,p);a.vec3.normalize(t,t);a.vec3.cross(p,t,h);var r=2*e+(b?2:0),u=e+(b?2:0);c=new Float32Array(3*
r);k=new Float32Array(3*u);var w=new Float32Array(2*r),v=new Uint32Array(3*e*(b?4:2)),A=new Uint32Array(3*e*(b?4:2));b&&(c[3*(r-2)+0]=q[0],c[3*(r-2)+1]=q[1],c[3*(r-2)+2]=q[2],w[2*(r-2)]=0,w[2*(r-2)+1]=0,c[3*(r-1)+0]=c[3*(r-2)+0]+f[0],c[3*(r-1)+1]=c[3*(r-2)+1]+f[1],c[3*(r-1)+2]=c[3*(r-2)+2]+f[2],w[2*(r-1)]=1,w[2*(r-1)+1]=1,k[3*(u-2)+0]=-h[0],k[3*(u-2)+1]=-h[1],k[3*(u-2)+2]=-h[2],k[3*(u-1)+0]=h[0],k[3*(u-1)+1]=h[1],k[3*(u-1)+2]=h[2]);for(var h=function(c,a,d){v[c]=a;A[c]=d},y=0,z=m.vec3f32.create(),
B=m.vec3f32.create(),C=0;C<e;C++){var H=2*Math.PI/e*C;a.vec3.scale(z,p,Math.sin(H));a.vec3.scale(B,t,Math.cos(H));a.vec3.add(z,z,B);k[3*C+0]=z[0];k[3*C+1]=z[1];k[3*C+2]=z[2];a.vec3.scale(z,z,d);a.vec3.add(z,z,q);c[3*C+0]=z[0];c[3*C+1]=z[1];c[3*C+2]=z[2];w[2*C+0]=C/e;w[2*C+1]=0;c[3*(C+e)+0]=c[3*C+0]+f[0];c[3*(C+e)+1]=c[3*C+1]+f[1];c[3*(C+e)+2]=c[3*C+2]+f[2];w[2*(C+e)+0]=C/e;w[2*C+1]=1;H=(C+1)%e;h(y++,C,C);h(y++,C+e,C);h(y++,H,H);h(y++,H,H);h(y++,C+e,C);h(y++,H+e,H)}if(b){for(C=0;C<e;C++)H=(C+1)%e,
h(y++,r-2,u-2),h(y++,C,u-2),h(y++,H,u-2);for(C=0;C<e;C++)H=(C+1)%e,h(y++,C+e,u-1),h(y++,r-1,u-1),h(y++,H+e,u-1)}d={};d[l.VertexAttrConstants.POSITION]=v;d[l.VertexAttrConstants.NORMAL]=A;d[l.VertexAttrConstants.UV0]=v;e={};e[l.VertexAttrConstants.POSITION]={size:3,data:c};e[l.VertexAttrConstants.NORMAL]={size:3,data:k};e[l.VertexAttrConstants.UV0]={size:2,data:w};return new g.GeometryData(e,d)};b.createTubeGeometry=function(c,a,d,e,g){d=d||10;e=null!=e?e:!0;l.assert(1<c.length);for(var f=[],k=[],
h=0;h<d;h++){f.push([0,-h-1,-((h+1)%d)-1]);var q=h/d*2*Math.PI;k.push([Math.cos(q)*a,Math.sin(q)*a])}return b.createPathExtrusionGeometry(k,c,[[0,0,0]],f,e,g)};b.createPathExtrusionGeometry=function(c,d,f,k,b,p){void 0===p&&(p=m.vec3f32.fromValues(0,0,0));var r=c.length,u=new Float32Array(d.length*r*3+(6*f.length||0)),w=new Float32Array(d.length*r+(2*f.length||0)),v=new Float32Array(d.length*r*3+(f?6:0)),y=(d.length-1)*r*6+6*k.length,A=new Uint32Array(y),y=new Uint32Array(y),z=0,B=0,C=0,H=0,F=0,I=
m.vec3f32.create(),n=m.vec3f32.create(),V=m.vec3f32.create(),T=m.vec3f32.create(),X=m.vec3f32.create(),Y=m.vec3f32.create(),da=m.vec3f32.create(),fa=h.vec3f64.create(),ga=m.vec3f32.create(),ka=m.vec3f32.create(),la=m.vec3f32.create(),ia=m.vec3f32.create(),Z=m.vec3f32.create(),oa=e.plane.create();a.vec3.set(ga,0,1,0);a.vec3.subtract(n,d[1],d[0]);a.vec3.normalize(n,n);b?(a.vec3.add(fa,d[0],p),a.vec3.normalize(V,fa)):a.vec3.set(V,0,0,1);q(n,V,ga,ga,X,V,t);a.vec3.copy(T,V);a.vec3.copy(ia,X);for(var aa=
0;aa<f.length;aa++)a.vec3.scale(Y,X,f[aa][0]),a.vec3.scale(fa,V,f[aa][2]),a.vec3.add(Y,Y,fa),a.vec3.add(Y,Y,d[0]),u[z++]=Y[0],u[z++]=Y[1],u[z++]=Y[2],w[C++]=0;v[B++]=-n[0];v[B++]=-n[1];v[B++]=-n[2];for(aa=0;aa<k.length;aa++)A[H++]=0<k[aa][0]?k[aa][0]:-k[aa][0]-1+f.length,A[H++]=0<k[aa][1]?k[aa][1]:-k[aa][1]-1+f.length,A[H++]=0<k[aa][2]?k[aa][2]:-k[aa][2]-1+f.length,y[F++]=0,y[F++]=0,y[F++]=0;for(var na=f.length,aa=f.length-1,ja=0;ja<d.length;ja++){var ta=!1;0<ja&&(a.vec3.copy(I,n),ja<d.length-1?(a.vec3.subtract(n,
d[ja+1],d[ja]),a.vec3.normalize(n,n)):ta=!0,a.vec3.add(ka,I,n),a.vec3.normalize(ka,ka),a.vec3.add(la,d[ja-1],T),e.plane.fromPositionAndNormal(d[ja],ka,oa),e.plane.intersectRay(oa,e.ray.wrap(la,I),fa)?(a.vec3.subtract(fa,fa,d[ja]),a.vec3.normalize(V,fa),a.vec3.cross(X,ka,V),a.vec3.normalize(X,X)):q(ka,T,ia,ga,X,V,t),a.vec3.copy(T,V),a.vec3.copy(ia,X));b&&(a.vec3.add(fa,d[ja],p),a.vec3.normalize(Z,fa));for(var ra=0;ra<r;ra++)if(a.vec3.scale(Y,X,c[ra][0]),a.vec3.scale(fa,V,c[ra][1]),a.vec3.add(Y,Y,fa),
a.vec3.normalize(da,Y),v[B++]=da[0],v[B++]=da[1],v[B++]=da[2],b?w[C++]=a.vec3.dot(Y,Z):w[C++]=Y[2],a.vec3.add(Y,Y,d[ja]),u[z++]=Y[0],u[z++]=Y[1],u[z++]=Y[2],!ta){var xa=(ra+1)%r;A[H++]=na+ra;A[H++]=na+r+ra;A[H++]=na+xa;A[H++]=na+xa;A[H++]=na+r+ra;A[H++]=na+r+xa;for(xa=0;6>xa;xa++)y[F++]=A[H-6+xa]-aa}na+=r}c=d[d.length-1];for(aa=0;aa<f.length;aa++)a.vec3.scale(Y,X,f[aa][0]),a.vec3.scale(fa,V,f[aa][1]),a.vec3.add(Y,Y,fa),a.vec3.add(Y,Y,c),u[z++]=Y[0],u[z++]=Y[1],u[z++]=Y[2],w[C++]=0;f=B/3;v[B++]=n[0];
v[B++]=n[1];v[B++]=n[2];r=na-r;for(aa=0;aa<k.length;aa++)A[H++]=0<=k[aa][0]?na+k[aa][0]:-k[aa][0]-1+r,A[H++]=0<=k[aa][2]?na+k[aa][2]:-k[aa][2]-1+r,A[H++]=0<=k[aa][1]?na+k[aa][1]:-k[aa][1]-1+r,y[F++]=f,y[F++]=f,y[F++]=f;k={};k[l.VertexAttrConstants.POSITION]=A;k[l.VertexAttrConstants.NORMAL]=y;A={};A[l.VertexAttrConstants.POSITION]={size:3,data:u};A.zOffset={size:1,data:w};A[l.VertexAttrConstants.NORMAL]={size:3,data:v};return new g.GeometryData(A,k)};b.createPolylineGeometry=function(c,a){l.assert(1<
c.length,"createPolylineGeometry(): polyline needs at least 2 points");l.assert(3===c[0].length,"createPolylineGeometry(): malformed vertex");l.assert(void 0===a||a.length===c.length,"createPolylineGeometry: need same number of points and normals");l.assert(void 0===a||3===a[0].length,"createPolylineGeometry(): malformed normal");for(var d=new Float64Array(3*c.length),e=new Uint32Array(2*(c.length-1)),f=0,k=0,b=0;b<c.length;b++){for(var h=0;3>h;h++)d[f++]=c[b][h];0<b&&(e[k++]=b-1,e[k++]=b)}f={};k=
{};f[l.VertexAttrConstants.POSITION]=e;k[l.VertexAttrConstants.POSITION]={size:3,data:d};if(a){for(var d=new Float32Array(3*a.length),q=0,b=0;b<c.length;b++)for(h=0;3>h;h++)d[q++]=a[b][h];f[l.VertexAttrConstants.NORMAL]=e;k[l.VertexAttrConstants.NORMAL]={size:3,data:d}}return new g.GeometryData(k,f,"line")};b.createExtrudedTriangle=function(c,a,d,e){var f,k,b=new Float32Array(18);c=[[-a,0,e/2],[d,0,e/2],[0,c,e/2],[-a,0,-e/2],[d,0,-e/2],[0,c,-e/2]];for(a=0;6>a;a++)b[3*a]=c[a][0],b[3*a+1]=c[a][1],b[3*
a+2]=c[a][2];c=(f={},f[l.VertexAttrConstants.POSITION]=new Uint32Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]),f);f=(k={},k[l.VertexAttrConstants.POSITION]={size:3,data:b},k);return new g.GeometryData(f,c)};b.transformInPlace=function(c,d){c=c.vertexAttributes[l.VertexAttrConstants.POSITION].data;for(var e=0;e<c.length;e+=3)a.vec3.set(u,c[e],c[e+1],c[e+2]),a.vec3.transformMat4(u,u,d),c[e]=u[0],c[e+1]=u[1],c[e+2]=u[2]};b.addVertexColors=function(c,a){var d=a||[1,1,1,1];a=new Uint8Array(4);
a[0]=255*d[0];a[1]=255*d[1];a[2]=255*d[2];a[3]=255*(3<d.length?d[3]:1);var d={},e=c.getVertexAttr(),f;for(f in e)d[f]=e[f];d[l.VertexAttrConstants.COLOR]={size:4,data:a};a={};for(f in c.indices)a[f]=c.indices[f];a[l.VertexAttrConstants.COLOR]=new Uint32Array(a[l.VertexAttrConstants.POSITION].length);return c=new g.GeometryData(d,a,c.primitiveType)};b.addNormals=function(c){var d=c.getVertexAttr();c=c.indices;for(var e=f.Vec3Compact.subtract,g=new Float32Array(c.position.length/3*3),k=d.position.data,
b=0,h=c.position,q=new Uint32Array(h.length),p=0;p<h.length;p+=3){e(k,3*h[p],k,3*h[p+2],v,0);e(k,3*h[p],k,3*h[p+1],u,0);a.vec3.cross(u,u,v);a.vec3.normalize(u,u);var r=b/3;g[b++]=u[0];g[b++]=u[1];g[b++]=u[2];q[p]=r;q[p+1]=r;q[p+2]=r}d[l.VertexAttrConstants.NORMAL]={size:3,data:g,offsetIdx:0,strideIdx:3};c[l.VertexAttrConstants.NORMAL]=q};b.cgToGIS=function(c,a){void 0===a&&(a=c);var d=c.getVertexAttr();c=d.position.data;var d=d.normal.data,e=a.getVertexAttr(),g=e.position.data,e=e.normal.data;if(d)for(var f=
0;f<d.length;f+=3){var k=d[f+1];e[f+1]=-d[f+2];e[f+2]=k}if(c)for(f=0;f<c.length;f+=3)k=c[f+1],g[f+1]=-c[f+2],g[f+2]=k;return a};b.makeOrthoBasisDirUp=r;b.makeOrthoBasisDirUpFallback=q})(r||(r={}));var t=.99619469809,u=m.vec3f32.create(),v=m.vec3f32.create();return r})},"esri/core/libs/gl-matrix-2/vec3f32":function(){define(["require","exports","./factories/vec3f32"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.vec3f32=a})},"esri/core/libs/gl-matrix-2/factories/vec3f32":function(){define(["require",
"exports"],function(n,b){function a(){return new Float32Array(3)}function m(a,d,c){var e=new Float32Array(3);e[0]=a;e[1]=d;e[2]=c;return e}function h(){return m(1,1,1)}function e(){return m(1,0,0)}function f(){return m(0,1,0)}function g(){return m(0,0,1)}Object.defineProperty(b,"__esModule",{value:!0});b.create=a;b.clone=function(a){var d=new Float32Array(3);d[0]=a[0];d[1]=a[1];d[2]=a[2];return d};b.fromValues=m;b.createView=function(a,d){return new Float32Array(a,d,3)};b.zeros=function(){return a()};
b.ones=h;b.unitX=e;b.unitY=f;b.unitZ=g;b.ZEROS=a();b.ONES=h();b.UNIT_X=e();b.UNIT_Y=f();b.UNIT_Z=g()})},"esri/views/3d/support/geometryUtils":function(){define("require exports ./geometryUtils/axisAngle ./geometryUtils/boundedPlane ./geometryUtils/clipRay ./geometryUtils/frustum ./geometryUtils/lineSegment ./geometryUtils/plane ./geometryUtils/ray ./geometryUtils/sphere ./geometryUtils/triangle ./geometryUtils/vector".split(" "),function(n,b,a,m,h,e,f,g,l,d,c,k){Object.defineProperty(b,"__esModule",
{value:!0});b.plane=g;b.boundedPlane=m;b.triangle=c;b.lineSegment=f;b.ray=l;b.clipRay=h;b.sphere=d;b.frustum=e;b.vector=k;b.axisAngle=a})},"esri/views/3d/support/geometryUtils/axisAngle":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../stack","./vector"],function(n,b,a,m,h){function e(a){void 0===a&&(a=b.UP);return[a[0],a[1],a[2],a[3]]}function f(a,f,d,c,k){void 0===k&&(k=e());k[0]=a;k[1]=f;k[2]=d;k[3]=c;return k}Object.defineProperty(b,"__esModule",{value:!0});
b.create=e;b.wrap=function(a,e,d,c){return f(a,e,d,c,m.sv4d.get())};b.wrapAxisAngle=function(a,e){return f(a[0],a[1],a[2],e,m.sv4d.get())};b.copy=function(a,b){void 0===b&&(b=e());return f(a[0],a[1],a[2],a[3],b)};b.fromValues=f;b.fromAxisAndAngle=function(g,f,d){void 0===d&&(d=e());a.vec3.copy(d,g);d[3]=f;return d};b.fromPoints=function(g,f,d){void 0===d&&(d=e());a.vec3.cross(d,g,f);a.vec3.normalize(d,d);d[3]=h.angle(g,f);return d};b.UP=[0,0,1,0]})},"esri/views/3d/support/stack":function(){define(["require",
"exports","../../../core/VectorStack"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.sv2d=a.VectorStack.createVec2f64();b.sv3d=a.VectorStack.createVec3f64();b.sv4d=a.VectorStack.createVec4f64();b.sm3d=a.VectorStack.createMat3f64();b.sm4d=a.VectorStack.createMat4f64();b.sq4d=a.VectorStack.createQuatf64()})},"esri/core/VectorStack":function(){define("require exports ./nextTick ./libs/gl-matrix-2/mat3f64 ./libs/gl-matrix-2/mat4f64 ./libs/gl-matrix-2/quatf64 ./libs/gl-matrix-2/vec2f64 ./libs/gl-matrix-2/vec3f64 ./libs/gl-matrix-2/vec4f64".split(" "),
function(n,b,a,m,h,e,f,g,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function c(c,d,e){var g=this;this.itemByteSize=c;this.itemCreate=d;this.buffers=[];this.items=[];this.itemsPtr=this.itemsPerBuffer=0;this.itemsPerBuffer=Math.ceil(e/this.itemByteSize);this.tickHandle=a.before(function(){return g.reset()})}c.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null);this.itemsPtr=0;this.buffers=this.items=null};c.prototype.get=function(){0===
this.itemsPtr&&a(function(){});for(var c=Math.floor(this.itemsPtr/this.itemsPerBuffer);this.buffers.length<=c;){for(var d=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize),e=0;e<this.itemsPerBuffer;++e)this.items.push(this.itemCreate(d,e*this.itemByteSize));this.buffers.push(d)}return this.items[this.itemsPtr++]};c.prototype.reset=function(){for(var c=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);this.buffers.length>c;)this.buffers.pop(),this.items.length=this.buffers.length*this.itemsPerBuffer;
this.itemsPtr=0};c.createVec2f64=function(a){void 0===a&&(a=d);return new c(16,f.vec2f64.createView,a)};c.createVec3f64=function(a){void 0===a&&(a=d);return new c(24,g.vec3f64.createView,a)};c.createVec4f64=function(a){void 0===a&&(a=d);return new c(32,l.vec4f64.createView,a)};c.createMat3f64=function(a){void 0===a&&(a=d);return new c(72,m.mat3f64.createView,a)};c.createMat4f64=function(a){void 0===a&&(a=d);return new c(128,h.mat4f64.createView,a)};c.createQuatf64=function(a){void 0===a&&(a=d);return new c(32,
e.quatf64.createView,a)};Object.defineProperty(c.prototype,"test",{get:function(){return{size:this.buffers.length*this.itemsPerBuffer*this.itemByteSize}},enumerable:!0,configurable:!0});return c}();b.VectorStack=n;var d=4096})},"esri/core/libs/gl-matrix-2/mat3f64":function(){define(["require","exports","./factories/mat3f64"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.mat3f64=a})},"esri/core/libs/gl-matrix-2/factories/mat3f64":function(){define(["require","exports"],function(n,
b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[1,0,0,0,1,0,0,0,1]};b.clone=function(a){return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]]};b.fromValues=function(a,b,h,e,f,g,l,d,c){return[a,b,h,e,f,g,l,d,c]};b.createView=function(a,b){return new Float64Array(a,b,9)}})},"esri/core/libs/gl-matrix-2/quatf64":function(){define(["require","exports","./factories/quatf64"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.quatf64=a})},"esri/core/libs/gl-matrix-2/factories/quatf64":function(){define(["require",
"exports"],function(n,b){function a(){return[0,0,0,1]}Object.defineProperty(b,"__esModule",{value:!0});b.create=a;b.clone=function(a){return[a[0],a[1],a[2],a[3]]};b.fromValues=function(a,b,e,f){return[a,b,e,f]};b.createView=function(a,b){return new Float64Array(a,b,4)};b.IDENTITY=a()})},"esri/core/libs/gl-matrix-2/vec2f64":function(){define(["require","exports","./factories/vec2f64"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.vec2f64=a})},"esri/core/libs/gl-matrix-2/factories/vec2f64":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[0,0]};b.clone=function(a){return[a[0],a[1]]};b.fromValues=function(a,b){return[a,b]};b.fromArray=function(a){for(var b=[0,0],h=Math.min(2,a.length),e=0;e<h;++e)b[e]=a[e];return b};b.createView=function(a,b){return new Float64Array(a,b,2)};b.zeros=function(){return[0,0]};b.ones=function(){return[1,1]};b.unitX=function(){return[1,0]};b.unitY=function(){return[0,1]};b.ZEROS=[0,0];b.ONES=[1,1];b.UNIT_X=
[1,0];b.UNIT_Y=[0,1]})},"esri/views/3d/support/geometryUtils/vector":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.projectPoint=function(a,e,d){e=m.vec3.dot(a,e)/m.vec3.dot(a,a);return m.vec3.scale(d,a,e)};b.projectPointSignedLength=function(a,e){return m.vec3.dot(a,e)/m.vec3.length(a)};b.angle=function(e,f){e=m.vec3.dot(e,
f)/(m.vec3.length(e)*m.vec3.length(f));return-a.acosClamped(e)};b.angleAroundAxis=function(g,b,d){m.vec3.normalize(e,g);m.vec3.normalize(f,b);g=m.vec3.dot(e,f);g=a.acosClamped(g);b=m.vec3.cross(e,e,f);return 0>m.vec3.dot(b,d)?2*Math.PI-g:g};var e=h.vec3f64.create(),f=h.vec3f64.create()})},"esri/views/3d/support/geometryUtils/boundedPlane":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../mathUtils ../stack ./lineSegment ./plane ./ray ./vector".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u){function v(c){void 0===c&&(c=b.UP);return{plane:r.create(c.plane),origin:d.vec3f64.clone(c.origin),basis1:d.vec3f64.clone(c.basis1),basis2:d.vec3f64.clone(c.basis2)}}function z(c,a){void 0===a&&(a=v());return w(c.origin,c.basis1,c.basis2,a)}function w(c,a,d,e){void 0===e&&(e=v());l.vec3.copy(e.origin,c);l.vec3.copy(e.basis1,a);l.vec3.copy(e.basis2,d);q(e);c=e;1E-6<Math.abs(l.vec3.dot(c.basis1,c.basis2)/(l.vec3.length(c.basis1)*l.vec3.length(c.basis2)))&&R.warn("fromValues()",
"Provided basis vectors are not perpendicular");1E-6<Math.abs(l.vec3.dot(c.basis1,E(c)))&&R.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-l.vec3.dot(E(c),c.origin)-c.plane[3])&&R.warn("fromValues()","Plane offset is not consistent with plane origin");return e}function q(c){r.fromVectorsAndPoint(c.basis2,c.basis1,c.origin,c.plane)}function y(c,a,d){c!==d&&z(c,d);c=l.vec3.scale(k.sv3d.get(),E(c),a);l.vec3.add(d.origin,d.origin,c);d.plane[3]-=a;return d}function A(c,
a){void 0===a&&(a=v());var d=(c[2]-c[0])/2,e=(c[3]-c[1])/2;l.vec3.set(a.origin,c[0]+d,c[1]+e,0);l.vec3.set(a.basis1,d,0,0);l.vec3.set(a.basis2,0,e,0);r.fromValues(0,0,1,0,a.plane);return a}function B(c,a,d){return r.intersectRay(c.plane,a,d)?L(c,d):!1}function C(a,d,e){var f=W.get(),g=W.get();Q(a,d,f,g);for(var g=Number.POSITIVE_INFINITY,b=0,q=ba;b<q.length;b++){var p=N(a,q[b],O.get()),t=k.sv3d.get();r.intersectLineSegment(f,p,t)&&(p=c.directionFromTo(k.sv3d.get(),d.origin,t),p=Math.abs(h.acosClamped(l.vec3.dot(d.direction,
p))),p<g&&(g=p,l.vec3.copy(e,t)))}return g===Number.POSITIVE_INFINITY?F(a,d,e):e}function F(c,a,d){if(B(c,a,d))return d;var e=W.get(),f=W.get();Q(c,a,e,f);for(var g=Number.POSITIVE_INFINITY,b=0,h=ba;b<h.length;b++){var q=N(c,h[b],O.get()),p=k.sv3d.get();r.intersectLineSegmentClamp(e,q,p)&&(q=t.distance2(a,p),r.isPointInside(f,p)&&q<g&&(g=q,l.vec3.copy(d,p)))}G(c,a.origin)<g&&H(c,a.origin,d);return d}function H(c,a,d){var e=r.projectPoint(c.plane,a,k.sv3d.get());a=p.projectPointClamp(M(c,c.basis1),
e,-1,1,k.sv3d.get());e=p.projectPointClamp(M(c,c.basis2),e,-1,1,k.sv3d.get());l.vec3.subtract(d,l.vec3.add(k.sv3d.get(),a,e),c.origin);return d}function I(c,a,d){var e=c.origin,f=c.basis1,g=c.basis2;a=l.vec3.subtract(k.sv3d.get(),a,e);f=u.projectPointSignedLength(f,a);g=u.projectPointSignedLength(g,a);c=u.projectPointSignedLength(E(c),a);return l.vec3.set(d,f,g,c)}function G(c,a){a=I(c,a,k.sv3d.get());var d=c.basis2;c=l.vec3.length(c.basis1);d=l.vec3.length(d);c=Math.max(Math.abs(a[0])-c,0);d=Math.max(Math.abs(a[1])-
d,0);a=a[2];return c*c+d*d+a*a}function J(c,a){var d=-c.plane[3];return u.projectPointSignedLength(E(c),a)-d}function E(c){return r.normal(c.plane)}function L(c,a){var d=l.vec3.subtract(k.sv3d.get(),a,c.origin);a=l.vec3.squaredLength(c.basis1);var e=l.vec3.squaredLength(c.basis2),f=l.vec3.dot(c.basis1,d);c=l.vec3.dot(c.basis2,d);return 0>-f-a&&0>f-a&&0>-c-e&&0>c-e}function M(c,a){var d=O.get();l.vec3.copy(d.origin,c.origin);l.vec3.copy(d.vector,a);return d}function N(c,a,d){var e=c.basis1,f=c.basis2;
c=c.origin;var g=l.vec3.scale(k.sv3d.get(),e,a.origin[0]),b=l.vec3.scale(k.sv3d.get(),f,a.origin[1]);l.vec3.add(d.origin,g,b);l.vec3.add(d.origin,d.origin,c);e=l.vec3.scale(k.sv3d.get(),e,a.direction[0]);a=l.vec3.scale(k.sv3d.get(),f,a.direction[1]);l.vec3.scale(d.vector,l.vec3.add(e,e,a),2);return d}function Q(c,a,d,e){c=E(c);r.fromVectorsAndPoint(c,a.direction,a.origin,d);r.fromVectorsAndPoint(r.normal(d),c,a.origin,e)}Object.defineProperty(b,"__esModule",{value:!0});var R=m.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");
n=function(){return function(){this.plane=r.create();this.origin=d.vec3f64.create();this.basis1=d.vec3f64.create();this.basis2=d.vec3f64.create()}}();b.BoundedPlaneClass=n;b.create=v;b.wrap=function(c,a,d){var e=P.get();e.origin=c;e.basis1=a;e.basis2=d;e.plane=r.wrap(0,0,0,0);q(e);return e};b.copy=z;b.fromValues=w;b.updateUnboundedPlane=q;b.elevate=y;b.setExtent=function(c,a,d){A(a,d);y(d,J(c,c.origin),d);return d};b.fromAABoundingRect=A;b.intersectRay=B;b.intersectRayClosestSilhouette=function(c,
a,d){if(B(c,a,d))return d;c=C(c,a,k.sv3d.get());l.vec3.add(d,a.origin,l.vec3.scale(k.sv3d.get(),a.direction,l.vec3.distance(a.origin,c)/l.vec3.length(a.direction)));return d};b.closestPointOnSilhouette=C;b.closestPoint=F;b.projectPoint=H;b.projectPointLocal=I;b.distance2=G;b.distance=function(c,a){return Math.sqrt(G(c,a))};b.distanceToSilhouette=function(c,a){for(var d=Number.NEGATIVE_INFINITY,e=0,f=ba;e<f.length;e++){var g=N(c,f[e],O.get()),g=p.distance2(g,a);g>d&&(d=g)}return Math.sqrt(d)};b.extrusionContainsPoint=
function(c,a){return r.isPointInside(c.plane,a)&&L(c,a)};b.axisAt=function(c,d,e,f){switch(e){case 0:l.vec3.copy(f,c.basis1);l.vec3.normalize(f,f);break;case 1:l.vec3.copy(f,c.basis2);l.vec3.normalize(f,f);break;case 2:l.vec3.copy(f,E(c));break;default:a.neverReached(e)}return f};b.altitudeAt=J;b.setAltitudeAt=function(c,a,d,e){var f=J(c,a);c=l.vec3.scale(U,E(c),d-f);l.vec3.add(e,a,c);return e};b.equals=function(c,a){return l.vec3.equals(c.basis1,a.basis1)&&l.vec3.equals(c.basis2,a.basis2)&&l.vec3.equals(c.origin,
a.origin)};b.transform=function(c,a,d){c!==d&&z(c,d);f.mat4.invert(V,a);f.mat4.transpose(V,V);l.vec3.transformMat4(d.basis1,c.basis1,V);l.vec3.transformMat4(d.basis2,c.basis2,V);l.vec3.transformMat4(d.plane,c.plane,V);l.vec3.transformMat4(d.origin,c.origin,a);r.setOffsetFromPoint(d.plane,d.origin,d.plane);return d};b.rotate=function(c,a,d,e){c!==e&&z(c,e);f.mat4.rotate(T,f.mat4.identity(T),a,d);l.vec3.transformMat4(e.basis1,c.basis1,T);l.vec3.transformMat4(e.basis2,c.basis2,T);q(e);return e};b.normal=
E;b.UP={plane:r.create(),origin:d.vec3f64.fromValues(0,0,0),basis1:d.vec3f64.fromValues(1,0,0),basis2:d.vec3f64.fromValues(0,1,0)};var W=new e.ObjectStack(r.create),O=new e.ObjectStack(p.create),U=d.vec3f64.create(),P=new e.ObjectStack(function(){return{origin:null,basis1:null,basis2:null,plane:null}}),ba=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],V=g.mat4f64.create(),T=g.mat4f64.create()})},"esri/core/ObjectStack":function(){define(["require",
"exports","./nextTick"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(e){var f=this;this.allocator=e;this.items=[];this.itemsPtr=0;this.tickHandle=a.before(function(){return f.reset()});this.grow()}b.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null);this.items=null};b.prototype.get=function(){0===this.itemsPtr&&a(function(){});this.itemsPtr===this.items.length&&this.grow();return this.items[this.itemsPtr++]};b.prototype.reset=
function(){this.items.length=Math.min(Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3*m),this.items.length);this.itemsPtr=0};b.prototype.grow=function(){for(var a=0;a<Math.max(8,Math.min(this.items.length,m));a++)this.items.push(this.allocator())};return b}();b.ObjectStack=n;var m=1024;b.default=n})},"esri/views/3d/support/geometryUtils/lineSegment":function(){define("require exports ../../../../core/mathUtils ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack".split(" "),
function(n,b,a,m,h,e,f){function g(c){return c?{origin:e.vec3f64.clone(c.origin),vector:e.vec3f64.clone(c.vector)}:{origin:e.vec3f64.create(),vector:e.vec3f64.create()}}function l(c,a){var d=t.get();d.origin=c;d.vector=a;return d}function d(c,a,d){void 0===d&&(d=g());h.vec3.copy(d.origin,c);h.vec3.copy(d.vector,a);return d}function c(c,d){d=h.vec3.subtract(f.sv3d.get(),d,c.origin);var e=h.vec3.dot(c.vector,d),g=h.vec3.dot(c.vector,c.vector),e=a.clamp(e/g,0,1);c=h.vec3.subtract(f.sv3d.get(),h.vec3.scale(f.sv3d.get(),
c.vector,e),d);return h.vec3.dot(c,c)}function k(c,d,e,g,k){var b=c.vector,l=c.origin;d=h.vec3.subtract(f.sv3d.get(),d,l);l=h.vec3.length(b);d=h.vec3.dot(b,d)/l;h.vec3.scale(k,b,a.clamp(d,e,g));return h.vec3.add(k,k,c.origin)}function p(c,d,e,g){var k=c.origin,b=h.vec3.add(f.sv3d.get(),k,c.vector);c=d.origin;var l=h.vec3.add(f.sv3d.get(),c,d.vector),p=f.sv3d.get();d=f.sv3d.get();p[0]=k[0]-c[0];p[1]=k[1]-c[1];p[2]=k[2]-c[2];d[0]=l[0]-c[0];d[1]=l[1]-c[1];d[2]=l[2]-c[2];if(1E-6>Math.abs(d[0])&&1E-6>
Math.abs(d[1])&&1E-6>Math.abs(d[2]))return!1;l=f.sv3d.get();l[0]=b[0]-k[0];l[1]=b[1]-k[1];l[2]=b[2]-k[2];if(1E-6>Math.abs(l[0])&&1E-6>Math.abs(l[1])&&1E-6>Math.abs(l[2]))return!1;var b=p[0]*d[0]+p[1]*d[1]+p[2]*d[2],r=d[0]*l[0]+d[1]*l[1]+d[2]*l[2],t=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],u=(l[0]*l[0]+l[1]*l[1]+l[2]*l[2])*t-r*r;if(1E-6>Math.abs(u))return!1;p=(b*r-(p[0]*l[0]+p[1]*l[1]+p[2]*l[2])*t)/u;b=(b+r*p)/t;e&&(p=a.clamp(p,0,1),b=a.clamp(b,0,1));e=f.sv3d.get();r=f.sv3d.get();e[0]=k[0]+p*l[0];e[1]=k[1]+p*
l[1];e[2]=k[2]+p*l[2];r[0]=c[0]+b*d[0];r[1]=c[1]+b*d[1];r[2]=c[2]+b*d[2];g.tA=p;g.tB=b;g.pA=e;g.pB=r;g.distance2=h.vec3.squaredDistance(e,r);return!0}Object.defineProperty(b,"__esModule",{value:!0});b.create=g;b.wrap=l;b.copy=function(c,a){void 0===a&&(a=g());return d(c.origin,c.vector,a)};b.fromValues=d;b.fromPoints=function(c,a,d){void 0===d&&(d=g());h.vec3.copy(d.origin,c);h.vec3.subtract(d.vector,a,c);return d};b.distance2=c;b.distance=function(a,d){return Math.sqrt(c(a,d))};b.projectPoint=function(c,
a,d){return k(c,a,0,1,d)};b.pointAt=function(c,a,d){return h.vec3.add(d,c.origin,h.vec3.scale(d,c.vector,a))};b.projectPointClamp=k;b.closestRayDistance2=function(c,a){if(p(c,l(a.origin,a.direction),!1,r)){a=r.tA;var d=r.pB,e=r.distance2;if(0<=a&&1>=a)return e;if(0>a)return h.vec3.squaredDistance(c.origin,d);if(1<a)return h.vec3.squaredDistance(h.vec3.add(f.sv3d.get(),c.origin,c.vector),d)}return null};b.closestLineSegmentPoint=function(c,a,d){return p(c,a,!0,r)?(h.vec3.copy(d,r.pA),!0):!1};b.closestLineSegmentDistance2=
function(c,a){return p(c,a,!0,r)?r.distance2:null};var r={tA:0,tB:0,pA:e.vec3f64.create(),pB:e.vec3f64.create(),distance2:0},t=new m.ObjectStack(function(){return{origin:null,vector:null}})})},"esri/views/3d/support/geometryUtils/plane":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3","../stack"],function(n,b,a,m,h){function e(c){void 0===c&&(c=b.UP);return[c[0],c[1],c[2],c[3]]}function f(c,a){void 0===a&&(a=e());return g(c[0],c[1],c[2],
c[3],a)}function g(c,a,d,f,g){void 0===g&&(g=e());g[0]=c;g[1]=a;g[2]=d;g[3]=f;return g}function l(c,a,f){void 0===f&&(f=e());m.vec3.copy(f,a);a=m.vec3.dot(a,a);1E-5<Math.abs(a-1)&&1E-12<a&&m.vec3.scale(f,f,1/Math.sqrt(a));d(f,c,f);return f}function d(c,a,d){c!==d&&f(c,d);d[3]=-m.vec3.dot(d,a);return d}function c(c,a,d,f){void 0===f&&(f=e());c=m.vec3.cross(h.sv3d.get(),a,c);return l(d,c,f)}function k(c,a,d){c=m.vec3.scale(h.sv3d.get(),c,m.vec3.dot(c,a));m.vec3.subtract(d,a,c);return d}function p(c,
a){return m.vec3.dot(c,a)+c[3]}function r(c,d,e,f,g,k){var b=m.vec3.dot(c,e);if(0===b)return!1;c=-(m.vec3.dot(c,d)+c[3])/b;g&&(c=f?Math.max(0,c):a.clamp(c,0,1));if(0>c||!f&&1<c)return!1;m.vec3.add(k,d,m.vec3.scale(k,e,c));return!0}Object.defineProperty(b,"__esModule",{value:!0});b.create=e;b.wrap=function(c,a,d,e){return g(c,a,d,e,h.sv4d.get())};b.copy=f;b.fromValues=g;b.fromNormalAndOffset=function(c,a,d){void 0===d&&(d=e());m.vec3.copy(d,c);d[3]=a;return d};b.fromPositionAndNormal=l;b.fromPoints=
function(a,d,f,g){void 0===g&&(g=e());return c(m.vec3.subtract(h.sv3d.get(),a,d),m.vec3.subtract(h.sv3d.get(),f,d),a,g)};b.setOffsetFromPoint=d;b.negate=function(c,a){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];a[3]=-c[3];return a};b.fromVectorsAndPoint=c;b.intersectRay=function(c,a,d){return r(c,a.origin,a.direction,!0,!1,d)};b.intersectLineSegment=function(c,a,d){return r(c,a.origin,a.vector,!1,!1,d)};b.intersectLineSegmentClamp=function(c,a,d){return r(c,a.origin,a.vector,!1,!0,d)};b.isSphereFullyInside=
function(c,a){var d=a.radius;return 0<=p(c,a.center)-d};b.isSphereFullyOutside=function(c,a){var d=a.radius;return 0>p(c,a.center)+d};b.isPointInside=function(c,a){return 0<=p(c,a)};b.isPointOutside=function(c,a){return 0>p(c,a)};b.isAABBFullyInside=function(c,a){var d=a[0],e=a[1],f=a[2],g=a[3],k=a[4];a=a[5];return 0<=c[0]*(0<c[0]?d:g)+c[1]*(0<c[1]?e:k)+c[2]*(0<c[2]?f:a)+c[3]};b.clip=function(c,a){var d=m.vec3.dot(c,a.ray.direction);c=-p(c,a.ray.origin);if(0>c&&0<=d)return!1;if(-1E-6<d&&1E-6>d)return 0<
c;if((0>c||0>d)&&!(0>c&&0>d))return!0;c/=d;0<d?c<a.c1&&(a.c1=c):c>a.c0&&(a.c0=c);return a.c0<=a.c1};b.clipInfinite=function(c,a){var d=m.vec3.dot(c,a.ray.direction);c=-p(c,a.ray.origin);if(-1E-6<d&&1E-6>d)return 0<c;c/=d;0<d?c<a.c1&&(a.c1=c):c>a.c0&&(a.c0=c);return a.c0<=a.c1};b.projectPoint=function(c,a,d){var e=m.vec3.scale(h.sv3d.get(),c,-c[3]);a=m.vec3.subtract(h.sv3d.get(),a,e);c=k(c,a,h.sv3d.get());m.vec3.add(d,c,e);return d};b.projectVector=k;b.distance=function(c,a){return Math.abs(p(c,a))};
b.signedDistance=p;b.normal=function(c){return c};b.UP=[0,0,1,0]})},"esri/views/3d/support/geometryUtils/ray":function(){define("require exports ../../../../core/ObjectStack ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack".split(" "),function(n,b,a,m,h,e,f,g){function l(c){return c?{origin:f.vec3f64.clone(c.origin),direction:f.vec3f64.clone(c.direction)}:{origin:f.vec3f64.create(),direction:f.vec3f64.create()}}
function d(c,a,d){void 0===d&&(d=l());e.vec3.copy(d.origin,c);e.vec3.copy(d.direction,a);return d}function c(c,a,d){void 0===d&&(d=l());var f=m.castRenderScreenPointArray3(h.vec2.copy(g.sv3d.get(),a));f[2]=0;c.unprojectPoint(f,d.origin);a=m.castRenderScreenPointArray3(h.vec2.copy(g.sv3d.get(),a));a[2]=1;c=c.unprojectPoint(a,g.sv3d.get());e.vec3.subtract(d.direction,c,d.origin);return d}function k(c,a,d){void 0===d&&(d=l());e.vec3.copy(d.origin,c.eye);a=e.vec3.set(g.sv3d.get(),a[0],a[1],1);c=c.unprojectPoint(a,
g.sv3d.get());e.vec3.subtract(d.direction,c,d.origin);return d}function p(c,a){c=e.vec3.cross(g.sv3d.get(),e.vec3.normalize(g.sv3d.get(),c.direction),e.vec3.subtract(g.sv3d.get(),a,c.origin));return e.vec3.dot(c,c)}function r(){return{origin:null,direction:null}}Object.defineProperty(b,"__esModule",{value:!0});b.create=l;b.wrap=function(c,a){var d=t.get();d.origin=c;d.direction=a;return d};b.copy=function(c,a){void 0===a&&(a=l());return d(c.origin,c.direction,a)};b.fromPoints=function(c,a,d){void 0===
d&&(d=l());e.vec3.copy(d.origin,c);e.vec3.subtract(d.direction,a,c);return d};b.fromValues=d;b.fromScreen=function(a,d,e){void 0===e&&(e=l());return c(a,a.screenToRender(d,m.castRenderScreenPointArray3(g.sv3d.get())),e)};b.fromRender=c;b.fromScreenAtEye=function(c,a,d){void 0===d&&(d=l());return k(c,c.screenToRender(a,m.castRenderScreenPointArray3(g.sv3d.get())),d)};b.fromRenderAtEye=k;b.distance2=p;b.distance=function(c,a){return Math.sqrt(p(c,a))};b.closestPoint=function(c,a,d){a=e.vec3.dot(c.direction,
e.vec3.subtract(d,a,c.origin));e.vec3.add(d,c.origin,e.vec3.scale(d,c.direction,a));return d};b.createWrapper=r;var t=new a.ObjectStack(r)})},"esri/views/3d/support/geometryUtils/clipRay":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec3 ../stack ./ray".split(" "),function(n,b,a,m,h,e){function f(c){return c?{ray:e.create(c.ray),c0:c.c0,c1:c.c1}:{ray:e.create(),c0:0,c1:Number.MAX_VALUE}}function g(c,a,d,g){void 0===g&&(g=f());e.copy(c,g.ray);g.c0=
a;g.c1=d;return g}function l(c,a,d){void 0===d&&(d=f());var g=m.vec3.length(c.vector);e.fromValues(c.origin,a,d.ray);d.c0=0;d.c1=g;return d}function d(c,a,d){return m.vec3.add(d,c.ray.origin,m.vec3.scale(d,c.ray.direction,a))}Object.defineProperty(b,"__esModule",{value:!0});b.create=f;b.wrap=function(a,d,e){var f=c.get();f.ray=a;f.c0=d;f.c1=e;return f};b.copy=function(c,a){void 0===a&&(a=f());return g(c.ray,c.c0,c.c1,a)};b.fromValues=g;b.fromRay=function(c,a){void 0===a&&(a=f());e.copy(c,a.ray);a.c0=
0;a.c1=Number.MAX_VALUE;return a};b.fromLineSegment=function(c,a){void 0===a&&(a=f());var d=m.vec3.normalize(h.sv3d.get(),c.vector);return l(c,d,a)};b.fromLineSegmentAndDirection=l;b.getStart=function(c,a){return d(c,c.c0,a)};b.getEnd=function(c,a){return d(c,c.c1,a)};b.getAt=d;var c=new a.ObjectStack(function(){return{c0:0,c1:0,ray:null}})})},"esri/views/3d/support/geometryUtils/frustum":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../stack ./clipRay ./plane".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c){function k(a){if(a){var d=a.planes;a=a.points;return{planes:[c.create(d[0]),c.create(d[1]),c.create(d[2]),c.create(d[3]),c.create(d[4]),c.create(d[5])],points:[e.vec3f64.clone(a[0]),e.vec3f64.clone(a[1]),e.vec3f64.clone(a[2]),e.vec3f64.clone(a[3]),e.vec3f64.clone(a[4]),e.vec3f64.clone(a[5]),e.vec3f64.clone(a[6]),e.vec3f64.clone(a[7])]}}return{planes:[c.create(),c.create(),c.create(),c.create(),c.create(),c.create()],points:[e.vec3f64.create(),e.vec3f64.create(),e.vec3f64.create(),
e.vec3f64.create(),e.vec3f64.create(),e.vec3f64.create(),e.vec3f64.create(),e.vec3f64.create()]}}function p(a,d,e){void 0===e&&(e=k());for(var f=0;6>f;f++)c.copy(a[f],e.planes[f]);for(f=0;8>f;f++)h.vec3.copy(e.points[f],d[f]);return e}function r(a){var d=a.planes;a=a.points;c.fromPoints(a[4],a[0],a[3],d[0]);c.fromPoints(a[1],a[5],a[6],d[1]);c.fromPoints(a[4],a[5],a[1],d[2]);c.fromPoints(a[3],a[2],a[6],d[3]);c.fromPoints(a[0],a[1],a[2],d[4]);c.fromPoints(a[5],a[4],a[7],d[5])}function t(a,d){for(var e=
0;6>e;e++)if(!c.clip(a[e],d))return!1;return!0}Object.defineProperty(b,"__esModule",{value:!0});b.create=k;b.copy=function(c,a){void 0===a&&(a=k());return p(c.planes,c.points,a)};b.fromValues=p;b.fromMatrix=function(c,a,d){void 0===d&&(d=k());var e=d.points;c=m.mat4.multiply(l.sm4d.get(),a,c);m.mat4.invert(c,c);for(a=0;8>a;++a){var g=f.vec4.transformMat4(l.sv4d.get(),u[a],c);h.vec3.set(e[a],g[0]/g[3],g[1]/g[3],g[2]/g[3])}r(d);return d};b.recomputePlanes=r;b.intersectsSphere=function(a,d){for(var e=
0;6>e;e++)if(c.isSphereFullyInside(a[e],d))return!1;return!0};b.intersectsRay=function(c,a){return t(c,d.fromRay(a,v.get()))};b.intersectClipRay=function(a,d){for(var e=0;6>e;e++)if(!c.clipInfinite(a[e],d))return!1;return!0};b.intersectsLineSegment=function(c,a,e){return t(c,d.fromLineSegmentAndDirection(a,e,v.get()))};b.intersectsPoint=function(a,d){for(var e=0;6>e;e++)if(0<c.signedDistance(a[e],d))return!1;return!0};b.intersectsAABB=function(a,d){for(var e=0;6>e;e++)if(c.isAABBFullyInside(a[e],
d))return!1;return!0};b.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]};var u=[g.vec4f64.fromValues(-1,-1,-1,1),g.vec4f64.fromValues(1,-1,-1,1),g.vec4f64.fromValues(1,1,-1,1),g.vec4f64.fromValues(-1,1,-1,1),g.vec4f64.fromValues(-1,-1,1,1),g.vec4f64.fromValues(1,-1,1,1),g.vec4f64.fromValues(1,1,1,1),g.vec4f64.fromValues(-1,1,1,1)],v=new a.ObjectStack(d.create)})},"esri/views/3d/support/geometryUtils/sphere":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../geometryUtils ../mathUtils ../stack ./ray".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p){function r(c){return c?{radius:c.radius,center:l.vec3f64.clone(c.center)}:{radius:1,center:l.vec3f64.create()}}function t(c,a){void 0===a&&(a=r());return u(c.radius,c.center,a)}function u(c,a,d){void 0===d&&(d=r());g.vec3.copy(d.center,a);d.radius=c;return d}function v(c,a,d){var e=g.vec3.subtract(k.sv3d.get(),a.origin,c.center),f=g.vec3.dot(a.direction,a.direction),b=2*g.vec3.dot(a.direction,e);c=g.vec3.dot(e,e)-c.radius*c.radius;c=b*b-4*f*c;if(0>c)return!1;e=
Math.sqrt(c);c=(-b-e)/(2*f);f=(-b+e)/(2*f);if(0>c||f<c&&0<f)c=f;if(0>c)return!1;d&&g.vec3.add(d,a.origin,g.vec3.scale(k.sv3d.get(),a.direction,c));return!0}function z(c,a,e){var b=k.sv3d.get(),l=k.sm4d.get();g.vec3.cross(b,a.origin,a.direction);g.vec3.cross(e,b,a.origin);g.vec3.scale(e,e,1/g.vec3.length(e)*c.radius);c=q(c,a.origin);a=d.vector.angle(a.origin,e);f.mat4.identity(l);f.mat4.rotate(l,l,a+c,b);g.vec3.transformMat4(e,e,l);return e}function w(c,a,d){a=g.vec3.subtract(k.sv3d.get(),a,c.center);
a=g.vec3.scale(k.sv3d.get(),a,c.radius/g.vec3.length(a));return g.vec3.add(d,a,c.center)}function q(c,a){a=g.vec3.subtract(k.sv3d.get(),a,c.center);a=g.vec3.length(a);return h.acosClamped(c.radius/(c.radius+Math.abs(c.radius-a)))}function y(d,e,f,k){d=g.vec3.subtract(C,e,d.center);switch(f){case 0:return d=c.cartesianToSpherical(d,C),d=d[2],g.vec3.set(k,-Math.sin(d),Math.cos(d),0);case 1:return d=c.cartesianToSpherical(d,C),f=d[1],d=d[2],e=Math.sin(f),g.vec3.set(k,-e*Math.cos(d),-e*Math.sin(d),Math.cos(f));
case 2:return g.vec3.normalize(k,d);default:a.neverReached(f)}}function A(c,a){a=g.vec3.subtract(G,a,c.center);return g.vec3.length(a)-c.radius}Object.defineProperty(b,"__esModule",{value:!0});var B=m.getLogger("esri.views.3d.support.geometryUtils.sphere");b.create=r;b.wrap=function(c,a){var d=F.get();d.radius=c;d.center=a||I;return d};b.copy=t;b.fromValues=u;b.elevate=function(c,a,d){c!==d&&g.vec3.copy(d.center,c.center);d.radius=c.radius+a;return d};b.setExtent=function(c,a,d){B.error("sphere.setExtent is not yet supported");
return c===d?d:t(c,d)};b.intersectRay=v;b.intersectScreen=function(c,a,d,e){a=p.fromScreenAtEye(a,d,H);return v(c,a,e)};b.intersectsRay=function(c,a){return v(c,a,null)};b.intersectRayClosestSilhouette=function(c,a,d){if(v(c,a,d))return d;c=z(c,a,k.sv3d.get());g.vec3.add(d,a.origin,g.vec3.scale(k.sv3d.get(),a.direction,g.vec3.distance(a.origin,c)/g.vec3.length(a.direction)));return d};b.closestPointOnSilhouette=z;b.closestPoint=function(c,a,d){if(v(c,a,d))return d;p.closestPoint(a,c.center,d);return w(c,
d,d)};b.projectPoint=w;b.distanceToSilhouette=function(c,a){a=g.vec3.subtract(k.sv3d.get(),a,c.center);a=g.vec3.squaredLength(a);return Math.sqrt(Math.abs(a-c.radius*c.radius))};b.angleToSilhouette=q;var C=l.vec3f64.create();b.axisAt=y;b.altitudeAt=A;b.setAltitudeAt=function(c,a,d,e){var f=A(c,a);c=y(c,a,2,G);d=g.vec3.scale(G,c,d-f);g.vec3.add(e,a,d);return e};var F=new e.ObjectStack(function(){return{center:null,radius:0}}),H=p.create(),I=l.vec3f64.create(),G=l.vec3f64.create();Object.freeze(I)})},
"esri/views/3d/support/geometryUtils/triangle":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack ./lineSegment".split(" "),function(n,b,a,m,h,e,f,g){function l(c){return c?{p0:e.vec3f64.clone(c.p0),p1:e.vec3f64.clone(c.p1),p2:e.vec3f64.clone(c.p2)}:{p0:e.vec3f64.create(),p1:e.vec3f64.create(),p2:e.vec3f64.create()}}function d(c,a,d,e){void 0===e&&(e=l());h.vec3.copy(e.p0,
c);h.vec3.copy(e.p1,a);h.vec3.copy(e.p2,d);return e}function c(c,a,d){var e=m.vec2.distance(c,a);a=m.vec2.distance(a,d);c=m.vec2.distance(d,c);d=(e+a+c)/2;e=d*(d-e)*(d-a)*(d-c);return 0>=e?0:Math.sqrt(e)}Object.defineProperty(b,"__esModule",{value:!0});b.create=l;b.wrap=function(c,a,d){var e=p.get();e.p0=c;e.p1=a;e.p2=d;return e};b.copy=function(c,a){void 0===a&&(a=l());return d(c.p0,c.p1,c.p2,a)};b.fromValues=d;b.distance2=function(c,a){var d=c.p0,e=c.p1;c=c.p2;var b=h.vec3.subtract(f.sv3d.get(),
e,d),l=h.vec3.subtract(f.sv3d.get(),c,e),p=h.vec3.subtract(f.sv3d.get(),d,c),r=h.vec3.subtract(f.sv3d.get(),a,d),t=h.vec3.subtract(f.sv3d.get(),a,e),m=h.vec3.subtract(f.sv3d.get(),a,c),u=h.vec3.cross(b,b,p),v=h.vec3.dot(h.vec3.cross(f.sv3d.get(),b,u),r),t=h.vec3.dot(h.vec3.cross(f.sv3d.get(),l,u),t),m=h.vec3.dot(h.vec3.cross(f.sv3d.get(),p,u),m);if(0<v&&0<t&&0<m)return a=h.vec3.dot(u,r),a*a/h.vec3.dot(u,u);d=g.distance2(g.fromValues(d,b,k.get()),a);e=g.distance2(g.fromValues(e,l,k.get()),a);a=g.distance2(g.fromValues(c,
p,k.get()),a);return Math.min(d,e,a)};b.intersectRay=function(c,a,d){var e=a.direction;a=a.origin;var f=c.p0,g=c.p1,k=c.p2,b=g[0]-f[0],l=g[1]-f[1],p=g[2]-f[2],g=k[0]-f[0];c=k[1]-f[1];var k=k[2]-f[2],r=e[1]*k-c*e[2],t=e[2]*g-k*e[0],m=e[0]*c-g*e[1],u=b*r+l*t+p*m;if(-1E-5<u&&1E-5>u)return!1;var u=1/u,v=a[0]-f[0],z=a[1]-f[1],f=a[2]-f[2],r=u*(v*r+z*t+f*m);if(0>r||1<r)return!1;t=z*p-l*f;p=f*b-p*v;b=v*l-b*z;l=u*(e[0]*t+e[1]*p+e[2]*b);if(0>l||1<r+l)return!1;d&&(h.vec3.scale(d,e,u*(g*t+c*p+k*b)),h.vec3.add(d,
a,d));return!0};b.areaPoints2d=c;b.area2d=function(a){return c(a.p0,a.p1,a.p2)};b.areaPoints3d=function(c,a,d){h.vec3.subtract(r,a,c);h.vec3.subtract(t,d,c);return h.vec3.length(h.vec3.cross(r,r,t))/2};var k=new a.ObjectStack(g.create),p=new a.ObjectStack(function(){return{p0:null,p1:null,p2:null}}),r=e.vec3f64.create(),t=e.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/GeometryData":function(){define(["require","exports","./geometryDataUtils","./Util"],function(n,b,a,m){Object.defineProperty(b,
"__esModule",{value:!0});n=function(){function b(e,f,g){void 0===f&&(f=b.DefaultIndices);void 0===g&&(g="triangle");var l={},d;for(d in e){var c=e[d],k=c.size;l[d]={data:c.data,size:k,offsetIdx:0,strideIdx:k}}if(f===b.DefaultIndices){f=m.getFirstObjectValue(l);f=null==f?0:f.data.length/f.size;e=a.generateDefaultIndexArray(f);f={};for(var h in l)f[h]=e}this._id=a.getNewId();this._vertexAttributes=l;this._indices=f;this._primitiveType=g}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indexCount",{get:function(){var a=m.getFirstObjectValue(this._indices);return null==a?0:a.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"primitiveType",{get:function(){return this._primitiveType},
enumerable:!0,configurable:!0});b.prototype.getVertexAttr=function(){return this.vertexAttributes};b.prototype.toRenderData=function(){return{id:this._id.toString(),indices:this._indices,vertexAttr:this._vertexAttributes}};b.prototype.getIndices=function(a){return this._indices[a]};b.prototype.getAttribute=function(a){return this._vertexAttributes[a]};b.prototype.estimateGpuMemoryUsage=function(){var a=0;this._indices[m.VertexAttrConstants.POSITION]&&(a+=12*this._indices[m.VertexAttrConstants.POSITION].length);
this._indices[m.VertexAttrConstants.NORMAL]&&(a+=12*this._indices[m.VertexAttrConstants.NORMAL].length);this._indices[m.VertexAttrConstants.UV0]&&(a+=8*this._indices[m.VertexAttrConstants.UV0].length);this._indices[m.VertexAttrConstants.COLOR]&&(a+=4*this._indices[m.VertexAttrConstants.COLOR].length);return a};b.DefaultIndices={};return b}();b.GeometryData=n})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64",
"../../support/geometryUtils/triangle"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});var e=1,f=null,g=new Uint32Array([0]);b.generateDefaultIndexArray=function(c){if(1===c)return g;if(c>e||null==f){for(;c>e;)e*=2;f=new Uint32Array(e);for(var a=0;a<e;a++)f[a]=a}return new Uint32Array(f.buffer,0,c)};b.computeAttachmentOriginTriangles=function(e,f,g){if(!e)return!1;var b=e.strideIdx,l=e.offsetIdx;e=e.data;a.vec3.set(g,0,0,0);a.vec3.set(p,0,0,0);for(var r=0,q=0,t=0;t<f.length-
2;t+=3){var m=f[t+0]*b+l,u=f[t+1]*b+l,C=f[t+2]*b+l;a.vec3.set(d,e[m+0],e[m+1],e[m+2]);a.vec3.set(c,e[u+0],e[u+1],e[u+2]);a.vec3.set(k,e[C+0],e[C+1],e[C+2]);(m=h.areaPoints3d(d,c,k))?(a.vec3.add(d,d,c),a.vec3.add(d,d,k),a.vec3.scale(d,d,1/3*m),a.vec3.add(g,g,d),r+=m):(a.vec3.add(p,p,d),a.vec3.add(p,p,c),a.vec3.add(p,p,k),q+=3)}return 0===q&&0===r?!1:0!==r?(a.vec3.scale(g,g,1/r),!0):0!==q?(a.vec3.scale(g,p,1/q),!0):!1};b.computeAttachmentOriginPoints=function(c,d,e){if(!c||!d)return!1;var f=c.strideIdx,
g=c.offsetIdx;c=c.data;a.vec3.set(e,0,0,0);for(var k=-1,b=0,l=0;l<d.length;l++){var h=d[l]*f+g;k!==h&&(e[0]+=c[h+0],e[1]+=c[h+1],e[2]+=c[h+2],b++);k=h}1<b&&a.vec3.scale(e,e,1/b);return 0<b};b.computeAttachmentOriginLines=function(e,f,g,k){if(!e)return!1;var b=e.strideIdx,l=e.offsetIdx;e=e.data;a.vec3.set(k,0,0,0);a.vec3.set(p,0,0,0);var h=0,r=0,t=f?f.length-1:e.length/b-1;g=t+(g?2:0);for(var m=0;m<g;m+=2){var u=m<t?m:t,v=m<t?m+1:0,u=(f?f[u]:u)*b+l,v=(f?f[v]:v)*b+l;d[0]=e[u+0];d[1]=e[u+1];d[2]=e[u+
2];c[0]=e[v+0];c[1]=e[v+1];c[2]=e[v+2];a.vec3.scale(d,a.vec3.add(d,d,c),.5);v=a.vec3.dist(d,c);0<v?(a.vec3.add(k,k,a.vec3.scale(d,d,v)),h+=v):(a.vec3.add(p,p,d),r++)}return 0!==h?(a.vec3.scale(k,k,1/h),!0):0!==r?(a.vec3.scale(k,p,1/r),!0):!1};var l=0;b.getNewId=function(){return l++};var d=m.vec3f64.create(),c=m.vec3f64.create(),k=m.vec3f64.create(),p=m.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/Util":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64".split(" "),
function(n,b,a,m,h,e,f,g,l){function d(c,a){if(!c)throw a=a||"assert",c=Error(a),c.stack&&console.log(c.stack),new u(a);}function c(c){for(var a in c)return a}function k(c,a){c[12]=a[0];c[13]=a[1];c[14]=a[2]}function p(c,a){void 0===a&&(a=0);for(var d=0,e=0;4>e;e++)d+=c[a+e]*z[e];return d}function r(c){return c-Math.floor(c)}Object.defineProperty(b,"__esModule",{value:!0});var t=l.vec4f64.create(),u=function(){function c(c){this.message=c}c.prototype.toString=function(){return"AssertException: "+
this.message};return c}();b.AssertException=u;b.VertexAttrConstants={POSITION:"position",NORMAL:"normal",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",TANGENT:"tangent"};b.assert=d;b.verify=function(c,a){c||console.warn("Verify failed: "+(a||"")+"\n"+Error("verify").stack)};b.encodeInt16=function(c){return a.clamp(Math.round(32767*c),-32767,32767)};b.encodeNormal=function(c,a){var d=Math.abs(c[0]),e=Math.abs(c[1]),f=1/(d+e+Math.abs(c[2])),g=Math.min(c[2]*
f,0);a[0]=(0>c[0]?-1:1)*(d*f-g);a[1]=(0>c[1]?-1:1)*(e*f-g)};b.fallbackIfUndefined=function(c,a){return void 0===c?a:c};b.hex2rgb=function(c){c=Math.floor(c);return[(c>>16&255)/255,(c>>8&255)/255,(c&255)/255]};b.rgb2hex=function(c){var d=a.clamp(Math.round(255*c[0]),0,255),e=a.clamp(Math.round(255*c[1]),0,255);c=a.clamp(Math.round(255*c[2]),0,255);return"0x"+((d<<16)+(e<<8)+c).toString(16)};b.dec2hex=function(c){c=c.toString(16);return"00000000".substr(0,8-c.length)+c};b.rayTriangle3D=function(c,a,
d,e,g,k,b,l,h){void 0===h&&(h=f.vec3f64.create());var q=e[b]-d[k],p=e[b+1]-d[k+1],r=e[b+2]-d[k+2];e=g[l]-d[k];b=g[l+1]-d[k+1];g=g[l+2]-d[k+2];var t=a[1]*g-b*a[2],m=a[2]*e-g*a[0],u=a[0]*b-e*a[1];l=q*t+p*m+r*u;if(-1E-5<l&&1E-5>l)return!1;l=1/l;var w=c[0]-d[k],v=c[1]-d[k+1];c=c[2]-d[k+2];h[1]=l*(w*t+v*m+c*u);if(0>h[1]||1<h[1])return!1;d=v*r-p*c;c=c*q-r*w;q=w*p-q*v;h[2]=l*(a[0]*d+a[1]*c+a[2]*q);if(0>h[2]||1<h[1]+h[2])return!1;h[0]=l*(e*d+b*c+g*q);return!0};b.rayBoxTest=function(c,a,d,e){var f,g=(d[0]-
c[0])/a[0],k=(e[0]-c[0])/a[0];g>k&&(f=g,g=k,k=f);var b=(d[1]-c[1])/a[1],l=(e[1]-c[1])/a[1];b>l&&(f=b,b=l,l=f);if(g>l||b>k)return!1;b>g&&(g=b);l<k&&(k=l);d=(d[2]-c[2])/a[2];c=(e[2]-c[2])/a[2];d>c&&(f=d,d=c,c=f);if(g>c||d>k)return!1;c<k&&(k=c);return 0>k?!1:!0};b.rayRay2D=function(c,a,d,f,g,k){void 0===k&&(k=e.vec2f64.create());var b=(f[g]-d[g])*(a[0]-c[0])-(f[0]-d[0])*(a[g]-c[g]);if(0===b)return!1;d=((f[0]-d[0])*(c[g]-d[g])-(f[g]-d[g])*(c[0]-d[0]))/b;k[0]=c[0]+d*(a[0]-c[0]);k[1]=c[g]+d*(a[g]-c[g]);
return!0};b.project=function(c,a,e,f,k){k||(k=c);t[0]=c[0];t[1]=c[1];t[2]=c[2];t[3]=1;g.vec4.transformMat4(t,t,a);2<k.length&&(k[2]=-t[2]);g.vec4.transformMat4(t,t,e);d(0!==t[3]);k[0]=t[0]/t[3];k[1]=t[1]/t[3];k[2]=t[2]/t[3];k[0]=(.5*k[0]+.5)*f[2]+f[0];k[1]=(.5*k[1]+.5)*f[3]+f[1]};b.getFirstObjectKey=c;b.getFirstObjectValue=function(a){return a[c(a)]};b.objectEmpty=function(c){for(var a in c)return!1;return!0};b.logWithBase=function(c,a){return Math.log(c)/Math.log(a)};b.setMatrixTranslation=k;b.setMatrixTranslation3=
function(c,a,d,e){c[12]=a;c[13]=d;c[14]=e};b.getMatrixTranslation=function(c,a){void 0===a&&(a=f.vec3f64.create());a[0]=c[12];a[1]=c[13];a[2]=c[14];return a};b.createTranslationMatrix=function(c,a){c=m.mat4.identity(c);k(c,a);return c};b.isTranslationMatrix=function(c){return 1===c[0]&&0===c[1]&&0===c[2]&&0===c[3]&&0===c[4]&&1===c[5]&&0===c[6]&&0===c[7]&&0===c[8]&&0===c[9]&&1===c[10]&&0===c[11]&&1===c[15]};b.fovx2fovy=function(c,a,d){return 2*Math.atan(d*Math.tan(.5*c)/a)};b.fovy2fovx=function(c,
a,d){return 2*Math.atan(a*Math.tan(.5*c)/d)};b.fovx2fovd=function(c,a,d){return 2*Math.atan(Math.sqrt(a*a+d*d)*Math.tan(.5*c)/a)};b.fovy2fovd=function(c,a,d){return 2*Math.atan(Math.sqrt(a*a+d*d)*Math.tan(.5*c)/d)};b.fovd2fovx=function(c,a,d){return 2*Math.atan(a*Math.tan(.5*c)/Math.sqrt(a*a+d*d))};b.fovd2fovy=function(c,a,d){return 2*Math.atan(d*Math.tan(.5*c)/Math.sqrt(a*a+d*d))};b.packFloatRGBA=function(c,d,e){void 0===e&&(e=0);c=a.clamp(c,0,w);for(var f=0;4>f;f++)d[e+f]=Math.floor(256*r(c*v[f]))};
b.unpackFloatRGBA=p;var v=[1,256,65536,16777216],z=[1/256,1/65536,1/16777216,1/4294967296],w=p(new Uint8ClampedArray([255,255,255,255]));b.inverseProjectionInfo=function(c,a,d,e,f){0===c[11]?(e[0]=2/(a*c[0]),e[1]=2/(d*c[5]),e[2]=(1+c[12])/c[0],e[3]=(1+c[13])/c[5],h.vec2.set(f,0,1)):(e[0]=-2/(a*c[0]),e[1]=-2/(d*c[5]),e[2]=(1-c[8])/c[0],e[3]=(1-c[9])/c[5],h.vec2.set(f,1,0))}})},"esri/views/webgl/BufferObject":function(){define(["require","exports","../../core/has","../../core/typedArrayUtil"],function(n,
b,a,m){return function(){function a(e,f,g,b,d){this._glName=this._context=null;this._bufferType=void 0;this._usage=35044;this._size=-1;this._indexType=void 0;this._context=e;this._bufferType=f;this._usage=g;this._id=a._nextId++;this._glName=this._context.gl.createBuffer();b&&this.setData(b,d)}a.createIndex=function(e,f,g,b){return new a(e,34963,f,g,b)};a.createVertex=function(e,f,g){return new a(e,34962,f,g)};Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"usage",{get:function(){return this._usage},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"bufferType",{get:function(){return this._bufferType},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"indexType",{get:function(){return this._indexType},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"byteSize",{get:function(){return 34962===this._bufferType?this._size:5125===this._indexType?4*this._size:2*this._size},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context=null)};a.prototype.setData=function(a,f){if(a){if("number"===typeof a){if(0>a&&console.error("Buffer size cannot be negative!"),34963===this._bufferType&&
f)switch(this._indexType=f,this._size=a,f){case 5123:a*=2;break;case 5125:a*=4}}else f=a.byteLength,m.isUint16Array(a)&&(f/=2,this._indexType=5123),m.isUint32Array(a)&&(f/=4,this._indexType=5125),this._size=f;f=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferData(this._bufferType,a,this._usage);this._context.bindVAO(f)}};a.prototype.setSubData=function(a,f,g,b){void 0===f&&(f=0);void 0===g&&(g=0);if(a){(0>f||f>=this._size)&&console.error("offset is out of range!");
var d=f,c=g,e=b,l=a.byteLength;m.isUint16Array(a)&&(l/=2,d*=2,c*=2,e*=2);m.isUint32Array(a)&&(l/=4,d*=4,c*=4,e*=4);void 0===b&&(b=l-1);g>=b&&console.error("end must be bigger than start!");f+g-b>this._size&&console.error("An attempt to write beyond the end of the buffer!");f=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);g=this._context.gl;a=ArrayBuffer.isView(a)?a.buffer:a;g.bufferSubData(this._bufferType,d,a.slice(c,e));this._context.bindVAO(f)}};a._nextId=
0;return a}()})},"esri/views/webgl/Texture":function(){define("require exports tslib ../../core/has ../../core/mathUtils ../../core/maybe".split(" "),function(n,b,a,m,h,e){return function(){function f(e,b,d){void 0===d&&(d=null);this._glName=this._context=null;this._id=-1;this._descriptor=void 0;this._wrapModeDirty=this._samplingModeDirty=!1;this._boundToUnits=new Set;this._context=e;this._descriptor=a.__assign({target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,
preMultiplyAlpha:!1},b);this._id=++f._nextId;this.setData(d)}Object.defineProperty(f.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"descriptor",{get:function(){return this._descriptor},enumerable:!0,configurable:!0});f.prototype.dispose=function(){var a=this;if(this._context&&this._context.gl){if(this._glName){var e=this._context.gl;
this._boundToUnits.forEach(function(d){a._context.bindTexture(null,d)});e.deleteTexture(this._glName);this._glName=null}this._context=null}};f.prototype.release=function(){this.dispose()};f.prototype.resize=function(a,e){var d=this._descriptor;if(d.width!==a||d.height!==e)d.width=a,d.height=e,this.setData(null)};f.prototype.setData=function(a){var g=this._context.gl;this._glName||(this._glName=g.createTexture());void 0===a&&(a=null);null===a&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=
this._descriptor.height||4);var d=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var c=this._descriptor;f._validateTexture(c);g.pixelStorei(g.UNPACK_ALIGNMENT,c.unpackAlignment);g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,c.flipped?1:0);g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c.preMultiplyAlpha?1:0);var k=c.pixelFormat,b=c.internalFormat?c.internalFormat:k;if(a instanceof ImageData||a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement){var h=
a.width,t=a.height;a instanceof HTMLVideoElement&&(h=a.videoWidth,t=a.videoHeight);c.width&&c.height&&console.assert(h===c.width&&t===c.height);g.texImage2D(g.TEXTURE_2D,0,b,k,c.dataType,a);c.hasMipmap&&this.generateMipmap();void 0===c.width&&(c.width=h);void 0===c.height&&(c.height=t)}else{null!=c.width&&null!=c.height||console.error("Width and height must be specified!");g.DEPTH24_STENCIL8&&b===g.DEPTH_STENCIL&&(b=g.DEPTH24_STENCIL8);var h=c.width,t=c.height,m=a;if(e.isSome(m)&&"type"in m&&"compressed"===
m.type)for(k=Math.round(Math.log(Math.max(h,t))/Math.LN2)+1,c.hasMipmap=c.hasMipmap&&k===a.levels.length,m=0;;++m){g.compressedTexImage2D(g.TEXTURE_2D,m,b,h,t,0,a.levels[Math.min(m,a.levels.length-1)]);if(1===h&&1===t||!c.hasMipmap)break;h=Math.max(1,h>>1);t=Math.max(1,t>>1)}else if(e.isSome(a))g.texImage2D(g.TEXTURE_2D,0,b,h,t,0,k,c.dataType,a),c.hasMipmap&&this.generateMipmap();else for(m=0;;++m){g.texImage2D(g.TEXTURE_2D,m,b,h,t,0,k,c.dataType,null);if(1===h&&1===t||!c.hasMipmap)break;h=Math.max(1,
h>>1);t=Math.max(1,t>>1)}}f._applySamplingMode(g,this._descriptor);f._applyWrapMode(g,this._descriptor);f._applyAnisotropicFilteringParameters(this._context,this._descriptor);this._context.bindTexture(d,0)};f.prototype.updateData=function(a,e,d,c,f,b){b||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");var g=this._context.gl,k=this._descriptor,l=this._context.getBoundTexture(0);this._context.bindTexture(this,0);(0>e||
0>d||c>k.width||f>k.height||e+c>k.width||d+f>k.height)&&console.error("An attempt to update out of bounds of the texture!");g.pixelStorei(g.UNPACK_ALIGNMENT,k.unpackAlignment);g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,k.flipped?1:0);g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k.preMultiplyAlpha?1:0);b instanceof ImageData||b instanceof HTMLImageElement||b instanceof HTMLCanvasElement||b instanceof HTMLVideoElement?g.texSubImage2D(g.TEXTURE_2D,a,e,d,k.pixelFormat,k.dataType,b):g.texSubImage2D(g.TEXTURE_2D,
a,e,d,c,f,k.pixelFormat,k.dataType,b);this._context.bindTexture(l,0)};f.prototype.generateMipmap=function(){var a=this._descriptor;a.hasMipmap||(a.hasMipmap=!0,f._validateTexture(a));9729===a.samplingMode?(this._samplingModeDirty=!0,a.samplingMode=9985):9728===a.samplingMode&&(this._samplingModeDirty=!0,a.samplingMode=9984);a=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var e=this._context.gl;e.generateMipmap(e.TEXTURE_2D);this._context.bindTexture(a,0)};f.prototype.setSamplingMode=
function(a){a!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=a,f._validateTexture(this._descriptor),this._samplingModeDirty=!0)};f.prototype.setWrapMode=function(a){a!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=a,f._validateTexture(this._descriptor),this._wrapModeDirty=!0)};f.prototype.applyChanges=function(){var a=this._context.gl,e=this._descriptor;this._samplingModeDirty&&(f._applySamplingMode(a,e),this._samplingModeDirty=!1);this._wrapModeDirty&&(f._applyWrapMode(a,
e),this._wrapModeDirty=!1)};f.prototype.setBoundToUnit=function(a,e){e?this._boundToUnits.add(a):this._boundToUnits.delete(a)};f._validateTexture=function(a){(0>a.width||0>a.height)&&console.error("Negative dimension parameters are not allowed!");h.isPowerOfTwo(a.width)&&h.isPowerOfTwo(a.height)||("number"===typeof a.wrapMode?33071!==a.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===a.wrapMode.s&&33071===a.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),
a.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};f._applySamplingMode=function(a,e){var d=e.samplingMode,c=e.samplingMode;if(9985===d||9987===d)d=9729,e.hasMipmap||(c=9729);else if(9984===d||9986===d)d=9728,e.hasMipmap||(c=9728);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,d);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,c)};f._applyWrapMode=function(a,e){"number"===typeof e.wrapMode?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,e.wrapMode),a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_WRAP_T,e.wrapMode)):(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,e.wrapMode.s),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,e.wrapMode.t))};f._applyAnisotropicFilteringParameters=function(a,e){if(null!=e.maxAnisotropy){var d=a.capabilities.textureFilterAnisotropic;d&&(a=a.gl,a.texParameterf(a.TEXTURE_2D,d.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy))}};f._nextId=0;return f}()})},"esri/views/webgl/Util":function(){define(["require","exports","tslib","../../core/compilerUtils","../../core/maybe"],
function(n,b,a,m,h){function e(a){return a[0].stride}function f(a){switch(a){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw m.neverReached(a),Error("Unknown data type");}}function g(a){switch(a){case 6406:case 6409:return 1;case 6410:return 2;case 6407:return 3;case 6408:return 4;case 34041:return 4;case 33325:return 2;case 33326:return 4;case 35898:return 4;case 33327:return 4;case 33328:return 8;
case 34842:return 8;case 34836:return 16;case 33189:return 2;case 34041:return 4;case 32854:return 2;case 36168:return 1;default:m.neverReached(a)}return 0}function l(a){if(h.isNone(a))return 0;if("colorAttachment"in a)return a.glName?l(a.colorAttachment)+l(a.depthStencilAttachment):0;if("descriptor"in a)return a.glName?l(a.descriptor):0;var c=a.internalFormat||"pixelFormat"in a&&a.pixelFormat;if(!c)return 0;var d="hasMipmap"in a&&a.hasMipmap?1.3:1;a=a.width*a.height;return g(c)*a*d}Object.defineProperty(b,
"__esModule",{value:!0});b.vertexCount=function(a,c){return a.vertexBuffers[c].size/e(a.layout[c])};b.getStride=e;b.getBytesPerElement=f;b.getTypedArrayConstructor=function(a){switch(a){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array;default:throw m.neverReached(a),Error("Unknown data type");}};b.addDescriptor=function(a,c,e,g,b,l){var d=f(g);if(0<
a.length){var k=a[0].stride,h=k+d*e;a.forEach(function(a){return a.stride=h});a.push({name:c,count:e,type:g,offset:k,stride:h,normalized:b,divisor:l})}else a.push({name:c,count:e,type:g,offset:0,stride:d*e,normalized:b,divisor:l})};b.hasAttribute=function(a,c){for(var d=0;d<a.length;d++)if(a[d].name===c)return!0;return!1};b.findAttribute=function(a,c){for(var d=0;d<a.length;d++)if(a[d].name===c)return a[d];return null};b.copyFramebufferToTexture=function(a,c,e,f,g){void 0===g&&(g=0);var d=a.getBoundFramebufferObject(),
k=a.getBoundTexture(0);a.bindFramebuffer(c);a.bindTexture(e,0);a.gl.copyTexImage2D(a.gl.TEXTURE_2D,g,e.descriptor.pixelFormat,f[0],f[1],f[2],f[3],0);a.gl.flush();a.bindFramebuffer(d);a.bindTexture(k,0)};b.setBaseInstanceOffset=function(d,c){var e={},f;for(f in d)e[f]=d[f].map(function(d){return d.divisor?a.__assign(a.__assign({},d),{baseInstance:c}):d});return e};b.bindVertexBufferLayout=function(a,c,e,f,g){var d=a.gl,k=a.capabilities.instancing;a.bindBuffer(e);for(a=0;a<f.length;a++){e=f[a];var b=
c[e.name],l=(g?g:0+e.baseInstance?e.baseInstance:0)*e.stride;void 0===b&&console.error("There is no location for vertex attribute '"+e.name+"' defined.");e.baseInstance&&!e.divisor&&console.error("Vertex attribute '"+e.name+"' uses baseInstanceOffset without divisor.");if(4>=e.count)d.vertexAttribPointer(b,e.count,e.type,e.normalized,e.stride,e.offset+l),d.enableVertexAttribArray(b),e.divisor&&0<e.divisor&&k&&k.vertexAttribDivisor(b,e.divisor);else if(9===e.count)for(var h=0;3>h;h++)d.vertexAttribPointer(b+
h,3,e.type,e.normalized,e.stride,e.offset+12*h+l),d.enableVertexAttribArray(b+h),e.divisor&&0<e.divisor&&k&&k.vertexAttribDivisor(b+h,e.divisor);else if(16===e.count)for(h=0;4>h;h++)d.vertexAttribPointer(b+h,4,e.type,e.normalized,e.stride,e.offset+16*h+l),d.enableVertexAttribArray(b+h),e.divisor&&0<e.divisor&&k&&k.vertexAttribDivisor(b+h,e.divisor);else console.error("Unsupported vertex attribute element count: "+e.count)}};b.unbindVertexBufferLayout=function(a,c,e,f){var d=a.gl,g=a.capabilities.instancing;
a.bindBuffer(e);for(e=0;e<f.length;e++){var k=f[e],b=c[k.name];if(4>=k.count)d.disableVertexAttribArray(b),k.divisor&&0<k.divisor&&g&&g.vertexAttribDivisor(b,0);else if(9===k.count)for(var l=0;3>l;l++)d.disableVertexAttribArray(b+l),k.divisor&&0<k.divisor&&g&&g.vertexAttribDivisor(b+l,0);else if(16===k.count)for(l=0;4>l;l++)d.disableVertexAttribArray(b+l),k.divisor&&0<k.divisor&&g&&g.vertexAttribDivisor(b+l,0);else console.error("Unsupported vertex attribute element count: "+k.count)}a.unbindBuffer(34962)};
b.getBytesPerElementFormat=g;b.getGpuMemoryUsage=l})},"esri/views/webgl/VertexArrayObject":function(){define(["require","exports","../../core/has","./Util"],function(n,b,a,m){return function(){function a(e,f,g,b,d){this._locations=this._layout=this._glName=this._context=null;this._indexBuffer=this._buffers=void 0;this._initialized=!1;this._context=e;this._layout=g;this._buffers=b;this._locations=f;d&&(this._indexBuffer=d);this._id=a._nextId++}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexBuffers",{get:function(){return this._buffers},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){var a=this;return Object.keys(this._buffers).reduce(function(e,
g){return e+a._buffers[g].size},this._indexBuffer?this._indexBuffer.size:0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});a.prototype.dispose=function(a){void 0===a&&(a=!0);if(this._context){var e=this._context.capabilities.vao;e&&this._glName&&(e.deleteVertexArray(this._glName),this._glName=
null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(a){for(var g in this._buffers)this._buffers[g].dispose(),delete this._buffers[g];this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}this._context=null}};a.prototype.initialize=function(){if(!this._initialized){var a=this._context.capabilities.vao;if(a){var f=a.createVertexArray();a.bindVertexArray(f);this._bindLayout();a.bindVertexArray(null);this._glName=f}this._initialized=!0}};a.prototype.bind=function(){this.initialize();
var a=this._context.capabilities.vao;a?a.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};a.prototype._bindLayout=function(){var a=this._buffers,f=!!this._context.capabilities.vao,g=this._layout,b=this._indexBuffer;a||console.error("Vertex buffer dictionary is empty!");var d=this._context.gl,c;for(c in a){var k=a[c];k||console.error("Vertex buffer is uninitialized!");var h=g[c];h||console.error("Vertex element descriptor is empty!");m.bindVertexBufferLayout(this._context,
this._locations,k,h)}b&&(f?d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,b.glName):this._context.bindBuffer(b))};a.prototype.unbind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(null):this._unbindLayout()};a.prototype._unbindLayout=function(){var a=this._buffers,f=this._layout;a||console.error("Vertex buffer dictionary is empty!");for(var g in a){var b=a[g];b||console.error("Vertex buffer is uninitialized!");m.unbindVertexBufferLayout(this._context,this._locations,b,
f[g])}(a=this._indexBuffer)&&this._context.unbindBuffer(a.bufferType)};a._nextId=0;return a}()})},"esri/views/3d/environment/RealisticAtmosphere":function(){define("require exports ../../../core/Handles ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ./atmosphereUtils ./RealisticAtmosphereTechnique ../support/earthUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,d){this._view=a;this.canRender=!0;this._skyslot=14;this._hazeSlot=15;this._renderData={texDepth:l.vec2f64.create(),cameraPosition:c.vec3f64.create(),projectionInverse:f.mat4f64.create(),viewInverse:f.mat4f64.create(),heightParameters:p.vec4f64.create(),atmosphereParameters1:p.vec4f64.create(),atmosphereParameters2:p.vec4f64.create(),atmosphereParameters3:c.vec3f64.create(),
invWavelength:A,invWavelengthScaled:B,radii:l.vec2f64.create(),scale:0,scaleDepth:C,lowerAlphaBlendBound:0,scaleOverScaleDepth:0,oneOverScaleDepth:0,scaleDepthBlue:F,oneOverScaleDepthBlue:I,scaleOverScaleDepthBlue:0,g:G,g2:G*G,miePhaseCoefficients:J,nearFar:l.vec2f64.create(),cameraHeight:0,cameraHeightSq:0,C:0,CSur:0,innerFadeDistance:0,altitudeFade:0};this._lowerElevationBoundRadius=0;this._earthRadius=u.earthRadius;this._updateRadius(u.earthRadius);this._techniqueRepository=d;this._atmosphereTechniqueConfig=
new t.RealisticAtmosphereTechniqueConfiguration}b.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);this._vao&&(this._vao.dispose(),this._vao=null)};b.prototype.when=function(){return m.resolve()};b.prototype.initializeRenderContext=function(c){var d=this;c=c.rctx;this._handles=new a;this._updateElevation({spatialReference:this._view.basemapTerrain.spatialReference,tile:this._view.basemapTerrain.rootTiles[0],extent:this._view.basemapTerrain.rootTiles[0].extent,
context:"ground"});this._handles.add(h.on(this._view,"basemapTerrain","elevation-change",function(a){return d._updateElevation(a)},function(){return d._updateElevation()}));this._handles.add(h.on(this._view,"basemapTerrain","elevation-bounds-change",function(){return d._updateVisibleElevationBounds()},function(){return d._updateVisibleElevationBounds()}));this._atmosphereTechniqueConfig.haze=!1;this._atmosphereTechnique=this._techniqueRepository.acquireAndReleaseExisting(t.RealisticAtmosphereTechnique,
this._atmosphereTechniqueConfig,this._atmosphereTechnique);this._atmosphereTechniqueConfig.haze=!0;this._atmosphereHazeTechnique=this._techniqueRepository.acquireAndReleaseExisting(t.RealisticAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereHazeTechnique);this._vao=this._createVertexArrayObject(c)};b.prototype.uninitializeRenderContext=function(){this.destroy()};b.prototype.render=function(a){if(a.slot!==this._hazeSlot&&a.slot!==this._skyslot||0!==a.pass)return!1;this._update(a.camera);
a.slot===this._skyslot&&this._renderSky(a);a.slot===this._hazeSlot&&this._renderHaze(a);return!0};b.prototype._renderSky=function(a){var c=a.rctx,d=this._atmosphereTechnique.program;c.bindProgram(d);this._atmosphereTechnique.bindPipelineState(c);d.setUniform3fv("atmosphereParameters3",this._renderData.atmosphereParameters3);this._renderCommon(d,a)};b.prototype._renderHaze=function(a){var c=this,d=a.rctx,e=a.offscreenRenderingHelper,f=this._atmosphereHazeTechnique.program;d.bindProgram(f);this._atmosphereHazeTechnique.bindPipelineState(d);
e.renderDepthDetached(function(){d.bindTexture(e.depthTexture,0);f.setUniform1i("depthTex",0);c._renderCommon(f,a)})};b.prototype._renderCommon=function(a,c){var d=c.rctx;a.setUniform3fv("invWavelength",this._renderData.invWavelength);a.setUniform3fv("invWavelengthScaled",this._renderData.invWavelengthScaled);c.scenelightingData.setLightDirectionUniform(a);a.setUniform4fv("heightParameters",this._renderData.heightParameters);a.setUniform3fv("cameraPosition",this._renderData.cameraPosition);a.setUniformMatrix4fv("projectionInverse",
this._renderData.projectionInverse);a.setUniformMatrix4fv("viewInverse",this._renderData.viewInverse);a.setUniform2fv("nearFar",this._renderData.nearFar);a.setUniform2fv("radii",this._renderData.radii);a.setUniform4fv("atmosphereParameters1",this._renderData.atmosphereParameters1);a.setUniform4fv("atmosphereParameters2",this._renderData.atmosphereParameters2);a.setUniform1f("innerFadeDistance",this._renderData.innerFadeDistance);a.setUniform1f("altitudeFade",this._renderData.altitudeFade);d.bindVAO(this._vao);
a.assertCompatibleVertexAttributeLocations(this._vao);d.drawArrays(5,0,4)};b.prototype._createVertexArrayObject=function(a){var c=E.createBuffer(4);c.position.setVec(0,[-1,-1]);c.position.setVec(1,[1,-1]);c.position.setVec(2,[-1,1]);c.position.setVec(3,[1,1]);c.uv0.setVec(0,[0,0]);c.uv0.setVec(1,[1,0]);c.uv0.setVec(2,[0,1]);c.uv0.setVec(3,[1,1]);return new y(a,w.Default3D,{geometry:v.glLayout(E)},{geometry:q.createVertex(a,35044,c.buffer)})};b.prototype._adjustRadiusForTesselation=function(a){return a*
Math.cos(Math.PI/Math.pow(2,4)/16)};b.prototype._updateElevation=function(a){a=a?a.tile:this._view.basemapTerrain.rootTiles[0];0===a.lij[0]&&(a=this._adjustRadiusForTesselation(u.earthRadius+a.elevationBounds[0]),a!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=a,this._earthRadius=-1,this._updateVisibleElevationBounds()))};b.prototype._updateVisibleElevationBounds=function(){var a=this._adjustRadiusForTesselation(u.earthRadius+this._view.basemapTerrain.elevationBounds.min);(0>
this._earthRadius||a<this._earthRadius)&&this._updateRadius(a)};b.prototype._updateRadius=function(a){this._earthRadius=a;var c=a/10*10.25,e=1/(c-a),f=e/C,b=e/F,l=.3*(c-a)+a,h=this._renderData;k.vec4.set(h.atmosphereParameters1,e,C,f,H);k.vec4.set(h.atmosphereParameters2,G,F,b,I);d.vec3.set(h.atmosphereParameters3,G*G,J,l);g.vec2.set(h.radii,a,c);h.scale=e;h.lowerAlphaBlendBound=l;h.scaleOverScaleDepth=f;h.scaleOverScaleDepthBlue=b;c=r.INNER_ATMOSPHERE_DEPTH;h.innerFadeDistance=2*Math.sqrt((2*a-c)*
c)};b.prototype._update=function(a){a&&(this._renderData.cameraHeight=d.vec3.length(a.eye),this._renderData.cameraHeightSq=this._renderData.cameraHeight*this._renderData.cameraHeight,this._renderData.C=this._renderData.cameraHeightSq-this._renderData.radii[1]*this._renderData.radii[1],this._renderData.CSur=this._renderData.cameraHeightSq-this._renderData.radii[0]*this._renderData.radii[0],this._renderData.heightParameters=p.vec4f64.fromValues(this._renderData.cameraHeight,this._renderData.cameraHeightSq,
this._renderData.C,this._renderData.CSur),d.vec3.copy(this._renderData.cameraPosition,a.eye),e.mat4.invert(this._renderData.projectionInverse,a.projectionMatrix),e.mat4.invert(this._renderData.viewInverse,a.viewMatrix),g.vec2.set(this._renderData.nearFar,a.near,a.far),this._renderData.altitudeFade=r.computeInnerAltitudeFade(this._renderData.cameraHeight-this._earthRadius))};b.isSupported=function(a){return a.rctx.capabilities.depthTexture};return b}();b.RealisticAtmosphere=n;b=.02*Math.PI;n=.004*
Math.PI;var A=c.vec3f64.fromValues(1/Math.pow(.65,4),1/Math.pow(.57,4),1/Math.pow(.475,4)),B=c.vec3f64.clone(A);d.vec3.scale(B,B,b);d.vec3.add(B,B,c.vec3f64.fromValues(n,n,n));var C=.25,F=.05,H=1/C,I=1/F,G=-.99999,J=(1-G*G)/(2+G*G)*1.5,E=z.newLayout().vec2f("position").vec2f("uv0")})},"esri/views/3d/environment/atmosphereUtils":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.computeInnerAltitudeFade=function(a){return Math.min(1,Math.max(0,
(a-1E5)/9E5))};b.INNER_ATMOSPHERE_DEPTH=1E4})},"esri/views/3d/environment/RealisticAtmosphereTechnique":function(){define("require exports tslib ../environment/RealisticAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",{value:!0});e=function(c){function e(){return null!==c&&c.apply(this,arguments)||this}a.__extends(e,c);e.prototype.initializeProgram=function(a){var c=e.shader.get().build({haze:this.configuration.haze});return new l(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),g.Default3D)};e.prototype.initializePipeline=function(){return this.configuration.haze?d.makePipelineState({blending:d.separateBlendingParams(1,0,769,1),colorWrite:d.defaultColorWriteParams}):
d.makePipelineState({blending:d.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:d.defaultColorWriteParams})};e.shader=new h.ReloadableShaderModule(m,function(){return new Promise(function(a,c){n(["../environment/RealisticAtmosphere.glsl"],a,c)})});return e}(e.ShaderTechnique);b.RealisticAtmosphereTechnique=e;e=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;a.haze=!1;return a}a.__extends(d,c);a.__decorate([f.parameter()],d.prototype,"haze",void 0);return d}(f.ShaderTechniqueConfiguration);
b.RealisticAtmosphereTechniqueConfiguration=e})},"esri/views/3d/environment/RealisticAtmosphere.glsl":function(){define("require exports tslib ../webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderModules/ShaderBuilder".split(" "),function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var E=new f.ShaderBuilder;E.attributes.add("position",
"vec2");E.attributes.add("uv0","vec2");E.varyings.add("worldRay","vec3");E.varyings.add("vtc","vec2");b.haze&&E.varyings.add("eyeDir","vec3");E.vertex.uniforms.add("projectionInverse","mat4");E.vertex.uniforms.add("viewInverse","mat4");E.vertex.code.add(e.glsl(l||(l=a.__makeTemplateObject(["\n    void main(void) {\n      vec3 posViewNear \x3d (projectionInverse * vec4(position, -1, 1)).xyz;\n\n      worldRay \x3d (viewInverse * vec4(posViewNear, 0)).xyz;\n      vtc \x3d uv0;\n\n      ","\n\n      gl_Position \x3d vec4(position, 1, 1);\n    }\n  "],
["\n    void main(void) {\n      vec3 posViewNear \x3d (projectionInverse * vec4(position, -1, 1)).xyz;\n\n      worldRay \x3d (viewInverse * vec4(posViewNear, 0)).xyz;\n      vtc \x3d uv0;\n\n      ","\n\n      gl_Position \x3d vec4(position, 1, 1);\n    }\n  "])),b.haze?e.glsl(g||(g=a.__makeTemplateObject(["eyeDir \x3d posViewNear;"],["eyeDir \x3d posViewNear;"]))):""));E.fragment.uniforms.add("lightingMainDirection","vec3").add("invWavelength","vec3").add("invWavelengthScaled","vec3").add("radii",
"vec2").add("atmosphereParameters1","vec4").add("atmosphereParameters2","vec4").add("cameraPosition","vec3").add("nearFar","vec2").add("heightParameters","vec4");b.haze?E.fragment.uniforms.add("depthTex","sampler2D"):E.fragment.uniforms.add("atmosphereParameters3","vec3").add("innerFadeDistance","float").add("altitudeFade","float");E.include(h.RgbaFloatEncoding);E.include(m.ColorConversion,{stages:1});E.fragment.code.add(e.glsl(d||(d=a.__makeTemplateObject(["\n  // Atmosphere\n  const float krESun \x3d 0.075;        // Kr * ESun \x3d 0.005 * 15.0\n  const float kmESun \x3d 0.015;        // Km * ESun \x3d 0.005 * 15\n\n  // The inner (planetary) radius\n  #define innerRadius radii[0]\n  // The outer (atmosphere) radius\n  #define outerRadius radii[1]\n\n  // Atmosphere parameters:\n\n  // shellScale:               1.0 / (outerRadius - innerRadius)\n  #define shellScale atmosphereParameters1.x\n\n  // shellDepth:               The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  // scaleDepthBlue:           The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  #define shellDepth vec2(atmosphereParameters1.y, atmosphereParameters2.y)\n\n  // scaleOverScaleDepth:      scale / shellDepth\n  // scaleOverScaleDepthBlue:  scale / scaleDepthBlue\n  #define scaleOverScaleDepth vec2(atmosphereParameters1.z, atmosphereParameters2.z)\n\n  // oneOverScaleDepth:        1.0 / shellDepth\n  // oneOverScaleDepthBlue;    1.0 / scaleDepthBlue\n  #define oneOverScaleDepth vec2(atmosphereParameters1.w, atmosphereParameters2.w)\n  "],
["\n  // Atmosphere\n  const float krESun \x3d 0.075;        // Kr * ESun \x3d 0.005 * 15.0\n  const float kmESun \x3d 0.015;        // Km * ESun \x3d 0.005 * 15\n\n  // The inner (planetary) radius\n  #define innerRadius radii[0]\n  // The outer (atmosphere) radius\n  #define outerRadius radii[1]\n\n  // Atmosphere parameters:\n\n  // shellScale:               1.0 / (outerRadius - innerRadius)\n  #define shellScale atmosphereParameters1.x\n\n  // shellDepth:               The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  // scaleDepthBlue:           The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  #define shellDepth vec2(atmosphereParameters1.y, atmosphereParameters2.y)\n\n  // scaleOverScaleDepth:      scale / shellDepth\n  // scaleOverScaleDepthBlue:  scale / scaleDepthBlue\n  #define scaleOverScaleDepth vec2(atmosphereParameters1.z, atmosphereParameters2.z)\n\n  // oneOverScaleDepth:        1.0 / shellDepth\n  // oneOverScaleDepthBlue;    1.0 / scaleDepthBlue\n  #define oneOverScaleDepth vec2(atmosphereParameters1.w, atmosphereParameters2.w)\n  "]))));
b.haze||E.fragment.code.add(e.glsl(c||(c=a.__makeTemplateObject(["\n      #define g atmosphereParameters2.x\n      #define gSq atmosphereParameters3.x\n      #define miePhaseCoefficients atmosphereParameters3.y\n      #define lowerAlphaBlendBound atmosphereParameters3.z\n    "],["\n      #define g atmosphereParameters2.x\n      #define gSq atmosphereParameters3.x\n      #define miePhaseCoefficients atmosphereParameters3.y\n      #define lowerAlphaBlendBound atmosphereParameters3.z\n    "]))));E.fragment.code.add(e.glsl(k||
(k=a.__makeTemplateObject(["\n  // The camera's current height\n  #define cameraHeight heightParameters[0]\n  // cameraHeight^2\n  #define cameraHeightSq heightParameters[1]\n  // cameraHeightSq - outerRadiusSq; // C \x3d ||o-c||^2 - r^2\n  #define C heightParameters[2]\n  // cameraHeightSq - (innerRadiusSq - 63756370000.0); // C \x3d ||o-c||^2 - r^2\n  #define CSur heightParameters[3]\n\n  ","\n    // Loop constants for integral approximation\n    const float samples \x3d 5.0;\n    const int maxSamples \x3d 5;\n\n    // ToneMapping operators\n    vec3 expTM(vec3 inputColor,float _exposure) {\n        return pow(1.0 - exp(inputColor * -_exposure), oneOverGamma);\n    }\n\n    // Approximation for inner integral based on a radii ratio of 10.25:10\n    float scale(float _cos) {\n      float x \x3d 1.0 - _cos;\n      return exp( -0.00287 + x * ( 0.459 + x * ( 3.83 + x * (-6.80 + x * 5.25 ))));\n    }\n\n    void main() {\n      // Obtain ray from Camera\n      vec3 worldSpaceRay \x3d normalize(worldRay);\n\n      // Compute Atmosphere intersection; i.e. ray/sphere intersection\n      float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay); // B \x3d 2(l * (o-c))\n      float det \x3d B * B - 4.0 * C; // det \x3d B^2 - 4.0* C\n\n      // idealized sphere intersection to discard early some pixels\n      float detSur \x3d B * B - 4.0 * CSur; // det \x3d B^2 - 4.0* C\n\n      // the minimal sample start position:\n      // at the camera by default, on the earth radius surface if the camera is underground.\n      float minRayStart \x3d 0.0;\n  "],
["\n  // The camera's current height\n  #define cameraHeight heightParameters[0]\n  // cameraHeight^2\n  #define cameraHeightSq heightParameters[1]\n  // cameraHeightSq - outerRadiusSq; // C \x3d ||o-c||^2 - r^2\n  #define C heightParameters[2]\n  // cameraHeightSq - (innerRadiusSq - 63756370000.0); // C \x3d ||o-c||^2 - r^2\n  #define CSur heightParameters[3]\n\n  ","\n    // Loop constants for integral approximation\n    const float samples \x3d 5.0;\n    const int maxSamples \x3d 5;\n\n    // ToneMapping operators\n    vec3 expTM(vec3 inputColor,float _exposure) {\n        return pow(1.0 - exp(inputColor * -_exposure), oneOverGamma);\n    }\n\n    // Approximation for inner integral based on a radii ratio of 10.25:10\n    float scale(float _cos) {\n      float x \x3d 1.0 - _cos;\n      return exp( -0.00287 + x * ( 0.459 + x * ( 3.83 + x * (-6.80 + x * 5.25 ))));\n    }\n\n    void main() {\n      // Obtain ray from Camera\n      vec3 worldSpaceRay \x3d normalize(worldRay);\n\n      // Compute Atmosphere intersection; i.e. ray/sphere intersection\n      float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay); // B \x3d 2(l * (o-c))\n      float det \x3d B * B - 4.0 * C; // det \x3d B^2 - 4.0* C\n\n      // idealized sphere intersection to discard early some pixels\n      float detSur \x3d B * B - 4.0 * CSur; // det \x3d B^2 - 4.0* C\n\n      // the minimal sample start position:\n      // at the camera by default, on the earth radius surface if the camera is underground.\n      float minRayStart \x3d 0.0;\n  "])),
b.haze?"// Camera HDR\n        const float exposure \x3d 1.5;\n        const vec3 oneOverGamma \x3d vec3(1.0); //Gamma \x3d 1.0":"const float exposure \x3d 2.0;\n        const vec3 oneOverGamma \x3d vec3(0.454545); // Gamma \x3d 2.2\n        vec3 reinhardTM(vec3 inputColor, float _exposure) {\n          vec3 intermediate \x3d inputColor * _exposure;\n          intermediate /\x3d ( 1.0 + intermediate );\n          return pow(intermediate, oneOverGamma);\n        }\n        "));b.haze||E.fragment.code.add(e.glsl(p||
(p=a.__makeTemplateObject(["\n      float surfaceBlend \x3d 0.0;\n      vec4 surfaceColor \x3d vec4(0.0);\n      if (detSur \x3e\x3d 0.0) {\n        float nearSurface \x3d max(0.0, 0.5 *(-B - sqrt(detSur)));\n        float farSurface \x3d max(0.0, 0.5 *(-B + sqrt(detSur)));\n\n        if (nearSurface \x3d\x3d 0.0) {\n          minRayStart \x3d farSurface;\n        }\n\n        // Compute lighting at the point where the ray enters the earth surface\n        // Lighting computation is copied from the terrain shader.\n        vec3 vPos \x3d cameraPosition + worldSpaceRay * nearSurface;\n        float lightAngle \x3d dot(-lightingMainDirection, normalize(vPos));\n        float brightness \x3d max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)));\n\n        // Make the surface transparent based on altitude\n        surfaceColor \x3d vec4(brightness, brightness, brightness, 1.0 - altitudeFade);\n\n        // Fade based on the distance the ray travels below the earth surface\n        float relDist \x3d (farSurface - nearSurface) / innerFadeDistance;\n\n        // early exit\n        if (relDist \x3e 1.0) {\n          gl_FragColor \x3d surfaceColor;\n          return;\n        }\n\n        surfaceBlend \x3d smoothstep(0.0, 1.0, relDist * relDist);\n      }\n    "],
["\n      float surfaceBlend \x3d 0.0;\n      vec4 surfaceColor \x3d vec4(0.0);\n      if (detSur \x3e\x3d 0.0) {\n        float nearSurface \x3d max(0.0, 0.5 *(-B - sqrt(detSur)));\n        float farSurface \x3d max(0.0, 0.5 *(-B + sqrt(detSur)));\n\n        if (nearSurface \x3d\x3d 0.0) {\n          minRayStart \x3d farSurface;\n        }\n\n        // Compute lighting at the point where the ray enters the earth surface\n        // Lighting computation is copied from the terrain shader.\n        vec3 vPos \x3d cameraPosition + worldSpaceRay * nearSurface;\n        float lightAngle \x3d dot(-lightingMainDirection, normalize(vPos));\n        float brightness \x3d max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)));\n\n        // Make the surface transparent based on altitude\n        surfaceColor \x3d vec4(brightness, brightness, brightness, 1.0 - altitudeFade);\n\n        // Fade based on the distance the ray travels below the earth surface\n        float relDist \x3d (farSurface - nearSurface) / innerFadeDistance;\n\n        // early exit\n        if (relDist \x3e 1.0) {\n          gl_FragColor \x3d surfaceColor;\n          return;\n        }\n\n        surfaceBlend \x3d smoothstep(0.0, 1.0, relDist * relDist);\n      }\n    "]))));
E.fragment.code.add(e.glsl(r||(r=a.__makeTemplateObject(["\n    if (det \x3e\x3d 0.0) {\n    ","\n    float rayStart \x3d 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\n    ","\n\n    float scatterDistance; // calculate its scattering offset\n    // Calculate the ray's starting position\n    if (rayStart \x3c minRayStart)\n    { // ray starts from camera or inner radius sphere to far\n      rayStart \x3d minRayStart;\n      ","\n    }\n    ","\n    // Initialize the scattering loop variables\n    vec3 start \x3d cameraPosition + worldSpaceRay * rayStart;\n  "],
["\n    if (det \x3e\x3d 0.0) {\n    ","\n    float rayStart \x3d 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\n    ","\n\n    float scatterDistance; // calculate its scattering offset\n    // Calculate the ray's starting position\n    if (rayStart \x3c minRayStart)\n    { // ray starts from camera or inner radius sphere to far\n      rayStart \x3d minRayStart;\n      ","\n    }\n    ","\n    // Initialize the scattering loop variables\n    vec3 start \x3d cameraPosition + worldSpaceRay * rayStart;\n  "])),
b.haze?"\n          float depthSample \x3d texture2D(depthTex, vtc).r;\n\n          float zNear \x3d nearFar[0];\n          float zFar \x3d nearFar[1];\n\n          // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\n          float zNorm \x3d 2.0 * depthSample - 1.0;\n          float linDepth \x3d 2.0 * zNear * zFar /\n            (zFar + zNear - zNorm * (zFar - zNear));\n\n          float rayEnd;\n          float altitudeAlpha \x3d 1.0;\n\n          // find intersections with ground, but only between the near and far\n          // clipping planes.\n          if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\n            vec3 cameraSpaceRay \x3d normalize(eyeDir);\n            cameraSpaceRay /\x3d cameraSpaceRay.z;\n            cameraSpaceRay *\x3d linDepth;\n\n            float cameraSpaceRayLength \x3d length(cameraSpaceRay);\n\n            vec3 world \x3d cameraPosition + worldSpaceRay * cameraSpaceRayLength;\n            float worldRadiusSq \x3d dot(world, world);\n\n            // Handle tall structures:\n            // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\n            float transitionStart \x3d innerRadius + 20000.0;\n            float transitionHeight \x3d 25000.0;\n            float transitionEnd \x3d transitionStart + transitionHeight;\n\n            float edge0 \x3d transitionStart * transitionStart;\n            float edge1 \x3d transitionEnd * transitionEnd;\n\n            altitudeAlpha \x3d 1.0 - clamp((worldRadiusSq - edge0) / (edge1 - edge0), 0.0, 1.0);\n            rayEnd \x3d cameraSpaceRayLength;\n\n            if (altitudeAlpha \x3e 0.0 \x26\x26 detSur \x3e 0.0) {\n              float nearSurface \x3d 0.5 * ( -B - sqrt(detSur) );\n              float interp \x3d clamp(((cameraHeight - innerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\n              rayEnd \x3d mix(cameraSpaceRayLength, nearSurface, interp);\n            }\n          }":
"",b.haze?"float near \x3d abs(rayStart);\n        float far \x3d abs(rayEnd);":"float rayEnd \x3d 0.5 *(-B + sqrt(det)); //far intersection with atmosphere",b.haze?"":"// clamp to value at inner radius altitude\n          scatterDistance \x3d shellScale * min(0.0, innerRadius - cameraHeight);",b.haze?"":"else { // outside atmosphere\n          scatterDistance \x3d -1.0;\n        }"));b.haze&&E.fragment.code.add(e.glsl(t||(t=a.__makeTemplateObject(["\n      vec3 end \x3d cameraPosition + worldSpaceRay * rayEnd;\n\n      float endLength \x3d length(end);\n      //altitudeStart, altitudeEnd\n      vec2 altitudeInterval \x3d vec2(length(start) - innerRadius, endLength - innerRadius);\n\n      // for camera positions below altitude 0, invert the altitudes, to achieve\n      // a similar haze as above ground. Note that there is a small but visible change\n      // when the camera passes altitude 0.\n      if (altitudeInterval.x \x3c 0.0) {\n        altitudeInterval \x3d -altitudeInterval;\n      }\n\n      // computed for the original end point to get consistent light angles after possible inversions\n      float lightAngle \x3d dot(-lightingMainDirection, end) / endLength;\n\n      if (near \x3e far)\n      {\n        if (altitudeInterval.x \x3c altitudeInterval.y)\n        {\n          // Switch positive slopes for flipped rays\n          end \x3d cameraPosition + worldSpaceRay * rayStart;\n          start \x3d cameraPosition + worldSpaceRay * rayEnd;\n          worldSpaceRay *\x3d -1.0;\n          float tmp \x3d altitudeInterval.x;\n          altitudeInterval.x \x3d altitudeInterval.y;\n          altitudeInterval.y \x3d tmp;\n        }\n        else if (altitudeInterval.x \x3d\x3d altitudeInterval.y)\n        { // create minuscule fake slope for integration if the slope is zero\n          altitudeInterval.x +\x3d 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\n          // slope for the camera function\n        }\n      }\n\n      // Calculate its scattering offset\n      // Assumes camera constrains of WSV 3.8\n      if (altitudeInterval.x \x3e outerRadius - innerRadius)\n      { // outside atmosphere\n        scatterDistance \x3d innerRadius - outerRadius;\n      } else\n      {\n        scatterDistance \x3d altitudeInterval.y - altitudeInterval.x;\n      }\n    "],
["\n      vec3 end \x3d cameraPosition + worldSpaceRay * rayEnd;\n\n      float endLength \x3d length(end);\n      //altitudeStart, altitudeEnd\n      vec2 altitudeInterval \x3d vec2(length(start) - innerRadius, endLength - innerRadius);\n\n      // for camera positions below altitude 0, invert the altitudes, to achieve\n      // a similar haze as above ground. Note that there is a small but visible change\n      // when the camera passes altitude 0.\n      if (altitudeInterval.x \x3c 0.0) {\n        altitudeInterval \x3d -altitudeInterval;\n      }\n\n      // computed for the original end point to get consistent light angles after possible inversions\n      float lightAngle \x3d dot(-lightingMainDirection, end) / endLength;\n\n      if (near \x3e far)\n      {\n        if (altitudeInterval.x \x3c altitudeInterval.y)\n        {\n          // Switch positive slopes for flipped rays\n          end \x3d cameraPosition + worldSpaceRay * rayStart;\n          start \x3d cameraPosition + worldSpaceRay * rayEnd;\n          worldSpaceRay *\x3d -1.0;\n          float tmp \x3d altitudeInterval.x;\n          altitudeInterval.x \x3d altitudeInterval.y;\n          altitudeInterval.y \x3d tmp;\n        }\n        else if (altitudeInterval.x \x3d\x3d altitudeInterval.y)\n        { // create minuscule fake slope for integration if the slope is zero\n          altitudeInterval.x +\x3d 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\n          // slope for the camera function\n        }\n      }\n\n      // Calculate its scattering offset\n      // Assumes camera constrains of WSV 3.8\n      if (altitudeInterval.x \x3e outerRadius - innerRadius)\n      { // outside atmosphere\n        scatterDistance \x3d innerRadius - outerRadius;\n      } else\n      {\n        scatterDistance \x3d altitudeInterval.y - altitudeInterval.x;\n      }\n    "]))));
E.fragment.code.add(e.glsl(u||(u=a.__makeTemplateObject(["\n    vec2 opticalStartDepth \x3d exp(scatterDistance * oneOverScaleDepth);\n\n    float rayLength \x3d rayEnd - rayStart;\n    float sampleLength \x3d rayLength / samples;\n    float scaledLength \x3d sampleLength * shellScale;\n    vec3 sampleRay \x3d worldSpaceRay * sampleLength;\n    vec3 samplePoint \x3d start + sampleRay * 0.5;\n  "],["\n    vec2 opticalStartDepth \x3d exp(scatterDistance * oneOverScaleDepth);\n\n    float rayLength \x3d rayEnd - rayStart;\n    float sampleLength \x3d rayLength / samples;\n    float scaledLength \x3d sampleLength * shellScale;\n    vec3 sampleRay \x3d worldSpaceRay * sampleLength;\n    vec3 samplePoint \x3d start + sampleRay * 0.5;\n  "]))));
b.haze?E.fragment.code.add(e.glsl(v||(v=a.__makeTemplateObject(["\n      float cameraAngle \x3d dot(-worldSpaceRay, end) / length(end);\n      float scaleCameraAngle \x3d scale(cameraAngle);\n      vec2 cameraOffset \x3d scaleCameraAngle * opticalStartDepth;\n\n      float scaledValues \x3d scale(lightAngle) + scaleCameraAngle;\n      vec2 scaledValuesDepth \x3d scaledValues * shellDepth;\n    "],["\n      float cameraAngle \x3d dot(-worldSpaceRay, end) / length(end);\n      float scaleCameraAngle \x3d scale(cameraAngle);\n      vec2 cameraOffset \x3d scaleCameraAngle * opticalStartDepth;\n\n      float scaledValues \x3d scale(lightAngle) + scaleCameraAngle;\n      vec2 scaledValuesDepth \x3d scaledValues * shellDepth;\n    "])))):
E.fragment.code.add(e.glsl(z||(z=a.__makeTemplateObject(["\n      float cameraAngle \x3d dot(worldSpaceRay, start / length(start));\n      float angleMultiplier \x3d cameraAngle \x3e 0.0 ? cameraAngle : 0.0;\n\n      float scaleCameraAngle \x3d scale(cameraAngle);\n      vec2 cameraOffset \x3d scaleCameraAngle * opticalStartDepth * shellDepth;\n    "],["\n      float cameraAngle \x3d dot(worldSpaceRay, start / length(start));\n      float angleMultiplier \x3d cameraAngle \x3e 0.0 ? cameraAngle : 0.0;\n\n      float scaleCameraAngle \x3d scale(cameraAngle);\n      vec2 cameraOffset \x3d scaleCameraAngle * opticalStartDepth * shellDepth;\n    "]))));
E.fragment.code.add(e.glsl(w||(w=a.__makeTemplateObject(["\n    // Loop variables\n    vec3 frontColor \x3d vec3(0.0);\n    vec3 frontColorBlue \x3d vec3(0.0);\n    vec3 attenuate \x3d vec3(0.0);\n    vec3 attenuateBlue \x3d vec3(0.0);\n\n    // Now loop through the sample rays\n    for(int i\x3d0; i\x3cmaxSamples; i++) {\n      float height \x3d length(samplePoint);\n      float altitude \x3d abs(height - innerRadius);\n\n      vec2 depth \x3d exp(-altitude * scaleOverScaleDepth);\n  "],["\n    // Loop variables\n    vec3 frontColor \x3d vec3(0.0);\n    vec3 frontColorBlue \x3d vec3(0.0);\n    vec3 attenuate \x3d vec3(0.0);\n    vec3 attenuateBlue \x3d vec3(0.0);\n\n    // Now loop through the sample rays\n    for(int i\x3d0; i\x3cmaxSamples; i++) {\n      float height \x3d length(samplePoint);\n      float altitude \x3d abs(height - innerRadius);\n\n      vec2 depth \x3d exp(-altitude * scaleOverScaleDepth);\n  "]))));
b.haze?E.fragment.code.add(e.glsl(q||(q=a.__makeTemplateObject(["\n      vec2 scatter \x3d depth * scaledValuesDepth - cameraOffset;\n    "],["\n      vec2 scatter \x3d depth * scaledValuesDepth - cameraOffset;\n    "])))):E.fragment.code.add(e.glsl(y||(y=a.__makeTemplateObject(["\n      float lightAngle \x3d dot(-lightingMainDirection, samplePoint) / height;\n      float cameraAngle \x3d dot(worldSpaceRay, samplePoint) / height;\n      float tmpScaledValues \x3d scale(lightAngle) - scale(cameraAngle);\n      vec2 scatter \x3d cameraOffset + tmpScaledValues * depth * shellDepth;\n    "],
["\n      float lightAngle \x3d dot(-lightingMainDirection, samplePoint) / height;\n      float cameraAngle \x3d dot(worldSpaceRay, samplePoint) / height;\n      float tmpScaledValues \x3d scale(lightAngle) - scale(cameraAngle);\n      vec2 scatter \x3d cameraOffset + tmpScaledValues * depth * shellDepth;\n    "]))));E.fragment.code.add(e.glsl(A||(A=a.__makeTemplateObject(["\n      attenuate \x3d exp(-scatter.x * invWavelengthScaled);\n      attenuateBlue \x3d exp(-scatter.y * invWavelengthScaled);\n\n      frontColor +\x3d attenuate * depth.x;\n      frontColorBlue +\x3d attenuateBlue * depth.y;\n\n      samplePoint +\x3d sampleRay;\n    }\n\n    // Phase computation\n    // clamp to avoid numerical instability at fCos \x3d\x3d -1.0 (and close values) to display fake sun\n    float LdotR \x3d clamp(dot(-lightingMainDirection, -worldSpaceRay ),-0.9999999,1.0);\n    float LdotRSq \x3d LdotR * LdotR + 1.0;\n  "],
["\n      attenuate \x3d exp(-scatter.x * invWavelengthScaled);\n      attenuateBlue \x3d exp(-scatter.y * invWavelengthScaled);\n\n      frontColor +\x3d attenuate * depth.x;\n      frontColorBlue +\x3d attenuateBlue * depth.y;\n\n      samplePoint +\x3d sampleRay;\n    }\n\n    // Phase computation\n    // clamp to avoid numerical instability at fCos \x3d\x3d -1.0 (and close values) to display fake sun\n    float LdotR \x3d clamp(dot(-lightingMainDirection, -worldSpaceRay ),-0.9999999,1.0);\n    float LdotRSq \x3d LdotR * LdotR + 1.0;\n  "]))));
b.haze?E.fragment.code.add(e.glsl(B||(B=a.__makeTemplateObject(["\n      // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\n      vec3 colorCoefficients \x3d (scaledLength * 0.75 * LdotRSq) * (krESun * invWavelength + kmESun );\n\n      // Scaled Length is only applied afterwards to save multiplications\n      vec3 color \x3d colorCoefficients * frontColor;\n      vec3 colorBlue \x3d colorCoefficients * frontColorBlue;\n    "],["\n      // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\n      vec3 colorCoefficients \x3d (scaledLength * 0.75 * LdotRSq) * (krESun * invWavelength + kmESun );\n\n      // Scaled Length is only applied afterwards to save multiplications\n      vec3 color \x3d colorCoefficients * frontColor;\n      vec3 colorBlue \x3d colorCoefficients * frontColorBlue;\n    "])))):
E.fragment.code.add(e.glsl(C||(C=a.__makeTemplateObject(["\n      vec3 rayleighCoefficients \x3d (scaledLength * 0.75 * LdotRSq * krESun) * invWavelength;\n      float mieCoefficients \x3d scaledLength * kmESun * miePhaseCoefficients * LdotRSq / pow(1.0 + gSq - 2.0 * g * LdotR, 1.5);\n\n      // Calculate the attenuation factor for the ground\n      vec3 color \x3d rayleighCoefficients * frontColor + mieCoefficients * frontColor;\n      vec3 colorBlue \x3d rayleighCoefficients * frontColorBlue + mieCoefficients * frontColorBlue;\n    "],
["\n      vec3 rayleighCoefficients \x3d (scaledLength * 0.75 * LdotRSq * krESun) * invWavelength;\n      float mieCoefficients \x3d scaledLength * kmESun * miePhaseCoefficients * LdotRSq / pow(1.0 + gSq - 2.0 * g * LdotR, 1.5);\n\n      // Calculate the attenuation factor for the ground\n      vec3 color \x3d rayleighCoefficients * frontColor + mieCoefficients * frontColor;\n      vec3 colorBlue \x3d rayleighCoefficients * frontColorBlue + mieCoefficients * frontColorBlue;\n    "]))));E.fragment.code.add(e.glsl(F||
(F=a.__makeTemplateObject(["\n    // HDR to LDR conversion\n    vec3 ldrBlue \x3d expTM(colorBlue, 2.0 * exposure);\n    vec3 ldrRed \x3d expTM(color, exposure);\n\n    // mix reddish and blueish atmosphere\n    vec3 LDR \x3d mix(ldrBlue, ldrRed, 0.2);\n  "],["\n    // HDR to LDR conversion\n    vec3 ldrBlue \x3d expTM(colorBlue, 2.0 * exposure);\n    vec3 ldrRed \x3d expTM(color, exposure);\n\n    // mix reddish and blueish atmosphere\n    vec3 LDR \x3d mix(ldrBlue, ldrRed, 0.2);\n  "]))));b.haze?
E.fragment.code.add(e.glsl(H||(H=a.__makeTemplateObject(["\n      LDR *\x3d (1.0 - cameraAngle);\n      vec3 hsv \x3d rgb2hsv(LDR);\n      hsv.y \x3d clamp(hsv.y * 1.5, 0.0, 1.0); // boost haze saturation by 50%\n      LDR \x3d hsv2rgb(hsv);\n      vec3 finalColor \x3d LDR;\n      // when rendering we specify the blend functions such that\n      // newDestColor \x3d oldDestColor*(1.0-finalColor) + finalColor\n    "],["\n      LDR *\x3d (1.0 - cameraAngle);\n      vec3 hsv \x3d rgb2hsv(LDR);\n      hsv.y \x3d clamp(hsv.y * 1.5, 0.0, 1.0); // boost haze saturation by 50%\n      LDR \x3d hsv2rgb(hsv);\n      vec3 finalColor \x3d LDR;\n      // when rendering we specify the blend functions such that\n      // newDestColor \x3d oldDestColor*(1.0-finalColor) + finalColor\n    "])))):
E.fragment.code.add(e.glsl(I||(I=a.__makeTemplateObject(["\n      // reinhard tonemapper for looking upwards\n      vec3 ldrReinhard \x3d reinhardTM(color, exposure);\n      LDR +\x3d angleMultiplier * ldrReinhard;\n\n      // height dependent parameter to smooth out reddish atmosphere\n      float side \x3d (rayEnd + rayStart) * 0.5;\n      float atmoHeight \x3d sqrt(cameraHeightSq - side * side);\n      float h2 \x3d clamp(1.0 - ( atmoHeight - lowerAlphaBlendBound ) / ( outerRadius - lowerAlphaBlendBound ), 0.0, 1.0);\n\n      vec3 finalColor \x3d LDR * h2;\n      vec3 hsv \x3d rgb2hsv(finalColor);\n      hsv.y \x3d clamp(hsv.y * 1.5, 0.0, 1.0); // boost sky saturation by 50%\n      finalColor \x3d hsv2rgb(hsv);\n    "],
["\n      // reinhard tonemapper for looking upwards\n      vec3 ldrReinhard \x3d reinhardTM(color, exposure);\n      LDR +\x3d angleMultiplier * ldrReinhard;\n\n      // height dependent parameter to smooth out reddish atmosphere\n      float side \x3d (rayEnd + rayStart) * 0.5;\n      float atmoHeight \x3d sqrt(cameraHeightSq - side * side);\n      float h2 \x3d clamp(1.0 - ( atmoHeight - lowerAlphaBlendBound ) / ( outerRadius - lowerAlphaBlendBound ), 0.0, 1.0);\n\n      vec3 finalColor \x3d LDR * h2;\n      vec3 hsv \x3d rgb2hsv(finalColor);\n      hsv.y \x3d clamp(hsv.y * 1.5, 0.0, 1.0); // boost sky saturation by 50%\n      finalColor \x3d hsv2rgb(hsv);\n    "]))));
E.fragment.code.add(e.glsl(G||(G=a.__makeTemplateObject(["\n    ","\n      } else { // Outside Atmosphere\n        gl_FragColor \x3d vec4(0.0);\n      }\n    }\n  "],["\n    ","\n      } else { // Outside Atmosphere\n        gl_FragColor \x3d vec4(0.0);\n      }\n    }\n  "])),b.haze?"gl_FragColor \x3d vec4(finalColor, 1.0) * altitudeAlpha;":"float atmosStrength \x3d clamp((length(ldrRed) - 0.05) * 1.05, 0.0, 1.0);\n          gl_FragColor \x3d vec4(finalColor, atmosStrength * clamp(1.0 - ( atmoHeight - innerRadius ) / (outerRadius - innerRadius), 0.0, 1.0));\n          if (surfaceBlend \x3e 0.0) {\n            gl_FragColor \x3d mix(gl_FragColor, surfaceColor, surfaceBlend);\n          }"));
return E};var g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.ColorConversion=function(b,d){var c=[m.glsl(h||(h=a.__makeTemplateObject(["\n      vec4 premultiplyAlpha(vec4 v) {\n        return vec4(v.rgb * v.a, v.a);\n      }\n    "],["\n      vec4 premultiplyAlpha(vec4 v) {\n        return vec4(v.rgb * v.a, v.a);\n      }\n    "]))),
m.glsl(e||(e=a.__makeTemplateObject(["\n      vec3 rgb2hsv(vec3 c) {\n        vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        vec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n        vec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n        float d \x3d q.x - min(q.w, q.y);\n        float e \x3d 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n      }\n    "],["\n      vec3 rgb2hsv(vec3 c) {\n        vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        vec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n        vec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n        float d \x3d q.x - min(q.w, q.y);\n        float e \x3d 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n      }\n    "]))),
m.glsl(f||(f=a.__makeTemplateObject(["\n      vec3 hsv2rgb(vec3 c) {\n        vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n      }\n    "],["\n      vec3 hsv2rgb(vec3 c) {\n        vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n      }\n    "]))),
m.glsl(g||(g=a.__makeTemplateObject(["\n      float rgb2v(vec3 c) {\n        return max(c.x, max(c.y, c.z));\n      }\n    "],["\n      float rgb2v(vec3 c) {\n        return max(c.x, max(c.y, c.z));\n      }\n    "])))];switch(d.stages){case 0:c.forEach(function(a){return b.vertex.code.add(a)});break;case 1:c.forEach(function(a){return b.fragment.code.add(a)});break;default:c.forEach(function(a){return b.vertex.code.add(a)}),c.forEach(function(a){return b.fragment.code.add(a)})}};var h,e,f,g})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["require",
"exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.RgbaFloatEncoding=function(e){var f=m.glsl(h||(h=a.__makeTemplateObject(["\n    // This is the maximum float value representable as 32bit fixed point,\n    // it is rgba2float(vec4(1)) inlined.\n    const float MAX_RGBA_FLOAT \x3d\n      255.0 / 256.0 +\n      255.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n    const vec4 FIXED_POINT_FACTORS \x3d vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n    vec4 float2rgba(const float value) {\n      // Make sure value is in the domain we can represent\n      float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n      // Decompose value in 32bit fixed point parts represented as\n      // uint8 rgba components. Decomposition uses the fractional part after multiplying\n      // by a power of 256 (this removes the bits that are represented in the previous\n      // component) and then converts the fractional part to 8bits.\n      vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n      // Convert uint8 values (from 0 to 255) to floating point representation for\n      // the shader\n      const float toU8AsFloat \x3d 1.0 / 255.0;\n\n      return fixedPointU8 * toU8AsFloat;\n    }\n\n    // Factors to convert rgba back to float\n    const vec4 RGBA_2_FLOAT_FACTORS \x3d vec4(\n      255.0 / (256.0),\n      255.0 / (256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n    );\n\n    float rgba2float(vec4 rgba) {\n      // Convert components from 0-\x3e1 back to 0-\x3e255 and then\n      // add the components together with their corresponding\n      // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n      return dot(rgba, RGBA_2_FLOAT_FACTORS);\n    }\n  "],
["\n    // This is the maximum float value representable as 32bit fixed point,\n    // it is rgba2float(vec4(1)) inlined.\n    const float MAX_RGBA_FLOAT \x3d\n      255.0 / 256.0 +\n      255.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n    const vec4 FIXED_POINT_FACTORS \x3d vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n    vec4 float2rgba(const float value) {\n      // Make sure value is in the domain we can represent\n      float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n      // Decompose value in 32bit fixed point parts represented as\n      // uint8 rgba components. Decomposition uses the fractional part after multiplying\n      // by a power of 256 (this removes the bits that are represented in the previous\n      // component) and then converts the fractional part to 8bits.\n      vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n      // Convert uint8 values (from 0 to 255) to floating point representation for\n      // the shader\n      const float toU8AsFloat \x3d 1.0 / 255.0;\n\n      return fixedPointU8 * toU8AsFloat;\n    }\n\n    // Factors to convert rgba back to float\n    const vec4 RGBA_2_FLOAT_FACTORS \x3d vec4(\n      255.0 / (256.0),\n      255.0 / (256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n    );\n\n    float rgba2float(vec4 rgba) {\n      // Convert components from 0-\x3e1 back to 0-\x3e255 and then\n      // add the components together with their corresponding\n      // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n      return dot(rgba, RGBA_2_FLOAT_FACTORS);\n    }\n  "])));
e.fragment.code.add(f);e.vertex.code.add(f)};var h})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("require exports ../../../core/Logger ../../../core/mathUtils ../../../core/mathUtils ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ./atmosphereUtils ./SimpleAtmosphereTechnique ./resources/SimpleAtmosphereTexture ../support/earthUtils ../support/imageUtils ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G){function J(a,c,d,e,f){var g=k.vec3.length(a),b=e*Math.sqrt(g*g-e*e)/g,l=f.silCircleV1,h=f.silCircleV2;k.vec3.scale(f.silCircleCenter,a,Math.sqrt(e*e-b*b)/g);k.vec3.cross(l,a,c);1>k.vec3.squaredLength(l)&&k.vec3.cross(l,a,d);k.vec3.scale(l,l,b/k.vec3.length(l));k.vec3.cross(h,l,a);k.vec3.scale(h,h,b/k.vec3.length(h));return b}function E(a,c,d,e){k.vec3.add(U,e.silCircleCenter,e.silCircleV2);k.vec3.scale(P,U,R);g.mat4.lookAt(O,c,U,d);
C.project(U,O,a.projectionMatrix,a.viewport);C.project(P,O,a.projectionMatrix,a.viewport);return k.vec3.distance(U,P)/a.height}var L=a.getLogger("esri.views.3d.environment.SimpleAtmosphere"),M=-r.INNER_ATMOSPHERE_DEPTH,N=(v.earthRadius+M)/v.earthRadius,Q=(v.earthRadius+0)/v.earthRadius,R=(v.earthRadius+3E5)/v.earthRadius,W=w.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);n=function(){function a(a,d){this.slot=14;this._renderData={texV:c.vec2f64.create(),silCircleCenter:p.vec3f64.create(),
silCircleV1:p.vec3f64.create(),silCircleV2:p.vec3f64.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0};this._fadeVaoCount=0;this._readyResolver=e.createResolver();this._readyController=e.createAbortController();this._techniqueRepository=d;this._atmosphereTechniqueConfig=new t.SimpleAtmosphereTechniqueConfiguration;this.view=a}Object.defineProperty(a.prototype,"canRender",{get:function(){return null!=this._texture},enumerable:!0,configurable:!0});a.prototype.when=function(){return this._readyResolver.promise};
a.prototype.initializeRenderContext=function(a){var c=this,d=a.rctx;this._cameraChangeHandle=f.init(this.view,"state.camera",function(){return a.requestRender()},!0);this._atmosphereTechniqueConfig.geometry=0;this._atmosphereConeTechnique=this._techniqueRepository.acquireAndReleaseExisting(t.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereConeTechnique);this._atmosphereTechniqueConfig.geometry=2;this._atmosphereUndergroundTechnique=this._techniqueRepository.acquireAndReleaseExisting(t.SimpleAtmosphereTechnique,
this._atmosphereTechniqueConfig,this._atmosphereUndergroundTechnique);this._vao=this._createRibbon(d);this._vaoCount=I.vertexCount(this._vao,"geometry");this._fadeVao=B.createQuadVAO(d);this._fadeVaoCount=I.vertexCount(this._fadeVao,"geometry");z.requestImage(u,{signal:this._readyController.signal}).then(function(e){c._texture=new H(d,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},e);a.requestRender();c._readyController=null;c._readyResolver.resolve()}).catch(function(a){e.isAbortError(a)||
L.error("Unable to initialize simple atmosphere: image request failed",a);c._readyResolver.reject()})};a.prototype.uninitializeRenderContext=function(){this.destroy()};a.prototype.destroy=function(){this._readyResolver.reject();this._cameraChangeHandle&&(this._cameraChangeHandle.remove(),this._cameraChangeHandle=null);this._texture&&(this._texture.dispose(),this._texture=null);this._fadeVao&&(this._fadeVao.dispose(),this._fadeVao=null);this._vao&&(this._vao.dispose(),this._vao=null);this._readyController&&
(this._readyController.abort(),this._readyController=null)};a.prototype.render=function(a){if(a.slot!==this.slot||0!==a.pass)return!1;this._update(a.camera);var c=a.rctx;this._atmosphereConeTechnique.bindPipelineState(c);if(1>this._renderData.undergroundFadeAlpha){var d=this._atmosphereConeTechnique.program;c.bindProgram(d);d.setUniformMatrix4fv("proj",a.camera.projectionMatrix);d.setUniformMatrix4fv("view",a.camera.viewMatrix);d.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter);d.setUniform3fv("silCircleV1",
this._renderData.silCircleV1);d.setUniform3fv("silCircleV2",this._renderData.silCircleV2);d.setUniform2fv("texV",this._renderData.texV);c.bindTexture(this._texture,0);d.setUniform1i("tex",0);a.scenelightingData.setLightDirectionUniform(d);d.setUniform1f("altitudeFade",this._renderData.altitudeFade);d.setUniform1f("innerScale",this._renderData.innerScale);c.bindVAO(this._vao);c.drawArrays(4,0,this._vaoCount)}0<this._renderData.undergroundFadeAlpha&&(d=this._atmosphereUndergroundTechnique.program,c.bindProgram(d),
d.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),a.scenelightingData.setLightDirectionUniform(d),d.setUniform3fv("cameraPosition",a.camera.eye),c.bindVAO(this._fadeVao),c.drawArrays(5,0,this._fadeVaoCount));return!0};a.prototype._update=function(a){var c=p.vec3f64.create(),e=v.earthRadius,f=k.vec3.length(a.eye),g=f-e;this._renderData.undergroundFadeAlpha=0>g?Math.min(-g/5E3,1):0;var b=e+M,l=e+Math.max(50,g);this._renderData.innerScale=l*l/(Math.sqrt(l*l-e*e)*Math.sqrt(l*
l-b*b)+e*b)-1;this._renderData.altitudeFade=r.computeInnerAltitudeFade(g);k.vec3.scale(c,a.eye,(e+50)/f);J(c,a.center,a.up,e,this._renderData);c=E(a,c,a.up,this._renderData);f=W(g);b=.001953125;l=0+c*f*1;50<g&&(J(a.eye,a.center,a.up,e,this._renderData),a=E(a,a.eye,a.up,this._renderData),a=m.clamp((a-1.5)/(c-1.5),0,1),b=0+.001953125*a,l=0+1*h.lerp(1,c*f,a));d.vec2.set(this._renderData.texV,b,l)};a.prototype._createRibbon=function(a){var c=new Float32Array(1155),d=new Uint32Array(1920);c[0]=0;c[1]=
0;c[2]=-1;for(var e=0;128>e;e++){var f=9*e+3;c[f+0]=e;c[f+1]=N;c[f+2]=-1;c[f+3]=e;c[f+4]=Q;c[f+5]=0;c[f+6]=e;c[f+7]=R;c[f+8]=1;var f=3*e+1,g=127===e?1:f+3,b=15*e;d[b+0]=f;d[b+1]=f+1;d[b+2]=g+1;d[b+3]=g+1;d[b+4]=g;d[b+5]=f;d[b+6]=f+1;d[b+7]=f+2;d[b+8]=g+2;d[b+9]=g+2;d[b+10]=g+1;d[b+11]=f+1;d[b+12]=f;d[b+13]=g;d[b+14]=0}f=ba.createBuffer(d.length);g=f.position;for(e=0;e<d.length;++e)b=3*d[e],g.set(e,0,c[b]),g.set(e,1,c[b+1]),g.set(e,2,c[b+2]);return new G(a,A.Default3D,{geometry:q.glLayout(ba)},{geometry:F.createVertex(a,
35044,f.buffer)})};return a}();var O=l.mat4f64.create(),U=p.vec3f64.create(),P=p.vec3f64.create(),ba=y.newLayout().vec3f("position");return n})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("require exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});b.createQuadVAO=function(e,b,d){void 0===b&&(b=
m.Pos2);void 0===d&&(d=a.Default3D);var c=null;switch(b){case m.Pos2Tex:c=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;default:c=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new f(e,d,{geometry:b},{geometry:h.createVertex(e,35044,c)})};b.createEmptyTexture=function(a,f){void 0===f&&(f=4);return new e(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:f,height:f})};b.createColorTexture=function(a,f,d){void 0===d&&(d=4);for(var c=new Uint8Array(d*d*4),g=0;g<c.length;g+=
4)c[g+0]=255*f[0],c[g+1]=255*f[1],c[g+2]=255*f[2],c[g+3]=255*f[3];return new e(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:d,height:d},c)};b.createEmptyDepthTexture=function(a){return new e(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))}})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.Pos3=
[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}];b.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}];b.Pos3NormalTex=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:32,normalized:!1}];b.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,
normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];b.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];b.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]})},"esri/views/3d/environment/Stars":function(){define("require exports tslib ../../../assets ../../../core/asyncUtils ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ./StarsTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v){var z=f.getLogger("esri.views.3d.environment.Stars");n=function(){function f(a){this.slot=14;this.numBinaryFloats=2;this.numBinaryUInt8=1;this.bytesPerStar=9;this._loadDataController=g.createAbortController();this._numStars=0;this._modelMatrix=c.mat4f64.create();this._destroyed=!1;this.view=a;this._loadDataPromise=this._loadBrightStarCatalogue()}Object.defineProperty(f.prototype,"canRender",{get:function(){return null!=this._vao},enumerable:!0,configurable:!0});
f.prototype.destroy=function(){this._destroyed=!0;this._loadDataController&&(this._loadDataController.abort(),this._loadDataController=null);this._dateHandle&&(this._dateHandle.remove(),this._dateHandle=null);this._vao&&(this._vao.dispose(),this._vao=null);this._starsTechnique&&(this._starsTechnique.dispose(),this._starsTechnique=null)};f.prototype.initializeRenderContext=function(a){var c=this;this._initContext=a;var d=a.rctx;this._starsTechnique=new k.StarsTechnique({rctx:d,viewingMode:"local"===
this.view.viewingMode?1:0},null);this._dateHandle=l.init(this.view,"environment.lighting.date",function(a){return c._update(a)});this._loadDataPromise.then(function(){if(!c._destroyed){c._numStars=c._starData.byteLength/c.bytesPerStar;var e=new Float32Array(c._starData,0,c._numStars*c.numBinaryFloats),f=new Uint8Array(c._starData,c._numStars*c.numBinaryFloats*4,c._numStars*c.numBinaryUInt8);c._vao=c._createVertexArrayObject(d,e,f);a.requestRender()}})};f.prototype.uninitializeRenderContext=function(){this.destroy()};
f.prototype.render=function(a){if(a.slot!==this.slot||0!==a.pass)return!1;var c=a.rctx,d=this._starsTechnique.program;c.bindProgram(d);this._starsTechnique.bindPass(c,{camera:a.camera,modelMatrix:this._modelMatrix});this._starsTechnique.bindPipelineState(c);c.bindVAO(this._vao);d.assertCompatibleVertexAttributeLocations(this._vao);c.drawArrays(0,0,this._numStars);return!0};f.prototype._computeDayDuration=function(a){var c=new Date(a.getFullYear(),0,1,11,58,56),d=new Date(a.getFullYear()+1,0,1,11,
58,55);return(+a-+c)/(+d-+c)};f.prototype._update=function(a){if(a){var c=a.getHours()/12,e=a.getMinutes()/60*(2/24),f=a.getSeconds()/60*(2/1440),c=(c+e+f-.9972222)%2;a=2*this._computeDayDuration(a);e=this._modelMatrix;d.mat4.copy(e,y);d.mat4.rotateZ(e,e,-a*Math.PI);d.mat4.multiply(e,q,e);d.mat4.rotateZ(e,e,-c*Math.PI);this._initContext.requestRender()}};f.prototype._hexToRGB=function(a){return[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)]};f.prototype._unpackUint8Attributes=
function(a){return 192<=a?[2.9,a-192]:160<=a?[2.5,a-160]:128<=a?[2,a-128]:96<=a?[1.5,a-96]:64<=a?[1,a-64]:32<=a?[.7,a-32]:[.4,a]};f.prototype._createVertexArrayObject=function(a,c,d){for(var e=A.createBuffer(this._numStars),f=e.position,g=e.color,b=e.size,k=0;k<this._numStars;k++){var l=c[2*k+0],h=c[2*k+1];f.set(k,0,-Math.cos(l)*Math.sin(h));f.set(k,1,-Math.sin(l)*Math.sin(h));f.set(k,2,-Math.cos(h));l=this._unpackUint8Attributes(d[k]);h=this._hexToRGB(w[l[1]]);g.set(k,0,255*h[0]);g.set(k,1,255*h[1]);
g.set(k,2,255*h[2]);g.set(k,3,255);b.set(k,l[0])}return new v(a,t.Default3D,{geometry:p.glLayout(A)},{geometry:u.createVertex(a,35044,e.buffer)})};f.prototype._verifyStartData=function(a){if(!a)throw new e("stars:no-data-received","Failed to create stars because star catalogue is missing");a=a.byteLength/this.bytesPerStar;if(0!==a%1||5E4<a||5E3>a)throw new e("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};f.prototype._loadBrightStarCatalogue=function(){return a.__awaiter(this,
void 0,void 0,function(){var c,d,e;return a.__generator(this,function(a){switch(a.label){case 0:return B?(this._starData=B,[2]):[4,h.result(m.fetchAsset("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:this._loadDataController.signal}))];case 1:c=a.sent();this._loadDataController=null;if(!1===c.ok){if(g.isAbortError(c.error))throw c.error;z.error("loadBrightStarCatalogue",c.error.message);return[2]}d=c.value;e=d.data;try{this._verifyStartData(e)}catch(J){throw z.error("loadBrightStarCatalogue",
J),J;}this._starData=B=e;return[2]}})})};return f}();var w="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),q=c.mat4f64.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),y=c.mat4f64.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),A=r.newLayout().vec3f("position").vec4u8("color").f32("size"),
B=null;return n})},"esri/views/3d/environment/StarsTechnique":function(){define("require exports tslib ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../environment/Stars.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState @dojo/framework/shim/Promise".split(" "),function(n,b,a,m,h,e,f,g,l,d,c){Object.defineProperty(b,
"__esModule",{value:!0});g=function(g){function b(){return null!==g&&g.apply(this,arguments)||this}a.__extends(b,g);b.prototype.initializeProgram=function(a){var c=b.shader.get().build();return new d(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),l.Default3D)};b.prototype.initializePipeline=function(){return c.makePipelineState({blending:c.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:c.defaultColorWriteParams})};b.prototype.bindPass=function(a,c){a=c.camera;
c=c.modelMatrix;var d=this.makeInfiniteProjectionMatrix(a.projectionMatrix,a.near,k);m.mat4.multiply(d,d,a.viewMatrix);m.mat4.multiply(d,d,c);this.program.setUniformMatrix4fv("transform",d);this.program.setUniform4fv("viewport",a.fullViewport);this.program.setUniform1f("pixelRatio",a.pixelRatio)};b.prototype.makeInfiniteProjectionMatrix=function(a,c,d){m.mat4.copy(d,a);d[10]=2.4E-7-1;d[11]=-1;d[14]=(2.4E-7-2)*c;return d};b.shader=new f.ReloadableShaderModule(e,function(){return new Promise(function(a,
c){n(["../environment/Stars.glsl"],a,c)})});return b}(g.ShaderTechnique);b.StarsTechnique=g;var k=h.mat4f64.create()})},"esri/views/3d/environment/Stars.glsl":function(){define("require exports tslib ../webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderModules/ShaderBuilder".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(){var b=new e.ShaderBuilder;b.attributes.add("position",
"vec3");b.attributes.add("color","vec4");b.attributes.add("size","float");b.varyings.add("vcolor","vec4");b.varyings.add("vsize","float");b.vertex.uniforms.add("transform","mat4").add("viewport","vec4").add("pixelRatio","float");b.include(m.AlignPixel);b.vertex.code.add(h.glsl(f||(f=a.__makeTemplateObject(["\n    void main(void) {\n      vec4 posProj \x3d transform * vec4(position, 0);\n      gl_Position \x3d alignToPixelCenter(posProj, viewport.zw);\n      vcolor \x3d color / 1.2;\n      vsize \x3d size * 5.0 * pixelRatio;\n      gl_PointSize \x3d vsize;\n    }\n  "],
["\n    void main(void) {\n      vec4 posProj \x3d transform * vec4(position, 0);\n      gl_Position \x3d alignToPixelCenter(posProj, viewport.zw);\n      vcolor \x3d color / 1.2;\n      vsize \x3d size * 5.0 * pixelRatio;\n      gl_PointSize \x3d vsize;\n    }\n  "]))));b.fragment.code.add(h.glsl(g||(g=a.__makeTemplateObject(["\n    void main() {\n      float cap \x3d 0.7;\n      float scale \x3d 1.0 / cap;\n      float helper \x3d clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);\n      float alpha \x3d clamp((cap - helper) * scale, 0.0, 1.0);\n      float intensity \x3d alpha * alpha * alpha;\n      if (vsize \x3c 3.0) {\n        intensity *\x3d 0.5;\n      }\n      gl_FragColor \x3d vec4(vcolor.xyz, intensity);\n    }\n  "],
["\n    void main() {\n      float cap \x3d 0.7;\n      float scale \x3d 1.0 / cap;\n      float helper \x3d clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);\n      float alpha \x3d clamp((cap - helper) * scale, 0.0, 1.0);\n      float intensity \x3d alpha * alpha * alpha;\n      if (vsize \x3c 3.0) {\n        intensity *\x3d 0.5;\n      }\n      gl_FragColor \x3d vec4(vcolor.xyz, intensity);\n    }\n  "]))));return b};var f,g})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["require",
"exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.AlignPixel=function(f){var g=m.glsl(h||(h=a.__makeTemplateObject(["\n    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy \x3d vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n      vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n      vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "],
["\n    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy \x3d vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n      vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n      vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "]))),b=m.glsl(e||(e=a.__makeTemplateObject(["\n\n    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy \x3d vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n      vec2 ij \x3d floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\n      vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "],
["\n\n    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy \x3d vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n      vec2 ij \x3d floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\n      vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "])));f.vertex.code.add(g);f.vertex.code.add(b);f.fragment.code.add(g);f.fragment.code.add(b)};var h,e})},"esri/views/3d/support/sunUtils":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../lib/SunCalc".split(" "),
function(n,b,a,m,h,e,f,g){function l(a,c,d,e){for(var f=[],g=0;g<d.length;g++)f[g]=(e[g]-d[g])*a/c+d[g];return f}Object.defineProperty(b,"__esModule",{value:!0});b.settings={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};b.computeColorAndIntensity=function(c,d){var h,p,r,
m,w=d[2],q=k;e.vec3.set(q.ambient.color,1,1,1);q.ambient.intensity=b.settings.global.ambient;e.vec3.set(q.diffuse.color,1,1,1);q.diffuse.intensity=b.settings.global.diffuse;w=(Math.abs(w)-b.settings.local.altitude)/(b.settings.global.altitude-b.settings.local.altitude);w=a.clamp(w,0,1);q.globalFactor=w;d=g.getTimes(c,d[1],d[0]);if(1>w){r=c.valueOf();var y,A;d.polarException===g.POLAR_EXCEPTION.MIDNIGHT_SUN?(y=r-36E5*(c.getHours()+48)-6E4*c.getMinutes(),A=y+432E6):d.polarException===g.POLAR_EXCEPTION.POLAR_NIGHT?
(y=r-2,A=r-1):(y=d.sunrise.valueOf(),A=d.sunset.valueOf());var B=A-y;m=y+B/2;p=B/4;h=m-p;p=m+p;var C=.06*B,B=y-C/2;y+=C/2;var F=A-C/2,H=A+C/2;A=b.settings.local;var I=[.01,A.ambientAtNight],G=[.8,.8,1],J=[.01,.01,.01],E=[A.diffuseAtTwilight,A.ambientAtTwilight],L=[1,.75,.75],M=[.8,.8,1],N=[.9*A.diffuseAtNoon,A.ambientAtNoon],Q=[1,.98,.98],R=[.98,.98,1],n=[A.diffuseAtNoon,A.ambientAtNoon],O=[1,1,1],U=[1,1,1];A=[0,0];var P=[0,0,0],C=[0,0,0];r<B||r>H?(A=I,P=J,C=G):r<y?(C=y-B,A=l(r-B,C,I,E),P=l(r-B,C,
J,L),C=l(r-B,C,G,M)):r<h?(C=h-y,A=l(r-y,C,E,N),P=l(r-y,C,L,Q),C=l(r-y,C,M,R)):r<m?(C=m-h,A=l(r-h,C,N,n),P=l(r-h,C,Q,O),C=l(r-h,C,R,U)):r<p?(C=p-m,A=l(r-m,C,n,N),P=l(r-m,C,O,Q),C=l(r-m,C,U,R)):r<F?(C=F-p,A=l(r-p,C,N,E),P=l(r-p,C,Q,L),C=l(r-p,C,R,M)):r<H&&(C=H-F,A=l(r-F,C,E,I),P=l(r-F,C,L,J),C=l(r-F,C,M,G));r=A[0];m=f.vec3f64.fromValues(P[0],P[1],P[2]);h=A[1];p=f.vec3f64.fromValues(C[0],C[1],C[2]);e.vec3.lerp(q.ambient.color,p,q.ambient.color,w);q.ambient.intensity=a.lerp(h,q.ambient.intensity,w);e.vec3.lerp(q.diffuse.color,
m,q.diffuse.color,w);q.diffuse.intensity=a.lerp(r,q.diffuse.intensity,w)}w=c.valueOf();d.polarException===g.POLAR_EXCEPTION.MIDNIGHT_SUN?(c=w-36E5*(c.getHours()+48)-6E4*c.getMinutes(),d=c+432E6):d.polarException===g.POLAR_EXCEPTION.POLAR_NIGHT?(c=w-2,d=w-1):(c=d.sunrise.valueOf(),d=d.sunset.valueOf());c=1-a.clamp(Math.abs(w-(c+(d-c)/2))/432E5,0,1);q.noonFactor=c;return q};b.computeDirection=function(k,l,h,u){u||(u=f.vec3f64.create());var p=c,r=m.mat4.identity(d);if("global"===h)g.getPosition(k,0,
0,p),e.vec3.set(u,0,0,-1),m.mat4.rotateX(r,r,-p.azimuth),m.mat4.rotateY(r,r,-p.altitude);else{var t=b.settings.planarDirection;h=t.globalAngles;t=(Math.abs(l[2])-t.localAltitude)/(t.globalAltitude-t.localAltitude);t=a.clamp(t,0,1);1>t?(g.getPosition(k,l[1],l[0],p),p.azimuth=(1-t)*p.azimuth+t*h.azimuth,p.altitude=(1-t)*p.altitude+t*h.altitude):(p.azimuth=h.azimuth,p.altitude=h.altitude);e.vec3.set(u,0,-1,0);m.mat4.rotateZ(r,r,-p.azimuth);m.mat4.rotateX(r,r,-p.altitude)}e.vec3.transformMat4(u,u,r);
return u};b.computeShadowsEnabled=function(a,c){return"global"===c?!0:Math.abs(a[2])<b.settings.planarDirection.localAltitude};var d=h.mat4f64.create(),c={azimuth:0,altitude:0},k={ambient:{color:f.vec3f64.create(),intensity:0},diffuse:{color:f.vec3f64.create(),intensity:0,direction:f.vec3f64.create()},globalFactor:0,noonFactor:0}})},"esri/views/3d/lib/SunCalc":function(){define([],function(){function n(a){return new Date(864E5*(a+.5-2440588))}function b(a,d){return t(c(a)*k(w)-p(d)*c(w),k(a))}function a(a,
d){return r(c(d)*k(w)+k(d)*c(w)*c(a))}function m(a,d,e){return t(c(a),k(a)*c(d)-p(e)*k(d))}function h(a,d,e){return r(c(d)*c(e)+k(d)*k(e)*k(a))}function e(a){return v*(1.9148*c(a)+.02*c(2*a)+3E-4*c(3*a))}function f(c,f){c=v*(357.5291+.98560028*c);var g=e(c);c=c+g+102.9372*v+d;f||(f={dec:0,ra:0});f.dec=a(c,0);f.ra=b(c,0);return f}function g(a,d,e){return 2451545+a+.0053*c(d)-.0069*c(2*e)}function l(d){var e=v*(134.963+13.064993*d),f=v*(93.272+13.22935*d);d=v*(218.316+13.176396*d)+6.289*v*c(e);f=5.128*
v*c(f);e=385001-20905*k(e);return{ra:b(d,f),dec:a(d,f),dist:e}}var d=Math.PI,c=Math.sin,k=Math.cos,p=Math.tan,r=Math.asin,t=Math.atan2,u=Math.acos,v=d/180,z={dec:0,ra:0},w=23.4397*v,q={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(a,c,d,e){d=v*-d;c*=v;var g=a.valueOf()/864E5-.5+2440588-2451545;a=f(g,z);d=v*(280.16+360.9856235*g)-d-a.ra;e||(e={azimuth:0,altitude:0});e.azimuth=m(d,c,a.dec);e.altitude=h(d,c,a.dec);return e}},y=[[-.83,"sunrise","sunset"]];q.addTime=function(a,
c,d){y.push([a,c,d])};q.getTimes=function(f,b,l){function h(a){var e=r,f=A;a=u((c(a)-c(e)*c(f))/(k(e)*k(f)));return g(9E-4+(a+p)/(2*d)+t,m,w)}var p=v*-l,r=v*b,t=Math.round(f.valueOf()/864E5-.5+2440588-2451545-9E-4-p/(2*d));f=9E-4+(0+p)/(2*d)+t;var m=v*(357.5291+.98560028*f);b=e(m);var w=m+b+102.9372*v+d,A=a(w,0);f=g(f,m,w);b={solarNoon:n(f),nadir:n(f-.5),polarException:q.POLAR_EXCEPTION.NORMAL};var z,B,C,R;l=0;for(z=y.length;l<z;l+=1)B=y[l],C=h(B[0]*v),R=f-(C-f),b[B[1]]=n(R),b[B[2]]=n(C);b.polarException=
function(a){a=(c(a)-c(r)*c(A))/(k(r)*k(A));return-1>a?q.POLAR_EXCEPTION.MIDNIGHT_SUN:1<a?q.POLAR_EXCEPTION.POLAR_NIGHT:q.POLAR_EXCEPTION.NORMAL}(y[0][0]*v);return b};q.getMoonPosition=function(a,c,d){d=v*-d;c*=v;var e=a.valueOf()/864E5-.5+2440588-2451545;a=l(e);d=v*(280.16+360.9856235*e)-d-a.ra;e=h(d,c,a.dec);e+=.017*v/p(e+10.26*v/(e+5.1*v));return{azimuth:m(d,c,a.dec),altitude:e,distance:a.dist}};q.getMoonFraction=function(a){var d=a.valueOf()/864E5-.5+2440588-2451545;a=f(d);d=l(d);a=u(c(a.dec)*
c(d.dec)+k(a.dec)*k(d.dec)*k(a.ra-d.ra));a=t(149598E3*c(a),d.dist-149598E3*k(a));return(1+k(a))/2};return q})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(b,h,e){void 0===b&&(b=a.vec3f64.create());void 0===h&&(h=a.vec3f64.fromValues(.57735,.57735,.57735));void 0===e&&(e=!0);this.intensity=b;this.direction=h;this.castShadows=
e}}();b.MainLight=n;n=function(){return function(b,h){void 0===b&&(b=a.vec3f64.create());void 0===h&&(h=a.vec3f64.fromValues(.57735,.57735,.57735));this.intensity=a.vec3f64.create();this.direction=a.vec3f64.create();this.intensity=b;this.direction=h}}();b.FillLight=n;n=function(){return function(b){void 0===b&&(b=a.vec3f64.create());this.intensity=b}}();b.AmbientLight=n;n=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();b.SphericalHarmonicsLight=n})},"esri/views/3d/input/SceneInputManager":function(){define("require exports tslib ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H){n=function(b){function m(){var a=null!==b&&b.apply(this,arguments)||this;a._handles=new h;return a}a.__extends(m,b);m.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this.disconnect()};Object.defineProperty(m.prototype,"primaryDragAction",{get:function(){return this._get("primaryDragAction")},set:function(a){"pan"!==a&&"rotate"!==a||a===this._get("primaryDragAction")||(this._set("primaryDragAction",
a),this._updateMode())},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"mode",{get:function(){return this._get("mode")},set:function(a){"default"!==a&&"pro"!==a||a===this._get("mode")||(this._set("mode",a),this._updateMode())},enumerable:!0,configurable:!0});m.prototype.disconnect=function(){this.view.viewEvents.disconnect();this._inputManager&&(this._inputManager.destroy(),this._inputManager=null);this._source&&(this._source.destroy(),this._source=null)};m.prototype.connect=function(){var a=
this,f=this.view;this._source=new w.BrowserEventSource(this.view.surface,f.input);var b=[new B.ImmediateDoubleClick,new C.PointerClickHoldAndDrag,new F.SingleAndDoubleClick,new A.Drag(this.view.navigation),new H.VerticalTwoFingerDrag];this._inputManager=b=new q.InputManager({eventSource:this._source,recognizers:b});b.installHandlers("prevent-context-menu",[new y.PreventContextMenu],q.ViewEventPriorities.INTERNAL);this._modeDragPan=new r.PinchAndPanNavigation(f,"primary");this._modeDragRotate=new l.DragRotate(f,
"secondary","center");this._modeDragZoom=new d.DragZoom(f,"tertiary");b.installHandlers("navigation",[new t.PointerDownCancelAnimation(f),new g.DoubleClickZoom(f),new c.GamepadNavigation(f),new k.KeyboardNavigation(f,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),new p.MouseWheelZoom(f),new v.SingleKeyResetTilt(f,"p"),new u.SingleKeyResetHeading(f,"n"),new l.DragRotate(f,
"primary","eye",["b"]),new l.DragRotate(f,"secondary","center",["b"]),new r.PinchAndPanNavigation(f,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new z.TwoFingerTilt(f)],q.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(b);this._updateMode();e.init(this.view.navigation,"browserTouchPanEnabled",function(c){a._source.browserTouchPanningEnabled=!c})};m.prototype._updateMode=function(){var a=this.primaryDragAction,a=I.get(this.mode).get(a);this._modeDragPan&&(this._modeDragPan.pointerAction=
a.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=a.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=a.zoom)};Object.defineProperty(m.prototype,"test",{get:function(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}},enumerable:!0,configurable:!0});a.__decorate([f.property()],m.prototype,"view",void 0);a.__decorate([f.property({value:"pan"})],m.prototype,"primaryDragAction",null);a.__decorate([f.property({value:"default"})],
m.prototype,"mode",null);a.__decorate([f.property({readOnly:!0,aliasOf:"_inputManager.hasPendingInputs"})],m.prototype,"hasPendingInputs",void 0);a.__decorate([f.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],m.prototype,"latestPointerType",void 0);a.__decorate([f.property()],m.prototype,"_inputManager",void 0);return m=a.__decorate([f.subclass("esri.views.3d.input.SceneInputManager")],m)}(m);var I=new Map;b=new Map;m=new Map;b.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});
b.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});m.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});m.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});I.set("default",b);I.set("pro",m);return n})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("require exports tslib ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(f){function d(a,d){var c=f.call(this,!0)||this;c.view=a;c.registerIncoming("double-click",d,function(a){return c.handleDoubleClick(a)});return c}a.__extends(d,f);d.prototype.handleDoubleClick=function(a){var c=a.data;if(g.eventMatchesPointerAction(c,"primary")){var d=this.view.state.isGlobal?new h.ZoomStepController({view:this.view,mode:"animation"}):new e.ZoomStepController({view:this.view,mode:"animation"});this.view.state.switchCameraController(d);
d.zoomStep(Math.log(.5)/Math.log(.6),m.createScreenPointArray(c.x,c.y));a.stopPropagation()}};return d}(f.InputHandler);b.DoubleClickZoom=n})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("require exports tslib ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p){Object.defineProperty(b,"__esModule",{value:!0});n=function(g){function b(){var a=null!==g&&g.apply(this,arguments)||this;a.zoomLocation=e.vec3f64.create();a.tmpCamera=new c.default;a.tmpViewDir=e.vec3f64.create();a.targetOnSphere=e.vec3f64.create();a.tmpCenter=e.vec3f64.create();a.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new c.default,interactionDirection:null,tiltMode:0};a.sphere=d.sphere.create();return a}
a.__extends(b,g);b.prototype.initialize=function(){this.intersector=new k.Intersector(this.view.viewingMode)};b.prototype.zoomStep=function(a,c){if(this.active){var d=this.view.state,e=this.constraintOptions.interactionStartCamera;this.animation.finished?e.copyFrom(d.camera):this.animation.cameraAt(1,e);e=!1;0<a&&this.intersectionHelper.intersectScreen(c,this.zoomLocation)&&(e=!0);this.tmpCamera.copyFrom(d.camera);e?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&
(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:h.vec3.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,c);this.begin(this.tmpCamera)}};b.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:p.outExpo}};b.prototype.updateCamera=function(a,c,e,g){this.sphere.radius=h.vec3.length(e);h.vec3.subtract(this.tmpViewDir,
a.center,a.eye);var b=h.vec3.length(this.tmpViewDir),k=b*c;1>=c&&4>k&&(k=4,c=k/b);1E-6>Math.abs(b-k)||(b=h.vec3.length(a.center),this.sphere.radius!==b&&h.vec3.scale(a.center,a.center,(this.sphere.radius+c*(b-this.sphere.radius))/b),h.vec3.scale(this.tmpViewDir,this.tmpViewDir,-c),h.vec3.add(a.eye,a.center,this.tmpViewDir),f.applyAll(this.view,a,this.constraintOptions),1E-12<h.vec3.squaredDistance(e,a.center)&&d.sphere.intersectScreen(this.sphere,a,g,this.targetOnSphere)&&l.panToPosition(this.sphere,
a,e,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0),f.applySurfaceCollisionConstraint(this.view,a))};return b=a.__decorate([m.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],b)}(g.PointToPointAnimationController);b.ZoomStepController=n})},"esri/views/3d/camera/constraintUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/vec2 ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../../animation/easing ./constraintUtils/tilt ./constraintUtils/altitude ./constraintUtils/distance ./constraintUtils/surfaceCollision".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p){Object.defineProperty(b,"__esModule",{value:!0});b.applyTiltConstraint=d.applyTiltConstraint;b.getTiltConstraintError=d.getTiltConstraintError;b.applyAltitudeConstraint=c.applyAltitudeConstraint;b.getAltitudeConstraintError=c.getAltitudeConstraintError;b.applyDistanceConstraint=k.applyDistanceConstraint;b.getDistanceConstraintError=k.getDistanceConstraintError;b.applySurfaceCollisionConstraint=p.applySurfaceCollisionConstraint;b.applyAll=function(a,c,d,e){void 0===
d&&(d=t);void 0===e&&(e=c);var g=!1;e!==c&&e.copyFrom(c);e.markViewDirty();e.computeUp(a.state.mode);for(c=0;c<u;c++){for(var b=0,k=0,l=r;k<l.length;k++){var p=l[k];if(h.hasConstraintType(d.selection,p.type)){var q=Math.abs(p.error(a,e,d));p.apply(a,e,d)&&(g=!0,b+=q)}}if(0===b)break}c=h.hasConstraintType(d.selection,8);a:switch(d.interactionType){case 4:d=1;break a;case 5:d=a.state.isGlobal?2:1;break a;default:d=0}c&&f.applySurfaceCollisionConstraint(a,e,d)&&(g=!0);g&&e.computeUp(a.state.mode);return g};
b.pixelDistanceToInteractionFactor=function(c,d){c="number"===typeof c?c:a.vec2.distance(c,d);return l.inOutCubic(Math.min(1,c/150))};var r=[{type:1,error:function(a,c,d){return g.getTiltConstraintError(a,c,d)*c.distance},apply:g.applyTiltConstraint},{type:2,error:m.getAltitudeConstraintError,apply:m.applyAltitudeConstraint},{type:4,error:e.getDistanceConstraintError,apply:e.applyDistanceConstraint}],t={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,
tiltMode:0},u=5})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../support/geometryUtils ../../support/intersectionUtils".split(" "),function(n,b,a,m,h,e,f,g){function l(d,f,g){void 0===g&&(g=e.defaultApplyOptions);var b;b=d.state.constraints.altitude;b=d.state.isGlobal&&b?2===g.interactionType&&e.hasConstraintType(g.selection,1)?!1:!0:!1;if(!b)return 0;
var k=d.state.constraints.altitude;b=c;b.min=k.min;b.max=k.max;var h=g.interactionType;if(0!==h){var k=b.min,p=b.max,r=g.interactionStartCamera;g=g.interactionFactor;var h=2===h||1===h,t=l(d,r),r=0===t?0:d.renderCoordsHelper.getAltitude(r.eye);b.min=k;b.max=p;e.adjustRangeForInteraction(t,r,h,g,.05*r,b)}d=d.renderCoordsHelper.getAltitude(f.eye);d=a.clamp(d,b.min,b.max)-d;return 1E-6>=Math.abs(d)?0:d}function d(a,c,d,e){a.renderCoordsHelper.worldUpAtPosition(c.eye,e);m.vec3.scale(e,e,d);return e}Object.defineProperty(b,
"__esModule",{value:!0});b.applyAltitudeConstraint=function(c,b,h){void 0===h&&(h=e.defaultApplyOptions);var t=l(c,b,h);if(0===t)return!1;var u=c.renderCoordsHelper,q=u.getAltitude(b.eye)+t;c=e.interactionDirectionTowardsConstraintMinimization(b,h.interactionDirection,d(c,b,a.sign(t),p),k);h=m.vec3.copy(r,b.viewForward);u.intersectInfiniteManifold(f.ray.wrap(b.eye,c),q,b.eye)||u.setAltitude(q,b.eye);g.closestPointOnRay(b.eye,h,b.center,b.center);b.markViewDirty();return!0};b.getAltitudeConstraintError=
l;var c={min:0,max:0},k=h.vec3f64.create(),p=h.vec3f64.create(),r=h.vec3f64.create()})},"esri/views/3d/camera/constraintUtils/common":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.hasConstraintType=function(a,e){return 0!==(a&e)};b.adjustRangeForInteraction=function(a,e,f,g,b,d){0!==a&&(f?(d.min=Math.min(d.min,e),d.max=Math.max(d.max,e)):null!=g?(d.min-=Math.max(0,(e-
d.min)*(1-g)),d.max+=Math.max(0,(e-d.max)*(1-g))):b&&(d.min-=Math.max(0,e-d.min-b),d.max+=Math.max(0,e-d.max-b)))};b.defaultApplyOptions={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};b.interactionDirectionTowardsConstraintMinimization=function(b,e,f,g){e=e||b.viewForward;m.vec3.copy(g,e);m.vec3.scale(g,g,a.sign(m.vec3.dot(e,f)));return g}})},"esri/views/3d/support/intersectionUtils":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec2f64",
"../../../core/libs/gl-matrix-2/vec3","../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,a,m,h){function e(a,c,e,f){var d=l;a?(e&&f&&(d.len=m.vec3.distance(c,e)),m.vec3.copy(d.dir,a)):f?(d.len=m.vec3.distance(c,e),m.vec3.subtract(d.dir,e,c),m.vec3.scale(d.dir,d.dir,1/d.len)):(m.vec3.subtract(d.dir,e,c),m.vec3.normalize(d.dir,d.dir));return d}function f(a,c){return-m.vec3.dot(c,a)-a[3]}function g(a,c,e,g){g.clip[0]=0;g.clip[1]=e?g.len:Number.MAX_VALUE;for(e=0;e<a.length;e++){var d;var b=a[e],k=
c;d=g;var l=m.vec3.dot(b,d.dir),b=f(b,k);0>b&&0<=l?d=!1:-1E-6<l&&1E-6>l?d=0<b:!(0>b||0>l)||0>b&&0>l?(b/=l,0<l?b<d.clip[1]&&(d.clip[1]=b):b>d.clip[0]&&(d.clip[0]=b),d=d.clip[0]<=d.clip[1]):d=!0;if(!d)return!1}return!0}Object.defineProperty(b,"__esModule",{value:!0});b.planeSphere=function(a,c,e){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]<e};b.frustumSphere=function(a,c,e){var d=c[0],f=c[1];c=c[2];return a[0][0]*d+a[0][1]*f+a[0][2]*c+a[0][3]>e||a[1][0]*d+a[1][1]*f+a[1][2]*c+a[1][3]>e||a[2][0]*d+a[2][1]*
f+a[2][2]*c+a[2][3]>e||a[3][0]*d+a[3][1]*f+a[3][2]*c+a[3][3]>e||a[4][0]*d+a[4][1]*f+a[4][2]*c+a[4][3]>e||a[5][0]*d+a[5][1]*f+a[5][2]*c+a[5][3]>e?!1:!0};b.frustumRay=function(a,c,f,b){f=e(b,c,f,!1);return g(a,c,null,f)};b.frustumPoint=function(a,c){for(var d=0;6>d;d++)if(0>f(a[d],c))return!1;return!0};b.frustumLineSegment=function(a,c,f,b){b=e(b,c,f,!0);return g(a,c,f,b)};b.closestPointOnRay=function(a,c,e,f){e=m.vec3.dot(c,m.vec3.subtract(f,e,a));m.vec3.add(f,a,m.vec3.scale(f,c,e));return f};var l=
{dir:h.vec3f64.create(),len:0,clip:a.vec2f64.create()}})},"esri/views/3d/camera/constraintUtils/distance":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../support/geometryUtils ../../support/mathUtils".split(" "),function(n,b,a,m,h,e,f){function g(c,d,e){void 0===e&&(e=h.defaultApplyOptions);if(!c.state.isLocal)return 0;var f=c.state.constraints.distance;if(!c.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===
f)return 0;l.min=0;l.max=f;var f=l,b=e.interactionType;if(0!==b){var k=f.min,p=f.max,r=e.interactionStartCamera;e=e.interactionFactor;var b=1===b||4===b,t=g(c,r),r=0===t?0:a.vec3.distance(r.eye,c.pointsOfInterest.surfaceOrigin.renderLocation);f.min=k;f.max=p;h.adjustRangeForInteraction(t,r,b,e,.05*r,f)}c=a.vec3.distance(d.eye,c.pointsOfInterest.surfaceOrigin.renderLocation);c=l.max-c;return-1E-6<=c?0:c}Object.defineProperty(b,"__esModule",{value:!0});b.getDistanceConstraintError=g;b.applyDistanceConstraint=
function(b,l,m){void 0===m&&(m=h.defaultApplyOptions);var r=g(b,l,m);if(0===r)return!1;var t=b.pointsOfInterest.surfaceOrigin,r=a.vec3.distance(l.eye,b.pointsOfInterest.surfaceOrigin.renderLocation)+r,w=a.vec3.copy(d,l.eye);m=h.interactionDirectionTowardsConstraintMinimization(l,m.interactionDirection,f.directionFromTo(p,l.eye,b.pointsOfInterest.surfaceOrigin.renderLocation),k);return e.sphere.intersectRay(e.sphere.wrap(r,t.renderLocation),e.ray.wrap(l.eye,m),l.eye)?(t=a.vec3.subtract(c,l.eye,w),
a.vec3.add(l.center,l.center,t),l.markViewDirty(),t=b.renderCoordsHelper.getAltitude(l.center),b.renderCoordsHelper.intersectInfiniteManifold(l.ray,t,l.center),l.markViewDirty(),!0):!1};var l={min:0,max:0},d=m.vec3f64.create(),c=m.vec3f64.create(),k=m.vec3f64.create(),p=m.vec3f64.create()})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64","../intersectionUtils"],function(n,
b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.applySurfaceCollisionConstraint=function(f,g,b){void 0===b&&(b=0);var d=f.state.constraints;if(!d.collision.enabled)return!1;var c=h.surfaceElevationBelowEye(f,g),k=f.renderCoordsHelper.getAltitude(g.eye),d=c+d.collision.elevationMargin;if(k>=d)return!1;c=a.vec3.length(g.eye);a.vec3.subtract(e,g.center,g.eye);f.renderCoordsHelper.setAltitude(d,g.eye);1===b?a.vec3.add(g.center,g.eye,e):2===b&&a.vec3.scale(g.center,g.center,(c-k+d)/c);g.markViewDirty();
return!0};var e=m.vec3f64.create()})},"esri/views/3d/camera/intersectionUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingRect ../support/earthUtils ../webgl-engine/lib/Intersector".split(" "),function(n,b,a,m,h,e,f){function g(a,c){return a.basemapTerrain?a.elevationProvider.getElevation(c[0],c[1],c[2],a.renderCoordsHelper.spatialReference)||0:0}function l(c,d,e){if(!c.state.isGlobal)return!1;var f=
g(c,d);c=c.stateManager.constraintsManager.nearFarHeuristic.compute(d,e,c.dataExtent,f,t).far;c*=c;return a.vec3.squaredDistance(d,e)>c}function d(d,g,b){void 0===b&&(b=m.vec3f64.create());var k=c[d.viewingMode];k||(k=new f.Intersector(d.viewingMode),k.options.backfacesTerrain=!d.state.isGlobal,k.options.invisibleTerrain=!0,c[d.viewingMode]=k);var h=d.state.isGlobal;return d.sceneIntersectionHelper.intersectRay(g,k,b)&&!l(d,g.origin,b)?!0:!d.renderCoordsHelper.intersectManifold(g,0,b)||l(d,g.origin,
b)?h?(d=b,b=a.vec3.dot(g.origin,g.origin)-e.earthRadius*e.earthRadius,a.vec3.scale(d,g.direction,(0<b?Math.sqrt(b)/3:1)/a.vec3.length(g.direction)),a.vec3.add(d,d,g.origin),!0):!1:!0}Object.defineProperty(b,"__esModule",{value:!0});b.eyeWithinExtent=function(a,c,d,e){return a.renderCoordsHelper.fromRenderCoords(c.eye,k,e)&&h.containsPoint(d,k)};b.surfaceElevationBelowEye=function(a,c){return g(a,c.eye)};b.cameraOnContentAlongViewDirection=function(c,e,f,g){var b=c.state.camera.clone();e&&(b.eye=e);
f&&(b.center=f);g&&(b.up=g);d(c,b.ray,p)||a.vec3.copy(p,b.center);f=c.state.constraints;g=f.minimumPoiDistance;a.vec3.squaredDistance(b.eye,p)<g&&(e=f.collision.enabled,a.vec3.copy(r,b.viewForward),a.vec3.scale(r,r,g),e?a.vec3.subtract(b.eye,p,r):a.vec3.add(p,b.eye,r),c=c.renderCoordsHelper,g=c.getAltitude(b.eye),f=f.collision.elevationMargin,e&&g<f&&(a.vec3.subtract(r,p,b.eye),c.setAltitude(f,b.eye),a.vec3.add(p,b.eye,r)));b.center=p;return b};var c={},k=m.vec3f64.create(),p=m.vec3f64.create(),r=
m.vec3f64.create(),t={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("require exports ../../../../core/has ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./intersectorUtils ../materials/renderers/utils".split(" "),function(n,b,a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a){this.options=new l.IntersectorOptions;
this.results=new l.IntersectorResults;this.transform=new l.IntersectorTransform;this.performanceInfo={queryDuration:0,numObjectsTested:0};this.tolerance=1E-5;this.verticalOffset=null;this._ray={origin:f.vec3f64.create(),direction:f.vec3f64.create()};this._rayEndPoint=f.vec3f64.create();this._rayStartPointTransformed=f.vec3f64.create();this._rayEndPointTransformed=f.vec3f64.create();this.viewingMode=a||"global"}Object.defineProperty(a.prototype,"ray",{get:function(){return this._ray},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"rayBeginPoint",{get:function(){return this._ray.origin},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"rayEndPoint",{get:function(){return this._rayEndPoint},enumerable:!0,configurable:!0});a.prototype.reset=function(a,c){this.resetWithRay(g.ray.fromPoints(a,c,this._ray))};a.prototype.resetWithRay=function(a){a!==this._ray&&g.ray.copy(a,this._ray);0!==this.options.verticalOffset?"local"===this.viewingMode?this._ray.origin[2]-=
this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;e.vec3.add(this._rayEndPoint,this._ray.origin,this._ray.direction);this._numObjectsTested=0;this.results.init(this._ray)};a.prototype.intersect=function(a,c,d,e,f,g){var b=this;this.point=c;this.camera=d;this.filterPredicate=f;this.tolerance=null==e?1E-5:e;c=l.getVerticalOffsetObject3D(this.verticalOffset);d=g?function(a){g(a)&&b.intersectObject(a)}:function(a){b.intersectObject(a)};if(a&&0<a.length)for(e=
0;e<a.length;e++){f=a[e];var k=f.getSpatialQueryAccelerator&&f.getSpatialQueryAccelerator();if(k)m.isSome(c)?k.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,d,c):k.forEachAlongRay(this._ray.origin,this._ray.direction,d),this.options.selectionMode&&this.options.hud&&k.forEachDegenerateObject(d);else for(k=0,f=f.getObjects();k<f.length;k++)d(f[k])}this.sortResults()};a.prototype.intersectObject=function(a){var c=this;this._numObjectsTested++;var f=a.geometryRecords;if(f)for(var g=
a.id,b=a.objectTransformation,k,z=l.getVerticalOffsetObject3D(this.verticalOffset),w=function(f){var p=f.geometry,r=f.material,t=f.instanceParameters;if(d.isInstanceHidden(t))return"continue";k=p.id;q.transform.setAndInvalidateLazyTransforms(b,f.getShaderTransformation());e.vec3.transformMat4(q._rayStartPointTransformed,q._ray.origin,q.transform.inverse);e.vec3.transformMat4(q._rayEndPointTransformed,q._rayEndPoint,q.transform.inverse);var w=q.transform.transform;m.isSome(z)&&(z.objectTransform=q.transform);
r.intersect(p,t,q.transform.transform,q,q._rayStartPointTransformed,q._rayEndPointTransformed,function(d,e,f,b,p,q){0<=d&&(!m.isSome(c.filterPredicate)||c.filterPredicate(c._ray.origin,c._rayEndPoint,d))&&(p?(null==c.results.hud.dist||d<c.results.hud.dist)&&c.results.hud.set(a,g,d,e,h.mat4f64.IDENTITY,b,q,k,f):(p=function(c){return c.set(a,g,d,e,w,b,null,k,f)},(null==c.results.min.drapedLayerOrder||b>=c.results.min.drapedLayerOrder)&&(null==c.results.min.dist||d<c.results.min.dist)&&p(c.results.min),
0!==c.options.store&&(null==c.results.max.drapedLayerOrder||b<c.results.max.drapedLayerOrder)&&(null==c.results.max.dist||d>c.results.max.dist)&&p(c.results.max),2===c.options.store&&(q=new l.IntersectorResult(c._ray),p(q),c.results.all.push(q))))},f.shaderTransformation)},q=this,y=0;y<f.length;y++)w(f[y])};a.prototype.sortResults=function(){this.results.all.sort(function(a,c){return a.dist!==c.dist?a.dist-c.dist:a.drapedLayerOrder!==c.drapedLayerOrder?(void 0!==a.drapedLayerOrder?a.drapedLayerOrder:
Number.MAX_VALUE)-(void 0!==c.drapedLayerOrder?c.drapedLayerOrder:Number.MAX_VALUE):(void 0!==c.drapedLayerGraphicOrder?c.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==a.drapedLayerGraphicOrder?a.drapedLayerGraphicOrder:Number.MIN_VALUE)})};a.DEFAULT_TOLERANCE=1E-5;return a}();b.Intersector=n})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/quat ../../../../core/libs/gl-matrix-2/quatf64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/geometryUtils/boundedPlane ../../support/geometryUtils/sphere ./Object3D".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z){function w(c,d){return a.isNone(c)||null==c.layerUid?null:a.isSome(d.graphicsView)&&c.layerUid===d.graphicsView.mockLayerId?d.graphics:d.map.findLayerByUid(c.layerUid)}function q(c,d){if(a.isNone(c))return null;var e=w(c,d);return a.isNone(e)?null:e===d.graphics?a.isSome(d.graphicsView)?a.unwrap(d.graphicsView.getGraphicFromGraphicUid(c.graphicUid)):null:(d=d.allLayerViews.find(function(a){return a.layer===e}))?y(d,c):null}function y(a,c){return!a||a.suspended?
null:"getGraphicFromIntersectorMetadata"in a&&c?a.getGraphicFromIntersectorMetadata(c):"getGraphicFromGraphicUid"in a&&null!=c.graphicUid?a.getGraphicFromGraphicUid(c.graphicUid):null}Object.defineProperty(b,"__esModule",{value:!0});b.sliceFilterPredicate=function(a){return function(c,e,f){d.vec3.lerp(J,c,e,f);return!u.extrusionContainsPoint(a,J)}};n=function(){return function(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.storeTerrainResults=
this.backfacesTerrain=!0;this.store=2}}();b.IntersectorOptions=n;n=function(){function a(){this._transform=f.mat4f64.create();this._transformInverse=new A({value:this._transform},e.mat4.invert,f.mat4f64.create);this._transformInverseTranspose=new A(this._transformInverse,e.mat4.transpose,f.mat4f64.create);this._transformTranspose=new A({value:this._transform},e.mat4.transpose,f.mat4f64.create);this._transformInverseRotation=new A({value:this._transform},m.mat3.normalFromMat4Legacy,h.mat3f64.create)}
a.prototype.invalidateLazyTransforms=function(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()};Object.defineProperty(a.prototype,"transform",{get:function(){return this._transform},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"inverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"inverseTranspose",
{get:function(){return this._transformInverseTranspose.value},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"inverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"transpose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0});a.prototype.setTransformMatrix=function(a){e.mat4.copy(this._transform,a)};a.prototype.multiplyTransform=function(a){e.mat4.multiply(this._transform,
this._transform,a)};a.prototype.set=function(a){e.mat4.copy(this._transform,a);this.invalidateLazyTransforms()};a.prototype.setAndInvalidateLazyTransforms=function(a,c){this.setTransformMatrix(a);this.multiplyTransform(c);this.invalidateLazyTransforms()};return a}();b.IntersectorTransform=n;var A=function(){function a(a,c,d){this.original=a;this.update=c;this.dirty=!0;this.transform=d()}a.prototype.invalidate=function(){this.dirty=!0};Object.defineProperty(a.prototype,"value",{get:function(){this.dirty&&
(this.update(this.transform,this.original.value),this.dirty=!1);return this.transform},enumerable:!0,configurable:!0});return a}();n=function(){function a(){this.min=new B;this.max=new B;this.hud=new B;this.ground=new B}a.prototype.init=function(a){this.min.init(a);this.max.init(a);this.hud.init(a);this.ground.init(a);this.all=[]};return a}();b.IntersectorResults=n;var B=function(){function a(a){this.normal=k.vec3f64.create();this.transformation=f.mat4f64.create();this._ray=t.ray.create();this.init(a)}
Object.defineProperty(a.prototype,"ray",{get:function(){return this._ray},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasIntersectionPoint",{get:function(){return null!=this.dist},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"distanceInRenderSpace",{get:function(){if(null!=this.dist)return d.vec3.scale(E,this.ray.direction,this.dist),d.vec3.length(E)},enumerable:!0,configurable:!0});a.prototype.getIntersectionPoint=function(a){if(!this.hasIntersectionPoint)return!1;
d.vec3.scale(E,this.ray.direction,this.dist);d.vec3.add(a,this.ray.origin,E);return!0};a.prototype.getTransformedNormal=function(a){d.vec3.copy(L,this.normal);L[3]=0;p.vec4.transformMat4(L,L,this.transformation);d.vec3.copy(a,L);d.vec3.normalize(a,a);return a};a.prototype.init=function(a){this.drapedLayerGraphicOrder=this.drapedLayerOrder=this.name=this.target=this.dist=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="Stage";a?t.ray.copy(a,this._ray):this._ray=t.ray.create()};
a.prototype.set=function(a,c,f,g,b,l,h,p,q,r){a instanceof z&&(a={type:"stage",obj:a});this.dist=f;d.vec3.copy(this.normal,g);e.mat4.copy(this.transformation,b);this.target=a;this.name=c;this.drapedLayerOrder=l;this.center=h?k.vec3f64.clone(h):null;this.geometryId=p;this.triangleNr=q;this.drapedLayerGraphicOrder=r};a.prototype.copyFrom=function(a){t.ray.copy(a._ray,this._ray);this.dist=a.dist;this.target=a.target;this.name=a.name;this.drapedLayerOrder=a.drapedLayerOrder;this.center=a.center?k.vec3f64.clone(a.center):
null;this.geometryId=a.geometryId;this.triangleNr=a.triangleNr;this.intersector=a.intersector;this.drapedLayerGraphicOrder=a.drapedLayerGraphicOrder;d.vec3.copy(this.normal,a.normal);e.mat4.copy(this.transformation,a.transformation)};a.prototype.toOwner=function(a){if(!this.target)return null;switch(this.target.type){case "stage":return w(this.target.obj.metadata,a);case "external":switch(this.intersector){case "PointRenderer":var c=this.target.metadata.layerUid;return null!=c?a.map.findLayerByUid(c):
null;case "I3S":case "IM":case "LodRenderer":case "OverlayRenderer":return w(this.target.metadata,a);case "TerrainRenderer":return a.map&&a.map.ground}}return null};a.prototype.toGraphic=function(a){if(!this.target)return null;switch(this.target.type){case "stage":return q(this.target.obj.metadata,a);case "external":switch(this.intersector){case "PointRenderer":return this.target.metadata.createGraphic();case "I3S":case "IM":case "LodRenderer":case "OverlayRenderer":return q(this.target.metadata,
a)}}return null};return a}();b.IntersectorResult=B;n=function(){function a(a){void 0===a&&(a=0);this.offset=a;this.tmpVertex=k.vec3f64.create()}a.prototype.applyToVertex=function(a,c,d){var e=a+this.localOrigin[0],f=c+this.localOrigin[1],g=d+this.localOrigin[2],b=this.offset/Math.sqrt(e*e+f*f+g*g);this.tmpVertex[0]=a+e*b;this.tmpVertex[1]=c+f*b;this.tmpVertex[2]=d+g*b;return this.tmpVertex};a.prototype.applyToAABB=function(a){var c=a[0]+this.localOrigin[0],d=a[1]+this.localOrigin[1],e=a[2]+this.localOrigin[2],
f=a[3]+this.localOrigin[0],g=a[4]+this.localOrigin[1],b=a[5]+this.localOrigin[2],k=this.offset/Math.sqrt(c*c+d*d+e*e);a[0]+=c*k;a[1]+=d*k;a[2]+=e*k;c=this.offset/Math.sqrt(f*f+g*g+b*b);a[3]+=f*c;a[4]+=g*c;a[5]+=b*c;return a};return a}();b.TerrainVerticalOffsetGlobalViewingMode=n;var C=function(){function a(a){void 0===a&&(a=0);this.offset=a;this.componentLocalOriginLength=0;this.tmpVertex=k.vec3f64.create();this.mbs=r.vec4f64.create();this.obb={center:k.vec3f64.create(),halfSize:c.vec3f32.create(),
quaternion:null}}Object.defineProperty(a.prototype,"localOrigin",{set:function(a){this.componentLocalOriginLength=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])},enumerable:!0,configurable:!0});a.prototype.applyToVertex=function(a,c,d){var e=d+this.componentLocalOriginLength,f=this.offset/Math.sqrt(a*a+c*c+e*e);this.tmpVertex[0]=a+a*f;this.tmpVertex[1]=c+c*f;this.tmpVertex[2]=d+e*f;return this.tmpVertex};a.prototype.applyToAABB=function(a){var c=a[0],d=a[1],e=a[2]+this.componentLocalOriginLength,f=a[3],
g=a[4],b=a[5]+this.componentLocalOriginLength,k=this.offset/Math.sqrt(c*c+d*d+e*e);a[0]+=c*k;a[1]+=d*k;a[2]+=e*k;c=this.offset/Math.sqrt(f*f+g*g+b*b);a[3]+=f*c;a[4]+=g*c;a[5]+=b*c;return a};a.prototype.applyToMbs=function(a){var c=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),d=this.offset/c;this.mbs[0]=a[0]+a[0]*d;this.mbs[1]=a[1]+a[1]*d;this.mbs[2]=a[2]+a[2]*d;this.mbs[3]=a[3]+a[3]*this.offset/c;return this.mbs};a.prototype.applyToObb=function(a){var c=a.center,e=this.offset/Math.sqrt(c[0]*c[0]+c[1]*
c[1]+c[2]*c[2]);this.obb.center[0]=c[0]+c[0]*e;this.obb.center[1]=c[1]+c[1]*e;this.obb.center[2]=c[2]+c[2]*e;d.vec3.transformQuat(this.obb.halfSize,a.halfSize,a.quaternion);d.vec3.add(this.obb.halfSize,this.obb.halfSize,a.center);c=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);this.obb.halfSize[0]+=this.obb.halfSize[0]*c;this.obb.halfSize[1]+=this.obb.halfSize[1]*c;this.obb.halfSize[2]+=this.obb.halfSize[2]*
c;d.vec3.subtract(this.obb.halfSize,this.obb.halfSize,a.center);g.quat.conjugate(M,a.quaternion);d.vec3.transformQuat(this.obb.halfSize,this.obb.halfSize,M);this.obb.halfSize[0]*=0>this.obb.halfSize[0]?-1:1;this.obb.halfSize[1]*=0>this.obb.halfSize[1]?-1:1;this.obb.halfSize[2]*=0>this.obb.halfSize[2]?-1:1;this.obb.quaternion=a.quaternion;return this.obb};return a}();b.I3SVerticalOffsetGlobalViewingMode=C;var F=function(){function a(a){void 0===a&&(a=0);this.offset=a;this.sphere=v.create();this.tmpVertex=
k.vec3f64.create()}a.prototype.applyToVertex=function(a,c,d){var e=this.objectTransform.transform,f=e[0]*a+e[4]*c+e[8]*d+e[12],g=e[1]*a+e[5]*c+e[9]*d+e[13];a=e[2]*a+e[6]*c+e[10]*d+e[14];c=this.offset/Math.sqrt(f*f+g*g+a*a);f+=f*c;g+=g*c;a+=a*c;c=this.objectTransform.inverse;this.tmpVertex[0]=c[0]*f+c[4]*g+c[8]*a+c[12];this.tmpVertex[1]=c[1]*f+c[5]*g+c[9]*a+c[13];this.tmpVertex[2]=c[2]*f+c[6]*g+c[10]*a+c[14];return this.tmpVertex};a.prototype.applyToMinMax=function(a,c){var d=this.offset/Math.sqrt(a[0]*
a[0]+a[1]*a[1]+a[2]*a[2]);a[0]+=a[0]*d;a[1]+=a[1]*d;a[2]+=a[2]*d;a=this.offset/Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);c[0]+=c[0]*a;c[1]+=c[1]*a;c[2]+=c[2]*a};a.prototype.applyToAABB=function(a){var c=this.offset/Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);a[0]+=a[0]*c;a[1]+=a[1]*c;a[2]+=a[2]*c;c=this.offset/Math.sqrt(a[3]*a[3]+a[4]*a[4]+a[5]*a[5]);a[3]+=a[3]*c;a[4]+=a[4]*c;a[5]+=a[5]*c;return a};a.prototype.applyToBoundingSphere=function(a,c){var d=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]),e=this.offset/
d;this.sphere.center[0]=c[0]+c[0]*e;this.sphere.center[1]=c[1]+c[1]*e;this.sphere.center[2]=c[2]+c[2]*e;this.sphere.radius=a+a*this.offset/d;return this.sphere};return a}();b.Object3DVerticalOffsetGlobalViewingMode=F;var H=new F;b.getVerticalOffsetObject3D=function(c){return a.isSome(c)?(H.offset=c,H):null};var I=new C;b.getVerticalOffsetI3S=function(c){return a.isSome(c)?(I.offset=c,I):null};var G=new n;b.getVerticalOffsetTerrain=function(c){return a.isSome(c)?(G.offset=c,G):null};b.TERRAIN_ID="terrain";
var J=k.vec3f64.create(),E=k.vec3f64.create(),L=r.vec4f64.create(),M=l.quatf64.create()})},"esri/core/libs/gl-matrix-2/mat3":function(){define(["require","exports","./math/mat3"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.mat3=a})},"esri/core/libs/gl-matrix-2/math/mat3":function(){define(["require","exports","./common"],function(n,b,a){function m(a,f,g){var e=f[0],d=f[1],c=f[2],b=f[3],h=f[4],r=f[5],m=f[6],u=f[7];f=f[8];var v=g[0],z=g[1],w=g[2],q=g[3],y=g[4],A=g[5],B=g[6],C=
g[7];g=g[8];a[0]=v*e+z*b+w*m;a[1]=v*d+z*h+w*u;a[2]=v*c+z*r+w*f;a[3]=q*e+y*b+A*m;a[4]=q*d+y*h+A*u;a[5]=q*c+y*r+A*f;a[6]=B*e+C*b+g*m;a[7]=B*d+C*h+g*u;a[8]=B*c+C*r+g*f;return a}function h(a,f,g){a[0]=f[0]-g[0];a[1]=f[1]-g[1];a[2]=f[2]-g[2];a[3]=f[3]-g[3];a[4]=f[4]-g[4];a[5]=f[5]-g[5];a[6]=f[6]-g[6];a[7]=f[7]-g[7];a[8]=f[8]-g[8];return a}Object.defineProperty(b,"__esModule",{value:!0});b.fromMat4=function(a,f){a[0]=f[0];a[1]=f[1];a[2]=f[2];a[3]=f[4];a[4]=f[5];a[5]=f[6];a[6]=f[8];a[7]=f[9];a[8]=f[10];
return a};b.copy=function(a,f){a[0]=f[0];a[1]=f[1];a[2]=f[2];a[3]=f[3];a[4]=f[4];a[5]=f[5];a[6]=f[6];a[7]=f[7];a[8]=f[8];return a};b.set=function(a,f,g,b,d,c,k,h,r,m){a[0]=f;a[1]=g;a[2]=b;a[3]=d;a[4]=c;a[5]=k;a[6]=h;a[7]=r;a[8]=m;return a};b.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};b.transpose=function(a,f){if(a===f){var e=f[1],b=f[2],d=f[5];a[1]=f[3];a[2]=f[6];a[3]=e;a[5]=f[7];a[6]=b;a[7]=d}else a[0]=f[0],a[1]=f[3],a[2]=f[6],a[3]=f[1],a[4]=f[4],
a[5]=f[7],a[6]=f[2],a[7]=f[5],a[8]=f[8];return a};b.invert=function(a,f){var e=f[0],b=f[1],d=f[2],c=f[3],k=f[4],h=f[5],r=f[6],m=f[7];f=f[8];var u=f*k-h*m,v=-f*c+h*r,z=m*c-k*r,w=e*u+b*v+d*z;if(!w)return null;w=1/w;a[0]=u*w;a[1]=(-f*b+d*m)*w;a[2]=(h*b-d*k)*w;a[3]=v*w;a[4]=(f*e-d*r)*w;a[5]=(-h*e+d*c)*w;a[6]=z*w;a[7]=(-m*e+b*r)*w;a[8]=(k*e-b*c)*w;return a};b.adjoint=function(a,f){var e=f[0],b=f[1],d=f[2],c=f[3],k=f[4],h=f[5],r=f[6],m=f[7];f=f[8];a[0]=k*f-h*m;a[1]=d*m-b*f;a[2]=b*h-d*k;a[3]=h*r-c*f;a[4]=
e*f-d*r;a[5]=d*c-e*h;a[6]=c*m-k*r;a[7]=b*r-e*m;a[8]=e*k-b*c;return a};b.determinant=function(a){var e=a[3],g=a[4],b=a[5],d=a[6],c=a[7],k=a[8];return a[0]*(k*g-b*c)+a[1]*(-k*e+b*d)+a[2]*(c*e-g*d)};b.multiply=m;b.translate=function(a,f,g){var e=f[0],d=f[1],c=f[2],b=f[3],h=f[4],r=f[5],m=f[6],u=f[7];f=f[8];var v=g[0];g=g[1];a[0]=e;a[1]=d;a[2]=c;a[3]=b;a[4]=h;a[5]=r;a[6]=v*e+g*b+m;a[7]=v*d+g*h+u;a[8]=v*c+g*r+f;return a};b.rotate=function(a,f,g){var e=f[0],d=f[1],c=f[2],b=f[3],h=f[4],r=f[5],m=f[6],u=f[7];
f=f[8];var v=Math.sin(g);g=Math.cos(g);a[0]=g*e+v*b;a[1]=g*d+v*h;a[2]=g*c+v*r;a[3]=g*b-v*e;a[4]=g*h-v*d;a[5]=g*r-v*c;a[6]=m;a[7]=u;a[8]=f;return a};b.scale=function(a,f,g){var e=g[0],d=g[1];g=g[2];a[0]=e*f[0];a[1]=e*f[1];a[2]=e*f[2];a[3]=d*f[3];a[4]=d*f[4];a[5]=d*f[5];a[6]=g*f[6];a[7]=g*f[7];a[8]=g*f[8];return a};b.scaleByVec2=function(a,f,g){var e=g[0];g=g[1];a[0]=e*f[0];a[1]=e*f[1];a[2]=e*f[2];a[3]=g*f[3];a[4]=g*f[4];a[5]=g*f[5];return a};b.fromTranslation=function(a,f){a[0]=1;a[1]=0;a[2]=0;a[3]=
0;a[4]=1;a[5]=0;a[6]=f[0];a[7]=f[1];a[8]=1;return a};b.fromRotation=function(a,f){var e=Math.sin(f);f=Math.cos(f);a[0]=f;a[1]=e;a[2]=0;a[3]=-e;a[4]=f;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};b.fromScaling=function(a,f){a[0]=f[0];a[1]=0;a[2]=0;a[3]=0;a[4]=f[1];a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};b.fromMat2d=function(a,f){a[0]=f[0];a[1]=f[1];a[2]=0;a[3]=f[2];a[4]=f[3];a[5]=0;a[6]=f[4];a[7]=f[5];a[8]=1;return a};b.fromQuat=function(a,f){var e=f[0],b=f[1],d=f[2];f=f[3];var c=e+e,k=b+b,h=d+d,e=e*c,r=b*
c,b=b*k,m=d*c,u=d*k,d=d*h,c=f*c,k=f*k;f*=h;a[0]=1-b-d;a[3]=r-f;a[6]=m+k;a[1]=r+f;a[4]=1-e-d;a[7]=u-c;a[2]=m-k;a[5]=u+c;a[8]=1-e-b;return a};b.normalFromMat4Legacy=function(a,f){var e=f[0],b=f[1],d=f[2],c=f[4],k=f[5],h=f[6],r=f[8],m=f[9];f=f[10];var u=f*k-h*m,v=-f*c+h*r,z=m*c-k*r,w=e*u+b*v+d*z;if(!w)return null;w=1/w;a[0]=u*w;a[1]=(-f*b+d*m)*w;a[2]=(h*b-d*k)*w;a[3]=v*w;a[4]=(f*e-d*r)*w;a[5]=(-h*e+d*c)*w;a[6]=z*w;a[7]=(-m*e+b*r)*w;a[8]=(k*e-b*c)*w;return a};b.normalFromMat4=function(a,f){var e=f[0],
b=f[1],d=f[2],c=f[3],k=f[4],h=f[5],r=f[6],m=f[7],u=f[8],v=f[9],z=f[10],w=f[11],q=f[12],y=f[13],A=f[14];f=f[15];var B=e*h-b*k,C=e*r-d*k,F=e*m-c*k,H=b*r-d*h,I=b*m-c*h,G=d*m-c*r,J=u*y-v*q,E=u*A-z*q,u=u*f-w*q,L=v*A-z*y,v=v*f-w*y,z=z*f-w*A,w=B*z-C*v+F*L+H*u-I*E+G*J;if(!w)return null;w=1/w;a[0]=(h*z-r*v+m*L)*w;a[1]=(r*u-k*z-m*E)*w;a[2]=(k*v-h*u+m*J)*w;a[3]=(d*v-b*z-c*L)*w;a[4]=(e*z-d*u+c*E)*w;a[5]=(b*u-e*v-c*J)*w;a[6]=(y*G-A*I+f*H)*w;a[7]=(A*F-q*G-f*C)*w;a[8]=(q*I-y*F+f*B)*w;return a};b.projection=function(a,
f,g){a[0]=2/f;a[1]=0;a[2]=0;a[3]=0;a[4]=-2/g;a[5]=0;a[6]=-1;a[7]=1;a[8]=1;return a};b.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};b.add=function(a,f,g){a[0]=f[0]+g[0];a[1]=f[1]+g[1];a[2]=f[2]+g[2];a[3]=f[3]+g[3];a[4]=f[4]+g[4];a[5]=f[5]+
g[5];a[6]=f[6]+g[6];a[7]=f[7]+g[7];a[8]=f[8]+g[8];return a};b.subtract=h;b.multiplyScalar=function(a,f,g){a[0]=f[0]*g;a[1]=f[1]*g;a[2]=f[2]*g;a[3]=f[3]*g;a[4]=f[4]*g;a[5]=f[5]*g;a[6]=f[6]*g;a[7]=f[7]*g;a[8]=f[8]*g;return a};b.multiplyScalarAndAdd=function(a,f,g,b){a[0]=f[0]+g[0]*b;a[1]=f[1]+g[1]*b;a[2]=f[2]+g[2]*b;a[3]=f[3]+g[3]*b;a[4]=f[4]+g[4]*b;a[5]=f[5]+g[5]*b;a[6]=f[6]+g[6]*b;a[7]=f[7]+g[7]*b;a[8]=f[8]+g[8]*b;return a};b.exactEquals=function(a,f){return a[0]===f[0]&&a[1]===f[1]&&a[2]===f[2]&&
a[3]===f[3]&&a[4]===f[4]&&a[5]===f[5]&&a[6]===f[6]&&a[7]===f[7]&&a[8]===f[8]};b.equals=function(e,f){var g=e[0],b=e[1],d=e[2],c=e[3],k=e[4],h=e[5],r=e[6],m=e[7];e=e[8];var u=f[0],v=f[1],z=f[2],w=f[3],q=f[4],y=f[5],A=f[6],B=f[7];f=f[8];return Math.abs(g-u)<=a.EPSILON*Math.max(1,Math.abs(g),Math.abs(u))&&Math.abs(b-v)<=a.EPSILON*Math.max(1,Math.abs(b),Math.abs(v))&&Math.abs(d-z)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(z))&&Math.abs(c-w)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(k-
q)<=a.EPSILON*Math.max(1,Math.abs(k),Math.abs(q))&&Math.abs(h-y)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(r-A)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(A))&&Math.abs(m-B)<=a.EPSILON*Math.max(1,Math.abs(m),Math.abs(B))&&Math.abs(e-f)<=a.EPSILON*Math.max(1,Math.abs(e),Math.abs(f))};b.mul=m;b.sub=h})},"esri/core/libs/gl-matrix-2/quat":function(){define(["require","exports","./math/quat"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.quat=a})},"esri/core/libs/gl-matrix-2/math/quat":function(){define("require exports ../factories/mat3f64 ../factories/quatf64 ../factories/vec3f64 ./common ./vec3 ./vec4".split(" "),
function(n,b,a,m,h,e,f,g){function l(a,c,d){d*=.5;var e=Math.sin(d);a[0]=e*c[0];a[1]=e*c[1];a[2]=e*c[2];a[3]=Math.cos(d);return a}function d(a,c,d){var e=c[0],f=c[1],g=c[2];c=c[3];var b=d[0],k=d[1],l=d[2];d=d[3];a[0]=e*d+c*b+f*l-g*k;a[1]=f*d+c*k+g*b-e*l;a[2]=g*d+c*l+e*k-f*b;a[3]=c*d-e*b-f*k-g*l;return a}function c(a,c,d,f){var g=c[0],b=c[1],k=c[2];c=c[3];var l=d[0],h=d[1],q=d[2];d=d[3];var p,r,m;r=g*l+b*h+k*q+c*d;0>r&&(r=-r,l=-l,h=-h,q=-q,d=-d);1-r>e.EPSILON?(p=Math.acos(r),m=Math.sin(p),r=Math.sin((1-
f)*p)/m,f=Math.sin(f*p)/m):r=1-f;a[0]=r*g+f*l;a[1]=r*b+f*h;a[2]=r*k+f*q;a[3]=r*c+f*d;return a}function k(a,c){var d=c[0]+c[4]+c[8];if(0<d)d=Math.sqrt(d+1),a[3]=.5*d,d=.5/d,a[0]=(c[5]-c[7])*d,a[1]=(c[6]-c[2])*d,a[2]=(c[1]-c[3])*d;else{var e=0;c[4]>c[0]&&(e=1);c[8]>c[3*e+e]&&(e=2);var f=(e+1)%3,g=(e+2)%3,d=Math.sqrt(c[3*e+e]-c[3*f+f]-c[3*g+g]+1);a[e]=.5*d;d=.5/d;a[3]=(c[3*f+g]-c[3*g+f])*d;a[f]=(c[3*f+e]+c[3*e+f])*d;a[g]=(c[3*g+e]+c[3*e+g])*d}return a}Object.defineProperty(b,"__esModule",{value:!0});
b.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};b.setAxisAngle=l;b.getAxisAngle=function(a,c){var d=2*Math.acos(c[3]),f=Math.sin(d/2);f>e.EPSILON?(a[0]=c[0]/f,a[1]=c[1]/f,a[2]=c[2]/f):(a[0]=1,a[1]=0,a[2]=0);return d};b.multiply=d;b.rotateX=function(a,c,d){d*=.5;var e=c[0],f=c[1],g=c[2];c=c[3];var b=Math.sin(d);d=Math.cos(d);a[0]=e*d+c*b;a[1]=f*d+g*b;a[2]=g*d-f*b;a[3]=c*d-e*b;return a};b.rotateY=function(a,c,d){d*=.5;var e=c[0],f=c[1],g=c[2];c=c[3];var b=Math.sin(d);d=Math.cos(d);a[0]=
e*d-g*b;a[1]=f*d+c*b;a[2]=g*d+e*b;a[3]=c*d-f*b;return a};b.rotateZ=function(a,c,d){d*=.5;var e=c[0],f=c[1],g=c[2];c=c[3];var b=Math.sin(d);d=Math.cos(d);a[0]=e*d+f*b;a[1]=f*d-e*b;a[2]=g*d+c*b;a[3]=c*d-g*b;return a};b.calculateW=function(a,c){var d=c[0],e=c[1];c=c[2];a[0]=d;a[1]=e;a[2]=c;a[3]=Math.sqrt(Math.abs(1-d*d-e*e-c*c));return a};b.slerp=c;b.random=function(a){var c=e.RANDOM(),d=e.RANDOM(),f=e.RANDOM(),g=Math.sqrt(1-c),c=Math.sqrt(c);a[0]=g*Math.sin(2*Math.PI*d);a[1]=g*Math.cos(2*Math.PI*d);
a[2]=c*Math.sin(2*Math.PI*f);a[3]=c*Math.cos(2*Math.PI*f);return a};b.invert=function(a,c){var d=c[0],e=c[1],f=c[2];c=c[3];var g=d*d+e*e+f*f+c*c,g=g?1/g:0;a[0]=-d*g;a[1]=-e*g;a[2]=-f*g;a[3]=c*g;return a};b.conjugate=function(a,c){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];a[3]=c[3];return a};b.fromMat3=k;b.fromEuler=function(a,c,d,e){var f=.5*Math.PI/180;c*=f;d*=f;e*=f;f=Math.sin(c);c=Math.cos(c);var g=Math.sin(d);d=Math.cos(d);var b=Math.sin(e);e=Math.cos(e);a[0]=f*d*e-c*g*b;a[1]=c*g*e+f*d*b;a[2]=c*d*b-f*
g*e;a[3]=c*d*e+f*g*b;return a};b.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};b.copy=g.copy;b.set=g.set;b.add=g.add;b.mul=d;b.scale=g.scale;b.dot=g.dot;b.lerp=g.lerp;b.length=g.length;b.len=b.length;b.squaredLength=g.squaredLength;b.sqrLen=b.squaredLength;b.normalize=g.normalize;b.exactEquals=g.exactEquals;b.equals=g.equals;b.rotationTo=function(a,c,d){var e=f.dot(c,d);if(-.999999>e)return f.cross(p,r,c),1E-6>f.len(p)&&f.cross(p,t,c),f.normalize(p,p),l(a,p,Math.PI),a;if(.999999<
e)return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a;f.cross(p,c,d);a[0]=p[0];a[1]=p[1];a[2]=p[2];a[3]=1+e;return b.normalize(a,a)};var p=h.create(),r=h.fromValues(1,0,0),t=h.fromValues(0,1,0);b.sqlerp=function(a,d,e,f,g,b){c(u,d,g,b);c(v,e,f,b);c(a,u,v,2*b*(1-b));return a};var u=m.create(),v=m.create();b.setAxes=function(a,c,d,e){var f=z;f[0]=d[0];f[3]=d[1];f[6]=d[2];f[1]=e[0];f[4]=e[1];f[7]=e[2];f[2]=-c[0];f[5]=-c[1];f[8]=-c[2];return b.normalize(a,k(a,f))};var z=a.create()})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("require exports tslib ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils ./GeometryRecord ./IdGen ./Object3DStateSet ./Util ../materials/renderers/utils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r){n=function(){function a(c){void 0===c&&(c={});this._objectTransformation=e.mat4f64.create();this._bvObjectSpace=new u;this._bvWorldSpace=new u;this._bvDirty=!0;this._hasVolatileTransformation=!1;this._visible=!0;this.id=a._idGen.gen(c.idHint);this.castShadow=null!=c.castShadow?c.castShadow:!0;(this.metadata=c.metadata)&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new t);this.objectTransformation=e.mat4f64.create();this._initializeGeometryRecords(c.geometries,
c.materials,c.transformations,c.origins)}Object.defineProperty(a.prototype,"geometryRecords",{get:function(){return this._geometryRecords},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"geometries",{get:function(){return this._geometries},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"objectTransformation",{get:function(){return this._objectTransformation},set:function(a){h.mat4.copy(this._objectTransformation,a);this._invalidateBoundingVolume();this._notifyDirty("objTransformation")},
enumerable:!0,configurable:!0});a.prototype.dispose=function(){for(var a=0,c=this._geometryRecords;a<c.length;a++)d.pool.release(c[a]);this._geometries=this._geometryRecords=null};a.prototype._initializeGeometryRecords=function(a,c,f,g){if(Array.isArray(a)){p.assert(c.length===a.length,"Object3D: materials don't match geometries");p.assert(f.length===a.length,"Object3D: transformations don't match geometries");this._geometryRecords=Array(a.length);this._geometries=a.slice();for(var b=0;b<a.length;b++)this._geometryRecords[b]=
d.pool.acquire(a[b],c[b],e.mat4f64.clone(f[b]),{highlights:null,occludees:null,visible:!0},g&&g[b]);this._hasVolatileTransformation=!1}else this._geometryRecords=[],this._geometries=[]};Object.defineProperty(a.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(a){p.assert(null==this._parentLayer||null==a,"Object3D can only be added to a single Layer");this._parentLayer=a},enumerable:!0,configurable:!0});a.prototype.getNumGeometryRecords=function(){return this._geometryRecords.length};
a.prototype.findGeometryRecords=function(a){for(var c=[],d=0;d<this._geometries.length;d++)this._geometries[d]===a&&c.push(this._geometryRecords[d]);return c};a.prototype.getGeometryRecord=function(a){p.assert(0<=a&&a<this._geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range");return this._geometryRecords[a]};a.prototype.addGeometry=function(a,c,f,g,b,k){f=f?f:e.mat4f64.IDENTITY;this._geometries.push(a);a=d.pool.acquire(a,c,f,g||{highlights:null,occludees:null,visible:!0},
b,k);this._geometryRecords.push(a);this._hasVolatileTransformation=this._geometryRecords.some(function(a){return!!a.shaderTransformation});this._notifyDirty("objGeometryAdded",a);this._invalidateBoundingVolume();return a};a.prototype.removeGeometry=function(a){var c=this._geometryRecords.splice(a,1)[0];d.pool.release(c);this._hasVolatileTransformation=this._geometryRecords.some(function(a){return!!a.shaderTransformation});this._geometries.splice(a,1);this._notifyDirty("objGeometryRemoved",c);this._invalidateBoundingVolume();
return c};a.prototype.removeAllGeometries=function(){for(;0<this.getNumGeometryRecords();)this.removeGeometry(0)};a.prototype.geometryVertexAttrsUpdated=function(a){this._notifyDirty("vertexAttrsUpdated",this._geometryRecords[a]);this._invalidateBoundingVolume()};Object.defineProperty(a.prototype,"isVisible",{get:function(){return this._visible},enumerable:!0,configurable:!0});a.prototype.setVisible=function(a){this._visible=a;a=0;for(var c=this._geometryRecords;a<c.length;a++)c[a].instanceParameters.visible=
this._visible;this._notifyDirty("visibilityChanged")};a.prototype.occlude=function(){for(var a=k.generateObject3DStateId(1),c=0,d=this._geometryRecords;c<d.length;c++){var e=d[c];e.instanceParameters.occludees=r.addObject3DStateID(e.instanceParameters.occludees,a)}this._notifyDirty("occlusionChanged");return a};a.prototype.removeOcclude=function(a){for(var c=0,d=this._geometryRecords;c<d.length;c++){var e=d[c];e.instanceParameters.occludees=r.removeObject3DStateID(e.instanceParameters.occludees,a)}this._notifyDirty("occlusionChanged")};
a.prototype.highlight=function(){for(var a=k.generateObject3DStateId(0),c=0,d=this._geometryRecords;c<d.length;c++){var e=d[c];e.instanceParameters.highlights=r.addObject3DStateID(e.instanceParameters.highlights,a)}this._notifyDirty("highlightChanged");return a};a.prototype.removeHighlight=function(a){for(var c=0,d=this._geometryRecords;c<d.length;c++){var e=d[c];e.instanceParameters.highlights=r.removeObject3DStateID(e.instanceParameters.highlights,a)}this._notifyDirty("highlightChanged")};a.prototype.setGeometryTransformation=
function(a,c){p.assert(0<=a&&a<this._geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var f=this._geometryRecords[a];d.pool.release(f);c=d.pool.acquire(f.geometry,f.material,e.mat4f64.clone(c),f.instanceParameters);this._geometryRecords[a]=c;this._notifyDirty("objGeometryReplaced",[f,c]);this._invalidateBoundingVolume()};a.prototype.getCombinedStaticTransformation=function(a,c){return h.mat4.multiply(m.unwrapOr(c,e.mat4f64.create()),this.objectTransformation,a.getStaticTransformation())};
a.prototype.getCombinedShaderTransformation=function(a,c){c=c||e.mat4f64.create();h.mat4.multiply(c,this.objectTransformation,a.getShaderTransformation());return c};a.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation};a.prototype.getBBMin=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin};a.prototype.getBBMax=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax};
a.prototype.getCenter=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.center:this._bvWorldSpace.center};a.prototype.getBSRadius=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius};a.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var a=0;a<this._geometryRecords.length;++a){var c=this._geometries[a],d=this._geometryRecords[a],
c=c.boundingInfo;this._calculateTransformedBoundingVolume(c,this._bvObjectSpace,d.getShaderTransformation());this._calculateTransformedBoundingVolume(c,this._bvWorldSpace,this.getCombinedShaderTransformation(d))}f.vec3.lerp(this._bvObjectSpace.center,this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5);f.vec3.lerp(this._bvWorldSpace.center,this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5);for(var d=g.vec3f64.create(),e=g.vec3f64.create(),b=l.maxScale(this.objectTransformation),a=0;a<this._geometryRecords.length;++a){var c=
this._geometries[a],k=this._geometryRecords[a].getShaderTransformation(),h=l.maxScale(k),c=c.boundingInfo;f.vec3.transformMat4(d,c.getCenter(),k);k=f.vec3.distance(d,this._bvObjectSpace.center);c=c.getBSRadius()*h;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,k+c);f.vec3.transformMat4(e,d,this.objectTransformation);h=f.vec3.distance(e,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,h+c*b)}this._bvDirty=!1}};a.prototype._calculateTransformedBoundingVolume=
function(a,c,d){var e=a.getBBMin();a=a.getBBMax();var b=g.vec3f64.clone(e),k=g.vec3f64.clone(a);f.vec3.transformMat4(b,b,d);f.vec3.transformMat4(k,k,d);for(var l=0;3>l;++l)c.bbMin[l]=Math.min(c.bbMin[l],b[l],k[l]),c.bbMax[l]=Math.max(c.bbMax[l],b[l],k[l]);for(l=0;3>l;++l){f.vec3.copy(b,e);f.vec3.copy(k,a);b[l]=a[l];k[l]=e[l];f.vec3.transformMat4(b,b,d);f.vec3.transformMat4(k,k,d);for(var h=0;3>h;++h)c.bbMin[h]=Math.min(c.bbMin[h],b[h],k[h]),c.bbMax[h]=Math.max(c.bbMax[h],b[h],k[h])}};a.prototype._invalidateBoundingVolume=
function(){this._bvDirty=!0;this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})};a.prototype._notifyDirty=function(a,c,d,e){this._parentLayer&&this._parentLayer.notifyDirty(a,c,d||1,e||this)};Object.defineProperty(a.prototype,"test",{get:function(){var a=this;return{hasGeometry:function(c){return-1<a._geometries.indexOf(c)},getGeometryIndex:function(c){return a._geometries.indexOf(c)}}},enumerable:!0,configurable:!0});
a._idGen=new c.IdGen;return a}();var t=function(){function a(){this.bbMin=g.vec3f64.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.bbMax=g.vec3f64.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}a.prototype.isEmpty=function(){return this.bbMax[0]<this.bbMin[0]&&this.bbMax[1]<this.bbMin[1]&&this.bbMax[2]<this.bbMin[2]};return a}(),u=function(c){function d(){var a=c.call(this)||this;a.center=g.vec3f64.create();a.bsRadius=0;return a}a.__extends(d,c);d.prototype.init=
function(){f.vec3.set(this.bbMin,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);f.vec3.set(this.bbMax,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);f.vec3.set(this.center,0,0,0);this.bsRadius=0};d.prototype.getCenter=function(){return this.center};d.prototype.getBSRadius=function(){return this.bsRadius};return d}(t);return n})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define(["require","exports","../../../../core/ObjectPool","../../../../core/libs/gl-matrix-2/vec3",
"./IdGen"],function(n,b,a,m,h){return function(){function e(){}e.prototype.acquire=function(a,g,b,d,c,k){this.id=e._idGen.gen(a&&a.id);this.geometry=a;this.material=g;this.transformation=b;this.instanceParameters=d;this.origin=c;this.shaderTransformation=k};e.prototype.getStaticTransformation=function(){return this.transformation};e.prototype.getShaderTransformation=function(){return this.shaderTransformation?this.shaderTransformation(this.transformation):this.transformation};e.prototype.computeAttachmentOrigin=
function(a){return(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,a):this.geometry.computeAttachmentOrigin(a))?(m.vec3.transformMat4(a,a,this.getStaticTransformation()),!0):!1};e._idGen=new h.IdGen;e.pool=new a(e);return e}()})},"esri/views/3d/webgl-engine/lib/IdGen":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(){this._count=0}a.prototype.gen=function(a){null==a&&(a="a");return a+
"_"+this._count++};return a}();b.IdGen=n})},"esri/views/3d/webgl-engine/lib/Object3DStateSet":function(){define(["require","exports","./IdGen"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});var m=new a.IdGen;b.generateObject3DStateId=function(a){return{id:m.gen(0===a?"highlight":"occludee"),channel:a}};n=function(){function a(){this.items=[]}a.prototype.addObject=function(a,f){this.items.push({type:0,objectStateId:f,object:a})};a.prototype.addRenderGeometry=function(a,f,g){this.items.push({type:1,
objectStateId:f,renderGeometry:a,owner:g})};a.prototype.addExternal=function(a,f){this.items.push({type:2,objectStateId:f,remove:a})};a.prototype.remove=function(a){for(var e=this.items.length-1;0<=e;--e){var g=this.items[e];g.objectStateId===a&&(this._removeObjectStateItem(g),this.items.splice(e,1))}};a.prototype.removeObject=function(a){for(var e=this.items.length-1;0<=e;--e){var g=this.items[e];0===g.type&&g.object===a&&(this._removeObjectStateItem(g),this.items.splice(e,1))}};a.prototype.removeRenderGeometry=
function(a){for(var e=this.items.length-1;0<=e;--e){var g=this.items[e];1===g.type&&g.renderGeometry===a&&(this._removeObjectStateItem(g),this.items.splice(e,1))}};a.prototype.removeAll=function(){var a=this;this.items.forEach(function(e){a._removeObjectStateItem(e)});this.items=[]};a.prototype._removeObjectStateItem=function(a){switch(a.type){case 0:0===a.objectStateId.channel?a.object.removeHighlight(a.objectStateId):1===a.objectStateId.channel&&a.object.removeOcclude(a.objectStateId);break;case 1:a.owner.removeRenderGeometryObjectState(a.renderGeometry,
a.objectStateId);break;case 2:a.remove(a.objectStateId)}};return a}();b.Object3DStateSet=n})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define("require exports ../../../../../core/maybe ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../lib/doublePrecisionUtils ../../lib/Util".split(" "),function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});b.addObject3DStateID=function(c,d){a.isNone(c)&&
(c=[]);c.push(d);return c};b.removeObject3DStateID=function(c,d){if(a.isNone(c))return c;c=c.filter(function(a){return a!==d});return 0===c.length?null:c};b.isInstanceHidden=function(a){return m.isSome(a)?!a.visible:!1};b.acquireMaterials=function(a,c){var d=new Map;d.set(0,c.acquire(a,0));d.set(3,c.acquire(a,3));d.set(2,c.acquire(a,2));d.set(1,c.acquire(a,1));d.set(4,c.acquire(a,4));return d};b.releaseMaterials=function(a,c){c.release(a,0);c.release(a,3);c.release(a,2);c.release(a,1);c.release(a,
4)};b.calculateTransformRelToOrigin=function(a,d,e){var f=a.origin.vec3;g.setMatrixTranslation3(c,-f[0],-f[1],-f[2]);m.isSome(a.transformation)?h.mat4.multiply(d,c,a.transformation):h.mat4.copy(d,c);e&&(h.mat4.invert(e,d),h.mat4.transpose(e,e))};b.encodeDoubleVec3=function(a,c,e,g,b){l[0]=a.get(c,0);l[1]=a.get(c,1);l[2]=a.get(c,2);f.encodeDoubleArray(l,d,3);e.set(b,0,d[0]);g.set(b,0,d[1]);e.set(b,1,d[2]);g.set(b,1,d[3]);e.set(b,2,d[4]);g.set(b,2,d[5])};var l=new Float64Array(3),d=new Float32Array(6),
c=e.mat4f64.create()})},"esri/views/3d/webgl-engine/lib/doublePrecisionUtils":function(){define(["require","exports"],function(n,b){function a(a,f,g){for(var e=0;e<g;++e)f[2*e]=a[e],f[2*e+1]=a[e]-f[2*e]}Object.defineProperty(b,"__esModule",{value:!0});b.encodeDouble=function(a,f){h[0]=a;h[1]=a-h[0];f[0]=h[0];f[1]=h[1]};b.encodeDoubleArray=a;b.decodeDoubleArray=function(a,f,g){for(var e=0;e<g;++e)f[e]=a[2*e]+a[2*e+1]};b.encodeDoubleArraySplit=function(e,f,g,b){for(var d=0;d<b;++d)m[0]=e[d],a(m,h,1),
f[d]=h[0],g[d]=h[1]};var m=new Float64Array(1),h=new Float32Array(2)})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("require exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../state/utils/viewUtils ../../support/earthUtils ../../support/geometryUtils".split(" "),function(n,b,a,m,h,e,f,g,l,d,
c,k){function p(c,d,e,b){void 0===e&&(e=l.defaultApplyOptions);void 0===b&&(b=!0);B.eyeCenterDistance=0;B.requiresTwoSteps=!1;var g=r(c,d,e,void 0,B);if(0===g)return!1;h.mat4.identity(z);h.mat4.rotate(z,z,-g,d.viewRight);switch(e.tiltMode){case 1:f.vec3.transformMat4(v,d.viewForward,z);f.vec3.scale(v,v,B.eyeCenterDistance);f.vec3.add(d.center,d.eye,v);break;case 0:f.vec3.subtract(v,d.center,d.eye);f.vec3.transformMat4(v,v,z);f.vec3.subtract(d.eye,d.center,v);break;default:a.neverReached(e.tiltMode)}f.vec3.transformMat4(d.up,
d.up,z);d.markViewDirty();return B.requiresTwoSteps&&b?p(c,d,e,!1):!0}function r(e,b,g,h,p){void 0===g&&(g=l.defaultApplyOptions);void 0===h&&(h=l.defaultApplyOptions);if(!e.state.constraints.tilt)return 0;var v=e.state.constraints.tilt(b.distance,y);var z=g;if(0!==z.interactionType){var B=z.interactionStartCamera,C=z.interactionFactor,H=v.min,F=v.max,I=r(e,B,l.defaultApplyOptions,z),G=0===I?0:d.viewAngle(e.renderCoordsHelper,B.center,B.eye);v.min=H;v.max=F;2===z.interactionType?(l.hasConstraintType(z.selection,
2)&&u(e,B,v),l.adjustRangeForInteraction(I,G,!0,C,q,v)):l.adjustRangeForInteraction(I,G,!1,C,q,v)}2===h.interactionType&&l.hasConstraintType(h.selection,2)&&u(e,h.interactionStartCamera,v);if(1===g.tiltMode||1===h.tiltMode){a:switch(p&&(p.requiresTwoSteps=!1),e.viewingMode){case "global":g=A;z=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;h=z+c.earthRadius;z=e.renderCoordsHelper.intersectManifold(b.ray,z,w);g.eyeCenterDistance=b.distance;z?(g.eyeCenterDistance=f.vec3.distance(b.eye,
w),g.tiltAtCenter=d.viewAngle(e.renderCoordsHelper,w,b.eye)):e.state.isLocal?g.tiltAtCenter=d.viewAngle(e.renderCoordsHelper,b.center,b.eye):(k.sphere.closestPointOnSilhouette(k.sphere.wrap(h),b.ray,w),g.eyeCenterDistance=f.vec3.distance(b.eye,w),g.tiltAtCenter=m.acosClamped(-f.vec3.dot(b.viewForward,f.vec3.normalize(w,w))));g.radius=h;g.eyeRadius=f.vec3.length(b.eye);g.constraints=e.state.constraints;g.centerIsOnSurface=z;b=m.clamp(g.tiltAtCenter,v.min,v.max);if(1E-9<Math.abs(g.tiltAtCenter-b)){if(g.centerIsOnSurface){b=
g.constraints;e=h=g.tiltAtCenter;v=b.clampTilt(g.eyeCenterDistance,h);z=t(g,v);if(b.clampTilt(z,h)!==v)for(h=0;10>h&&1E-9<Math.abs(v-e);)z=(e+v)/2,B=t(g,z),B=b.clampTilt(B,z),1E-9<Math.abs(B-z)?e=z:v=z,h++;b=v;v=b;e=m.asinClamped(g.radius/g.eyeRadius*Math.sin(g.tiltAtCenter));v=m.asinClamped(g.radius/g.eyeRadius*Math.sin(v));e=g.eyeRadius>g.radius?e-v:v-e}else b=g.constraints.clampTilt(g.eyeCenterDistance,g.tiltAtCenter),p&&b<Math.PI/2&&(p.requiresTwoSteps=!0,b=Math.PI/2-1E-5),e=g.tiltAtCenter-Math.PI/
2-(b-Math.PI/2);p&&(p.eyeCenterDistance=t(g,b));p=e}else p=0;break a;case "local":h=d.viewAngle(e.renderCoordsHelper,b.center,b.eye);g=m.clamp(h,v.min,v.max);v=h-g;1E-9<Math.abs(v)?(p&&(h=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,e=e.renderCoordsHelper.getAltitude(b.eye)-h,g=Math.cos(g),p.eyeCenterDistance=1E-4<Math.abs(g)?e/g:b.distance),p=v):p=0;break a;default:a.neverReached(e.viewingMode),p=void 0}return p}p=d.viewAngle(e.renderCoordsHelper,b.center,b.eye);b=m.clamp(p,
v.min,v.max);p-=b;p=1E-9<Math.abs(p)?p:0;return p}function t(a,c){if(!a.centerIsOnSurface)return a.eyeCenterDistance;c=Math.PI-m.clamp(c,0,Math.PI);var d=m.asinClamped(a.radius/a.eyeRadius*Math.sin(c)),e=Math.sin(Math.PI-c-d)/Math.sin(c);return a.eyeRadius<a.radius&&1<e?Math.sin(Math.PI-c-(Math.PI-d))/Math.sin(c)*a.eyeRadius:e*a.eyeRadius}function u(a,d,e){if(!a.state.isLocal){var g=a.state.constraints;if(g.altitude){a=f.vec3.squaredLength(d.center);var b=Math.sqrt(a);d=d.distance;var k=g.altitude.min+
c.earthRadius,g=g.altitude.max+c.earthRadius,k=(k*k-d*d-a)/(-2*b*d);e.min=Math.max(e.min,Math.min(Math.PI-m.acosClamped((g*g-d*d-a)/(-2*b*d)),e.max));e.max=Math.min(e.max,Math.PI-m.acosClamped(k))}}}Object.defineProperty(b,"__esModule",{value:!0});b.applyTiltConstraint=p;b.getTiltConstraintError=r;var v=g.vec3f64.create(),z=e.mat4f64.create(),w=g.vec3f64.create(),q=m.deg2rad(5),y={min:0,max:0},A={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},B={eyeCenterDistance:0,
requiresTwoSteps:!1}})},"esri/views/3d/state/utils/viewUtils":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.viewAngle=function(g,b,d){g.worldUpAtPosition(b,e);m.vec3.subtract(f,d,b);g=m.vec3.length(f);return 0===g?0:a.acosClamped(m.vec3.dot(f,e)/g)};var e=h.vec3f64.create(),f=h.vec3f64.create()})},"esri/views/animation/easing":function(){define(["require",
"exports"],function(n,b){function a(a){return a}function m(a){var e=2*(a-Math.sqrt((a-1)*a)),g=e/2/a;return function(f){return f<g?a*f*f:e*f-e+1}}function h(a,f){return function(e){return e<f?f*a(e/f):1-a((1-e)/(1-f))*(1-f)}}Object.defineProperty(b,"__esModule",{value:!0});b.linear=a;b.inQuad=function(a){return a*a};b.outQuad=function(a){return 1-b.inQuad(1-a)};b.inOutQuad=function(a){return.5>a?b.inQuad(2*a)/2:(b.outQuad(2*(a-.5))+1)/2};b.inCubic=function(a){return a*a*a};b.outCubic=function(a){return 1-
b.inCubic(1-a)};b.inOutCubic=function(a){return.5>a?b.inCubic(2*a)/2:(b.outCubic(2*(a-.5))+1)/2};b.inQuart=function(a){return a*a*a*a};b.outQuart=function(a){return 1-b.inQuart(1-a)};b.inOutQuart=function(a){return.5>a?b.inQuart(2*a)/2:(b.outQuart(2*(a-.5))+1)/2};b.inQuint=function(a){return a*a*a*a*a};b.outQuint=function(a){return 1-b.inQuint(1-a)};b.inOutQuint=function(a){return.5>a?b.inQuint(2*a)/2:(b.outQuint(2*(a-.5))+1)/2};b.inSine=function(a){return-Math.cos(a*Math.PI/2)+1};b.outSine=function(a){return 1-
b.inSine(1-a)};b.inOutSine=function(a){return.5>a?b.inSine(2*a)/2:(b.outSine(2*(a-.5))+1)/2};b.inExpo=function(a){return Math.pow(2,10*(a-1))};b.outExpo=function(a){return 1-b.inExpo(1-a)};b.inOutExpo=function(a){return.5>a?b.inExpo(2*a)/2:(b.outExpo(2*(a-.5))+1)/2};b.inCirc=function(a){return-(Math.sqrt(1-a*a)-1)};b.outCirc=function(a){return 1-b.inCirc(1-a)};b.inOutCirc=function(a){return.5>a?b.inCirc(2*a)/2:(b.outCirc(2*(a-.5))+1)/2};b.inCoastQuad=h(m(1),1);b.outCoastQuad=h(m(1),0);b.inOutCoastQuad=
h(m(1),.5);b.inCoastCubic=h(m(2),1);b.outCoastCubic=h(m(2),0);b.inOutCoastCubic=h(m(2),.5);b.inCoastQuart=h(m(3),1);b.outCoastQuart=h(m(3),0);b.inOutCoastQuart=h(m(3),.5);b.inCoastQuint=h(m(4),1);b.outCoastQuint=h(m(4),0);b.inOutCoastQuint=h(m(4),.5);b.named={linear:a,"in-quad":b.inQuad,"out-quad":b.outQuad,"in-out-quad":b.inOutQuad,"in-coast-quad":b.inCoastQuad,"out-coast-quad":b.outCoastQuad,"in-out-coast-quad":b.inOutCoastQuad,"in-cubic":b.inCubic,"out-cubic":b.outCubic,"in-out-cubic":b.inOutCubic,
"in-coast-cubic":b.inCoastCubic,"out-coast-cubic":b.outCoastCubic,"in-out-coast-cubic":b.inOutCoastCubic,"in-quart":b.inQuart,"out-quart":b.outQuart,"in-out-quart":b.inOutQuart,"in-coast-quart":b.inCoastQuart,"out-coast-quart":b.outCoastQuart,"in-out-coast-quart":b.inOutCoastQuart,"in-quint":b.inQuint,"out-quint":b.outQuint,"in-out-quint":b.inOutQuint,"in-coast-quint":b.inCoastQuint,"out-coast-quint":b.outCoastQuint,"in-out-coast-quint":b.inOutCoastQuint,"in-sine":b.inSine,"out-sine":b.outSine,"in-out-sine":b.inOutSine,
"in-expo":b.inExpo,"out-expo":b.outExpo,"in-out-expo":b.inOutExpo,"in-circ":b.inCirc,"out-circ":b.outCirc,"in-out-circ":b.inOutCirc}})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("require exports tslib ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../ViewAnimation ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Intersector".split(" "),function(n,
b,a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(g){function b(a){a=g.call(this,a)||this;a.view=null;a.mode="interaction";a.hasTarget=!1;return a}a.__extends(b,g);Object.defineProperty(b.prototype,"intersectionHelper",{get:function(){return this.view.sceneIntersectionHelper},enumerable:!0,configurable:!0});b.prototype.initialize=function(){this.animation=new f.default(this.view.state.mode);this.viewAnimation="interaction"===this.mode?null:new e};Object.defineProperty(b.prototype,
"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});b.prototype.begin=function(a,e){this.hasTarget=!0;e=this.animationSettings(e);c.copyFrom(this.view.state.camera);var f=new d.Intersector(this.view.state.mode);this.intersectionHelper.intersectRay(c.ray,f,k)&&(c.center=k);this.animation.update(c,a,e);this.animation.finished&&this.finish()};b.prototype.finish=function(){this.animation.currentTime=this.animation.time;g.prototype.finish.call(this)};Object.defineProperty(b.prototype,
"steppingFinished",{get:function(){return this.hasTarget&&this.animation.finished},enumerable:!0,configurable:!0});b.prototype.stepController=function(a,c){this.hasTarget&&this.animation.step(a,c)};b.prototype.onControllerEnd=function(a){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,a),this.animation.currentTime=this.animation.time);g.prototype.onControllerEnd.call(this,a)};b.prototype.animationSettings=function(a){void 0===a&&(a={});return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(Infinity)/
6,ascensionFactor:void 0,descensionFactor:void 0},speedFactor:a.speedFactor,duration:a.duration,maxDuration:a.maxDuration,easing:a.easing}};a.__decorate([m.property({constructOnly:!0})],b.prototype,"view",void 0);a.__decorate([m.property({constructOnly:!0})],b.prototype,"mode",void 0);return b=a.__decorate([m.subclass("esri.views.3d.state.controllers.PointToPointAnimationController")],b)}(g.AnimationController);b.PointToPointAnimationController=n;var c=new l.default,k=h.vec3f64.create()})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),
function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});var g=m.vec3f64.create();n=function(){function b(a){this.currentTime=0;this.animation=new f.Animation(function(){return new h.default(a)});this._current=new h.default(a)}Object.defineProperty(b.prototype,"finished",{get:function(){return this.currentTime>=this.animation.time},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"time",{get:function(){return this.animation.time},enumerable:!0,configurable:!0});b.prototype.update=
function(d,c,e){var f=this.animation.definition.source,b=this.animation.definition.target,k=a.vec3.subtract(g,c.center,d.center),l=a.vec3.length(k);1E-5<=l?(k[0]/=l,k[1]/=l,k[2]/=l):(k[0]=0,k[1]=1,k[0]=0);a.vec3.copy(f.lookAtDirection,k);a.vec3.copy(b.lookAtDirection,k);f.copyFromRenderCamera(d);b.copyFromRenderCamera(c);this._current.copyFrom(f);this.animation.update(f,b,e);this.currentTime=0;d.almostEquals(c)&&(this.currentTime=this.animation.time)};b.prototype.cameraAt=function(a,c){this.animation.cameraAt(a,
this._current);c=c||new e.default;this._current.copyToRenderCamera(c);return c};b.prototype.step=function(a,c){this.finished||(this.currentTime+=a,this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,c)};return b}();b.Animation=n;b.default=n})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils".split(" "),
function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});var l=f.vec3f64.create(),d=f.vec3f64.create(),c=f.vec3f64.create(),k=f.vec3f64.create(),p=f.vec3f64.create(),r=f.vec3f64.create(),t=f.vec3f64.fromValues(0,0,1),u=f.vec3f64.fromValues(0,1,0),v=f.vec3f64.fromValues(1,0,0),z=h.mat3f64.create();n=function(){function b(a){void 0===a&&(a="global");this.viewingMode=a;this.center=f.vec3f64.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=f.vec3f64.clone(u)}b.prototype.pixelsPerPanAtZoom=
function(a){return this.size/2/(this._zoomToPanScale*a)};b.prototype.zoomAtPixelsPerPan=function(a){return this.size/2/(this._zoomToPanScale*a)};b.prototype.pixelsPerRotateAtZoom=function(){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};b.prototype.compareTo=function(a,c){c||(c={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if("global"===this.viewingMode){var d=e.vec3.length(this.center),f=e.vec3.length(a.center),d=(d+f)/2;c.pan=g.angle(this.center,a.center)*d}else c.pan=e.vec3.distance(this.center,
a.center);d=Math.abs(a.yaw-this.yaw);d>=Math.PI&&(d=2*Math.PI-d);c.rotate=Math.max(d,Math.abs(a.pitch-this.pitch));c.sourceZoom=this.distance;c.targetZoom=a.distance;return c};b.prototype.interpolate=function(c,d,f){"global"===this.viewingMode?g.slerp(c.center,d.center,f.pan,this.center):e.vec3.lerp(this.center,c.center,d.center,f.pan);this.distance=a.lerp(c.distance,d.distance,f.zoom);this.pitch=a.lerp(c.pitch,d.pitch,f.rotate);c=c.yaw;d=d.yaw;Math.abs(d-c)>=Math.PI&&(c+=2*(c<d?1:-1)*Math.PI);this.yaw=
a.lerp(c,d,f.rotate)};b.prototype.copyFrom=function(a){e.vec3.copy(this.center,a.center);this.pitch=a.pitch;this.yaw=a.yaw;this.distance=a.distance;e.vec3.copy(this.lookAtDirection,a.lookAtDirection);this.size=a.size;this.copyFromCommon(a);this.viewingMode=a.viewingMode};b.prototype.copyFromRenderCamera=function(a){var c=this._lookAtOrientation(a.center,z);e.vec3.copy(this.center,a.center);e.vec3.subtract(k,a.center,a.eye);e.vec3.transformMat3(k,k,c);e.vec3.transformMat3(p,a.up,c);this.distance=e.vec3.length(k);
k[0]/=this.distance;k[1]/=this.distance;k[2]/=this.distance;this.pitch=this._eyeUpToPitch(k);this.yaw=this._eyeUpToYaw(k,p);this.size=Math.sqrt(a.width*a.width+a.height*a.height);this.copyFromCommon(a)};b.prototype.copyFromCommon=function(a){this.fov=a.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};b.prototype.copyToRenderCamera=function(a){var c=this._lookAtOrientation(this.center,z);m.mat3.transpose(c,c);this._axisAngleVec3(v,this.pitch-Math.PI/2,u,k);this._axisAngleVec3(t,this.yaw,k);this._axisAngleVec3(v,
this.pitch-Math.PI/2,t,p);this._axisAngleVec3(t,this.yaw,p);e.vec3.scale(k,k,this.distance);e.vec3.transformMat3(k,k,c);e.vec3.transformMat3(p,p,c);a.center=this.center;a.eye=e.vec3.subtract(k,this.center,k);a.up=p};b.prototype._axisAngleVec3=function(a,f,b,g){void 0===g&&(g=b);var k=Math.cos(f);f=Math.sin(f);e.vec3.scale(l,b,k);e.vec3.cross(d,a,b);e.vec3.scale(d,d,f);e.vec3.scale(c,a,(1-k)*e.vec3.dot(a,b));return e.vec3.add(g,e.vec3.add(g,l,d),c)};b.prototype._lookAtOrientation=function(a,f){this._upAtLookAt(a,
c);e.vec3.cross(l,this.lookAtDirection,c);e.vec3.normalize(l,l);0===l[0]&&0===l[1]&&0===l[2]&&e.vec3.copy(l,v);e.vec3.cross(d,c,l);e.vec3.normalize(d,d);f||(f=h.mat3f64.create());f[0]=l[0];f[1]=d[0];f[2]=c[0];f[3]=l[1];f[4]=d[1];f[5]=c[1];f[6]=l[2];f[7]=d[2];f[8]=c[2];return f};b.prototype._upAtLookAt=function(a,c){return"local"===this.viewingMode?e.vec3.copy(c,t):e.vec3.normalize(c,a)};b.prototype._eyeUpToPitch=function(a){return Math.PI-g.angle(t,a)};b.prototype._eyeUpToYaw=function(a,c){.5>Math.abs(c[2])?
(e.vec3.copy(r,c),0<a[2]&&e.vec3.scale(r,r,-1)):e.vec3.copy(r,a);e.vec3.cross(d,r,t);e.vec3.normalize(d,d);return g.angle(v,d,t)};return b}();b.default=n})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("require exports ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/mathUtils ../../support/geometryUtils/vector ./Util".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,f,b){void 0===a&&(a=g.vec3f64.create());void 0===f&&(f=g.vec3f64.create());void 0===b&&(b=g.vec3f64.fromValues(0,0,1));this._viewUp=g.vec3f64.create();this._viewForward=g.vec3f64.create();this._viewRight=g.vec3f64.create();this._ray=c.ray.createWrapper();this._viewport=d.vec4f64.fromValues(0,0,1,1);this._padding=d.vec4f64.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._near=1;this._far=
1E3;this._viewDirty=!0;this._viewMatrix=e.mat4f64.create();this._projectionDirty=!0;this._projectionMatrix=e.mat4f64.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=e.mat4f64.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=e.mat4f64.create();this._frustumDirty=!0;this._frustum=c.frustum.create();this._fullViewport=null;this.pixelRatio=1;this.relativeElevation=0;this._eye=g.vec3f64.clone(a);this._center=g.vec3f64.clone(f);this._up=g.vec3f64.clone(b);
this._padding=d.vec4f64.create()}Object.defineProperty(b.prototype,"eye",{get:function(){return this._eye},set:function(a){this._compareAndSetView(a,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"center",{get:function(){return this._center},set:function(a){this._compareAndSetView(a,this._center)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"ray",{get:function(){this._ray.origin=this.eye;this._ray.direction||(this._ray.direction=g.vec3f64.create());
f.vec3.subtract(this._ray.direction,this.center,this.eye);return this._ray},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"up",{get:function(){return this._up},set:function(a){this._compareAndSetView(a,this._up)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewMatrix",{get:function(){this._ensureViewClean();return this._viewMatrix},set:function(a){h.mat4.copy(this._viewMatrix,a);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=
!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewForward",{get:function(){this._ensureViewClean();return this._viewForward},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewUp",{get:function(){this._ensureViewClean();return this._viewUp},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewRight",{get:function(){this._ensureViewClean();return this._viewRight},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"near",
{get:function(){return this._near},set:function(a){this._near!==a&&(this._near=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"far",{get:function(){return this._far},set:function(a){this._far!==a&&(this._far=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewport",{get:function(){return this._viewport},set:function(a){this.x=
a[0];this.y=a[1];this.width=a[2];this.height=a[3]},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"x",{get:function(){return this._viewport[0]},set:function(a){a+=this._padding[3];this._viewport[0]!==a&&(this._viewport[0]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"y",{get:function(){return this._viewport[1]},set:function(a){a+=this._padding[2];this._viewport[1]!==a&&(this._viewport[1]=
a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"width",{get:function(){return this._viewport[2]},set:function(a){this._viewport[2]!==a&&(this._viewport[2]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this._viewport[3]},set:function(a){this._viewport[3]!==a&&(this._viewport[3]=a,this._frustumDirty=
this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(a){this.width=a-(this._padding[1]+this._padding[3])},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(a){this.height=a-(this._padding[0]+this._padding[2])},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"fullViewport",{get:function(){this._fullViewport||(this._fullViewport=d.vec4f64.create());this._fullViewport[0]=this._viewport[0]-this._padding[3];this._fullViewport[1]=this._viewport[1]-this._padding[2];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"padding",{get:function(){return this._padding},set:function(a){if(this._padding[0]!==a[0]||this._padding[1]!==a[1]||this._padding[2]!==a[2]||this._padding[3]!==a[3])this._viewport[0]+=a[3]-this._padding[3],this._viewport[1]+=a[2]-this._padding[2],this._viewport[2]-=a[1]+a[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=a[0]+a[2]-(this._padding[0]+this._padding[2]),l.vec4.copy(this._padding,a),this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=
!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewProjectionMatrix",{get:function(){this._viewProjectionDirty&&(h.mat4.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var a=this.width,c=this.height,d=this.near*Math.tan(this.fovY/2),e=d*this.aspect;h.mat4.frustum(this._projectionMatrix,
-e*(1+2*this._padding[3]/a),e*(1+2*this._padding[1]/a),-d*(1+2*this._padding[2]/c),d*(1+2*this._padding[0]/c),this.near,this.far);this._projectionDirty=!1}return this._projectionMatrix},set:function(a){h.mat4.copy(this._projectionMatrix,a);this._projectionDirty=!1;this._frustumDirty=this._viewProjectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fov",{get:function(){return this._fov},set:function(a){this._fov=a;this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=
!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fovX",{get:function(){return r.fovd2fovx(this._fov,this.width,this.height)},set:function(a){this._fov=r.fovx2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fovY",{get:function(){return r.fovd2fovy(this._fov,this.width,this.height)},set:function(a){this._fov=r.fovy2fovd(a,this.width,this.height);this._frustumDirty=
this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"distance",{get:function(){return f.vec3.distance(this._center,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"frustum",{get:function(){this._recomputeFrustum();return this._frustum},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewInverseTransposeMatrix",{get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)this._viewInverseTransposeMatrix||
(this._viewInverseTransposeMatrix=e.mat4f64.create()),h.mat4.invert(this._viewInverseTransposeMatrix,this.viewMatrix),h.mat4.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0});b.prototype.depthNDCToWorld=function(a){return 2*this.near*this.far/(this.far+this.near-(2*a-1)*(this.far-this.near))};Object.defineProperty(b.prototype,"perRenderPixelRatio",{get:function(){return Math.tan(this.fovX/
2)/(this.width/2)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"perScreenPixelRatio",{get:function(){return this.perRenderPixelRatio*this.pixelRatio},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"aboveGround",{get:function(){return 0<=this.relativeElevation},enumerable:!0,configurable:!0});b.prototype.copyFrom=function(a){f.vec3.copy(this._eye,a._eye);f.vec3.copy(this._center,a._center);f.vec3.copy(this._up,a._up);l.vec4.copy(this._viewport,a._viewport);
l.vec4.copy(this._padding,a._padding);this._near=a._near;this._far=a._far;this._fov=a._fov;this.relativeElevation=a.relativeElevation;this._viewDirty=a._viewDirty;this._viewDirty||(h.mat4.copy(this._viewMatrix,a._viewMatrix),f.vec3.copy(this._viewRight,a._viewRight),f.vec3.copy(this._viewUp,a._viewUp),f.vec3.copy(this._viewForward,a._viewForward));a._projectionDirty?this._projectionDirty=!0:(h.mat4.copy(this._projectionMatrix,a._projectionMatrix),this._projectionDirty=!1);this._viewProjectionDirty=
!0;this._frustumDirty=a._frustumDirty;this._frustumDirty||(c.frustum.copy(a._frustum,this._frustum),this._frustumDirty=!1);a._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?h.mat4.copy(this._viewInverseTransposeMatrix,a._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=e.mat4f64.clone(a._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);a._fullViewport?this._fullViewport?l.vec4.copy(this._fullViewport,a._fullViewport):
this._fullViewport=d.vec4f64.clone(a._fullViewport):this._fullViewport=null;this.pixelRatio=a.pixelRatio;return this};b.prototype.copyViewFrom=function(a){this.eye=a.eye;this.center=a.center;this.up=a.up};b.prototype.clone=function(){var a=new b;a.copyFrom(this);return a};b.prototype.equals=function(a){return f.vec3.exactEquals(this._eye,a._eye)&&f.vec3.exactEquals(this._center,a._center)&&f.vec3.exactEquals(this._up,a._up)&&l.vec4.exactEquals(this._viewport,a._viewport)&&l.vec4.exactEquals(this._padding,
a._padding)&&this._near===a._near&&this._far===a._far&&this._fov===a._fov&&this.pixelRatio===a.pixelRatio&&this.relativeElevation===a.relativeElevation};b.prototype.almostEquals=function(a){if(this.pixelRatio!==a.pixelRatio||.001<=Math.abs(a._fov-this._fov))return!1;var c=1-1E-10;f.vec3.sub(v,a._eye,a._center);f.vec3.sub(z,this._eye,this._center);var d=f.vec3.dot(v,z),e=f.vec3.sqrLen(v),b=f.vec3.sqrLen(z);return d*d>=c*e*b&&f.vec3.sqrDist(a._eye,this._eye)<2.5E-7*Math.max(e,b)&&.5>l.vec4.squaredDistance(a._padding,
this._padding)&&.5>l.vec4.squaredDistance(a._viewport,this._viewport)};b.prototype.markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};b.prototype.computeRenderPixelSizeAt=function(a){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(a))};b.prototype.computeRenderPixelSizeAtDist=function(a){return a*this.perRenderPixelRatio};b.prototype.computeScreenPixelSizeAt=function(a){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(a))};
b.prototype.viewDirectionDistance=function(a){return Math.abs(p.projectPointSignedLength(this.viewForward,f.vec3.subtract(v,a,this._eye)))};b.prototype.computeScreenPixelSizeAtDist=function(a){return a*this.perScreenPixelRatio};b.prototype.computeDistanceFromRadius=function(a,c){return a/Math.tan(Math.min(this.fovX,this.fovY)/(2*(c||1)))};b.prototype.getScreenCenter=function(a){void 0===a&&(a=m.createScreenPointArray());a[0]=(this.padding[3]+this.width/2)/this.pixelRatio;a[1]=(this.padding[0]+this.height/
2)/this.pixelRatio;return a};b.prototype.getRenderCenter=function(a,c,d){void 0===c&&(c=.5);void 0===d&&(d=.5);a||(a=m.createRenderScreenPointArray3());a[0]=this.padding[3]+this.width*c;a[1]=this.padding[2]+this.height*d;2<a.length&&(a[2]=.5);return a};b.prototype.setGLViewport=function(a){var c=this.viewport,d=this.padding;a.setViewport(c[0]-d[3],c[1]-d[2],c[2]+d[1]+d[3],c[3]+d[0]+d[2])};b.prototype.applyProjection=function(c,d,e){void 0===e&&(e=!1);c!==t&&f.vec3.copy(t,c);t[3]=1;e&&(d[2]=-t[2]);
l.vec4.transformMat4(t,t,this.projectionMatrix);f.vec3.scale(t,t,1/Math.abs(t[3]));c=this.fullViewport;d[0]=a.lerp(0,c[0]+c[2],.5+.5*t[0]);d[1]=a.lerp(0,c[1]+c[3],.5+.5*t[1]);e||(d[2]=.5*(t[2]+1));return d};b.prototype.projectPoint=function(c,d){t[0]=c[0];t[1]=c[1];t[2]=c[2];t[3]=1;l.vec4.transformMat4(t,t,this.viewProjectionMatrix);if(0===t[3])return null;f.vec3.scale(t,t,1/Math.abs(t[3]));c=this.fullViewport;"x"in d?(d.x=a.lerp(0,c[0]+c[2],.5+.5*t[0]),d.y=a.lerp(0,c[1]+c[3],.5+.5*t[1])):(d[0]=a.lerp(0,
c[0]+c[2],.5+.5*t[0]),d[1]=a.lerp(0,c[1]+c[3],.5+.5*t[1]),2<d.length&&(d[2]=.5*(t[2]+1)));return d};b.prototype.unprojectPoint=function(a,c){h.mat4.multiply(u,this.projectionMatrix,this.viewMatrix);if(!h.mat4.invert(u,u))return null;var d=this.fullViewport;t[0]=2*(a[0]-d[0])/d[2]-1;t[1]=2*(a[1]-d[1])/d[3]-1;t[2]=2*a[2]-1;t[3]=1;l.vec4.transformMat4(t,t,u);if(0===t[3])return null;c[0]=t[0]/t[3];c[1]=t[1]/t[3];c[2]=t[2]/t[3];return c};b.prototype.computeUp=function(a){"global"===a?this.computeUpGlobal():
this.computeUpLocal()};b.prototype.screenToRender=function(a,c){var d=this.fullHeight-a[1]*this.pixelRatio;c[0]=a[0]*this.pixelRatio;c[1]=d;return c};b.prototype.renderToScreen=function(a,c){var d=(this.fullHeight-a[1])/this.pixelRatio;c[0]=a[0]/this.pixelRatio;c[1]=d;return c};b.prototype.computeUpGlobal=function(){f.vec3.subtract(v,this.center,this.eye);var a=f.vec3.length(this.center);1>a?(f.vec3.set(this.up,0,0,1),this.markViewDirty()):Math.abs(f.vec3.dot(v,this.center))>.9999*f.vec3.length(v)*
a||(f.vec3.cross(this.up,v,this.center),f.vec3.cross(this.up,this.up,v),f.vec3.normalize(this.up,this.up),this.markViewDirty())};b.prototype.computeUpLocal=function(){k.directionFromTo(v,this.eye,this.center);.9999>=Math.abs(v[2])&&(f.vec3.scale(v,v,v[2]),f.vec3.set(this.up,-v[0],-v[1],1-v[2]),f.vec3.normalize(this.up,this.up),this.markViewDirty())};b.prototype._compareAndSetView=function(a,c){f.vec3.exactEquals(a,c)||(f.vec3.copy(c,a),this._viewProjectionDirty=this._frustumDirty=this._viewDirty=
!0)};b.prototype._recomputeFrustum=function(){this._frustumDirty&&(c.frustum.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};b.prototype._ensureViewClean=function(){this._viewDirty&&(h.mat4.lookAt(this._viewMatrix,this._eye,this._center,this._up),f.vec3.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),f.vec3.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),f.vec3.set(this._viewRight,this._viewMatrix[0],
this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};return b}();b.default=n;var t=d.vec4f64.create(),u=e.mat4f64.create(),v=g.vec3f64.create(),z=g.vec3f64.create()})},"esri/views/animation/pointToPoint/Animation":function(){define("require exports ../easing ./Definition ./Settings ./apex/Path".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});var f={zoom:0,pan:0,rotate:0};n=function(){function b(a){this.createCamera=
a;this.time=0;this.definition=new m.Definition(a);this.path=new e.Path}b.prototype.update=function(a,d,c){this.definition.update(a,d,c);this.path.update(this.definition,c);this.time=this._applyTimeSettings(this.path.time,c);this.settings=c};b.prototype.cameraAt=function(e,d){d=d||this.createCamera();e=Math.min(Math.max(0,e),1);e=this.settings.easing?this.normalizedEasing(this.settings.easing,e):1<=this.time?this.normalizedEasing(a.inOutCoastQuad,e):this.normalizedEasing(a.outExpo,e);e=this.path.interpolateComponentsAt(e,
f);d.interpolate(this.definition.source,this.definition.target,e);return d};b.prototype.normalizedEasing=function(a,d){var c=a(0),e=a(1);return(a(d)-c)/(e-c)};b.prototype._applyTimeSettings=function(a,d){var c=null!=d.speedFactor?d.speedFactor:1;null!=d.duration?a=d.duration:null!=d.speedFactor&&(a/=c);return a=Math.min(Math.max(null!=d.minDuration?d.minDuration:h.defaultSettings.minDuration/c,a),null!=d.maxDuration?d.maxDuration:h.defaultSettings.maxDuration/c)};return b}();b.Animation=n;b.default=
n})},"esri/views/animation/pointToPoint/Definition":function(){define(["require","exports","./Settings"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this.createCamera=b;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:a.defaultSettings.desiredScreenFlow};this.source=b();this.target=b()}b.prototype.clone=function(){var a=new b(this.createCamera);a.copyFrom(this);return a};b.prototype.copyFrom=function(a){this.update(a.source,
a.target,a.settings)};b.prototype.update=function(b,e,f){this.source!==b&&this.source.copyFrom(b);this.target!==e&&this.target.copyFrom(e);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=f.desiredScreenFlow?f.desiredScreenFlow:a.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2};b.prototype.halfWindowPanAtZoom=function(a){a=this.target.pixelsPerPanAtZoom(a);
return this.halfWindowSize/a};Object.defineProperty(b.prototype,"hasZoom",{get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasPan",{get:function(){return 1E-9<this.compared.pan},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasRotate",{get:function(){return 1E-9<this.compared.rotate},enumerable:!0,configurable:!0});return b}();b.Definition=n;b.default=n})},"esri/views/animation/pointToPoint/Settings":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.defaultSettings={desiredScreenFlow:2,minDuration:.5,maxDuration:8}})},"esri/views/animation/pointToPoint/apex/Path":function(){define("require exports tslib ../../easing ../Path ../Segment ./planning".split(" "),function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function g(a,c){var d=b.call(this)||this;d._preallocSegments=[new e.default,new e.default,new e.default];d.update(a,c);return d}
a.__extends(g,b);g.prototype.update=function(a,c){if(a){this.definition?this.definition.copyFrom(a):this.definition=a.clone();var d=null;c&&c.apex&&(d=f.optimalDistance(a,c.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==d?this._updateWithoutApex():this._updateWithApex(d,c.apex)}};g.prototype.segmentInterpolateComponentsAt=function(a,c,e){e=a.interpolateComponentsAt(c,e);a===this._ascensionSegment?e.zoom=m.outQuad(e.zoom):a===this._descensionSegment&&(e.zoom=
m.inQuad(e.zoom));return e};g.prototype._updateWithApex=function(a,c){var d=this._preallocSegments,e=d[0],f=d[1],d=d[2],b=null!=c.ascensionFactor?c.ascensionFactor:.5;c=Math.min(1-b,null!=c.ascensionFactor?c.descensionFactor:.5);var g=1-b-c;e.definition?e.definition.copyFrom(this.definition):e.definition=this.definition.clone();e.definition.compared.targetZoom=a;e.definition.compared.pan=this.definition.compared.pan*b;e.definition.compared.rotate=this.definition.compared.rotate*b;e.update();this._ascensionSegment=
e;this.segments.push(e);0<g&&(f.definition?f.definition.copyFrom(this.definition):f.definition=this.definition.clone(),f.definition.copyFrom(this.definition),f.definition.compared.sourceZoom=a,f.definition.compared.targetZoom=a,f.definition.compared.pan=this.definition.compared.pan*g,f.definition.compared.rotate=this.definition.compared.rotate*g,f.update(),this.segments.push(f));d.definition?d.definition.copyFrom(this.definition):d.definition=this.definition.clone();d.definition.compared.sourceZoom=
a;d.definition.compared.pan=this.definition.compared.pan*c;d.definition.compared.rotate=this.definition.compared.rotate*c;d.update();this._descensionSegment=d;this.segments.push(d)};g.prototype._updateWithoutApex=function(){var a=this._preallocSegments[0];a.update(this.definition);this.segments.push(a)};return g}(h.default);b.Path=n;b.default=n})},"esri/views/animation/pointToPoint/Path":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(){this.segments=
[]}Object.defineProperty(a.prototype,"time",{get:function(){return this.segments.reduce(function(a,b){return a+b.time},0)},enumerable:!0,configurable:!0});a.prototype.interpolateComponentsAt=function(a,b){a=Math.min(Math.max(a,0),1);a*=this.time;for(var e=0,f=0,g=this.definition,l=0;l<this.segments.length;l++){var d=this.segments[l],c=d.definition;if(a<=d.time||l===this.segments.length-1)return b=this.segmentInterpolateComponentsAt(d,a/d.time,b),b.pan=g.hasPan?(e+c.compared.pan*b.pan)/g.compared.pan:
1,b.rotate=g.hasRotate?(f+c.compared.rotate*b.rotate)/g.compared.rotate:1,a=b.zoom*(c.compared.targetZoom-c.compared.sourceZoom)+c.compared.sourceZoom,e=this.segments[0].definition.compared.sourceZoom,f=this.segments[this.segments.length-1].definition.compared.targetZoom,b.zoom=g.hasZoom?(a-e)/(f-e):1,b;a-=d.time;e+=c.compared.pan;f+=c.compared.rotate}};a.prototype.segmentInterpolateComponentsAt=function(a,b,e){return a.interpolateComponentsAt(b,e)};return a}();b.Path=n;b.default=n})},"esri/views/animation/pointToPoint/Segment":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a){a&&this.update(a)}a.prototype.update=function(a){a&&(this.definition?this.definition.copyFrom(a):this.definition=a.clone());this._updatePrecomputedVariables();this._updatePixelFlow()};a.prototype._updatePrecomputedVariables=function(){var a=this.definition,b=a.compared,e=b.sourceZoom,f=b.targetZoom;this._zoomSign=e>f?1:-1;this._panPixelsAtSource=b.pan*a.source.pixelsPerPanAtZoom(e);a=(a.source.pixelsPerRotateAtZoom(e)+
a.target.pixelsPerRotateAtZoom(f))/2;this._rotatePixels=b.rotate*a};a.prototype._updatePixelFlow=function(){var a=this.definition.compared.sourceZoom,b=this.definition.compared.targetZoom,e=this.definition,f=e.hasZoom,g=e.hasPan,e=e.hasRotate,l=0,d=0;f&&(g&&(l=(b/a-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),e&&(d=Math.log(a/b)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=
0;a=this.definition.desiredPixelFlow;f&&g&&e?(b=l+d+l*d,this._zoomPixelFlow=l*d/b*a,this._panPixelFlow=d/b*a,this._rotatePixelFlow=l/b*a):f&&g?(b=1+l,this._zoomPixelFlow=l/b*a,this._panPixelFlow=1/b*a):f&&e?(b=1+d,this._zoomPixelFlow=d/b*a,this._rotatePixelFlow=1/b*a):g&&e?(l=this._panPixelsAtSource/this._rotatePixels,b=1+l,this._panPixelFlow=l/b*a,this._rotatePixelFlow=1/b*a):g?this._panPixelFlow=a:f?this._zoomPixelFlow=a:e&&(this._rotatePixelFlow=a);this.time=e?this.rotateTime:f?this.zoomTime:g?
this.panTime:0};Object.defineProperty(a.prototype,"zoomTime",{get:function(){return this.definition.hasZoom?Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._zoomPixelFlow:0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"panTime",{get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){var a=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return Math.log(this._zoomPixelFlow/
this._panPixelFlow*this._panPixelsAtSource*a+1)/(a*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"rotateTime",{get:function(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0},enumerable:!0,configurable:!0});a.prototype._interpolateComponentsZoom=function(a){if(0===a||1===a)return a;if(this.definition.hasZoom){var b=this.definition.compared.sourceZoom,e=this.definition.compared.targetZoom;
return(b*Math.pow(b/e,-a)-b)/(e-b)}return a};a.prototype._interpolateComponentsPan=function(a){if(0===a||1===a)return a;if(this.definition.hasPan&&this.definition.hasZoom){var b=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*(Math.pow(2,b*a*this.time)-1)/(b*Math.LN2)}return a};a.prototype._interpolateComponentsRotate=function(a){return a};a.prototype.interpolateComponentsAt=function(a,b){a=Math.min(Math.max(a,0),1);var e=
this._interpolateComponentsZoom(a),f=this._interpolateComponentsPan(a);a=this._interpolateComponentsRotate(a);b?(b.zoom=e,b.pan=f,b.rotate=a):b={zoom:e,pan:f,rotate:a};return b};return a}();b.Segment=n;b.default=n})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["require","exports","./functions"],function(n,b,a){function m(a,e){var f=Math.max(a.compared.sourceZoom,a.compared.targetZoom);a=a.source.zoomAtPixelsPerPan(a.desiredPixelFlow/a.compared.pan)/2;return a<f?null!=e.maximumDistance?
f+(e.maximumDistance-f)/2:1.5*f:e.maximumDistance?Math.min(e.maximumDistance,a):a}Object.defineProperty(b,"__esModule",{value:!0});b.optimalDistance=function(b,e){var f=m(b,e),g={ascensionFactor:null!=e.ascensionFactor?e.ascensionFactor:.5,descensionFactor:null!=e.descensionFactor?e.descensionFactor:.5},l=0===g.ascensionFactor,d=0===g.descensionFactor,c=l?a.tAscensionZoomOnly:a.tAscensionZoomPan,k=l?a.dtAscensionZoomOnly:a.dtAscensionZoomPan,h=l?a.ddtAscensionZoomOnly:a.ddtAscensionZoomPan,r=d?a.tDescensionZoomOnly:
a.tDescensionZoomPan,t=d?a.dtDescensionZoomOnly:a.dtDescensionZoomPan,u=d?a.ddtDescensionZoomOnly:a.ddtDescensionZoomPan,l=function(d){return c(b,d,g)+a.tPanion(b,d,g)+r(b,d,g)},d=function(c){return k(b,c,g)+a.dtPanion(b,c,g)+t(b,c,g)},v=function(c){return h(b,c,g)+a.ddtPanion(b,c,g)+u(b,c,g)},z=l(f),w=a.tBaseLine(b),q=e.maximumIterations||20,y=null!=e.maximumDistance?e.maximumDistance:Infinity;for(e=0;e<q;e++){var A=(d(f)+1E-6)/v(f);if(isNaN(A)||f>=y&&0>A){if(!isFinite(y))return null;f=y;z=l(f);
break}f-=A;if(f<b.compared.sourceZoom||f<b.compared.targetZoom)return null;A=l(f);if(.005>=Math.abs(A-z)/z)break;z=A}return z>.7*w||f<b.compared.sourceZoom||f<b.compared.targetZoom?null:f}})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.tAscensionZoomPan=function(a,b,h){var e=a.halfWindowPanAtZoom(b-a.compared.sourceZoom);return-a.halfWindowSize*(h.ascensionFactor*Math.LN2*a.compared.pan+
e)*Math.log(a.compared.sourceZoom/b)/(a.desiredPixelFlow*Math.LN2*e)};b.dtAscensionZoomPan=function(a,b,h){var e=1/b,f=Math.log(a.compared.sourceZoom*e),g=1/a.desiredPixelFlow,l=1/Math.LN2;b-=a.compared.sourceZoom;var d=1/b;h=(h.ascensionFactor*Math.LN2*a.compared.pan+a.halfWindowPanAtZoom(b))/a.halfWindowPanAtZoom(1);return a.halfWindowSize*e*g*l*d*h-a.halfWindowSize*f*g*l*d+a.halfWindowSize*f*g*l*h/(b*b)};b.ddtAscensionZoomPan=function(a,b,h){var e=b-a.compared.sourceZoom,f=1/e,g=1/b,l=Math.log(a.compared.sourceZoom*
g);h=(h.ascensionFactor*Math.LN2*a.compared.pan+a.halfWindowPanAtZoom(e))/a.halfWindowPanAtZoom(1);return a.halfWindowSize*f*(-2*f*g*h+2*f*l+2*g-2*l*h/(e*e)-h/(b*b))/(a.desiredPixelFlow*Math.LN2)};b.tAscensionZoomOnly=function(a,b){return-a.halfWindowSize*Math.log(a.compared.sourceZoom/b)/(a.desiredPixelFlow*Math.LN2)};b.dtAscensionZoomOnly=function(a,b){return a.halfWindowSize/(b*a.desiredPixelFlow*Math.LN2)};b.ddtAscensionZoomOnly=function(a,b){return-a.halfWindowSize/(b*b*a.desiredPixelFlow*Math.LN2)};
b.tPanion=function(a,b,h){return-a.compared.pan*a.halfWindowSize*(h.ascensionFactor+h.descensionFactor-1)/(a.desiredPixelFlow*a.halfWindowPanAtZoom(b))};b.dtPanion=function(a,b,h){return a.compared.pan*a.halfWindowSize*(h.ascensionFactor+h.descensionFactor-1)/(a.desiredPixelFlow*a.halfWindowPanAtZoom(b*b))};b.ddtPanion=function(a,b,h){return-2*a.compared.pan*a.halfWindowSize*(h.ascensionFactor+h.descensionFactor-1)/(a.desiredPixelFlow*a.halfWindowPanAtZoom(b*b*b))};b.tDescensionZoomPan=function(a,
b,h){return a.halfWindowSize*(-a.halfWindowPanAtZoom(b)-h.descensionFactor*Math.LN2*a.compared.pan+a.halfWindowPanAtZoom(a.compared.targetZoom))*Math.log(b/a.compared.targetZoom)/(a.desiredPixelFlow*Math.LN2*a.halfWindowPanAtZoom(-b+a.compared.targetZoom))};b.dtDescensionZoomPan=function(a,b,h){var e=Math.log(b/a.compared.targetZoom),f=1/a.desiredPixelFlow,g=1/Math.LN2,l=-b+a.compared.targetZoom,d=1/l;h=(-a.halfWindowPanAtZoom(b)-h.descensionFactor*Math.LN2*a.compared.pan+a.halfWindowPanAtZoom(a.compared.targetZoom))/
a.halfWindowPanAtZoom(1);return-a.halfWindowSize*e*f*g*d+a.halfWindowSize*e*f*g*h/(l*l)+a.halfWindowSize*f*g*d*h/b};b.ddtDescensionZoomPan=function(a,b,h){var e=b-a.compared.targetZoom,f=1/e,g=1/b,l=Math.log(b/a.compared.targetZoom);h=(a.halfWindowPanAtZoom(b)+h.descensionFactor*Math.LN2*a.compared.pan-a.halfWindowPanAtZoom(a.compared.targetZoom))/a.halfWindowPanAtZoom(1);return a.halfWindowSize*f*(-2*f*g*h-2*f*l+2*g+2*l*h/(e*e)-h/(b*b))/(a.desiredPixelFlow*Math.LN2)};b.tDescensionZoomOnly=function(a,
b){return a.halfWindowSize*Math.log(b/a.compared.targetZoom)/(a.desiredPixelFlow*Math.LN2)};b.dtDescensionZoomOnly=function(a,b){return a.halfWindowSize/(b*a.desiredPixelFlow*Math.LN2)};b.ddtDescensionZoomOnly=function(a,b){return-a.halfWindowSize/(b*b*a.desiredPixelFlow*Math.LN2)};b.tBaseLine=function(a){var b=Math.LN2*a.compared.pan,h=a.halfWindowPanAtZoom(a.compared.sourceZoom-a.compared.targetZoom),e=a.halfWindowSize*Math.log(a.compared.sourceZoom/a.compared.targetZoom)/(a.desiredPixelFlow*Math.LN2*
h);return a.compared.sourceZoom<=a.compared.targetZoom?e*(b-h):e*(b+h)}})},"esri/views/3d/state/controllers/AnimationController":function(){define("require exports tslib ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../ViewAnimation ./CameraController".split(" "),function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}a.__extends(d,b);Object.defineProperty(d.prototype,
"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"asyncResult",{get:function(){return this._asyncResult},set:function(a){this._asyncResult&&(this._asyncResult.reject(h.createAbortError()),this._asyncResult=null);this.state===g.State.Finished||this.state===g.State.Stopped?this.state===g.State.Finished?a.resolve():a.reject(h.createAbortError()):this._asyncResult=a},enumerable:!0,configurable:!0});d.prototype.onControllerStart=function(){var a=this;
this.state=g.State.Running;m.isSome(this.viewAnimation)&&this.viewAnimation.when(function(){return a.updateStateFromViewAnimation()},function(){return a.updateStateFromViewAnimation()})};d.prototype.updateStateFromViewAnimation=function(){!m.isSome(this.viewAnimation)||this.state!==g.State.Ready&&this.state!==g.State.Running||(this.viewAnimation.state===f.State.FINISHED?this.finish():this.viewAnimation.state===f.State.STOPPED&&(this.state=g.State.Stopped))};d.prototype.onControllerEnd=function(){m.isSome(this.viewAnimation)&&
!this.viewAnimation.done&&(this.state===g.State.Finished?this.viewAnimation.finish():this.state===g.State.Stopped&&this.viewAnimation.stop());this._asyncResult&&(this.state===g.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(h.createAbortError()))};d.prototype.finish=function(){this.finishController()};return d=a.__decorate([e.subclass("esri.views.3d.state.controllers.AnimationController")],d)}(g.CameraController);b.AnimationController=n})},"esri/views/3d/state/controllers/CameraController":function(){define(["require",
"exports","tslib","../../../../core/Accessor","../../../../core/accessorSupport/decorators"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});var e;(function(a){a.Ready="ready";a.Rejected="rejected";a.Running="running";a.Stopped="stopped";a.Finished="finished"})(e=b.State||(b.State={}));n=function(b){function f(){var a=null!==b&&b.apply(this,arguments)||this;a.state=e.Ready;return a}a.__extends(f,b);Object.defineProperty(f.prototype,"active",{get:function(){return this.state===
e.Running},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"isInteractive",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"canStop",{get:function(){return!1},enumerable:!0,configurable:!0});f.prototype.stopController=function(){return this.canStop?(this.state=e.Stopped,!0):!1};f.prototype.finishController=function(){this.state=e.Finished};Object.defineProperty(f.prototype,"steppingFinished",{get:function(){return!1},enumerable:!0,configurable:!0});
a.__decorate([h.property({readOnly:!0,dependsOn:["state"]})],f.prototype,"active",null);a.__decorate([h.property()],f.prototype,"state",void 0);return f=a.__decorate([h.subclass("esri.views.3d.state.controllers.CameraController")],f)}(m);b.CameraController=n})},"esri/views/3d/state/utils/navigationUtils":function(){define("require exports ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils ../../support/stack ../../support/geometryUtils/coordinateSystem ../../webgl-engine/lib/Camera".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u){function v(a,c,d){var e=r.sm4d.get();h.mat4.identity(e);h.mat4.rotate(e,e,d[3],d);l.vec3.subtract(a.eye,a.eye,c);l.vec3.transformMat4(a.eye,a.eye,e);l.vec3.add(a.eye,a.eye,c);l.vec3.subtract(a.center,a.center,c);l.vec3.transformMat4(a.center,a.center,e);l.vec3.add(a.center,a.center,c);l.vec3.transformMat4(a.up,a.up,e);a.markViewDirty()}function z(a,c){l.vec3.set(c,0,0,0);for(var d=0;d<a.length;d++)l.vec3.add(c,c,a[d]);l.vec3.scale(c,c,1/a.length)}function w(a,
d,e){return Math.sin(a/l.vec3.length(d))*(e+c.earthRadius)}function q(a,c,d,e){d=k.ray.fromScreenAtEye(c,d,ra);k.sphere.closestPointOnSilhouette(a,d,Q);return k.sphere.intersectRay(a,d,e)?l.vec3.squaredDistance(Q,d.origin)<l.vec3.squaredDistance(e,d.origin)?(l.vec3.copy(e,Q),!1):!0:(l.vec3.subtract(R,c.eye,c.center),l.vec3.normalize(R,R),k.plane.fromNormalAndOffset(R,-l.vec3.dot(l.vec3.normalize(R,R),Q),W),k.plane.intersectRay(W,d,e),!1)}function y(c,d,e,f,g,k){l.vec3.cross(ja,c,d);l.vec3.subtract(aa,
c,d);l.vec3.length(c)<=g||!f.aboveGround?(l.vec3.cross(e,aa,f.eye),c=l.vec3.dot(c,d)/(l.vec3.length(c)*l.vec3.length(d)),k=Math.cos(a.clamp(p.cyclicalPI.normalize(a.deg2rad(k)),0,b.TiltThresholdPanningSpeed)),d=-a.acosClamped(c)-Math.max(0,l.vec3.length(d)-g)/(k*g)):(l.vec3.subtract(O,f.eye,f.center),l.vec3.cross(e,aa,O),d=-l.vec3.length(aa)/g);l.vec3.normalize(e,e);l.vec3.scale(e,e,l.vec3.length(ja));return d}function A(c,d,e,f){f=Math.cos(a.clamp(p.cyclicalPI.normalize(a.deg2rad(f)),0,b.TiltThresholdPanningSpeed));
d=d>e?-(d-e)/(f*e):d<-e?Math.PI-(d+e)/(f*e):a.acosClamped(d/e);return((c>e?-(c-e)/(f*e):c<-e?Math.PI-(c+e)/(f*e):a.acosClamped(c/e))-d)*e}function B(a,c,d,e,b,g,k,h,p,r){p=A(a[2],c[2],k.radius,p);c=r?A(a[0],c[0],k.radius,180):c[0]-a[0];a=Math.sin(h)*c-Math.cos(h)*p;h=Math.cos(h)*c+Math.sin(h)*p;l.vec3.normalize(oa,b);b=r?a/Math.sqrt(Math.abs(Math.pow(k.radius,2)-Math.pow(l.vec3.dot(d,oa),2))):a/k.radius;d=h/Math.sqrt(Math.abs(Math.pow(k.radius,2)-Math.pow(l.vec3.dot(d,e),2)));f.vec2.set(g,b,d)}function C(a,
c,d,e,b,f,g,k,h,p){l.vec3.cross(ja,a,c);t.coordinateSystemFromOneAxisAndNormalVector(f.up,f.eye,V,T,X);t.coordinateSystemFromOneAxisAndNormalVector([0,0,1],f.eye,U,P,ba);l.vec3.copy(d,P);l.vec3.copy(e,U);l.vec3.normalize(d,d);l.vec3.scale(d,d,l.vec3.length(ja));t.vectorCoordinates(a,l.vec3.normalize(T,T),l.vec3.normalize(X,X),l.vec3.normalize(V,V),Y);t.vectorCoordinates(c,T,X,V,da);B(Y,da,a,U,P,b,g,k,h,p)}function F(a,c,d,e,b,f,g){h.mat4.identity(ka);h.mat4.identity(la);h.mat4.identity(ia);h.mat4.rotate(ka,
ka,b,e);h.mat4.rotate(la,la,g,f);h.mat4.multiply(ia,ka,la);l.vec3.subtract(c,a,d);l.vec3.transformMat4(c,c,ia);l.vec3.add(c,c,d)}function H(a,c,d,e,b,f){h.mat4.identity(ka);h.mat4.identity(la);h.mat4.identity(ia);h.mat4.rotate(ka,ka,e,d);h.mat4.rotate(la,la,f,b);h.mat4.multiply(ia,ka,la);l.vec3.subtract(a.eye,a.eye,c);l.vec3.transformMat4(a.eye,a.eye,ia);l.vec3.add(a.eye,a.eye,c);l.vec3.subtract(a.center,a.center,c);l.vec3.transformMat4(a.center,a.center,ia);l.vec3.add(a.center,a.center,c);l.vec3.subtract(a.up,
a.up,c);l.vec3.transformMat4(a.up,a.up,ia);l.vec3.add(a.up,a.up,c);a.markViewDirty()}function I(a,c,d,e,f,g,k,l){void 0===k&&(k=b.PreservingHeadingThreshold.Pole);void 0===l&&(l=b.PreservingHeadingThreshold.Angle);a=Math.abs(a[2])<d*k||Math.abs(c)>d;return(Math.abs(e)>Math.PI-l||Math.abs(e)<l)&&a&&g.aboveGround&&f<b.PreservingHeadingThreshold.Tilt?!0:!1}function G(a,c,d,e,b,f){f?(k.axisAngle.fromPoints(d,e,ga),v(c,a.center,ga)):(d=y(d,e,ta,c,a.radius,b),v(c,a.center,k.axisAngle.wrapAxisAngle(ta,d)))}
function J(a,c,d,e,b,f,g){var k=g?20:1;l.vec3.copy(Z,e);na.copyFrom(c);for(var h,p=0;p<k&&1E-12<l.vec3.squaredDistance(d,Z);p++)if(e=l.vec3.squaredDistance(d,Z),C(d,Z,P,U,fa,na,a,b,f,g),H(na,a.center,U,fa[1],P,fa[0]),F(Z,Z,a.center,U,fa[1],P,fa[0]),h=l.vec3.squaredDistance(d,Z),h<e||0===p)c.copyFrom(na);else break}Object.defineProperty(b,"__esModule",{value:!0});b.Earth=k.sphere.fromValues(c.earthRadius,d.vec3f64.create());b.normalizeCoordinate=function(a,c,d){d[0]=c[0]/(a.fullWidth/a.pixelRatio);
d[1]=c[1]/(a.fullHeight/a.pixelRatio);return d};b.rotationFromPointsAroundAxis=function(a,c,d){var e=r.sv3d.get(),b=r.sv3d.get(),f=r.sv3d.get();l.vec3.copy(b,a);l.vec3.copy(f,c);a=l.vec3.dot(b,d);c=l.vec3.dot(f,d);l.vec3.scale(e,d,a);l.vec3.subtract(b,b,e);l.vec3.normalize(b,b);l.vec3.scale(e,d,c);l.vec3.subtract(f,f,e);l.vec3.normalize(f,f);a=l.vec3.dot(b,f);l.vec3.cross(e,d,b);d=l.vec3.dot(f,e);return Math.atan2(d,a)};b.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=
2*Math.PI;return a};b.applyRotation=v;b.intersectPlaneFromScreenPoint=function(a,c,d,e){return k.plane.intersectRay(a,k.ray.fromScreen(c,d,ra),e)};b.applyZoomToPoint=function(a,c,d,e){var b=r.sv3d.get();d=1-d;l.vec3.subtract(b,c,a.eye);var f=l.vec3.length(b),g=f*(1-d);0<=d&&g<e&&(g=e,d=-(g-f)/f);1E-6>Math.abs(f-g)||(l.vec3.scale(b,b,d),l.vec3.add(a.eye,a.eye,b),l.vec3.lerp(a.center,a.center,c,d))};b.applyZoomOnSphere=function(a,c,d){c.getScreenCenter(E);k.sphere.intersectScreen(a,c,E,c.center);c.markViewDirty();
a=c.distance;d*=a;1E-6>Math.abs(a-d)||(d=l.vec3.scale(r.sv3d.get(),c.viewForward,d),l.vec3.subtract(c.eye,c.center,d),c.markViewDirty())};var E=m.createScreenPointArray();b.centroidOnSphere=function(a,c,d){z(c,d);l.vec3.normalize(d,d);l.vec3.scale(d,d,a)};b.centroid=z;b.onSurfaceTiltToEyeTiltGlobal=w;b.offSurfaceTiltToEyeTiltGlobal=function(a,c,d){return w(Math.PI/2,c,d)+(a-Math.PI/2)};var L;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(L=b.PanMode||(b.PanMode={}));b.VerticalPanTresholds=
{Elevation:3E4,Angle:a.deg2rad(8)};b.PreservingHeadingThreshold={Pole:.95,Angle:a.deg2rad(18),Tilt:45};b.TiltThresholdPanningSpeed=a.deg2rad(80);b.pickPointAndInitSphere=function(a,c,e,f){var g=d.vec3f64.create(),h=k.sphere.create(),p=!0;a.intersectScreen(e,g)?h.radius=l.vec3.length(g):(h.radius=c.aboveGround?Math.max(l.vec3.length(c.center),.9*b.Earth.radius):l.vec3.length(c.eye)-c.relativeElevation,f?q(h,c,e,g):p=k.sphere.intersectScreen(h,c,e,g));return{sphere:h,scenePickPoint:p?g:null}};b.decidePanMode=
function(c,d,e){var f=l.vec3.length(c.eye);if(Math.abs(f-b.Earth.radius)>b.VerticalPanTresholds.Elevation)return L.Horizontal;if(c.aboveGround===d.radius>f)return L.Vertical;l.vec3.subtract(M,c.eye,e);l.vec3.normalize(M,M);return Math.abs(.5*Math.PI-a.acosClamped(l.vec3.dot(e,M)/l.vec3.length(e)))<b.VerticalPanTresholds.Angle?L.Vertical:L.Horizontal};var M=d.vec3f64.create();b.applyPanPlanar=function(a,c,d){l.vec3.subtract(N,d,c);l.vec3.subtract(a.eye,a.eye,N);l.vec3.subtract(a.center,a.center,N);
a.markViewDirty()};var N=d.vec3f64.create();b.sphereOrPlanePointFromScreenPoint=q;var Q=d.vec3f64.create(),R=d.vec3f64.create(),W=k.plane.create();b.rotationAngleAndAxisDirectRotation=y;var O=d.vec3f64.create();b.lengthFromPoints=A;b.rotationAnglesHeadingPreserving=B;b.rotationAnglesAndAxesHeadingPreserving=C;b.rotatePointAroundTwoAxes=F;b.applyRotationWithTwoAxes=H;b.preserveHeadingThreshold=I;b.applyPanSphericalDirectRotation=G;b.applyPanSphericalPreserveHeading=J;b.panToPosition=function(c,d,e,
f,g,k,h){I(e,l.vec3.dot(d.up,e),c.radius,-p.cyclicalPI.normalize(a.deg2rad(g)),k,d,b.PreservingHeadingThreshold.Pole,b.PreservingHeadingThreshold.Angle)?J(c,d,e,f,-p.cyclicalPI.normalize(a.deg2rad(g)),k,h):G(c,d,e,f,k,h)};b.panMotionToRotationMatrix=function(c,d,e,b,f,g,k,q,m){if(I(c.center,l.vec3.dot(c.up,c.center),l.vec3.length(c.center),-p.cyclicalPI.normalize(a.deg2rad(g)),k,d))switch(c=-p.cyclicalPI.normalize(a.deg2rad(f)),t.coordinateSystemFromOneAxisAndNormalVector([0,0,1],d.eye,U,P,ba),f=
e.translation[0]*b.pan,g=e.translation[1]*b.pan,d=Math.max(Math.sqrt(Math.abs(1-Math.pow(l.vec3.dot(d.center,U),2)/Math.pow(l.vec3.length(d.center),2))),.5),k=-Math.cos(c)*g+Math.sin(c)*f,h.mat4.rotate(q.pan.matrix,q.pan.matrix,(Math.sin(c)*g+Math.cos(c)*f)/d,U),q.pan.enabled=!0,m.mode){case "pan":h.mat4.rotate(q.pan.matrix,q.pan.matrix,k,P);q.pan.enabled=!0;break;case "zoom":q.zoom=-e.translation[1]*b.zoom}else switch(c=d.eye,d=d.viewRight,c=l.vec3.cross(r.sv3d.get(),d,c),f=e.translation[0]*b.pan,
0!==f&&(h.mat4.rotate(q.pan.matrix,q.pan.matrix,-f,c),q.pan.enabled=!0),m.mode){case "pan":e=e.translation[1]*b.pan;0!==e&&(h.mat4.rotate(q.pan.matrix,q.pan.matrix,e,d),q.pan.enabled=!0);break;case "zoom":q.zoom=-e.translation[1]*b.zoom}};var U=d.vec3f64.create(),P=d.vec3f64.create(),ba=d.vec3f64.create(),V=d.vec3f64.create(),T=d.vec3f64.create(),X=d.vec3f64.create(),Y=d.vec3f64.create(),da=d.vec3f64.create(),fa=g.vec2f64.create(),ga=k.axisAngle.create(),ka=e.mat4f64.create(),la=e.mat4f64.create(),
ia=e.mat4f64.create(),Z=d.vec3f64.create(),oa=d.vec3f64.create(),aa=d.vec3f64.create(),na=new u.default,ja=d.vec3f64.create(),ta=d.vec3f64.create(),ra={origin:d.vec3f64.create(),direction:d.vec3f64.create()}})},"esri/views/3d/support/geometryUtils/coordinateSystem":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/mat4","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,a,m,h){function e(a){return{operations:a,value:a.create()}}
function f(a,d,e,b){return a.operations.setAltitudeAt(a.value,d,e,b)}Object.defineProperty(b,"__esModule",{value:!0});b.create=function(a){var c=a.operations;return{operations:c,value:c.create(a.value)}};b.setExtent=function(a,d,e){a.operations.setExtent(a.value,d,e.value);return e};b.createFromOperations=e;b.fromValues=function(a,d,b){void 0===b&&(b=e(a));b.operations=a;a.copy(d,b.value);return b};b.wrap=function(a,d){l.operations=a;l.value=d;return l};b.normalAt=function(a,d,e){return a.operations.axisAt(a.value,
d,2,e)};b.axisAt=function(a,d,e,b){return a.operations.axisAt(a.value,d,e,b)};b.intersectRay=function(a,d,e){return a.operations.intersectRay(a.value,d,e)};b.intersectsRay=function(a,d){return a.operations.intersectRay(a.value,d,null)};b.closestPoint=function(a,d,e){return a.operations.closestPoint(a.value,d,e)};b.intersectRayClosestSilhouette=function(a,d,e){return a.operations.intersectRayClosestSilhouette(a.value,d,e)};b.closestPointOnSilhouette=function(a,d,e){return a.operations.closestPointOnSilhouette(a.value,
d,e)};b.distanceToSilhouette=function(a,d){return a.operations.distanceToSilhouette(a.value,d)};b.altitudeAt=function(a,d){return a.operations.altitudeAt(a.value,d)};b.setAltitudeAt=f;b.setAltitudeOfTransformation=function(c,d,e,b){d!==b&&a.mat4.copy(b,d);m.vec3.set(g,b[12],b[13],b[14]);f(c,g,e,g);b[12]=g[0];b[13]=g[1];b[14]=g[2];return b};b.elevate=function(a,d,e){return a.operations.elevate(a.value,d,e.value)};var g=h.vec3f64.create(),l={operations:null,value:null};b.vectorCoordinates=function(a,
d,e,b,f){f[0]=m.vec3.dot(a,d);f[1]=m.vec3.dot(a,e);f[2]=m.vec3.dot(a,b);return f};b.coordinateSystemFromOneAxisAndNormalVector=function(a,e,b,f,g){m.vec3.copy(b,a);m.vec3.copy(d,e);m.vec3.normalize(d,d);m.vec3.cross(f,d,b);m.vec3.cross(g,f,b)};var d=h.vec3f64.create()})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("require exports tslib ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function g(){var a=null!==b&&b.apply(this,arguments)||this;a.zoomLocation=e.vec3f64.create();a.tmpCamera=new l.default;a.tmpRayDir=e.vec3f64.create();a.tmpCenter=e.vec3f64.create();a.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new l.default,interactionDirection:null,tiltMode:0};return a}a.__extends(g,b);g.prototype.zoomStep=function(a,c){if(this.active){var e=
this.view.state,b=this.constraintOptions.interactionStartCamera;this.animation.finished?b.copyFrom(e.camera):this.animation.cameraAt(1,b);this.tmpCamera.copyFrom(e.camera);e=new d.Intersector(this.view.viewingMode);0<a?(this.intersectionHelper.intersectScreenFreePointFallback(c,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,e,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,e,this.zoomLocation)?this.tmpCamera.center=
this.zoomLocation:h.vec3.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation);this.begin(this.tmpCamera)}};g.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:c.outExpo}};g.prototype.updateCamera=function(a,c,d){h.vec3.subtract(this.tmpRayDir,d,a.eye);var e=h.vec3.length(this.tmpRayDir),b=e*c;1>=c&&4>b&&(b=4,c=b/e);1E-6>Math.abs(e-b)||(h.vec3.scale(this.tmpRayDir,this.tmpRayDir,c),h.vec3.subtract(a.eye,d,this.tmpRayDir),
h.vec3.lerp(a.center,a.center,d,1-c),f.applyAll(this.view,a,this.constraintOptions))};return g=a.__decorate([m.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],g)}(g.PointToPointAnimationController);b.ZoomStepController=n})},"esri/views/input/handlers/support":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.eventMatchesPointerAction=function(a,b){switch(b){case "primary":return"touch"===a.pointerType||0===a.button;case "secondary":return"touch"!==
a.pointerType&&2===a.button;case "tertiary":return"touch"!==a.pointerType&&1===a.button}};b.eventMatchesMousePointerAction=function(a,b){if("touch"===a.pointerType)return!1;switch(b){case "primary":return 0===a.button;case "secondary":return 2===a.button;case "tertiary":return 1===a.button}}})},"esri/views/3d/input/handlers/DragRotate":function(){define("require exports tslib ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(e){function b(a,c,b,f){var d=e.call(this,!0)||this;d.view=a;d.pointerAction=c;d.pivotPoint=b;d.registerIncoming("drag",f,function(a){return d.handleDrag(a)});return d}a.__extends(b,e);b.prototype.handleDrag=function(a){var c=a.data;if(!(1<c.pointers.size)&&f.eventMatchesMousePointerAction(a.data,this.pointerAction)){var d=m.createScreenPointArray(c.center.x,c.center.y);switch(c.action){case "start":this.cameraController&&
(this.cameraController.end(),this.cameraController=null);this.cameraController=new h.RotateController({view:this.view,pivot:this.pivotPoint});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);break;case "update":this.cameraController&&this.cameraController.update(d);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}a.stopPropagation()}};return b}(e.InputHandler);b.DragRotate=n})},"esri/views/3d/state/controllers/RotateController":function(){define("require exports tslib ../../../../core/mathUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function r(a){a=b.call(this,a)||this;a.view=null;a.pivot="center";a.lastPoint=l.vec2f64.create();a.tmpWorldUp=c.vec3f64.create();a.tmpViewDir=c.vec3f64.create();a.tmpRotCurPoint=l.vec2f64.create();a.tmpTransf=f.mat4f64.create();a.tmpAxis=c.vec3f64.create();a.pivotPos=c.vec3f64.create();a.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,
tiltMode:0};return a}a.__extends(r,b);Object.defineProperty(r.prototype,"intersectionHelper",{get:function(){return this.view.sceneIntersectionHelper},enumerable:!0,configurable:!0});r.prototype.initialize=function(){this.rotScale="center"===this.pivot?3:1.5};r.prototype.begin=function(a){if(this.active){switch(this.pivot){case "eye":d.vec3.copy(this.pivotPos,this.beginCamera.eye);this.constraintOptions.interactionType=3;this.constraintOptions.tiltMode=1;this.constraintOptions.selection=0;break;case "center":this.intersectionHelper.intersectRayFreePointFallback(this.beginCamera.ray,
this.pivotPos)||d.vec3.copy(this.pivotPos,this.beginCamera.center),this.beginCamera.center=this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera;t.normalizeCoordinate(this.beginCamera,a,this.lastPoint)}};r.prototype.update=function(a){if(this.active){var c;switch(this.pivot){case "eye":c=this.currentCamera.center;break;case "center":this.currentCamera.center=this.pivotPos,
c=this.currentCamera.eye}this.applyRotation(this.currentCamera,a,c,this.pivotPos);k.applyAll(this.view,this.currentCamera,this.constraintOptions)}};r.prototype.end=function(){this.active&&this.finishController()};r.prototype.applyRotation=function(a,c,b,f){this.view.renderCoordsHelper.worldUpAtPosition(f,this.tmpWorldUp);t.normalizeCoordinate(a,c,this.tmpRotCurPoint);c=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale;var k=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;d.vec3.subtract(this.tmpViewDir,
b,f);var l=d.vec3.length(this.tmpViewDir),l=m.acosClamped(d.vec3.dot(this.tmpViewDir,this.tmpWorldUp)/l);if("eye"===this.pivot){var h=.5*Math.PI-l,q=.495*Math.PI;c=h-Math.max(-q,Math.min(q,h+-.5*c))}c=m.clamp(c+l,p.TiltDefault.min,p.TiltDefault.max)-l;e.mat4.identity(this.tmpTransf);d.vec3.cross(this.tmpAxis,a.up,this.tmpViewDir);"center"===this.pivot&&(k=-k);e.mat4.rotate(this.tmpTransf,this.tmpTransf,k,this.tmpWorldUp);e.mat4.rotate(this.tmpTransf,this.tmpTransf,c,this.tmpAxis);d.vec3.transformMat4(this.tmpViewDir,
this.tmpViewDir,this.tmpTransf);d.vec3.add(b,f,this.tmpViewDir);d.vec3.transformMat4(a.up,a.up,this.tmpTransf);g.vec2.copy(this.lastPoint,this.tmpRotCurPoint);a.markViewDirty()};a.__decorate([h.property({constructOnly:!0})],r.prototype,"view",void 0);a.__decorate([h.property()],r.prototype,"pivot",void 0);return r=a.__decorate([h.subclass("esri.views.3d.state.controllers.RotateController")],r)}(r.InteractiveController);b.RotateController=n})},"esri/views/3d/state/controllers/InteractiveController":function(){define("require exports tslib ../../../../core/accessorSupport/decorators ./CameraController ../../webgl-engine/lib/Camera".split(" "),
function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function f(){var a=null!==b&&b.apply(this,arguments)||this;a.beginCamera=new e.default;a.currentCamera=new e.default;return a}a.__extends(f,b);Object.defineProperty(f.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});f.prototype.stepController=function(a,d){d.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(d)};f.prototype.onControllerStart=function(a){this.state=h.State.Running;
this.beginCamera.copyFrom(a);this.currentCamera.copyFrom(a)};f.prototype.onControllerEnd=function(a){a.copyViewFrom(this.currentCamera)};return f=a.__decorate([m.subclass("esri.views.3d.state.controllers.InteractiveController")],f)}(h.CameraController);b.InteractiveController=n})},"esri/views/3d/input/handlers/DragZoom":function(){define("require exports tslib ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a,d,e){var c=b.call(this,!0)||this;c.view=a;c.pointerAction=d;c.registerIncoming("drag",e,function(a){return c.handleDrag(a)});return c}a.__extends(d,b);d.prototype.handleDrag=function(a){var c=a.data;if(!(1<c.pointers.size)&&g.eventMatchesMousePointerAction(a.data,this.pointerAction)){var d=m.createScreenPointArray(c.center.x,c.center.y);switch(c.action){case "start":this.cameraController&&(this.cameraController.end(),
this.cameraController=null);this.cameraController=this.view.state.isGlobal?new h.ZoomController({view:this.view}):new e.ZoomController({view:this.view});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);break;case "update":this.cameraController&&this.cameraController.update(d);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}a.stopPropagation()}};return d}(f.InputHandler);b.DragZoom=n})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("require exports tslib ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p){Object.defineProperty(b,"__esModule",{value:!0});n=function(c){function b(a){a=c.call(this,a)||this;a.view=null;a.pickPoint=l.vec3f64.create();a.tmpP0=f.vec2f64.create();a.panAxisAngle=p.axisAngle.create();a.tmpRayDir=l.vec3f64.create();a.targetOnSphere=l.vec3f64.create();a.dragBeginPoint=m.createScreenPointArray();a.normalizedAnchorPoint=f.vec2f64.create();a.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,
tiltMode:0};a.sphere=p.sphere.create();a.hasPickPoint=!1;return a}a.__extends(b,c);Object.defineProperty(b.prototype,"intersectionHelper",{get:function(){return this.view.sceneIntersectionHelper},enumerable:!0,configurable:!0});b.prototype.begin=function(a){this.active&&(e.vec2.copy(this.dragBeginPoint,a),k.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),a=k.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,a,!1),this.hasPickPoint=!!a.scenePickPoint,this.pickPoint=
a.scenePickPoint,this.sphere=a.sphere,this.constraintOptions.interactionStartCamera=this.beginCamera)};b.prototype.update=function(a){if(this.active){this.currentCamera.eye=this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;this.currentCamera.up=this.beginCamera.up;g.vec3.subtract(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var c=g.vec3.length(this.tmpRayDir);k.normalizeCoordinate(this.currentCamera,a,this.tmpP0);var e=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]),
b=c*Math.pow(2,e),f=this.view.state.constraints.minimumPoiDistance;0>e&&b<f&&(b=f);1E-6>Math.abs(c-b)||(this.hasPickPoint&&b<c&&(e=1-(1-b/c)*(1-this.sphere.radius/g.vec3.length(this.currentCamera.center)),g.vec3.scale(this.currentCamera.center,this.currentCamera.center,e)),g.vec3.scale(this.tmpRayDir,this.tmpRayDir,-b/c),g.vec3.add(this.currentCamera.eye,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=d.pixelDistanceToInteractionFactor(this.dragBeginPoint,a),d.applyAll(this.view,
this.currentCamera,this.constraintOptions),this.hasPickPoint&&(k.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),p.axisAngle.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),k.applyRotation(this.currentCamera,this.sphere.center,this.panAxisAngle)),d.applySurfaceCollisionConstraint(this.view,this.currentCamera))}};b.prototype.end=function(){this.active&&this.finishController()};a.__decorate([h.property({constructOnly:!0})],b.prototype,
"view",void 0);return b=a.__decorate([h.subclass("esri.views.3d.state.controllers.global.ZoomController")],b)}(c.InteractiveController);b.ZoomController=n})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("require exports tslib ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function k(a){a=b.call(this,a)||this;a.view=null;a.tmpP=d.vec3f64.create();a.tmpN=d.vec3f64.create();a.tmpP0=g.vec2f64.create();a.tmpPoi=d.vec3f64.create();a.tmpRayDir=d.vec3f64.create();a.dragBeginPoint=h.createScreenPointArray();a.normalizedAnchorPoint=g.vec2f64.create();a.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:d.vec3f64.create(),
tiltMode:0};a.plane=r.plane.create();return a}a.__extends(k,b);Object.defineProperty(k.prototype,"intersectionHelper",{get:function(){return this.view.sceneIntersectionHelper},enumerable:!0,configurable:!0});k.prototype.begin=function(a){this.active&&(f.vec2.copy(this.dragBeginPoint,a),p.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),this.intersectionHelper.intersectScreenFreePointFallback(a,this.tmpP),l.vec3.subtract(this.tmpN,this.beginCamera.eye,this.beginCamera.center),l.vec3.normalize(this.tmpN,
this.tmpN),0>this.tmpN[1]&&l.vec3.negate(this.tmpN,this.tmpN),r.plane.fromPositionAndNormal(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.beginCamera)};k.prototype.update=function(a){if(this.active){p.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||l.vec3.copy(this.tmpPoi,this.currentCamera.center);p.normalizeCoordinate(this.currentCamera,a,this.tmpP0);var d=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);f.vec2.copy(this.normalizedAnchorPoint,
this.tmpP0);l.vec3.subtract(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);var e=l.vec3.length(this.tmpRayDir),b=e*(1-d);l.vec3.copy(this.constraintOptions.interactionDirection,this.tmpRayDir);l.vec3.scale(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,m.sign(d)/e);var g=this.view.state.constraints.minimumPoiDistance;0<=d&&b<g&&(b=g,d=-(b-e)/e);1E-6>Math.abs(e-b)||(l.vec3.scale(this.tmpRayDir,this.tmpRayDir,d),l.vec3.add(this.currentCamera.eye,this.currentCamera.eye,
this.tmpRayDir),l.vec3.lerp(this.currentCamera.center,this.currentCamera.center,this.tmpPoi,d),this.currentCamera.center[2]=this.tmpPoi[2]>this.beginCamera.center[2]?Math.max(this.beginCamera.center[2],this.currentCamera.center[2]):Math.min(this.beginCamera.center[2],this.currentCamera.center[2]),this.currentCamera.markViewDirty(),this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(this.dragBeginPoint,a),c.applyAll(this.view,this.currentCamera,this.constraintOptions))}};k.prototype.end=
function(){this.active&&this.finishController()};a.__decorate([e.property({constructOnly:!0})],k.prototype,"view",void 0);return k=a.__decorate([e.subclass("esri.views.3d.state.controllers.local.ZoomController")],k)}(k.InteractiveController);b.ZoomController=n})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("require exports tslib ../../../../core/Handles ../../../../core/watchUtils ../../state/controllers/GamepadKeyboardController ../../../input/InputHandler".split(" "),function(n,
b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function f(a){var c=b.call(this,!0)||this;c.view=a;c.watchHandles=new m;c.handle=c.registerIncoming("gamepad",function(a){return c.handleEventGamepad(a)});c.handle.pause();return c}a.__extends(f,b);f.prototype.onInstall=function(a){var c=this;b.prototype.onInstall.call(this,a);this.watchHandles.add([h.init(this.view.navigation.gamepad,"enabled",function(a){a?c.handle.resume():(c.handle.pause(),c.cameraControllerGamepad&&(c.cameraControllerGamepad.finishController(),
c.cameraControllerGamepad=null))}),this.view.navigation.gamepad.watch("device",function(a){c.cameraControllerGamepad&&a&&c.cameraControllerGamepad.gamepadDevice!==a&&(c.cameraControllerGamepad.finishController(),c.cameraControllerGamepad=null)})])};f.prototype.onUninstall=function(){this.watchHandles.removeAll();b.prototype.onUninstall.call(this)};f.prototype.handleEventGamepad=function(a){var c=this.view.navigation.gamepad.device;if(!c||a.data.device===c)if((c=this.cameraControllerGamepad&&this.cameraControllerGamepad.active)||
e.GamepadKeyboardController.activatesFor(this.view,a.data))c||(c=new e.GamepadKeyboardController({view:this.view,gamepadDevice:a.data.device}),this.view.state.switchCameraController(c)&&(this.cameraControllerGamepad=c)),this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===a.data.device&&this.cameraControllerGamepad.handleEventGamepad(a.data)};return f}(f.InputHandler);b.GamepadNavigation=n})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("require exports tslib ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils ../../support/stack ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F){Object.defineProperty(b,"__esModule",{value:!0});n=function(c){function b(a){a=c.call(this,a)||this;a.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};a.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0];a.tmpCamera=new C.default;a.constraintOptions={selection:15,interactionType:0,interactionStartCamera:new C.default,interactionFactor:0,interactionDirection:null,tiltMode:1};return a}a.__extends(b,c);b.prototype.handleEventGamepad=function(a){var c=
F.extractTransformation(a,this.view.navigation.gamepad,this.transformation);("end"===a.action||F.isZeroTransformation(c))&&this.finishController()};b.prototype.activateDirection=function(a){this.keysButtonState[a]=1;F.extractTransformationKeyboard(this.keysButtonState,this.transformation)};b.prototype.deactivateDirection=function(a){this.keysButtonState[a]=0;a=F.extractTransformationKeyboard(this.keysButtonState,this.transformation);F.isZeroTransformation(a)&&this.finishController()};b.prototype.onControllerStart=
function(a){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;this.headingStart=this.view.camera.heading;c.prototype.onControllerStart.call(this,a)};b.prototype.updateFilteredSurfaceElevation=function(a){this.filteredSurfaceElevation+=1*(this.view.pointsOfInterest.cameraOnSurface.location.z-this.filteredSurfaceElevation)*a};b.prototype.stepController=function(a,d){this.updateStartHeading();this.updateFilteredSurfaceElevation(a);this.currentCamera.copyViewFrom(d);
this.updateCameraCenter();this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera);this.calculateControlTransformation(a,this.currentCamera,N);this.applyDisabledMovementTypes(N);this.applyPan(N.pan);this.applyRotate(N.rotate);this.applyZoom(N.zoom);this.applyAscend(N.ascend);this.constraintOptions.interactionType=0;this.constraintOptions.selection=8;k.applyAll(this.view,this.currentCamera,this.constraintOptions);c.prototype.stepController.call(this,a,d)};b.prototype.updateStartHeading=
function(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)};b.prototype.applyRotate=function(a){if(a.enabled){var c=this.currentCamera,e=c.center,b=c.up,f=c.eye;d.vec3.subtract(e,e,f);d.vec3.transformMat4(e,e,a.matrix);d.vec3.add(e,e,f);d.vec3.transformMat4(b,b,a.matrix);c.markViewDirty();this.constraintOptions.interactionType=3;this.constraintOptions.selection=7;k.applyAll(this.view,c,this.constraintOptions)}};b.prototype.applyPan=function(a,c){void 0===c&&(c=this.currentCamera);
if(a.enabled){var e=c.center,b=c.eye,f=c.up;d.vec3.transformMat4(b,b,a.matrix);d.vec3.transformMat4(e,e,a.matrix);this.view.state.isGlobal&&d.vec3.transformMat4(f,f,a.matrix);c.markViewDirty();this.constraintOptions.interactionType=4;this.constraintOptions.selection=15;k.applyAll(this.view,c,this.constraintOptions)}};b.prototype.applyZoom=function(a){if(a){var c=this.currentCamera,e=c.eye,c=c.viewForward;d.vec3.add(e,e,d.vec3.scale(B.sv3d.get(),c,a));this.currentCamera.markViewDirty();d.vec3.copy(Q,
c);d.vec3.negate(Q,Q);this.constraintOptions.interactionDirection=Q;this.constraintOptions.interactionType=1;this.constraintOptions.selection=7;k.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};b.prototype.applyAscend=function(a){if(a){var c=this.currentCamera,e=c.center,c=c.eye,b=this.view.renderCoordsHelper.worldUpAtPosition(c,B.sv3d.get());this.constraintOptions.interactionDirection=d.vec3.copy(Q,b);this.view.state.isGlobal?(b=d.vec3.length(c),
a=(b+a)/b,d.vec3.scale(c,c,a),d.vec3.scale(e,e,a)):(a=d.vec3.scale(B.sv3d.get(),b,a),d.vec3.add(c,c,a),d.vec3.add(e,e,a));this.currentCamera.markViewDirty();this.updateCameraCenter();this.constraintOptions.interactionType=5;this.constraintOptions.selection=8;k.applyAll(this.view,this.currentCamera,this.constraintOptions)&&this.updateCameraCenter();this.constraintOptions.selection=7;k.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};b.prototype.calculateControlTransformation=
function(a,c,d){d.zoom=0;d.ascend=0;d.pan.enabled=!1;g.mat4.identity(d.pan.matrix);d.rotate.enabled=!1;g.mat4.identity(d.rotate.matrix);a=this.computeVelocities(a);this.view.state.isLocal?this.calculateControlTransformationLocal(a,c,d):this.calculateControlTransformationGlobal(a,c,d)};b.prototype.updateCameraCenter=function(){var a=this.currentCamera;this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(a.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,a.center);
this.currentCamera.markViewDirty()};b.prototype.calculateControlTransformationLocal=function(a,c,e){var b=c.viewRight,f=c.viewForward,k=this.transformation,l=this.view.navigation.gamepad,f=d.vec3.set(B.sv3d.get(),f[0],f[1],0);d.vec3.normalize(f,f);var q=k.translation[0]*a.pan;0!==q&&(q=d.vec3.scale(B.sv3d.get(),b,q),g.mat4.translate(e.pan.matrix,e.pan.matrix,q),e.pan.enabled=!0);switch(l.mode){case "pan":l=-k.translation[1]*a.pan;0!==l&&(l=d.vec3.scale(B.sv3d.get(),f,l),g.mat4.translate(e.pan.matrix,
e.pan.matrix,l),e.pan.enabled=!0);e.zoom=k.zoom*a.zoom;break;case "zoom":e.zoom=(-k.translation[1]+k.zoom)*a.zoom;break;default:m.neverReached(l.mode)}e.ascend=k.translation[2]*a.ascend;l=-k.heading*a.rotate;0!==l&&(g.mat4.rotate(e.rotate.matrix,e.rotate.matrix,l,this.view.renderCoordsHelper.worldUpAtPosition(c.eye,B.sv3d.get())),e.rotate.enabled=!0);a=k.tilt*a.rotate;c=v.viewAngle(this.view.renderCoordsHelper,c.center,c.eye);if(c=h.clamp(c+a,p.TiltDefault.min,p.TiltDefault.max)-c)g.mat4.rotate(e.rotate.matrix,
e.rotate.matrix,c,b),e.rotate.enabled=!0};b.prototype.calculateControlTransformationGlobal=function(a,c,e){var b=c.eye,f=c.viewRight,k=this.transformation,l=this.view.navigation.gamepad,b=d.vec3.cross(B.sv3d.get(),f,b);d.vec3.normalize(b,b);d.vec3.negate(b,b);t.panMotionToRotationMatrix(this.beginCamera,c,k,a,this.view.camera.heading,this.headingStart,this.view.camera.tilt,e,l);this.tmpCamera.copyFrom(this.currentCamera);this.applyPan(N.pan,this.tmpCamera);l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;
e.ascend=k.translation[2]*a.ascend;b=-k.heading*a.rotate;0!==b&&(g.mat4.rotate(e.rotate.matrix,e.rotate.matrix,b,this.tmpCamera.eye),e.rotate.enabled=!0);c=this.clampTiltDeltaGlobalToValidRange(k.tilt*a.rotate,c.ray,l);0!==c&&(g.mat4.rotate(e.rotate.matrix,e.rotate.matrix,c,this.tmpCamera.viewRight),e.rotate.enabled=!0);e.zoom=k.zoom*a.zoom};b.prototype.clampTiltDeltaGlobalToValidRange=function(a,c,e){var b=u.onSurfaceTiltToEyeTiltGlobal(p.TiltDefault.min,c.origin,e),f=0,g=0,f=B.sv3d.get();this.view.renderCoordsHelper.intersectManifold(c,
e,f)?(f=v.viewAngle(this.view.renderCoordsHelper,f,c.origin),f=u.onSurfaceTiltToEyeTiltGlobal(f,c.origin,e),g=u.onSurfaceTiltToEyeTiltGlobal(p.TiltDefault.max,c.origin,e)):(y.sphere.closestPointOnSilhouette(y.sphere.wrap(e+q.earthRadius),c,f),f=h.acosClamped(-d.vec3.dot(c.direction,d.vec3.normalize(f,f))),f=u.offSurfaceTiltToEyeTiltGlobal(f,c.origin,e),g=u.offSurfaceTiltToEyeTiltGlobal(p.TiltDefault.max,c.origin,e));return h.clamp(f+a,b,g)-f};b.prototype.getPointAbsoluteSurfaceElevation=function(a,
c,e){var b=this.view.renderCoordsHelper,f=b.getAltitude(a);c+=Math.abs(f-c);d.vec3.copy(e,a);b.setAltitude(c,e);return c};b.prototype.clampedDistanceToSurface=function(a,c){var e=this.view.renderCoordsHelper,b=this.view.state.camera,f=z.headingTiltToDirectionUp(this.view,c,0,I,R).direction,f=e.intersectManifoldClosestSilhouette(y.ray.wrap(c,f),a,B.sv3d.get()),f=d.vec3.distance(c,f);a=e.intersectManifoldClosestSilhouette(y.ray.wrap(c,A.directionFromTo(B.sv3d.get(),c,b.center)),a,B.sv3d.get());c=d.vec3.distance(c,
a);return Math.min(f,c)};b.prototype.computeHeadingRotateRadius=function(a){var c=this.view,e=c.renderCoordsHelper,b=c.state,c=b.isGlobal,b=e.intersectManifoldClosestSilhouette(b.camera.ray,this.filteredSurfaceElevation,B.sv3d.get());if(c)return c=d.vec3.subtract(B.sv3d.get(),a,b),e=d.vec3.length(c),d.vec3.scale(c,c,1/e),a=d.vec3.normalize(B.sv3d.get(),a),a=h.acosClamped(d.vec3.dot(a,c)),e*Math.sin(Math.min(G,a));a=d.vec3.copy(B.sv3d.get(),a);e.setAltitude(this.filteredSurfaceElevation,a);return d.vec3.distance(b,
a)};b.prototype.minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:E};b.prototype.computeVelocities=function(a){var c=this.filteredSurfaceElevation,d=c+q.earthRadius,e=this.view.state,b=e.camera,f=e.isGlobal,g=B.sv3d.get(),k=this.getPointAbsoluteSurfaceElevation(b.eye,c,g),l=this.clampedDistanceToSurface(c,g),p=b.width/2,r=J*b.width,e=J*b.width,b=l*Math.tan(.5*b.fovX)/p,m=b/d,d=b/this.computeHeadingRotateRadius(g),f=(f?m:b)*r*a,c=k-c,c=Math.max(this.minimumAscendVelocity()*
a,Math.pow(2,r*a/p)*c-c),l=Math.pow(2,r*a/p)*l-l;a*=h.clamp(d*e,L,M);return{pan:f,ascend:c,zoom:l,rotate:a}};b.prototype.applyDisabledMovementTypes=function(a){!e.isSome(this.disableMovements)||void 0!==this.disableMovements.mode&&this.view.state.mode!==this.disableMovements.mode||(a.zoom=this.disableMovements.zoom?0:a.zoom,a.ascend=this.disableMovements.ascend?0:a.ascend,a.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&g.mat4.identity(a.pan.matrix),a.rotate.enabled=!this.disableMovements.rotate,
this.disableMovements.rotate&&g.mat4.identity(a.rotate.matrix))};b.activatesFor=function(a,c){a=F.extractTransformation(c,a.navigation.gamepad,H);return!("end"===c.action||F.isZeroTransformation(a))};a.__decorate([f.property({constructOnly:!0})],b.prototype,"view",void 0);a.__decorate([f.property({constructOnly:!0})],b.prototype,"gamepadDevice",void 0);a.__decorate([f.property({constructOnly:!0})],b.prototype,"disableMovements",void 0);return b=a.__decorate([f.subclass("esri.views.3d.state.controllers.GamepadKeyboardController")],
b)}(r.InteractiveController);b.GamepadKeyboardController=n;var H={translation:[0,0,0],heading:0,tilt:0,zoom:0},I=80,G=h.deg2rad(I),J=.75,E=5,L=h.deg2rad(30),M=h.deg2rad(80),N={zoom:0,ascend:0,pan:{enabled:!1,matrix:l.mat4f64.create()},rotate:{enabled:!1,matrix:l.mat4f64.create()}},Q=c.vec3f64.create(),R=w.createDirectionUp()})},"esri/views/3d/support/cameraUtils":function(){define("require exports tslib ../../../Camera ../../../core/Logger ../../../core/mathUtils ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../camera/intersectionUtils ./cameraUtilsPlanar ./cameraUtilsSpherical ./earthUtils ./ElevationProvider ./mathUtils ./projectionUtils ../../support/spatialReferenceSupport".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q){function y(a){return"global"===a.viewingMode?t:r}function A(a,c,d){var b=a.state.camera,f=b.fovX,b=b.width/2/b.pixelRatio;"global"===a.viewingMode&&null!=d&&(c*=Math.cos(e.deg2rad(d)));c/=a.renderCoordsHelper.unitInMeters;return b/(96*39.37/c)/Math.tan(f/2)}function B(a,c,d){var b=a.state.camera;c=96*39.37/(b.width/2/b.pixelRatio/(c*Math.tan(b.fovX/2)));"global"===a.viewingMode&&(c/=Math.cos(e.deg2rad(d)));return c*=a.renderCoordsHelper.unitInMeters}
function C(a,c,d,e,b,f){if(R(f)){var g=Q(f.signal);E(a,e.heading,e.tilt,c,d,b,g);g.resolver.promise.then(function(c){return f.resolver.resolve(N(a,c,e.fov))},function(a){return f.resolver.reject(a)})}else return c=E(a,e.heading,e.tilt,c,d,b),N(a,c,e.fov,f)}function F(a,c,d,e,b){return y(a).directionToHeadingTilt(c,d,e,b)}function H(a,c){return!!(a.basemapTerrain&&a.renderCoordsHelper.fromRenderCoords(c,V,a.spatialReference)&&v.getElevationAtPoint(a.elevationProvider,V)>V.z-1)}function I(c,d,e){return a.__awaiter(this,
void 0,void 0,function(){var b;return a.__generator(this,function(a){switch(a.label){case 0:return c.renderCoordsHelper.fromRenderCoords(d,V,c.spatialReference)?[4,c.elevationProvider.queryElevation(V.x,V.y,V.z,V.spatialReference,e)]:[2,!1];case 1:return b=a.sent(),[2,b>V.z-1]}})})}function G(c,e,b){return a.__awaiter(this,void 0,void 0,function(){var f,k;return a.__generator(this,function(a){switch(a.label){case 0:f=l.vec3f64.create();if(e)return[3,1];g.vec3.copy(f,c.state.camera.center);return[3,
5];case 1:if(!(e instanceof d))return[3,4];w.pointToVector(e,f,c.renderSpatialReference);return null!=e.z||null==c.basemapTerrain?[3,3]:[4,c.elevationProvider.queryElevation(e.x,e.y,e.z,e.spatialReference,b)];case 2:return k=a.sent(),null!=k&&c.renderCoordsHelper.setAltitude(k,f),[2,f];case 3:return[3,5];case 4:g.vec3.copy(f,e),a.label=5;case 5:return[2,f]}})})}function J(a,c){var e=l.vec3f64.create();c&&c instanceof d?(w.pointToVector(c,e,a.renderSpatialReference),null==c.z&&null!=a.basemapTerrain&&
(c=v.getElevationAtPoint(a.elevationProvider,c),null!=c&&a.renderCoordsHelper.setAltitude(c,e))):c?g.vec3.copy(e,c):g.vec3.copy(e,a.state.camera.center);return e}function E(a,c,e,b,f,g,k){var l=b&&b instanceof d?b:null;if(R(k))G(a,b,k.signal).then(function(d){L(a,c,e,l,d,f,g,k)},function(a){return k.resolver.reject(a)});else return b=J(a,b),L(a,c,e,l,b,f,g,k)}function L(a,d,e,b,f,g,k,h){b||(b=w.vectorToPoint(f,a.renderSpatialReference,a.spatialReference||c.WGS84));g=Math.max(g,a.state.constraints.minimumPoiDistance);
var p=M(a,d,e,f,g,k),q=y(a).eyeForCenterWithHeadingTilt,r=q(f,g,p.heading,p.tilt);if(1===k&&"global"===a.viewingMode&&0<e){var m=function(){var c=g,l=g,p=a.state.constraints.tilt(l),l=y(a).eyeTiltToLookAtTilt(e,f,l),l=Math.min(l,.5*Math.PI),p=p.min*(1-Y)+l*Y,c=y(a).lookAtTiltToEyeTilt(p,f,c);k=1>e-c?0:1;return L(a,d,c,b,f,g,k,h)},p=a.map.ground.navigationConstraint;if(!p||"stay-above"===p.type){if(H(a,r.eye))return m();if(R(h)){I(a,r.eye,h.signal).then(function(a){if(a)return m();h.resolver.resolve({eye:r.eye,
up:r.up,center:l.vec3f64.clone(f),heading:r.heading,tilt:r.tilt})});return}}}p=!h||R(h)?{center:l.vec3f64.create(),eye:l.vec3f64.create(),up:l.vec3f64.create(),tilt:0,heading:0}:h;p.eye=r.eye;p.up=r.up;p.center=l.vec3f64.clone(f);p.heading=r.heading;p.tilt=r.tilt;R(h)&&h.resolver.resolve(p);return p}function M(a,d,e,b,f,g){var k=0;if(g=1===g)if(k=a.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(f/k)/Math.LN2)g=!0;else{var l=a.renderSpatialReference,h=a.spatialReference||c.WGS84;g=w.vectorToPoint(b,
l,h);l=w.vectorToPoint(a.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,l,h);k*=Math.tan(.5*a.state.camera.fov);g=5<l.distance(g)/k}g?(d=0,g=a.state.constraints.tilt(f),g.max=Math.min(g.max,.5*Math.PI),g=g.min*(1-Y)+g.max*Y,e=y(a).eyeTiltToLookAtTilt(e,b,f),k=Math.min(e,g)):k=y(a).eyeTiltToLookAtTilt(e,b,f);e=k=a.state.constraints.clampTilt(f,k);e=y(a).lookAtTiltToEyeTilt(e,b,f);return{heading:d,tilt:e}}function N(a,d,e,b){a=w.vectorToPoint(d.eye,a.renderSpatialReference,a.spatialReference||
c.WGS84);return a?b?(b.position=a,b.heading=d.heading,b.tilt=d.tilt,b.fov=e,b):new m(a,d.heading,d.tilt,e):null}function Q(a){return{resolver:f.createResolver(),signal:a}}function R(a){return a&&"resolver"in a}Object.defineProperty(b,"__esModule",{value:!0});var W=h.getLogger("esri.views.3d.support.cameraUtils"),O=l.vec3f64.create(),U=l.vec3f64.create(),P=l.vec3f64.create(),ba={heading:0,tilt:0},V=new d,T=new z.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),X=new z.Cyclical(-180,180);b.headingTiltToDirectionUp=
function(a,c,d,e,b){return y(a).headingTiltToDirectionUp(c,d,e,b)};b.externalToInternal=function(a,c){var d=a.renderSpatialReference,b=y(a).headingTiltToDirectionUp,f=l.vec3f64.create();if(!w.pointToVector(c.position,f,d))return null;d=b(f,c.heading,c.tilt);g.vec3.scale(d.direction,d.direction,a.state.camera.distance);g.vec3.add(d.direction,d.direction,f);a=p.cameraOnContentAlongViewDirection(a,f,d.direction,d.up);a.fov=e.deg2rad(c.fov);return a};b.internalToExternal=function(a,b,f){var k=a.renderSpatialReference,
l=g.vec3.copy(P,b.viewForward),l=F(a,b.eye,l,b.up,ba);a=a.spatialReference||c.WGS84;w.vectorToVector(b.eye,k,O,a)||(a=c.WGS84,w.vectorToVector(b.eye,k,O,a));if(!f)return new m(new d(O,a),l.heading,l.tilt,e.rad2deg(b.fov));f.position.x=O[0];f.position.y=O[1];f.position.z=O[2];f.position.spatialReference=a;f.heading=l.heading;f.tilt=l.tilt;f.fov=e.rad2deg(b.fov);return f};b.scaleToDistance=A;b.distanceToScale=B;b.fromCenterScale=function(a,c,d,e,b,f){d=A(a,d,c.latitude);return C(a,c,d,e,b,f)};b.fromCenterDistance=
C;b.directionToHeadingTilt=F;b.getObserverForPointAtDistance=E;b.fromExtent=function(a,e,b,f,g,k){var l,h=0;null!=e.zmax&&null!=e.zmin&&(l=(e.zmax+e.zmin)/2,h=e.zmax-e.zmin);var p,r;if("global"===a.viewingMode){if(!q.isSpatialReferenceSupported(e.spatialReference,"global"))return R(k)&&k.resolver.reject(),null;var m=new d(e.xmin,e.ymin,e.spatialReference),t=new d(e.xmax,e.ymax,e.spatialReference),v=e.spatialReference.isGeographic?X:T;e=new d(v.center(m.x,t.x),(t.y+m.y)/2,e.spatialReference);null!=
l&&(e.z=l);r=u.getGreatCircleSpanAt(e,m,t);p=r.lon;r=r.lat;v.diff(m.x,t.x)>v.range/2&&(p+=u.halfEarthCircumference);p=Math.min(p,u.halfEarthCircumference);r=Math.min(r,u.halfEarthCircumference)}else m=a.spatialReference||c.WGS84,p=e.xmax-e.xmin,r=e.ymax-e.ymin,e=new d({x:e.xmin+.5*p,y:e.ymin+.5*r,z:l,spatialReference:m});l=a.state.camera;h=Math.max(1/Math.tan(l.fovX/2)*p*.5,1/Math.tan(l.fovY/2)*r*.5,1/Math.tan(l.fov/2)*h*.5)/1;if(R(k))p=Q(k.signal),E(a,b,f,e,h,g,p),p.resolver.promise.then(function(c){return k.resolver.resolve(N(a,
c,a.camera.fov))},function(a){return k.resolver.reject(a)});else return b=E(a,b,f,e,h,g),N(a,b,a.camera.fov,k)};b.toExtent=function(a,d,e){var b=a.renderSpatialReference,f=g.vec3.dist(d.eye,e);e=w.vectorToPoint(e,b,a.spatialReference||c.WGS84);b=2*f*Math.tan(d.fovX/2)*1;d=2*f*Math.tan(d.fovY/2)*1;return"global"===a.viewingMode?t.toExtent(a,e,b,d):r.toExtent(a,e,b,d)};var Y=.7;b.observerToCamera=N;b.scaleToZoom=function(a,c){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.levelAtScale(c);
W.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};b.zoomToScale=function(a,c){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.scaleAtLevel(c);W.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};b.scaleToResolution=function(a,c){return a.spatialReference?k.getResolutionForScale(c,a.spatialReference):void 0};b.computeScale=function(a,d,e){var b=a.renderSpatialReference;d||(d=a.state.camera);var f;f=c.WGS84;d instanceof m?
(f=d.position.latitude,w.pointToVector(d.position,O,b),w.pointToVector(e,U,b),d=g.vec3.distance(O,U)):(w.vectorToVector(d.center,b,U,f),f=U[1],d=d.distance);return B(a,d,f)};b.createAsyncContext=Q;b.isAsyncContext=R})},"esri/views/3d/support/cameraUtilsPlanar":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Extent ./cameraUtilsInternal ./projectionUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d){function c(c,d,b,f){void 0===f&&(f=l.createDirectionUp());m.mat4.identity(r);c=f.direction;var g=f.up;m.mat4.rotateZ(r,r,-a.deg2rad(d));m.mat4.rotateX(r,r,a.deg2rad(b));e.vec3.transformMat4(c,p,r);e.vec3.scale(c,c,-1);e.vec3.transformMat4(g,k,r);return f}Object.defineProperty(b,"__esModule",{value:!0});var k=f.vec3f64.fromValues(0,1,0),p=f.vec3f64.fromValues(0,0,1),r=h.mat4f64.create(),t=f.vec3f64.create(),u=f.vec3f64.create();b.headingTiltToDirectionUp=c;b.directionToHeadingTilt=
function(a,c,d,e){return l.directionToHeadingTilt(c,d,e,p,k)};b.eyeForCenterWithHeadingTilt=function(a,d,b,g){var k=c(a,b,g),l=f.vec3f64.create();e.vec3.scale(l,k.direction,-d);e.vec3.add(l,l,a);return{up:k.up,eye:l,heading:b,tilt:g}};b.lookAtTiltToEyeTilt=function(c){return a.rad2deg(c)};b.eyeTiltToLookAtTilt=function(c){return a.deg2rad(c)};b.toExtent=function(a,c,e,b,f){var k=a.renderSpatialReference;a=a.map&&a.spatialReference||c.spatialReference;d.pointToVector(c,t,k);d.pointToVector(c,u,k);
t[0]-=e/2;u[0]+=e/2;t[1]-=b/2;u[1]+=b/2;d.vectorToVector(t,k,t,a);d.vectorToVector(u,k,u,a);f?(f.xmin=t[0],f.ymin=t[1],f.xmax=u[0],f.ymax=u[1],f.spatialReference=a):f=new g(t[0],t[1],u[0],u[1],a);return f}})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["require","exports","../../../core/mathUtils","../../../core/libs/gl-matrix-2/vec3","../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});var e=h.vec3f64.create(),f=h.vec3f64.create();
b.createDirectionUp=function(){return{direction:h.vec3f64.create(),up:h.vec3f64.create()}};b.directionToHeadingTilt=function(b,l,d,c,k){var g=e;m.vec3.normalize(g,b);var h=m.vec3.dot(g,c),t=0<h,h=Math.abs(h);.99<h&&(h=Math.abs(m.vec3.dot(l,c)),.99>h?(m.vec3.copy(g,l),t&&m.vec3.scale(g,g,-1)):g=null);l=0;g&&(m.vec3.scale(f,c,m.vec3.dot(c,g)),m.vec3.subtract(g,g,f),l=m.vec3.dot(g,k)/(m.vec3.length(g)*m.vec3.length(k)),m.vec3.cross(f,g,k),l=(0<m.vec3.dot(f,c)?1:-1)*a.rad2deg(a.acosClamped(l)));b=a.rad2deg(a.acosClamped(-m.vec3.dot(c,
b)/m.vec3.length(b)));if(!d)return{heading:l,tilt:b};d.heading=l;d.tilt=b;return d}})},"esri/views/3d/support/cameraUtilsSpherical":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./cameraUtilsInternal ./earthUtils ./mathUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p){function r(d,b,f,g){void 0===g&&(g=c.createDirectionUp());e.vec3.cross(y,d,v);0===e.vec3.dot(y,y)&&e.vec3.cross(y,d,z);m.mat4.identity(q);m.mat4.rotate(q,q,-a.deg2rad(b),d);m.mat4.rotate(q,q,-a.deg2rad(f),y);b=g.up;f=g.direction;e.vec3.cross(b,y,d);e.vec3.normalize(b,b);e.vec3.transformMat4(b,b,q);e.vec3.normalize(f,d);e.vec3.negate(f,f);e.vec3.transformMat4(f,f,q);return g}function t(a){var c=a[1];a[1]=-a[2];a[2]=c}function u(a,c){c=r(c,a.heading,a.tilt);a.up=
c.up;return a}Object.defineProperty(b,"__esModule",{value:!0});var v=f.vec3f64.fromValues(0,0,1),z=e.vec3.normalize(f.vec3f64.create(),f.vec3f64.fromValues(1,1,1)),w=new p.Cyclical(-180,180),q=h.mat4f64.create(),y=f.vec3f64.create(),A=f.vec3f64.create();b.headingTiltToDirectionUp=r;b.directionToHeadingTilt=function(a,d,b,f){var g=y;e.vec3.normalize(g,a);e.vec3.cross(A,g,v);0===e.vec3.dot(A,A)&&e.vec3.cross(A,g,z);e.vec3.cross(A,A,g);return c.directionToHeadingTilt(d,b,f,g,A)};b.eyeForCenterWithHeadingTilt=
function(c,d,b,g){var k={eye:f.vec3f64.create(),up:null,tilt:g,heading:b},l=y;l[0]=c[0];l[1]=c[2];l[2]=-c[1];b=a.deg2rad(b);var h=a.deg2rad(g);g=Math.sin(b);b=Math.cos(b);var p=Math.sin(h),r=Math.cos(h),q=e.vec3.length(l);if(1E-8>Math.abs(h))h=d+q;else var m=q/p,v=a.asinClamped(d/m),h=m*Math.sin(Math.PI-h-v);var r=r*d,m=d*d*p*p,v=b*b*m,w=h-r,A=w*w,z=v*(v+A-l[1]*l[1]);if(0>z)return e.vec3.scale(k.eye,l,h/q),k.tilt=0,k;var B=Math.sqrt(z),C=l[1]*w,z=v+A,B=0<b?-B+C:B+C;if(1E-8>Math.abs(z))return 1E-8>
q?(k.eye[0]=0,k.eye[1]=0,k.eye[2]=d):e.vec3.scale(k.eye,l,h/q),k.tilt=0,t(k.eye),u(k,c);k.eye[1]=B/z;d*=p;B=k.eye[1]*k.eye[1];p=1-B;z=Math.sqrt(p);m=v*B+g*g*m-2*b*d*k.eye[1]*z*w+p*A;if(1E-8>Math.abs(m))return e.vec3.scale(k.eye,l,h/q),k.tilt=0,t(k.eye),u(k,c);k.eye[0]=(p*(h*l[0]-r*l[0])-d*z*(l[0]*k.eye[1]*b+l[2]*g))/m;k.eye[2]=(p*(h*l[2]-r*l[2])-d*z*(l[2]*k.eye[1]*b-l[0]*g))/m;e.vec3.scale(k.eye,k.eye,h);t(k.eye);return u(k,c)};b.lookAtTiltToEyeTilt=function(c,d,b){d=e.vec3.length(d);b=a.asinClamped(b/
(Math.sqrt(b*b+d*d-2*b*d*Math.cos(Math.PI-c))/Math.sin(c)));return a.rad2deg(c-b)};b.eyeTiltToLookAtTilt=function(c,d,b){c=a.deg2rad(c);d=e.vec3.length(d);return a.asinClamped(b/(d/Math.sin(c)))+c};b.toExtent=function(c,e,b,f,h){function r(a){var c=Math.PI/2;a=p.cyclical2PI.normalize(a,-c);a>c&&(a=Math.PI-a);return a}var q;q=e.latitude;e=e.longitude;var m=k.getLonDeltaForDistance(q,b)/2;b=e-m;e+=m;q=a.deg2rad(q);m=k.earthRadius;q=(1+Math.sin(q))/(1-Math.sin(q));var t=(q+1)*Math.tan(f/m/2);q=1.5*Math.PI-
2*Math.atan(.5*(t+Math.sqrt(4*q+t*t)));f=q+f/m;q=r(q);f=r(f);f<q&&(m=f,f=q,q=m);q=Math.max(a.rad2deg(q),-90);f=Math.min(a.rad2deg(f),90);e=w.monotonic(b,e);180<e-b&&(m=(e-b-180)/2,b+=m,e-=m);m=c.spatialReference&&c.spatialReference.isGeographic?c.spatialReference:l.WGS84;h?(h.xmin=b,h.ymin=q,h.xmax=e,h.ymax=f,h.spatialReference=m):h=new g(b,q,e,f,m);c.spatialReference&&c.spatialReference.isWebMercator&&d.geographicToWebMercator(h,!1,h);return h}})},"esri/views/support/spatialReferenceSupport":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.isSpatialReferenceSupported=function(a,b){return null==a?!1:"2d"===b?!0:"local"===b?!a.isGeographic:a.isWebMercator||a.isWGS84||4490===a.wkid}})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["require","exports","../../core/libs/gl-matrix-2/vec3"],function(n,b,a){function m(a){var e=a*a;0>a&&(e*=-1);return e}Object.defineProperty(b,"__esModule",{value:!0});b.quadraticAccentuation=m;b.resetTransformation=
function(a){a.translation[0]=0;a.translation[1]=0;a.translation[2]=0;a.heading=0;a.tilt=0;return a};b.extractTransformation=function(b,e,f){var g=b.state;b=b.device;e="forward-down"===e.tiltDirection?1:-1;"standard"===b.deviceType?(f.translation[0]=m(g.axes[0]),f.translation[1]=m(g.axes[1]),f.translation[2]=m(g.buttons[7])-m(g.buttons[6]),f.heading=m(g.axes[2]),f.tilt=m(g.axes[3])):"spacemouse"===b.deviceType&&(f.translation[0]=1.2*m(g.axes[0]),f.translation[1]=1.2*m(g.axes[1]),f.translation[2]=2*
-m(g.axes[2]),f.heading=1.2*m(g.axes[5]),f.tilt=1.2*m(g.axes[3]));f.tilt*=e;a.vec3.scale(f.translation,f.translation,1);return f};b.extractTransformationKeyboard=function(a,e){e.translation[0]=a[1]-a[0];e.translation[1]=a[3]-a[2];e.translation[2]=a[4]-a[5];e.heading=a[7]-a[6];e.tilt=a[8]-a[9];e.zoom=a[10]-a[11];return e};b.isZeroTransformation=function(a){return 0===a.translation[0]&&0===a.translation[1]&&0===a.translation[2]&&0===a.heading&&0===a.tilt&&0===a.zoom}})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["require",
"exports","tslib","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(e){function b(a,b){var d,c=e.call(this,!0)||this;c.view=a;c.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:"local"};c.keyToNumber=(d={},d[b.left]=0,d[b.right]=1,d[b.forward]=2,d[b.backward]=3,d[b.up]=4,d[b.down]=5,d[b.headingLeft]=6,d[b.headingRight]=7,d[b.tiltUp]=8,d[b.tiltDown]=9,d[b.zoomIn]=10,d[b.zoomOut]=
11,d);c.registerIncoming("key-down",null,function(a){return c.handleKeyDown(a)});c.registerIncoming("key-up",null,function(a){return c.handleKeyUp(a)});c.registerIncoming("blur",null,function(){return c.handleBlur()});return c}a.__extends(b,e);b.prototype.handleKeyDown=function(a){if(!a.data.native.ctrlKey&&!a.data.native.metaKey){var e=this.keyToNumber[a.data.key];null!=e&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new m.GamepadKeyboardController({view:this.view,
disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(e),a.stopPropagation()))}};b.prototype.handleBlur=function(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)};b.prototype.handleKeyUp=function(a){if(!a.data.native.ctrlKey&&!a.data.native.metaKey){var e=
this.keyToNumber[a.data.key];null!=e&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(e),a.stopPropagation())}};return b}(h.InputHandler);b.KeyboardNavigation=n})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("require exports tslib ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),function(n,
b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function f(a,c){var d=b.call(this,!0)||this;d.view=a;d.registerIncoming("mouse-wheel",c,function(a){return d.handleMouseWheel(a)});return d}a.__extends(f,b);f.prototype.handleMouseWheel=function(a){if(this.view.navigation.mouseWheelZoomEnabled){var c=a.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new h.ZoomStepController({view:this.view,mode:"interaction"}):new e.ZoomStepController({view:this.view,
mode:"interaction"}),this.view.state.switchCameraController(this.cameraController));this.cameraController.zoomStep(-1/60*c.deltaY,m.createScreenPointArray(c.x,c.y));a.preventDefault();a.stopPropagation()}};return f}(f.InputHandler);b.MouseWheelZoom=n})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("require exports tslib ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(e){function b(a,c,b){var d=e.call(this,!0)||this;d.view=a;d.pointerAction=c;d.lastEndTimestamp=0;d.lastTimestamp=0;d.registerIncoming("drag",b,function(a){return d.handleDrag(a)});return d}a.__extends(b,e);b.prototype.handleDrag=function(a){if("mouse"!==a.data.pointerType||f.eventMatchesMousePointerAction(a.data,this.pointerAction)){var c=a.timestamp-this.lastEndTimestamp,c=this.momentum&&this.momentum.active&&40>
c;switch(a.data.action){case "start":case "update":if(c)break;this.controller&&this.controller.active?2<a.data.timestamp-this.lastTimestamp&&(this.controller.update(a.data),this.lastTimestamp=a.timestamp):this.startController(a);break;case "end":case "removed":this.endController(a,!0);break;case "added":this.endController(a,!1),this.startController(a)}a.stopPropagation()}};b.prototype.endController=function(a,c){this.controller&&this.controller.active&&(this.lastEndTimestamp=a.timestamp,a=this.controller.end(a.data),
c&&a&&(this.momentum=a,this.view.state.switchCameraController(this.momentum)));this.controller=null};b.prototype.startController=function(a){this.controller=this.createController();this.view.state.switchCameraController(this.controller);this.controller.begin(a.data);this.lastTimestamp=a.timestamp};b.prototype.createController=function(){return this.view.state.isGlobal?new m.PinchAndPanController({view:this.view}):new h.PinchAndPanController({view:this.view})};return b}(e.InputHandler);b.PinchAndPanNavigation=
n})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("require exports tslib ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../utils/navigationUtils ../../../support/geometryUtils ../../../support/mathUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function r(a){a=b.call(this,a)||this;a.view=null;a.smoothRotation=new p.ExponentialFalloff(.05);a.rotationAxis=c.vec3f64.create();a.panningPlane=A.plane.create();a.smoothScaling=new p.ExponentialFalloff(.05);a.zoomCenterScreen=h.createScreenPointArray();a.zoomMomentumEstimator=new G.ZoomMomentumEstimator;a.rotationMomentumEstimator=new I.RotationMomentumEstimator;a.panSphericalMomentumEstimator=
new H.PanSphericalMomentumEstimator;a.panPlanarMomentumEstimator=new F.PanPlanarMomentumEstimator;a.adjustedSphere=A.sphere.create();a.tmp3d=c.vec3f64.create();a.tmpMat=g.mat4f64.create();a.tmpAxisAngle=A.axisAngle.create();a.tmpScreenPointArray=h.createScreenPointArray();a.beginScreenPoint=h.createScreenPointArray();a.beginScenePoint=c.vec3f64.create();a.screenPickPoint=h.createScreenPointArray();a.panMode=y.PanMode.Horizontal;a.tmpInteractionDirection=c.vec3f64.create();a.constraintOptions={selection:15,
interactionType:0,interactionFactor:0,interactionStartCamera:new C.default,interactionDirection:null,tiltMode:0};return a}a.__extends(r,b);Object.defineProperty(r.prototype,"intersectionHelper",{get:function(){return this.view.sceneIntersectionHelper},enumerable:!0,configurable:!0});r.prototype.begin=function(a){if(this.active){var c=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=c;this.rotationMomentumEstimator.enabled=c;this.panPlanarMomentumEstimator.enabled=c;this.panSphericalMomentumEstimator.enabled=
c;this.beginHeading=-B.cyclicalPI.normalize(m.deg2rad(this.view.camera.heading));this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.smoothRotation.reset();h.screenPointObjectToArray(a.center,this.screenPickPoint);l.vec2.copy(this.beginScreenPoint,this.screenPickPoint);c=q.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,this.screenPickPoint,!0);this.scenePickPoint=c.scenePickPoint;this.sphere=c.sphere;d.vec3.copy(this.beginScenePoint,this.scenePickPoint);
this.panMode=q.decidePanMode(this.beginCamera,this.sphere,this.scenePickPoint);this.panMode===y.PanMode.Vertical&&(this.beginCamera.aboveGround?this.preparePlanarPanModeOverground(a):this.preparePlanarPanMode(a));this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};r.prototype.preparePlanarPanModeOverground=function(a){var e=d.vec3.negate(this.tmp3d,this.beginCamera.viewForward);A.plane.fromPositionAndNormal(this.scenePickPoint,e,this.panningPlane);var b=h.createScreenPointArray(this.screenPickPoint[0],
0),e=c.vec3f64.create(),f=d.vec3.length(this.beginCamera.eye);this.adjustedSphere.radius=f<this.sphere.radius?f-100:this.sphere.radius;q.sphereOrPlanePointFromScreenPoint(this.adjustedSphere,this.beginCamera,b,e);b=h.createRenderScreenPointArray3();this.beginCamera.projectPoint(e,b);this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],.9*b[1]);this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&A.plane.fromPositionAndNormal(this.scenePickPoint,A.plane.normal(this.panningPlane),
this.panningPlane);a=h.screenPointObjectToArray(a.center,this.tmpScreenPointArray);q.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,a,this.beginScenePoint)};r.prototype.preparePlanarPanMode=function(a){var c=d.vec3.negate(this.tmp3d,this.beginCamera.viewForward);A.plane.fromPositionAndNormal(this.scenePickPoint,c,this.panningPlane);var e=A.sphere.angleToSilhouette(this.sphere,this.currentCamera.eye),c=A.axisAngle.fromPoints(this.currentCamera.eye,this.scenePickPoint,this.tmpAxisAngle),
e=-c[3]-(this.currentCamera.aboveGround?.25:.025)*e;if(0<e){var b=f.mat4.identity(this.tmpMat);f.mat4.rotate(b,b,-e,c);d.vec3.subtract(this.scenePickPoint,this.scenePickPoint,this.sphere.center);d.vec3.transformMat4(this.scenePickPoint,this.scenePickPoint,b);d.vec3.add(this.scenePickPoint,this.scenePickPoint,this.sphere.center);A.plane.setOffsetFromPoint(this.panningPlane,this.scenePickPoint,this.panningPlane);a=h.screenPointObjectToArray(a.center,this.tmpScreenPointArray);q.intersectPlaneFromScreenPoint(this.panningPlane,
this.beginCamera,a,this.beginScenePoint)}};r.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var c=1<a.pointers.size;this.panMode===y.PanMode.Horizontal?(c&&this.zoomSpherical(a),this.panningSpherical(a),c&&this.rotateSpherical(a)):(c&&this.zoomPlanar(a),this.panningPlanar(a),c&&this.rotatePlanar(a));this.currentCamera.markViewDirty()}};r.prototype.end=function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();if(a=this.zoomMomentumEstimator.evaluateMomentum())return this.panMode===
y.PanMode.Horizontal?new w.ZoomSphericalMomentumController({view:this.view,momentum:a,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere.radius}):new z.ZoomPlanarMomentumController({view:this.view,momentum:a,zoomCenter:this.beginScenePoint});if(a=this.rotationMomentumEstimator.evaluateMomentum())return new v.RotationMomentumController({view:this.view,momentum:a,center:this.sphere.center,axis:this.rotationAxis});if(this.panMode===y.PanMode.Horizontal){if(a=this.panSphericalMomentumEstimator.evaluateMomentum())return new u.PanSphericalMomentumController({view:this.view,
momentum:a})}else if(a=this.panPlanarMomentumEstimator.evaluateMomentum())return new t.PanPlanarMomentumController({view:this.view,momentum:a});return null};r.prototype.zoomSpherical=function(a){var c=this.beginRadius/a.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(a.radius,40),120);this.smoothScaling.update(c);q.applyZoomOnSphere(this.sphere,this.currentCamera,this.smoothScaling.value);h.screenPointObjectToArray(a.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,
.001*a.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=k.pixelDistanceToInteractionFactor(a.radius-this.beginRadius);k.applyAll(this.view,this.currentCamera,this.constraintOptions)};r.prototype.panningSpherical=function(a){var c=h.screenPointObjectToArray(a.center,this.tmpScreenPointArray);q.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,c,this.tmp3d);q.preserveHeadingThreshold(this.beginScenePoint,d.vec3.dot(this.currentCamera.up,this.beginScenePoint),
this.sphere.radius,this.beginHeading,this.view.camera.tilt,this.beginCamera)?(q.applyPanSphericalPreserveHeading(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(c,this.tmp3d,.001*a.timestamp,this.beginCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(q.applyPanSphericalDirectRotation(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,
!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(c,this.tmp3d,.001*a.timestamp,this.beginCamera,this.sphere.radius,this.view.camera.tilt));this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=k.pixelDistanceToInteractionFactor(this.screenPickPoint,c);k.applyAll(this.view,this.currentCamera,this.constraintOptions)};r.prototype.rotateSpherical=function(a){d.vec3.normalize(this.rotationAxis,this.scenePickPoint);this.currentCamera.aboveGround||d.vec3.negate(this.rotationAxis,
this.rotationAxis);var c=this.smoothRotation.value,e=q.normalizeRotationDelta(a.angle-c),c=c+e;this.smoothRotation.gain=.00125*Math.min(Math.max(a.radius,40),120);this.smoothRotation.update(c);e=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(e,.001*a.timestamp);q.applyRotation(this.currentCamera,this.sphere.center,A.axisAngle.wrapAxisAngle(this.rotationAxis,e));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=k.pixelDistanceToInteractionFactor(a.radius*
c);k.applyAll(this.view,this.currentCamera,this.constraintOptions)};r.prototype.panningPlanar=function(a){var c=h.screenPointObjectToArray(a.center,this.tmpScreenPointArray);q.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,c,this.tmp3d)&&(q.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(c,this.tmp3d,.001*a.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=k.pixelDistanceToInteractionFactor(this.beginScreenPoint,
c),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),k.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};r.prototype.zoomPlanar=function(a){var c=this.beginRadius/a.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(a.radius,40),120);this.smoothScaling.update(c);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*a.timestamp);q.applyZoomToPoint(this.currentCamera,
this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=k.pixelDistanceToInteractionFactor(a.radius-this.beginRadius);k.applyAll(this.view,this.currentCamera,this.constraintOptions)};r.prototype.rotatePlanar=function(a){d.vec3.copy(this.rotationAxis,this.beginScenePoint);this.currentCamera.aboveGround||d.vec3.negate(this.rotationAxis,this.rotationAxis);var c=this.smoothRotation.value,
e=a.angle-c,e=q.normalizeRotationDelta(e);this.smoothRotation.gain=.00125*Math.min(Math.max(a.radius,40),120);this.smoothRotation.update(c+e);c=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(c,.001*a.timestamp);q.applyRotation(this.currentCamera,this.sphere.center,A.axisAngle.wrapAxisAngle(this.rotationAxis,c));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=k.pixelDistanceToInteractionFactor(a.radius*c);k.applyAll(this.view,this.currentCamera,
this.constraintOptions)};a.__decorate([e.property({constructOnly:!0})],r.prototype,"view",void 0);return r=a.__decorate([e.subclass("esri.views.3d.state.controllers.global.PinchAndPanController")],r)}(r.InteractiveController);b.PinchAndPanController=n})},"esri/views/3d/input/util":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a){this._gain=a}a.prototype.reset=function(a){this._value=a};Object.defineProperty(a.prototype,
"gain",{set:function(a){this._gain=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"value",{get:function(){return void 0===this._value?0:this._value},enumerable:!0,configurable:!0});a.prototype.update=function(a){this._value=void 0===this._value?a:this._gain*a+(1-this._gain)*this._value};return a}();b.ExponentialFalloff=n})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("require exports tslib ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController".split(" "),
function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function f(a){a=b.call(this,a)||this;a.interactionType=4;a.tmpPan=e.vec3f64.create();return a}a.__extends(f,b);f.prototype.momentumStep=function(a,c){a=this.momentum.value(a);h.vec3.scale(this.tmpPan,this.momentum.direction,a);h.vec3.subtract(c.eye,c.eye,this.tmpPan);h.vec3.subtract(c.center,c.center,this.tmpPan);c.markViewDirty();this.constraintOptions.interactionDirection=this.tmpPan};a.__decorate([m.property({constructOnly:!0})],
f.prototype,"momentum",void 0);return f=a.__decorate([m.subclass("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],f)}(f.MomentumController);b.PanPlanarMomentumController=n})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("require exports tslib ../../../../../core/accessorSupport/decorators ../../../../ViewAnimation ../../../camera/constraintUtils ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),function(n,b,a,m,h,e,f,g){Object.defineProperty(b,
"__esModule",{value:!0});n=function(b){function d(a){a=b.call(this,a)||this;a.view=null;a.beginCamera=new g.default;a.elapsedTimeSec=0;a.constraintOptions={selection:15,interactionType:4,interactionFactor:0,interactionStartCamera:new g.default,interactionDirection:null,tiltMode:0};return a}a.__extends(d,b);d.prototype.initialize=function(){this.constraintOptions.interactionType=this.interactionType;this.viewAnimation=new h};Object.defineProperty(d.prototype,"steppingFinished",{get:function(){return this.momentum.isFinished(this.elapsedTimeSec)},
enumerable:!0,configurable:!0});d.prototype.onControllerStart=function(a){this.beginCamera.copyFrom(a);this.constraintOptions.interactionStartCamera=this.beginCamera;b.prototype.onControllerStart.call(this,a)};d.prototype.stepController=function(a,d){d.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=a;this.momentumStep(this.elapsedTimeSec,d);e.applyAll(this.view,d,this.constraintOptions)};a.__decorate([m.property({constructOnly:!0})],d.prototype,"view",void 0);return d=a.__decorate([m.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],
d)}(f.AnimationController);b.MomentumController=n})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("require exports tslib ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils".split(" "),function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});var l=e.vec3f64.create(),d=e.vec3f64.create();n=function(c){function e(a){a=
c.call(this,a)||this;a.interactionType=4;return a}a.__extends(e,c);e.prototype.momentumStep=function(a,c){var e=this.momentum.value1(a);a=this.momentum.value2(a);h.vec3.copy(d,c.eye);h.vec3.normalize(d,d);h.vec3.cross(this.momentum.axis2,d,this.momentum.axis1);g.applyRotationWithTwoAxes(c,l,this.momentum.axis1,e,this.momentum.axis2,a)};a.__decorate([m.property({constructOnly:!0})],e.prototype,"momentum",void 0);return e=a.__decorate([m.subclass("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],
e)}(f.MomentumController);b.PanSphericalMomentumController=n})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("require exports tslib ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(e){function d(a){a=e.call(this,a)||this;a.interactionType=
2;return a}a.__extends(d,e);Object.defineProperty(d.prototype,"center",{set:function(a){this._set("center",h.vec3f64.clone(a))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"axis",{set:function(a){this._set("axis",h.vec3f64.clone(a))},enumerable:!0,configurable:!0});d.prototype.momentumStep=function(a,d){a=this.momentum.value(a);f.applyRotation(d,this.center,g.axisAngle.wrapAxisAngle(this.axis,a))};a.__decorate([m.property({constructOnly:!0})],d.prototype,"momentum",void 0);a.__decorate([m.property({constructOnly:!0})],
d.prototype,"center",null);a.__decorate([m.property({constructOnly:!0})],d.prototype,"axis",null);return d=a.__decorate([m.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],d)}(e.MomentumController);b.RotationMomentumController=n})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("require exports tslib ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../support/mathUtils".split(" "),
function(n,b,a,m,h,e,f,g,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(d){function c(a){a=d.call(this,a)||this;a.interactionType=1;a.constraintOptions.interactionDirection=e.vec3f64.create();return a}a.__extends(c,d);Object.defineProperty(c.prototype,"zoomCenter",{set:function(a){this._set("zoomCenter",e.vec3f64.clone(a))},enumerable:!0,configurable:!0});c.prototype.momentumStep=function(a,c){h.vec3.copy(this.constraintOptions.interactionDirection,c.eye);a=this.momentum.valueDelta(0,
a);g.applyZoomToPoint(c,this.zoomCenter,a,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionDirection=l.directionFromTo(this.constraintOptions.interactionDirection,c.eye,this.constraintOptions.interactionDirection)};a.__decorate([m.property({constructOnly:!0})],c.prototype,"momentum",void 0);a.__decorate([m.property({constructOnly:!0})],c.prototype,"zoomCenter",null);return c=a.__decorate([m.subclass("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],
c)}(f.MomentumController);b.ZoomPlanarMomentumController=n})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("require exports tslib ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ./MomentumController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),function(n,b,a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",{value:!0});
n=function(c){function b(a){a=c.call(this,a)||this;a.interactionType=1;a.radius=0;a.tmpSceneCenter=e.vec3f64.create();a.tmpZoomAxisAngle=d.axisAngle.create();a.sphere=d.sphere.create();return a}a.__extends(b,c);Object.defineProperty(b.prototype,"screenCenter",{set:function(a){this._set("screenCenter",m.createScreenPointArray(a[0],a[1]))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"sceneCenter",{set:function(a){this._set("sceneCenter",e.vec3f64.clone(a))},enumerable:!0,configurable:!0});
b.prototype.initialize=function(){this.sphere.radius=this.radius};b.prototype.momentumStep=function(a,c){a=this.momentum.valueDelta(0,a);l.applyZoomOnSphere(this.sphere,c,a);this.constraintOptions.interactionType=1;f.applyAll(this.view,c,this.constraintOptions);l.sphereOrPlanePointFromScreenPoint(this.sphere,c,this.screenCenter,this.tmpSceneCenter);d.axisAngle.fromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle);l.applyRotation(c,this.sphere.center,this.tmpZoomAxisAngle);this.constraintOptions.interactionType=
4};a.__decorate([h.property({constructOnly:!0})],b.prototype,"momentum",void 0);a.__decorate([h.property({constructOnly:!0})],b.prototype,"screenCenter",null);a.__decorate([h.property({constructOnly:!0})],b.prototype,"sceneCenter",null);a.__decorate([h.property({constructOnly:!0})],b.prototype,"radius",void 0);return b=a.__decorate([h.subclass("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],b)}(g.MomentumController);b.ZoomSphericalMomentumController=n})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("require exports tslib ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),
function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});var g=function(e){function d(a,d,b,f,g){a=e.call(this,a,d,b)||this;a.sceneVelocity=f;a.direction=g;return a}a.__extends(d,e);d.prototype.value=function(a){return e.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,a)};return d}(f.Momentum);b.PanPlanarMomentum=g;n=function(){function a(a,c,b){void 0===a&&(a=300);void 0===c&&(c=12);void 0===b&&(b=.84);this.minimumInitialVelocity=a;this.stopVelocity=c;this.friction=
b;this.enabled=!0;this.time=new e.FilteredFiniteDifference(.6);this.screen=[new e.FilteredFiniteDifference(.4),new e.FilteredFiniteDifference(.4)];this.scene=[new e.FilteredFiniteDifference(.6),new e.FilteredFiniteDifference(.6),new e.FilteredFiniteDifference(.6)];this.tmpDirection=h.vec3f64.create()}a.prototype.add=function(a,c,e){!this.enabled||this.time.hasLastValue&&.015>this.time.computeDelta(e)||(this.screen[0].update(a[0]),this.screen[1].update(a[1]),this.scene[0].update(c[0]),this.scene[1].update(c[1]),
this.scene[2].update(c[2]),this.time.update(e))};a.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};a.prototype.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,c=this.screen[1].filteredDelta,a=Math.sqrt(a*a+c*c)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,
this.friction)};a.prototype.createMomentum=function(a,c,e){m.vec3.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);var d=m.vec3.length(this.tmpDirection);0<d&&m.vec3.scale(this.tmpDirection,this.tmpDirection,1/d);return new g(a,c,e,d/this.time.filteredDelta,this.tmpDirection)};return a}();b.PanPlanarMomentumEstimator=n})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,
"__esModule",{value:!0});n=function(){function a(a){this.gain=a}a.prototype.update=function(a){if(this.hasLastValue){var b=this.computeDelta(a);this.updateDelta(b)}this.lastValue=a};a.prototype.reset=function(){this.filteredDelta=this.lastValue=void 0};Object.defineProperty(a.prototype,"hasLastValue",{get:function(){return void 0!==this.lastValue},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasFilteredDelta",{get:function(){return void 0!==this.filteredDelta},enumerable:!0,
configurable:!0});a.prototype.computeDelta=function(a){return a-this.lastValue};a.prototype.updateDelta=function(a){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*a:a};return a}();b.FilteredFiniteDifference=n})},"esri/views/navigation/Momentum":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a,b,e){this._initialVelocity=a;this._stopVelocity=b;this._friction=e;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/
this._stopVelocity)/Math.log(1-this._friction))}Object.defineProperty(a.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0});a.prototype.isFinished=function(a){return a>this.duration};Object.defineProperty(a.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});a.prototype.value=function(a){return this.valueFromInitialVelocity(this._initialVelocity,a)};a.prototype.valueDelta=function(a,b){var e=this.value(a);return this.value(a+
b)-e};a.prototype.valueFromInitialVelocity=function(a,b){b=Math.min(b,this.duration);var e=1-this.friction;return a*(Math.pow(e,b)-1)/Math.log(e)};return a}();b.Momentum=n})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("require exports tslib ../../core/libs/gl-matrix-2/vec2f64 ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),function(n,b,a,m,h,e,f,g,l,
d){Object.defineProperty(b,"__esModule",{value:!0});var c=function(c){function d(a,d,e,b,f,g,k){void 0===g&&(g=0);a=c.call(this,a,d,e)||this;a.angularVelocity1=b;a.axis1=f;a.angularVelocity2=g;a.axis2=k;return a}a.__extends(d,c);d.prototype.value1=function(a){return c.prototype.valueFromInitialVelocity.call(this,this.angularVelocity1,a)};d.prototype.value2=function(a){return c.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,a)};return d}(d.Momentum);b.PanSphericalMomentum=c;n=function(){function a(a,
c,d){void 0===a&&(a=300);void 0===c&&(c=12);void 0===d&&(d=.84);this.minimumInitialVelocity=a;this.stopVelocity=c;this.friction=d;this.enabled=!0;this.tmpAxis1=e.vec3f64.create();this.tmpAxis2=e.vec3f64.create();this.tmpAngles=m.vec2f64.create();this.time=new g.FilteredFiniteDifference(.3);this.screen=[new g.FilteredFiniteDifference(.4),new g.FilteredFiniteDifference(.4)];this.angle1=new l.FilteredValue(.6);this.angle2=new l.FilteredValue(.6);this.axis1=e.vec3f64.create();this.axis2=e.vec3f64.create();
this.lastScene=e.vec3f64.create()}a.prototype.addMomentumDirectRotation=function(a,c,d,e,b,g){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(d))return;e=f.rotationAngleAndAxisDirectRotation(this.lastScene,c,this.tmpAxis2,e,b,g);this.angle2.update(0);1E-5>h.vec3.squaredLength(this.tmpAxis2)?e=0:h.vec3.normalize(this.axis1,this.tmpAxis2);this.angle1.update(e);h.vec3.copy(this.lastScene,c)}this.screen[0].update(a[0]);this.screen[1].update(a[1]);this.time.update(d)}};a.prototype.addMomentumPreserveHeading=
function(a,c,d,e,b,g,k){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(d))return;f.rotationAnglesAndAxesHeadingPreserving(this.lastScene,c,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,e,b,g,k,!1);1E-5>h.vec3.squaredLength(this.tmpAxis2)?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),h.vec3.normalize(this.axis1,this.tmpAxis1),h.vec3.normalize(this.axis2,this.tmpAxis2));h.vec3.copy(this.lastScene,c)}this.screen[0].update(a[0]);
this.screen[1].update(a[1]);this.time.update(d)}};a.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle1.reset();this.angle2.reset();this.time.reset()};a.prototype.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,c=this.screen[1].filteredDelta,a=Math.sqrt(a*a+c*c)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};
a.prototype.createMomentum=function(a,d,e){return new c(a,d,e,this.angle1.filteredValue/this.time.filteredDelta,this.axis1,this.angle2.filteredValue/this.time.filteredDelta,this.axis2)};return a}();b.PanSphericalMomentumEstimator=n})},"esri/views/navigation/FilteredValue":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a){this.gain=a}a.prototype.update=function(a){this.filteredValue=this.hasFilteredValue?(1-this.gain)*
this.filteredValue+this.gain*a:a};a.prototype.reset=function(){this.filteredValue=void 0};Object.defineProperty(a.prototype,"hasFilteredValue",{get:function(){return void 0!==this.filteredValue},enumerable:!0,configurable:!0});return a}();b.FilteredValue=n})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["require","exports","tslib","./MomentumEstimator"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(a,e,l,d){void 0===a&&(a=3);void 0===
e&&(e=.01);void 0===l&&(l=.95);void 0===d&&(d=12);return b.call(this,a,e,l,d)||this}a.__extends(e,b);e.prototype.add=function(a,e){if(this.value.hasLastValue){var f=this.value.lastValue;for(a-=f;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;a=f+a}b.prototype.add.call(this,a,e)};return e}(m.MomentumEstimator);b.RotationMomentumEstimator=n})},"esri/views/navigation/MomentumEstimator":function(){define(["require","exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(n,
b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function e(a,e,b,d){void 0===a&&(a=2.5);void 0===e&&(e=.01);void 0===b&&(b=.95);void 0===d&&(d=12);this.minimumInitialVelocity=a;this.stopVelocity=e;this.friction=b;this.maxVelocity=d;this.enabled=!0;this.value=new m.FilteredFiniteDifference(.8);this.time=new m.FilteredFiniteDifference(.3)}e.prototype.add=function(a,e){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(e))return;if(this.value.hasFilteredDelta){var b=
this.value.computeDelta(a);0>this.value.filteredDelta*b&&this.value.reset()}}this.time.update(e);this.value.update(a)}};e.prototype.reset=function(){this.value.reset();this.time.reset()};e.prototype.evaluateMomentum=function(){if(!this.enabled||!this.value.hasFilteredDelta)return null;var e=this.value.filteredDelta/this.time.filteredDelta,e=a.clamp(e,-this.maxVelocity,this.maxVelocity);return Math.abs(e)<this.minimumInitialVelocity?null:this.createMomentum(e,this.stopVelocity,this.friction)};e.prototype.createMomentum=
function(a,e,b){return new h.Momentum(a,e,b)};return e}();b.MomentumEstimator=n})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["require","exports","tslib","./Momentum","./MomentumEstimator"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});var e=function(e){function b(a,d,c){return e.call(this,a,d,c)||this}a.__extends(b,e);b.prototype.value=function(a){a=e.prototype.value.call(this,a);return Math.exp(a)};b.prototype.valueDelta=function(a,d){var c=e.prototype.value.call(this,
a);a=e.prototype.value.call(this,a+d);return Math.exp(a-c)};return b}(m.Momentum);b.ZoomMomentum=e;n=function(b){function f(a,d,c,e){void 0===a&&(a=2.5);void 0===d&&(d=.01);void 0===c&&(c=.95);void 0===e&&(e=12);return b.call(this,a,d,c,e)||this}a.__extends(f,b);f.prototype.add=function(a,d){b.prototype.add.call(this,Math.log(a),d)};f.prototype.createMomentum=function(a,d,c){return new e(a,d,c)};return f}(h.MomentumEstimator);b.ZoomMomentumEstimator=n})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("require exports tslib ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../support/geometryUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q){Object.defineProperty(b,"__esModule",{value:!0});var y;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(y=b.PanMode||(b.PanMode={}));var A=g.vec3f64.fromValues(0,0,1),B=16/180*Math.PI;n=function(c){function b(a){a=c.call(this,a)||this;a.view=null;a.rotationValueSmooth=new d.ExponentialFalloff(.05);a.scalingValueSmooth=new d.ExponentialFalloff(.05);a.planeHorizontal=u.plane.create();a.planeVertical=u.plane.create();a.rotationMomentumEstimator=
new w.RotationMomentumEstimator;a.panMomentumEstimator=new z.PanPlanarMomentumEstimator(300,12,.9);a.zoomMomentumEstimator=new q.ZoomMomentumEstimator;a.beginCenter=g.vec3f64.create();a.tmpPoints=[];a.beginCenterScreen=h.createScreenPointArray();a.tmpCentroid3d=g.vec3f64.create();a.tmpCentroid2d=h.createScreenPointArray();a.tmp2d=h.createScreenPointArray();a.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new v.default,interactionDirection:null,tiltMode:0};
return a}a.__extends(b,c);Object.defineProperty(b.prototype,"intersectionHelper",{get:function(){return this.view.sceneIntersectionHelper},enumerable:!0,configurable:!0});b.prototype.begin=function(a){if(this.active){var c=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=c;this.rotationMomentumEstimator.enabled=c;this.panMomentumEstimator.enabled=c;this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();
h.screenPointObjectToArray(a.center,this.beginCenterScreen);u.plane.fromNormalAndOffset(A,0,this.planeHorizontal);c=g.vec3f64.create();this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,c);var d=g.vec3f64.create();f.vec3.negate(d,this.beginCamera.viewForward);var e=g.vec3f64.create();f.vec3.copy(e,A);var b=f.vec3.dot(d,e);this.panMode=m.asinClamped(0>b?-b:b)>=B?y.Horizontal:y.Vertical;u.plane.setOffsetFromPoint(this.planeHorizontal,c,this.planeHorizontal);this.beginCamera.aboveGround||
u.plane.negate(this.planeHorizontal,this.planeHorizontal);this.panMode===y.Vertical?(f.vec3.scale(e,e,b),f.vec3.subtract(this.planeVertical,d,e),f.vec3.normalize(this.planeVertical,this.planeVertical),u.plane.setOffsetFromPoint(this.planeVertical,c,this.planeVertical),this.computePlanePoints(a.pointers,this.planeVertical,this.beginCamera,this.tmpPoints)):this.computePlanePoints(a.pointers,this.planeHorizontal,this.beginCamera,this.tmpPoints);t.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};
b.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var c=1<a.pointers.size,d=this.panMode===y.Horizontal?this.planeHorizontal:this.planeVertical,e=this.beginCenter;if(c){var b=this.beginRadius/a.radius,f=.001875*Math.min(Math.max(a.radius,40),120);this.scalingValueSmooth.gain=f;this.scalingValueSmooth.update(b);t.applyZoomToPoint(this.currentCamera,e,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,
.001*a.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=l.pixelDistanceToInteractionFactor(Math.abs(a.radius-this.beginRadius));l.applyAll(this.view,this.currentCamera,this.constraintOptions)}this.computePlanePoints(a.pointers,d,this.currentCamera,this.tmpPoints);t.centroid(this.tmpPoints,this.tmpCentroid3d);h.screenPointObjectToArray(a.center,this.tmpCentroid2d);t.applyPanPlanar(this.currentCamera,e,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,
this.tmpCentroid3d,.001*a.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=l.pixelDistanceToInteractionFactor(this.beginCenterScreen,this.tmpCentroid2d);l.applyAll(this.view,this.currentCamera,this.constraintOptions);c&&(c=this.planeHorizontal,d=this.rotationValueSmooth.value,b=t.normalizeRotationDelta(a.angle-d),f=.00125*Math.min(Math.max(a.radius,40),120),this.rotationValueSmooth.gain=f,this.rotationValueSmooth.update(d+b),f=this.rotationValueSmooth.value-
this.beginAngle,this.rotationMomentumEstimator.add(f,.001*a.timestamp),t.applyRotation(this.currentCamera,e,u.axisAngle.wrapAxisAngle(c,f)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=l.pixelDistanceToInteractionFactor(Math.abs(a.radius*f)),l.applyAll(this.view,this.currentCamera,this.constraintOptions));this.currentCamera.markViewDirty()}};b.prototype.end=function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();return(a=this.zoomMomentumEstimator.evaluateMomentum())?
new r.ZoomPlanarMomentumController({view:this.view,momentum:a,zoomCenter:this.beginCenter}):(a=this.rotationMomentumEstimator.evaluateMomentum())?new p.RotationMomentumController({view:this.view,momentum:a,center:this.beginCenter,axis:u.plane.normal(this.planeHorizontal)}):(a=this.panMomentumEstimator.evaluateMomentum())?new k.PanPlanarMomentumController({view:this.view,momentum:a}):null};b.prototype.computePlanePoints=function(a,c,d,e){e.length=a.size;var b=this.tmp2d,f=0;a.forEach(function(a){b[0]=
a.x;b[1]=a.y;void 0===e[f]&&(e[f]=g.vec3f64.create());t.intersectPlaneFromScreenPoint(c,d,b,e[f]);f+=1});return e};a.__decorate([e.property({constructOnly:!0})],b.prototype,"view",void 0);return b=a.__decorate([e.subclass("esri.views.3d.state.controllers.local.PinchAndPanController")],b)}(c.InteractiveController);b.PinchAndPanController=n})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["require","exports","tslib","../../../input/InputHandler"],function(n,b,a,m){Object.defineProperty(b,
"__esModule",{value:!0});n=function(b){function e(a,e){var f=b.call(this,!0)||this;f.view=a;f.registerIncoming("pointer-down",e,function(){return f.view.state.stopActiveCameraController()});return f}a.__extends(e,b);return e}(m.InputHandler);b.PointerDownCancelAnimation=n})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["require","exports","tslib","./SingleKey"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(a,e,l){l=b.call(this,
e,l)||this;l.view=a;l.key=e;return l}a.__extends(e,b);e.prototype.activate=function(){this.view.goTo({heading:0}).catch(function(){})};return e}(m.SingleKey);b.SingleKeyResetHeading=n})},"esri/views/3d/input/handlers/SingleKey":function(){define(["require","exports","tslib","../../../input/InputHandler"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(a,e){var f=b.call(this,!0)||this;f.key=a;f.registerIncoming("key-down",e,function(a){return f._handleKeyDown(a)});
return f}a.__extends(e,b);e.prototype._handleKeyDown=function(a){a.data.key===this.key&&(this.activate(),a.stopPropagation())};return e}(m.InputHandler);b.SingleKey=n})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["require","exports","tslib","./SingleKey"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(a,e,l){l=b.call(this,e,l)||this;l.view=a;l.key=e;return l}a.__extends(e,b);e.prototype.activate=function(){this.view.goTo({tilt:0}).catch(function(){})};
return e}(m.SingleKey);b.SingleKeyResetTilt=n})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define("require exports tslib ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(e){function b(a,d){void 0===d&&(d=!1);var c=e.call(this,!0)||this;c.view=a;c.invert=d;c.registerIncoming("vertical-two-finger-drag",function(a){return c.handleTwoFinger(a)});
return c}a.__extends(b,e);b.prototype.handleTwoFinger=function(a){var d=m.createScreenPointArray(0,a.data.delta*(this.invert?-1:1));switch(a.data.action){case "begin":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=new h.RotateController({view:this.view,pivot:"center"});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);break;case "update":this.cameraController&&this.cameraController.update(d);break;case "end":this.cameraController&&
(this.cameraController.end(),this.cameraController=null)}};return b}(e.InputHandler);b.TwoFingerTilt=n})},"esri/views/input/BrowserEventSource":function(){define("require exports ../../core/has ../../core/screenUtils ../../core/libs/pep/pep ./keys ./gamepad/GamepadSource".split(" "),function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});var g=a("trident"),l=a("edge"),d=a("chrome"),c=a("ff"),k=a("safari");n=function(){function a(a,c){var d=this;this.input=c;this._active={};this._activePointerCaptures=
new Set;this._keyDownState=new Set;this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=a;h.applyLocal(a);a.getAttribute("tabindex")||a.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,
"pointer-capture-lost":this._handlePointerCaptureLost};this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new f.GamepadSource(a,this.input);this._gamepadSource.onEvent=function(a){return d._callback("gamepad",a)}}a.prototype.destroy=function(){var a=this;this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(function(c){a._releasePointerCaptureSafe(c)});this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=
null);this._activePointerCaptures=null;this._removeTouchAction();this._element.removeEventListener("keydown",this._preventAltKeyDefault)};Object.defineProperty(a.prototype,"browserTouchPanningEnabled",{get:function(){return this._browserTouchPanningEnabled},set:function(a){this._browserTouchPanningEnabled=a;this._updateTouchAction();this._updateTouchEventHandling()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"onEventReceived",{set:function(a){this._callback=a},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"activeEvents",{set:function(a){var c=this,d;for(d in this._active)a&&a.has(d)||(this._element.removeEventListener(p[d],this._active[d]),delete this._active[d]);a&&a.forEach(function(a){if(!c._active[a]&&p[a]){var d=(c._eventHandlers[a]||c._handleDefault).bind(c,a);c._element.addEventListener(p[a],d);c._active[a]=d}});this._gamepadSource.hasEventListeners=a&&a.has("gamepad")},enumerable:!0,configurable:!0});a.prototype.setPointerCapture=function(a,
c){c?(this._element.setPointerCapture(a.pointerId),this._activePointerCaptures.add(a.pointerId)):(this._releasePointerCaptureSafe(a.pointerId),this._activePointerCaptures.delete(a.pointerId))};a.prototype._updateTouchAction=function(){this._element.classList.remove(this._browserTouchPanningEnabled?"esri-view-surface--touch-none":"esri-view-surface--touch-pan");this._element.classList.add(this._browserTouchPanningEnabled?"esri-view-surface--touch-pan":"esri-view-surface--touch-none")};a.prototype._updateTouchEventHandling=
function(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};a.prototype._removeTouchAction=function(){this._element.classList.remove("esri-view-surface--touch-none");this._element.classList.remove("esri-view-surface--touch-pan");this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};a.prototype._releasePointerCaptureSafe=function(a){try{this._element.hasPointerCapture&&
!this._element.hasPointerCapture(a)||this._element.releasePointerCapture(a)}catch(u){}};a.prototype._updateNormalizedPointerLikeEvent=function(c,d){c=m.createScreenPointFromNativeEvent(this._element,c);a.test.disableSubpixelCoordinates&&(c.x=Math.round(c.x),c.y=Math.round(c.y));d.x=c.x;d.y=c.y;return d};a.prototype._handleKey=function(a,c){var d=e.eventKey(c);d&&"key-up"===a&&this._keyDownState.delete(d);c={native:c,key:d,repeat:d&&this._keyDownState.has(d)};d&&"key-down"===a&&this._keyDownState.add(c.key);
this._callback(a,c)};a.prototype._handlePointer=function(a,c){c=this._updateNormalizedPointerLikeEvent(c,{native:c,x:0,y:0,pointerType:c.pointerType,button:c.button,buttons:c.buttons,eventId:this._eventId++});this._callback(a,c)};a.prototype._handlePointerPreventDefault=function(a,c){var d=this._updateNormalizedPointerLikeEvent(c,{native:c,x:0,y:0,pointerType:c.pointerType,button:c.button,buttons:c.buttons,eventId:this._eventId++});c.preventDefault();this._callback(a,d)};a.prototype._handleMouseWheel=
function(a,e){var b=e.deltaY;switch(e.deltaMode){case 0:if(g||l)b=b/document.documentElement.clientHeight*600;break;case 1:b*=30;break;case 2:b*=900}g||l?b*=.7:d||k?b*=.6:c&&(b*=1.375);var f=Math.abs(b);100<f&&(b=b/f*200/(1+Math.exp(-.02*(f-100))));e=this._updateNormalizedPointerLikeEvent(e,{native:e,x:0,y:0,deltaY:b});this._callback(a,e)};a.prototype._handlePointerCaptureLost=function(a,c){this._activePointerCaptures.delete(c.pointerId);this._handleDefault(a,c)};a.prototype._handleDefault=function(a,
c){var d={native:c};c.preventDefault();this._callback(a,d)};a.prototype._preventAltKeyDefault=function(a){"Alt"===a.key&&a.preventDefault()};a.prototype._preventMultiTouchPanning=function(a){1<a.touches.length&&a.preventDefault()};a.test={disableSubpixelCoordinates:!1};return a}();b.BrowserEventSource=n;var p={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture",
"context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"}})},"esri/core/libs/pep/pep":function(){define(function(){function n(a,e){e=e||Object.create(null);var b=document.createEvent("Event");b.initEvent(a,e.bubbles||!1,e.cancelable||!1);a=2;for(var f;a<d.length;a++)f=d[a],b[f]=e[f]||c[a];b.buttons=e.buttons||0;a=0;a=e.pressure&&b.buttons?e.pressure:b.buttons?.5:0;b.x=b.clientX;b.y=b.clientY;b.pointerId=e.pointerId||
0;b.width=e.width||0;b.height=e.height||0;b.pressure=a;b.tiltX=e.tiltX||0;b.tiltY=e.tiltY||0;b.twist=e.twist||0;b.tangentialPressure=e.tangentialPressure||0;b.pointerType=e.pointerType||"";b.hwTimestamp=e.hwTimestamp||0;b.isPrimary=e.isPrimary||!1;return b}function b(){this.array=[];this.size=0}function a(a,c,d,e){this.addCallback=a.bind(e);this.removeCallback=c.bind(e);this.changedCallback=d.bind(e);B&&(this.observer=new B(this.mutationWatcher.bind(this)))}function m(a){return"body /shadow-deep/ "+
h(a)}function h(a){return'[touch-action\x3d"'+a+'"]'}function e(a){return"{ -ms-touch-action: "+a+"; touch-action: "+a+"; }"}function f(){if(I){F.forEach(function(a){String(a)===a?(H+=h(a)+e(a)+"\n",G&&(H+=m(a)+e(a)+"\n")):(H+=a.selectors.map(h)+e(a.rule)+"\n",G&&(H+=a.selectors.map(m)+e(a.rule)+"\n"))});var a=document.createElement("style");a.textContent=H;document.head.appendChild(a)}}function g(a){if(!v.pointermap.has(a))throw a=Error("NotFoundError"),a.name="NotFoundError",a;}function l(a){for(var c=
a.parentNode;c&&c!==a.ownerDocument;)c=c.parentNode;if(!c)throw a=Error("InvalidStateError"),a.name="InvalidStateError",a;}var d="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget pageX pageY".split(" "),c=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],k=window.Map&&window.Map.prototype.forEach?Map:b;b.prototype={set:function(a,c){if(void 0===c)return this.delete(a);this.has(a)||this.size++;this.array[a]=c},has:function(a){return void 0!==
this.array[a]},delete:function(a){this.has(a)&&(delete this.array[a],this.size--)},get:function(a){return this.array[a]},clear:function(){this.size=this.array.length=0},forEach:function(a,c){return this.array.forEach(function(d,e){a.call(c,d,e,this)},this)}};var p="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget buttons pointerId width height pressure tiltX tiltY pointerType hwTimestamp isPrimary type target currentTarget which pageX pageY timeStamp".split(" "),
r=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],t={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},u="undefined"!==typeof SVGElementInstance,v={pointermap:new k,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(a,c){var d=c.events;d&&(d.forEach(function(a){c[a]&&(this.eventMap[a]=c[a].bind(c))},this),this.eventSources[a]=c,this.eventSourceList.push(c))},register:function(a){for(var c=
this.eventSourceList.length,d=0,e;d<c&&(e=this.eventSourceList[d]);d++)e.register.call(e,a)},unregister:function(a){for(var c=this.eventSourceList.length,d=0,e;d<c&&(e=this.eventSourceList[d]);d++)e.unregister.call(e,a)},contains:function(a,c){try{return a.contains(c)}catch(ka){return!1}},down:function(a){a.bubbles=!0;this.fireEvent("pointerdown",a)},move:function(a){a.bubbles=!0;this.fireEvent("pointermove",a)},up:function(a){a.bubbles=!0;this.fireEvent("pointerup",a)},enter:function(a){a.bubbles=
!1;this.fireEvent("pointerenter",a)},leave:function(a){a.bubbles=!1;this.fireEvent("pointerleave",a)},over:function(a){a.bubbles=!0;this.fireEvent("pointerover",a)},out:function(a){a.bubbles=!0;this.fireEvent("pointerout",a)},cancel:function(a){a.bubbles=!0;this.fireEvent("pointercancel",a)},leaveOut:function(a){this.out(a);this.propagate(a,this.leave,!1)},enterOver:function(a){this.over(a);this.propagate(a,this.enter,!0)},eventHandler:function(a){if(!a._handledByPE){var c=a.type;(c=this.eventMap&&
this.eventMap[c])&&c(a);a._handledByPE=!0}},listen:function(a,c){c.forEach(function(c){this.addEvent(a,c)},this)},unlisten:function(a,c){c.forEach(function(c){this.removeEvent(a,c)},this)},addEvent:function(a,c){a.addEventListener(c,this.boundHandler)},removeEvent:function(a,c){a.removeEventListener(c,this.boundHandler)},makeEvent:function(a,c){this.captureInfo[c.pointerId]&&(c.relatedTarget=null);a=new n(a,c);c.preventDefault&&(a.preventDefault=c.preventDefault);a._target=a._target||c.target;return a},
fireEvent:function(a,c){a=this.makeEvent(a,c);return this.dispatchEvent(a)},cloneEvent:function(a){for(var c=Object.create(null),d,e=0;e<p.length;e++)d=p[e],c[d]=a[d]||r[e],u&&("target"===d||"relatedTarget"===d)&&c[d]instanceof SVGElementInstance&&(c[d]=c[d].correspondingUseElement);a.preventDefault&&(c.preventDefault=function(){a.preventDefault()});return c},getTarget:function(a){var c=this.captureInfo[a.pointerId];if(!c)return a._target;if(a._target===c||!(a.type in t))return c},propagate:function(a,
c,d){for(var e=a.target,b=[];null!=e&&e!==document&&!e.contains(a.relatedTarget);)if(b.push(e),e=e.parentNode,!e)return;d&&b.reverse();b.forEach(function(d){a.target=d;c.call(this,a)},this)},setCapture:function(a,c,d){this.captureInfo[a]&&this.releaseCapture(a,d);this.captureInfo[a]=c;this.implicitRelease=this.releaseCapture.bind(this,a,d);document.addEventListener("pointerup",this.implicitRelease);document.addEventListener("pointercancel",this.implicitRelease);var e=new n("gotpointercapture");e.pointerId=
a;e._target=c;d||this.asyncDispatchEvent(e)},releaseCapture:function(a,c){var d=this.captureInfo[a];if(d){this.captureInfo[a]=void 0;document.removeEventListener("pointerup",this.implicitRelease);document.removeEventListener("pointercancel",this.implicitRelease);var e=new n("lostpointercapture");e.pointerId=a;e._target=d;c||this.asyncDispatchEvent(e)}},dispatchEvent:function(a){var c=this.getTarget(a);if(c)return c.dispatchEvent(a)},asyncDispatchEvent:function(a){requestAnimationFrame(this.dispatchEvent.bind(this,
a))}};v.boundHandler=v.eventHandler.bind(v);var z={shadow:function(a){if(a)return a.shadowRoot||a.webkitShadowRoot},canTarget:function(a){return a&&!!a.elementFromPoint},targetingShadow:function(a){a=this.shadow(a);if(this.canTarget(a))return a},olderShadow:function(a){var c=a.olderShadowRoot;!c&&(a=a.querySelector("shadow"))&&(c=a.olderShadowRoot);return c},allShadows:function(a){var c=[];for(a=this.shadow(a);a;)c.push(a),a=this.olderShadow(a);return c},searchRoot:function(a,c,d){if(a){var e=a.elementFromPoint(c,
d),b;for(b=this.targetingShadow(e);b;){if(a=b.elementFromPoint(c,d))return e=this.targetingShadow(a),this.searchRoot(e,c,d)||a;b=this.olderShadow(b)}return e}},owner:function(a){for(;a.parentNode;)a=a.parentNode;a.nodeType!==Node.DOCUMENT_NODE&&a.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(a=document);return a},findTarget:function(a){var c=a.clientX,d=a.clientY;a=this.owner(a.target);a.elementFromPoint(c,d)||(a=document);return this.searchRoot(a,c,d)}},w=Array.prototype.forEach.call.bind(Array.prototype.forEach),
q=Array.prototype.map.call.bind(Array.prototype.map),y=Array.prototype.slice.call.bind(Array.prototype.slice),A=Array.prototype.filter.call.bind(Array.prototype.filter),B=window.MutationObserver||window.WebKitMutationObserver,C={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};a.prototype={watchSubtree:function(a){this.observer&&z.canTarget(a)&&this.observer.observe(a,C)},enableOnSubtree:function(a){this.watchSubtree(a);a===document&&"complete"!==document.readyState?
this.installOnLoad():this.installNewSubtree(a)},installNewSubtree:function(a){w(this.findElements(a),this.addElement,this)},findElements:function(a){return a.querySelectorAll?a.querySelectorAll("[touch-action]"):[]},removeElement:function(a){this.removeCallback(a)},addElement:function(a){this.addCallback(a)},elementChanged:function(a,c){this.changedCallback(a,c)},concatLists:function(a,c){return a.concat(y(c))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===
document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(a){return a.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(a){var c=q(a,this.findElements,this);c.push(A(a,this.isElement));return c.reduce(this.concatLists,[])},mutationWatcher:function(a){a.forEach(this.mutationHandler,this)},mutationHandler:function(a){"childList"===a.type?(this.flattenMutationTree(a.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(a.removedNodes).forEach(this.removeElement,
this)):"attributes"===a.type&&this.elementChanged(a.target,a.oldValue)}};var F=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],H="",I=window.PointerEvent||window.MSPointerEvent,G=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,J=v.pointermap,E=[1,4,2,8,16],L=!1;try{L=1===(new MouseEvent("test",{buttons:1})).buttons}catch(fa){}var M={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(a){v.listen(a,
this.events)},unregister:function(a){v.unlisten(a,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(a){var c=this.lastTouches,d=a.clientX;a=a.clientY;for(var e=0,b=c.length,f;e<b&&(f=c[e]);e++){var g=Math.abs(a-f.y);if(25>=Math.abs(d-f.x)&&25>=g)return!0}},prepareEvent:function(a){var c=v.cloneEvent(a),d=c.preventDefault;c.preventDefault=function(){a.preventDefault();d()};c.pointerId=this.POINTER_ID;c.isPrimary=!0;c.pointerType=this.POINTER_TYPE;return c},prepareButtonsForMove:function(a,
c){var d=J.get(this.POINTER_ID);a.buttons=0!==c.which&&d?d.buttons:0;c.buttons=a.buttons},mousedown:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=J.get(this.POINTER_ID),d=this.prepareEvent(a);L||(d.buttons=E[d.button],c&&(d.buttons|=c.buttons),a.buttons=d.buttons);J.set(this.POINTER_ID,a);c&&0!==c.buttons?v.move(d):v.down(d)}},mousemove:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=this.prepareEvent(a);L||this.prepareButtonsForMove(c,a);c.button=-1;J.set(this.POINTER_ID,a);v.move(c)}},
mouseup:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=J.get(this.POINTER_ID),d=this.prepareEvent(a);if(!L){var e=E[d.button];d.buttons=c?c.buttons&~e:0;a.buttons=d.buttons}J.set(this.POINTER_ID,a);d.buttons&=~E[d.button];0===d.buttons?v.up(d):v.move(d)}},mouseover:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=this.prepareEvent(a);L||this.prepareButtonsForMove(c,a);c.button=-1;J.set(this.POINTER_ID,a);v.enterOver(c)}},mouseout:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=
this.prepareEvent(a);L||this.prepareButtonsForMove(c,a);c.button=-1;v.leaveOut(c)}},cancel:function(a){a=this.prepareEvent(a);v.cancel(a);this.deactivateMouse()},deactivateMouse:function(){J.delete(this.POINTER_ID)}},N=v.captureInfo,Q=z.findTarget.bind(z),R=z.allShadows.bind(z),W=v.pointermap,O,U={events:["touchstart","touchmove","touchend","touchcancel"],register:function(a){O.enableOnSubtree(a)},unregister:function(){},elementAdded:function(a){var c=a.getAttribute("touch-action"),d=this.touchActionToScrollType(c);
d&&(a._scrollType=d,v.listen(a,this.events),R(a).forEach(function(a){a._scrollType=d;v.listen(a,this.events)},this))},elementRemoved:function(a){a._scrollType=void 0;v.unlisten(a,this.events);R(a).forEach(function(a){a._scrollType=void 0;v.unlisten(a,this.events)},this)},elementChanged:function(a,c){var d=a.getAttribute("touch-action"),e=this.touchActionToScrollType(d);c=this.touchActionToScrollType(c);e&&c?(a._scrollType=e,R(a).forEach(function(a){a._scrollType=e},this)):c?this.elementRemoved(a):
e&&this.elementAdded(a)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(a){var c=this.scrollTypes;if("none"===a)return"none";if(a===c.XSCROLLER)return"X";if(a===c.YSCROLLER)return"Y";if(c.SCROLLER.exec(a))return"XY"},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(0===W.size||1===W.size&&W.has(1))this.firstTouch=
a.identifier,this.firstXY={X:a.clientX,Y:a.clientY},this.scrolling=!1,this.cancelResetClickCount()},removePrimaryPointer:function(a){a.isPrimary&&(this.firstXY=this.firstTouch=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var a=function(){this.clickCount=0;this.resetId=null}.bind(this);this.resetId=setTimeout(a,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(a){var c=0;if("touchstart"===a||"touchmove"===a)c=
1;return c},touchToPointer:function(a){var c=this.currentTouchEvent,d=v.cloneEvent(a),e=d.pointerId=a.identifier+2;d.target=N[e]||Q(d);d.bubbles=!0;d.cancelable=!0;d.detail=this.clickCount;d.button=0;d.buttons=this.typeToButtons(c.type);d.width=2*(a.radiusX||a.webkitRadiusX||0);d.height=2*(a.radiusY||a.webkitRadiusY||0);d.pressure=a.force||a.webkitForce||.5;d.isPrimary=this.isPrimaryTouch(a);d.pointerType=this.POINTER_TYPE;d.altKey=c.altKey;d.ctrlKey=c.ctrlKey;d.metaKey=c.metaKey;d.shiftKey=c.shiftKey;
var b=this;d.preventDefault=function(){b.scrolling=!1;b.firstXY=null;c.preventDefault()};return d},processTouches:function(a,c){var d=a.changedTouches;this.currentTouchEvent=a;a=0;for(var e;a<d.length;a++)e=d[a],c.call(this,this.touchToPointer(e))},shouldScroll:function(a){if(this.firstXY){var c;c=a.currentTarget._scrollType;if("none"===c)c=!1;else if("XY"===c)c=!0;else{a=a.changedTouches[0];var d="Y"===c?"X":"Y";c=Math.abs(a["client"+c]-this.firstXY[c])>=Math.abs(a["client"+d]-this.firstXY[d])}this.firstXY=
null;return c}},findTouch:function(a,c){for(var d=0,e=a.length,b;d<e&&(b=a[d]);d++)if(b.identifier===c)return!0},vacuumTouches:function(a){var c=a.touches;if(W.size>=c.length){var d=[];W.forEach(function(a,e){1===e||this.findTouch(c,e-2)||d.push(a.out)},this);d.forEach(this.cancelOut,this)}},touchstart:function(a){this.vacuumTouches(a);this.setPrimaryTouch(a.changedTouches[0]);this.dedupSynthMouse(a);this.scrolling||(this.clickCount++,this.processTouches(a,this.overDown))},overDown:function(a){W.set(a.pointerId,
{target:a.target,out:a,outTarget:a.target});v.enterOver(a);v.down(a)},touchmove:function(a){this.scrolling||(this.shouldScroll(a)?(this.scrolling=!0,this.touchcancel(a)):(a.preventDefault(),this.processTouches(a,this.moveOverOut)))},moveOverOut:function(a){var c=W.get(a.pointerId);if(c){var d=c.out,e=c.outTarget;v.move(a);d&&e!==a.target&&(d.relatedTarget=a.target,a.relatedTarget=e,d.target=e,a.target?(v.leaveOut(d),v.enterOver(a)):(a.target=e,a.relatedTarget=null,this.cancelOut(a)));c.out=a;c.outTarget=
a.target}},touchend:function(a){this.dedupSynthMouse(a);this.processTouches(a,this.upOut)},upOut:function(a){this.scrolling||(v.up(a),v.leaveOut(a));this.cleanUpPointer(a)},touchcancel:function(a){this.processTouches(a,this.cancelOut)},cancelOut:function(a){v.cancel(a);v.leaveOut(a);this.cleanUpPointer(a)},cleanUpPointer:function(a){W.delete(a.pointerId);this.removePrimaryPointer(a)},dedupSynthMouse:function(a){var c=M.lastTouches;a=a.changedTouches[0];this.isPrimaryTouch(a)&&(a={x:a.clientX,y:a.clientY},
c.push(a),c=function(a,c){c=a.indexOf(c);-1<c&&a.splice(c,1)}.bind(null,c,a),setTimeout(c,2500))}};O=new a(U.elementAdded,U.elementRemoved,U.elementChanged,U);var P=v.pointermap,ba=window.MSPointerEvent&&"number"===typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,V={events:"MSPointerDown MSPointerMove MSPointerUp MSPointerOut MSPointerOver MSPointerCancel MSGotPointerCapture MSLostPointerCapture".split(" "),register:function(a){v.listen(a,this.events)},unregister:function(a){v.unlisten(a,this.events)},
POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(a){var c=a;ba&&(c=v.cloneEvent(a),c.pointerType=this.POINTER_TYPES[a.pointerType]);return c},cleanup:function(a){P.delete(a)},MSPointerDown:function(a){P.set(a.pointerId,a);a=this.prepareEvent(a);v.down(a)},MSPointerMove:function(a){a=this.prepareEvent(a);v.move(a)},MSPointerUp:function(a){var c=this.prepareEvent(a);v.up(c);this.cleanup(a.pointerId)},MSPointerOut:function(a){a=this.prepareEvent(a);v.leaveOut(a)},MSPointerOver:function(a){a=
this.prepareEvent(a);v.enterOver(a)},MSPointerCancel:function(a){var c=this.prepareEvent(a);v.cancel(c);this.cleanup(a.pointerId)},MSLostPointerCapture:function(a){a=v.makeEvent("lostpointercapture",a);v.dispatchEvent(a)},MSGotPointerCapture:function(a){a=v.makeEvent("gotpointercapture",a);v.dispatchEvent(a)}},T,X,Y;window.navigator.msPointerEnabled?(T=function(a){g(a);l(this);0!==v.pointermap.get(a).buttons&&(v.setCapture(a,this,!0),this.msSetPointerCapture(a))},X=function(a){g(a);v.releaseCapture(a,
!0);this.msReleasePointerCapture(a)}):(T=function(a){g(a);l(this);0!==v.pointermap.get(a).buttons&&v.setCapture(a,this)},X=function(a){g(a);v.releaseCapture(a)});Y=function(a){return!!v.captureInfo[a]};var da=window.PointerEvent||window.MSPointerEvent;return{dispatcher:v,Installer:a,PointerEvent:n,PointerMap:k,targetFinding:z,applyGlobal:function(){f();window.PointerEvent||(window.PointerEvent=n,window.navigator.msPointerEnabled?(Object.defineProperty(window.navigator,"maxTouchPoints",{value:window.navigator.msMaxTouchPoints,
enumerable:!0}),v.registerSource("ms",V)):(Object.defineProperty(window.navigator,"maxTouchPoints",{value:0,enumerable:!0}),v.registerSource("mouse",M),void 0!==window.ontouchstart&&v.registerSource("touch",U)),v.register(document));window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:T},releasePointerCapture:{value:X},hasPointerCapture:{value:Y}})},applyLocal:function(a){da||(window.PointerEvent||(window.navigator.msPointerEnabled?
v.registerSource("ms",V):(v.registerSource("mouse",M),void 0!==window.ontouchstart&&v.registerSource("touch",U)),v.register(document)),window.Element&&!Element.prototype.setPointerCapture&&(a.setPointerCapture=T.bind(a),a.releasePointerCapture=X.bind(a),a.hasPointerCapture=Y.bind(a)),a.getAttribute("touch-action")||a.setAttribute("touch-action","none"))}}})},"esri/views/input/gamepad/GamepadSource":function(){define(["require","exports","../../../core/scheduling","./GamepadInputDevice","./GamepadState"],
function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function e(a,e){var b=this;this.element=a;this.input=e;this._hasEventListeners=!1;this.frameTask=null;this.latestUpdate=[];this.inputDevices=[];this.callback=null;if(this.supported="getGamepads"in window.navigator)this.forEachGamepad(function(a){return b.connectGamepad(a)}),window.addEventListener("gamepadconnected",function(a){return b.connectGamepad(a.gamepad)}),window.addEventListener("gamepaddisconnected",function(a){return b.disconnectGamepad(a.gamepad)}),
this.ensurePollingState()}e.prototype.destroy=function(){var a=this;this.ensurePollingState();this.supported&&(window.removeEventListener("gamepadconnected",function(e){return a.connectGamepad(e.gamepad)}),window.removeEventListener("gamepaddisconnected",function(e){return a.disconnectGamepad(e.gamepad)}))};Object.defineProperty(e.prototype,"hasEventListeners",{set:function(a){this._hasEventListeners!==a&&(this._hasEventListeners=a,this.ensurePollingState())},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,
"eventsEnabled",{get:function(){return this.supported&&0<this.inputDevices.length&&this._hasEventListeners},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"onEvent",{set:function(a){this.callback=a},enumerable:!0,configurable:!0});e.prototype.connectGamepad=function(a){var e=new m(a);"unknown"!==e.deviceType&&(this.inputDevices[a.index]=e,this.input.gamepad.devices.add(e));this.ensurePollingState()};e.prototype.disconnectGamepad=function(a){var e=a.index,b=this.inputDevices[e];
b&&(this.emitGamepadEvent(a,h.extractState(b),!1),this.inputDevices.splice(e,1),this.latestUpdate.splice(e,1),this.input.gamepad.devices.remove(b),this.ensurePollingState())};e.prototype.ensurePollingState=function(){this.eventsEnabled?this.startPolling():this.stopPolling()};e.prototype.startPolling=function(){var e=this;null==this.frameTask&&(this.frameTask=a.addFrameTask({update:function(){return e.readGamepadState()}}))};e.prototype.stopPolling=function(){null!=this.frameTask&&(this.frameTask.remove(),
this.frameTask=null,this.latestUpdate=[])};e.prototype.readGamepadState=function(){var a=this,e=document.hasFocus(),b=this.element.contains(document.activeElement),d="document"===this.input.gamepad.enabledFocusMode&&!e||"view"===this.input.gamepad.enabledFocusMode&&!b;this.forEachGamepad(function(c){var e=a.inputDevices[c.index];if(e){var b=a.latestUpdate[c.index],e=h.extractState(e),f=d||h.stateIdle(e);b&&(b.timestamp===c.timestamp||!b.active&&f||h.stateEqual(b.state,e))||a.emitGamepadEvent(c,e,
!f)}})};e.prototype.forEachGamepad=function(a){for(var e=window.navigator.getGamepads(),b=0;b<e.length;b++){var d=e[b];this.validate(d)&&a(d)}};e.prototype.emitGamepadEvent=function(a,e,b){var d=this.latestUpdate[a.index];if((d=d&&d.active)||b)this.latestUpdate[a.index]={timestamp:a.timestamp,state:e,active:b},this.callback&&this.callback({device:this.inputDevices[a.index],state:e,action:!d&&b?"start":d&&b?"update":"end"})};e.prototype.validate=function(a){if(!a||!a.connected)return!1;for(var e=0;e<
a.axes.length;e++)if(isNaN(a.axes[e]))return!1;return!0};return e}();b.GamepadSource=n})},"esri/views/input/gamepad/GamepadState":function(){define(["require","exports","../../../core/mathUtils"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.extractState=function(b){var h=b.native;return h?{buttons:h.buttons.map(function(a){return a.pressed?a.value?a.value:1:0}),axes:h.axes.map(function(e){var f=b.axisThreshold,g=Math.abs(e);e=g<f?0:a.sign(e)*(g-f)/(1-f);return e})}:{buttons:[],
axes:[]}};b.stateEqual=function(a,b){if(a.axes.length!==b.axes.length||a.buttons.length!==b.buttons.length)return!1;for(var e=0;e<a.axes.length;e++)if(a.axes[e]!==b.axes[e])return!1;for(e=0;e<a.buttons.length;e++)if(a.buttons[e]!==b.buttons[e])return!1;return!0};b.stateIdle=function(a){for(var b=0;b<a.axes.length;b++)if(0!==a.axes[b])return!1;for(b=0;b<a.buttons.length;b++)if(0!==a.buttons[b])return!1;return!0}})},"esri/views/input/handlers/PreventContextMenu":function(){define(["require","exports",
"tslib","../InputHandler"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(){var a=b.call(this,!0)||this;a.registerIncoming("context-menu",function(a){a.data.native.preventDefault()});return a}a.__extends(e,b);return e}(m.InputHandler);b.PreventContextMenu=n;b.default=n})},"esri/views/input/recognizers/Drag":function(){define("require exports tslib ../../../core/screenUtils ../../../layers/support/timeUtils ../InputHandler ./support".split(" "),function(n,
b,a,m,h,e,f){function g(a){var c=[];a.forEach(function(a){c.push(m.createScreenPoint(a.event.x,a.event.y))});return f.fitCircleLSQ(c)}function l(a){var d=g(a),e=0;a.forEach(function(a){for(var b=c(a,d),b=b-a.lastAngle;b>Math.PI;)b-=2*Math.PI;for(;b<-Math.PI;)b+=2*Math.PI;b=a.lastAngle+b;a.lastAngle=b;e+=b-a.initialAngle});e/=a.size||1;return{angle:e,radius:d.radius,center:d.center}}function d(a){var c=new Map;a.forEach(function(a,d){return c.set(d,a.event)});return c}function c(a,c){a=a.event;return Math.atan2(a.y-
c.center.y,a.x-c.center.x)}Object.defineProperty(b,"__esModule",{value:!0});n=function(e){function b(a){var c=e.call(this,!1)||this;c.navigationTouch=a;c.startStateModifiers=new Set;c.activePointerMap=new Map;c.isDragging=!1;c.isCurrentDragSuppressed=!1;c.drag=c.registerOutgoing("drag");c.registerIncoming("pointer-drag",c.handlePointerDrag.bind(c));c.registerIncoming("pointer-up",c.handlePointerUpAndPointerLost.bind(c));c.registerIncoming("pointer-capture-lost",c.handlePointerUpAndPointerLost.bind(c));
c.registerIncoming("pointer-cancel",c.handlePointerUpAndPointerLost.bind(c));return c}a.__extends(b,e);b.prototype.createPayload=function(a,c,e,b){return{action:a,pointerType:this.pointerType,button:this.mouseButton,buttons:c.buttons,timestamp:b,pointers:d(this.activePointerMap),pointer:c,angle:e.angle,radius:e.radius,center:e.center}};b.prototype.addPointer=function(a){var d=a.native.pointerId,e=l(this.activePointerMap).angle;a={event:a,initialAngle:0,lastAngle:0};this.activePointerMap.set(d,a);
d=c(a,g(this.activePointerMap));a.initialAngle=d;a.lastAngle=d;this.updatePointerAngles(e)};b.prototype.updatePointer=function(a){if(!a||null!=a.x||null!=a.y){var c=this.activePointerMap.get(a.native.pointerId);c?c.event=a:this.addPointer(a)}};b.prototype.removePointer=function(a){var c=l(this.activePointerMap).angle;this.activePointerMap.delete(a);this.updatePointerAngles(c)};b.prototype.updatePointerAngles=function(a){var d=l(this.activePointerMap);this.activePointerMap.forEach(function(e){e.initialAngle=
c(e,d)-a;e.lastAngle=c(e,d)-a})};b.prototype.emitEvent=function(a,c,d){var e=l(this.activePointerMap);this.drag.emit(this.createPayload(a,c,e,d),void 0,this.startStateModifiers)};b.prototype.handlePointerUpAndPointerLost=function(a){var c=a.data.native.pointerId,d=h.Milliseconds(a.timestamp);this.activePointerMap.get(c)&&(1===this.activePointerMap.size?(this.updatePointer(a.data),!this.isCurrentDragSuppressed&&this.emitEvent("end",a.data,d),this.isCurrentDragSuppressed=this.isDragging=!1,this.removePointer(c)):
(this.removePointer(c),this.emitEvent("removed",a.data,h.Milliseconds(a.timestamp))))};b.prototype.handlePointerDrag=function(a){var c=a.data,d=c.currentEvent,e=h.Milliseconds(a.timestamp);switch(c.action){case "start":case "update":this.isDragging?this.activePointerMap.has(d.native.pointerId)?(this.updatePointer(d),!this.isCurrentDragSuppressed&&this.emitEvent("update",d,e)):(this.addPointer(d),this.emitEvent("added",d,e),this.isCurrentDragSuppressed=this.isSuppressed):(this.updatePointer(d),this.pointerType=
a.data.startEvent.pointerType,this.mouseButton=a.data.startEvent.button,this.startStateModifiers=a.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this.emitEvent("start",d,e))}};Object.defineProperty(b.prototype,"isSuppressed",{get:function(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size},enumerable:!0,configurable:!0});return b}(e.InputHandler);b.Drag=
n;(function(a){a[a.Left=0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right";a[a.Back=3]="Back";a[a.Forward=4]="Forward";a[a.Undefined=-1]="Undefined"})(b.Button||(b.Button={}))})},"esri/views/input/recognizers/support":function(){define(["require","exports","../../../core/screenUtils"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.manhattanDistance=function(a,b){return Math.abs(b.x-a.x)+Math.abs(b.y-a.y)};b.euclideanDistance=function(a,b){var e=b.x-a.x;a=b.y-a.y;return Math.sqrt(e*
e+a*a)};b.fitCircleLSQ=function(b,h){h?(h.radius=0,h.center.x=0,h.center.y=0):h={radius:0,center:a.createScreenPoint()};if(0===b.length)return h;if(1===b.length)return h.center.x=b[0].x,h.center.y=b[0].y,h;if(2===b.length){var e=b[0];b=b[1];var f=[b.x-e.x,b.y-e.y],g=f[0],f=f[1];h.radius=Math.sqrt(g*g+f*f)/2;h.center.x=(e.x+b.x)/2;h.center.y=(e.y+b.y)/2;return h}for(var l=0,d=0,c=0;c<b.length;c++)l+=b[c].x,d+=b[c].y;for(var l=l/b.length,d=d/b.length,k=b.map(function(a){return a.x-l}),p=b.map(function(a){return a.y-
d}),r=e=h=0,m=0,u=g=0,c=f=0;c<k.length;c++){var v=k[c],z=p[c],w=v*v,q=z*z;h+=w;e+=q;r+=v*z;m+=w*v;g+=q*z;u+=v*q;f+=z*w}c=h;k=r;p=e;m=.5*(m+u);g=.5*(g+f);f=c*p-r*k;u=(m*p-g*k)/f;g=(c*g-r*m)/f;f=a.createScreenPoint(u+l,g+d);return{radius:Math.sqrt(u*u+g*g+(h+e)/b.length),center:f}}})},"esri/views/input/recognizers/ImmediateDoubleClick":function(){define("require exports tslib ../../../core/clock ../InputHandler ./SingleAndDoubleClick ./support".split(" "),function(n,b,a,m,h,e,f){Object.defineProperty(b,
"__esModule",{value:!0});n=function(b){function g(a,c,f,g,l){void 0===a&&(a=e.DefaultParameters.maximumDoubleClickDelay);void 0===c&&(c=e.DefaultParameters.maximumDoubleClickDistance);void 0===f&&(f=e.DefaultParameters.maximumDoubleTouchDelay);void 0===g&&(g=e.DefaultParameters.maximumDoubleTouchDistance);void 0===l&&(l=m.default);var d=b.call(this,!1)||this;d.maximumDoubleClickDelay=a;d.maximumDoubleClickDistance=c;d.maximumDoubleTouchDelay=f;d.maximumDoubleTouchDistance=g;d._clock=l;d._pointerState=
new Map;d._immediateDoubleClick=d.registerOutgoing("immediate-double-click");d.registerIncoming("pointer-down",d._handlePointerDown.bind(d));d.registerIncoming("pointer-up",function(a){d._handlePointerLoss(a,"pointer-up")});d.registerIncoming("pointer-capture-lost",function(a){d._handlePointerLoss(a,"pointer-capture-lost")});d.registerIncoming("pointer-cancel",function(a){d._handlePointerLoss(a,"pointer-cancel")});return d}a.__extends(g,b);g.prototype.onUninstall=function(){this._pointerState.forEach(function(a){a.immediateDoubleClick&&
a.immediateDoubleClick.timeoutHandle.remove()});b.prototype.onUninstall.call(this)};g.prototype._handlePointerDown=function(a){a=a.data;var c=this._pointerId(a);this._pointerState.has(c)||(this._pointerState.set(c,{downButton:a.native.button,immediateDoubleClick:null}),this.startCapturingPointer(a.native))};g.prototype._handlePointerLoss=function(a,c){var d=a.data,e=this._pointerId(d);if((e=this._pointerState.get(e))&&"pointer-up"===c&&e.downButton===d.native.button)if(c=e.immediateDoubleClick){c.timeoutHandle.remove();
var b="touch"===a.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;f.manhattanDistance(c,a.data)>b?this._startImmediateDoubleClick(a,e):(this._immediateDoubleClick.emit(a.data,void 0,c.modifiers),this._removeState(d))}else this._startImmediateDoubleClick(a,e)};g.prototype._startImmediateDoubleClick=function(a,c){var d=this;c.immediateDoubleClick={x:a.data.x,y:a.data.y,modifiers:a.modifiers,timeoutHandle:this._clock.setTimeout(function(){return d._removeState(a.data)},
"touch"===a.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)}};g.prototype._pointerId=function(a){a=a.native;return"mouse"===a.pointerType?a.pointerId+":"+a.button:""+a.pointerType};g.prototype._removeState=function(a){var c=this._pointerId(a);this._pointerState.delete(c);this.stopCapturingPointer(a.native);this.refreshHasPendingInputs()};return g}(h.InputHandler);b.ImmediateDoubleClick=n})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("require exports tslib ../../../core/clock ../../../core/MapUtils ../InputHandler ./support".split(" "),
function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});b.DefaultParameters={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};n=function(e){function g(a,c,f,g,l){void 0===a&&(a=b.DefaultParameters.maximumDoubleClickDelay);void 0===c&&(c=b.DefaultParameters.maximumDoubleClickDistance);void 0===f&&(f=b.DefaultParameters.maximumDoubleTouchDelay);void 0===g&&(g=b.DefaultParameters.maximumDoubleTouchDistance);void 0===
l&&(l=m.default);var d=e.call(this,!1)||this;d.maximumDoubleClickDelay=a;d.maximumDoubleClickDistance=c;d.maximumDoubleTouchDelay=f;d.maximumDoubleTouchDistance=g;d._clock=l;d._pointerState=new Map;d._click=d.registerOutgoing("click");d._doubleClick=d.registerOutgoing("double-click");d.registerIncoming("immediate-click",d._handleImmediateClick.bind(d));d.registerIncoming("pointer-drag",d._handlePointerDrag.bind(d));d.registerIncoming("drag",d._handleDrag.bind(d));return d}a.__extends(g,e);g.prototype.onUninstall=
function(){this._pointerState.forEach(function(a){null!=a.doubleClickTimeout&&(a.doubleClickTimeout.remove(),a.doubleClickTimeout=null)})};Object.defineProperty(g.prototype,"hasPendingInputs",{get:function(){return h.someMap(this._pointerState,function(a){return null!=a.doubleClickTimeout})},enumerable:!0,configurable:!0});g.prototype._pointerId=function(a){a=a.native;return"mouse"===a.pointerType?a.pointerId+":"+a.button:""+a.pointerType};g.prototype._handleImmediateClick=function(a){var c=a.data,
d=this._pointerId(c),e=this._pointerState.get(d);if(e){var b="touch"===c.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;f.manhattanDistance(e.event.data,c)>b?(this._clearDoubleClickTimeout(d,!0),this._startClick(a)):(this._clearDoubleClickTimeout(d,!1),this._doubleClick.emit(e.event.data,void 0,e.event.modifiers))}else this._startClick(a)};g.prototype._startClick=function(a){var c=this,d=this._pointerId(a.data);this._pointerState.set(d,{event:a,doubleClickTimeout:this._clock.setTimeout(function(){return c._doubleClickTimeoutExceeded(d)},
"touch"===a.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)});this.refreshHasPendingInputs()};g.prototype._handlePointerDrag=function(a){a=this._pointerId(a.data.currentEvent);this._clearDoubleClickTimeout(a,!0)};g.prototype._handleDrag=function(a){a=this._pointerId(a.data.pointer);this._clearDoubleClickTimeout(a,!0)};g.prototype._clearDoubleClickTimeout=function(a,c){var d=this._pointerState.get(a);d&&(d.doubleClickTimeout.remove(),d.doubleClickTimeout=null,c&&
this._doubleClickTimeoutExceeded(a),this._pointerState.delete(a),this.refreshHasPendingInputs())};g.prototype._doubleClickTimeoutExceeded=function(a){var c=this._pointerState.get(a);this._click.emit(c.event.data,void 0,c.event.modifiers);c.doubleClickTimeout=null;this._pointerState.delete(a);this.refreshHasPendingInputs()};return g}(e.InputHandler);b.SingleAndDoubleClick=n})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define("require exports tslib ../../../core/clock ../InputHandler ./support".split(" "),
function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});b.DefaultParameters={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};n=function(f){function g(a,d,c,e,g,h){void 0===a&&(a=b.DefaultParameters.maximumClickDelay);void 0===d&&(d=b.DefaultParameters.movementUntilMouseDrag);void 0===c&&(c=b.DefaultParameters.movementUntilPenDrag);void 0===e&&(e=b.DefaultParameters.movementUntilTouchDrag);void 0===g&&(g=b.DefaultParameters.holdDelay);
void 0===h&&(h=m.default);var k=f.call(this,!1)||this;k.maximumClickDelay=a;k.movementUntilMouseDrag=d;k.movementUntilPenDrag=c;k.movementUntilTouchDrag=e;k.holdDelay=g;k._clock=h;k._pointerState=new Map;k._pointerDrag=k.registerOutgoing("pointer-drag");k._immediateClick=k.registerOutgoing("immediate-click");k._pointerHold=k.registerOutgoing("hold");k.registerIncoming("pointer-down",k._handlePointerDown.bind(k));k.registerIncoming("pointer-up",function(a){k._handlePointerLoss(a,"pointer-up")});k.registerIncoming("pointer-capture-lost",
function(a){k._handlePointerLoss(a,"pointer-capture-lost")});k.registerIncoming("pointer-cancel",function(a){k._handlePointerLoss(a,"pointer-cancel")});k._moveHandle=k.registerIncoming("pointer-move",k._handlePointerMove.bind(k));k._moveHandle.pause();return k}a.__extends(g,f);g.prototype.onUninstall=function(){this._pointerState.forEach(function(a){null!=a.holdTimeout&&(a.holdTimeout.remove(),a.holdTimeout=null)});f.prototype.onUninstall.call(this)};g.prototype._handlePointerDown=function(a){var d=
this,c=a.data,e=c.native.pointerId,b=null;0===this._pointerState.size&&(b=this._clock.setTimeout(function(){var c=d._pointerState.get(e);c&&(c.isDragging||(d._pointerHold.emit(c.previousEvent,void 0,a.modifiers),c.holdEmitted=!0),c.holdTimeout=null)},this.holdDelay));b={startEvent:c,previousEvent:c,startTimestamp:a.timestamp,isDragging:!1,downButton:c.native.button,holdTimeout:b,modifiers:new Set};this._pointerState.set(e,b);this.startCapturingPointer(c.native);this._moveHandle.resume();1<this._pointerState.size&&
this.startDragging(a)};g.prototype._createPointerDragData=function(a,d,c){return{action:a,startEvent:d.startEvent,previousEvent:d.previousEvent,currentEvent:c}};g.prototype._handlePointerMove=function(a){var d=a.data,c=this._pointerState.get(d.native.pointerId);if(c){if(c.isDragging)this._pointerDrag.emit(this._createPointerDragData("update",c,d),void 0,c.modifiers);else{var b=e.euclideanDistance(d,c.startEvent),f=this._getDragThreshold(d.native.pointerType);b>f&&this.startDragging(a)}c.previousEvent=
d}};g.prototype._getDragThreshold=function(a){switch(a){case "touch":return this.movementUntilTouchDrag;case "pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}};g.prototype.startDragging=function(a){var d=this,c=a.data,e=c.native.pointerId;this._pointerState.forEach(function(b){null!=b.holdTimeout&&(b.holdTimeout.remove(),b.holdTimeout=null);b.isDragging||(b.modifiers=a.modifiers,b.isDragging=!0,e===b.startEvent.native.pointerId?d._pointerDrag.emit(d._createPointerDragData("start",
b,c)):d._pointerDrag.emit(d._createPointerDragData("start",b,b.previousEvent),a.timestamp))})};g.prototype._handlePointerLoss=function(a,d){var c=a.data,e=c.native.pointerId,b=this._pointerState.get(e);b&&(null!=b.holdTimeout&&(b.holdTimeout.remove(),b.holdTimeout=null),b.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",b,"pointer-up"===d?c:b.previousEvent),void 0,b.modifiers):"pointer-up"===d&&b.downButton===c.native.button&&a.timestamp-b.startTimestamp<=this.maximumClickDelay&&
!b.holdEmitted&&this._immediateClick.emit(c),this._pointerState.delete(e),this.stopCapturingPointer(c.native),0===this._pointerState.size&&this._moveHandle.pause())};return g}(h.InputHandler);b.PointerClickHoldAndDrag=n})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["require","exports","tslib","../DragEventSeparator","../InputHandler"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(e){function b(a,b){void 0===a&&(a=20);void 0===b&&(b=40);
var d=e.call(this,!1)||this;d._threshold=a;d._maxDelta=b;d.state="ready";d.emittedArtificalEnd2=!1;d._vertical=d.registerOutgoing("vertical-two-finger-drag");d._artificalDrag=d.registerOutgoing("drag");d.dragEventSeparator=new m.DragEventSeparator({start:function(a,e){return d.observeStart(a,e)},update:function(a,e,b){return d.observeUpdate(a,e,b)},end:function(a,e){return d.observeEnd(e)}});d.registerIncoming("drag",function(a){return d.dragEventSeparator.handle(a)});return d}a.__extends(b,e);Object.defineProperty(b.prototype,
"failed",{get:function(){return"failed"===this.state},enumerable:!0,configurable:!0});b.prototype.observeStart=function(a,e){1===a&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:e.data.button,buttons:e.data.buttons,pointerType:e.data.pointerType,timestamp:e.data.timestamp,pointers:e.data.pointers,pointer:e.data.pointer,angle:e.data.angle,radius:e.data.radius,center:e.data.center,artifical:!0}),e.stopPropagation());this.state=2===a?"ready":
"failed"};b.prototype.observeUpdate=function(a,e,d){"failed"!==this.state&&2===a&&("active"===this.state?(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"update"}),e.stopPropagation()):this.checkMovementWithinLimits(e.data,d.data)?this.checkVerticalThresholdReached(e.data,d.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=e.data.center,this._artificalDrag.emit({action:"end",button:e.data.button,buttons:e.data.buttons,pointerType:e.data.pointerType,
timestamp:e.data.timestamp,pointers:e.data.pointers,pointer:e.data.pointer,angle:e.data.angle,radius:e.data.radius,center:e.data.center,artifical:!0}),this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),e.stopPropagation()):this.state="failed")};b.prototype.observeEnd=function(a){"active"===this.state&&(this._vertical.emit({delta:a.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",a.stopPropagation())};b.prototype.checkMovementWithinLimits=
function(a,e){var d=-Infinity,c=Infinity,b=-Infinity,f=Infinity;e.pointers.forEach(function(a){d=Math.max(d,a.x);c=Math.min(c,a.x);b=Math.max(b,a.y);f=Math.min(f,a.y)});var g=-Infinity,l=Infinity,h=-Infinity,m=Infinity;a.pointers.forEach(function(a){g=Math.max(g,a.x);l=Math.min(l,a.x);h=Math.max(h,a.y);m=Math.min(m,a.y)});return Math.abs(a.center.x-e.center.x)<this._threshold&&Math.abs(g-l-(d-c))<=this._maxDelta&&Math.abs(h-m-(b-f))<=this._maxDelta};b.prototype.checkVerticalThresholdReached=function(a,
e){var d=Math.abs(a.center.y-e.center.y);a.pointers.forEach(function(a,b){b=e.pointers.get(b);d=Math.min(d,Math.abs(a.y-b.y))});return d>=this._threshold};return b}(h.InputHandler);b.VerticalTwoFingerDrag=n})},"esri/views/input/DragEventSeparator":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a){this.callbacks=a;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=function(){return!0})}a.prototype.handle=
function(a){var b=a.data,e=b.pointers.size;switch(b.action){case "start":this.currentCount=e;this.emitStart(a);break;case "added":this.emitEnd(this.previousEvent);this.currentCount=e;this.emitStart(a);break;case "update":this.emitUpdate(a);break;case "removed":this.startEvent&&this.emitEnd(this.previousEvent);this.currentCount=e;this.emitStart(a);break;case "end":this.emitEnd(a),this.currentCount=0}this.previousEvent=a};a.prototype.emitStart=function(a){this.startEvent=a;this.callbacks.condition(this.currentCount,
a)&&this.callbacks.start(this.currentCount,a,this.startEvent)};a.prototype.emitUpdate=function(a){this.callbacks.condition(this.currentCount,a)&&this.callbacks.update(this.currentCount,a,this.startEvent)};a.prototype.emitEnd=function(a){this.callbacks.condition(this.currentCount,a)&&this.callbacks.end(this.currentCount,a,this.startEvent);this.startEvent=null};return a}();b.DragEventSeparator=n})},"esri/views/3d/layers/graphics/GraphicsDeconflictor":function(){define("require exports tslib ../../../../core/Handles ../../../../core/MapUtils ../../../../core/maybe ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ./Deconflictor ./LabelDeconflictor ../../support/geometryUtils ../../../support/Scheduler".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k){function p(a){a=a.layer;return!(!a||!a.featureReduction||"selection"!==a.featureReduction.type)}function r(a){(a=a.graphics3DGraphics)&&a.forEach(function(a){return a.clearVisibilityFlag(3)})}Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function t(){var a=null!==b&&b.apply(this,arguments)||this;a._handles=new m;a._contexts=new Map;a._viewState=new l.DeconflictorViewState;a.visibilityGroup=0;a._iconMarginFactor=-.1;return a}a.__extends(t,b);Object.defineProperty(t.prototype,
"labels",{get:function(){return this._labels},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"viewState",{get:function(){return this._viewState},enumerable:!0,configurable:!0});t.prototype.initialize=function(){var a=this;this._handles.add([this.view.watch("state.camera",function(){a.updateViewState();a.setDirty()}),this.view.watch("map.ground.opacity",function(c,d){1!==c&&1!==d||a.setDirty()}),f.init(this.view,"slicePlane",function(){a.updateSlicePlane();a.slicePlaneChanged()})]);
this._frameTask=this.view.resourceController.scheduler.registerTask(k.Task.GRAPHICS_DECONFLICTOR,function(c){return a.update(c)},function(){return a.needsUpdate()});this._labels=new d.LabelDeconflictor({view:this.view,parent:this})};t.prototype.destroy=function(){this._labels.destroy();this._labels=null;this._handles.destroy();this._handles=null;this._frameTask&&(this._frameTask.remove(),this._frameTask=null)};Object.defineProperty(t.prototype,"iconMarginFactor",{get:function(){return this._iconMarginFactor},
set:function(a){this._iconMarginFactor=a;this.setDirty()},enumerable:!0,configurable:!0});t.prototype.setDirty=function(){0<this._contexts.size&&(b.prototype.setDirty.call(this),this._labels.setDirty())};t.prototype.update=function(a){b.prototype.update.call(this,a);this.needsUpdate()||this._labels.setDirty()};t.prototype.setInitialIconVisibilityFlag=function(a,c){a=!(this._graphicSupportsDeconfliction(c)&&p(a));c.setVisibilityFlag(3,a,0)};t.prototype.updateViewState=function(){this.view&&this.view.state&&
(this._viewState.camera.copyFrom(this.view.state.camera),this.updateSlicePlane())};t.prototype.updateSlicePlane=function(){var a=this.view?this.view.slicePlane:null;e.isSome(a)&&c.boundedPlane.transform(a,this._viewState.camera.viewMatrix,this._viewState.slicePlane);this._viewState.slicePlaneEnabled=e.isSome(a)};t.prototype.slicePlaneChanged=function(){h.someMap(this._contexts,function(a,c){return c.symbolCreationContext.slicePlaneEnabled})&&this.setDirty()};t.prototype.addGraphicsOwner=function(a){var c=
this,d=this._contexts.get(a);null==d&&(d=new Map,this._contexts.set(a,d),this.setDirty());return{addGraphic:function(e){return c.addGraphic(a,d,e)},removeGraphic:function(a){return c.removeGraphic(d,a)},labelingInfoChange:function(){return c._labels.enabledChanged(a,d)},featureReductionChange:function(){return c.enabledChanged(a,d)},slicePlaneEnabledChange:function(){return c._slicePlaneEnabledChanged(a,d)},clear:function(){return d.forEach(function(a){return c.removeGraphic(d,a.graphics3DGraphic)})}}};
t.prototype.removeGraphicsOwner=function(a){var c=this,d=this._contexts.get(a);d&&(d.forEach(function(a){return c.removeGraphic(d,a.graphics3DGraphic)}),this._contexts.delete(a),this.setDirty())};t.prototype.addGraphic=function(a,c,d){var e=d.graphic.uid;d=new l.DeconflictorGraphic(d,a.symbolCreationContext.slicePlaneEnabled);c.set(e,d);p(a)&&this.addToActiveGraphics(d);a.labelsEnabled&&this._labels.addToActiveGraphics(d)};t.prototype.removeGraphic=function(a,c){c=c.graphic.uid;var d=a.get(c);d&&
(this.removeFromActiveGraphics(d),this._labels.removeFromActiveGraphics(d),a.delete(c),this.setDirty())};t.prototype.enabledChanged=function(a,c){var d=p(a);d||r(a);this.modifyGraphics(c,d)};t.prototype._slicePlaneEnabledChanged=function(a,c){var d=a.symbolCreationContext.slicePlaneEnabled;c.forEach(function(a){return a.slicePlaneEnabled=d});this.setDirty()};t.prototype.getGraphicsLayers=function(a){return a._graphics};t.prototype._graphicSupportsDeconfliction=function(a){if(a.isDraped)return!1;a=
a._graphics;if(!a||!a.length)return!1;for(var c=0;c<a.length;c++)if(this.layerSupportsDeconfliction(a[c]))return!0;return!1};return t=a.__decorate([g.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],t)}(l.Deconflictor);b.GraphicsDeconflictor=n})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingRect ./deconflictorDebug ../../support/debugFlags ../../support/earthUtils ../../support/geometryUtils ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/Util ../../webgl-engine/materials/HUDMaterial".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I){function G(c){var d,e,b,f,g;return a.__generator(this,function(a){switch(a.label){case 0:if(!Map.prototype.entries)return[3,5];d=c.entries();e=d.next();a.label=1;case 1:return e.done?[3,4]:[4,e.value[1]];case 2:a.sent(),a.label=3;case 3:return e=d.next(),[3,1];case 4:return[3,9];case 5:b=h.valuesOfMap(c),f=0,g=b,a.label=6;case 6:if(!(f<g.length))return[3,9];e=g[f];return[4,e];case 7:a.sent(),a.label=8;case 8:return f++,[3,6];case 9:return[2]}})}
function J(c,d,e){var b,f;return a.__generator(this,function(a){switch(a.label){case 0:return d.clear(),c.forEach(function(a,c){var b=d.pushNew();b.id=c;b.prio=a.info?-a.info[e].distance:Number.MAX_VALUE}),[4];case 1:a.sent(),b=d.iterableSort(function(a,c){return c.prio-a.prio}),f=b.next(),a.label=2;case 2:return f.done?[3,5]:[4];case 3:a.sent(),a.label=4;case 4:return f=b.next(),[3,2];case 5:return d.forEach(function(a){var d=c.get(a.id);d&&(c.delete(a.id),c.set(a.id,d))}),d.clear(),[2]}})}Object.defineProperty(b,
"__esModule",{value:!0});var E=r.vec3f64.create(),L=u.vec4f64.create(),M=u.vec4f64.create(),N=r.vec3f64.create(),Q=c.mat4f64.create(),R=A.sphere.create(),W=A.ray.create(),O=r.vec3f64.create(),U=z.create(),P=function(){return function(){this.aabr=z.create();this.distance=0;this.visible=this.culled=!1}}();n=function(){return function(a,c,d){void 0===d&&(d={});this.graphics3DGraphic=a;this.slicePlaneEnabled=c;this.info=d}}();b.DeconflictorGraphic=n;var ba=function(){function a(){this.active=new Map;
this.visible=new Map}a.prototype.clear=function(){this.active.clear();this.visible.clear()};return a}(),V=function(){return function(){}}(),T=function(){return function(){this.sortArray=new g({allocator:function(a){return a||new V}})}}(),X=function(){function a(){this.camera=new C.default;this.slicePlane=A.boundedPlane.create();this.slicePlaneEnabled=!1}a.prototype.copyFrom=function(a){this.camera.copyFrom(a.camera);A.boundedPlane.copy(a.slicePlane,this.slicePlane);this.slicePlaneEnabled=a.slicePlaneEnabled};
return a}();b.DeconflictorViewState=X;m=function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a._dirty=!1;a._runningViewState=new X;a._state=0;a.graphics=new ba;a.iterators=new T;a.accBinsNumX=15;a.accBinsNumY=20;a.accBinsSizeX=0;a.accBinsSizeY=0;a.accBins=null;a.accNumTests=0;return a}a.__extends(b,c);Object.defineProperty(b.prototype,"dirty",{get:function(){return this._dirty},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"state",{get:function(){return this._state},
enumerable:!0,configurable:!0});b.prototype.destroy=function(){this.graphics.clear();this.iterators=null};b.prototype.setDirty=function(){!this._dirty&&0<this.graphics.active.size&&(this._dirty=!0,this.notifyChange("updating"))};Object.defineProperty(b.prototype,"updating",{get:function(){return 0!==this._state||this._dirty},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"updatingProgress",{get:function(){if(!this.updating)return 1;var a=this._state/4;return this._dirty?.5*a:a},
enumerable:!0,configurable:!0});b.prototype.needsUpdate=function(){return this.view.ready&&null!=this.view.state&&this.updating};b.prototype.update=function(a){switch(this._state){case 0:this.startUpdate(),a.madeProgress();case 1:if(this._state=1,!this.processActiveGraphics(a))break;case 2:if(this._state=2,!this.sortVisibleGraphics(a))break;case 3:if(this._state=3,!this.deconflictVisibleGraphics(a))break;default:w.drawAccelerationStruct(this,this.graphics.visible),this._state=0,this.notifyChange("updating")}};
b.prototype.modifyGraphics=function(a,c){var d=this;c?a.forEach(function(a){return d.addToActiveGraphics(a)}):a.forEach(function(a){return d.removeFromActiveGraphics(a)});this.setDirty()};b.prototype.layerSupportsDeconfliction=function(a){if(f.isNone(a)||"object3d"!==a.type)return!1;a=a.stageObject;return 1===(a?a.getNumGeometryRecords():0)&&a.getGeometryRecord(0).material instanceof I.default?!0:!1};b.prototype.startUpdate=function(){w.prepare(this.view);this._dirty=!1;this._runningViewState.copyFrom(this.viewState);
var a=this._runningViewState.camera;this.initBins(a.fullWidth,a.fullHeight);this.resetIterators()};b.prototype.addToActiveGraphics=function(a){a.info[this.visibilityGroup]=new P;this.graphics.active.set(a.graphics3DGraphic.graphic.uid,a);this.setDirty()};b.prototype.removeFromActiveGraphics=function(a){this.removeFromVisibleGraphics(a);var c=a.graphics3DGraphic;c.destroyed||c.clearVisibilityFlag(3,this.visibilityGroup);delete a.info[this.visibilityGroup];this.graphics.active.delete(a.graphics3DGraphic.graphic.uid);
this.setDirty()};b.prototype.addToVisibleGraphics=function(a){this.graphics.visible.set(a.graphics3DGraphic.graphic.uid,a)};b.prototype.removeFromVisibleGraphics=function(a){this.graphics.visible.delete(a.graphics3DGraphic.graphic.uid)};b.prototype.processActiveGraphics=function(a){var c=this.ensureActiveGraphicsIterator(),e=d.mat4.invert(Q,this._runningViewState.camera.projectionMatrix),b="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&0<this._runningViewState.camera.relativeElevation?
R:null,g=0;f.isSome(b)&&(p.vec3.transformMat4(b.center,v.ZEROS,this._runningViewState.camera.viewMatrix),b.radius=y.earthRadius,g=A.sphere.distanceToSilhouette(b,v.ZEROS));for(;!a.done;){a.madeProgress();var k=c.next();if(k.done)return this.resetActiveGraphicsIterator(),!0;var l=(k=k.value)&&k.info[this.visibilityGroup];l&&(this.collectGraphics3DGraphics(k,e,b,g),l.culled?this.removeFromVisibleGraphics(k):this.addToVisibleGraphics(k))}return!1};b.prototype.sortVisibleGraphics=function(a){for(var c=
this.ensureSortGraphicsIterator();!a.done;){var d=c.next();a.madeProgress();if(d.done)return this.resetSortGraphicsIterator(),!0}return!1};b.prototype.deconflictVisibleGraphics=function(a){for(var c=this.ensureVisibleGraphicsIterator(),d=1===this.visibilityGroup;!a.done;){a.madeProgress();var e=c.next();if(e.done)return this.resetVisibleGraphicsIterator(),!0;var e=e.value,b=e.info[this.visibilityGroup];if(b&&!b.culled){var f=e.graphics3DGraphic;(f=(!d||f.isVisible())&&!this.isConflicted(e))&&this.addToBins(e);
b.visible=f;this.setGraphicVisibility(e,f);w.drawPoly(b,f)}}return!1};b.prototype.resetIterators=function(){this.iterators.active=null;this.iterators.visible=null;this.iterators.sort=null};b.prototype.ensureActiveGraphicsIterator=function(){this.iterators.active||(this.iterators.active=G(this.graphics.active));return this.iterators.active};b.prototype.resetActiveGraphicsIterator=function(){this.iterators.active=null};b.prototype.ensureVisibleGraphicsIterator=function(){this.iterators.visible||(this.iterators.visible=
G(this.graphics.visible));return this.iterators.visible};b.prototype.resetVisibleGraphicsIterator=function(){this.iterators.visible=null};b.prototype.ensureSortGraphicsIterator=function(){this.iterators.sort||(this.iterators.sort=J(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup));return this.iterators.sort};b.prototype.resetSortGraphicsIterator=function(){this.iterators.sort=null};b.prototype.collectGraphics3DGraphics=function(a,c,d,e){var b=a.graphics3DGraphic;if(!b.destroyed){var g=
a.info[this.visibilityGroup];if(b.isVisible(0,3)){b=this.getGraphicsLayers(b);z.empty(g.aabr);for(var k=null,l=0;l<b.length;l++){var h=b[l];if(this.layerSupportsDeconfliction(h)){var p=h.stageObject.getGeometryRecord(0).material;if(f.isNone(k)){k=this.getProjectionInfo(h,c,da);if(k.isOutsideScreen||this.isCulledBySlice(a,E)||f.isSome(d)&&this.isCulledByHorizon(k,d,e)){g.culled=!0;return}!q.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET&&g.visible&&(k.distance*=.7)}this.expandBoundingRect(g,h,p,k)}}f.isNone(k)?
g.culled=!0:(g.distance=k.distance,g.culled=!1)}else g.culled=!0}};b.prototype.getProjectionInfo=function(a,c,d){var e=this._runningViewState.camera;a=a.stageObject;var b=a.getGeometryRecord(0),f=b.material,g=a.getCenter();p.vec3.transformMat4(E,g,e.viewMatrix);b=b.geometry.data.getVertexAttr();g=b[H.VertexAttrConstants.AUXPOS1].data;f.applyShaderOffsetsView(E,b[H.VertexAttrConstants.NORMAL].data,a.objectTransformation,g,e,d.scaleInfo,E);t.vec4.set(L,E[0],E[1],E[2],1);t.vec4.transformMat4(M,L,e.projectionMatrix);
p.vec3.scale(d.positionNDC,M,1/M[3]);f.applyShaderOffsetsNDC(d.positionNDC,g,e,d.positionNDC,N);d.distanceWithoutPolygonOffset=e.depthNDCToWorld(N[2]);d.distance=N[2]===d.positionNDC[2]?d.distanceWithoutPolygonOffset:e.depthNDCToWorld(d.positionNDC[2]);t.vec4.set(M,d.positionNDC[0],d.positionNDC[1],d.positionNDC[2],1);t.vec4.transformMat4(L,M,c);t.vec4.scale(L,L,1/L[3]);p.vec3.set(d.positionView,E[0],E[1],E[2]);return d};b.prototype.isCulledByHorizon=function(a,c,d){p.vec3.copy(W.direction,a.positionView);
p.vec3.set(W.origin,0,0,0);return B.intersectRay(c,W,O)?a.distanceWithoutPolygonOffset>d:!1};b.prototype.isCulledBySlice=function(a,c){return a.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&A.boundedPlane.extrusionContainsPoint(this._runningViewState.slicePlane,c)};b.prototype.expandBoundingRect=function(a,c,d,b){var f=b.positionNDC;b=b.scaleInfo;var g=this._runningViewState.camera;c=c.getScreenSize(Y);F.applyPrecomputedScaleFactor(c,b.factor,c);c[0]*=g.pixelRatio;c[1]*=g.pixelRatio;
d=z.offset(d.calculateRelativeScreenBounds(c,b.factorAlignment.scale,U),e.lerp(0,g.fullWidth,.5+.5*f[0]),e.lerp(0,g.fullHeight,.5+.5*f[1]));f=this.iconMarginFactor;0!==f&&(f*=Math.min(z.width(d),z.height(d)),d[0]-=f,d[1]-=f,d[2]+=f,d[3]+=f);z.expand(a.aabr,d)};b.prototype.isConflicted=function(a){var c=a.graphics3DGraphic.graphic.uid;a=a.info[this.visibilityGroup];for(var d=Math.floor(a.aabr[0]/this.accBinsSizeX);d<=Math.floor(a.aabr[2]/this.accBinsSizeX);d++)if(!(0>d||d>=this.accBinsNumX))for(var e=
Math.floor(a.aabr[1]/this.accBinsSizeY);e<=Math.floor(a.aabr[3]/this.accBinsSizeY);e++)if(!(0>e||e>=this.accBinsNumY))for(var b=this.accBins[d][e],f=0;f<b.length;f++){var g=b.data[f],k=g.info[this.visibilityGroup];if(k&&k.visible&&g.graphics3DGraphic.graphic.uid!==c&&(this.accNumTests++,z.intersects(k.aabr,a.aabr)))return!0}return!1};b.prototype.initBins=function(a,c){if(null==this.accBins){this.accBins=[];for(var d=0;d<this.accBinsNumX;d++){this.accBins.push([]);for(var e=this.accBins[this.accBins.length-
1],b=0;b<this.accBinsNumY;b++)e.push(new g)}}else for(d=0;d<this.accBinsNumX;d++)for(b=0;b<this.accBinsNumY;b++)this.accBins[d][b].clear();this.accBinsSizeX=a/this.accBinsNumX;this.accBinsSizeY=c/this.accBinsNumY;this.accNumTests=0};b.prototype.addToBins=function(a){for(var c=a.info[this.visibilityGroup],d=Math.floor(c.aabr[2]/this.accBinsSizeX),e=Math.floor(c.aabr[1]/this.accBinsSizeY),b=Math.floor(c.aabr[3]/this.accBinsSizeY),c=Math.floor(c.aabr[0]/this.accBinsSizeX);c<=d;c++)if(!(0>c||c>=this.accBinsNumX))for(var f=
e;f<=b;f++)0>f||f>=this.accBinsNumY||this.accBins[c][f].push(a)};b.prototype.setGraphicVisibility=function(a,c){a=a.graphics3DGraphic;a.destroyed||(a.setVisibilityFlag(3,c,this.visibilityGroup),1===this.visibilityGroup&&this.view.labeler.setLabelGraphicVisibility(a,c))};a.__decorate([l.property({constructOnly:!0})],b.prototype,"view",void 0);a.__decorate([l.property({type:Boolean,readOnly:!0})],b.prototype,"updating",null);return b=a.__decorate([l.subclass("esri.views.3d.layers.graphics.Deconflictor")],
b)}(m);b.Deconflictor=m;var Y=k.vec2f64.create(),da=new (function(){function a(){this.positionView=r.vec3f64.create();this.positionNDC=r.vec3f64.create();this.distanceWithoutPolygonOffset=this.distance=0;this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}Object.defineProperty(a.prototype,"isOutsideScreen",{get:function(){var a=this.positionNDC;return-1>a[0]||-1>a[1]||-1>a[2]||1<=a[0]||1<=a[1]},enumerable:!0,configurable:!0});
return a}())})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["require","exports","../../support/debugFlags"],function(n,b,a){function m(a,e,b,f,g){l&&(l(),l=null);var k=d.height,h=c;h.beginPath();h.lineWidth=1;h.strokeStyle=g;h.moveTo(a,k-b);h.lineTo(e,k-b);h.stroke();h.lineTo(e,k-f);h.stroke();h.lineTo(e,k-b);h.stroke();h.lineTo(a,k-b);h.stroke();h.lineTo(a,k-b);h.stroke();h.closePath()}Object.defineProperty(b,"__esModule",{value:!0});var h=!1,e=!1,f=!1,g=!1,l=null,d,c;b.drawAccelerationStruct=
function(a,d){if(e&&c){l&&(l(),l=null);for(var b=c,f=0,g=0;g<a.accBinsNumX;g++)for(var k=0;k<a.accBinsNumY;k++){var h=a.accBins[g][a.accBinsNumY-1-k],f=f+h.length,p=g*a.accBinsSizeX,q=(g+1)*a.accBinsSizeX,y=k*a.accBinsSizeY,A=(k+1)*a.accBinsSizeY;b.fillText(h.length.toFixed(),p+5,y+15);m(p,q,y,A,"blue")}b.fillText("total totalShownLabels: "+f,70,40);b.fillText("total visible labels: "+d.size,70,50);b.fillText("total numTests: "+a.accNumTests,70,30)}};b.prepare=function(b){f=a.DECONFLICTOR_SHOW_VISIBLE;
g=a.DECONFLICTOR_SHOW_INVISIBLE;h=f||g;e=a.DECONFLICTOR_SHOW_GRID;l=null;h||e?l=function(){null==d&&(d=document.createElement("canvas"),d.setAttribute("id","canvas2d"),b.surface.parentElement.style.position="relative",b.surface.parentElement.appendChild(d));var a=b.height*b.pixelRatio;d.setAttribute("width",b.width*b.pixelRatio+"px");d.setAttribute("height",a+"px");d.setAttribute("style","position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:"+b.width+"px;height:"+b.height+"px");
c=d.getContext("2d");c.clearRect(0,0,b.width,b.height);c.font="12px Arial"}:d&&(d.parentElement.removeChild(d),d=null)};b.drawPoly=function(a,c){h&&(c&&f||!c&&g)&&m(a.aabr[0],a.aabr[2],a.aabr[1],a.aabr[3],c?"green":"red")}})},"esri/views/3d/support/debugFlags":function(){define(["require","exports","tslib","../../../core/Accessor","../../../core/accessorSupport/decorators"],function(n,b,a,m,h){return new (function(e){function b(){var a=null!==e&&e.apply(this,arguments)||this;a.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=
!1;a.SCENEVIEW_LOCKING_LOG=!1;a.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1;a.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;a.DECONFLICTOR_SHOW_VISIBLE=!1;a.DECONFLICTOR_SHOW_INVISIBLE=!1;a.DECONFLICTOR_SHOW_GRID=!1;a.LABELS_SHOW_BORDER=!1;a.OVERLAY_DRAW_DEBUG_TEXTURE=!1;a.OVERLAY_SHOW_CENTER=!1;a.TERRAIN_DEBUG_POPUP=!1;a.TESTS_DISABLE_UPDATE_THRESHOLDS=!1;a.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1;a.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1;a.DRAW_MESH_GEOMETRY_NORMALS=!1;a.FEATURE_TILE_FETCH_SHOW_TILES=
!1;a.FEATURE_TILE_TREE_SHOW_TILES=!1;a.I3S_TREE_SHOW_TILES=!1;a.I3S_SHOW_MODIFICATIONS=!1;a.ENABLE_PROFILE_DEPTH_RANGE=!1;a.DISABLE_FAST_UPDATES=!1;a.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;a.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;a.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1;return a}a.__extends(b,e);a.__decorate([h.property()],b.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);a.__decorate([h.property()],b.prototype,"SCENEVIEW_LOCKING_LOG",void 0);a.__decorate([h.property()],b.prototype,
"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0);a.__decorate([h.property()],b.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);a.__decorate([h.property()],b.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0);a.__decorate([h.property()],b.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0);a.__decorate([h.property()],b.prototype,"DECONFLICTOR_SHOW_GRID",void 0);a.__decorate([h.property()],b.prototype,"LABELS_SHOW_BORDER",void 0);a.__decorate([h.property()],b.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0);
a.__decorate([h.property()],b.prototype,"OVERLAY_SHOW_CENTER",void 0);a.__decorate([h.property()],b.prototype,"TERRAIN_DEBUG_POPUP",void 0);a.__decorate([h.property()],b.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0);a.__decorate([h.property()],b.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0);a.__decorate([h.property()],b.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0);a.__decorate([h.property()],b.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);a.__decorate([h.property()],
b.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);a.__decorate([h.property()],b.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);a.__decorate([h.property()],b.prototype,"I3S_TREE_SHOW_TILES",void 0);a.__decorate([h.property()],b.prototype,"I3S_SHOW_MODIFICATIONS",void 0);a.__decorate([h.property()],b.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0);a.__decorate([h.property()],b.prototype,"DISABLE_FAST_UPDATES",void 0);a.__decorate([h.property()],b.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",
void 0);a.__decorate([h.property()],b.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);a.__decorate([h.property()],b.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);return b=a.__decorate([h.subclass("esri.views.3d.support.DebugFlags")],b)}(m))})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["require","exports","../../../../core/mathUtils","../../support/earthUtils"],function(n,b,a,m){function h(a,d,e){var b=e.parameters;e=e.paddingPixelsOverride;
c.scale=Math.min(b.divisor/(d-b.offset),1);c.factor=Math.abs(a*a*a);c.minPixelSize=b.minPixelSize;c.paddingPixels=e;return c}function e(a,c){return 0===a?c.minPixelSize:c.minPixelSize*(1+2*c.paddingPixels/a)}function f(c,d){return Math.max(a.lerp(c*d.scale,c,d.factor),e(c,d))}Object.defineProperty(b,"__esModule",{value:!0});b.getSettings=function(a){return new g(a,l)};b.getLabelSettings=function(a){var c=l.curvatureDependent;return new g(a,{curvatureDependent:{min:{curvature:c.min.curvature,tiltAngle:c.min.tiltAngle,
scaleFallOffFactor:d.curvatureDependent.min.scaleFallOffFactor},max:{curvature:c.max.curvature,tiltAngle:c.max.tiltAngle,scaleFallOffFactor:d.curvatureDependent.max.scaleFallOffFactor}},scaleStart:l.scaleStart,scaleFallOffRange:l.scaleFallOffRange,minPixelSize:d.minPixelSize})};b.applyScaleFactor=f;b.applyScaleFactorVec2=function(c,d,b){void 0===b&&(b=[0,0]);var f=Math.min(Math.max(d.scale,e(c[1],d)/c[1]),1);b[0]=a.lerp(c[0]*f,c[0],d.factor);b[1]=a.lerp(c[1]*f,c[1],d.factor);return b};b.precomputeScaleFactor=
function(a,c,d,e){a=h(a,c,d);a.minPixelSize=0;a.paddingPixels=0;a=f(1,a);e.scale=a;e.factor=0;e.minPixelSize=d.parameters.minPixelSize;e.paddingPixels=d.paddingPixelsOverride};b.applyPrecomputedScaleFactor=function(a,c,d){void 0===d&&(d=[0,0]);c=Math.min(Math.max(c.scale,e(a[1],c)/a[1]),1);d[0]=a[0]*c;d[1]=a[1]*c;return d};b.scale=function(a,c,d,e){return f(a,h(c,d,e))};var g=function(){function c(a,c,d,e){void 0===d&&(d={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0});
this.viewingMode=a;this.description=c;this.parameters=d;this._paddingPixelsOverride=e;"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}Object.defineProperty(c.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||
this.parameters.paddingPixels},enumerable:!0,configurable:!0});c.prototype.update=function(a){if(this.parameters&&this.parameters.camera.fovY===a.fovY&&this.parameters.camera.distance===a.distance)return!1;this.calculateParameters(a,this.parameters);return!0};c.prototype.overridePadding=function(a){return a!==this.paddingPixelsOverride?new c(this.viewingMode,this.description,this.parameters,a):this};c.prototype.calculateParameters=function(a,c){var d=this.description,e=d.scaleStart,b=d.scaleFallOffRange,
d=d.minPixelSize,f=a.fovY,g=a.distance,k=this.calculateCurvatureDependentParameters(a),l=this.coverageCompensation(a,k),h=k.tiltAngle,k=k.scaleFallOffFactor,g=Math.sin(h)*g,h=.5*Math.PI-h-f*(.5-e*l),e=g/Math.cos(h),b=(e-g/Math.cos(h+f*b*l)*k)/(1-k);c.camera.fovY=a.fovY;c.camera.distance=a.distance;c.offset=b;c.divisor=e-b;c.minPixelSize=d;return c};c.prototype.calculateCurvatureDependentParametersLocal=function(a,c){void 0===c&&(c=k);c.tiltAngle=this.description.curvatureDependent.min.tiltAngle;c.scaleFallOffFactor=
this.description.curvatureDependent.min.scaleFallOffFactor;return c};c.prototype.calculateCurvatureDependentParametersGlobal=function(c,d){void 0===d&&(d=k);var e=this.description.curvatureDependent;c=1+c.distance/m.earthRadius;var b=[e.min.curvature,e.max.curvature],f=b[0];c=a.clamp((Math.sqrt(c*c-1)-f)/(b[1]-f),0,1);b=[e.min,e.max];e=b[0];b=b[1];d.tiltAngle=a.lerp(e.tiltAngle,b.tiltAngle,c);d.scaleFallOffFactor=a.lerp(e.scaleFallOffFactor,b.scaleFallOffFactor,c);return d};c.prototype.surfaceCoverageCompensationLocal=
function(a,c){return(a.fovY-c.tiltAngle)/a.fovY};c.prototype.surfaceCoverageCompensationGlobal=function(a,c){var d=m.earthRadius*m.earthRadius;c=c.tiltAngle+.5*Math.PI;var e=a.fovY;a=a.distance;a=a*a+d-2*Math.cos(c)*a*m.earthRadius;var b=Math.sqrt(a);return(Math.acos(Math.sqrt(a-d)/b)-Math.asin(m.earthRadius/(b/Math.sin(c)))+.5*e)/e};return c}(),l={curvatureDependent:{min:{curvature:a.deg2rad(10),tiltAngle:a.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:a.deg2rad(70),tiltAngle:a.deg2rad(40),scaleFallOffFactor:.8}},
scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},d={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14},c={scale:0,factor:0,minPixelSize:0,paddingPixels:0},k={tiltAngle:0,scaleFallOffFactor:0}})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("require exports tslib ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../support/buffer/InterleavedLayout ../lib/geometryDataUtils ../lib/GLMaterialTexture ../lib/Material ../lib/screenSizePerspectiveUtils ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/MergedRenderer ./renderers/utils ../shaders/HUDMaterial.glsl ../shaders/HUDMaterialTechnique".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G){function J(a,c,d,e,b,f,g,k){c=c-b-(0<k[0]?e[0]*k[0]:0);var l=c+e[0]+2*b;d=d-b-(0<k[1]?e[1]*k[1]:0);b=d+e[1]+2*b;g.textureIsSignedDistanceField&&(g=g.distanceFieldBoundingBox,c+=e[0]*g[0],d+=e[1]*g[1],l-=e[0]*(1-g[2]),b-=e[1]*(1-g[3]),c-=f,l+=f,d-=f,b+=f);return a[0]>c&&a[0]<l&&a[1]>d&&a[1]<b}Object.defineProperty(b,"__esModule",{value:!0});n=function(d){function e(a,c){c=d.call(this,c)||this;c.techniqueConfig=new G.HUDMaterialTechniqueConfiguration;
c.params=C.copyParameters(a,la);return c}a.__extends(e,d);e.prototype.setParameterValues=function(a){for(var c in a)"textureId"===c&&A.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[c]=a[c];this.parametersChanged()};e.prototype.getParameters=function(){return this.params};e.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.verticalOffset=
!!this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective;this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0;this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset;this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest;this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField;this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled;this.techniqueConfig.vvColor=!!this.params.vvColorEnabled;
0===a&&(this.techniqueConfig.debugDrawBorder=!!this.params.debugDrawBorder);4===a&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion);this.techniqueConfig.depthEnabled=this.params.depthEnabled;return this.techniqueConfig};e.prototype.intersect=function(a,c,d,e,b,f,g,k,l){l?this.intersectDrapedHudGeometry(a,f,g,k):this.intersectHudGeometry(a,c,d,e,g,k)};e.prototype.intersectDrapedHudGeometry=function(a,c,d,e){var b=a.getAttribute(A.VertexAttrConstants.POSITION),f=
a.getAttribute(A.VertexAttrConstants.SIZE),g=this.params,k=I.calculateAnchorPosForRendering(g),l=1,h=1;e&&(h=e(Y),l=h[0],h=h[5]);l*=a.pixelRatio;h*=a.pixelRatio;e=fa*a.pixelRatio;for(var p=0;p<b.data.length/b.size;p++){var q=p*b.size,r=b.data[q],q=b.data[q+1],m=p*f.size;ga[0]=f.data[m]*l;ga[1]=f.data[m+1]*h;m=void 0;g.textureIsSignedDistanceField&&(m=g.outlineSize*a.pixelRatio/2);J(c,r,q,ga,e,m,g,k)&&d()}};e.prototype.intersectHudGeometry=function(a,c,d,e,b,g){if(e.options.selectionMode&&e.options.hud&&
!H.isInstanceHidden(c)){var k=a.data;a=this.params;var h=c=1;f.mat3.fromMat4(P,d);if(g){h=g(Y);c=h[0];h=h[5];g=P;var q=g[0],m=g[1],t=g[2],u=g[3],w=g[4],v=g[5],z=g[6],B=g[7],C=g[8],E=1/Math.sqrt(q*q+m*m+t*t),F=1/Math.sqrt(u*u+w*w+v*v),G=1/Math.sqrt(z*z+B*B+C*C);g[0]=q*E;g[1]=m*E;g[2]=t*E;g[3]=u*F;g[4]=w*F;g[5]=v*F;g[6]=z*G;g[7]=B*G;g[8]=C*G}g=k.getVertexAttr()[A.VertexAttrConstants.POSITION];q=k.getVertexAttr()[A.VertexAttrConstants.SIZE];m=k.getVertexAttr()[A.VertexAttrConstants.NORMAL];k=k.getVertexAttr()[A.VertexAttrConstants.AUXPOS1];
A.assert(3<=g.size);t=e.point;u=e.camera;w=I.calculateAnchorPosForRendering(a);c*=u.pixelRatio;h*=u.pixelRatio;v="screen"===this.params.centerOffsetUnits;for(z=0;z<g.data.length/g.size;z++)B=z*g.size,p.vec3.set(Q,g.data[B],g.data[B+1],g.data[B+2]),p.vec3.transformMat4(Q,Q,d),B=z*q.size,ga[0]=q.data[B]*c,ga[1]=q.data[B+1]*h,p.vec3.transformMat4(Q,Q,u.viewMatrix),B=z*k.size,p.vec3.set(T,k.data[B+0],k.data[B+1],k.data[B+2]),v||(Q[0]+=T[0],Q[1]+=T[1],0!==T[2]&&(B=T[2],p.vec3.normalize(T,Q),p.vec3.subtract(Q,
Q,p.vec3.scale(T,T,B)))),B=z*m.size,p.vec3.set(R,m.data[B],m.data[B+1],m.data[B+2]),this.normalAndViewAngle(R,P,u,X),this.applyVerticalOffsetTransformationView(Q,X,u,M),u.applyProjection(Q,W),-1<W[0]&&(B=Math.floor(W[0])+this.params.screenOffset[0],C=Math.floor(W[1])+this.params.screenOffset[1],v&&(B+=T[0],0!==T[1]&&(C+=y.applyScaleFactor(T[1],M.factorAlignment))),y.applyPrecomputedScaleFactor(ga,M.factor,ga),E=da*u.pixelRatio,F=void 0,a.textureIsSignedDistanceField&&(F=a.outlineSize*u.pixelRatio/
2),J(t,B,C,ga,E,F,a,w)&&(C=e.ray,p.vec3.transformMat4(U,Q,l.mat4.invert(V,u.viewMatrix)),W[0]=t[0],W[1]=t[1],u.unprojectPoint(W,Q),B=r.vec3f64.create(),p.vec3.copy(B,C.direction),E=1/p.vec3.length(B),p.vec3.scale(B,B,E),C=p.vec3.distance(C.origin,Q)*E,b(C,B,-1,1,!0,U)))}};e.prototype.computeAttachmentOrigin=function(a,c){a=a.data;var d="getVertexAttr"in a?a.getVertexAttr():"vertexAttr"in a?a.vertexAttr:null;if(!d)return null;var e=A.VertexAttrConstants.POSITION,d=d[e];a="getIndices"in a?a.getIndices(e):
"indices"in a?a.indices[e]:null;return z.computeAttachmentOriginPoints(d,a,c)};e.prototype.createBufferWriter=function(){return new Z(this)};e.prototype.createRenderer=function(a,c){return new F(a,c,this)};e.prototype.normalAndViewAngle=function(a,c,d,e){t.isMat4(c)&&(c=f.mat3.fromMat4(ba,c));p.vec3.transformMat3(e.normal,a,c);p.vec3.transformMat4(e.normal,e.normal,d.viewInverseTransposeMatrix);e.cosAngle=p.vec3.dot(O,ka);return e};e.prototype.updateScaleInfo=function(a,c,d){var e=this.params;e.screenSizePerspective?
y.precomputeScaleFactor(d,c,e.screenSizePerspective,a.factor):(a.factor.scale=1,a.factor.factor=0,a.factor.minPixelSize=0,a.factor.paddingPixels=0);e.screenSizePerspectiveAlignment?y.precomputeScaleFactor(d,c,e.screenSizePerspectiveAlignment,a.factorAlignment):(a.factorAlignment.factor=a.factor.factor,a.factorAlignment.scale=a.factor.scale,a.factorAlignment.minPixelSize=a.factor.minPixelSize,a.factorAlignment.paddingPixels=a.factor.paddingPixels)};e.prototype.applyShaderOffsetsView=function(a,c,d,
e,b,f,g){c=this.normalAndViewAngle(c,d,b,X);this.applyVerticalGroundOffsetView(a,c,b,g);this.applyVerticalOffsetTransformationView(g,c,b,f);this.applyPolygonOffsetView(g,c,e[3],b,g);this.applyCenterOffsetView(g,e,g);return g};e.prototype.applyShaderOffsetsNDC=function(a,c,d,e,b){this.applyCenterOffsetNDC(a,c,d,e);h.isSome(b)&&p.vec3.copy(b,e);this.applyPolygonOffsetNDC(e,c,d,e);return e};e.prototype.applyPolygonOffsetView=function(a,c,d,e,b){var f=e.aboveGround?1:-1;d=m.sign(d);0===d&&(d=f);f*=d;
if(0>=this.params.shaderPolygonOffset)return p.vec3.copy(b,a);c=m.clamp(Math.abs(c.cosAngle),.01,1);e=1-Math.sqrt(1-c*c)/c/e.viewport[2];0<f?p.vec3.scale(b,a,e):p.vec3.scale(b,a,1/e);return b};e.prototype.applyVerticalGroundOffsetView=function(a,c,d,e){var b=p.vec3.length(a),f=d.aboveGround?1:-1;d=.5*d.computeRenderPixelSizeAtDist(b);c=p.vec3.scale(Q,c.normal,f*d);p.vec3.add(e,a,c);return e};e.prototype.applyVerticalOffsetTransformationView=function(a,c,d,e){var b=this.params;if(!b.verticalOffset||
!b.verticalOffset.screenLength){if(b.screenSizePerspective||b.screenSizePerspectiveAlignment){var f=p.vec3.length(a);this.updateScaleInfo(e,f,c.cosAngle)}else e.factor.scale=1,e.factorAlignment.scale=1;return a}f=p.vec3.length(a);d=C.verticalOffsetAtDistance(d,f,b.verticalOffset,c.cosAngle,b.screenSizePerspectiveAlignment||b.screenSizePerspective);this.updateScaleInfo(e,f,c.cosAngle);p.vec3.scale(c.normal,c.normal,d);return p.vec3.add(a,a,c.normal)};e.prototype.applyCenterOffsetView=function(a,c,
d){var e="screen"!==this.params.centerOffsetUnits;d!==a&&p.vec3.copy(d,a);e&&(d[0]+=c[0],d[1]+=c[1],c[2]&&(p.vec3.normalize(R,d),p.vec3.add(d,d,p.vec3.scale(R,R,c[2]))));return d};e.prototype.applyCenterOffsetNDC=function(a,c,d,e){var b="screen"!==this.params.centerOffsetUnits;e!==a&&p.vec3.copy(e,a);b||(e[0]+=c[0]/d.fullWidth*2,e[1]+=c[1]/d.fullHeight*2);return e};e.prototype.applyPolygonOffsetNDC=function(a,c,d,e){var b=this.params.shaderPolygonOffset;a!==e&&p.vec3.copy(e,a);b&&(a=d.aboveGround?
1:-1,c=a*m.sign(c[3]),e[2]-=(c||a)*b);return e};e.prototype.getGLMaterial=function(a){if(0===a.output)return new E(a);if(4===a.output)return new L(a)};e.prototype.calculateRelativeScreenBounds=function(a,d,e){void 0===e&&(e=u.create());var b=this.params,f=e;void 0===f&&(f=N);c.vec2.copy(f,b.anchorPos);f[0]*=-a[0];f[1]*=-a[1];f[0]+=b.screenOffset[0]*d;f[1]+=b.screenOffset[1]*d;e[2]=e[0]+a[0];e[3]=e[1]+a[1];return e};e.shouldRenderVisibilityDuringRenderPass=function(a){return 0===a||4};return e}(q.Material);
b.default=n;b=function(c){function d(d){d=c.call(this,a.__assign(a.__assign({},d),d.material.getParameters()))||this;d.updateParameters();return d}a.__extends(d,c);d.prototype.beginSlot=function(a){return a===(this.params.drawInSecondSlot?19:18)};d.prototype.updateParameters=function(){this.params=C.copyParameters(this.material.getParameters());this.updateTexture(this.params.textureId);this.selectProgram()};d.prototype.selectProgram=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(G.HUDMaterialTechnique,
this.material.getTechniqueConfig(this.output),this.technique)};d.prototype.bind=function(a,c){a.bindProgram(this.technique.program);this.bindTexture(a,this.technique.program);this.bindTextureScale(a,this.technique.program);this.technique.bindPass(a,this.params,c)};return d}(w);var E=function(c){function d(d){d=c.call(this,a.__assign(a.__assign({},d),{output:0}))||this;d.isOcclusionSlot=!1;return d}a.__extends(d,c);d.prototype.beginSlot=function(a){var c=this.params.drawInSecondSlot?19:18;if(this.params.occlusionTest)return this.isOcclusionSlot=
12===a,12===a||a===c;this.isOcclusionSlot=!1;return a===c};d.prototype.getTechnique=function(){return this.isOcclusionSlot?this.occlusionTechnique:this.technique};d.prototype.selectProgram=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(G.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique);this.occlusionTechnique=this.techniqueRep.acquireAndReleaseExisting(G.HUDMaterialTechnique,this.material.getTechniqueConfig(6),this.occlusionTechnique)};d.prototype.bind=
function(a,c){var d=this.getTechnique();a.bindProgram(d.program);this.isOcclusionSlot||(this.bindTexture(a,d.program),this.bindTextureScale(a,d.program));d.bindPass(a,this.params,c)};return d}(b),L=function(c){function d(d){return c.call(this,a.__assign(a.__assign({},d),{output:4}))||this}a.__extends(d,c);return d}(b),M={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},N=k.vec2f64.create(),Q=r.vec3f64.create(),R=r.vec3f64.create(),
W=e.createRenderScreenPointArray3(),O=r.vec3f64.create(),U=r.vec3f64.create(),P=g.mat3f64.create(),ba=g.mat3f64.create(),V=d.mat4f64.create(),T=r.vec3f64.create(),X={normal:O,cosAngle:0},Y=d.mat4f64.create(),da=1,fa=2,ga=[0,0],ka=r.vec3f64.fromValues(0,0,1),la={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],
vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:k.vec2f64.fromValues(.5,.5),shaderPolygonOffset:1E-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,debugDrawBorder:!1},ia=v.newLayout().vec3f(A.VertexAttrConstants.POSITION).vec3f(A.VertexAttrConstants.NORMAL).vec2f(A.VertexAttrConstants.UV0).vec4u8(A.VertexAttrConstants.COLOR).vec2f(A.VertexAttrConstants.SIZE).vec4f(A.VertexAttrConstants.AUXPOS1).vec4f(A.VertexAttrConstants.AUXPOS2),
Z=function(){function a(a){this.material=a;this.vertexBufferLayout=ia}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return 6*a.indices[A.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,c,d,e){B.writePosition(c.indices[A.VertexAttrConstants.POSITION],c.vertexAttr[A.VertexAttrConstants.POSITION].data,a.transformation,d.position,e,6);B.writeNormal(c.indices[A.VertexAttrConstants.NORMAL],c.vertexAttr[A.VertexAttrConstants.NORMAL].data,
a.invTranspTransformation,d.normal,e,6);a=c.vertexAttr[A.VertexAttrConstants.UV0].data;var b=void 0,f=void 0,g=void 0,k=void 0;null==a||4>a.length?(a=this.material.getParameters(),f=b=0,g=a.texCoordScale[0],k=a.texCoordScale[1]):(b=a[0],f=a[1],g=a[2],k=a[3]);var g=Math.min(1.99999,g+1),k=Math.min(1.99999,k+1),l=c.indices[A.VertexAttrConstants.POSITION].length,h=d.uv0;a=e;for(var p=0;p<l;++p)h.set(a,0,b),h.set(a,1,f),a+=1,h.set(a,0,g),h.set(a,1,f),a+=1,h.set(a,0,g),h.set(a,1,k),a+=1,h.set(a,0,g),h.set(a,
1,k),a+=1,h.set(a,0,b),h.set(a,1,k),a+=1,h.set(a,0,b),h.set(a,1,f),a+=1;B.writeColor(c.indices[A.VertexAttrConstants.COLOR],c.vertexAttr[A.VertexAttrConstants.COLOR].data,4,d.color,e,6);b=c.indices[A.VertexAttrConstants.SIZE];f=c.vertexAttr[A.VertexAttrConstants.SIZE].data;g=b.length;k=d.size;a=e;for(p=0;p<g;++p)for(var l=f[2*b[p]],h=f[2*b[p]+1],q=0;6>q;++q)k.set(a,0,l),k.set(a,1,h),a+=1;c.indices[A.VertexAttrConstants.AUXPOS1]&&c.vertexAttr[A.VertexAttrConstants.AUXPOS1]&&B.writeBufferVec4(c.indices[A.VertexAttrConstants.AUXPOS1],
c.vertexAttr[A.VertexAttrConstants.AUXPOS1].data,d.auxpos1,e,6);c.indices[A.VertexAttrConstants.AUXPOS2]&&c.vertexAttr[A.VertexAttrConstants.AUXPOS2]&&B.writeBufferVec4(c.indices[A.VertexAttrConstants.AUXPOS2],c.vertexAttr[A.VertexAttrConstants.AUXPOS2].data,d.auxpos2,e,6)};return a}()})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["require","exports"],function(n,b){function a(a){return a instanceof Float32Array&&16<=a.length}function m(a){return Array.isArray(a)&&16<=a.length}Object.defineProperty(b,
"__esModule",{value:!0});b.isMat4f32=a;b.isMat4f64=m;b.isMat4=function(b){return a(b)||m(b)}})},"esri/views/3d/webgl-engine/lib/GLMaterialTexture":function(){define("require exports tslib ../../../../core/maybe ./DefaultTextureUnits ./GLMaterial".split(" "),function(n,b,a,m,h,e){return function(e){function b(a){var d=e.call(this,a)||this;d._textureIDs=new Set;d._textureRepository=a.textureRep;d._textureId=a.textureId;d._initTransparent=!!a.initTextureTransparent;d._texture=d._acquireIfNotUndefined(d._textureId);
d._textureNormal=d._acquireIfNotUndefined(a.normalTextureId);d._textureEmissive=d._acquireIfNotUndefined(a.emissiveTextureId);d._textureOcclusion=d._acquireIfNotUndefined(a.occlusionTextureId);d._textureMetallicRoughness=d._acquireIfNotUndefined(a.metallicRoughnessTextureId);return d}a.__extends(b,e);b.prototype.dispose=function(){var a=this;this._textureIDs.forEach(function(d){return a._textureRepository.release(d)});this._textureIDs.clear()};b.prototype.updateTexture=function(a){a!==this._textureId&&
(this._releaseIfNotUndefined(this._textureId),this._textureId=a,this._texture=this._acquireIfNotUndefined(this._textureId))};b.prototype.bindTexture=function(a,d){m.isSome(this._texture)&&(d.setUniform1i("tex",h.DefaultTextureUnits.DIFFUSE),a.bindTexture(this._texture.glTexture,h.DefaultTextureUnits.DIFFUSE));m.isSome(this._textureNormal)&&(d.setUniform1i("normalTexture",h.DefaultTextureUnits.NORMAL),a.bindTexture(this._textureNormal.glTexture,h.DefaultTextureUnits.NORMAL));m.isSome(this._textureEmissive)&&
(d.setUniform1i("texEmission",h.DefaultTextureUnits.EMISSION),a.bindTexture(this._textureEmissive.glTexture,h.DefaultTextureUnits.EMISSION));m.isSome(this._textureOcclusion)&&(d.setUniform1i("texOcclusion",h.DefaultTextureUnits.OCCLUSION),a.bindTexture(this._textureOcclusion.glTexture,h.DefaultTextureUnits.OCCLUSION));m.isSome(this._textureMetallicRoughness)&&(d.setUniform1i("texMetallicRoughness",h.DefaultTextureUnits.METALLIC_ROUGHNESS),a.bindTexture(this._textureMetallicRoughness.glTexture,h.DefaultTextureUnits.METALLIC_ROUGHNESS))};
b.prototype.bindTextureScale=function(a,d){(a=m.isSome(this._texture)&&this._texture.glTexture)&&a.descriptor.textureCoordinateScaleFactor?d.setUniform2fv("textureCoordinateScaleFactor",a.descriptor.textureCoordinateScaleFactor):d.setUniform2f("textureCoordinateScaleFactor",1,1)};b.prototype._acquireIfNotUndefined=function(a){if(!m.isNone(a))return this._textureIDs.add(a),this._textureRepository.acquire(a,this._initTransparent)};b.prototype._releaseIfNotUndefined=function(a){void 0!==a&&(this._textureIDs.delete(a),
this._textureRepository.release(a))};return b}(e.GLMaterial)})},"esri/views/3d/webgl-engine/lib/DefaultTextureUnits":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.DefaultTextureUnits={DIFFUSE:0,NORMAL:1,EMISSION:2,OCCLUSION:3,METALLIC_ROUGHNESS:4,SSAO:6,SHADOW_MAP:7}})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["require","exports","tslib","./AutoDisposable"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});
n=function(b){function e(a){var e=b.call(this)||this;e.material=a.material;e.techniqueRep=a.techniqueRep;e.output=a.output;return e}a.__extends(e,b);e.prototype.getTechnique=function(){return this.technique};e.prototype.getPipelineState=function(a,e){return this.getTechnique().pipeline};e.prototype.ensureResources=function(a){return 2};e.prototype.ensureParameters=function(a){};return e}(m.AutoDisposable);b.GLMaterial=n})},"esri/views/3d/webgl-engine/lib/AutoDisposable":function(){define(["require",
"exports","tslib"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.AutoDisposableMixin=function(b){return function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a._isDisposed=!1;return a}a.__extends(e,b);e.prototype.dispose=function(){for(var a=this.__proto__.__managedDisposables__||[],e=a.length-1;0<=e;e--){var b=a[e];this[b]&&"function"===typeof this[b].dispose&&this[b].dispose();this[b]=null}this._isDisposed=!0};Object.defineProperty(e.prototype,"isDisposed",
{get:function(){return this._isDisposed},enumerable:!0,configurable:!0});return e}(b)};n=function(b){function h(){return null!==b&&b.apply(this,arguments)||this}a.__extends(h,b);return h}(b.AutoDisposableMixin(function(){return function(){}}()));b.AutoDisposable=n;b.autoDispose=function(){return function(a,b){a.hasOwnProperty("__managedDisposables__")||(a.__managedDisposables__=a.__managedDisposables__?a.__managedDisposables__.slice():[]);a.__managedDisposables__.push(b)}}})},"esri/views/3d/webgl-engine/lib/Material":function(){define(["require",
"exports","../../../../core/maybe","./IdGen"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this.supportsEdges=!1;this._visible=!0;this._renderOccluded=1;this._insertOrder=this._renderPriority=0;this.id=b._idGen.gen(a)}b.prototype.dispose=function(){};b.prototype.update=function(a){return!1};Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},set:function(a){a!==this._visible&&(this._visible=a,this.parametersChanged())},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(a){a!==this._renderOccluded&&(this._renderOccluded=a,this.parametersChanged())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(a){a!==this._renderPriority&&(this._renderPriority=a,this.parametersChanged())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"insertOrder",{get:function(){return this._insertOrder},set:function(a){a!==this._insertOrder&&(this._insertOrder=a,this.parametersChanged())},enumerable:!0,configurable:!0});b.prototype.isVisibleInPass=function(a){return!0};b.prototype.isVisible=function(){return this._visible};b.prototype.parametersChanged=function(){a.isSome(this.materialRepository)&&this.materialRepository.materialChanged(this)};b._idGen=new m.IdGen;return b}();b.Material=n;b.materialPredicate=function(a,e){return a.isVisible()&&
a.isVisibleInPass(e.pass)&&0!==(a.renderOccluded&e.renderOccludedMask)}})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["require","exports","../../../support/buffer/BufferView","../../lib/Util"],function(n,b,a,m){function h(a,d,e,b,f){var c=e.typedBuffer;e=e.typedBufferStride;var g=a.length;b*=e;if(null==f||1===f)for(var k=0;k<g;++k){var l=2*a[k];c[b]=d[l];c[b+1]=d[l+1];b+=e}else for(k=0;k<g;++k)for(var l=2*a[k],h=0;h<f;++h)c[b]=d[l],c[b+1]=d[l+1],b+=e}function e(a,
d,e,b,f){var c=e.typedBuffer;e=e.typedBufferStride;var g=a.length;b*=e;if(null==f||1===f)for(var k=0;k<g;++k){var l=3*a[k];c[b]=d[l];c[b+1]=d[l+1];c[b+2]=d[l+2];b+=e}else for(k=0;k<g;++k)for(var l=3*a[k],h=0;h<f;++h)c[b]=d[l],c[b+1]=d[l+1],c[b+2]=d[l+2],b+=e}function f(a,d,e,b,f){var c=e.typedBuffer;e=e.typedBufferStride;var g=a.length;b*=e;if(null==f||1===f)for(var k=0;k<g;++k){var l=4*a[k];c[b]=d[l];c[b+1]=d[l+1];c[b+2]=d[l+2];c[b+3]=d[l+3];b+=e}else for(k=0;k<g;++k)for(var l=4*a[k],h=0;h<f;++h)c[b]=
d[l],c[b+1]=d[l+1],c[b+2]=d[l+2],c[b+3]=d[l+3],b+=e}function g(a,d,b,f,g,l){if(b){var c=f.typedBuffer;f=f.typedBufferStride;var k=a.length;g*=f;if(null==l||1===l)for(var h=0;h<k;++h){var p=3*a[h],m=d[p],r=d[p+1],t=d[p+2];c[g]=b[0]*m+b[4]*r+b[8]*t+b[12];c[g+1]=b[1]*m+b[5]*r+b[9]*t+b[13];c[g+2]=b[2]*m+b[6]*r+b[10]*t+b[14];g+=f}else for(h=0;h<k;++h)for(var p=3*a[h],m=d[p],r=d[p+1],t=d[p+2],p=b[0]*m+b[4]*r+b[8]*t+b[12],u=b[1]*m+b[5]*r+b[9]*t+b[13],m=b[2]*m+b[6]*r+b[10]*t+b[14],r=0;r<l;++r)c[g]=p,c[g+
1]=u,c[g+2]=m,g+=f}else e(a,d,f,g,l)}function l(a,d,b,f,g,l){if(b){var c=f.typedBuffer;f=f.typedBufferStride;var k=a.length,h=b[0],p=b[1],m=b[2],r=b[4],t=b[5],u=b[6],F=b[8],H=b[9];b=b[10];var I=1E-5<Math.abs(1-h*h+r*r+F*F)||1E-5<Math.abs(1-p*p+t*t+H*H)||1E-5<Math.abs(1-m*m+u*u+b*b);g*=f;if(null==l||1===l)for(var G=0;G<k;++G){var J=3*a[G],E=d[J],L=d[J+1],M=d[J+2];l=h*E+r*L+F*M;var J=p*E+t*L+H*M,N=m*E+u*L+b*M;I&&(E=l*l+J*J+N*N,.999999>E&&1E-6<E&&(E=Math.sqrt(E),l/=E,J/=E,N/=E));c[g+0]=l;c[g+1]=J;c[g+
2]=N;g+=f}else for(G=0;G<k;++G)for(J=3*a[G],E=d[J],L=d[J+1],M=d[J+2],J=h*E+r*L+F*M,N=p*E+t*L+H*M,L=m*E+u*L+b*M,I&&(E=J*J+N*N+L*L,.999999>E&&1E-6<E&&(E=Math.sqrt(E),J/=E,N/=E,L/=E)),E=0;E<l;++E)c[g+0]=J,c[g+1]=N,c[g+2]=L,g+=f}else e(a,d,f,g,l)}function d(a,d,e,b,f,g){var c=b.typedBuffer;b=b.typedBufferStride;var k=a.length;f*=b;if(null==g||1===g)if(4===e)for(e=0;e<k;++e){var l=4*a[e];c[f]=d[l];c[f+1]=d[l+1];c[f+2]=d[l+2];c[f+3]=d[l+3];f+=b}else{if(3===e)for(e=0;e<k;++e)l=3*a[e],c[f]=d[l],c[f+1]=d[l+
1],c[f+2]=d[l+2],c[f+3]=255,f+=b}else if(4===e)for(e=0;e<k;++e)for(var l=4*a[e],h=0;h<g;++h)c[f]=d[l],c[f+1]=d[l+1],c[f+2]=d[l+2],c[f+3]=d[l+3],f+=b;else if(3===e)for(e=0;e<k;++e)for(l=3*a[e],h=0;h<g;++h)c[f]=d[l],c[f+1]=d[l+1],c[f+2]=d[l+2],c[f+3]=255,f+=b}Object.defineProperty(b,"__esModule",{value:!0});b.writeBufferVec2=h;b.writeBufferVec3=e;b.writeBufferVec4=f;b.writeBufferMat3f=function(a,d,e,b){var c=e.typedBuffer;e=e.typedBufferStride;var f=a.length;b*=e;for(var g=0;g<f;++g){for(var k=9*a[g],
l=0;9>l;++l)c[b+l]=d[k+l];b+=e}};b.writeBufferMat4f=function(a,d,e,b){var c=e.typedBuffer;e=e.typedBufferStride;var f=a.length;b*=e;for(var g=0;g<f;++g){for(var k=16*a[g],l=0;16>l;++l)c[b+l]=d[k+l];b+=e}};b.writePosition=g;b.writeNormal=l;b.writeColor=d;b.writeMultipliedColor=function(a,d,e,b,f,g,l){var c=f.typedBuffer;f=f.typedBufferStride;var k=a.length;g*=f;if(null==l||1===l)if(4===e)for(e=0;e<k;++e){var h=4*a[e];c[g]=d[h]*b[0];c[g+1]=d[h+1]*b[1];c[g+2]=d[h+2]*b[2];c[g+3]=d[h+3]*b[3];g+=f}else{if(3===
e){var p=255*b[3];for(e=0;e<k;++e)h=3*a[e],c[g]=d[h]*b[0],c[g+1]=d[h+1]*b[1],c[g+2]=d[h+2]*b[2],c[g+3]=p,g+=f}}else if(4===e)for(e=0;e<k;++e)for(var h=4*a[e],m=0;m<l;++m)c[g]=d[h]*b[0],c[g+1]=d[h+1]*b[1],c[g+2]=d[h+2]*b[2],c[g+3]=d[h+3]*b[3],g+=f;else if(3===e)for(p=255*b[3],e=0;e<k;++e)for(h=3*a[e],m=0;m<l;++m)c[g]=d[h]*b[0],c[g+1]=d[h+1]*b[1],c[g+2]=d[h+2]*b[2],c[g+3]=p,g+=f};b.writeDefaultAttributes=function(c,e,b,r,t,u){var k=0;for(e=e.fieldNames;k<e.length;k++){var p=e[k],w=c.vertexAttr[p],q=
c.indices[p];if(w&&q)switch(p){case m.VertexAttrConstants.POSITION:m.assert(3===w.size);(p=t.getField(p,a.BufferViewVec3f))&&g(q,w.data,b,p,u);break;case m.VertexAttrConstants.NORMAL:m.assert(3===w.size);(p=t.getField(p,a.BufferViewVec3f))&&l(q,w.data,r,p,u);break;case m.VertexAttrConstants.UV0:m.assert(2===w.size);(p=t.getField(p,a.BufferViewVec2f))&&h(q,w.data,p,u);break;case m.VertexAttrConstants.COLOR:m.assert(3===w.size||4===w.size);(p=t.getField(p,a.BufferViewVec4u8))&&d(q,w.data,w.size,p,u);
break;case m.VertexAttrConstants.SYMBOLCOLOR:m.assert(3===w.size||4===w.size);(p=t.getField(p,a.BufferViewVec4u8))&&d(q,w.data,w.size,p,u);break;case m.VertexAttrConstants.TANGENT:m.assert(4===w.size),(p=t.getField(p,a.BufferViewVec4f))&&f(q,w.data,p,u)}}}})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("require exports ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../lib/screenSizePerspectiveUtils ../../lib/Util ../renderers/utils".split(" "),
function(n,b,a,m,h,e,f,g,l,d){function c(a,d,e,b,g,l){var h=r(d,e,y);f.setMin(w,a.getBBMin());f.setMax(w,a.getBBMax());m.isSome(g)&&g.applyToAABB(w);if(t(w,d,h,b)){var h=a.getPrimitiveIndices(),p=a.getIndices(),q=a.getPosition(),u=h?h.length:p.length/3;if(u>H&&(a=a.getChildren(),void 0!==a)){for(h=0;8>h;++h)void 0!==a[h]&&c(a[h],d,e,b,g,l);return}k(d,e,0,u,p,q,h,g,l)}}function k(a,c,d,e,b,f,g,k,l){var h,q,r;if(g){var t,u,y=f.data,w=f.offsetIdx;f=f.strideIdx;var v=a[0],z=a[1];a=a[2];var C=c[0]-v,H=
c[1]-z;for(c=c[2]-a;d<e;++d){var E=g[d],F=3*E;u=w+f*b[F++];var G=y[u++],I=y[u++];h=y[u];u=w+f*b[F++];var J=y[u++];q=y[u++];t=y[u];u=w+f*b[F];F=y[u++];r=y[u++];u=y[u];m.isSome(k)&&(h=k.applyToVertex(G,I,h),G=h[0],I=h[1],h=h[2],t=k.applyToVertex(J,q,t),J=t[0],q=t[1],t=t[2],u=k.applyToVertex(F,r,u),F=u[0],r=u[1],u=u[2]);J-=G;q-=I;t-=h;F-=G;r-=I;u-=h;var L=H*u-r*c,N=c*F-u*C,Q=C*r-F*H,M=J*L+q*N+t*Q;if(!(Math.abs(M)<=A)){G=v-G;I=z-I;h=a-h;L=G*L+I*N+h*Q;if(0<M){if(0>L||L>M)continue}else if(0<L||L<M)continue;
N=I*t-q*h;h=h*J-t*G;I=G*q-J*I;G=C*N+H*h+c*I;if(0<M){if(0>G||L+G>M)continue}else if(0<G||L+G<M)continue;I=(F*N+r*h+u*I)/M;0<=I&&(J=p(J,q,t,F,r,u,B),l(I,J,E))}}}else for(g=f.data,y=f.offsetIdx,w=f.strideIdx,f=a[0],v=a[1],z=a[2],a=c[0]-f,C=c[1]-v,H=c[2]-z,c=d,d*=3;c<e;++c)if(r=y+w*b[d++],G=g[r++],I=g[r++],h=g[r],r=y+w*b[d++],E=g[r++],J=g[r++],q=g[r],r=y+w*b[d++],t=g[r++],F=g[r++],r=g[r],m.isSome(k)&&(h=k.applyToVertex(G,I,h),G=h[0],I=h[1],h=h[2],q=k.applyToVertex(E,J,q),E=q[0],J=q[1],q=q[2],r=k.applyToVertex(t,
F,r),t=r[0],F=r[1],r=r[2]),E-=G,J-=I,q-=h,t-=G,F-=I,r-=h,M=C*r-F*H,L=H*t-r*a,N=a*F-t*C,u=E*M+J*L+q*N,!(Math.abs(u)<=A)){G=f-G;I=v-I;h=z-h;M=G*M+I*L+h*N;if(0<u){if(0>M||M>u)continue}else if(0<M||M<u)continue;L=I*q-J*h;h=h*E-q*G;I=G*J-E*I;G=a*L+C*h+H*I;if(0<u){if(0>G||M+G>u)continue}else if(0<G||M+G<u)continue;I=(t*L+F*h+r*I)/u;0<=I&&(E=p(E,J,q,t,F,r,B),l(I,E,c))}}function p(a,c,d,e,b,f,g){h.vec3.set(C,a,c,d);h.vec3.set(F,e,b,f);h.vec3.cross(g,C,F);h.vec3.normalize(g,g);return g}function r(a,c,d){return h.vec3.set(d,
1/(c[0]-a[0]),1/(c[1]-a[1]),1/(c[2]-a[2]))}function t(a,c,d,e){return u(a,c,d,e,Infinity)}function u(a,c,d,e,b){var f=(a[0]-e-c[0])*d[0],g=(a[3]+e-c[0])*d[0],k=Math.min(f,g),f=Math.max(f,g),g=(a[1]-e-c[1])*d[1],l=(a[4]+e-c[1])*d[1],f=Math.min(f,Math.max(g,l));if(0>f)return!1;k=Math.max(k,Math.min(g,l));if(k>f)return!1;g=(a[2]-e-c[2])*d[2];a=(a[5]+e-c[2])*d[2];f=Math.min(f,Math.max(g,a));if(0>f)return!1;k=Math.max(k,Math.min(g,a));return k>f?!1:k<b}function v(a,c){c=c?v(c):{};for(var d in a){var e=
a[d];e&&e.forEach&&(e=z(e));null==e&&d in c||(c[d]=e)}return c}function z(a){var c=[];a.forEach(function(a){return c.push(a)});return c}Object.defineProperty(b,"__esModule",{value:!0});var w=f.create(),q=l.VertexAttrConstants;b.intersectTriangleGeometry=function(a,e,b,f,g,h,p){e=d.isInstanceHidden(e);b=b.tolerance;e||(a.boundingInfo?(l.assert("triangle"===a.data.primitiveType),c(a.boundingInfo,f,g,b,h,p)):(b=a.getIndices(q.POSITION),a=a.getAttribute(q.POSITION),k(f,g,0,b.length/3,b,a,void 0,h,p)))};
var y=e.vec3f64.create(),A=Math.pow(2,-52),B=e.vec3f64.create();b.intersectTriangles=k;var C=e.vec3f64.create(),F=e.vec3f64.create();b.computeNormal=p;b.computeInvDir=r;b.intersectAabbInvDir=t;b.intersectAabbInvDirBefore=u;b.verticalOffsetAtDistance=function(c,d,e,b,f){var k=(e.screenLength||0)*c.pixelRatio;f&&(k=g.scale(k,b,d,f));return a.glClamp(k*Math.tan(.5*c.fovY)/(.5*c.fullHeight)*d,e.minWorldLength||0,null!=e.maxWorldLength?e.maxWorldLength:Infinity)};b.bindScreenSizePerspective=function(a,
c,d){if(a){var e=a.parameters;c.setUniform4f(d,e.divisor,e.offset,e.minPixelSize,a.paddingPixelsOverride)}};b.copyParameters=v;b.updateParameters=function(a,c){var d=!1,e;for(e in c){var b=c[e];void 0!==b&&(d=!0,Array.isArray(b)?a[e]=b.slice():a[e]=b)}return d};b.intersectDrapedRenderLineGeometry=function(c,d,e,b,f){if(d.options.selectionMode){d=c.getAttribute(q.POSITION).data;var g=c.getAttribute(q.SIZE),k=e[0];e=e[1];c=(((g&&g.data[0])+b)/2+4)*c.pixelRatio;b=Number.MAX_VALUE;for(g=0;g<d.length-
5;g+=3){var l=d[g],h=d[g+1],p=k-l,m=e-h,l=d[g+3]-l,h=d[g+4]-h,r=a.clamp((l*p+h*m)/(l*l+h*h),0,1),p=l*r-p,m=h*r-m,m=p*p+m*m;m<b&&(b=m)}b<c*c&&f()}};b.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var H=1E3})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("require exports ../../../../../core/MapUtils ../../../../../core/MapUtils ../../../../../core/maybe ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../support/buffer/glUtil ../../lib/DefaultVertexAttributeLocations ../../lib/renderStats ../../lib/ResizableFloat32Array ../../lib/Util ../WaterGLMaterial ./Instance ./utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w){function q(a,c,d,e){for(var b=new Map,f=c.vertexBufferLayout.stride/4,g=function(d,e){var g=d.origin,k=a.get(g.id),l=b.get(g.id);null==l&&(l={optimalCount:null==k?0:k.optimalCount,sparseCount:null==k?0:k.buffer.size,toAdd:[],toRemove:[],origin:g.vec3},b.set(g.id,l));g=c.elementCount(d.data)*f;e?(l.optimalCount+=g,l.sparseCount+=g,l.toAdd.push(d)):(l.optimalCount-=g,l.toRemove.push(d))},k=0;k<d.length;k++){var l=d[k];g(l,!0)}for(d=0;d<e.length;d++)l=
e[d],g(l,!1);return b}n=function(){function b(a,c,e,b){void 0===b&&(b=d.Default3D);this.type="MergedRenderer";this._dataByOrigin=new Map;this._hasOccludees=this._hasHighlights=!1;this._rctx=a;this._vertexAttributeLocations=b;this._material=e;this._materialRep=c;this._glMaterials=u.acquireMaterials(this._material,this._materialRep);this._bufferWriter=e.createBufferWriter()}b.prototype.dispose=function(){u.releaseMaterials(this._material,this._materialRep);this._dataByOrigin&&(this._dataByOrigin.forEach(function(a){a.vao.dispose(!0);
a.vao=null}),this._dataByOrigin.clear(),this._dataByOrigin=null);this._glMaterials&&(this._glMaterials.forEach(function(a){a&&a.dispose()}),this._glMaterials.clear(),this._glMaterials=null)};Object.defineProperty(b.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasOccludees",{get:function(){return this._hasOccludees},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasWater",{get:function(){return!this.isEmpty&&m.someMap(this._glMaterials,function(a){return a instanceof r.WaterGLMaterial})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"rendersOccluded",{get:function(){return!this.isEmpty&&1!==this._material.renderOccluded},enumerable:!0,configurable:!0});b.prototype.modify=function(a){this.updateGeometries(a.toUpdate);this.addAndRemoveGeometries(a.toAdd,a.toRemove);this.updateRenderCommands()};
b.prototype.addAndRemoveGeometries=function(a,c){var d=this,e=this._bufferWriter,b=e.vertexBufferLayout,f=b.stride/4,g=this._dataByOrigin,k=q(g,e,a,c);k.forEach(function(a,c){k.delete(c);var e=a.optimalCount,l=a.sparseCount,h=g.get(c);null==h&&(p.assert(0<e),h=d.createData(b,e,a.origin),g.set(c,h));if(0===e)h.vao.dispose(!0),h.vao=null,g.delete(c);else{var q=e<a.sparseCount/2;c=y;var m=h.buffer.size,r=h.buffer.array,e=h.buffer.resize(q?e:l,!1);q||e?d.removeAndRebuild(h,a.toRemove,f,r,c):0<a.toRemove.length?
(d.removeByErasing(h,a.toRemove,f,c),0<a.toAdd.length&&(c.end=m)):(c.begin=m,c.end=m);e=A;p.setMatrixTranslation3(e,-a.origin[0],-a.origin[1],-a.origin[2]);d.append(h,a.toAdd,f,e,c);a=h.vao.vertexBuffers.geometry;a.byteSize!==h.buffer.array.buffer.byteLength?a.setData(h.buffer.array):(e=c.begin,c=c.end,e<c&&(e*=4,a.setSubData(h.buffer.array,e,e,4*c)));h.drawCommandsDirty=!0}})};b.prototype.updateGeometries=function(a){for(var c=this._bufferWriter,d=c.vertexBufferLayout.stride/4,e=0;e<a.length;e++){var b=
a[e],f=b.updateType,b=b.renderGeometry,g=this._dataByOrigin.get(b.origin.id),k=g&&g.instances.get(b.uniqueName);if(!k)break;f&1&&(k.isVisible=b.instanceParameters.visible);if(f&9){var l=b.instanceParameters.visible;k.hasHighlights=!!b.instanceParameters.highlights&&l}f&16&&(k.hasOccludees=!!b.instanceParameters.occludees);f&6&&(f=g.buffer.array,l=g.vao,u.calculateTransformRelToOrigin(b,B,C),c.write({transformation:B,invTranspTransformation:C},b.data,c.vertexBufferLayout.createView(f.buffer),k.from),
p.assert(k.from+c.elementCount(b.data)===k.to,"material VBO layout has changed"),l.vertexBuffers.geometry.setSubData(f,k.from*d*4,k.from*d*4,k.to*d*4));g.drawCommandsDirty=!0}};b.prototype.updateRenderCommands=function(){this._dataByOrigin.forEach(function(a){a.hasHiddenInstances=m.someMap(a.instances,function(a){return!a.isVisible});a.hasHighlights=m.someMap(a.instances,function(a){return a.isVisible&&a.hasHighlights});a.hasOccludees=m.someMap(a.instances,function(a){return a.isVisible&&a.hasOccludees})});
this._hasHighlights=m.someMap(this._dataByOrigin,function(a){return a.hasHighlights});this._hasOccludees=m.someMap(this._dataByOrigin,function(a){return a.hasOccludees});var c=function(c){c.drawCommandsDefault=null;c.drawCommandsHighlight=null;c.drawCommandsOccludees=null;c.stats={default:0,highlight:0,occludees:0};if(0!==c.instances.size)if(c.hasOccludees||c.hasHighlights||c.hasHiddenInstances){var d=t.sortInstancesAccordingToRange(a.valuesOfMap(c.instances));c.drawCommandsDefault=[];c.drawCommandsHighlight=
[];c.drawCommandsOccludees=[];for(var e=0;e<d.length;e++){var b=d[e];b.isVisible&&(b.hasOccludees?t.addOrMerge(c.drawCommandsOccludees,b):t.addOrMerge(c.drawCommandsDefault,b),b.hasHighlights&&t.addOrMerge(c.drawCommandsHighlight,b))}d=function(a){for(var c=0,d=0;d<a.length;d++)c+=a[d].count;return c/3};c.stats={default:d(c.drawCommandsDefault),highlight:d(c.drawCommandsHighlight),occludees:d(c.drawCommandsOccludees)}}else d=4*c.buffer.size/z.getStride(c.vao.layout.geometry),c.drawCommandsDefault=
[{first:0,count:d}],c.stats={default:d,highlight:0,occludees:0}};this._dataByOrigin.forEach(function(a){a.drawCommandsDirty&&(c(a),a.drawCommandsDirty=!1)})};b.prototype.updateLogic=function(a){return this._material.update(a)};b.prototype.render=function(a,d,b,f){var g=this,k=this._rctx,l=this._glMaterials.get(d.pass),p=4===d.pass,q=a;2===d.pass&&null===q&&(q=22);if(!l||2!==l.ensureResources(k)||null!=q&&!l.beginSlot(q)||p&&!this._hasHighlights)return!1;l.ensureParameters(b);var m=l.getTechnique(),
r=l.getPipelineState(q,!1);k.setPipelineState(r);l.bind(k,b);var t=!1;this._dataByOrigin.forEach(function(a){if(!(h.isNone(a.drawCommandsDefault)&&h.isNone(a.drawCommandsHighlight)&&h.isNone(a.drawCommandsOccludees)||p&&!a.hasHighlights)){b.origin=a.origin;m.bindDraw(b);m.ensureAttributeLocations(a.vao);k.bindVAO(a.vao);var d=m.primitiveType,u=p?a.drawCommandsHighlight:a.drawCommandsDefault,y=p?a.stats.highlight:a.stats.default;e.isSome(u)&&(g.renderCommands(k,d,u),c.addToRenderStats(u.length,y,f),
t=!0);p||(u=a.drawCommandsOccludees,e.isSome(u)&&(y=l.getPipelineState(q,!0),k.setPipelineState(y),g.renderCommands(k,d,u),k.setPipelineState(r),c.addToRenderStats(u.length,a.stats.occludees,f),t=!0))}});return t};b.prototype.renderCommands=function(a,c,d){for(var e=0;e<d.length;e++)a.drawArrays(c,d[e].first,d[e].count)};b.prototype.createData=function(a,c,d){return{instances:new Map,vao:new w(this._rctx,this._vertexAttributeLocations,{geometry:l.glLayout(a)},{geometry:v.createVertex(this._rctx,35044)}),
buffer:new k.ResizableFloat32Array(c),optimalCount:0,origin:d,hasHiddenInstances:!1,hasHighlights:!1,hasOccludees:!1,drawCommandsDirty:!1,drawCommandsDefault:null,drawCommandsOccludees:null,drawCommandsHighlight:null,stats:{default:0,highlight:0,occludees:0}}};b.prototype.removeAndRebuild=function(a,c,d,e,b){for(var f=0;f<c.length;f++){var g=c[f].uniqueName,k=a.instances.get(g);a.optimalCount-=(k.to-k.from)*d;a.instances.delete(g)}var l=0,h=a.buffer.array;b.begin=0;b.end=0;var p=-1,q=-1,m=0;a.instances.forEach(function(a){var c=
a.from*d,b=a.to*d,f=b-c;p!==q&&q!==c?(h.set(e.subarray(p,q),m),m+=q-p,p=c):-1===p&&(p=c);q=b;a.from=l/d;l+=f;a.to=l/d});p!==q&&h.set(e.subarray(p,q),m);b.end=l};b.prototype.removeByErasing=function(a,c,d,e){e.begin=Infinity;e.end=-Infinity;for(var b=-1,f=-1,g=0;g<c.length;g++){var k=c[g].uniqueName,l=a.instances.get(k),h=l.from*d,l=l.to*d;b!==f&&f!==h?(a.buffer.erase(b,f),b=h):-1===b&&(b=h);f=l;a.instances.delete(k);a.optimalCount-=l-h;h<e.begin&&(e.begin=h);l>e.end&&(e.end=l)}b!==f&&a.buffer.erase(b,
f)};b.prototype.append=function(a,c,d,b,g){for(var k=this._bufferWriter,l=0;l<c.length;l++){var h=c[l],q=e.isSome(h.transformation)?f.mat4.multiply(B,b,h.transformation):b;f.mat4.invert(C,q);f.mat4.transpose(C,C);var m=g.end;k.write({transformation:q,invTranspTransformation:C},h.data,k.vertexBufferLayout.createView(a.buffer.array.buffer),g.end/d);var q=k.elementCount(h.data)*d,r=m+q;p.assert(null==a.instances.get(h.uniqueName));var u=h.instanceParameters.visible,m=new t.Instance(m/d,r/d,u,!!h.instanceParameters.highlights&&
u,!!h.instanceParameters.occludees);a.instances.set(h.uniqueName,m);a.optimalCount+=q;g.end+=q}};Object.defineProperty(b.prototype,"test",{get:function(){return{material:this._material,glMaterials:this._glMaterials}},enumerable:!0,configurable:!0});return b}();var y={begin:0,end:0},A=g.mat4f64.create(),B=g.mat4f64.create(),C=g.mat4f64.create();return n})},"esri/views/3d/webgl-engine/lib/renderStats":function(){define(["require","exports"],function(n,b){function a(){return{triangles:0,drawCalls:0}}
Object.defineProperty(b,"__esModule",{value:!0});b.makeNewRenderStats=a;b.addToRenderStats=function(a,b,e){e&&(e.drawCalls+=a,e.triangles+=b)};n=function(){function b(){this.materialRenderStats=new Map;this.reset()}b.prototype.getMaterialRenderStatsObject=function(b){var e=this.materialRenderStats.get(b);e||(e=a(),this.materialRenderStats.set(b,e));return e};b.prototype.getAggregatedStats=function(){var b={materialRenderers:{},total:a()};this.materialRenderStats.forEach(function(a,f){b.materialRenderers[f]=
a;b.total.drawCalls+=a.drawCalls;b.total.triangles+=a.triangles});return b};b.prototype.reset=function(){this.materialRenderStats.forEach(function(a){a.drawCalls=0;a.triangles=0})};return b}();b.RenderStatsAggregator=n})},"esri/views/3d/webgl-engine/lib/ResizableFloat32Array":function(){define(["require","exports","../../../../core/mathUtils"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){null==b?b=16:65536>b&&(b=a.nextHighestPowerOfTwo(b));this._array=
new Float32Array(b);this._size=0}b.prototype.resize=function(a,e){this._size=a;if(this._size>this._array.length){for(a=this._array.length||1;a<this._size;)a*=2;var b=new Float32Array(a);e&&b.set(this._array);this._array=b;return!0}b=2*this._size;if(b<=this._array.length){for(a=this._array.length;a>=b;)a=Math.floor(a/2);b=new Float32Array(a);e&&b.set(this._array.subarray(0,a));this._array=b;return!0}return!1};b.prototype.append=function(a){var e=this._size;this.resize(this._size+a.length,!0);this._array.set(a,
e)};b.prototype.erase=function(a,e){for(;a<e;++a)this._array[a]=0};Object.defineProperty(b.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});return b}();b.ResizableFloat32Array=n})},"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define("require exports tslib ../lib/GLMaterial ./WaterTechnique ./internal/MaterialUtil".split(" "),function(n,
b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function f(a){a=b.call(this,a)||this;a.updateParameters();return a}a.__extends(f,b);f.prototype.updateParameters=function(){this.params=e.copyParameters(this.material.getParameters());this.technique=this.techniqueRep.acquireAndReleaseExisting(h.WaterTechnique,this.material.getTechniqueConfig(this.output),this.technique)};f.prototype.beginSlot=function(a){if(2===this.output)return 22===a;if(5===this.output)return null==a;var d=
3;this.params.transparent&&(d=this.params.writeDepth?5:8);return a===d};f.prototype.setElapsedTimeUniform=function(a){a.setUniform1f("timeElapsed",.001*this.material.animation.time*this.params.animationSpeed)};f.prototype._updateShadowState=function(a){a.shadowMappingEnabled!==this.params.receiveShadows&&(this.material.setParameterValues({receiveShadows:a.shadowMappingEnabled}),this.updateParameters())};f.prototype._updateSSRState=function(a){a.ssrEnabled!==this.params.ssrEnabled&&(this.material.setParameterValues({ssrEnabled:a.ssrEnabled}),
this.updateParameters())};f.prototype.ensureResources=function(a){return this.technique.ensureResource(a)};f.prototype.ensureParameters=function(a){0===this.output&&(this._updateShadowState(a),this._updateSSRState(a))};f.prototype.bind=function(a,d){a.bindProgram(this.technique.program);this.technique.bindPass(a,this.params,d);2!==this.output&&0!==this.output||this.setElapsedTimeUniform(this.technique.program)};return f}(m.GLMaterial);b.WaterGLMaterial=n})},"esri/views/3d/webgl-engine/materials/WaterTechnique":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderLibrary/util/Camera.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultTextureUnits ../lib/DefaultVertexAttributeLocations ../shaders/WaterSurface.glsl ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v){Object.defineProperty(b,"__esModule",{value:!0});c=function(c){function b(a,d){d=c.call(this,a,d)||this;d.waterTextureRepository=a.waterTextureRepository;return d}a.__extends(b,c);b.prototype.initializeProgram=function(a){var c=b.shader.get(),d=this.configuration,c=c.build({output:d.output,viewingMode:a.viewingMode,slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:d.receiveShadows,pbrMode:3,useCustomDTRExponentForWater:!0,
ssrEnabled:d.useSSR,highStepCount:!0});return new u(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),r.Default3D)};b.prototype.ensureResource=function(a){this.waterTextureRepository.ready||this.waterTextureRepository.updating||this.waterTextureRepository.loadTextures(a);return this.waterTextureRepository.ready?2:1};b.prototype.bindPass=function(a,c,d){0===this.configuration.output&&f.ScreenSpaceReflections.bindUniforms(this.program,a,d);if(0===this.configuration.output||2===this.configuration.output)g.WaterDistortion.bindUniforms(this.program,
c),this.waterTextureRepository.bindRepo(a);0!==this.configuration.output&&5!==this.configuration.output||this.program.setUniform4fv("waterColor",c.color)};b.prototype.bindDraw=function(a){h.Transform.bindUniforms(this.program,a);0===this.configuration.output&&(l.Camera.bindUniforms(this.program,a),m.Slice.bindUniformsWithOrigin(this.program,this.configuration,a),e.ReadShadowMap.bindUniforms(this.program,a,p.DefaultTextureUnits.SHADOW_MAP))};b.prototype.initializePipeline=function(){var a=this.configuration;
return 2===a.output?v.makePipelineState({depthTest:{func:513},depthWrite:a.writeDepth&&v.defaultDepthWriteParams,colorWrite:v.defaultColorWriteParams}):v.makePipelineState({blending:a.transparent&&v.separateBlendingParams(770,1,771,771),depthTest:{func:513},depthWrite:a.writeDepth&&v.defaultDepthWriteParams,colorWrite:v.defaultColorWriteParams})};b.shader=new d.ReloadableShaderModule(t,function(){return new Promise(function(a,c){n(["../shaders/WaterSurface.glsl"],a,c)})});return b}(c.ShaderTechnique);
b.WaterTechnique=c;c=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;a.output=0;a.receiveShadows=!1;a.slicePlaneEnabled=!1;a.transparent=!1;a.writeDepth=!1;a.useSSR=!1;a.isDraped=!1;return a}a.__extends(d,c);a.__decorate([k.parameter({count:7})],d.prototype,"output",void 0);a.__decorate([k.parameter()],d.prototype,"receiveShadows",void 0);a.__decorate([k.parameter()],d.prototype,"slicePlaneEnabled",void 0);a.__decorate([k.parameter()],d.prototype,"transparent",void 0);a.__decorate([k.parameter()],
d.prototype,"writeDepth",void 0);a.__decorate([k.parameter()],d.prototype,"useSSR",void 0);a.__decorate([k.parameter()],d.prototype,"isDraped",void 0);return d}(k.ShaderTechniqueConfiguration);b.WaterTechniqueConfiguration=c})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define("require exports tslib ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../shaderModules/interfaces".split(" "),function(n,b,a,m,h,e,
f){function g(e,b){if(b.slicePlaneEnabled){e.extensions.add("GL_OES_standard_derivatives");b.sliceEnabledForVertexPrograms&&(e.vertex.uniforms.add("slicePlaneOrigin","vec3"),e.vertex.uniforms.add("slicePlaneBasis1","vec3"),e.vertex.uniforms.add("slicePlaneBasis2","vec3"));e.fragment.uniforms.add("slicePlaneOrigin","vec3");e.fragment.uniforms.add("slicePlaneBasis1","vec3");e.fragment.uniforms.add("slicePlaneBasis2","vec3");var g=f.glsl(d||(d=a.__makeTemplateObject(["\n      struct SliceFactors {\n        float front;\n        float side0;\n        float side1;\n        float side2;\n        float side3;\n      };\n\n      SliceFactors calculateSliceFactors(vec3 pos) {\n        vec3 rel \x3d pos - slicePlaneOrigin;\n\n        vec3 slicePlaneNormal \x3d -cross(slicePlaneBasis1, slicePlaneBasis2);\n        float slicePlaneW \x3d -dot(slicePlaneNormal, slicePlaneOrigin);\n\n        float basis1Len2 \x3d dot(slicePlaneBasis1, slicePlaneBasis1);\n        float basis2Len2 \x3d dot(slicePlaneBasis2, slicePlaneBasis2);\n\n        float basis1Dot \x3d dot(slicePlaneBasis1, rel);\n        float basis2Dot \x3d dot(slicePlaneBasis2, rel);\n\n        return SliceFactors(\n          dot(slicePlaneNormal, pos) + slicePlaneW,\n          -basis1Dot - basis1Len2,\n          basis1Dot - basis1Len2,\n          -basis2Dot - basis2Len2,\n          basis2Dot - basis2Len2\n        );\n      }\n\n      bool sliceByFactors(SliceFactors factors) {\n        return factors.front \x3c 0.0\n          \x26\x26 factors.side0 \x3c 0.0\n          \x26\x26 factors.side1 \x3c 0.0\n          \x26\x26 factors.side2 \x3c 0.0\n          \x26\x26 factors.side3 \x3c 0.0;\n      }\n      \n      bool sliceEnabled() {\n        // a slicePlaneBasis1 vector of zero length is used to disable slicing in the shader during draped rendering.\n        return dot(slicePlaneBasis1, slicePlaneBasis1) !\x3d 0.0;\n      }\n\n      bool sliceByPlane(vec3 pos) {\n        return sliceEnabled() \x26\x26 sliceByFactors(calculateSliceFactors(pos));\n      }\n\n      #define rejectBySlice(_pos_) sliceByPlane(_pos_)\n      #define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n    "],
["\n      struct SliceFactors {\n        float front;\n        float side0;\n        float side1;\n        float side2;\n        float side3;\n      };\n\n      SliceFactors calculateSliceFactors(vec3 pos) {\n        vec3 rel \x3d pos - slicePlaneOrigin;\n\n        vec3 slicePlaneNormal \x3d -cross(slicePlaneBasis1, slicePlaneBasis2);\n        float slicePlaneW \x3d -dot(slicePlaneNormal, slicePlaneOrigin);\n\n        float basis1Len2 \x3d dot(slicePlaneBasis1, slicePlaneBasis1);\n        float basis2Len2 \x3d dot(slicePlaneBasis2, slicePlaneBasis2);\n\n        float basis1Dot \x3d dot(slicePlaneBasis1, rel);\n        float basis2Dot \x3d dot(slicePlaneBasis2, rel);\n\n        return SliceFactors(\n          dot(slicePlaneNormal, pos) + slicePlaneW,\n          -basis1Dot - basis1Len2,\n          basis1Dot - basis1Len2,\n          -basis2Dot - basis2Len2,\n          basis2Dot - basis2Len2\n        );\n      }\n\n      bool sliceByFactors(SliceFactors factors) {\n        return factors.front \x3c 0.0\n          \x26\x26 factors.side0 \x3c 0.0\n          \x26\x26 factors.side1 \x3c 0.0\n          \x26\x26 factors.side2 \x3c 0.0\n          \x26\x26 factors.side3 \x3c 0.0;\n      }\n      \n      bool sliceEnabled() {\n        // a slicePlaneBasis1 vector of zero length is used to disable slicing in the shader during draped rendering.\n        return dot(slicePlaneBasis1, slicePlaneBasis1) !\x3d 0.0;\n      }\n\n      bool sliceByPlane(vec3 pos) {\n        return sliceEnabled() \x26\x26 sliceByFactors(calculateSliceFactors(pos));\n      }\n\n      #define rejectBySlice(_pos_) sliceByPlane(_pos_)\n      #define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n    "]))),
l=f.glsl(c||(c=a.__makeTemplateObject(["\n      vec4 applySliceHighlight(vec4 color, vec3 pos) {\n        SliceFactors factors \x3d calculateSliceFactors(pos);\n\n        if (sliceByFactors(factors)) {\n          return color;\n        }\n\n        const float HIGHLIGHT_WIDTH \x3d 1.0;\n        const vec4 HIGHLIGHT_COLOR \x3d vec4(0.0, 0.0, 0.0, 0.3);\n\n        factors.front /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n        factors.side0 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n        factors.side1 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n        factors.side2 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n        factors.side3 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n\n        float highlightFactor \x3d (1.0 - step(0.5, factors.front))\n          * (1.0 - step(0.5, factors.side0))\n          * (1.0 - step(0.5, factors.side1))\n          * (1.0 - step(0.5, factors.side2))\n          * (1.0 - step(0.5, factors.side3));\n\n        return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n      }\n    "],
["\n      vec4 applySliceHighlight(vec4 color, vec3 pos) {\n        SliceFactors factors \x3d calculateSliceFactors(pos);\n\n        if (sliceByFactors(factors)) {\n          return color;\n        }\n\n        const float HIGHLIGHT_WIDTH \x3d 1.0;\n        const vec4 HIGHLIGHT_COLOR \x3d vec4(0.0, 0.0, 0.0, 0.3);\n\n        factors.front /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n        factors.side0 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n        factors.side1 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n        factors.side2 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n        factors.side3 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n\n        float highlightFactor \x3d (1.0 - step(0.5, factors.front))\n          * (1.0 - step(0.5, factors.side0))\n          * (1.0 - step(0.5, factors.side1))\n          * (1.0 - step(0.5, factors.side2))\n          * (1.0 - step(0.5, factors.side3));\n\n        return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n      }\n    "]))),
l=b.sliceHighlightDisabled?f.glsl(k||(k=a.__makeTemplateObject(["#define highlightSlice(_color_, _pos_) (_color_)"],["#define highlightSlice(_color_, _pos_) (_color_)"]))):f.glsl(p||(p=a.__makeTemplateObject(["\n        "," \n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      "],["\n        "," \n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      "])),l);b.sliceEnabledForVertexPrograms&&
e.vertex.code.add(g);e.fragment.code.add(g);e.fragment.code.add(l)}else g=f.glsl(r||(r=a.__makeTemplateObject(["\n      #define rejectBySlice(_pos_) false\n      #define discardBySlice(_pos_) {}\n      #define highlightSlice(_color_, _pos_) (_color_)\n    "],["\n      #define rejectBySlice(_pos_) false\n      #define discardBySlice(_pos_) {}\n      #define highlightSlice(_color_, _pos_) (_color_)\n    "]))),b.sliceEnabledForVertexPrograms&&e.vertex.code.add(g),e.fragment.code.add(g)}Object.defineProperty(b,
"__esModule",{value:!0});b.Slice=g;(function(a){a.bindUniformsWithOrigin=function(c,d,e){a.bindUniforms(c,d,e.slicePlane,e.origin)};a.bindUniforms=function(a,c,d,b){c.slicePlaneEnabled&&(m.isSome(d)?(b?(h.vec3.subtract(l,d.origin,b),a.setUniform3fv("slicePlaneOrigin",l)):a.setUniform3fv("slicePlaneOrigin",d.origin),a.setUniform3fv("slicePlaneBasis1",d.basis1),a.setUniform3fv("slicePlaneBasis2",d.basis2)):(a.setUniform3fv("slicePlaneBasis1",e.vec3f64.ZEROS),a.setUniform3fv("slicePlaneBasis2",e.vec3f64.ZEROS),
a.setUniform3fv("slicePlaneOrigin",e.vec3f64.ZEROS)))}})(g=b.Slice||(b.Slice={}));var l=e.vec3f64.create(),d,c,k,p,r})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define(["require","exports","tslib","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(n,b,a,m,h){function e(e){e.include(m.RgbaFloatEncoding);e.fragment.uniforms.add("depthTex","sampler2D");e.fragment.uniforms.add("shadowMapNum","int");e.fragment.uniforms.add("shadowMapDistance",
"vec4");e.fragment.uniforms.add("shadowMapMatrix","mat4",4);e.fragment.uniforms.add("depthHalfPixelSz","float");e.fragment.code.add(h.glsl(f||(f=a.__makeTemplateObject(["\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      float halfPixelSize \x3d depthHalfPixelSz;\n      vec4 distance \x3d shadowMapDistance;\n      float depth \x3d _linearDepth;\n\n      //choose correct cascade\n      int i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\n\n      if (i \x3e\x3d shadowMapNum) { return 0.0; }\n\n      mat4 mat \x3d i \x3d\x3d 0 ? shadowMapMatrix[0] : i \x3d\x3d 1 ? shadowMapMatrix[1] : i \x3d\x3d 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\n\n      vec4 lv \x3d mat * vec4(_vpos, 1.0);\n      lv.xy /\x3d lv.w;\n\n      // vertex completely outside? -\x3e no shadow\n      vec3 lvpos \x3d 0.5 * lv.xyz + vec3(0.5);\n      if (lvpos.z \x3e\x3d 1.0) { return 0.0; }\n      if (lvpos.x \x3c 0.0 || lvpos.x \x3e 1.0 || lvpos.y \x3c 0.0 || lvpos.y \x3e 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv \x3d vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n\n      float texSize \x3d 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st \x3d fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, -halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, -halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n  "],
["\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      float halfPixelSize \x3d depthHalfPixelSz;\n      vec4 distance \x3d shadowMapDistance;\n      float depth \x3d _linearDepth;\n\n      //choose correct cascade\n      int i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\n\n      if (i \x3e\x3d shadowMapNum) { return 0.0; }\n\n      mat4 mat \x3d i \x3d\x3d 0 ? shadowMapMatrix[0] : i \x3d\x3d 1 ? shadowMapMatrix[1] : i \x3d\x3d 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\n\n      vec4 lv \x3d mat * vec4(_vpos, 1.0);\n      lv.xy /\x3d lv.w;\n\n      // vertex completely outside? -\x3e no shadow\n      vec3 lvpos \x3d 0.5 * lv.xyz + vec3(0.5);\n      if (lvpos.z \x3e\x3d 1.0) { return 0.0; }\n      if (lvpos.x \x3c 0.0 || lvpos.x \x3e 1.0 || lvpos.y \x3c 0.0 || lvpos.y \x3e 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv \x3d vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n\n      float texSize \x3d 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st \x3d fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, -halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, -halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n  "]))))}
Object.defineProperty(b,"__esModule",{value:!0});b.ReadShadowMap=e;(function(a){a.bindUniforms=function(a,d,c){d.shadowMappingEnabled&&(d.shadowMap.bind(a,c),d.shadowMap.bindView(a,d.origin))};a.bindViewCustomOrigin=function(a,d,c){d.shadowMappingEnabled&&d.shadowMap.bindView(a,c)};a.bindView=function(a,d){d.shadowMappingEnabled&&d.shadowMap.bindView(a,d.origin)}})(e=b.ReadShadowMap||(b.ReadShadowMap={}));var f})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":function(){define("require exports tslib ../output/ReadLinearDepth.glsl ./Reprojection.glsl ../../shaderModules/interfaces".split(" "),
function(n,b,a,m,h,e){function f(b,d){b.fragment.uniforms.add("nearFar","vec2");b.fragment.uniforms.add("depthMapView","sampler2D");b.fragment.uniforms.add("ssrViewMat","mat4");b.include(m.ReadLinearDepth);b.include(h.Reprojection);b.fragment.code.add(e.glsl(g||(g=a.__makeTemplateObject(["\n  const int maxSteps \x3d ","\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord \x3d  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /\x3d projectedCoord.w;\n    projectedCoord.xy \x3d projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos \x3d startPosition;\n    vec3 viewPosEnd \x3d startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart \x3d applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q0 \x3d viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 \x3d 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos +\x3d dir;\n\n    vec4 projectedCoordVanishingPoint \x3d applyProjectionMat(rpProjectionMat, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd \x3d applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q1 \x3d viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 \x3d 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir \x3d (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint \x3d (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod \x3d min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength \x3d length(projectedCoordDir);\n    float maxSt \x3d float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP \x3d yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ \x3d yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk \x3d yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P \x3d projectedCoordStart.xy;\n    vec3 Q \x3d Q0;\n    float k \x3d k0;\n    float rayStartZ \x3d -startPosition.z; // estimated ray start depth value\n    float rayEndZ \x3d -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ \x3d -startPosition.z;\n    float rayDiffZ;\n    float dDepth;\n    float depth;\n    float rayDiffZOld \x3d 0.0;\n\n    // early outs\n    if (dot(normal, dir) \x3c 0.0 || dot(-viewDir, normal) \x3c 0.0)\n      return vec3(P, 0.0);\n\n    for(int i \x3d 0; i \x3c maxSteps; i++)\n    {\n      depth \x3d -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ \x3d prevEstimateZ;\n      dDepth \x3d -rayStartZ - depth;\n      rayEndZ \x3d (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ \x3d rayEndZ- rayStartZ;\n      prevEstimateZ \x3d rayEndZ;\n\n      if(-rayEndZ \x3e nearFar[1] || -rayEndZ \x3c nearFar[0] || P.y \x3c 0.0  || P.y \x3e 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth \x3e 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) \x3c 0.025/abs(k) +  abs(rayDiffZOld) \x26\x26 dDepth \x3e 0.0 \x26\x26 depth \x3e nearFar[0] \x26\x26 depth \x3c nearFar[1])\n      {\n          return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P +\x3d dP;\n      Q.z +\x3d dQ.z;\n      k +\x3d dk;\n      rayDiffZOld \x3d rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "],
["\n  const int maxSteps \x3d ","\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord \x3d  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /\x3d projectedCoord.w;\n    projectedCoord.xy \x3d projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos \x3d startPosition;\n    vec3 viewPosEnd \x3d startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart \x3d applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q0 \x3d viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 \x3d 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos +\x3d dir;\n\n    vec4 projectedCoordVanishingPoint \x3d applyProjectionMat(rpProjectionMat, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd \x3d applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q1 \x3d viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 \x3d 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir \x3d (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint \x3d (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod \x3d min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength \x3d length(projectedCoordDir);\n    float maxSt \x3d float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP \x3d yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ \x3d yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk \x3d yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P \x3d projectedCoordStart.xy;\n    vec3 Q \x3d Q0;\n    float k \x3d k0;\n    float rayStartZ \x3d -startPosition.z; // estimated ray start depth value\n    float rayEndZ \x3d -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ \x3d -startPosition.z;\n    float rayDiffZ;\n    float dDepth;\n    float depth;\n    float rayDiffZOld \x3d 0.0;\n\n    // early outs\n    if (dot(normal, dir) \x3c 0.0 || dot(-viewDir, normal) \x3c 0.0)\n      return vec3(P, 0.0);\n\n    for(int i \x3d 0; i \x3c maxSteps; i++)\n    {\n      depth \x3d -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ \x3d prevEstimateZ;\n      dDepth \x3d -rayStartZ - depth;\n      rayEndZ \x3d (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ \x3d rayEndZ- rayStartZ;\n      prevEstimateZ \x3d rayEndZ;\n\n      if(-rayEndZ \x3e nearFar[1] || -rayEndZ \x3c nearFar[0] || P.y \x3c 0.0  || P.y \x3e 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth \x3e 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) \x3c 0.025/abs(k) +  abs(rayDiffZOld) \x26\x26 dDepth \x3e 0.0 \x26\x26 depth \x3e nearFar[0] \x26\x26 depth \x3c nearFar[1])\n      {\n          return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P +\x3d dP;\n      Q.z +\x3d dQ.z;\n      k +\x3d dk;\n      rayDiffZOld \x3d rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),
d.highStepCount?"150;":"75;"))}Object.defineProperty(b,"__esModule",{value:!0});b.ScreenSpaceReflections=f;(function(a){a.bindUniforms=function(a,c,e){e.ssrEnabled&&(a.setUniform1i("depthMapView",e.linearDepthTextureID),c.bindTexture(e.linearDepthTexture,e.linearDepthTextureID),a.setUniform2f("nearFar",e.nearFar[0],e.nearFar[1]),a.setUniformMatrix4fv("ssrViewMat",e.ssrViewMat),h.Reprojection.bindUniforms(a,c,e))}})(f=b.ScreenSpaceReflections||(b.ScreenSpaceReflections={}));var g})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":function(){define(["require",
"exports","tslib","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(n,b,a,m,h){function e(e){e.include(m.RgbaFloatEncoding);e.fragment.code.add(h.glsl(f||(f=a.__makeTemplateObject(["\n    float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n      return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n    }\n  "],["\n    float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n      return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n    }\n  "]))))}
Object.defineProperty(b,"__esModule",{value:!0});b.ReadLinearDepth=e;(function(a){a.bindUniforms=function(a,d){a.setUniform2fv("nearFar",d.nearFar)}})(e=b.ReadLinearDepth||(b.ReadLinearDepth={}));var f})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Reprojection.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){function h(b){b.fragment.uniforms.add("lastFrameColorMap","sampler2D");b.fragment.uniforms.add("reprojectionMat","mat4");b.fragment.uniforms.add("rpProjectionMat",
"mat4");b.fragment.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw \x3d rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord \x3d reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /\x3d reprojectedCoord.w;\n    return reprojectedCoord.xy*0.5 + 0.5;\n  }\n  "],["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw \x3d rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord \x3d reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /\x3d reprojectedCoord.w;\n    return reprojectedCoord.xy*0.5 + 0.5;\n  }\n  "]))))}
Object.defineProperty(b,"__esModule",{value:!0});b.Reprojection=h;(function(a){a.bindUniforms=function(a,e,d){a.setUniform1i("lastFrameColorMap",d.lastFrameColorTextureID);e.bindTexture(d.lastFrameColorTexture,d.lastFrameColorTextureID);a.setUniformMatrix4fv("reprojectionMat",d.reprojectionMat);a.setUniformMatrix4fv("rpProjectionMat",d.rpProjectionMat)}})(h=b.Reprojection||(b.Reprojection={}));var e})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":function(){define(["require",
"exports","tslib","./FoamRendering.glsl","../../shaderModules/interfaces"],function(n,b,a,m,h){function e(e){e.fragment.uniforms.add("texWaveNormal","sampler2D");e.fragment.uniforms.add("texWavePerturbation","sampler2D");e.fragment.uniforms.add("waveParams","vec4");e.fragment.uniforms.add("waveDirection","vec2");e.include(m.FoamIntensity);e.fragment.code.add(h.glsl(f||(f=a.__makeTemplateObject(["\n      const vec2  FLOW_JUMP \x3d vec2(6.0/25.0, 5.0/24.0);\n\n      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n      }\n\n      float sampleNoiseTexture(vec2 _uv) {\n        return texture2D(texWavePerturbation, _uv).b;\n      }\n\n      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n      }\n\n      float computeProgress(vec2 uv, float time) {\n        return fract(time);\n      }\n\n      float computeWeight(vec2 uv, float time) {\n        float progress \x3d computeProgress(uv, time);\n        return 1.0 - abs(1.0 - 2.0 * progress);\n      }\n\n      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n        float flowStrength \x3d waveParams[2];\n        float flowOffset \x3d waveParams[3];\n\n        vec2 flowVector \x3d textureDenormalized2D(texFlow, uv) * flowStrength;\n\n        float progress \x3d computeProgress(uv, time + phaseOffset);\n        float weight \x3d computeWeight(uv, time + phaseOffset);\n\n        vec2 result \x3d uv;\n        result -\x3d flowVector * (progress + flowOffset);\n        result +\x3d phaseOffset;\n        result +\x3d (time - progress) * FLOW_JUMP;\n\n        return vec3(result, weight);\n      }\n\n      const float TIME_NOISE_TEXTURE_REPEAT \x3d 0.3737;\n      const float TIME_NOISE_STRENGTH \x3d 7.77;\n\n      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n        float waveStrength \x3d waveParams[0];\n\n        // overall directional shift in uv's for directional wave movement for\n        // now we do a hard coded scale for wave speed such that a unit length\n        // direction is not too fast.\n        vec2 waveMovement \x3d time * -_waveDir;\n\n        float timeNoise \x3d sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n\n        // compute two perturbed uvs and blend weights\n        // then sample the wave normals at the two positions and blend\n        vec3 uv_A \x3d computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n        vec3 uv_B \x3d computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n\n        vec3 normal_A \x3d textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n        vec3 normal_B \x3d textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n\n        // logic to flatten the wave pattern\n        // scale xy components of the normal, then adjust z (up) component\n        vec3 mixNormal \x3d normalize(normal_A + normal_B);\n        mixNormal.xy *\x3d waveStrength;\n        mixNormal.z \x3d sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n\n        return mixNormal;\n      }\n\n      vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\n        float waveTextureRepeat \x3d waveParams[1];\n        vec3 normal \x3d getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n        float foam  \x3d normals2FoamIntensity(normal, waveParams[0]);\n        return vec4(normal, foam);\n      }\n    "],
["\n      const vec2  FLOW_JUMP \x3d vec2(6.0/25.0, 5.0/24.0);\n\n      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n      }\n\n      float sampleNoiseTexture(vec2 _uv) {\n        return texture2D(texWavePerturbation, _uv).b;\n      }\n\n      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n      }\n\n      float computeProgress(vec2 uv, float time) {\n        return fract(time);\n      }\n\n      float computeWeight(vec2 uv, float time) {\n        float progress \x3d computeProgress(uv, time);\n        return 1.0 - abs(1.0 - 2.0 * progress);\n      }\n\n      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n        float flowStrength \x3d waveParams[2];\n        float flowOffset \x3d waveParams[3];\n\n        vec2 flowVector \x3d textureDenormalized2D(texFlow, uv) * flowStrength;\n\n        float progress \x3d computeProgress(uv, time + phaseOffset);\n        float weight \x3d computeWeight(uv, time + phaseOffset);\n\n        vec2 result \x3d uv;\n        result -\x3d flowVector * (progress + flowOffset);\n        result +\x3d phaseOffset;\n        result +\x3d (time - progress) * FLOW_JUMP;\n\n        return vec3(result, weight);\n      }\n\n      const float TIME_NOISE_TEXTURE_REPEAT \x3d 0.3737;\n      const float TIME_NOISE_STRENGTH \x3d 7.77;\n\n      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n        float waveStrength \x3d waveParams[0];\n\n        // overall directional shift in uv's for directional wave movement for\n        // now we do a hard coded scale for wave speed such that a unit length\n        // direction is not too fast.\n        vec2 waveMovement \x3d time * -_waveDir;\n\n        float timeNoise \x3d sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n\n        // compute two perturbed uvs and blend weights\n        // then sample the wave normals at the two positions and blend\n        vec3 uv_A \x3d computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n        vec3 uv_B \x3d computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n\n        vec3 normal_A \x3d textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n        vec3 normal_B \x3d textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n\n        // logic to flatten the wave pattern\n        // scale xy components of the normal, then adjust z (up) component\n        vec3 mixNormal \x3d normalize(normal_A + normal_B);\n        mixNormal.xy *\x3d waveStrength;\n        mixNormal.z \x3d sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n\n        return mixNormal;\n      }\n\n      vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\n        float waveTextureRepeat \x3d waveParams[1];\n        vec3 normal \x3d getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n        float foam  \x3d normals2FoamIntensity(normal, waveParams[0]);\n        return vec4(normal, foam);\n      }\n    "]))))}
Object.defineProperty(b,"__esModule",{value:!0});b.WaterDistortion=e;(function(a){a.bindUniforms=function(a,d){a.setUniform1i("texWaveNormal",0);a.setUniform1i("texWavePerturbation",1);a.setUniform4f("waveParams",d.waveStrength,d.waveTextureRepeat,d.flowStrength,d.flowOffset);a.setUniform2f("waveDirection",d.waveDirection[0]*d.waveVelocity,d.waveDirection[1]*d.waveVelocity)}})(e=b.WaterDistortion||(b.WaterDistortion={}));var f})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":function(){define(["require",
"exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.FoamIntensity=function(e){e.fragment.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n    float normals2FoamIntensity(vec3 n, float waveStrength){\n      float normalizationFactor \x3d  max(0.015, waveStrength);\n      return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n    }\n  "],["\n    float normals2FoamIntensity(vec3 n, float waveStrength){\n      float normalizationFactor \x3d  max(0.015, waveStrength);\n      return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n    }\n  "]))))};
b.FoamColor=function(b){b.fragment.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n    vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\n      return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n    }\n  "],["\n    vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\n      return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n    }\n  "]))))};
var h,e})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/Camera.glsl":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});(function(a){function b(a,e,b){a.setUniform3f("camPos",b[3]-e[0],b[7]-e[1],b[11]-e[2])}a.bindUniformsCustomOrigin=b;a.bindUniforms=function(a,e){b(a,e.origin,e.viewInvTransp)}})(b.Camera||(b.Camera={}));(function(a){a.bindUniforms=function(a,b){a.setUniform1f("pixelRatio",b.pixelRatio||1);a.setUniform4fv("viewport",b.viewport)}})(b.Viewport||
(b.Viewport={}))})},"esri/views/3d/webgl-engine/shaders/WaterSurface.glsl":function(){define("require exports tslib ../core/shaderLibrary/ForwardLinearDepth.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/shading/NormalUtils.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/Water.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var A=new k.ShaderBuilder;A.include(e.Transform,{linearDepth:!1});A.attributes.add("position","vec3");A.attributes.add("uv0","vec2");A.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3");0===b.output&&(A.include(f.NormalUtils,b),A.include(m.ForwardLinearDepth,b),A.varyings.add("vuv","vec2"),A.varyings.add("vpos","vec3"),A.varyings.add("vnormal","vec3"),A.varyings.add("vtbnMatrix",
"mat3"),A.vertex.code.add(c.glsl(p||(p=a.__makeTemplateObject(["\n      void main(void) {\n        vuv \x3d uv0;\n        vpos \x3d position;\n\n        vnormal \x3d getLocalUp(vpos, localOrigin);\n        vtbnMatrix \x3d getTBNMatrix(vnormal);\n\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardLinearDepth();\n      }\n    "],["\n      void main(void) {\n        vuv \x3d uv0;\n        vpos \x3d position;\n\n        vnormal \x3d getLocalUp(vpos, localOrigin);\n        vtbnMatrix \x3d getTBNMatrix(vnormal);\n\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardLinearDepth();\n      }\n    "])))),
A.include(d.WaterDistortion,b),A.include(h.Slice,b),b.receiveShadows&&A.include(g.ReadShadowMap,b),A.include(l.Water,b),A.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),A.fragment.code.add(c.glsl(r||(r=a.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        vec3 localUp \x3d vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam \x3d getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n \x3d normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v \x3d -normalize(vpos - camPos);\n        vec3 l \x3d normalize(-lightingMainDirection);\n        "],
["\n      void main() {\n        discardBySlice(vpos);\n        vec3 localUp \x3d vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam \x3d getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n \x3d normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v \x3d -normalize(vpos - camPos);\n        vec3 l \x3d normalize(-lightingMainDirection);\n        "])))),b.receiveShadows?
A.fragment.code.add(c.glsl(t||(t=a.__makeTemplateObject(["\n        float shadow \x3d 1.0 - readShadowMap(vpos, linearDepth);\n      "],["\n        float shadow \x3d 1.0 - readShadowMap(vpos, linearDepth);\n      "])))):A.fragment.code.add(c.glsl(u||(u=a.__makeTemplateObject(["\n        float shadow \x3d 1.0;\n      "],["\n        float shadow \x3d 1.0;\n      "])))),A.fragment.code.add(c.glsl(v||(v=a.__makeTemplateObject(["\n        vec4 vPosView \x3d view*vec4(vpos, 1.0);\n        vec4 final \x3d vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);\n\n        // gamma correction\n        gl_FragColor \x3d delinearizeGamma(final);\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "],
["\n        vec4 vPosView \x3d view*vec4(vpos, 1.0);\n        vec4 final \x3d vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);\n\n        // gamma correction\n        gl_FragColor \x3d delinearizeGamma(final);\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "])))));2===b.output&&(A.include(f.NormalUtils,b),A.include(d.WaterDistortion,b),A.include(h.Slice,b),A.varyings.add("vpos","vec3"),
A.varyings.add("vuv","vec2"),A.vertex.code.add(c.glsl(z||(z=a.__makeTemplateObject(["\n        void main(void) {\n          vuv \x3d uv0;\n          vpos \x3d position;\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          vuv \x3d uv0;\n          vpos \x3d position;\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "])))),A.fragment.uniforms.add("timeElapsed","float"),A.fragment.code.add(c.glsl(w||
(w=a.__makeTemplateObject(["\n        void main() {\n          discardBySlice(vpos);\n\n          // the created normal is in tangent space and foam\n          vec4 tangentNormalFoam \x3d getSurfaceNormalAndFoam(vuv, timeElapsed);\n          tangentNormalFoam.xyz \x3d normalize(tangentNormalFoam.xyz);\n\n          gl_FragColor \x3d vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n        }\n    "],["\n        void main() {\n          discardBySlice(vpos);\n\n          // the created normal is in tangent space and foam\n          vec4 tangentNormalFoam \x3d getSurfaceNormalAndFoam(vuv, timeElapsed);\n          tangentNormalFoam.xyz \x3d normalize(tangentNormalFoam.xyz);\n\n          gl_FragColor \x3d vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n        }\n    "])))));
5===b.output&&(A.include(f.NormalUtils,b),A.varyings.add("vpos","vec3"),A.vertex.code.add(c.glsl(q||(q=a.__makeTemplateObject(["\n        void main(void) {\n          vpos \x3d position;\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          vpos \x3d position;\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "])))),A.fragment.uniforms.add("waterColor","vec4"),A.fragment.code.add(c.glsl(y||(y=a.__makeTemplateObject(["\n        void main() {\n          gl_FragColor \x3d waterColor;\n        }\n    "],
["\n        void main() {\n          gl_FragColor \x3d waterColor;\n        }\n    "])))));return A};var p,r,t,u,v,z,w,q,y})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["require","exports","tslib","../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.ForwardLinearDepth=function(b,l){0===l.output&&l.receiveShadows?(b.varyings.add("linearDepth","float"),b.vertex.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n      void forwardLinearDepth() { linearDepth \x3d gl_Position.w; }\n    "],
["\n      void forwardLinearDepth() { linearDepth \x3d gl_Position.w; }\n    "]))))):1===l.output||3===l.output?(b.varyings.add("linearDepth","float"),b.vertex.uniforms.add("uCameraNearFar","vec2"),b.vertex.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n      void forwardLinearDepth() {\n        linearDepth \x3d (-position_view().z - uCameraNearFar[0]) / (uCameraNearFar[1] - uCameraNearFar[0]);\n      }\n    "],["\n      void forwardLinearDepth() {\n        linearDepth \x3d (-position_view().z - uCameraNearFar[0]) / (uCameraNearFar[1] - uCameraNearFar[0]);\n      }\n    "]))))):
b.vertex.code.add(m.glsl(f||(f=a.__makeTemplateObject(["\n      void forwardLinearDepth() {}\n    "],["\n      void forwardLinearDepth() {}\n    "]))))};var h,e,f})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.NormalUtils=function(b,d){0===d.viewingMode?b.vertex.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return normalize(pos + origin);\n      }\n    "],
["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return normalize(pos + origin);\n      }\n    "])))):b.vertex.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n      }\n    "],["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n      }\n    "]))));0===d.viewingMode?b.vertex.code.add(m.glsl(f||
(f=a.__makeTemplateObject(["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t \x3d normalize(cross(vec3(0.0, 0.0, 1.0), n));\n            vec3 b \x3d normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "],["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t \x3d normalize(cross(vec3(0.0, 0.0, 1.0), n));\n            vec3 b \x3d normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "])))):b.vertex.code.add(m.glsl(g||(g=a.__makeTemplateObject(["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t \x3d vec3(1.0, 0.0, 0.0);\n            vec3 b \x3d normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "],
["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t \x3d vec3(1.0, 0.0, 0.0);\n            vec3 b \x3d normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "]))))};var h,e,f,g})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("require exports tslib ./FoamRendering.glsl ./Gamma.glsl ./PhysicallyBasedRendering.glsl ./ScreenSpaceReflections.glsl ../../shaderModules/interfaces".split(" "),function(n,b,a,m,h,e,f,g){Object.defineProperty(b,
"__esModule",{value:!0});b.Water=function(b,p){b.include(e.PhysicallyBasedRendering,p);b.include(h.Gamma);b.include(m.FoamColor);p.ssrEnabled&&b.include(f.ScreenSpaceReflections,p);b.fragment.code.add(g.glsl(l||(l=a.__makeTemplateObject(["\n    const vec3 fresnelSky \x3d  vec3(0.02, 1.0, 15.0); // f0, f0max, exp\n    const vec2 fresnelMaterial \x3d  vec2(0.02, 0.1); // f0, f0max for specular term\n    const float roughness \x3d 0.015;\n    const float foamIntensityExternal \x3d 1.7;\n    const float ssrIntensity \x3d 0.65;\n    const float ssrHeightFadeStart \x3d 300000.0;\n    const float ssrHeightFadeEnd \x3d 500000.0;\n    const float waterDiffusion \x3d 0.775;\n    const float waterSeeColorMod \x3d 0.8;\n    const float correctionViewingPowerFactor \x3d 0.4;\n\n    const vec3 skyZenitColor \x3d vec3(0.52, 0.68, 0.90);\n    const vec3 skyColor \x3d vec3(0.67, 0.79, 0.9);\n\n    PBRShadingWater shadingInfo;\n\n    /*\n    *   This function is an approximation for the sky gradient reflected\n    *   the water surface and describes a combination of two fresnel terms.\n    *   @parameter: cosTheta \x3d is the result of max(dot(n,v), 0.0)\n    *   @parameter: horizon \x3d the dominant color of the sky horizon\n    *   @parameter: cosTheta \x3d the dominant color of the sky zenit\n    */\n    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n      float exponent \x3d pow((1.0 - cosTheta), fresnelSky[2]);\n      return mix(zenit, horizon, exponent);\n    }\n\n    /*\n    *   This function determines the water color per pixel.\n    *   @parameter: n \x3d normal facing away from the surface\n    *   @parameter: v \x3d view direction facing away from the surface.\n    *   @parameter: l \x3d light direction facing away from the surface\n    *   @parameter: lightIntensity \x3d light intensity, currently between 0...PI\n    *   @parameter: localUp \x3d a normal for the general direction of the surface\n    *   @parameter: shadow \x3d the amount of shadow at this pixel (0 \x3d no shadow)\n    */\n    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {\n\n      float reflectionHit \x3d 0.;\n      vec3 seaWaterColor \x3d linearizeGamma(color);\n      // using half vector to determine the specular light\n      vec3 h \x3d normalize(l + v);\n      shadingInfo.NdotL \x3d clamp(dot(n, l), 0.0, 1.0);\n      shadingInfo.NdotV \x3d clamp(dot(n, v), 0.001, 1.0);\n      shadingInfo.VdotN \x3d clamp(dot(v, n), 0.001, 1.0);\n      shadingInfo.NdotH \x3d clamp(dot(n, h), 0.0, 1.0);\n      shadingInfo.VdotH \x3d clamp(dot(v, h), 0.0, 1.0);\n      shadingInfo.LdotH \x3d clamp(dot(l, h), 0.0, 1.0);\n\n      // angle between vertex normal and view direction\n      float upDotV \x3d max(dot(localUp,v), 0.0);\n      // reflected sky color: the reflected sky color consists of two main colors, the\n      // reflected color at the horizon and the reflected color of the zenit.\n      // the reflected sky color is then an approximation based on the fresnel term.\n      vec3 skyHorizon \x3d linearizeGamma(skyColor);\n      vec3 skyZenit \x3d linearizeGamma(skyZenitColor);\n      vec3 skyColor \x3d getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n\n      // we use the upDotL to smoothen out the\n      // reflected color of the water\n      float upDotL \x3d max(dot(localUp,l),0.0);\n\n      // The approximated sky color is adjusted according to the sun position.\n      // This is done as approximation for e.g. night views.\n      float daytimeMod \x3d 0.1 + upDotL * 0.9;\n      skyColor *\x3d daytimeMod;\n\n      // If a water surface is in shadow we just use a slight darkening of the\n      // water surface expressed with this shadowModifier.\n      float shadowModifier \x3d clamp(shadow, 0.8, 1.0);\n\n      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.\n      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long\n      // as reflection are absent there is a need to have a slight shadow for depth perception.\n      vec3 fresnelModifier \x3d fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\n      vec3 reflSky \x3d fresnelModifier * skyColor * shadowModifier;\n\n      // The reflected sea color is the input water color combined with the reflected sky color.\n      // The reflected sky color is modified by the incoming light.\n      vec3 reflSea \x3d seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n\n      vec3 specular \x3d vec3(0.0);\n      // This prevents the specular light to be rendered when:\n      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)\n      // - viewer is under water (for this localUp is better than n)\n      if(upDotV \x3e 0.0 \x26\x26 upDotL \x3e 0.0) {\n        // calculate the cook torrance BRDF but with simplified occlusion\n        vec3 specularSun \x3d brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n\n        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here\n        vec3 incidentLight \x3d lightIntensity * LIGHT_NORMALIZATION * shadow;\n\n        specular \x3d shadingInfo.NdotL * incidentLight * specularSun;\n      }\n\n      vec3 foam \x3d vec3(0.0);\n      if(upDotV \x3e 0.0) {\n        foam \x3d foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n      }\n      "],
["\n    const vec3 fresnelSky \x3d  vec3(0.02, 1.0, 15.0); // f0, f0max, exp\n    const vec2 fresnelMaterial \x3d  vec2(0.02, 0.1); // f0, f0max for specular term\n    const float roughness \x3d 0.015;\n    const float foamIntensityExternal \x3d 1.7;\n    const float ssrIntensity \x3d 0.65;\n    const float ssrHeightFadeStart \x3d 300000.0;\n    const float ssrHeightFadeEnd \x3d 500000.0;\n    const float waterDiffusion \x3d 0.775;\n    const float waterSeeColorMod \x3d 0.8;\n    const float correctionViewingPowerFactor \x3d 0.4;\n\n    const vec3 skyZenitColor \x3d vec3(0.52, 0.68, 0.90);\n    const vec3 skyColor \x3d vec3(0.67, 0.79, 0.9);\n\n    PBRShadingWater shadingInfo;\n\n    /*\n    *   This function is an approximation for the sky gradient reflected\n    *   the water surface and describes a combination of two fresnel terms.\n    *   @parameter: cosTheta \x3d is the result of max(dot(n,v), 0.0)\n    *   @parameter: horizon \x3d the dominant color of the sky horizon\n    *   @parameter: cosTheta \x3d the dominant color of the sky zenit\n    */\n    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n      float exponent \x3d pow((1.0 - cosTheta), fresnelSky[2]);\n      return mix(zenit, horizon, exponent);\n    }\n\n    /*\n    *   This function determines the water color per pixel.\n    *   @parameter: n \x3d normal facing away from the surface\n    *   @parameter: v \x3d view direction facing away from the surface.\n    *   @parameter: l \x3d light direction facing away from the surface\n    *   @parameter: lightIntensity \x3d light intensity, currently between 0...PI\n    *   @parameter: localUp \x3d a normal for the general direction of the surface\n    *   @parameter: shadow \x3d the amount of shadow at this pixel (0 \x3d no shadow)\n    */\n    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {\n\n      float reflectionHit \x3d 0.;\n      vec3 seaWaterColor \x3d linearizeGamma(color);\n      // using half vector to determine the specular light\n      vec3 h \x3d normalize(l + v);\n      shadingInfo.NdotL \x3d clamp(dot(n, l), 0.0, 1.0);\n      shadingInfo.NdotV \x3d clamp(dot(n, v), 0.001, 1.0);\n      shadingInfo.VdotN \x3d clamp(dot(v, n), 0.001, 1.0);\n      shadingInfo.NdotH \x3d clamp(dot(n, h), 0.0, 1.0);\n      shadingInfo.VdotH \x3d clamp(dot(v, h), 0.0, 1.0);\n      shadingInfo.LdotH \x3d clamp(dot(l, h), 0.0, 1.0);\n\n      // angle between vertex normal and view direction\n      float upDotV \x3d max(dot(localUp,v), 0.0);\n      // reflected sky color: the reflected sky color consists of two main colors, the\n      // reflected color at the horizon and the reflected color of the zenit.\n      // the reflected sky color is then an approximation based on the fresnel term.\n      vec3 skyHorizon \x3d linearizeGamma(skyColor);\n      vec3 skyZenit \x3d linearizeGamma(skyZenitColor);\n      vec3 skyColor \x3d getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n\n      // we use the upDotL to smoothen out the\n      // reflected color of the water\n      float upDotL \x3d max(dot(localUp,l),0.0);\n\n      // The approximated sky color is adjusted according to the sun position.\n      // This is done as approximation for e.g. night views.\n      float daytimeMod \x3d 0.1 + upDotL * 0.9;\n      skyColor *\x3d daytimeMod;\n\n      // If a water surface is in shadow we just use a slight darkening of the\n      // water surface expressed with this shadowModifier.\n      float shadowModifier \x3d clamp(shadow, 0.8, 1.0);\n\n      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.\n      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long\n      // as reflection are absent there is a need to have a slight shadow for depth perception.\n      vec3 fresnelModifier \x3d fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\n      vec3 reflSky \x3d fresnelModifier * skyColor * shadowModifier;\n\n      // The reflected sea color is the input water color combined with the reflected sky color.\n      // The reflected sky color is modified by the incoming light.\n      vec3 reflSea \x3d seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n\n      vec3 specular \x3d vec3(0.0);\n      // This prevents the specular light to be rendered when:\n      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)\n      // - viewer is under water (for this localUp is better than n)\n      if(upDotV \x3e 0.0 \x26\x26 upDotL \x3e 0.0) {\n        // calculate the cook torrance BRDF but with simplified occlusion\n        vec3 specularSun \x3d brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n\n        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here\n        vec3 incidentLight \x3d lightIntensity * LIGHT_NORMALIZATION * shadow;\n\n        specular \x3d shadingInfo.NdotL * incidentLight * specularSun;\n      }\n\n      vec3 foam \x3d vec3(0.0);\n      if(upDotV \x3e 0.0) {\n        foam \x3d foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n      }\n      "]))));
p.ssrEnabled?b.fragment.code.add(g.glsl(d||(d=a.__makeTemplateObject(["\n      // Convert the world position to view position\n      vec4 viewPosition \x3d vec4(positionView.xyz, 1.0);\n      vec3 viewDir \x3d normalize(viewPosition.xyz);\n      vec4 viewNormalVectorCoordinate \x3d ssrViewMat *vec4(n, 0.0);\n      vec3 viewNormal \x3d normalize(viewNormalVectorCoordinate.xyz);\n      vec4 viewUp \x3d ssrViewMat *vec4(localUp, 0.0);\n\n      // at steeper viewing angles we use more of a vertex normal (in this case up) then the wave normal\n      // this removes some artifacts of normal mapping\n      float correctionViewingFactor \x3d pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);\n      vec3 viewNormalCorrected \x3d mix(viewUp.xyz, viewNormal, correctionViewingFactor);\n\n      vec3 reflected \x3d normalize(reflect(viewDir, viewNormalCorrected));\n\n      // perform screen space reflection to detect hit\n      vec3 hitCoordinate \x3d screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);\n      vec3 reflectedColor \x3d vec3(0.0);\n\n      // if there is a hit with ssr find reflected color from the reprojeted frame\n      if (hitCoordinate.z \x3e 0.0)\n      {\n        vec2 reprojectedCoordinate \x3d reprojectionCoordinate(hitCoordinate);\n\n        // fade out if there if the hit is near end of Y axis\n        vec2 dCoords \x3d smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\n        float heightMod \x3d smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);\n        reflectionHit \x3d waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;\n\n        reflectedColor \x3d linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;\n      }\n      float seeColorMod \x3d  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);\n    }\n  "],
["\n      // Convert the world position to view position\n      vec4 viewPosition \x3d vec4(positionView.xyz, 1.0);\n      vec3 viewDir \x3d normalize(viewPosition.xyz);\n      vec4 viewNormalVectorCoordinate \x3d ssrViewMat *vec4(n, 0.0);\n      vec3 viewNormal \x3d normalize(viewNormalVectorCoordinate.xyz);\n      vec4 viewUp \x3d ssrViewMat *vec4(localUp, 0.0);\n\n      // at steeper viewing angles we use more of a vertex normal (in this case up) then the wave normal\n      // this removes some artifacts of normal mapping\n      float correctionViewingFactor \x3d pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);\n      vec3 viewNormalCorrected \x3d mix(viewUp.xyz, viewNormal, correctionViewingFactor);\n\n      vec3 reflected \x3d normalize(reflect(viewDir, viewNormalCorrected));\n\n      // perform screen space reflection to detect hit\n      vec3 hitCoordinate \x3d screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);\n      vec3 reflectedColor \x3d vec3(0.0);\n\n      // if there is a hit with ssr find reflected color from the reprojeted frame\n      if (hitCoordinate.z \x3e 0.0)\n      {\n        vec2 reprojectedCoordinate \x3d reprojectionCoordinate(hitCoordinate);\n\n        // fade out if there if the hit is near end of Y axis\n        vec2 dCoords \x3d smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\n        float heightMod \x3d smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);\n        reflectionHit \x3d waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;\n\n        reflectedColor \x3d linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;\n      }\n      float seeColorMod \x3d  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);\n    }\n  "])))):
b.fragment.code.add(g.glsl(c||(c=a.__makeTemplateObject(["\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);\n    }\n  "],["\n      // combining reflected sky, reflected sea, specular highlight and SSR reflections.\n      return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);\n    }\n  "]))))};var l,d,c})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["require",
"exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.Gamma=function(b){b.fragment.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n    const float GAMMA \x3d 2.2;\n    const float INV_GAMMA \x3d 0.4545454545;\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "],["\n    const float GAMMA \x3d 2.2;\n    const float INV_GAMMA \x3d 0.4545454545;\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "]))))};
var h})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define("require exports tslib ./AnalyticalSkyModel.glsl ./PiUtils.glsl ../../shaderModules/interfaces".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});b.PhysicallyBasedRendering=function(b,w){var q=b.fragment.code;b.include(h.PiUtils);if(3===w.pbrMode||4===w.pbrMode)q.add(e.glsl(f||(f=a.__makeTemplateObject(["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent \x3d ",
";\n    "],["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent \x3d ",
";\n    "])),w.useCustomDTRExponentForWater?"2.2":"2.0")),q.add(e.glsl(g||(g=a.__makeTemplateObject(["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "],["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "])))),q.add(e.glsl(l||(l=a.__makeTemplateObject(["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 \x3d roughness * roughness;\n      float NdotH2 \x3d NdotH * NdotH;\n      float denom \x3d pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "],
["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 \x3d roughness * roughness;\n      float NdotH2 \x3d NdotH * NdotH;\n      float denom \x3d pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "])))),q.add(e.glsl(d||(d=a.__makeTemplateObject(["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "],["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "])))),
q.add(e.glsl(c||(c=a.__makeTemplateObject(["\n    vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F \x3d fresnelReflection(props.VdotH, F0, F0Max);\n      float dSun \x3d normalDistributionWater(props.NdotH, roughness);\n      float V \x3d geometricOcclusionKelemen(props.LdotH);\n\n      float diffusionSunHaze \x3d mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);\n      float strengthSunHaze  \x3d 1.2;\n      float dSunHaze \x3d normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;\n\n      return ((dSun + dSunHaze) * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "],
["\n    vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F \x3d fresnelReflection(props.VdotH, F0, F0Max);\n      float dSun \x3d normalDistributionWater(props.NdotH, roughness);\n      float V \x3d geometricOcclusionKelemen(props.LdotH);\n\n      float diffusionSunHaze \x3d mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);\n      float strengthSunHaze  \x3d 1.2;\n      float dSunHaze \x3d normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;\n\n      return ((dSun + dSunHaze) * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "]))));
else if(1===w.pbrMode||2===w.pbrMode)b.include(m.AnalyticalSkyModel),q.add(e.glsl(k||(k=a.__makeTemplateObject(["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "],
["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "])))),
q.add(e.glsl(p||(p=a.__makeTemplateObject(["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a \x3d NdotH * roughness;\n        float b \x3d roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "],["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a \x3d NdotH * roughness;\n        float b \x3d roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "])))),q.add(e.glsl(r||
(r=a.__makeTemplateObject(["\n    const vec4 c0 \x3d vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 \x3d vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 \x3d vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r \x3d roughness * c0 + c1;\n        float a004 \x3d min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "],["\n    const vec4 c0 \x3d vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 \x3d vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 \x3d vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r \x3d roughness * c0 + c1;\n        float a004 \x3d min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "])))),
q.add(e.glsl(t||(t=a.__makeTemplateObject(["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse \x3d evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular \x3d evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent \x3d inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg \x3d prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor \x3d inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent \x3d specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "],
["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse \x3d evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular \x3d evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent \x3d inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg \x3d prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor \x3d inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent \x3d specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "])))),
q.add(e.glsl(u||(u=a.__makeTemplateObject(["\n    float gamutMapChanel(float x, vec2 p){\n      return (x \x3c p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }"],["\n    float gamutMapChanel(float x, vec2 p){\n      return (x \x3c p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }"])))),q.add(e.glsl(v||(v=a.__makeTemplateObject(["\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      vec2 p \x3d vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      outColor.x \x3d gamutMapChanel(inColor.x, p) ;\n      outColor.y \x3d gamutMapChanel(inColor.y, p) ;\n      outColor.z \x3d gamutMapChanel(inColor.z, p) ;\n      return outColor;\n    }\n    "],
["\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      vec2 p \x3d vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      outColor.x \x3d gamutMapChanel(inColor.x, p) ;\n      outColor.y \x3d gamutMapChanel(inColor.y, p) ;\n      outColor.z \x3d gamutMapChanel(inColor.z, p) ;\n      return outColor;\n    }\n    "]))))};var f,g,l,d,c,k,p,r,t,u,v})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["require",
"exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.AnalyticalSkyModel=function(b){b=b.fragment.code;b.add(m.glsl(h||(h=a.__makeTemplateObject(["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "],["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "]))));
b.add(m.glsl(e||(e=a.__makeTemplateObject(["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "],["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "]))));b.add(m.glsl(f||(f=a.__makeTemplateObject(["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 \x3d 1.0 - RdotNG * RdotNG;\n      float intRadTheta \x3d integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground \x3d RdotNG \x3c 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky \x3d 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "],
["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 \x3d 1.0 - RdotNG * RdotNG;\n      float intRadTheta \x3d integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground \x3d RdotNG \x3c 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky \x3d 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "]))))};
var h,e,f})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.PiUtils=function(b){b.vertex.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n    const float PI \x3d 3.141592653589793;\n  "],["\n    const float PI \x3d 3.141592653589793;\n  "]))));b.fragment.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n    const float PI \x3d 3.141592653589793;\n    const float LIGHT_NORMALIZATION \x3d 1.0 / PI;\n    const float INV_PI \x3d 0.3183098861837907;\n    const float HALF_PI \x3d 1.570796326794897;\n    "],
["\n    const float PI \x3d 3.141592653589793;\n    const float LIGHT_NORMALIZATION \x3d 1.0 / PI;\n    const float INV_PI \x3d 0.3183098861837907;\n    const float HALF_PI \x3d 1.570796326794897;\n    "]))))};var h,e})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/mat4","../../../../../core/libs/gl-matrix-2/mat4f64"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(b,
e,f,g,l,d){this.from=b;this.to=e;this.isVisible=f;this.hasHighlights=g;this.hasOccludees=l;this.transformation=d;null!=d&&(this.transformationNormal=m.mat4f64.clone(d),a.mat4.invert(this.transformationNormal,this.transformationNormal),a.mat4.transpose(this.transformationNormal,this.transformationNormal))}}();b.Instance=n;b.sortInstancesAccordingToRange=function(a){return a.sort(function(a,b){return a.from===b.from?a.to>b.to?1:a.to<b.to?-1:0:a.from>b.from?1:a.from<b.from?-1:0})};b.addOrMerge=function(a,
b){if(0===a.length)a.push({first:b.from,count:b.to-b.from});else{var e=a[a.length-1],g;g=e.first+e.count>=b.from?!0:!1;g?e.count=b.from-e.first+b.to-b.from:a.push({first:b.from,count:b.to-b.from})}}})},"esri/views/3d/webgl-engine/shaders/HUDMaterial.glsl":function(){define("require exports tslib ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/hud/AlignPixel.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderLibrary/hud/HUDOcclusionPass.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/AlphaDiscard.glsl ../core/shaderLibrary/util/ColorConversion.glsl ../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../core/shaderLibrary/util/ScreenSizePerspective.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z){function w(a,c){void 0===c&&(c=q);if(a.textureIsSignedDistanceField){var d=a.anchorPos;a=a.distanceFieldBoundingBox;var b=c;b[0]=d[0]*(a[2]-a[0])+a[0];b[1]=d[1]*(a[3]-a[1])+a[1]}else m.vec2.copy(c,a.anchorPos);return c}Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var e=new z.ShaderBuilder,h=b.signedDistanceFieldEnabled;e.include(g.AlignPixel);e.include(l.HUD,b);e.include(f.Slice,b);if(6===b.output)return e.include(d.HUDOcclusionPass,
b),e;e.include(u.ScreenSizePerspective);e.include(t.RgbaFloatEncoding);e.include(r.ColorConversion,{stages:1});e.include(k.VisualVariables,b);e.varyings.add("vcolor","vec4");e.varyings.add("vtc","vec2");e.varyings.add("vsize","vec2");b.binaryHighlightOcclusionEnabled&&e.varyings.add("voccluded","float");e.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4");h&&e.vertex.uniforms.add("outlineColor","vec4");b.screenSizePerspectiveEnabled&&
e.vertex.uniforms.add("screenSizePerspective","vec4");(b.debugDrawBorder||b.binaryHighlightOcclusionEnabled)&&e.varyings.add("debugBorderCoords","vec4");e.attributes.add("uv0","vec2");e.attributes.add("color","vec4");e.attributes.add("size","vec2");e.attributes.add("auxpos2","vec4");e.vertex.code.add(v.glsl(B||(B=a.__makeTemplateObject(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj \x3d projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ",
"\n\n      ","\n\n      vec2 combinedSize \x3d inputSize * pixelRatio;\n      vec4 quadOffset \x3d vec4(0.0);\n\n      ","\n\n      ","\n    "],["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj \x3d projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize \x3d inputSize * pixelRatio;\n      vec4 quadOffset \x3d vec4(0.0);\n\n      ",
"\n\n      ","\n    "])),b.screenSizePerspectiveEnabled?v.glsl(y||(y=a.__makeTemplateObject(["\n      inputSize \x3d screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "],["\n      inputSize \x3d screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "]))):
v.glsl(A||(A=a.__makeTemplateObject(["\n      inputSize \x3d size;\n      vec2 screenOffsetScaled \x3d screenOffset;"],["\n      inputSize \x3d size;\n      vec2 screenOffsetScaled \x3d screenOffset;"]))),b.vvSize?"inputSize *\x3d vvScale(auxpos2).xx;":"",b.occlusionTestEnabled||b.binaryHighlightOcclusionEnabled?"bool visible \x3d testVisibilityHUD(posProj);":"",b.binaryHighlightOcclusionEnabled?"voccluded \x3d visible ? 0.0 : 1.0;":""));var q=v.glsl(C||(C=a.__makeTemplateObject(["\n      vec2 uv01 \x3d floor(uv0);\n      vec2 uv \x3d uv0 - uv01;\n      quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n  "],
["\n      vec2 uv01 \x3d floor(uv0);\n      vec2 uv \x3d uv0 - uv01;\n      quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n  "]))),m=h?v.glsl(F||(F=a.__makeTemplateObject(["\n  posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"],["\n  posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"]))):v.glsl(H||(H=a.__makeTemplateObject(["\n  posProj +\x3d quadOffset;\n  if (inputSize.x \x3d\x3d size.x) {\n    posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\n  }"],
["\n  posProj +\x3d quadOffset;\n  if (inputSize.x \x3d\x3d size.x) {\n    posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\n  }"])));e.vertex.code.add(v.glsl(G||(G=a.__makeTemplateObject(["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard \x3d vcolor.a \x3c ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (\x3d fill) and outline color (if applicable) are transparent\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',
"\n        gl_Position \x3d posProj;\n      }\n\n      vtc \x3d uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize \x3d inputSize;\n      ","\n    }\n    "],["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard \x3d vcolor.a \x3c ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (\x3d fill) and outline color (if applicable) are transparent\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',
"\n        gl_Position \x3d posProj;\n      }\n\n      vtc \x3d uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize \x3d inputSize;\n      ","\n    }\n    "])),b.occlusionTestEnabled?"if (visible) {":"",q,b.vvColor?"vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor \x3d color / 255.0 * materialColor;",v.glsl.float(p.symbolAlphaCutoff),h?"alphaDiscard \x3d alphaDiscard \x26\x26 outlineColor.a \x3c "+v.glsl.float(p.symbolAlphaCutoff)+";":"",m,b.debugDrawBorder?
"debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);":"",b.occlusionTestEnabled?v.glsl(I||(I=a.__makeTemplateObject(["} else { vtc \x3d vec2(0.0);\n        ",""],["} else { vtc \x3d vec2(0.0);\n        ",""])),b.debugDrawBorder?"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"):""));e.fragment.uniforms.add("tex","sampler2D");h&&(e.fragment.uniforms.add("outlineColor","vec4"),e.fragment.uniforms.add("outlineSize","float"));q=b.debugDrawBorder?v.glsl(J||(J=a.__makeTemplateObject(["(isBorder \x3e 0.0 ? 0.0 : ",
")"],["(isBorder \x3e 0.0 ? 0.0 : ",")"])),v.glsl.float(p.defaultMaskAlphaCutoff)):v.glsl.float(p.defaultMaskAlphaCutoff);h=v.glsl(Q||(Q=a.__makeTemplateObject(["\n    ","\n\n    ","\n\n    ","\n  "],["\n    ","\n\n    ","\n\n    ","\n  "])),b.debugDrawBorder?v.glsl(E||(E=a.__makeTemplateObject(["\n      float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"],["\n      float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"]))):
"",h?v.glsl(L||(L=a.__makeTemplateObject(["\n      vec4 fillPixelColor \x3d vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize \x3d 128.0;\n      const float texelSize \x3d 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor \x3d (vsize - txSize) * texelSize;\n      vec2 samplePos \x3d vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d \x3d rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist \x3d d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor \x3d clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *\x3d fillAlphaFactor;\n\n      if (outlineSize \x3e 0.25) {\n        vec4 outlinePixelColor \x3d outlineColor;\n        float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor \x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *\x3d outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor \x3c ",
" ||\n          fillPixelColor.a + outlinePixelColor.a \x3c ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor \x3c ",
") {\n          discard;\n        }\n\n        gl_FragColor \x3d premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor \x3d vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "],["\n      vec4 fillPixelColor \x3d vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize \x3d 128.0;\n      const float texelSize \x3d 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor \x3d (vsize - txSize) * texelSize;\n      vec2 samplePos \x3d vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d \x3d rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist \x3d d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor \x3d clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *\x3d fillAlphaFactor;\n\n      if (outlineSize \x3e 0.25) {\n        vec4 outlinePixelColor \x3d outlineColor;\n        float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor \x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *\x3d outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor \x3c ",
" ||\n          fillPixelColor.a + outlinePixelColor.a \x3c ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor \x3c ",
") {\n          discard;\n        }\n\n        gl_FragColor \x3d premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor \x3d vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "])),q,v.glsl.float(p.symbolAlphaCutoff),q):v.glsl(M||(M=a.__makeTemplateObject(["\n          vec4 texColor \x3d texture2D(tex, vtc, -0.5);\n          if (texColor.a \x3c ",") {\n            discard;\n          }\n          gl_FragColor \x3d texColor * premultiplyAlpha(vcolor);\n          "],
["\n          vec4 texColor \x3d texture2D(tex, vtc, -0.5);\n          if (texColor.a \x3c ",") {\n            discard;\n          }\n          gl_FragColor \x3d texColor * premultiplyAlpha(vcolor);\n          "])),q),b.debugDrawBorder?v.glsl(N||(N=a.__makeTemplateObject(["gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"],["gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"]))):"");0===b.output&&e.fragment.code.add(v.glsl(R||(R=a.__makeTemplateObject(["\n    void main() {\n      ",
"\n    }\n    "],["\n    void main() {\n      ","\n    }\n    "])),h));4===b.output&&(e.include(c.OutputHighlight),e.fragment.code.add(v.glsl(O||(O=a.__makeTemplateObject(["\n    void main() {\n      ","\n      ","\n    }\n    "],["\n    void main() {\n      ","\n      ","\n    }\n    "])),h,b.binaryHighlightOcclusionEnabled?v.glsl(W||(W=a.__makeTemplateObject(["\n          if (voccluded \x3d\x3d 1.0) {\n            gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n          }"],
["\n          if (voccluded \x3d\x3d 1.0) {\n            gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n          }"]))):"outputHighlight();")));return e};(function(a){a.bindUniforms=function(a,c,d){a.setUniform4fv("materialColor",c.color);c.textureIsSignedDistanceField&&(0>=c.outlineColor[3]||0>=c.outlineSize?(a.setUniform4fv("outlineColor",e.vec4f64.ZEROS),a.setUniform1f("outlineSize",0)):(a.setUniform4fv("outlineColor",
c.outlineColor),a.setUniform1f("outlineSize",c.outlineSize)));d=d.pixelRatio||1;a.setUniform2f("screenOffset",2*c.screenOffset[0]*d,2*c.screenOffset[1]*d);a.setUniform2fv("anchorPos",w(c))}})(b.HUDMaterial||(b.HUDMaterial={}));b.calculateAnchorPosForRendering=w;var q=h.vec2f64.create(),y,A,B,C,F,H,I,G,J,E,L,M,N,Q,R,W,O})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define(["require","exports","tslib","../util/ScreenSizePerspective.glsl","../../shaderModules/interfaces"],
function(n,b,a,m,h){function e(b,e){b.include(m.ScreenSizePerspective);b.attributes.add("position","vec3");b.attributes.add("normal","vec3");b.attributes.add("auxpos1","vec4");b.vertex.uniforms.add("proj","mat4");b.vertex.uniforms.add("view","mat4");b.vertex.uniforms.add("viewNormal","mat4");b.vertex.uniforms.add("viewport","vec4");b.vertex.uniforms.add("camPos","vec3");b.vertex.uniforms.add("polygonOffset","float");b.vertex.uniforms.add("cameraGroundRelative","float");b.vertex.uniforms.add("pixelRatio",
"float");b.vertex.uniforms.add("perDistancePixelRatio","float");b.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float");e.verticalOffsetEnabled&&b.vertex.uniforms.add("verticalOffset","vec4");e.screenSizePerspectiveEnabled&&b.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4");b.vertex.uniforms.add("hudVisibilityTexture","sampler2D");b.vertex.defines.addFloat("SMALL_OFFSET_ANGLE",.984807753012208);b.vertex.code.add(h.glsl(f||(f=a.__makeTemplateObject(["\n    struct ProjectHUDAux {\n      vec3 posModel;\n      vec3 posView;\n      vec3 vnormal;\n\n      float distanceToCamera;\n      float absCosAngle;\n    };\n  "],
["\n    struct ProjectHUDAux {\n      vec3 posModel;\n      vec3 posView;\n      vec3 vnormal;\n\n      float distanceToCamera;\n      float absCosAngle;\n    };\n  "]))));b.vertex.code.add(h.glsl(g||(g=a.__makeTemplateObject(["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign \x3d sign(pointGroundDistance);\n\n      if (pointGroundSign \x3d\x3d 0.0) {\n        pointGroundSign \x3d cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative \x3d cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation\n      // we take the absolute value because the sign that is dropped is\n      // instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset \x3e .0) {\n        float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\n\n        float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor \x3d (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative \x3e 0.0) {\n          posView *\x3d factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /\x3d factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "],
["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign \x3d sign(pointGroundDistance);\n\n      if (pointGroundSign \x3d\x3d 0.0) {\n        pointGroundSign \x3d cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative \x3d cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation\n      // we take the absolute value because the sign that is dropped is\n      // instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset \x3e .0) {\n        float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\n\n        float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor \x3d (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative \x3e 0.0) {\n          posView *\x3d factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /\x3d factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "]))));
b.vertex.code.add(h.glsl(l||(l=a.__makeTemplateObject(["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera \x3d length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset \x3d distanceToCamera * perDistancePixelRatio * 0.5;\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset \x3d normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel +\x3d modelOffset;\n      posView +\x3d viewOffset;\n    }\n  "],
["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera \x3d length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset \x3d distanceToCamera * perDistancePixelRatio * 0.5;\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset \x3d normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel +\x3d modelOffset;\n      posView +\x3d viewOffset;\n    }\n  "]))));
b.vertex.code.add(h.glsl(k||(k=a.__makeTemplateObject(["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset \x3d auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance \x3d auxpos1.w;\n\n      aux.posModel \x3d position;\n      aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal \x3d normal;\n\n      applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera \x3d length(aux.posView);\n\n      vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\n      float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle \x3d abs(cosAngle);\n\n      ",
"\n\n      ","\n\n      ","\n\n      float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "],["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset \x3d auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance \x3d auxpos1.w;\n\n      aux.posModel \x3d position;\n      aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal \x3d normal;\n\n      applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera \x3d length(aux.posView);\n\n      vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\n      float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle \x3d abs(cosAngle);\n\n      ",
"\n\n      ","\n\n      ","\n\n      float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "])),e.screenSizePerspectiveEnabled?e.verticalOffsetEnabled||1===e.screenCenterOffsetUnitsEnabled?"vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":
"":"",e.verticalOffsetEnabled?e.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":"",e.verticalOffsetEnabled?h.glsl(d||(d=a.__makeTemplateObject(["\n            float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset \x3d aux.vnormal * worldOffset;\n            aux.posModel +\x3d modelOffset;\n            vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView +\x3d viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance +\x3d worldOffset;"],
["\n            float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset \x3d aux.vnormal * worldOffset;\n            aux.posModel +\x3d modelOffset;\n            vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView +\x3d viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance +\x3d worldOffset;"]))):
"",1!==e.screenCenterOffsetUnitsEnabled?h.glsl(c||(c=a.__makeTemplateObject(["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z !\x3d 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z !\x3d 0.0) {\n              aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\n            }\n          "],
["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z !\x3d 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z !\x3d 0.0) {\n              aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\n            }\n          "]))):"",
1===e.screenCenterOffsetUnitsEnabled?e.screenSizePerspectiveEnabled?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":"",1===e.screenCenterOffsetUnitsEnabled?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""));b.vertex.code.add(h.glsl(p||(p=a.__makeTemplateObject(["\n    bool testVisibilityHUD(vec4 posProj) {\n      // For occlusion testing, use the nearest pixel center to avoid\n      // subpixel filtering messing up the color we use to test for\n      vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n\n      vec4 occlusionPixel \x3d texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n      // the green pixel stores transparency of transparent geometry (1.0 -\x3e fully transparent)\n      // note that we also check against green \x3d\x3d 0.0, i.e. transparent geometry that has opaque parts\n\n      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n      if (uRenderTransparentlyOccludedHUD \x3e 0.5) {\n        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n        // uRenderTransparentlyOccludedHUD \x3d 0.75\n        return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g * uRenderTransparentlyOccludedHUD \x3c 1.0;\n      }\n\n      // and visible pixels that are not occluded by semi-transparent geometry here\n      return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g \x3d\x3d 1.0;\n    }\n  "],
["\n    bool testVisibilityHUD(vec4 posProj) {\n      // For occlusion testing, use the nearest pixel center to avoid\n      // subpixel filtering messing up the color we use to test for\n      vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n\n      vec4 occlusionPixel \x3d texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n      // the green pixel stores transparency of transparent geometry (1.0 -\x3e fully transparent)\n      // note that we also check against green \x3d\x3d 0.0, i.e. transparent geometry that has opaque parts\n\n      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n      if (uRenderTransparentlyOccludedHUD \x3e 0.5) {\n        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n        // uRenderTransparentlyOccludedHUD \x3d 0.75\n        return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g * uRenderTransparentlyOccludedHUD \x3c 1.0;\n      }\n\n      // and visible pixels that are not occluded by semi-transparent geometry here\n      return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g \x3d\x3d 1.0;\n    }\n  "]))))}
Object.defineProperty(b,"__esModule",{value:!0});b.HUD=e;(function(a){(function(a){a[a.OCCLUDED=0]="OCCLUDED";a[a.NOTOCCLUDED=1]="NOTOCCLUDED";a[a.BOTH=2]="BOTH";a[a.COUNT=3]="COUNT"})(a.TransparentRenderStyle||(a.TransparentRenderStyle={}));a.bindUniforms=function(c,d){c.setUniform1f("uRenderTransparentlyOccludedHUD",d.renderTransparentlyOccludedHUD===a.TransparentRenderStyle.OCCLUDED?1:d.renderTransparentlyOccludedHUD===a.TransparentRenderStyle.NOTOCCLUDED?0:.75)};a.bindVisibilityTexture=function(a,
c,d){c.setUniform1i("hudVisibilityTexture",1);a.bindTexture(d.hudVisibilityTexture,1);a.setActiveTexture(0)}})(e=b.HUD||(b.HUD={}));var f,g,l,d,c,k,p})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces","../../../materials/internal/MaterialUtil"],function(n,b,a,m,h){function e(b){b.vertex.code.add(m.glsl(f||(f=a.__makeTemplateObject(["\n    float screenSizePerspectiveMinSize(float size, vec4 factor) {\n      float nonZeroSize \x3d 1.0 - step(size, 0.0);\n\n      return (\n        factor.z * (\n          1.0 +\n          // Multiply by nzs ensures if size is 0, then we ignore proportionally scaled padding\n          nonZeroSize *\n          2.0 * factor.w / (\n            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n          )\n        )\n      );\n    }\n  "],
["\n    float screenSizePerspectiveMinSize(float size, vec4 factor) {\n      float nonZeroSize \x3d 1.0 - step(size, 0.0);\n\n      return (\n        factor.z * (\n          1.0 +\n          // Multiply by nzs ensures if size is 0, then we ignore proportionally scaled padding\n          nonZeroSize *\n          2.0 * factor.w / (\n            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n          )\n        )\n      );\n    }\n  "]))));b.vertex.code.add(m.glsl(g||
(g=a.__makeTemplateObject(["\n    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n      return absCosAngle * absCosAngle * absCosAngle;\n    }\n  "],["\n    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n      return absCosAngle * absCosAngle * absCosAngle;\n    }\n  "]))));b.vertex.code.add(m.glsl(l||(l=a.__makeTemplateObject(["\n    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n      return vec4(\n        min(params.x / (distanceToCamera - params.y), 1.0),\n        screenSizePerspectiveViewAngleDependentFactor(absCosAngle),\n        params.z,\n        params.w\n      );\n    }\n  "],
["\n    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n      return vec4(\n        min(params.x / (distanceToCamera - params.y), 1.0),\n        screenSizePerspectiveViewAngleDependentFactor(absCosAngle),\n        params.z,\n        params.w\n      );\n    }\n  "]))));b.vertex.code.add(m.glsl(d||(d=a.__makeTemplateObject(["\n    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n    }\n  "],
["\n    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n    }\n  "]))));b.vertex.code.add(m.glsl(c||(c=a.__makeTemplateObject(["\n    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorFloat(\n        size,\n        screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)\n      );\n    }\n  "],
["\n    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorFloat(\n        size,\n        screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)\n      );\n    }\n  "]))));b.vertex.code.add(m.glsl(k||(k=a.__makeTemplateObject(["\n    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n    }\n  "],
["\n    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n    }\n  "]))));b.vertex.code.add(m.glsl(p||(p=a.__makeTemplateObject(["\n    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "],
["\n    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "]))))}Object.defineProperty(b,"__esModule",{value:!0});b.ScreenSizePerspective=e;(function(a){a.bindUniforms=function(a,c){c.screenSizePerspective&&(h.bindScreenSizePerspective(c.screenSizePerspective,a,"screenSizePerspective"),h.bindScreenSizePerspective(c.screenSizePerspectiveAlignment||
c.screenSizePerspective,a,"screenSizePerspectiveAlignment"))}})(e=b.ScreenSizePerspective||(b.ScreenSizePerspective={}));var f,g,l,d,c,k,p})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.HUDOcclusionPass=function(b){b.vertex.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) \x3e 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj \x3d projectPositionHUD(projectAux);\n      posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n\n      vec3 vpos \x3d projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n      }\n    }\n    else {\n      // Project out of clip space\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position \x3d posProjCenter;\n    gl_PointSize \x3d 1.0;\n  }\n  "],
["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) \x3e 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj \x3d projectPositionHUD(projectAux);\n      posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n\n      vec3 vpos \x3d projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n      }\n    }\n    else {\n      // Project out of clip space\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position \x3d posProjCenter;\n    gl_PointSize \x3d 1.0;\n  }\n  "]))));
b.fragment.uniforms.add("color","vec4");b.fragment.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n  void main() {\n    gl_FragColor \x3d color;\n  }\n  "],["\n  void main() {\n    gl_FragColor \x3d color;\n  }\n  "]))))};(function(a){a.bindUniforms=function(a){a.setUniform4f("color",1,1,1,1)}})(b.HUDOcclusion||(b.HUDOcclusion={}));var h,e})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],
function(n,b,a,m){function h(b){b.fragment.uniforms.add("depthTex","sampler2D");b.fragment.uniforms.add("highlightViewportPixelSz","vec4");b.fragment.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n    void outputHighlight() {\n      vec4 fragCoord \x3d gl_FragCoord;\n\n      float sceneDepth \x3d texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n      if (fragCoord.z \x3e sceneDepth + 5e-7) {\n        gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n      }\n      else {\n        gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n      }\n    }\n  "],
["\n    void outputHighlight() {\n      vec4 fragCoord \x3d gl_FragCoord;\n\n      float sceneDepth \x3d texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n      if (fragCoord.z \x3e sceneDepth + 5e-7) {\n        gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n      }\n      else {\n        gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n      }\n    }\n  "]))))}Object.defineProperty(b,"__esModule",{value:!0});b.OutputHighlight=h;(function(a){a.bindOutputHighlight=
function(a,b,d){a.bindTexture(d.highlightDepthTexture,5);b.setUniform1i("depthTex",5);b.setUniform4f("highlightViewportPixelSz",0,0,1/d.viewport[2],1/d.viewport[3])}})(h=b.OutputHighlight||(b.OutputHighlight={}));var e})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){function h(b,h){h.vvInstancingEnabled&&(h.vvSize||h.vvColor)&&b.attributes.add("instanceFeatureAttribute",
"vec4");h.vvSize?(b.vertex.uniforms.add("vvSizeMinSize","vec3"),b.vertex.uniforms.add("vvSizeMaxSize","vec3"),b.vertex.uniforms.add("vvSizeOffset","vec3"),b.vertex.uniforms.add("vvSizeFactor","vec3"),b.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),b.vertex.uniforms.add("vvSymbolAnchor","vec3"),b.vertex.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n      vec3 vvScale(vec4 _featureAttribute) {\n        return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n      }\n\n      vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\n        return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n      }\n    "],
["\n      vec3 vvScale(vec4 _featureAttribute) {\n        return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n      }\n\n      vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\n        return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n      }\n    "])))),b.vertex.code.add(m.glsl(g||(g=a.__makeTemplateObject(["\n      const float eps \x3d 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale \x3d clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ",
"\n    "],["\n      const float eps \x3d 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale \x3d clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ","\n    "])),h.vvInstancingEnabled?m.glsl(f||(f=a.__makeTemplateObject(["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"],
["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"]))):""))):b.vertex.code.add(m.glsl(l||(l=a.__makeTemplateObject(["\n      vec4 localPosition() { return vec4(position, 1.0); }\n\n      vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }\n    "],["\n      vec4 localPosition() { return vec4(position, 1.0); }\n\n      vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }\n    "]))));
h.vvColor?(b.vertex.defines.addInt("VV_COLOR_N",8),b.vertex.code.add(m.glsl(c||(c=a.__makeTemplateObject(["\n      uniform float vvColorValues[VV_COLOR_N];\n      uniform vec4 vvColorColors[VV_COLOR_N];\n\n      vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n        float value \x3d featureAttribute.y;\n        if (value \x3c\x3d values[0]) {\n          return colors[0];\n        }\n\n        for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n          if (values[i] \x3e\x3d value) {\n            float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[VV_COLOR_N - 1];\n      }\n\n      ",
"\n    "],["\n      uniform float vvColorValues[VV_COLOR_N];\n      uniform vec4 vvColorColors[VV_COLOR_N];\n\n      vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n        float value \x3d featureAttribute.y;\n        if (value \x3c\x3d values[0]) {\n          return colors[0];\n        }\n\n        for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n          if (values[i] \x3e\x3d value) {\n            float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[VV_COLOR_N - 1];\n      }\n\n      ",
"\n    "])),h.vvInstancingEnabled?m.glsl(d||(d=a.__makeTemplateObject(["\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }"],["\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }"]))):""))):b.vertex.code.add(m.glsl(k||(k=a.__makeTemplateObject(["\n      vec4 vvColor() { return vec4(1.0); }\n    "],["\n      vec4 vvColor() { return vec4(1.0); }\n    "]))))}Object.defineProperty(b,
"__esModule",{value:!0});b.VisualVariables=h;(function(a){function c(a,c){c.vvSizeEnabled&&(a.setUniform3fv("vvSizeMinSize",c.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",c.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",c.vvSizeOffset),a.setUniform3fv("vvSizeFactor",c.vvSizeFactor));c.vvColorEnabled&&(a.setUniform1fv("vvColorValues",c.vvColorValues),a.setUniform4fv("vvColorColors",c.vvColorColors))}a.bindUniforms=c;a.bindUniformsWithOpacity=function(a,d){c(a,d);d.vvOpacityEnabled&&(a.setUniform1fv("vvOpacityValues",
d.vvOpacityValues),a.setUniform1fv("vvOpacityOpacities",d.vvOpacityOpacities))};a.bindUniformsForSymbols=function(a,d){c(a,d);d.vvSizeEnabled&&(a.setUniform3fv("vvSymbolAnchor",d.vvSymbolAnchor),a.setUniformMatrix3fv("vvSymbolRotationMatrix",d.vvSymbolRotationMatrix))}})(h=b.VisualVariables||(b.VisualVariables={}));var e,f,g,l,d,c,k})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,
b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.defaultMaskAlphaCutoff=.1;b.symbolAlphaCutoff=.001;b.DiscardOrAdjustAlpha=function(b,d){var c=b.fragment;switch(d.alphaDiscardMode){case 0:c.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n        void discardOrAdjustAlpha(inout vec4 color) {}\n      "],["\n        void discardOrAdjustAlpha(inout vec4 color) {}\n      "]))));break;case 1:c.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n        void discardOrAdjustAlpha(inout vec4 color) {\n          color.a \x3d 1.0;\n        }\n      "],
["\n        void discardOrAdjustAlpha(inout vec4 color) {\n          color.a \x3d 1.0;\n        }\n      "]))));break;case 2:c.uniforms.add("textureAlphaCutoff","float");c.code.add(m.glsl(f||(f=a.__makeTemplateObject(["\n        #define discardOrAdjustAlpha(color) { if (color.a \x3c textureAlphaCutoff) { discard; } else { color.a \x3d 1.0; } }\n      "],["\n        #define discardOrAdjustAlpha(color) { if (color.a \x3c textureAlphaCutoff) { discard; } else { color.a \x3d 1.0; } }\n      "]))));break;
case 3:b.fragment.uniforms.add("textureAlphaCutoff","float"),b.fragment.code.add(m.glsl(g||(g=a.__makeTemplateObject(["\n        #define discardOrAdjustAlpha(color) { if (color.a \x3c textureAlphaCutoff) { discard; } }\n      "],["\n        #define discardOrAdjustAlpha(color) { if (color.a \x3c textureAlphaCutoff) { discard; } }\n      "]))))}};var h,e,f,g})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderLibrary/hud/HUDOcclusionPass.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/Camera.glsl ../core/shaderLibrary/util/ScreenSizePerspective.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ./HUDMaterial.glsl ./HUDMaterial.glsl ../../../webgl/Program ../../../webgl/renderState ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y){Object.defineProperty(b,"__esModule",{value:!0});r=function(b){function r(){return null!==b&&b.apply(this,arguments)||this}a.__extends(r,b);r.prototype.initializeProgram=function(a){var c=r.shader.get(),d=this.configuration,c=c.build({output:d.output,viewingMode:a.viewingMode,occlusionTestEnabled:d.occlusionTestEnabled,signedDistanceFieldEnabled:d.sdf,slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,
debugDrawBorder:d.debugDrawBorder,binaryHighlightOcclusionEnabled:d.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:d.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:d.screenSizePerspective,verticalOffsetEnabled:d.verticalOffset,vvSize:d.vvSize,vvColor:d.vvColor,vvInstancingEnabled:!1});return new w(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),u.Default3D)};r.prototype.bindPass=function(a,b,h){this.program.setUniform1f("cameraGroundRelative",h.cameraAboveGround?
1:-1);this.program.setUniform1f("perDistancePixelRatio",Math.tan(h.fovY/2)/(h.viewport[2]/2));this.program.setUniformMatrix4fv("viewNormal",h.viewInvTransp);this.program.setUniform1f("polygonOffset",b.shaderPolygonOffset);e.VerticalOffset.bindUniforms(this.program,b,h);k.ScreenSizePerspective.bindUniforms(this.program,b);c.Viewport.bindUniforms(this.program,h);6===this.configuration.output?g.HUDOcclusion.bindUniforms(this.program):(f.HUD.bindUniforms(this.program,h),z.HUDMaterial.bindUniforms(this.program,
b,h),d.VisualVariables.bindUniforms(this.program,b),this.configuration.occlusionTestEnabled&&f.HUD.bindVisibilityTexture(a,this.program,h));4===this.configuration.output&&l.OutputHighlight.bindOutputHighlight(a,this.program,h)};r.prototype.bindDraw=function(a){h.Transform.bindUniforms(this.program,a);c.Camera.bindUniforms(this.program,a);m.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};r.prototype.initializePipeline=function(){return 4===this.configuration.output?y.makePipelineState({blending:q.separateBlendingParams(1,
1,771,771),polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:513},colorWrite:y.defaultColorWriteParams}):6===this.configuration.output?y.makePipelineState({depthTest:{func:515},depthWrite:y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams}):y.makePipelineState({blending:q.simpleBlendingParams(1,771),polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:this.configuration.depthEnabled?515:519},depthWrite:this.configuration.depthEnabled?
y.defaultDepthWriteParams:void 0,colorWrite:y.defaultColorWriteParams})};Object.defineProperty(r.prototype,"primitiveType",{get:function(){return 6===this.configuration.output?0:4},enumerable:!0,configurable:!0});r.shader=new p.ReloadableShaderModule(v,function(){return new Promise(function(a,c){n(["./HUDMaterial.glsl"],a,c)})});return r}(r.ShaderTechnique);b.HUDMaterialTechnique=r;r=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;a.output=0;a.occlusionTestEnabled=!0;a.sdf=
!1;a.vvSize=!1;a.vvColor=!1;a.verticalOffset=!1;a.screenSizePerspective=!1;a.screenCenterOffsetUnitsEnabled=0;a.debugDrawBorder=!0;a.binaryHighlightOcclusion=!0;a.slicePlaneEnabled=!1;a.polygonOffsetEnabled=!1;a.depthEnabled=!0;return a}a.__extends(d,c);a.__decorate([t.parameter({count:7})],d.prototype,"output",void 0);a.__decorate([t.parameter()],d.prototype,"occlusionTestEnabled",void 0);a.__decorate([t.parameter()],d.prototype,"sdf",void 0);a.__decorate([t.parameter()],d.prototype,"vvSize",void 0);
a.__decorate([t.parameter()],d.prototype,"vvColor",void 0);a.__decorate([t.parameter()],d.prototype,"verticalOffset",void 0);a.__decorate([t.parameter()],d.prototype,"screenSizePerspective",void 0);a.__decorate([t.parameter({count:2})],d.prototype,"screenCenterOffsetUnitsEnabled",void 0);a.__decorate([t.parameter()],d.prototype,"debugDrawBorder",void 0);a.__decorate([t.parameter()],d.prototype,"binaryHighlightOcclusion",void 0);a.__decorate([t.parameter()],d.prototype,"slicePlaneEnabled",void 0);
a.__decorate([t.parameter()],d.prototype,"polygonOffsetEnabled",void 0);a.__decorate([t.parameter()],d.prototype,"depthEnabled",void 0);return d}(t.ShaderTechniqueConfiguration);b.HUDMaterialTechniqueConfiguration=r})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define(["require","exports","tslib","../util/ScreenSizePerspective.glsl","../../shaderModules/interfaces"],function(n,b,a,m,h){function e(b,e){var f=b.vertex.code;e.verticalOffsetEnabled?(b.vertex.uniforms.add("verticalOffset",
"vec4"),e.screenSizePerspectiveEnabled&&(b.include(m.ScreenSizePerspective),b.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),f.add(h.glsl(p||(p=a.__makeTemplateObject(["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance \x3d length((view * vec4(worldPos, 1.0)).xyz);\n      ","\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "],
["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance \x3d length((view * vec4(worldPos, 1.0)).xyz);\n      ","\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "])),
0===e.viewingMode?h.glsl(l||(l=a.__makeTemplateObject(["vec3 worldNormal \x3d normalize(worldPos + localOrigin);"],["vec3 worldNormal \x3d normalize(worldPos + localOrigin);"]))):h.glsl(d||(d=a.__makeTemplateObject(["vec3 worldNormal \x3d vec3(0.0, 0.0, 1.0);"],["vec3 worldNormal \x3d vec3(0.0, 0.0, 1.0);"]))),e.screenSizePerspectiveEnabled?h.glsl(c||(c=a.__makeTemplateObject(["\n          float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"],
["\n          float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"]))):h.glsl(k||(k=a.__makeTemplateObject(["\n          float verticalOffsetScreenHeight \x3d verticalOffset.x;"],["\n          float verticalOffsetScreenHeight \x3d verticalOffset.x;"])))))):f.add(h.glsl(r||(r=a.__makeTemplateObject(["\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }\n    "],
["\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }\n    "]))))}function f(a,c,d,b){void 0===b&&(b=g);b.screenLength=a.screenLength;b.perDistance=Math.tan(.5*c)/(.5*d);b.minWorldLength=a.minWorldLength;b.maxWorldLength=a.maxWorldLength;return b}Object.defineProperty(b,"__esModule",{value:!0});b.VerticalOffset=e;(function(a){a.bindUniforms=function(a,c,d){c.verticalOffset&&(c=f(c.verticalOffset,d.fovY,d.viewport[3]),a.setUniform4f("verticalOffset",c.screenLength*(d.pixelRatio||
1),c.perDistance,c.minWorldLength,c.maxWorldLength))}})(e=b.VerticalOffset||(b.VerticalOffset={}));b.calculateVerticalOffsetFactors=f;var g={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0},l,d,c,k,p,r})},"esri/views/3d/layers/graphics/LabelDeconflictor":function(){define(["require","exports","tslib","../../../../core/accessorSupport/decorators","./Deconflictor"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(){var a=null!==b&&b.apply(this,
arguments)||this;a.visibilityGroup=1;a.iconMarginFactor=0;a._lastDeconfliction=0;return a}a.__extends(e,b);Object.defineProperty(e.prototype,"viewState",{get:function(){return this.parent.viewState},enumerable:!0,configurable:!0});e.prototype.update=function(a){if(!this.parent.needsUpdate()){var e=performance.now();if(2===a.state||2E3<e-this._lastDeconfliction)b.prototype.update.call(this,a),0===this.state&&(this._lastDeconfliction=e)}};e.prototype.enabledChanged=function(a,b){this.modifyGraphics(b,
a.labelsEnabled)};e.prototype.getGraphicsLayers=function(a){return a.labelGraphics};a.__decorate([m.property({constructOnly:!0})],e.prototype,"parent",void 0);return e=a.__decorate([m.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],e)}(h.Deconflictor);b.LabelDeconflictor=n})},"esri/views/3d/layers/graphics/Labeler":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../layers/graphics/dehydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../layers/support/layerUtils ../../../../symbols/callouts/calloutUtils ./Graphics3DCalloutSymbolLayerFactory ./graphicSymbolUtils ./labelPlacement ../../support/debugFlags ../../webgl-engine/lib/Layer ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../../support/Scheduler".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F){Object.defineProperty(b,"__esModule",{value:!0});var H=f.getLogger("esri.views.3d.layers.graphics.Labeler");n=function(b){function f(){var a=null!==b&&b.apply(this,arguments)||this;a.idHint="__labeler";a._dirty=!1;a.labels=new Map;a.labelsToAdd=new Map;a.labelsToRemove=new Map;a.labelingContexts=[];return a}a.__extends(f,b);f.prototype.setup=function(){var a=this;this.handles||(this.handles=new e,this.handles.add([this.view.watch("state.camera",
function(){return a.setDirty()}),this.view.watch("pixelRatio",function(){return a.resetAllLabels()})]));this.textTextureAtlas||(this.textTextureAtlas=new C.default({idHint:this.idHint+"_atlas",view:this.view}),this.hudMaterialCollection=new y(this.view._stage),this.calloutMaterialCollection=new y(this.view._stage));this.handles.add(this.view.resourceController.scheduler.registerTask(F.Task.LABELER,function(c){return a.update(c)},function(){return a.needsUpdate()}))};f.prototype.dispose=function(){this.handles&&
(this.handles.destroy(),this.handles=null);this.textTextureAtlas&&(this.textTextureAtlas.dispose(),this.textTextureAtlas=null);this.hudMaterialCollection&&(this.hudMaterialCollection.dispose(),this.hudMaterialCollection=null);this.calloutMaterialCollection&&(this.calloutMaterialCollection.dispose(),this.calloutMaterialCollection=null);this.labelingContexts=[];this.labels.clear();this.labelsToAdd.clear();this.labelsToRemove.clear()};f.prototype.isActiveLabelingContext=function(a){return a.active&&
r.areLabelsVisible(a.layer)};f.prototype.activateLabelingContext=function(a){var c=this;a.labels.forEach(function(a,d){c.labels.set(d,a);a.graphics3DGraphic.setVisibilityFlag(0,!0,1)});a.active=!0};f.prototype.deactivateLabelingContext=function(a){var c=this;a.labels.forEach(function(a,d){a.graphics3DGraphic.setVisibilityFlag(0,!1,1);c.setLabelGraphicVisibility(a.graphics3DGraphic,!1);c.labels.delete(d)});a.active=!1};f.prototype.addLabelTextureToAtlas=function(a){for(var c=0,d=a.graphics3DGraphic.labelGraphics;c<
d.length;c++){var b=d[c];if(b._labelClass){var e=a.textRenderers[b._labelIndex];e&&this.textTextureAtlas.addTextTexture(e,b.stageObject)}}a.rendered=!0};f.prototype.removeLabelTextureFromAtlas=function(a){for(var c=0,d=a.graphics3DGraphic.labelGraphics;c<d.length;c++){var b=d[c];if(b._labelClass){var e=a.textRenderers[b._labelIndex];e&&this.textTextureAtlas.removeTextTexture(e,b.stageObject)}}a.rendered=!1};f.prototype.needsUpdate=function(){return this.view.ready&&this.isDirty};f.prototype.update=
function(a){this._updateLabels(a);!this._dirty&&this.deconflictor.needsUpdate()&&this.deconflictor.update(a)};f.prototype._updateLabels=function(a){var c=this;if(this._dirty){this._dirty=!1;for(var d=function(d){if(!b.isActiveLabelingContext(d))return"continue";if(!b.hasValidLabelClassContext(d)){if(b.hasInvalidLabelClassContext(d))return b.deactivateLabelingContext(d),"continue";b.createLabelClassContext(d);if(b.hasPendingLabelClassContext(d))return b._dirty=!0,"continue";if(!b.hasValidLabelClassContext(d))return"continue"}g.someMap(d.labelsToInitialize,
function(b,e){c.ensureGraphics3DResources(b)&&(c.labels.set(e,b),c.deconflictor.setDirty(),a.madeProgress());if(b.visible&&b.hasTextTextureResources||!b.visible&&b.hasGraphics3DResources)d.labelsToInitialize.delete(e),a.madeProgress();return a.done})&&(b._dirty=!0)},b=this,e=0,f=this.labelingContexts;e<f.length;e++)d(f[e]);this.labelsToRemove.forEach(function(a){return c.removeLabelTextureFromAtlas(a)});this.labelsToRemove.clear();this.labelsToAdd.forEach(function(a){return c.addLabelTextureToAtlas(a)});
this.labelsToAdd.clear();this._dirty||this.notifyChange("updating")}};f.prototype.hasPendingLabelClassContext=function(a){return a.labelClassPromise&&!!a.labelClassAbortController};f.prototype.hasValidLabelClassContext=function(a){return a.labelClassContexts&&a.labelClassContexts.length};f.prototype.hasInvalidLabelClassContext=function(a){return null===a.labelClassContexts};f.prototype.createLabelClassContextAsync=function(c){return a.__awaiter(this,void 0,void 0,function(){var b,e,f,g,k,q,m=this;
return a.__generator(this,function(r){switch(r.label){case 0:return b=c.labelClassAbortController.signal,[4,c.layer.when()];case 1:r.sent();d.throwIfAborted(b);c.scaleVisibility&&c.scaleVisibility.updateScaleRangeActive();e=c.graphics3DCore;f=e.layer;g=f.labelingInfo&&f.labelingInfo.filter(function(a){return!!a.symbol});if(!g||0===g.length)return[2];k=Array(g.length);q=!1;return[4,h.forEach(g,function(f,g){return a.__awaiter(m,void 0,void 0,function(){var m,r,y,A;return a.__generator(this,function(a){switch(a.label){case 0:return m=
f.symbol,r=v.getGraphics3DSymbol(e.getOrCreateGraphics3DSymbol(m)),l.isNone(r)?(H.error("Failed to create Graphics3DSymbol for label"),[2]):[4,r.load()];case 1:a.sent();d.throwIfAborted(b);y=null;if(!t.isCalloutSupport(m)||!m.hasVisibleCallout())return[3,3];y=u.make(m,e.symbolCreationContext);return[4,y.load()];case 2:a.sent(),d.throwIfAborted(b),a.label=3;case 3:return[4,h.result(p.createLabelFunction(f,c.layer.fields.map(function(a){return a.toJSON()}),this.view.spatialReference))];case 4:return A=
a.sent(),d.throwIfAborted(b),!0===A.ok?k[g]={labelClass:f,labelFunction:A.value,graphics3DSymbol:r,graphics3DCalloutSymbolLayer:y,calloutSymbolLayerIndex:0,textRenderParameters:this.createTextRenderParameters(r.symbol)}:(H.error("Label expression failed to evaluate: "+A.error),q=!0),[2]}})})})];case 2:r.sent();d.throwIfAborted(b);if(q)return[2];c.labelClassContexts=k;return[2]}})})};f.prototype.createLabelClassContext=function(c){return a.__awaiter(this,void 0,void 0,function(){var b=this;return a.__generator(this,
function(a){c.labelClassPromise||(c.labelClassPromise=this.createLabelClassContextAsync(c).catch(function(a){if(d.isAbortError(a))throw a;c.labelClassContexts=null}).then(function(){c.labelClassAbortController=null;b.notifyChange("updating")}).catch(function(){}),this.notifyChange("updating"));return[2,c.labelClassPromise]})})};f.prototype.createTextRenderParameters=function(a){return(a=a.symbolLayers.getItemAt(0))&&"text"===a.type?B.default.fromSymbol(a,this.view.pixelRatio):null};f.prototype.destroyLabelClassContext=
function(a){for(var c=0,b=a.labelClassContexts;c<b.length;c++){var e=b[c];--e.graphics3DSymbol.referenced;e.graphics3DSymbol=null}c=a.labelClassAbortController;a.labelClassAbortController=d.createAbortController();c&&c.abort();a.labelClassContexts=[];a.labelClassPromise=null;this.notifyChange("updating")};f.prototype.createTextSymbolGraphic=function(a,c,d,b,e){a={text:a.text,centerOffset:d.centerOffset,translation:d.translation,elevationOffset:d.elevationOffset,screenOffset:d.screenOffset,anchor:d.anchor,
centerOffsetUnits:d.centerOffsetUnits,verticalOffset:d.verticalOffset,debugDrawBorder:w.LABELS_SHOW_BORDER,displayWidth:a.displayWidth,displayHeight:a.displayHeight};I.graphic=c;I.renderingInfo=null;I.layer=b;return e.createLabel(I,a,this.hudMaterialCollection,this.textTextureAtlas)};f.prototype.createLineCalloutGraphic=function(a,c,d,b,e){c={symbol:c,translation:b.translation,elevationOffset:b.elevationOffset,screenOffset:b.screenOffset,centerOffset:b.centerOffset,centerOffsetUnits:b.centerOffsetUnits,
materialCollection:this.calloutMaterialCollection};I.graphic=a;I.renderingInfo=c;I.layer=e;return d.createGraphics3DGraphic(I)};f.prototype.ensureGraphics3DResources=function(a){if(a.hasGraphics3DResources)return!1;var c=a.graphics3DGraphic;if(c.destroyed)return!1;this.ensureTextTextureResources(a);var d=a.labelingContext,b=d.labelClassContexts;if(!b||0===b.length||!d.emptySymbolLabelSupported&&0===c._graphics.length)return!1;for(var e=!1,f=c.graphic,g=d.layer,k=r.areLabelsVisible(d.layer),h=this.view._stage,
p=0;p<b.length;p++){var q=a.textRenderers[p];if(q){var m=b[p],t=m.graphics3DSymbol,u=null;t.symbol&&"label-3d"===t.symbol.type&&(u=t.symbol);var y=t.symbolLayers[0];if(y){var A=m.labelClass,t=z.get({graphics3DGraphic:c,labelSymbol:u,labelClass:A,disablePlacement:d.disablePlacement});if(!l.isNone(t)){y.setElevationInfoOverride(d.elevationInfoOverride);e=this.createTextSymbolGraphic(q,f,t,g,y);if(!e)return!1;e._labelClass=A;e._labelIndex=p;c.addLabelGraphic(e,h,d.stageLayer);c.setVisibilityFlag(0,k,
1);c.clearVisibilityFlag(1,1);c.setVisibilityFlag(3,!1,1);e=!0;(k=m.graphics3DCalloutSymbolLayer)&&t.hasLabelVerticalOffset&&(k.setElevationInfoOverride(d.elevationInfoOverride),f=this.createLineCalloutGraphic(f,u,k,t,g))&&(m.calloutSymbolLayerIndex=c.labelGraphics.length,c.addLabelGraphic(f,h,d.stageLayer));break}}}}d.scaleVisibility&&e&&d.scaleVisibility.updateGraphicLabelScaleVisibility(c);return a.hasGraphics3DResources=!0};f.prototype.destroyGraphics3DResources=function(a){for(var c=a.labelingContext.labelClassContexts,
d=0,b=a.graphics3DGraphic.labelGraphics;d<b.length;d++){var e=b[d];if(null!=e._labelClass){var f=c[e._labelIndex].graphics3DSymbol.symbolLayers[0];if(null!=f)f.onRemoveGraphic(e)}}a.graphics3DGraphic.clearLabelGraphics();a.hasGraphics3DResources=!1};f.prototype.ensureTextTextureResources=function(a){if(!a.hasTextTextureResources){var c=a.labelingContext,d=c.labelClassContexts;if(d&&0!==d.length){for(var b=a.graphics3DGraphic.graphic,e=0;e<d.length;e++){var f=d[e];a.textRenderers[e]=null;if(f.textRenderParameters){var g=
f.labelFunction,h=void 0;if("arcade"===g.type)try{var p=g.needsHydrationToEvaluate()?k.hydrateGraphic(b,c.layer):b,h=g.evaluate(p)}catch(P){h=null}else h=g.evaluate(b);l.isNone(h)||""===h||/^\s+$/.test(h)||(a.textRenderers[e]=new A.default(h,f.textRenderParameters))}}a.hasTextTextureResources=!0}}};f.prototype.destroyTextTextureResources=function(a){a.textRenderers=[];a.hasTextTextureResources=!1};f.prototype.addGraphic=function(a,c){var d={hasGraphics3DResources:!1,hasTextTextureResources:!1,visible:!1,
rendered:!1,labelingContext:a,graphics3DGraphic:c,textRenderers:[]};c=c.graphic.uid;a.labels.set(c,d);a.labelsToInitialize.set(c,d);this.setDirty();this.deconflictor.setDirty()};f.prototype.removeGraphic=function(a,c){c=c.graphic.uid;var d=a.labels.get(c);d&&(this.destroyGraphic(d,c),a.labels.delete(c),a.labelsToInitialize.delete(c),this.setDirty(),this.deconflictor.setDirty())};f.prototype.destroyGraphic=function(a,c){this.labels.has(c)&&(this.labels.delete(c),this.labelsToAdd.delete(c),this.labelsToRemove.delete(c));
a.hasTextTextureResources&&(this.removeLabelTextureFromAtlas(a),this.destroyTextTextureResources(a));a.hasGraphics3DResources&&this.destroyGraphics3DResources(a)};f.prototype.labelingInfoChange=function(c,d){return a.__awaiter(this,void 0,void 0,function(){var b,e,f,g;return a.__generator(this,function(a){if(d){b=0;for(e=d;b<e.length;b++)if(f=e[b],g=c.labels.get(f))this.removeGraphic(c,g.graphics3DGraphic),this.addGraphic(c,g.graphics3DGraphic);return[2]}this.visibilityInfoChange(c);this.resetLabels(c);
return[2,this.createLabelClassContext(c)]})})};f.prototype.globalPropertyChanged=function(a,c){for(var d=function(d){var b=new Map;c.labels.forEach(function(a){a=a.graphics3DGraphic;b.set(a.graphic.uid,a)});l.unwrap(d.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(a,b,function(a){return a.labelGraphics[0]});d.graphics3DCalloutSymbolLayer&&d.graphics3DCalloutSymbolLayer.globalPropertyChanged(a,b,function(a){return a.labelGraphics[d.calloutSymbolLayerIndex]})},b=0,e=c.labelClassContexts;b<
e.length;b++)d(e[b])};f.prototype.visibilityInfoChange=function(a){var c=a.layer.labelsVisible;c&&!a.active&&this.activateLabelingContext(a);!c&&a.active&&this.deactivateLabelingContext(a);this.setDirty()};f.prototype.resetAllLabels=function(){for(var a=0,c=this.labelingContexts;a<c.length;a++)this.resetLabels(c[a])};f.prototype.resetLabels=function(a){var c=this;a.labels.forEach(function(d,b){c.destroyGraphic(d,b);d.visible=!1;d.rendered=!1;a.labelsToInitialize.set(b,d)});this.destroyLabelClassContext(a);
this.setDirty();this.deconflictor.setDirty()};f.prototype.findLabelingContext=function(a){for(var c=0,d=this.labelingContexts;c<d.length;c++){var b=d[c];if(b.graphics3DCore===a)return b}return null};f.prototype.addGraphicsOwner=function(a,c,b){var e=this,f=b&&b.emptySymbolLabelSupported||!1,g=b&&b.elevationInfoOverride||null;b=b&&b.disablePlacement||null;if(!this.findLabelingContext(a)){var k=a.layer,l={graphics3DCore:a,layer:k,scaleVisibility:c,emptySymbolLabelSupported:f,elevationInfoOverride:g,
disablePlacement:b,active:k.labelsVisible,labelClassPromise:null,labelClassAbortController:d.createAbortController(),labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new q(this.idHint+"_"+k.uid,{isPickable:!0},k.uid)};this.view._stage.add(0,l.stageLayer);this.view._stage.addToViewContent([l.stageLayer.id]);this.labelingContexts.push(l);this.setDirty();return{addGraphic:function(a){return e.addGraphic(l,a)},removeGraphic:function(a){return e.removeGraphic(l,a)},featureReductionChange:function(){},
layerLabelsEnabled:function(){return r.areLabelsVisible(l.layer)},labelingInfoChange:function(a){return e.labelingInfoChange(l,a)},elevationInfoChange:function(){return e.globalPropertyChanged("elevationInfo",l)},slicePlaneEnabledChange:function(){return e.globalPropertyChanged("slicePlaneEnabled",l)},visibilityInfoChange:function(){return e.visibilityInfoChange(l)},reset:function(){return e.resetLabels(l)},clear:function(){},processStageDirty:function(){return e.view._stage.processDirtyLayer(l.stageLayer.id)}}}};
f.prototype.removeGraphicsOwner=function(a){var c=this,d=this.findLabelingContext(a);d&&(a=this.labelingContexts.indexOf(d),this.labelingContexts.splice(a,1),d.labels.forEach(function(a){return c.removeGraphic(d,a.graphics3DGraphic)}),a=d.stageLayer.id,this.view._stage.removeFromViewContent([a]),this.view._stage.remove(0,a),d.stageLayer=null,this.setDirty())};f.prototype.setLabelGraphicVisibility=function(a,c){a=a.graphic.uid;var d=this.labels.get(a);d&&d.visible!==c&&(c&&!d.rendered?(this.labelsToAdd.set(a,
d),this.labelsToRemove.delete(a),d.hasTextTextureResources||d.labelingContext.labelsToInitialize.set(a,d)):!c&&d.rendered&&(this.labelsToRemove.set(a,d),this.labelsToAdd.delete(a)),d.visible=c,this.setDirty())};Object.defineProperty(f.prototype,"isDirty",{get:function(){return this._dirty||this.textTextureAtlas&&this.textTextureAtlas.isDirty||this.deconflictor.needsUpdate()},enumerable:!0,configurable:!0});f.prototype.setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};
Object.defineProperty(f.prototype,"updating",{get:function(){var a=this;return this._dirty||this.textTextureAtlas&&this.textTextureAtlas.updating||this.deconflictor.updating||this.labelingContexts.some(function(c){return a.hasPendingLabelClassContext(c)})},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"updatingProgress",{get:function(){var a=this;if(!this.updating||!this.textTextureAtlas)return 1;var c=0<this.labelingContexts.length?this.labelingContexts.reduce(function(c,d){return c+
(a.hasPendingLabelClassContext(d)?0:1)},0)/this.labelingContexts.length:1;return(this._dirty?0:.3)+(this.textTextureAtlas.updating?0:.1)+.1*c+.5*this.deconflictor.updatingProgress},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"test",{get:function(){var a=this;return{textTextureAtlas:this.textTextureAtlas,resetAllLabels:function(){return a.resetAllLabels()}}},enumerable:!0,configurable:!0});a.__decorate([c.property({constructOnly:!0})],f.prototype,"view",void 0);a.__decorate([c.property({constructOnly:!0})],
f.prototype,"deconflictor",void 0);a.__decorate([c.property()],f.prototype,"textTextureAtlas",void 0);a.__decorate([c.property({type:Boolean,readOnly:!0,dependsOn:["textTextureAtlas.updating","deconflictor.updating"]})],f.prototype,"updating",null);return f=a.__decorate([c.subclass("esri.views.3d.layers.graphics.Labeler")],f)}(m);b.Labeler=n;var I={graphic:null,renderingInfo:null,layer:null}})},"esri/layers/support/labelFormatUtils":function(){define("require exports tslib ../../core/Error ../../core/Logger ../../intl/date ../../intl/number ./FieldsIndex ./fieldUtils ./labelUtils ../../support/arcadeOnDemand @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c){function k(a,c,d,b){a=l.getField(b,a);if(!a)return c;if(null==d[a.name])return"";if(c=a.domain)if("codedValue"===c.type||"coded-value"===c.type){b=d[a.name];var g=0;for(c=c.codedValues;g<c.length;g++){var k=c[g];if(k.code===b)return k.name}}else if("range"===c.type&&(b=+d[a.name],g="range"in c?c.range[1]:c.maxValue,("range"in c?c.range[0]:c.minValue)<=b&&b<=g))return c.name;d=d[a.name];"date"===a.type||"esriFieldTypeDate"===a.type?d=e.formatDate(d,e.convertDateFormatToIntlOptions("short-date")):
l.isNumericField(a)&&(d=f.formatNumber(+d));return d?d:""}Object.defineProperty(b,"__esModule",{value:!0});var p=h.getLogger("esri.layers.support.labelFormatUtils"),r={type:"simple",evaluate:function(){return null}};b.createLabelFunction=function(b,e,f){return a.__awaiter(this,void 0,void 0,function(){var l,h,q,t,u,v,C,F;return a.__generator(this,function(a){switch(a.label){case 0:if(!b||!b.symbol)return[2,r];l=b.where;h=b.getLabelExpression();return l?[4,new Promise(function(a,c){n(["../../core/sql/WhereClause"],
a,c)})]:[3,2];case 1:return t=a.sent(),[3,3];case 2:t=null,a.label=3;case 3:return q=t,"arcade"!==h.type?[3,5]:[4,c.createLabelExpression(h.expression,f,e)];case 4:return v=a.sent(),u={type:"arcade",evaluate:function(a){try{var c=v.evaluate({$feature:v.repurposeFeature(a)});if(null!=c)return c.toString()}catch(J){p.error(new m("bad-arcade-expression","Encountered an error when evaluating label expression for feature",{feature:a,expression:h}))}return null},needsHydrationToEvaluate:function(){return null==
d.getSingleFieldArcadeExpression(h.expression)}},[3,6];case 5:u={type:"simple",evaluate:function(a){var c=a&&a.attributes;return c?h.expression.replace(/{[^}]*}/g,function(a){return k(a.slice(1,-1),a,c,e)}):null}},a.label=6;case 6:if(l){try{C=q.WhereClause.create(l,new g(e))}catch(I){return[2,r]}F=u.evaluate;u.evaluate=function(a){return C.testFeature(a)?F(a):null}}return[2,u]}})})};b.formatField=k})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["require",
"exports","../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});var e=a.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");b.make=function(a,b){if(!m.isCalloutSupport(a))return e.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+a.type+"' does not support callouts"),null;if(!a.callout)return null;var d=f[a.callout.type];return d?new d(a,
b):(e.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+a.callout.type),null)};var f={line:h.default}})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("require exports tslib ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./symbolComplexity ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z){var w,q;Object.defineProperty(b,"__esModule",{value:!0});var y=v.VertexAttrConstants;n=function(c){function b(a,d){a=c.call(this,a,null,d,F)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};a.ensureDrapedStatus(!1);return a}a.__extends(b,c);b.prototype.doLoad=function(){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){this._material=new z(this.materialParameters,this._getIdHint("_lineCallout_common"));
this._context.stage.add(3,this._material);return[2]})})};b.prototype.destroy=function(){c.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,this._material.id),this._material=null)};b.prototype.perInstanceMaterialParameters=function(a){var c=this.materialParameters;c.screenOffset=a.screenOffset||[0,0];c.centerOffsetUnits=a.centerOffsetUnits||"world";return c};Object.defineProperty(b.prototype,"materialParameters",{get:function(){var a=this.symbol,c=a.callout,d=h.isSome(c.color)?
m.toUnitRGBA(c.color):[0,0,0,0];d[3]*=this._getLayerOpacity();var b=e.pt2px(c.size||0),f=null;if(a.verticalOffset)var f=a.verticalOffset,g=f.minWorldLength,k=f.maxWorldLength,f={screenLength:e.pt2px(f.screenLength),minWorldLength:g||0,maxWorldLength:null!=k?k:Infinity};c=h.isSome(c.border)&&h.isSome(c.border.color)?m.toUnitRGBA(c.border.color):null;g="object"===a.symbolLayers.getItemAt(0).type;return{color:d,size:b,verticalOffset:f,screenSizePerspective:this._context.screenSizePerspectiveEnabled?
this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:c,occlusionTest:!g,shaderPolygonOffset:g?0:void 0,depthHUDAlignStart:"label-3d"===a.type,slicePlaneEnabled:this._context.slicePlaneEnabled}},enumerable:!0,configurable:!0});b.prototype._defaultElevationInfoNoZ=function(){return C};b.prototype.createGraphics3DGraphic=function(a){var c=a.renderingInfo;a=a.graphic;var d=this.setGraphicElevationContext(a,new l.ElevationContext,c.elevationOffset||
0),b=c.symbol,e="on-the-ground"===this._elevationContext.mode&&("cim"===b.type||!b.symbolLayers.some(function(a){return"object"===a.type||"text"===a.type}));if("label-3d"!==b.type&&e)return null;b=k.computeCentroid(a.geometry);return h.isNone(b)?null:this._createAs3DShape(b,d,c,"graphic"+a.uid,a.uid)};b.prototype.layerOpacityChanged=function(){this._material.setParameterValues(this.materialParameters);return!0};b.prototype.layerElevationInfoChanged=function(a,c,d){var e=this;d=g.elevationModeChangeUpdateType(b.elevationModeChangeTypes,
d,this._elevationContext.mode);if(d!==g.SymbolUpdateType.UPDATE)return d;a.forEach(function(a){var d=c(a);h.isSome(d)&&e.updateGraphicElevationContext(a.graphic,d)});return d};b.prototype.slicePlaneEnabledChanged=function(){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};b.prototype.physicalBasedRenderingChanged=function(){return!0};b.prototype.pixelRatioChanged=function(){return!0};b.prototype.setGraphicElevationContext=function(a,d,b){void 0===b&&
(b=0);a=c.prototype.setGraphicElevationContext.call(this,a,d);a.addOffsetRenderUnits(b);return a};b.prototype.updateGraphicElevationContext=function(a,c){this.setGraphicElevationContext(a,c.elevationContext,c.metadata.elevationOffset);c.needsElevationUpdates=g.needsElevationUpdates2D(c.elevationContext.mode)};b.prototype.updateGeometry=function(a,c){return!1};b.prototype.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,estimated:!1,memory:r.emptySymbolComplexity.memory}};
b.prototype.createVertexData=function(a){var c,d=a.translation;a=a.centerOffset;if(!d&&!a)return A;d=d?{size:3,data:[d[0],d[1],d[2]]}:A[y.POSITION];a=a?{size:4,data:[a[0],a[1],a[2],a[3]]}:A[y.AUXPOS1];return c={},c[y.POSITION]=d,c[y.NORMAL]=A[y.NORMAL],c[y.AUXPOS1]=a,c};b.prototype.getOrCreateMaterial=function(a,c){var d=this.perInstanceMaterialParameters(a),b=z.uniqueMaterialIdentifier(d);if(b===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(a.materialCollection){var e=
a.materialCollection.getMaterial(b);e||(e=new z(d,c+"_lineCallout_shared"),a.materialCollection.addMaterial(b,e));return{material:e,isUnique:!1}}e=new z(d,c+"_lineCallout_unique");return{material:e,isUnique:!0}};b.prototype._createAs3DShape=function(a,c,b,e,k){var l=new u.GeometryData(this.createVertexData(b),B,"point"),l=[new t(l,e)],h=this.getOrCreateMaterial(b,e);e=p.createStageObjectForHUD(this._context,a,l,[h.material],null,null,c,e,this._context.layer.uid,k);if(null===e)return null;k=new d(this,
e.object,l,h.isUnique?[h.material]:null,null,f.perObjectElevationAligner,c);k.metadata={elevationOffset:b.elevationOffset||0};k.alignedSampledElevation=e.sampledElevation;k.needsElevationUpdates=g.needsElevationUpdates2D(c.mode);p.extendPointGraphicElevationContext(k,a,this._context.elevationProvider);return k};b.elevationModeChangeTypes={definedChanged:g.SymbolUpdateType.UPDATE,staysOnTheGround:g.SymbolUpdateType.UPDATE,onTheGroundChanged:g.SymbolUpdateType.RECREATE};return b}(c.Graphics3DSymbolLayer);
b.Graphics3DLineCalloutSymbolLayer=n;var A=(w={},w[y.POSITION]={size:3,data:[0,0,0]},w[y.NORMAL]={size:3,data:[0,0,1]},w[y.AUXPOS1]={size:4,data:[0,0,0,1]},w);w=new Uint32Array([0]);var B=(q={},q[y.POSITION]=w,q[y.NORMAL]=w,q[y.AUXPOS1]=w,q),C={mode:"relative-to-ground",offset:0},F={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};b.default=n})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ./elevationAlignmentUtils ./graphicUtils ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k){Object.defineProperty(b,"__esModule",{value:!0});var p=k.VertexAttrConstants;b.perVertexElevationAligner=function(a,c,e,f){a=a.stageObject;t.spatialReference=e.spatialReference;for(var k=a.geometryRecords,l=k.length,h="absolute-height"!==c.mode,q=0,m=0;m<l;m++){var r=k[m].geometry,A=k[m].getShaderTransformation();v[0]=A[12];v[1]=A[13];v[2]=A[14];r.invalidateBoundingInfo();for(var A=r.data.getVertexAttr(),w=A[p.POSITION],r=w.data,A=A.mapPos.data,w=w.size,B=r.length/
w,C=0,F=0,n=!1,U=0,P=0;P<B;P++){t.x=A[F++];t.y=A[F++];t.z=A[F++];z[0]=r[C];z[1]=r[C+1];z[2]=r[C+2];var ba=g.evaluateElevationAlignmentAtPoint(t,e,c,f,h?y:null);h&&(U+=y.sampledElevation);u[0]=r[C]+v[0];u[1]=r[C+1]+v[1];u[2]=r[C+2]+v[2];f.setAltitude(ba,u);r[C]=u[0]-v[0];r[C+1]=u[1]-v[1];r[C+2]=u[2]-v[2];if(d.TESTS_DISABLE_UPDATE_THRESHOLDS)n=!0;else if(ba=b.updateThresholdInMeters/f.unitInMeters,Math.abs(z[0]-r[C])>=ba||Math.abs(z[1]-r[C+1])>=ba||Math.abs(z[2]-r[C+2])>=ba)n=!0;C+=w}q+=U/B;n&&a.geometryVertexAttrsUpdated(m)}return q/
l};b.perObjectElevationAligner=function(e,f,k,p){e=e.stageObject;var m=f.centerPointInElevationSR,t=0,A=0;if(e.metadata.usesVerticalDistanceToGround)t=g.evaluateElevationAlignmentAtPoint(m,k,f,p,y),l.updateVertexAttributeAuxpos1w(e,y.verticalDistanceToGround),A=y.sampledElevation;else{var w="absolute-height"!==f.mode,t=g.evaluateElevationAlignmentAtPoint(m,k,f,p,w?y:null);w&&(A=y.sampledElevation)}f=a.mat4.copy(r,e.objectTransformation);k=h.vec3.set(q,f[12],f[13],f[14]);d.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?
(u[0]=m.x,u[1]=m.y,u[2]=t,c.computeLinearTransformation(m.spatialReference,u,f,p.spatialReference)&&(e.objectTransformation=f)):p.setAltitudeOfTransformation(t,f);p=b.updateThresholdInMeters/p.unitInMeters;if(Math.abs(f[12]-k[0])>=p||Math.abs(f[13]-k[1])>=p||Math.abs(f[14]-k[2])>=p)e.objectTransformation=f;return A};var r=m.mat4f64.create();b.perLodInstanceElevationAligner=function(a,e,f,k){var l=e.centerPointInElevationSR,p=0,m=0,r="absolute-height"!==e.mode,p=g.evaluateElevationAlignmentAtPoint(l,
f,e,k,r?y:null);r&&(m=y.sampledElevation);e=a.graphics3DSymbolLayer.lodRenderer.instanceData;a=a.instanceIndex;f=w;e.getGlobalTransform(a,f);r=h.vec3.set(q,f[12],f[13],f[14]);d.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(u[0]=l.x,u[1]=l.y,u[2]=p,c.computeLinearTransformation(l.spatialReference,u,f,k.spatialReference)&&e.setGlobalTransform(a,f)):k.setAltitudeOfTransformation(p,f);k=b.updateThresholdInMeters/k.unitInMeters;(Math.abs(f[12]-r[0])>=k||Math.abs(f[13]-r[1])>=k||Math.abs(f[14]-r[2])>=k)&&
e.setGlobalTransform(a,f);return m};b.updateThresholdInMeters=.01;b.iterativeUpdatesEnabled=!0;var t=new f,u=e.vec3f64.create(),v=e.vec3f64.create(),z=e.vec3f64.create(),w=m.mat4f64.create(),q=e.vec3f64.create(),y={verticalDistanceToGround:0,sampledElevation:0}})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("require exports ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ./graphicUtils ../../support/ElevationProvider ../../support/projectionUtils".split(" "),
function(n,b,a,m,h,e,f,g,l){function d(c,d,b,e,f){var k=c.z||0;switch(b.mode){case "on-the-ground":return c=g.getElevationAtPoint(d,c,"ground")||0,f&&(f.verticalDistanceToGround=0,f.sampledElevation=c),c;case "relative-to-ground":return c=g.getElevationAtPoint(d,c,"ground")||0,b=b.geometryZWithOffset(k,e),f&&(f.verticalDistanceToGround=b,f.sampledElevation=c),b+c;case "relative-to-scene":return c=g.getElevationAtPoint(d,c,"scene")||0,b=b.geometryZWithOffset(k,e),f&&(f.verticalDistanceToGround=b,f.sampledElevation=
c),b+c;case "absolute-height":return b=b.geometryZWithOffset(k,e),f&&(c=g.getElevationAtPoint(d,c,"ground")||0,f.verticalDistanceToGround=b-c,f.sampledElevation=c),b;default:return a.neverReached(b.mode),0}}Object.defineProperty(b,"__esModule",{value:!0});b.applyPerVertexElevationAlignment=function(a,c,d,b,e,f,g,h,p,m,r){var q=k[r.mode],t=0;if(l.bufferToBuffer(a,c,d,b,p.spatialReference,e,h)&&(q.requiresAlignment(r)?(t=q.applyElevationAlignmentBuffer(b,e,f,g,h,p,m,r),a=f,e=g):a=b,l.bufferToBuffer(a,
p.spatialReference,e,f,m.spatialReference,g,h)))return t};b.evaluateElevationAlignmentAtPoint=d;b.elevationModeChangeUpdateType=function(a,d,b){return null==d||null==b?a.definedChanged:"on-the-ground"===d&&"on-the-ground"===b?a.staysOnTheGround:d===b||"on-the-ground"!==d&&"on-the-ground"!==b?c.UPDATE:a.onTheGroundChanged};b.needsElevationUpdates2D=function(a){return"relative-to-ground"===a||"relative-to-scene"===a};b.needsElevationUpdates3D=function(a){return"absolute-height"!==a};b.applyElevationAlignmentForHUD=
function(a,c,b,e,g){b=d(c,b,g,e,r);f.updateVertexAttributeAuxpos1w(a,r.verticalDistanceToGround);g=r.sampledElevation;var k=m.mat4.copy(p,a.objectTransformation);t[0]=c.x;t[1]=c.y;t[2]=b;l.computeLinearTransformation(c.spatialReference,t,k,e.spatialReference)?a.objectTransformation=k:console.warn("Could not locate symbol object properly, it might be misplaced");return g};var c;(function(a){a[a.NONE=0]="NONE";a[a.UPDATE=1]="UPDATE";a[a.RECREATE=2]="RECREATE"})(c=b.SymbolUpdateType||(b.SymbolUpdateType=
{}));var k={"absolute-height":{applyElevationAlignmentBuffer:function(a,c,d,b,e,f,g,k){f=k.calculateOffsetRenderUnits(g);k=k.featureExpressionInfoContext;c*=3;b*=3;for(g=0;g<e;++g){var l=a[c+1],h=a[c+2];d[b+0]=a[c+0];d[b+1]=l;d[b+2]=null==k?h+f:f;c+=3;b+=3}return 0},requiresAlignment:function(a){var c=a.featureExpressionInfoContext;return 0!==a.meterUnitOffset||null!=c}},"on-the-ground":{applyElevationAlignmentBuffer:function(a,c,d,b,e,f){var g=0,k=f.spatialReference;c*=3;b*=3;for(var l=0;l<e;++l){var h=
a[c+0],p=a[c+1],q=f.getElevation(h,p,a[c+2],k,"ground")||0,g=g+q;d[b+0]=h;d[b+1]=p;d[b+2]=q;c+=3;b+=3}return g/e},requiresAlignment:function(){return!0}},"relative-to-ground":{applyElevationAlignmentBuffer:function(a,c,d,b,e,f,g,k){var l=0;g=k.calculateOffsetRenderUnits(g);k=k.featureExpressionInfoContext;var h=f.spatialReference;c*=3;b*=3;for(var p=0;p<e;++p){var q=a[c+0],m=a[c+1],r=a[c+2],t=f.getElevation(q,m,r,h,"ground")||0,l=l+t;d[b+0]=q;d[b+1]=m;d[b+2]=null==k?r+t+g:t+g;c+=3;b+=3}return l/e},
requiresAlignment:function(){return!0}},"relative-to-scene":{applyElevationAlignmentBuffer:function(a,c,d,b,e,f,g,k){var l=0;g=k.calculateOffsetRenderUnits(g);k=k.featureExpressionInfoContext;var h=f.spatialReference;c*=3;b*=3;for(var p=0;p<e;++p){var q=a[c+0],m=a[c+1],r=a[c+2],t=f.getElevation(q,m,r,h,"scene")||0,l=l+t;d[b+0]=q;d[b+1]=m;d[b+2]=null==k?r+t+g:t+g;c+=3;b+=3}return l/e},requiresAlignment:function(){return!0}}},p=h.mat4f64.create(),r={verticalDistanceToGround:0,sampledElevation:0},t=
e.vec3f64.create()})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("require exports ../../../../core/mathUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ../../support/projectionUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u){function v(a){var c=a.paths[0];if(!c||0===c.length)return null;c=r.getPointOnPath(c,r.getPathLength(c)/2);return t.makeDehydratedPoint(c[0],c[1],c[2],a.spatialReference)}function z(a,c,d){d=d?a:t.clonePoint(a);return c&&a?u.pointToPoint(a,d,c)?d:null:d}function w(a){if(Array.isArray(a)){for(var c=0;c<a.length;c++)if(!w(a[c]))return!1;return!0}return null==a||0<=a}Object.defineProperty(b,"__esModule",{value:!0});b.computeCentroid=function(c,d){if("point"===
c.type)return z(c,d,!1);if(t.isHydratedGeometry(c))switch(c.type){case "extent":return z(c.center,d,!1);case "polygon":return z(c.centroid,d,!1);case "polyline":return z(v(c),d,!0);case "mesh":return z(c.extent.center,d,!1)}else switch(c.type){case "extent":var b=a.isFinite(c.zmin);c=t.makeDehydratedPoint(.5*(c.xmax+c.xmin),.5*(c.ymax+c.ymin),b?.5*(c.zmax+c.zmin):void 0,c.spatialReference);return z(c,d,!0);case "polygon":return(b=c.rings[0])&&0!==b.length?(b=p.ringsCentroid(c.rings,c.hasZ),c=t.makeDehydratedPoint(b[0],
b[1],b[2],c.spatialReference)):c=null,z(c,d,!0);case "polyline":return z(v(c),d,!0)}};b.enlargeExtent=function(a,c,d){if(a){c||(c=k.create());var b=.5*a.width*(d-1);d=.5*a.height*(d-1);a.width<1E-7*a.height?b+=d/20:a.height<1E-7*a.width&&(d+=b/20);l.vec4.set(c,a.xmin-b,a.ymin-d,a.xmax+b,a.ymax+d);return c}return null};b.updateVertexAttributeAuxpos1w=function(a,c){for(var d=0;d<a.geometries.length;++d){var b=a.geometries[d].data.vertexAttributes.auxpos1;b&&b.data[3]!==c&&(b.data[3]=c,a.geometryVertexAttrsUpdated(d))}};
b.mixinColorAndOpacity=function(a,c){var b=d.vec4f64.clone(d.vec4f64.ONES);m.isSome(a)&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]);m.isSome(c)?b[3]=c:m.isSome(a)&&3<a.length&&(b[3]=a[3]);return b};b.overrideColor=function(a,c,d,b,e,f){void 0===f&&(f=[0,0,0,0]);for(var g=0;3>g;++g)m.isSome(a)&&null!=a[g]?f[g]=a[g]:m.isSome(d)&&null!=d[g]?f[g]=d[g]:f[g]=e[g];m.isSome(c)?f[3]=c:m.isSome(b)?f[3]=b:f[3]=e[3];return f};b.computeObjectScale=function(a,c,d,b){void 0===a&&(a=g.vec3f64.ONES);void 0===b&&(b=1);var e=Array(3);
if(null==c||null==d)e[0]=1,e[1]=1,e[2]=1;else{for(var f=void 0,k=0,l=2;0<=l;l--){var h=a[l],p=void 0,q=null!=h,m=0===l&&!f&&!q,r=d[l];"symbol-value"===h||m?p=0!==r?c[l]/r:1:q&&"proportional"!==h&&isFinite(h)&&(p=0!==r?h/r:1);null!=p&&(f=e[l]=p,k=Math.max(k,Math.abs(p)))}for(l=2;0<=l;l--)null==e[l]?e[l]=f:0===e[l]&&(e[l]=.001*k)}for(l=2;0<=l;l--)e[l]/=b;return g.vec3f64.fromArray(e)};b.computeSizeWithResourceSize=function(a,c){var d=c.width,b=c.depth,e=c.height;c=c.isPrimitive?10:1;if(null==d&&null==
e&&null==b)return[c*a[0],c*a[1],c*a[2]];for(var d=g.vec3f64.fromValues(d,b,e),f,b=0;3>b;b++)if(e=d[b],null!=e){f=e/a[b];break}for(b=0;3>b;b++)null==d[b]&&(d[b]=a[b]*f);return d};b.validateSymbolLayerSize=function(a){null!=a.isPrimitive&&(a=[a.width,a.depth,a.height]);return w(a)?null:"Symbol sizes may not be negative values"};b.isValidSize=w;b.computeObjectRotation=function(a,c,d,b){void 0===b&&(b=e.mat4f64.create());a=a||0;c=c||0;d=d||0;0!==a&&h.mat4.rotateZ(b,b,-a/180*Math.PI);0!==c&&h.mat4.rotateX(b,
b,c/180*Math.PI);0!==d&&h.mat4.rotateY(b,b,d/180*Math.PI);return b};b.demResolutionForBoundingBox=function(a,d){return null!=d.minDemResolution?d.minDemResolution:c.isPoint(a)?d.minDemResolutionForPoints:.01*c.maximumDimension(a)};b.namedAnchorToHUDMaterialAnchorPos={"bottom-left":f.vec2f64.fromValues(0,0),bottom:f.vec2f64.fromValues(.5,0),"bottom-right":f.vec2f64.fromValues(1,0),left:f.vec2f64.fromValues(0,.5),center:f.vec2f64.fromValues(.5,.5),right:f.vec2f64.fromValues(1,.5),"top-left":f.vec2f64.fromValues(0,
1),top:f.vec2f64.fromValues(.5,1),"top-right":f.vec2f64.fromValues(1,1)}})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["require","exports","../../../../core/maybe","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this._renderUnitOffset=this._meterUnitOffset=0;this._unit="meters";this._metersPerElevationInfoUnit=1;this.mode=this.centerPointInElevationSR=
this._featureExpressionInfoContext=null}Object.defineProperty(b.prototype,"featureExpressionInfoContext",{get:function(){return this._featureExpressionInfoContext},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"unit",{get:function(){return this._unit},set:function(a){this._unit=a;this._metersPerElevationInfoUnit=m.getMetersPerUnit(a)},enumerable:!0,
configurable:!0});b.prototype.reset=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this._featureExpressionInfoContext=null;this.unit="meters"};Object.defineProperty(b.prototype,"offsetMeters",{set:function(a){this._meterUnitOffset=a;this._renderUnitOffset=0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"offsetElevationInfoUnits",{set:function(a){this._meterUnitOffset=a*this._metersPerElevationInfoUnit;this._renderUnitOffset=0},enumerable:!0,configurable:!0});
b.prototype.addOffsetRenderUnits=function(a){this._renderUnitOffset+=a};b.prototype.geometryZWithOffset=function(a,b){b=this.calculateOffsetRenderUnits(b);return null!=this.featureExpressionInfoContext?b:a+b};b.prototype.calculateOffsetRenderUnits=function(a){var b=this._meterUnitOffset,e=this.featureExpressionInfoContext;null!=e&&(b+=h.execute(e)*this._metersPerElevationInfoUnit);return b/a.unitInMeters+this._renderUnitOffset};b.prototype.setFromElevationInfo=function(b){this.mode=b.mode;this.unit=
b.unit||"meters";this.offsetElevationInfoUnits=a.unwrapOr(b.offset,0)};b.prototype.updateFeatureExpressionInfoContext=function(b,e,l){if(a.isNone(b))this._featureExpressionInfoContext=null;else{var d=b&&b.arcade;d&&a.isSome(e)&&a.isSome(l)?(this._featureExpressionInfoContext=h.clone(b),h.setContextFeature(this._featureExpressionInfoContext,h.createFeature(d.modules,e,l))):this._featureExpressionInfoContext=b}};b.fromElevationInfo=function(e){var f=new b;a.isSome(e)&&f.setFromElevationInfo(e);return f};
return b}();b.ElevationContext=n})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define("require exports tslib ../../../../core/Logger ../../../../layers/graphics/dehydratedFeatures ../../../../support/arcadeOnDemand".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});var f=m.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");b.clone=function(a){return{cachedResult:a.cachedResult,arcade:a.arcade?{func:a.arcade.func,context:a.arcade.modules.arcadeUtils.createExecContext(null,
{sr:a.arcade.context.spatialReference}),modules:a.arcade.modules}:null}};b.createContextWithoutExpressionSupport=function(a){a=a&&a.expression;return"string"===typeof a&&(a="0"===a?0:null,null!=a)?{cachedResult:a}:null};b.createContext=function(b,f,d){return a.__awaiter(this,void 0,void 0,function(){var c,g,l,h,m;return a.__generator(this,function(a){switch(a.label){case 0:c=b&&b.expression;if("string"!==typeof c)return[2,null];g="0"===c?0:null;return null!=g?[2,{cachedResult:g}]:[4,e.loadArcade()];
case 1:return l=a.sent(),h=l.arcadeUtils,m=h.createSyntaxTree(c),h.dependsOnView(m)?(null!=d&&d.error("Expressions containing '$view' are not supported on ElevationInfo"),[2,{cachedResult:0}]):[2,{arcade:{func:h.createFunction(m),context:h.createExecContext(null,{sr:f}),modules:l}}]}})})};b.createFeature=function(a,b,d){return a.arcadeUtils.createFeature(b.attributes,b.geometry,d)};b.setContextFeature=function(a,b){null!=a&&null==a.cachedResult&&(b&&a.arcade?(b._geometry&&(b._geometry=h.hydrateGeometry(b._geometry)),
a.arcade.modules.arcadeUtils.updateExecContext(a.arcade.context,b)):f.errorOncePerTick("Arcade support required but not provided"))};b.execute=function(a){if(null!=a){if(null!=a.cachedResult)return a.cachedResult;var b=a.arcade,b=a.arcade.modules.arcadeUtils.executeFunction(b.func,b.context);"number"!==typeof b&&(b=a.cachedResult=0);return b}return 0};b.extractExpressionInfo=function(a,b){void 0===b&&(b=!1);var d=(a=a&&a.featureExpressionInfo)&&a.expression;b||"0"===d||(a=null);return a};b.zeroContext=
{cachedResult:0}})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("require exports tslib ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./graphicUtils".split(" "),function(n,b,a,m,h,e,f,g,l){function d(a){return a.isVisible?a.getParameters().transparent?1:2:0}n=function(){function b(a,c,d,e,f,g,k,l,h){this.uniqueGeometries=d;this.uniqueMaterials=
e;this.uniqueTextures=f;this.elevationAligner=g;this.elevationContext=k;this._edgeState=l;this.type="object3d";this.stage=this.stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.stageObject=c;this.visibilityMode=null!=h?h:b.VisibilityModes.HIDE_FACERANGE}Object.defineProperty(b.prototype,"isElevationSource",{get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)},
enumerable:!0,configurable:!0});b.prototype.initialize=function(a,c){this.stageLayer=c;this.stage=a;if(this.uniqueMaterials)for(c=0;c<this.uniqueMaterials.length;c++)a.add(3,this.uniqueMaterials[c]);if(this.uniqueGeometries)for(c=0;c<this.uniqueGeometries.length;c++)a.add(2,this.uniqueGeometries[c]);if(this.uniqueTextures)for(c=0;c<this.uniqueTextures.length;c++)a.add(4,this.uniqueTextures[c]);a.add(1,this.stageObject)};b.prototype.layerOpacityChanged=function(a,c){if(!m.isNone(this._edgeState)){for(var b=
d(this._edgeState.baseMaterial),e=!1,f=0,g=this._edgeState.edgeMaterials;f<g.length;f++){var k=g[f];k.objectTransparency!==b&&(k.objectTransparency=b,e=!0)}e&&this.resetEdgeObject(c);this.stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[a])}};b.prototype.slicePlaneEnabledChanged=function(a,c){m.isNone(this._edgeState)||(this.stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:a},!c),this._edgeState.slicePlaneEnabled=
a)};b.prototype.setVisibility=function(a){if(null!=this.stage){if(this._visible===a)return!1;(this._visible=a)?this._addedToStage?this.stageObject.setVisible(!0):(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===b.VisibilityModes.HIDE_FACERANGE?this.stageObject.setVisible(!1):(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);if(m.isSome(this._edgeState)){var c=this.stage.renderView.ensureEdgeView();c.hasObject(this.stageObject)?c.updateObjectVisibility(this.stageObject,
a):a&&this.addOrUpdateEdgeObject(c,!1)}return!0}};Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},enumerable:!0,configurable:!0});b.prototype.destroy=function(){var a=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var c=0;c<this.uniqueMaterials.length;c++)a.remove(3,this.uniqueMaterials[c].id);if(this.uniqueGeometries)for(c=0;c<this.uniqueGeometries.length;c++)a.remove(2,this.uniqueGeometries[c].id);if(this.uniqueTextures)for(c=0;c<this.uniqueTextures.length;c++)a.remove(4,
this.uniqueTextures[c].id)}a.remove(1,this.stageObject.id);this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);a=this.stage.renderView.ensureEdgeView();a.hasObject(this.stageObject)&&a.removeObject(this.stageObject);this.stageObject.dispose();this._visible=!1;this.stage=this.stageLayer=null};b.prototype.alignWithElevation=function(a,c,d,b){null!=this.elevationAligner&&(m.isSome(d)&&g.setContextFeature(this.elevationContext.featureExpressionInfoContext,d),a=this.elevationAligner(this,
this.elevationContext,a,c),null!=a&&(this.alignedSampledElevation=a),this.resetEdgeObject(b))};b.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()};b.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=e.vec3f64.create());return h.vec3.copy(a,this.stageObject.getCenter(!0))};b.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=f.create());var c=this.stageObject;a||(a=f.create());f.setMin(a,c.getBBMin(!0));f.setMax(a,c.getBBMax(!0));return a};b.prototype.computeAttachmentOrigin=
function(a){for(var c=0,d=this.stageObject.geometryRecords;c<d.length;c++)d[c].computeAttachmentOrigin(p)&&(h.vec3.transformMat4(p,p,this.stageObject.objectTransformation),h.vec3.add(a.render.origin,a.render.origin,p),a.render.num++)};b.prototype.getProjectedBoundingBox=function(d,b,e,g,q){return a.__awaiter(this,void 0,void 0,function(){var m,t,u,w,v,z,I,G,J,E;return a.__generator(this,function(a){switch(a.label){case 0:m=this.getBoundingBoxObjectSpace(q);t=r;u=f.isPoint(m)?1:t.length;for(w=0;w<
u;w++)v=t[w],k[0]=m[v[0]],k[1]=m[v[1]],k[2]=m[v[2]],h.vec3.transformMat4(k,k,this.stageObject.objectTransformation),c[3*w+0]=k[0],c[3*w+1]=k[1],c[3*w+2]=k[2];if(!d(c,0,u))return[2,null];f.empty(m);z=null;this.calculateRelativeScreenBounds&&(z=this.calculateRelativeScreenBounds());for(w=0;w<3*u;w+=3){for(I=0;3>I;I++)m[I]=Math.min(m[I],c[w+I]),m[I+3]=Math.max(m[I+3],c[w+I]);z&&e.push({location:c.slice(w,w+3),screenSpaceBoundingRect:z})}if(!b||!b.service||"absolute-height"===this.elevationContext.mode)return[3,
5];f.center(m,p);G="relative-to-scene"===this.elevationContext.mode?"scene":"ground";J=void 0;if(!b.useViewElevation)return[3,1];J=b.service.getElevation(p[0],p[1],G);return[3,4];case 1:return a.trys.push([1,3,,4]),E=l.demResolutionForBoundingBox(m,b),[4,b.service.queryElevation(p[0],p[1],g,E,G)];case 2:return J=a.sent(),[3,4];case 3:return a.sent(),J=null,[3,4];case 4:f.offset(m,0,0,-this.alignedSampledElevation+J),a.label=5;case 5:return[2,m]}})})};b.prototype.addObjectState=function(a,c){0===a&&
c.addObject(this.stageObject,this.stageObject.highlight());1===a&&c.addObject(this.stageObject,this.stageObject.occlude())};b.prototype.removeObjectState=function(a){a.removeObject(this.stageObject)};b.prototype.resetEdgeObject=function(a){if(!m.isNone(this._edgeState)){var c=this.stage.renderView.ensureEdgeView();this._visible?this.addOrUpdateEdgeObject(c,a):c.removeObject(this.stageObject)}};b.prototype.addOrUpdateEdgeObject=function(a,c){var b=this._edgeState;if(!m.isNone(b)){for(var e=d(b.baseMaterial),
f=0,g=b.edgeMaterials;f<g.length;f++)g[f].objectTransparency=e;a.addOrUpdateObject(this.stageObject,b.edgeMaterials,{slicePlaneEnabled:b.slicePlaneEnabled},!c,b.addObjectSettings)}};return b}();(function(a){a=a.VisibilityModes||(a.VisibilityModes={});a[a.REMOVE_OBJECT=0]="REMOVE_OBJECT";a[a.HIDE_FACERANGE=1]="HIDE_FACERANGE"})(n||(n={}));var c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],k=e.vec3f64.create(),p=e.vec3f64.create(),r=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,
5]];return n})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("require exports tslib ../../../../Color ../../../../core/arrayUtils ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./Loadable ./symbolComplexity".split(" "),function(n,b,a,m,h,e,f,g,
l,d,c,k,p,r,t,u,v){function z(a,c){a=null!=a?c.attributes[a]:0;return null!=a&&isFinite(a)?a:0}Object.defineProperty(b,"__esModule",{value:!0});var w=f.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");n=function(b){function f(a,c,d,e){var f=b.call(this)||this;f._elevationInfoOverride=null;f.complexity=null;f.logger=w;f._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};f.symbol=a;f.symbolLayer=c;f._context=d;f._renderPriority=e.renderPriority;f._renderPriorityStep=
e.renderPriorityStep;f._elevationContext=new p.ElevationContext;f.complexity=f.computeComplexity();f._updateDrivenProperties(e.ignoreDrivers);f._updateElevationContext();return f}a.__extends(f,b);f.prototype.getCachedSize=function(){return null};Object.defineProperty(f.prototype,"needsDrivenTransparentPass",{get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque},enumerable:!0,configurable:!0});f.prototype._logGeometryCreationWarnings=function(a,c,d,b){var e=
"polygons"in a?a.polygons:null;b+=" geometry failed to be created";var f=null;a.projectionSuccess?!c.length||1===c.length&&!c[0].length?f=b+" (no "+d+" were defined)":Array.isArray(c)&&Array.isArray(c[0])?c.some(function(a){return 1===a.length})?f=b+" ("+d+" should contain at least 2 vertices)":e&&0===e.length&&"rings"===d&&(f=b+" (filled "+d+" should use clockwise winding - try reversing the order of vertices)"):f=b+" ("+d+" should be defined as a 2D array)":f=b+" (failed to project geometry to view spatial reference)";
f&&w.warnOncePerTick(f)};f.prototype._validateGeometryType=function(a,c,d){if(h.includes(c,a.type))return!0;this.logger.warn("unsupported geometry type for "+d+(" symbol: "+a.type));return!1};f.prototype._validateGeometry=function(a){return"point"!==a.type||g.isFinite(a.x)&&g.isFinite(a.y)?!0:(w.warn("point coordinate is not a valid number, graphic skipped"),!1)};f.prototype._defaultElevationInfoNoZ=function(){return q};f.prototype._defaultElevationInfoZ=function(){return y};f.prototype._updateElevationContext=
function(){l.isSome(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()};f.prototype.getDefaultElevationInfo=function(a){return a.hasZ?this._defaultElevationInfoZ():
this._defaultElevationInfoNoZ()};f.prototype.getGeometryElevationMode=function(a,c){void 0===c&&(c=this.getDefaultElevationInfo(a));return this._elevationContext.mode||c.mode};f.prototype.setElevationInfoOverride=function(a){this._elevationInfoOverride=a;this._updateElevationContext()};f.prototype.setGraphicElevationContext=function(a,c){var d=l.unwrap(a.geometry),b=this.getDefaultElevationInfo(d);c.unit=null!=this._elevationContext.unit?this._elevationContext.unit:b.unit;c.mode=this.getGeometryElevationMode(d,
b);c.offsetMeters=l.unwrapOr(this._elevationContext.meterUnitOffset,l.unwrapOr(b.offset,0));if(d=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===c.mode)c.mode="relative-to-ground",c.offsetMeters=0;c.updateFeatureExpressionInfoContext(d?r.zeroContext:this._elevationContext.featureExpressionInfoContext,a,this._context.layer);return c};f.prototype.prepareSymbolLayerPatch=function(a){};f.prototype.updateGeometry=function(a,c){return!1};f.prototype.onRemoveGraphic=function(a){};f.prototype._updateDrivenProperties=
function(a){var c={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};a||(a=this._context.renderer)&&"visualVariables"in a&&a.visualVariables&&a.visualVariables.forEach(function(a){switch(a.type){case "color":c.color=!0;if(a.stops)for(var d=0;d<a.stops.length;d++){var b=a.stops[d].color;b&&(c.opacity=!0,1>b.a&&(c.opacityAlwaysOpaque=!1))}break;case "opacity":c.opacity=!0;c.opacityAlwaysOpaque=!1;break;case "size":c.size=!0}});this._drivenProperties=c};f.prototype._getLayerOpacity=function(){if(this._context.layerView&&
"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;var a=this._context.layer.opacity;return null==a?1:a};f.prototype._getCombinedOpacity=function(a,c){void 0===c&&(c=A);var d=1;this.draped||(d*=this._getLayerOpacity());if(this._drivenProperties.opacity)return d;l.isSome(a)?d*=a.a:c.hasIntrinsicColor||(d=0);return d};f.prototype._getCombinedOpacityAndColor=function(a,c){void 0===c&&(c=A);c=this._getCombinedOpacity(a,c);if(this._drivenProperties.color)return t.mixinColorAndOpacity(null,
c);a=l.isSome(a)?m.toUnitRGB(a):d.vec3f64.ONES;return t.mixinColorAndOpacity(a,c)};f.prototype._getVertexOpacityAndColor=function(a,c,d){a=t.mixinColorAndOpacity(this._drivenProperties.color?a.color:null,this._drivenProperties.opacity?a.opacity:null);d&&(a[0]*=d,a[1]*=d,a[2]*=d,a[3]*=d);return c?new c(a):a};f.prototype._getIdHint=function(a){void 0===a&&(a="");return this._context.layer.id+"_symbol"+a};f.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};
f.prototype.computeComplexity=function(){return v.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)};f.prototype.destroy=function(){this.abortLoad()};f.prototype.globalPropertyChanged=function(a,c,d){switch(a){case "opacity":return this.layerOpacityChanged(c,d);case "elevationInfo":return a=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(c,d,a)===k.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(c,d);
case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged();default:return e.neverReachedSilent(a),!1}};f.prototype.updateGraphics3DGraphicElevationInfo=function(a,c,d){var b=this,e=k.SymbolUpdateType.UPDATE;a.forEach(function(a){var f=c(a);l.isSome(f)?(b.setGraphicElevationContext(a.graphic,f.elevationContext),f.needsElevationUpdates=d(f.elevationContext.mode)):e=k.SymbolUpdateType.RECREATE});return e};f.prototype.applyRendererDiff=
function(a,c){return!1};f.prototype.getFastUpdateAttrValues=function(a){if(!this._fastUpdates.enabled)return null;var d=this._fastUpdates.visualVariables,b=d.size?z(d.size.field,a):0,e=d.color?z(d.color.field,a):0;a=d.opacity?z(d.opacity.field,a):0;return c.vec4f64.fromValues(b,e,a,0)};Object.defineProperty(f.prototype,"draped",{get:function(){return this._draped},enumerable:!0,configurable:!0});f.prototype.ensureDrapedStatus=function(a){if(null==this._draped)return this._draped=a,!0;a!==this.draped&&
w.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");return!1};return f}(u.Loadable);b.Graphics3DSymbolLayer=n;b.getAttributeValue=z;var q={mode:"on-the-ground",offset:0,unit:"meters"},y={mode:"absolute-height",offset:0,unit:"meters"},A={hasIntrinsicColor:!1};b.default=n})},"esri/views/3d/layers/graphics/Loadable":function(){define(["require","exports","../../../../core/promiseUtils"],
function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this._abortController=null;this._loadStatus=0;this.logger=this._loader=this._loadError=null}Object.defineProperty(b.prototype,"loadStatus",{get:function(){return this._loadStatus},enumerable:!0,configurable:!0});b.prototype.load=function(b,e){var f=this;if(1===this._loadStatus)return b&&b(),this._loader;if(2===this._loadStatus)return e&&e(this._loadError),this._loader;this._loader||(this._abortController=a.createAbortController(),
this._loader=this.doLoad(this._abortController.signal).then(function(){f._abortController=null;f._loadStatus=1},function(b){f._loadError=b;f._abortController=null;f._loadStatus=2;!a.isAbortError(b)&&f.logger&&b.message&&f.logger.warn(b.message);throw b;}));this._loader.then(b,e).catch(function(){});return this._loader};b.prototype.abortLoad=function(){this._abortController?(this._abortController.abort(),this._abortController=null):0===this._loadStatus&&(this._loadStatus=2);this._loader=null};return b}();
b.Loadable=n})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("require exports tslib ../../../../core/compilerUtils ../../../../core/maybe ../../../../symbols/support/ObjectSymbol3DLayerResource ./primitiveObjectSymbolUtils ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodResources".split(" "),function(n,b,a,m,h,e,f,g,l){function d(a){for(var c=0,d=0,b=!1,e={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,
bytesPerCoordinate:0}},f=0;f<a.length;f++){var g=a[f];g&&(c+=g.primitivesPerFeature,d+=g.primitivesPerCoordinate,e.bytesPerFeature+=g.memory.bytesPerFeature,e.bytesPerFeatureLabel+=g.memory.bytesPerFeatureLabel,e.bytesPerCoordinate+=g.memory.bytesPerCoordinate,e.draped.bytesPerFeature+=g.memory.bytesPerFeature,e.draped.bytesPerFeatureLabel+=g.memory.bytesPerFeatureLabel,e.draped.bytesPerCoordinate+=g.memory.bytesPerCoordinate,b=b||g.estimated)}return{primitivesPerFeature:c,primitivesPerCoordinate:d,
estimated:b,memory:e}}function c(c,d){var b=k(c,d);switch(d.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,estimated:!1,memory:b};case "fill":return"mesh-3d"===c.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,estimated:!1,memory:b}:h.isSome(d.outline)&&0<d.outline.size?{primitivesPerFeature:-4,primitivesPerCoordinate:3,estimated:!1,memory:b}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,estimated:!1,memory:b};case "water":return{primitivesPerFeature:-2,
primitivesPerCoordinate:1,estimated:!1,memory:b};case "line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,estimated:!1,memory:b};case "object":return d.resource&&d.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,estimated:!0,memory:b}:a.__assign(a.__assign({},p(d.resource&&d.resource.primitive||e.defaultPrimitive)),{memory:b});case "path":var f=c=0;switch(d.profile){case "circle":c=10;break;case "quad":c=4;break;default:m.neverReached(d.profile);return}switch(d.join){case "round":f=
3;break;case "miter":case "bevel":f=1;break;default:m.neverReached(d.join);return}var g=2*c,f=c*f*2,l=-2*f-g;switch(d.cap){case "none":break;case "butt":case "square":l+=2*(c-1);break;case "round":l+=2*(4*c+c);break;default:m.neverReached(d.cap);return}return{primitivesPerFeature:l,primitivesPerCoordinate:f+g,estimated:!1,memory:b};case "text":case "icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,estimated:!1,memory:b};default:m.neverReached(d)}}function k(a,c){a="point-3d"===a.type;
switch(c.type){case "extrude":return c.edges&&0<c.edges.size?b.memoryEstimators.EXTRUDE_EDGES:b.memoryEstimators.EXTRUDE;case "fill":return h.isSome(c.outline)&&0<c.outline.size?b.memoryEstimators.FILL_OUTLINE:b.memoryEstimators.FILL;case "water":return b.memoryEstimators.FILL;case "line":return"round"===c.join?b.memoryEstimators.LINE_ROUND:b.memoryEstimators.LINE_MITER;case "path":switch(c.join){case "round":switch(c.profile){case "circle":return b.memoryEstimators.PATH_ROUND_CIRCLE;case "quad":return b.memoryEstimators.PATH_ROUND_QUAD;
default:m.neverReached(c.profile);return}case "miter":case "bevel":switch(c.profile){case "circle":return b.memoryEstimators.PATH_MITER_CIRCLE;case "quad":return b.memoryEstimators.PATH_MITER_QUAD;default:m.neverReached(c.profile);return}default:m.neverReached(c.join);return}case "object":return a?b.memoryEstimators.OBJECT_POINT:b.memoryEstimators.OBJECT_POLYGON;case "icon":case "text":return a?b.memoryEstimators.ICON_POINT:b.memoryEstimators.ICON_POLYGON;default:m.neverReached(c)}}function p(a){var c=
r[a];if(c)return c;c=f.primitiveLodResources(a,null,null);c={primitivesPerFeature:l.geometriesFromLodLevelResources(c.levels[0]).reduce(function(a,c){return a+c.data.getIndices(g.VertexAttrConstants.POSITION).length/3},0),primitivesPerCoordinate:0,estimated:!1};return r[a]=c}Object.defineProperty(b,"__esModule",{value:!0});b.emptySymbolComplexity={primitivesPerFeature:0,primitivesPerCoordinate:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,
bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};b.defaultSymbolComplexity=function(a){if("web-style"===a.type)return b.emptySymbolComplexity;var e=a.symbolLayers.toArray().map(function(d){return c(a,d)});return d(e)};b.totalSymbolComplexities=d;var r={};b.defaultSymbolLayerComplexity=c;b.defaultSymbolLayerMemoryComplexity=k;b.memoryEstimators={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,
bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,
bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,
bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,
draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,
bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,
bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}}})},
"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define("require exports ../../../../core/compilerUtils ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});var f=m.fromValues(-.5,-.5,-.5,.5,.5,.5),g=m.fromValues(-.5,-.5,0,.5,.5,1),l=m.fromValues(-.5,-.5,0,.5,.5,.5);b.isValidPrimitive=function(a){switch(a){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};
b.primitiveBoundingBox=function(c){switch(c){case "sphere":case "cube":case "diamond":return f;case "cylinder":case "cone":case "inverted-cone":return g;case "tetrahedron":return l;default:a.neverReached(c)}};b.primitiveGeometryData=function(c){switch(c){case "sphere":return e.createPolySphereGeometry(.5,2,!0);case "cube":return e.createBoxGeometry(1);case "cylinder":return e.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);case "cone":return e.cgToGIS(e.createConeGeometry(1,.5,15,!1));case "inverted-cone":return e.cgToGIS(e.createConeGeometry(1,
.5,15,!0));case "tetrahedron":return e.cgToGIS(e.createTetrahedronGeometry(1));case "diamond":return e.cgToGIS(e.createDiamondGeometry(1));default:a.neverReached(c)}};b.primitiveLodResources=function(c,b,f){var g=function(a,c,d){void 0===d&&(d=!1);return{levels:a.map(function(a,g){var k=c(a.tesselation);d&&e.cgToGIS(k);return{components:[{geometry:new h(k,f+("_lod"+g)),material:b}],faceCount:k.indexCount/3,minScreenSpaceRadius:a.minScreenSpaceRadius}})}};switch(c){case "sphere":return g([{tesselation:0,
minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],function(a){return e.createPolySphereGeometry(.5,a,!0)});case "cube":return g([{tesselation:0,minScreenSpaceRadius:0}],function(){return e.createBoxGeometry(1)});case "cone":return g(d,function(a){return e.createConeGeometry(1,.5,a,!1)},!0);case "inverted-cone":return g(d,function(a){return e.createConeGeometry(1,.5,
a,!0)},!0);case "cylinder":return g(d,function(a){return e.createCylinderGeometry(1,.5,a,[0,0,1],[0,0,.5])});case "tetrahedron":return g([{tesselation:0,minScreenSpaceRadius:0}],function(){return e.createTetrahedronGeometry(1)},!0);case "diamond":return g([{tesselation:0,minScreenSpaceRadius:0}],function(){return e.createDiamondGeometry(1)},!0);default:a.neverReached(c)}};var d=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]})},
"esri/views/3d/webgl-engine/lib/Geometry":function(){define("require exports ./BoundingInfo ./geometryDataUtils ./IdGen ./Util ./Util".split(" "),function(n,b,a,m,h,e,f){return function(){function b(a,d,c){this._boundingInfo=null;this._id=b.__idGen.gen(d);this._data=a;this._boundingInfo=c}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});
b.prototype.getIndices=function(a){return this.data.getIndices(a)};Object.defineProperty(b.prototype,"indexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0});b.prototype.getAttribute=function(a){return this.data.getAttribute(a)};Object.defineProperty(b.prototype,"vertexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"faceCount",{get:function(){return this.data.indexCount/3},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"boundingInfo",{get:function(){null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo},enumerable:!0,configurable:!0});b.prototype.computeAttachmentOrigin=function(a){return"triangle"===this.data.primitiveType?this.computeAttachmentOriginTriangles(a):this.computeAttachmentOriginPoints(a)};b.prototype.computeAttachmentOriginTriangles=function(a){var d=this.getIndices(f.VertexAttrConstants.POSITION),c=this.getAttribute(f.VertexAttrConstants.POSITION);
return m.computeAttachmentOriginTriangles(c,d,a)};b.prototype.computeAttachmentOriginPoints=function(a){var d=this.getIndices(f.VertexAttrConstants.POSITION),c=this.getAttribute(f.VertexAttrConstants.POSITION);return m.computeAttachmentOriginPoints(c,d,a)};b.prototype.invalidateBoundingInfo=function(){this._boundingInfo=null};b.prototype._calculateBoundingInfo=function(){var b=this.data.getIndices(f.VertexAttrConstants.POSITION),d=this.data.getAttribute(f.VertexAttrConstants.POSITION),c="triangle"===
this.data.primitiveType?3:1;if(0===b.length)for(var b=new Uint32Array(c),g=0;g<c;++g)b[g]=g;g=b.length;e.assert(0===g%c,"Indexing error: "+g.toFixed(0)+" not divisible by "+c.toFixed(0));g=m.generateDefaultIndexArray(g/c);return new a(g,c,b,d)};b.__idGen=new h.IdGen;return b}()})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define("require exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./Util".split(" "),function(n,
b,a,m,h,e){n=function(){function a(b,f,d,c){this.primitiveIndices=b;this._numIndexPerPrimitive=f;this.indices=d;this._position=c;this.center=h.vec3f64.create();e.assert(1<=b.length);e.assert(0===d.length%this._numIndexPerPrimitive);e.assert(d.length>=b.length*this._numIndexPerPrimitive);e.assert(3===this._position.size||4===this._position.size);c=this._position;f=c.data;var g=c.offsetIdx,l=c.strideIdx;c=0;var r=b.length,t=g+l*d[this._numIndexPerPrimitive*b[c]];a.tmpIndices.clear();a.tmpIndices.push(t);
this.bbMin=h.vec3f64.fromValues(f[t],f[t+1],f[t+2]);for(this.bbMax=h.vec3f64.clone(this.bbMin);c<r;++c)for(var u=this._numIndexPerPrimitive*b[c],v=0;v<this._numIndexPerPrimitive;++v){t=g+l*d[u+v];a.tmpIndices.push(t);var z=f[t];this.bbMin[0]=Math.min(z,this.bbMin[0]);this.bbMax[0]=Math.max(z,this.bbMax[0]);z=f[t+1];this.bbMin[1]=Math.min(z,this.bbMin[1]);this.bbMax[1]=Math.max(z,this.bbMax[1]);z=f[t+2];this.bbMin[2]=Math.min(z,this.bbMin[2]);this.bbMax[2]=Math.max(z,this.bbMax[2])}m.vec3.lerp(this.center,
this.bbMin,this.bbMax,.5);this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);b=this.bsRadius*this.bsRadius;for(c=0;c<a.tmpIndices.length;++c)t=a.tmpIndices.data[c],d=f[t]-this.center[0],g=f[t+1]-this.center[1],t=f[t+2]-this.center[2],l=d*d+g*g+t*t,l<=b||(l=Math.sqrt(l),r=.5*(l-this.bsRadius),this.bsRadius+=r,b=this.bsRadius*this.bsRadius,l=r/l,this.center[0]+=d*l,this.center[1]+=g*l,this.center[2]+=t*l);a.tmpIndices.clear()}a.prototype.getCenter=
function(){return this.center};a.prototype.getBSRadius=function(){return this.bsRadius};a.prototype.getBBMin=function(){return this.bbMin};a.prototype.getBBMax=function(){return this.bbMax};a.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};a.prototype.getIndices=function(){return this.indices};a.prototype.getPosition=function(){return this._position};a.prototype.getChildren=function(){if(this._children)return this._children;if(1<m.vec3.squaredDistance(this.bbMin,this.bbMax)){for(var b=
m.vec3.lerp(h.vec3f64.create(),this.bbMin,this.bbMax,.5),e=this.primitiveIndices.length,d=new Uint8Array(e),c=Array(8),f=0;8>f;++f)c[f]=0;for(var f=this._position,p=f.data,r=f.offsetIdx,t=f.strideIdx,f=0;f<e;++f){for(var u=0,v=this._numIndexPerPrimitive*this.primitiveIndices[f],z=r+t*this.indices[v],w=p[z],q=p[z+1],y=p[z+2],A=1;A<this._numIndexPerPrimitive;++A){var z=r+t*this.indices[v+A],B=p[z],C=p[z+1],z=p[z+2];B<w&&(w=B);C<q&&(q=C);z<y&&(y=z)}w<b[0]&&(u|=1);q<b[1]&&(u|=2);y<b[2]&&(u|=4);d[f]=u;
++c[u]}for(f=b=0;8>f;++f)0<c[f]&&++b;if(2>b)return;b=Array(8);for(f=0;8>f;++f)b[f]=0<c[f]?new Uint32Array(c[f]):void 0;for(f=0;8>f;++f)c[f]=0;for(f=0;f<e;++f)u=d[f],b[u][c[u]++]=this.primitiveIndices[f];this._children=Array(8);for(f=0;8>f;++f)void 0!==b[f]&&(this._children[f]=new a(b[f],this._numIndexPerPrimitive,this.indices,this._position))}return this._children};return a}();(n||(n={})).tmpIndices=new a({deallocator:null});return n})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["require",
"exports","../../../../../core/arrayUtils"],function(n,b,a){function m(b){var e=[];b.components.forEach(function(a){e.push(a.geometry)});return a.unique(e)}Object.defineProperty(b,"__esModule",{value:!0});b.materialsFromLodResources=function(b){var e=[];b.levels.forEach(function(a){a.components.forEach(function(a){e.push(a.material)})});return a.unique(e)};b.texturesFromLodResources=function(b){var e=[];b.levels.forEach(function(a){a.components.forEach(function(a){a.textures&&e.push.apply(e,a.textures)})});
return a.unique(e)};b.geometriesFromLodLevelResources=m;b.geometriesFromLodResources=function(b){var e=[];b.levels.forEach(function(a){a.components.forEach(function(a){e.push(a.geometry)})});return a.unique(e)};b.computeFaceCount=function(a){var b=0;m(a).forEach(function(a){b+=a.data.indexCount/3});return b}})},"esri/views/3d/layers/graphics/pointUtils":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./elevationAlignmentUtils ./graphicUtils ../../support/projectionUtils ../../webgl-engine/lib/Object3D".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p){Object.defineProperty(b,"__esModule",{value:!0});var r=h.vec3f64.create();b.createStageObjectForHUD=function(c,b,f,g,l,h,y,A,B,C,F){var q=f?f.length:0,t=c.clippingExtent;k.pointToVector(b,r,c.elevationProvider.spatialReference);if(a.isSome(t)&&!e.containsPoint(t,r))return null;k.pointToVector(b,r,c.renderCoordsHelper.spatialReference);t=c.localOriginFactory.getOrigin(r);A=new p({castShadow:!1,metadata:{layerUid:B,graphicUid:C,usesVerticalDistanceToGround:!0},idHint:A});
for(B=0;B<q;B++)A.addGeometry(f[B],g[B],l?l[B]:m.mat4f64.IDENTITY,h,t,F);c=d.applyElevationAlignmentForHUD(A,b,c.elevationProvider,c.renderCoordsHelper,y);return{object:A,sampledElevation:c}};b.extendPointGraphicElevationContext=function(a,c,d){a=a.elevationContext;d=d.spatialReference;k.pointToVector(c,r,d);a.centerPointInElevationSR=g.makeDehydratedPoint(r[0],r[1],c.hasZ?r[2]:0,d)};b.placePointOnGeometry=function(a){switch(a.type){case "point":return a;case "polygon":case "extent":return c.computeCentroid(a);
case "polyline":var d=a.paths[0];if(!d||0===d.length)break;d=f.getPointOnPath(d,f.getPathLength(d)/2);return g.makeDehydratedPoint(d[0],d[1],d[2],a.spatialReference);case "mesh":return a.extent.center}return null};b.geometryToRenderInfo=function(a,c,d,b,e){var f=new Float64Array(3*a.length),g=new Float64Array(f.length);a.forEach(function(a,c){f[3*c+0]=a[0];f[3*c+1]=a[1];f[3*c+2]=2<a.length?a[2]:0});c=l.applyPerVertexElevationAlignment(f,c,0,g,0,f,0,f.length/3,d,b,e);return{numVertices:a.length,position:f,
mapPosition:g,projectionSuccess:null!=c,sampledElevation:c}}})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("require exports tslib ../../../../core/libs/gl-matrix-2/vec2f32 ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/LineCalloutTechnique".split(" "),function(n,b,a,m,h,e,f,g,l,d,c,k){n=function(b){function e(a,c){c=b.call(this,c)||this;
c.techniqueConfig=new k.LineCalloutTechniqueConfiguration;c.params=d.copyParameters(a,r);c._uniqueMaterialIdentifier=e.uniqueMaterialIdentifier(c.params);return c}a.__extends(e,b);Object.defineProperty(e.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0});e.prototype.dispose=function(){};e.prototype.getGLMaterial=function(a){return 0===a.output?new p(a):void 0};e.prototype.getPassParameters=function(){return this.params};e.prototype.getTechniqueConfig=
function(a){this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest;this.techniqueConfig.verticalOffset=!!this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective;this.techniqueConfig.depthHudEnabled=a;this.techniqueConfig.depthHudAlignStartEnabled=!!this.params.depthHUDAlignStart;this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;
return this.techniqueConfig};e.prototype.intersect=function(){};e.prototype.createBufferWriter=function(){return new v};e.prototype.createRenderer=function(a,d){return new c(a,d,this)};e.prototype.setParameterValues=function(a){d.updateParameters(this.params,a)&&(this._uniqueMaterialIdentifier=e.uniqueMaterialIdentifier(this.params),this.parametersChanged())};e.prototype.getParameters=function(){return this.params};e.uniqueMaterialIdentifier=function(a){return JSON.stringify({screenOffset:a.screenOffset||
[0,0],centerOffsetUnits:a.centerOffsetUnits||"world"})};return e}(f.Material);var p=function(c){function d(a){a=c.call(this,a)||this;a.isRenderSlot=!0;a.updateParameters();return a}a.__extends(d,c);d.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(k.LineCalloutTechnique,this.material.getTechniqueConfig(!1),this.technique);this.depthTechnique=this.techniqueRep.acquireAndReleaseExisting(k.LineCalloutTechnique,this.material.getTechniqueConfig(!0),this.depthTechnique)};
d.prototype.beginSlot=function(a){switch(a){case 20:return this.isRenderSlot=!0;case 21:return this.isRenderSlot=!1,!0}return!1};d.prototype.getTechnique=function(){return this.isRenderSlot?this.technique:this.depthTechnique};d.prototype.bind=function(a,c){var d=this.getTechnique();a.bindProgram(d.program);d.bindPass(a,this.material.getPassParameters(),c)};return d}(e.GLMaterial),r={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,
shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1},t=h.newLayout().vec3f(g.VertexAttrConstants.POSITION).vec3f(g.VertexAttrConstants.NORMAL).vec2f(g.VertexAttrConstants.UV0).vec4f(g.VertexAttrConstants.AUXPOS1),u=[m.vec2f32.fromValues(0,0),m.vec2f32.fromValues(1,0),m.vec2f32.fromValues(0,1),m.vec2f32.fromValues(1,0),m.vec2f32.fromValues(1,1),m.vec2f32.fromValues(0,1)],v=function(){function a(){this.vertexBufferLayout=t}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};
a.prototype.elementCount=function(a){return 6*a.indices[g.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,c,d,b){l.writePosition(c.indices[g.VertexAttrConstants.POSITION],c.vertexAttr[g.VertexAttrConstants.POSITION].data,a.transformation,d.position,b,6);l.writeNormal(c.indices[g.VertexAttrConstants.NORMAL],c.vertexAttr[g.VertexAttrConstants.NORMAL].data,a.invTranspTransformation,d.normal,b,6);l.writeBufferVec4(c.indices[g.VertexAttrConstants.AUXPOS1],c.vertexAttr[g.VertexAttrConstants.AUXPOS1].data,
d.auxpos1,b,6);for(a=0;a<u.length;++a)d.uv0.setVec(b+a,u[a])};return a}();return n})},"esri/core/libs/gl-matrix-2/vec2f32":function(){define(["require","exports","./factories/vec2f32"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.vec2f32=a})},"esri/core/libs/gl-matrix-2/factories/vec2f32":function(){define(["require","exports"],function(n,b){function a(){return new Float32Array(2)}function m(a,b){var d=new Float32Array(2);d[0]=a;d[1]=b;return d}function h(){return m(1,1)}function e(){return m(1,
0)}function f(){return m(0,1)}Object.defineProperty(b,"__esModule",{value:!0});b.create=a;b.clone=function(a){var b=new Float32Array(2);b[0]=a[0];b[1]=a[1];return b};b.fromValues=m;b.createView=function(a,b){return new Float32Array(a,b,2)};b.zeros=function(){return a()};b.ones=h;b.unitX=e;b.unitY=f;b.ZEROS=a();b.ONES=h();b.UNIT_X=e();b.UNIT_Y=f()})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/util/Camera.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../materials/internal/MaterialUtil ./LineCallout.glsl ./LineCallout.glsl ../../../webgl/Program ../../../webgl/renderState ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v){Object.defineProperty(b,"__esModule",{value:!0});l=function(d){function b(){return null!==d&&d.apply(this,arguments)||this}a.__extends(b,d);b.prototype.initializeProgram=function(a){var d=b.shader.get(),e=this.configuration,d=d.build({occlusionTestEnabled:e.occlusionTestEnabled,verticalOffsetEnabled:e.verticalOffset,screenSizePerspectiveEnabled:e.screenSizePerspective,depthHudEnabled:e.depthHudEnabled,depthHudAlignStartEnabled:e.depthHudAlignStartEnabled,
screenCenterOffsetUnitsEnabled:e.screenCenterOffsetUnitsEnabled,slicePlaneEnabled:e.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,viewingMode:a.viewingMode});return new t(a.rctx,d.generateSource("vertex"),d.generateSource("fragment"),c.Default3D)};b.prototype.bindPass=function(a,c,d){r.LineCallout.bindUniforms(this.program,c,d);e.VerticalOffset.bindUniforms(this.program,c,d);var b=d.cameraAboveGround?1:-1;this.program.setUniform1i("hudVisibilityTexture",0);a.bindTexture(d.hudVisibilityTexture,
0);this.program.setUniform1f("cameraGroundRelative",b);this.program.setUniform1f("polygonOffset",c.shaderPolygonOffset);this.program.setUniform4fv("viewport",d.viewport);this.program.setUniform1f("perDistancePixelRatio",Math.tan(d.fovY/2)/(d.viewport[2]/2));this.program.setUniformMatrix4fv("viewNormal",d.viewInvTransp);this.program.setUniform2f("pixelToNDC",2/d.viewport[2],2/d.viewport[3]);this.program.setUniform1f("lineSize",Math.ceil(c.size)*(d.pixelRatio||1));k.bindScreenSizePerspective(c.screenSizePerspective,
this.program,"screenSizePerspectiveAlignment")};b.prototype.bindDraw=function(a){h.Transform.bindUniforms(this.program,a);f.Camera.bindUniforms(this.program,a);m.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};b.prototype.initializePipeline=function(){return this.configuration.depthHudEnabled?v.makePipelineState({depthTest:{func:513},depthWrite:u.defaultDepthWriteParams}):v.makePipelineState({blending:v.separateBlendingParams(1,770,771,771),depthTest:{func:513},colorWrite:v.defaultColorWriteParams})};
b.shader=new g.ReloadableShaderModule(p,function(){return new Promise(function(a,c){n(["./LineCallout.glsl"],a,c)})});return b}(l.ShaderTechnique);b.LineCalloutTechnique=l;l=function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.occlusionTestEnabled=!0;a.verticalOffset=!1;a.screenSizePerspective=!1;a.depthHudEnabled=!1;a.depthHudAlignStartEnabled=!1;a.screenCenterOffsetUnitsEnabled=0;a.slicePlaneEnabled=!1;return a}a.__extends(b,c);a.__decorate([d.parameter()],b.prototype,"occlusionTestEnabled",
void 0);a.__decorate([d.parameter()],b.prototype,"verticalOffset",void 0);a.__decorate([d.parameter()],b.prototype,"screenSizePerspective",void 0);a.__decorate([d.parameter()],b.prototype,"depthHudEnabled",void 0);a.__decorate([d.parameter()],b.prototype,"depthHudAlignStartEnabled",void 0);a.__decorate([d.parameter({count:2})],b.prototype,"screenCenterOffsetUnitsEnabled",void 0);a.__decorate([d.parameter()],b.prototype,"slicePlaneEnabled",void 0);return b}(d.ShaderTechniqueConfiguration);b.LineCalloutTechniqueConfiguration=
l})},"esri/views/3d/webgl-engine/shaders/LineCallout.glsl":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/hud/AlignPixel.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),function(n,b,a,m,h,e,f,g){function l(a,c,d){3===d.length?a.setUniform4f(c,d[0],d[1],d[2],1):a.setUniform4fv(c,d)}Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var l=new g.ShaderBuilder;l.include(h.AlignPixel);
l.include(e.HUD,b);l.include(m.Slice,b);l.attributes.add("uv0","vec2");l.vertex.uniforms.add("lineSize","float").add("pixelToNDC","vec2").add("borderSize","float").add("screenOffset","vec2");l.varyings.add("coverageSampling","vec4");l.varyings.add("lineSizes","vec2");l.vertex.code.add(f.glsl(v||(v=a.__makeTemplateObject(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 endPoint \x3d projectPositionHUD(projectAux);\n\n      vec3 vpos \x3d projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n    ",
"\n\n    ","\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly\n      // used to get the correct depth value\n      vec3 posView \x3d (view * vec4(position, 1.0)).xyz;\n      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\n      vec4 startPoint \x3d proj * vec4(posView, 1.0);\n      // Apply screen offset to both start and end point\n      vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\n      startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\n      endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\n      // Align start and end to pixel origin\n      vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\n      vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\n    ",
"\n      vec4 projectedPosition \x3d mix(startAligned, endAligned, uv0.y);\n      // The direction of the line in screen space\n      vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n    ","\n      float halfPixelSize \x3d lineSizeScaled * 0.5;\n      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\n      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\n      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\n      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\n      float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\n      float halfPixelSizeInt \x3d floor(halfWholePixelSize);\n\n      // Sub-pixel offset if we need to grow sub-pixels to the left\n      float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\n\n      // Pixel offset aligning to whole pixels and adding subpixel offset if needed\n      float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\n\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n      float padding \x3d 1.0 + borderSizeScaled;\n      vec2 ndcOffset \x3d (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n      // Offset x/y from the center of the line in screen space\n      projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n      // Compute a coverage varying which we can use in the fragment shader to determine\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n      // This works by computing two coordinates that can be linearly interpolated and then\n      // subtracted to find out how far away from the line edge we are.\n      float edgeDirection \x3d (uv0.x * 2.0 - 1.0);\n\n      float halfBorderSize \x3d 0.5 * borderSizeScaled;\n      float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\n      float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n      float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\n\n      coverageSampling \x3d vec4(\n        // Edge coordinate\n        outerEdgeCoverageSampler,\n\n        // Border edge coordinate\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n        // Line offset\n        halfPixelSize - 0.5,\n\n        // Border offset\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n      );\n\n      lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\n\n      gl_Position \x3d projectedPosition;\n    }\n  "],
["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 endPoint \x3d projectPositionHUD(projectAux);\n\n      vec3 vpos \x3d projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n    ","\n\n    ","\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly\n      // used to get the correct depth value\n      vec3 posView \x3d (view * vec4(position, 1.0)).xyz;\n      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\n      vec4 startPoint \x3d proj * vec4(posView, 1.0);\n      // Apply screen offset to both start and end point\n      vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\n      startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\n      endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\n      // Align start and end to pixel origin\n      vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\n      vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\n    ",
"\n      vec4 projectedPosition \x3d mix(startAligned, endAligned, uv0.y);\n      // The direction of the line in screen space\n      vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n    ","\n      float halfPixelSize \x3d lineSizeScaled * 0.5;\n      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\n      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\n      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\n      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\n      float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\n      float halfPixelSizeInt \x3d floor(halfWholePixelSize);\n\n      // Sub-pixel offset if we need to grow sub-pixels to the left\n      float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\n\n      // Pixel offset aligning to whole pixels and adding subpixel offset if needed\n      float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\n\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n      float padding \x3d 1.0 + borderSizeScaled;\n      vec2 ndcOffset \x3d (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n      // Offset x/y from the center of the line in screen space\n      projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n      // Compute a coverage varying which we can use in the fragment shader to determine\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n      // This works by computing two coordinates that can be linearly interpolated and then\n      // subtracted to find out how far away from the line edge we are.\n      float edgeDirection \x3d (uv0.x * 2.0 - 1.0);\n\n      float halfBorderSize \x3d 0.5 * borderSizeScaled;\n      float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\n      float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n      float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\n\n      coverageSampling \x3d vec4(\n        // Edge coordinate\n        outerEdgeCoverageSampler,\n\n        // Border edge coordinate\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n        // Line offset\n        halfPixelSize - 0.5,\n\n        // Border offset\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n      );\n\n      lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\n\n      gl_Position \x3d projectedPosition;\n    }\n  "])),
b.occlusionTestEnabled?f.glsl(d||(d=a.__makeTemplateObject(["\n      if (!testVisibilityHUD(endPoint)) {\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }"],["\n      if (!testVisibilityHUD(endPoint)) {\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }"]))):"",b.screenSizePerspectiveEnabled?f.glsl(c||(c=a.__makeTemplateObject(["\n      vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n      vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n        "],
["\n      vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n      vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n        "]))):f.glsl(k||(k=a.__makeTemplateObject(["\n      vec2 screenOffsetScaled \x3d screenOffset;\n        "],["\n      vec2 screenOffsetScaled \x3d screenOffset;\n        "]))),b.depthHudEnabled?b.depthHudAlignStartEnabled?f.glsl(p||
(p=a.__makeTemplateObject(["endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);"],["endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);"]))):f.glsl(r||(r=a.__makeTemplateObject(["startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);"],["startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);"]))):"",b.screenSizePerspectiveEnabled?f.glsl(t||(t=a.__makeTemplateObject(["\n      float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n      float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n        "],
["\n      float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n      float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n        "]))):f.glsl(u||(u=a.__makeTemplateObject(["\n      float lineSizeScaled \x3d lineSize;\n      float borderSizeScaled \x3d borderSize;\n        "],["\n      float lineSizeScaled \x3d lineSize;\n      float borderSizeScaled \x3d borderSize;\n        "])))));l.fragment.uniforms.add("color",
"vec4");l.fragment.uniforms.add("borderColor","vec4");l.fragment.code.add(f.glsl(q||(q=a.__makeTemplateObject(["\n    void main() {\n      // Mix between line and border coverage offsets depending on whether we need\n      // a border (based on the sidedness).\n      vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n      // Mix between border and line color based on the line coverage (conceptually the line\n      // blends on top of the border background).\n      //\n      // Anti-alias by blending final result using the full (including optional border) coverage\n      // and the color alpha\n      float borderAlpha \x3d color.a * borderColor.a * coverage.y;\n      float colorAlpha \x3d color.a * coverage.x;\n\n      float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\n\n    ",
"\n  }\n  "],["\n    void main() {\n      // Mix between line and border coverage offsets depending on whether we need\n      // a border (based on the sidedness).\n      vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n      // Mix between border and line color based on the line coverage (conceptually the line\n      // blends on top of the border background).\n      //\n      // Anti-alias by blending final result using the full (including optional border) coverage\n      // and the color alpha\n      float borderAlpha \x3d color.a * borderColor.a * coverage.y;\n      float colorAlpha \x3d color.a * coverage.x;\n\n      float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\n\n    ",
"\n  }\n  "])),b.depthHudEnabled?f.glsl(z||(z=a.__makeTemplateObject(["\n      if (finalAlpha \x3c 0.01) {\n        discard;\n      }\n      "],["\n      if (finalAlpha \x3c 0.01) {\n        discard;\n      }\n      "]))):f.glsl(w||(w=a.__makeTemplateObject(["\n      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\n      // need to divide by finalAlpha). We avoid the division here by setting the\n      // appropriate blending function in the material.\n      vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\n      gl_FragColor \x3d vec4(finalRgb, finalAlpha);\n      "],
["\n      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\n      // need to divide by finalAlpha). We avoid the division here by setting the\n      // appropriate blending function in the material.\n      vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\n      gl_FragColor \x3d vec4(finalRgb, finalAlpha);\n      "])))));return l};(function(a){a.bindUniforms=function(a,c,d){l(a,"color",c.color);d=d.pixelRatio||1;a.setUniform1f("pixelRatio",
d);a.setUniform2f("screenOffset",c.screenOffset[0]*d,c.screenOffset[1]*d);null!==c.borderColor?(l(a,"borderColor",c.borderColor),a.setUniform1f("borderSize",d)):(a.setUniform4f("borderColor",0,0,0,0),a.setUniform1f("borderSize",0))}})(b.LineCallout||(b.LineCallout={}));var d,c,k,p,r,t,u,v,z,w,q})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["require","exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});
b.getGraphics3DSymbol=function(b){return b instanceof m?b.graphics3DSymbol:b instanceof a?b:null}})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("require exports tslib ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayerFactory ./Loadable ./symbolComplexity".split(" "),function(n,b,a,m,h,e,f,g,l,d,c){var k={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};return function(d){function b(a,
c,b){var e=d.call(this)||this;e._symbol=a;e._context=c;e._backgroundLayers=b;e._destroyed=!1;e.symbolLayers=[];e.referenced=0;return e}a.__extends(b,d);Object.defineProperty(b.prototype,"symbol",{get:function(){return this._symbol},set:function(a){this._symbol=a;if(this.symbolLayers)for(var c=0;c<a.symbolLayers.length;c++){var d=this.symbolLayers[c];h.isNone(d)||(d.symbol=a,d.symbolLayer=a.symbolLayers.items[c])}},enumerable:!0,configurable:!0});b.prototype.doLoad=function(c){return a.__awaiter(this,
void 0,void 0,function(){var d,b,f,g,p,r=this;return a.__generator(this,function(q){switch(q.label){case 0:d=this._symbol.symbolLayers;this._backgroundLayers&&(d=this._backgroundLayers.concat(d));for(b=d.length;this.symbolLayers.length<d.length;)this.symbolLayers.push(null);this.symbolLayers.length=d.length;f=function(a){var f=d.getItemAt(a);if(!1===f.enabled)return"continue";k.renderPriority=1-(1+a)/b;k.renderPriorityStep=1/b;k.ignoreDrivers=f._ignoreDrivers;var h=l.make(g.symbol,f,g._context,k);
e.onAbortOrThrow(c,function(){r.symbolLayers[a]=null;h.destroy()});g.symbolLayers[a]=h};g=this;for(p=0;p<b;p++)f(p);return[4,m.forEach(this.symbolLayers,function(c,d){return a.__awaiter(r,void 0,void 0,function(){return a.__generator(this,function(a){switch(a.label){case 0:if(!h.isSome(c))return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,c.load()];case 2:return a.sent(),[3,4];case 3:return a.sent(),this.symbolLayers[d]=null,[3,4];case 4:return[2]}})})})];case 1:q.sent();e.throwIfAborted(c);
if(this.symbolLayers.length&&!this.symbolLayers.some(function(a){return!!a}))throw Error();return[2]}})})};b.prototype.getSymbolLayerSize=function(a){a=this.symbolLayers[a];return h.isSome(a)?a.getCachedSize():null};b.prototype.createGraphics3DGraphic=function(a,c){for(var d=a.graphic,b=Array(this.symbolLayers.length),e=0;e<this.symbolLayers.length;e++){var g=this.symbolLayers[e];b[e]=h.isSome(g)?g.createGraphics3DGraphic(a):null}return new f(d,c||this,b,a.layer,this._context.arcade||this._context.featureExpressionInfoContext&&
this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null)};Object.defineProperty(b.prototype,"complexity",{get:function(){return c.totalSymbolComplexities(this.symbolLayers.map(function(a){return h.isSome(a)&&a.complexity}))},enumerable:!0,configurable:!0});b.prototype.globalPropertyChanged=function(a,c){for(var d=this.symbolLayers.length,b=function(d){var b=e.symbolLayers[d],f=function(a){a=a._graphics[d];return a instanceof g?a:null};if(h.isSome(b)&&
!b.globalPropertyChanged(a,c,f))return{value:!1}},e=this,f=0;f<d;f++){var k=b(f);if("object"===typeof k)return k.value}return!0};b.prototype.applyRendererDiff=function(a,c){return 1!==this.loadStatus?!1:this.symbolLayers.reduce(function(d,b){return d&&(h.isNone(b)||b.applyRendererDiff(a,c))},!0)};b.prototype.prepareSymbolPatch=function(a){if(2!==this.loadStatus&&"partial"===a.diff.type){var c=a.diff.diff;if(c.symbolLayers&&"partial"===c.symbolLayers.type){var d=c.symbolLayers.diff;this.symbolLayers.forEach(function(c,
b){var e;if(!h.isNone(c)){var f=d[b];if(f){var g={diff:f,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};c.prepareSymbolLayerPatch(g);(e=a.symbolStatePatches).push.apply(e,g.symbolLayerStatePatches);g.graphics3DGraphicPatches.length&&a.graphics3DGraphicPatches.push(function(a,c){var d=a._graphics[b];h.isSome(d)&&g.graphics3DGraphicPatches.forEach(function(a){return a(d,c)})})}}})}}};b.prototype.updateGeometry=function(a,c){for(var d=0;d<this.symbolLayers.length;d++){var b=this.symbolLayers[d];
if(!h.isNone(b)){var e=a._graphics[d];if(h.isSome(e)&&!b.updateGeometry(e,c))return!1}}return!0};b.prototype.onRemoveGraphic=function(a){for(var c=0;c<this.symbolLayers.length;c++){var d=this.symbolLayers[c];if(!h.isNone(d)){var b=a._graphics[c];if(h.isSome(b))d.onRemoveGraphic(b)}}};b.prototype.getFastUpdateStatus=function(){var a=0,c=0,d=0;this.symbolLayers.forEach(function(b){h.isNone(b)||(0===b.loadStatus?a++:b.isFastUpdatesEnabled()?d++:c++)});return{loading:a,slow:c,fast:d}};b.prototype.destroy=
function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{this.abortLoad();for(var a=0,c=this.symbolLayers;a<c.length;a++){var d=c[a];h.isSome(d)&&d.destroy()}this.symbolLayers.length=0;this._destroyed=!0}};Object.defineProperty(b.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0});return b}(d.Loadable)})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("require exports tslib ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./featureExpressionInfoUtils ../../support/projectionUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v){var z=new e(Array,function(a){return k.set(a,k.ZERO)},null,10,5),w=p.create();return function(){function b(a,c,d,b,e){this._labelGraphics=[];this._auxiliaryGraphics=[];for(var f=Array(2),g=0;g<f.length;g++)f[g]=Array(4);this._visibilityFlags=f;this._featureExpressionFeature=null;this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1};this._extent=null;this.isElevationSource=!1;++c.referenced;this.graphics3DSymbol=c;this.graphic=a;this._graphics=d;this._featureExpressionFeature=
e?u.createFeature(e,a,b):null;a=0;for(c=this._graphics;a<c.length;a++)d=c[a],h.isSome(d)&&(this.isElevationSource=this.isElevationSource||d.isElevationSource)}Object.defineProperty(b.prototype,"labelGraphics",{get:function(){return this._labelGraphics},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"extent",{get:function(){return this._extent},enumerable:!0,configurable:!0});b.prototype.initialize=function(a,c,d){var b=this;this._layer=c;this._stage=a;this.forEachSymbolLayerGraphic(function(e){e.initialize(a,
c,d);e.setVisibility(b.isVisible())})};b.prototype.destroy=function(){this.forEachSymbolLayerGraphic(function(a){return a.destroy()});this._auxiliaryGraphics=this._graphics=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=null};Object.defineProperty(b.prototype,"destroyed",{get:function(){return null==this._graphics},enumerable:!0,configurable:!0});b.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(a){return a.destroy()});this._labelGraphics.length=0};b.prototype.addLabelGraphic=
function(a,c,d){this._labelGraphics.push(a);a.initialize(c,d);a.setVisibility(this.isVisible(1))};b.prototype.addAuxiliaryGraphic=function(a){this._auxiliaryGraphics.push(a);this._layer&&(a.initialize(this._stage,this._layer),a.setVisibility(this.isVisible()))};Object.defineProperty(b.prototype,"isDraped",{get:function(){var a=!1;this.forEachSymbolLayerGraphic(function(c){"draped"===c.type&&(a=!0)});return a},enumerable:!0,configurable:!0});b.prototype.isVisible=function(a,c){void 0===a&&(a=0);for(var d=
0;d<=a;d++)for(var b=this._visibilityFlags[d],e=0;e<b.length;++e)if(!1===b[e]&&e!==c)return!1;return!0};b.prototype.hasVisibilityFlag=function(a,c){return null!=this._visibilityFlags[c][a]};b.prototype.setVisibilityFlag=function(a,c,d){var b=this.isVisible(d);this._visibilityFlags[d][a]=c;var e=this.isVisible(d);if(b===e)return!1;if(1===d)this.forEachLabelGraphic(function(a){return a.setVisibility(e)});else{this.forEachSymbolLayerGraphic(function(a){return a.setVisibility(e)});var f=this.isVisible(1);
this.forEachLabelGraphic(function(a){return a.setVisibility(f)})}return!0};b.prototype.clearVisibilityFlag=function(a,c){void 0===c&&(c=0);return this.setVisibilityFlag(a,void 0,c)};b.prototype.getBSRadius=function(){var a=0;this.forEachSymbolLayerGraphic(function(c){a=Math.max(a,c.getBSRadius())});return a};b.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=d.vec3f64.create());if(0===this._graphics.length)return l.vec3.set(a,0,0,0),a;var c=this._graphics[0];return h.isSome(c)?c.getCenterObjectSpace(a):
a};b.prototype.computeExtent=function(a){if(!this._extent){var c=this.graphic.geometry;if(h.isNone(c))return!1;this._extent=p.create();r.computeAABR(c,this._extent);c=c.spatialReference;if(!c.equals(a)&&!v.boundingRectToBoundingRect(this._extent,c,this._extent,a))return this._extent=null,!1}return!0};b.prototype.getAsOptimizedGeometry=function(a,c){if(this._optimizedGeometry.geometry&&this._optimizedGeometry.hasZ===a&&this._optimizedGeometry.hasM===c)return this._optimizedGeometry.geometry;this._optimizedGeometry.geometry=
this._convertGraphicToOptimizedGeometry(this.graphic,a,c);this._optimizedGeometry.hasZ=a;this._optimizedGeometry.hasM=c;return this._optimizedGeometry.geometry};b.prototype._convertGraphicToOptimizedGeometry=function(a,d,b){a=a.geometry;if("mesh"===a.type||"extent"===a.type)a=c.fromExtent("mesh"===a.type?a.extent:a);return t.convertFromGeometry(a,d,b)};Object.defineProperty(b.prototype,"usedMemory",{get:function(){var a=this,c=r.estimateAttributesObjectSize(this.graphic.attributes);this.forEachSymbolLayerGraphic(function(d){var b=
d.graphics3DSymbolLayer.complexity;d="draped"===d.type?b.memory.draped:b.memory;c+=d.bytesPerFeature;d.bytesPerCoordinate&&(c+=r.numVertices(a.graphic.geometry)*d.bytesPerCoordinate)});return c},enumerable:!0,configurable:!0});b.prototype.computeAttachmentOrigin=function(){for(var a={render:{origin:d.vec3f64.create(),num:0},draped:{origin:g.vec2f64.create(),num:0}},c=0,b=this._graphics;c<b.length;c++){var e=b[c];h.isNone(e)||e.computeAttachmentOrigin(a)}a.render.num&&l.vec3.scale(a.render.origin,
a.render.origin,1/a.render.num);a.draped.num&&f.vec2.scale(a.draped.origin,a.draped.origin,1/a.draped.num);return a};b.prototype.getProjectedBoundingBox=function(c,d,b,e,f){return a.__awaiter(this,void 0,void 0,function(){var g=this;return a.__generator(this,function(l){switch(l.label){case 0:return f||(f={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),f.boundingBox?k.empty(f.boundingBox):f.boundingBox=k.empty(),f.requiresDrapedElevation=!1,[4,m.forEach(this._graphics,function(l){return a.__awaiter(g,
void 0,void 0,function(){var g,p,m;return a.__generator(this,function(a){switch(a.label){case 0:if(h.isNone(l))return[2];g="draped"===l.type?d:c;p=z.acquire();return[4,l.getProjectedBoundingBox(g,b,f.screenSpaceObjects,e,p)];case 1:return m=a.sent(),isFinite(m[2])&&isFinite(m[5])||(f.requiresDrapedElevation=!0),m&&k.expand(f.boundingBox,p),z.release(p),[2]}})})})];case 1:return l.sent(),k.allFinite(f.boundingBox)||p.allFinite(k.toRect(f.boundingBox,w))?[2,f]:[2,null]}})})};b.prototype.needsElevationUpdates=
function(){for(var a=0,c=this._graphics;a<c.length;a++){var d=c[a];if(h.isSome(d)&&("object3d"===d.type||"lod-instance"===d.type)&&d.needsElevationUpdates)return!0}a=0;for(c=this._labelGraphics;a<c.length;a++)if((d=c[a])&&d.needsElevationUpdates)return!0;return!1};b.prototype.alignWithElevation=function(a,c,d){var b=this;this.forEachRenderedGraphic(function(e){"object3d"!==e.type&&"lod-instance"!==e.type||e.alignWithElevation(a,c,b._featureExpressionFeature,d)})};b.prototype.addObjectStateSet=function(a,
c){this.forEachSymbolLayerGraphic(function(d){return d.addObjectState(a,c)})};b.prototype.removeObjectState=function(a){this.forEachSymbolLayerGraphic(function(c){return c.removeObjectState(a)})};b.prototype.forEachGraphicList=function(a,c){a.forEach(function(a){return a&&c(a)})};b.prototype.forEachSymbolLayerGraphic=function(a){this.forEachGraphicList(this._graphics,a);this.forEachGraphicList(this._auxiliaryGraphics,a)};b.prototype.forEachLabelGraphic=function(a){this.forEachGraphicList(this._labelGraphics,
a)};b.prototype.forEachRenderedGraphic=function(a){this.forEachSymbolLayerGraphic(a);this.forEachLabelGraphic(a)};return b}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("require exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k){Object.defineProperty(b,"__esModule",{value:!0});var p=a.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");b.make=function(a,c,d,b){var e=t[a.type]&&t[a.type][c.type]||r[c.type];return e?new e(a,c,d,b):(p.error("GraphicsLayerFactory#make","unknown symbol type "+c.type),null)};var r={icon:h.default,object:g.default,line:e.default,path:l.default,fill:d.default,extrude:m.default,text:c.default,water:k.default};b.setSymbolClass=function(a,c){r[a]=
c};var t={"mesh-3d":{fill:f.default}}})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("require exports tslib ../../../../core/Error ../../../../core/maybe ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../../../renderers/support/renderingInfoUtils ./elevationAlignmentUtils ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./polygonUtils ../support/edgeUtils ../../support/projectionUtils ../../support/buffer/BufferView ../../support/buffer/math/vec3 ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L){function M(a,d,b,e,f,g,k,l,h,p,m,r,q,t){var w=b.length/3,u=0;m+=2*e.count;var A=e.index,v=e.count,y=h,z=m;c.vec3.copy(Y,q);var B=0<r?1:-1,A=3*A,C=y;q=3*C;for(var H=y+v,y=3*H,F=0;F<v;++F)t&&(Y[0]=a[A+0],Y[1]=a[A+1],Y[2]=a[A+2],c.vec3.normalize(Y,Y)),f[q+0]=a[A+0],f[q+1]=a[A+1],f[q+2]=a[A+2],g[q+0]=d[A+0],g[q+1]=d[A+1],g[q+2]=d[A+2],k[q+0]=-B*Y[0],k[q+1]=-B*Y[1],k[q+2]=-B*Y[2],l[C]=0,f[y+0]=a[A+0]+r*Y[0],f[y+1]=a[A+1]+r*Y[1],f[y+
2]=a[A+2]+r*Y[2],g[y+0]=d[A+0],g[y+1]=d[A+1],g[y+2]=d[A+2],k[y+0]=B*Y[0],k[y+1]=B*Y[1],k[y+2]=B*Y[2],l[H]=r,q+=3,y+=3,A+=3,C+=1,H+=1;A=0;q=3*z;y=3*(z+w);q=3*(z+w);y=3*z;a=da;d=fa;0>r&&(a=fa,d=da);for(F=0;F<w;++F)p[q+0]=b[A+a[0]],p[q+1]=b[A+a[1]],p[q+2]=b[A+a[2]],p[y+0]=b[A+d[0]]+v,p[y+1]=b[A+d[1]]+v,p[y+2]=b[A+d[2]]+v,q+=3,y+=3,A+=3;h+=2*e.count;m=m+2*w-(2*e.count+2*w);Q(f,g,l,k,u,e.pathLengths[0],e.count,h,p,m,r);h+=4*e.pathLengths[0];m+=2*e.pathLengths[0];u+=e.pathLengths[0];for(b=1;b<e.pathLengths.length;++b)Q(f,
g,l,k,u,e.pathLengths[b],e.count,h,p,m,r),h+=4*e.pathLengths[b],m+=2*e.pathLengths[b],u+=e.pathLengths[b]}function N(a,c,d,b,e,f,g){b[f]=b[g];g*=3;f*=3;a[f+0]=a[g+0];a[f+1]=a[g+1];a[f+2]=a[g+2];c[f+0]=c[g+0];c[f+1]=c[g+1];c[f+2]=c[g+2];d[f+0]=e[0];d[f+1]=e[1];d[f+2]=e[2]}function Q(a,d,b,e,f,g,k,l,h,p,m){var r=f,q=f+1,t=f+k,w=f+k+1,u=l,A=l+1,y=l+2*g;l=l+2*g+1;0>m&&(r=f+k+1,w=f);p*=3;for(var v=0;v<g;++v){v===g-1&&(0<m?(q=f,w=f+k):(q=f,r=f+k));var z=a,B=r,C=q,H=t,F=W,B=3*B,C=3*C,H=3*H;c.vec3.set(O,
z[B++],z[B++],z[B++]);c.vec3.set(U,z[C++],z[C++],z[C++]);c.vec3.set(P,z[H++],z[H++],z[H++]);c.vec3.subtract(ba,U,O);c.vec3.subtract(V,P,O);c.vec3.cross(F,V,ba);c.vec3.normalize(F,F);N(a,d,e,b,W,u,r);N(a,d,e,b,W,A,q);N(a,d,e,b,W,y,t);N(a,d,e,b,W,l,w);h[p++]=u;h[p++]=y;h[p++]=l;h[p++]=u;h[p++]=l;h[p++]=A;r++;q++;t++;w++;u+=2;A+=2;y+=2;l+=2}}function R(a,b,e,f){a=a.stageObject;ga.spatialReference=e.spatialReference;for(var g=a.geometryRecords,k=g.length,h="absolute-height"!==b.mode,p=0,m=a.objectTransformation,
r=l.mat4.invert(d.mat4f64.create(),m),q=0;q<k;q++){var t=g[q].geometry;t.invalidateBoundingInfo();for(var w=t.data.getVertexAttr(),t=w[E.VertexAttrConstants.POSITION].data,A=w[E.VertexAttrConstants.SIZE].data,w=w.mapPos.data,y=t.length/3,v=0,z=0,B=!1,C=0,H=0;H<y;H++){ga.x=w[z];ga.y=w[z+1];ga.z=w[z+2];T[0]=t[v];T[1]=t[v+1];T[2]=t[v+2];var F=u.evaluateElevationAlignmentAtPoint(ga,e,b,f,h?ka:null);h&&(C+=ka.sampledElevation);c.vec3.set(X,t[v+0],t[v+1],t[v+2]);c.vec3.transformMat4(X,X,m);f.setAltitude(F+
A[v/3],X);c.vec3.transformMat4(X,X,r);t[v]=X[0];t[v+1]=X[1];t[v+2]=X[2];F=.01/f.unitInMeters;if(Math.abs(T[0]-t[v])>F||Math.abs(T[1]-t[v+1])>F||Math.abs(T[2]-t[v+2])>F)B=!0;z+=3;v+=3}B&&a.geometryVertexAttrsUpdated(q);p+=C/y}return p/k}Object.defineProperty(b,"__esModule",{value:!0});n=function(c){function b(a,d,b,e){a=c.call(this,a,d,b,e)||this;a.ensureDrapedStatus(!1);return a}a.__extends(b,c);b.prototype.doLoad=function(){return a.__awaiter(this,void 0,void 0,function(){var c,d,b,e,f,g;return a.__generator(this,
function(a){if(!this._drivenProperties.size&&(c=y.validateSymbolLayerSize(this._getSymbolSize())))throw new m("graphics3dextrudesymbollayer:invalid-size",c);d=h.get(this.symbolLayer,"material","color");b=this._getCombinedOpacityAndColor(d);e=k.vec3f64.fromArray(b);f=b[3];g={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:e,ambient:e,opacity:f,transparent:1>f||this.needsDrivenTransparentPass,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,
offsetTransparentBackfaces:!0};this._material=new L(g,this._getIdHint("_3dlinemat"));this._context.stage.add(3,this._material);return[2]})})};b.prototype.destroy=function(){c.prototype.destroy.call(this);this._material&&this._context.stage.remove(3,this._material.id)};b.prototype.createGraphics3DGraphic=function(a){var c=a.graphic;if(!this._validateGeometryType(c.geometry,b.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(c.geometry))return null;var d="graphic"+c.uid,e=this._getVertexOpacityAndColor(a.renderingInfo,
Float32Array,255),f=this.setGraphicElevationContext(c,new z.ElevationContext);return this._createAs3DShape(c,a.renderingInfo,e,f,d,c.uid)};b.prototype.layerOpacityChanged=function(a,c){var d=this,b=h.get(this.symbolLayer,"material","color"),b=this._getCombinedOpacity(b);this._material.setParameterValues({opacity:b,transparent:1>b||this.needsDrivenTransparentPass});var e=this._getLayerOpacity();a.forEach(function(a){a=c(a);h.isSome(a)&&a.layerOpacityChanged(e,d._context.isAsync)});return!0};b.prototype.layerElevationInfoChanged=
function(a,c){return this.updateGraphics3DGraphicElevationInfo(a,c,v.needsElevationUpdates3D)};b.prototype.slicePlaneEnabledChanged=function(a,c){var d=this;this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});a.forEach(function(a){a=c(a);h.isSome(a)&&a.slicePlaneEnabledChanged(d._context.slicePlaneEnabled,d._context.isAsync)});return!0};b.prototype.physicalBasedRenderingChanged=function(){this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0});return!0};b.prototype.pixelRatioChanged=function(){return!0};b.prototype._getExtrusionSize=function(a){var c;a=a.size&&this._drivenProperties.size?null!==(c=t.getDriverAxisSizeValue(a.size,2))&&void 0!==c?c:0:this._getSymbolSize();return a/=this._context.renderCoordsHelper.unitInMeters};b.prototype._getSymbolSize=function(){var a;return null!==(a=this.symbolLayer.size)&&void 0!==a?a:1};b.prototype._createAs3DShape=function(a,c,b,m,r,q){var t=A.geometryAsPolygon(a.geometry);if(h.isNone(t))return null;
a=[];var u=[],z=[],B=p.create(),E="global"===this._context.renderCoordsHelper.type,G=this._getExtrusionSize(c),P=k.vec3f64.create();E||this._context.renderCoordsHelper.worldUpAtPosition(null,P);c=A.geometryToRenderInfo(t,this._context.elevationProvider,this._context.renderCoordsHelper,m);this._logGeometryCreationWarnings(c,t.rings,"rings","ExtrudeSymbol3DLayer");if(0===t.rings.length||!t.rings.some(function(a){return 0<a.length}))return null;var n=y.computeCentroid(t);if(h.isNone(n))return null;var L=
d.mat4f64.create();C.computeLinearTransformation(t.spatialReference,[n.x,n.y,0],L,this._context.renderCoordsHelper.spatialReference);t=d.mat4f64.create();l.mat4.invert(t,L);n=g.mat3f64.create();f.mat3.normalFromMat4(n,t);for(var Q=c.polygons,N=c.mapPosition,T=c.position,ba=T.length/3,W=new Float64Array(18*ba),V=new Float64Array(18*ba),ia=new Float64Array(18*ba),ba=new Float64Array(6*ba),O=0,ga=0;ga<Q.length;++ga){var da=Q[ga],U=da.count;if(this._context.clippingExtent&&(p.empty(B),p.expandWithBuffer(B,
da.mapPosition),!p.intersectsClippingArea(B,this._context.clippingExtent)))continue;var Y=e.earcut(da.mapPosition,da.holeIndices,3);if(0!==Y.length){var X=new Uint32Array(6*U+2*Y.length),la=6*U,ka=3*W.BYTES_PER_ELEMENT,ka=new F.BufferViewVec3f64(W.buffer,O*ka,ka,(O+la)*ka),fa=3*V.BYTES_PER_ELEMENT,fa=new F.BufferViewVec3f64(V.buffer,O*fa,fa,(O+la)*fa),Z=new Float64Array(ia.buffer,3*O*ia.BYTES_PER_ELEMENT,3*la),la=new Float64Array(ba.buffer,1*O*ba.BYTES_PER_ELEMENT,1*la);M(T,N,Y,da,ka.typedBuffer,
Z,fa.typedBuffer,la,0,X,0,G,P,E);H.transformMat4(ka,ka,t);H.transformMat3(fa,fa,n);O+=6*U;da=this._createExtrudeGeometry(X,{positions:ka.typedBuffer,elevation:Z,normals:fa.typedBuffer,heights:la},b);da=new I(da,r+"path"+ga);a.push(da);u.push(this._material);z.push(d.mat4f64.IDENTITY)}}if(0===a.length)return null;b=new J({geometries:a,materials:u,transformations:z,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:q,isElevationSource:!0},idHint:r});b.objectTransformation=L;r=this._createEdgeMaterial();
r=h.isSome(r)?{baseMaterial:this._material,edgeMaterials:[r],slicePlaneEnabled:this._context.slicePlaneEnabled}:null;a=new w(this,b,a,null,null,R,m,r);a.alignedSampledElevation=c.sampledElevation;a.needsElevationUpdates=v.needsElevationUpdates3D(m.mode);return a};b.prototype._createExtrudeGeometry=function(a,c,d){for(var b=a.length,e=new Uint32Array(b),f=0;f<b;f++)e[f]=0;b={};f={};b[E.VertexAttrConstants.POSITION]=a;b[E.VertexAttrConstants.NORMAL]=a;b[E.VertexAttrConstants.COLOR]=e;f[E.VertexAttrConstants.POSITION]=
{size:3,data:c.positions};f[E.VertexAttrConstants.NORMAL]={size:3,data:c.normals};f[E.VertexAttrConstants.COLOR]={size:4,data:d};f[E.VertexAttrConstants.SIZE]={size:1,data:c.heights};c.elevation&&(f.mapPos={size:3,data:c.elevation},b.mapPos=a);return new G.GeometryData(f,b)};b.prototype._createEdgeMaterial=function(){var a={opacity:this._getLayerOpacity()};return B.createMaterial(this.symbolLayer,a)};b.validGeometryTypes=["polygon","extent"];return b}(q.default);b.Graphics3DExtrudeSymbolLayer=n;var W=
k.vec3f64.create(),O=k.vec3f64.create(),U=k.vec3f64.create(),P=k.vec3f64.create(),ba=k.vec3f64.create(),V=k.vec3f64.create(),T=k.vec3f64.create(),X=k.vec3f64.create(),Y=k.vec3f64.create(),da=[0,2,1],fa=[0,1,2],ga=r.makeDehydratedPoint(0,0,0,null),ka={verticalDistanceToGround:0,sampledElevation:0};b.default=n})},"esri/core/libs/earcut/earcut":function(){define(["require","exports"],function(n,b){function a(a,c,d,b,e){var k;if(e===0<r(a,c,d,b))for(e=c;e<d;e+=b)k=f(e,a[e],a[e+1],k);else for(e=d-b;e>=
c;e-=b)k=f(e,a[e],a[e+1],k);k&&z(k,k.next)&&(g(k),k=k.next);return k}function m(a,c){void 0===c&&(c=a);if(!a)return a;var d;do if(d=!1,a.steiner||!z(a,a.next)&&0!==k(a.prev,a,a.next))a=a.next;else{g(a);a=c=a.prev;if(a===a.next)break;d=!0}while(d||a!==c);return c}function h(a,d,b,f,l,r,w){void 0===w&&(w=0);if(a){!w&&r&&(a=c(a,f,l,r));for(var v=a;a.prev!==a.next;){var y=a.prev,A=a.next,B;if(r)B=e(a,f,l,r);else a:{B=a;var C=B.prev,H=B,F=B.next;if(0<=k(C,H,F))B=!1;else{for(var G=B.next.next,I=G,n=0;G!==
B.prev&&(0===n||G!==I);){n++;if(t(C.x,C.y,H.x,H.y,F.x,F.y,G.x,G.y)&&0<=k(G.prev,G,G.next)){B=!1;break a}G=G.next}B=!0}}if(B)d.push(y.index/b),d.push(a.index/b),d.push(A.index/b),g(a),v=a=A.next;else if(a=A,a===v){if(!w)h(m(a),d,b,f,l,r,1);else if(1===w){w=d;v=b;y=a;do A=y.prev,B=y.next.next,!z(A,B)&&p(A,y,y.next,B)&&u(A,B)&&u(B,A)&&(w.push(A.index/v),w.push(y.index/v),w.push(B.index/v),g(y),g(y.next),y=a=B),y=y.next;while(y!==a);a=y;h(a,d,b,f,l,r,2)}else if(2===w)a:{w=a;do{for(v=w.next.next;v!==w.prev;){if(y=
w.index!==v.index){y=w;A=v;B=void 0;if(B=y.next.index!==A.index&&y.prev.index!==A.index){B=void 0;b:{B=y;do{if(B.index!==y.index&&B.next.index!==y.index&&B.index!==A.index&&B.next.index!==A.index&&p(B,B.next,y,A)){B=!0;break b}B=B.next}while(B!==y);B=!1}B=!B}C=void 0;if(C=B&&u(y,A)&&u(A,y)){B=y;C=!1;H=(y.x+A.x)/2;A=(y.y+A.y)/2;do B.y>A!==B.next.y>A&&B.next.y!==B.y&&H<(B.next.x-B.x)*(A-B.y)/(B.next.y-B.y)+B.x&&(C=!C),B=B.next;while(B!==y)}y=C}if(y){a=q(w,v);w=m(w,w.next);a=m(a,a.next);h(w,d,b,f,l,
r);h(a,d,b,f,l,r);break a}v=v.next}w=w.next}while(w!==a)}break}}}}function e(a,c,d,b){var e=a.prev,f=a.next;if(0<=k(e,a,f))return!1;var g=e.x>a.x?e.x>f.x?e.x:f.x:a.x>f.x?a.x:f.x,l=e.y>a.y?e.y>f.y?e.y:f.y:a.y>f.y?a.y:f.y,h=v(e.x<a.x?e.x<f.x?e.x:f.x:a.x<f.x?a.x:f.x,e.y<a.y?e.y<f.y?e.y:f.y:a.y<f.y?a.y:f.y,c,d,b);c=v(g,l,c,d,b);d=a.prevZ;for(b=a.nextZ;d&&d.z>=h&&b&&b.z<=c;){if(d!==a.prev&&d!==a.next&&t(e.x,e.y,a.x,a.y,f.x,f.y,d.x,d.y)&&0<=k(d.prev,d,d.next))return!1;d=d.prevZ;if(b!==a.prev&&b!==a.next&&
t(e.x,e.y,a.x,a.y,f.x,f.y,b.x,b.y)&&0<=k(b.prev,b,b.next))return!1;b=b.nextZ}for(;d&&d.z>=h;){if(d!==a.prev&&d!==a.next&&t(e.x,e.y,a.x,a.y,f.x,f.y,d.x,d.y)&&0<=k(d.prev,d,d.next))return!1;d=d.prevZ}for(;b&&b.z<=c;){if(b!==a.prev&&b!==a.next&&t(e.x,e.y,a.x,a.y,f.x,f.y,b.x,b.y)&&0<=k(b.prev,b,b.next))return!1;b=b.nextZ}return!0}function f(a,c,d,b){a=new y(a,c,d);b?(a.next=b.next,a.prev=b,b.next.prev=a,b.next=a):(a.prev=a,a.next=a);return a}function g(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&
(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function l(a){var c=a,d=a;do{if(c.x<d.x||c.x===d.x&&c.y<d.y)d=c;c=c.next}while(c!==a);return d}function d(a,c){var d=c,b=a.x,e=a.y,f=-Infinity,g;do{if(e<=d.y&&e>=d.next.y&&d.next.y!==d.y){var k=d.x+(e-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(k<=b&&k>f){f=k;if(k===b){if(e===d.y)return d;if(e===d.next.y)return d.next}g=d.x<d.next.x?d:d.next}}d=d.next}while(d!==c);if(!g)return null;if(b===f)return g.prev;c=g;for(var k=g.x,l=g.y,h=Infinity,p,d=g.next;d!==
c;)b>=d.x&&d.x>=k&&b!==d.x&&t(e<l?b:f,e,k,l,e<l?f:b,e,d.x,d.y)&&(p=Math.abs(e-d.y)/(b-d.x),(p<h||p===h&&d.x>g.x)&&u(d,a)&&(g=d,h=p)),d=d.next;return g}function c(a,d,b,e){for(var f=void 0;f!==a;f=f.next){f=f||a;null===f.z&&(f.z=v(f.x,f.y,d,b,e));if(f.prev.next!==f||f.next.prev!==f)return f.prev.next=f,f.next.prev=f,c(a,d,b,e);f.prevZ=f.prev;f.nextZ=f.next}a.prevZ.nextZ=null;a.prevZ=null;a:for(b=1;;){e=a;f=void 0;d=a=null;for(var g=0;e;){g++;for(var f=e,k=0;k<b&&f;k++)f=f.nextZ;for(var l=b;0<k||0<
l&&f;){var h=void 0;0===k?(h=f,f=f.nextZ,l--):0!==l&&f?e.z<=f.z?(h=e,e=e.nextZ,k--):(h=f,f=f.nextZ,l--):(h=e,e=e.nextZ,k--);d?d.nextZ=h:a=h;h.prevZ=d;d=h}e=f}d.nextZ=null;b*=2;if(2>g)break a}return a}function k(a,c,d){return(c.y-a.y)*(d.x-c.x)-(c.x-a.x)*(d.y-c.y)}function p(a,c,d,b){return z(a,c)&&z(d,b)||z(a,b)&&z(d,c)?!0:0<k(a,c,d)!==0<k(a,c,b)&&0<k(d,b,a)!==0<k(d,b,c)}function r(a,c,d,b){for(var e=0,f=d-b;c<d;c+=b)e+=(a[f]-a[c])*(a[c+1]+a[f+1]),f=c;return e}function t(a,c,d,b,e,f,g,k){return 0<=
(e-g)*(c-k)-(a-g)*(f-k)&&0<=(a-g)*(b-k)-(d-g)*(c-k)&&0<=(d-g)*(f-k)-(e-g)*(b-k)}function u(a,c){return 0>k(a.prev,a,a.next)?0<=k(a,c,a.next)&&0<=k(a,a.prev,c):0>k(a,c,a.prev)||0>k(a,a.next,c)}function v(a,c,d,b,e){a=32767*(a-d)*e;c=32767*(c-b)*e;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;c=(c|c<<8)&16711935;c=(c|c<<4)&252645135;c=(c|c<<2)&858993459;return(a|a<<1)&1431655765|((c|c<<1)&1431655765)<<1}function z(a,c){return a.x===c.x&&a.y===c.y}function w(a,c){return a.x-c.x}function q(a,
c){var d=new y(a.index,a.x,a.y),b=new y(c.index,c.x,c.y),e=a.next,f=c.prev;a.next=c;c.prev=a;d.next=e;e.prev=d;b.next=d;d.prev=b;f.next=b;b.prev=f;return b}Object.defineProperty(b,"__esModule",{value:!0});b.earcut=function(c,b,e){var f=b&&b.length,g=f?b[0]*e:c.length,k=a(c,0,g,e,!0),p=[];if(!k||k.next===k.prev)return p;var r,t,u;if(f){for(var f=[],y=0,v=b.length;y<v;y++){var A=a(c,b[y]*e,y<v-1?b[y+1]*e:c.length,e,!1);A===A.next&&(A.steiner=!0);f.push(l(A))}f.sort(w);for(b=0;b<f.length;b++){y=f[b];
v=k;if(v=d(y,v))y=q(v,y),m(y,y.next);k=m(k,k.next)}}if(c.length>80*e){r=u=c[0];t=f=c[1];for(b=e;b<g;b+=e)y=c[b],v=c[b+1],r=Math.min(r,y),t=Math.min(t,v),u=Math.max(u,y),f=Math.max(f,v);u=Math.max(u-r,f-t);u=0!==u?1/u:0}h(k,p,e,r,t,u);return p};b.deviation=function(a,c,d,b){var e=c&&c.length,f=Math.abs(r(a,0,e?c[0]*d:a.length,d));if(e)for(var e=0,g=c.length;e<g;e++)f-=Math.abs(r(a,c[e]*d,e<g-1?c[e+1]*d:a.length,d));for(e=c=0;e<b.length;e+=3){var g=b[e]*d,k=b[e+1]*d,l=b[e+2]*d;c+=Math.abs((a[g]-a[l])*
(a[k+1]-a[g+1])-(a[g]-a[k])*(a[l+1]-a[g+1]))}return 0===f&&0===c?0:Math.abs((c-f)/f)};var y=function(){return function(a,c,d){this.index=a;this.x=c;this.y=d;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}}()})},"esri/renderers/support/renderingInfoUtils":function(){define("require exports tslib ../../Color ../../core/maybe ../visualVariables/support/visualVariableUtils".split(" "),function(n,b,a,m,h,e){function f(a,c){if(!a||a.symbol)return null;c=c&&c.renderer;return a&&h.isSome(c)&&
c.getObservationRenderer?c.getObservationRenderer(a):c}function g(a,c){if(h.isSome(a.symbol))return a.symbol;var d=f(a,c);return h.isSome(d)?d.getSymbol(a,c):null}function l(d,c){return a.__awaiter(this,void 0,void 0,function(){var b;return a.__generator(this,function(e){if(h.isSome(d.symbol))return[2,d.symbol];b=f(d,c);return[2,h.isSome(b)&&b.getSymbolAsync(d,a.__assign(a.__assign({},c),{abortOptions:{signal:c.signal}}))]})})}Object.defineProperty(b,"__esModule",{value:!0});b.getRenderer=f;b.getSymbol=
g;b.getRenderingInfo=function(a,c){var d=f(a,c),b=g(a,c);if(!b)return null;b={renderer:d,symbol:b};if(h.isNone(d)||!("visualVariables"in d)||!d.visualVariables)return b;var l=["proportional","proportional","proportional"],m=0;for(a=e.getVisualVariableValues(d,a,c);m<a.length;m++)switch(d=a[m],c=d.variable,d=d.value,c.type){case "color":b.color=d.toRgba();break;case "size":if("outline"===c.target)b.outlineSize=d;else switch(d=c.useSymbolValue?"symbol-value":d,c.axis){case "width":l[0]=d;break;case "depth":l[1]=
d;break;case "height":l[2]=d;break;case "width-and-depth":l[0]=l[1]=d;break;default:l[0]=l[1]=l[2]=d}break;case "opacity":b.opacity=d;break;case "rotation":switch(c.axis){case "tilt":b.tilt=d;break;case "roll":b.roll=d;break;default:b.heading=d}}if("proportional"!==l[0]||"proportional"!==l[1]||"proportional"!==l[2])b.size=l;return b};b.getSymbolAsync=l;b.getRenderingInfoAsync=function(d,c){return a.__awaiter(this,void 0,void 0,function(){var b,g,h,t,u,v,z,w,q,y,A,B;return a.__generator(this,function(a){switch(a.label){case 0:return b=
f(d,c),[4,l(d,c)];case 1:g=a.sent();if(!g)return[2,null];h={renderer:b,symbol:g};if(!(b&&"visualVariables"in b&&b.visualVariables))return[2,h];t=e.getVisualVariableValues(b,d,c);u=["proportional","proportional","proportional"];v=0;for(z=t;v<z.length;v++)w=z[v],q=w.variable,y=w.value,"color"===q.type?h.color=m.toUnitRGBA(y):"size"===q.type?"outline"===q.target?h.outlineSize=y:(A=q.axis,B=q.useSymbolValue?"symbol-value":y,"width"===A?u[0]=B:"depth"===A?u[1]=B:"height"===A?u[2]=B:u[0]="width-and-depth"===
A?u[1]=B:u[1]=u[2]=B):"opacity"===q.type?h.opacity=y:"rotation"===q.type&&"tilt"===q.axis?h.tilt=y:"rotation"===q.type&&"roll"===q.axis?h.roll=y:"rotation"===q.type&&(h.heading=y);if(isFinite(u[0])||isFinite(u[1])||isFinite(u[2]))h.size=u;return[2,h]}})})};b.getDriverAxisSizeValue=function(a,c){void 0===c&&(c=0);a=a[c];return"number"===typeof a&&isFinite(a)?a:null};b.getDriverAxisSizeValueAny=function(a){for(var c=0;3>c;c++){var d=a[c];if("number"===typeof d)return isFinite(d)?d:0}return 0}})},"esri/views/3d/layers/graphics/polygonUtils":function(){define("require exports ../../../../geometry ../../../../core/maybe ../../../../geometry/support/triangulationUtils ./elevationAlignmentUtils ../../support/projectionUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util".split(" "),
function(n,b,a,m,h,e,f,g,l,d){function c(a,c,d){for(var b=[],e=0;e<a.length;e++){var f=a[e],g=f.index,f=f.count;if(!(1>=f)){var k=3*g,l=k+3*f;b.push({index:g,count:f,position:c.subarray(k,l),mapPosition:d?d.subarray(k,l):void 0})}}return b}function k(a,c,d){for(var b=[],e=function(a,e,f,g){if(1>=e)return"continue";var k=3*a,l=k+3*e;f=f.map(function(c){return c-a});b.push({index:a,count:e,holeIndices:f,pathLengths:g,position:c.subarray(k,l),mapPosition:d?d.subarray(k,l):void 0})},f=0;f<a.length;f++){var g=
a[f];e(g.index,g.count,g.holeIndices,g.pathLengths)}return b}Object.defineProperty(b,"__esModule",{value:!0});b.createColorGeometryData=function(a){var c={},b={};b[d.VertexAttrConstants.POSITION]={size:3,data:a.attributeData.position};c[d.VertexAttrConstants.POSITION]=a.indices;if(m.isSome(a.attributeData.color)){var e=new Uint32Array(a.indices.length);b[d.VertexAttrConstants.COLOR]={size:4,data:a.attributeData.color};c[d.VertexAttrConstants.COLOR]=e}m.isSome(a.attributeData.mapPosition)&&(b.mapPos=
{size:3,data:a.attributeData.mapPosition},c.mapPos=a.indices);return new l.GeometryData(b,c)};b.createWaterGeometryData=function(a){var c={},b={};b[d.VertexAttrConstants.POSITION]={size:3,data:a.attributeData.position};c[d.VertexAttrConstants.POSITION]=a.indices;b[d.VertexAttrConstants.UV0]={size:2,data:a.attributeData.uv0};c[d.VertexAttrConstants.UV0]=a.indices;m.isSome(a.attributeData.mapPosition)&&(b.mapPos={size:3,data:a.attributeData.mapPosition},c.mapPos=a.indices);return new l.GeometryData(b,
c)};b.geometryAsPolygon=function(c){switch(c.type){case "extent":if(c instanceof a.Extent)return a.Polygon.fromExtent(c);break;case "polygon":return c}return null};b.geometryToRenderInfo=function(a,d,b,f){var g=h.pathsToTriangulationInfo(a.rings,a.hasZ,1),l=new Float64Array(g.position.length);a=e.applyPerVertexElevationAlignment(g.position,a.spatialReference,0,l,0,g.position,0,g.position.length/3,d,b,f);d=null!=a;return{position:g.position,mapPosition:l,polygons:k(g.polygons,g.position,l),outlines:c(g.outlines,
g.position,l),projectionSuccess:d,sampledElevation:a}};b.geometryToRenderInfoDraped=function(a,d){var b=h.pathsToTriangulationInfo(a.rings,!1,1);a=f.bufferToBuffer(b.position,a.spatialReference,0,b.position,d,0,b.position.length/3);for(d=2;d<b.position.length;d+=3)b.position[d]=g.DRAPED_Z;return{position:b.position,polygons:k(b.polygons,b.position),outlines:c(b.outlines,b.position),projectionSuccess:a}}})},"esri/geometry/support/triangulationUtils":function(){define(["require","exports","../../core/libs/earcut/earcut",
"./coordsUtils","./meshUtils/deduplicate"],function(n,b,a,m,h){function e(a,d,c){if(1===a.length)return a[0];d=new Float64Array(d);c=new Uint32Array(c);for(var b=0,e=0,f=0,g=0;g<a.length;g++){for(var l=a[g],h=0;h<l.position.length;h++)d[b++]=l.position[h];for(h=0;h<l.faces.length;h++)c[e++]=l.faces[h]+f;f=b/3}return{position:d,faces:c}}function f(a,d,c){for(var b=a.length,e=Array(b),f=Array(b),l=Array(b),h=0,v=0,z=0,w=0,q=0;q<b;++q)w+=a[q].length;for(var w=new Float64Array(3*w),y=0,A=b-1;0<=A;A--){var B=
a[A],C=1===c?!m.isClockwise(B,!1,!1):!1;if(C&&1!==b)e[h++]=B;else{for(var F=B.length,q=0;q<h;++q)F+=e[q].length;q={index:y,pathLengths:Array(h+1),count:F,holeIndices:Array(h)};q.pathLengths[0]=B.length;0<B.length&&(l[z++]={index:y,count:B.length});y=C?g(B,B.length-1,-1,w,y,B.length,d):g(B,0,1,w,y,B.length,d);for(B=0;B<h;++B)C=e[B],q.holeIndices[B]=y,q.pathLengths[B+1]=C.length,0<C.length&&(l[z++]={index:y,count:C.length}),y=g(C,0,1,w,y,C.length,d);h=0;0<q.count&&(f[v++]=q)}}for(B=0;B<h;++B)C=e[B],
0<C.length&&(l[z++]={index:y,count:C.length}),y=g(C,0,1,w,y,C.length,d);v<b&&(f.length=v);z<b&&(l.length=z);return{position:w,polygons:f,outlines:l}}function g(a,d,c,b,e,f,g){e*=3;for(var k=0;k<f;++k){var l=a[d];b[e++]=l[0];b[e++]=l[1];b[e++]=g?l[2]:0;d+=c}return e/3}Object.defineProperty(b,"__esModule",{value:!0});b.triangulate=function(b){var d=f(b.rings,b.hasZ,1),c=[],g=0,l=0;b=function(b){var e=b.index,f=new Float64Array(d.position.buffer,3*e*d.position.BYTES_PER_ELEMENT,3*b.count);b=b.holeIndices.map(function(a){return a-
e});b=new Uint32Array(a.earcut(f,b,3));c.push({position:f,faces:b});g+=f.length;l+=b.length};for(var m=0,t=d.polygons;m<t.length;m++)b(t[m]);b=e(c,g,l);m=h.default(b.position.buffer,6,{originalIndices:b.faces});b.position=new Float64Array(m.buffer);b.faces=m.indices;return b};b.pathsToTriangulationInfo=f})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["require","exports","../../../core/mathUtils"],function(n,b,a){function m(b,f,g){var e=b.byteLength/(4*f),d=new Uint32Array(b,0,
e*f);b=new Uint32Array(e);var c=g&&g.minReduction||0,k=g&&g.originalIndices||null,p=g&&g.componentOffsets||null,m=0;if(p)for(g=0;g<p.length-1;g++){var t=p[g+1]-p[g];t>m&&(m=t)}else m=e;var u=Math.floor(1.1*m)+1;if(null==h||h.length<2*u)h=new Uint32Array(a.nextHighestPowerOfTwo(2*u));for(g=0;g<2*u;g++)h[g]=0;var m=0,v=(t=!!p&&!!k)?k.length:e,z=t?new Uint32Array(k.length):null,w=0!==c?Math.ceil(7.84*1.96/(c*c)*c*(1-c)):v,q=1,y=p?p[1]:v;for(g=0;g<v;g++){if(g===w){var A=1-m/g;if(A+1.96*Math.sqrt(A*(1-
A)/g)<c)return null;w*=2}if(g===y){for(A=0;A<2*u;A++)h[A]=0;if(k)for(A=p[q-1];A<p[q];A++)z[A]=b[k[A]];y=p[++q]}for(var B=t?k[g]:g,A=B*f,C,F=C=0;F<f;F++)C=d[A+F]+C|0,C=C+(C<<11)+(C>>>2)|0;C>>>=0;for(var F=C%u,H=m;0!==h[2*F+1];){if(h[2*F]===C){var I=h[2*F+1]-1,G=I*f;a:{for(var n=0;n<f;n++)if(d[A+n]!==d[G+n]){G=!1;break a}G=!0}if(G){H=b[I];break}}F++;F>=u&&(F-=u)}H===m&&(h[2*F]=C,h[2*F+1]=B+1,m++);b[B]=H}if(0!==c&&1-m/e<c)return null;if(t){for(g=p[q-1];g<z.length;g++)z[g]=b[k[g]];b=z}e=new Uint32Array(f*
m);for(g=m=0;g<v;g++)if(b[g]===m){A=(t?k[g]:g)*f;c=d;p=A;u=e;z=m*f;w=f;for(q=0;q<w;q++)u[z+q]=c[p+q];m++}if(k&&!t){f=new Uint32Array(k.length);for(g=0;g<f.length;g++)f[g]=b[k[g]];b=f}return{buffer:e.buffer,indices:b,uniqueCount:m}}Object.defineProperty(b,"__esModule",{value:!0});b.deduplicate=m;var h=null;b.default=m})},"esri/views/3d/terrain/OverlayRenderer":function(){define("require exports tslib ../../../core/Accessor ../../../core/Handles ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/SetUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3f64 ../support/debugFlags ../webgl-engine/core/shaderTechnique/CommonUniformStore ../webgl-engine/core/shaderTechnique/ShaderTechniqueRepository ../webgl-engine/lib/AutoDisposable ../webgl-engine/lib/Camera ../webgl-engine/lib/GLMaterialRep ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/RenderContext ../webgl-engine/lib/renderStats ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/TextureTechnique ../webgl-engine/lighting/Lightsources ../webgl-engine/lighting/SceneLighting ../webgl-engine/materials/lineStippleUtils ../../webgl/FramebufferObject ../../webgl/Texture ../../webgl/Util".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L,M,N){Object.defineProperty(b,"__esModule",{value:!0});var Q=e.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer");n=function(e){function m(){var a=null!==e&&e.apply(this,arguments)||this;a._hasHighlights=!1;a._rendersOccluded=!1;a._hasWater=!1;a._lighting=new J.SceneLighting;a._localOrigins=new A;a._handles=new h;a._layerRenderers=new Map;a._sortedLayerRenderersDirty=!1;a._sortedLayerRenderers=new l;a._stats=new F.RenderStatsAggregator;
a._geometries=new Map;a._renderTargets={};a._uniqueIdx=0;a.longitudeCyclical=null;return a}a.__extends(m,e);m.prototype.initialize=function(){var a=this;this._rctx=this.renderView.renderingContext;this._renderContext=new C(this._rctx,null,null,null,null,null);this._stippleTextureRepository=new E.StippleTextureRepository;this.waterTextureRepository=this.renderView.waterTextureRepository;this._shaderTechniqueRepository=new v.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:1,commonUniformStore:new u.CommonUniformStore,
stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository});c.init(this.waterTextureRepository,"loadingState",function(){return a.emitContentChanged()});this._materialRepository=new q(this.renderView.textureRepository,this._shaderTechniqueRepository);this._materialRepository.onMaterialChanged=function(c){0<(c.renderOccluded&b.overlayRenderOccludedFlag)!==a._rendersOccluded&&a.updateRendersOccluded();a.emitContentChanged();a.notifyChange("updating")};
this._compositingHelper=this.renderView.compositingHelper;this._bindParameters={slot:null,fovY:0,highlightDepthTexture:y.createEmptyDepthTexture(this._rctx),nearFar:[O.near,O.far],origin:null,pixelRatio:null,proj:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,view:null,viewInvTransp:null,viewport:null,hasOccludees:!1,linearDepthTexture:null,linearDepthTextureID:0,lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,ssrViewMat:null,rpProjectionMat:null,ssrEnabled:!1};
this._lighting.set({lights:[new G.AmbientLight(r.vec3f64.fromValues(1,1,1))],groundLightingFactor:1,globalFactor:0})};m.prototype.dispose=function(){this._handles.destroy();this._layerRenderers.forEach(function(a){return a.dispose()});this._layerRenderers.clear();for(var a in this._renderTargets)this._renderTargets[a].dispose();this._renderTargets=null;this._bindParameters.highlightDepthTexture.dispose();this._bindParameters.highlightDepthTexture=null;this._shaderTechniqueRepository.dispose();this._shaderTechniqueRepository=
null};m.prototype.disposeRenderTarget=function(a){var c=this._renderTargets[a];c&&c.dispose();delete this._renderTargets[a]};Object.defineProperty(m.prototype,"updating",{get:function(){return this._sortedLayerRenderersDirty||f.someMap(this._layerRenderers,function(a){return a.updating})||this.waterTextureRepository.updating},enumerable:!0,configurable:!0});m.prototype.commitChanges=function(){var a=this,c=!1;this._layerRenderers.forEach(function(d,b){d.commitChanges()&&(c=!0);d.isEmpty&&(a._layerRenderers.delete(b),
a._sortedLayerRenderersDirty=!0,a._handles.remove(b))});this._sortedLayerRenderersDirty&&(this.updateSortedLayerRenderers(),c=!0);this.notifyChange("updating");c&&(this.emitContentChanged(),this.updateHasHighlights(),this.updateRendersOccluded(),this.updateHasWater())};m.prototype.getRenderTargetTexture=function(a){return(a=this._renderTargets[a])?a.colorTexture:null};m.prototype.addGeometries=function(a,c,d){for(var b=0;b<a.length;b++){var e=a[b];null==e.origin&&(e.origin=this._localOrigins.getOrigin(e.center));
e.uniqueName||(e.uniqueName="ov:"+this._uniqueIdx++);this._geometries.set(e.uniqueName,e)}this.ensureLayerRenderer(c).add(a);2===d&&this.notifyGraphicUpdate(a,c,2)};m.prototype.removeGeometries=function(a,c,d){for(var b=0;b<a.length;b++)this._geometries.delete(a[b].uniqueName);(b=this._layerRenderers.get(c))?(b.remove(a),2===d&&this.notifyGraphicUpdate(a,c,2)):Q.warn("Attempted to remove geometry for nonexistent layer")};m.prototype.updateGeometries=function(a,c,d){var b=this._layerRenderers.get(c);
b?(b.modify(a,d),this.notifyUpdateGeometries(a,c,d)):Q.warn("Attempted to update geometry for nonexistent layer")};m.prototype.notifyUpdateGeometries=function(a,c,d){this.notifyGraphicUpdate(a,c,4===d||2===d?2:1===d?1:0)};m.prototype.notifyGraphicUpdate=function(a,c,d){if(0!==d)for(var b=-1,e=0;e<a.length;e++){var f=a[e].data.graphicUid;f!==b&&(c.notifyGraphicUpdate(f,d),b=f)}};m.prototype.updateHighlights=function(a,c){(c=this._layerRenderers.get(c))?c.modify(a,8):Q.warn("Attempted to update highlights for nonexistent layer")};
m.prototype.isEmpty=function(){return 0===this._geometries.size&&!t.OVERLAY_DRAW_DEBUG_TEXTURE};Object.defineProperty(m.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"hasWater",{get:function(){return this._hasWater},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"rendersOccluded",{get:function(){return this._rendersOccluded},enumerable:!0,configurable:!0});m.prototype.updateLogic=function(a){var c=
!1;this._layerRenderers.forEach(function(d){d.updateLogic(a)&&(c=!0)});return c};m.prototype.updateLayerOrder=function(){this._sortedLayerRenderersDirty=!0};m.prototype.draw=function(a,c){return this.drawPass(0,a,c)};m.prototype.drawWithoutRasterImage=function(a,c){return this.drawPass(0,a,c,2)};m.prototype.drawNormals=function(a,c){return this.drawPass(2,a,c)};m.prototype.drawHighlights=function(a,c){return this.drawPass(4,a,c)};m.prototype.drawOccluded=function(a,c){return this.drawPass(0,a,c,1)};
m.prototype.drawPass=function(a,c,d,e){var f=this;void 0===e&&(e=0);if(0===d.numViews)return!1;this._pixelRatio=d.pixelRatio*Math.abs(d.views[0].extent[2]-d.views[0].extent[0])/Math.abs(d.views[0].viewport[2]-d.views[0].viewport[0]);if(this.isEmpty()||4===a&&!this.hasHighlights||2===a&&!this.hasWater||!this.hasNonZeroSizedView(d))return!1;var k=d.width,l=d.height,h=this._renderTargets[c];if(!h)return!1;h.resize(k,l);var p=this._rctx,m=O;m.pixelRatio=d.pixelRatio||1;this._renderContext.pass=a;this._bindParameters.pixelRatio=
m.pixelRatio;p.bindFramebuffer(h);p.setClearColor(0,0,0,0);p.clearSafe(16384);this.updateLightingUniforms();1===e&&(this._renderContext.renderOccludedMask=b.overlayRenderOccludedFlag);if(t.OVERLAY_DRAW_DEBUG_TEXTURE&&1!==e)for(c=0;c<d.numViews;c++)this.setViewParameters(d.views[c],m),this.drawDebugTexture(k,l,W[d.index%W.length]);0<this._layerRenderers.size&&this._sortedLayerRenderers.forEach(function(c){var b=c.layerView;c=c.renderer;if(2!==e||!g.isSome(b)||0!==b.drapeSourceType){var q=g.isSome(b)&&
g.isSome(b.fullOpacity)&&1>b.fullOpacity&&0===a;q&&(f.bindTemporaryFramebuffer(k,l),p.clearSafe(16384));for(var r=0;r<d.numViews;r++)f.setViewParameters(d.views[r],m),c.draw(f._renderContext,f._bindParameters,f._stats);q&&(p.bindFramebuffer(h),f._compositingHelper.composite(f.temporaryTexture,2,g.unwrap(g.unwrap(b).fullOpacity)))}});p.bindFramebuffer(null);h.colorTexture.descriptor.hasMipmap&&h.colorTexture.generateMipmap();this._renderContext.resetRenderOccludedMask();return!0};m.prototype.createRenderTarget=
function(a,c){for(var d=a,b=0;this._renderTargets[d];)d=a+"_"+ ++b;this._renderTargets[d]=new L(this._rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:c,maxAnisotropy:8,width:0,height:0});return d};m.prototype.disposeRenderTargetMemory=function(a){(a=this._renderTargets[a])&&a.resize(0,0)};m.prototype.bindTemporaryFramebuffer=function(a,c){g.isNone(this._temporaryRenderTargetId)&&(this._temporaryRenderTargetId=this.createRenderTarget("temp",
!1));var d=this._renderTargets[this._temporaryRenderTargetId];d.resize(a,c);this._rctx.bindFramebuffer(d)};Object.defineProperty(m.prototype,"temporaryTexture",{get:function(){return this._renderTargets[g.unwrap(this._temporaryRenderTargetId)].colorTexture},enumerable:!0,configurable:!0});m.prototype.getGpuMemoryUsage=function(){var a=0,c;for(c in this._renderTargets)a+=N.getGpuMemoryUsage(this._renderTargets[c]);return a};m.prototype.getStats=function(){return this._stats.getAggregatedStats()};m.prototype.hotReloadShaders=
function(){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){switch(a.label){case 0:return[4,this._shaderTechniqueRepository.hotReload()];case 1:return a.sent(),[2]}})})};m.prototype.intersect=function(a,c,d){var b=this,e=0;this._geometries.forEach(function(f){if(!d||d(f)){b.intersectRenderGeometry(f,c,0,a,e);var g=b.longitudeCyclical;g&&(f.center[0]-f.bsRadius<g.min&&b.intersectRenderGeometry(f,c,g.range,a,e),f.center[0]+f.bsRadius>g.max&&b.intersectRenderGeometry(f,
c,-g.range,a,e));e++}})};m.prototype.intersectRenderGeometry=function(a,c,d,b,e){var f=this,k=0;g.isSome(a.transformation)&&(d+=a.transformation[12],k=a.transformation[13]);U[0]=c[0]-d;U[1]=c[1]-k;U[2]=1;P[0]=c[0]-d;P[1]=c[1]-k;P[2]=0;a.pixelRatio=this._pixelRatio;a.material.intersect(a,null,a.getShaderTransformation(),b,U,P,function(c,d,g){f.addIntersectionResult(g,a.material.renderPriority,e,b,a.data.layerUid,a.data.graphicUid)},a.calculateShaderTransformation,!0)};m.prototype.addIntersectionResult=
function(a,c,d,b,e,f){var g={type:"external",metadata:{layerUid:e,graphicUid:f}};e=function(e){e.set(g,null,b.results.ground.dist,b.results.ground.normal,b.results.ground.transformation,c,null,null,a,d);e.intersector="OverlayRenderer"};(null==b.results.min.drapedLayerOrder||c>=b.results.min.drapedLayerOrder)&&(null==b.results.min.dist||b.results.ground.dist<=b.results.min.dist)&&e(b.results.min);0!==b.options.store&&(null==b.results.max.drapedLayerOrder||c<b.results.max.drapedLayerOrder)&&(null==
b.results.max.dist||b.results.ground.dist>b.results.max.dist)&&e(b.results.max);2===b.options.store&&(f=new B.IntersectorResult(b.ray),e(f),b.results.all.push(f))};m.prototype.stopAnimationsAtTime=function(a){this._sortedLayerRenderers.forEach(function(c){return c.renderer.stopAnimationsAtTime(a)})};m.prototype.ensureLayerRenderer=function(a){var d=this,b=this._layerRenderers.get(a);b||(b=new H.SortedRenderGeometryRenderer({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(a,
b),this._sortedLayerRenderersDirty=!0,this._handles.add([a.watch("fullOpacity",function(){return d.emitContentChanged()}),c.init(b,"updating",function(){return d.notifyChange("updating")})],a));return b};m.prototype.updateSortedLayerRenderers=function(){var a=this;if(this._sortedLayerRenderersDirty&&(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0!==this._layerRenderers.size)){var c=f.firstKeyOfMap(this._layerRenderers).view.allLayerViews,b=d.SetFromValues(f.valuesOfMap(this._layerRenderers));
c.forEach(function(c){var d=a._layerRenderers.get(c);d&&(a._sortedLayerRenderers.push(new R(c,d)),b.delete(d))});b.forEach(function(c){a._sortedLayerRenderers.push(new R(null,c))})}};m.prototype.setViewParameters=function(a,c){c.viewport=a.viewport;var d=a.extent;p.mat4.ortho(c.projectionMatrix,0,d[2]-d[0],0,d[3]-d[1],c.near,c.far);p.mat4.identity(c.viewMatrix);p.mat4.translate(c.viewMatrix,c.viewMatrix,[-a.extent[0],-a.extent[1],0]);c.setGLViewport(this._rctx);this._renderContext.camera=c;this._bindParameters.view=
c.viewMatrix;this._bindParameters.proj=c.projectionMatrix;this._bindParameters.viewInvTransp=c.viewInverseTransposeMatrix;this._bindParameters.viewport=c.fullViewport;this._shaderTechniqueRepository.getProgramsUsingUniform("proj").forEach(function(a){a.setUniformMatrix4fv("proj",c.projectionMatrix)})};m.prototype.updateLightingUniforms=function(){var a=this;this._shaderTechniqueRepository.getProgramsUsingUniform("lightingMainDirection").forEach(function(c){a._lighting.setUniforms(c)})};m.prototype.hasNonZeroSizedView=
function(a){for(var c=0;c<a.numViews;c++){var d=a.views[c];if(d.extent[0]!==d.extent[2]&&d.extent[1]!==d.extent[3])return!0}return!1};m.prototype.emitContentChanged=function(){if(this.onContentChanged)this.onContentChanged()};m.prototype.updateHasWater=function(){var a=f.someMap(this._layerRenderers,function(a){return a.hasWater});a!==this._hasWater&&(this._hasWater=a)};m.prototype.updateHasHighlights=function(){var a=f.someMap(this._layerRenderers,function(a){return a.hasHighlights});if(a!==this._hasHighlights&&
(this._hasHighlights=a,this.onHasHighlightsChanged))this.onHasHighlightsChanged(this._hasHighlights)};m.prototype.updateRendersOccluded=function(){var a=f.someMap(this._layerRenderers,function(a){return a.rendersOccluded});if(a!==this._rendersOccluded&&(this._rendersOccluded=a,this.onRendersOccludedChanged))this.onRendersOccludedChanged(this.rendersOccluded)};m.prototype.drawDebugTexture=function(a,c,d){var b=this._rctx;this.ensureDebugPatternResources(a,c);a=this._debugPatternProgram;b.bindProgram(a);
b.setPipelineState(this._debugPatternPipelineState);a.setUniform4f("color",d[0],d[1],d[2],1);a.setUniform1i("tex",0);b.bindTexture(this._debugPatternTexture,0);b.bindVAO(this._quadVAO);b.drawArrays(5,0,N.vertexCount(this._quadVAO,"geometry"))};m.prototype.ensureDebugPatternResources=function(a,c){if(!this._debugPatternTexture){for(var d=new Uint8Array(a*c*4),b=0,e=0;e<c;e++)for(var f=0;f<a;f++){var g=Math.floor(f/10),k=Math.floor(e/10);2>g||2>k||10*g>a-20||10*k>c-20?(d[b++]=255,d[b++]=255,d[b++]=
255,d[b++]=255):(d[b++]=255,d[b++]=255,d[b++]=255,g&1&&k&1?d[b++]=f&1^e&1?0:255:d[b++]=g&1^k&1?0:128)}this._debugPatternTexture=new M(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:a,height:c},d);a=new I.TextureTechniqueConfiguration;a.hasAlpha=!0;this._debugTextureTechnique=this._shaderTechniqueRepository.acquireAndReleaseExisting(I.TextureTechnique,a,this._debugTextureTechnique);this._debugPatternProgram=this._debugTextureTechnique.program;this._debugPatternPipelineState=
this._debugTextureTechnique.pipeline;this._quadVAO=y.createQuadVAO(this._rctx)}};Object.defineProperty(m.prototype,"test",{get:function(){return{layerRenderers:this._layerRenderers}},enumerable:!0,configurable:!0});a.__decorate([z.autoDispose()],m.prototype,"_shaderTechniqueRepository",void 0);a.__decorate([z.autoDispose()],m.prototype,"_stippleTextureRepository",void 0);a.__decorate([k.property(),z.autoDispose()],m.prototype,"waterTextureRepository",void 0);a.__decorate([k.property()],m.prototype,
"renderView",void 0);a.__decorate([k.property({type:Boolean,readOnly:!0,dependsOn:["waterTextureRepository.updating"]})],m.prototype,"updating",null);return m=a.__decorate([k.subclass("esri.views.3d.terrain.OverlayRenderer")],m)}(z.AutoDisposableMixin(m));b.OverlayRenderer=n;var R=function(){return function(a,c){this.layerView=a;this.renderer=c}}(),W=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],O=new w.default;O.near=1;O.far=1E4;var U=r.vec3f64.create(),P=r.vec3f64.create();b.DRAPED_Z=-2;b.overlayRenderOccludedFlag=
4})},"esri/views/3d/webgl-engine/core/shaderTechnique/CommonUniformStore":function(){define(["require","exports","../../../../../core/arrayUtils"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this._uniforms={proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}b.prototype.dispose=function(){this._uniforms=null};b.prototype.getPrograms=function(a){return this._uniforms[a]||[]};b.prototype.subscribeProgram=function(a){for(var b in this._uniforms)a.hasUniform(b)&&
this._uniforms[b].push(a)};b.prototype.unsubscribeProgram=function(b){for(var e in this._uniforms)a.removeUnordered(this._uniforms[e],b)};return b}();b.CommonUniformStore=n})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define(["require","exports","tslib","../../../../../core/maybe","../../../../../core/promiseUtils"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});var e=function(){return function(a){this.technique=a;this.refZeroFrame=
this.refCount=0}}();n=function(){function b(a){this._context=a;this._perConstructorInstances=new Map;this._frameCounter=0;this._keepAliveFrameCount=1200}Object.defineProperty(b.prototype,"viewingMode",{get:function(){return this._context.viewingMode},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"constructionContext",{get:function(){return this._context},enumerable:!0,configurable:!0});b.prototype.dispose=function(){this._perConstructorInstances.forEach(function(a){return a.forEach(function(a){return a.technique.dispose()})});
this._perConstructorInstances.clear()};b.prototype.acquire=function(a,b){var d=b.key,c=this._perConstructorInstances.get(a);c||(c=new Map,this._perConstructorInstances.set(a,c));var f=c.get(d);void 0===f&&(f=new e(new a(this._context,b)),c.set(d,f));++f.refCount;return f.technique};b.prototype.acquireAndReleaseExisting=function(a,b,d){return m.isNone(d)?this.acquire(a,b):b.key===d.key&&d instanceof a?d:(this.release(d),this.acquire(a,b))};b.prototype.release=function(a){a=this._perConstructorInstances.get(a.constructor).get(a.key);
--a.refCount;0===a.refCount&&(a.refZeroFrame=this._frameCounter)};b.prototype.frameUpdate=function(){var a=this;this._frameCounter++;this._perConstructorInstances.forEach(function(b,d){b.forEach(function(c,d){0===c.refCount&&c.refZeroFrame+a._keepAliveFrameCount<a._frameCounter&&(c.technique.dispose(),b.delete(d))});0===b.size&&a._perConstructorInstances.delete(d)})};b.prototype.getProgramsUsingUniform=function(a){return this._context.commonUniformStore.getPrograms(a)};b.prototype.hotReload=function(){return a.__awaiter(this,
void 0,void 0,function(){var b,e=this;return a.__generator(this,function(d){switch(d.label){case 0:return b=[],this._perConstructorInstances.forEach(function(c,d){b.push(function(c,d){return a.__awaiter(e,void 0,void 0,function(){var b,e=this;return a.__generator(this,function(a){switch(a.label){case 0:return(b=d.shader)?[4,b.reload()]:[3,2];case 1:a.sent(),c.forEach(function(a){a.technique.reload(e._context)}),a.label=2;case 2:return[2]}})})}(c,d))}),[4,h.all(b)];case 1:return d.sent(),[2]}})})};
return b}();b.ShaderTechniqueRepository=n})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define("require exports ../../../../core/Logger ../../../../core/maybe ../core/shaderLibrary/ShaderOutputOptions ./Util".split(" "),function(n,b,a,m,h,e){var f=a.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep"),g=function(){function a(a){this.refCnt=0;this.glMaterial=a}a.prototype.incRefCnt=function(){++this.refCnt};a.prototype.decRefCnt=function(){--this.refCnt;e.assert(0<=this.refCnt)};
a.prototype.getRefCnt=function(){return this.refCnt};a.prototype.getGLMaterial=function(){return this.glMaterial};return a}();return function(){function a(a,c,b){this._textureRep=a;this._techniqueRep=c;this.onMaterialChanged=b;this._id2glMaterialRef=new Map}a.prototype.acquire=function(a,c){this.ownMaterial(a);var d=h.getShaderOutputID(a.id,c),b=this._id2glMaterialRef.get(d);null==b?(a=a.getGLMaterial({material:a,techniqueRep:this._techniqueRep,textureRep:this._textureRep,output:c}),b=new g(a),this._id2glMaterialRef.set(d,
b)):a=b.getGLMaterial();b.incRefCnt();return a};a.prototype.release=function(a,c){a=h.getShaderOutputID(a.id,c);c=this._id2glMaterialRef.get(a);c.decRefCnt();0===c.getRefCnt()&&((c=c.getGLMaterial())&&c.dispose(),this._id2glMaterialRef.delete(a))};a.prototype.materialChanged=function(a){for(var c=0,d=h.ShaderOutputTypes;c<d.length;c++){var b=d[c];5!==b.output&&6!==b.output&&(b=this._id2glMaterialRef.get(h.getShaderOutputID(a.id,b.output)))&&b.getGLMaterial()&&(b=b.getGLMaterial(),b.updateParameters&&
b.updateParameters())}if(this.onMaterialChanged)this.onMaterialChanged(a)};a.prototype.ownMaterial=function(a){m.isSome(a.materialRepository)&&a.materialRepository!==this&&f.error("Material is already owned by a different material repository");a.materialRepository=this};return a}()})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions":function(){define(["require","exports","../../../../../core/arrayUtils"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.ShaderOutputTypes=
[{output:0,name:"color"},{output:1,name:"depth"},{output:2,name:"normal"},{output:3,name:"depthShadowMap"},{output:4,name:"highlight"},{output:5,name:"draped"},{output:6,name:"occlusion"}];b.getShaderOutputID=function(m,h){return m+"_"+a.find(b.ShaderOutputTypes,function(a){return a.output===h}).name}})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/SpatialReference ../../support/projectionUtils ./Geometry ./GeometryData ./Layer ./localOrigin ./Object3D ./Util ../materials/RibbonLineMaterial".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t){var u=0;n=function(){function b(){this.ROOT_ORIGIN_ID="rg_root_"+u++;this._origins=new Map;this._gridSize=42E5}b.prototype.getOrigin=function(c){var d=this._origins.get(this.ROOT_ORIGIN_ID);if(null==d){if(a.isSome(b.testOrigin)){var e=b.testOrigin;this._origins.set(this.ROOT_ORIGIN_ID,k.fromValues(e[0],e[1],e[2],this.ROOT_ORIGIN_ID));return this.getOrigin(c)}e=k.fromValues(c[0]+Math.random()-.5,c[1]+Math.random()-.5,c[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);
this._origins.set(this.ROOT_ORIGIN_ID,e);return e}h.vec3.subtract(v,c,d.vec3);v[0]=Math.abs(v[0]);v[1]=Math.abs(v[1]);v[2]=Math.abs(v[2]);e=this._gridSize;if(v[0]<e&&v[1]<e&&v[2]<e)return d;var d=Math.round(c[0]/e),f=Math.round(c[1]/e);c=Math.round(c[2]/e);var g="rg_"+d+"/"+f+"/"+c,l=this._origins.get(g);l||(l=k.fromValues(d*e,f*e,c*e,g),this._origins.set(g,l));return l};b.prototype._drawOriginBox=function(a){var b=window.view,e=b._stage;if(null==this._object){this._material=new t({width:2,color:[0,
1,0,1]},"GridLocalOriginMaterial");e.add(3,this._material);var k=new c("GridLocalOrigin",{isPickable:!1});e.add(0,k);this._object=new p({idHint:"GridLocalOrigin",castShadow:!1});e.add(1,this._object);k.addObject(this._object);e.addToViewContent([k.id])}for(var h=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],w=h.length,u=new Float32Array(3*w),k=new Uint32Array(2*(w-1)),v=.5*this._gridSize,z=0;z<w;z++)u[3*z+0]=a[0]+(h[z]&1?v:-v),u[3*z+1]=a[1]+(h[z]&2?v:-v),u[3*z+2]=a[2]+(h[z]&4?v:-v),0<z&&(k[2*z+0]=z-1,k[2*
z+1]=z);g.bufferToBuffer(u,f.WebMercator,0,u,b.spatialReference,0,w);b={};b[r.VertexAttrConstants.POSITION]={size:3,data:u};u={};u[r.VertexAttrConstants.POSITION]=k;k=new d.GeometryData(b,u,"line");k=new l(k,"GridLocalOriginBox");e.add(2,k);this._object.addGeometry(k,this._material,m.mat4f64.IDENTITY);console.log(this._origins.size,a)};return b}();var v=e.vec3f64.create();(n||(n={})).testOrigin=null;return n})},"esri/views/3d/webgl-engine/lib/Layer":function(){define("require exports tslib ../../../../core/arrayUtils ../../../../core/Evented ../../../../core/libs/gl-matrix-2/vec3f64 ./IdGen ./Octree".split(" "),
function(n,b,a,m,h,e,f,g){return function(b){function d(a,f,g){var c=b.call(this)||this;c._parentStages=new Map;c._objects=new Set;c.id=d._idGen.gen(a);c.apiLayerUid=g;c.name=a;f=f||{};c.group=f.group||"";c.isVisible=null!=f.isVisible?f.isVisible:!0;c.isPickable=null!=f.isPickable?f.isPickable:!0;c.isSliceable=!1;c.translation=f.translation?e.vec3f64.clone(f.translation):e.vec3f64.create();return c}a.__extends(d,b);d.prototype.addParentStage=function(a){if(!this._parentStages.has(a)){var c=this.on("dirty",
function(c){a.notifyDirty(c.origin,c.dirtyType,c.subObject)});this._parentStages.set(a,c)}};d.prototype.removeParentStage=function(a){var c=this._parentStages.get(a);c&&(c.remove(),this._parentStages.delete(a));this.invalidateSpatialQueryAccelerator()};d.prototype.getName=function(){return this.name};d.prototype.getGroup=function(){return this.group};d.prototype.getTranslation=function(){return this.translation};d.prototype.getObjectIds=function(){return m.keysOfSet(this._objects,function(a){return a.id})};
d.prototype.getObjects=function(){return m.keysOfSet(this._objects)};d.prototype.addObject=function(a){this._objects.add(a);a.parentLayer=this;this.notifyDirty("layerObjectAdded",a);this._octree&&this._octree.add(a)};d.prototype.hasObject=function(a){return this._objects.has(a)};d.prototype.removeObject=function(a){if(!this._objects.delete(a))return!1;a.parentLayer=null;this.notifyDirty("layerObjectRemoved",a);this._octree&&this._octree.remove(a);return!0};d.prototype.notifyObjectBBChanged=function(a,
d){this._octree&&this._octree.update(a,d)};d.prototype.getSpatialQueryAccelerator=function(){!this._octree&&50<this._objects.size&&this._createOctree();return this._octree};d.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)};d.prototype.invalidateSpatialQueryAccelerator=function(){this._octree&&(this._octree.destroy(),this._octree=null)};d.prototype.notifyDirty=function(a,d,b,e){this.emit("dirty",{origin:e||this,dirtyType:a,subObject:d})};d.prototype._createOctree=
function(){this._octree=new g({getRadius:function(a){return a.getBSRadius()},getCenter:function(a){return a.getCenter()}});this._octree.add(m.keysOfSet(this._objects))};d._idGen=new f.IdGen;return d}(h)})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("require exports ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./Util".split(" "),function(n,b,a,m,h,e,f,g){function l(a,
c,d){d=d||a;d[0]=a[0]+c;d[1]=a[1]+c;d[2]=a[2]+c;return d}function d(a,c,d){return!f.frustum.intersectsSphere(d.planes,f.sphere.wrap(c,a))}function c(a,c,d){if(!E.length)for(var b=0;8>b;++b)E.push({index:0,distance:0});for(b=0;8>b;++b){var e=u[b];E.data[b].index=b;E.data[b].distance=p(a,c,e)}E.sort(function(a,c){return a.distance-c.distance});d.clear();for(b=0;8>b;++b)d.push(E.data[b].index)}function k(a,c){for(var d=Infinity,b=null,e=0;8>e;++e){var f=p(a,c,v[e]);f<d&&(d=f,b=v[e])}return b}function p(a,
c,d){return c*(a[0]*d[0]+a[1]*d[1]+a[2]*d[2])}function r(a){if(Array.isArray(a))return a;w[0]=a;return w}n=function(){function a(a,c){this._maximumObjectsPerNode=10;this._maximumDepth=20;this._degenerateObjects=new Set;this._objectCount=0;this._objectToBoundingSphere=a;c&&(void 0!==c.maximumObjectsPerNode&&(this._maximumObjectsPerNode=c.maximumObjectsPerNode),void 0!==c.maximumDepth&&(this._maximumDepth=c.maximumDepth));this._root=new t(null,e.vec3f64.fromValues(0,0,0),0)}Object.defineProperty(a.prototype,
"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maximumDepth",
{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"objectCount",{get:function(){return this._objectCount},enumerable:!0,configurable:!0});a.prototype.destroy=function(){this._degenerateObjects.clear();this._root=null;t.clearPool();w[0]=null;C.prune();E.prune();L.prune()};a.prototype.add=function(a,c){a=r(a);c=null==c?a.length:c;this._objectCount+=c;this._grow(a,c);for(var d=t.acquire(),b=0;b<c;b++){var e=a[b];this._isDegenerate(e)?this._degenerateObjects.add(e):
(d.init(this._root),this._add(e,d))}t.release(d)};a.prototype.remove=function(a,c){a=r(a);this._objectCount-=a.length;for(var d=t.acquire(),b=0;b<a.length;b++){var e=a[b],f=c||this._boundingSphereFromObject(e,F);this._isValidRadius(f.radius)?(d.init(this._root),this._remove(e,f,d)):this._degenerateObjects.delete(e)}t.release(d);this._shrink()};a.prototype.update=function(a,c){if(this._isValidRadius(c.radius)||!this._isDegenerate(a))this.remove(a,c),this.add(a)};a.prototype.forEachAlongRay=function(a,
c,d){var b=this,e=f.ray.wrap(a,c);this._forEachNode(this._root,function(a){if(!b._intersectsNode(e,a))return!1;a=a.node;a.terminals.forEach(function(a){b._intersectsObject(e,a)&&d(a)});null!==a.residents&&a.residents.forEach(function(a){b._intersectsObject(e,a)&&d(a)});return!0})};a.prototype.forEachAlongRayWithVerticalOffset=function(a,c,d,b){var e=this,g=f.ray.wrap(a,c);this._forEachNode(this._root,function(a){if(!e._intersectsNodeWithOffset(g,a,b))return!1;a=a.node;a.terminals.forEach(function(a){e._intersectsObjectWithOffset(g,
a,b)&&d(a)});null!==a.residents&&a.residents.forEach(function(a){e._intersectsObjectWithOffset(g,a,b)&&d(a)});return!0})};a.prototype.forEach=function(a){this._forEachNode(this._root,function(c){c=c.node;c.terminals.forEach(a);null!==c.residents&&c.residents.forEach(a);return!0});this._degenerateObjects.forEach(a)};a.prototype.forEachDegenerateObject=function(a){this._degenerateObjects.forEach(a)};a.prototype.findClosest=function(a,c,d,b,e){return this._findClosest(a,"front-to-back"===c?1:-1,d,b,
e)};a.prototype.forEachInDepthRange=function(a,c,d,b,e,f,g,k){this._forEachInDepthRange(a,c,"front-to-back"===d?1:-1,b,e,f,g,k)};a.prototype.forEachNode=function(a){this._forEachNode(this._root,function(c){return a(c.node,c.center,2*c.halfSize)})};a.prototype._intersectsNode=function(a,c){l(c.center,2*-c.halfSize,A);l(c.center,2*c.halfSize,B);return g.rayBoxTest(a.origin,a.direction,A,B)};a.prototype._intersectsNodeWithOffset=function(a,c,d){l(c.center,2*-c.halfSize,A);l(c.center,2*c.halfSize,B);
d.applyToMinMax(A,B);return g.rayBoxTest(a.origin,a.direction,A,B)};a.prototype._intersectsObject=function(a,c){var d=this._objectToBoundingSphere.getRadius(c);return 0<d?f.sphere.intersectsRay(f.sphere.wrap(d,this._objectToBoundingSphere.getCenter(c)),a):!0};a.prototype._intersectsObjectWithOffset=function(a,c,d){var b=this._objectToBoundingSphere.getRadius(c);return 0<b?f.sphere.intersectsRay(d.applyToBoundingSphere(b,this._objectToBoundingSphere.getCenter(c)),a):!0};a.prototype._forEachNode=function(a,
c){a=t.acquire().init(a);for(var d=[a];0!==d.length;){a=d.pop();if(c(a)&&!a.isLeaf())for(var b=0;b<a.node.children.length;b++)a.node.children[b]&&d.push(t.acquire().init(a).advance(b));t.release(a)}};a.prototype._forEachNodeDepthOrdered=function(a,d,b,e){void 0===e&&(e=1);a=t.acquire().init(a);var f=[a];for(c(b,e,L);0!==f.length;){a=f.pop();if(d(a)&&!a.isLeaf())for(b=7;0<=b;--b)e=L.data[b],e>=a.node.children.length||a.node.children[e]&&f.push(t.acquire().init(a).advance(e));t.release(a)}};a.prototype._findClosest=
function(a,c,b,e,f){var g=this,l=Infinity,m=Infinity,q=null,r=k(a,c),t=0,w=function(f){++t;if(!e||e(f)){var k=g._objectToBoundingSphere.getCenter(f),h=g._objectToBoundingSphere.getRadius(f);if(!b||!d(k,h,b)){var k=p(a,c,k),r=k-h;r<l&&(l=r,m=k+h,q=f)}}};this._forEachNodeDepthOrdered(this._root,function(e){if(null!=f&&t>=f||b&&d(e.center,e.halfSize*z,b))return!1;h.vec3.scale(y,r,e.halfSize);h.vec3.add(y,y,e.center);if(p(a,c,y)>m)return!1;e=e.node;e.terminals.forEach(function(a){w(a)});null!==e.residents&&
e.residents.forEach(function(a){w(a)});return!0},a,c);return q};a.prototype._forEachInDepthRange=function(a,c,b,e,f,g,l,m){var q=this,r=-Infinity,t=Infinity,w={setRange:function(a){1===b?(r=Math.max(r,a.near),t=Math.min(t,a.far)):(r=Math.max(r,-a.far),t=Math.min(t,-a.near))}};w.setRange(e);var u=p(c,b,a),v=k(c,b),A=k(c,-1*b),B=0,C=function(a){++B;if(!l||l(a)){var e=q._objectToBoundingSphere.getCenter(a),k=q._objectToBoundingSphere.getRadius(a),h=p(c,b,e)-u;h-k>t||h+k<r||g&&d(e,k,g)||f(a,w)}};this._forEachNodeDepthOrdered(this._root,
function(a){if(null!=m&&B>=m||g&&d(a.center,a.halfSize*z,g))return!1;h.vec3.scale(y,v,a.halfSize);h.vec3.add(y,y,a.center);if(p(c,b,y)-u>t)return!1;h.vec3.scale(y,A,a.halfSize);h.vec3.add(y,y,a.center);if(p(c,b,y)-u<r)return!1;a=a.node;a.terminals.forEach(function(a){C(a)});null!==a.residents&&a.residents.forEach(function(a){C(a)});return!0},c,b)};a.prototype._remove=function(a,c,d){C.clear();c=d.advanceTo(c,function(a,c){C.push(a.node);C.push(c)})?d.node.terminals:d.node.residents;c.removeUnordered(a);
if(0===c.length)for(a=C.length-2;0<=a&&this._purge(C.data[a],C.data[a+1]);a-=2);};a.prototype._nodeIsEmpty=function(a){if(0!==a.terminals.length)return!1;if(null!==a.residents)return 0===a.residents.length;for(var c=0;c<a.children.length;c++)if(a.children[c])return!1;return!0};a.prototype._purge=function(a,c){0<=c&&(a.children[c]=null);return this._nodeIsEmpty(a)?(null===a.residents&&(a.residents=new m({shrink:!0})),!0):!1};a.prototype._add=function(a,c){c.advanceTo(this._boundingSphereFromObject(a,
F))?c.node.terminals.push(a):(c.node.residents.push(a),c.node.residents.length>this._maximumObjectsPerNode&&c.depth<this._maximumDepth&&this._split(c))};a.prototype._split=function(a){var c=a.node.residents;a.node.residents=null;for(var d=0;d<c.length;d++){var b=t.acquire().init(a);this._add(c.data[d],b);t.release(b)}};a.prototype._grow=function(a,c){var d=this;0!==c&&(a=this._boundingSphereFromObjects(a,c,function(a,c){return d._boundingSphereFromObject(a,c)},H),this._isValidRadius(a.radius)&&!this._fitsInsideTree(a)&&
(this._nodeIsEmpty(this._root.node)?(h.vec3.copy(this._root.center,a.center),this._root.halfSize=1.25*a.radius):(c=t.acquire(),this._rootBoundsForRootAsSubNode(a,c),this._placingRootViolatesMaxDepth(c)?this._rebuildTree(a,c):this._growRootAsSubNode(c),t.release(c))))};a.prototype._rebuildTree=function(a,c){var d=this;h.vec3.copy(I.center,c.center);I.radius=c.halfSize;a=this._boundingSphereFromObjects([a,I],2,function(a){return a},G);c=t.acquire().init(this._root);this._root.initFrom(null,a.center,
1.25*a.radius);this._forEachNode(c,function(a){d.add(a.node.terminals.data,a.node.terminals.length);null!==a.node.residents&&d.add(a.node.residents.data,a.node.residents.length);return!0});t.release(c)};a.prototype._placingRootViolatesMaxDepth=function(a){var c=0;this._forEachNode(this._root,function(a){c=Math.max(c,a.depth);return!0});return c+Math.log(a.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth};a.prototype._rootBoundsForRootAsSubNode=function(a,c){var d=a.radius,b=a.center;a=
-Infinity;for(var e=this._root.center,f=this._root.halfSize,g=0;3>g;g++){var k=Math.max(0,Math.ceil((e[g]-f-(b[g]-d))/(2*f))),l=Math.max(0,Math.ceil((b[g]+d-(e[g]+f))/(2*f)))+1;a=Math.max(a,Math.pow(2,Math.ceil(Math.log(k+l)*Math.LOG2E)));J[g].min=k;J[g].max=l}for(g=0;3>g;g++)k=J[g].min,l=J[g].max,d=(a-(k+l))/2,k+=Math.ceil(d),l+=Math.floor(d),q[g]=e[g]-f-k*f*2+(l+k)*f;return c.initFrom(null,q,a*f,0)};a.prototype._growRootAsSubNode=function(a){var c=this._root.node;h.vec3.copy(H.center,this._root.center);
H.radius=this._root.halfSize;this._root.init(a);a.advanceTo(H,null,!0);a.node.children=c.children;a.node.residents=c.residents;a.node.terminals=c.terminals};a.prototype._shrink=function(){for(;;){var a=this._findShrinkIndex();if(-1===a)break;this._root.advance(a);this._root.depth=0}};a.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var a=null,c=this._root.node.children,d=0,b=0;b<c.length&&null==a;)d=b++,a=c[d];for(;b<c.length;)if(c[b++])return-1;
return d};a.prototype._isDegenerate=function(a){a=this._objectToBoundingSphere.getRadius(a);return!this._isValidRadius(a)};a.prototype._isValidRadius=function(a){return!isNaN(a)&&-Infinity!==a&&Infinity!==a&&0<a};a.prototype._fitsInsideTree=function(a){var c=this._root.center,d=this._root.halfSize,b=a.center;return a.radius<=d&&b[0]>=c[0]-d&&b[0]<=c[0]+d&&b[1]>=c[1]-d&&b[1]<=c[1]+d&&b[2]>=c[2]-d&&b[2]<=c[2]+d};a.prototype._boundingSphereFromObject=function(a,c){h.vec3.copy(c.center,this._objectToBoundingSphere.getCenter(a));
c.radius=this._objectToBoundingSphere.getRadius(a);return c};a.prototype._boundingSphereFromObjects=function(a,c,d,b){if(1===c){var e=d(a[0],H);h.vec3.copy(b.center,e.center);b.radius=e.radius}else{A[0]=Infinity;A[1]=Infinity;A[2]=Infinity;B[0]=-Infinity;B[1]=-Infinity;B[2]=-Infinity;for(var f=0;f<c;f++)if(e=d(a[f],H),this._isValidRadius(e.radius)){var g=A,k=e.center,l=e.radius;g[0]=Math.min(g[0],k[0]-l);g[1]=Math.min(g[1],k[1]-l);g[2]=Math.min(g[2],k[2]-l);g=B;k=e.center;e=e.radius;g[0]=Math.max(g[0],
k[0]+e);g[1]=Math.max(g[1],k[1]+e);g[2]=Math.max(g[2],k[2]+e)}h.vec3.lerp(b.center,A,B,.5);b.radius=Math.max(B[0]-A[0],B[1]-A[1],B[2]-A[2])/2}return b};return a}();var t=function(){function c(a,c,d){void 0===d&&(d=0);this.center=e.vec3f64.create();this.initFrom(a,c,d,0)}c.prototype.init=function(a){return this.initFrom(a.node,a.center,a.halfSize,a.depth)};c.prototype.initFrom=function(a,d,b,e){void 0===a&&(a=null);void 0===b&&(b=this.halfSize);void 0===e&&(e=this.depth);this.node=a||c.createEmptyNode();
d&&h.vec3.copy(this.center,d);this.halfSize=b;this.depth=e;return this};c.prototype.advance=function(a){var d=this.node.children[a];d||(d=c.createEmptyNode(),this.node.children[a]=d);this.node=d;this.halfSize/=2;this.depth++;a=u[a];this.center[0]+=a[0]*this.halfSize;this.center[1]+=a[1]*this.halfSize;this.center[2]+=a[2]*this.halfSize;return this};c.prototype.advanceTo=function(a,c,d){for(void 0===d&&(d=!1);;){if(this.isTerminalFor(a))return c&&c(this,-1),!0;if(this.isLeaf()&&!d)return c&&c(this,
-1),!1;this.isLeaf()&&(this.node.residents=null);var b=this._childIndex(a);c&&c(this,b);this.advance(b)}};c.prototype.isLeaf=function(){return null!=this.node.residents};c.prototype.isTerminalFor=function(a){return a.radius>this.halfSize/2};c.prototype._childIndex=function(a){a=a.center;for(var c=this.center,d=0,b=0;3>b;b++)c[b]<a[b]&&(d|=1<<b);return d};c.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new m({shrink:!0}),residents:new m({shrink:!0})}};
c.acquire=function(){return c._pool.acquire()};c.release=function(a){c._pool.release(a)};c.clearPool=function(){c._pool.prune()};c._pool=new a(c);return c}(),u=[e.vec3f64.fromValues(-1,-1,-1),e.vec3f64.fromValues(1,-1,-1),e.vec3f64.fromValues(-1,1,-1),e.vec3f64.fromValues(1,1,-1),e.vec3f64.fromValues(-1,-1,1),e.vec3f64.fromValues(1,-1,1),e.vec3f64.fromValues(-1,1,1),e.vec3f64.fromValues(1,1,1)],v=[e.vec3f64.fromValues(-1,-1,-1),e.vec3f64.fromValues(-1,-1,1),e.vec3f64.fromValues(-1,1,-1),e.vec3f64.fromValues(-1,
1,1),e.vec3f64.fromValues(1,-1,-1),e.vec3f64.fromValues(1,-1,1),e.vec3f64.fromValues(1,1,-1),e.vec3f64.fromValues(1,1,1)],z=Math.sqrt(3),w=[null],q=e.vec3f64.create(),y=e.vec3f64.create(),A=e.vec3f64.create(),B=e.vec3f64.create(),C=new m,F={center:e.vec3f64.create(),radius:0},H={center:e.vec3f64.create(),radius:0},I={center:e.vec3f64.create(),radius:0},G={center:e.vec3f64.create(),radius:0},J=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],E=new m,L=new m;return n})},"esri/views/3d/webgl-engine/lib/localOrigin":function(){define(["require",
"exports","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.fromVector=function(b,h){return{vec3:a.vec3f64.clone(b),id:h}};b.fromValues=function(b,h,e,f){return{vec3:a.vec3f64.fromValues(b,h,e),id:f}}})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("require exports tslib ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/buffer/InterleavedLayout ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./VisualVariableMaterialParameters ./internal/MaterialUtil ./renderers/MergedRenderer ./renderers/utils ../shaders/RibbonLineTechnique ../shaders/RibbonLineTechnique".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A){function B(a,c,d,b,e){for(var f=0;f<e;f++)d[b++]=a[c++];return b}var C=m.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");n=function(d){function b(a,c){c=d.call(this,c)||this;c.techniqueConfig=new A.RibbonLineTechniqueConfiguration;c.params=z.copyParameters(a,H);c.validateParams();c.params.transparent=1>c.params.color[3]||c.params.transparent;c.layout=c.createLayout();return c}a.__extends(b,d);b.prototype.dispose=function(){};
b.prototype.setParameterValues=function(a){for(var c in a)"cap"===c?C.error("cap cannot be changed after creation"):"join"===c&&"round"===this.params[c]!==("round"===a[c])?C.error("join cannot be changed after creation"):"stipplePattern"===c&&!!this.params[c]!==!!a[c]?C.error("stippledness cannot be changed after creation"):this.params[c]=a[c];this.validateParams();this.parametersChanged()};b.prototype.getParameters=function(){return this.params};b.prototype.getPassParameters=function(){return this.params};
b.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;a=e.isSome(this.params.stipplePattern);this.techniqueConfig.stippleEnabled=a;this.techniqueConfig.stippleIntegerRepeatsEnabled=a&&this.params.stippleIntegerRepeats;this.techniqueConfig.stippleOffColorEnabled=a&&e.isSome(this.params.stippleOffColor);this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;this.techniqueConfig.roundJoins="round"===this.params.join;
this.techniqueConfig.roundCaps="round"===this.params.cap;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.polygonOffset=this.params.polygonOffset;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.vvColor=this.params.vvColorEnabled;this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.innerColorEnabled=0<this.params.innerWidth&&e.isSome(this.params.innerColor);this.techniqueConfig.falloffEnabled=
0<this.params.falloff;this.techniqueConfig.occluder=8===this.renderOccluded;return this.techniqueConfig};b.prototype.intersect=function(a,c,d,b,e,f,g,k,l){l?this.intersectDrapedLineGeometry(a,b,f,g):this.intersectLineGeometry(a,c,d,b,this.params.width,g)};b.prototype.intersectDrapedLineGeometry=function(a,c,d,b){if(c.options.selectionMode){c=a.getAttribute(A.RibbonVertexAttributeConstants.POSITION).data;var e=a.getAttribute(A.RibbonVertexAttributeConstants.SIZE),f=this.params.width;this.params.vvSizeEnabled?
(e=a.getAttribute(A.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE).data[0],f*=h.clamp(this.params.vvSizeOffset[0]+e*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])):e&&(f*=e.data[0]);e=d[0];d=d[1];a=(f/2+4)*a.pixelRatio;for(var f=Number.MAX_VALUE,g=0;g<c.length-5;g+=3){var k=c[g],l=c[g+1],p=e-k,m=d-l,k=c[g+3]-k,l=c[g+4]-l,q=h.clamp((k*p+l*m)/(k*k+l*l),0,1),p=k*q-p,m=l*q-m,m=p*p+m*m;m<f&&(f=m)}f<a*a&&b()}};b.prototype.intersectLineGeometry=function(a,d,
b,e,f,k){if(e.options.selectionMode&&!q.isInstanceHidden(d))if(u.isTranslationMatrix(b)){d=a.data.getVertexAttr();a=d[A.RibbonVertexAttributeConstants.POSITION].data;this.params.vvSizeEnabled?f*=h.clamp(this.params.vvSizeOffset[0]+d[A.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE].data[0]*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0]):d[A.RibbonVertexAttributeConstants.SIZE]&&(f*=d[A.RibbonVertexAttributeConstants.SIZE].data[0]);var p=e.camera,m=Q;g.vec2.copy(m,
e.point);f=f*p.pixelRatio/2+4*p.pixelRatio;l.vec3.set(Y[0],m[0]-f,m[1]+f,0);l.vec3.set(Y[1],m[0]+f,m[1]+f,0);l.vec3.set(Y[2],m[0]+f,m[1]-f,0);l.vec3.set(Y[3],m[0]-f,m[1]-f,0);for(var r=0;4>r;r++)p.unprojectPoint(Y[r],da[r]);c.plane.fromPoints(p.eye,da[0],da[1],fa);c.plane.fromPoints(p.eye,da[1],da[2],ga);c.plane.fromPoints(p.eye,da[2],da[3],ka);c.plane.fromPoints(p.eye,da[3],da[0],la);d=Number.MAX_VALUE;for(var t=this.params.isClosed?a.length-2:a.length-5,r=0;r<t;r+=3){E[0]=a[r]+b[12];E[1]=a[r+1]+
b[13];E[2]=a[r+2]+b[14];var w=(r+3)%a.length;L[0]=a[w]+b[12];L[1]=a[w+1]+b[13];L[2]=a[w+2]+b[14];if(!(0>c.plane.signedDistance(fa,E)&&0>c.plane.signedDistance(fa,L)||0>c.plane.signedDistance(ga,E)&&0>c.plane.signedDistance(ga,L)||0>c.plane.signedDistance(ka,E)&&0>c.plane.signedDistance(ka,L)||0>c.plane.signedDistance(la,E)&&0>c.plane.signedDistance(la,L))){p.projectPoint(E,R);p.projectPoint(L,W);if(0>R[2]&&0<W[2]){l.vec3.subtract(M,E,L);var w=p.frustum,y=-c.plane.signedDistance(w.planes[4],E),w=y/
l.vec3.dot(M,c.plane.normal(w.planes[4]));l.vec3.scale(M,M,w);l.vec3.add(E,E,M);p.projectPoint(E,R)}else if(0<R[2]&&0>W[2])l.vec3.subtract(M,L,E),w=p.frustum,y=-c.plane.signedDistance(w.planes[4],L),w=y/l.vec3.dot(M,c.plane.normal(w.planes[4])),l.vec3.scale(M,M,w),l.vec3.add(L,L,M),p.projectPoint(L,W);else if(0>R[2]&&0>W[2])continue;R[2]=0;W[2]=0;w=c.lineSegment.distance2(c.lineSegment.fromPoints(R,W,P),m);w<d&&(d=w,l.vec3.copy(O,E),l.vec3.copy(U,L))}}b=e.rayBeginPoint;e=e.rayEndPoint;d<f*f&&(a=Number.MAX_VALUE,
c.lineSegment.closestLineSegmentPoint(c.lineSegment.fromPoints(O,U,P),c.lineSegment.fromPoints(b,e,ba),N)&&(l.vec3.subtract(N,N,b),a=l.vec3.length(N),l.vec3.scale(N,N,1/a),a/=l.vec3.distance(b,e)),k(a,N))}else C.error("intersection assumes a translation-only matrix")};b.prototype.computeAttachmentOrigin=function(a,c){var d=a.data;a="getVertexAttr"in d?d.getVertexAttr():"vertexAttr"in d?d.vertexAttr:null;if(!a)return null;var b=A.RibbonVertexAttributeConstants.POSITION,d="getVertexAttr"in d?d.getIndices(b):
null;return p.computeAttachmentOriginLines(a[b],d,d&&this.params.isClosed,c)};b.prototype.createLayout=function(){var a=k.newLayout().vec3f(A.RibbonVertexAttributeConstants.POSITION).f32(A.RibbonVertexAttributeConstants.SUBDIVISIONFACTOR).vec2f(A.RibbonVertexAttributeConstants.UV0).vec3f(A.RibbonVertexAttributeConstants.AUXPOS1).vec3f(A.RibbonVertexAttributeConstants.AUXPOS2);this.params.vvSizeEnabled?a.f32(A.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE):a.f32(A.RibbonVertexAttributeConstants.SIZE);
this.params.vvColorEnabled?a.f32(A.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE):a.vec4f(A.RibbonVertexAttributeConstants.COLOR);this.params.vvOpacityEnabled&&a.f32(A.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE);return a};b.prototype.createBufferWriter=function(){return new I(this.layout,this.params)};b.prototype.createRenderer=function(a,c){return new w(a,c,this,A.ribbonVertexAttributeLocations)};b.prototype.getGLMaterial=function(a){return 0===a.output||4===a.output?new F(a):
void 0};b.prototype.validateParams=function(){"miter"!==this.params.join&&(this.params.miterLimit=0)};return b}(t.Material);var F=function(c){function d(a){a=c.call(this,a)||this;a.updateParameters();return a}a.__extends(d,c);d.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(y.RibbonLineTechnique,this.material.getTechniqueConfig(this.output),this.technique)};d.prototype.beginSlot=function(a){return this.technique.configuration.occluder?3===a||10===
a||11===a:0===this.output?(this.targetSlot=this.technique.configuration.writeDepth?5:8,a===this.targetSlot):3===a};d.prototype._updateOccludeeState=function(a){a.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:a.hasOccludees}),this.updateParameters())};d.prototype.ensureParameters=function(a){0===this.output&&this._updateOccludeeState(a)};d.prototype.bind=function(a,c){a.bindProgram(this.technique.program);this.technique.bindPass(a,
this.material.getPassParameters(),c)};d.prototype.getPipelineState=function(a,c){return c?this.technique.occludeePipeline:this.technique.configuration.occluder?11===a?this.technique.occluderPipelineTransparent:10===a?this.technique.occluderPipelineOpaque:this.technique.occluderPipelineMaskWrite:this.technique.pipeline};return d}(r.GLMaterial),H=a.__assign({width:0,color:[1,1,1,1],join:"miter",cap:"butt",miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,
slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1},v.Default),I=function(){function a(a,c){this.params=c;this.numJoinSubdivisions=this.numCapSubdivisions=0;this.vertexBufferLayout=a;if(!c.isClosed)switch(this.params.cap){case "butt":this.numCapSubdivisions=0;break;case "square":this.numCapSubdivisions=1;break;case "round":this.numCapSubdivisions=G}switch(this.params.join){case "miter":case "bevel":this.numJoinSubdivisions=c.stipplePattern?
1:0;break;case "round":this.numJoinSubdivisions=J}}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){var c=2*this.numCapSubdivisions+2,d=a.indices[A.RibbonVertexAttributeConstants.POSITION].length/2+1,b=this.params.isClosed,c=b?2:2*c,e=b?0:1,d=b?d:d-1;if(a.vertexAttr[A.RibbonVertexAttributeConstants.SUBDIVISIONS])for(a=a.vertexAttr[A.RibbonVertexAttributeConstants.SUBDIVISIONS].data;e<d;++e)c+=4+2*a[e];else c+=(d-e)*(2*this.numJoinSubdivisions+
4);return c+2};a.prototype.write=function(a,c,d,b){var e=this,f=V,g=T,k=X,h=c.vertexAttr[A.RibbonVertexAttributeConstants.POSITION].data,p=c.indices&&c.indices[A.RibbonVertexAttributeConstants.POSITION];p&&p.length!==2*(h.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");p=null;c.vertexAttr[A.RibbonVertexAttributeConstants.SUBDIVISIONS]&&(p=c.vertexAttr[A.RibbonVertexAttributeConstants.SUBDIVISIONS].data);var m=1,q=0;this.params.vvSizeEnabled?q=c.vertexAttr[A.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE].data[0]:
c.vertexAttr[A.RibbonVertexAttributeConstants.SIZE]&&(m=c.vertexAttr[A.RibbonVertexAttributeConstants.SIZE].data[0]);var r=[1,1,1,1],t=0;this.params.vvColorEnabled?t=c.vertexAttr[A.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE].data[0]:c.vertexAttr[A.RibbonVertexAttributeConstants.COLOR]&&(r=c.vertexAttr[A.RibbonVertexAttributeConstants.COLOR].data);var w=0;this.params.vvOpacityEnabled&&(w=c.vertexAttr[A.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE].data[0]);c=h.length/3;a=a.transformation;
var u=new Float32Array(d.buffer);d=this.vertexBufferLayout.stride/4;var y=b*d;b=y;var v=function(a,c,d,b,f,g){u[y++]=c[0];u[y++]=c[1];u[y++]=c[2];u[y++]=b;u[y++]=f;u[y++]=g;u[y++]=a[0];u[y++]=a[1];u[y++]=a[2];u[y++]=d[0];u[y++]=d[1];u[y++]=d[2];e.params.vvSizeEnabled?u[y++]=q:u[y++]=m;e.params.vvColorEnabled?u[y++]=t:(u[y++]=r[0],u[y++]=r[1],u[y++]=r[2],u[y++]=r[3]);e.params.vvOpacityEnabled&&(u[y++]=w)},y=y+d;l.vec3.set(g,h[0],h[1],h[2]);a&&l.vec3.transformMat4(g,g,a);var z=this.params.isClosed;
if(z){var C=h.length-3;l.vec3.set(f,h[C],h[C+1],h[C+2]);a&&l.vec3.transformMat4(f,f,a)}else{l.vec3.copy(f,g);l.vec3.set(k,h[3],h[4],h[5]);a&&l.vec3.transformMat4(k,k,a);for(C=0;C<this.numCapSubdivisions;++C){var H=1-C/this.numCapSubdivisions;v(f,g,k,H,1,-4);v(f,g,k,H,1,4)}v(f,g,k,0,0,-4);v(f,g,k,0,0,4);l.vec3.copy(f,g);l.vec3.copy(g,k)}for(var E=z?c:c-1,C=z?0:1;C<E;C++){H=(C+1)%c*3;l.vec3.set(k,h[H+0],h[H+1],h[H+2]);a&&l.vec3.transformMat4(k,k,a);v(f,g,k,0,1,-1);v(f,g,k,0,1,1);for(var F=p?p[C]:this.numJoinSubdivisions,
G=0;G<F;++G)H=(G+1)/(F+1),v(f,g,k,H,1,-2),v(f,g,k,H,1,2);v(f,g,k,1,0,-2);v(f,g,k,1,0,2);l.vec3.copy(f,g);l.vec3.copy(g,k)}if(z)y=B(u,b+d,u,y,2*d);else for(v(f,g,k,0,1,-5),v(f,g,k,0,1,5),C=0;C<this.numCapSubdivisions;++C)H=(C+1)/this.numCapSubdivisions,v(f,g,k,H,1,-5),v(f,g,k,H,1,5);B(u,b+d,u,b,d);y=B(u,y-d,u,y,d)};return a}(),G=3,J=1,E=d.vec3f64.create(),L=d.vec3f64.create(),M=d.vec3f64.create(),N=d.vec3f64.create(),Q=d.vec3f64.create(),R=f.createRenderScreenPointArray3(),W=f.createRenderScreenPointArray3(),
O=d.vec3f64.create(),U=d.vec3f64.create(),P=c.lineSegment.create(),ba=c.lineSegment.create(),V=d.vec3f64.create(),T=d.vec3f64.create(),X=d.vec3f64.create(),Y=[f.createRenderScreenPointArray3(),f.createRenderScreenPointArray3(),f.createRenderScreenPointArray3(),f.createRenderScreenPointArray3()],da=[d.vec3f64.create(),d.vec3f64.create(),d.vec3f64.create(),d.vec3f64.create()],fa=c.plane.create(),ga=c.plane.create(),ka=c.plane.create(),la=c.plane.create();return n})},"esri/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":function(){define(["require",
"exports","../../../../core/libs/gl-matrix-2/mat3f64","../../../../core/libs/gl-matrix-2/vec3f32"],function(n,b,a,m){var h;(h||(h={})).Default={vvSizeEnabled:!1,vvSizeMinSize:m.vec3f32.fromValues(1,1,1),vvSizeMaxSize:m.vec3f32.fromValues(100,100,100),vvSizeOffset:m.vec3f32.fromValues(0,0,0),vvSizeFactor:m.vec3f32.fromValues(1,1,1),vvSizeValue:m.vec3f32.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:a.mat3f64.create()};return h})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports tslib ../../../../core/maybe ../../../../core/maybe ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/StencilUtils ./RibbonLine.glsl ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u){Object.defineProperty(b,"__esModule",{value:!0});b.RibbonVertexAttributeConstants={POSITION:"position",SUBDIVISIONFACTOR:"subdivisionFactor",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",SUBDIVISIONS:"subdivisions",COLOR:"color",COLORFEATUREATTRIBUTE:"colorFeatureAttribute",SIZE:"size",SIZEFEATUREATTRIBUTE:"sizeFeatureAttribute",OPACITYFEATUREATTRIBUTE:"opacityFeatureAttribute"};b.ribbonVertexAttributeLocations={position:0,subdivisionFactor:1,uv0:2,auxpos1:3,
auxpos2:4,size:6,sizeFeatureAttribute:6,color:5,colorFeatureAttribute:5,opacityFeatureAttribute:7};c=function(c){function k(a,d){d=c.call(this,a,d)||this;d.stipplePattern=null;d.stippleTextureBind=null;d.stippleTextureRepository=a.stippleTextureRepository;return d}a.__extends(k,c);k.prototype.initializeProgram=function(a){var c=k.shader.get(),d=this.configuration,c=c.build({output:d.output,slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:d.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,
stippleEnabled:d.stippleEnabled,stippleOffColorEnabled:d.stippleOffColorEnabled,stippleUVMaxEnabled:d.stippleIntegerRepeatsEnabled,stippleIntegerRepeatsEnabled:d.stippleIntegerRepeatsEnabled,roundCaps:d.roundCaps,roundJoins:d.roundJoins,vvColor:d.vvColor,vvSize:d.vvSize,vvInstancingEnabled:!0,vvOpacity:d.vvOpacity,falloffEnabled:d.falloffEnabled,innerColorEnabled:d.innerColorEnabled});return new t(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),b.ribbonVertexAttributeLocations)};k.prototype.dispose=
function(){c.prototype.dispose.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};k.prototype.bindPass=function(a,c,d){4===this.configuration.output&&g.OutputHighlight.bindOutputHighlight(a,this.program,d);this.program.setUniform1f("intrinsicWidth",c.width);this.program.setUniform4fv("intrinsicColor",c.color);this.program.setUniform1f("miterLimit","miter"!==c.join?0:c.miterLimit);this.program.setUniform1f("nearPlane",d.nearFar[0]);
this.program.setUniform1f("pixelRatio",d.pixelRatio);this.program.setUniform2fv("screenSize",[d.viewport[2],d.viewport[3]]);l.VisualVariables.bindUniformsWithOpacity(this.program,c);if(this.stipplePattern!==c.stipplePattern){var b=c.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,b);this.stipplePattern=b}this.configuration.stippleEnabled&&(a=h.isSome(this.stippleTextureBind)?this.stippleTextureBind(a,0)*d.pixelRatio:1,this.program.setUniform1i("stipplePatternTexture",
0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/a),this.configuration.stippleOffColorEnabled&&(a=m.unwrap(c.stippleOffColor),this.program.setUniform4f("stippleOffColor",a[0],a[1],a[2],3<a.length?a[3]:1)));this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",c.falloff);this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",m.unwrapOr(c.innerColor,c.color)),this.program.setUniform1f("innerWidth",c.innerWidth*d.pixelRatio))};k.prototype.bindDraw=
function(a){f.Transform.bindUniforms(this.program,a);e.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};k.prototype.initializePipeline=function(){var a=this.configuration,c=u.separateBlendingParams(770,1,771,771),d=a.polygonOffset&&v;a.occluder&&(this._occluderPipelineTransparent=u.makePipelineState({blending:c,polygonOffset:d,depthTest:p.depthCompareAlways,depthWrite:null,colorWrite:u.defaultColorWriteParams,stencilWrite:null,stencilTest:p.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=
u.makePipelineState({polygonOffset:d,depthTest:p.depthCompareAlways,depthWrite:null,colorWrite:u.defaultColorWriteParams,stencilWrite:p.stencilWriteMaskOff,stencilTest:p.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=u.makePipelineState({polygonOffset:d,depthTest:p.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:p.stencilWriteMaskOn,stencilTest:p.stencilToolMaskBaseParams}));if(0===a.output){var b=function(b){return u.makePipelineState({blending:c,polygonOffset:d,depthTest:p.depthCompareLess,
depthWrite:!a.transparent&&a.writeDepth&&u.defaultDepthWriteParams,colorWrite:u.defaultColorWriteParams,stencilWrite:a.sceneHasOcludees?p.stencilWriteMaskOn:null,stencilTest:a.sceneHasOcludees?b?p.stencilToolMaskBaseParams:a.sceneHasOcludees?p.stencilBaseAllZerosParams:null:null})};this._occludeePipeline=b(!0);return b(!1)}return u.makePipelineState({polygonOffset:d,depthTest:p.depthCompareLess,depthWrite:!a.transparent&&a.writeDepth&&u.defaultDepthWriteParams,colorWrite:u.defaultColorWriteParams})};
Object.defineProperty(k.prototype,"occluderPipelineTransparent",{get:function(){return this._occluderPipelineTransparent},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"occluderPipelineOpaque",{get:function(){return this._occluderPipelineOpaque},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"occludeePipeline",{get:function(){return this._occludeePipeline},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"occluderPipelineMaskWrite",{get:function(){return this._occluderPipelineMaskWrite},
enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"primitiveType",{get:function(){return 5},enumerable:!0,configurable:!0});k.shader=new d.ReloadableShaderModule(r,function(){return new Promise(function(a,c){n(["./RibbonLine.glsl"],a,c)})});return k}(c.ShaderTechnique);b.RibbonLineTechnique=c;var v={factor:0,units:-4};c=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;a.output=0;a.occluder=!1;a.slicePlaneEnabled=!1;a.sliceHighlightDisabled=!1;a.vertexColors=!1;
a.transparent=!1;a.polygonOffset=!1;a.writeDepth=!1;a.stippleEnabled=!1;a.stippleOffColorEnabled=!1;a.stippleIntegerRepeatsEnabled=!1;a.roundCaps=!1;a.roundJoins=!1;a.vvSize=!1;a.vvColor=!1;a.vvOpacity=!1;a.falloffEnabled=!1;a.innerColorEnabled=!1;a.sceneHasOcludees=!1;return a}a.__extends(d,c);a.__decorate([k.parameter({count:7})],d.prototype,"output",void 0);a.__decorate([k.parameter()],d.prototype,"occluder",void 0);a.__decorate([k.parameter()],d.prototype,"slicePlaneEnabled",void 0);a.__decorate([k.parameter()],
d.prototype,"sliceHighlightDisabled",void 0);a.__decorate([k.parameter()],d.prototype,"vertexColors",void 0);a.__decorate([k.parameter()],d.prototype,"transparent",void 0);a.__decorate([k.parameter()],d.prototype,"polygonOffset",void 0);a.__decorate([k.parameter()],d.prototype,"writeDepth",void 0);a.__decorate([k.parameter()],d.prototype,"stippleEnabled",void 0);a.__decorate([k.parameter()],d.prototype,"stippleOffColorEnabled",void 0);a.__decorate([k.parameter()],d.prototype,"stippleIntegerRepeatsEnabled",
void 0);a.__decorate([k.parameter()],d.prototype,"roundCaps",void 0);a.__decorate([k.parameter()],d.prototype,"roundJoins",void 0);a.__decorate([k.parameter()],d.prototype,"vvSize",void 0);a.__decorate([k.parameter()],d.prototype,"vvColor",void 0);a.__decorate([k.parameter()],d.prototype,"vvOpacity",void 0);a.__decorate([k.parameter()],d.prototype,"falloffEnabled",void 0);a.__decorate([k.parameter()],d.prototype,"innerColorEnabled",void 0);a.__decorate([k.parameter()],d.prototype,"sceneHasOcludees",
void 0);return d}(k.ShaderTechniqueConfiguration);b.RibbonLineTechniqueConfiguration=c})},"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.depthCompareLess={func:513};b.depthCompareAlways={func:519};b.stencilWriteMaskOn={mask:255};b.stencilWriteMaskOff={mask:0};b.renderWhenBitIsNotSet=function(a){return{function:{func:517,ref:a,mask:a},operation:{fail:7680,zFail:7680,zPass:7680}}};b.replaceBitWhenDepthTestPasses=
function(a){return{function:{func:519,ref:a,mask:a},operation:{fail:7680,zFail:7680,zPass:7681}}};b.stencilBaseAllZerosParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}};b.stencilToolMaskBaseParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}};b.stencilToolMaskOccluderParams={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}};b.stencilToolTransparentOccluderParams={function:{func:517,ref:2,mask:2},operation:{fail:7680,
zFail:7680,zPass:7680}}})},"esri/views/3d/webgl-engine/shaders/RibbonLine.glsl":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../core/shaderLibrary/shading/LineStipple.glsl ../core/shaderLibrary/shading/PiUtils.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),function(n,b,a,m,h,e,f,g,l){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var n=new l.ShaderBuilder;
n.extensions.add("GL_OES_standard_derivatives");n.include(f.PiUtils);n.include(h.RibbonVertexPosition,b);n.include(e.LineStipple,b);n.vertex.uniforms.add("proj","mat4").add("view","mat4").add("nearPlane","float").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2");n.attributes.add("position","vec3");n.attributes.add("subdivisionFactor","float");n.attributes.add("uv0","vec2");n.attributes.add("auxpos1","vec3");n.attributes.add("auxpos2","vec3");n.varyings.add("vColor","vec4");
n.varyings.add("vpos","vec3");var R=b.falloffEnabled,U=b.innerColorEnabled;U&&n.varyings.add("vLineDistance","float");R&&n.varyings.add("vLineDistanceNorm","float");b.falloffEnabled&&n.fragment.uniforms.add("falloff","float");b.innerColorEnabled&&(n.fragment.uniforms.add("innerColor","vec4"),n.fragment.uniforms.add("innerWidth","float"));n.vertex.code.add(g.glsl(d||(d=a.__makeTemplateObject(["\n\t\t#define PERPENDICULAR(v) vec2(v.y, -v.x);\n\t\t#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y \x3e 0.0\n\n\t\tfloat interp(float ncp, vec4 a, vec4 b) {\n\t\t\treturn (-ncp - a.z) / (b.z - a.z);\n\t\t}\n\n\t\tvec2 rotate(vec2 v, float a) {\n\t\t\tfloat s \x3d sin(a);\n\t\t\tfloat c \x3d cos(a);\n\t\t\tmat2 m \x3d mat2(c, -s, s, c);\n\t\t\treturn m * v;\n\t\t}\n"],
["\n\t\t#define PERPENDICULAR(v) vec2(v.y, -v.x);\n\t\t#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y \x3e 0.0\n\n\t\tfloat interp(float ncp, vec4 a, vec4 b) {\n\t\t\treturn (-ncp - a.z) / (b.z - a.z);\n\t\t}\n\n\t\tvec2 rotate(vec2 v, float a) {\n\t\t\tfloat s \x3d sin(a);\n\t\t\tfloat c \x3d cos(a);\n\t\t\tmat2 m \x3d mat2(c, -s, s, c);\n\t\t\treturn m * v;\n\t\t}\n"]))));n.vertex.code.add(g.glsl(c||(c=a.__makeTemplateObject(["\n    vec4 projectAndScale(vec4 pos) {\n      vec4 posNdc \x3d proj * pos;\n\n      // Note that posNdc is in -1:1, scaling by screenSize converts this to a coordinate system\n      // that is twice scaled (going from -size:size).\n      posNdc.xy *\x3d screenSize / posNdc.w;\n      return posNdc;\n    }\n"],
["\n    vec4 projectAndScale(vec4 pos) {\n      vec4 posNdc \x3d proj * pos;\n\n      // Note that posNdc is in -1:1, scaling by screenSize converts this to a coordinate system\n      // that is twice scaled (going from -size:size).\n      posNdc.xy *\x3d screenSize / posNdc.w;\n      return posNdc;\n    }\n"]))));n.vertex.code.add(g.glsl(k||(k=a.__makeTemplateObject(["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp \x3d nearPlane*0.99;\n\n      //current pos behind ncp --\x3e we need to clip\n      if(pos.z \x3e -nearPlane) {\n        if (!isStartVertex) {\n          //previous in front of ncp\n          if(prev.z \x3c -nearPlane) {\n            pos \x3d mix(prev, pos, interp(vnp, prev, pos));\n            next \x3d pos;\n          } else {\n            pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n        //next in front of ncp\n        if(isStartVertex) {\n          if(next.z \x3c -nearPlane) {\n            pos \x3d mix(pos, next, interp(vnp, pos, next));\n            prev \x3d pos;\n          } else {\n            pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        //previous behind ncp\n        if (prev.z \x3e -nearPlane) {\n          prev \x3d mix(pos, prev, interp(vnp, pos, prev));\n        }\n        //next behind ncp\n        if (next.z \x3e -nearPlane) {\n          next \x3d mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      pos \x3d projectAndScale(pos);\n      next \x3d projectAndScale(next);\n      prev \x3d projectAndScale(prev);\n    }\n"],
["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp \x3d nearPlane*0.99;\n\n      //current pos behind ncp --\x3e we need to clip\n      if(pos.z \x3e -nearPlane) {\n        if (!isStartVertex) {\n          //previous in front of ncp\n          if(prev.z \x3c -nearPlane) {\n            pos \x3d mix(prev, pos, interp(vnp, prev, pos));\n            next \x3d pos;\n          } else {\n            pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n        //next in front of ncp\n        if(isStartVertex) {\n          if(next.z \x3c -nearPlane) {\n            pos \x3d mix(pos, next, interp(vnp, pos, next));\n            prev \x3d pos;\n          } else {\n            pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        //previous behind ncp\n        if (prev.z \x3e -nearPlane) {\n          prev \x3d mix(pos, prev, interp(vnp, pos, prev));\n        }\n        //next behind ncp\n        if (next.z \x3e -nearPlane) {\n          next \x3d mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      pos \x3d projectAndScale(pos);\n      next \x3d projectAndScale(next);\n      prev \x3d projectAndScale(prev);\n    }\n"]))));
n.vertex.code.add(g.glsl(p||(p=a.__makeTemplateObject(["\n  void main(void) {\n    float coverage \x3d 1.0;\n    vpos \x3d position;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y \x3d\x3d 0.0) {\n      // Project out of clip space\n      gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isStartVertex \x3d abs(abs(uv0.y)-3.0) \x3d\x3d 1.0;\n      bool isJoin \x3d abs(uv0.y)-3.0 \x3c 0.0;\n\n      float lineWidth \x3d getSize() * pixelRatio;\n\n      // convert sub-pixel coverage to alpha\n      if (lineWidth \x3c 1.0) {\n        coverage \x3d lineWidth;\n        lineWidth \x3d 1.0;\n      }else{\n        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if\n        // larger than one for better quality. Note that we do render \x3c 1 pixels more or less correctly\n        // so we only really care to round anything larger than 1.\n        lineWidth \x3d floor(lineWidth + 0.5);\n      }\n\n      vec4 pos  \x3d view * vec4(position.xyz, 1.0);\n      vec4 prev \x3d view * vec4(auxpos1.xyz, 1.0);\n      vec4 next \x3d view * vec4(auxpos2.xyz, 1.0);\n\n      clipAndTransform(pos, prev, next, isStartVertex);\n\n      vec2 left \x3d (pos.xy - prev.xy);\n      vec2 right \x3d (next.xy - pos.xy);\n\n      float leftLen \x3d length(left);\n      float rightLen \x3d length(right);\n  "],
["\n  void main(void) {\n    float coverage \x3d 1.0;\n    vpos \x3d position;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y \x3d\x3d 0.0) {\n      // Project out of clip space\n      gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isStartVertex \x3d abs(abs(uv0.y)-3.0) \x3d\x3d 1.0;\n      bool isJoin \x3d abs(uv0.y)-3.0 \x3c 0.0;\n\n      float lineWidth \x3d getSize() * pixelRatio;\n\n      // convert sub-pixel coverage to alpha\n      if (lineWidth \x3c 1.0) {\n        coverage \x3d lineWidth;\n        lineWidth \x3d 1.0;\n      }else{\n        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if\n        // larger than one for better quality. Note that we do render \x3c 1 pixels more or less correctly\n        // so we only really care to round anything larger than 1.\n        lineWidth \x3d floor(lineWidth + 0.5);\n      }\n\n      vec4 pos  \x3d view * vec4(position.xyz, 1.0);\n      vec4 prev \x3d view * vec4(auxpos1.xyz, 1.0);\n      vec4 next \x3d view * vec4(auxpos2.xyz, 1.0);\n\n      clipAndTransform(pos, prev, next, isStartVertex);\n\n      vec2 left \x3d (pos.xy - prev.xy);\n      vec2 right \x3d (next.xy - pos.xy);\n\n      float leftLen \x3d length(left);\n      float rightLen \x3d length(right);\n  "]))));
b.stippleEnabled&&n.vertex.code.add(g.glsl(r||(r=a.__makeTemplateObject(["\n      // uv0.x is either 0 or 1, depending on whether this is considered the start of a line segment\n      // or the end. If start, then use pos-\x3enext, otherwise use prev-\x3epos to define the line segment\n      // vector\n      vec4 stippleSegmentInfo \x3d mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);\n      vec2 stippleSegmentOrigin \x3d stippleSegmentInfo.xy;\n\n      // Scale s.t. it's in units of stipple pattern size.\n      vec2 stippleSegmentDirection \x3d stippleSegmentInfo.zw;\n    "],
["\n      // uv0.x is either 0 or 1, depending on whether this is considered the start of a line segment\n      // or the end. If start, then use pos-\x3enext, otherwise use prev-\x3epos to define the line segment\n      // vector\n      vec4 stippleSegmentInfo \x3d mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);\n      vec2 stippleSegmentOrigin \x3d stippleSegmentInfo.xy;\n\n      // Scale s.t. it's in units of stipple pattern size.\n      vec2 stippleSegmentDirection \x3d stippleSegmentInfo.zw;\n    "]))));
n.vertex.code.add(g.glsl(t||(t=a.__makeTemplateObject(['\n    left \x3d (leftLen \x3e 0.001) ? left/leftLen : vec2(0.0, 0.0);\n    right \x3d (rightLen \x3e 0.001) ? right/rightLen : vec2(0.0, 0.0);\n\n    vec2 capDisplacementDir \x3d vec2(0, 0);\n    vec2 joinDisplacementDir \x3d vec2(0, 0);\n    float displacementLen \x3d lineWidth;\n\n    if (isJoin) {\n\n      // JOIN handling ---------------------------------------------------\n      // determine if vertex is on the "outside or "inside" of the join\n      bool isOutside \x3d ISOUTSIDE;\n\n      // compute miter join position first\n      joinDisplacementDir \x3d normalize(left + right);\n      joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n\n      // compute miter stretch\n      if (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\n        float nDotSeg \x3d dot(joinDisplacementDir, left);\n        displacementLen /\x3d length(nDotSeg * left - joinDisplacementDir);\n\n        // limit displacement of inner vertices\n        if (!isOutside) {\n          displacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n        }\n      }\n\n      if (isOutside \x26\x26 (displacementLen \x3e miterLimit * lineWidth)) {\n    '],
['\n    left \x3d (leftLen \x3e 0.001) ? left/leftLen : vec2(0.0, 0.0);\n    right \x3d (rightLen \x3e 0.001) ? right/rightLen : vec2(0.0, 0.0);\n\n    vec2 capDisplacementDir \x3d vec2(0, 0);\n    vec2 joinDisplacementDir \x3d vec2(0, 0);\n    float displacementLen \x3d lineWidth;\n\n    if (isJoin) {\n\n      // JOIN handling ---------------------------------------------------\n      // determine if vertex is on the "outside or "inside" of the join\n      bool isOutside \x3d ISOUTSIDE;\n\n      // compute miter join position first\n      joinDisplacementDir \x3d normalize(left + right);\n      joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n\n      // compute miter stretch\n      if (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\n        float nDotSeg \x3d dot(joinDisplacementDir, left);\n        displacementLen /\x3d length(nDotSeg * left - joinDisplacementDir);\n\n        // limit displacement of inner vertices\n        if (!isOutside) {\n          displacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n        }\n      }\n\n      if (isOutside \x26\x26 (displacementLen \x3e miterLimit * lineWidth)) {\n    ']))));
b.roundJoins?n.vertex.code.add(g.glsl(u||(u=a.__makeTemplateObject(["\n        vec2 startDir;\n        vec2 endDir;\n\n        if (leftLen \x3c 0.001) {\n          startDir \x3d right;\n        }\n        else{\n          startDir \x3d left;\n        }\n        startDir \x3d normalize(startDir);\n        startDir \x3d PERPENDICULAR(startDir);\n\n        if (rightLen \x3c 0.001) {\n          endDir \x3d left;\n        }\n        else{\n          endDir \x3d right;\n        }\n        endDir \x3d normalize(endDir);\n        endDir \x3d PERPENDICULAR(endDir);\n\n        float rotationAngle \x3d acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir \x3d rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);\n      "],
["\n        vec2 startDir;\n        vec2 endDir;\n\n        if (leftLen \x3c 0.001) {\n          startDir \x3d right;\n        }\n        else{\n          startDir \x3d left;\n        }\n        startDir \x3d normalize(startDir);\n        startDir \x3d PERPENDICULAR(startDir);\n\n        if (rightLen \x3c 0.001) {\n          endDir \x3d left;\n        }\n        else{\n          endDir \x3d right;\n        }\n        endDir \x3d normalize(endDir);\n        endDir \x3d PERPENDICULAR(endDir);\n\n        float rotationAngle \x3d acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir \x3d rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);\n      "])))):
n.vertex.code.add(g.glsl(v||(v=a.__makeTemplateObject(["\n        // convert to bevel join if miterLimit is exceeded\n        if (leftLen \x3c 0.001) {\n          joinDisplacementDir \x3d right;\n        }\n        else if (rightLen \x3c 0.001) {\n          joinDisplacementDir \x3d left;\n        }\n        else {\n          joinDisplacementDir \x3d isStartVertex ? right : left;\n        }\n        joinDisplacementDir \x3d normalize(joinDisplacementDir);\n        joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n  "],
["\n        // convert to bevel join if miterLimit is exceeded\n        if (leftLen \x3c 0.001) {\n          joinDisplacementDir \x3d right;\n        }\n        else if (rightLen \x3c 0.001) {\n          joinDisplacementDir \x3d left;\n        }\n        else {\n          joinDisplacementDir \x3d isStartVertex ? right : left;\n        }\n        joinDisplacementDir \x3d normalize(joinDisplacementDir);\n        joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n  "]))));n.vertex.code.add(g.glsl(z||
(z=a.__makeTemplateObject(["\n        displacementLen \x3d lineWidth;\n      }\n    } else {\n    // CAP handling ---------------------------------------------------\n    if (leftLen \x3c 0.001) {\n      joinDisplacementDir \x3d right;\n    }\n    else if (rightLen \x3c 0.001) {\n      joinDisplacementDir \x3d left;\n    }\n    else {\n      joinDisplacementDir \x3d isStartVertex ? right : left;\n    }\n    joinDisplacementDir \x3d normalize(joinDisplacementDir);\n    joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n    displacementLen \x3d lineWidth;\n\n    capDisplacementDir \x3d isStartVertex ? -right : left;\n  "],
["\n        displacementLen \x3d lineWidth;\n      }\n    } else {\n    // CAP handling ---------------------------------------------------\n    if (leftLen \x3c 0.001) {\n      joinDisplacementDir \x3d right;\n    }\n    else if (rightLen \x3c 0.001) {\n      joinDisplacementDir \x3d left;\n    }\n    else {\n      joinDisplacementDir \x3d isStartVertex ? right : left;\n    }\n    joinDisplacementDir \x3d normalize(joinDisplacementDir);\n    joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n    displacementLen \x3d lineWidth;\n\n    capDisplacementDir \x3d isStartVertex ? -right : left;\n  "]))));
b.roundCaps?n.vertex.code.add(g.glsl(w||(w=a.__makeTemplateObject(["\n    float angle \x3d subdivisionFactor*PI*0.5;\n    joinDisplacementDir *\x3d cos(angle);\n    capDisplacementDir *\x3d sin(angle);\n    "],["\n    float angle \x3d subdivisionFactor*PI*0.5;\n    joinDisplacementDir *\x3d cos(angle);\n    capDisplacementDir *\x3d sin(angle);\n    "])))):n.vertex.code.add(g.glsl(q||(q=a.__makeTemplateObject(["\n    capDisplacementDir *\x3d subdivisionFactor;\n    "],["\n    capDisplacementDir *\x3d subdivisionFactor;\n    "]))));
n.vertex.code.add(g.glsl(C||(C=a.__makeTemplateObject(["\n  }\n\n  // Displacement (in pixels) caused by join/or cap\n  vec2 dpos \x3d joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n\n  ","\n\n  ","\n  ","\n\n  pos.xy +\x3d dpos;\n  "],["\n  }\n\n  // Displacement (in pixels) caused by join/or cap\n  vec2 dpos \x3d joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n\n  ","\n\n  ","\n  ","\n\n  pos.xy +\x3d dpos;\n  "])),
R||U?g.glsl(y||(y=a.__makeTemplateObject(["float lineDist \x3d lineWidth * sign(uv0.y) * pos.w;"],["float lineDist \x3d lineWidth * sign(uv0.y) * pos.w;"]))):"",U?g.glsl(A||(A=a.__makeTemplateObject(["vLineDistance \x3d lineDist;"],["vLineDistance \x3d lineDist;"]))):"",R?g.glsl(B||(B=a.__makeTemplateObject(["vLineDistanceNorm \x3d lineDist / lineWidth;"],["vLineDistanceNorm \x3d lineDist / lineWidth;"]))):""));b.stippleEnabled&&(n.vertex.code.add(g.glsl(F||(F=a.__makeTemplateObject(["\n    {\n      // Compute the stipple pattern UV coordinate from the actual position, based on the origin\n      // and direction of the line segment on which the stipple pattern is based.\n\n      // Project the vector from the origin of the segment to the vertex onto the line segment.\n      // Note the 0.5 factor due to projected positions being at twice the screen size scale (see projectAndScale)\n      vec2 posVec \x3d pos.xy - stippleSegmentOrigin;\n\n      float stippleSegmentDirectionLength \x3d length(stippleSegmentDirection);\n    "],
["\n    {\n      // Compute the stipple pattern UV coordinate from the actual position, based on the origin\n      // and direction of the line segment on which the stipple pattern is based.\n\n      // Project the vector from the origin of the segment to the vertex onto the line segment.\n      // Note the 0.5 factor due to projected positions being at twice the screen size scale (see projectAndScale)\n      vec2 posVec \x3d pos.xy - stippleSegmentOrigin;\n\n      float stippleSegmentDirectionLength \x3d length(stippleSegmentDirection);\n    "])))),
b.stippleIntegerRepeatsEnabled&&n.vertex.code.add(g.glsl(H||(H=a.__makeTemplateObject(["\n      float numberOfPatternRepeats \x3d stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;\n      float roundedNumberOfPatternRepeats \x3d max(1.0, floor(numberOfPatternRepeats + 0.5));\n      stipplePatternUvMax \x3d roundedNumberOfPatternRepeats;\n      "],["\n      float numberOfPatternRepeats \x3d stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;\n      float roundedNumberOfPatternRepeats \x3d max(1.0, floor(numberOfPatternRepeats + 0.5));\n      stipplePatternUvMax \x3d roundedNumberOfPatternRepeats;\n      "])))),
n.vertex.code.add(g.glsl(I||(I=a.__makeTemplateObject(["\n      if (stippleSegmentDirectionLength \x3e\x3d 0.001) {\n        // Project the vertex position onto the line segment.\n        float projectedLength \x3d dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;\n     ","\n        stipplePatternUv \x3d projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;\n        } else {\n          stipplePatternUv \x3d 1.0;\n        }\n      }\n    "],["\n      if (stippleSegmentDirectionLength \x3e\x3d 0.001) {\n        // Project the vertex position onto the line segment.\n        float projectedLength \x3d dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;\n     ",
"\n        stipplePatternUv \x3d projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;\n        } else {\n          stipplePatternUv \x3d 1.0;\n        }\n      }\n    "])),b.stippleIntegerRepeatsEnabled?"float wholeNumberOfRepeatsScale \x3d roundedNumberOfPatternRepeats / numberOfPatternRepeats;":"float wholeNumberOfRepeatsScale \x3d 1.0;")));n.vertex.code.add(g.glsl(G||(G=a.__makeTemplateObject(["\n      // Convert back into NDC\n      pos.xy \x3d pos.xy / screenSize * pos.w;\n\n      vColor \x3d getColor();\n      vColor.a *\x3d coverage;\n\n      gl_Position \x3d pos;\n    }\n  }\n  "],
["\n      // Convert back into NDC\n      pos.xy \x3d pos.xy / screenSize * pos.w;\n\n      vColor \x3d getColor();\n      vColor.a *\x3d coverage;\n\n      gl_Position \x3d pos;\n    }\n  }\n  "]))));n.include(m.Slice,b);0===b.output&&(n.fragment.uniforms.add("intrinsicColor","vec4"),n.fragment.code.add(g.glsl(J||(J=a.__makeTemplateObject(["\n    void main() {\n      discardBySlice(vpos);\n      float stippleAlpha \x3d getStippleAlpha();\n      discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n      vec4 color \x3d intrinsicColor * vColor;\n    "],
["\n    void main() {\n      discardBySlice(vpos);\n      float stippleAlpha \x3d getStippleAlpha();\n      discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n      vec4 color \x3d intrinsicColor * vColor;\n    "])))),b.innerColorEnabled&&(n.fragment.uniforms.add("pixelRatio","float"),n.fragment.code.add(g.glsl(E||(E=a.__makeTemplateObject(["\n      float distToInner \x3d abs(vLineDistance * gl_FragCoord.w) - innerWidth;\n      float innerAA \x3d clamp(0.5 - distToInner, 0.0, 1.0);\n      float innerAlpha \x3d innerColor.a + color.a * (1.0 - innerColor.a);\n      color \x3d mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);\n      "],
["\n      float distToInner \x3d abs(vLineDistance * gl_FragCoord.w) - innerWidth;\n      float innerAA \x3d clamp(0.5 - distToInner, 0.0, 1.0);\n      float innerAlpha \x3d innerColor.a + color.a * (1.0 - innerColor.a);\n      color \x3d mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);\n      "]))))),n.fragment.code.add(g.glsl(L||(L=a.__makeTemplateObject(["\n      vec4 finalColor \x3d blendStipple(color, stippleAlpha);\n    "],["\n      vec4 finalColor \x3d blendStipple(color, stippleAlpha);\n    "])))),
b.falloffEnabled&&n.fragment.code.add(g.glsl(M||(M=a.__makeTemplateObject(["\n      finalColor.a *\x3d pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);\n      "],["\n      finalColor.a *\x3d pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);\n      "])))),n.fragment.code.add(g.glsl(N||(N=a.__makeTemplateObject(["\n      gl_FragColor \x3d highlightSlice(finalColor, vpos);\n    }\n    "],["\n      gl_FragColor \x3d highlightSlice(finalColor, vpos);\n    }\n    "])))));
4===b.output&&n.fragment.code.add(g.glsl(Q||(Q=a.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        discardByStippleAlpha(getStippleAlpha(), STIPPLE_ALPHA_HIGHLIGHT_DISCARD);\n        gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        discardByStippleAlpha(getStippleAlpha(), STIPPLE_ALPHA_HIGHLIGHT_DISCARD);\n        gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n      }\n    "]))));return n};
var d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L,M,N,Q})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.RibbonVertexPosition=function(c,b){c.vertex.uniforms.add("intrinsicWidth","float");b.vvSize?(c.attributes.add("sizeFeatureAttribute","float"),c.vertex.uniforms.add("vvSizeMinSize","vec3"),c.vertex.uniforms.add("vvSizeMaxSize",
"vec3"),c.vertex.uniforms.add("vvSizeOffset","vec3"),c.vertex.uniforms.add("vvSizeFactor","vec3"),c.vertex.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n    float getSize() {\n      return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n    }\n    "],["\n    float getSize() {\n      return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n    }\n    "]))))):(c.attributes.add("size",
"float"),c.vertex.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n    float getSize(){\n      return intrinsicWidth * size;\n    }\n    "],["\n    float getSize(){\n      return intrinsicWidth * size;\n    }\n    "])))));b.vvOpacity?(c.attributes.add("opacityFeatureAttribute","float"),c.vertex.defines.addInt("VV_OPACITY_N",8),c.vertex.code.add(m.glsl(f||(f=a.__makeTemplateObject(["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    float interpolateOpacity( float value ){\n      if (value \x3c\x3d vvOpacityValues[0]) {\n        return vvOpacityOpacities[0];\n      }\n\n      for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n        }\n      }\n\n      return vvOpacityOpacities[VV_OPACITY_N - 1];\n    }\n\n    vec4 applyOpacity( vec4 color ){\n      return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n    }\n    "],
["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    float interpolateOpacity( float value ){\n      if (value \x3c\x3d vvOpacityValues[0]) {\n        return vvOpacityOpacities[0];\n      }\n\n      for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n        }\n      }\n\n      return vvOpacityOpacities[VV_OPACITY_N - 1];\n    }\n\n    vec4 applyOpacity( vec4 color ){\n      return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n    }\n    "]))))):
c.vertex.code.add(m.glsl(g||(g=a.__makeTemplateObject(["\n    vec4 applyOpacity( vec4 color ){\n      return color;\n    }\n    "],["\n    vec4 applyOpacity( vec4 color ){\n      return color;\n    }\n    "]))));b.vvColor?(c.attributes.add("colorFeatureAttribute","float"),c.vertex.defines.addInt("VV_COLOR_N",8),c.vertex.code.add(m.glsl(l||(l=a.__makeTemplateObject(["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 interpolateColor( float value ) {\n      if (value \x3c\x3d vvColorValues[0]) {\n        return vvColorColors[0];\n      }\n\n      for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n        if (vvColorValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return mix(vvColorColors[i-1], vvColorColors[i], f);\n        }\n      }\n\n      return vvColorColors[VV_COLOR_N - 1];\n    }\n\n    vec4 getColor(){\n      return applyOpacity(interpolateColor(colorFeatureAttribute));\n    }\n    "],
["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 interpolateColor( float value ) {\n      if (value \x3c\x3d vvColorValues[0]) {\n        return vvColorColors[0];\n      }\n\n      for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n        if (vvColorValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return mix(vvColorColors[i-1], vvColorColors[i], f);\n        }\n      }\n\n      return vvColorColors[VV_COLOR_N - 1];\n    }\n\n    vec4 getColor(){\n      return applyOpacity(interpolateColor(colorFeatureAttribute));\n    }\n    "]))))):
(c.attributes.add("color","vec4"),c.vertex.code.add(m.glsl(d||(d=a.__makeTemplateObject(["\n    vec4 getColor(){\n      return applyOpacity(color);\n    }\n    "],["\n    vec4 getColor(){\n      return applyOpacity(color);\n    }\n    "])))))};var h,e,f,g,l,d})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.LineStipple=function(b,
d){b.defines.addFloat("STIPPLE_ALPHA_COLOR_DISCARD",.001);b.defines.addFloat("STIPPLE_ALPHA_HIGHLIGHT_DISCARD",.5);d.stippleEnabled?(b.vertex.uniforms.add("stipplePatternPixelSizeInv","float"),d.stippleUVMaxEnabled&&b.varyings.add("stipplePatternUvMax","float"),b.varyings.add("stipplePatternUv","float"),b.fragment.uniforms.add("stipplePatternTexture","sampler2D"),d.stippleOffColorEnabled&&b.fragment.uniforms.add("stippleOffColor","vec4"),b.fragment.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n  float getStippleAlpha() {\n    float stipplePatternUvClamped \x3d stipplePatternUv * gl_FragCoord.w;\n    ",
"\n\n    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;\n  }"],["\n  float getStippleAlpha() {\n    float stipplePatternUvClamped \x3d stipplePatternUv * gl_FragCoord.w;\n    ","\n\n    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;\n  }"])),d.stippleUVMaxEnabled?"stipplePatternUvClamped \x3d clamp(stipplePatternUvClamped, 0.0, stipplePatternUvMax);":"")),d.stippleOffColorEnabled?b.fragment.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n    #define discardByStippleAlpha(stippleAlpha, threshold) {}\n    #define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)\n    "],
["\n    #define discardByStippleAlpha(stippleAlpha, threshold) {}\n    #define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)\n    "])))):b.fragment.code.add(m.glsl(f||(f=a.__makeTemplateObject(["\n    #define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha \x3c threshold) { discard; }\n    #define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)\n    "],["\n    #define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha \x3c threshold) { discard; }\n    #define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)\n    "]))))):
b.fragment.code.add(m.glsl(g||(g=a.__makeTemplateObject(["\n  float getStippleAlpha() { return 1.0; }\n\n  #define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n  #define blendStipple(color, _stippleAlpha_) color\n  "],["\n  float getStippleAlpha() { return 1.0; }\n\n  #define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n  #define blendStipple(color, _stippleAlpha_) color\n  "]))))};var h,e,f,g})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["require","exports"],
function(n,b){return function(){function a(a,b,e,f,g,l){this.camera=null;this.slot=this.pass=0;this.highlightDepthTexture=null;this.renderOccludedMask=13;this.hasOccludees=!1;this.rctx=a;this.offscreenRenderingHelper=b;this.scenelightingData=e;this.shadowMap=f;this.ssaoHelper=g;this.sliceHelper=l}a.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=13};Object.defineProperty(a.prototype,"isHighlightPass",{get:function(){return 4===this.pass},enumerable:!0,configurable:!0});return a}()})},
"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators ./Material ./rendererUtils".split(" "),function(n,b,a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",{value:!0});var c=function(){return function(){}}();n=function(b){function k(){var a=null!==b&&b.apply(this,arguments)||this;a._pendingAddsRemoves=
new Map;a._adds=new f;a._removes=new f;a._updates=new f({allocator:function(a){return a||new c},deallocator:function(a){a.renderGeometry=null;return a}});a._materialRenderers=new Map;a._sortedMaterialRenderers=new f;a._hasHighlights=!1;a._hasWater=!1;return a}a.__extends(k,b);k.prototype.dispose=function(){this._adds.prune();this._removes.prune();this._updates.prune();this._materialRenderers&&(this._materialRenderers.forEach(function(a){return a.dispose()}),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear())};
Object.defineProperty(k.prototype,"updating",{get:function(){return 0<this._pendingAddsRemoves.size||0<this._updates.length},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"hasWater",{get:function(){return this._hasWater},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"rendersOccluded",{get:function(){return h.someMap(this._materialRenderers,
function(a){return a.rendersOccluded})},enumerable:!0,configurable:!0});k.prototype.stopAnimationsAtTime=function(a){this._sortedMaterialRenderers.forEach(function(c){return e.applySome(c.material.animation,function(c){return c.stopAtTime(a)})})};Object.defineProperty(k.prototype,"isEmpty",{get:function(){return!this.updating&&0===this._materialRenderers.size},enumerable:!0,configurable:!0});k.prototype.commitChanges=function(){var a=this,c=!1;if(!this.updating)return!1;this.updateAddsRemoves();var b=
!1,e=!1;d.splitRenderGeometryChangeSetByMaterial({numToAdd:this._adds.length,toAdd:this._adds.data,numToRemove:this._removes.length,toRemove:this._removes.data,numToUpdate:this._updates.length,toUpdate:this._updates.data}).forEach(function(d,f){var g=a._materialRenderers.get(f);!g&&0<d.toAdd.length&&(g=f.createRenderer(a.rctx,a.materialRepository),a._materialRenderers.set(f,g),e=b=c=!0);if(g){var k=b||g.hasHighlights,l=e||g.hasWater;g.modify(d);b=b||k!==g.hasHighlights;e=e||l!==g.hasWater;g.isEmpty&&
(a._materialRenderers.delete(f),g.dispose(),c=!0)}});this._adds.clear();this._removes.clear();this._updates.clear();this._pendingAddsRemoves.clear();c&&this.updateSortedMaterialRenderers();b&&(this._hasHighlights=h.someMap(this._materialRenderers,function(a){return a.hasHighlights}));e&&(this._hasWater=h.someMap(this._materialRenderers,function(a){return a.hasWater}));this.notifyChange("updating");return!0};k.prototype.add=function(a){for(var c=0===this._pendingAddsRemoves.size,d=0;d<a.length;d++)this._pendingAddsRemoves.set(a[d],
0);c&&0<this._pendingAddsRemoves.size&&this.notifyChange("updating")};k.prototype.remove=function(a){for(var c=0===this._pendingAddsRemoves.size,d=0;d<a.length;d++){var b=a[d],e=this._pendingAddsRemoves.get(b);0===e?this._pendingAddsRemoves.set(b,2):2!==e&&this._pendingAddsRemoves.set(b,1)}c&&0<this._pendingAddsRemoves.size&&this.notifyChange("updating")};k.prototype.modify=function(a,c){for(var d=0===this._updates.length,b=0;b<a.length;b++){var e=a[b],f=this._updates.pushNew();f.renderGeometry=e;
f.updateType=c}d&&0<this._updates.length&&this.notifyChange("updating")};k.prototype.updateLogic=function(a){for(var c=!1,d=0;d<this._sortedMaterialRenderers.length;d++){var b=this._sortedMaterialRenderers.data[d].materialRenderer;b.updateLogic&&b.updateLogic(a)&&(c=!0)}return c};k.prototype.draw=function(a,c,d){for(var b=0;b<this._sortedMaterialRenderers.length;b++){var e=this._sortedMaterialRenderers.data[b];if(l.materialPredicate(e.material,a)){var f=d.getMaterialRenderStatsObject(e.materialRenderer.type);
e.materialRenderer.render(null,a,c,f)}}};k.prototype.updateSortedMaterialRenderers=function(){var a=this;this._sortedMaterialRenderers.clear();var c=0;this._materialRenderers.forEach(function(d,b){b.insertOrder=c++;a._sortedMaterialRenderers.push({material:b,materialRenderer:d})});this._sortedMaterialRenderers.sort(function(a,c){var d=c.material.renderPriority-a.material.renderPriority;return 0!==d?d:a.material.insertOrder-c.material.insertOrder})};k.prototype.updateAddsRemoves=function(){var a=this;
this._adds.clear();this._removes.clear();this._pendingAddsRemoves.forEach(function(c,d){switch(c){case 0:a._adds.push(d);break;case 1:a._removes.push(d)}});for(var c=0;c<this._updates.length;)this._pendingAddsRemoves.has(this._updates.data[c].renderGeometry)?this._updates.removeUnorderedIndex(c):c++};Object.defineProperty(k.prototype,"test",{get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}},enumerable:!0,configurable:!0});a.__decorate([g.property()],k.prototype,"rctx",
void 0);a.__decorate([g.property()],k.prototype,"materialRepository",void 0);a.__decorate([g.property()],k.prototype,"updating",null);return k=a.__decorate([g.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],k)}(m);b.SortedRenderGeometryRenderer=n})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["require","exports","./Util"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.splitRenderGeometryChangeSetByMaterial=function(b){for(var h=new Map,
e=null,f=null,g=function(a){if(a===e)return f;var c=h.get(a);c||(c={toAdd:[],numToAdd:-1,toRemove:[],numToRemove:-1,toUpdate:[],numToUpdate:-1},h.set(a,c));e=a;return f=c},l=0;l<b.numToAdd;l++){var d=b.toAdd[l];if(1<=a.getFirstObjectValue(d.data.indices).length){var c=g(d.material);c.toAdd.push(d)}}for(l=0;l<b.numToRemove;l++)d=b.toRemove[l],1<=a.getFirstObjectValue(d.data.indices).length&&(c=g(d.material),c.toRemove.push(d));for(l=0;l<b.numToUpdate;l++)d=b.toUpdate[l],1<=a.getFirstObjectValue(d.renderGeometry.data.indices).length&&
(c=g(d.renderGeometry.material),c.toUpdate.push(d));return h}})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports tslib ../core/shaderLibrary/util/TextureOnly.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),function(n,b,a,m,h,e,f,g,l,d){Object.defineProperty(b,
"__esModule",{value:!0});e=function(c){function b(){return null!==c&&c.apply(this,arguments)||this}a.__extends(b,c);b.prototype.initializeProgram=function(a){var c=b.shader.get().build();return new l(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),g.Default3D)};b.prototype.initializePipeline=function(){return this.configuration.hasAlpha?d.makePipelineState({blending:d.separateBlendingParams(770,1,771,771),colorWrite:d.defaultColorWriteParams}):d.makePipelineState({colorWrite:d.defaultColorWriteParams})};
b.shader=new h.ReloadableShaderModule(m,function(){return new Promise(function(a,c){n(["../core/shaderLibrary/util/TextureOnly.glsl"],a,c)})});return b}(e.ShaderTechnique);b.TextureTechnique=e;e=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;a.hasAlpha=!1;return a}a.__extends(d,c);a.__decorate([f.parameter()],d.prototype,"hasAlpha",void 0);return d}(f.ShaderTechniqueConfiguration);b.TextureTechniqueConfiguration=e})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureOnly.glsl":function(){define("require exports tslib ../ScreenSpacePass ../../shaderModules/interfaces ../../shaderModules/ShaderBuilder".split(" "),
function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(){var b=new e.ShaderBuilder;b.include(m.ScreenSpacePass);b.fragment.uniforms.add("tex","sampler2D");b.fragment.uniforms.add("color","vec4");b.fragment.code.add(h.glsl(f||(f=a.__makeTemplateObject(["\n    void main() {\n      vec4 texColor \x3d texture2D(tex, uv);\n      gl_FragColor \x3d texColor * color;\n    }\n  "],["\n    void main() {\n      vec4 texColor \x3d texture2D(tex, uv);\n      gl_FragColor \x3d texColor * color;\n    }\n  "]))));
return b};var f})},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass":function(){define(["require","exports","tslib","../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.ScreenSpacePass=function(b){b.attributes.add("position","vec2");b.varyings.add("uv","vec2");b.vertex.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n    void main(void) {\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n      uv \x3d position * 0.5 + vec2(0.5);\n    } \n  "],
["\n    void main(void) {\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n      uv \x3d position * 0.5 + vec2(0.5);\n    } \n  "]))))};var h})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64","./SphericalHarmonics"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});var e=m.vec3f64.create();n=function(){function b(){this._renderLighting={main:{intensity:m.vec3f64.create(),
direction:m.vec3f64.fromValues(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}};this._shOrder=2;this._oldSunlight={direction:m.vec3f64.create(),ambient:{color:m.vec3f64.create(),intensity:0},diffuse:{color:m.vec3f64.create(),intensity:0}}}b.prototype.setLightDirectionUniform=function(a){a.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction)};b.prototype.setUniforms=function(a,b){void 0===b&&(b=!1);b?a.setUniform1f("lightingFixedFactor",(1-this._info.groundLightingFactor)*
(1-this._info.globalFactor)):a.setUniform1f("lightingFixedFactor",0);a.setUniform1f("lightingGlobalFactor",this._info.globalFactor);this.setLightDirectionUniform(a);a.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity);a.setUniform1f("ambientBoostFactor",.4);b=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?a.setUniform3f("lightingAmbientSH0",b.r[0],b.g[0],b.b[0]):1===this._shOrder?(a.setUniform4f("lightingAmbientSH_R",b.r[0],b.r[1],b.r[2],b.r[3]),a.setUniform4f("lightingAmbientSH_G",
b.g[0],b.g[1],b.g[2],b.g[3]),a.setUniform4f("lightingAmbientSH_B",b.b[0],b.b[1],b.b[2],b.b[3])):2===this._shOrder&&(a.setUniform3f("lightingAmbientSH0",b.r[0],b.g[0],b.b[0]),a.setUniform4f("lightingAmbientSH_R1",b.r[1],b.r[2],b.r[3],b.r[4]),a.setUniform4f("lightingAmbientSH_G1",b.g[1],b.g[2],b.g[3],b.g[4]),a.setUniform4f("lightingAmbientSH_B1",b.b[1],b.b[2],b.b[3],b.b[4]),a.setUniform4f("lightingAmbientSH_R2",b.r[5],b.r[6],b.r[7],b.r[8]),a.setUniform4f("lightingAmbientSH_G2",b.g[5],b.g[6],b.g[7],
b.g[8]),a.setUniform4f("lightingAmbientSH_B2",b.b[5],b.b[6],b.b[7],b.b[8]))};b.prototype.set=function(b){this._info=b;h.combineLights(b.lights,this._shOrder,this._renderLighting);a.vec3.negate(this._oldSunlight.direction,this._renderLighting.main.direction);b=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*b;this._oldSunlight.ambient.color[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*b;this._oldSunlight.ambient.color[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*
b;this._oldSunlight.ambient.intensity=1;this._oldSunlight.diffuse.color[0]=this._renderLighting.main.intensity[0]*b;this._oldSunlight.diffuse.color[1]=this._renderLighting.main.intensity[1]*b;this._oldSunlight.diffuse.color[2]=this._renderLighting.main.intensity[2]*b;this._oldSunlight.diffuse.intensity=1;b=a.vec3.copy(e,this._oldSunlight.diffuse.color);a.vec3.scale(b,b,.4*this._info.globalFactor);a.vec3.add(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,b)};Object.defineProperty(b.prototype,
"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"old",{get:function(){return this._oldSunlight},enumerable:!0,configurable:!0});return b}();b.SceneLighting=n})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),function(n,
b,a,m,h,e,f){function g(a){return(a+1)*(a+1)}function l(c){return a.clamp(Math.floor(Math.sqrt(c)-1),0,2)}function d(a,c,d){var b=a[0],e=a[1];a=a[2];d=d||[];d.length=g(c);0<=c&&(d[0]=.28209479177);1<=c&&(d[1]=.4886025119*b,d[2]=.4886025119*a,d[3]=.4886025119*e);2<=c&&(d[4]=1.09254843059*b*e,d[5]=1.09254843059*e*a,d[6]=.31539156525*(3*a*a-1),d[7]=1.09254843059*b*a,d[8]=.54627421529*(b*b-e*e));return d}function c(a,c){a=g(a);c=c||{r:[],g:[],b:[]};c.r.length=c.g.length=c.b.length=a;for(var d=0;d<a;d++)c.r[d]=
c.g[d]=c.b[d]=0;return c}function k(a,c){for(var b=l(c.r.length),f=0;f<a.length;f++){var g=a[f];m.vec3.negate(w,g.direction);d(w,b,v);e.elementwiseProduct(v,q);e.scalarProduct(v,g.intensity[0],z);e.add(c.r,z);e.scalarProduct(v,g.intensity[1],z);e.add(c.g,z);e.scalarProduct(v,g.intensity[2],z);e.add(c.b,z)}return c}function p(a,c){d(w,0,v);for(var b=0;b<a.length;b++){var e=a[b];c.r[0]+=v[0]*q[0]*e.intensity[0]*4*Math.PI;c.g[0]+=v[0]*q[0]*e.intensity[1]*4*Math.PI;c.b[0]+=v[0]*q[0]*e.intensity[2]*4*
Math.PI}return c}Object.defineProperty(b,"__esModule",{value:!0});b.numberOfCoefficients=g;b.numberOfCoefficientsInBand=function(a){return 2*a+1};b.orderFromNumberOfCoefficients=l;b.computeCoefficients=d;b.initSHCoefficients=c;b.projectFillLights=k;b.projectAmbientLights=p;b.combineLights=function(a,d,b){c(d,b.sphericalHarmonics.sh);m.vec3.set(b.main.intensity,0,0,0);var g=!1,l=r,h=t;d=u;l.length=0;h.length=0;for(var q=d.length=0;q<a.length;q++){var w=a[q];w instanceof f.MainLight&&!g?(m.vec3.copy(b.main.direction,
w.direction),b.main.intensity[0]=w.intensity[0],b.main.intensity[1]=w.intensity[1],b.main.intensity[2]=w.intensity[2],b.main.castShadows=w.castShadows,g=!0):w instanceof f.MainLight||w instanceof f.FillLight?l.push(w):w instanceof f.AmbientLight?h.push(w):w instanceof f.SphericalHarmonicsLight&&d.push(w)}k(l,b.sphericalHarmonics.sh);p(h,b.sphericalHarmonics.sh);for(a=0;a<d.length;a++)w=d[a],e.add(b.sphericalHarmonics.sh.r,w.sh.r),e.add(b.sphericalHarmonics.sh.g,w.sh.g),e.add(b.sphericalHarmonics.sh.b,
w.sh.b)};var r=[],t=[],u=[],v=[0],z=[0],w=h.vec3f64.create(),q=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.dotProduct=function(a,b){for(var h=0,e=0;e<a.length;e++)h+=a[e]*b[e];return h};b.elementwiseProduct=function(a,b,h){h=h||a;h.length=a.length;for(var e=0;e<a.length;e++)h[e]=a[e]*b[e];return h};b.scalarProduct=
function(a,b,h){h=h||a;h.length=a.length;for(var e=0;e<a.length;e++)h[e]=a[e]*b;return h};b.add=function(a,b,h){h=h||a;h.length=a.length;for(var e=0;e<a.length;e++)h[e]=a[e]+b[e];return h}})},"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define(["require","exports","../../../../core/maybe","../../../webgl"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this.cache=new Map}b.prototype.dispose=function(){this.cache.forEach(function(b){a.isSome(b.texture)&&
(b.texture.dispose(),b.texture=null)});this.cache.clear()};b.prototype.acquire=function(b){if(a.isNone(b))return null;var e=this.patternId(b),g=this.cache.get(e);if(g)return g.refCount++,g.bind;var l=this.patternToTextureData(b,2),d=l.length/2,c={refCount:1,texture:null,bind:function(b,e){a.isNone(c.texture)&&(c.texture=new m.Texture(b,{width:l.length,height:1,internalFormat:6406,pixelFormat:6406,dataType:5121,wrapMode:33071},l));b.bindTexture(c.texture,e);return d}};this.cache.set(e,c);return c.bind};
b.prototype.release=function(b){if(!a.isNone(b)){b=this.patternId(b);var e=this.cache.get(b);e&&(e.refCount--,0===e.refCount&&(a.isSome(e.texture)&&e.texture.dispose(),this.cache.delete(b)))}};b.prototype.swap=function(a,b){b=this.acquire(b);this.release(a);return b};b.prototype.bind=function(b,f,g,l,d){b=a.isSome(l)?l(b,d)*f.pixelRatio:1;g.setUniform1i("stipplePatternTexture",d);g.setUniform1f("stipplePatternPixelSizeInv",1/b)};b.prototype.patternId=function(a){return a.join(",")};b.prototype.patternToTextureData=
function(a,b){for(var e=a.reduce(function(a,c){return a+c})*b,e=new Uint8Array(e),f=!0,d=0,c=0;c<a.length;c++){for(var k=a[c],h=0;h<k*b;h++)e[d++]=f?255:0;f=!f}return e};return b}();b.StippleTextureRepository=n;b.createStipplePattern=function(b){return a.isNone(b)?b:b.slice()};b.createStipplePatternSimple=function(a){return[a,a]}})},"esri/views/webgl":function(){define("require exports ./webgl/BufferObject ./webgl/FramebufferObject ./webgl/Program ./webgl/Renderbuffer ./webgl/RenderingContext ./webgl/ShaderCompiler ./webgl/Texture ./webgl/VertexArrayObject ./webgl/ProgramCache ./webgl/programUtils ./webgl/context-util".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p){Object.defineProperty(b,"__esModule",{value:!0});b.BufferObject=a;b.FramebufferObject=m;b.Program=h;b.Renderbuffer=e;b.RenderingContext=f;b.ShaderCompiler=g;b.Texture=l;b.VertexArrayObject=d;b.ProgramCache=c.ProgramCache;b.createProgram=k.createProgram;b.glslifyDefineMap=k.glslifyDefineMap;b.createContextOrErrorHTML=p.createContextOrErrorHTML})},"esri/views/webgl/FramebufferObject":function(){define(["require","exports","../../core/has","./Renderbuffer","./Texture"],
function(n,b,a,m,h){return function(){function a(b,e,l,d){this._colorAttachment=this._stencilAttachment=this._depthAttachment=this._glName=this._context=null;this._initialized=!1;this._context=b;this._desc={colorTarget:e.colorTarget,depthStencilTarget:e.depthStencilTarget,width:e.width,height:e.height,multisampled:e.multisampled};this._id=a._nextId++;l&&(b=void 0,l instanceof h?(this._colorAttachment=l,b=l.descriptor):(b=l,this._colorAttachment=new h(this._context,b)),0!==this._desc.colorTarget&&
console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),a._validateTextureDimensions(b,this._desc));d instanceof m?(2===e.depthStencilTarget?this._stencilAttachment=d:1===e.depthStencilTarget||3===e.depthStencilTarget?this._depthAttachment=d:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),a._validateBufferDimensions(d.descriptor,
this._desc)):d&&(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),e=void 0,d instanceof h?(this._depthStencilTexture=d,e=this._depthStencilTexture.descriptor):(e=d,this._depthStencilTexture=new h(this._context,e)),a._validateTextureDimensions(e,this._desc))}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof h?this._colorAttachment:null},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"colorAttachment",{get:function(){return this._colorAttachment},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"depthStencilAttachment",{get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._desc.width},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._desc.height},enumerable:!0,
configurable:!0});a.prototype.dispose=function(){if(this._context){var a=this._context,b=a.getBoundFramebufferObject();this._disposeColorAttachment();this._disposeDepthStencilAttachments();this._glName&&(a.gl.deleteFramebuffer(this._glName),this._glName=null);a.bindFramebuffer(b);this._context=null}};a.prototype.attachColorTexture=function(b){if(b){a._validateTextureDimensions(b.descriptor,this._desc);this._disposeColorAttachment();if(this._initialized){this._context.bindFramebuffer(this);var e=this._context.gl;
e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,b.glName,0)}this._colorAttachment=b}};a.prototype.detachColorTexture=function(){if(this._colorAttachment instanceof h){var a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0)}this._colorAttachment=null;return a}};a.prototype.attachDepthStencilTexture=function(b){if(b){var e=b.descriptor;34041!==e.pixelFormat&&
console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");34042!==e.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");a._validateTextureDimensions(e,this._desc);4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);this._disposeDepthStencilAttachments();
this._initialized&&(this._context.bindFramebuffer(this),e=this._context.gl,e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,b.glName,0));this._depthStencilTexture=b}};a.prototype.detachDepthStencilTexture=function(){var a=this._depthStencilTexture;if(a&&this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;this._context.gl.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,null,0)}this._depthStencilTexture=null;return a};
a.prototype.attachDepthStencilBuffer=function(b){if(b){var e=b.descriptor;34041!==e.internalFormat&&33189!==e.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat");a._validateBufferDimensions(e,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=34041===e.internalFormat?3:1;this._initialized&&(this._context.bindFramebuffer(this),e=this._context.gl,e.framebufferRenderbuffer(e.FRAMEBUFFER,1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:
e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,b.glName));this._depthAttachment=b}};a.prototype.detachDepthStencilBuffer=function(){var a=this._context.gl,b=this._depthAttachment;b&&this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null));this._depthAttachment=null;return b};a.prototype.copyToTexture=function(a,b,e,d,c,k,h){(0>a||0>b||0>c||0>k)&&console.error("Offsets cannot be negative!");
(0>=e||0>=d)&&console.error("Copy width and height must be greater than zero!");var f=this._desc,g=h.descriptor;3553!==h.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");(a+e>f.width||b+d>f.height||c+e>g.width||k+d>g.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");f=this._context;f.bindTexture(h);f.bindFramebuffer(this);f.gl.copyTexSubImage2D(3553,0,c,k,a,b,e,d)};a.prototype.readPixels=function(a,b,e,d,c,k,h){(0>=
e||0>=d)&&console.error("Copy width and height must be greater than zero!");h||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(a,b,e,d,c,k,h)};a.prototype.resize=function(b,e){var f=this._desc;if(f.width!==b||f.height!==e)if(this._initialized){f.width=b;f.height=e;this._colorAttachment instanceof h?(d=this._colorAttachment,f=d.descriptor,f.width=b,f.height=e,this._colorAttachment.dispose(),this._colorAttachment=new h(this._context,
f),a._validateTextureDimensions(d.descriptor,this._desc)):this._colorAttachment&&this._disposeColorAttachment();if(null!=this._depthStencilTexture)f=this._depthStencilTexture.descriptor,f.width=b,f.height=e,this._depthStencilTexture.dispose(),this._depthStencilTexture=new h(this._context,f);else if(this._depthAttachment||this._stencilAttachment)this._depthAttachment&&this._depthAttachment.resize(b,e),this._stencilAttachment&&this._stencilAttachment.resize(b,e);this._context.getBoundFramebufferObject()===
this&&this._context.bindFramebuffer(null);this._initialized=!1}else{f.width=b;f.height=e;if(this._colorAttachment instanceof h){var d=this._colorAttachment;d.resize(b,e)}this._depthStencilTexture&&this._depthStencilTexture.resize(b,e)}};a.prototype.initialize=function(){if(this._initialized)return!1;var a=this._context.gl;this._glName&&a.deleteFramebuffer(this._glName);var b=a.createFramebuffer(),e=this._desc;a.bindFramebuffer(a.FRAMEBUFFER,b);if(!this._colorAttachment)if(0===e.colorTarget)this._colorAttachment=
new h(this._context,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:e.width,height:e.height});else{var d=new m(this._context,{internalFormat:32854,width:e.width,height:e.height});a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,d.glName);this._colorAttachment=d}this._colorAttachment instanceof h&&a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this._colorAttachment.glName,0);switch(e.depthStencilTarget){case 1:case 3:this._depthAttachment||
(this._depthAttachment=new m(this._context,{internalFormat:1===e.depthStencilTarget?33189:34041,width:e.width,height:e.height}));a.framebufferRenderbuffer(a.FRAMEBUFFER,1===e.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=new m(this._context,{internalFormat:36168,width:e.width,height:e.height}));a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,this._stencilAttachment.glName);
break;case 4:this._depthStencilTexture||(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new h(this._context,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:e.width,height:e.height})),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,this._depthStencilTexture.glName,0)}this._glName=
b;return this._initialized=!0};a.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof h){var a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0)}a.dispose()}else this._colorAttachment instanceof WebGLRenderbuffer&&(a=this._colorAttachment,b=this._context.gl,this._initialized&&(this._context.bindFramebuffer(this),b.framebufferRenderbuffer(b.FRAMEBUFFER,
b.COLOR_ATTACHMENT0,b.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(a));this._colorAttachment=null};a.prototype._disposeDepthStencilAttachments=function(){var a=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._depthAttachment.dispose(),this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&
(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};a._validateBufferDimensions=function(a,b){console.assert(0<=a.width&&0<=a.height);
void 0!==b.width&&0<=b.width&&void 0!==b.height&&0<=b.height?b.width===a.width&&b.height===a.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(b.width=a.width,b.height=a.height)};a._validateTextureDimensions=function(a,b){console.assert(0<=a.width&&0<=a.height);3553!==a.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==b.width&&0<=b.width&&void 0!==b.height&&0<=b.height?b.width===a.width&&b.height===a.height||console.error("Color attachment texture must match the framebuffer's!"):
(b.width=a.width,b.height=a.height)};a._nextId=0;return a}()})},"esri/views/webgl/Renderbuffer":function(){define(["require","exports","../../core/has"],function(n,b,a){return function(){function a(b,e){this._context=b;this._desc=e;this._glName=null;this._id=-1;b=this._context.gl;this._id=++a._nextId;this._glName=b.createRenderbuffer();this._context.bindRenderbuffer(this);b.renderbufferStorage(b.RENDERBUFFER,e.internalFormat,e.width,e.height)}Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});a.prototype.resize=function(a,b){var e=this._context.gl,g=this._desc;if(g.width!==a||g.height!==b)g.width=a,g.height=b,this._context.bindRenderbuffer(this),e.renderbufferStorage(e.RENDERBUFFER,g.internalFormat,g.width,g.height)};a.prototype.dispose=function(){this._glName&&
(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null);this._context=null};a._nextId=0;return a}()})},"esri/views/webgl/RenderingContext":function(){define("require exports ../../core/has ../../core/maybe ./enums ./InstanceCounter ./renderState ./capabilities/isWebGL2Context ./capabilities/load".split(" "),function(n,b,a,m,h,e,f,g,l){return function(){function a(a,d){var c=this;this.gl=null;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,
dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=
[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._clearColor={r:0,g:0,b:0,a:0};this._activeRenderbuffer=this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap={};this._numOfTriangles=this._numOfDrawCalls=0;this.contextVersion=g.default(a)?"webgl2":"webgl";this.gl=a;a instanceof
WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");this._capabilities=l.loadCapabilities(a,d);a=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:a[0],y:a[1],width:a[2],height:a[3]};this._stateTracker=new f.StateTracker({setBlending:function(a){a?(c.setBlendingEnabled(!0),c.setBlendEquationSeparate(a.opRgb,a.opAlpha),c.setBlendFunctionSeparate(a.srcRgb,a.dstRgb,a.srcAlpha,a.dstAlpha),a=a.color,c.setBlendColor(a.r,a.g,a.b,a.a)):c.setBlendingEnabled(!1)},setCulling:function(a){a?
(c.setFaceCullingEnabled(!0),c.setCullFace(a.face),c.setFrontFace(a.mode)):c.setFaceCullingEnabled(!1)},setPolygonOffset:function(a){a?(c.setPolygonOffsetFillEnabled(!0),c.setPolygonOffset(a.factor,a.units)):c.setPolygonOffsetFillEnabled(!1)},setDepthTest:function(a){a?(c.setDepthTestEnabled(!0),c.setDepthFunction(a.func)):c.setDepthTestEnabled(!1)},setStencilTest:function(a){if(a){c.setStencilTestEnabled(!0);var d=a.function;c.setStencilFunction(d.func,d.ref,d.mask);a=a.operation;c.setStencilOp(a.fail,
a.zFail,a.zPass)}else c.setStencilTestEnabled(!1)},setDepthWrite:function(a){a?(c.setDepthWriteEnabled(!0),c.setDepthRange(a.zNear,a.zFar)):c.setDepthWriteEnabled(!1)},setColorWrite:function(a){a?c.setColorMask(a.r,a.g,a.b,a.a):c.setColorMask(!1,!1,!1,!1)},setStencilWrite:function(a){a?c.setStencilWriteMask(a.mask):c.setStencilWriteMask(0)}});this.enforceState()}Object.defineProperty(a.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"parameters",{get:function(){if(!this._parameters){var a=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:a?this.gl.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),
maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE)}}return this._parameters},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap={};this.gl=null};a.prototype.setPipelineState=function(a){this._stateTracker.setPipeline(a)};a.prototype.setBlendingEnabled=function(a){this._blendEnabled!==a&&(!0===a?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=a,this._stateTracker.invalidateBlending())};
a.prototype.setBlendColor=function(a,d,b,e){if(a!==this._blendColorState.r||d!==this._blendColorState.g||b!==this._blendColorState.b||e!==this._blendColorState.a)this.gl.blendColor(a,d,b,e),this._blendColorState.r=a,this._blendColorState.g=d,this._blendColorState.b=b,this._blendColorState.a=e,this._stateTracker.invalidateBlending()};a.prototype.setBlendFunction=function(a,d){if(a!==this._blendFunctionState.srcRGB||d!==this._blendFunctionState.dstRGB)this.gl.blendFunc(a,d),this._blendFunctionState.srcRGB=
a,this._blendFunctionState.srcAlpha=a,this._blendFunctionState.dstRGB=d,this._blendFunctionState.dstAlpha=d,this._stateTracker.invalidateBlending()};a.prototype.setBlendFunctionSeparate=function(a,d,b,e){if(this._blendFunctionState.srcRGB!==a||this._blendFunctionState.srcAlpha!==b||this._blendFunctionState.dstRGB!==d||this._blendFunctionState.dstAlpha!==e)this.gl.blendFuncSeparate(a,d,b,e),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=b,this._blendFunctionState.dstRGB=d,this._blendFunctionState.dstAlpha=
e,this._stateTracker.invalidateBlending()};a.prototype.setBlendEquation=function(a){this._blendEquationState.mode!==a&&(this.gl.blendEquation(a),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=a,this._stateTracker.invalidateBlending())};a.prototype.setBlendEquationSeparate=function(a,d){if(this._blendEquationState.mode!==a||this._blendEquationState.modeAlpha!==d)this.gl.blendEquationSeparate(a,d),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=d,this._stateTracker.invalidateBlending()};
a.prototype.setColorMask=function(a,d,b,e){if(this._colorMaskState.r!==a||this._colorMaskState.g!==d||this._colorMaskState.b!==b||this._colorMaskState.a!==e)this.gl.colorMask(a,d,b,e),this._colorMaskState.r=a,this._colorMaskState.g=d,this._colorMaskState.b=b,this._colorMaskState.a=e,this._stateTracker.invalidateColorWrite()};a.prototype.setClearColor=function(a,d,b,e){if(this._clearColor.r!==a||this._clearColor.g!==d||this._clearColor.b!==b||this._clearColor.a!==e)this.gl.clearColor(a,d,b,e),this._clearColor.r=
a,this._clearColor.g=d,this._clearColor.b=b,this._clearColor.a=e};a.prototype.setFaceCullingEnabled=function(a){this._polygonCullingEnabled!==a&&(!0===a?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=a,this._stateTracker.invalidateCulling())};a.prototype.setPolygonOffsetFillEnabled=function(a){this._polygonOffsetFillEnabled!==a&&(!0===a?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=
a,this._stateTracker.invalidatePolygonOffset())};a.prototype.setPolygonOffset=function(a,d){if(this._polygonOffset[0]!==a||this._polygonOffset[1]!==d)this._polygonOffset[0]=a,this._polygonOffset[1]=d,this.gl.polygonOffset(a,d),this._stateTracker.invalidatePolygonOffset()};a.prototype.setCullFace=function(a){this._cullFace!==a&&(this.gl.cullFace(a),this._cullFace=a,this._stateTracker.invalidateCulling())};a.prototype.setFrontFace=function(a){this._frontFace!==a&&(this.gl.frontFace(a),this._frontFace=
a,this._stateTracker.invalidateCulling())};a.prototype.setScissorTestEnabled=function(a){this._scissorTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=a)};a.prototype.setScissorRect=function(a,d,b,e){if(this._scissorRect.x!==a||this._scissorRect.y!==d||this._scissorRect.width!==b||this._scissorRect.height!==e)this.gl.scissor(a,d,b,e),this._scissorRect.x=a,this._scissorRect.y=d,this._scissorRect.width=b,this._scissorRect.height=
e};a.prototype.setDepthTestEnabled=function(a){this._depthTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=a,this._stateTracker.invalidateDepthTest())};a.prototype.setClearDepth=function(a){this._clearDepth!==a&&(this.gl.clearDepth(a),this._clearDepth=a)};a.prototype.setDepthFunction=function(a){this._depthFunction!==a&&(this.gl.depthFunc(a),this._depthFunction=a,this._stateTracker.invalidateDepthTest())};a.prototype.setDepthWriteEnabled=
function(a){this._depthWriteEnabled!==a&&(this.gl.depthMask(a),this._depthWriteEnabled=a,this._stateTracker.invalidateDepthWrite())};a.prototype.setDepthRange=function(a,d){if(this._depthRange.zNear!==a||this._depthRange.zFar!==d)this.gl.depthRange(a,d),this._depthRange.zNear=a,this._depthRange.zFar=d,this._stateTracker.invalidateDepthWrite()};a.prototype.setStencilTestEnabled=function(a){this._stencilTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),
this._stencilTestEnabled=a,this._stateTracker.invalidateStencilTest())};a.prototype.setClearStencil=function(a){a!==this._clearStencil&&(this.gl.clearStencil(a),this._clearStencil=a)};a.prototype.setStencilFunction=function(a,d,b){if(this._stencilFunction.func!==a||this._stencilFunction.ref!==d||this._stencilFunction.mask!==b)this.gl.stencilFunc(a,d,b),this._stencilFunction.face=1032,this._stencilFunction.func=a,this._stencilFunction.ref=d,this._stencilFunction.mask=b,this._stateTracker.invalidateStencilTest()};
a.prototype.setStencilFunctionSeparate=function(a,d,b,e){if(this._stencilFunction.face!==a||this._stencilFunction.func!==d||this._stencilFunction.ref!==b||this._stencilFunction.mask!==e)this.gl.stencilFuncSeparate(a,d,b,e),this._stencilFunction.face=a,this._stencilFunction.func=d,this._stencilFunction.ref=b,this._stencilFunction.mask=e,this._stateTracker.invalidateStencilTest()};a.prototype.setStencilWriteMask=function(a){this._stencilWriteMask!==a&&(this.gl.stencilMask(a),this._stencilWriteMask=
a,this._stateTracker.invalidateStencilWrite())};a.prototype.setStencilOp=function(a,d,b){if(this._stencilOperation.fail!==a||this._stencilOperation.zFail!==d||this._stencilOperation.zPass!==b)this.gl.stencilOp(a,d,b),this._stencilOperation.face=1032,this._stencilOperation.fail=a,this._stencilOperation.zFail=d,this._stencilOperation.zPass=b,this._stateTracker.invalidateStencilTest()};a.prototype.setStencilOpSeparate=function(a,d,b,e){if(this._stencilOperation.face!==a||this._stencilOperation.fail!==
d||this._stencilOperation.zFail!==b||this._stencilOperation.zPass!==e)this.gl.stencilOpSeparate(a,d,b,e),this._stencilOperation.face=a,this._stencilOperation.face=a,this._stencilOperation.fail=d,this._stencilOperation.zFail=b,this._stencilOperation.zPass=e,this._stateTracker.invalidateStencilTest()};a.prototype.setActiveTexture=function(a){var c=this._activeTextureUnit;0<=a&&a!==this._activeTextureUnit&&(this.gl.activeTexture(h.BASE_TEXTURE_UNIT+a),this._activeTextureUnit=a);return c};a.prototype.clear=
function(a){a&&this.gl.clear(a)};a.prototype.clearSafe=function(a,d){void 0===d&&(d=255);a&&(a&16384&&this.setColorMask(!0,!0,!0,!0),a&256&&this.setDepthWriteEnabled(!0),a&1024&&this.setStencilWriteMask(d),this.gl.clear(a))};a.prototype.drawArrays=function(a,d,b){this.gl.drawArrays(a,d,b)};a.prototype.drawElements=function(a,d,b,e){5123===b?this.gl.drawElements(a,d,b,e):5125===b&&this.gl.drawElements(a,d,b,e)};a.prototype.logIno=function(){};Object.defineProperty(a.prototype,"capabilities",{get:function(){return this._capabilities},
enumerable:!0,configurable:!0});a.prototype.setViewport=function(a,d,b,e){var c=this._viewport;if(c.x!==a||c.y!==d||c.width!==b||c.height!==e)c.x=a,c.y=d,c.width=b,c.height=e,this.gl.viewport(a,d,b,e)};a.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};a.prototype.bindProgram=function(a){a?this._activeShaderProgram!==a&&(a.initialize(),this.gl.useProgram(a.glName),this._activeShaderProgram=a):(this.gl.useProgram(null),
this._activeShaderProgram=null)};a.prototype.bindTexture=function(c,d){void 0===d&&(d=0);-1===a._MAX_TEXTURE_IMAGE_UNITS&&(a._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));(d>=a._MAX_TEXTURE_IMAGE_UNITS||0>d)&&console.error("Input texture unit is out of range of available units!");var b=this._textureUnitMap[d];this.setActiveTexture(d);null==c||null==c.glName?(null!=b&&(this.gl.bindTexture(b.descriptor.target,null),b.setBoundToUnit(d,!1)),this._textureUnitMap[d]=null):
b&&b.id===c.id?c.applyChanges():(b&&b.setBoundToUnit(d,!1),this.gl.bindTexture(c.descriptor.target,c.glName),c.setBoundToUnit(d,!0),c.applyChanges(),this._textureUnitMap[d]=c)};a.prototype.bindFramebuffer=function(a){m.isNone(a)?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null):this._activeFramebuffer!==a&&(a.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.glName),this._activeFramebuffer=a)};a.prototype.bindBuffer=function(c){c&&(34962===c.bufferType?this._activeVertexBuffer=
a._bindBuffer(this.gl,c,c.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=a._bindBuffer(this.gl,c,c.bufferType,this._activeIndexBuffer))};a.prototype.bindRenderbuffer=function(a){var c=this.gl;a||(c.bindRenderbuffer(c.RENDERBUFFER,null),this._activeRenderbuffer=null);this._activeRenderbuffer!==a&&(c.bindRenderbuffer(c.RENDERBUFFER,a.glName),this._activeRenderbuffer=a)};a.prototype.unbindBuffer=function(c){34962===c?this._activeVertexBuffer=a._bindBuffer(this.gl,null,c,this._activeVertexBuffer):
this._activeIndexBuffer=a._bindBuffer(this.gl,null,c,this._activeIndexBuffer)};a.prototype.bindVAO=function(a){a?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===a.id||(a.bind(),this._activeVertexArrayObject=a):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};a.prototype.getBoundTexture=function(a){return this._textureUnitMap[a]};a.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer};a.prototype.getBoundVAO=
function(){return this._activeVertexArrayObject};a.prototype.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);this.unbindBuffer(34963);for(var a=0;a<this.parameters.maxTextureImageUnits;a++)this.bindTexture(null,a);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);
this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,
this.gl.canvas.height)};a.prototype.enforceState=function(){var a=this.gl,d=this.capabilities.vao;d&&d.bindVertexArray(null);for(var b=0;b<this.parameters.maxVertexAttributes;b++)a.disableVertexAttribArray(b);this._activeVertexBuffer?a.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):a.bindBuffer(34962,null);this._activeIndexBuffer?a.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):a.bindBuffer(34963,null);if(d&&this._activeVertexArrayObject){if(d=
this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(d)}a.bindFramebuffer(a.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null);a.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null);a.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);a.bindRenderbuffer(a.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null);!0===
this._blendEnabled?a.enable(this.gl.BLEND):a.disable(this.gl.BLEND);a.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);a.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);a.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);a.clearDepth(this._clearDepth);a.clearStencil(this._clearStencil);a.colorMask(this._colorMaskState.r,
this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);a.cullFace(this._cullFace);a.depthFunc(this._depthFunction);a.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST);a.depthMask(this._depthWriteEnabled);a.frontFace(this._frontFace);a.lineWidth(1);!0===this._polygonCullingEnabled?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE);a.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?
a.enable(a.POLYGON_OFFSET_FILL):a.disable(a.POLYGON_OFFSET_FILL);a.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?a.enable(a.SCISSOR_TEST):a.disable(a.SCISSOR_TEST);a.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask);a.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);!0===this._stencilTestEnabled?
a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST);a.stencilMask(this._stencilWriteMask);for(d=0;d<this.parameters.maxTextureImageUnits;d++)a.activeTexture(h.BASE_TEXTURE_UNIT+d),a.bindTexture(3553,null),(b=this._textureUnitMap[d])&&a.bindTexture(b.descriptor.target,b.glName);a.activeTexture(h.BASE_TEXTURE_UNIT+this._activeTextureUnit);a.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)};a._bindBuffer=function(a,d,b,e){if(!d)return a.bindBuffer(b,null),null;if(e===
d)return e;a.bindBuffer(b,d.glName);return d};a._MAX_TEXTURE_IMAGE_UNITS=-1;return a}()})},"esri/views/webgl/enums":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.BASE_TEXTURE_UNIT=33984})},"esri/views/webgl/InstanceCounter":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(){this._current=[];this._max=[];for(this._allocations=new Map;6>this._current.length;)this._current.push(0),
this._max.push(0)}a.prototype.increment=function(a,b){b=++this._current[a];this._max[a]=Math.max(b,this._max[a])};a.prototype.decrement=function(a,b){--this._current[a]};Object.defineProperty(a.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0});a.prototype.printResourceCount=function(){console.log("Live objects:");console.log("Textures: "+this._current[0]);console.log("Buffers: "+this._current[1]);console.log("VAOs: "+this._current[2]);console.log("Programs: "+this._current[3]);
console.log("Framebuffers: "+this._current[4]);console.log("Renderbuffers: "+this._current[5]);0<this._allocations.size&&(console.log(this._allocations.size+" live object allocations:"),this._allocations.forEach(function(a){return console.log(a)}))};return a}();b.InstanceCounter=n})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.default=function(a){return window.WebGL2RenderingContext&&a instanceof
window.WebGL2RenderingContext}})},"esri/views/webgl/capabilities/load":function(){define("require exports ./DisjointTimerQuery ./Instancing ./isWebGL2Context ./LoseContext ./VertexArrayObjects".split(" "),function(n,b,a,m,h,e,f){function g(a,d,c,b,e){if(b&&h.default(a))return!0;if(d[c])return!1;for(d=0;d<e.length;d++)if(a.getExtension(e[d]))return!0;return!1}Object.defineProperty(b,"__esModule",{value:!0});b.loadCapabilities=function(b,d){var c=d&&d.disabledExtensions||{},k=d&&d.debugWebGLExtensions||
{},l,r,t,u,v,z,w,q,y,A=null,B=null,C=null,F=null;return{get instancing(){l||(l=m.load(b));return l},get vao(){r||(r=f.load(b,c));return r},get compressedTextureS3TC(){if(!t)if(c.compressedTextureS3TC)t=null;else{var a=b.getExtension("WEBGL_compressed_texture_s3tc");t=a?{COMPRESSED_RGB_S3TC_DXT1:a.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:a.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:a.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:a.COMPRESSED_RGBA_S3TC_DXT5_EXT}:
null}return t},get textureFilterAnisotropic(){if(!u)if(c.textureFilterAnisotropic)u=null;else{var a=b.getExtension("EXT_texture_filter_anisotropic")||b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic");u=a?{MAX_TEXTURE_MAX_ANISOTROPY:a.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:a.TEXTURE_MAX_ANISOTROPY_EXT}:null}return u},get disjointTimerQuery(){v||(v=a.load(b,c));return v},get textureFloat(){if(!z)if(h.default(b))z={textureFloat:!0,
textureFloatLinear:!c.textureFloatLinear&&!!b.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!c.textureHalfFloatLinear&&!!b.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:b.HALF_FLOAT};else if(b instanceof WebGLRenderingContext){var a=!c.textureHalfFloat&&b.getExtension("OES_texture_half_float");z={textureFloat:!c.textureFloat&&!!b.getExtension("OES_texture_float"),textureFloatLinear:!c.textureFloatLinear&&!!b.getExtension("OES_texture_float_linear"),
textureHalfFloat:!!a,textureHalfFloatLinear:!c.textureHalfFloatLinear&&!!b.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:a?a.HALF_FLOAT_OES:void 0}}else z=null;return z},get colorBufferFloat(){if(!w)if(h.default(b)){var a=!c.colorBufferFloat&&b.getExtension("EXT_color_buffer_half_float"),d=!c.colorBufferFloat&&b.getExtension("EXT_color_buffer_float");w=a||d?{textureFloat:!!d,textureHalfFloat:!!a,R16F:b.R16F,RG16F:b.RG16F,RGBA16F:b.RGBA16F,R32F:b.R32F,RG32F:b.RG32F,RGBA32F:b.RGBA32F,R11F_G11F_B10F:b.R11F_G11F_B10F,
RGB16F:b.RGB16F}:null}else b instanceof WebGLRenderingContext?(a=!c.colorBufferFloat&&b.getExtension("EXT_color_buffer_half_float"),d=!c.colorBufferFloat&&b.getExtension("WEBGL_color_buffer_float"),w=a||d?{textureFloat:!!d,textureHalfFloat:!!a,RGBA16F:a?a.RGBA16F_EXT:void 0,RGB16F:a?a.RGB16F_EXT:void 0,RGBA32F:d?d.RGBA32F_EXT:void 0}:null):w=null;return w},get blendMinMax(){if(!q)if(h.default(b))q={MIN:b.MIN,MAX:b.MAX};else if(c.blendMinMax)q=null;else{var a=b.getExtension("EXT_blend_minmax");q=a?
{MIN:a.MIN_EXT,MAX:a.MAX_EXT}:null}return q},get depthTexture(){null===A&&(A=g(b,c,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return A},get standardDerivatives(){null===B&&(B=g(b,c,"standardDerivatives",!0,["OES_standard_derivatives"]));return B},get shaderTextureLOD(){null===C&&(C=g(b,c,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]));return C},get fragDepth(){null===F&&(F=g(b,c,"fragDepth",!0,["EXT_frag_depth"]));return F},get loseContext(){y||
(y=e.load(b,k));return y}}}})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["require","exports","./isWebGL2Context"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.load=function(b,h){if(h.disjointTimerQuery)return null;var e=b.getExtension("EXT_disjoint_timer_query")||b.getExtension("EXT_disjoint_timer_query_webgl2");return e?a.default(b)?{createQuery:function(){return b.createQuery()},resultAvailable:function(a){return b.getQueryParameter(a,b.QUERY_RESULT_AVAILABLE)},
getResult:function(a){return b.getQueryParameter(a,b.QUERY_RESULT)},disjoint:function(){return b.getParameter(e.GPU_DISJOINT_EXT)},beginTimeElapsed:function(a){return b.beginQuery(e.TIME_ELAPSED_EXT,a)},endTimeElapsed:function(){return b.endQuery(e.TIME_ELAPSED_EXT)},createTimestamp:function(a){return e.queryCounterEXT(a,e.TIMESTAMP_EXT)},timestampBits:function(){return b.getQuery(e.TIMESTAMP_EXT,e.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return e.createQueryEXT()},resultAvailable:function(a){return e.getQueryObjectEXT(a,
e.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(a){return e.getQueryObjectEXT(a,e.QUERY_RESULT_EXT)},disjoint:function(){return b.getParameter(e.GPU_DISJOINT_EXT)},beginTimeElapsed:function(a){return e.beginQueryEXT(e.TIME_ELAPSED_EXT,a)},endTimeElapsed:function(){return e.endQueryEXT(e.TIME_ELAPSED_EXT)},createTimestamp:function(a){return e.queryCounterEXT(a,e.TIMESTAMP_EXT)},timestampBits:function(){return e.getQueryEXT(e.TIMESTAMP_EXT,e.QUERY_COUNTER_BITS_EXT)}}:null}})},"esri/views/webgl/capabilities/Instancing":function(){define(["require",
"exports","./isWebGL2Context"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.load=function(b){return a.default(b)?{drawArraysInstanced:b.drawArraysInstanced.bind(b),drawElementsInstanced:b.drawElementsInstanced.bind(b),vertexAttribDivisor:b.vertexAttribDivisor.bind(b)}:(b=b.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:b.drawArraysInstancedANGLE.bind(b),drawElementsInstanced:b.drawElementsInstancedANGLE.bind(b),vertexAttribDivisor:b.vertexAttribDivisorANGLE.bind(b)}:
null}})},"esri/views/webgl/capabilities/LoseContext":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.load=function(a,b){var h=b.loseContext&&a.getExtension("WEBGL_lose_context");return h?{loseRenderingContext:function(){return h.loseContext()}}:null}})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["require","exports","./isWebGL2Context"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.load=function(b,
h){return a.default(b)?{createVertexArray:b.createVertexArray.bind(b),deleteVertexArray:b.deleteVertexArray.bind(b),bindVertexArray:b.bindVertexArray.bind(b)}:h.vao?null:(b=b.getExtension("OES_vertex_array_object")||b.getExtension("MOZ_OES_vertex_array_object")||b.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:b.createVertexArrayOES.bind(b),deleteVertexArray:b.deleteVertexArrayOES.bind(b),bindVertexArray:b.bindVertexArrayOES.bind(b)}:null}})},"esri/views/webgl/ShaderCompiler":function(){define(["require",
"exports"],function(n,b){return function(){function a(a){this.readFile=a}a.prototype.resolveIncludes=function(a){return this.resolve(a)};a.prototype.resolve=function(a,b){var e=this;void 0===b&&(b=new Map);if(b.has(a))return b.get(a);var f=this.read(a);if(!f)throw Error("cannot find shader file "+a);for(var g=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm,h=g.exec(f),d=[];null!=h;)d.push({path:h[1],start:h.index,length:h[0].length}),h=g.exec(f);var c=0,k="";d.forEach(function(a){k+=f.slice(c,a.start);k+=
b.has(a.path)?"":e.resolve(a.path,b);c=a.start+a.length});k+=f.slice(c);b.set(a,k);return k};a.prototype.read=function(a){return this.readFile(a)};return a}()})},"esri/views/webgl/ProgramCache":function(){define(["require","exports","./programUtils"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this._programCacheByTemplate=new Map;this._rctx=a}b.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(a){a.programs.forEach(function(a){a.dispose()})});
this._programCacheByTemplate=null};b.prototype.getProgram=function(b,e){var f=this;this._programCacheByTemplate.has(b)||this.addProgramTemplate(b,function(e){return a.createProgram(f._rctx,b,e)});return this.getProgramTemplateInstance(b,e)};b.prototype.addProgramTemplate=function(a,b){this._programCacheByTemplate.set(a,{constructor:b,programs:new Map})};b.prototype.getProgramTemplateInstance=function(a,b){if(a=this._programCacheByTemplate.get(a)){var e=b?JSON.stringify(b):"default";a.programs.has(e)||
(b=a.constructor(b),a.programs.set(e,b));return a.programs.get(e)}return null};return b}();b.ProgramCache=n})},"esri/views/webgl/programUtils":function(){define(["require","exports","./Program"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.glslifyDefineMap=function(a){var b="",e;for(e in a){var f=a[e];if("boolean"===typeof f)f&&(b+="#define "+e+"\n");else if("number"===typeof f)b+="#define "+e+" "+f.toFixed()+"\n";else if("object"===typeof f){var g=f.options,l=0,d;for(d in g)b+=
"#define "+g[d]+" "+(l++).toFixed()+"\n";b+="#define "+e+" "+g[f.value]+"\n"}}return b};b.createProgram=function(b,h,e,f){e=e||{};f=f||"";e="function"===typeof h.shaders?h.shaders(e):h.shaders;return new a(b,f+e.vertexShader,f+e.fragmentShader,h.attributes)}})},"esri/views/3d/layers/support/edgeUtils":function(){define("require exports tslib ../../../../Color ../../../../core/compilerUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec4f64".split(" "),function(n,
b,a,m,h,e,f,g){function l(c,b){if(e.isNone(c))return null;var l=e.isSome(c.color)?g.vec4f64.fromArray(m.toUnitRGBA(c.color)):g.vec4f64.fromValues(0,0,0,0),p=f.pt2px(c.size),r=f.pt2px(c.extensionLength);switch(c.type){case "solid":return d(a.__assign({color:l,size:p,extensionLength:r},b));case "sketch":return c=a.__assign({color:l,size:p,extensionLength:r},b),a.__assign(a.__assign(a.__assign({},k),c),{type:"sketch"});default:h.neverReached(c)}}function d(d){return a.__assign(a.__assign(a.__assign({},
c),d),{type:"solid"})}Object.defineProperty(b,"__esModule",{value:!0});b.createMaterial=function(a,c){return l(a&&a.enabled&&a.edges||null,c)};b.createMaterialFromEdges=l;b.createSolidEdgeMaterial=d;var c={color:g.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2},k={color:g.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2}})},"esri/views/3d/support/buffer/math/vec3":function(){define(["require","exports","./common"],function(n,
b,a){Object.defineProperty(b,"__esModule",{value:!0});b.transformMat4=function(b,h,e){if(b.count!==h.count)a.logger.error("source and destination buffers need to have the same number of elements");else{var f=b.count,g=e[0],l=e[1],d=e[2],c=e[4],k=e[5],p=e[6],m=e[8],t=e[9],u=e[10],v=e[12],z=e[13];e=e[14];var w=b.typedBuffer;b=b.typedBufferStride;var q=h.typedBuffer;h=h.typedBufferStride;for(var y=0;y<f;y++){var A=y*b,B=y*h,C=q[B],F=q[B+1],B=q[B+2];w[A]=g*C+c*F+m*B+v;w[A+1]=l*C+k*F+t*B+z;w[A+2]=d*C+
p*F+u*B+e}}};b.transformMat3=function(b,h,e){if(b.count!==h.count)a.logger.error("source and destination buffers need to have the same number of elements");else{var f=b.count,g=e[0],l=e[1],d=e[2],c=e[3],k=e[4],p=e[5],m=e[6],t=e[7];e=e[8];var u=b.typedBuffer;b=b.typedBufferStride;var v=h.typedBuffer;h=h.typedBufferStride;for(var z=0;z<f;z++){var w=z*b,q=z*h,y=v[q],A=v[q+1],q=v[q+2];u[w]=g*y+c*A+m*q;u[w+1]=l*y+k*A+t*q;u[w+2]=d*y+p*A+e*q}}};b.scale=function(a,b,e){var f=Math.min(a.count,b.count),g=a.typedBuffer;
a=a.typedBufferStride;var h=b.typedBuffer;b=b.typedBufferStride;for(var d=0;d<f;d++){var c=d*a,k=d*b;g[c]=e*h[k];g[c+1]=e*h[k+1];g[c+2]=e*h[k+2]}};b.shiftRight=function(a,b,e){var f=Math.min(a.count,b.count),g=a.typedBuffer;a=a.typedBufferStride;var h=b.typedBuffer;b=b.typedBufferStride;for(var d=0;d<f;d++){var c=d*a,k=d*b;g[c]=h[k]>>e;g[c+1]=h[k+1]>>e;g[c+2]=h[k+2]>>e}}})},"esri/views/3d/support/buffer/math/common":function(){define(["require","exports","../../../../../core/Logger"],function(n,b,
a){Object.defineProperty(b,"__esModule",{value:!0});b.logger=a.getLogger("esri.views.3d.support.buffer.math")})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("require exports tslib ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/util/AlphaDiscard.glsl ../lib/GLMaterialTexture ../lib/intersectorUtils ../lib/Material ../lib/StencilUtils ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/DefaultMaterialTechnique ../shaders/RealisticTreeTechnique ../../../webgl/renderState ../../../webgl/renderState".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q){var y=p.assert;n=function(c){function b(a,d){d=c.call(this,d)||this;d.supportsEdges=!0;d.techniqueConfig=new v.DefaultMaterialTechniqueConfiguration;d.params=t.copyParameters(a,B);d.vertexBufferLayout=b.getVertexBufferLayout(d.params);d.instanceBufferLayout=a.instanced?b.getInstanceBufferLayout(d.params):null;return d}a.__extends(b,c);b.prototype.isVisibleInPass=function(a){return 3===a?this.params.castShadows:!0};b.prototype.isVisible=function(){var a=
this.params;if(!c.prototype.isVisible.call(this)||0===a.layerOpacity)return!1;var d=a.instanced,b=a.vertexColors,e=a.symbolColors,d=!!d&&-1<d.indexOf("color"),f=a.vvColorEnabled,g="replace"===a.colorMixMode,k=0<a.opacity,a=a.externalColor&&0<a.externalColor[3];return b&&(d||f||e)?g?!0:k:b?g?a:k:d||f||e?g?!0:k:g?a:k};b.prototype.setParameterValues=function(a){var c=this.params,d;for(d in a)"instanced"===d&&y(a.instanced===c.instanced,"Can not change instanced attributes"),"textureId"===d&&y(c.textureId,
"Can only change texture of material that already has a texture"),"vertexColors"===d&&!0===a[d]&&a[d]!==c[d]&&y(c.vertexColors,"Can not enable vertex colors after DefaultMaterial creation"),c[d]=a[d];this.parametersChanged()};b.prototype.getParameters=function(){return this.params};b.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.hasNormalTexture=!!this.params.normalTextureId;this.techniqueConfig.hasColorTexture=!!this.params.textureId;this.techniqueConfig.vertexTangents=
this.params.vertexTangents;this.techniqueConfig.instanced=!!this.params.instanced;this.techniqueConfig.instancedDoublePrecision=this.params.instancedDoublePrecision;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.verticalOffset=null!==this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=null!==this.params.screenSizePerspective;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.sliceHighlightDisabled=this.params.sliceHighlightDisabled;
this.techniqueConfig.alphaDiscardMode=this.params.textureAlphaMode;this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.params.normals?!0:!1;0===a&&(this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.symbolColors=this.params.symbolColors,this.params.treeRendering||(this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0),this.techniqueConfig.instancedColor=
!!this.params.instanced&&-1<this.params.instanced.indexOf("color"),this.techniqueConfig.receiveShadows=this.params.receiveShadows&&this.params.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=this.params.receiveSSAO,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.params.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.params.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.params.metallicRoughnessTextureId,
this.techniqueConfig.hasEmissionTexture=!!this.params.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.params.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.params.transparent||!this.params.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.params.usePBR&&this.params.isSchematic);return this.techniqueConfig};b.prototype.intersect=function(a,c,b,e,f,g,k){if(null!==this.params.verticalOffset){var l=e.camera;h.vec3.set(L,b[12],b[13],b[14]);b=null;switch(e.viewingMode){case "global":b=
h.vec3.normalize(J,L);break;case "local":b=h.vec3.copy(J,G)}var p=0;if(null!==this.params.verticalOffset){var m=h.vec3.subtract(M,L,l.eye),q=h.vec3.length(m),m=h.vec3.scale(m,m,1/q),r=null;this.params.screenSizePerspective&&(r=h.vec3.dot(b,m));p+=t.verticalOffsetAtDistance(l,q,this.params.verticalOffset,r,this.params.screenSizePerspective)}h.vec3.scale(b,b,p);h.vec3.transformMat3(E,b,e.transform.inverseRotation);f=h.vec3.subtract(H,f,E);g=h.vec3.subtract(I,g,E)}t.intersectTriangleGeometry(a,c,e,f,
g,d.getVerticalOffsetObject3D(e.verticalOffset),k)};b.prototype.getGLMaterial=function(a){if(0===a.output||1===a.output||2===a.output||3===a.output||4===a.output)return new A(a)};b.prototype.createRenderer=function(a,c){return new u(a,c,this)};b.prototype.createBufferWriter=function(){return new C(this.vertexBufferLayout,this.instanceBufferLayout)};b.getVertexBufferLayout=function(a){var c=a.textureId||a.normalTextureId||a.metallicRoughnessTextureId||a.emissiveTextureId||a.occlusionTextureId,d=f.newLayout().vec3f("position").vec3f("normal");
a.vertexTangents&&d.vec4f("tangent");c&&d.vec2f("uv0");a.vertexColors&&d.vec4u8("color");a.symbolColors&&d.vec4u8("symbolColor");return d};b.getInstanceBufferLayout=function(a){var c=f.newLayout(),c=a.instancedDoublePrecision?c.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):c.mat4f("model").mat4f("modelNormal");a.instanced&&-1<a.instanced.indexOf("color")&&(c=c.vec4f("instanceColor"));a.instanced&&-1<a.instanced.indexOf("featureAttribute")&&(c=c.vec4f("instanceFeatureAttribute"));
return c};return b}(c.Material);var A=function(c){function d(d){var b=this,b=d.material,b=c.call(this,a.__assign(a.__assign({},d),b.getParameters()))||this;b.updateParameters();return b}a.__extends(d,c);d.prototype.updateParameters=function(){this.selectPipelines();this.selectSlot();var a=this.material.getParameters();this.updateTexture(a.textureId);this.technique=a.treeRendering?this.techniqueRep.acquireAndReleaseExisting(z.RealisticTreeTechnique,this.material.getTechniqueConfig(this.output),this.technique):
this.techniqueRep.acquireAndReleaseExisting(v.DefaultMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)};d.prototype.selectSlot=function(){this.slot=this.material.getParameters().transparent?this.material.getParameters().writeDepth?5:8:3};d.prototype.selectPipelines=function(){var a=this.material.getParameters(),c=0===this.output?a.transparent&&w.separateBlendingParams(770,1,771,771):null,d=function(d){return q.makePipelineState({blending:c,culling:F(a),depthTest:{func:513},
depthWrite:a.writeDepth&&q.defaultDepthWriteParams,colorWrite:q.defaultColorWriteParams,stencilWrite:a.sceneHasOcludees?k.stencilWriteMaskOn:null,stencilTest:a.sceneHasOcludees?d?k.stencilToolMaskBaseParams:k.stencilBaseAllZerosParams:null})};this.pipelineState=d(!1);this.occludeePipelineState=d(!0)};d.prototype._updateShadowState=function(a){a.shadowMappingEnabled!==this.material.getParameters().shadowMappingEnabled&&(this.material.setParameterValues({shadowMappingEnabled:a.shadowMappingEnabled}),
this.updateParameters())};d.prototype._updateOccludeeState=function(a){a.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:a.hasOccludees}),this.updateParameters())};d.prototype.ensureParameters=function(a){0===this.output&&(this._updateShadowState(a),this._updateOccludeeState(a))};d.prototype.bind=function(a,c){a.bindProgram(this.technique.program);this.technique.bindPass(a,this.material.getParameters(),c);this.bindTexture(a,this.technique.program)};
d.prototype.beginSlot=function(a){return a===this.slot};d.prototype.getPipelineState=function(a,c){return c?this.occludeePipelineState:this.pipelineState};return d}(l);(n||(n={})).COLOR_GAMMA=2.1;var B={textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],
colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,
1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:m.mat3f64.create(),transparent:!1,writeDepth:!0,textureAlphaMode:0,textureAlphaCutoff:g.defaultMaskAlphaCutoff,textureAlphaPremultiplied:!1,sceneHasOcludees:!1},C=function(){function a(a,c){this.vertexBufferLayout=a;this.instanceBufferLayout=c}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};
a.prototype.elementCount=function(a){return a.indices.position.length};a.prototype.write=function(a,c,d,b){r.writeDefaultAttributes(c,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,d,b)};return a}(),F=function(a){var c;c=a.cullFace?0!==a.cullFace:a.slicePlaneEnabled?!1:!a.transparent&&!a.doubleSided;return c&&{face:1===a.cullFace?1028:1029,mode:2305}},H=e.vec3f64.create(),I=e.vec3f64.create(),G=e.vec3f64.fromValues(0,0,1),J=e.vec3f64.create(),E=e.vec3f64.create(),L=e.vec3f64.create(),
M=e.vec3f64.create();return n})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports tslib ../../../../core/libs/gl-matrix-2/vec3f64 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/Camera.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../materials/internal/MaterialUtil ./DefaultMaterial.glsl ../../../webgl/Program @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y){Object.defineProperty(b,"__esModule",{value:!0});u=function(b){function u(){return null!==b&&b.apply(this,arguments)||this}a.__extends(u,b);u.prototype.initializeProgram=function(a){var c=u.shader.get(),d=this.configuration,c=c.build({output:d.output,viewingMode:a.viewingMode,receiveShadows:d.receiveShadows,slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:d.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:d.symbolColors,
vvSize:d.vvSize,vvColor:d.vvColor,vvInstancingEnabled:!0,instanced:d.instanced,instancedColor:d.instancedColor,instancedDoublePrecision:d.instancedDoublePrecision,useOldSceneLightInterface:!1,pbrMode:d.usePBR?d.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:d.hasMetalnessAndRoughnessTexture,hasEmissionTexture:d.hasEmissionTexture,hasOcclusionTexture:d.hasOcclusionTexture,hasNormalTexture:d.hasNormalTexture,hasColorTexture:d.hasColorTexture,receiveAmbientOcclusion:d.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,
normalType:d.normalsTypeDerivate?3:0,doubleSidedMode:d.doubleSidedMode,vertexTangets:d.vertexTangents,attributeTextureCoordinates:d.hasMetalnessAndRoughnessTexture||d.hasEmissionTexture||d.hasOcclusionTexture||d.hasNormalTexture||d.hasColorTexture?1:0,textureAlphaPremultiplied:d.textureAlphaPremultiplied,attributeColor:d.vertexColors,screenSizePerspectiveEnabled:d.screenSizePerspective,verticalOffsetEnabled:d.verticalOffset,offsetBackfaces:d.offsetBackfaces,doublePrecisionRequiresObfuscation:r.doublePrecisionRequiresObfuscation(a.rctx),
alphaDiscardMode:d.alphaDiscardMode,supportsTextureAtlas:!1});return new y(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),z.Default3D)};u.prototype.bindPass=function(a,c,b){var e=this.configuration.output;0===e?(this.program.setUniform3fv("ambient",c.ambient),this.program.setUniform3fv("diffuse",c.diffuse),this.program.setUniform4fv("externalColor",c.externalColor),this.program.setUniform1i("colorMixMode",w.colorMixModes[c.colorMixMode]),this.program.setUniform1f("opacity",c.opacity),
this.program.setUniform1f("layerOpacity",c.layerOpacity),this.configuration.usePBR&&d.PhysicallyBasedRenderingParameters.bindUniforms(this.program,c,this.configuration.isSchematic)):1===e||3===e?this.program.setUniform2fv("nearFar",b.nearFar):4===e&&l.OutputHighlight.bindOutputHighlight(a,this.program,b);k.VisualVariables.bindUniformsForSymbols(this.program,c);g.VerticalOffset.bindUniforms(this.program,c,b);w.bindScreenSizePerspective(c.screenSizePerspective,this.program,"screenSizePerspectiveAlignment");
2!==c.textureAlphaMode&&3!==c.textureAlphaMode||this.program.setUniform1f("textureAlphaCutoff",c.textureAlphaCutoff)};u.prototype.bindDraw=function(a){var d=this.configuration.instancedDoublePrecision?m.vec3f64.fromValues(a.viewInvTransp[3],a.viewInvTransp[7],a.viewInvTransp[11]):a.origin;e.Transform.bindUniformsCustomOrigin(this.program,d,a.view);(0===this.configuration.output||1===this.configuration.output&&this.configuration.screenSizePerspective||2===this.configuration.output&&this.configuration.screenSizePerspective||
4===this.configuration.output&&this.configuration.screenSizePerspective)&&p.Camera.bindUniformsCustomOrigin(this.program,d,a.viewInvTransp);2===this.configuration.output&&this.program.setUniformMatrix4fv("viewNormal",a.viewInvTransp);this.configuration.instancedDoublePrecision&&f.InstancedDoublePrecision.bindCustomOrigin(this.program,d);h.Slice.bindUniforms(this.program,this.configuration,a.slicePlane,d);0===this.configuration.output&&c.ReadShadowMap.bindViewCustomOrigin(this.program,a,d)};u.prototype.initializePipeline=
function(){return null};u.shader=new t.ReloadableShaderModule(q,function(){return new Promise(function(a,c){n(["./DefaultMaterial.glsl"],a,c)})});return u}(u.ShaderTechnique);b.DefaultMaterialTechnique=u;u=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;a.output=0;a.alphaDiscardMode=1;a.doubleSidedMode=0;a.isSchematic=!1;a.vertexColors=!1;a.offsetBackfaces=!1;a.symbolColors=!1;a.vvSize=!1;a.vvColor=!1;a.verticalOffset=!1;a.receiveShadows=!1;a.slicePlaneEnabled=!1;a.sliceHighlightDisabled=
!1;a.receiveAmbientOcclusion=!1;a.screenSizePerspective=!1;a.textureAlphaPremultiplied=!1;a.hasColorTexture=!1;a.usePBR=!1;a.hasMetalnessAndRoughnessTexture=!1;a.hasEmissionTexture=!1;a.hasOcclusionTexture=!1;a.hasNormalTexture=!1;a.instanced=!1;a.instancedColor=!1;a.instancedDoublePrecision=!1;a.vertexTangents=!1;a.normalsTypeDerivate=!1;return a}a.__extends(d,c);a.__decorate([v.parameter({count:7})],d.prototype,"output",void 0);a.__decorate([v.parameter({count:4})],d.prototype,"alphaDiscardMode",
void 0);a.__decorate([v.parameter({count:3})],d.prototype,"doubleSidedMode",void 0);a.__decorate([v.parameter()],d.prototype,"isSchematic",void 0);a.__decorate([v.parameter()],d.prototype,"vertexColors",void 0);a.__decorate([v.parameter()],d.prototype,"offsetBackfaces",void 0);a.__decorate([v.parameter()],d.prototype,"symbolColors",void 0);a.__decorate([v.parameter()],d.prototype,"vvSize",void 0);a.__decorate([v.parameter()],d.prototype,"vvColor",void 0);a.__decorate([v.parameter()],d.prototype,"verticalOffset",
void 0);a.__decorate([v.parameter()],d.prototype,"receiveShadows",void 0);a.__decorate([v.parameter()],d.prototype,"slicePlaneEnabled",void 0);a.__decorate([v.parameter()],d.prototype,"sliceHighlightDisabled",void 0);a.__decorate([v.parameter()],d.prototype,"receiveAmbientOcclusion",void 0);a.__decorate([v.parameter()],d.prototype,"screenSizePerspective",void 0);a.__decorate([v.parameter()],d.prototype,"textureAlphaPremultiplied",void 0);a.__decorate([v.parameter()],d.prototype,"hasColorTexture",
void 0);a.__decorate([v.parameter()],d.prototype,"usePBR",void 0);a.__decorate([v.parameter()],d.prototype,"hasMetalnessAndRoughnessTexture",void 0);a.__decorate([v.parameter()],d.prototype,"hasEmissionTexture",void 0);a.__decorate([v.parameter()],d.prototype,"hasOcclusionTexture",void 0);a.__decorate([v.parameter()],d.prototype,"hasNormalTexture",void 0);a.__decorate([v.parameter()],d.prototype,"instanced",void 0);a.__decorate([v.parameter()],d.prototype,"instancedColor",void 0);a.__decorate([v.parameter()],
d.prototype,"instancedDoublePrecision",void 0);a.__decorate([v.parameter()],d.prototype,"vertexTangents",void 0);a.__decorate([v.parameter()],d.prototype,"normalsTypeDerivate",void 0);return d}(v.ShaderTechniqueConfiguration);b.DefaultMaterialTechniqueConfiguration=u})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define("require exports tslib ../../../../../../core/libs/gl-matrix-2/vec3f64 ../util/DoublePrecision.glsl ../../shaderModules/interfaces ../../../lib/doublePrecisionUtils".split(" "),
function(n,b,a,m,h,e,f){function g(d,b){b.instanced&&b.instancedDoublePrecision&&(d.attributes.add("modelOriginHi","vec3"),d.attributes.add("modelOriginLo","vec3"),d.attributes.add("model","mat3"),d.attributes.add("modelNormal","mat3"));b.instancedDoublePrecision&&(d.include(h.DoublePrecision,b),d.vertex.uniforms.add("viewOriginHi","vec3"),d.vertex.uniforms.add("viewOriginLo","vec3"));var f=[e.glsl(c||(c=a.__makeTemplateObject(["\n    vec3 calculateVPos() {\n      ","\n    }\n    "],["\n    vec3 calculateVPos() {\n      ",
"\n    }\n    "])),b.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"),e.glsl(p||(p=a.__makeTemplateObject(["\n    vec3 subtractOrigin(vec3 _pos) {\n      ","\n    }\n    "],["\n    vec3 subtractOrigin(vec3 _pos) {\n      ","\n    }\n    "])),b.instancedDoublePrecision?e.glsl(k||(k=a.__makeTemplateObject(["\n          vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n          return _pos - originDelta;"],["\n          vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n          return _pos - originDelta;"]))):
"return vpos;"),e.glsl(r||(r=a.__makeTemplateObject(["\n    vec3 dpNormal(vec4 _normal) {\n      ","\n    }\n    "],["\n    vec3 dpNormal(vec4 _normal) {\n      ","\n    }\n    "])),b.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"),e.glsl(t||(t=a.__makeTemplateObject(["\n    vec3 dpNormalView(vec4 _normal) {\n      ","\n    }\n    "],["\n    vec3 dpNormalView(vec4 _normal) {\n      ","\n    }\n    "])),b.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":
"return normalize((viewNormal * _normal).xyz);"),b.vertexTangets?e.glsl(u||(u=a.__makeTemplateObject(["\n    vec4 dpTransformVertexTangent(vec4 _tangent) {\n      ","\n      \n    }\n    "],["\n    vec4 dpTransformVertexTangent(vec4 _tangent) {\n      ","\n      \n    }\n    "])),b.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"):e.glsl(v||(v=a.__makeTemplateObject([""],[""])))];d.vertex.code.add(f[0]);d.vertex.code.add(f[1]);d.vertex.code.add(f[2]);
2===b.output&&d.vertex.code.add(f[3]);d.vertex.code.add(f[4])}Object.defineProperty(b,"__esModule",{value:!0});b.InstancedDoublePrecision=g;(function(a){var c=function(){return function(){}}();a.Uniforms=c;a.bindCustomOrigin=function(a,c){f.encodeDoubleArraySplit(c,l,d,3);a.setUniform3fv("viewOriginHi",l);a.setUniform3fv("viewOriginLo",d)}})(g=b.InstancedDoublePrecision||(b.InstancedDoublePrecision={}));var l=m.vec3f64.create(),d=m.vec3f64.create(),c,k,p,r,t,u,v})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define("require exports tslib ../../../../../../core/has ../../shaderModules/interfaces ../../../lib/WebGLDriverTest".split(" "),
function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});b.DoublePrecision=function(b,d){d.doublePrecisionRequiresObfuscation?b.vertex.code.add(h.glsl(f||(f=a.__makeTemplateObject(["\n      vec3 dpPlusFrc(vec3 a, vec3 b) {\n        return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n      }\n\n      vec3 dpMinusFrc(vec3 a, vec3 b) {\n        return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n      }\n\n      // based on https://www.thasler.com/blog/blog/glsl-part2-emu\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 \x3d dpPlusFrc(hiA, hiB);\n        vec3 e \x3d dpMinusFrc(t1, hiA);\n        vec3 t2 \x3d dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n        return t1 + t2;\n      }\n    "],
["\n      vec3 dpPlusFrc(vec3 a, vec3 b) {\n        return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n      }\n\n      vec3 dpMinusFrc(vec3 a, vec3 b) {\n        return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n      }\n\n      // based on https://www.thasler.com/blog/blog/glsl-part2-emu\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 \x3d dpPlusFrc(hiA, hiB);\n        vec3 e \x3d dpMinusFrc(t1, hiA);\n        vec3 t2 \x3d dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n        return t1 + t2;\n      }\n    "])))):
b.vertex.code.add(h.glsl(g||(g=a.__makeTemplateObject(["\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 \x3d hiA + hiB;\n        vec3 e \x3d t1 - hiA;\n        vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n        return t1 + t2;\n      }\n    "],["\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 \x3d hiA + hiB;\n        vec3 e \x3d t1 - hiA;\n        vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n        return t1 + t2;\n      }\n    "]))))};
b.doublePrecisionRequiresObfuscation=function(a){return m("force-double-precision-obfuscation")?!0:e.testWebGLDriver(a).doublePrecisionRequiresObfuscation};var f,g})},"esri/views/3d/webgl-engine/lib/WebGLDriverTest":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3f64 ../../../webgl ./doublePrecisionUtils ./Util".split(" "),function(n,b,a,m,h,e,f){function g(a,d){var c=new h.FramebufferObject(a,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,
pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),b=h.BufferObject.createVertex(a,35044,new Uint16Array([0,0,1,0,0,1,1,1])),g=new h.VertexArrayObject(a,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:b}),k=m.vec3f64.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),l=m.vec3f64.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387);d=new h.Program(a,"\n\n  precision highp float;\n\n  attribute vec2 a_pos;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  "+
(d?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":"")+"\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 \x3d dpPlusFrc(hiA, hiB);\n    vec3 e \x3d dpMinusFrc(t1, hiA);\n    vec3 t2 \x3d dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 \x3d hiA + hiB;\n    vec3 e \x3d t1 - hiA;\n    vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT \x3d\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS \x3d vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat \x3d 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val \x3d dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color \x3d float2rgba(val.z / 25.0);\n\n    gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ",
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",{a_pos:0});var z=new Float32Array(6);e.encodeDoubleArray(k,z,3);var w=new Float32Array(6);e.encodeDoubleArray(l,w,3);a.bindProgram(d);d.setUniform3f("u_highA",z[0],z[2],z[4]);d.setUniform3f("u_lowA",z[1],z[3],z[5]);d.setUniform3f("u_highB",w[0],w[2],w[4]);d.setUniform3f("u_lowB",w[1],w[3],w[5]);var z=a.getBoundFramebufferObject(),q=a.getViewport(),w=q.x,y=q.y,A=q.width,B=q.height;a.bindFramebuffer(c);
a.setViewport(0,0,1,1);a.bindVAO(g);a.drawArrays(5,0,4);q=new Uint8Array(4);c.readPixels(0,0,1,1,6408,5121,q);d.dispose();g.dispose(!1);b.dispose();c.dispose();a.setViewport(w,y,A,B);a.bindFramebuffer(z);a=(k[2]-l[2])/25;c=f.unpackFloatRGBA(q);return Math.abs(a-c)}Object.defineProperty(b,"__esModule",{value:!0});var l=function(){function c(a){this.context=a;this._doublePrecisionRequiresObfuscation=null}Object.defineProperty(c.prototype,"doublePrecisionRequiresObfuscation",{get:function(){if(a.isNone(this._doublePrecisionRequiresObfuscation)){var c=
g(this.context,!1),d=g(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==c&&(0===d||5<c/d)}return this._doublePrecisionRequiresObfuscation},enumerable:!0,configurable:!0});return c}(),d=null;b.testWebGLDriver=function(c){if(a.isNone(d)||d.context!==c)d=new l(c);return d};b.clearTestWebGLDriver=function(c){a.isSome(d)&&d.context===c&&(d=null)}})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define("require exports tslib ../../../../../../core/libs/gl-matrix-2/vec3f32 ../attributes/VertexTextureCoordinates.glsl ../../shaderModules/interfaces".split(" "),
function(n,b,a,m,h,e){function f(b,f){var m=b.fragment,w=f.hasMetalnessAndRoughnessTexture||f.hasEmissionTexture||f.hasOcclusionTexture;1===f.pbrMode&&w&&b.include(h.VertexTextureCoordinates,f);2===f.pbrMode?m.code.add(e.glsl(g||(g=a.__makeTemplateObject(["\n      const vec3 mrr \x3d vec3(0.0, 0.6, 0.2);\n      const vec3 emission \x3d vec3(0.0);\n      float occlusion \x3d 1.0;\n\n      void applyPBRFactors() {}\n\n      float getBakedOcclusion() { return 1.0; }\n    "],["\n      const vec3 mrr \x3d vec3(0.0, 0.6, 0.2);\n      const vec3 emission \x3d vec3(0.0);\n      float occlusion \x3d 1.0;\n\n      void applyPBRFactors() {}\n\n      float getBakedOcclusion() { return 1.0; }\n    "])))):
(0===f.pbrMode&&m.code.add(e.glsl(l||(l=a.__makeTemplateObject(["\n      float getBakedOcclusion() { return 1.0; }\n  "],["\n      float getBakedOcclusion() { return 1.0; }\n  "])))),1===f.pbrMode&&(m.uniforms.add("emissionFactor","vec3"),m.uniforms.add("mrrFactors","vec3"),m.code.add(e.glsl(d||(d=a.__makeTemplateObject(["\n      vec3 mrr;\n      vec3 emission;\n      float occlusion;\n    "],["\n      vec3 mrr;\n      vec3 emission;\n      float occlusion;\n    "])))),f.hasMetalnessAndRoughnessTexture&&
(m.uniforms.add("texMetallicRoughness","sampler2D"),f.supportsTextureAtlas&&m.uniforms.add("texMetallicRoughnessSize","vec2"),m.code.add(e.glsl(c||(c=a.__makeTemplateObject(["\n      void applyMetallnessAndRoughness(TextureLookupParameter params) {\n        vec3 metallicRoughness \x3d textureLookup(texMetallicRoughness, params).rgb;\n\n        mrr[0] *\x3d metallicRoughness.b;\n        mrr[1] *\x3d metallicRoughness.g;\n      }"],["\n      void applyMetallnessAndRoughness(TextureLookupParameter params) {\n        vec3 metallicRoughness \x3d textureLookup(texMetallicRoughness, params).rgb;\n\n        mrr[0] *\x3d metallicRoughness.b;\n        mrr[1] *\x3d metallicRoughness.g;\n      }"]))))),
f.hasEmissionTexture&&(m.uniforms.add("texEmission","sampler2D"),f.supportsTextureAtlas&&m.uniforms.add("texEmissionSize","vec2"),m.code.add(e.glsl(k||(k=a.__makeTemplateObject(["\n      void applyEmission(TextureLookupParameter params) {\n        emission *\x3d textureLookup(texEmission, params).rgb;\n      }"],["\n      void applyEmission(TextureLookupParameter params) {\n        emission *\x3d textureLookup(texEmission, params).rgb;\n      }"]))))),f.hasOcclusionTexture?(m.uniforms.add("texOcclusion",
"sampler2D"),f.supportsTextureAtlas&&m.uniforms.add("texOcclusionSize","vec2"),m.code.add(e.glsl(p||(p=a.__makeTemplateObject(["\n      void applyOcclusion(TextureLookupParameter params) {\n        occlusion *\x3d textureLookup(texOcclusion, params).r;\n      }\n\n      float getBakedOcclusion() {\n        return occlusion;\n      }\n      "],["\n      void applyOcclusion(TextureLookupParameter params) {\n        occlusion *\x3d textureLookup(texOcclusion, params).r;\n      }\n\n      float getBakedOcclusion() {\n        return occlusion;\n      }\n      "]))))):
m.code.add(e.glsl(r||(r=a.__makeTemplateObject(["\n      float getBakedOcclusion() { return 1.0; }\n      "],["\n      float getBakedOcclusion() { return 1.0; }\n      "])))),m.code.add(e.glsl(t||(t=a.__makeTemplateObject(["\n    void applyPBRFactors() {\n      mrr \x3d mrrFactors;\n      emission \x3d emissionFactor;\n      occlusion \x3d 1.0;\n      ","\n      ","\n      ","\n      ","\n    }\n  "],["\n    void applyPBRFactors() {\n      mrr \x3d mrrFactors;\n      emission \x3d emissionFactor;\n      occlusion \x3d 1.0;\n      ",
"\n      ","\n      ","\n      ","\n    }\n  "])),w?"vtc.uv \x3d vuv0;":"",f.hasMetalnessAndRoughnessTexture?f.supportsTextureAtlas?"vtc.size \x3d texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":"",f.hasEmissionTexture?f.supportsTextureAtlas?"vtc.size \x3d texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":"",f.hasOcclusionTexture?f.supportsTextureAtlas?"vtc.size \x3d texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""))))}Object.defineProperty(b,
"__esModule",{value:!0});b.PBRSchematicMRRValues=m.vec3f32.fromValues(0,.6,.2);b.PhysicallyBasedRenderingParameters=f;(function(a){a.bindUniforms=function(a,c,d){void 0===d&&(d=!1);d||(a.setUniform3fv("mrrFactors",c.mrrFactors),a.setUniform3fv("emissionFactor",c.emissiveFactor))}})(f=b.PhysicallyBasedRenderingParameters||(b.PhysicallyBasedRenderingParameters={}));var g,l,d,c,k,p,r,t})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define("require exports tslib ./TextureCoordinateAttribute.glsl ../util/TextureAtlasLookup.glsl ../../shaderModules/interfaces".split(" "),
function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});b.VertexTextureCoordinates=function(d,c){d.include(m.TextureCoordinateAttribute,c);d.fragment.code.add(e.glsl(f||(f=a.__makeTemplateObject(["\n  struct TextureLookupParameter {\n    vec2 uv;\n    ","\n  } vtc;\n  "],["\n  struct TextureLookupParameter {\n    vec2 uv;\n    ","\n  } vtc;\n  "])),c.supportsTextureAtlas?"vec2 size;":""));1===c.attributeTextureCoordinates&&d.fragment.code.add(e.glsl(g||(g=a.__makeTemplateObject(["\n      vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return texture2D(tex, params.uv);\n      }\n    "],
["\n      vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return texture2D(tex, params.uv);\n      }\n    "]))));2===c.attributeTextureCoordinates&&(d.include(h.TextureAtlasLookup),d.fragment.code.add(e.glsl(l||(l=a.__makeTemplateObject(["\n    vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);\n      }\n    "],["\n    vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);\n      }\n    "])))))};
var f,g,l})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.TextureCoordinateAttribute=function(b,l){1===l.attributeTextureCoordinates&&(b.attributes.add("uv0","vec2"),b.varyings.add("vuv0","vec2"),b.vertex.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n      void forwardTextureCoordinates() {\n        vuv0 \x3d uv0;\n      }\n    "],
["\n      void forwardTextureCoordinates() {\n        vuv0 \x3d uv0;\n      }\n    "])))));2===l.attributeTextureCoordinates&&(b.attributes.add("uv0","vec2"),b.varyings.add("vuv0","vec2"),b.attributes.add("uvRegion","vec4"),b.varyings.add("vuvRegion","vec4"),b.vertex.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n      void forwardTextureCoordinates() {\n        vuv0 \x3d uv0;\n        vuvRegion \x3d uvRegion;\n      }\n    "],["\n      void forwardTextureCoordinates() {\n        vuv0 \x3d uv0;\n        vuvRegion \x3d uvRegion;\n      }\n    "])))));
0===l.attributeTextureCoordinates&&b.vertex.code.add(m.glsl(f||(f=a.__makeTemplateObject(["\n      void forwardTextureCoordinates() {}\n    "],["\n      void forwardTextureCoordinates() {}\n    "]))))};var h,e,f})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.TextureAtlasLookup=function(b){b.extensions.add("GL_EXT_shader_texture_lod");
b.extensions.add("GL_OES_standard_derivatives");b.fragment.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n    #ifndef GL_EXT_shader_texture_lod\n      float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n        float deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\n        return max(0.0, 0.5 * log2(deltaMaxSqr));\n      }\n    #endif\n\n    vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {\n      //[umin, vmin, umax, vmax]\n      vec2 atlasScale \x3d atlasRegion.zw - atlasRegion.xy;\n      vec2 uvAtlas \x3d fract(textureCoordinates) * atlasScale + atlasRegion.xy;\n\n      // calculate derivative of continuous texture coordinate\n      // to avoid mipmapping artifacts caused by manual wrapping in shader\n      vec2 dUVdx \x3d dFdx(textureCoordinates) * atlasScale;\n      vec2 dUVdy \x3d dFdy(textureCoordinates) * atlasScale;\n\n      #ifdef GL_EXT_shader_texture_lod\n        return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);\n      #else\n        // use bias to compensate for difference in automatic vs desired mipmap level\n        vec2 dUVdxAuto \x3d dFdx(uvAtlas);\n        vec2 dUVdyAuto \x3d dFdy(uvAtlas);\n        float mipMapLevel \x3d calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);\n        float autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);\n\n        return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);\n      #endif\n    }\n  "],
["\n    #ifndef GL_EXT_shader_texture_lod\n      float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n        float deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\n        return max(0.0, 0.5 * log2(deltaMaxSqr));\n      }\n    #endif\n\n    vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {\n      //[umin, vmin, umax, vmax]\n      vec2 atlasScale \x3d atlasRegion.zw - atlasRegion.xy;\n      vec2 uvAtlas \x3d fract(textureCoordinates) * atlasScale + atlasRegion.xy;\n\n      // calculate derivative of continuous texture coordinate\n      // to avoid mipmapping artifacts caused by manual wrapping in shader\n      vec2 dUVdx \x3d dFdx(textureCoordinates) * atlasScale;\n      vec2 dUVdy \x3d dFdy(textureCoordinates) * atlasScale;\n\n      #ifdef GL_EXT_shader_texture_lod\n        return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);\n      #else\n        // use bias to compensate for difference in automatic vs desired mipmap level\n        vec2 dUVdxAuto \x3d dFdx(uvAtlas);\n        vec2 dUVdyAuto \x3d dFdy(uvAtlas);\n        float mipMapLevel \x3d calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);\n        float autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);\n\n        return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);\n      #endif\n    }\n  "]))))};
var h})},"esri/views/3d/webgl-engine/shaders/DefaultMaterial.glsl":function(){define("require exports tslib ../core/shaderLibrary/ForwardLinearDepth.glsl ../core/shaderLibrary/Offset.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/PositionAttribute.glsl ../core/shaderLibrary/attributes/SymbolColor.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/attributes/VertexColor.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../core/shaderLibrary/shading/ComputeNormalTexture.glsl ../core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/AlphaDiscard.glsl ../core/shaderLibrary/util/HeaderComment.glsl ../core/shaderLibrary/util/MixExternalColor.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var n=new J.ShaderBuilder,fa=n.vertex.code,ga=n.fragment.code;n.include(H.HeaderComment,{name:"Default Material Shader",output:b.output});n.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");n.include(d.PositionAttribute);n.varyings.add("vpos","vec3");n.include(C.VisualVariables,b);n.include(g.InstancedDoublePrecision,
b);n.include(t.VerticalOffset,b);0===b.output&&(n.include(l.NormalAttribute,b),n.include(f.Transform,{linearDepth:!1}),0===b.normalType&&b.offsetBackfaces&&n.include(h.Offset),n.include(v.ComputeNormalTexture,b),n.include(r.VertexNormal,b),b.instancedColor&&n.attributes.add("instanceColor","vec4"),n.varyings.add("localvpos","vec3"),n.include(k.TextureCoordinateAttribute,b),n.include(m.ForwardLinearDepth,b),n.include(c.SymbolColor,b),n.include(p.VertexColor,b),n.vertex.uniforms.add("externalColor",
"vec4"),n.varyings.add("vcolorExt","vec4"),fa.add(G.glsl(L||(L=a.__makeTemplateObject(["\n      void main(void) {\n        forwardNormalizedVertexColor();\n        vcolorExt \x3d externalColor;\n        ","\n        vcolorExt *\x3d vvColor();\n        vcolorExt *\x3d getSymbolColor();\n        forwardColorMixMode();\n\n        if (vcolorExt.a \x3c ",") {\n          gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        }\n        else {\n          vpos \x3d calculateVPos();\n          localvpos \x3d vpos - view[3].xyz;\n          vpos \x3d subtractOrigin(vpos);\n          ",
"\n          vpos \x3d addVerticalOffset(vpos, localOrigin);\n          ","\n          gl_Position \x3d transformPosition(proj, view, vpos);\n          ","\n        }\n        forwardLinearDepth();\n        forwardTextureCoordinates();\n      }\n    "],["\n      void main(void) {\n        forwardNormalizedVertexColor();\n        vcolorExt \x3d externalColor;\n        ","\n        vcolorExt *\x3d vvColor();\n        vcolorExt *\x3d getSymbolColor();\n        forwardColorMixMode();\n\n        if (vcolorExt.a \x3c ",
") {\n          gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        }\n        else {\n          vpos \x3d calculateVPos();\n          localvpos \x3d vpos - view[3].xyz;\n          vpos \x3d subtractOrigin(vpos);\n          ","\n          vpos \x3d addVerticalOffset(vpos, localOrigin);\n          ","\n          gl_Position \x3d transformPosition(proj, view, vpos);\n          ","\n        }\n        forwardLinearDepth();\n        forwardTextureCoordinates();\n      }\n    "])),b.instancedColor?
"vcolorExt *\x3d instanceColor;":"",G.glsl.float(F.symbolAlphaCutoff),0===b.normalType?G.glsl(E||(E=a.__makeTemplateObject(["\n          vNormalWorld \x3d dpNormal(vvLocalNormal(normalModel()));"],["\n          vNormalWorld \x3d dpNormal(vvLocalNormal(normalModel()));"]))):"",b.vertexTangets?"vTangent \x3d dpTransformVertexTangent(tangent);":"",0===b.normalType&&b.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"")),n.include(e.Slice,b),n.include(w.EvaluateSceneLighting,
b),n.include(z.EvaluateAmbientOcclusion,b),n.include(F.DiscardOrAdjustAlpha,b),b.receiveShadows&&n.include(B.ReadShadowMap,b),n.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),b.hasColorTexture&&n.fragment.uniforms.add("tex","sampler2D"),n.include(A.PhysicallyBasedRenderingParameters,b),n.include(y.PhysicallyBasedRendering,b),n.include(I.MixExternalColor,{stages:1}),n.include(q.Normals,
b),ga.add(G.glsl(X||(X=a.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        shadingParams.viewDirection \x3d normalize(vpos - camPos);\n        ","\n        ","\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n        ssao *\x3d getBakedOcclusion();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ",
"\n        vec3 matColor \x3d max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        shadingParams.viewDirection \x3d normalize(vpos - camPos);\n        ","\n        ","\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n        ssao *\x3d getBakedOcclusion();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ",
"\n        vec3 matColor \x3d max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\n      }\n    "])),b.hasColorTexture?G.glsl(M||(M=a.__makeTemplateObject(["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),b.textureAlphaPremultiplied?
"texColor.rgb /\x3d texColor.a;":""):G.glsl(N||(N=a.__makeTemplateObject(["vec4 texColor \x3d vec4(1.0);"],["vec4 texColor \x3d vec4(1.0);"]))),3===b.normalType?G.glsl(Q||(Q=a.__makeTemplateObject(["\n        vec3 normal \x3d screenDerivativeNormal(localvpos);"],["\n        vec3 normal \x3d screenDerivativeNormal(localvpos);"]))):G.glsl(R||(R=a.__makeTemplateObject(["\n        shadingParams.normalView \x3d vNormalWorld;\n        vec3 normal \x3d shadingNormal(shadingParams);"],["\n        shadingParams.normalView \x3d vNormalWorld;\n        vec3 normal \x3d shadingNormal(shadingParams);"]))),
1===b.pbrMode?"applyPBRFactors();":"",b.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":0===b.viewingMode?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;",b.attributeColor?G.glsl(W||(W=a.__makeTemplateObject(["\n        vec3 albedo_ \x3d mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"],
["\n        vec3 albedo_ \x3d mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):G.glsl(O||(O=a.__makeTemplateObject(["\n        vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "],
["\n        vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),b.hasNormalTexture?G.glsl(U||(U=a.__makeTemplateObject(["\n              mat3 tangentSpace \x3d ","\n              vec3 shadedNormal \x3d computeTextureNormal(tangentSpace, vuv0);"],["\n              mat3 tangentSpace \x3d ","\n              vec3 shadedNormal \x3d computeTextureNormal(tangentSpace, vuv0);"])),
b.vertexTangets?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"):"vec3 shadedNormal \x3d normal;",1===b.pbrMode||2===b.pbrMode?0===b.viewingMode?G.glsl(P||(P=a.__makeTemplateObject(["vec3 normalGround \x3d normalize(vpos + localOrigin);"],["vec3 normalGround \x3d normalize(vpos + localOrigin);"]))):G.glsl(ba||(ba=a.__makeTemplateObject(["vec3 normalGround \x3d vec3(0.0, 0.0, 1.0);"],["vec3 normalGround \x3d vec3(0.0, 0.0, 1.0);"]))):G.glsl(V||(V=a.__makeTemplateObject([""],
[""]))),1===b.pbrMode||2===b.pbrMode?G.glsl(T||(T=a.__makeTemplateObject(["\n            float additionalAmbientIrradiance \x3d additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor \x3d evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"],["\n            float additionalAmbientIrradiance \x3d additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor \x3d evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):
"vec3 shadedColor \x3d evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);")));n.include(u.DefaultMaterialAuxiliaryPasses,b);return n};var E,L,M,N,Q,R,W,O,U,P,ba,V,T,X})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["require","exports","tslib","../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.Offset=function(b){b.vertex.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n    vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\n      vec3 camToVert \x3d posWorld - camPosWorld;\n\n      bool isBackface \x3d dot(camToVert, normalWorld) \x3e 0.0;\n      if (isBackface) {\n        posClip.z +\x3d 0.0000003 * posClip.w;\n      }\n      return posClip;\n    }\n  "],
["\n    vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\n      vec3 camToVert \x3d posWorld - camPosWorld;\n\n      bool isBackface \x3d dot(camToVert, normalWorld) \x3e 0.0;\n      if (isBackface) {\n        posClip.z +\x3d 0.0000003 * posClip.w;\n      }\n      return posClip;\n    }\n  "]))))};var h})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["require","exports","tslib","../util/DecodeNormal.glsl",
"../../shaderModules/interfaces"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.NormalAttribute=function(b,d){0===d.normalType&&(b.attributes.add("normal","vec3"),b.vertex.code.add(h.glsl(e||(e=a.__makeTemplateObject(["\n      vec3 normalModel() {\n        return normal;\n      }\n    "],["\n      vec3 normalModel() {\n        return normal;\n      }\n    "])))));1===d.normalType&&(b.include(m.DecodeNormal),b.attributes.add("normalCompressed","vec2"),b.vertex.code.add(h.glsl(f||
(f=a.__makeTemplateObject(["\n      vec3 normalModel() {\n        return decodeNormal(normalCompressed);\n      }\n    "],["\n      vec3 normalModel() {\n        return decodeNormal(normalCompressed);\n      }\n    "])))));3===d.normalType&&(b.extensions.add("GL_OES_standard_derivatives"),b.fragment.code.add(h.glsl(g||(g=a.__makeTemplateObject(["\n      vec3 screenDerivativeNormal(vec3 positionView) {\n        return normalize(cross(dFdx(positionView), dFdy(positionView)));\n      }\n    "],["\n      vec3 screenDerivativeNormal(vec3 positionView) {\n        return normalize(cross(dFdx(positionView), dFdy(positionView)));\n      }\n    "])))))};
var e,f,g})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DecodeNormal.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.DecodeNormal=function(b){var e=m.glsl(h||(h=a.__makeTemplateObject(["\n    vec3 decodeNormal(vec2 f) {\n      float z \x3d 1.0 - abs(f.x) - abs(f.y);\n      return vec3(f + sign(f) * min(z, 0.0), z);\n    }\n  "],["\n    vec3 decodeNormal(vec2 f) {\n      float z \x3d 1.0 - abs(f.x) - abs(f.y);\n      return vec3(f + sign(f) * min(z, 0.0), z);\n    }\n  "])));
b.fragment.code.add(e);b.vertex.code.add(e)};var h})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.PositionAttribute=function(b){b.attributes.add("position","vec3");b.vertex.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n    vec3 positionModel() { return position; }\n  "],["\n    vec3 positionModel() { return position; }\n  "]))))};
var h})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define(["require","exports","tslib","../../../collections/Component/Material/shader/DecodeSymbolColor.glsl","../../shaderModules/interfaces"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.SymbolColor=function(b,l){l.symbolColor?(b.include(m.DecodeSymbolColor),b.attributes.add("symbolColor","vec4"),b.varyings.add("colorMixMode","mediump float")):b.fragment.uniforms.add("colorMixMode",
"int");l.symbolColor?b.vertex.code.add(h.glsl(e||(e=a.__makeTemplateObject(["\n    int symbolColorMixMode;\n\n    vec4 getSymbolColor() {\n      return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n    }\n\n    void forwardColorMixMode() {\n      colorMixMode \x3d float(symbolColorMixMode) + 0.5;\n    }\n  "],["\n    int symbolColorMixMode;\n\n    vec4 getSymbolColor() {\n      return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n    }\n\n    void forwardColorMixMode() {\n      colorMixMode \x3d float(symbolColorMixMode) + 0.5;\n    }\n  "])))):
b.vertex.code.add(h.glsl(f||(f=a.__makeTemplateObject(["\n    vec4 getSymbolColor() { return vec4(1.0); }\n    void forwardColorMixMode() {}\n    "],["\n    vec4 getSymbolColor() { return vec4(1.0); }\n    void forwardColorMixMode() {}\n    "]))))};var e,f})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["require","exports","tslib","../../../../core/shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});
b.DecodeSymbolColor=function(b){b.vertex.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n      float symbolAlpha \x3d 0.0;\n\n      const float maxTint \x3d 85.0;\n      const float maxReplace \x3d 170.0;\n      const float scaleAlpha \x3d 3.0;\n\n      if (symbolColor.a \x3e maxReplace) {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\n      } else if (symbolColor.a \x3e maxTint) {\n        colorMixMode \x3d ",
";\n        symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\n      } else if (symbolColor.a \x3e 0.0) {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d scaleAlpha * symbolColor.a;\n      } else {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d 0.0;\n      }\n\n      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n    }\n  "],["\n    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n      float symbolAlpha \x3d 0.0;\n\n      const float maxTint \x3d 85.0;\n      const float maxReplace \x3d 170.0;\n      const float scaleAlpha \x3d 3.0;\n\n      if (symbolColor.a \x3e maxReplace) {\n        colorMixMode \x3d ",
";\n        symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\n      } else if (symbolColor.a \x3e maxTint) {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\n      } else if (symbolColor.a \x3e 0.0) {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d scaleAlpha * symbolColor.a;\n      } else {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d 0.0;\n      }\n\n      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n    }\n  "])),
m.glsl.int(1),m.glsl.int(3),m.glsl.int(4),m.glsl.int(1)))};var h})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.VertexColor=function(b,l){l.attributeColor?(b.attributes.add("color","vec4"),b.varyings.add("vColor","vec4"),b.vertex.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n      void forwardVertexColor() { vColor \x3d color; }\n    "],
["\n      void forwardVertexColor() { vColor \x3d color; }\n    "])))),b.vertex.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n      void forwardNormalizedVertexColor() { vColor \x3d color * 0.003921568627451; }\n    "],["\n      void forwardNormalizedVertexColor() { vColor \x3d color * 0.003921568627451; }\n    "]))))):b.vertex.code.add(m.glsl(f||(f=a.__makeTemplateObject(["\n      void forwardVertexColor() {}\n      void forwardNormalizedVertexColor() {}\n    "],["\n      void forwardVertexColor() {}\n      void forwardNormalizedVertexColor() {}\n    "]))))};
var h,e,f})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define("require exports tslib ./NormalAttribute.glsl ./VertexPosition.glsl ../../shaderModules/interfaces".split(" "),function(n,b,a,m,h,e){function f(b,f){0===f.normalType||1===f.normalType?(b.include(m.NormalAttribute,f),b.varyings.add("vNormalWorld","vec3"),b.varyings.add("vNormalView","vec3"),b.vertex.uniforms.add("uTransformNormal_GlobalFromModel","mat3"),b.vertex.uniforms.add("uTransformNormal_ViewFromGlobal",
"mat3"),b.vertex.code.add(e.glsl(g||(g=a.__makeTemplateObject(["\n      void forwardNormal() {\n        vNormalWorld \x3d uTransformNormal_GlobalFromModel * normalModel();\n        vNormalView \x3d uTransformNormal_ViewFromGlobal * vNormalWorld;\n      }\n    "],["\n      void forwardNormal() {\n        vNormalWorld \x3d uTransformNormal_GlobalFromModel * normalModel();\n        vNormalView \x3d uTransformNormal_ViewFromGlobal * vNormalWorld;\n      }\n    "]))))):2===f.normalType?(b.include(h.VertexPosition,
f),b.varyings.add("vNormalWorld","vec3"),b.vertex.code.add(e.glsl(c||(c=a.__makeTemplateObject(["\n    void forwardNormal() {\n      vNormalWorld \x3d ","\n    }\n    "],["\n    void forwardNormal() {\n      vNormalWorld \x3d ","\n    }\n    "])),0===f.viewingMode?e.glsl(l||(l=a.__makeTemplateObject(["normalize(vPositionWorldCameraRelative);"],["normalize(vPositionWorldCameraRelative);"]))):e.glsl(d||(d=a.__makeTemplateObject(["vec3(0.0, 0.0, 1.0);"],["vec3(0.0, 0.0, 1.0);"])))))):b.vertex.code.add(e.glsl(k||
(k=a.__makeTemplateObject(["\n      void forwardNormal() {}\n    "],["\n      void forwardNormal() {}\n    "]))))}Object.defineProperty(b,"__esModule",{value:!0});b.VertexNormal=f;(function(a){a.bindUniforms=function(a,c){a.setUniformMatrix4fv("viewNormal",c.viewInvTransp)}})(f=b.VertexNormal||(b.VertexNormal={}));var g,l,d,c,k})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("require exports tslib ../../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../../core/libs/gl-matrix-2/vec3f64 ./PositionAttribute.glsl ../util/DoublePrecision.glsl ../../shaderModules/interfaces".split(" "),
function(n,b,a,m,h,e,f,g,l){function d(d,b){d.include(f.PositionAttribute);d.include(g.DoublePrecision,b);d.varyings.add("vPositionWorldCameraRelative","vec3");d.varyings.add("vPosition_view","vec3");d.vertex.uniforms.add("uTransform_WorldFromModel_RS","mat3");d.vertex.uniforms.add("uTransform_WorldFromModel_TH","vec3");d.vertex.uniforms.add("uTransform_WorldFromModel_TL","vec3");d.vertex.uniforms.add("uTransform_WorldFromView_TH","vec3");d.vertex.uniforms.add("uTransform_WorldFromView_TL","vec3");
d.vertex.uniforms.add("uTransform_ViewFromCameraRelative_RS","mat3");d.vertex.uniforms.add("uTransform_ProjFromView","mat4");d.vertex.code.add(l.glsl(c||(c=a.__makeTemplateObject(["\n    // compute position in world space orientation, but relative to the camera position\n    vec3 positionWorldCameraRelative() {\n      vec3 rotatedModelPosition \x3d uTransform_WorldFromModel_RS * positionModel();\n\n      vec3 transform_CameraRelativeFromModel \x3d dpAdd(\n        uTransform_WorldFromModel_TL,\n        uTransform_WorldFromModel_TH,\n        -uTransform_WorldFromView_TL,\n        -uTransform_WorldFromView_TH\n      );\n\n      return transform_CameraRelativeFromModel + rotatedModelPosition;\n    }\n\n    // position in view space, that is relative to the camera position and orientation\n    vec3 position_view() {\n      return uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();\n    }\n\n    // compute gl_Position and forward related varyings to fragment shader\n    void forwardPosition() {\n      vPositionWorldCameraRelative \x3d positionWorldCameraRelative();\n      vPosition_view \x3d position_view();\n      gl_Position \x3d uTransform_ProjFromView * vec4(vPosition_view, 1.0);\n    }\n\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "],
["\n    // compute position in world space orientation, but relative to the camera position\n    vec3 positionWorldCameraRelative() {\n      vec3 rotatedModelPosition \x3d uTransform_WorldFromModel_RS * positionModel();\n\n      vec3 transform_CameraRelativeFromModel \x3d dpAdd(\n        uTransform_WorldFromModel_TL,\n        uTransform_WorldFromModel_TH,\n        -uTransform_WorldFromView_TL,\n        -uTransform_WorldFromView_TH\n      );\n\n      return transform_CameraRelativeFromModel + rotatedModelPosition;\n    }\n\n    // position in view space, that is relative to the camera position and orientation\n    vec3 position_view() {\n      return uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();\n    }\n\n    // compute gl_Position and forward related varyings to fragment shader\n    void forwardPosition() {\n      vPositionWorldCameraRelative \x3d positionWorldCameraRelative();\n      vPosition_view \x3d position_view();\n      gl_Position \x3d uTransform_ProjFromView * vec4(vPosition_view, 1.0);\n    }\n\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "]))));
d.fragment.uniforms.add("uTransform_WorldFromView_TL","vec3");d.fragment.code.add(l.glsl(k||(k=a.__makeTemplateObject(["\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "],["\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "]))))}Object.defineProperty(b,"__esModule",{value:!0});b.VertexPosition=d;(function(a){var c=function(){return function(){this.worldFromModel_RS=m.mat3f64.create();
this.worldFromModel_TH=e.vec3f64.create();this.worldFromModel_TL=e.vec3f64.create()}}();a.ModelTransform=c;c=function(){return function(){this.worldFromView_TH=e.vec3f64.create();this.worldFromView_TL=e.vec3f64.create();this.viewFromCameraRelative_RS=m.mat3f64.create();this.projFromView=h.mat4f64.create()}}();a.ViewProjectionTransform=c;a.bindModelTransform=function(a,c){a.setUniformMatrix3fv("uTransform_WorldFromModel_RS",c.worldFromModel_RS);a.setUniform3fv("uTransform_WorldFromModel_TH",c.worldFromModel_TH);
a.setUniform3fv("uTransform_WorldFromModel_TL",c.worldFromModel_TL)};a.bindViewProjTransform=function(a,c){a.setUniform3fv("uTransform_WorldFromView_TH",c.worldFromView_TH);a.setUniform3fv("uTransform_WorldFromView_TL",c.worldFromView_TL);a.setUniformMatrix4fv("uTransform_ProjFromView",c.projFromView);a.setUniformMatrix3fv("uTransform_ViewFromCameraRelative_RS",c.viewFromCameraRelative_RS)}})(d=b.VertexPosition||(b.VertexPosition={}));var c,k})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("require exports tslib ../Slice.glsl ../Transform.glsl ../attributes/NormalAttribute.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexNormal.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../../shaderModules/interfaces".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p){Object.defineProperty(b,"__esModule",{value:!0});b.DefaultMaterialAuxiliaryPasses=function(b,n){var H=b.vertex.code,I=b.fragment.code;if(1===n.output||3===n.output)b.include(h.Transform,{linearDepth:!0}),b.include(f.TextureCoordinateAttribute,n),b.include(c.VisualVariables,n),b.include(l.OutputDepth,n),b.include(m.Slice,n),b.vertex.uniforms.add("nearFar","vec2"),b.varyings.add("depth","float"),n.hasColorTexture&&b.fragment.uniforms.add("tex","sampler2D"),H.add(p.glsl(r||
(r=a.__makeTemplateObject(["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        forwardTextureCoordinates();\n      }\n    "],["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        forwardTextureCoordinates();\n      }\n    "])))),
b.include(k.DiscardOrAdjustAlpha,n),I.add(p.glsl(u||(u=a.__makeTemplateObject(["\n      void main(void) {\n        discardBySlice(vpos);\n        ","\n        outputDepth(depth);\n      }\n    "],["\n      void main(void) {\n        discardBySlice(vpos);\n        ","\n        outputDepth(depth);\n      }\n    "])),n.hasColorTexture?p.glsl(t||(t=a.__makeTemplateObject(["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):
""));2===n.output&&(b.include(h.Transform,{linearDepth:!1}),b.include(e.NormalAttribute,n),b.include(g.VertexNormal,n),b.include(f.TextureCoordinateAttribute,n),b.include(c.VisualVariables,n),n.hasColorTexture&&b.fragment.uniforms.add("tex","sampler2D"),b.vertex.uniforms.add("viewNormal","mat4"),b.varyings.add("vPositionView","vec3"),H.add(p.glsl(z||(z=a.__makeTemplateObject(["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        ","\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "],
["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        ","\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "])),0===n.normalType?p.glsl(v||(v=a.__makeTemplateObject(["\n        vNormalWorld \x3d dpNormalView(vvLocalNormal(normalModel()));"],["\n        vNormalWorld \x3d dpNormalView(vvLocalNormal(normalModel()));"]))):
"")),b.include(m.Slice,n),b.include(k.DiscardOrAdjustAlpha,n),I.add(p.glsl(A||(A=a.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n\n        ","\n        gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 1.0);\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        ","\n\n        ","\n        gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 1.0);\n      }\n    "])),n.hasColorTexture?p.glsl(w||(w=a.__makeTemplateObject(["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"],
["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"",3===n.normalType?p.glsl(q||(q=a.__makeTemplateObject(["\n            vec3 normal \x3d screenDerivativeNormal(vPositionView);"],["\n            vec3 normal \x3d screenDerivativeNormal(vPositionView);"]))):p.glsl(y||(y=a.__makeTemplateObject(["\n            vec3 normal \x3d normalize(vNormalWorld);\n            if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;"],["\n            vec3 normal \x3d normalize(vNormalWorld);\n            if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;"]))))));
4===n.output&&(b.include(h.Transform,{linearDepth:!1}),b.include(f.TextureCoordinateAttribute,n),b.include(c.VisualVariables,n),n.hasColorTexture&&b.fragment.uniforms.add("tex","sampler2D"),H.add(p.glsl(B||(B=a.__makeTemplateObject(["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "],
["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "])))),b.include(m.Slice,n),b.include(k.DiscardOrAdjustAlpha,n),b.include(d.OutputHighlight),I.add(p.glsl(F||(F=a.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        outputHighlight();\n      }\n    "],
["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        outputHighlight();\n      }\n    "])),n.hasColorTexture?p.glsl(C||(C=a.__makeTemplateObject(["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"")))};var r,t,u,v,z,w,q,y,A,B,C,F})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["require",
"exports","tslib","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.OutputDepth=function(b,l){b.include(m.RgbaFloatEncoding);3===l.output?(b.extensions.add("GL_OES_standard_derivatives"),b.fragment.code.add(h.glsl(e||(e=a.__makeTemplateObject(["\n      float _calculateFragDepth(const in float depth) {\n        // calc polygon offset\n        const float SLOPE_SCALE \x3d 2.0;\n        const float BIAS \x3d 2.0 * .000015259;    // 1 / (2^16 - 1)\n        float m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\n        float result \x3d depth + SLOPE_SCALE * m + BIAS;\n        return clamp(result, .0, .999999);\n      }\n\n      void outputDepth(float _linearDepth) {\n        gl_FragColor \x3d float2rgba(_calculateFragDepth(_linearDepth));\n      }\n    "],
["\n      float _calculateFragDepth(const in float depth) {\n        // calc polygon offset\n        const float SLOPE_SCALE \x3d 2.0;\n        const float BIAS \x3d 2.0 * .000015259;    // 1 / (2^16 - 1)\n        float m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\n        float result \x3d depth + SLOPE_SCALE * m + BIAS;\n        return clamp(result, .0, .999999);\n      }\n\n      void outputDepth(float _linearDepth) {\n        gl_FragColor \x3d float2rgba(_calculateFragDepth(_linearDepth));\n      }\n    "]))))):
1===l.output&&b.fragment.code.add(h.glsl(f||(f=a.__makeTemplateObject(["\n      void outputDepth(float _linearDepth) {\n        gl_FragColor \x3d float2rgba(_linearDepth);\n      }\n    "],["\n      void outputDepth(float _linearDepth) {\n        gl_FragColor \x3d float2rgba(_linearDepth);\n      }\n    "]))))};var e,f})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define(["require","exports","tslib","../attributes/VertexTextureCoordinates.glsl","../../shaderModules/interfaces"],
function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.ComputeNormalTexture=function(d,c){var b=d.fragment;b.uniforms.add("normalTexture","sampler2D");b.uniforms.add("normalTextureSize","vec2");c.vertexTangets?(d.attributes.add("tangent","vec4"),d.varyings.add("vTangent","vec4"),2===c.doubleSidedMode?b.code.add(h.glsl(e||(e=a.__makeTemplateObject(["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness \x3d gl_FrontFacing ? vTangent.w : -vTangent.w;\n        vec3 tangent \x3d normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "],
["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness \x3d gl_FrontFacing ? vTangent.w : -vTangent.w;\n        vec3 tangent \x3d normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "])))):b.code.add(h.glsl(f||(f=a.__makeTemplateObject(["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness \x3d vTangent.w;\n        vec3 tangent \x3d normalize(vTangent.xyz);\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "],
["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness \x3d vTangent.w;\n        vec3 tangent \x3d normalize(vTangent.xyz);\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "]))))):(d.extensions.add("GL_OES_standard_derivatives"),b.code.add(h.glsl(g||(g=a.__makeTemplateObject(['\n    mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\n\n      vec3 Q1 \x3d dFdx(pos);\n      vec3 Q2 \x3d dFdy(pos);\n\n      vec2 stx \x3d dFdx(st);\n      vec2 sty \x3d dFdy(st);\n\n      float det \x3d stx.t * sty.s - sty.t * stx.s;\n\n      vec3 T \x3d stx.t * Q2 - sty.t * Q1; // compute tangent\n      T \x3d T - normal * dot(normal, T); // orthogonalize tangent\n      T *\x3d inversesqrt(max(dot(T,T), 1.e-10)); // "soft" normalize - goes to 0 when T goes to 0\n      vec3 B \x3d sign(det) * cross(normal, T); // assume normal is normalized, B has the same lenght as B\n      return mat3(T, B, normal); // T and B go to 0 when the tangent space is not well defined by the uv coordinates\n    }\n  '],
['\n    mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\n\n      vec3 Q1 \x3d dFdx(pos);\n      vec3 Q2 \x3d dFdy(pos);\n\n      vec2 stx \x3d dFdx(st);\n      vec2 sty \x3d dFdy(st);\n\n      float det \x3d stx.t * sty.s - sty.t * stx.s;\n\n      vec3 T \x3d stx.t * Q2 - sty.t * Q1; // compute tangent\n      T \x3d T - normal * dot(normal, T); // orthogonalize tangent\n      T *\x3d inversesqrt(max(dot(T,T), 1.e-10)); // "soft" normalize - goes to 0 when T goes to 0\n      vec3 B \x3d sign(det) * cross(normal, T); // assume normal is normalized, B has the same lenght as B\n      return mat3(T, B, normal); // T and B go to 0 when the tangent space is not well defined by the uv coordinates\n    }\n  '])))));
0!==c.attributeTextureCoordinates&&(d.include(m.VertexTextureCoordinates,c),b.code.add(h.glsl(l||(l=a.__makeTemplateObject(["\n    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {\n      vtc.uv \x3d uv;\n      ","\n      vec3 rawNormal \x3d textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;\n      return tangentSpace * rawNormal;\n    }\n  "],["\n    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {\n      vtc.uv \x3d uv;\n      ","\n      vec3 rawNormal \x3d textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;\n      return tangentSpace * rawNormal;\n    }\n  "])),
c.supportsTextureAtlas?"vtc.size \x3d normalTextureSize;":"")))};var e,f,g,l})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.EvaluateAmbientOcclusion=function(b,g){b=b.fragment;g.receiveAmbientOcclusion?(b.uniforms.add("ssaoTex","sampler2D"),b.uniforms.add("viewportPixelSz","vec4"),b.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n      float evaluateAmbientOcclusion() {\n        return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n      }\n\n      float evaluateAmbientOcclusionInverse() {\n        float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        return viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\n      }\n    "],
["\n      float evaluateAmbientOcclusion() {\n        return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n      }\n\n      float evaluateAmbientOcclusionInverse() {\n        float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        return viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\n      }\n    "]))))):b.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n      float evaluateAmbientOcclusion() { return 0.0; } // no occlusion\n      float evaluateAmbientOcclusionInverse() { return 1.0; }\n    "],
["\n      float evaluateAmbientOcclusion() { return 0.0; } // no occlusion\n      float evaluateAmbientOcclusionInverse() { return 1.0; }\n    "]))))};var h,e})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("require exports tslib ./EvaluateAmbientLighting.glsl ./EvaluateAmbientOcclusion.glsl ./EvaluateMainLighting.glsl ./PhysicallyBasedRendering.glsl ./PiUtils.glsl ./ReadShadowMap.glsl ../../shaderModules/interfaces".split(" "),function(n,b,
a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",{value:!0});b.EvaluateSceneLighting=function(b,F){var C=b.fragment;b.include(e.EvaluateMainLighting);b.include(h.EvaluateAmbientOcclusion,F);0!==F.pbrMode&&b.include(f.PhysicallyBasedRendering,F);b.include(m.EvaluateAmbientLighting,F);F.receiveShadows&&b.include(l.ReadShadowMap,F);C.uniforms.add("lightingGlobalFactor","float");C.uniforms.add("ambientBoostFactor","float");b.include(g.PiUtils);C.code.add(d.glsl(c||(c=a.__makeTemplateObject(["\n    const float GAMMA_SRGB \x3d 2.1;\n    const float INV_GAMMA_SRGB \x3d 0.4761904;\n    ",
"\n  "],["\n    const float GAMMA_SRGB \x3d 2.1;\n    const float INV_GAMMA_SRGB \x3d 0.4761904;\n    ","\n  "])),0===F.pbrMode?"":"const vec3 GROUND_REFLECTANCE \x3d vec3(0.2);"));if(F.useOldSceneLightInterface)C.code.add(d.glsl(k||(k=a.__makeTemplateObject(["\n    vec3 evaluateSceneLightingExt(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n      // evaluate the main light\n      #if defined(TREE_RENDERING)\n        // Special case for tree rendering:\n        // We shift the Lambert lobe to the back, allowing it to reach part of the hemisphere\n        // facing away from the light. The idea is to get an effect where light is transmitted\n        // through the tree.\n        float minDot \x3d -0.5;\n        float dotRange \x3d 1.0 - minDot;\n        float dotNormalization \x3d 0.66; // guessed \x26 hand tweaked value, for an exact value we could precompute an integral over the sphere\n\n        float dotVal \x3d dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);\n      #else\n        float dotVal \x3d clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);\n      #endif\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\n\n      vec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\n      vec3 ambientLight \x3d calculateAmbientIrradiance(normal, ssao);\n\n      // inverse gamma correction on the albedo color\n      vec3 albedoGammaC \x3d pow(albedo, vec3(GAMMA_SRGB));\n\n      // physically correct BRDF normalizes by PI\n      vec3 totalLight \x3d mainLight + ambientLight + additionalLight;\n      totalLight \x3d min(totalLight, vec3(PI));\n      vec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\n\n      // apply gamma correction to the computed color\n      outColor \x3d pow(outColor, vec3(INV_GAMMA_SRGB));\n\n      return outColor;\n    }\n  "],
["\n    vec3 evaluateSceneLightingExt(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n      // evaluate the main light\n      #if defined(TREE_RENDERING)\n        // Special case for tree rendering:\n        // We shift the Lambert lobe to the back, allowing it to reach part of the hemisphere\n        // facing away from the light. The idea is to get an effect where light is transmitted\n        // through the tree.\n        float minDot \x3d -0.5;\n        float dotRange \x3d 1.0 - minDot;\n        float dotNormalization \x3d 0.66; // guessed \x26 hand tweaked value, for an exact value we could precompute an integral over the sphere\n\n        float dotVal \x3d dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);\n      #else\n        float dotVal \x3d clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);\n      #endif\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\n\n      vec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\n      vec3 ambientLight \x3d calculateAmbientIrradiance(normal, ssao);\n\n      // inverse gamma correction on the albedo color\n      vec3 albedoGammaC \x3d pow(albedo, vec3(GAMMA_SRGB));\n\n      // physically correct BRDF normalizes by PI\n      vec3 totalLight \x3d mainLight + ambientLight + additionalLight;\n      totalLight \x3d min(totalLight, vec3(PI));\n      vec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\n\n      // apply gamma correction to the computed color\n      outColor \x3d pow(outColor, vec3(INV_GAMMA_SRGB));\n\n      return outColor;\n    }\n  "]))));
else if(0===F.viewingMode?C.code.add(d.glsl(p||(p=a.__makeTemplateObject(["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        vec3 shadingNormalWorld \x3d normalize(vPosWorld);\n        float vndl \x3d -dot(shadingNormalWorld, lightingMainDirection);\n\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "],["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        vec3 shadingNormalWorld \x3d normalize(vPosWorld);\n        float vndl \x3d -dot(shadingNormalWorld, lightingMainDirection);\n\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "])))):
C.code.add(d.glsl(r||(r=a.__makeTemplateObject(["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        float vndl \x3d -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "],["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        float vndl \x3d -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "])))),C.code.add(d.glsl(t||
(t=a.__makeTemplateObject(["\n      vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vPosWorld);\n        return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;\n      }\n    "],["\n      vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vPosWorld);\n        return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;\n      }\n    "])))),
0===F.pbrMode||4===F.pbrMode)C.code.add(d.glsl(u||(u=a.__makeTemplateObject(["\n      vec3 evaluateSceneLighting(vec3 normalWorld, vec3 baseColor, float mainLightShadow, float ambientOcclusion, vec3 additionalLight)\n      {\n        vec3 mainLighting \x3d evaluateMainLighting(normalWorld, mainLightShadow);\n        vec3 ambientLighting \x3d calculateAmbientIrradiance(normalWorld, ambientOcclusion);\n        // inverse gamma correction on the base color\n        vec3 baseColorLinear \x3d pow(baseColor, vec3(GAMMA_SRGB));\n\n        // physically correct BRDF normalizes by PI\n        vec3 totalLight \x3d mainLighting + ambientLighting + additionalLight;\n        totalLight \x3d min(totalLight, vec3(PI));\n        vec3 outColor \x3d vec3((baseColorLinear / PI) * totalLight);\n\n        // apply gamma correction to the computed color\n        outColor \x3d pow(outColor, vec3(INV_GAMMA_SRGB));\n\n        return outColor;\n      }\n      "],
["\n      vec3 evaluateSceneLighting(vec3 normalWorld, vec3 baseColor, float mainLightShadow, float ambientOcclusion, vec3 additionalLight)\n      {\n        vec3 mainLighting \x3d evaluateMainLighting(normalWorld, mainLightShadow);\n        vec3 ambientLighting \x3d calculateAmbientIrradiance(normalWorld, ambientOcclusion);\n        // inverse gamma correction on the base color\n        vec3 baseColorLinear \x3d pow(baseColor, vec3(GAMMA_SRGB));\n\n        // physically correct BRDF normalizes by PI\n        vec3 totalLight \x3d mainLighting + ambientLighting + additionalLight;\n        totalLight \x3d min(totalLight, vec3(PI));\n        vec3 outColor \x3d vec3((baseColorLinear / PI) * totalLight);\n\n        // apply gamma correction to the computed color\n        outColor \x3d pow(outColor, vec3(INV_GAMMA_SRGB));\n\n        return outColor;\n      }\n      "]))));
else if(1===F.pbrMode||2===F.pbrMode)C.code.add(d.glsl(v||(v=a.__makeTemplateObject(["\n      const float fillLightIntensity \x3d 0.25;\n      const float horizonLightDiffusion \x3d 0.4;\n      const float additionalAmbientIrradianceFactor \x3d 0.02;\n\n      vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)\n      {\n        // Calculate half vector between view and light direction\n        vec3 viewDirection \x3d -viewDir;\n        vec3 mainLightDirection \x3d -lightingMainDirection;\n        vec3 h \x3d normalize(viewDirection + mainLightDirection);\n\n        PBRShadingInfo inputs;\n        inputs.NdotL \x3d clamp(dot(normal, mainLightDirection), 0.001, 1.0);\n        inputs.NdotV \x3d clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\n        inputs.NdotH \x3d clamp(dot(normal, h), 0.0, 1.0);\n        inputs.VdotH \x3d clamp(dot(viewDirection, h), 0.0, 1.0);\n        inputs.NdotNG \x3d clamp(dot(normal, normalGround), -1.0, 1.0);\n        vec3 reflectedView \x3d normalize(reflect(viewDirection, normal));\n        inputs.RdotNG \x3d clamp(dot(reflectedView, normalGround), -1.0, 1.0);\n\n        inputs.albedoLinear \x3d pow(albedo, vec3(GAMMA_SRGB));\n        inputs.ssao \x3d ssao;\n\n        inputs.metalness \x3d mrr[0];\n        inputs.roughness \x3d clamp(mrr[1] * mrr[1], 0.001, 0.99);\n      "],
["\n      const float fillLightIntensity \x3d 0.25;\n      const float horizonLightDiffusion \x3d 0.4;\n      const float additionalAmbientIrradianceFactor \x3d 0.02;\n\n      vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)\n      {\n        // Calculate half vector between view and light direction\n        vec3 viewDirection \x3d -viewDir;\n        vec3 mainLightDirection \x3d -lightingMainDirection;\n        vec3 h \x3d normalize(viewDirection + mainLightDirection);\n\n        PBRShadingInfo inputs;\n        inputs.NdotL \x3d clamp(dot(normal, mainLightDirection), 0.001, 1.0);\n        inputs.NdotV \x3d clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\n        inputs.NdotH \x3d clamp(dot(normal, h), 0.0, 1.0);\n        inputs.VdotH \x3d clamp(dot(viewDirection, h), 0.0, 1.0);\n        inputs.NdotNG \x3d clamp(dot(normal, normalGround), -1.0, 1.0);\n        vec3 reflectedView \x3d normalize(reflect(viewDirection, normal));\n        inputs.RdotNG \x3d clamp(dot(reflectedView, normalGround), -1.0, 1.0);\n\n        inputs.albedoLinear \x3d pow(albedo, vec3(GAMMA_SRGB));\n        inputs.ssao \x3d ssao;\n\n        inputs.metalness \x3d mrr[0];\n        inputs.roughness \x3d clamp(mrr[1] * mrr[1], 0.001, 0.99);\n      "])))),
C.code.add(d.glsl(z||(z=a.__makeTemplateObject(["\n        inputs.f0 \x3d (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\n        inputs.f90 \x3d vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0)); // more accurate then using  f90 \x3d 1.0\n        inputs.diffuseColor \x3d inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);\n      "],["\n        inputs.f0 \x3d (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\n        inputs.f90 \x3d vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0)); // more accurate then using  f90 \x3d 1.0\n        inputs.diffuseColor \x3d inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);\n      "])))),
C.code.add(d.glsl(w||(w=a.__makeTemplateObject(["\n        vec3 ambientDir \x3d vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);\n        ambientDir \x3d ambientDir !\x3d vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));\n\n        inputs.NdotAmbDir \x3d abs(dot(normal, ambientDir));\n\n        // Calculate the irradiance components: sun, fill lights and the sky.\n        vec3 mainLightIrradianceComponent  \x3d inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\n        vec3 fillLightsIrradianceComponent \x3d inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\n        // calculateAmbientIrradiance for localView and additionalLight for gloabalView\n        vec3 ambientLightIrradianceComponent \x3d calculateAmbientIrradiance(normal, ssao) + additionalLight;\n\n        // Assemble the overall irradiance of the sky that illuminates the surface\n        inputs.skyIrradianceToSurface    \x3d ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n        // Assemble the overall irradiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky irradiance by the groundReflectance\n        inputs.groundIrradianceToSurface \x3d GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n      "],
["\n        vec3 ambientDir \x3d vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);\n        ambientDir \x3d ambientDir !\x3d vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));\n\n        inputs.NdotAmbDir \x3d abs(dot(normal, ambientDir));\n\n        // Calculate the irradiance components: sun, fill lights and the sky.\n        vec3 mainLightIrradianceComponent  \x3d inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\n        vec3 fillLightsIrradianceComponent \x3d inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\n        // calculateAmbientIrradiance for localView and additionalLight for gloabalView\n        vec3 ambientLightIrradianceComponent \x3d calculateAmbientIrradiance(normal, ssao) + additionalLight;\n\n        // Assemble the overall irradiance of the sky that illuminates the surface\n        inputs.skyIrradianceToSurface    \x3d ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n        // Assemble the overall irradiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky irradiance by the groundReflectance\n        inputs.groundIrradianceToSurface \x3d GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n      "])))),
C.code.add(d.glsl(q||(q=a.__makeTemplateObject(["\n        vec3 horizonRingDir \x3d inputs.RdotNG * normalGround - reflectedView;\n        vec3 horizonRingH \x3d normalize(viewDirection + horizonRingDir);\n        inputs.NdotH_Horizon \x3d dot(normal, horizonRingH);\n\n        vec3 mainLightRadianceComponent  \x3d normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\n        vec3 horizonLightRadianceComponent \x3d normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\n        vec3 ambientLightRadianceComponent \x3d calculateAmbientRadiance(ssao) + additionalLight; // calculateAmbientRadiance for localView and additionalLight for gloabalView\n\n        // Assemble the overall radiance of the sky that illuminates the surface\n        inputs.skyRadianceToSurface    \x3d  ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\n        // Assemble the overall radiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky radince by the groundReflectance\n        inputs.groundRadianceToSurface \x3d GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\n\n        // Calculate average ambient radiance - this is used int the gamut mapping part to deduce the black level that is soft compressed\n        inputs.averageAmbientRadiance \x3d ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);\n        "],
["\n        vec3 horizonRingDir \x3d inputs.RdotNG * normalGround - reflectedView;\n        vec3 horizonRingH \x3d normalize(viewDirection + horizonRingDir);\n        inputs.NdotH_Horizon \x3d dot(normal, horizonRingH);\n\n        vec3 mainLightRadianceComponent  \x3d normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\n        vec3 horizonLightRadianceComponent \x3d normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\n        vec3 ambientLightRadianceComponent \x3d calculateAmbientRadiance(ssao) + additionalLight; // calculateAmbientRadiance for localView and additionalLight for gloabalView\n\n        // Assemble the overall radiance of the sky that illuminates the surface\n        inputs.skyRadianceToSurface    \x3d  ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\n        // Assemble the overall radiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky radince by the groundReflectance\n        inputs.groundRadianceToSurface \x3d GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\n\n        // Calculate average ambient radiance - this is used int the gamut mapping part to deduce the black level that is soft compressed\n        inputs.averageAmbientRadiance \x3d ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);\n        "])))),
C.code.add(d.glsl(B||(B=a.__makeTemplateObject(["\n        vec3 reflectedColorComponent \x3d evaluateEnvironmentIllumination(inputs);\n        vec3 additionalMaterialReflectanceComponent \x3d inputs.albedoLinear * additionalAmbientIrradiance;\n        vec3 emissionComponent \x3d pow(_emission, vec3(GAMMA_SRGB));\n        vec3 outColorLinear \x3d reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n        ","\n        return outColor;\n      }\n    "],["\n        vec3 reflectedColorComponent \x3d evaluateEnvironmentIllumination(inputs);\n        vec3 additionalMaterialReflectanceComponent \x3d inputs.albedoLinear * additionalAmbientIrradiance;\n        vec3 emissionComponent \x3d pow(_emission, vec3(GAMMA_SRGB));\n        vec3 outColorLinear \x3d reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n        ",
"\n        return outColor;\n      }\n    "])),2===F.pbrMode?d.glsl(y||(y=a.__makeTemplateObject(["vec3 outColor \x3d pow(outColorLinear - 0.005 * inputs.averageAmbientRadiance, vec3(INV_GAMMA_SRGB));"],["vec3 outColor \x3d pow(outColorLinear - 0.005 * inputs.averageAmbientRadiance, vec3(INV_GAMMA_SRGB));"]))):d.glsl(A||(A=a.__makeTemplateObject(["vec3 outColor \x3d pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));"],["vec3 outColor \x3d pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));"])))))};
var c,k,p,r,t,u,v,z,w,q,y,A,B})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.EvaluateAmbientLighting=function(b,d){b=b.fragment;var c=void 0!==d.lightingSphericalHarmonicsOrder?d.lightingSphericalHarmonicsOrder:2;0===c?(b.uniforms.add("lightingAmbientSH0","vec3"),b.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "],
["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "]))))):1===c?(b.uniforms.add("lightingAmbientSH_R","vec4"),b.uniforms.add("lightingAmbientSH_G","vec4"),b.uniforms.add("lightingAmbientSH_B","vec4"),b.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec4 sh0 \x3d vec4(\n          0.282095,\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y\n        );\n        vec3 ambientLight \x3d vec3(\n          dot(lightingAmbientSH_R, sh0),\n          dot(lightingAmbientSH_G, sh0),\n          dot(lightingAmbientSH_B, sh0)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "],
["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec4 sh0 \x3d vec4(\n          0.282095,\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y\n        );\n        vec3 ambientLight \x3d vec3(\n          dot(lightingAmbientSH_R, sh0),\n          dot(lightingAmbientSH_G, sh0),\n          dot(lightingAmbientSH_B, sh0)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "]))))):2===c&&(b.uniforms.add("lightingAmbientSH0",
"vec3"),b.uniforms.add("lightingAmbientSH_R1","vec4"),b.uniforms.add("lightingAmbientSH_G1","vec4"),b.uniforms.add("lightingAmbientSH_B1","vec4"),b.uniforms.add("lightingAmbientSH_R2","vec4"),b.uniforms.add("lightingAmbientSH_G2","vec4"),b.uniforms.add("lightingAmbientSH_B2","vec4"),b.code.add(m.glsl(f||(f=a.__makeTemplateObject(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n\n        vec4 sh1 \x3d vec4(\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y,\n          1.092548 * normal.x * normal.y\n        );\n        vec4 sh2 \x3d vec4(\n          1.092548 * normal.y * normal.z,\n          0.315392 * (3.0 * normal.z * normal.z - 1.0),\n          1.092548 * normal.x * normal.z,\n          0.546274 * (normal.x * normal.x - normal.y * normal.y)\n        );\n        ambientLight +\x3d vec3(\n          dot(lightingAmbientSH_R1, sh1),\n          dot(lightingAmbientSH_G1, sh1),\n          dot(lightingAmbientSH_B1, sh1)\n        );\n        ambientLight +\x3d vec3(\n          dot(lightingAmbientSH_R2, sh2),\n          dot(lightingAmbientSH_G2, sh2),\n          dot(lightingAmbientSH_B2, sh2)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "],
["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n\n        vec4 sh1 \x3d vec4(\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y,\n          1.092548 * normal.x * normal.y\n        );\n        vec4 sh2 \x3d vec4(\n          1.092548 * normal.y * normal.z,\n          0.315392 * (3.0 * normal.z * normal.z - 1.0),\n          1.092548 * normal.x * normal.z,\n          0.546274 * (normal.x * normal.x - normal.y * normal.y)\n        );\n        ambientLight +\x3d vec3(\n          dot(lightingAmbientSH_R1, sh1),\n          dot(lightingAmbientSH_G1, sh1),\n          dot(lightingAmbientSH_B1, sh1)\n        );\n        ambientLight +\x3d vec3(\n          dot(lightingAmbientSH_R2, sh2),\n          dot(lightingAmbientSH_G2, sh2),\n          dot(lightingAmbientSH_B2, sh2)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "])))),
1!==d.pbrMode&&2!==d.pbrMode||b.code.add(m.glsl(g||(g=a.__makeTemplateObject(["\n        const vec3 skyTransmittance \x3d vec3(0.9, 0.9, 1.0);\n\n        vec3 calculateAmbientRadiance(float ambientOcclusion)\n        {\n          vec3 ambientLight \x3d 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\n          return ambientLight *\x3d (1.0 - ambientOcclusion) * skyTransmittance;\n        }\n      "],["\n        const vec3 skyTransmittance \x3d vec3(0.9, 0.9, 1.0);\n\n        vec3 calculateAmbientRadiance(float ambientOcclusion)\n        {\n          vec3 ambientLight \x3d 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\n          return ambientLight *\x3d (1.0 - ambientOcclusion) * skyTransmittance;\n        }\n      "])))))};
var h,e,f,g})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateMainLighting.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.EvaluateMainLighting=function(b){b=b.fragment;b.uniforms.add("lightingMainDirection","vec3");b.uniforms.add("lightingMainIntensity","vec3");b.uniforms.add("lightingFixedFactor","float");b.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n    vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {\n      float dotVal \x3d clamp(-dot(normal_global, lightingMainDirection), 0.0, 1.0);\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\n\n      return lightingMainIntensity * ((1.0 - shadowing) * dotVal);\n    }\n  "],
["\n    vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {\n      float dotVal \x3d clamp(-dot(normal_global, lightingMainDirection), 0.0, 1.0);\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\n\n      return lightingMainIntensity * ((1.0 - shadowing) * dotVal);\n    }\n  "]))))};var h})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],
function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.Normals=function(b,d){b=b.fragment;b.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n    struct ShadingNormalParameters {\n      vec3 normalView;\n      vec3 viewDirection;\n    } shadingParams;\n    "],["\n    struct ShadingNormalParameters {\n      vec3 normalView;\n      vec3 viewDirection;\n    } shadingParams;\n    "]))));1===d.doubleSidedMode?b.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return dot(params.normalView, params.viewDirection) \x3e 0.0 ? normalize(-params.normalView) : normalize(params.normalView);\n      }\n    "],
["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return dot(params.normalView, params.viewDirection) \x3e 0.0 ? normalize(-params.normalView) : normalize(params.normalView);\n      }\n    "])))):2===d.doubleSidedMode?b.code.add(m.glsl(f||(f=a.__makeTemplateObject(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);\n      }\n    "],["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);\n      }\n    "])))):
b.code.add(m.glsl(g||(g=a.__makeTemplateObject(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return normalize(params.normalView);\n      }\n    "],["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return normalize(params.normalView);\n      }\n    "]))))};var h,e,f,g})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl":function(){define(["require","exports","tslib","../../../../../../core/has","../../shaderModules/interfaces"],
function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.HeaderComment=function(b,g){h.glsl(e||(e=a.__makeTemplateObject(["\n  /*\n  *  ","\n  *  ","\n  */\n  "],["\n  /*\n  *  ","\n  *  ","\n  */\n  "])),g.name,0===g.output?"RenderOutput: Color":1===g.output?"RenderOutput: Depth":3===g.output?"RenderOutput: Shadow":2===g.output?"RenderOutput: Normal":4===g.output?"RenderOutput: Highlight":"")};var e})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["require",
"exports","tslib","./ColorConversion.glsl","../../shaderModules/interfaces"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.MixExternalColor=function(b,g){b.include(m.ColorConversion,g);var f=h.glsl(e||(e=a.__makeTemplateObject(["\n    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      vec3 internalMixed \x3d internalColor * textureColor;\n      vec3 allMixed \x3d internalMixed * externalColor;\n\n      if (mode \x3d\x3d ",
") {\n        return allMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return internalMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return externalColor;\n      }\n      else {\n        // tint (or something invalid)\n        float vIn \x3d rgb2v(internalMixed);\n        vec3 hsvTint \x3d rgb2hsv(externalColor);\n        vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n        return hsv2rgb(hsvOut);\n      }\n    }\n\n    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      float internalMixed \x3d internalOpacity * textureOpacity;\n      float allMixed \x3d internalMixed * externalOpacity;\n\n      if (mode \x3d\x3d ",
") {\n        return internalMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return externalOpacity;\n      }\n      else {\n        // multiply or tint (or something invalid)\n        return allMixed;\n      }\n    }\n  "],["\n    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      vec3 internalMixed \x3d internalColor * textureColor;\n      vec3 allMixed \x3d internalMixed * externalColor;\n\n      if (mode \x3d\x3d ",
") {\n        return allMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return internalMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return externalColor;\n      }\n      else {\n        // tint (or something invalid)\n        float vIn \x3d rgb2v(internalMixed);\n        vec3 hsvTint \x3d rgb2hsv(externalColor);\n        vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n        return hsv2rgb(hsvOut);\n      }\n    }\n\n    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      float internalMixed \x3d internalOpacity * textureOpacity;\n      float allMixed \x3d internalMixed * externalOpacity;\n\n      if (mode \x3d\x3d ",
") {\n        return internalMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return externalOpacity;\n      }\n      else {\n        // multiply or tint (or something invalid)\n        return allMixed;\n      }\n    }\n  "])),h.glsl.int(1),h.glsl.int(2),h.glsl.int(3),h.glsl.int(2),h.glsl.int(3));switch(g.stages){case 0:b.vertex.code.add(f);break;case 1:b.fragment.code.add(f);break;default:b.vertex.code.add(f),b.fragment.code.add(f)}};var e})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define("require exports tslib ../core/shaderLibrary/default/RealisticTree.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderTechnique/ReloadableShaderModule ../lib/DefaultVertexAttributeLocations ./DefaultMaterialTechnique ../../../webgl/Program @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l){Object.defineProperty(b,"__esModule",{value:!0});g=function(d){function c(){return null!==d&&d.apply(this,arguments)||this}a.__extends(c,d);c.prototype.initializeProgram=function(a){var d=c.shader.get(),b=this.configuration,d=d.build({output:b.output,viewingMode:a.viewingMode,receiveShadows:b.receiveShadows,slicePlaneEnabled:b.slicePlaneEnabled,sliceHighlightDisabled:b.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:b.symbolColors,vvSize:b.vvSize,vvColor:b.vvColor,
vvInstancingEnabled:!0,instanced:b.instanced,instancedColor:b.instancedColor,instancedDoublePrecision:b.instancedDoublePrecision,useOldSceneLightInterface:!1,pbrMode:b.usePBR?1:0,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:b.hasColorTexture,receiveAmbientOcclusion:b.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:0,doubleSidedMode:2,vertexTangets:!1,attributeTextureCoordinates:b.hasColorTexture?1:0,textureAlphaPremultiplied:b.textureAlphaPremultiplied,
attributeColor:b.vertexColors,screenSizePerspectiveEnabled:b.screenSizePerspective,verticalOffsetEnabled:b.verticalOffset,offsetBackfaces:b.offsetBackfaces,doublePrecisionRequiresObfuscation:h.doublePrecisionRequiresObfuscation(a.rctx),alphaDiscardMode:b.alphaDiscardMode,supportsTextureAtlas:!1});return new l(a.rctx,d.generateSource("vertex"),d.generateSource("fragment"),f.Default3D)};c.shader=new e.ReloadableShaderModule(m,function(){return new Promise(function(a,c){n(["../core/shaderLibrary/default/RealisticTree.glsl"],
a,c)})});return c}(g.DefaultMaterialTechnique);b.RealisticTreeTechnique=g})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/RealisticTree.glsl":function(){define("require exports tslib ../ForwardLinearDepth.glsl ../Offset.glsl ../Slice.glsl ../Transform.glsl ../attributes/InstancedDoublePrecision.glsl ../attributes/NormalAttribute.glsl ../attributes/PositionAttribute.glsl ../attributes/SymbolColor.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexColor.glsl ../attributes/VerticalOffset.glsl ./DefaultMaterialAuxiliaryPasses.glsl ../shading/EvaluateAmbientOcclusion.glsl ../shading/EvaluateSceneLighting.glsl ../shading/PhysicallyBasedRendering.glsl ../shading/PhysicallyBasedRenderingParameters.glsl ../shading/ReadShadowMap.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../util/MixExternalColor.glsl ../../shaderModules/interfaces ../../shaderModules/ShaderBuilder".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var n=new F.ShaderBuilder,P=n.vertex.code,ba=n.fragment.code;n.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");n.include(d.PositionAttribute);n.varyings.add("vpos","vec3");n.include(y.VisualVariables,b);n.include(g.InstancedDoublePrecision,b);n.include(r.VerticalOffset,b);0===b.output&&(n.include(l.NormalAttribute,b),
n.include(f.Transform,{linearDepth:!1}),b.offsetBackfaces&&n.include(h.Offset),b.instancedColor&&n.attributes.add("instanceColor","vec4"),n.varyings.add("vNormalWorld","vec3"),n.varyings.add("localvpos","vec3"),n.include(k.TextureCoordinateAttribute,b),n.include(m.ForwardLinearDepth,b),n.include(c.SymbolColor,b),n.include(p.VertexColor,b),n.vertex.uniforms.add("externalColor","vec4"),n.varyings.add("vcolorExt","vec4"),P.add(C.glsl(H||(H=a.__makeTemplateObject(["\n        void main(void) {\n          forwardNormalizedVertexColor();\n          vcolorExt \x3d externalColor;\n          ",
"\n          vcolorExt *\x3d vvColor();\n          vcolorExt *\x3d getSymbolColor();\n          forwardColorMixMode();\n\n          if (vcolorExt.a \x3c ",") {\n            gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n          }\n          else {\n            vpos \x3d calculateVPos();\n            localvpos \x3d vpos - view[3].xyz;\n            vpos \x3d subtractOrigin(vpos);\n            vNormalWorld \x3d dpNormal(vvLocalNormal(normalModel()));\n            vpos \x3d addVerticalOffset(vpos, localOrigin);\n            gl_Position \x3d transformPosition(proj, view, vpos);\n            ",
"\n          }\n          forwardLinearDepth();\n          forwardTextureCoordinates();\n        }\n      "],["\n        void main(void) {\n          forwardNormalizedVertexColor();\n          vcolorExt \x3d externalColor;\n          ","\n          vcolorExt *\x3d vvColor();\n          vcolorExt *\x3d getSymbolColor();\n          forwardColorMixMode();\n\n          if (vcolorExt.a \x3c ",") {\n            gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n          }\n          else {\n            vpos \x3d calculateVPos();\n            localvpos \x3d vpos - view[3].xyz;\n            vpos \x3d subtractOrigin(vpos);\n            vNormalWorld \x3d dpNormal(vvLocalNormal(normalModel()));\n            vpos \x3d addVerticalOffset(vpos, localOrigin);\n            gl_Position \x3d transformPosition(proj, view, vpos);\n            ",
"\n          }\n          forwardLinearDepth();\n          forwardTextureCoordinates();\n        }\n      "])),b.instancedColor?"vcolorExt *\x3d instanceColor;":"",C.glsl.float(A.symbolAlphaCutoff),b.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"")),n.include(e.Slice,b),n.include(v.EvaluateSceneLighting,b),n.include(u.EvaluateAmbientOcclusion,b),n.include(A.DiscardOrAdjustAlpha,b),b.receiveShadows&&n.include(q.ReadShadowMap,b),n.fragment.uniforms.add("camPos",
"vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),n.fragment.uniforms.add("view","mat4"),b.hasColorTexture&&n.fragment.uniforms.add("tex","sampler2D"),n.include(w.PhysicallyBasedRenderingParameters,b),n.include(z.PhysicallyBasedRendering,b),n.include(B.MixExternalColor,{stages:1}),ba.add(C.glsl(W||(W=a.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 viewDirection \x3d normalize(vpos - camPos);\n        ",
"\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n        ssao *\x3d getBakedOcclusion();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor \x3d max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\n      }\n    "],
["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 viewDirection \x3d normalize(vpos - camPos);\n        ","\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n        ssao *\x3d getBakedOcclusion();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor \x3d max(ambient, diffuse);\n        ",
"\n        ","\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\n      }\n    "])),b.hasColorTexture?C.glsl(I||(I=a.__makeTemplateObject(["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),b.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""):C.glsl(G||(G=a.__makeTemplateObject(["vec4 texColor \x3d vec4(1.0);"],
["vec4 texColor \x3d vec4(1.0);"]))),1===b.pbrMode?"applyPBRFactors();":"",b.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":0===b.viewingMode?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;",b.attributeColor?C.glsl(J||(J=a.__makeTemplateObject(["\n        vec3 albedo_ \x3d mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"],
["\n        vec3 albedo_ \x3d mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):C.glsl(E||(E=a.__makeTemplateObject(["\n        vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "],
["\n        vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),C.glsl(L||(L=a.__makeTemplateObject(["\n        vec3 shadedNormal \x3d normalize(vNormalWorld);\n        albedo_ *\x3d 1.2;\n        vec3 viewForward \x3d - vec3(view[0][2], view[1][2], view[2][2]);\n        float alignmentLightView \x3d clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);\n        float transmittance \x3d 1.0 - clamp(dot(-viewForward, shadedNormal), 0.0, 1.0);\n        float treeRadialFalloff \x3d vColor.r;\n        float backLightFactor \x3d 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n        additionalLight +\x3d backLightFactor * lightingMainIntensity;"],
["\n        vec3 shadedNormal \x3d normalize(vNormalWorld);\n        albedo_ *\x3d 1.2;\n        vec3 viewForward \x3d - vec3(view[0][2], view[1][2], view[2][2]);\n        float alignmentLightView \x3d clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);\n        float transmittance \x3d 1.0 - clamp(dot(-viewForward, shadedNormal), 0.0, 1.0);\n        float treeRadialFalloff \x3d vColor.r;\n        float backLightFactor \x3d 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n        additionalLight +\x3d backLightFactor * lightingMainIntensity;"]))),
1===b.pbrMode||2===b.pbrMode?0===b.viewingMode?C.glsl(M||(M=a.__makeTemplateObject(["vec3 normalGround \x3d normalize(vpos + localOrigin);"],["vec3 normalGround \x3d normalize(vpos + localOrigin);"]))):C.glsl(N||(N=a.__makeTemplateObject(["vec3 normalGround \x3d vec3(0.0, 0.0, 1.0);"],["vec3 normalGround \x3d vec3(0.0, 0.0, 1.0);"]))):C.glsl(Q||(Q=a.__makeTemplateObject([""],[""]))),1===b.pbrMode||2===b.pbrMode?C.glsl(R||(R=a.__makeTemplateObject(["\n            float additionalAmbientIrradiance \x3d additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor \x3d evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"],
["\n            float additionalAmbientIrradiance \x3d additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor \x3d evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):"vec3 shadedColor \x3d evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);")));n.include(t.DefaultMaterialAuxiliaryPasses,b);return n};var H,I,G,J,E,L,M,N,
Q,R,W})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports tslib ../../../../Color ../../../../symbols ../../../../core/asyncUtils ../../../../core/compilerUtils ../../../../core/Error ../../../../core/has ../../../../core/lang ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../support/arcadeOnDemand ../../../../symbols/cim/CIMSymbolRasterizer ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/utils ../../../2d/arcade/utils ./constants ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./sdfPrimitives ../support/FastSymbolUpdates ../../support/projectionUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L,M,N,Q,R,W,O,U,P,ba,V,T){function X(a){return c.isSome(a)?"cross"===a||"x"===a:!1}Object.defineProperty(b,"__esModule",{value:!0});var Y=t.mat4f64.create(),da=v.vec3f64.fromValues(0,0,1),fa=[.25,.25,.75,.75],ga=[64,64];n=function(b){function t(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._cimLayers=null;a._cimSymbolMaterials=new Map;a._cimSymbolTextures=new Map;a._cimMaterialParametersInfo=null;a._cimRequiredFields=null;a._cimScaleFactorOrFunction=
null;a._size=null;a._symbolTextureRatio=1;a._outlineSize=0;a._texture=null;a._releaseTexture=null;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};return a}a.__extends(t,b);t.prototype.getCachedSize=function(){return{size:this._getIconSize()}};t.prototype.doLoad=function(d){return a.__awaiter(this,void 0,void 0,function(){var b,e,f,g;return a.__generator(this,function(a){switch(a.label){case 0:this._validateOrThrow();b=this._prepareMaterialParameters();e=this._getPrimitive();
if(!c.isSome(e))return[3,1];this._prepareResourcesPrimitive(b,e);return[3,5];case 1:return f=B.getIconHref(this.symbol,this.symbolLayer),(g=r.dataComponents(f))&&"application/json"===g.mediaType?[4,this._prepareResourcesCIM(b,JSON.parse(g.data),d)]:[3,3];case 2:return a.sent(),[3,5];case 3:return[4,this._prepareResourcesHref(b,f,d)];case 4:a.sent(),a.label=5;case 5:return[2]}})})};t.prototype._validateOrThrow=function(){if(!this._drivenProperties.size){var a=M.validateSymbolLayerSize(this._getIconSize());
if(a)throw new g("graphics3diconsymbollayer:invalid-size",a);}};t.prototype._getIconSize=function(){var a=this.symbolLayer,a=Math.round(null!=a.size?p.pt2px(a.size):16);return this._drivenProperties.size?Math.max(a,64):a};t.prototype._generateTextureCIM=function(a){var c=this._getGraphicHash(a),d=""===c?null:this._cimSymbolTextures.get(c);d||(a=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,a,"esriGeometryPoint",{scaleFactor:this._cimScaleFactorOrFunction},null,
null),this._cimMaterialParametersInfo.anchorPos=this._getAnchorPos("relative",a.anchorPosition),d=new V(a.imageData,"symbol",{width:a.imageData.width,height:a.imageData.height,powerOfTwoResizeMode:2}),this._cimSymbolTextures.set(c,d),this._context.stage.add(4,d));return d};t.prototype._computeSize=function(a,c){a=a.width/a.height;return 1<a?[c,Math.round(c/a)]:[Math.round(c*a),c]};t.prototype._prepareMaterialParameters=function(){var a={anchorPos:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},
c=this.symbol;if(c&&"point-3d"===c.type&&c.hasVisibleVerticalOffset()){var c=c.verticalOffset,d=c.minWorldLength,b=c.maxWorldLength;a.verticalOffset={screenLength:p.pt2px(c.screenLength),minWorldLength:d||0,maxWorldLength:null!=b?b:Infinity}}this._context.screenSizePerspectiveEnabled&&(a.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);a.occlusionTest=!0;a.slicePlaneEnabled=this._context.slicePlaneEnabled;return a};t.prototype._prepareResourcesPrimitive=function(a,
c){var d=this,b=this._getOutlineSize();if(X(c)&&0===b)throw Error("Nothing to render");this._outlineSize=b;a.color=this._getFillColor();a.outlineColor=this._getOutlineColor();a.outlineSize=this._outlineSize;var e=this._context.sharedResources.textures.fromData(c,function(){var a;switch(c){case "circle":a=Q.createCircle(128,64);break;case "square":a=Q.createSquare(128,64);break;case "kite":a=Q.createKite(128,64);break;case "cross":a=Q.createCross(128,64);break;case "x":a=Q.createX(128,64);break;case "triangle":a=
Q.createTriangle(128,64);break;default:f.neverReached(c)}return new V(a,"sdf_"+c,{mipmap:!1,wrap:{s:33071,t:33071},width:128,height:128,components:4,noUnpackFlip:!0})});this._texture=e.texture;this._releaseTexture=function(){return d._context.sharedResources.textures.release(e.uid)};a.textureIsSignedDistanceField=!0;a.distanceFieldBoundingBox=fa;a.textureId=this._texture.id;b=this._getIconSize();this._size=[b,b];this._symbolTextureRatio=2;this._createMaterialAndAddToStage(a,this._context.stage)};
t.prototype._prepareResourcesHref=function(c,d,b){return a.__awaiter(this,void 0,void 0,function(){var f,h,m,p,q,t,w,u,y=this;return a.__generator(this,function(a){switch(a.label){case 0:if(!l("esri-canvas-svg-support")&&r.isSVG(d))throw f="IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)",new g("graphics3diconsymbollayer:unsupported-image-format",f);this._outlineSize=this._getOutlineSize();c.color=this._getFillColor();c.outlineColor=this._getOutlineColor();c.outlineSize=this._outlineSize;
c.textureIsSignedDistanceField=!1;h=this._getIconSize();m=h*this._context.layerView.view.pixelRatio;return[4,e.result(this._context.sharedResources.textures.fromUrl(d,m,{signal:b}))];case 1:p=a.sent();if(!1===p.ok)throw k.throwIfAbortError(p.error),f="Failed to load (Request for icon resource failed: "+d+")",new g("graphics3diconsymbollayer:request-failed",f);q=p.value;t=q.uid;w=q.texture;this._releaseTexture=function(){return y._context.sharedResources.textures.release(t)};u=w.params;this._size=
this._computeSize(u,h);c.textureId=w.id;this._createMaterialAndAddToStage(c,this._context.stage);return[2]}})})};t.prototype._prepareResourcesCIM=function(c,d,b){return a.__awaiter(this,void 0,void 0,function(){var e,f,g,l,m,p,r,t,w,u,v;return a.__generator(this,function(a){switch(a.label){case 0:return e=new h.CIMSymbol({data:d}),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new y.CIMSymbolRasterizer(this._context.renderCoordsHelper.spatialReference,
!0)),f=this._context.layer.fields?this._context.layer.fields.map(function(a){return a.toJSON()}):null,g=this,[4,this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(e,f,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:b})];case 1:g._cimLayers=a.sent();if(!this._context.renderer||"dictionary"!==this._context.renderer.type||!this._context.renderer.scaleExpression)return[3,4];p=this._context.renderer;if(!isNaN(p.scaleExpression))return[3,
3];r=p.scaleExpression;return[4,q.createRendererExpression(r,this._context.layer.spatialReference,f)];case 2:return t=a.sent(),m=function(a,c,d){a=C.callWithFeature(t,a,{$view:d},"esriGeometryPoint",c);return null!==a?a:1},[3,4];case 3:l=Number(p.scaleExpression),a.label=4;case 4:this._cimScaleFactorOrFunction=l||m||1;if(this._context.renderer)return[3,5];u=[];return[3,7];case 5:return[4,this._context.renderer.getRequiredFields(this._context.layer.fields)];case 6:u=a.sent(),a.label=7;case 7:return w=
u,k.throwIfAborted(b),v=this._context.layer.fieldsIndex,this._cimRequiredFields=w.map(function(a){return v.get(a).name}),this._cimMaterialParametersInfo=c,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1,[2]}})})};t.prototype._getPrimitive=function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&
this.symbolLayer.resource.primitive||A.defaultPrimitive};t.prototype._getOutlineSize=function(){var a=0,a=this.symbolLayer;if(c.isSome(a.outline)&&null!=a.outline.size)return Math.max(p.pt2px(a.outline.size),0);a=this._getPrimitive();a=X(a)?1.5:0;return Math.max(a,0)};t.prototype._getOutlineColor=function(){var a=this._getLayerOpacity(),d=c.get(this.symbolLayer,"outline","color");if(c.isSome(d)){var b=m.toUnitRGB(d);return[b[0],b[1],b[2],d.a*a]}return[0,0,0,0]};t.prototype._getFillColor=function(){if(X(this._getPrimitive()))return F.TRANSPARENT_UNIT;
var a=c.isNone(this._getPrimitive()),d=c.get(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(d,{hasIntrinsicColor:a})};t.prototype._getAnchorPos=function(a,c){return"relative"===a?u.vec2f64.fromValues((c.x||0)+.5,-(c.y||0)+.5):a in M.namedAnchorToHUDMaterialAnchorPos?M.namedAnchorToHUDMaterialAnchorPos[a]:M.namedAnchorToHUDMaterialAnchorPos.center};t.prototype._createMaterialAndAddToStage=function(a,c){this._fastUpdates=this._cimLayers?{enabled:!1}:R.initFastSymbolUpdatesState(this._context.renderer,
this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&d.mixin(a,this._fastUpdates.materialParameters);if(this._cimLayers){var b=this._cimSymbolMaterials.get(a.textureId);b||(b=new T.default(a,this._getIdHint("_icon")),this._cimSymbolMaterials.set(a.textureId,b),c.add(3,b));return b}this._material=new T.default(a,this._getIdHint("_icon"));c.add(3,this._material);return this._material};t.prototype._setDrapingDependentMaterialParameters=function(){this.draped&&(this._forEachMaterial(function(a){a.setParameterValues({verticalOffset:null,
screenSizePerspective:null,occlusionTest:!1,slicePlaneEnabled:!1,shaderPolygonOffset:0})}),this.layerOpacityChanged())};t.prototype.destroy=function(){var a=this;b.prototype.destroy.call(this);this._forEachMaterial(function(c){a._context.stage.remove(3,c.id)});c.isSome(this._material)&&(this._material=null);this._cimSymbolMaterials.clear();this._cimSymbolTextures.forEach(function(c){a._context.stage.remove(4,c.id)});this._cimSymbolTextures.clear();this._releaseTexture&&(this._releaseTexture(),this._releaseTexture=
null)};t.prototype._getScaleFactor=function(a,c){if(this._drivenProperties.size&&a.size){for(var d=0;3>d;d++){var b=a.size[d];b&&"symbol-value"!==b&&"proportional"!==b&&(a.size[d]=p.pt2px(b))}if("symbol-value"===a.size[0])return 1;if(isFinite(+a.size[0]))return+a.size[0]/c;if(isFinite(+a.size[2]))return+a.size[2]/c}return 1};t.prototype.createGraphics3DGraphic=function(d){var b=d.renderingInfo,e=d.graphic,f,g;if(this._cimLayers){if(!this._cimLayers.length)return null;var k=this._generateTextureCIM(e);
g=a.__assign({textureId:k.id},this._cimMaterialParametersInfo);g=this._createMaterialAndAddToStage(g,this._context.stage);f=[k.params.width,k.params.height]}else f=this._size,g=c.unwrap(this._material);if(!this._validateGeometry(e.geometry))return null;k=N.placePointOnGeometry(e.geometry);if(c.isNone(k))return this.logger.warn("unsupported geometry type for icon symbol: "+e.geometry.type),null;var h="graphic"+e.uid,l=this._getVertexOpacityAndColor(b),m=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||
(m=this._getScaleFactor(b,f[0]>f[1]?f[0]:f[1]));m*=this._symbolTextureRatio;b=[f[0]*m,f[1]*m];f=this.setGraphicElevationContext(e,new G.ElevationContext);this.ensureDrapedStatus("on-the-ground"===f.mode)&&this._setDrapingDependentMaterialParameters();return this.draped?this._createAsOverlay(e,k,g,l,b,d.layer.uid):this._createAs3DShape(e,k,g,l,b,f,h,e.uid)};t.prototype.layerOpacityChanged=function(){var a=this._getFillColor(),c=this._getOutlineColor();this._forEachMaterial(function(d){d.setParameterValues({color:a});
d.setParameterValues({outlineColor:c})});return!0};t.prototype.layerElevationInfoChanged=function(a,c,d){var b=this._elevationContext.mode;d=I.elevationModeChangeUpdateType(t.elevationModeChangeTypes,d,b);if(d!==I.SymbolUpdateType.UPDATE)return d;var e=I.needsElevationUpdates2D(b)||"absolute-height"===b;return this.updateGraphics3DGraphicElevationInfo(a,c,function(){return e})};t.prototype.slicePlaneEnabledChanged=function(){var a=this;this.draped||this._forEachMaterial(function(c){c.setParameterValues({slicePlaneEnabled:a._context.slicePlaneEnabled})});
return!0};t.prototype.physicalBasedRenderingChanged=function(){return!0};t.prototype.pixelRatioChanged=function(){return this._getPrimitive()?!0:!1};t.prototype.applyRendererDiff=function(a,d){for(var b in a.diff)switch(b){case "visualVariables":if(R.updateFastSymbolUpdatesState(this._fastUpdates,d,this._fastVisualVariableConvertOptions()))c.isSome(this._material)&&this._material.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};t.prototype._defaultElevationInfoNoZ=
function(){return ka};t.prototype._createAs3DShape=function(a,c,d,b,e,f,g,k){var h=this,l=this.getFastUpdateAttrValues(a);a=l?function(a){return R.evaluateModelTransform(h._fastUpdates.materialParameters,l,a)}:null;b=P.createPointGeometry(da,null,b,e,la,null,l);b=[new U(b,g)];g=N.createStageObjectForHUD(this._context,c,b,[d],null,null,f,g,this._context.layer.uid,k,a);if(null===g)return null;var m=new E(this,g.object,b,null,null,H.perObjectElevationAligner,f);m.alignedSampledElevation=g.sampledElevation;
m.needsElevationUpdates=I.needsElevationUpdates2D(f.mode)||"absolute-height"===f.mode;m.getScreenSize=this._createScreenSizeGetter(e,a);m.calculateRelativeScreenBounds=function(a){return d.calculateRelativeScreenBounds(m.getScreenSize(),1,a)};N.extendPointGraphicElevationContext(m,c,this._context.elevationProvider);return m};t.prototype._createAsOverlay=function(a,d,b,e,f,g){var k=this;b.renderPriority=this._renderPriority;var h=v.vec3f64.create();W.pointToVector(d,h,this._context.overlaySR);h[2]=
O.DRAPED_Z;d=this._context.clippingExtent;if(c.isSome(d)&&!w.containsPoint(d,h))return null;var l=this.getFastUpdateAttrValues(a);d=l?function(a){return R.evaluateModelTransform(k._fastUpdates.materialParameters,l,a)}:null;e=P.createPointGeometry(da,h,e,f,null,null,l);e=new ba(e);e.material=b;e.center=h;e.bsRadius=0;e.data.layerUid=g;e.data.graphicUid=a.uid;e.calculateShaderTransformation=d;var m=new J(this,[e],null);m.getScreenSize=this._createScreenSizeGetter(f,d);m.calculateRelativeScreenBounds=
function(a){return b.calculateRelativeScreenBounds(m.getScreenSize(),1,a)};return m};t.prototype._createScreenSizeGetter=function(a,c){var d=this._outlineSize+2;if(this._fastUpdates.enabled){var b=a[0]/this._symbolTextureRatio,e=a[1]/this._symbolTextureRatio;return function(a){void 0===a&&(a=u.vec2f64.create());var f=c(Y);a[0]=f[0]*b+d;a[1]=f[5]*e+d;return a}}var f=a[0]/this._symbolTextureRatio+d,g=a[1]/this._symbolTextureRatio+d;return function(a){void 0===a&&(a=u.vec2f64.create());a[0]=f;a[1]=g;
return a}};t.prototype._fastVisualVariableConvertOptions=function(){var a=this._size[0]>this._size[1]?this._size[0]:this._size[1],c=v.vec3f64.fromValues(a,a,a),d=p.px2pt(1),a=a*d,a=v.vec3f64.fromValues(a,a,a);return{modelSize:c,symbolSize:a,unitInMeters:d,transformation:{anchor:v.vec3f64.ZEROS,scale:v.vec3f64.ONES,rotation:v.vec3f64.ZEROS}}};t.prototype._getGraphicHash=function(a){for(var c="",d=0,b=this._cimRequiredFields;d<b.length;d++)var e=b[d],c=c+(e+a.attributes[e]);return c};t.prototype._forEachMaterial=
function(a){c.isSome(this._material)&&a(this._material);this._cimSymbolMaterials.forEach(a)};t.PRIMITIVE_SIZE=ga;t.elevationModeChangeTypes={definedChanged:I.SymbolUpdateType.UPDATE,staysOnTheGround:I.SymbolUpdateType.NONE,onTheGroundChanged:I.SymbolUpdateType.RECREATE};return t}(L.default);b.Graphics3DIconSymbolLayer=n;var ka={mode:"relative-to-ground",offset:0},la=z.vec4f64.fromValues(0,0,0,1);b.default=n})},"esri/symbols/cim/CIMSymbolRasterizer":function(){define("require exports tslib ../../request ../../core/promiseUtils ../../core/screenUtils ../../core/string ../../geometry/support/jsonUtils ./cimAnalyzer ./cimSymbolUtils ./Rasterizer ./TextRasterizer ./utils ../support/Symbol3DAnchorPosition2D".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r){function t(a){return(a?Object.keys(a):[]).map(function(c){return{name:c,alias:c,type:"string"===typeof a[c]?"esriFieldTypeString":"esriFieldTypeDouble"}})}function u(a){if(!(a&&a.data&&a.data.symbol))return null;switch(a.data.symbol.type){case "CIMPointSymbol":case "CIMTextSymbol":return"esriGeometryPoint";case "CIMLineSymbol":return"esriGeometryPolyline";case "CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function v(a,c,d,b){if("function"===
typeof a.materialHash){var e=a.materialHash;c=e(c,d,b);a=l.analyzeCIMResource(a.cim,a.materialOverrides)}else c=a.materialHash,a=a.cim;return{analyzedCIM:a,hash:c}}Object.defineProperty(b,"__esModule",{value:!0});var z;(function(a){a.Legend="legend";a.Preview="preview"})(z=b.GeometryStyle||(b.GeometryStyle={}));var w=function(a,c,d){if(a&&a.targetSize){var b=void 0;return b=d?a.targetSize/e.pt2px(Math.max(d.frame.xmax-d.frame.xmin,d.frame.ymax-d.frame.ymin)):a.targetSize/c.referenceSize}return a?
a.scaleFactor:1},q={fill:{legend:{frame:{xmax:15,xmin:0,ymax:15,ymin:0},geometry:{rings:[[[0,15],[15,7.5],[15,0],[0,0],[0,15]]]},canvasPaths:{rings:[[[0,15],[0,0],[15,7.5],[15,15],[0,15]]]}},preview:{frame:{xmax:100,xmin:0,ymax:100,ymin:0},geometry:{rings:[[[0,100],[100,100],[100,0],[0,0],[0,100]]]},canvasPaths:{rings:[[[0,100],[0,0],[100,0],[100,100],[0,100]]]}}},stroke:{legend:{frame:{xmax:24,xmin:0,ymax:-2,ymin:2},geometry:{paths:[[[0,0],[12,0],[24,0]]]},canvasPaths:{paths:[[[0,2],[12,2],[24,2]]]}},
preview:{frame:{xmax:100,xmin:0,ymax:-2,ymin:2},geometry:{paths:[[[0,0],[50,0],[100,0]]]},canvasPaths:{paths:[[[0,2],[50,2],[100,2]]]}}}};n=function(){function b(a,d){this._spatialReference=a;this._avoidSDF=d;this._resourceCache=new Map;this._rasterizer=new c.default;this._textRasterizer=new k.default;this._pictureMarkerCache=new Map}b.prototype.rasterizeCIMSymbolAsync=function(c,d,b,e,f,k,h,l){return a.__awaiter(this,void 0,void 0,function(){var m;return a.__generator(this,function(a){switch(a.label){case 0:return e=
e||(d?null!=d.centroid?"esriGeometryPolygon":g.getJsonType(d.geometry):null)||u(c),[4,this.analyzeCIMSymbol(c,d?t(d.attributes):null,b,e,l)];case 1:return m=a.sent(),[2,this.rasterizeCIMSymbol(m,d,e,f,k,h)]}})})};b.prototype.analyzeCIMSymbol=function(c,b,e,f,g){return a.__awaiter(this,void 0,void 0,function(){var k,m,q,r,t,w,u;return a.__generator(this,function(a){switch(a.label){case 0:return[4,d.fetchSymbol(c,g)];case 1:return k=a.sent(),m=[],b?q={geometryType:f,spatialReference:this._spatialReference,
fields:b}:(k=k.clone(),"CIMSymbolReference"===k.data.type&&(k.data.primitiveOverrides=[],q=null)),[4,l.analyzeCIMSymbol(k.data,q,m,this._avoidSDF)];case 2:a.sent();h.throwIfAborted(g);t=0;for(w=m;t<w.length;t++){u=w[t];if("CIMPictureMarker"===u.cim.type||"CIMPictureFill"===u.cim.type||"CIMPictureStroke"===u.cim.type)r||(r=[]),r.push(this.fetchPictureMarkerResource(u,g));e&&"text"===u.type&&"string"===typeof u.text&&-1<u.text.indexOf("[")&&(u.text=p.createLabelOverrideFunction(e,u.text,u.cim.textCase))}return r?
[4,h.all(r)]:[3,4];case 3:a.sent(),a.label=4;case 4:return[2,m]}})})};b.prototype.fetchPictureMarkerResource=function(c,d){return a.__awaiter(this,void 0,void 0,function(){var b,e,f;return a.__generator(this,function(a){switch(a.label){case 0:return b=c.materialHash,this._pictureMarkerCache.get(b)?[3,2]:[4,m(c.cim.url,{responseType:"image",signal:d&&d.signal})];case 1:e=a.sent(),f=e.data,this._pictureMarkerCache.set(b,f),a.label=2;case 2:return[2]}})})};b.prototype.rasterizeCIMSymbol=function(a,c,
d,b,e,f){for(var g=[],k=0;k<a.length;k++){var h=a[k];b&&"function"===typeof b.scaleFactor&&(b.scaleFactor=b.scaleFactor(c,e,f));var l=this._getRasterizedResource(h,c,d,b,e,f);if(l){var m=0,q=l.anchorX||0,r=l.anchorY||0,t=!1,u=0,v=0;if("esriGeometryPoint"===d)if(v=w(b,h,null),u=p.evaluateValueOrFunction(h.offsetX,c,e,f)*v||0,v=p.evaluateValueOrFunction(h.offsetY,c,e,f)*v||0,"marker"===h.type)m=p.evaluateValueOrFunction(h.rotation,c,e,f)||0,t=h.rotateClockwise?h.rotateClockwise:!1;else if("text"===
h.type){m=p.evaluateValueOrFunction(h.angle,c,e,f)||0;if(void 0!==h.horizontalAlignment)switch(h.horizontalAlignment){case "left":q=-.5;break;case "right":q=.5;break;default:q=0}if(void 0!==h.verticalAlignment)switch(h.verticalAlignment){case "top":r=.5;break;case "bottom":r=-.5;break;case "baseline":r=-.25;break;default:r=0}}null!=l&&g.push({angle:m,rotateClockWise:t,anchorX:q,anchorY:r,offsetX:u,offsetY:v,rasterizedResource:l})}}return this.getSymbolImage(g)};b.prototype.getSymbolImage=function(a){for(var c=
document.createElement("canvas"),d=c.getContext("2d"),b=0,f=0,g=0,k=0,h=[],l=0;l<a.length;l++){var m=a[l],p=m.rasterizedResource;if(p){var q=p.size,t=m.offsetX,w=m.offsetY,u=m.anchorX,v=m.anchorY,y=m.rotateClockWise||!1,m=m.angle,z=e.pt2px(t)-q[0]*(.5+u),A=e.pt2px(w)-q[1]*(.5+v),n=z+q[0],T=A+q[1];if(m){y&&(m=-m);var X=Math.sin(m*Math.PI/180),Y=Math.cos(m*Math.PI/180),q=z*Y-A*X,da=z*X+A*Y,fa=z*Y-T*X,ga=z*X+T*Y,ka=n*Y-T*X,T=n*X+T*Y,la=n*Y-A*X,X=n*X+A*Y,z=Math.min(q,fa,ka,la),A=Math.min(da,ga,T,X),n=
Math.max(q,fa,ka,la),T=Math.max(da,ga,T,X)}b=z<b?z:b;f=A<f?A:f;g=n>g?n:g;k=T>k?T:k;z=d.createImageData(p.size[0],p.size[1]);z.data.set(new Uint8ClampedArray(p.image.buffer));p={offsetX:t,offsetY:w,rotateClockwise:y,angle:m,rasterizedImage:z,anchorX:u,anchorY:v};h.push(p)}}c.width=g-b;c.height=k-f;a=-b;for(l=0;l<h.length;l++)p=h[l],b=this._imageDataToCanvas(p.rasterizedImage),f=a-p.rasterizedImage.width*(.5+p.anchorX),g=k-p.rasterizedImage.height*(.5-p.anchorY),p.angle?(t=(360-p.angle)*Math.PI/180,
d.save(),d.translate(e.pt2px(p.offsetX),-e.pt2px(p.offsetY)),d.translate(a,k),d.rotate(t),d.translate(-a,-k),d.drawImage(b,f,g),d.restore()):d.drawImage(b,f+e.pt2px(p.offsetX),g-e.pt2px(p.offsetY));h=new r.default({x:a/c.width-.5,y:k/c.height-.5});return{imageData:0!==c.width&&0!==c.height?d.getImageData(0,0,c.width,c.height):d.createImageData(1,1),anchorPosition:h}};b.prototype._imageDataToCanvas=function(a){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));var c=this._imageDataCanvas,
d=c.getContext("2d");c.width=a.width;c.height=a.height;d.putImageData(a,0,0);return c};b.prototype._imageTo32Array=function(a,c,d){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));var b=this._imageDataCanvas,e=b.getContext("2d");b.width=c;b.height=d;e.drawImage(a,0,0,c,d);return new Uint32Array(e.getImageData(0,0,c,d).data.buffer)};b.prototype._getRasterizedResource=function(a,c,d,b,e,g){var k,h,l;if("esriGeometryPolyline"===d||"esriGeometryPolygon"===d)if(k=b&&b.style?
b.style:z.Legend,k="esriGeometryPolyline"===d?q.stroke[k]:q.fill[k],"line"===a.type)if("CIMSolidStroke"===a.cim.type)a=v(a,c,e,g),h=a.analyzedCIM,l=a.hash,h=this._embedCIMLayerInVectorMarker(h,k);else return"CIMPictureStroke"===a.cim.type?(h=p.evaluateValueOrFunction(a.width,c,e,g),l=b=d=void 0,c=this._getPictureResource(a,h),d=c.image,b=c.width,l=c.height,this._rasterizePictureResource(a,d,b,l,k,h)):null;else if("marker"===a.type)if("CIMPictureMarker"!==a.cim.type&&"CIMVectorMarker"===a.cim.type)a.cim.offsetX=
p.evaluateValueOrFunction(a.offsetX,c,e,g),a.cim.offsetY=p.evaluateValueOrFunction(a.offsetY,c,e,g),a.cim.rotation=p.evaluateValueOrFunction(a.rotation,c,e,g),a.cim.markerPlacement=a.markerPlacement,h=v(a,c,e,g).analyzedCIM,l=f.numericHash(JSON.stringify(h)).toString(),h=this._embedCIMLayerInVectorMarker(h,k);else return null;else{if("text"===a.type)return null;if("fill"===a.type){if("CIMHatchFill"===a.cim.type||"CIMVectorMarker"===a.cim.type||"CIMPictureMarker"===a.cim.type||"CIMPictureFill"===a.cim.type)return h=
a.cim.size||a.cim.height,l=b=d=void 0,"CIMPictureMarker"===a.cim.type||"CIMPictureFill"===a.cim.type?(c=this._getPictureResource(a,h),d=c.image,b=c.width,l=c.height):(c=v(a,c,e,g),h=c.analyzedCIM,l=c.hash,c=this._rasterizer.rasterizeJSONResource(h,this._avoidSDF),d=c.image,b=c.size[0],l=c.size[1]),this._rasterizePictureResource(a,d,b,l,k,null);if("CIMSolidFill"===a.cim.type)a=v(a,c,e,g),h=a.analyzedCIM,l=a.hash,h=this._embedCIMLayerInVectorMarker(h,k);else return null}}else{if("text"===a.type)return k=
this._rasterizeTextResource(a,c,b,e,g);k=v(a,c,e,g);h=k.analyzedCIM;l=k.hash;k=w(b,a,null);if("CIMPictureMarker"===a.cim.type)return h=p.evaluateValueOrFunction(a.size,c,e,g)*k,k=this._getPictureResource(a,h),d=k.image,b=k.width,l=k.height,k={image:d,size:[b,l],sdf:!1,simplePattern:!1,anchorX:a.anchorPoint?a.anchorPoint.x:0,anchorY:a.anchorPoint?a.anchorPoint.y:0};h.size*=k}l+=d;b&&(l+=JSON.stringify(b));a=this._resourceCache;if(a.has(l))return a.get(l);k=this._rasterizer.rasterizeJSONResource(h,
this._avoidSDF);a.set(l,k);return k};b.prototype._rasterizeTextResource=function(a,c,d,b,e){var f=w(d,a,null);d=p.evaluateValueOrFunction(a.text,c,b,e);if(!d||0===d.length)return null;var g=p.evaluateValueOrFunction(a.fontName,c,b,e),k=p.evaluateValueOrFunction(a.style,c,b,e),h=p.evaluateValueOrFunction(a.weight,c,b,e),l=p.evaluateValueOrFunction(a.decoration,c,b,e),f=p.evaluateValueOrFunction(a.size,c,b,e)*f,m=p.evaluateValueOrFunction(a.horizontalAlignment,c,b,e),q=p.evaluateValueOrFunction(a.verticalAlignment,
c,b,e),r=p.colorToArray(p.evaluateValueOrFunction(a.color,c,b,e)),t=p.colorToArray(p.evaluateValueOrFunction(a.outlineColor,c,b,e));a=p.evaluateValueOrFunction(a.outlineSize,c,b,e);return this._textRasterizer.rasterizeText(d,{color:r,size:f,horizontalAlignment:m,verticalAlignment:q,font:{family:g,style:k,weight:h,decoration:l},halo:{size:a||0,color:t,style:k},pixelRatio:1,premultiplyColors:!this._avoidSDF})};b.prototype._rasterizePictureResource=function(a,c,d,b,f,k){var h=document.createElement("canvas"),
l=h.getContext("2d");h.height=e.pt2px(Math.max(Math.abs(f.frame.ymax-f.frame.ymin),k));h.width=e.pt2px(Math.abs(f.frame.xmax-f.frame.xmin));d=l.createImageData(d,b);d.data.set(new Uint8ClampedArray(c.buffer));c=this._imageDataToCanvas(d);c=l.createPattern(c,"repeat");d=Math.cos((-a.cim.rotation||0)*Math.PI/180);b=Math.sin((-a.cim.rotation||0)*Math.PI/180);c.setTransform({m11:d,m12:b,m21:-b,m22:d,m41:e.pt2px(a.cim.offsetX)||0,m42:e.pt2px(a.cim.offsetY)||0});a=f.canvasPaths;var m,p,q;g.isPolygon(a)?
(m=a.rings,l.fillStyle=c,p=l.fill,q=["evenodd"]):g.isPolyline(a)&&(m=a.paths,l.strokeStyle=c,l.lineWidth=k,p=l.stroke,m[0][0][1]=h.height/2,m[0][1][1]=h.height/2);l.beginPath();for(k=0;k<m.length;k++)if(f=(a=m[k])?a.length:0,1<f){c=a[0];l.moveTo(e.pt2px(c[0]),e.pt2px(c[1]));for(d=1;d<f;++d)c=a[d],l.lineTo(e.pt2px(c[0]),e.pt2px(c[1]));l.closePath()}p.apply(l,q);l=l.getImageData(0,0,h.width,h.height);l=new Uint8Array(l.data);return{size:[h.width,h.height],image:new Uint32Array(l.buffer),sdf:!1,simplePattern:!1,
anchorX:0,anchorY:0}};b.prototype._getPictureResource=function(a,c){a=this._pictureMarkerCache.get(a.materialHash);if(!a)return null;var d=a.height/a.width,b=c?1<d?e.pt2px(c):e.pt2px(c)/d:a.width;c=c?1<d?e.pt2px(c)*d:e.pt2px(c):a.height;return{image:this._imageTo32Array(a,b,c),width:b,height:c}};b.prototype._embedCIMLayerInVectorMarker=function(a,c){var d=g.isPolygon(c.geometry)?"CIMPolygonSymbol":"CIMLineSymbol";return{type:"CIMVectorMarker",frame:c.frame,markerGraphics:[{type:"CIMMarkerGraphic",
geometry:c.geometry,symbol:{type:d,symbolLayers:[a]}}]}};return b}();b.CIMSymbolRasterizer=n})},"esri/symbols/cim/Rasterizer":function(){define("require exports ./CIMSymbolHelper ./Rect ./SDFHelper ./utils".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){}b.prototype.dispose=function(){this._rasterizationCanvas=null};b.prototype.rasterizeJSONResource=function(b,e){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));
if("simple-fill"===b.type||"esriSFS"===b.type)return e=a.SymbolHelper.rasterizeSimpleFill(this._rasterizationCanvas,b.style),{size:[e[1],e[2]],image:new Uint32Array(e[0].buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0};if("simple-line"===b.type||"esriSLS"===b.type)return e=a.SymbolHelper.rasterizeSimpleLine(b.style,b.cap),{size:[e[1],e[2]],image:new Uint32Array(e[0].buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0};var d,c;"simple-marker"===b.type||"esriSMS"===b.type||"line-marker"===b.type?
(b=a.CIMSymbolHelper.fromSimpleMarker(b),c=h.getSDFInfo(b)):"CIMHatchFill"===b.type?(b=a.CIMSymbolHelper.fromCIMHatchFill(b),d=new m.default(b.frame.xmin,-b.frame.ymax,b.frame.xmax-b.frame.xmin,b.frame.ymax-b.frame.ymin)):b.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===b.markerPlacement.type?(b=a.CIMSymbolHelper.fromCIMInsidePolygon(b),d=new m.default(b.frame.xmin,-b.frame.ymax,b.frame.xmax-b.frame.xmin,b.frame.ymax-b.frame.ymin)):c=h.getSDFInfo(b);if(c&&!e)return e=h.buildSDF(c),(d=e[0])?
{size:[e[1],e[2]],image:new Uint32Array(d.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null;e=a.CIMSymbolHelper.rasterize(this._rasterizationCanvas,b,d,!e);d=e[0];c=e[3];b=e[4];return d?{size:[e[1],e[2]],image:new Uint32Array(d.buffer),sdf:!1,simplePattern:!1,anchorX:c,anchorY:b}:null};b.prototype.rasterizeImageResource=function(a,b){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));this._rasterizationCanvas.width=a.width;this._rasterizationCanvas.height=
a.height;var d=this._rasterizationCanvas.getContext("2d");a instanceof ImageData?d.putImageData(a,0,0):(a.setAttribute("width",a.width.toString()),a.setAttribute("height",a.height.toString()),d.drawImage(a,0,0,a.width,a.height));d=d.getImageData(0,0,a.width,a.height);d=new Uint8Array(d.data);if(b)for(var c=0;c<b.length;c++){var f=b[c];if(f&&f.oldColor&&4===f.oldColor.length&&f.newColor&&4===f.newColor.length){var g=f.oldColor,h=g[0],l=g[1],m=g[2],g=g[3],v=f.newColor,f=v[0],z=v[1],w=v[2],q=v[3];if(h!==
f||l!==z||m!==w||g!==q)for(v=0;v<d.length;v+=4)h===d[v]&&l===d[v+1]&&m===d[v+2]&&g===d[v+3]&&(d[v]=f,d[v+1]=z,d[v+2]=w,d[v+3]=q)}}for(v=0;v<d.length;v+=4)b=d[v+3]/255,d[v]*=b,d[v+1]*=b,d[v+2]*=b;b=a.width;c=a.height;h=d;if(512<=b||512<=c)h=a.width/a.height,1<h?(b=512,c=Math.round(512/h)):(c=512,b=Math.round(512*h)),h=new Uint8Array(4*b*c),e.resampleHermite(d,a.width,a.height,new Uint8ClampedArray(h.buffer),b,c,!1);return{size:[b,c],image:new Uint32Array(h.buffer),sdf:!1,simplePattern:!1,anchorX:0,
anchorY:0}};return b}();b.default=n})},"esri/symbols/cim/TextRasterizer":function(){define(["require","exports","../../core/screenUtils"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){}b.prototype.rasterizeText=function(a,b){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));var e=this._textRasterizationCanvas,d=e.getContext("2d");this.setFontProperties(d,b);this.parameters=b;this.textLines=a.split(/\r?\n/);
this.lineHeight=this.computeLineHeight();a=this.computeTextWidth(d,b);var c=this.lineHeight*this.textLines.length;e.width=a;e.height=c;this.renderedLineHeight=Math.round(this.lineHeight*b.pixelRatio);this.renderedHaloSize=b.halo.size*b.pixelRatio;this.renderedWidth=a*b.pixelRatio;this.renderedHeight=c*b.pixelRatio;e=b.color;this.fillStyle="rgba("+e.slice(0,3).toString()+","+e[3]+")";this.haloStyle="rgb("+b.halo.color.slice(0,3).toString()+")";var e=this.renderedLineHeight,f=this.renderedHaloSize;
this.setFontProperties(d,b);a=d.textAlign;var c=this.renderedWidth,g=("center"===a?.5*c:"right"===a?c:0)+f,c=a=0;0<f&&this.renderHalo(d,g,f,a,c,b);c+=f;a+=g;f=0;for(g=this.textLines;f<g.length;f++){var h=g[f];d.globalCompositeOperation="destination-out";d.fillStyle="rgb(0, 0, 0)";d.fillText(h,a,c);d.globalCompositeOperation="source-over";d.fillStyle=this.fillStyle;d.fillText(h,a,c);c+=e}d=d.getImageData(0,0,this.renderedWidth,this.renderedHeight);d=new Uint8Array(d.data);if(b.premultiplyColors)for(b=
void 0,e=0;e<d.length;e+=4)b=d[e+3]/255,d[e]*=b,d[e+1]*=b,d[e+2]*=b;return{size:[this.renderedWidth,this.renderedHeight],image:new Uint32Array(d.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}};b.prototype.renderHalo=function(a,b,e,d,c,k){var f=this.renderedWidth,g=this.renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas"));this._haloRasterizationCanvas.width=f;this._haloRasterizationCanvas.height=g;var h=this._haloRasterizationCanvas,l=
h.getContext("2d");l.clearRect(0,0,f,g);this.setFontProperties(l,k);l.fillStyle=this.haloStyle;l.strokeStyle=this.haloStyle;k=3>this.renderedHaloSize;l.lineJoin=k?"miter":"round";k?this.renderHaloEmulated(l,b,e):this.renderHaloNative(l,b,e);a.globalAlpha=this.parameters.halo.color[3];a.drawImage(h,0,0,f,g,d,c,f,g);a.globalAlpha=1};b.prototype.renderHaloEmulated=function(a,b,e){for(var d=this.renderedLineHeight,c=this.renderedHaloSize,f=0,g=this.textLines;f<g.length;f++){for(var h=g[f],l=0,u=m;l<u.length;l++){var v=
u[l];a.fillText(h,b+c*v[0],e+c*v[1])}e+=d}};b.prototype.renderHaloNative=function(a,b,e){for(var d=this.renderedLineHeight,c=this.renderedHaloSize,f=0,g=this.textLines;f<g.length;f++){for(var h=g[f],l=2*c,m=0;5>m;m++)a.lineWidth=(.6+.1*m)*l,a.strokeText(h,b,e);e+=d}};b.prototype.setFontProperties=function(b,e){var f=e.font;e=f.style+" "+f.weight+" "+a.pt2px(e.size*e.pixelRatio)+"px "+f.family+", sans-serif";b.font=e;b.textAlign="left";b.textBaseline="top"};b.prototype.computeTextWidth=function(a,
b){for(var e=0,d=0,c=this.textLines;d<c.length;d++)e=Math.max(e,a.measureText(c[d]).width);b=b.font;if("italic"===b.style||"oblique"===b.style||"string"===typeof b.weight&&("bold"===b.weight||"bolder"===b.weight)||"number"===typeof b.weight&&600<b.weight)e+=.3*a.measureText("A").width;e+=2*this.parameters.halo.size;return Math.round(e)};b.prototype.computeLineHeight=function(){return Math.round(1.275*this.parameters.size+2*this.parameters.halo.size)};return b}();b.TextRasterizer=n;for(var m=[],h=
0;360>h;h+=22.5)m.push([Math.cos(Math.PI*h/180),Math.sin(Math.PI*h/180)]);b.default=n})},"esri/symbols/support/utils":function(){define("require exports tslib ../../Color ../../symbols ../../core/asyncUtils ../../core/compilerUtils ../../core/has ../../core/maybe ../../core/screenUtils ../../core/libs/gl-matrix-2/vec3f64 ./gfxUtils ./Symbol3DMaterial @dojo/framework/shim/Promise".split(" "),function(n,b,a,m,h,e,f,g,l,d,c,k,p){function r(a,c){if(null==c)return a;a=a.toRgba();a[3]*=c;return new m(a)}
function t(a,c,b){if(a=a.symbolLayers){var d=function(a){a=l.isSome(a)?a:null;c=c||a||null!=b&&C;return r(c,b)};a.forEach(function(a){if("object"!==a.type||null==a.resource.href||c)if("water"===a.type)a.color=d(a.color);else{var e=l.isSome(a.material)?a.material.color:null,e=d(e);l.isNone(a.material)?a.material=new p.default({color:e}):a.material.color=e;null!=b&&"outline"in a&&l.isSome(a.outline)&&l.isSome(a.outline.color)&&(a.outline.color=r(a.outline.color,b))}})}}function u(c,b){return a.__awaiter(this,
void 0,void 0,function(){var d,f=this;return a.__generator(this,function(g){switch(g.label){case 0:return(d=c.symbolLayers)?[4,e.forEach(d,function(c){return a.__awaiter(f,void 0,void 0,function(){return a.__generator(this,function(a){return[2,v(c,b)]})})})]:[2];case 1:return g.sent(),[2]}})})}function v(b,d){return a.__awaiter(this,void 0,void 0,function(){var e;return a.__generator(this,function(a){switch(a.label){case 0:e=b.type;switch(e){case "extrude":return[3,1];case "icon":return[3,2];case "line":return[3,
2];case "text":return[3,2];case "path":return[3,3];case "object":return[3,4];case "fill":return[3,6];case "water":return[3,6]}return[3,7];case 1:return b.size="number"===typeof d[2]?d[2]:0,[3,8];case 2:return a=z(d),l.isSome(a)&&(b.size=a),[3,8];case 3:return a=q(d,c.vec3f64.ONES,[b.width,void 0,b.height]),b.width=A(d[0],b.width,1,a),b.height=A(d[2],b.height,1,a),[3,8];case 4:return[4,w(b,d)];case 5:return a.sent(),[3,8];case 6:return[3,8];case 7:f.neverReached(b),a.label=8;case 8:return[2]}})})}
function z(a){for(var c=0;c<a.length;c++){var b=a[c];if("number"===typeof b)return b}return null}function w(c,b){return a.__awaiter(this,void 0,void 0,function(){var d,e,f,g;return a.__generator(this,function(a){switch(a.label){case 0:return[4,y(c)];case 1:return d=a.sent(),e=d.resourceSize,f=d.symbolSize,g=q(b,e,f),c.width=A(b[0],f[0],e[0],g),c.depth=A(b[1],f[1],e[1],g),c.height=A(b[2],f[2],e[2],g),[2]}})})}function q(a,c,b){for(var d=0;3>d;d++){var e=a[d];switch(e){case "symbol-value":return null!=
b[d]?b[d]/c[d]:1;case "proportional":break;default:if(e&&c[d])return e/c[d]}}return 1}function y(c){return a.__awaiter(this,void 0,void 0,function(){var b,d,e,f,g,k,h,l;return a.__generator(this,function(a){switch(a.label){case 0:return[4,new Promise(function(a,c){n(["./symbolLayerUtils"],a,c)})];case 1:return b=a.sent(),[4,b.computeObjectLayerResourceSize(c,10)];case 2:d=a.sent();e=c.width;f=c.height;g=c.depth;k=[e,g,f];h=1;for(l=0;3>l;l++)if(null!=k[l]){h=k[l]/d[l];break}for(l=0;3>l;l++)null==k[l]&&
(k[l]=d[l]*h);return[2,{resourceSize:d,symbolSize:k}]}})})}function A(a,c,b,d){switch(a){case "proportional":return b*d;case "symbol-value":return null!=c?c:b;default:return a}}Object.defineProperty(b,"__esModule",{value:!0});var B=/\/resource\/(.*?)\.svg$/,C=new m("white");b.getSymbolOutlineSize=function(a){if(!a)return 0;if(h.isSymbol3D(a)){var c=a.symbolLayers&&a.symbolLayers.length;c?(a=a.symbolLayers.getItemAt(c-1),a="outline"in a?l.get(a,"outline","size"):void 0):a=void 0;return l.isSome(a)?
a:0}return(a=k.getStroke(a))&&d.px2pt(a.width)||0};b.isVolumetricSymbol=function(a){if(!a||!a.symbolLayers)return!1;switch(a.type){case "point-3d":return a.symbolLayers.some(function(a){return"object"===a.type});case "line-3d":return a.symbolLayers.some(function(a){return"path"===a.type});case "polygon-3d":return a.symbolLayers.some(function(a){return"object"===a.type||"extrude"===a.type});default:return!1}};b.getIconHref=function(a,c){c=c.resource.href;return!g("esri-canvas-svg-support")&&a.styleOrigin&&
B.test(c)?c.replace(B,"/resource/png/$1.png"):c};b.applyOpacityToColor=r;b.applyColorToSymbol=function(a,c,b){if(a&&(c||null!=b))if(c&&(c=new m(c)),h.isSymbol3D(a))t(a,c,b);else if(h.isSymbol2D(a)){if(c=c||a.color)a.color=r(c,b);null!=b&&"outline"in a&&a.outline&&a.outline.color&&(a.outline.color=r(a.outline.color,b))}};b.applySizesToSymbol=function(c,b){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){if(!c||!b)return[2];if(h.isSymbol3D(c))return[2,u(c,b)];if(h.isSymbol2D(c)&&
(a=z(b),!l.isNone(a)))switch(c.type){case "simple-marker":c.size=a;break;case "picture-marker":var d=c.width/c.height;1<d?(c.width=a,c.height=a*d):(c.width=a*d,c.height=a);break;case "simple-line":c.width=a;break;case "text":c.font.size=a;break;case "simple-fill":case "picture-fill":break;case "cim":break;default:f.neverReached(c)}return[2]})})};b.applyRotationToSymbol=function(a,c,b){a&&null!=c&&(h.isSymbol3D(a)?(a=a.symbolLayers)&&a.forEach(function(a){if(a&&"object"===a.type)switch(b){case "tilt":a.tilt=
c;break;case "roll":a.roll=c;break;default:a.heading=c}}):!h.isSymbol2D(a)||"simple-marker"!==a.type&&"picture-marker"!==a.type&&"text"!==a.type||(a.angle=c))}})},"esri/symbols/support/gfxUtils":function(){define("require exports ../../assets ../../Color ../../request ../../core/ItemCache ../../core/promiseUtils ../../core/screenUtils ./cimSymbolUtils".split(" "),function(n,b,a,m,h,e,f,g,l){function d(a){if(!a)return null;var c;switch(a.type){case "simple-fill":case "picture-fill":case "simple-marker":c=
d(a.outline);break;case "simple-line":var b=g.pt2px(a.width);"none"!==a.style&&0!==b&&(c={color:a.color,style:t(a.style),width:b,cap:a.cap,join:"miter"===a.join?g.pt2px(a.miterLimit):a.join});break;default:c=null}return c}Object.defineProperty(b,"__esModule",{value:!0});var c=a.getAssetUrl("../../symbols/patterns/"),k={left:"start",center:"middle",right:"end",justify:"start"},p={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},r=new e(1E3);b.getSVGAlign=function(a){return a=
(a=a.horizontalAlignment)&&k[a.toLowerCase()]||"middle"};b.getSVGBaseline=function(a){return(a=a.verticalAlignment)&&p[a.toLowerCase()]||"alphabetic"};b.getSVGBaselineShift=function(a){return"bottom"===a.verticalAlignment?"super":null};b.getFill=function(a){var b=a.style,d=null;if(a)switch(a.type){case "simple-marker":"cross"!==b&&"x"!==b&&(d=a.color);break;case "simple-fill":"solid"===b?d=a.color:"none"!==b&&(d={type:"pattern",x:0,y:0,src:c+b+".png",width:8,height:8});break;case "picture-fill":d=
{type:"pattern",src:a.url,width:g.pt2px(a.width)*a.xscale,height:g.pt2px(a.height)*a.yscale,x:g.pt2px(a.xoffset),y:g.pt2px(a.yoffset)};break;case "text":d=a.color;break;case "cim":d=l.getCIMSymbolColor(a)}return d};b.getPatternUrlWithColor=function(a,c){var b=a+"-"+c;return void 0!==r.get(b)?f.resolve(r.get(b)):h(a,{responseType:"image"}).then(function(a){a=a.data;var d=a.naturalWidth,e=a.naturalHeight,f=document.createElement("canvas");f.width=d;f.height=e;var g=f.getContext("2d");g.fillStyle=c;
g.fillRect(0,0,d,e);g.globalCompositeOperation="destination-in";g.drawImage(a,0,0);a=f.toDataURL();r.put(b,a);return a})};b.getStroke=d;var t=function(){var a={};return function(c){if(a[c])return a[c];var b=c.replace(/-/g,"");return a[c]=b}}();b.defaultThematicColor=new m([128,128,128])})},"esri/core/ItemCache":function(){define(["require","exports","./MemCache"],function(n,b,a){return function(){function b(b,e){this._storage=new a.MemCacheStorage;this._storage.maxSize=b;e&&this._storage.registerRemoveFunc("",
e)}b.prototype.put=function(a,b){this._storage.put(a,b,1,1)};b.prototype.pop=function(a){return this._storage.pop(a)};b.prototype.get=function(a){return this._storage.get(a)};b.prototype.clear=function(){this._storage.clearAll()};b.prototype.destroy=function(){this._storage.clearAll()};return b}()})},"esri/symbols/support/cimSymbolUtils":function(){define(["require","exports","../../Color","../cim/utils"],function(n,b,a,m){function h(a){var c=m.toCIMSymbolJSON(a);if("CIMTextSymbol"===c.type)return c.height;
a=0;if(c.symbolLayers)for(var b=0,c=c.symbolLayers;b<c.length;b++){var d=c[b];m.isCIMMarker(d)&&d.size>a?a=d.size:m.isCIMStroke(d)&&d.width>a?a=d.width:m.isCIMFill(d)}return a}function e(a,c,b){if("CIMTextSymbol"===a.type)a.height*=c;else{if(b&&a.effects){b=0;for(var d=a.effects;b<d.length;b++)g(d[b],c)}if(a.symbolLayers)for(b=0,a=a.symbolLayers;b<a.length;b++)switch(d=a[b],d.type){case "CIMPictureMarker":case "CIMVectorMarker":d.markerPlacement&&f(d.markerPlacement,c);d.offsetX*=c;d.offsetY*=c;d.anchorPoint&&
"Absolute"===d.anchorPointUnits&&(d.anchorPoint={x:d.anchorPoint.x*c,y:d.anchorPoint.y*c});d.size*=c;if("CIMVectorMarker"===d.type&&d.markerGraphics)for(var k=0,h=d.markerGraphics;k<h.length;k++){var l=h[k];d.scaleSymbolsProportionally||e(l.symbol,c,!0)}break;case "CIMPictureStroke":case "CIMSolidStroke":d.width*=c;break;case "CIMPictureFill":d.height*=c;d.offsetX*=c;d.offsetY*=c;break;case "CIMHatchFill":e(d.lineSymbol,c,!0),d.offsetX*=c,d.offsetY*=c,d.separation*=c}}}function f(a,c){m.isCIMMarkerStrokePlacement(a)&&
(a.offset*=c);switch(a.type){case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineSameSize":a.customEndingOffset*=c;a.offsetAlongLine*=c;if(a.placementTemplate&&a.placementTemplate.length){var b=a.placementTemplate.map(function(a){return a*c});a.placementTemplate=b}break;case "CIMMarkerPlacementAlongLineVariableSize":a.maxRandomOffset*=c;a.placementTemplate&&a.placementTemplate.length&&(b=a.placementTemplate.map(function(a){return a*c}),a.placementTemplate=b);break;case "CIMMarkerPlacementOnLine":a.startPointOffset*=
c;break;case "CIMMarkerPlacementAtExtremities":a.offsetAlongLine*=c;break;case "CIMMarkerPlacementAtRatioPositions":a.beginPosition*=c;a.endPosition*=c;break;case "CIMMarkerPlacementPolygonCenter":a.offsetX*=c;a.offsetY*=c;break;case "CIMMarkerPlacementInsidePolygon":a.offsetX*=c,a.offsetY*=c,a.stepX*=c,a.stepY*=c}}function g(a,c){switch(a.type){case "CIMGeometricEffectArrow":case "CIMGeometricEffectDonut":a.width*=c;break;case "CIMGeometricEffectBuffer":a.size*=c;break;case "CIMGeometricEffectCut":a.beginCut*=
c;a.endCut*=c;a.middleCut*=c;break;case "CIMGeometricEffectDashes":a.customEndingOffset*=c;a.offsetAlongLine*=c;if(a.dashTemplate&&a.dashTemplate.length){var b=a.dashTemplate.map(function(a){return a*c});a.dashTemplate=b}break;case "CIMGeometricEffectExtension":case "CIMGeometricEffectJog":case "CIMGeometricEffectRadial":a.length*=c;break;case "CIMGeometricEffectMove":a.offsetX*=c;a.offsetY*=c;break;case "CIMGeometricEffectOffset":case "CIMGeometricEffectOffsetTangent":a.offset*=c;break;case "CIMGeometricEffectRegularPolygon":a.radius*=
c;break;case "CIMGeometricEffectTaperedPolygon":a.fromWidth*=c;a.length*=c;a.toWidth*=c;break;case "CIMGeometricEffectWave":a.amplitude*=c,a.period*=c}}function l(a,c){var b;b="CIMTextSymbol"===a.type?a.symbol:a;a="CIMPolygonSymbol"===a.type;if(b.symbolLayers){var e=0;for(b=b.symbolLayers;e<b.length;e++){var f=b[e];if(!(f.colorLocked||a&&(m.isCIMStroke(f)||m.isCIMMarker(f)&&f.markerPlacement&&m.isCIMMarkerStrokePlacement(f.markerPlacement))))switch(f.type){case "CIMVectorMarker":f.markerGraphics.forEach(function(a){l(a.symbol,
c)});break;case "CIMSolidStroke":case "CIMSolidFill":d(c,f.color);break;case "CIMHatchFill":l(f.lineSymbol,c)}}}}function d(a,c){for(var b=0;b<a.length;b++)if(a[b].join(".")===c.join("."))return;a.push(c)}function c(a,b){var d;d="CIMTextSymbol"===a.type?a.symbol:a;a="CIMPolygonSymbol"===a.type?!0:!1;if(d.symbolLayers){var e=0;for(d=d.symbolLayers;e<d.length;e++){var f=d[e];if(!(f.colorLocked||a&&(m.isCIMStroke(f)||m.isCIMMarker(f)&&f.markerPlacement&&m.isCIMMarkerStrokePlacement(f.markerPlacement)))){var g=
b.toArray(0);switch(f.type){case "CIMVectorMarker":f.markerGraphics.forEach(function(a){c(a.symbol,b)});break;case "CIMSolidStroke":case "CIMSolidFill":f.color=g;break;case "CIMHatchFill":c(f.lineSymbol,b)}}}}}Object.defineProperty(b,"__esModule",{value:!0});b.getCIMSymbolSize=h;b.scaleCIMSymbolTo=function(a,c){var b=m.toCIMSymbolJSON(a);a=h(a);if(0===a)if("CIMTextSymbol"===b.type)b.height=c;else{if(b.symbolLayers)for(a=0,b=b.symbolLayers;a<b.length;a++){var d=b[a];switch(d.type){case "CIMPictureMarker":case "CIMVectorMarker":d.size=
c;break;case "CIMPictureStroke":case "CIMSolidStroke":d.width=c}}}else e(b,c/a,!1)};b.getCIMSymbolColor=function(c){c=m.toCIMSymbolJSON(c);var b=[];l(c,b);return b.length?new a(m.fromCIMColor(b[0])):null};b.applyCIMSymbolColor=function(b,d){d instanceof a||(d=new a(d));b=m.toCIMSymbolJSON(b);c(b,d)};b.getCIMSymbolRotation=function(a){a=m.toCIMSymbolJSON(a);return"CIMTextSymbol"===a.type||"CIMPointSymbol"===a.type?a.angle||0:0};b.applyCIMSymbolRotation=function(a,c){a=m.toCIMSymbolJSON(a);if("CIMTextSymbol"===
a.type)a.angle=c;else if("CIMPointSymbol"===a.type&&a.symbolLayers)for(var b=c-(a.angle||0),d=0,e=a.symbolLayers;d<e.length;d++){var f=e[d];if(m.isCIMMarker(f)){var g=f.rotation||0,g=f.rotateClockwise?g-b:g+b;f.rotation=g}a.angle=c}}})},"esri/views/3d/layers/graphics/constants":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec4f64"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.defaultIconElevationOffset=1;b.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2;b.TRANSPARENT_UNIT=
a.vec4f64.ZEROS;b.WHITE_UNIT=a.vec4f64.ONES})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("require exports tslib ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils".split(" "),function(n,b,a,m,h,e,f,g){n=function(){function b(a,c,b){this.graphics3DSymbolLayer=a;this.renderGeometries=c;this.boundingBox=b;this.type="draped";this.stage=
null;this._addedToStage=this._visible=!1;this._layerView=null;this.isElevationSource=!1}b.prototype.initialize=function(a,c,b){this.stage=a;this._layerView=b;this._overlayRenderer=this._layerView.view.basemapTerrain.overlayManager.renderer};b.prototype.setVisibility=function(a){if(null!=this.stage){if(this._visible!==a){if((this._visible=a)&&!this._addedToStage)return this._addedToStage=!0,this._overlayRenderer.addGeometries(this.renderGeometries,this._layerView,0),!0;if(!a&&!this._addedToStage)return!1;
a=0;for(var c=this.renderGeometries;a<c.length;a++)c[a].instanceParameters.visible=this._visible;this._overlayRenderer.updateGeometries(this.renderGeometries,this._layerView,1);return!0}return!1}};b.prototype.destroy=function(){this.stage&&this._addedToStage&&this._overlayRenderer.removeGeometries(this.renderGeometries,this._layerView,1);this._visible=this._addedToStage=!1;this.stage=null};b.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(a,c){return Math.max(a,c.bsRadius)},
0)};b.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=h.vec3f64.create());return m.vec3.set(a,0,0,0)};b.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=e.create());return e.empty(a)};b.prototype.addObjectState=function(a,c){var b=this;0===a&&(this.renderGeometries.forEach(function(a){var d=a.addHighlight();c.addRenderGeometry(a,d,b)}),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView))};b.prototype.removeObjectState=function(a){this.renderGeometries.forEach(function(c){a.removeRenderGeometry(c)})};
b.prototype.removeRenderGeometryObjectState=function(a,c){a.removeHighlight(c);this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView)};b.prototype.computeAttachmentOrigin=function(a){for(var b=0,d=this.renderGeometries;b<d.length;b++)d[b].computeAttachmentOrigin(c)&&(a.draped.origin[0]+=c[0],a.draped.origin[1]+=c[1],a.draped.num++)};b.prototype.getProjectedBoundingBox=function(b,d,f,k,h){return a.__awaiter(this,void 0,void 0,function(){var m,p,q,r;return a.__generator(this,
function(a){switch(a.label){case 0:e.empty(h);for(m=0;m<this.renderGeometries.length;m++)p=this.renderGeometries[m],this._getRenderGeometryProjectedBoundingRect(p,b,l,f),e.expand(h,l);if(!d)return[3,5];e.center(h,c);q=void 0;r=g.demResolutionForBoundingBox(h,d);a.label=1;case 1:return a.trys.push([1,3,,4]),[4,d.service.queryElevation(c[0],c[1],k,r)];case 2:return q=a.sent(),[3,4];case 3:return a.sent(),q=null,[3,4];case 4:null!=q&&(h[2]=Math.min(h[2],q),h[5]=Math.max(h[5],q)),a.label=5;case 5:return[2,
h]}})})};b.prototype._getRenderGeometryProjectedBoundingRect=function(a,c,b,f){if(this.boundingBox)e.set(d,this.boundingBox);else{var g=a.center;a=a.bsRadius;d[0]=g[0]-a;d[1]=g[1]-a;d[2]=g[2]-a;d[3]=g[0]+a;d[4]=g[1]+a;d[5]=g[2]+a}c(d,0,2);this.calculateRelativeScreenBounds&&f.push({location:e.center(d),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return e.toRect(d,b)};return b}();var l=f.create(),d=e.create(),c=h.vec3f64.create();return n})},"esri/views/3d/layers/graphics/sdfPrimitives":function(){define(["require",
"exports","../../../../core/compilerUtils","../../webgl-engine/lib/Util"],function(n,b,a,m){function h(a,c){var b=new Uint8Array(4*a*a),d=a/2-.5;c/=2;for(var e=0;e<a;e++)for(var f=0;f<a;f++){var g=f+a*e,k=f-d,h=e-d,k=Math.sqrt(k*k+h*h)-c,k=k/a+.5;m.packFloatRGBA(k,b,4*g)}return b}function e(a,b){return c(a,b,!1)}function f(a,b){return c(a,b,!0)}function g(a,c){return k(a,c,!1)}function l(a,c){return k(a,c,!0)}function d(a,c){for(var b=new Uint8Array(4*a*a),d=Math.sqrt(1.25),e=(a-c)/2,f=0;f<a;f++)for(var g=
0;g<a;g++){var k=(g-e)/c,h=(f-e+.75)/c;m.packFloatRGBA(Math.max(-(1*k+-.5*h)/d,(1*(k-1)+-.5*-h)/d,-h)*c/a+.5,b,4*(f*a+g))}return b}function c(a,c,b){b&&(c/=Math.SQRT2);for(var d=new Uint8Array(4*a*a),e=0;e<a;e++)for(var f=0;f<a;f++){var g=f-.5*a+.25,k=-e+.5*a-.75,h=e*a+f;if(b)var l=(g+k)/Math.SQRT2,k=(k-g)/Math.SQRT2,g=l;g=Math.max(Math.abs(g),Math.abs(k))-.5*c;g=g/a+.5;m.packFloatRGBA(g,d,4*h)}return d}function k(a,c,b){b&&(c*=Math.SQRT2);c*=.5;for(var d=new Uint8Array(4*a*a),e=0;e<a;e++)for(var f=
0;f<a;f++){var g=f-.5*a,k=-e+.5*a-1,h=e*a+f;if(b)var l=(g+k)/Math.SQRT2,k=(k-g)/Math.SQRT2,g=l;l=void 0;g=Math.abs(g);k=Math.abs(k);l=g>k?g>c?Math.sqrt((g-c)*(g-c)+k*k):k:k>c?Math.sqrt(g*g+(k-c)*(k-c)):g;l=l/a+.5;m.packFloatRGBA(l,d,4*h)}return d}Object.defineProperty(b,"__esModule",{value:!0});b.createType=function(c,b,k){switch(c){case "circle":return h(b,k);case "square":return e(b,k);case "cross":return g(b,k);case "x":return l(b,k);case "kite":return f(b,k);case "triangle":return d(b,k);default:return a.neverReached(c),
h(b,k)}};b.createCircle=h;b.createSquare=e;b.createKite=f;b.createCross=g;b.createX=l;b.createTriangle=d})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("require exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../renderers/support/utils ../../support/debugFlags".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k){function p(a){return null!==a&&void 0!==a}function r(a){return"number"===typeof a}function t(a){return"string"===typeof a}function u(a,c){a&&a.push(c)}function v(a,b,d,e,f){var g=a.minSize,k=a.maxSize;if(a.expression)return u(f,"Could not convert size info: expression not supported"),!1;if(a.useSymbolValue)return a=e.symbolSize[d],b.minSize[d]=a,b.maxSize[d]=a,b.offset[d]=b.minSize[d],b.factor[d]=0,b.type[d]=1,!0;if(p(a.field)){if(p(a.stops)){if(2===a.stops.length&&
r(a.stops[0].size)&&r(a.stops[1].size))return z(a.stops[0].size,a.stops[1].size,a.stops[0].value,a.stops[1].value,b,d),b.type[d]=1,!0;u(f,"Could not convert size info: stops only supported with 2 elements");return!1}if(r(g)&&r(k)&&p(a.minDataValue)&&p(a.maxDataValue))return z(g,k,a.minDataValue,a.maxDataValue,b,d),b.type[d]=1,!0;if(null!=c.meterIn[a.valueUnit])return b.minSize[d]=-Infinity,b.maxSize[d]=Infinity,b.offset[d]=0,b.factor[d]=1/c.meterIn[a.valueUnit],b.type[d]=1,!0;if("unknown"===a.valueUnit)return u(f,
"Could not convert size info: proportional size not supported"),!1;u(f,"Could not convert size info: scale-dependent size not supported");return!1}if(!p(a.field)){if(a.stops&&a.stops[0]&&r(a.stops[0].size))return b.minSize[d]=a.stops[0].size,b.maxSize[d]=a.stops[0].size,b.offset[d]=b.minSize[d],b.factor[d]=0,b.type[d]=1,!0;if(r(g))return b.minSize[d]=g,b.maxSize[d]=g,b.offset[d]=g,b.factor[d]=0,b.type[d]=1,!0}u(f,"Could not convert size info: unsupported variant of sizeInfo");return!1}function z(a,
c,b,d,e,f){d=0<Math.abs(d-b)?(c-a)/(d-b):0;e.minSize[f]=0<d?a:c;e.maxSize[f]=0<d?c:a;e.offset[f]=a-b*d;e.factor[f]=d}function w(a,c,b,d){if(a.normalizationField||a.valueRepresentation)return u(d,"Could not convert size info: unsupported property"),null;var e=a.field;if(null!=e&&!t(e))return u(d,"Could not convert size info: field is not a string"),null;if(!c.size)c.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(a.field)if(!c.size.field)c.size.field=
a.field;else if(a.field!==c.size.field)return u(d,"Could not convert size info: multiple fields in use"),null;switch(a.axis){case "width":return(e=v(a,c.size,0,b,d))?c:null;case "height":return(e=v(a,c.size,2,b,d))?c:null;case "depth":return(e=v(a,c.size,1,b,d))?c:null;case "width-and-depth":return(e=v(a,c.size,0,b,d))&&v(a,c.size,1,b,d),e?c:null;case null:case void 0:case "all":return(e=(e=(e=v(a,c.size,0,b,d))&&v(a,c.size,1,b,d))&&v(a,c.size,2,b,d))?c:null;default:return u(d,'Could not convert size info: unknown axis "'+
a.axis+'""'),null}}function q(a,c,b){for(var d=0;3>d;++d){var e=c.unitInMeters;1===a.type[d]&&(e*=c.modelSize[d],a.type[d]=2);a.minSize[d]/=e;a.maxSize[d]/=e;a.offset[d]/=e;a.factor[d]/=e}if(0!==a.type[0])c=0;else if(0!==a.type[1])c=1;else if(0!==a.type[2])c=2;else return u(b,"No size axis contains a valid size or scale"),!1;for(d=0;3>d;++d)0===a.type[d]&&(a.minSize[d]=a.minSize[c],a.maxSize[d]=a.maxSize[c],a.offset[d]=a.offset[c],a.factor[d]=a.factor[c],a.type[d]=a.type[c]);return!0}function y(a,
c,b){a[4*c+0]=b.r/255;a[4*c+1]=b.g/255;a[4*c+2]=b.b/255;a[4*c+3]=b.a}function A(a,c,b){if(a.normalizationField)return u(b,"Could not convert color info: unsupported property"),null;if(t(a.field))if(a.stops){if(8<a.stops.length)return u(b,"Could not convert color info: too many color stops"),null;c.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};b=a.stops;for(a=0;8>a;++a){var d=b[Math.min(a,b.length-1)];c.color.values[a]=d.value;
y(c.color.colors,a,d.color)}}else return u(b,"Could not convert color info: missing stops or colors"),null;else if(a.stops&&0<=a.stops.length)for(b=a.stops&&0<=a.stops.length&&a.stops[0].color,c.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},a=0;8>a;a++)c.color.values[a]=Infinity,y(c.color.colors,a,b);else return u(b,"Could not convert color info: no field and no colors/stops"),null;return c}function B(a,c,b){if(a.normalizationField)return u(b,
"Could not convert opacity info: unsupported property"),null;if(t(a.field))if(a.stops){if(8<a.stops.length)return u(b,"Could not convert opacity info: too many opacity stops"),null;c.opacity={field:a.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};b=a.stops;for(a=0;8>a;++a){var d=b[Math.min(a,b.length-1)];c.opacity.values[a]=d.value;c.opacity.opacityValues[a]=d.opacity}}else return u(b,"Could not convert opacity info: missing stops or opacities"),null;else if(a.stops&&0<=a.stops.length)for(b=
a.stops&&0<=a.stops.length&&a.stops[0].opacity,c.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},a=0;8>a;a++)c.opacity.values[a]=Infinity,c.opacity.opacityValues[a]=b;else return u(b,"Could not convert opacity info: no field and no opacities/stops"),null;return c}function C(a,c,b){a=2===b&&"arithmetic"===a.rotationType;c.offset[b]=a?90:0;c.factor[b]=a?-1:1;c.type[b]=1}function F(a,c,b){if(!t(a.field))return u(b,"Could not convert rotation info: field is not a string"),
null;if(!c.rotation)c.rotation={field:a.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(a.field)if(!c.rotation.field)c.rotation.field=a.field;else if(a.field!==c.rotation.field)return u(b,"Could not convert rotation info: multiple fields in use"),null;switch(a.axis){case "tilt":return C(a,c.rotation,0),c;case "roll":return C(a,c.rotation,1),c;case null:case void 0:case "heading":return C(a,c.rotation,2),c;default:return u(b,'Could not convert rotation info: unknown axis "'+a.axis+'""'),
null}}function H(c,b,d){if(!c)return null;var e=!b.supportedTypes||!!b.supportedTypes.size,f=!b.supportedTypes||!!b.supportedTypes.color,g=!b.supportedTypes||!!b.supportedTypes.rotation,k=!!b.supportedTypes&&!!b.supportedTypes.opacity,h=c.reduce(function(c,h){if(!c)return c;if(h.valueExpression)return u(d,"Could not convert visual variables: arcade expressions not supported"),null;switch(h.type){case "size":return e?w(h,c,b,d):c;case "color":return f?A(h,c,d):c;case "opacity":return k?B(h,c,d):null;
case "rotation":return g?F(h,c,d):c;default:return a.neverReached(h),null}},{size:null,color:null,opacity:null,rotation:null});return 0<c.length&&h&&!h.size&&!h.color&&!h.opacity&&!h.rotation||h&&h.size&&!q(h.size,b,d)?null:h}function I(a,c,b){if(!!a!==!!c||a&&a.field!==c.field)return!1;if(a&&"rotation"===b)for(b=0;3>b;b++)if(a.type[b]!==c.type[b]||a.offset[b]!==c.offset[b]||a.factor[b]!==c.factor[b])return!1;return!0}function G(a,c){var b={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,
vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},d=a&&null!=a.size;a&&a.size?(b.vvSizeEnabled=!0,b.vvSizeMinSize=a.size.minSize,b.vvSizeMaxSize=a.size.maxSize,b.vvSizeOffset=a.size.offset,b.vvSizeFactor=a.size.factor):a&&d&&(b.vvSizeValue=c.transformation.scale);if(a&&d){b.vvSymbolAnchor=c.transformation.anchor;b.vvSymbolRotationMatrix=e.mat3f64.create();
f.mat4.identity(E);var k=c.transformation.rotation[2],d=c.transformation.rotation[0],l=c.transformation.rotation[1];c=E;void 0===c&&(c=g.mat4f64.create());k=k||0;d=d||0;l=l||0;0!==k&&f.mat4.rotateZ(c,c,-k/180*Math.PI);0!==d&&f.mat4.rotateX(c,c,d/180*Math.PI);0!==l&&f.mat4.rotateY(c,c,l/180*Math.PI);h.mat3.fromMat4(b.vvSymbolRotationMatrix,E)}a&&a.color&&(b.vvColorEnabled=!0,b.vvColorValues=a.color.values,b.vvColorColors=a.color.colors);a&&a.opacity&&(b.vvOpacityEnabled=!0,b.vvOpacityValues=a.opacity.values,
b.vvOpacityOpacities=a.opacity.opacityValues);return b}Object.defineProperty(b,"__esModule",{value:!0});b.convertVisualVariables=H;b.initFastSymbolUpdatesState=function(a,c){return!a||k.DISABLE_FAST_UPDATES?{enabled:!1}:(a=H(a.visualVariables,c))?{enabled:!0,visualVariables:a,materialParameters:G(a,c),requiresShaderTransformation:a&&null!=a.size}:{enabled:!1}};b.updateFastSymbolUpdatesState=function(a,c,b){if(!c||!a.enabled)return!1;var d=a.visualVariables;c=H(c.visualVariables,b);if(!(c&&I(d.size,
c.size,"size")&&I(d.color,c.color,"color")&&I(d.rotation,c.rotation,"rotation")&&I(d.opacity,c.opacity,"opacity")))return!1;a.visualVariables=c;a.materialParameters=G(c,b);a.requiresShaderTransformation=c&&null!=c.size;return!0};b.getMaterialParams=G;var J;(function(a){var c=g.mat4f64.create(),b=d.vec3f64.create();a.evaluateModelTransform=function(a,d,e){if(!a.vvSizeEnabled)return e;f.mat4.copy(c,e);e=a.vvSymbolRotationMatrix;f.mat4.set(E,e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1);
f.mat4.multiply(c,c,E);for(e=0;3>e;++e)b[e]=m.clamp(a.vvSizeOffset[e]+d[0]*a.vvSizeFactor[e],a.vvSizeMinSize[e],a.vvSizeMaxSize[e]);f.mat4.scale(c,c,b);f.mat4.translate(c,c,a.vvSymbolAnchor);return c};a.evaluateModelTransformScale=function(a,c,b){if(!c.vvSizeEnabled)return l.vec3.set(a,1,1,1);for(var d=0;3>d;++d)a[d]=m.clamp(c.vvSizeOffset[d]+b[0]*c.vvSizeFactor[d],c.vvSizeMinSize[d],c.vvSizeMaxSize[d]);return a}})(J||(J={}));var E=g.mat4f64.create();b.evaluateModelTransform=J.evaluateModelTransform;
b.evaluateModelTransformScale=J.evaluateModelTransformScale})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../support/mathUtils ./geometryDataUtils ./Object3DStateSet ./Util ../materials/renderers/utils".split(" "),function(n,
b,a,m,h,e,f,g,l,d,c,k,p){return function(){function b(a,c,b,d,e,g,k){this.uniqueName=null;this.shaderTransformationDirty=!0;this.data=a.toRenderData();this.boundingInfo=c;this.material=b;this.origin=null;this.center=f.vec3f64.create();this.bsRadius=0;this.transformation=null;this.calculateShaderTransformation=e;d&&this.updateTransformation(d,g);this.castShadow=k;this.instanceParameters={highlights:null,occludees:null,visible:!0}}b.prototype.updateTransformation=function(a,c){this.transformation=a;
this.shaderTransformationDirty=!0;this.bsRadius=this.getBoundingSphere(a,c,this.center)};b.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0};b.prototype.getBoundingSphere=function(a,c,b){c=c||l.maxScale(a);e.vec3.transformMat4(b,this.boundingInfo.getCenter(),a);return this.boundingInfo.getBSRadius()*c};Object.defineProperty(b.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0});b.prototype.getShaderTransformation=
function(){if(!this.calculateShaderTransformation)return a.unwrapOr(this.transformation,g.IDENTITY);this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=h.mat4f64.create()),m.mat4.copy(this.shaderTransformation,this.calculateShaderTransformation(a.unwrapOr(this.transformation,g.IDENTITY))),this.shaderTransformationDirty=!1);return this.shaderTransformation};b.prototype.computeAttachmentOrigin=function(c){if(this.material.computeAttachmentOrigin)return this.material.computeAttachmentOrigin(this,
c)?(a.isSome(this.transformation)&&e.vec3.transformMat4(c,c,this.transformation),!0):!1;var b=this.getIndices(k.VertexAttrConstants.POSITION),f=this.getAttribute(k.VertexAttrConstants.POSITION);return d.computeAttachmentOriginTriangles(f,b,c)?(a.isSome(this.transformation)&&e.vec3.transformMat4(c,c,this.transformation),!0):!1};b.prototype.getIndices=function(a){return"indices"in this.data?this.data.indices[a]:null};b.prototype.getAttribute=function(a){return"vertexAttr"in this.data?this.data.vertexAttr[a]:
null};b.prototype.addHighlight=function(){var a=c.generateObject3DStateId(0),b=this.instanceParameters;b.highlights=p.addObject3DStateID(b.highlights,a);return a};b.prototype.removeHighlight=function(a){var c=this.instanceParameters;c.highlights=p.removeObject3DStateID(c.highlights,a)};return b}()})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("require exports tslib ../../../../core/compilerUtils ../../../../core/Error ../../../../core/Evented ../../../../core/mathUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/urlUtils ../../../../support/requestUtils ../../support/imageUtils ./DDSUtil ./glUtil3D ./IdGen ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/capabilities/isWebGL2Context".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A){return function(){function b(a,c,d){this.data=a;this.loadingController=this.loadingPromise=this.powerOfTwoStretchInfo=this.glTexture=null;this.events=new e;this.data=a;this.id=b.idGen.gen(c);this.params=d||{};this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=this.params.noUnpackFlip||!1;this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1;this.params.wrap=this.params.wrap||{s:10497,t:10497};this.params.powerOfTwoResizeMode=
this.params.powerOfTwoResizeMode||1;this.estimatedTexMemRequired=b.estimateTexMemRequired(this.data,this.params);this.startPreload()}b.prototype.startPreload=function(){var a=this.data;l.isNone(a)||(a instanceof HTMLVideoElement?this.startPreloadVideoElement(a):a instanceof HTMLImageElement&&this.startPreloadImageElement(a))};b.prototype.startPreloadVideoElement=function(a){k.isBlobProtocol(a.src)||"auto"===a.preload&&a.crossOrigin||(a.preload="auto",a.crossOrigin="anonymous",a.src=a.src)};b.prototype.startPreloadImageElement=
function(a){k.isDataProtocol(a.src)||k.isBlobProtocol(a.src)||a.crossOrigin||(a.crossOrigin="anonymous",a.src=a.src)};b.getDataDimensions=function(a){return a instanceof HTMLVideoElement?{width:a.videoWidth,height:a.videoHeight}:a};b.estimateTexMemRequired=function(a,d){if(l.isNone(a))return 0;if(c.isArrayBuffer(a)||c.isUint8Array(a))return a.byteLength;a=a instanceof Image||a instanceof ImageData||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement?b.getDataDimensions(a):d;return(d.mipmap?
4/3:1)*a.width*a.height*(d.components||4)||0};b.prototype.dispose=function(){this.data=void 0};Object.defineProperty(b.prototype,"width",{get:function(){return this.params.width},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this.params.height},enumerable:!0,configurable:!0});b.prototype.createDescriptor=function(a){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?
9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.mipmap&&!this.params.disableAnisotropy?a.parameters.maxMaxAnisotropy:void 0}};b.prototype.load=function(a,d){if(l.isSome(this.glTexture))return this.glTexture;if(l.isSome(this.loadingPromise))return this.loadingPromise;var e=this.data;if(l.isNone(e))return this.glTexture=new q(a,this.createDescriptor(a),null),a.bindTexture(this.glTexture),this.glTexture;if("string"===typeof e)return this.loadFromURL(a,
d,e);if(e instanceof Image)return this.loadFromImageElement(a,d,e);if(e instanceof HTMLVideoElement)return this.loadFromVideoElement(a,d,e);if(e instanceof ImageData||e instanceof HTMLCanvasElement)return this.loadFromImage(a,e,d);if((c.isArrayBuffer(e)||c.isUint8Array(e))&&this.params.encoding===b.DDS_ENCODING)return this.loadFromDDSData(a,e);if(c.isUint8Array(e))return this.loadFromPixelData(a,e);if(c.isArrayBuffer(e))return this.loadFromPixelData(a,new Uint8Array(e));m.neverReachedSilent(e);return null};
Object.defineProperty(b.prototype,"requiresFrameUpdates",{get:function(){return this.data instanceof HTMLVideoElement},enumerable:!0,configurable:!0});b.prototype.frameUpdate=function(a,c,b){if(!(this.data instanceof HTMLVideoElement)||l.isNone(this.glTexture)||2>this.data.readyState||b===this.data.currentTime)return b;if(l.isSome(this.powerOfTwoStretchInfo)){var d=this.powerOfTwoStretchInfo;b=d.framebuffer;var e=d.vao,d=d.sourceTexture;d.setData(this.data);this.drawStretchedTexture(a,c,b,e,d,this.glTexture)}else c=
this.data,a=c.width,c=c.height,e=this.glTexture.descriptor,b=e.width,e=e.height,a!==b||c!==e?this.glTexture.updateData(0,0,0,Math.min(a,b),Math.min(c,e),this.data):this.glTexture.setData(this.data);this.glTexture.descriptor.hasMipmap&&this.glTexture.generateMipmap();return this.data.currentTime};b.prototype.loadFromDDSData=function(a,c){this.glTexture=t.createDDSTexture(a,this.createDescriptor(a),c,this.params.mipmap);a.bindTexture(this.glTexture);return this.glTexture};b.prototype.loadFromPixelData=
function(a,c){z.assert(0<this.params.width&&0<this.params.height);var b=this.createDescriptor(a);b.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408;b.width=this.params.width;b.height=this.params.height;this.glTexture=new q(a,b,c);a.bindTexture(this.glTexture);return this.glTexture};b.prototype.loadAsync=function(c){return a.__awaiter(this,void 0,void 0,function(){var b,e,f,g=this;return a.__generator(this,function(a){this.loadingController=b=d.createAbortController();
this.loadingPromise=e=c(b.signal);f=function(){g.loadingController===b&&(g.loadingController=null);g.loadingPromise===e&&(g.loadingPromise=null)};e.then(f,f);return[2,e]})})};b.prototype.loadFromURL=function(c,b,d){var e=this;return this.loadAsync(function(f){return a.__awaiter(e,void 0,void 0,function(){var e;return a.__generator(this,function(a){switch(a.label){case 0:return[4,r.requestImage(d,{signal:f})];case 1:return e=a.sent(),[2,this.loadFromImage(c,e,b)]}})})})};b.prototype.loadFromImageElement=
function(c,b,d){var e=this;return d.complete?this.loadFromImage(c,d,b):this.loadAsync(function(f){return a.__awaiter(e,void 0,void 0,function(){var e;return a.__generator(this,function(a){switch(a.label){case 0:return[4,p.loadImageAsync(d,d.src,!1,f)];case 1:return e=a.sent(),[2,this.loadFromImage(c,e,b)]}})})})};b.prototype.loadFromVideoElement=function(a,c,b){return 2<=b.readyState?this.loadFromImage(a,b,c):this.loadFromVideoElementAsync(a,c,b)};b.prototype.loadFromVideoElementAsync=function(a,
c,b){var e=this;return this.loadAsync(function(f){return d.create(function(g,k){var m=function(){b.removeEventListener("loadeddata",q);b.removeEventListener("error",p);l.isSome(r)&&r.remove()},q=function(){2<=b.readyState&&(m(),g(e.loadFromImage(a,b,c)))},p=function(a){m();k(a||new h("Failed to load video"))};b.addEventListener("loadeddata",q);b.addEventListener("error",p);var r=d.onAbort(f,function(){return p(d.createAbortError())})})})};b.prototype.loadFromImage=function(a,c,d){var e=b.getDataDimensions(c);
this.params.width=e.width;this.params.height=e.height;var f=this.createDescriptor(a);f.pixelFormat=3===this.params.components?6407:6408;if(this.requiresPowerOfTwo(a,f)&&(!g.isPowerOfTwo(e.width)||!g.isPowerOfTwo(e.height)))return this.glTexture=this.makePowerOfTwoTexture(a,c,e,f,d),a.bindTexture(this.glTexture),this.glTexture;f.width=e.width;f.height=e.height;this.glTexture=new q(a,f,c);a.bindTexture(this.glTexture);return this.glTexture};b.prototype.requiresPowerOfTwo=function(a,c){var b="number"===
typeof c.wrapMode?33071===c.wrapMode:33071===c.wrapMode.s&&33071===c.wrapMode.t;return!A.default(a.gl)&&(c.hasMipmap||!b)};b.prototype.makePowerOfTwoTexture=function(a,c,b,d,e){var g=b.width;b=b.height;var k=f.nextHighestPowerOfTwo(g),h=f.nextHighestPowerOfTwo(b);d.width=k;d.height=h;var l;switch(this.params.powerOfTwoResizeMode){case 2:d.textureCoordinateScaleFactor=[g/k,b/h];l=new q(a,d);l.updateData(0,0,0,g,b,c);break;case 1:case null:case void 0:l=this.stretchToPowerOfTwo(a,c,d,e);break;default:m.neverReached(this.params.powerOfTwoResizeMode)}d.hasMipmap&&
l.generateMipmap();return l};b.prototype.stretchToPowerOfTwo=function(a,c,b,d){var e=new q(a,b),f=new w(a,{colorTarget:0,depthStencilTarget:0},e);c=new q(a,{target:3553,pixelFormat:b.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!b.flipped,maxAnisotropy:8,preMultiplyAlpha:b.preMultiplyAlpha},c);b=u.createQuadVAO(a);this.drawStretchedTexture(a,d,f,b,c,e);this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:b,sourceTexture:c,framebuffer:f}:(b.dispose(!0),c.dispose(),f.detachColorTexture(),
a.bindFramebuffer(null),f.dispose());return e};b.prototype.drawStretchedTexture=function(a,c,b,d,e,f){a.bindFramebuffer(b);b=a.getViewport();a.setViewport(0,0,f.descriptor.width,f.descriptor.height);f=c.program;a.bindProgram(f);f.setUniform4f("color",1,1,1,1);f.setUniform1i("tex",0);a.bindTexture(e,0);a.bindVAO(d);a.setPipelineState(c.pipeline);a.drawArrays(5,0,y.vertexCount(d,"geometry"));a.bindFramebuffer(null);a.setViewport(b.x,b.y,b.width,b.height)};b.prototype.unload=function(){if(l.isSome(this.powerOfTwoStretchInfo)){var a=
this.powerOfTwoStretchInfo,c=a.framebuffer,b=a.sourceTexture;a.vao.dispose(!0);b.dispose();c.dispose();this.powerOfTwoStretchInfo=this.glTexture=null}l.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null);l.isSome(this.loadingController)&&(a=this.loadingController,this.loadingPromise=this.loadingController=null,a.abort());this.events.emit("unloaded")};b.idGen=new v.IdGen;b.DDS_ENCODING="image/vnd-ms.dds";return b}()})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["require",
"exports","../../../../core/Logger","../../../../core/mathUtils","../../../webgl/Texture"],function(n,b,a,m,h){function e(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function f(a,b){var e=new Int32Array(a,0,31);if(542327876!==e[0])return g.error("Invalid magic number in DDS header"),null;if(!(e[20]&4))return g.error("Unsupported format, must contain a FourCC code"),null;var f=e[21],k;switch(f){case l:f=8;k=33776;break;case d:f=16;k=33778;break;case c:f=
16;k=33779;break;default:return g.error("Unsupported FourCC code:",String.fromCharCode(f&255,f>>8&255,f>>16&255,f>>24&255)),null}var h=1,p=e[4],w=e[3];if(0!==(p&3)||0!==(w&3))g.warn("Rounding up compressed texture size to nearest multiple of 4."),p=p+3&-4,w=w+3&-4;var q=p,y=w;e[2]&131072&&!1!==b&&(h=Math.max(1,e[7]));1===h||m.isPowerOfTwo(p)&&m.isPowerOfTwo(w)||(g.warn("Ignoring mipmaps of non power of two sized compressed texture."),h=1);for(var A=e[1]+4,B=[],C=0;C<h;++C)e=(p+3>>2)*(w+3>>2)*f,b=
new Uint8Array(a,A,e),B.push(b),A+=e,p=Math.max(1,p>>1),w=Math.max(1,w>>1);return{textureData:{type:"compressed",levels:B},internalFormat:k,width:q,height:y}}Object.defineProperty(b,"__esModule",{value:!0});var g=a.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),l=e("DXT1"),d=e("DXT3"),c=e("DXT5");b.createDDSTexture=function(a,c,b,d){var e=f(b,d);b=e.textureData;d=e.internalFormat;var g=e.width,e=e.height;c.samplingMode=1<b.levels.length?9987:9729;c.hasMipmap=1<b.levels.length;c.internalFormat=
d;c.width=g;c.height=e;c=new h(a,c,b);a.bindTexture(c);return c};b.createDDSTextureData=f})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("require exports tslib ../../../../Color ../../../../geometry ../../../../core/Error ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../renderers/support/renderingInfoUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./lineUtils ../support/FastSymbolUpdates ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function n(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._uniformSize=1;return a}a.__extends(n,b);n.prototype.doLoad=function(){return a.__awaiter(this,void 0,void 0,function(){var c;return a.__generator(this,function(a){this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,
color:!0,opacity:!0,rotation:!1}};this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?q.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};if(!this._drivenProperties.size){c=null!=this.symbolLayer.size?this.symbolLayer.size:g.px2pt(1);if(0>c)throw new e("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=c}return[2]})})};n.prototype.getMaterialParameters=
function(c){var b=f.get(this.symbolLayer,"material","color"),b=this._getCombinedOpacityAndColor(b);c={width:1,color:b,polygonOffset:!0,join:this.symbolLayer.join||"miter",cap:this.symbolLayer.cap||"butt",transparent:1>b[3]||this.needsDrivenTransparentPass,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:c,stipplePattern:this.symbolLayer.stipplePattern?C.createStipplePattern(this.symbolLayer.stipplePattern.map(g.pt2px)):null,stippleOffColor:this.symbolLayer.stippleOffColor?m.toUnitRGBA(this.symbolLayer.stippleOffColor):
null,stippleIntegerRepeats:!0};this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size&&(c.width=g.pt2px(1)):(b=null!=this.symbolLayer.size?this.symbolLayer.size:g.px2pt(1),c.width=g.pt2px(b));return this._fastUpdates&&this._fastUpdates.visualVariables?a.__assign(a.__assign({},c),this._fastUpdates.materialParameters):c};Object.defineProperty(n.prototype,"lineMaterial",{get:function(){f.isNone(this._lineMaterial)&&(this._lineMaterial=new F(this.getMaterialParameters(!1),
this._getIdHint("_ribbonlinemat")),this._context.stage.add(3,this._lineMaterial));return this._lineMaterial},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"ringMaterial",{get:function(){f.isNone(this._ringMaterial)&&(this._ringMaterial=new F(this.getMaterialParameters(!0),this._getIdHint("_ribbonlinemat")),this._context.stage.add(3,this._ringMaterial));return this._ringMaterial},enumerable:!0,configurable:!0});n.prototype.destroy=function(){b.prototype.destroy.call(this);f.isSome(this._lineMaterial)&&
(this._context.stage.remove(3,this._lineMaterial.id),this._lineMaterial=null);f.isSome(this._ringMaterial)&&(this._context.stage.remove(3,this._ringMaterial.id),this._ringMaterial=null)};n.prototype.getDrivenSize=function(a){return this._drivenProperties.size&&a.size?g.pt2px(k.getDriverAxisSizeValueAny(a.size)):1};n.prototype.getSizeFeatureAttributeData=function(a){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?z.getAttributeValue(this._fastUpdates.visualVariables.size.field,
a):null};n.prototype.getDrivenColor=function(a){var c=d.vec4f64.fromValues(1,1,1,1);this._drivenProperties.color&&a.color&&(c[0]=a.color[0],c[1]=a.color[1],c[2]=a.color[2],0<a.color.length&&(c[3]=a.color[3]));this._drivenProperties.opacity&&a.opacity&&(c[3]=a.opacity);return c};n.prototype.getColorFeatureAttributeData=function(a){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?z.getAttributeValue(this._fastUpdates.visualVariables.color.field,a):null};n.prototype.getOpacityFeatureAttributeData=
function(a){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?z.getAttributeValue(this._fastUpdates.visualVariables.opacity.field,a):null};n.prototype.createGraphics3DGraphic=function(a){var c=a.graphic,b=c.geometry;if(!this._validateGeometryType(c.geometry,n.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(b))return null;var b="graphic"+c.uid,d=this.setGraphicElevationContext(c,new t.ElevationContext);this.ensureDrapedStatus("on-the-ground"===d.mode);return this.draped?
this._createAsOverlay(a,this._context.layer.uid):this._createAs3DShape(a,d,b,c.uid)};n.prototype.applyRendererDiff=function(a,c){for(var b in a.diff)switch(b){case "visualVariables":if(q.updateFastSymbolUpdatesState(this._fastUpdates,c,this._vvConvertOptions))f.isSome(this._lineMaterial)&&this._lineMaterial.setParameterValues(this._fastUpdates.materialParameters),f.isSome(this._ringMaterial)&&this._ringMaterial.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};
n.prototype.layerOpacityChanged=function(){f.isSome(this._lineMaterial)&&this.updateMaterialLayerOpacity(this._lineMaterial);f.isSome(this._ringMaterial)&&this.updateMaterialLayerOpacity(this._ringMaterial);return!0};n.prototype.updateMaterialLayerOpacity=function(a){var c=a.getParameters().color,b=f.get(this.symbolLayer,"material","color"),b=this._getCombinedOpacity(b);a.setParameterValues({color:[c[0],c[1],c[2],b],transparent:1>b||this.needsDrivenTransparentPass})};n.prototype.layerElevationInfoChanged=
function(a,c,b){var d=this._elevationContext.mode;b=r.elevationModeChangeUpdateType(n.elevationModeChangeTypes,b,d);if(b!==r.SymbolUpdateType.UPDATE)return b;var e=r.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(a,c,function(){return e})};n.prototype.slicePlaneEnabledChanged=function(){f.isSome(this._lineMaterial)&&this._lineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});f.isSome(this._ringMaterial)&&this._ringMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});
return!0};n.prototype.physicalBasedRenderingChanged=function(){return!0};n.prototype.pixelRatioChanged=function(){return!0};n.prototype._getGeometryAsPolygonOrPolyline=function(a){switch(a.type){case "extent":if(a instanceof h.Extent)return h.Polygon.fromExtent(a);break;case "polygon":case "polyline":return a}return null};n.prototype._createAs3DShape=function(a,b,d,e){var g=this._getGeometryAsPolygonOrPolyline(a.graphic.geometry),k="polygon"===g.type?g.rings:g.paths,h=[],m=[],q=[],t=c.create(),u=
w.geometryToRenderInfo(g,this._context.elevationProvider,this._context.renderCoordsHelper,b);this._logGeometryCreationWarnings(u,k,"polygon"===g.type?"rings":"paths","LineSymbol3DLayer");for(k=0;k<u.lines.length;k++){var z=u.lines[k],B=z.position,z=z.mapPosition;if(f.isSome(this._context.clippingExtent)&&(c.empty(t),c.expandWithBuffer(t,z),!c.intersectsClippingArea(t,this._context.clippingExtent)))continue;B=this._createGeometryData(a,B,z,g.type);B=new y(B,d+"path"+k);h.push(B);m.push("polygon"===
g.type?this.ringMaterial:this.lineMaterial);q.push(l.mat4f64.IDENTITY)}if(0===h.length)return null;a=new A({geometries:h,materials:m,transformations:q,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e},idHint:d});h=new v(this,a,h,null,null,p.perVertexElevationAligner,b);h.alignedSampledElevation=u.sampledElevation;h.needsElevationUpdates=r.needsElevationUpdates2D(b.mode);return h};n.prototype._createGeometryData=function(a,c,b,d){var e=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color;
return w.createGeometryData({removeDuplicateStartEnd:"polygon"===d?1:0,uniformSize:this._uniformSize,attributeData:{position:c,mapPosition:b,size:this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?null:this.getDrivenSize(a.renderingInfo),color:e?null:this.getDrivenColor(a.renderingInfo),sizeFeature:this.getSizeFeatureAttributeData(a.graphic),colorFeature:this.getColorFeatureAttributeData(a.graphic),opacityFeature:this.getOpacityFeatureAttributeData(a.graphic)}})};n.prototype._createAsOverlay=
function(a,b){var d=a.graphic,e=this._getGeometryAsPolygonOrPolyline(d.geometry),f="polygon"===e.type?e.rings:e.paths,g="polygon"===e.type?this.ringMaterial:this.lineMaterial;g.renderPriority=this._renderPriority;var k=[],h=c.create(),l=c.empty(),m=w.geometryToRenderInfoDraped(e,this._context.overlaySR);this._logGeometryCreationWarnings(m,f,"polygon"===e.type?"rings":"paths","LineSymbol3DLayer");if(0<f.length){f=m.lines;for(m=0;m<f.length;++m){var q=f[m];c.empty(h);c.expandWithBuffer(h,q.position);
c.intersectsClippingArea(h,this._context.clippingExtent)&&(c.expand(l,h),q=this._createGeometryData(a,q.position,null,e.type),q=new B(q),q.data.layerUid=b,q.data.graphicUid=d.uid,q.material=g,q.center=[.5*(h[0]+h[3]),.5*(h[1]+h[4]),0],q.bsRadius=.5*Math.sqrt((h[3]-h[0])*(h[3]-h[0])+(h[4]-h[1])*(h[4]-h[1])),k.push(q))}return new u(this,k,l)}return null};n.validGeometryTypes=["polyline","polygon","extent"];n.elevationModeChangeTypes={definedChanged:r.SymbolUpdateType.RECREATE,staysOnTheGround:r.SymbolUpdateType.NONE,
onTheGroundChanged:r.SymbolUpdateType.RECREATE};return n}(z.Graphics3DSymbolLayer);b.Graphics3DLineSymbolLayer=n;b.default=n})},"esri/views/3d/layers/graphics/lineUtils":function(){define("require exports ../../../../core/mathUtils ../../../../core/maybe ../../../../core/typedArrayUtil ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/triangulationUtils ./constants ./elevationAlignmentUtils ../../support/projectionUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/GeometryData ../../webgl-engine/shaders/RibbonLineTechnique".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r){function t(a,c,b){for(var d=[],e=0;e<a.length;e++){var f=a[e],g=f.count;1>=g||(f=3*f.index,g=f+3*g,d.push({position:c.subarray(f,g),mapPosition:b?b.subarray(f,g):void 0}))}return d}Object.defineProperty(b,"__esModule",{value:!0});b.createGeometryData=function(c){for(var b={},d={},f=c.attributeData.position,g=c.removeDuplicateStartEnd,k=f.length,t=f[0]===f[k-3]&&f[1]===f[k-2]&&f[2]===f[k-1]&&1===g,g=f.length/3-(t?1:0),k=new Uint32Array(2*(g-1)),f=t?h.slice(f,0,
f.length-3):f,w=t=0;w<g-1;w++)k[t++]=w,k[t++]=w+1;d[r.RibbonVertexAttributeConstants.POSITION]={size:3,data:f,offsetIdx:0,strideIdx:3};b[r.RibbonVertexAttributeConstants.POSITION]=k;g=new Uint32Array(b[r.RibbonVertexAttributeConstants.POSITION].length);k=c.attributeData.mapPosition;m.isNone(k)||(b.mapPos=b[r.RibbonVertexAttributeConstants.POSITION],d.mapPos={size:3,data:k,offsetIdx:0,strideIdx:3});m.isSome(c.attributeData.colorFeature)||(d[r.RibbonVertexAttributeConstants.COLOR]={size:4,data:m.unwrapOr(c.attributeData.color,
l.WHITE_UNIT),offsetIdx:0,strideIdx:4},b[r.RibbonVertexAttributeConstants.COLOR]=g);m.isSome(c.attributeData.sizeFeature)||(d[r.RibbonVertexAttributeConstants.SIZE]={size:1,data:new Float32Array([m.unwrapOr(c.attributeData.size,1)]),offsetIdx:0,strideIdx:1},b[r.RibbonVertexAttributeConstants.SIZE]=g);k=c.attributeData.colorFeature;m.isNone(k)||(d[r.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE]={size:1,data:new Float32Array([k]),offsetIdx:0,strideIdx:1},b[r.RibbonVertexAttributeConstants.COLOR]=
g);k=c.attributeData.sizeFeature;m.isNone(k)||(d[r.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE]={size:1,data:new Float32Array([k]),offsetIdx:0,strideIdx:1},b[r.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE]=g);k=c.attributeData.opacityFeature;m.isNone(k)||(d[r.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE]={size:1,data:new Float32Array([k]),offsetIdx:0,strideIdx:1},b[r.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE]=g);if("round"===c.join){g=d[r.RibbonVertexAttributeConstants.POSITION].data;
k=g.length/3;f=new Float32Array(k);t=u;w=v;e.vec3.set(t,0,0,0);c=m.unwrapOr(c.uniformSize,1);for(var n=-1;n<k;++n){var G=0>n?k+n:n,J=(n+1)%k;e.vec3.set(w,g[3*J+0]-g[3*G+0],g[3*J+1]-g[3*G+1],g[3*J+2]-g[3*G+2]);e.vec3.normalize(w,w);0<=n&&(G=1*(Math.PI-a.acosClamped(e.vec3.dot(t,w)))*z*(1.863798+-2.0062872/Math.pow(1+c/18.2313,.8856294)),f[n]=Math.max(Math.floor(G),0));e.vec3.scale(t,w,-1)}d[r.RibbonVertexAttributeConstants.SUBDIVISIONS]={size:1,data:f,offsetIdx:0,strideIdx:1};b[r.RibbonVertexAttributeConstants.SUBDIVISIONS]=
b[r.RibbonVertexAttributeConstants.POSITION]}return new p.GeometryData(d,b,"line")};b.geometryToRenderInfo=function(a,c,b,e){var f=g.pathsToTriangulationInfo("polygon"===a.type?a.rings:a.paths,a.hasZ,"polygon"===a.type?1:0),k=f.position,f=f.outlines,h=new Float64Array(k.length);a=d.applyPerVertexElevationAlignment(k,a.spatialReference,0,h,0,k,0,k.length/3,c,b,e);c=null!=a;return{lines:c?t(f,k,h):[],projectionSuccess:c,sampledElevation:a}};b.geometryToRenderInfoDraped=function(a,b){var d=g.pathsToTriangulationInfo("polygon"===
a.type?a.rings:a.paths,!1,"polygon"===a.type?1:0),e=d.position,d=d.outlines;a=c.bufferToBuffer(e,a.spatialReference,0,e,b,0,e.length/3);for(b=2;b<e.length;b+=3)e[b]=k.DRAPED_Z;return{lines:a?t(d,e):[],projectionSuccess:a}};var u=f.vec3f64.create(),v=f.vec3f64.create(),z=4/Math.PI})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("require exports tslib ../../../../Color ../../../../core/compilerUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/MeshMaterialMetallicRoughness ../../../../geometry/support/webMercatorUtils ../../../../geometry/support/meshUtils/projection ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L,M,N,Q){Object.defineProperty(b,"__esModule",{value:!0});var R=M.VertexAttrConstants;n=function(b){function g(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._materials=new Map;a._textures=new Map;a.ensureDrapedStatus(!1);return a}a.__extends(g,b);g.prototype.doLoad=function(){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){H.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Q({color:[1,
0,1,1]},"debugVertexNormal"),this._debugFaceNormalMaterial=new Q({color:[0,1,1,1]},"debugFAceNormal"));return[2]})})};g.prototype.destroy=function(){var a=this;b.prototype.destroy.call(this);this._materials.forEach(function(c){a._context.stage.remove(3,c.material.id)});this._textures.forEach(function(c){a._context.stage.remove(4,c.id)});this._materials.clear();this._textures.clear()};g.prototype.createGraphics3DGraphic=function(a){var c=a.graphic;if(!this._validateGeometryType(c.geometry,g.validGeometryTypes,
"fill on mesh-3d")||!this._validateGeometry(c.geometry))return null;var b="graphic"+c.uid,d=this.setGraphicElevationContext(c,new y.ElevationContext);return this._createAs3DShape(c,a.renderingInfo,d,b,c.uid)};g.prototype.layerOpacityChanged=function(a,c){var b=this,d=this._getLayerOpacity();this._materials.forEach(function(a){a.material.setParameterValues({layerOpacity:d});var c=a.material.getParameters();b._setMaterialTransparentParameter(c,a);a.material.setParameterValues({transparent:c.transparent})});
a.forEach(function(a){a=c(a);e.isSome(a)&&a.layerOpacityChanged(d,b._context.isAsync)});return!0};g.prototype.layerElevationInfoChanged=function(a,c){return this.updateGraphics3DGraphicElevationInfo(a,c,q.needsElevationUpdates3D)};g.prototype.slicePlaneEnabledChanged=function(a,c){var b=this;this._materials.forEach(function(a){a.material.setParameterValues({slicePlaneEnabled:b._context.slicePlaneEnabled})});a.forEach(function(a){a=c(a);e.isSome(a)&&a.slicePlaneEnabledChanged(b._context.slicePlaneEnabled,
b._context.isAsync)});return!0};g.prototype.physicalBasedRenderingChanged=function(){var a=this;this._materials.forEach(function(c){var b=c.material.getParameters().isSchematic;c.material.setParameterValues({usePBR:a._usePBR(b)})});return!0};g.prototype.pixelRatioChanged=function(){return!0};g.prototype._requiresSymbolVertexColors=function(){return this._drivenProperties.color||this._drivenProperties.opacity};g.prototype._colorOrTextureUid=function(a){return a?a instanceof m?a.toHex():a.contentHash:
"-"};g.prototype._materialPropertiesDefault=function(a,c){var b=this._requiresSymbolVertexColors(),d=!!a.vertexAttributes.color;a=!!a.vertexAttributes.tangent;return{hasSymbolVertexColors:b,hasVertexColors:d,hasVertexTangents:a,uid:"vc:"+d+",vt:"+a+",vct"+c+",svc:"+b}};g.prototype._materialProperties=function(a,c,b){a=this._materialPropertiesDefault(a,b);if(!c.material)return a;var d=c.material;b=d.color;var e=d.colorTexture,f=d.normalTexture,g=d.doubleSided,k=d.alphaCutoff,d=d.alphaMode,h=this._colorOrTextureUid(b),
l=this._colorOrTextureUid(e),m=this._colorOrTextureUid(f);a.color=b;a.colorTexture=e;a.normalTexture=f;a.uid=a.uid+",cmuid:"+h+",ctmuid:"+l+",ntmuid:"+m+",ds:"+g+",ac:"+k+",am:"+d;c.material instanceof u&&(k=c.material,c=k.metallic,b=k.roughness,e=k.metallicRoughnessTexture,f=k.emissiveColor,g=k.emissiveTexture,k=k.occlusionTexture,d=this._colorOrTextureUid(e),h=this._colorOrTextureUid(f),l=this._colorOrTextureUid(g),m=this._colorOrTextureUid(k),a.metallic=c,a.roughness=b,a.metallicRoughnessTexture=
e,a.emissiveColor=f,a.emissiveTexture=g,a.occlusionTexture=k,a.uid=a.uid+",mrm:"+c+",mrr:"+b+",mrt:"+d+",emuid:"+h+",etmuid:"+l+",otmuid:"+m);return a};g.prototype._setInternalColorValueParameters=function(a,c){c.diffuse=m.toUnitRGB(a);c.opacity=a.a};g.prototype._getLoadableTextureResource=function(a){return a.data?a.data:a.url};g.prototype._getInternalTextureId=function(a,c){var b=this._getLoadableTextureResource(a);if(b){var d=a.contentHash,e=this._textures.get(d);e||(e=new L(b,c+"_"+d+"_tex",{mipmap:!0,
wrap:this._castTextureWrap(a.wrap),noUnpackFlip:!0,preMultiplyAlpha:!0}),this._textures.set(d,e),this._context.stage.add(4,e));return e.id}};g.prototype._castTextureWrap=function(a){void 0===a&&(a="repeat");return"string"===typeof a?(a=this._castTextureWrapIndividual(a),{s:a,t:a}):{s:this._castTextureWrapIndividual(a.horizontal),t:this._castTextureWrapIndividual(a.vertical)}};g.prototype._castTextureWrapIndividual=function(a){switch(a){case "clamp":return 33071;case "mirror":return 33648;default:return 10497}};
g.prototype._setInternalMaterialParameters=function(a,c,b){a.color&&this._setInternalColorValueParameters(a.color,b);a.colorTexture&&(b.textureId=this._getInternalTextureId(a.colorTexture,c));a.normalTexture&&(b.normalTextureId=this._getInternalTextureId(a.normalTexture,c));a.emissiveColor&&(b.emissiveFactor=m.toUnitRGB(a.emissiveColor));a.emissiveTexture&&(b.emissiveTextureId=this._getInternalTextureId(a.emissiveTexture,c));a.occlusionTexture&&(b.occlusionTextureId=this._getInternalTextureId(a.occlusionTexture,
c));a.metallicRoughnessTexture&&(b.metallicRoughnessTextureId=this._getInternalTextureId(a.metallicRoughnessTexture,c))};g.prototype._setExternalMaterialParameters=function(a){var c=this._drivenProperties.color,b=e.isSome(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;c?a.externalColor=p.vec4f64.ONES:(c=e.isSome(this.symbolLayer.material)?this.symbolLayer.material.color:null,e.isSome(c)?a.externalColor=m.toUnitRGBA(c):(b=null,a.externalColor=p.vec4f64.ONES));b&&(a.colorMixMode=
b);a.castShadows=!!this.symbolLayer.castShadows};g.prototype._hasTransparentVertexColors=function(a){a=a.vertexAttributes.color;if(!a)return!1;for(var c=3;c<a.length;c+=4)if(255!==a[c])return!0;return!1};g.prototype._getOrCreateMaterial=function(a,c){var b=c.material&&c.material.color,d=c.material&&c.material.colorTexture,e=c.material&&"blend"===c.material.alphaMode,b=!(c.material&&"opaque"===c.material.alphaMode)&&(this._hasTransparentVertexColors(a)||b&&1>b.a||d&&d.transparent||e);a=this._materialProperties(a,
c,b);if(d=this._materials.get(a.uid))return d.material;var b={material:null,isComponentTransparent:b,alphaMode:c.material?c.material.alphaMode:"opaque"},d=this._getIdHint(),e=null==a.metallicRoughnessTexture&&null==a.metallic&&null==a.roughness,f={usePBR:this._usePBR(e),isSchematic:e,vertexColors:a.hasVertexColors,symbolColors:a.hasSymbolVertexColors,vertexTangents:a.hasVertexTangents,ambient:k.vec3f64.ZEROS,diffuse:k.vec3f64.ONES,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:0,
textureAlphaPremultiplied:!0,layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,initTextureTransparent:!0};e||(f.mrrFactors=[null!=a.metallic?a.metallic:1,null!=a.roughness?a.roughness:1,.5]);c.material&&(f.doubleSided=c.material.doubleSided,f.cullFace=c.material.doubleSided?0:2,f.textureAlphaCutoff=c.material.alphaCutoff);this._setInternalMaterialParameters(a,d,f);this._setExternalMaterialParameters(f);this._setMaterialTransparentParameter(f,b);c=new N(f,d+"_"+
a.uid+"_mat");b.material=c;this._materials.set(a.uid,b);this._context.stage.add(3,c);return c};g.prototype._usePBR=function(a){return a?this._context.physicalBasedRenderingEnabled:!0};g.prototype._setMaterialTransparentParameter=function(a,c){a.transparent=this.needsDrivenTransparentPass||c.isComponentTransparent||1>a.layerOpacity||1>a.opacity||a.externalColor&&1>a.externalColor[3];a.textureAlphaMode="auto"===c.alphaMode?a.transparent?3:1:"opaque"===c.alphaMode?1:"mask"===c.alphaMode?2:0};g.prototype._addDebugNormals=
function(a,b,e,f){var g,k,h,l,m=b.length,q=a.spatialReference.isGeographic?20015077/180:1,p=.1*Math.max(a.extent.width*q,a.extent.height*q,a.extent.zmax-a.extent.zmin),r=[],t=[];a=[];for(var q=[],w=0;w<m;w++)for(var u=b[w],y=u.data.getAttribute(R.POSITION),v=u.data.getAttribute(R.NORMAL),z=u.data.getIndices(R.POSITION),u=u.data.getIndices(R.NORMAL),y=y.data,v=v.data,A=0;A<z.length;A++){for(var B=3*z[A],C=3*u[A],n=0;3>n;n++)r.push(y[B+n]);for(n=0;3>n;n++)r.push(y[B+n]+v[C+n]*p);t.push(t.length);t.push(t.length);
if(0===A%3){this._calculateFaceNormal(y,z,A,ba);this._getFaceVertices(y,z,A,O,U,P);c.vec3.add(O,O,U);c.vec3.add(O,O,P);c.vec3.scale(O,O,1/3);for(n=0;3>n;n++)a.push(O[n]);for(n=0;3>n;n++)a.push(O[n]+ba[n]*p);q.push(q.length);q.push(q.length)}}m=(g={},g[R.POSITION]={data:new Float64Array(r),size:3},g);g=(k={},k[R.POSITION]=new Uint32Array(t),k);k=new J.GeometryData(m,g,"line");k=new G(k,"debugVertexNormal");b.push(k);e.push(this._debugVertexNormalMaterial);f.push(d.mat4f64.clone(f[0]));m=(h={},h[R.POSITION]=
{data:new Float64Array(a),size:3},h);g=(l={},l[R.POSITION]=new Uint32Array(q),l);k=new J.GeometryData(m,g,"line");k=new G(k,"debugFaceNormal");b.push(k);e.push(this._debugFaceNormalMaterial);f.push(d.mat4f64.clone(f[0]))};g.prototype._createAs3DShape=function(a,c,b,d,f){a=a.geometry;if("mesh"!==a.type)return null;var g=this._createGeometryInfo(a,c,d);if(!g)return null;c=g.geometries;var k=g.materials,h=g.transformations,g=g.objectTransformation;H.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(a,
c,k,h);f=new E({geometries:c,materials:k,transformations:h,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:f},idHint:d});f.objectTransformation=g;d=w.perObjectElevationAligner;h=this._createEdgeMaterial();k=e.isSome(h)?{baseMaterial:k[0],edgeMaterials:[h],addObjectSettings:{mergeGeometries:!0},slicePlaneEnabled:this._context.slicePlaneEnabled}:null;c=new A(this,f,c,null,null,d,b,k);c.needsElevationUpdates=q.needsElevationUpdates3D(b.mode);b=a.extent.center.clone();b.z=0;c.elevationContext.centerPointInElevationSR=
b;c.alignedSampledElevation=d(c,c.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper);return c};g.prototype._createComponentNormals=function(a,c,b,d){var e=b.shading||"flat";switch(e){case "source":return this._createComponentNormalsSource(a,c,b,d);case "flat":return this._createComponentNormalsFlat(a,d);case "smooth":return this._createComponentNormalsSmooth(a,d);default:h.neverReached(e)}};g.prototype._createComponentNormalsSource=function(a,b,d,e){if(!b)return this._createComponentNormalsFlat(a,
e);var f=!1;if(!d.trustSourceNormals)for(d=0;d<e.length;d+=3){this._calculateFaceNormal(a,e,d,ba);for(var g=0;3>g;g++){var k=3*e[d+g];O[0]=b[k+0];O[1]=b[k+1];O[2]=b[k+2];0>c.vec3.dot(ba,O)&&(b[k+0]=-b[k+0],b[k+1]=-b[k+1],b[k+2]=-b[k+2],f=!0)}}return{normals:b,indices:e,didFlipNormals:f}};g.prototype._createComponentNormalsFlat=function(a,c){for(var b=new Float32Array(c.length),d=new Uint32Array(3*c.length),e=0;e<c.length;e+=3)for(var f=this._calculateFaceNormal(a,c,e,ba),g=0;3>g;g++)b[e+g]=f[g],d[e+
g]=e/3;return{normals:b,indices:d,didFlipNormals:!1}};g.prototype._createComponentNormalsSmooth=function(a,b){for(var d={},e=0;e<b.length;e+=3)for(var f=this._calculateFaceNormal(a,b,e,ba),g=0;3>g;g++){var h=b[e+g],l=d[h];l||(l={normal:k.vec3f64.create(),count:0},d[h]=l);c.vec3.add(l.normal,l.normal,f);l.count++}a=new Float32Array(3*b.length);f=new Uint32Array(3*b.length);for(e=0;e<b.length;e++){h=b[e];l=d[h];1!==l.count&&(c.vec3.normalize(l.normal,l.normal),l.count=1);for(g=0;3>g;g++)a[3*e+g]=l.normal[g];
f[e]=e}return{normals:a,indices:f,didFlipNormals:!1}};g.prototype._getFaceVertices=function(a,c,b,d,e,f){var g=3*c[b+0],k=3*c[b+1];c=3*c[b+2];d[0]=a[g+0];d[1]=a[g+1];d[2]=a[g+2];e[0]=a[k+0];e[1]=a[k+1];e[2]=a[k+2];f[0]=a[c+0];f[1]=a[c+1];f[2]=a[c+2]};g.prototype._calculateFaceNormal=function(a,b,d,e){this._getFaceVertices(a,b,d,O,U,P);c.vec3.subtract(U,U,O);c.vec3.subtract(P,P,O);c.vec3.cross(O,U,P);c.vec3.normalize(e,O);return e};g.prototype._getOrCreateComponents=function(a){return a.components?
a.components:Y};g.prototype._createPositionBuffer=function(a){var c=a.vertexAttributes.position,b=new Float64Array(c.length);I.bufferToBuffer(a.vertexAttributes.position,a.spatialReference,0,b,this._context.renderCoordsHelper.spatialReference,0,c.length/3);return b};g.prototype._createNormalBuffer=function(a,c){var b=a.vertexAttributes.normal;if(!b)return null;if("local"===this._context.layerView.view.viewingMode)return b;var d=a.vertexAttributes.position,e=new Float32Array(b.length);return z.projectNormalToECEF(b,
d,c,a.spatialReference,e)};g.prototype._createTangentBuffer=function(a,c){var b=a.vertexAttributes.tangent;if(!b)return null;if("local"===this._context.layerView.view.viewingMode)return b;var d=a.vertexAttributes.position,e=new Float32Array(b.length);return z.projectTangentToECEF(b,d,c,a.spatialReference,e)};g.prototype._createColorBuffer=function(a){return a.vertexAttributes.color};g.prototype._createSymbolColorBuffer=function(a){if(this._requiresSymbolVertexColors()){a=this._getVertexOpacityAndColor(a);
var c=F.parseColorMixMode(e.get(this.symbolLayer,"material","colorMixMode")),b=new Uint8Array(4);F.encodeSymbolColor(a,c,b);return b}return null};g.prototype._createColorIndices=function(a){a=new Uint32Array(a.length);for(var c=0;c<a.length;c++)a[c]=0;return a};g.prototype._createBuffers=function(a,c){var b=a.vertexAttributes&&a.vertexAttributes.position;if(!b)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var d=a.vertexAttributes.normal,e=a.vertexAttributes.uv,
f=a.vertexAttributes.tangent;if(d&&d.length!==b.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(f&&f.length/4!==b.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(e&&e.length/2!==b.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;b=this._createPositionBuffer(a);
d=this._createColorBuffer(a);c=this._createSymbolColorBuffer(c);var f=this._createNormalBuffer(a,b),g=this._createTangentBuffer(a,b);a=this._transformCenterLocal(a,b,f);return{positionBuffer:b,normalBuffer:f,tangentBuffer:g,uvBuffer:e,colorBuffer:d,symbolColorBuffer:c,objectTransformation:a}};g.prototype._transformCenterLocal=function(a,b,e){var g=a.extent.center,k=this._context.renderCoordsHelper.spatialReference;W[0]=g.x;W[1]=g.y;W[2]=0;g=d.mat4f64.create();I.computeLinearTransformation(a.spatialReference,
W,g,k);l.mat4.invert(V,g);for(a=0;a<b.length;a+=3)O[0]=b[a+0],O[1]=b[a+1],O[2]=b[a+2],c.vec3.transformMat4(O,O,V),b[a+0]=O[0],b[a+1]=O[1],b[a+2]=O[2];if(e)for(f.mat3.fromMat4(T,g),f.mat3.transpose(T,T),a=0;a<e.length;a+=3)O[0]=e[a+0],O[1]=e[a+1],O[2]=e[a+2],c.vec3.transformMat3(O,O,T),e[a+0]=O[0],e[a+1]=O[1],e[a+2]=O[2];return g};g.prototype._validateFaces=function(a,c){a=a.vertexAttributes.position.length/3;if(c=c.faces){for(var b=-1,d=0;d<c.length;d++){var e=c[d];e>b&&(b=e)}if(a<=b)return this.logger.warn("Vertex index "+
b+" is out of bounds of the mesh position buffer"),!1}else if(0!==a%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0};g.prototype._getOrCreateFaces=function(a,c){if(c.faces)return c.faces;a=new Uint32Array(a.vertexAttributes.position.length/3);for(c=0;c<a.length;c++)a[c]=c;return a};g.prototype._isOutsideClippingArea=function(a){if(!this._context.clippingExtent)return!1;var c=
a.vertexAttributes&&a.vertexAttributes.position;if(!c)return!1;var b=this._context.elevationProvider.spatialReference,d=c.length/3;a.spatialReference.equals(b)||(c=new Float64Array(c.length),I.bufferToBuffer(a.vertexAttributes.position,a.spatialReference,0,c,b,0,d));r.empty(X);r.expandWithBuffer(X,c,0,d);return!r.intersectsClippingArea(X,this._context.clippingExtent)};g.prototype._createGeometryInfo=function(a,c,b){var e,f;if(!v.canProject(a,this._context.layerView.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),
null;if(this._isOutsideClippingArea(a))return null;var g=this._createBuffers(a,c);if(!g)return null;c=g.positionBuffer;for(var k=g.uvBuffer,h=g.colorBuffer,l=g.symbolColorBuffer,m=g.normalBuffer,q=g.tangentBuffer,g=g.objectTransformation,p=[],r=[],t=[],w=!1,u=0,y=this._getOrCreateComponents(a);u<y.length;u++){var z=y[u];if(!this._validateFaces(a,z))return null;var A=this._getOrCreateFaces(a,z);if(0!==A.length){var B=this._createComponentNormals(c,m,z,A);B.didFlipNormals&&(w=!0);var C=(e={},e[R.POSITION]=
{size:3,data:c},e[R.NORMAL]={size:3,data:B.normals},e),B=(f={},f[R.POSITION]=A,f[R.NORMAL]=B.indices,f);h&&(C[R.COLOR]={size:4,data:h},B[R.COLOR]=A);l&&(C[R.SYMBOLCOLOR]={size:4,data:l},B[R.SYMBOLCOLOR]=this._createColorIndices(A));a.vertexAttributes.uv&&(C[R.UV0]={size:2,data:k},B[R.UV0]=A);a.vertexAttributes.tangent&&(C[R.TANGENT]={size:4,data:q},B[R.TANGENT]=A);A=new J.GeometryData(C,B);A=new G(A,b+"_mesh");p.push(A);r.push(d.mat4f64.create());t.push(this._getOrCreateMaterial(a,z))}}w&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");
return{geometries:p,transformations:r,materials:t,objectTransformation:g}};g.prototype._createEdgeMaterial=function(){var a={opacity:this._getLayerOpacity()};return C.createMaterial(this.symbolLayer,a)};g.validGeometryTypes=["mesh"];return g}(B.default);b.Graphics3DMeshFillSymbolLayer=n;var W=k.vec3f64.create(),O=k.vec3f64.create(),U=k.vec3f64.create(),P=k.vec3f64.create(),ba=k.vec3f64.create(),V=d.mat4f64.create(),T=g.mat3f64.create(),X=r.create(),Y=[new t];b.default=n})},"esri/geometry/support/MeshComponent":function(){define("require exports tslib ../../core/Accessor ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./MeshMaterial ./MeshMaterialMetallicRoughness ./MeshVertexAttributes".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c){var k=e.getLogger("esri.geometry.support.MeshComponent");return function(b){function e(a){a=b.call(this,a)||this;a.faces=null;a.material=null;a.shading="source";a.trustSourceNormals=!1;return a}a.__extends(e,b);m=e;e.from=function(a){return g.ensureClass(m,a)};e.prototype.castFaces=function(a){return c.castArray(a,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},k)};e.prototype.castMaterial=function(a){return a&&"object"===typeof a&&("metallic"in a||"roughness"in
a||"metallicRoughnessTexture"in a)?g.ensureClass(d,a):g.ensureClass(l,a)};e.prototype.clone=function(){return new m({faces:h.clone(this.faces),shading:this.shading,material:h.clone(this.material),trustSourceNormals:this.trustSourceNormals})};e.prototype.cloneWithDeduplication=function(a,c){return new m({faces:h.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(a,c):null,trustSourceNormals:this.trustSourceNormals})};var m;a.__decorate([f.property({json:{write:!0}})],
e.prototype,"faces",void 0);a.__decorate([f.cast("faces")],e.prototype,"castFaces",null);a.__decorate([f.property({type:l,json:{write:!0}})],e.prototype,"material",void 0);a.__decorate([f.cast("material")],e.prototype,"castMaterial",null);a.__decorate([f.property({type:String,json:{write:!0}})],e.prototype,"shading",void 0);a.__decorate([f.property({type:Boolean})],e.prototype,"trustSourceNormals",void 0);return e=m=a.__decorate([f.subclass("esri.geometry.support.MeshComponent")],e)}(m)})},"esri/geometry/support/MeshMaterial":function(){define("require exports tslib ../../Color ../../core/JSONSupport ../../core/lang ../../core/maybe ../../core/accessorSupport/decorators ./MeshTexture".split(" "),
function(n,b,a,m,h,e,f,g,l){return function(b){function c(a){a=b.call(this,a)||this;a.color=null;a.colorTexture=null;a.normalTexture=null;a.alphaMode="auto";a.alphaCutoff=.5;a.doubleSided=!0;return a}a.__extends(c,b);d=c;c.prototype.clone=function(){return this.cloneWithDeduplication(null,new Map)};c.prototype.cloneWithDeduplication=function(a,c){var b=f.isSome(a)?a.get(this):null;if(b)return b;c=new d(this.clonePropertiesWithDeduplication(c));f.isSome(a)&&a.set(this,c);return c};c.prototype.clonePropertiesWithDeduplication=
function(a){return{color:e.clone(this.color),colorTexture:this.colorTexture?this.colorTexture.cloneWithDeduplication(a):null,normalTexture:this.normalTexture?this.normalTexture.cloneWithDeduplication(a):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}};var d;a.__decorate([g.property({type:m,json:{write:!0}})],c.prototype,"color",void 0);a.__decorate([g.property({type:l,json:{write:!0}})],c.prototype,"colorTexture",void 0);a.__decorate([g.property({type:l,json:{write:!0}})],
c.prototype,"normalTexture",void 0);a.__decorate([g.property({json:{write:!0}})],c.prototype,"alphaMode",void 0);a.__decorate([g.property({json:{write:!0}})],c.prototype,"alphaCutoff",void 0);a.__decorate([g.property({json:{write:!0}})],c.prototype,"doubleSided",void 0);return c=d=a.__decorate([g.subclass("esri.geometry.support.MeshMaterial")],c)}(h.JSONSupport)})},"esri/geometry/support/MeshTexture":function(){define("require exports tslib @dojo/framework/shim/WeakMap ../../core/compilerUtils ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../support/persistableUrlUtils ../../views/support/screenshotUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d){var c=new m.default,k=0;return function(b){function e(a){a=b.call(this,a)||this;a.wrap="repeat";return a}a.__extends(e,b);m=e;Object.defineProperty(e.prototype,"url",{get:function(){return this._get("url")||null},set:function(a){this._set("url",a);a&&this._set("data",null)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"data",{get:function(){return this._get("data")||null},set:function(a){this._set("data",a);a&&this._set("url",null)},enumerable:!0,
configurable:!0});e.prototype.writeData=function(a,c,b,d){a instanceof HTMLImageElement?a={type:"image-element",src:l.toJSON(a.src,d),crossOrigin:a.crossOrigin}:a instanceof HTMLCanvasElement?(a=a.getContext("2d").getImageData(0,0,a.width,a.height),a={type:"canvas-element",imageData:this.encodeImageData(a)}):a=a instanceof HTMLVideoElement?{type:"video-element",src:l.toJSON(a.src,d),autoplay:a.autoplay,loop:a.loop,muted:a.muted,crossOrigin:a.crossOrigin,preload:a.preload}:{type:"image-data",imageData:this.encodeImageData(a)};
c[b]=a};e.prototype.readData=function(a){switch(a.type){case "image-element":var c=new Image;c.src=a.src;c.crossOrigin=a.crossOrigin;return c;case "canvas-element":return a=this.decodeImageData(a.imageData),c=document.createElement("canvas"),c.width=a.width,c.height=a.height,c.getContext("2d").putImageData(a,0,0),c;case "image-data":return this.decodeImageData(a.imageData);case "video-element":return c=document.createElement("video"),c.src=a.src,c.crossOrigin=a.crossOrigin,c.autoplay=a.autoplay,c.loop=
a.loop,c.muted=a.muted,c.preload=a.preload,c;default:h.neverReached(a)}};Object.defineProperty(e.prototype,"transparent",{get:function(){var a=this.data,c=this.url;return a instanceof HTMLCanvasElement?this.imageDataContainsTransparent(a.getContext("2d").getImageData(0,0,a.width,a.height)):a instanceof ImageData?this.imageDataContainsTransparent(a):c&&(a=c.substr(c.length-4,4).toLowerCase(),c=c.substr(0,15).toLocaleLowerCase(),".png"===a||"data:image/png;"===c)?!0:!1},set:function(a){null!=a?this._override("transparent",
a):this._clearOverride("transparent")},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"contentHash",{get:function(){var a=this,b="string"===typeof this.wrap?this.wrap:"object"===typeof this.wrap?this.wrap.horizontal+"/"+this.wrap.vertical:"",d=function(c){void 0===c&&(c="");return"d:"+c+",t:"+a.transparent+",w:"+b};if(null!=this.url)return d(this.url);if(null!=this.data){if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement)return d(this.data.src);c.has(this.data)||
c.set(this.data,++k);return d(c.get(this.data))}return d()},enumerable:!0,configurable:!0});e.prototype.clone=function(){return new m({url:this.url,data:this.data,wrap:this.cloneWrap()})};e.prototype.cloneWithDeduplication=function(a){var c=a.get(this);if(c)return c;c=new m({url:this.url,data:this.data,wrap:this.cloneWrap()});a.set(this,c);return c};e.prototype.cloneWrap=function(){return"string"===typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};e.prototype.encodeImageData=
function(a){for(var c="",b=0;b<a.data.length;b++)c+=String.fromCharCode(a.data[b]);return{data:btoa(c),width:a.width,height:a.height}};e.prototype.decodeImageData=function(a){for(var c=atob(a.data),b=new Uint8ClampedArray(c.length),e=0;e<c.length;e++)b[e]=c.charCodeAt(e);return d.wrapImageData(b,a.width,a.height)};e.prototype.imageDataContainsTransparent=function(a){for(var c=3;c<a.data.length;c+=4)if(255!==a.data[c])return!0;return!1};e.from=function(a){return"string"===typeof a?new m({url:a}):a instanceof
HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof ImageData||a instanceof HTMLVideoElement?new m({data:a}):g.ensureClass(m,a)};var m;a.__decorate([f.property({type:String,json:{write:l.write}})],e.prototype,"url",null);a.__decorate([f.property({json:{write:{overridePolicy:function(){return{enabled:!this.url}}}}}),f.property()],e.prototype,"data",null);a.__decorate([f.writer("data")],e.prototype,"writeData",null);a.__decorate([f.reader("data")],e.prototype,"readData",null);a.__decorate([f.property({type:Boolean,
dependsOn:["data","url"],json:{write:{overridePolicy:function(){return{enabled:this._isOverridden("transparent")}}}}})],e.prototype,"transparent",null);a.__decorate([f.property({json:{write:!0}})],e.prototype,"wrap",void 0);a.__decorate([f.property({readOnly:!0,dependsOn:["url","data","wrap","transparent"]})],e.prototype,"contentHash",null);return e=m=a.__decorate([f.subclass("esri.geometry.support.MeshTexture")],e)}(e.JSONSupport)})},"esri/views/support/screenshotUtils":function(){define(["require",
"exports","tslib","../../core/compilerUtils","../../core/mathUtils"],function(n,b,a,m,h){function e(a,b){var e=a||{},f=e.format,g=e.quality,k=e.rotation,e=e.disableSlice,p=c(a,b.padding),r;r=b.width-p.left-p.right;b=b.height-p.top-p.bottom;p={x:0,y:0,width:r,height:b};if(a&&a.area){null!=a.area.x&&(p.x=Math.floor(a.area.x));null!=a.area.y&&(p.y=Math.floor(a.area.y));var w=null!=a.area.width?Math.floor(a.area.width):null,v=null!=a.area.height?Math.floor(a.area.height):null;p.width=r-p.x;p.height=b-
p.y;null!=w&&null!=v?(p.width=Math.min(p.width,w),p.height=Math.min(p.height,v)):null==w&&null!=v?(w=Math.min(p.width,w),p.height*=w/p.width,p.width=w):null!=w&&null==v&&(w=Math.min(p.height,v),p.width*=w/p.height,p.height=w)}p=d(p,a);w=Math.floor(Math.max(p.x,0));v=Math.floor(Math.max(p.y,0));r={x:w,y:v,width:Math.floor(Math.min(p.width,r-w)),height:Math.floor(Math.min(p.height,b-v))};b=r.width/r.height;p=p.width/p.height;p!==b&&(p>b?(b=Math.floor(r.width/p),r={x:r.x,y:Math.floor(r.y+(r.height-b)/
2),width:r.width,height:b}):(b=Math.floor(r.height*p),r={x:Math.floor(r.x+(r.width-b)/2),y:r.y,width:b,height:r.height}));p=l(a,r);b=p.width;p=p.height;a:switch(f){case "png":case "jpg":case "jpeg":break a;case null:case void 0:f=t;break a;default:m.neverReached(f),f=t}w=u[f];g=h.clamp(null!=g?g:w,0,100);return{format:f,quality:g,area:r,width:b,height:p,rotation:k,disableSlice:!!e,ignoreBackground:!(!a||!a.ignoreBackground),ignorePadding:!(!a||!a.ignorePadding)}}function f(a,c){return a.toDataURL(r[c.format],
c.quality/100)}function g(a,c,b){b||(k||(k=document.createElement("canvas"),k.width=1,k.height=1),b=k);return b.getContext("2d").createImageData(a,c)}function l(a,c){if(!a)return c;var b=a.width;a=a.height;if(null!=b&&null!=a)return{width:Math.floor(b),height:Math.floor(a)};if(null==b&&null==a)return c;c=c.width/c.height;return null==a?{width:Math.floor(b),height:Math.floor(b/c)}:{width:Math.floor(a*c),height:Math.floor(a)}}function d(a,c){if(!c||null==c.width||null==c.height)return a;c=c.width/c.height;
var b=a.width/a.height;if(b===c)return a;if(b<c)return c=Math.floor(a.height*c),a.x-=(c-a.width)/2,a.width=c,a;c=Math.floor(a.width/c);a.y-=(c-a.height)/2;a.height=c;return a}function c(a,c){return!c||a&&a.ignorePadding?v:c}Object.defineProperty(b,"__esModule",{value:!0});b.completeUserSettings=e;b.toRenderSettings=function(a,b){var d=e(a,b),f=d.area,g=d.width/f.width,k=c(d,b.padding),h=k.left+k.right,l=k.top+k.bottom;return{framebufferWidth:Math.floor((b.width-h)*g+h),framebufferHeight:Math.floor((b.height-
l)*g+l),region:{x:Math.floor(f.x*g)+k.left,y:Math.floor(f.y*g)+k.top,width:d.width,height:d.height},format:d.format,quality:d.quality,rotation:d.rotation,pixelRatio:g,layers:a&&a.layers?a.layers:[],disableSlice:d.disableSlice,ignoreBackground:d.ignoreBackground,ignorePadding:d.ignorePadding}};b.encodeResult=function(a,c,b,d){if(d.premultipliedAlpha)for(var e=a.data,g=e.length,k=0;k<g;k+=4){var h=e[k+3];0<h&&(h/=255,e[k+0]/=h,e[k+1]/=h,e[k+2]/=h)}b.width=a.width;b.height=a.height;e=b.getContext("2d");
e.putImageData(a,0,0);d.flipY&&(e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore());a=e.getImageData(0,0,a.width,a.height);c=f(b,c);b.width=0;b.height=0;return{dataUrl:c,data:a}};b.toDataUrl=f;b.createEmptyImageData=function(a,c,b){if(!a||!c)throw Error("Cannot construct image data without dimensions");if(p)try{return new ImageData(a,c)}catch(y){p=!1}return g(a,c,b)};b.wrapImageData=function(a,c,b,d){if(!c||!b)throw Error("Cannot construct image data without dimensions");
if(p)try{return new ImageData(a,c,b)}catch(A){p=!1}c=g(c,b,d);c.data.set(a,0);return c};b.resampleHermite=function(a,c,b,d,e,f,g,k){void 0===d&&(d=0);void 0===e&&(e=0);void 0===f&&(f=a.width-d);void 0===g&&(g=a.height-e);void 0===k&&(k=!1);var h=a.data,l=c.width,m=c.height,p=c.data;f/=l;g/=m;var q=Math.ceil(f/2),r=Math.ceil(g/2);a=a.width;for(var t=0;t<m;t++)for(var w=0;w<l;w++){for(var y=4*(w+(k?m-t-1:t)*l),u=0,v=0,z=0,A=0,B=0,C=0,n=(t+.5)*g,F=Math.floor(t*g);F<(t+1)*g;F++)for(var X=Math.abs(n-(F+
.5))/r,Y=(w+.5)*f,X=X*X,da=Math.floor(w*f);da<(w+1)*f;da++){var fa=Math.abs(Y-(da+.5))/q,fa=Math.sqrt(X+fa*fa);if(!(1<=fa)){var fa=2*fa*fa*fa-3*fa*fa+1,ga=4*(d+da+(e+F)*a),C=C+fa*h[ga+3],v=v+fa;!b&&255>h[ga+3]&&(fa=fa*h[ga+3]/255);z+=fa*h[ga];A+=fa*h[ga+1];B+=fa*h[ga+2];u+=fa}}p[y]=z/u;p[y+1]=A/u;p[y+2]=B/u;p[y+3]=C/v}return c};b.screenshotSuperSampleSettings=function(b,d,e){if(!d)return b;d=b.framebufferWidth;var f=b.framebufferHeight,g=b.pixelRatio,k=b.region;e=c(b,e);var h=e.left+e.right,l=e.top+
e.bottom,m=d-h,p=f-l,q=Math.min(8,Math.min((2048-h)/m,(2048-l)/p));return 1.5>q?b:a.__assign(a.__assign({},b),{framebufferWidth:Math.round(m*q)+h,framebufferHeight:Math.round(p*q)+l,pixelRatio:g*q,resample:{region:{x:Math.round((k.x-e.left)*q)+e.left,y:Math.round((k.y-e.top)*q)+e.top,width:Math.round(k.width*q),height:Math.round(k.height*q)},width:d,height:f}})};var k=null,p=!0,r={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},t="jpg",u={png:100,jpg:98,jpeg:98},v={top:0,right:0,bottom:0,left:0}})},
"esri/geometry/support/MeshMaterialMetallicRoughness":function(){define("require exports tslib ../../Color ../../core/maybe ../../core/accessorSupport/decorators ./MeshMaterial ./MeshTexture".split(" "),function(n,b,a,m,h,e,f,g){return function(b){function d(a){a=b.call(this,a)||this;a.emissiveColor=null;a.emissiveTexture=null;a.occlusionTexture=null;a.metallic=1;a.roughness=1;a.metallicRoughnessTexture=null;return a}a.__extends(d,b);c=d;d.prototype.clone=function(){return this.cloneWithDeduplication(null,
new Map)};d.prototype.cloneWithDeduplication=function(a,b){var d=h.isSome(a)?a.get(this):null;if(d)return d;b=new c(this.clonePropertiesWithDeduplication(b));h.isSome(a)&&a.set(this,b);return b};d.prototype.clonePropertiesWithDeduplication=function(c){return a.__assign(a.__assign({},b.prototype.clonePropertiesWithDeduplication.call(this,c)),{emissiveColor:this.emissiveColor?this.emissiveColor.clone():null,emissiveTexture:this.emissiveTexture?this.emissiveTexture.cloneWithDeduplication(c):null,occlusionTexture:this.occlusionTexture?
this.occlusionTexture.cloneWithDeduplication(c):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?this.metallicRoughnessTexture.cloneWithDeduplication(c):null})};var c;a.__decorate([e.property({type:m,json:{write:!0}})],d.prototype,"emissiveColor",void 0);a.__decorate([e.property({type:g,json:{write:!0}})],d.prototype,"emissiveTexture",void 0);a.__decorate([e.property({type:g,json:{write:!0}})],d.prototype,"occlusionTexture",void 0);a.__decorate([e.property({type:Number,
json:{write:!0},range:{min:0,max:1}})],d.prototype,"metallic",void 0);a.__decorate([e.property({type:Number,json:{write:!0},range:{min:0,max:1}})],d.prototype,"roughness",void 0);a.__decorate([e.property({type:g,json:{write:!0}})],d.prototype,"metallicRoughnessTexture",void 0);return d=c=a.__decorate([e.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],d)}(f)})},"esri/geometry/support/MeshVertexAttributes":function(){define("require exports tslib ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators".split(" "),
function(n,b,a,m,h,e,f){function g(a,c,b,d){var e=c.loggerTag;c=c.stride;return 0!==a.length%c?(d.error(e,"Invalid array length, expected a multiple of "+c),new b([])):a}function l(a,c,b,d,e){if(!a)return a;if(a instanceof c)return g(a,d,c,e);for(var f=0;f<b.length;f++)if(a instanceof b[f])return g(new c(a),d,c,e);if(Array.isArray(a))return g(new c(a),d,c,e);b=b.map(function(a){return"'"+a.name+"'"});e.error("Failed to set property, expected one of "+b+", but got "+a.constructor.name);return new c([])}
function d(a,c,b){for(var d=Array(a.length),e=0;e<a.length;e++)d[e]=a[e];c[b]=d}Object.defineProperty(b,"__esModule",{value:!0});var c=e.getLogger("esri.geometry.support.MeshVertexAttributes");n=function(b){function e(a){a=b.call(this,a)||this;a.color=null;a.position=new Float64Array(0);a.uv=null;a.normal=null;a.tangent=null;return a}a.__extends(e,b);g=e;e.prototype.castColor=function(a){return l(a,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},c)};e.prototype.castPosition=function(a){a&&
a instanceof Float32Array&&c.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return l(a,Float64Array,[Float32Array],{loggerTag:".position\x3d",stride:3},c)};e.prototype.castUv=function(a){return l(a,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},c)};e.prototype.castNormal=function(a){return l(a,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},c)};e.prototype.castTangent=
function(a){return l(a,Float32Array,[Float64Array],{loggerTag:".tangent\x3d",stride:4},c)};e.prototype.clone=function(){var a={position:h.clone(this.position),uv:h.clone(this.uv),normal:h.clone(this.normal),tangent:h.clone(this.tangent),color:h.clone(this.color)};return new g(a)};var g;a.__decorate([f.property({json:{write:d}})],e.prototype,"color",void 0);a.__decorate([f.cast("color")],e.prototype,"castColor",null);a.__decorate([f.property({nonNullable:!0,json:{write:d}})],e.prototype,"position",
void 0);a.__decorate([f.cast("position")],e.prototype,"castPosition",null);a.__decorate([f.property({json:{write:d}})],e.prototype,"uv",void 0);a.__decorate([f.cast("uv")],e.prototype,"castUv",null);a.__decorate([f.property({json:{write:d}})],e.prototype,"normal",void 0);a.__decorate([f.cast("normal")],e.prototype,"castNormal",null);a.__decorate([f.property({json:{write:d}})],e.prototype,"tangent",void 0);a.__decorate([f.cast("tangent")],e.prototype,"castTangent",null);return e=g=a.__decorate([f.subclass("esri.geometry.support.MeshVertexAttributes")],
e)}(m.JSONSupport);b.MeshVertexAttributes=n;b.castArray=l;b.default=n})},"esri/geometry/support/meshUtils/projection":function(){define("require exports ../../../core/Logger ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../views/3d/support/projectionUtils ../../../views/3d/support/buffer/BufferView".split(" "),function(n,b,a,m,h,e,f,g,l,d){function c(a,
c,b,d,e,g){if(c){var k=b.count;if(e.isWGS84)for(e=0;e<k;e++)d.getVec(e,p),c.getVec(e,r),l.computeLinearTransformation(l.SphericalECEFSpatialReference,p,t,l.SphericalECEFSpatialReference),m.mat3.fromMat4(u,t),1===a&&m.mat3.transpose(u,u),f.vec3.transformMat3(r,r,u),g.setVec(e,r);else for(e=0;e<k;e++){d.getVec(e,p);c.getVec(e,r);l.computeLinearTransformation(l.SphericalECEFSpatialReference,p,t,l.SphericalECEFSpatialReference);m.mat3.fromMat4(u,t);var h=l.webMercator.y2lat(b.get(e,1)),h=Math.cos(h);
0===a&&(h=1/h);u[0]*=h;u[1]*=h;u[2]*=h;u[3]*=h;u[4]*=h;u[5]*=h;1===a&&m.mat3.transpose(u,u);f.vec3.transformMat3(r,r,u);f.vec3.normalize(r,r);g.setVec(e,r)}return g}}Object.defineProperty(b,"__esModule",{value:!0});var k=a.getLogger("esri.geometry.support.meshUtils.normalProjection");b.projectNormalToECEF=function(a,b,e,f,g){if(!f.isWebMercator&&!f.isWGS84)return k.error("Cannot convert PCS spatial reference buffer to ECEF"),g;c(0,d.BufferViewVec3f.fromTypedArray(a),d.BufferViewVec3f64.fromTypedArray(b),
d.BufferViewVec3f64.fromTypedArray(e),f,d.BufferViewVec3f.fromTypedArray(g));return g};b.projectNormalFromECEF=function(a,b,e,f,g){if(!f.isWebMercator&&!f.isWGS84)return k.error("Cannot convert to PCS spatial reference buffer from ECEF"),g;c(1,d.BufferViewVec3f.fromTypedArray(a),d.BufferViewVec3f64.fromTypedArray(b),d.BufferViewVec3f64.fromTypedArray(e),f,d.BufferViewVec3f.fromTypedArray(g));return g};b.projectToECEF=function(a,c,b){l.bufferToBuffer(a,c,0,b,l.SphericalECEFSpatialReference,0,a.length/
3);return b};b.projectFromECEF=function(a,c,b){l.bufferToBuffer(a,l.SphericalECEFSpatialReference,0,c,b,0,a.length/3);return c};b.transformBufferInPlace=function(a,c,b){void 0===b&&(b=!1);if(a)for(var d=0;d<a.length;d+=3){for(var e=0;3>e;e++)p[e]=a[d+e];f.vec3.transformMat4(p,p,c);b&&f.vec3.normalize(p,p);for(e=0;3>e;e++)a[d+e]=p[e]}};b.projectTangentToECEF=function(a,b,e,f,g){if(!f.isWebMercator&&!f.isWGS84)return k.error("Cannot convert PCS spatial reference buffer to ECEF"),g;c(0,d.BufferViewVec3f.fromTypedArray(a,
4*Float32Array.BYTES_PER_ELEMENT),d.BufferViewVec3f64.fromTypedArray(b),d.BufferViewVec3f64.fromTypedArray(e),f,d.BufferViewVec3f.fromTypedArray(g,4*Float32Array.BYTES_PER_ELEMENT));for(b=3;b<a.length;b+=4)g[b]=a[b];return g};b.projectTangentFromECEF=function(a,b,e,f,g){if(!f.isWebMercator&&!f.isWGS84)return k.error("Cannot convert to PCS spatial reference buffer from ECEF"),g;c(1,d.BufferViewVec3f.fromTypedArray(a,16),d.BufferViewVec3f64.fromTypedArray(b),d.BufferViewVec3f64.fromTypedArray(e),f,
d.BufferViewVec3f.fromTypedArray(g,16));for(b=3;b<a.length;b+=4)g[b]=a[b];return g};var p=g.vec3f64.create(),r=g.vec3f64.create(),t=e.mat4f64.create(),u=h.mat3f64.create()})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/maybe"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.parseColorMixMode=function(a){switch(a){case "multiply":return 1;case "ignore":return 2;case "replace":return 3;case "tint":return 4;
default:return 1}};b.encodeSymbolColor=function(b,d,c){if(m.isNone(b)||2===d)c[0]=255,c[1]=255,c[2]=255,c[3]=255;else{var k=a.clamp(Math.round(b[3]*e),0,e);d=0===k||4===d?0:3===d?f:g;c[0]=a.clamp(Math.round(b[0]*h),0,h);c[1]=a.clamp(Math.round(b[1]*h),0,h);c[2]=a.clamp(Math.round(b[2]*h),0,h);c[3]=k+d}};var h=255,e=85,f=e,g=2*e})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("require exports tslib ../../../../core/Logger ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/buffer/BufferView ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ./internal/MaterialUtil ./renderers/MergedRenderer ./renderers/utils ../shaders/NativeLineTechnique".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y){var A=m.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");n=function(c){function b(a,b){b=c.call(this,b)||this;b.techniqueConfig=new y.NativeLineTechniqueConfiguration;b.params=z.copyParameters(a,F);return b}a.__extends(b,c);b.prototype.setParameterValues=function(a){var c=this.params,b;for(b in a)c[b]=a[b];this.parametersChanged()};b.prototype.getParameters=function(){return this.params};b.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=
a;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.vertexColors=this.params.vertexColors;this.techniqueConfig.transparent=1>this.params.color[3]||1>this.params.width;a=h.isSome(this.params.stipplePattern);this.techniqueConfig.stippleEnabled=a;this.techniqueConfig.stippleOffColorEnabled=a&&h.isSome(this.params.stippleOffColor);this.techniqueConfig.stippleIntegerRepeatsEnabled=a&&this.params.stippleIntegerRepeats;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;
return this.techniqueConfig};b.prototype.getPassParameters=function(){return this.params};b.prototype.intersect=function(a,c,b,d,e,f,g,k,h){h?z.intersectDrapedRenderLineGeometry(a,d,f,1,g):this.intersectLineGeometry(a,c,b,d,g)};b.prototype.intersectLineGeometry=function(a,c,b,e,k){if(e.options.selectionMode&&!q.isInstanceHidden(c))if(t.isTranslationMatrix(b)){c=a.data.getVertexAttr().position.data;var h=e.camera,l=W;f.vec2.copy(l,e.point);g.vec3.set(O[0],l[0]-2,l[1]+2,0);g.vec3.set(O[1],l[0]+2,l[1]+
2,0);g.vec3.set(O[2],l[0]+2,l[1]-2,0);g.vec3.set(O[3],l[0]-2,l[1]-2,0);for(var m=0;4>m;m++)h.unprojectPoint(O[m],U[m]);d.plane.fromPoints(h.eye,U[0],U[1],P);d.plane.fromPoints(h.eye,U[1],U[2],ba);d.plane.fromPoints(h.eye,U[2],U[3],V);d.plane.fromPoints(h.eye,U[3],U[0],T);a=Number.MAX_VALUE;for(m=0;m<c.length-5;m+=3)if(H[0]=c[m]+b[12],H[1]=c[m+1]+b[13],H[2]=c[m+2]+b[14],I[0]=c[m+3]+b[12],I[1]=c[m+4]+b[13],I[2]=c[m+5]+b[14],!(0>d.plane.signedDistance(P,H)&&0>d.plane.signedDistance(P,I)||0>d.plane.signedDistance(ba,
H)&&0>d.plane.signedDistance(ba,I)||0>d.plane.signedDistance(V,H)&&0>d.plane.signedDistance(V,I)||0>d.plane.signedDistance(T,H)&&0>d.plane.signedDistance(T,I))){h.projectPoint(H,E);h.projectPoint(I,L);if(0>E[2]&&0<L[2]){g.vec3.subtract(G,H,I);var p=h.frustum,r=-d.plane.signedDistance(p.planes[4],H),p=r/g.vec3.dot(G,d.plane.normal(p.planes[4]));g.vec3.scale(G,G,p);g.vec3.add(H,H,G);h.projectPoint(H,E)}else if(0<E[2]&&0>L[2])g.vec3.subtract(G,I,H),p=h.frustum,r=-d.plane.signedDistance(p.planes[4],I),
p=r/g.vec3.dot(G,d.plane.normal(p.planes[4])),g.vec3.scale(G,G,p),g.vec3.add(I,I,G),h.projectPoint(I,L);else if(0>E[2]&&0>L[2])continue;E[2]=0;L[2]=0;p=d.lineSegment.distance2(d.lineSegment.fromPoints(E,L,Q),l);p<a&&(a=p,g.vec3.copy(M,H),g.vec3.copy(N,I))}b=e.rayBeginPoint;e=e.rayEndPoint;4>a&&(a=Number.MAX_VALUE,d.lineSegment.closestLineSegmentPoint(d.lineSegment.fromPoints(M,N,Q),d.lineSegment.fromPoints(b,e,R),J)&&(g.vec3.subtract(J,J,b),a=g.vec3.length(J),g.vec3.scale(J,J,1/a),a/=g.vec3.distance(b,
e)),k(a,J))}else A.error("intersection assumes a translation-only matrix")};b.prototype.computeAttachmentOrigin=function(a,c){a=a.data;return(a="getVertexAttr"in a?a.getVertexAttr():"vertexAttr"in a?a.vertexAttr:null)?k.computeAttachmentOriginLines(a[t.VertexAttrConstants.POSITION],null,!1,c):null};b.prototype.createBufferWriter=function(){var a=this.params.vertexColors?v.PositionColorLayout:v.PositionLayout;return h.isNone(this.params.stipplePattern)?new v.DefaultBufferWriter(a):new C(a.clone().vec3f(t.VertexAttrConstants.AUXPOS1))};
b.prototype.createRenderer=function(a,c){return new w(a,c,this)};b.prototype.getGLMaterial=function(a){return 0===a.output||4===a.output?new B(a):void 0};return b}(r.Material);var B=function(c){function b(a){a=c.call(this,a)||this;a.updateParameters();return a}a.__extends(b,c);b.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(y.NativeLineTechnique,this.material.getTechniqueConfig(this.output),this.technique)};b.prototype.beginSlot=function(a){return 3===
a};b.prototype._updateOccludeeState=function(a){a.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:a.hasOccludees}),this.updateParameters())};b.prototype.ensureParameters=function(a){0===this.output&&this._updateOccludeeState(a)};b.prototype.bind=function(a,c){a.bindProgram(this.technique.program);this.technique.bindPass(a,this.material.getPassParameters(),c)};b.prototype.getPipelineState=function(a,c){return c?this.technique.opaqueOccludeeState:
this.technique.pipeline};return b}(p.GLMaterial),C=function(){function a(a){this.vertexBufferLayout=a}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices[t.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,c,b,d){u.writeDefaultAttributes(c,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,b,d);this.writeAuxpos1(a,c,b,d)};a.prototype.writeAuxpos1=function(a,b,d,e){var f=d.getField(t.VertexAttrConstants.AUXPOS1,
c.BufferViewVec3f);d=b.indices[t.VertexAttrConstants.POSITION];b=b.vertexAttr[t.VertexAttrConstants.POSITION].data;a=a.transformation;var g=f.typedBufferStride,f=f.typedBuffer;e*=g;for(var k=0;k<d.length;k+=2)for(var h=3*d[k],l=b[h],m=b[h+1],p=b[h+2],h=a[0]*l+a[4]*m+a[8]*p+a[12],q=a[1]*l+a[5]*m+a[9]*p+a[13],l=a[2]*l+a[6]*m+a[10]*p+a[14],m=0;2>m;++m)f[e]=h,f[e+1]=q,f[e+2]=l,e+=g};return a}(),F={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,
stippleOffColor:null,sceneHasOcludees:!1},H=l.vec3f64.create(),I=l.vec3f64.create(),G=l.vec3f64.create(),J=l.vec3f64.create(),E=e.createRenderScreenPointArray3(),L=e.createRenderScreenPointArray3(),M=l.vec3f64.create(),N=l.vec3f64.create(),Q=d.lineSegment.create(),R=d.lineSegment.create(),W=l.vec3f64.create(),O=[e.createRenderScreenPointArray3(),e.createRenderScreenPointArray3(),e.createRenderScreenPointArray3(),e.createRenderScreenPointArray3()],U=[l.vec3f64.create(),l.vec3f64.create(),l.vec3f64.create(),
l.vec3f64.create()],P=d.plane.create(),ba=d.plane.create(),V=d.plane.create(),T=d.plane.create();return n})},"esri/views/3d/webgl-engine/materials/internal/DefaultBufferWriter":function(){define(["require","exports","../../../support/buffer/InterleavedLayout","../../lib/Util","./bufferWriterUtils"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.PositionLayout=a.newLayout().vec3f(m.VertexAttrConstants.POSITION);b.PositionUVLayout=a.newLayout().vec3f(m.VertexAttrConstants.POSITION).vec2f(m.VertexAttrConstants.UV0);
b.PositionColorLayout=a.newLayout().vec3f(m.VertexAttrConstants.POSITION).vec4u8(m.VertexAttrConstants.COLOR);n=function(){function a(a){this.vertexBufferLayout=a}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices[m.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,e,d){h.writeDefaultAttributes(b,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,e,d)};return a}();b.DefaultBufferWriter=
n})},"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":function(){define("require exports tslib ../../../../core/maybe ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/StencilUtils ./NativeLine.glsl ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t){Object.defineProperty(b,"__esModule",{value:!0});l=function(b){function d(a,c){c=b.call(this,a,c)||this;c.stipplePattern=null;c.stippleTextureBind=null;c.stippleTextureRepository=a.stippleTextureRepository;return c}a.__extends(d,b);d.prototype.initializeProgram=function(a){var b=d.shader.get(),e=this.configuration,b=b.build({output:e.output,attributeColor:e.vertexColors,slicePlaneEnabled:e.slicePlaneEnabled,sliceHighlightDisabled:e.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,
stippleEnabled:e.stippleEnabled,stippleOffColorEnabled:e.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:e.stippleIntegerRepeatsEnabled});return new r(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),c.Default3D)};d.prototype.dispose=function(){b.prototype.dispose.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};d.prototype.bindPass=function(a,c,b){if(this.stipplePattern!==c.stipplePattern){var d=
c.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,d);this.stipplePattern=d}this.configuration.stippleEnabled&&(d=m.isSome(this.stippleTextureBind)?this.stippleTextureBind(a,0)*b.pixelRatio:1,this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/d),this.program.setUniform2f("ndcToPixel",b.viewport[2]/2,b.viewport[3]/2));0===this.configuration.output?(this.program.setUniform4fv("constantColor",c.color),
this.program.setUniform1f("alphaCoverage",Math.min(1,c.width*b.pixelRatio)),this.configuration.stippleOffColorEnabled&&(a=m.unwrap(c.stippleOffColor),this.program.setUniform4f("stippleOffColor",a[0],a[1],a[2],3<a.length?a[3]:1))):f.OutputHighlight.bindOutputHighlight(a,this.program,b)};d.prototype.bindDraw=function(a){e.Transform.bindUniforms(this.program,a);h.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};d.prototype.initializePipeline=function(){var a=this.configuration,c=t.separateBlendingParams(770,
1,771,771),b=function(c,b,d){void 0===b&&(b=null);void 0===d&&(d=null);return t.makePipelineState({blending:b,depthTest:k.depthCompareLess,depthWrite:d,colorWrite:t.defaultColorWriteParams,stencilWrite:a.sceneHasOcludees?k.stencilWriteMaskOn:null,stencilTest:a.sceneHasOcludees?c?k.stencilToolMaskBaseParams:k.stencilBaseAllZerosParams:null})};return 0===a.output?(this._occludeeState=b(!0,a.transparent||a.stippleEnabled?c:null,t.defaultDepthWriteParams),b(!1,a.transparent||a.stippleEnabled?c:null,t.defaultDepthWriteParams)):
b(!1)};Object.defineProperty(d.prototype,"primitiveType",{get:function(){return 1},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"opaqueOccludeeState",{get:function(){return this._occludeeState},enumerable:!0,configurable:!0});d.shader=new g.ReloadableShaderModule(p,function(){return new Promise(function(a,c){n(["./NativeLine.glsl"],a,c)})});return d}(l.ShaderTechnique);b.NativeLineTechnique=l;l=function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.output=0;
a.slicePlaneEnabled=!1;a.sliceHighlightDisabled=!1;a.vertexColors=!1;a.transparent=!1;a.stippleEnabled=!1;a.stippleOffColorEnabled=!1;a.stippleIntegerRepeatsEnabled=!1;a.sceneHasOcludees=!1;return a}a.__extends(b,c);a.__decorate([d.parameter({count:7})],b.prototype,"output",void 0);a.__decorate([d.parameter()],b.prototype,"slicePlaneEnabled",void 0);a.__decorate([d.parameter()],b.prototype,"sliceHighlightDisabled",void 0);a.__decorate([d.parameter()],b.prototype,"vertexColors",void 0);a.__decorate([d.parameter()],
b.prototype,"transparent",void 0);a.__decorate([d.parameter()],b.prototype,"stippleEnabled",void 0);a.__decorate([d.parameter()],b.prototype,"stippleOffColorEnabled",void 0);a.__decorate([d.parameter()],b.prototype,"stippleIntegerRepeatsEnabled",void 0);a.__decorate([d.parameter()],b.prototype,"sceneHasOcludees",void 0);return b}(d.ShaderTechniqueConfiguration);b.NativeLineTechniqueConfiguration=l})},"esri/views/3d/webgl-engine/shaders/NativeLine.glsl":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/VertexColor.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/LineStipple.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,b,a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var u=new d.ShaderBuilder;u.include(h.Transform,{linearDepth:!1});u.include(e.VertexColor,b);u.include(g.LineStipple,b);u.vertex.uniforms.add("proj","mat4").add("view","mat4");u.attributes.add("position","vec3");u.varyings.add("vpos","vec3");u.vertex.code.add(l.glsl(c||(c=a.__makeTemplateObject(["\n    void main(void) {\n      vpos \x3d position;\n      forwardNormalizedVertexColor();\n      gl_Position \x3d transformPosition(proj, view, vpos);\n  "],
["\n    void main(void) {\n      vpos \x3d position;\n      forwardNormalizedVertexColor();\n      gl_Position \x3d transformPosition(proj, view, vpos);\n  "]))));b.stippleEnabled&&(u.attributes.add("auxpos1","vec3"),u.vertex.uniforms.add("ndcToPixel","vec2"),u.vertex.code.add(l.glsl(k||(k=a.__makeTemplateObject(["\n    vec4 vpos2 \x3d transformPosition(proj, view, auxpos1);\n    float lineSegmentPixelSize \x3d length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);\n\n    stipplePatternUv \x3d lineSegmentPixelSize * stipplePatternPixelSizeInv;\n    ",
"\n\n    // Cancel out perspective correct interpolation because we want this length the really represent\n    // the screen distance\n    stipplePatternUv *\x3d gl_Position.w;\n    "],["\n    vec4 vpos2 \x3d transformPosition(proj, view, auxpos1);\n    float lineSegmentPixelSize \x3d length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);\n\n    stipplePatternUv \x3d lineSegmentPixelSize * stipplePatternPixelSizeInv;\n    ","\n\n    // Cancel out perspective correct interpolation because we want this length the really represent\n    // the screen distance\n    stipplePatternUv *\x3d gl_Position.w;\n    "])),
b.stippleIntegerRepeatsEnabled?"stipplePatternUv \x3d floor(stipplePatternUv + 0.5);":"")));u.vertex.code.add(l.glsl(p||(p=a.__makeTemplateObject(["\n  }\n  "],["\n  }\n  "]))));0===b.output&&(u.include(m.Slice,b),u.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),u.fragment.code.add(l.glsl(r||(r=a.__makeTemplateObject(["\n    void main() {\n      discardBySlice(vpos);\n\n      vec4 color \x3d ",";\n\n      float stippleAlpha \x3d getStippleAlpha();\n      discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n      gl_FragColor \x3d highlightSlice(blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha), vpos);\n    }\n    "],
["\n    void main() {\n      discardBySlice(vpos);\n\n      vec4 color \x3d ",";\n\n      float stippleAlpha \x3d getStippleAlpha();\n      discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n      gl_FragColor \x3d highlightSlice(blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha), vpos);\n    }\n    "])),b.attributeColor?"vColor":"constantColor")));4===b.output&&(u.include(m.Slice,b),u.include(f.OutputHighlight),u.fragment.code.add(l.glsl(t||(t=a.__makeTemplateObject(["\n    void main() {\n      discardBySlice(vpos);\n      discardByStippleAlpha(getStippleAlpha(), STIPPLE_ALPHA_HIGHLIGHT_DISCARD);\n      outputHighlight();\n    }\n    "],
["\n    void main() {\n      discardBySlice(vpos);\n      discardByStippleAlpha(getStippleAlpha(), STIPPLE_ALPHA_HIGHLIGHT_DISCARD);\n      outputHighlight();\n    }\n    "])))));return u};var c,k,p,r,t})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("require exports tslib ../../../../Color ../../../../core/lang ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lodResourceUtils ./objectResourceUtils ./pointUtils ./primitiveObjectSymbolUtils ./symbolComplexity ../support/FastSymbolUpdates ../../support/projectionUtils ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function l(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._removeResource=null;a._optionalFields=[];a._instanceIndexToGraphicUid=new Map;a.ensureDrapedStatus(!1);return a}a.__extends(l,b);l.prototype.getCachedSize=function(){var a=this._symbolSize;return{width:a[0],depth:a[1],height:a[2]}};l.prototype.doLoad=function(c){return a.__awaiter(this,void 0,void 0,function(){var b,
d,e,f;return a.__generator(this,function(a){switch(a.label){case 0:b=this._getIdHint("_objectmat");if(!this._drivenProperties.size&&(d=q.validateSymbolLayerSize(this.symbolLayer)))throw Error();e=this.symbolLayer;return this.isByResource?[4,this._prepareModelResources(e.resource.href,c)]:[3,2];case 1:return a.sent(),[3,3];case 2:f=e.resource?e.resource.primitive:r.defaultPrimitive,this._preparePrimitiveResources(f,b),a.label=3;case 3:return[2]}})})};Object.defineProperty(l.prototype,"isByResource",
{get:function(){return!(!this.symbolLayer.resource||!this.symbolLayer.resource.href)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"lodRenderer",{get:function(){return this._lodRenderer},enumerable:!0,configurable:!0});l.prototype.setMaterialTransparencyParams=function(a,c){void 0===c&&(c=e.get(this.symbolLayer,"material","color"));c=this._getCombinedOpacity(c);a.transparent=1>c||this.needsDrivenTransparentPass;a.opacity=c;return a};l.prototype._preparePrimitiveResources=function(a,
b){if(!C.isValidPrimitive(a))throw Error("Unknown object symbol primitive: "+a);var d=this.symbolLayer;this._resourceBoundingBox=p.create(C.primitiveBoundingBox(a));this._resourceSize=c.vec3f64.fromArray(p.size(this._resourceBoundingBox));this._symbolSize=c.vec3f64.fromArray(q.computeSizeWithResourceSize(this._resourceSize,d));this._isWosr=this._isEsriSymbolResource=!1;var g={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,instanced:["transformation"],ambient:c.vec3f64.ONES,diffuse:c.vec3f64.ONES,
slicePlaneEnabled:this._context.slicePlaneEnabled,sliceHighlightDisabled:!0,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:this.symbolLayer.isPrimitive};this._physicalBasedRenderingEnabled=g.usePBR;this.setMaterialTransparencyParams(g);var l=this.symbol;if("point-3d"===l.type&&l.verticalOffset){var l=l.verticalOffset,r=l.minWorldLength,t=l.maxWorldLength;g.verticalOffset={screenLength:f.pt2px(l.screenLength),minWorldLength:r||0,maxWorldLength:null!=t?t:Infinity};g.castShadows=
!1}this._context.screenSizePerspectiveEnabled&&(g.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._drivenProperties.color?g.externalColor=k.vec4f64.ONES:(d=e.isSome(d.material)&&d.material.color,d=e.isSome(d)?m.toUnitRGBA(d):k.vec4f64.ONES,g.externalColor=d);this._fastUpdates=H.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(h.mixin(g,this._fastUpdates.materialParameters),g.instanced.push("featureAttribute"),
this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(g.instanced.push("color"),this._optionalFields.push("color"));g=new L(g,b);this._lodResources=C.primitiveLodResources(a,g,b);this._originalMaterialParameters=E.materialsFromLodResources(this._lodResources).map(function(a){return{opacity:1,transparent:a.getParameters().transparent}});if(!this._lodResources)throw Error("Unknown object symbol primitive: "+a);this._finalizeSymbolResources();this._initializeLodRenderer();this.complexity=
this.computeComplexity()};l.prototype._prepareModelResources=function(b,d){return a.__awaiter(this,void 0,void 0,function(){var g,k,l,m,r,t,w,u,v,z,B,C,n,P,F,G,I,J=this;return a.__generator(this,function(a){switch(a.label){case 0:return g=["transformation"],k={instanced:g,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},l={materialParamsMixin:k,streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache},
this._fastUpdates=H.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled?(h.mixin(l.materialParamsMixin,this._fastUpdates.materialParameters),g.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(g.push("color"),this._optionalFields.push("color")),m=this.symbol,"point-3d"===m.type&&m.verticalOffset&&(r=m.verticalOffset,t=r.screenLength,w=r.minWorldLength,u=r.maxWorldLength,l.materialParamsMixin.verticalOffset=
{screenLength:f.pt2px(t),minWorldLength:w||0,maxWorldLength:null!=u?u:Infinity},l.materialParamsMixin.castShadows=!1),l.signal=d,l.usePBR=this._context.physicalBasedRenderingEnabled,this._physicalBasedRenderingEnabled=l.usePBR,[4,A.fetch(b,l)];case 1:return v=a.sent(),this._isEsriSymbolResource=v.isEsriSymbolResource,this._isWosr=v.isWosr,this._removeResource=v.remove,z=y.makeLodResources(v.lods),y.fillEstimatedMinScreenSpaceRadius(z),z.levels.sort(function(a,c){return a.minScreenSpaceRadius-c.minScreenSpaceRadius}),
z.levels[0].minScreenSpaceRadius=Math.min(2,z.levels[0].minScreenSpaceRadius),this._lodResources=z,B=this._context,C=this.symbolLayer.material,n=this._getExternalColorParameters(C),P=e.get(this.symbolLayer,"material","color"),F=this._getCombinedOpacity(P,{hasIntrinsicColor:!0}),G=this.needsDrivenTransparentPass,I=E.materialsFromLodResources(this._lodResources),this._originalMaterialParameters=E.materialsFromLodResources(this._lodResources).map(function(a){a=a.getParameters();return{opacity:a.opacity||
1,transparent:a.transparent}}),I.forEach(function(a){var c=a.getParameters();a.setParameterValues(n);var b=c.opacity*F;a.setParameterValues({opacity:b,transparent:1>b||G||c.transparent});B.screenSizePerspectiveEnabled&&a.setParameterValues({screenSizePerspective:B.sharedResources.screenSizePerspectiveSettings})}),this._resourceBoundingBox=v.referenceBoundingBox,this._resourceSize=c.vec3f64.fromArray(p.size(this._resourceBoundingBox)),this._pivotOffset=c.vec3f64.fromArray(this._lodResources.levels[0].pivotOffset),
this._symbolSize=c.vec3f64.fromArray(q.computeSizeWithResourceSize(this._resourceSize,this.symbolLayer)),H.updateFastSymbolUpdatesState(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions())&&I.forEach(function(a){return a.setParameterValues(J._fastUpdates.materialParameters)}),this._finalizeSymbolResources(),this._initializeLodRenderer(),this.complexity=this.computeComplexity(),[2]}})})};l.prototype._finalizeSymbolResources=function(){var a=this._context.stage;this._materials=
E.materialsFromLodResources(this._lodResources);this._physicalBasedRenderingEnabled!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged();this._materials.forEach(function(c){a.add(3,c)});this._textures=E.texturesFromLodResources(this._lodResources);this._textures.forEach(function(c){a.add(4,c)});this._geometries=E.geometriesFromLodResources(this._lodResources);this._geometries.forEach(function(c){a.add(2,c)})};l.prototype._initializeLodRenderer=function(){var a=this,
c=this._context.stage;this._lodRenderer=new J.LodRenderer(this._lodResources,this._optionalFields,{layerUid:this._context.layer.uid,graphicUid:function(c){return a._instanceIndexToGraphicUid.get(c)},notifyGraphicUpdate:function(c,b){return a._context.notifyGraphicUpdate(a._instanceIndexToGraphicUid.get(c),b)}},this._fastUpdates.enabled?{applyTransform:function(c,b,d){c.getFeatureAttribute(b,R);g.mat4.copy(d,H.evaluateModelTransform(a._fastUpdates.materialParameters,R,d))},scaleFactor:function(c,b,
d){b.getFeatureAttribute(d,R);return H.evaluateModelTransformScale(c,a._fastUpdates.materialParameters,R)}}:null);this._lodRenderer.slicePlane=this._context.slicePlaneEnabled;c.addRenderPlugin(this._lodRenderer.slots,this._lodRenderer)};l.prototype._getExternalColorParameters=function(a){var c={};this._drivenProperties.color?c.externalColor=k.vec4f64.ONES:e.isSome(a)&&e.isSome(a.color)?c.externalColor=m.toUnitRGBA(a.color):(c.externalColor=k.vec4f64.ONES,c.colorMixMode="ignore");return c};l.prototype.destroy=
function(){b.prototype.destroy.call(this);var a=this._context.stage;e.isSome(this._lodRenderer)&&(a.removeRenderPlugin(this._lodRenderer),this._lodRenderer.destroy());e.isSome(this._materials)&&this._materials.forEach(function(c){return a.remove(3,c.id)});e.isSome(this._textures)&&this._textures.forEach(function(c){return a.remove(4,c.id)});e.isSome(this._geometries)&&this._geometries.forEach(function(c){return a.remove(2,c.id)});e.isSome(this._removeResource)&&this._removeResource()};l.prototype.createGraphics3DGraphic=
function(a){var c=a.graphic;if(!this._validateGeometry(c.geometry))return null;var b=B.placePointOnGeometry(c.geometry);if(e.isNone(b))return this.logger.warn("unsupported geometry type for icon symbol: "+c.geometry.type),null;var d=this.setGraphicElevationContext(c,new v.ElevationContext);return this._createAs3DShape(c,b,a.renderingInfo,d,c.uid)};l.prototype.notifyDestroyGraphicLayer=function(a){this._instanceIndexToGraphicUid.delete(a.instanceIndex)};l.prototype.graphicLayerToGraphicId=function(){return 0};
l.prototype.layerOpacityChanged=function(){var a=this;if(e.isNone(this._materials))return!0;var c=this._drivenProperties.opacity,b=this.isByResource;this._materials.forEach(function(d,f){var g=e.get(a.symbolLayer,"material","color");f=a._originalMaterialParameters[f];g=a._getCombinedOpacity(g,{hasIntrinsicColor:b})*f.opacity;d.setParameterValues({opacity:g,transparent:1>g||c||f.transparent})});return!0};l.prototype.layerElevationInfoChanged=function(a,c){return this.updateGraphics3DGraphicElevationInfo(a,
c,u.needsElevationUpdates3D)};l.prototype.slicePlaneEnabledChanged=function(){var a=this;if(e.isNone(this._lodRenderer)||e.isNone(this._materials))return!0;this._lodRenderer.slicePlane=this._context.slicePlaneEnabled;this._materials.forEach(function(c){c.setParameterValues({slicePlaneEnabled:a._context.slicePlaneEnabled})});return!0};l.prototype.physicalBasedRenderingChanged=function(){var a=this;if(e.isNone(this._materials))return!0;this._materials.forEach(function(c){a.isByResource?a._isEsriSymbolResource&&
!a._isWosr&&c.setParameterValues({usePBR:a._context.physicalBasedRenderingEnabled,isSchematic:!1}):c.setParameterValues({usePBR:a._context.physicalBasedRenderingEnabled,isSchematic:!0})});return!0};l.prototype.pixelRatioChanged=function(){return!0};l.prototype.applyRendererDiff=function(a,c){var b=this;if(e.isNone(this._materials)||e.isNone(this._lodRenderer))return!0;for(var d in a.diff)switch(d){case "visualVariables":if(H.updateFastSymbolUpdatesState(this._fastUpdates,c,this._fastVisualVariableConvertOptions()))this._materials.forEach(function(a){return a.setParameterValues(b._fastUpdates.materialParameters)}),
this._lodRenderer.notifyShaderTransformationChanged();else return!1;break;default:return!1}return!0};l.prototype.computeComplexity=function(){if(!this._lodResources)return b.prototype.computeComplexity.call(this);var a=E.geometriesFromLodLevelResources(this._lodResources.levels[0]).reduce(function(a,c){return a+c.data.getIndices(G.VertexAttrConstants.POSITION).length},0)/3,c=F.defaultSymbolLayerMemoryComplexity(this.symbol,this.symbolLayer);return{primitivesPerFeature:a,primitivesPerCoordinate:0,
estimated:!1,memory:c}};l.prototype._createAs3DShape=function(a,c,b,d,f){if(e.isNone(this._lodRenderer))return null;a=this.getFastUpdateAttrValues(a);var g=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?q.mixinColorAndOpacity(b.color,b.opacity):null,k=this._context.clippingExtent;I.pointToVector(c,M,this._context.elevationProvider.spatialReference);if(e.isSome(k)&&!p.containsPoint(k,M))return null;var k=this._requiresTerrainElevation(d),h=this._computeGlobalTransform(c,d,Q,k?W:null);b=this._computeLocalTransform(this.symbolLayer,
b,N);var l=this._lodRenderer.instanceData,m=l.addInstance();this._instanceIndexToGraphicUid.set(m,f);l.setLocalTransform(m,b,!1);l.setGlobalTransform(m,h);a&&l.setFeatureAttribute(m,a);g&&l.setColor(m,g);f=new z(this,m,t.perLodInstanceElevationAligner,d);k&&(f.alignedSampledElevation=W.sampledElevation);f.needsElevationUpdates=u.needsElevationUpdates3D(d.mode);B.extendPointGraphicElevationContext(f,c,this._context.elevationProvider);return f};l.prototype._computeGlobalTransform=function(a,c,b,d){c=
u.evaluateElevationAlignmentAtPoint(a,this._context.elevationProvider,c,this._context.renderCoordsHelper,d);M[0]=a.x;M[1]=a.y;M[2]=c;I.computeLinearTransformation(a.spatialReference,M,b,this._context.renderCoordsHelper.spatialReference);return b};l.prototype._computeLocalTransform=function(a,c,b){g.mat4.identity(b);this._applyObjectRotation(c,!1,b);this._applyObjectRotation(a,!0,b);this._applyObjectScale(c,b);this._applyAnchor(a,b);return b};l.prototype._applyObjectScale=function(a,c){this._fastUpdates.enabled&&
this._fastUpdates.requiresShaderTransformation||(a=q.computeObjectScale(this._drivenProperties.size&&a.size?a.size:this._symbolSize,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters),1===a[0]&&1===a[1]&&1===a[2]||g.mat4.scale(c,c,a))};l.prototype.prepareSymbolLayerPatch=function(a){if("partial"===a.diff.type){var c=a.diff.diff;this._preparePatchTransform(a,c);this._preparePatchColor(a,c)}};l.prototype.updateGeometry=function(a,c){if(e.isNone(this._lodRenderer))return!0;
var b=c&&B.placePointOnGeometry(c);if(e.isNone(b))return!1;c=this.getGeometryElevationMode(c);if(a.elevationContext.mode!==c)return!1;c=this._requiresTerrainElevation(a.elevationContext);this._computeGlobalTransform(b,a.elevationContext,Q,c?W:null);c&&(a.alignedSampledElevation=W.sampledElevation);this._lodRenderer.instanceData.setGlobalTransform(a.instanceIndex,Q,!0);B.extendPointGraphicElevationContext(a,b,this._context.elevationProvider);return!0};l.prototype._preparePatchTransform=function(a,
b){var d=this;if(b.heading||b.tilt||b.roll||b.width||b.height||b.depth||b.anchor||b.anchorPosition){var f=this._lodRenderer;if(!e.isNone(f)){var g=function(a,c,b){return e.unwrapOr(null!=a&&"complete"===a.type?a.newValue:c,b)},k=g(b.heading,this.symbolLayer.heading,0),h=g(b.tilt,this.symbolLayer.tilt,0),l=g(b.roll,this.symbolLayer.roll,0),m=g(b.width,this.symbolLayer.width,void 0),p=g(b.height,this.symbolLayer.height,void 0),r=g(b.depth,this.symbolLayer.depth,void 0),t=g(b.anchor,this.symbolLayer.anchor,
void 0),g=g(b.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete b.heading;delete b.tilt;delete b.roll;delete b.width;delete b.height;delete b.depth;delete b.anchor;delete b.anchorPosition;var w={heading:k,tilt:h,roll:l,anchor:t,anchorPosition:g};1===this.loadStatus&&a.symbolLayerStatePatches.push(function(){d._symbolSize=c.vec3f64.fromArray(q.computeSizeWithResourceSize(d._resourceSize,{width:m,height:p,depth:r,isPrimitive:d.symbolLayer.isPrimitive}))});a.graphics3DGraphicPatches.push(function(a,
c){c=d._computeLocalTransform(w,c,N);f.instanceData.setLocalTransform(a.instanceIndex,c,!0)})}}};l.prototype._preparePatchColor=function(a,c){var b=this;if(c.material&&"partial"===c.material.type&&(c=c.material.diff,c.color&&"complete"===c.color.type&&null!=c.color.newValue&&null!=c.color.oldValue)){var d=c.color.newValue,f=e.isSome(d)?m.toUnitRGBA(d):k.vec4f64.ONES;delete c.color;var g=this._materials,h=this._lodRenderer;e.isNone(g)||e.isNone(h)||a.graphics3DGraphicPatches.push(function(a){b._hasPerInstanceColor()?
(h.instanceData.setColor(a.instanceIndex,f),a=b.setMaterialTransparencyParams({},d)):a=b.setMaterialTransparencyParams({externalColor:f},d);for(var c=0;c<g.length;c++)g[c].setParameterValues(a)})}};l.prototype._requiresTerrainElevation=function(a){return"absolute-height"!==a.mode};l.prototype._applyObjectRotation=function(a,c,b){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&c))return q.computeObjectRotation(a.heading,a.tilt,a.roll,b)};l.prototype._computeAnchor=function(a){var b=
c.vec3f64.create();switch(a.anchor){case "center":d.vec3.copy(b,p.center(this._resourceBoundingBox));d.vec3.negate(b,b);break;case "top":var e=p.center(this._resourceBoundingBox);d.vec3.set(b,-e[0],-e[1],-this._resourceBoundingBox[5]);break;case "bottom":e=p.center(this._resourceBoundingBox);d.vec3.set(b,-e[0],-e[1],-this._resourceBoundingBox[2]);break;case "relative":var e=p.center(this._resourceBoundingBox),f=p.size(this._resourceBoundingBox);a=(a=a.anchorPosition)?c.vec3f64.fromValues(a.x,a.y,
a.z):c.vec3f64.ZEROS;d.vec3.multiply(b,f,a);d.vec3.add(b,b,e);d.vec3.negate(b,b);break;default:this._pivotOffset?d.vec3.negate(b,this._pivotOffset):d.vec3.copy(b,c.vec3f64.ZEROS)}return b};l.prototype._applyAnchor=function(a,c){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(a=this._computeAnchor(a))&&g.mat4.translate(c,c,a)};l.prototype._hasPerInstanceColor=function(){return this._drivenProperties.color||this._drivenProperties.opacity};l.prototype._fastVisualVariableConvertOptions=
function(){var a=this._resourceBoundingBox?c.vec3f64.fromArray(p.size(this._resourceBoundingBox)):c.vec3f64.ONES,b=this._resourceBoundingBox?this._computeAnchor(this.symbolLayer):c.vec3f64.ZEROS,d=this._context.renderCoordsHelper.unitInMeters,e=q.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,d),f=c.vec3f64.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:a,symbolSize:this._symbolSize||c.vec3f64.ONES,unitInMeters:d,
transformation:{anchor:b,scale:e,rotation:f}}};return l}(w.default);b.Graphics3DObjectSymbolLayer=n;var M=c.vec3f64.create(),N=l.mat4f64.create(),Q=l.mat4f64.create(),R=k.vec4f64.create(),W={verticalDistanceToGround:0,sampledElevation:0};b.default=n})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("require exports tslib ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/Object3DStateSet".split(" "),
function(n,b,a,m,h,e,f,g,l,d){n=function(){function b(a,c,b,d){this.graphics3DSymbolLayer=a;this.instanceIndex=c;this.elevationAligner=b;this.elevationContext=d;this.type="lod-instance";this.alignedSampledElevation=0;this.needsElevationUpdates=this.isElevationSource=!1}b.prototype.initialize=function(){};b.prototype.setVisibility=function(a){var c=this.lodRenderer.instanceData;return a!==c.getVisible(this.instanceIndex)?(c.setVisible(this.instanceIndex,a),!0):!1};b.prototype.destroy=function(){null!=
this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};b.prototype.alignWithElevation=function(a,c,b){this.elevationAligner&&(g.setContextFeature(this.elevationContext.featureExpressionInfoContext,b),a=this.elevationAligner(this,this.elevationContext,a,c),null!=a&&(this.alignedSampledElevation=a))};b.prototype.getBSRadius=function(){var a=this.lodRenderer;return a.baseBoundingSphere.radius*a.instanceData.getCombinedMaxScaleFactor(this.instanceIndex)};
b.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=e.vec3f64.create());this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,t);return h.vec3.transformMat4(a,this.lodRenderer.baseBoundingSphere.center,t)};b.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=f.create());this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,t);var c=this.lodRenderer.baseBoundingBox;f.empty(a);for(var b=0;8>b;++b)h.vec3.set(k,0===(b&1)?c[0]:c[3],0===(b&2)?
c[1]:c[4],0===(b&4)?c[2]:c[5]),h.vec3.transformMat4(k,k,t),f.expandPointInPlace(a,k);return a};b.prototype.computeAttachmentOrigin=function(a){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,t);a.render.origin[0]+=t[12];a.render.origin[1]+=t[13];a.render.origin[2]+=t[14];a.render.num++};b.prototype.getProjectedBoundingBox=function(b,d,e,g,m){return a.__awaiter(this,void 0,void 0,function(){var q,w,u,y,v,z,n,J,E;return a.__generator(this,function(a){switch(a.label){case 0:q=this.getBoundingBoxObjectSpace(m);
w=r;u=f.isPoint(q)?1:w.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,t);for(y=0;y<u;y++)v=w[y],k[0]=q[v[0]],k[1]=q[v[1]],k[2]=q[v[2]],h.vec3.transformMat4(k,k,t),c[3*y+0]=k[0],c[3*y+1]=k[1],c[3*y+2]=k[2];if(!b(c,0,u))return[2,null];f.empty(q);z=null;this.calculateRelativeScreenBounds&&(z=this.calculateRelativeScreenBounds());for(y=0;y<3*u;y+=3){for(n=0;3>n;n++)q[n]=Math.min(q[n],c[y+n]),q[n+3]=Math.max(q[n+3],c[y+n]);z&&e.push({location:c.slice(y,y+3),screenSpaceBoundingRect:z})}if(!d)return[3,
5];f.center(q,p);if("absolute-height"===this.elevationContext.mode)return[3,5];J=void 0;E=l.demResolutionForBoundingBox(q,d);a.label=1;case 1:return a.trys.push([1,3,,4]),[4,d.service.queryElevation(p[0],p[1],g,E)];case 2:return J=a.sent(),[3,4];case 3:return a.sent(),J=null,[3,4];case 4:null!=J&&f.offset(q,0,0,-this.alignedSampledElevation+J),a.label=5;case 5:return[2,q]}})})};b.prototype.addObjectState=function(a,c){var b=this;0===a&&(a=d.generateObject3DStateId(a),this.addHighlightId(a),c.addExternal(function(a){b.removeHighlightId(a)},
a))};b.prototype.removeObjectState=function(a){this.highlights&&this.highlights.forEach(function(c){return a.remove(c)})};b.prototype.addHighlightId=function(a){this.highlights=this.highlights||new Set;this.highlights.add(a);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};b.prototype.removeHighlightId=function(a){this.highlights&&(this.highlights.delete(a),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,0<this.highlights.size),0===this.highlights.size&&(this.highlights=
null))};Object.defineProperty(b.prototype,"lodRenderer",{get:function(){return this.graphics3DSymbolLayer.lodRenderer},enumerable:!0,configurable:!0});return b}();var c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],k=e.vec3f64.create(),p=e.vec3f64.create(),r=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],t=m.mat4f64.create();return n})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["require","exports","../../webgl-engine/lib/lodRendering/LodResources"],
function(n,b,a){function m(a){var b=[];a.stageResources.geometries.forEach(function(e,d){b.push({material:a.stageResources.materials[d],geometry:e,textures:a.stageResources.textures})});return{components:b,minScreenSpaceRadius:a.lodThreshold,pivotOffset:a.pivotOffset}}function h(b,g){void 0===g&&(g=e);b=a.computeFaceCount(b);return Math.sqrt(b/(g*Math.PI))}Object.defineProperty(b,"__esModule",{value:!0});b.makeLodLevelResources=m;b.makeLodResources=function(a){return{levels:a.map(function(a){return m(a)})}};
b.estimateMinScreenSpaceRadius=h;b.fillEstimatedMinScreenSpaceRadius=function(a){a.levels.forEach(function(a){a.minScreenSpaceRadius||(a.minScreenSpaceRadius=h(a))})};var e=.05})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("require exports tslib ../../../../core/devEnvironmentUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../glTF/DefaultLoadingContext ../../glTF/loader ../../glTF/internal/indexUtils ./wosrLoader ../../support/buffer/BufferView ../../support/buffer/math ../../support/buffer/utils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B){function C(a){var c=a.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return c?{fileType:"gltf",url:c[1],specifiedLodIndex:null!=c[4]?Number(c[4]):null}:a.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:a,specifiedLodIndex:null}:{fileType:"unknown",url:a,specifiedLodIndex:null}}function F(c,b,d,g){var l=c.model,m=f.mat3f64.create(),p=[],r=new Map,u=new Map;l.lods.forEach(function(c,f){if(void 0===g||f===g){var n=0,C={name:c.name,stageResources:{textures:[],
materials:[],geometries:[]},lodThreshold:h.isSome(c.lodThreshold)?c.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:k.empty()};p.push(C);c.parts.forEach(function(f){var g=f.material+(f.attributes.normal?"_normal":"")+(f.attributes.color?"_color":"")+(f.attributes.texCoord0?"_texCoord0":"")+(f.attributes.tangent?"_tangent":""),p=l.materials.get(f.material),E=h.isSome(f.attributes.texCoord0),F=h.isSome(f.attributes.normal);if(!r.has(g)){if(E){if(h.isSome(p.textureColor)&&!u.has(p.textureColor)){var G=
l.textures.get(p.textureColor),P=a.__assign(a.__assign({},G.parameters),{preMultiplyAlpha:!0});u.set(p.textureColor,new A(G.data,p.textureColor,P))}h.isSome(p.textureNormal)&&!u.has(p.textureNormal)&&(G=l.textures.get(p.textureNormal),P=a.__assign(a.__assign({},G.parameters),{preMultiplyAlpha:!0}),u.set(p.textureNormal,new A(G.data,p.textureNormal,P)));h.isSome(p.textureOcclusion)&&!u.has(p.textureOcclusion)&&(G=l.textures.get(p.textureOcclusion),P=a.__assign(a.__assign({},G.parameters),{preMultiplyAlpha:!0}),
u.set(p.textureOcclusion,new A(G.data,p.textureOcclusion,P)));h.isSome(p.textureEmissive)&&!u.has(p.textureEmissive)&&(G=l.textures.get(p.textureEmissive),P=a.__assign(a.__assign({},G.parameters),{preMultiplyAlpha:!0}),u.set(p.textureEmissive,new A(G.data,p.textureEmissive,P)));h.isSome(p.textureMetallicRoughness)&&!u.has(p.textureMetallicRoughness)&&(G=l.textures.get(p.textureMetallicRoughness),P=a.__assign(a.__assign({},G.parameters),{preMultiplyAlpha:!0}),u.set(p.textureMetallicRoughness,new A(G.data,
p.textureMetallicRoughness,P)))}var I=B.COLOR_GAMMA,G=Math.pow(p.color[0],1/I),P=Math.pow(p.color[1],1/I),J=Math.pow(p.color[2],1/I),L=Math.pow(p.emissiveFactor[0],1/I),Q=Math.pow(p.emissiveFactor[1],1/I),I=Math.pow(p.emissiveFactor[2],1/I);r.set(g,new B(a.__assign(a.__assign(a.__assign({},b),{transparent:"BLEND"===p.alphaMode,textureAlphaMode:H(p.alphaMode),textureAlphaCutoff:p.alphaCutoff,diffuse:[G,P,J],ambient:[G,P,J],opacity:p.opacity,doubleSided:p.doubleSided,doubleSidedType:"winding-order",
cullFace:p.doubleSided?0:2,vertexColors:!!f.attributes.color,vertexTangents:!!f.attributes.tangent,normals:F?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:h.isSome(p.textureColor)&&E?u.get(p.textureColor).id:void 0,colorMixMode:p.colorMixMode,normalTextureId:h.isSome(p.textureNormal)&&E?u.get(p.textureNormal).id:void 0,textureAlphaPremultiplied:!0,occlusionTextureId:h.isSome(p.textureOcclusion)&&E?u.get(p.textureOcclusion).id:void 0,emissiveTextureId:h.isSome(p.textureEmissive)&&
E?u.get(p.textureEmissive).id:void 0,metallicRoughnessTextureId:h.isSome(p.textureMetallicRoughness)&&E?u.get(p.textureMetallicRoughness).id:void 0,emissiveFactor:[L,Q,I],mrrFactors:[p.metallicFactor,p.roughnessFactor,b.mrrFactors[2]],isSchematic:!1}),d),g))}a:{F=f.indices||f.attributes.position.count;switch(f.primitiveType){case 4:G=t.trianglesToTriangles(F);break a;case 5:G=t.triangleStripToTriangles(F);break a;case 6:G=t.triangleFanToTriangles(F);break a}G=void 0}P={};J={};F=f.attributes.position.count;
L=w.createBuffer(v.BufferViewVec3f,F);z.vec3.transformMat4(L,f.attributes.position,f.transform);J.position={data:L.typedBuffer,size:L.elementCount};P.position=G;h.isSome(f.attributes.normal)&&(L=w.createBuffer(v.BufferViewVec3f,F),e.mat3.normalFromMat4(m,f.transform),z.vec3.transformMat3(L,f.attributes.normal,m),J.normal={data:L.typedBuffer,size:L.elementCount},P.normal=G);h.isSome(f.attributes.tangent)&&(L=w.createBuffer(v.BufferViewVec4f,F),e.mat3.normalFromMat4(m,f.transform),z.vec4.transformMat3(L,
f.attributes.tangent,m),J.tangent={data:L.typedBuffer,size:L.elementCount},P.tangent=G);h.isSome(f.attributes.texCoord0)&&(L=w.createBuffer(v.BufferViewVec2f,F),w.vec2.normalizeIntegerBuffer(L,f.attributes.texCoord0),J.uv0={data:L.typedBuffer,size:L.elementCount},P.uv0=G);h.isSome(f.attributes.color)&&(L=w.createBuffer(v.BufferViewVec4u8,F),4===f.attributes.color.elementCount?f.attributes.color instanceof v.BufferViewVec4f?z.vec4.scale(L,f.attributes.color,255):f.attributes.color instanceof v.BufferViewVec4u8?
w.vec4.copy(L,f.attributes.color):f.attributes.color instanceof v.BufferViewVec4u16&&z.vec4.scale(L,f.attributes.color,1/256):(w.vec4.fill(L,255,255,255,255),Q=new v.BufferViewVec3u8(L.buffer,0,4),f.attributes.color instanceof v.BufferViewVec3f?z.vec3.scale(Q,f.attributes.color,255):f.attributes.color instanceof v.BufferViewVec3u8?w.vec3.copy(Q,f.attributes.color):f.attributes.color instanceof v.BufferViewVec3u16&&z.vec3.scale(Q,f.attributes.color,1/256)),J.color={data:L.typedBuffer,size:L.elementCount},
P.color=G);f=new q(new y.GeometryData(J,P),"gltf_"+c.name+"_"+n++);C.stageResources.geometries.push(f);C.stageResources.materials.push(r.get(g));E&&(h.isSome(p.textureColor)&&C.stageResources.textures.push(u.get(p.textureColor)),h.isSome(p.textureNormal)&&C.stageResources.textures.push(u.get(p.textureNormal)),h.isSome(p.textureOcclusion)&&C.stageResources.textures.push(u.get(p.textureOcclusion)),h.isSome(p.textureEmissive)&&C.stageResources.textures.push(u.get(p.textureEmissive)),h.isSome(p.textureMetallicRoughness)&&
C.stageResources.textures.push(u.get(p.textureMetallicRoughness)));C.numberOfVertices+=F;g=f.boundingInfo;k.expand(C.boundingBox,g.getBBMin());k.expand(C.boundingBox,g.getBBMax())})}});return p}function H(a){switch(a){case "BLEND":return 0;case "MASK":return 2;case "OPAQUE":return 1;default:return 0}}Object.defineProperty(b,"__esModule",{value:!0});b.fetch=function(b,e){return a.__awaiter(this,void 0,void 0,function(){var f,k,q,t,y,z,A,B,n,H,G,I;return a.__generator(this,function(E){switch(E.label){case 0:return f=
C(m.adjustStaticAGOUrl(b)),"wosr"!==f.fileType?[3,2]:[4,e.cache?e.cache.loadWOSR(f.url,e):u.load(f.url,e)];case 1:return k=E.sent(),q=u.processLoadResult(k,e),[2,{lods:[q],referenceBoundingBox:q.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:k.remove}];case 2:return[4,e.cache?e.cache.loadGLTF(f.url,e):r.load(new p.DefaultLoadingContext(e.streamDataRequester),f.url,e)];case 3:t=E.sent();y=h.get(t.model.meta,"ESRI_proxyEllipsoid");if(t.meta.isEsriSymbolResource&&h.isSome(y)&&-1!==t.meta.uri.indexOf("/RealisticTrees/"))a:{E=
t;for(var P=y,J=0;J<E.model.lods.length;++J){var L=E.model.lods[J];E.customMeta.esriTreeRendering=!0;for(var Q=0,L=L.parts;Q<L.length;Q++){var N=L[Q],R=N.attributes.normal;if(h.isNone(R))break a;for(var M=N.attributes.position,ba=M.count,W=c.vec3f64.create(),V=c.vec3f64.create(),O=c.vec3f64.create(),U=w.createBuffer(v.BufferViewVec4u8,ba),na=w.createBuffer(v.BufferViewVec3f,ba),ja=g.mat4.invert(l.mat4f64.create(),N.transform),ta=0;ta<ba;ta++){M.getVec(ta,V);R.getVec(ta,W);d.vec3.transformMat4(V,V,
N.transform);d.vec3.subtract(O,V,P.center);d.vec3.divide(O,O,P.radius);var ra=O[2],xa=d.vec3.length(O),xa=Math.min(.45+.55*xa*xa,1);d.vec3.divide(O,O,P.radius);d.vec3.transformMat4(O,O,ja);d.vec3.normalize(O,O);J+1!==E.model.lods.length&&1<E.model.lods.length&&(-1<ra?d.vec3.lerp(O,O,W,.2):d.vec3.lerp(O,O,W,Math.min(-4*ra-3.8,1)));na.setVec(ta,O);U.set(ta,0,255*xa);U.set(ta,1,255*xa);U.set(ta,2,255*xa);U.set(ta,3,255)}N.attributes.normal=na;N.attributes.color=U}}}z=t.meta.isEsriSymbolResource?{usePBR:e.usePBR,
isSchematic:!1,treeRendering:t.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:!0,isSchematic:!1,mrrFactors:[0,1,.5]};A=a.__assign(a.__assign({},e.materialParamsMixin),{treeRendering:t.customMeta.esriTreeRendering});if(null!=f.specifiedLodIndex)return B=F(t,z,A,f.specifiedLodIndex),n=B[0].boundingBox,0!==f.specifiedLodIndex&&(H=F(t,z,A,0),n=H[0].boundingBox),[2,{lods:B,referenceBoundingBox:n,isEsriSymbolResource:t.meta.isEsriSymbolResource,isWosr:!1,remove:t.remove}];G=F(t,z,A);I=G[0].boundingBox;
return[2,{lods:G,referenceBoundingBox:I,isEsriSymbolResource:t.meta.isEsriSymbolResource,isWosr:!1,remove:t.remove}]}})})};b.parseUrl=C;b.gltfToEngineResources=F})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("require exports tslib ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils".split(" "),function(n,b,a,m,h,e,f,g,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function c(a){this.streamDataRequester=
a}c.prototype.loadJSON=function(c,b){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return[2,this.load("json",c,b)]})})};c.prototype.loadBinary=function(c,b){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return l.isDataProtocol(c)?(g.throwIfAborted(b),[2,l.dataToArrayBuffer(c)]):[2,this.load("binary",c,b)]})})};c.prototype.loadImage=function(c,b){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,
function(a){return[2,this.load("image",c,b)]})})};c.prototype.load=function(c,b,l){return a.__awaiter(this,void 0,void 0,function(){var k;return a.__generator(this,function(a){switch(a.label){case 0:return f.isNone(this.streamDataRequester)?[4,m(b,{responseType:d[c]})]:[3,2];case 1:return[2,a.sent().data];case 2:return[4,h.result(this.streamDataRequester.request(b,c,l))];case 3:k=a.sent();if(!0===k.ok)return[2,k.value];g.throwIfAbortError(k.error);throw new e("","Request for resource failed: "+k.error);
}})})};return c}();b.DefaultLoadingContext=n;var d={image:"image",binary:"array-buffer",json:"json"}})},"esri/views/3d/glTF/loader":function(){define("require exports tslib ../../../core/maybe ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4f64 ./DefaultErrorContext ./LoaderResult ./internal/Resource".split(" "),function(n,b,a,m,h,e,f,g,l){function d(a){var c=null;a.json.nodes.forEach(function(a){a=a.extras;m.isSome(a)&&(a.ESRI_proxyEllipsoid||a.ESRI_lod)&&(c=a)});return c}function c(c,
b){return a.__awaiter(this,void 0,void 0,function(){function d(f,g){return a.__awaiter(this,void 0,void 0,function(){var k,h,l,m,p,q,r,w,u;return a.__generator(this,function(a){switch(a.label){case 0:k=e.nodes[f];h=c.getNodeTransform(f);t.warnUnsupportedIf(null!=k.weights,"Morph targets are not supported.");if(null==k.mesh)return[3,4];l=e.meshes[k.mesh];m=0;p=l.primitives;a.label=1;case 1:if(!(m<p.length))return[3,4];q=p[m];return[4,b(q,h,g,l.name)];case 2:a.sent(),a.label=3;case 3:return m++,[3,
1];case 4:r=0,w=k.children||[],a.label=5;case 5:if(!(r<w.length))return[3,8];u=w[r];return[4,d(u,g)];case 6:a.sent(),a.label=7;case 7:return r++,[3,5];case 8:return[2]}})})}var e,f,g,k,l,m,p,r,w,u;return a.__generator(this,function(a){switch(a.label){case 0:e=c.json,f=e.scenes[e.scene||0],g=f.nodes,k=1<g.length,l=0,m=g,a.label=1;case 1:if(!(l<m.length))return[3,4];p=m[l];r=e.nodes[p];w=[d(p,0)];r.extensions&&r.extensions.MSFT_lod&&Array.isArray(r.extensions.MSFT_lod.ids)&&!k&&(u=r.extensions.MSFT_lod.ids,
w.push.apply(w,u.map(function(a,c){return d(a,c+1)})));return[4,h.all(w)];case 2:a.sent(),a.label=3;case 3:return l++,[3,1];case 4:return[2]}})})}function k(a,c,b){var d=function(c){var d=b+"_tex_"+(c&&c.id)+(c&&c.name?"_"+c.name:"");if(c&&!a.textures.has(d)){var e=g.makeTextureSource(c.data,{wrap:{s:p(c.wrapS),t:p(c.wrapT)},mipmap:u.some(function(a){return a===c.minFilter}),noUnpackFlip:!0});a.textures.set(d,e)}return d},e=b+"_mat_"+c.id+"_"+c.name;a.materials.has(e)||(c=g.makeMaterialParameters({color:[c.color[0],
c.color[1],c.color[2]],opacity:c.color[3],alphaMode:c.alphaMode,alphaCutoff:c.alphaCutoff,doubleSided:c.doubleSided,colorMixMode:c.ESRI_externalColorMixMode,textureColor:c.colorTexture?d(c.colorTexture):void 0,textureNormal:c.normalTexture?d(c.normalTexture):void 0,textureOcclusion:c.occlusionTexture?d(c.occlusionTexture):void 0,textureEmissive:c.emissiveTexture?d(c.emissiveTexture):void 0,textureMetallicRoughness:c.metallicRoughnessTexture?d(c.metallicRoughnessTexture):void 0,emissiveFactor:[c.emissiveFactor[0],
c.emissiveFactor[1],c.emissiveFactor[2]],metallicFactor:c.metallicFactor,roughnessFactor:c.roughnessFactor}),a.materials.set(e,c));return e}function p(a){if(33071===a||33648===a||10497===a)return a;t.error("Unexpected TextureSampler WrapMode: "+a)}Object.defineProperty(b,"__esModule",{value:!0});var r=0;b.load=function(b,f,g){void 0===g&&(g={});return a.__awaiter(this,void 0,void 0,function(){var h,p,q,w,u=this;return a.__generator(this,function(y){switch(y.label){case 0:return[4,l.Resource.load(b,
t,f,g)];case 1:return h=y.sent(),p="gltf_"+r++,q={lods:[],materials:new Map,textures:new Map,meta:d(h)},w=!(!h.json.asset.extras||"symbolResource"!==h.json.asset.extras.ESRI_type),[4,c(h,function(c,b,d,f){return a.__awaiter(u,void 0,void 0,function(){var l,r,w,u,y,A,z,B,n,C,E;return a.__generator(this,function(a){switch(a.label){case 0:l=void 0!==c.mode?c.mode:4;a:switch(l){case 4:case 5:case 6:r=l;break a;default:r=null}return m.isNone(r)?(t.warnUnsupported("Unsupported primitive mode ("+v[l]+"). Skipping primitive."),
[2]):h.hasPositions(c)?[4,h.getMaterial(c,g)]:(t.warn("Skipping primitive without POSITION vertex attribute."),[2]);case 1:return w=a.sent(),y={transform:e.mat4f64.clone(b)},A={},[4,h.getPositionData(c,g)];case 2:return y.attributes=(A.position=a.sent(),A.normal=null,A.texCoord0=null,A.color=null,A.tangent=null,A),[4,h.getIndexData(c,g)];case 3:u=(y.indices=a.sent(),y.primitiveType=r,y.material=k(q,w,p),y);if(!h.hasNormals(c))return[3,5];z=u.attributes;return[4,h.getNormalData(c,g)];case 4:z.normal=
a.sent(),a.label=5;case 5:if(!h.hasTangents(c))return[3,7];B=u.attributes;return[4,h.getTangentData(c,g)];case 6:B.tangent=a.sent(),a.label=7;case 7:if(!h.hasTextureCoordinates(c))return[3,9];n=u.attributes;return[4,h.getTextureCoordinates(c,g)];case 8:n.texCoord0=a.sent(),a.label=9;case 9:if(!h.hasVertexColors(c))return[3,11];C=u.attributes;return[4,h.getVertexColors(c,g)];case 10:C.color=a.sent(),a.label=11;case 11:return E=null,m.isSome(q.meta)&&m.isSome(q.meta.ESRI_lod)&&"screenSpaceRadius"===
q.meta.ESRI_lod.metric&&(E=q.meta.ESRI_lod.thresholds[d]),q.lods[d]=q.lods[d]||{parts:[],name:f,lodThreshold:E},q.lods[d].parts.push(u),[2]}})})})];case 2:return y.sent(),[2,{model:q,meta:{isEsriSymbolResource:w,uri:h.uri},customMeta:{}}]}})})};var t=new f.DefaultErrorContext,u=[9987,9985],v="POINTS LINES LINE_LOOP LINE_STRIP TRIANGLES TRIANGLE_STRIP TRIANGLE_FAN".split(" ")})},"esri/views/3d/glTF/DefaultErrorContext":function(){define(["require","exports","../../../core/Error","../../../core/Logger"],
function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});var h=m.getLogger("esri.views.3d.glTF");n=function(){function b(){}b.prototype.error=function(b){throw new a("gltf-loader-error",b);};b.prototype.errorUnsupported=function(b){throw new a("gltf-loader-unsupported-feature",b);};b.prototype.errorUnsupportedIf=function(a,b){a&&this.errorUnsupported(b)};b.prototype.assert=function(a,b){a||this.error(b)};b.prototype.warn=function(a){h.warn(a)};b.prototype.warnUnsupported=function(a){this.warn("[Unsupported Feature] "+
a)};b.prototype.warnUnsupportedIf=function(a,b){a&&this.warnUnsupported(b)};return b}();b.DefaultErrorContext=n})},"esri/views/3d/glTF/LoaderResult":function(){define(["require","exports","tslib"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.makeMaterialParameters=function(b){void 0===b&&(b={});return a.__assign({color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,
textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply"},b)};b.makeTextureSource=function(b,h){void 0===h&&(h={});return{data:b,parameters:a.__assign({wrap:a.__assign({s:10497,t:10497},h.wrap),noUnpackFlip:!0,mipmap:!1},h)}}})},"esri/views/3d/glTF/internal/Resource":function(){define("require exports tslib ../../../../core/compilerUtils ../../../../core/promiseUtils ../../../../core/string ../../../../core/urlUtils ../../../../core/urlUtils ../../../../core/Version ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/quat ../../../../core/libs/gl-matrix-2/quatf64 ./BinaryStreamReader ./fillDefaults ./pathUtils ../../support/buffer/BufferView ../../support/buffer/utils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z){function w(a){switch(a.componentType){case 5120:return new v.BufferViewVec2i8(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5121:return new v.BufferViewVec2u8(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5122:return new v.BufferViewVec2i16(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5123:return new v.BufferViewVec2u16(a.raw,a.byteOffset,a.byteStride,a.byteOffset+
a.byteStride*a.entryCount);case 5125:return new v.BufferViewVec2u32(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5126:return new v.BufferViewVec2f(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);default:m.neverReached(a.componentType)}}function q(c){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return[2,h.create(function(a,b){var d=new Blob([c]),e=new FileReader;e.onload=function(){a(JSON.parse(e.result))};
e.onerror=function(a){b(a)};e.readAsText(d)})]})})}function y(c,b){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return[2,h.create(function(a,d){var e=new Blob([c],{type:b}),f=URL.createObjectURL(e),g=new Image;g.addEventListener("load",function(){URL.revokeObjectURL(f);"decode"in g?g.decode().then(function(){return a(g)},function(){return a(g)}):a(g)});g.addEventListener("error",function(a){URL.revokeObjectURL(f);d(a)});g.src=f})]})})}var A;Object.defineProperty(b,
"__esModule",{value:!0});n=function(){function b(a,c,b,d,e){this.context=a;this.errorContext=c;this.uri=b;this.json=d;this.glbBuffer=e;this.bufferCache=new Map;this.textureCache=new Map;this.materialCache=new Map;this.nodeParentMap=new Map;this.nodeTransformCache=new Map;this.baseUri=u.splitURI(this.uri).dirPart;this.checkVersionSupported();this.checkRequiredExtensionsSupported();c.errorUnsupportedIf(null==d.scenes,"Scenes must be defined.");c.errorUnsupportedIf(null==d.meshes,"Meshes must be defined");
c.errorUnsupportedIf(null==d.nodes,"Nodes must be defined.");this.computeNodeParents()}b.load=function(c,d,f,k){return a.__awaiter(this,void 0,void 0,function(){var h,l,m,p,q,r;return a.__generator(this,function(a){switch(a.label){case 0:if(g.isDataProtocol(f)){h=g.dataComponents(f);if("model/gltf-binary"!==h.mediaType)try{return l=JSON.parse(h.isBase64?atob(h.data):h.data),[2,new b(c,d,f,l)]}catch(V){}m=g.dataToArrayBuffer(f);if(b.isGLBData(m))return[2,this.fromGLBData(c,d,f,m)]}return e.endsWith(f,
".gltf")?[4,c.loadJSON(f,k)]:[3,2];case 1:return p=a.sent(),[2,new b(c,d,f,p)];case 2:return[4,c.loadBinary(f,k)];case 3:return q=a.sent(),b.isGLBData(q)?[2,this.fromGLBData(c,d,f,q)]:[4,c.loadJSON(f,k)];case 4:return r=a.sent(),[2,new b(c,d,f,r)]}})})};b.isGLBData=function(a){a=new r.BinaryStreamReader(a);return 4<=a.remainingBytes()&&1179937895===a.readUint32()};b.fromGLBData=function(c,d,e,f){return a.__awaiter(this,void 0,void 0,function(){var g;return a.__generator(this,function(a){switch(a.label){case 0:return[4,
b.parseGLBData(d,f)];case 1:return g=a.sent(),[2,new b(c,d,e,g.json,g.binaryData)]}})})};b.parseGLBData=function(c,b){return a.__awaiter(this,void 0,void 0,function(){var d,e,f,g,k,h,l,m,p;return a.__generator(this,function(a){switch(a.label){case 0:d=new r.BinaryStreamReader(b),c.assert(12<=d.remainingBytes(),"GLB binary data is insufficiently large."),e=d.readUint32(),f=d.readUint32(),g=d.readUint32(),c.assert(1179937895===e,"Magic first 4 bytes do not fit to expected GLB value."),c.assert(b.byteLength>=
g,"GLB binary data is smaller than header specifies."),c.errorUnsupportedIf(2!==f,"An unsupported GLB container version was detected. Only version 2 is supported."),k=0,a.label=1;case 1:if(!(8<=d.remainingBytes()))return[3,5];m=d.readUint32();p=d.readUint32();if(0!==k)return[3,3];c.assert(1313821514===p,"First GLB chunk must be JSON.");c.assert(0<=m,"No JSON data found.");return[4,q(d.readUint8Array(m))];case 2:return h=a.sent(),[3,4];case 3:1===k?(c.errorUnsupportedIf(5130562!==p,"Second GLB chunk expected to be BIN."),
l=d.readUint8Array(m)):c.warnUnsupported("More than 2 GLB chunks detected. Skipping."),a.label=4;case 4:return k+=1,[3,1];case 5:return h||c.error("No GLB JSON chunk detected."),[2,{json:h,binaryData:l}]}})})};b.prototype.getBuffer=function(c,b){return a.__awaiter(this,void 0,void 0,function(){var d,e,f,g;return a.__generator(this,function(a){switch(a.label){case 0:return d=this.json.buffers[c],e=this.errorContext,null==d.uri?(e.assert(null!=this.glbBuffer,"GLB buffer not present"),[2,this.glbBuffer]):
(f=this.bufferCache.get(c))?[3,2]:[4,this.context.loadBinary(this.resolveUri(d.uri),b)];case 1:g=a.sent(),f=new Uint8Array(g),this.bufferCache.set(c,f),e.assert(f.byteLength===d.byteLength,"Buffer byte lengths should match."),a.label=2;case 2:return[2,f]}})})};b.prototype.getAccessor=function(c,b){return a.__awaiter(this,void 0,void 0,function(){var d,e,f,g,k,h,l,m;return a.__generator(this,function(a){switch(a.label){case 0:return d=this.json.accessors[c],e=this.errorContext,e.errorUnsupportedIf(null==
d.bufferView,"Some accessor does not specify a bufferView."),e.errorUnsupportedIf(d.type in["MAT2","MAT3","MAT4"],"AttributeType "+d.type+" is not supported"),f=this.json.bufferViews[d.bufferView],[4,this.getBuffer(f.buffer,b)];case 1:return g=a.sent(),k=H[d.type],h=I[d.componentType],l=k*h,m=f.byteStride||l,[2,{raw:g.buffer,byteStride:m,byteOffset:g.byteOffset+(f.byteOffset||0)+(d.byteOffset||0),entryCount:d.count,isDenselyPacked:m===l,componentCount:k,componentByteSize:h,componentType:d.componentType,
min:d.min,max:d.max,normalized:!!d.normalized}]}})})};b.prototype.getIndexData=function(c,b){return a.__awaiter(this,void 0,void 0,function(){var d;return a.__generator(this,function(a){switch(a.label){case 0:return null==c.indices?[2,null]:[4,this.getAccessor(c.indices,b)];case 1:d=a.sent();if(d.isDenselyPacked)switch(d.componentType){case 5121:return[2,new Uint8Array(d.raw,d.byteOffset,d.entryCount)];case 5123:return[2,new Uint16Array(d.raw,d.byteOffset,d.entryCount)];case 5125:return[2,new Uint32Array(d.raw,
d.byteOffset,d.entryCount)]}else switch(d.componentType){case 5121:return[2,z.scalar.makeDense(this.wrapAccessor(v.BufferViewUint8,d))];case 5123:return[2,z.scalar.makeDense(this.wrapAccessor(v.BufferViewUint16,d))];case 5125:return[2,z.scalar.makeDense(this.wrapAccessor(v.BufferViewUint32,d))]}return[2,void 0]}})})};b.prototype.getPositionData=function(c,b){return a.__awaiter(this,void 0,void 0,function(){var d,e;return a.__generator(this,function(a){switch(a.label){case 0:return d=this.errorContext,
d.errorUnsupportedIf(null==c.attributes.POSITION,"No POSITION vertex data found."),[4,this.getAccessor(c.attributes.POSITION,b)];case 1:return e=a.sent(),d.errorUnsupportedIf(5126!==e.componentType,"Expected type FLOAT for POSITION vertex attribute, but found "+G[e.componentType]),d.errorUnsupportedIf(3!==e.componentCount,"POSITION vertex attribute must have 3 components, but found "+e.componentCount.toFixed()),[2,this.wrapAccessor(v.BufferViewVec3f,e)]}})})};b.prototype.getNormalData=function(c,
b){return a.__awaiter(this,void 0,void 0,function(){var d,e;return a.__generator(this,function(a){switch(a.label){case 0:return d=this.errorContext,d.assert(null!=c.attributes.NORMAL,"No NORMAL vertex data found."),[4,this.getAccessor(c.attributes.NORMAL,b)];case 1:return e=a.sent(),d.errorUnsupportedIf(5126!==e.componentType,"Expected type FLOAT for NORMAL vertex attribute, but found "+G[e.componentType]),d.errorUnsupportedIf(3!==e.componentCount,"NORMAL vertex attribute must have 3 components, but found "+
e.componentCount.toFixed()),[2,this.wrapAccessor(v.BufferViewVec3f,e)]}})})};b.prototype.getTangentData=function(c,b){return a.__awaiter(this,void 0,void 0,function(){var d,e;return a.__generator(this,function(a){switch(a.label){case 0:return d=this.errorContext,d.assert(null!=c.attributes.TANGENT,"No TANGENT vertex data found."),[4,this.getAccessor(c.attributes.TANGENT,b)];case 1:return e=a.sent(),d.errorUnsupportedIf(5126!==e.componentType,"Expected type FLOAT for TANGENT vertex attribute, but found "+
G[e.componentType]),d.errorUnsupportedIf(4!==e.componentCount,"TANGENT vertex attribute must have 4 components, but found "+e.componentCount.toFixed()),[2,new v.BufferViewVec4f(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount)]}})})};b.prototype.getTextureCoordinates=function(c,b){return a.__awaiter(this,void 0,void 0,function(){var d,e;return a.__generator(this,function(a){switch(a.label){case 0:return d=this.errorContext,d.assert(null!=c.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found."),
[4,this.getAccessor(c.attributes.TEXCOORD_0,b)];case 1:e=a.sent();d.errorUnsupportedIf(2!==e.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+e.componentCount.toFixed());if(5126===e.componentType)return[2,this.wrapAccessor(v.BufferViewVec2f,e)];d.errorUnsupportedIf(!e.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return[2,w(e)]}})})};b.prototype.getVertexColors=function(c,b){return a.__awaiter(this,void 0,void 0,function(){var d,
e;return a.__generator(this,function(a){switch(a.label){case 0:return d=this.errorContext,d.assert(null!=c.attributes.COLOR_0,"No COLOR_0 vertex data found."),[4,this.getAccessor(c.attributes.COLOR_0,b)];case 1:e=a.sent();d.errorUnsupportedIf(4!==e.componentCount&&3!==e.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+e.componentCount.toFixed());if(4===e.componentCount){if(5126===e.componentType)return[2,this.wrapAccessor(v.BufferViewVec4f,e)];if(5121===e.componentType)return[2,
this.wrapAccessor(v.BufferViewVec4u8,e)];if(5123===e.componentType)return[2,this.wrapAccessor(v.BufferViewVec4u16,e)]}else if(3===e.componentCount){if(5126===e.componentType)return[2,this.wrapAccessor(v.BufferViewVec3f,e)];if(5121===e.componentType)return[2,this.wrapAccessor(v.BufferViewVec3u8,e)];if(5123===e.componentType)return[2,this.wrapAccessor(v.BufferViewVec3u16,e)]}d.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+G[e.componentType]);return[2,void 0]}})})};b.prototype.hasPositions=
function(a){return void 0!==a.attributes.POSITION};b.prototype.hasNormals=function(a){return void 0!==a.attributes.NORMAL};b.prototype.hasVertexColors=function(a){return void 0!==a.attributes.COLOR_0};b.prototype.hasTextureCoordinates=function(a){return void 0!==a.attributes.TEXCOORD_0};b.prototype.hasTangents=function(a){return void 0!==a.attributes.TANGENT};b.prototype.getMaterial=function(c,b){return a.__awaiter(this,void 0,void 0,function(){var d,e,f,g,k,h,l,m,p,q,r;return a.__generator(this,
function(a){switch(a.label){case 0:d=this.errorContext;if(e=this.materialCache.get(c.material))return[3,15];f=null!=c.material?t.material(this.json.materials[c.material]):t.material();g=f.pbrMetallicRoughness;k=this.hasVertexColors(c);h=void 0;if(!g.baseColorTexture)return[3,2];d.errorUnsupportedIf(0!==(g.baseColorTexture.texCoord||0),"Only TEXCOORD with index 0 is supported.");return[4,this.getTexture(g.baseColorTexture.index,b)];case 1:h=a.sent(),a.label=2;case 2:l=void 0;if(!f.normalTexture)return[3,
5];if(0===(f.normalTexture.texCoord||0))return[3,3];d.warnUnsupported("Only TEXCOORD with index 0 is supported for the normal map texture.");return[3,5];case 3:return[4,this.getTexture(f.normalTexture.index,b)];case 4:l=a.sent(),a.label=5;case 5:m=void 0;if(!f.occlusionTexture)return[3,8];if(0===(f.occlusionTexture.texCoord||0))return[3,6];d.warnUnsupported("Only TEXCOORD with index 0 is supported for the occlusion texture.");return[3,8];case 6:return[4,this.getTexture(f.occlusionTexture.index,b)];
case 7:m=a.sent(),a.label=8;case 8:p=void 0;if(!f.emissiveTexture)return[3,11];if(0===(f.emissiveTexture.texCoord||0))return[3,9];d.warnUnsupported("Only TEXCOORD with index 0 is supported for the emissive texture.");return[3,11];case 9:return[4,this.getTexture(f.emissiveTexture.index,b)];case 10:p=a.sent(),a.label=11;case 11:q=void 0;if(!g.metallicRoughnessTexture)return[3,14];if(0===(g.metallicRoughnessTexture.texCoord||0))return[3,12];d.warnUnsupported("Only TEXCOORD with index 0 is supported for the metallicRoughness texture.");
return[3,14];case 12:return[4,this.getTexture(g.metallicRoughnessTexture.index,b)];case 13:q=a.sent(),a.label=14;case 14:r=null!=c.material?c.material:-1,e={alphaMode:f.alphaMode,alphaCutoff:f.alphaCutoff,color:g.baseColorFactor,doubleSided:!!f.doubleSided,colorTexture:h,normalTexture:l,name:f.name,id:r,occlusionTexture:m,emissiveTexture:p,emissiveFactor:f.emissiveFactor,metallicFactor:g.metallicFactor,roughnessFactor:g.roughnessFactor,metallicRoughnessTexture:q,vertexColors:k,ESRI_externalColorMixMode:f.extras.ESRI_externalColorMixMode},
a.label=15;case 15:return[2,e]}})})};b.prototype.getTexture=function(c,b){return a.__awaiter(this,void 0,void 0,function(){var d,e,f,g,k,h,l,m;return a.__generator(this,function(a){switch(a.label){case 0:d=this.errorContext;e=this.json.textures[c];f=t.textureSampler(null!=e.sampler?this.json.samplers[e.sampler]:{});d.errorUnsupportedIf(null==e.source,"Source is expected to be defined for a texture.");g=this.json.images[e.source];if(k=this.textureCache.get(c))return[3,6];h=void 0;return g.uri?[4,this.context.loadImage(this.resolveUri(g.uri),
b)]:[3,2];case 1:return h=a.sent(),[3,5];case 2:return d.errorUnsupportedIf(null==g.bufferView,"Image bufferView must be defined."),d.errorUnsupportedIf(null==g.mimeType,"Image mimeType must be defined."),l=this.json.bufferViews[g.bufferView],[4,this.getBuffer(l.buffer,b)];case 3:return m=a.sent(),d.errorUnsupportedIf(null!=l.byteStride,"byteStride not supported for image buffer"),[4,y(new Uint8Array(m.buffer,m.byteOffset+(l.byteOffset||0),l.byteLength),g.mimeType)];case 4:h=a.sent(),a.label=5;case 5:k=
{data:h,wrapS:f.wrapS,wrapT:f.wrapT,minFilter:f.minFilter,name:g.name,id:c},this.textureCache.set(c,k),a.label=6;case 6:return[2,k]}})})};b.prototype.getNodeTransform=function(a){if(void 0===a)return C;var b=this.nodeTransformCache.get(a);if(!b){var b=this.getNodeTransform(this.getNodeParent(a)),e=this.json.nodes[a];if(e.matrix)b=d.mat4.multiply(c.mat4f64.create(),b,e.matrix);else if(e.translation||e.rotation||e.scale)b=c.mat4f64.clone(b),e.translation&&d.mat4.translate(b,b,e.translation),e.rotation&&
(F[3]=k.quat.getAxisAngle(F,e.rotation),d.mat4.rotate(b,b,F[3],F)),e.scale&&d.mat4.scale(b,b,e.scale);this.nodeTransformCache.set(a,b)}return b};b.prototype.wrapAccessor=function(a,c){return new a(c.raw,c.byteOffset,c.byteStride,c.byteOffset+c.byteStride*(c.entryCount-1)+c.componentByteSize*c.componentCount)};b.prototype.resolveUri=function(a){return f.makeAbsolute(a,this.baseUri)};b.prototype.getNodeParent=function(a){return this.nodeParentMap.get(a)};b.prototype.checkVersionSupported=function(){var a=
l.Version.parse(this.json.asset.version,"glTF");B.validate(a)};b.prototype.checkRequiredExtensionsSupported=function(){var a=this.json,c=this.errorContext;a.extensionsRequired&&0!==a.extensionsRequired.length&&c.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+a.extensionsRequired.join(", "))};b.prototype.computeNodeParents=function(){var a=this;this.json.nodes.forEach(function(c,b){c.children&&c.children.forEach(function(c){a.nodeParentMap.set(c,b)})})};
return b}();b.Resource=n;var B=new l.Version(2,0,"glTF"),C=d.mat4.fromXRotation(c.mat4f64.create(),Math.PI/2),F=p.quatf64.create(),H={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},I=(A={},A[5120]=1,A[5121]=1,A[5122]=2,A[5123]=2,A[5126]=4,A[5125]=4,A),G={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"}})},"esri/core/Version":function(){define(["require","exports","./Error"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,
b,f){void 0===f&&(f="");this.major=a;this.minor=b;this._context=f}b.prototype.lessThan=function(a,b){return this.major<a||a===this.major&&this.minor<b};b.prototype.since=function(a,b){return!this.lessThan(a,b)};b.prototype.validate=function(b){if(this.major!==b.major)throw new a((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:b});};b.prototype.clone=function(){return new b(this.major,
this.minor,this._context)};b.parse=function(h,e){void 0===e&&(e="");var f=h.split("."),g=f[0],f=f[1],l=/^\s*\d+\s*$/;if(!g||!g.match||!g.match(l))throw new a((e&&e+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:h});if(!f||!f.match||!f.match(l))throw new a((e&&e+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:h});h=parseInt(g,10);g=parseInt(f,10);return new b(h,g,e)};return b}();b.Version=n})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a){this.data=a;this.offset4=0;this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}a.prototype.readUint32=function(){var a=this.offset4;this.offset4+=1;return this.dataUint32[a]};a.prototype.readUint8Array=function(a){var b=4*this.offset4;this.offset4+=a/4;return new Uint8Array(this.data,b,a)};a.prototype.remainingBytes=function(){return this.data.byteLength-4*this.offset4};
return a}();b.BinaryStreamReader=n})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["require","exports","tslib","../../../../core/compilerUtils"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});var h={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},e={pbrMetallicRoughness:h,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},f={ESRI_externalColorMixMode:"tint"};b.material=function(b){void 0===b&&(b={});var d=a.__assign(a.__assign({},
h),b.pbrMetallicRoughness),c=a.__assign(a.__assign({},f),b.extras);switch(c.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":case "replace":break;default:m.neverReached(c.ESRI_externalColorMixMode),c.ESRI_externalColorMixMode="tint"}return a.__assign(a.__assign(a.__assign({},e),b),{pbrMetallicRoughness:d,extras:c})};var g={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};b.textureSampler=function(b){return a.__assign(a.__assign({},g),b)}})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.splitURI=function(a){var b,h;a.replace(/^(.*\/)?([^/]*)$/,function(a,f,g){b=f||"";h=g||"";return""});return{dirPart:b,filePart:h}}})},"esri/views/3d/support/buffer/utils":function(){define("require exports ./types ./utils/mat3 ./utils/mat4 ./utils/scalar ./utils/vec2 ./utils/vec3 ./utils/vec4".split(" "),function(n,b,a,m,h,e,f,g,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat3=m;b.mat4=h;b.scalar=e;b.vec2=f;b.vec3=
g;b.vec4=l;b.createBuffer=function(b,c){return new b(new ArrayBuffer(c*b.ElementCount*a.elementTypeSize(b.ElementType)))}})},"esri/views/3d/support/buffer/utils/mat3":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(a,b,h){var e=a.typedBuffer;a=a.typedBufferStride;var f=b.typedBuffer,g=b.typedBufferStride;b=h?h.count:b.count;var l=(h&&h.dstIndex?h.dstIndex:0)*a;h=(h&&h.srcIndex?h.srcIndex:0)*g;for(var d=0;d<b;++d){for(var c=0;9>
c;++c)e[l+c]=f[h+c];l+=a;h+=g}}})},"esri/views/3d/support/buffer/utils/mat4":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(a,b,h){var e=a.typedBuffer;a=a.typedBufferStride;var f=b.typedBuffer,g=b.typedBufferStride;b=h?h.count:b.count;var l=(h&&h.dstIndex?h.dstIndex:0)*a;h=(h&&h.srcIndex?h.srcIndex:0)*g;for(var d=0;d<b;++d){for(var c=0;16>c;++c)e[l+c]=f[h+c];l+=a;h+=g}}})},"esri/views/3d/support/buffer/utils/scalar":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(a,b,h){var e=a.typedBuffer;a=a.typedBufferStride;var f=b.typedBuffer,g=b.typedBufferStride;b=h?h.count:b.count;var l=(h&&h.dstIndex?h.dstIndex:0)*a;h=(h&&h.srcIndex?h.srcIndex:0)*g;for(var d=0;d<b;++d)e[l]=f[h],l+=a,h+=g};b.makeDense=function(a,b){var h=a.count;b||(b=new a.TypedArrayConstructor(h));for(var e=0;e<h;e++)b[e]=a.get(e);return b}})},"esri/views/3d/support/buffer/utils/vec2":function(){define(["require",
"exports","../types"],function(n,b,a){function m(a,b,f){var e=a.typedBuffer;a=a.typedBufferStride;var h=b.typedBuffer,d=b.typedBufferStride;b=f?f.count:b.count;var c=(f&&f.dstIndex?f.dstIndex:0)*a;f=(f&&f.srcIndex?f.srcIndex:0)*d;for(var k=0;k<b;++k)e[c]=h[f],e[c+1]=h[f+1],c+=a,f+=d}Object.defineProperty(b,"__esModule",{value:!0});b.copy=m;b.normalizeIntegerBuffer=function(b,e,f){var g=b.typedBuffer,h=b.typedBufferStride,d=e.typedBuffer,c=e.typedBufferStride,k=f?f.count:e.count,p=(f&&f.dstIndex?f.dstIndex:
0)*h,r=(f&&f.srcIndex?f.srcIndex:0)*c;if(a.isInteger(e.elementType))if(f=a.maximumValue(e.elementType),a.isSigned(e.elementType))for(e=0;e<k;++e)g[p]=Math.max(d[r]/f,-1),g[p+1]=Math.max(d[r+1]/f,-1),p+=h,r+=c;else for(e=0;e<k;++e)g[p]=d[r]/f,g[p+1]=d[r+1]/f,p+=h,r+=c;else m(b,e,f);return b}})},"esri/views/3d/support/buffer/utils/vec3":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(a,b,h){var e=a.typedBuffer;a=a.typedBufferStride;
var f=b.typedBuffer,g=b.typedBufferStride;b=h?h.count:b.count;var l=(h&&h.dstIndex?h.dstIndex:0)*a;h=(h&&h.srcIndex?h.srcIndex:0)*g;for(var d=0;d<b;++d)e[l]=f[h],e[l+1]=f[h+1],e[l+2]=f[h+2],l+=a,h+=g}})},"esri/views/3d/support/buffer/utils/vec4":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(a,b,h){var e=a.typedBuffer;a=a.typedBufferStride;var f=b.typedBuffer,g=b.typedBufferStride;b=h?h.count:b.count;var l=(h&&h.dstIndex?h.dstIndex:
0)*a;h=(h&&h.srcIndex?h.srcIndex:0)*g;for(var d=0;d<b;++d)e[l]=f[h],e[l+1]=f[h+1],e[l+2]=f[h+2],e[l+3]=f[h+3],l+=a,h+=g};b.fill=function(a,b,h,e,f,g){var l=a.typedBuffer,d=a.typedBufferStride;a=g?g.count:a.count;g=(g&&g.dstIndex?g.dstIndex:0)*d;for(var c=0;c<a;++c)l[g]=b,l[g+1]=h,l[g+2]=e,l[g+3]=f,g+=d}})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["require","exports","../../../../core/typedArrayUtil","../../webgl-engine/lib/geometryDataUtils"],function(n,b,a,m){function h(a){return m.generateDefaultIndexArray(a)}
Object.defineProperty(b,"__esModule",{value:!0});b.linearIndexArray=h;b.trianglesToTriangles=function(b){return"number"===typeof b?h(b):a.isUint16Array(b)||a.isUint8Array(b)?new Uint32Array(b):b};b.triangleStripToTriangles=function(a){var b="number"===typeof a?a:a.length;if(3>b)return new Uint32Array(0);var b=b-2,e=new Uint32Array(3*b);if("number"===typeof a)for(var h=0,d=0;d<b;d+=1)0===d%2?(e[h++]=d,e[h++]=d+1):(e[h++]=d+1,e[h++]=d),e[h++]=d+2;else for(d=h=0;d<b;d+=1){if(0===d%2)var c=a[d],k=a[d+
1],m=a[d+2];else c=a[d+1],k=a[d],m=a[d+2];e[h++]=c;e[h++]=k;e[h++]=m}return e};b.triangleFanToTriangles=function(a){var b="number"===typeof a?a:a.length;if(3>b)return new Uint32Array(0);var b=b-2,e=new Uint32Array(3*b);if("number"===typeof a){for(var h=0,d=0;d<b;++d)e[h++]=0,e[h++]=d+1,e[h++]=d+2;return e}for(var c=a[0],k=a[1],d=h=0;d<b;++d){var m=a[d+2];e[h++]=c;e[h++]=k;k=e[h++]=m}return e}})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("require exports tslib ../../../../request ../../../../core/asyncUtils ../../../../core/Error ../../../../core/lang ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Version ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../support/imageUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z){function w(c,b){return a.__awaiter(this,void 0,void 0,function(){var e,f;return a.__generator(this,function(a){switch(a.label){case 0:return(e=l.isSome(b)&&b.streamDataRequester)?[2,q(c,e,b)]:[4,h.result(m(c,l.unwrap(b)))];case 1:f=a.sent();if(!0===f.ok)return[2,f.value.data];d.throwIfAbortError(f.error);y(f.error);return[2,void 0]}})})}function q(c,b,e){return a.__awaiter(this,void 0,void 0,function(){var f;return a.__generator(this,function(a){switch(a.label){case 0:return[4,
h.result(b.request(c,"json",e))];case 1:f=a.sent();if(!0===f.ok)return[2,f.value];d.throwIfAbortError(f.error);y(f.error.details.url);return[2,void 0]}})})}function y(a){throw new e("","Request for object resource failed: "+a);}function A(a){var c=p.empty();a.forEach(function(a){a=a.boundingInfo;p.expand(c,a.getBBMin());p.expand(c,a.getBBMax())});return c}function B(c,b){return a.__awaiter(this,void 0,void 0,function(){var e,f,g,k,h,m,p,q;return a.__generator(this,function(a){switch(a.label){case 0:e=
[];f=function(a){var f=c[a],g=f.images[0].data;if(!g)return F.warn("Externally referenced texture data is not yet supported"),"continue";var g=f.encoding+";base64,"+g,k="/textureDefinitions/"+a,h={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:!0};a=l.isSome(b)&&b.disableTextures?d.resolve(null):r.requestImage(g,b);e.push(a.then(function(a){return{refId:k,image:a,params:h,alphaChannelUsage:"rgba"===f.channels?f.alphaChannelUsage||"transparency":"none"}}))};for(g in c)f(g);return[4,d.all(e)];
case 1:k=a.sent();h={};m=0;for(p=k;m<p.length;m++)q=p[m],h[q.refId]=q;return[2,h]}})})}function C(a){switch(a){case "mask":return 2;case "maskAndTransparency":return 3;case "none":return 1;case "transparency":return 0;default:return 0}}Object.defineProperty(b,"__esModule",{value:!0});var F=g.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");b.load=function(c,b){return a.__awaiter(this,void 0,void 0,function(){var d,e;return a.__generator(this,function(a){switch(a.label){case 0:return[4,
w(c,b)];case 1:return d=a.sent(),[4,B(d.textureDefinitions,b)];case 2:return e=a.sent(),[2,{resource:d,textures:e}]}})})};b.processLoadResult=function(a,b){var d,e,g=[],h=[],m=[],p=[],q=a.resource,r=c.Version.parse(q.version||"1.0","wosr");H.validate(r);var r=q.model.name,w=q.model.geometries,y=q.materialDefinitions;a=a.textures;for(var B=0,n=new Map,G=0;G<w.length;G++){var I=w[G];e=I;var X=e.params,Y=X.topology;d=!0;X.vertexAttributes||(F.warn("Geometry must specify vertex attributes"),d=!1);switch(X.topology){case "PerAttributeArray":break;
case "Indexed":case null:case void 0:Y=X.faces;if(!Y)F.warn("Indexed geometries must specify faces"),d=!1;else if(X.vertexAttributes){var da=void 0;for(da in X.vertexAttributes)(X=Y[da])&&X.values?(null!=X.valueType&&"UInt32"!==X.valueType&&(F.warn("Unsupported indexed geometry indices type '"+X.valueType+"', only UInt32 is currently supported"),d=!1),null!=X.valuesPerElement&&1!==X.valuesPerElement&&(F.warn("Unsupported indexed geometry values per element '"+X.valuesPerElement+"', only 1 is currently supported"),
d=!1)):(F.warn("Indexed geometry does not specify face indices for '"+da+"' attribute"),d=!1)}break;default:F.warn("Unsupported topology '"+Y+"'"),d=!1}e.params.material||(F.warn("Geometry requires material"),d=!1);e=e.params.vertexAttributes;X=void 0;for(X in e)e[X].values||(F.warn("Geometries with externally defined attributes are not yet supported"),d=!1);if(d){e=I.params;d=e.material;e=e.texture;var Y=I.params.vertexAttributes,X={},fa;for(fa in Y)da=Y[fa],X[fa]={data:da.values,size:da.valuesPerElement};
Y={};if("PerAttributeArray"===I.params.topology){for(var I=X.position.data.length/X.position.size,da=new Uint32Array(I),ga=0;ga<I;ga++)da[ga]=ga;var I=da,ka;for(ka in X)Y[ka]=I}else{var I=I.params.faces,la;for(la in I)Y[la]=new Uint32Array(I[la].values)}(I=a&&a[e])&&!n.has(e)&&(da=new v(I.image,r,I.params),p.push(da),n.set(e,da));da=(da=n.get(e))?da.id:void 0;ga=m[d]?m[d][e]:null;if(!ga){ga=d.substring(d.lastIndexOf("/")+1);ga=y[ga].params;1===ga.transparency&&(ga.transparency=0);var ia=I&&I.alphaChannelUsage,
ia=0<ga.transparency||"transparency"===ia||"maskAndTransparency"===ia,I={ambient:k.vec3f64.fromArray(ga.diffuse),diffuse:k.vec3f64.fromArray(ga.diffuse),opacity:1-(ga.transparency||0),transparent:ia,textureAlphaMode:I?C(I.alphaChannelUsage):void 0,textureAlphaCutoff:.33,textureId:da,initTextureTransparent:!0,doubleSided:!0,cullFace:0,colorMixMode:ga.externalColorMixMode||"tint",textureAlphaPremultiplied:!0};l.isSome(b)&&b.materialParamsMixin&&f.mixin(I,b.materialParamsMixin);ga=new z(I,r);m[d]||(m[d]=
{});m[d][e]=ga}h.push(ga);d=new t(new u.GeometryData(X,Y),r);B+=Y.position?Y.position.length:0;g.push(d)}}return{name:r,stageResources:{textures:p,materials:h,geometries:g},pivotOffset:q.model.pivotOffset,boundingBox:A(g),numberOfVertices:B,lodThreshold:null}};b.createTextureResources=B;var H=new c.Version(1,2,"wosr")})},"esri/views/3d/support/buffer/math":function(){define(["require","exports","./math/vec3","./math/vec4"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.vec3=
a;b.vec4=m})},"esri/views/3d/support/buffer/math/vec4":function(){define(["require","exports","./common"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.transformMat4=function(b,h,e){if(b.count!==h.count)a.logger.error("source and destination buffers need to have the same number of elements");else{var f=b.count,g=e[0],l=e[1],d=e[2],c=e[3],k=e[4],m=e[5],r=e[6],t=e[7],u=e[8],v=e[9],z=e[10],w=e[11],q=e[12],y=e[13],A=e[14];e=e[15];var B=b.typedBuffer;b=b.typedBufferStride;var n=h.typedBuffer;
h=h.typedBufferStride;for(var F=0;F<f;F++){var H=F*b,I=F*h,G=n[I],J=n[I+1],E=n[I+2],I=n[I+3];B[H]=g*G+k*J+u*E+q*I;B[H+1]=l*G+m*J+v*E+y*I;B[H+2]=d*G+r*J+z*E+A*I;B[H+3]=c*G+t*J+w*E+e*I}}};b.transformMat3=function(b,h,e){if(b.count!==h.count)a.logger.error("source and destination buffers need to have the same number of elements");else{var f=b.count,g=e[0],l=e[1],d=e[2],c=e[3],k=e[4],m=e[5],r=e[6],t=e[7];e=e[8];var u=b.typedBuffer;b=b.typedBufferStride;var v=h.typedBuffer;h=h.typedBufferStride;for(var z=
0;z<f;z++){var w=z*b,q=z*h,y=v[q],A=v[q+1],B=v[q+2],q=v[q+3];u[w]=g*y+c*A+r*B;u[w+1]=l*y+k*A+t*B;u[w+2]=d*y+m*A+e*B;u[w+3]=q}}};b.scale=function(a,b,e){var f=Math.min(a.count,b.count),g=a.typedBuffer;a=a.typedBufferStride;var h=b.typedBuffer;b=b.typedBufferStride;for(var d=0;d<f;d++){var c=d*a,k=d*b;g[c]=e*h[k];g[c+1]=e*h[k+1];g[c+2]=e*h[k+2];g[c+3]=e*h[k+3]}};b.shiftRight=function(a,b,e){var f=Math.min(a.count,b.count),g=a.typedBuffer;a=a.typedBufferStride;var h=b.typedBuffer;b=b.typedBufferStride;
for(var d=0;d<f;d++){var c=d*a,k=d*b;g[c]=h[k]>>e;g[c+1]=h[k+1]>>e;g[c+2]=h[k+2]>>e;g[c+3]=h[k+3]>>e}}})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4f64 ../../../../../geometry/support/aaBoundingBox ../../../support/debugFlags ../../../support/buffer/glUtil ../../core/shaderLibrary/output/OutputHighlight.glsl ../Camera ../DefaultVertexAttributeLocations ../intersectorUtils ../Util ./InstanceData ./InstanceOctree ./LevelSelector ./RenderInstanceData ../../materials/DefaultMaterial ../../materials/internal/MaterialUtil ../../materials/renderers/utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C){function F(a,c,b,d){y.encodeDoubleVec3(a.modelOrigin,c,b.modelOriginHi,b.modelOriginLo,d);b.model.copyFrom(d,a.model,c);b.modelNormal.copyFrom(d,a.modelNormal,c);a.color&&b.color&&b.color.copyFrom(d,a.color,c);a.featureAttribute&&b.featureAttribute&&b.featureAttribute.copyFrom(d,a.featureAttribute,c)}Object.defineProperty(b,"__esModule",{value:!0});var H=function(a){var c=a.baseBoundingSphere.radius;a=a.levels.map(function(a){return a.minScreenSpaceRadius});
return new v.LevelSelector(c,a)};b.setLevelSelectorFactory=function(a){H=a};var I=function(){function a(a,c){var b=a.rctx,d=c.geometry;c=c.material;var e=d.data.toRenderData();this.materialRep=a.materialRep;c.setParameterValues({instancedDoublePrecision:!0});a=c.createBufferWriter();var f=a.vertexBufferLayout,g=a.elementCount(e),h=a.allocate(g);a.write({},e,h,0);this.geometry=d;this.material=c;this.glMaterials=y.acquireMaterials(c,this.materialRep);this.vertexBufferLayout=f;this.vbo=A.createVertex(b,
35044,h.buffer);this.vao=new C(b,k.Default3D,{geometry:l.glLayout(f)},{geometry:this.vbo});this.vertexCount=g}a.prototype.destroy=function(){y.releaseMaterials(this.material,this.materialRep);this.vbo.dispose();this.vao.dispose()};Object.defineProperty(a.prototype,"boundingInfo",{get:function(){return this.geometry.boundingInfo},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"triangleCount",{get:function(){return this.vertexCount/3},enumerable:!0,configurable:!0});a.prototype.intersect=
function(a,c,b,d,e,f){var g=this.geometry.id,k=e.toString();this.material.intersect(this.geometry,null,a.transform.transform,a,b,d,function(b,d,h,l){if(0<=b&&(null==c||c(a.rayBeginPoint,a.rayEndPoint,b))){var m={type:"external",metadata:{layerUid:f.layerUid,graphicUid:f.graphicUid(e)}};if(null==a.results.min.drapedLayerOrder||l>=a.results.min.drapedLayerOrder)if(null==a.results.min.dist||b<a.results.min.dist)a.results.min.set(m,k,b,d,a.transform.transform,l,null,g,h),a.results.min.intersector="LodRenderer";
0!==a.options.store&&(null==a.results.max.drapedLayerOrder||l>=a.results.max.drapedLayerOrder)&&(null==a.results.max.dist||b>a.results.max.dist)&&(a.results.max.set(m,k,b,d,a.transform.transform,l,null,g,h),a.results.min.intersector="LodRenderer");if(2===a.options.store){var q=new p.IntersectorResult(a.results.min.ray);q.set(m,k,b,d,a.transform.transform,l,null,g,h);q.intersector="LodRenderer";a.results.all.push(q)}}})};return a}();b.LodComponentData=I;var G=function(){function a(a,c){var b=this;
this.components=[];this.minScreenSpaceRadius=c.minScreenSpaceRadius;c.components.forEach(function(c){b.components.push(new I(a,c))})}a.prototype.destroy=function(){this.components.forEach(function(a){a.destroy()})};a.prototype.intersect=function(a,c,b,d,e,f){this.components.forEach(function(g){g.intersect(a,c,b,d,e,f)})};Object.defineProperty(a.prototype,"boundingBox",{get:function(){if(!this._boundingBox){var a=f.empty();this.components.forEach(function(c){f.expand(a,c.boundingInfo.bbMin);f.expand(a,
c.boundingInfo.bbMax)});this._boundingBox=a}return this._boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"boundingSphere",{get:function(){if(!this._boundingSphere){var a=this.boundingBox,c=h.vec3f64.create();f.center(a,c);this._boundingSphere={center:c,radius:.5*f.diameter(a)}}return this._boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"triangleCount",{get:function(){return this.components.reduce(function(a,c){return a+c.triangleCount},
0)},enumerable:!0,configurable:!0});return a}();b.LodLevelData=G;n=function(){function a(a,d,e,f){var g=this;this.type="Lod";this.isGround=!1;this._levels=[];this._renderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._slicePlane=!1;this._enableLevelSelection=!0;this._lastCamera=new c.default;this._updateCyclesWithStaticCamera=-1;this._needFullCycle=!1;this.canRender=!0;this._symbol=a;this._optionalFields=d;this._metadata=e;this._instanceBufferLayout=w.getInstanceBufferLayout({instancedDoublePrecision:!0,
instanced:d});this._glInstanceBufferLayout=l.glLayout(this._instanceBufferLayout,{divisor:1});this._instanceData=new t.InstanceData(this._optionalFields,f);this._instanceData.on("instance-added",function(){g.requestUpdateCycle()});this._instanceData.on("instance-removed",function(){g.requestUpdateCycle()});this._instanceData.on("instance-transform-changed",function(a){g.requestUpdateCycle();g._metadata.notifyGraphicUpdate(a.index,2)});this._instanceData.on("instance-visibility-changed",function(a){g.requestUpdateCycle(!0);
g._metadata.notifyGraphicUpdate(a.index,1)});this._instanceData.on("instance-highlight-changed",function(){g.requestUpdateCycle(!0)});this._enableLevelSelection=1<this._symbol.levels.length;b.lodRenderers.push(this)}a.prototype.destroy=function(){b.lodRenderers.splice(b.lodRenderers.indexOf(this),1)};Object.defineProperty(a.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"baseBoundingBox",{get:function(){return this._levels[this._levels.length-
1].boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"baseBoundingSphere",{get:function(){return this._levels[this._levels.length-1].boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"baseMaterial",{get:function(){return this._levels[this._levels.length-1].components[0].material},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"slicePlane",{get:function(){return this._slicePlane},set:function(a){this._slicePlane=a},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"intersectionHandlerId",{get:function(){return this._metadata.layerUid},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"instanceData",{get:function(){return this._instanceData},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"memoryUsage",{get:function(){var a={cpu:0,gpu:0};this._renderInstanceData.forEach(function(c){c=c.memoryUsage;a.cpu+=c.cpu;a.gpu+=c.gpu});this._highlightRenderInstanceData.forEach(function(c){c=
c.memoryUsage;a.cpu+=c.cpu;a.gpu+=c.gpu});return a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderStats",{get:function(){var a=this,c=this._instanceData.size,b=[];this._levels.forEach(function(c,d){d=a._renderInstanceData[d].size+a._highlightRenderInstanceData[d].size;c=c.triangleCount;b.push({renderedInstances:d,renderedTriangles:d*c,trianglesPerInstance:c})});return{totalInstances:c,renderedInstances:b.reduce(function(a,c){return a+c.renderedInstances},0),renderedTriangles:b.reduce(function(a,
c){return a+c.renderedTriangles},0),levels:b}},enumerable:!0,configurable:!0});a.prototype.initializeRenderContext=function(a){var c=this;this._initContext=a;var b=a.rctx;this._symbol.levels.forEach(function(d){c._levels.push(new G(a,d));c._renderInstanceData.push(new z.RenderInstanceData(b,c._instanceBufferLayout));c._highlightRenderInstanceData.push(new z.RenderInstanceData(b,c._instanceBufferLayout))});this._levelSelector=H(this)};a.prototype.uninitializeRenderContext=function(){this.invalidateOctree();
this._levels.forEach(function(a){a.destroy()});this._renderInstanceData.forEach(function(a){a.destroy()});this._highlightRenderInstanceData.forEach(function(a){a.destroy()})};Object.defineProperty(a.prototype,"slots",{get:function(){return[4,6]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"needsHighlight",{get:function(){return 0<this._highlightRenderInstanceData.reduce(function(a,c){return a+c.size},0)},enumerable:!0,configurable:!0});a.prototype.prepareRender=function(a){this.runUpdates(a)};
a.prototype.render=function(a){var c=this,b=a.rctx,d=4===a.slot?3:6===a.slot?5:null;if(d){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(a.pass))return!1;var e=a.camera,f={slot:d,view:e.viewMatrix,proj:e.projectionMatrix,origin:[0,0,0],viewInvTransp:e.viewInverseTransposeMatrix,viewport:e.fullViewport,fovY:e.fovY,nearFar:[e.near,e.far],shadowMap:a.shadowMap,shadowMappingEnabled:!!a.shadowMap&&a.shadowMap.enabled,ssaoEnabled:!!a.ssaoHelper&&a.ssaoHelper.enabled,pixelRatio:e.pixelRatio,
slicePlane:a.sliceHelper&&a.sliceHelper.plane,cameraAboveGround:e.aboveGround,hudVisibilityTexture:a.offscreenRenderingHelper?a.offscreenRenderingHelper.hudVisibilityTexture:null,highlightDepthTexture:a.offscreenRenderingHelper?a.offscreenRenderingHelper.depthTexture:null,hasOccludees:!1,linearDepthTexture:null,linearDepthTextureID:0,lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,ssrViewMat:null,rpProjectionMat:null,ssrEnabled:!1};b.bindVAO();for(var b=function(b){var e=
a.isHighlightPass?g._highlightRenderInstanceData[b]:g._renderInstanceData[b];g._levels[b].components.forEach(function(g){c.renderComponent(a,d,f,e,g,b)})},g=this,e=0;e<this._levels.length;++e)b(e);return!0}};a.prototype.intersect=function(a,c,b,d){var e=this;if(this.baseMaterial.isVisible()){var f=h.vec3f64.create();m.vec3.subtract(f,d,b);var g=function(f){e._instanceData.getCombinedModelTransform(f,L);a.transform.set(L);m.vec3.transformMat4(M,b,a.transform.inverse);m.vec3.transformMat4(N,d,a.transform.inverse);
var g=e._instanceData.getState(f),k=e._instanceData.getLodLevel(f);r.assert(g&t.StateFlags.ACTIVE,"invalid instance state");r.assert(0<=k&&k<e._levels.length,"invaid lod level");e._levels[k].intersect(a,c,M,N,f,e._metadata)};this.baseMaterial.getParameters().verticalOffset?this.octree.forEach(g):this.octree.forEachAlongRay(b,f,g)}};a.prototype.queryDepthRange=function(a){return this.queryDepthRangeOctree(a)};a.prototype.notifyShaderTransformationChanged=function(){this.invalidateOctree()};a.prototype.requestUpdateCycle=
function(a){void 0===a&&(a=!1);this._updateCyclesWithStaticCamera=-1;a&&(this._needFullCycle=!0);this.needsUpdates&&this._initContext.requestRender()};Object.defineProperty(a.prototype,"needsUpdates",{get:function(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera},enumerable:!0,configurable:!0});a.prototype.runUpdates=function(a){if(!g.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){var c=a.equals(this._lastCamera);this._lastCamera.copyFrom(a);c||this.requestUpdateCycle()}c=
this._needFullCycle?this._instanceData.size:2E3;this._needFullCycle=!1;this.updateInstances(a,c);this.needsUpdates&&this._initContext.requestRender()}};Object.defineProperty(a.prototype,"octree",{get:function(){this._octree||(this._octree=this.buildOctree());return this._octree},enumerable:!0,configurable:!0});a.prototype.invalidateOctree=function(){this._octree&&(this._octree.destroy(),this._octree=null)};a.prototype.buildOctree=function(){for(var a=new u.InstanceOctree(this._instanceData,this.baseBoundingSphere),
c=this._instanceData,c=c.view?c.view.state:null,b=0;b<this._instanceData.capacity;++b)c.get(b)&t.StateFlags.ACTIVE&&a.addInstance(b);return a};a.prototype.queryDepthRangeOctree=function(a){var c=a.eye,b=a.viewForward,d=this.octree.findClosest(b,"front-to-back",a.frustum),e=this.octree.findClosest(b,"back-to-front",a.frustum);return null!=d&&null!=e?(this._instanceData.view.boundingSphere.getVec(d,E),m.vec3.subtract(E,E,c),d=m.vec3.dot(E,b)-E[3],this._instanceData.view.boundingSphere.getVec(e,E),m.vec3.subtract(E,
E,c),c=m.vec3.dot(E,b)+E[3],{near:Math.max(a.near,d),far:Math.min(a.far,c)}):{near:Infinity,far:-Infinity}};a.prototype.startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;this._renderInstanceData.forEach(function(a){a.startUpdateCylce()});this._highlightRenderInstanceData.forEach(function(a){a.startUpdateCylce()});this.needsUpdates&&this._initContext.requestRender()};a.prototype.updateInstances=function(a,c){var b=this._enableLevelSelection,d=this._levelSelector;d.updateCamera(a);this._renderInstanceData.forEach(function(a){a.beginUpdate()});
this._highlightRenderInstanceData.forEach(function(a){a.beginUpdate()});a=this._instanceData;var e=this._instanceData.view,f=a.capacity,g=this._instanceIndex;c=Math.min(a.size,c);for(var k=0;k<c;++k){0===g&&this.startUpdateCycle();var h=e.state.get(g),l=0;if(h&t.StateFlags.ALLOCATED){var m=e.lodLevel.get(g);h&t.StateFlags.ACTIVE&&this._renderInstanceData[m].freeTail();h&t.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[m].freeTail();if(h&t.StateFlags.REMOVE)a.freeInstance(g);else if(h&
t.StateFlags.VISIBLE){m=0;b&&(e.modelOrigin.getVec(g,J),m=d.selectLevel(J,a.getCombinedMedianScaleFactor(g)));l=h&~(t.StateFlags.ACTIVE|t.StateFlags.HIGHLIGHT_ACTIVE|t.StateFlags.TRANSFORM_CHANGED);if(0<=m){var p=this._renderInstanceData[m],q=p.allocateHead();F(e,g,p.view,q);l|=t.StateFlags.ACTIVE;h&t.StateFlags.HIGHLIGHT&&(p=this._highlightRenderInstanceData[m],q=p.allocateHead(),F(e,g,p.view,q),l|=t.StateFlags.HIGHLIGHT_ACTIVE)}e.state.set(g,l);e.lodLevel.set(g,m)}else l=h&~(t.StateFlags.ACTIVE|
t.StateFlags.HIGHLIGHT_ACTIVE|t.StateFlags.TRANSFORM_CHANGED),e.state.set(g,l);this._octree&&(m=!!(h&t.StateFlags.ACTIVE),l=!!(l&t.StateFlags.ACTIVE),!m&&l?this._octree.addInstance(g):m&&!l?this._octree.removeInstance(g):m&&l&&h&t.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(g),this._octree.addInstance(g)));g=(g+1)%f}else g=(g+1)%f,c++}this._instanceIndex=g;this._renderInstanceData.forEach(function(a){a.endUpdate()});this._highlightRenderInstanceData.forEach(function(a){a.endUpdate()})};
a.prototype.renderComponent=function(a,c,b,e,f,h){var l=f.glMaterials.get(a.pass);if(l&&l.beginSlot(c)&&0!==e.size){var m=a.rctx,p=m.capabilities.instancing;l.ensureParameters(b);var t=l.getTechnique();c=l.getPipelineState(c);m.setPipelineState(c);l.bind(m,b);m.bindVAO(f.vao);t.ensureAttributeLocations(f.vao);l=t.program;a.isHighlightPass&&d.OutputHighlight.bindOutputHighlight(m,l,b);t.bindDraw(b);g.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&0===a.pass&&(l.setUniform4fv("externalColor",Q[Math.min(h,
Q.length-1)]),l.setUniform1i("colorMixMode",q.colorMixModes.replace));a=e.capacity;b=e.headIndex;h=e.tailIndex;var l=e.firstIndex,w=this._glInstanceBufferLayout;c=function(a,c){B.bindVertexBufferLayout(m,k.Default3D,e.buffer,w,a);p.drawArraysInstanced(t.primitiveType,0,f.vertexCount,c-a);B.unbindVertexBufferLayout(m,k.Default3D,e.buffer,w)};f.material.getParameters().transparent&&null!=l?b>h?(r.assert(l>=h&&l<=b,"invalid firstIndex"),c(l,b),c(h,l)):b<h&&(l<=b?(r.assert(0<=l&&l<=b,"invalid firstIndex"),
c(l,b),c(h,a),c(0,l)):(r.assert(l>=h&&l<=a,"invalid firstIndex"),c(l,a),c(0,b),c(h,l))):b>h?c(h,b):b<h&&(c(0,b),c(h,a));m.bindVAO(null)}};return a}();b.LodRenderer=n;b.lodRenderers=[];var J=h.vec3f64.create(),E=e.vec4f64.create(),L=a.mat4f64.create(),M=h.vec3f64.create(),N=h.vec3f64.create(),Q=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]]})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("require exports tslib ../../../../../core/Evented ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils ../../../support/buffer/BufferView ../../../support/buffer/InterleavedLayout ../Util".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r){Object.defineProperty(b,"__esModule",{value:!0});var t;(function(a){a[a.ALLOCATED=1]="ALLOCATED";a[a.ACTIVE=2]="ACTIVE";a[a.VISIBLE=4]="VISIBLE";a[a.HIGHLIGHT=8]="HIGHLIGHT";a[a.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";a[a.REMOVE=32]="REMOVE";a[a.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED"})(t=b.StateFlags||(b.StateFlags={}));var u=function(){return function(a){this.localTransform=a.getField("localTransform",k.BufferViewMat4f64);this.globalTransform=a.getField("globalTransform",
k.BufferViewMat4f64);this.modelOrigin=a.getField("modelOrigin",k.BufferViewVec3f64);this.model=a.getField("model",k.BufferViewMat3f);this.modelNormal=a.getField("modelNormal",k.BufferViewMat3f);this.modelScaleFactors=a.getField("modelScaleFactors",k.BufferViewVec2f);this.boundingSphere=a.getField("boundingSphere",k.BufferViewVec4f64);this.color=a.getField("color",k.BufferViewVec4f);this.featureAttribute=a.getField("featureAttribute",k.BufferViewVec4f);this.state=a.getField("state",k.BufferViewUint8);
this.lodLevel=a.getField("lodLevel",k.BufferViewUint8)}}();b.View=u;n=function(b){function d(a,c){var d=b.call(this)||this;d._capacity=0;d._size=0;d._next=0;var e=p.newLayout().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("model").mat3f("modelNormal").vec2f("modelScaleFactors");0<=a.indexOf("color")&&(e=e.vec4f("color"));0<=a.indexOf("featureAttribute")&&(e=e.vec4f("featureAttribute"));e=e.u8("state").u8("lodLevel").alignTo(8);d._layout=
e;d._shaderTransformation=c;return d}a.__extends(d,b);Object.defineProperty(d.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0});
d.prototype.addInstance=function(){this._size+1>this._capacity&&this.grow();var a=this.findSlot();this._view.state.set(a,t.ALLOCATED);this._size++;this.emit("instance-added",{index:a});return a};d.prototype.removeInstance=function(a){var c=this._view.state;r.assert(0<=a&&a<this._capacity&&c.get(a)&t.ALLOCATED,"invalid instance handle");this.getStateFlag(a,t.ACTIVE)?this.setStateFlags(a,t.REMOVE):this.freeInstance(a);this.emit("instance-removed",{index:a})};d.prototype.freeInstance=function(a){var c=
this._view.state;r.assert(0<=a&&a<this._capacity&&c.get(a)&t.ALLOCATED,"invalid instance handle");c.set(a,0);this._size--};d.prototype.setLocalTransform=function(a,c,b){void 0===b&&(b=!0);this._view.localTransform.setMat(a,c);b&&this.updateModelTransform(a)};d.prototype.getLocalTransform=function(a,c){this._view.localTransform.getMat(a,c)};d.prototype.setGlobalTransform=function(a,c,b){void 0===b&&(b=!0);this._view.globalTransform.setMat(a,c);b&&this.updateModelTransform(a)};d.prototype.getGlobalTransform=
function(a,c){this._view.globalTransform.getMat(a,c)};d.prototype.updateModelTransform=function(a){var b=this._view,d=w,e=q;b.localTransform.getMat(a,y);b.globalTransform.getMat(a,A);var g=f.mat4.multiply(A,A,y);l.vec3.set(d,g[12],g[13],g[14]);b.modelOrigin.setVec(a,d);h.mat3.fromMat4(e,g);b.model.setMat(a,e);d=c.scaleFromMatrix(w,g);d.sort();b.modelScaleFactors.set(a,0,d[1]);b.modelScaleFactors.set(a,1,d[2]);h.mat3.invert(e,e);h.mat3.transpose(e,e);b.modelNormal.setMat(a,e);this.setStateFlags(a,
t.TRANSFORM_CHANGED);this.emit("instance-transform-changed",{index:a})};d.prototype.getModelTransform=function(a,c){var b=this._view;b.model.getMat(a,q);b.modelOrigin.getVec(a,w);c[0]=q[0];c[1]=q[1];c[2]=q[2];c[3]=0;c[4]=q[3];c[5]=q[4];c[6]=q[5];c[7]=0;c[8]=q[6];c[9]=q[7];c[10]=q[8];c[11]=0;c[12]=w[0];c[13]=w[1];c[14]=w[2];c[15]=1};d.prototype.applyShaderTransformation=function(a,c){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,a,c)};d.prototype.getCombinedModelTransform=
function(a,c){this.getModelTransform(a,c);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,a,c);return c};d.prototype.getCombinedLocalTransform=function(a,c){this._view.localTransform.getMat(a,c);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,a,c);return c};d.prototype.getCombinedMaxScaleFactor=function(a){var c=this._view.modelScaleFactors.get(a,1);this._shaderTransformation&&(a=this._shaderTransformation.scaleFactor(w,this,a),c*=Math.max(a[0],
a[1],a[2]));return c};d.prototype.getCombinedMedianScaleFactor=function(a){var c=this._view.modelScaleFactors.get(a,0);this._shaderTransformation&&(a=this._shaderTransformation.scaleFactor(w,this,a),a.sort(),c*=a[1]);return c};d.prototype.getModel=function(a,c){this._view.model.getMat(a,c)};d.prototype.setFeatureAttribute=function(a,c){this._view.featureAttribute.setVec(a,c)};d.prototype.getFeatureAttribute=function(a,c){this._view.featureAttribute.getVec(a,c)};d.prototype.setColor=function(a,c){this._view.color.setVec(a,
c)};d.prototype.getColor=function(a,c){this._view.color.getVec(a,c)};d.prototype.setVisible=function(a,c){c!==this.getVisible(a)&&(this.setStateFlag(a,t.VISIBLE,c),this.emit("instance-visibility-changed",{index:a}))};d.prototype.getVisible=function(a){return this.getStateFlag(a,t.VISIBLE)};d.prototype.setHighlight=function(a,c){c!==this.getHighlight(a)&&(this.setStateFlag(a,t.HIGHLIGHT,c),this.emit("instance-highlight-changed",{index:a}))};d.prototype.getHighlight=function(a){return this.getStateFlag(a,
t.HIGHLIGHT)};d.prototype.getState=function(a){return this._view.state.get(a)};d.prototype.getLodLevel=function(a){return this._view.lodLevel.get(a)};d.prototype.countFlags=function(a){for(var c=0,b=0;b<this._capacity;++b)this.getState(b)&a&&++c;return c};d.prototype.setStateFlags=function(a,c){var b=this._view.state;c|=b.get(a);b.set(a,c)};d.prototype.clearStateFlags=function(a,c){var b=this._view.state;c=b.get(a)&~c;b.set(a,c)};d.prototype.setStateFlag=function(a,c,b){b?this.setStateFlags(a,c):
this.clearStateFlags(a,c)};d.prototype.getStateFlag=function(a,c){return!!(this._view.state.get(a)&c)};d.prototype.grow=function(){var a=Math.max(v,Math.floor(this._capacity*z)),c=this._layout.createBuffer(a);if(this._buffer){var b=new Uint8Array(this._buffer.buffer);(new Uint8Array(c.buffer)).set(b)}this._capacity=a;this._buffer=c;this._view=new u(this._buffer)};d.prototype.findSlot=function(){for(var a=this._view.state,c=this._next;a.get(c)&t.ALLOCATED;)c=(c+1)%this._capacity;this._next=(c+1)%this._capacity;
return c};return d}(m);b.InstanceData=n;var v=1024,z=2,w=d.vec3f64.create(),q=e.mat3f64.create(),y=g.mat4f64.create(),A=g.mat4f64.create()})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("require exports tslib ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils ../Octree".split(" "),function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});n=
function(b){function d(a,d){var c=b.call(this,{getCenter:function(a){var b=c._instanceData.view.boundingSphere,d=c._tmpCenter;d[0]=b.get(a,0);d[1]=b.get(a,1);d[2]=b.get(a,2);return d},getRadius:function(a){return c._instanceData.view.boundingSphere.get(a,3)}},{maximumDepth:25})||this;c._tmpCenter=e.vec3f64.create();c._tmpMat4=m.mat4f64.create();c._instanceData=a;c._boundingSphere=d;return c}a.__extends(d,b);d.prototype.addInstance=function(a){var c=this._instanceData.view.boundingSphere,b=this._instanceData.getCombinedModelTransform(a,
this._tmpMat4),d=h.vec3.transformMat4(this._tmpCenter,this._boundingSphere.center,b),b=this._boundingSphere.radius*f.maxScale(b);c.set(a,0,d[0]);c.set(a,1,d[1]);c.set(a,2,d[2]);c.set(a,3,b);this.add(a)};d.prototype.removeInstance=function(a){this.remove(a)};return d}(g);b.InstanceOctree=n})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["require","exports","../Camera"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,e){this.thresholdScale=
1;this._camera=new a.default;this._worldSpaceRadius=b;this._thresholds=e.map(function(a){return a})}b.prototype.updateCamera=function(a){this._camera.copyFrom(a)};b.prototype.selectLevel=function(a,b){a=this._camera.computeScreenPixelSizeAt(a);b=this._worldSpaceRadius*b/a;a=this._thresholds;for(var e=-1,g=0;g<a.length;++g)b>=a[g]*this.thresholdScale&&(e=g);return e};return b}();b.LevelSelector=n})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define(["require","exports",
"../../../support/buffer/BufferView","../Util","./BackedBufferObject"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});var e=function(){return function(c){this.modelOriginHi=c.getField("modelOriginHi",a.BufferViewVec3f);this.modelOriginLo=c.getField("modelOriginLo",a.BufferViewVec3f);this.model=c.getField("model",a.BufferViewMat3f);this.modelNormal=c.getField("modelNormal",a.BufferViewMat3f);this.color=c.getField("instanceColor",a.BufferViewVec4f);this.featureAttribute=c.getField("instanceFeatureAttribute",
a.BufferViewVec4f)}}();b.View=e;n=function(){function a(a,c){this._tailIndex=this._headIndex=0;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=a;this._instanceBufferLayout=c;this._elementSize=c.stride;this._capacity=1}a.prototype.destroy=function(){this._buffer&&this._buffer.destroy()};Object.defineProperty(a.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"view",{get:function(){return this._view},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){var a=this._headIndex,c=this._tailIndex;return a>=c?a-c:a+this._capacity-c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isEmpty",{get:function(){return this._headIndex===this._tailIndex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isFull",{get:function(){return this._tailIndex===
(this._headIndex+1)%this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"headIndex",{get:function(){return this._headIndex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"tailIndex",{get:function(){return this._tailIndex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"firstIndex",{get:function(){return this._firstIndex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"memoryUsage",{get:function(){return this._buffer?
this._buffer.memoryUsage:{cpu:0,gpu:0}},enumerable:!0,configurable:!0});a.prototype.reset=function(){this._tailIndex=this._headIndex=0;this._firstIndex=null};a.prototype.startUpdateCylce=function(){this._captureFirstIndex=!0};a.prototype.beginUpdate=function(){m.assert(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex};a.prototype.endUpdate=function(){m.assert(this._updating,"not updating");this.size<l*this.capacity&&this.shrink();this._resized?(this._buffer.transferAll(),
this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};a.prototype.allocateHead=function(){m.assert(this._updating,"not updating");this.isFull&&this.grow();var a=this.headIndex;this._captureFirstIndex&&(this._firstIndex=a,this._captureFirstIndex=!1);this.incrementHead();m.assert(this._headIndex!==this._tailIndex,"invalid pointers");return a};a.prototype.freeTail=function(){m.assert(this._updating,"not updating");m.assert(0<this.size,"invalid size");var a=this._tailIndex===
this._firstIndex;this.incrementTail();a&&(this._firstIndex=this._tailIndex)};a.prototype.grow=function(){this.resize(Math.max(f,Math.floor(this._capacity*g)))};a.prototype.shrink=function(){c&&this.resize(Math.max(f,Math.floor(this._capacity*d)))};a.prototype.resize=function(a){m.assert(this._updating,"not updating");if(a!==this._capacity){var c=new h(this._rctx,34962,35044,this._elementSize,a);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%
this._capacity);var b=this.size,d=this.compactInstances(c);m.assert(d===b,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=d;this._prevHeadIndex=0}this._resized=!0;this._capacity=a;this._buffer=c;this._view=new e(this._instanceBufferLayout.createView(this._buffer.array))}};a.prototype.compactInstances=function(a){var c=this._headIndex,b=this._tailIndex;return b<c?(this._buffer.copyRange(b,c,a),c-b):b>c?(this._buffer.copyRange(b,this._capacity,a),0<c&&this._buffer.copyRange(0,
c,a,this._capacity-b),c+(this._capacity-b)):0};a.prototype.incrementHead=function(a){void 0===a&&(a=1);this._headIndex=(this._headIndex+a)%this._capacity};a.prototype.incrementTail=function(a){void 0===a&&(a=1);this._tailIndex=(this._tailIndex+a)%this._capacity};a.prototype.transferRange=function(a,c){a<c?this._buffer.transferRange(a,c):a>c&&(0<c&&this._buffer.transferRange(0,c),this._buffer.transferRange(a,this._capacity))};return a}();b.RenderInstanceData=n;var f=1024,g=2,l=.3,d=.5,c=!0})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["require",
"exports","../../../../webgl/BufferObject"],function(n,b,a){return function(){function b(b,e,f,g,l){this._elementSize=g;this._buffer=new a(b,e,f);this.resize(l)}b.prototype.destroy=function(){this._buffer.dispose()};Object.defineProperty(b.prototype,"elementSize",{get:function(){return this._elementSize},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"array",{get:function(){return this._array},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"memoryUsage",{get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}},enumerable:!0,configurable:!0});b.prototype.copyRange=function(a,b,f,g){void 0===g&&(g=0);a=new Uint8Array(this.array,a*this.elementSize,(b-a)*this.elementSize);(new Uint8Array(f.array,g*this.elementSize)).set(a)};
b.prototype.transferAll=function(){this._buffer.setData(this._array)};b.prototype.transferRange=function(a,b){a*=this._elementSize;this._buffer.setSubData(this._array,a,a,b*this._elementSize)};b.prototype.resize=function(a){var b=a*this._elementSize,f=new ArrayBuffer(b);this._array&&(a>=this._capacity?(new Uint8Array(f)).set(new Uint8Array(this._array)):(new Uint8Array(f)).set((new Uint8Array(this._array)).subarray(0,a*this._elementSize)));this._array=f;this._buffer.setData(b);this._capacity=a};return b}()})},
"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("require exports tslib ../../../../core/Error ../../../../core/lang ../../../../core/mathUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat2 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ../support/FastSymbolUpdates ../../support/projectionUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G){function J(a,b,d){switch(b){case "world":for(var f=0,k=a.vertices;f<k.length;f++)b=k[f],c.vec3.add(W,b.pos,a.offset),d.worldUpAtPosition(W,R),b.setFrameFromUpVector(R),b.computeRotationAxisAndAngleFromUpVector();break;case "path":for(c.vec3.add(W,a.vertices[0].pos,a.offset),d.worldUpAtPosition(W,R),H.computeMinimumRotationTangentFrame(a,R),d=0,a=a.vertices;d<a.length;d++){b=a[d];f=e.sign(c.vec3.dot(b.frame.right,b.vRight));c.vec3.cross(b.rotationFrame.up,
b.vRight,b.vLeft);c.vec3.scale(b.rotationFrame.up,b.rotationFrame.up,f);c.vec3.normalize(b.rotationFrame.up,b.rotationFrame.up);var k=c.vec3.dot(b.rotationFrame.up,b.frame.up),h=c.vec3.dot(b.rotationFrame.up,b.frame.right);c.vec3.scale(W,b.frame.up,-h);c.vec3.scale(O,b.frame.right,k);c.vec3.add(W,W,O);c.vec3.normalize(b.rotationFrame.right,W);H.vertexSpaceToProfileSpace(b.rotationRight,b.frame,b.rotationFrame.right);c.vec3.negate(W,b.vLeft);b.rotationAngle=-f*(Math.PI-e.acosClamped(c.vec3.dot(W,b.vRight)));
0<Math.abs(b.rotationAngle)&&(f=e.reciprocalClamped(Math.cos(.5*b.rotationAngle)),g.mat2.set(b.miterStretch,1+(f-1)*b.rotationRight[0]*b.rotationRight[0],(f-1)*b.rotationRight[0]*b.rotationRight[1],(f-1)*b.rotationRight[0]*b.rotationRight[1],1+(f-1)*b.rotationRight[1]*b.rotationRight[1]));b.maxStretchDistance=Math.abs(Math.min(b.vLeftLength,b.vRightLength)*e.reciprocalClamped(Math.cos(.5*(Math.PI-b.rotationAngle))))}}}function E(a,c,b){switch(a){case "symbol-value":return b;case "proportional":return c;
default:return a}}function L(a,b,d,e){a=a.stageObject;var f=a.geometryRecords,g=f.length,k=0;N.spatialReference=d.spatialReference;M.spatialReference=e.spatialReference;for(var h=0;h<g;h++){var l=f[h].geometry,m=l.metadata,p=m.pathGeometry,q=p.builder.path;Q.spatialReference=m.geometrySR;for(var r=q,t=b,w=d,y=e,v=0,A=0,z=r.vertices;A<z.length;A++){var B=z[A];N.x=B.posES[0];N.y=B.posES[1];N.z=B.posES[2];var n=u.evaluateElevationAlignmentAtPoint(N,w,t,y,U),v=v+U.sampledElevation;c.vec3.add(R,B.pos,
r.offset);y.setAltitude(n,R);c.vec3.subtract(B.pos,R,r.offset)}r.updatePathVertexInformation();k+=v/r.vertices.length;"world"!==q.upVector&&J(q,m.upVectorAlignment,e);p.onPathChanged();l.invalidateBoundingInfo();a.geometryVertexAttrsUpdated(h)}return k/g}Object.defineProperty(b,"__esModule",{value:!0});n=function(e){function g(a,c,b,f){a=e.call(this,a,c,b,f)||this;a._intrinsicSize=d.vec2f64.fromValues(1,1);a.upVectorAlignment="path";a.stencilWidth=.1;a.ensureDrapedStatus(!1);return a}a.__extends(g,
e);g.prototype.doLoad=function(){return a.__awaiter(this,void 0,void 0,function(){var c,d,e,g,k,q,r,t,w,u,v,z,B,n;return a.__generator(this,function(a){c=f.isSome(this.symbolLayer.width)?this.symbolLayer.width:f.isSome(this.symbolLayer.height)?this.symbolLayer.height:this.symbolLayer.size;d=f.isSome(this.symbolLayer.height)?this.symbolLayer.height:c;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[c,1,d],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],
scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?A.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};e=this.symbolLayer.anchor||"center";this.upVectorAlignment="path";"heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world");g=this.symbolLayer.profile||"circle";switch(g){default:this._profile=
H.Profile.circle(b.NUM_CIRCLE_PROFILE_SUBDIVISIONS);break;case "quad":this._profile=H.Profile.rect()}k=[0,0];"center"!==e&&(k={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[e],this._profile.translate(k[0],k[1]));q=this.symbolLayer.join||"simple";switch(q){case "round":this._extruder=new H.MiterExtruder(0,b.NUM_ROUND_JOIN_SUBDIVISIONS);break;case "bevel":this._extruder=new H.MiterExtruder(0,1);break;case "miter":this._extruder=new H.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new H.SimpleExtruder}r=
this.symbolLayer.cap||"butt";switch(r){case "none":this._startCap=new H.NoCapBuilder;this._endCap=new H.NoCapBuilder;break;default:this._startCap=new H.TriangulationCapBuilder(this._profile,0);this._endCap=new H.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new H.TriangulationCapBuilder(this._profile,-.5);this._endCap=new H.TriangulationCapBuilder(this._profile,.5,!0);break;case "round":t="quad"===g?!0:!1,this._startCap=new H.RoundCapBuilder({profile:this._profile,
flip:!1,breakNormals:t,subdivisions:b.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS}),this._endCap=new H.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:t,subdivisions:b.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS})}w=this._getIdHint();u=f.get(this.symbolLayer,"material","color");v=this._getCombinedOpacityAndColor(u);z=p.vec3f64.fromArray(v);B=v[3];n={diffuse:z,ambient:z,opacity:B,transparent:1>B||this.needsDrivenTransparentPass,vertexColors:!1,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,
cullFace:"none"===r?0:void 0,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(l.vec2.set(this._intrinsicSize,c,d),!y.isValidSize(this._intrinsicSize[0])||!y.isValidSize(this._intrinsicSize[1])))throw new m("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||l.vec2.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);this._fastUpdates.enabled?
(h.mixin(n,this._fastUpdates.materialParameters,{size:[this._intrinsicSize[0],this._intrinsicSize[1],0]}),this._material=new G(n,w+"_pathmat")):(n.vertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new I(n,w+"_pathmat"));this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._context.stage.add(3,this._material);return[2]})})};g.prototype.destroy=function(){e.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,
this._material.id),this._material=null)};g.prototype.createGraphics3DGraphic=function(a){var c=a.graphic;if(!this._validateGeometryType(c.geometry,g.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(c.geometry))return null;var b="graphic"+c.uid,d=this.setGraphicElevationContext(c,new z.ElevationContext);return this._createAs3DShape(c,a.renderingInfo,d,b,c.uid)};g.prototype.layerOpacityChanged=function(){var a=f.get(this.symbolLayer,"material","color"),a=this._getCombinedOpacity(a);
this._material.setParameterValues({opacity:a,transparent:1>a||this.needsDrivenTransparentPass});return!0};g.prototype.layerElevationInfoChanged=function(a,c){return this.updateGraphics3DGraphicElevationInfo(a,c,v.needsElevationUpdates3D)};g.prototype.slicePlaneEnabledChanged=function(){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};g.prototype.physicalBasedRenderingChanged=function(){this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0});return!0};g.prototype.pixelRatioChanged=function(){return!0};g.prototype.applyRendererDiff=function(a,c){for(var b in a.diff)switch(b){case "visualVariables":if(A.updateFastSymbolUpdatesState(this._fastUpdates,c,this._vvConvertOptions))this._material.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};g.prototype.getVertexData=function(a){for(var c=0,b=a.paths,d=[],e=a.spatialReference,f=this._context.elevationProvider.spatialReference,
g=this._context.renderCoordsHelper.spatialReference,k=0;k<b.length;k++)var h=b[k],c=c+h.length;for(var k=new Float64Array(3*c),l=new Float64Array(3*c),m=new Float64Array(3*c),p=0,q=0;q<b.length;q++){h=b[q];d.push({index:p,numVertices:h.length});for(var r=0;r<h.length;r++){var t=h[r];k[p++]=t[0];k[p++]=t[1];k[p++]=a.hasZ?t[2]:0}}a=!0;e.equals(f)?this._copyVertices(k,0,l,0,c):a=B.bufferToBuffer(k,e,0,l,f,0,c);f.equals(g)?this._copyVertices(l,0,m,0,c):B.bufferToBuffer(l,f,0,m,g,0,c);return{pathVertexDataInfos:d,
vertexDataGS:k,vertexDataES:l,vertexDataRS:m,projectionSuccess:a,terrainElevation:0}};g.prototype._copyVertices=function(a,c,b,d,e){c*=3;d*=3;for(var f=0;f<e;++f)b[d++]=a[c++],b[d++]=a[c++],b[d++]=a[c++]};g.prototype._createAs3DShape=function(a,b,d,e,g){var k=a.geometry,h=[],l=[],m=[],p=k.spatialReference,t=this._context.elevationProvider.spatialReference,y=r.create(),A=this._context.renderCoordsHelper;Q.spatialReference=p;N.spatialReference=t;k=this.getVertexData(k);if(!k.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),
null;if(0<k.pathVertexDataInfos.length){for(t=0;t<k.pathVertexDataInfos.length;++t){var z=k.pathVertexDataInfos[t],B=z.index,z=z.numVertices;if(2>z)this.logger.warn("PathSymbol3DLayer geometry failed to be created (paths should contain at least 2 vertices)");else{if(f.isSome(this._context.clippingExtent)&&(r.empty(y),r.expandWithBuffer(y,k.vertexDataES,3*B,z),!r.intersectsClippingArea(y,this._context.clippingExtent)))continue;for(var n=[],G=B;G<B+3*z;){var P=G++,I=G++,T=G++,M=new H.PathVertex;c.vec3.set(M.posGS,
k.vertexDataGS[P],k.vertexDataGS[I],k.vertexDataGS[T]);c.vec3.set(M.posES,k.vertexDataES[P],k.vertexDataES[I],k.vertexDataES[T]);N.x=M.posES[0];N.y=M.posES[1];N.z=M.posES[2];var V=u.evaluateElevationAlignmentAtPoint(N,this._context.elevationProvider,d,A,null);c.vec3.set(R,k.vertexDataRS[P],k.vertexDataRS[I],k.vertexDataRS[T]);A.setAltitude(V,R);c.vec3.set(M.pos,R[0],R[1],R[2]);n.push(M)}B=new H.Path(n);J(B,this.upVectorAlignment,this._context.renderCoordsHelper);B=new H.Builder(B,this._profile,this._extruder,
this._startCap,this._endCap);z=null;this._fastUpdates.enabled?(G=this._fastUpdates.visualVariables,z=G.size?q.getAttributeValue(G.size.field,a):0,n=G.color?q.getAttributeValue(G.color.field,a):0,G=G.opacity?q.getAttributeValue(G.opacity.field,a):0,z=new H.FastUpdatePathGeometry(B,z,n,G)):(z=[this._intrinsicSize[0],this._intrinsicSize[1]],this._drivenProperties.size&&(z[0]*=E(b.size[0],"symbol-value"===b.size[2]?this.symbolLayer.height||0:b.size[2],this.symbolLayer.width||0),z[1]*=E(b.size[2],"symbol-value"===
b.size[0]?this.symbolLayer.width||0:b.size[0],this.symbolLayer.height||0)),n=null,this._drivenProperties.color&&(n=b.color),this._drivenProperties.opacity&&null!=b.opacity&&(n=n?[n[0],n[1],n[2],b.opacity]:[1,1,1,b.opacity]),B=new H.StaticPathGeometry(B),B.bake(z),n&&B.bakeVertexColors(n),z=B);B=z.createGeometryData();B=new C(B,e+"path"+t);B.metadata={pathGeometry:z,geometrySR:p,upVectorAlignment:this.upVectorAlignment,stencilWidth:this.stencilWidth};h.push(B);l.push(this._material);m.push(z.xform)}}a=
{layerUid:this._context.layer.uid,graphicUid:g};if(0<h.length)return e=new F({geometries:h,materials:l,transformations:m,castShadow:!0,metadata:a,idHint:e}),h=new w(this,e,h,null,null,L,d),h.alignedSampledElevation=k.terrainElevation,h.needsElevationUpdates=v.needsElevationUpdates3D(d.mode),h}else this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null};g.validGeometryTypes=["polyline"];return g}(q.Graphics3DSymbolLayer);b.Graphics3DPathSymbolLayer=
n;var M=t.makeDehydratedPoint(0,0,0,null),N=t.makeDehydratedPoint(0,0,0,null),Q=t.makeDehydratedPoint(0,0,0,null),R=p.vec3f64.create(),W=k.vec3f32.create(),O=k.vec3f32.create();b.NUM_ROUND_JOIN_SUBDIVISIONS=3;b.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS=3;b.NUM_CIRCLE_PROFILE_SUBDIVISIONS=10;var U={verticalDistanceToGround:0,sampledElevation:0};b.default=n})},"esri/core/libs/gl-matrix-2/mat2":function(){define(["require","exports","./math/mat2"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});
b.mat2=a})},"esri/core/libs/gl-matrix-2/math/mat2":function(){define(["require","exports","./common"],function(n,b,a){function m(a,b,g){var e=b[0],d=b[1],c=b[2];b=b[3];var f=g[0],h=g[1],m=g[2];g=g[3];a[0]=e*f+c*h;a[1]=d*f+b*h;a[2]=e*m+c*g;a[3]=d*m+b*g;return a}function h(a,b,g){a[0]=b[0]-g[0];a[1]=b[1]-g[1];a[2]=b[2]-g[2];a[3]=b[3]-g[3];return a}Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a};b.identity=function(a){a[0]=1;a[1]=
0;a[2]=0;a[3]=1;return a};b.set=function(a,b,g,h,d){a[0]=b;a[1]=g;a[2]=h;a[3]=d;return a};b.transpose=function(a,b){if(a===b){var e=b[1];a[1]=b[2];a[2]=e}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a};b.invert=function(a,b){var e=b[0],f=b[1],d=b[2];b=b[3];var c=e*b-d*f;if(!c)return null;c=1/c;a[0]=b*c;a[1]=-f*c;a[2]=-d*c;a[3]=e*c;return a};b.adjoint=function(a,b){var e=b[0];a[0]=b[3];a[1]=-b[1];a[2]=-b[2];a[3]=e;return a};b.determinant=function(a){return a[0]*a[3]-a[2]*a[1]};b.multiply=m;
b.rotate=function(a,b,g){var e=b[0],d=b[1],c=b[2];b=b[3];var f=Math.sin(g);g=Math.cos(g);a[0]=e*g+c*f;a[1]=d*g+b*f;a[2]=e*-f+c*g;a[3]=d*-f+b*g;return a};b.scale=function(a,b,g){var e=b[1],d=b[2],c=b[3],f=g[0];g=g[1];a[0]=b[0]*f;a[1]=e*f;a[2]=d*g;a[3]=c*g;return a};b.fromRotation=function(a,b){var e=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=e;a[2]=-e;a[3]=b;return a};b.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=b[1];return a};b.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+
")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))};b.LDU=function(a,b,g,h){a[2]=h[2]/h[0];g[0]=h[0];g[1]=h[1];g[3]=h[3]-a[2]*g[1];return[a,b,g]};b.add=function(a,b,g){a[0]=b[0]+g[0];a[1]=b[1]+g[1];a[2]=b[2]+g[2];a[3]=b[3]+g[3];return a};b.subtract=h;b.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]};b.equals=function(b,f){var e=b[0],h=b[1],d=b[2];b=b[3];var c=f[0],k=f[1],m=f[2];f=f[3];return Math.abs(e-
c)<=a.EPSILON*Math.max(1,Math.abs(e),Math.abs(c))&&Math.abs(h-k)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(d-m)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(m))&&Math.abs(b-f)<=a.EPSILON*Math.max(1,Math.abs(b),Math.abs(f))};b.multiplyScalar=function(a,b,g){a[0]=b[0]*g;a[1]=b[1]*g;a[2]=b[2]*g;a[3]=b[3]*g;return a};b.multiplyScalarAndAdd=function(a,b,g,h){a[0]=b[0]+g[0]*h;a[1]=b[1]+g[1]*h;a[2]=b[2]+g[2]*h;a[3]=b[3]+g[3]*h;return a};b.mul=m;b.sub=h})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("require exports tslib ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat2 ../../../../core/libs/gl-matrix-2/mat2f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./GeometryData ./GeometryUtil ./Util ../materials/PathTechnique ../materials/internal/MaterialUtil".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z){var w;(function(b){function w(){return{up:k.vec3f64.create(),right:k.vec3f64.create()}}b.makeFrame=w;b.profileSpaceToVertexSpace=function(a,c,b){a[0]=b[0]*c.right[0]+b[1]*c.up[0];a[1]=b[0]*c.right[1]+b[1]*c.up[1];a[2]=b[0]*c.right[2]+b[1]*c.up[2]};b.vertexSpaceToProfileSpace=function(a,b,d){l.vec2.set(a,c.vec3.dot(d,b.right),c.vec3.dot(d,b.up))};var n=function(){function a(){this.pos=k.vec3f64.create();this.posES=k.vec3f64.create();this.posGS=k.vec3f64.create();
this.vRight=k.vec3f64.create();this.vLeft=k.vec3f64.create();this.frame=w();this.rotationFrame=w();this.rotationRight=d.vec2f64.create();this.rotationAngle=0;this.miterStretch=e.mat2f64.create()}a.prototype.setFrameFromUpVector=function(a){c.vec3.copy(this.frame.up,a);c.vec3.add(F,this.vLeft,this.vRight);c.vec3.normalize(F,F);c.vec3.scale(C,this.frame.up,c.vec3.dot(F,this.frame.up));c.vec3.subtract(G,F,C);c.vec3.normalize(G,G);c.vec3.cross(this.frame.right,G,this.frame.up)};a.prototype.computeRotationAxisAndAngleFromUpVector=
function(){c.vec3.copy(this.rotationFrame.up,this.frame.up);c.vec3.copy(this.rotationFrame.right,this.frame.right);l.vec2.set(this.rotationRight,1,0);c.vec3.scale(C,this.frame.up,c.vec3.dot(this.frame.up,this.vLeft));c.vec3.subtract(C,this.vLeft,C);c.vec3.negate(C,C);c.vec3.normalize(C,C);c.vec3.scale(F,this.frame.up,c.vec3.dot(this.frame.up,this.vRight));c.vec3.subtract(F,this.vRight,F);c.vec3.normalize(F,F);c.vec3.cross(H,this.rotationFrame.up,this.vLeft);this.rotationAngle=m.sign(c.vec3.dot(H,
this.vRight))*(Math.PI-m.acosClamped(c.vec3.dot(C,F)));if(0<Math.abs(this.rotationAngle)){var a=m.reciprocalClamped(Math.cos(.5*this.rotationAngle));h.mat2.set(this.miterStretch,1+(a-1),0,0,1)}this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*(Math.PI-this.rotationAngle)))};return a}();b.PathVertex=n;n=function(){function a(){this.vertices=[];this.vertexIndices=[];this.vertexNormals=[];this.poles=[];this.poleIndices=[];this.uvIndices=this.uvs=null}a.prototype.addVertex=
function(a,c){this.vertices.push(d.vec2f64.clone(a));this.vertexNormals.push(d.vec2f64.clone(c));return this.vertices.length-1};a.prototype.addUV=function(a){this.uvs||(this.uvs=[],this.uvIndices=[]);this.uvs.push(a);return this.uvs.length-1};a.prototype.addPole=function(a,c){void 0===c&&(c=null);this.poles.push({position:d.vec2f64.clone(a),normal:c?d.vec2f64.clone(c):null});return this.poles.length-1};a.prototype.addSegment=function(a,c,b){void 0===c&&(c=null);void 0===b&&(b=null);this.vertexIndices.push(a.v0);
this.vertexIndices.push(a.v1);c&&(this.uvIndices.push(c.v0),this.uvIndices.push(c.v1));b&&(this.poleIndices.push(b.v0),this.poleIndices.push(b.v1))};Object.defineProperty(a.prototype,"numSegments",{get:function(){return this.vertexIndices.length/2},enumerable:!0,configurable:!0});a.prototype.hasUV=function(){return null!=this.uvs};a.prototype.translate=function(a,c){for(var b=0,d=this.vertices;b<d.length;b++){var e=d[b];e[0]+=a;e[1]+=c}b=0;for(d=this.poles;b<d.length;b++)e=d[b],e.position[0]+=a,e.position[1]+=
c};a.circle=function(c){void 0===c&&(c=20);var b=new a,e={v0:0,v1:0};b.addPole(d.vec2f64.fromValues(0,0));for(var f=0;f<c;++f){var g=2*f*Math.PI/c,k=Math.cos(g),h=Math.sin(g),g=d.vec2f64.fromValues(.5*k,.5*h),k=d.vec2f64.fromValues(k,h);b.addVertex(g,k);b.addUV(f/c)}b.addUV(1);for(f=0;f<c-1;++f)k={v0:f,v1:f+1},b.addSegment(k,k,e);b.addSegment({v0:c-1,v1:0},{v0:c-1,v1:c},e);return b};a.rect=function(){var c=new a,b=d.vec2f64.fromValues(-.5,-.5),e=d.vec2f64.fromValues(.5,-.5),f=d.vec2f64.fromValues(.5,
.5),g=d.vec2f64.fromValues(-.5,.5),k=d.vec2f64.fromValues(0,-1),h=d.vec2f64.fromValues(1,0),l=d.vec2f64.fromValues(0,1),m=d.vec2f64.fromValues(-1,0);c.addUV(0);c.addUV(1);c.addPole(d.vec2f64.fromValues(0,.5),l);c.addPole(d.vec2f64.fromValues(0,.5));c.addPole(d.vec2f64.fromValues(0,-.5));c.addPole(d.vec2f64.fromValues(0,-.5),k);var p={v0:0,v1:1};c.addVertex(b,k);c.addVertex(e,k);c.addSegment({v0:0,v1:1},p,{v0:3,v1:3});c.addVertex(e,h);c.addVertex(f,h);c.addSegment({v0:2,v1:3},p,{v0:2,v1:1});c.addVertex(f,
l);c.addVertex(g,l);c.addSegment({v0:4,v1:5},p,{v0:0,v1:0});c.addVertex(g,m);c.addVertex(b,m);c.addSegment({v0:6,v1:7},p,{v0:1,v1:2});return c};return a}();b.Profile=n;n=function(){function a(a){this.vertices=[];this.offset=k.vec3f64.create();this.xform=g.mat4f64.create();this.vertices=a;c.vec3.copy(this.offset,this.vertices[Math.floor((a.length-1)/2)].pos);a=0;for(var b=this.vertices;a<b.length;a++){var d=b[a];c.vec3.subtract(d.pos,d.pos,this.offset)}f.mat4.translate(this.xform,this.xform,this.offset);
this.updatePathVertexInformation()}a.prototype.updatePathVertexInformation=function(){var a=this.vertices.length,b=this.vertices[0];b.index=0;c.vec3.set(b.vLeft,0,0,0);b.vLeftLength=0;c.vec3.subtract(b.vRight,this.vertices[1].pos,b.pos);b.vRightLength=c.vec3.length(b.vRight);c.vec3.normalize(b.vRight,b.vRight);for(var d=b,e=1;e<a;++e)b=this.vertices[e],b.index=e,c.vec3.copy(b.vLeft,d.vRight),b.vLeftLength=d.vRightLength,e<a-1?(c.vec3.subtract(b.vRight,this.vertices[e+1].pos,b.pos),b.vRightLength=
c.vec3.length(b.vRight),c.vec3.normalize(b.vRight,b.vRight)):(c.vec3.copy(b.vRight,b.vLeft),b.vRightLength=b.vLeftLength),d=b};return a}();b.Path=n;b.computeMinimumRotationTangentFrame=function(a,b){var d=null,e=a.vertices.length,f=k.vec3f64.create(),g=k.vec3f64.create(),h=k.vec3f64.create(),l=k.vec3f64.create(),m=k.vec3f64.create(),q=k.vec3f64.create(),r=p.plane.create(),w=a.vertices[0];c.vec3.copy(g,b);c.vec3.set(f,0,1,0);t.makeOrthoBasisDirUpFallback(w.vRight,g,f,f,h,g,.99619469809);c.vec3.copy(w.frame.up,
g);c.vec3.copy(w.frame.right,h);d=w;for(b=1;b<e;++b){w=a.vertices[b];c.vec3.add(m,w.vLeft,w.vRight);var u=c.vec3.length(m);0<u?(u=1/Math.sqrt(u),m[0]*=u,m[1]*=u,m[2]*=u):(m[0]=w.vRight[0],m[1]=w.vRight[1],m[2]=w.vRight[2]);c.vec3.add(q,d.pos,d.frame.up);p.plane.fromPositionAndNormal(w.pos,m,r);p.plane.intersectRay(r,p.ray.wrap(q,w.vLeft),l)?(c.vec3.subtract(l,l,w.pos),c.vec3.normalize(g,l),c.vec3.cross(h,m,g),c.vec3.normalize(h,h)):t.makeOrthoBasisDirUpFallback(m,d.frame.up,d.frame.right,f,h,g,.99619469809);
c.vec3.copy(w.frame.up,g);c.vec3.copy(w.frame.right,h);d=w}};n=function(){return function(){}}();b.Extruder=n;n=function(){function a(){}a.prototype.numProfilesPerJoin=function(){return 1};a.prototype.extrude=function(a,c,b){for(var d=0;d<c.vertices.length;++d)b(a.index,a.frame,c.vertices[d],c.vertexNormals[d],!1)};return a}();b.SimpleExtruder=n;n=function(){function a(a,c){void 0===a&&(a=.8*Math.PI);void 0===c&&(c=1);this.cutoffAngle=a;this.numBendSubdivisions=c}a.prototype.numProfilesPerJoin=function(){return this.numBendSubdivisions+
1};a.prototype.extrude=function(a,b,d){var e=J;if(Math.abs(a.rotationAngle)>=this.cutoffAngle)for(var g=0;g<this.numBendSubdivisions+1;++g){f.mat4.identity(E);f.mat4.rotate(E,E,.5*-a.rotationAngle+g*a.rotationAngle/this.numBendSubdivisions,a.rotationFrame.up);var k=e,h=a.frame,m=E;c.vec3.transformMat4(k.up,h.up,m);c.vec3.transformMat4(k.right,h.right,m);for(k=0;k<b.vertices.length;++k)h=l.vec2.dot(b.vertices[k],a.rotationRight),(h=0<=h*a.rotationAngle)?d(a.index,e,b.vertices[k],b.vertexNormals[k],
!1):(l.vec2.transformMat2(y,b.vertices[k],a.miterStretch),d(a.index,a.frame,y,b.vertexNormals[k],!0))}else for(g=0;g<this.numBendSubdivisions+1;++g)for(k=0;k<b.vertices.length;++k)h=l.vec2.dot(b.vertices[k],a.rotationRight),h=0<=h*a.rotationAngle,l.vec2.transformMat2(y,b.vertices[k],a.miterStretch),d(a.index,a.frame,y,b.vertexNormals[k],h?!1:!0)};return a}();b.MiterExtruder=n;var L={generateUV:!1},n=function(){function a(){}a.prototype.rebuildConnectingProfileGeometry=function(a,c,b){for(var d=0;d<
c.vertices.length;++d)b(a.index,a.frame,c.vertices[d],c.vertexNormals[d],0,0)};return a}();b.CapBuilder=n;var R=function(c){function b(){return c.call(this)||this}a.__extends(b,c);b.prototype.getNumVertices=function(){return 0};b.prototype.getNumIndices=function(){return 0};b.prototype.rebuildCapGeometry=function(){};b.prototype.buildTopology=function(){};return b}(n);b.NoCapBuilder=R;R=function(c){function b(a,b,d){void 0===b&&(b=0);void 0===d&&(d=!1);var e=c.call(this)||this;e.profile=a;e.profilePlaneOffset=
b;e.flip=d;return e}a.__extends(b,c);b.prototype.getNumVertices=function(){return this.profile.vertices.length};b.prototype.getNumIndices=function(){return 3*this.profile.numSegments};b.prototype.rebuildConnectingProfileGeometry=function(a,c,b){for(var d=0;d<c.vertices.length;++d)b(a.index,a.frame,c.vertices[d],c.vertexNormals[d],this.profilePlaneOffset,0)};b.prototype.rebuildCapGeometry=function(a,c){var b=A;l.vec2.set(b,0,0);for(var d=this.flip?1:-1,e=0;e<this.profile.vertices.length;++e)c(a.index,
a.frame,this.profile.vertices[e],b,this.profilePlaneOffset,d)};b.prototype.buildTopology=function(a,c){a=this.vertexBufferStart+this.profile.vertexIndices[0];for(var b=1;b<this.profile.numSegments;++b){var d=this.vertexBufferStart+this.profile.vertexIndices[2*b+0],e=this.vertexBufferStart+this.profile.vertexIndices[2*b+1];this.flip?c(e,d,a):c(a,d,e)}};return b}(n);b.TriangulationCapBuilder=R;n=function(c){function b(a){var b=c.call(this)||this;b.flip=!1;b.sign=0;b.breakNormals=!1;b.numSegments=3;
b.profile=a.profile;b.flip=a.flip;b.sign=b.flip?1:-1;b.breakNormals=a.breakNormals;b.numSegments=a.subdivisions;return b}a.__extends(b,c);b.prototype.getNumVertices=function(){var a=0,a=this.profile.vertices.length*(this.numSegments-1);this.breakNormals&&(a+=this.profile.vertices.length);return a+=this.profile.poles.length};b.prototype.getNumIndices=function(){var a;a=0+2*this.profile.numSegments*(this.numSegments-1);for(var c=0;c<this.profile.numSegments;++c)a=this.profile.poleIndices[this.profile.vertexIndices[2*
c+0]]===this.profile.poleIndices[this.profile.vertexIndices[2*c+1]]?a+1:a+2;return 3*a};b.prototype.rebuildCapGeometry=function(a,c){var b=a.frame,d=.5*this.sign,e=y,f=A;l.vec2.set(f,0,0);for(var g=0;g<this.profile.poles.length;++g){var k=this.profile.poles[g];k.normal?c(a.index,b,k.position,k.normal,d,0):c(a.index,b,k.position,f,d,this.sign)}if(this.breakNormals)for(g=0;g<this.profile.vertices.length;++g)c(a.index,b,this.profile.vertices[g],this.profile.vertexNormals[g],0,0);for(g=0;g<this.numSegments-
1;++g)for(var k=(1-(g+1)/this.numSegments)*Math.PI*.5,h=Math.sin(k),m=Math.cos(k),p=0;p<this.profile.vertices.length;++p)k=this.profile.poles[this.profile.poleIndices[p]],l.vec2.subtract(e,this.profile.vertices[p],k.position),l.vec2.scale(e,e,h),k.normal?(l.vec2.add(e,e,k.position),c(a.index,b,e,k.normal,d*m,0)):(l.vec2.normalize(f,e),l.vec2.scale(f,f,h),l.vec2.add(e,e,k.position),c(a.index,b,e,f,d*m,this.sign*m))};b.prototype.buildTopology=function(a,c){a=this.breakNormals?this.vertexBufferStart+
this.profile.poles.length:this.firstProfileVertexIndex;for(var b=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length,d=0;d<this.profile.numSegments;++d){for(var e=this.profile.vertexIndices[2*d+0],f=this.profile.vertexIndices[2*d+1],g=this.vertexBufferStart+this.profile.poleIndices[e],k=this.vertexBufferStart+this.profile.poleIndices[f],h=a+e,l=a+f,m=0;m<this.numSegments-1;++m){var p=b+m*this.profile.vertices.length+
e,q=b+m*this.profile.vertices.length+f;this.flip?(c(p,l,h),c(l,p,q)):(c(h,l,p),c(q,p,l));h=p;l=q}this.flip?(c(g,l,h),g!==k&&c(g,k,l)):(c(h,l,g),g!==k&&c(l,k,g))}};return b}(n);b.RoundCapBuilder=n;n=function(){function a(a,c,b,d,e,f){void 0===f&&(f=L);this.options=f;this.numUVTotal=this.numNormalsTotal=this.numVerticesTotal=this.numExtrusionProfiles=this._triangleCount=this._extrusionVertexCount=0;this.profile=c;this.path=a;this.extruder=b;this.startCap=d;this.endCap=e;a=this.path.vertices.length-
2;this.numExtrusionProfiles=b.numProfilesPerJoin()*a+2;this.numNormalsTotal=this.numVerticesTotal=c.vertices.length*this.numExtrusionProfiles;this.startCap.vertexBufferStart=this.numVerticesTotal;c=this.startCap.getNumVertices();this.numVerticesTotal+=c;this.numNormalsTotal+=c;this.endCap.vertexBufferStart=this.numVerticesTotal;c=this.endCap.getNumVertices();this.numVerticesTotal+=c;this.numNormalsTotal+=c;this.pathVertexData=new Float32Array(1*this.numVerticesTotal);this.profileRightAxisData=new Float32Array(4*
this.numVerticesTotal);this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal);this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal);this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal));this.originData=new Float32Array(3*this.path.vertices.length);this.rebuildGeometry();this.buildTopology()}a.prototype.emitVertex=function(a,c,b,d,e){this.profileRightAxisData[4*this._extrusionVertexCount+
0]=c.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=c.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=c.right[2];this.profileUpAxisData[4*this._extrusionVertexCount+0]=c.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=c.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=c.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=b[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=b[1];this.profileVertexAndNormalData[4*
this._extrusionVertexCount+2]=d[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=d[1];this.pathVertexData[this._extrusionVertexCount]=a;e?(a=this.path.vertices[a],this.profileRightAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[0]*a.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[1]*a.maxStretchDistance):(this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0);++this._extrusionVertexCount};
a.prototype.emitCapVertex=function(a,c,b,d,e,f){this.profileRightAxisData[4*this._extrusionVertexCount+0]=c.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=c.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=c.right[2];this.profileUpAxisData[4*this._extrusionVertexCount+0]=c.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=c.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=c.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount+
0]=b[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=b[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=d[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=d[1];this.pathVertexData[this._extrusionVertexCount]=a;this.profileRightAxisData[4*this._extrusionVertexCount+3]=e;this.profileUpAxisData[4*this._extrusionVertexCount+3]=f;++this._extrusionVertexCount};a.prototype.emitTriangle=function(a,c,b){this.vertexIndices[3*this._triangleCount+0]=a;this.vertexIndices[3*
this._triangleCount+1]=c;this.vertexIndices[3*this._triangleCount+2]=b;this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[a];this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[c];this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[b];this.normalIndices[3*this._triangleCount+0]=a;this.normalIndices[3*this._triangleCount+1]=c;this.normalIndices[3*this._triangleCount+2]=b;++this._triangleCount};a.prototype.rebuildGeometry=function(){for(var a=this,c=
function(c,b,d,e,f){return a.emitVertex(c,b,d,e,f)},b=function(c,b,d,e,f,g){return a.emitCapVertex(c,b,d,e,f,g)},d=this._extrusionVertexCount=0,e=this.path.vertices;d<e.length;d++){var f=e[d];this.originData[3*f.index+0]=f.pos[0];this.originData[3*f.index+1]=f.pos[1];this.originData[3*f.index+2]=f.pos[2]}this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,b);for(d=1;d<this.path.vertices.length-1;++d)this.extruder.extrude(this.path.vertices[d],this.profile,c);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-
1],this.profile,b);this.startCap.rebuildCapGeometry(this.path.vertices[0],b);this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],b);if(this.profile.hasUV()&&this.options.generateUV)for(d=0;d<this.profile.uvs.length;++d)this.uvData[2*d+0]=this.profile.uvs[d],this.uvData[2*d+1]=0};a.prototype.buildTopology=function(){var a=this,c=function(c,b,d){return a.emitTriangle(c,b,d)};this._triangleCount=0;var b=this.profile.vertices.length,d=this.profile.numSegments,e=this.numExtrusionProfiles-
1,f=d*e*6;this.startCap.indexBufferStart=f;this.startCap.firstProfileVertexIndex=0;f+=this.startCap.getNumIndices();this.endCap.indexBufferStart=f;this.endCap.firstProfileVertexIndex=b*(this.numExtrusionProfiles-1);f+=this.endCap.getNumIndices();this.vertexIndices=new Uint32Array(f);this.normalIndices=new Uint32Array(f);this.pathVertexIndices=new Uint32Array(f);this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(f));for(f=0;f<d;++f)for(var g=this.profile.vertexIndices[2*
f],k=this.profile.vertexIndices[2*f+1],h=0;h<e;++h){var l=h*b+g,m=(h+1)*b+k,p=h*b+k;c(l,(h+1)*b+g,m);c(l,m,p)}this.startCap.buildTopology(this.path.vertices[0],c);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],c)};a.prototype.onPathChanged=function(){this.rebuildGeometry()};return a}();b.Builder=n;n=function(){function a(a){this.builder=a}Object.defineProperty(a.prototype,"xform",{get:function(){return this.builder.path.xform},enumerable:!0,configurable:!0});a.prototype.onPathChanged=
function(){this.builder.onPathChanged()};return a}();b.PathGeometry=n;var W=function(b){function d(a){a=b.call(this,a)||this;a.vertexAttributePosition=null;a.vertexAttributeNormal=null;a.vertexAttributeColor=null;a.vertexAttributePosition=new Float32Array(3*a.builder.numVerticesTotal);a.vertexAttributeNormal=new Float32Array(3*a.builder.numNormalsTotal);a.vertexAttributeColor=new Uint8Array(4);a.vertexAttributeColor[0]=255;a.vertexAttributeColor[1]=255;a.vertexAttributeColor[2]=255;a.vertexAttributeColor[3]=
255;return a}a.__extends(d,b);d.prototype.bakeVertexColors=function(a){this.vertexAttributeColor[0]=255*a[0];this.vertexAttributeColor[1]=255*a[1];this.vertexAttributeColor[2]=255*a[2];this.vertexAttributeColor[3]=255*(3<a.length?a[3]:1)};d.prototype.bake=function(a){this.size=a;for(var b=0;b<this.builder.numVerticesTotal;++b){var d=this.builder.pathVertexData[b],e=0===d||d===this.builder.path.vertices.length-1,f=q;c.vec3.set(f,this.builder.originData[3*d+0],this.builder.originData[3*d+1],this.builder.originData[3*
d+2]);var g=C,k=y,d=F,h=H,p=I,r=0,t=0;c.vec3.set(h,this.builder.profileRightAxisData[4*b+0],this.builder.profileRightAxisData[4*b+1],this.builder.profileRightAxisData[4*b+2]);c.vec3.set(p,this.builder.profileUpAxisData[4*b+0],this.builder.profileUpAxisData[4*b+1],this.builder.profileUpAxisData[4*b+2]);l.vec2.set(k,this.builder.profileVertexAndNormalData[4*b+0]*a[0],this.builder.profileVertexAndNormalData[4*b+1]*a[1]);if(e)c.vec3.cross(d,p,h),r=this.builder.profileRightAxisData[4*b+3]*a[0],t=this.builder.profileUpAxisData[4*
b+3];else{var e=A,w=B;l.vec2.set(e,this.builder.profileRightAxisData[4*b+3],this.builder.profileUpAxisData[4*b+3]);var u=l.vec2.length(e);l.vec2.normalize(e,e);var v=l.vec2.dot(k,e);if(Math.abs(v)>u){l.vec2.set(w,-e[1],e[0]);var z=l.vec2.dot(k,w);l.vec2.scale(e,e,u*m.sign(v));l.vec2.scale(w,w,z);l.vec2.add(k,e,w)}c.vec3.set(d,0,0,0)}c.vec3.set(g,h[0]*k[0]+p[0]*k[1],h[1]*k[0]+p[1]*k[1],h[2]*k[0]+p[2]*k[1]);this.vertexAttributePosition[3*b+0]=f[0]+g[0]+d[0]*r;this.vertexAttributePosition[3*b+1]=f[1]+
g[1]+d[1]*r;this.vertexAttributePosition[3*b+2]=f[2]+g[2]+d[2]*r;f=y;l.vec2.set(f,this.builder.profileVertexAndNormalData[4*b+2],this.builder.profileVertexAndNormalData[4*b+3]);this.vertexAttributeNormal[3*b+0]=h[0]*f[0]+p[0]*f[1]+d[0]*t;this.vertexAttributeNormal[3*b+1]=h[1]*f[0]+p[1]*f[1]+d[1]*t;this.vertexAttributeNormal[3*b+2]=h[2]*f[0]+p[2]*f[1]+d[2]*t}};d.prototype.createGeometryData=function(){var a={};a[u.VertexAttrConstants.POSITION]=this.builder.vertexIndices;a[u.VertexAttrConstants.NORMAL]=
this.builder.normalIndices;this.vertexAttributeColor&&(a[u.VertexAttrConstants.COLOR]=new Uint32Array(a[u.VertexAttrConstants.POSITION].length));var c={};c[u.VertexAttrConstants.POSITION]={size:3,data:this.vertexAttributePosition};c[u.VertexAttrConstants.NORMAL]={size:3,data:this.vertexAttributeNormal};this.vertexAttributeColor&&(c[u.VertexAttrConstants.COLOR]={size:4,data:this.vertexAttributeColor});return new r.GeometryData(c,a,"triangle")};d.prototype.onPathChanged=function(){b.prototype.onPathChanged.call(this);
this.bake(this.size)};d.prototype.intersect=function(a,c,b){var d=this.builder.vertexIndices;z.intersectTriangles(a,c,0,d.length/3,d,{size:3,offsetIdx:0,strideIdx:3,data:this.vertexAttributePosition},void 0,void 0,b)};return d}(n);b.StaticPathGeometry=W;n=function(c){function b(a,b,d,e){var f=c.call(this,a)||this;f.sizeAttributeValue=b;f.colorAttributeValue=d;f.opacityAttributeValue=e;f.vvData=null;f.baked=new W(a);f.vvData=new Float32Array(4*f.builder.path.vertices.length);for(a=0;a<f.builder.path.vertices.length;++a)f.vvData[4*
a+0]=b,f.vvData[4*a+1]=d,f.vvData[4*a+2]=e,f.vvData[4*a+3]=0===a||a===f.builder.path.vertices.length-1?1:0;return f}a.__extends(b,c);b.prototype.createGeometryData=function(){var a={};a[v.PathVertexAttrConstants.POSITION]=this.builder.pathVertexIndices;a[v.PathVertexAttrConstants.PROFILERIGHT]=this.builder.vertexIndices;a[v.PathVertexAttrConstants.PROFILEUP]=this.builder.vertexIndices;a[v.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL]=this.builder.vertexIndices;a[v.PathVertexAttrConstants.FEATUREVALUE]=
this.builder.pathVertexIndices;var c={};c[v.PathVertexAttrConstants.POSITION]={size:3,data:this.builder.originData};c[v.PathVertexAttrConstants.PROFILERIGHT]={size:4,data:this.builder.profileRightAxisData};c[v.PathVertexAttrConstants.PROFILEUP]={size:4,data:this.builder.profileUpAxisData};c[v.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL]={size:4,data:this.builder.profileVertexAndNormalData};c[v.PathVertexAttrConstants.FEATUREVALUE]={size:4,data:this.vvData};return new r.GeometryData(c,a,"triangle")};
return b}(n);b.FastUpdatePathGeometry=n})(w||(w={}));var q=k.vec3f64.create(),y=d.vec2f64.create(),A=d.vec2f64.create(),B=d.vec2f64.create(),C=k.vec3f64.create(),F=k.vec3f64.create(),H=k.vec3f64.create(),I=k.vec3f64.create(),G=k.vec3f64.create(),J=w.makeFrame(),E=g.mat4f64.create();return w})},"esri/core/libs/gl-matrix-2/mat2f64":function(){define(["require","exports","./factories/mat2f64"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.mat2f64=a})},"esri/core/libs/gl-matrix-2/factories/mat2f64":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[1,0,0,1]};b.clone=function(a){return[a[0],a[1],a[2],a[3]]};b.fromValues=function(a,b,h,e){return[a,b,h,e]};b.createView=function(a,b){return new Float64Array(a,b,4)}})},"esri/views/3d/webgl-engine/materials/PathTechnique":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/output/ReadLinearDepth.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/util/Camera.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/StencilUtils ../shaders/Path.glsl ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v){Object.defineProperty(b,"__esModule",{value:!0});b.PathVertexAttrConstants={POSITION:"position",PROFILERIGHT:"profileRight",PROFILEUP:"profileUp",PROFILEVERTEXANDNORMAL:"profileVertexAndNormal",FEATUREVALUE:"featureValue"};b.pathVertexAttributeLocations={position:0,profileRight:1,profileUp:2,profileVertexAndNormal:3,featureValue:4};k=function(k){function p(){return null!==k&&k.apply(this,arguments)||this}a.__extends(p,k);p.prototype.initializeProgram=function(a){var c=
p.shader.get(),d=this.configuration,c=c.build({output:d.output,viewingMode:a.viewingMode,slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:d.receiveShadows,vvSize:d.vvSize,vvColor:d.vvColor,vvInstancingEnabled:!0,vvOpacity:d.vvOpacity,useOldSceneLightInterface:!1,pbrMode:0,useCustomDTRExponentForWater:!1,receiveAmbientOcclusion:d.receiveSSAO,doubleSidedMode:d.doubleSidedMode});return new u(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),
b.pathVertexAttributeLocations)};p.prototype.bindPass=function(a,c,b){this.program.setUniform3fv("size",c.size);0===this.configuration.output?(this.program.setUniform3fv("size",c.size),this.program.setUniform3fv("ambient",c.ambient),this.program.setUniform3fv("diffuse",c.diffuse),this.program.setUniform3fv("specular",c.specular),this.program.setUniform1f("opacity",c.opacity)):1!==this.configuration.output&&3!==this.configuration.output||g.ReadLinearDepth.bindUniforms(this.program,b);e.setVVUniforms(this.program,
c)};p.prototype.bindDraw=function(a){h.Transform.bindUniforms(this.program,a);m.Slice.bindUniformsWithOrigin(this.program,this.configuration,a);0===this.configuration.output&&(d.Camera.bindUniforms(this.program,a),l.ReadShadowMap.bindView(this.program,a));2===this.configuration.output&&f.VertexNormal.bindUniforms(this.program,a)};p.prototype.initializePipeline=function(){var a=this.configuration,c=function(c){return v.makePipelineState({blending:c,culling:(a.slicePlaneEnabled?!1:!a.transparent&&0!==
a.doubleSidedMode)&&{face:1028,mode:2305},depthTest:{func:513},depthWrite:v.defaultDepthWriteParams,colorWrite:v.defaultColorWriteParams,stencilWrite:a.sceneHasOcludees?r.stencilWriteMaskOn:null,stencilTest:a.sceneHasOcludees?r.stencilBaseAllZerosParams:null})};return 0===a.output?c(a.transparent&&v.separateBlendingParams(770,1,771,771)):c(null)};p.shader=new c.ReloadableShaderModule(t,function(){return new Promise(function(a,c){n(["../shaders/Path.glsl"],a,c)})});return p}(k.ShaderTechnique);b.PathTechnique=
k;k=function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.output=0;a.doubleSidedMode=0;a.receiveShadows=!1;a.receiveSSAO=!1;a.vvSize=!1;a.vvColor=!1;a.vvOpacity=!1;a.slicePlaneEnabled=!1;a.shadowMap=!1;a.transparent=!1;a.sceneHasOcludees=!1;return a}a.__extends(b,c);a.__decorate([p.parameter({count:7})],b.prototype,"output",void 0);a.__decorate([p.parameter({count:3})],b.prototype,"doubleSidedMode",void 0);a.__decorate([p.parameter()],b.prototype,"receiveShadows",void 0);a.__decorate([p.parameter()],
b.prototype,"receiveSSAO",void 0);a.__decorate([p.parameter()],b.prototype,"vvSize",void 0);a.__decorate([p.parameter()],b.prototype,"vvColor",void 0);a.__decorate([p.parameter()],b.prototype,"vvOpacity",void 0);a.__decorate([p.parameter()],b.prototype,"slicePlaneEnabled",void 0);a.__decorate([p.parameter()],b.prototype,"shadowMap",void 0);a.__decorate([p.parameter()],b.prototype,"transparent",void 0);a.__decorate([p.parameter()],b.prototype,"sceneHasOcludees",void 0);return b}(p.ShaderTechniqueConfiguration);
b.PathTechniqueConfiguration=k})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":function(){define(["require","exports","tslib","./PositionAttribute.glsl","../../shaderModules/interfaces"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.PathVertexPosition=function(b,z){b.attributes.add("featureValue","vec4");b.vertex.code.add(h.glsl(e||(e=a.__makeTemplateObject(["\n  bool isCapVertex() {\n    return featureValue.w \x3d\x3d 1.0;\n  }\n  "],
["\n  bool isCapVertex() {\n    return featureValue.w \x3d\x3d 1.0;\n  }\n  "]))));b.vertex.uniforms.add("size","vec3");z.vvSize?(b.vertex.uniforms.add("vvSizeMinSize","vec3"),b.vertex.uniforms.add("vvSizeMaxSize","vec3"),b.vertex.uniforms.add("vvSizeOffset","vec3"),b.vertex.uniforms.add("vvSizeFactor","vec3"),b.vertex.code.add(h.glsl(f||(f=a.__makeTemplateObject(["\n    vec2 getSize() {\n      return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;\n    }\n    "],
["\n    vec2 getSize() {\n      return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;\n    }\n    "]))))):b.vertex.code.add(h.glsl(g||(g=a.__makeTemplateObject(["\n    vec2 getSize(){\n      return size.xy;\n    }\n    "],["\n    vec2 getSize(){\n      return size.xy;\n    }\n    "]))));z.vvOpacity?(b.vertex.defines.addInt("VV_OPACITY_N",8),b.vertex.code.add(h.glsl(l||(l=a.__makeTemplateObject(["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    vec4 applyOpacity(vec4 color) {\n      float value \x3d featureValue.z;\n      if (value \x3c\x3d vvOpacityValues[0]) {\n        return vec4( color.xyz, vvOpacityOpacities[0]);\n      }\n\n      for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));\n        }\n      }\n\n      return vec4( color.xyz, vvOpacityOpacities[VV_OPACITY_N - 1]);\n    }\n    "],
["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    vec4 applyOpacity(vec4 color) {\n      float value \x3d featureValue.z;\n      if (value \x3c\x3d vvOpacityValues[0]) {\n        return vec4( color.xyz, vvOpacityOpacities[0]);\n      }\n\n      for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));\n        }\n      }\n\n      return vec4( color.xyz, vvOpacityOpacities[VV_OPACITY_N - 1]);\n    }\n    "]))))):
b.vertex.code.add(h.glsl(d||(d=a.__makeTemplateObject(["\n    vec4 applyOpacity(vec4 color){\n      return color;\n    }\n    "],["\n    vec4 applyOpacity(vec4 color){\n      return color;\n    }\n    "]))));z.vvColor?(b.vertex.defines.addInt("VV_COLOR_N",8),b.vertex.code.add(h.glsl(c||(c=a.__makeTemplateObject(["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 getColor() {\n      float value \x3d featureValue.y;\n      if (value \x3c\x3d vvColorValues[0]) {\n        return applyOpacity(vvColorColors[0]);\n      }\n\n      for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n        if (vvColorValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));\n        }\n      }\n\n      return applyOpacity(vvColorColors[VV_COLOR_N - 1]);\n    }\n    "],
["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 getColor() {\n      float value \x3d featureValue.y;\n      if (value \x3c\x3d vvColorValues[0]) {\n        return applyOpacity(vvColorColors[0]);\n      }\n\n      for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n        if (vvColorValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));\n        }\n      }\n\n      return applyOpacity(vvColorColors[VV_COLOR_N - 1]);\n    }\n    "]))))):
b.vertex.code.add(h.glsl(k||(k=a.__makeTemplateObject(["\n    vec4 getColor(){\n      return applyOpacity(vec4(1, 1, 1, 1));\n    }\n    "],["\n    vec4 getColor(){\n      return applyOpacity(vec4(1, 1, 1, 1));\n    }\n    "]))));b.include(m.PositionAttribute);b.attributes.add("profileRight","vec4");b.attributes.add("profileUp","vec4");b.attributes.add("profileVertexAndNormal","vec4");b.vertex.code.add(h.glsl(p||(p=a.__makeTemplateObject(["\n  vec3 calculateVPos() {\n    vec2 size \x3d getSize();\n    vec3 origin \x3d position;\n    vec3 right \x3d profileRight.xyz;\n    vec3 up \x3d profileUp.xyz;\n    vec3 forward \x3d cross(up, right);\n    vec2 profileVertex \x3d profileVertexAndNormal.xy * size;\n    vec2 profileNormal \x3d profileVertexAndNormal.zw;\n    float positionOffsetAlongProfilePlaneNormal \x3d 0.0;\n    float normalOffsetAlongProfilePlaneNormal \x3d 0.0;\n    "],
["\n  vec3 calculateVPos() {\n    vec2 size \x3d getSize();\n    vec3 origin \x3d position;\n    vec3 right \x3d profileRight.xyz;\n    vec3 up \x3d profileUp.xyz;\n    vec3 forward \x3d cross(up, right);\n    vec2 profileVertex \x3d profileVertexAndNormal.xy * size;\n    vec2 profileNormal \x3d profileVertexAndNormal.zw;\n    float positionOffsetAlongProfilePlaneNormal \x3d 0.0;\n    float normalOffsetAlongProfilePlaneNormal \x3d 0.0;\n    "]))));b.vertex.code.add(h.glsl(r||(r=a.__makeTemplateObject(["\n    if(!isCapVertex()) {\n      vec2 rotationRight \x3d vec2(profileRight.w, profileUp.w);\n      float maxDistance \x3d length(rotationRight);\n  "],
["\n    if(!isCapVertex()) {\n      vec2 rotationRight \x3d vec2(profileRight.w, profileUp.w);\n      float maxDistance \x3d length(rotationRight);\n  "]))));b.vertex.code.add(h.glsl(t||(t=a.__makeTemplateObject(["\n      rotationRight \x3d maxDistance \x3e 0.0 ? normalize(rotationRight) : vec2(0, 0);\n\n      // decompose vertex into rotationRight and rotationUp\n      // limit rotation right component to maxDistance\n      // and reassemble profile vertex from rotationRight and rotationUp\n      float rx \x3d dot(profileVertex, rotationRight);\n      if (abs(rx) \x3e maxDistance) {\n        // NB: we do the tangent by x\x3d-y and y\x3dx\n        vec2 rotationUp \x3d vec2(-rotationRight.y, rotationRight.x);\n        float ry \x3d dot(profileVertex, rotationUp);\n        profileVertex \x3d rotationRight * maxDistance * sign(rx) + rotationUp * ry;\n      }\n    }else{\n       positionOffsetAlongProfilePlaneNormal \x3d profileRight.w * size[0];\n       normalOffsetAlongProfilePlaneNormal \x3d profileUp.w;\n    }\n\n    vec3 offset \x3d right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;\n\n    return origin + offset; // localPosition\n  }\n  "],
["\n      rotationRight \x3d maxDistance \x3e 0.0 ? normalize(rotationRight) : vec2(0, 0);\n\n      // decompose vertex into rotationRight and rotationUp\n      // limit rotation right component to maxDistance\n      // and reassemble profile vertex from rotationRight and rotationUp\n      float rx \x3d dot(profileVertex, rotationRight);\n      if (abs(rx) \x3e maxDistance) {\n        // NB: we do the tangent by x\x3d-y and y\x3dx\n        vec2 rotationUp \x3d vec2(-rotationRight.y, rotationRight.x);\n        float ry \x3d dot(profileVertex, rotationUp);\n        profileVertex \x3d rotationRight * maxDistance * sign(rx) + rotationUp * ry;\n      }\n    }else{\n       positionOffsetAlongProfilePlaneNormal \x3d profileRight.w * size[0];\n       normalOffsetAlongProfilePlaneNormal \x3d profileUp.w;\n    }\n\n    vec3 offset \x3d right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;\n\n    return origin + offset; // localPosition\n  }\n  "]))));
b.vertex.code.add(h.glsl(u||(u=a.__makeTemplateObject(["\n  vec3 localNormal() {\n    vec3 right \x3d profileRight.xyz;\n    vec3 up \x3d profileUp.xyz;\n    vec3 forward \x3d cross(up, right);\n    vec2 profileNormal \x3d profileVertexAndNormal.zw;\n\n    vec3 normal \x3d right * profileNormal.x + up * profileNormal.y;\n\n    if(isCapVertex()) {\n      normal +\x3d forward * profileUp.w;\n    }\n\n    return normal;\n  }\n  "],["\n  vec3 localNormal() {\n    vec3 right \x3d profileRight.xyz;\n    vec3 up \x3d profileUp.xyz;\n    vec3 forward \x3d cross(up, right);\n    vec2 profileNormal \x3d profileVertexAndNormal.zw;\n\n    vec3 normal \x3d right * profileNormal.x + up * profileNormal.y;\n\n    if(isCapVertex()) {\n      normal +\x3d forward * profileUp.w;\n    }\n\n    return normal;\n  }\n  "]))))};
b.setVVUniforms=function(a,c){c.vvSizeEnabled&&(a.setUniform3fv("vvSizeMinSize",c.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",c.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",c.vvSizeOffset),a.setUniform3fv("vvSizeFactor",c.vvSizeFactor));c.vvColorEnabled&&(a.setUniform1fv("vvColorValues",c.vvColorValues),a.setUniform4fv("vvColorColors",c.vvColorColors));c.vvOpacityEnabled&&(a.setUniform1fv("vvOpacityValues",c.vvOpacityValues),a.setUniform1fv("vvOpacityOpacities",c.vvOpacityOpacities))};var e,f,
g,l,d,c,k,p,r,t,u})},"esri/views/3d/webgl-engine/shaders/Path.glsl":function(){define("require exports tslib ../core/shaderLibrary/ForwardLinearDepth.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/output/OutputDepth.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/NormalUtils.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var n=new u.ShaderBuilder;n.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");n.varyings.add("vpos","vec3");n.include(f.PathVertexPosition,b);0===b.output&&(n.include(e.Transform,{linearDepth:!1}),b.receiveShadows&&n.include(r.ReadShadowMap,b),n.include(m.ForwardLinearDepth,b),n.varyings.add("vnormal","vec3"),n.varyings.add("vcolor","vec4"),
n.vertex.code.add(t.glsl(v||(v=a.__makeTemplateObject(["\n      void main() {\n        vpos \x3d calculateVPos();\n        vnormal \x3d normalize(localNormal());\n\n        gl_Position \x3d transformPosition(proj, view, vpos);\n\n        forwardLinearDepth();\n\n        vcolor \x3d getColor();\n      }\n    "],["\n      void main() {\n        vpos \x3d calculateVPos();\n        vnormal \x3d normalize(localNormal());\n\n        gl_Position \x3d transformPosition(proj, view, vpos);\n\n        forwardLinearDepth();\n\n        vcolor \x3d getColor();\n      }\n    "])))),
n.include(h.Slice,b),n.include(c.EvaluateSceneLighting,b),n.include(d.EvaluateAmbientOcclusion,b),b.receiveShadows&&n.include(r.ReadShadowMap,b),n.include(k.Normals,b),n.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("specular","vec3").add("opacity","float"),n.fragment.code.add(t.glsl(z||(z=a.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n\n        shadingParams.viewDirection \x3d normalize(vpos - camPos);\n        shadingParams.normalView \x3d vnormal;\n        vec3 normal \x3d shadingNormal(shadingParams);\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n    "],
["\n      void main() {\n        discardBySlice(vpos);\n\n        shadingParams.viewDirection \x3d normalize(vpos - camPos);\n        shadingParams.normalView \x3d vnormal;\n        vec3 normal \x3d shadingNormal(shadingParams);\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n    "])))),
b.receiveShadows?n.fragment.code.add(t.glsl(w||(w=a.__makeTemplateObject(["\n        float shadow \x3d readShadowMap(vpos, linearDepth);\n      "],["\n        float shadow \x3d readShadowMap(vpos, linearDepth);\n      "])))):0===b.viewingMode?n.fragment.code.add(t.glsl(q||(q=a.__makeTemplateObject(["\n        float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n      "],["\n        float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n      "])))):n.fragment.code.add(t.glsl(y||
(y=a.__makeTemplateObject(["\n        float shadow \x3d 0.0;\n      "],["\n        float shadow \x3d 0.0;\n      "])))),n.fragment.code.add(t.glsl(A||(A=a.__makeTemplateObject(["\n        vec3 albedo \x3d vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one\n        float combinedOpacity \x3d vcolor.a * opacity;\n        albedo +\x3d 0.25 * specular; // don't completely ignore specular for now\n\n        vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);\n        gl_FragColor \x3d vec4(shadedColor, combinedOpacity);\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "],
["\n        vec3 albedo \x3d vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one\n        float combinedOpacity \x3d vcolor.a * opacity;\n        albedo +\x3d 0.25 * specular; // don't completely ignore specular for now\n\n        vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);\n        gl_FragColor \x3d vec4(shadedColor, combinedOpacity);\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "])))));
if(1===b.output||3===b.output)n.include(e.Transform,{linearDepth:!0}),n.vertex.uniforms.add("nearFar","vec2"),n.varyings.add("depth","float"),n.vertex.code.add(t.glsl(B||(B=a.__makeTemplateObject(["\n        void main() {\n          vpos \x3d calculateVPos();\n          gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        }\n    "],["\n        void main() {\n          vpos \x3d calculateVPos();\n          gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        }\n    "])))),
n.include(h.Slice,b),n.include(g.OutputDepth,b),n.fragment.uniforms.add("timeElapsed","float"),n.fragment.code.add(t.glsl(C||(C=a.__makeTemplateObject(["\n        void main() {\n          discardBySlice(vpos);\n          outputDepth(depth);\n        }\n    "],["\n        void main() {\n          discardBySlice(vpos);\n          outputDepth(depth);\n        }\n    "]))));2===b.output&&(n.include(e.Transform,{linearDepth:!1}),n.include(p.NormalUtils,b),n.vertex.uniforms.add("viewNormal","mat4"),n.varyings.add("vnormal",
"vec3"),n.vertex.code.add(t.glsl(F||(F=a.__makeTemplateObject(["\n        void main(void) {\n          vpos \x3d calculateVPos();\n          vnormal \x3d normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          vpos \x3d calculateVPos();\n          vnormal \x3d normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "])))),
n.include(h.Slice,b),n.fragment.uniforms.add("waterColor","vec4"),n.fragment.code.add(t.glsl(H||(H=a.__makeTemplateObject(["\n        void main() {\n          discardBySlice(vpos);\n          vec3 normal \x3d normalize(vnormal);\n          if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\n          gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 1.0);\n        }\n    "],["\n        void main() {\n          discardBySlice(vpos);\n          vec3 normal \x3d normalize(vnormal);\n          if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\n          gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 1.0);\n        }\n    "])))));
4===b.output&&(n.include(e.Transform,{linearDepth:!1}),n.include(p.NormalUtils,b),n.vertex.uniforms.add("viewNormal","mat4"),n.varyings.add("vnormal","vec3"),n.vertex.code.add(t.glsl(I||(I=a.__makeTemplateObject(["\n        void main(void) {\n          vpos \x3d calculateVPos();\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          vpos \x3d calculateVPos();\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "])))),
n.include(h.Slice,b),n.include(l.OutputHighlight),n.fragment.code.add(t.glsl(G||(G=a.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vpos);\n        outputHighlight();\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        outputHighlight();\n      }\n    "])))));return n};var v,z,w,q,y,A,B,C,F,H,I,G})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("require exports tslib ../../../../core/mathUtils ../../../../geometry/support/aaBoundingBox ../../support/buffer/BufferView ../../support/buffer/InterleavedLayout ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./PathTechnique ./VisualVariableMaterialParameters ./internal/bufferWriterUtils ./internal/MaterialUtil ./internal/MaterialUtil ./renderers/MergedRenderer".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v){var z=c.assert;n=function(c){function b(a,d){d=c.call(this,d)||this;d.supportsEdges=!0;d.techniqueConfig=new k.PathTechniqueConfiguration;d.params=u.copyParameters(a,q);d.vertexBufferLayout=b.getVertexBufferLayout(d.params);return d}a.__extends(b,c);b.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.vvColor=this.params.vvColorEnabled;this.techniqueConfig.vvOpacity=
this.params.vvOpacityEnabled;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;0===a&&(this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.receiveShadows=this.params.receiveShadows,this.techniqueConfig.receiveSSAO=
this.params.receiveSSAO);return this.techniqueConfig};b.prototype.getPassParameters=function(){return this.params};b.prototype.isVisibleInPass=function(a){return 3===a?this.params.castShadows:!0};b.prototype.isVisible=function(){var a=this.params;return c.prototype.isVisible.call(this)?0<a.opacity:!1};b.prototype.setParameterValues=function(a){t.updateParameters(this.params,a)&&this.parametersChanged()};b.prototype.getParameters=function(){return this.params};b.prototype.intersect=function(a,c,b,
d,e,f,g){if(a.metadata){c=a.metadata.pathGeometry;b=[this.params.size[0],this.params.size[1]];if(this.params.vvSizeEnabled){var k=this.params.vvSizeOffset,l=this.params.vvSizeFactor,p=this.params.vvSizeMinSize,q=this.params.vvSizeMaxSize,r=c.sizeAttributeValue;b[0]*=m.clamp(k[0]+r*l[0],p[0],q[0]);b[1]*=m.clamp(k[2]+r*l[2],p[2],q[2])}k=Math.max(b[0],b[1]);a=h.fromValues(a.boundingInfo.bbMin[0]-k,a.boundingInfo.bbMin[1]-k,a.boundingInfo.bbMin[2]-k,a.boundingInfo.bbMax[0]+k,a.boundingInfo.bbMax[1]+k,
a.boundingInfo.bbMax[2]+k);k=[f[0]-e[0],f[1]-e[1],f[2]-e[2]];l=Math.sqrt(k[0]*k[0]+k[1]*k[1]+k[2]*k[2]);u.intersectAabbInvDir(a,e,[l/k[0],l/k[1],l/k[2]],d.tolerance)&&(c.baked.size&&c.baked.size[0]===b[0]&&c.baked.size[1]===b[1]||c.baked.bake(b),c.baked.intersect(e,f,g))}};b.prototype.computeAttachmentOrigin=function(a,c){a=a.data;return(a="getVertexAttr"in a?a.getVertexAttr():"vertexAttr"in a?a.vertexAttr:null)?g.computeAttachmentOriginLines(a[k.PathVertexAttrConstants.POSITION],null,!1,c):null};
b.prototype.createBufferWriter=function(){return new y(this.vertexBufferLayout)};b.prototype.createRenderer=function(a,c){return new v(a,c,this,k.pathVertexAttributeLocations)};b.prototype.getGLMaterial=function(a){if(0===a.output||1===a.output||2===a.output||4===a.output||3===a.output&&this.params.castShadows)return new w(a)};b.getVertexBufferLayout=function(a){var c=f.newLayout().vec3f(k.PathVertexAttrConstants.POSITION).vec4f(k.PathVertexAttrConstants.PROFILERIGHT).vec4f(k.PathVertexAttrConstants.PROFILEUP).vec4f(k.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL);
if(a.vvColorEnabled||a.vvSizeEnabled||a.vvOpacityEnabled)c=c.vec4f(k.PathVertexAttrConstants.FEATUREVALUE);return c};return b}(d.Material);var w=function(c){function b(a){a=c.call(this,a)||this;a.updateParameters();return a}a.__extends(b,c);b.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(k.PathTechnique,this.material.getTechniqueConfig(this.output),this.technique)};b.prototype.beginSlot=function(a){return a===(this.technique.configuration.transparent?
5:3)};b.prototype._updateOccludeeState=function(a){a.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:a.hasOccludees}),this.updateParameters())};b.prototype._updateShadowState=function(a){a.shadowMappingEnabled!==this.technique.configuration.receiveShadows&&(this.material.setParameterValues({receiveShadows:a.shadowMappingEnabled}),this.updateParameters())};b.prototype.ensureParameters=function(a){0===this.output&&(this._updateShadowState(a),
this._updateOccludeeState(a))};b.prototype.bind=function(a,c){a.bindProgram(this.technique.program);this.technique.bindPass(a,this.material.getPassParameters(),c)};return b}(l.GLMaterial),q=a.__assign({size:[1,1,1],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],opacity:1,doubleSided:!1,doubleSidedType:"normal",receiveSSAO:!0,receiveShadows:!1,castShadows:!0,slicePlaneEnabled:!1,transparent:!1,sceneHasOcludees:!1},p.Default),y=function(){function a(a){this.vertexBufferLayout=a}a.prototype.allocate=
function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices[k.PathVertexAttrConstants.POSITION].length};a.prototype.write=function(a,c,b,d){var f=function(a){if(a in c.vertexAttr){var f=c.vertexAttr[a],g=c.indices[a];z(4===f.size);var k=b.getField(a,e.BufferViewVec4f);if(k)r.writeBufferVec4(g,f.data,k,d);else throw Error("unable to acquire view for "+a);}};f(k.PathVertexAttrConstants.PROFILERIGHT);f(k.PathVertexAttrConstants.PROFILEUP);f(k.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL);
this.vertexBufferLayout.hasField(k.PathVertexAttrConstants.FEATUREVALUE)&&f(k.PathVertexAttrConstants.FEATUREVALUE);r.writeDefaultAttributes(c,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,b,d)};return a}();return n})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("require exports tslib ../../../../Color ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../geometry/support/aaBoundingBox ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ./polygonUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Util ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function u(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._hasOutline=!1;return a}a.__extends(u,b);u.prototype.doLoad=function(){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return[2]})})};u.prototype.ensureMaterials=function(){this.ensureFillMaterial();this.ensureOutlineMaterial()};u.prototype.ensureFillMaterial=function(){if(!e.isSome(this._material)){var a=
e.get(this.symbolLayer,"material","color"),a=this._getCombinedOpacityAndColor(a);this._material=new C({color:a,transparent:1>a[3]||this.needsDrivenTransparentPass,polygonOffset:!1,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},this._getIdHint("_colormat"));this._context.stage.add(3,this._material)}};u.prototype.ensureOutlineMaterial=function(){var a=this.symbolLayer.outline;if(!e.isSome(this._outlineMaterial)&&this._isValidOutline(a)){this._hasOutline=!0;var c;c=f.pt2px(a.size);
var b=a.stipplePattern?F.createStipplePattern(a.stipplePattern.map(f.pt2px)):null,a=a.stippleOffColor?h.toUnitRGBA(a.stippleOffColor):null;c=1.5<c?new I({width:c,color:this._getOutlineColor(),polygonOffset:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:b,stippleIntegerRepeats:!0,stippleOffColor:a},this._getIdHint("_outline_ribbonlinemat")):new H({color:this._getOutlineColor(),slicePlaneEnabled:this._context.slicePlaneEnabled,width:c,stipplePattern:b,stippleIntegerRepeats:!0,
stippleOffColor:a},this._getIdHint("_outline_nativelinemat"));this._outlineMaterial=c;this._context.stage.add(3,this._outlineMaterial)}};u.prototype._isValidOutline=function(a){return e.isSome(a)&&a.size&&0<a.size&&e.isSome(a.color)};u.prototype.destroy=function(){b.prototype.destroy.call(this);e.isSome(this._material)&&(this._context.stage.remove(3,this._material.id),this._material=null);e.isSome(this._outlineMaterial)&&(this._context.stage.remove(3,this._outlineMaterial.id),this._outlineMaterial=
null)};u.prototype.createGraphics3DGraphic=function(a){var c=a.graphic;if(!this._validateGeometryType(c.geometry,u.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(c.geometry))return null;var b="graphic"+c.uid;a=this._getVertexOpacityAndColor(a.renderingInfo,Uint8Array,255);var d=this.setGraphicElevationContext(c,new p.ElevationContext);this.ensureDrapedStatus("on-the-ground"===d.mode);this.ensureMaterials();return this.draped?this._createAsOverlay(c,a,b):this._createAs3DShape(c,
a,d,b)};u.prototype.layerOpacityChanged=function(){if(e.isSome(this._material)){var a=this._material.getParameters().color,c=e.get(this.symbolLayer,"material","color"),c=this._getCombinedOpacity(c);this._material.setParameterValues({color:[a[0],a[1],a[2],c],transparent:1>c||this.needsDrivenTransparentPass})}e.isSome(this._outlineMaterial)&&(a=this._outlineMaterial.getParameters().color,this._outlineMaterial.setParameterValues({color:[a[0],a[1],a[2],this._getOutlineOpacity()]}));return!0};u.prototype.layerElevationInfoChanged=
function(a,c,b){var d=this._elevationContext.mode;b=k.elevationModeChangeUpdateType(u.elevationModeChangeTypes,b,d);if(b!==k.SymbolUpdateType.UPDATE)return b;var e=k.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(a,c,function(){return e})};u.prototype.slicePlaneEnabledChanged=function(){e.isSome(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});e.isSome(this._outlineMaterial)&&this._outlineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});
return!0};u.prototype.physicalBasedRenderingChanged=function(){return!0};u.prototype.pixelRatioChanged=function(){return!0};u.prototype._createAs3DShape=function(a,b,d,f){var g=w.geometryAsPolygon(a.geometry);if(e.isNone(g))return null;J.renderData=w.geometryToRenderInfo(g,this._context.elevationProvider,this._context.renderCoordsHelper,d);J.idHint=f;J.color=b;J.outNum=0;J.outGeometries=[];J.outTransforms=[];J.outMaterials=[];this._createAs3DShapeFill(J);this._hasOutline&&this._createAs3DShapeOutline(J);
this._logGeometryCreationWarnings(J.renderData,g.rings,"rings","FillSymbol3DLayer");if(0===J.outNum)return null;a=new y({geometries:J.outGeometries,materials:J.outMaterials,transformations:J.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:a.uid},idHint:f});a=new t(this,a,J.outGeometries,null,null,c.perVertexElevationAligner,d);a.alignedSampledElevation=J.renderData.sampledElevation;a.needsElevationUpdates=k.needsElevationUpdates2D(d.mode);return a};u.prototype._createAs3DShapeFill=
function(a){for(var c=a.renderData.polygons,b=0;b<c.length;++b){var f=c[b],k=f.position,h=f.mapPosition,f=f.holeIndices;if(e.isSome(this._context.clippingExtent)&&(d.empty(G),d.expandWithBuffer(G,h),!d.intersectsClippingArea(G,this._context.clippingExtent)))continue;f=g.earcut(h,f,3);0!==f.length&&(f=new Uint32Array(f),k=w.createColorGeometryData({indices:f,attributeData:{position:k,color:a.color,mapPosition:h}}),k=new q(k,a.idHint),a.outGeometries.push(k),a.outMaterials.push(e.unwrap(this._material)),
a.outTransforms.push(l.mat4f64.IDENTITY),a.outNum++)}};u.prototype._createAs3DShapeOutline=function(a){if(this._hasOutline)for(var c=a.renderData.outlines,b=this._outlineMaterial instanceof H,f=0;f<c.length;++f){var g=c[f],k=g.mapPosition,g=g.position;if(e.isSome(this._context.clippingExtent)&&(d.empty(G),d.expandWithBuffer(G,k),!d.intersectsClippingArea(G,this._context.clippingExtent)))continue;var k=z.createGeometryData({removeDuplicateStartEnd:b?0:1,attributeData:{position:g,mapPosition:k}}),h=
k.vertexAttributes[B.VertexAttrConstants.POSITION];h.data===g&&(h.data=new Float64Array(g));g=new q(k,a.idHint+"outline"+f);a.outGeometries.push(g);a.outMaterials.push(e.unwrap(this._outlineMaterial));a.outTransforms.push(l.mat4f64.IDENTITY);a.outNum++}};u.prototype._createAsOverlay=function(a,c,b){var f=w.geometryAsPolygon(a.geometry);if(e.isNone(f))return null;e.unwrap(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2;e.isSome(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=
this._renderPriority);E.renderData=w.geometryToRenderInfoDraped(f,this._context.overlaySR);E.idHint=b;E.color=c;E.outNum=0;E.outGeometries=[];E.outBoundingBox=d.empty();E.layerUid=this._context.layer.uid;E.graphicsUid=a.uid;this._createAsOverlayFill(E);this._hasOutline&&this._createAsOverlayOutline(E);this._logGeometryCreationWarnings(E.renderData,f.rings,"rings","FillSymbol3DLayer");return 0<E.outNum?new r(this,E.outGeometries,E.outBoundingBox):null};u.prototype._createAsOverlayFill=function(a){for(var c=
a.renderData.polygons,b=0;b<c.length;++b){var f=c[b],k=f.position,f=f.holeIndices;d.empty(G);d.expandWithBuffer(G,k);d.intersectsClippingArea(G,this._context.clippingExtent)&&(f=g.earcut(k,f,3),0!==f.length&&(d.expand(a.outBoundingBox,G),f=new Uint32Array(f),k=w.createColorGeometryData({indices:f,attributeData:{position:k,color:a.color}}),k=new A(k),k.data.layerUid=a.layerUid,k.data.graphicUid=a.graphicsUid,k.material=e.unwrap(this._material),f=G,k.center=[.5*(f[0]+f[3]),.5*(f[1]+f[4]),0],k.bsRadius=
.5*Math.sqrt((f[3]-f[0])*(f[3]-f[0])+(f[4]-f[1])*(f[4]-f[1])),a.outGeometries.push(k),a.outNum++))}};u.prototype._createAsOverlayOutline=function(a){if(this._hasOutline)for(var c=a.renderData.outlines,b=0;b<c.length;++b){var f=c[b].position;d.empty(G);d.expandWithBuffer(G,f);if(d.intersectsClippingArea(G,this._context.clippingExtent)){d.expand(a.outBoundingBox,G);f=z.createGeometryData({removeDuplicateStartEnd:this._outlineMaterial instanceof H?0:1,attributeData:{position:f}});f=new A(f);f.data.layerUid=
a.layerUid;f.data.graphicUid=a.graphicsUid;f.material=e.unwrap(this._outlineMaterial);var g=G;f.center=[.5*(g[0]+g[3]),.5*(g[1]+g[4]),0];f.bsRadius=.5*Math.sqrt((g[3]-g[0])*(g[3]-g[0])+(g[4]-g[1])*(g[4]-g[1]));a.outGeometries.push(f);a.outNum++}}};u.prototype._getOutlineOpacity=function(){var a=e.get(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(e.isSome(a)?a.a:0)};u.prototype._getOutlineColor=function(){var a=e.get(this.symbolLayer,"outline","color"),c=this._getOutlineOpacity();
return v.mixinColorAndOpacity(e.isSome(a)?m.toUnitRGB(a):null,c)};Object.defineProperty(u.prototype,"test",{get:function(){var a=this;return{createAsOverlay:function(c,b,d){return a._createAsOverlay(c,b,d)},createAs3DShape:function(c,b,d,e){return a._createAs3DShape(c,b,d,e)}}},enumerable:!0,configurable:!0});u.validGeometryTypes=["polyline","polygon","extent"];u.elevationModeChangeTypes={definedChanged:k.SymbolUpdateType.RECREATE,staysOnTheGround:k.SymbolUpdateType.NONE,onTheGroundChanged:k.SymbolUpdateType.RECREATE};
return u}(u.default);b.Graphics3DPolygonFillSymbolLayer=n;var G=d.create(),J={idHint:null,renderData:null,color:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},E={idHint:null,renderData:null,color:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};b.default=n})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("require exports tslib ../lib/GLMaterial ../lib/Material ./internal/DefaultBufferWriter ./internal/MaterialUtil ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/ColorMaterialTechnique".split(" "),
function(n,b,a,m,h,e,f,g,l,d){n=function(b){function h(a,c){c=b.call(this,c)||this;c.supportsEdges=!0;c.techniqueConfig=new d.ColorMaterialTechniqueConfiguration;c.params=g.copyParameters(a,k);return c}a.__extends(h,b);h.prototype.setParameterValues=function(a){f.updateParameters(this.params,a)&&this.parametersChanged()};h.prototype.getParameters=function(){return this.params};h.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.cullFace=this.params.cullFace;
this.techniqueConfig.vertexColors=this.params.vertexColors;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.polygonOffset=this.params.polygonOffset;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;return this.techniqueConfig};h.prototype.getPassParameters=function(){return this.params};h.prototype.intersect=function(a,c,b,d,e,f,
k){g.intersectTriangleGeometry(a,c,d,e,f,void 0,k)};h.prototype.getGLMaterial=function(a){return 0===a.output||4===a.output?new c(a):void 0};h.prototype.createBufferWriter=function(){return new e.DefaultBufferWriter(e.PositionColorLayout)};h.prototype.createRenderer=function(a,c){return new l(a,c,this)};return h}(h.Material);var c=function(c){function b(a){a=c.call(this,a)||this;a.updateParameters();return a}a.__extends(b,c);b.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(d.ColorMaterialTechnique,
this.material.getTechniqueConfig(this.output),this.technique)};b.prototype.beginSlot=function(a){return 4===this.output?3===a:a===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)};b.prototype._updateOccludeeState=function(a){a.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:a.hasOccludees}),this.updateParameters())};b.prototype.ensureParameters=function(a){0===this.output&&this._updateOccludeeState(a)};
b.prototype.bind=function(a,c){a.bindProgram(this.technique.program);this.technique.bindPass(a,this.material.getPassParameters(),c)};b.prototype.getPipelineState=function(a,c){return c?this.technique.opaqueOccludeeState:this.technique.pipeline};return b}(m.GLMaterial),k={color:[1,1,1,1],transparent:!1,writeDepth:!0,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1};return n})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/StencilUtils ./ColorMaterial.glsl ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p){Object.defineProperty(b,"__esModule",{value:!0});f=function(b){function f(){return null!==b&&b.apply(this,arguments)||this}a.__extends(f,b);f.prototype.initializeProgram=function(a){var c=f.shader.get(),b=this.configuration,c=c.build({attributeColor:b.vertexColors,slicePlaneEnabled:b.slicePlaneEnabled,sliceHighlightDisabled:b.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1});return new k(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),l.Default3D)};
f.prototype.bindPass=function(a,c,b){this.program.setUniform4fv("eColor",c.color)};f.prototype.bindDraw=function(a){h.Transform.bindUniforms(this.program,a);m.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};f.prototype.initializePipeline=function(){var a=function(a){return 0!==a&&{face:1===a?1028:1029,mode:2305}},c=this.configuration,b=p.separateBlendingParams(770,1,771,771),e=0===c.output?c.transparent&&b:null,b=function(b){return p.makePipelineState({blending:e,polygonOffset:c.polygonOffset&&
r,culling:a(c.cullFace),depthTest:d.depthCompareLess,depthWrite:c.writeDepth&&p.defaultDepthWriteParams,colorWrite:p.defaultColorWriteParams,stencilWrite:c.sceneHasOcludees?d.stencilWriteMaskOn:null,stencilTest:c.sceneHasOcludees?b?d.stencilToolMaskBaseParams:d.stencilBaseAllZerosParams:null})};this._occludeeState=b(!0);return b(!1)};Object.defineProperty(f.prototype,"opaqueOccludeeState",{get:function(){return this._occludeeState},enumerable:!0,configurable:!0});f.shader=new e.ReloadableShaderModule(c,
function(){return new Promise(function(a,c){n(["./ColorMaterial.glsl"],a,c)})});return f}(f.ShaderTechnique);b.ColorMaterialTechnique=f;var r={factor:1,units:1};f=function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.output=0;a.cullFace=0;a.slicePlaneEnabled=!1;a.sliceHighlightDisabled=!1;a.vertexColors=!1;a.transparent=!1;a.polygonOffset=!1;a.writeDepth=!0;a.sceneHasOcludees=!1;return a}a.__extends(b,c);a.__decorate([g.parameter({count:7})],b.prototype,"output",void 0);a.__decorate([g.parameter({count:3})],
b.prototype,"cullFace",void 0);a.__decorate([g.parameter()],b.prototype,"slicePlaneEnabled",void 0);a.__decorate([g.parameter()],b.prototype,"sliceHighlightDisabled",void 0);a.__decorate([g.parameter()],b.prototype,"vertexColors",void 0);a.__decorate([g.parameter()],b.prototype,"transparent",void 0);a.__decorate([g.parameter()],b.prototype,"polygonOffset",void 0);a.__decorate([g.parameter()],b.prototype,"writeDepth",void 0);a.__decorate([g.parameter()],b.prototype,"sceneHasOcludees",void 0);return b}(g.ShaderTechniqueConfiguration);
b.ColorMaterialTechniqueConfiguration=f})},"esri/views/3d/webgl-engine/shaders/ColorMaterial.glsl":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/VertexColor.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(c){var b=new g.ShaderBuilder;b.include(h.Transform,{linearDepth:!1});
b.include(e.VertexColor,c);b.vertex.uniforms.add("proj","mat4").add("view","mat4");b.attributes.add("position","vec3");b.varyings.add("vpos","vec3");b.vertex.code.add(f.glsl(l||(l=a.__makeTemplateObject(["\n    void main(void) {\n      vpos \x3d position;\n      forwardNormalizedVertexColor();\n      gl_Position \x3d transformPosition(proj, view, vpos);\n    }\n  "],["\n    void main(void) {\n      vpos \x3d position;\n      forwardNormalizedVertexColor();\n      gl_Position \x3d transformPosition(proj, view, vpos);\n    }\n  "]))));
b.include(m.Slice,c);b.fragment.uniforms.add("eColor","vec4");b.fragment.code.add(f.glsl(d||(d=a.__makeTemplateObject(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n    }\n    "],["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n    }\n    "])),c.attributeColor?"gl_FragColor \x3d vColor * eColor;":"gl_FragColor \x3d eColor;"));return b};var l,d})},
"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("require exports tslib ../../../../core/Error ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A){function B(a,c,b){a&&a.forEach(function(a){var d=c(a);h.isSome(d)&&b(d,a.graphic)})}Object.defineProperty(b,"__esModule",{value:!0});var C=[0,0,1];n=function(b){function r(a,c,d,f){a=b.call(this,a,c,d,f)||this;a._geometryDataPool=new e(z.GeometryData,function(a,c,b){var d=c.translation;b=h.isSome(b)?[b.displayWidth,b.displayHeight]:[0,0];c=c.centerOffset;0===a.indexCount?w.createPointGeometry(C,d,null,b,c,[0,0],null,a):w.updatePointGeometry(null,
d,null,b,c,null,null,a)});a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};a.ensureDrapedStatus(!1);return a}a.__extends(r,b);r.prototype.doLoad=function(){return a.__awaiter(this,void 0,void 0,function(){var c;return a.__generator(this,function(a){if(!this._drivenProperties.size&&(c=t.validateSymbolLayerSize(this.symbolLayer.size)))throw new m("graphics3dtextsymbollayer:invalid-size",c);this._createTextRenderParameters();return[2]})})};r.prototype._createTextRenderParameters=
function(){this._textRenderParameters=q.default.fromSymbol(this.symbolLayer,this._context.layerView.view.pixelRatio)};r.prototype.destroy=function(){b.prototype.destroy.call(this);this._geometryDataPool.destroy()};r.prototype.createGraphics3DGraphic=function(a){a=a.graphic;var c=u.placePointOnGeometry(a.geometry);if(h.isNone(c))return this.logger.warn("unsupported geometry type for text symbol: "+a.geometry.type),null;var b=this.symbolLayer.text;if(!b)return null;var d=l.isCalloutSupport(this.symbol)&&
this.symbol.hasVisibleVerticalOffset()?this.symbol:null;return this._createAs3DShape(a,c,b,d)};r.prototype.onRemoveGraphic=function(a){this._geometryDataPool.release(a.stageObject.geometries[0].data)};r.prototype.createLabel=function(a,c,b,d){a=a.graphic;var e=u.placePointOnGeometry(a.geometry);if(h.isNone(e))return this.logger.warn("unsupported geometry type for label: "+a.geometry.type),null;var f=c.text;return!f||/^\s+$/.test(f)?null:this._createAs3DShape(a,e,f,c,c,b,d)};r.prototype.setGraphicElevationContext=
function(a,c,d){void 0===d&&(d=0);a=b.prototype.setGraphicElevationContext.call(this,a,c);a.addOffsetRenderUnits(d);return a};r.prototype.layerOpacityChanged=function(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");return!1};r.prototype.layerElevationInfoChanged=function(a,b){var d=this;B(a,b,function(a,c){d.updateGraphicElevationContext(c,a)});return c.SymbolUpdateType.UPDATE};r.prototype.slicePlaneEnabledChanged=function(a,c){var b=this;B(a,c,function(a){var c=
0;for(a=a.stageObject.geometryRecords;c<a.length;c++)a[c].material.setParameterValues({slicePlaneEnabled:b._context.slicePlaneEnabled})});return!0};r.prototype.physicalBasedRenderingChanged=function(){return!0};r.prototype.pixelRatioChanged=function(){return!1};r.prototype.updateGraphicElevationContext=function(a,b){this.setGraphicElevationContext(a,b.elevationContext,b.metadata.elevationOffset);b.needsElevationUpdates=c.needsElevationUpdates2D(b.elevationContext.mode)||"absolute-height"===b.elevationContext.mode};
r.prototype._defaultElevationInfoNoZ=function(){return F};r.prototype._createAs3DShape=function(a,b,e,l,m,q,r){void 0===m&&(m=H);var w=this.setGraphicElevationContext(a,new k.ElevationContext,m.elevationOffset),z=this._context.layer.id+"_label_"+a.uid,B="polyline"===h.get(a.geometry,"type"),n=a.uid;a=this._context.stage.renderView.renderingContext;var C=t.namedAnchorToHUDMaterialAnchorPos[m.anchor in t.namedAnchorToHUDMaterialAnchorPos?m.anchor:"center"];a=h.isNone(r)?new y(a,e,this._textRenderParameters,
z):null;C={occlusionTest:!0,screenOffset:m.screenOffset,anchorPos:C,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:m.centerOffsetUnits,debugDrawBorder:m.debugDrawBorder,drawInSecondSlot:!0};h.isSome(a)&&(C.textureId=a.id,C.texCoordScale=a.texcoordScale);h.isSome(r)&&(C.textureId=r.textureId);if(h.isSome(l)&&h.isSome(l.verticalOffset)){l=l.verticalOffset;r=l.minWorldLength;var E=l.maxWorldLength;C.verticalOffset={screenLength:f.pt2px(l.screenLength),minWorldLength:r||0,maxWorldLength:null!=E?E:
Infinity}}this._context.screenSizePerspectiveEnabled&&(l=this._context.sharedResources,r=l.screenSizePerspectiveSettings,C.screenSizePerspective=l.screenSizePerspectiveSettingsLabels.overridePadding(this._textRenderParameters.haloSize),C.screenSizePerspectiveAlignment=r);B&&(C.shaderPolygonOffset=1E-4);C.slicePlaneEnabled=this._context.slicePlaneEnabled;B=null;h.isSome(q)?(l=JSON.stringify(C),B=q.getMaterial(l),null==B&&(B=new A.default(C,z),q.addMaterial(l,B))):B=new A.default(C,z);B=[B];C=this._geometryDataPool.acquire(m,
a);C=[new v(C,z)];z=u.createStageObjectForHUD(this._context,b,C,B,null,null,w,z,this._context.layer.uid,n);if(null===z)return null;n=d.perObjectElevationAligner;q=new p(this,z.object,C,h.isNone(q)?B:null,h.isSome(a)?[a]:null,n,w);q.alignedSampledElevation=z.sampledElevation;q.needsElevationUpdates=c.needsElevationUpdates2D(w.mode)||"absolute-height"===w.mode;var w=h.isSome(a)?a:m,G=w.displayWidth,F=w.displayHeight;q.getScreenSize=function(a){void 0===a&&(a=g.vec2f64.create());a[0]=G;a[1]=F;return a};
q.metadata={labelText:e,elevationOffset:m.elevationOffset};u.extendPointGraphicElevationContext(q,b,this._context.elevationProvider);return q};return r}(r.default);b.Graphics3DTextSymbolLayer=n;var F={mode:"relative-to-ground",offset:0},H={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],anchor:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawBorder:!1,displayWidth:0,displayHeight:0};b.default=n})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define("require exports ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec4f64".split(" "),
function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this.definition=a;this.key=JSON.stringify(a);this.haloSize=Math.round(a.halo.size);this.fillStyle=this.colorToRGBA(a.color);this.haloStyle=this.colorToRGB(a.halo.color)}b.prototype.colorToRGB=function(a){return"rgb("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+")"};b.prototype.colorToRGBA=function(a){return"rgba("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+
","+a[3]+")"};b.fromSymbol=function(f,l){void 0===l&&(l=1);var d=m.get(f,"material","color"),d=m.isSome(d)?a.toUnitRGBA(d):e.ZEROS,c=f.halo,g=null!=f.size?h.pt2px(f.size):12;f={family:f.font&&f.font.family?f.font.family:"sans-serif",weight:f.font&&f.font.weight?f.font.weight:"normal",style:f.font&&f.font.style?f.font.style:"normal"};c=m.isSome(c)&&m.isSome(c.color)&&0<c.size?{size:h.pt2px(c.size),color:a.toUnitRGBA(c.color)}:{size:0,color:e.ZEROS};return new b({size:g,color:d,font:f,halo:c,pixelRatio:l})};
return b}();b.TextRenderParameters=n;b.default=n})},"esri/views/3d/webgl-engine/lib/TextTexture":function(){define("require exports ../../../../core/Evented ../../../../core/mathUtils ../../../../core/maybe ./TextRenderer ./Texture ../../../webgl/Texture ../../../webgl/capabilities/isWebGL2Context".split(" "),function(n,b,a,m,h,e,f,g,l){var d={canvas:null};return function(){function c(c,b,d,f){this._idHint=f;this._glTexture=null;this.events=new a;this._requiresPowerOfTwo=!l.default(c.gl);this._renderer=
new e.default(b,d)}Object.defineProperty(c.prototype,"id",{get:function(){null==this._id&&(this._id=f.idGen.gen(this._idHint));return this._id},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"width",{get:function(){return this._renderer.renderedWidth},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"height",{get:function(){return this._renderer.renderedHeight},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"textureWidth",{get:function(){var a=
this.width;return this._requiresPowerOfTwo?m.nextHighestPowerOfTwo(a):a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"textureHeight",{get:function(){var a=this.height;return this._requiresPowerOfTwo?m.nextHighestPowerOfTwo(a):a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"displayWidth",{get:function(){return this._renderer.displayWidth},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"displayHeight",{get:function(){return this._renderer.displayHeight},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"texcoordScale",{get:function(){return[this._renderer.renderedWidth/this.textureWidth,this._renderer.renderedHeight/this.textureHeight]},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"requiresFrameUpdates",{get:function(){return!1},enumerable:!0,configurable:!0});c.prototype.createDescriptor=function(a){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,
maxAnisotropy:a.parameters.maxMaxAnisotropy}};c.prototype.load=function(a){if(h.isSome(this._glTexture))return this._glTexture;var c=e.getTextHelperCanvas(d,this.textureWidth,this.textureHeight),b=c.getContext("2d");b.save();this._renderer.render(b,0,this.textureHeight-this._renderer.renderedHeight);this._glTexture=new g(a,this.createDescriptor(a),c);b.restore();return this._glTexture};c.prototype.unload=function(){h.isSome(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null);this.events.emit("unloaded")};
return c}()})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["require","exports","../../../../core/maybe","./TextRenderParameters"],function(n,b,a,m){function h(a,b,d){a.canvas||(a.canvas=document.createElement("canvas"));a.canvas.width=b;a.canvas.height=d;return a.canvas}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function c(a,c,b){void 0===b&&(b=2048);this.text=a;this.maxSize=b;this._displayWidth=this._renderPixelRatio=null;this.parameters=c instanceof m.default?
c:new m.default(c);this.key=this.parameters.key+"--"+a;this.textLines=a.split(/\r?\n/);this.lineHeight=this.computeLineHeight()}Object.defineProperty(c.prototype,"displayWidth",{get:function(){a.isNone(this._displayWidth)&&(this._displayWidth=this.computeTextWidth());return this._displayWidth},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"displayHeight",{get:function(){return this.lineHeight*this.textLines.length},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"renderedWidth",{get:function(){return Math.round(this.displayWidth*this.renderPixelRatio)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderedHeight",{get:function(){return Math.round(this.displayHeight*this.renderPixelRatio)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderedLineHeight",{get:function(){return Math.round(this.lineHeight*this.renderPixelRatio)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderedFontSize",{get:function(){return this.parameters.definition.size*
this.renderPixelRatio},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderedHaloSize",{get:function(){return this.parameters.haloSize*this.renderPixelRatio},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderPixelRatio",{get:function(){if(a.isNone(this._renderPixelRatio)){var c=this.parameters.definition.pixelRatio;this._renderPixelRatio=0<this.maxSize?Math.min(c,Math.min(this.maxSize/(this.displayWidth*c),this.maxSize/(this.displayHeight*c))):c}return this._renderPixelRatio},
enumerable:!0,configurable:!0});c.prototype.render=function(a,c,b){void 0===c&&(c=0);void 0===b&&(b=0);var d=this.renderedLineHeight,f=this.renderedHaloSize,g=a.textAlign,k=this.renderedWidth,g=("center"===g?.5*k:"right"===g?k:0)+f,k=f+e;a.save();0<f&&this.renderHalo(a,g,k,c,b);this.setFontProperties(a,this.renderedFontSize);b+=k;c+=g;f=0;for(g=this.textLines;f<g.length;f++)k=g[f],a.globalCompositeOperation="destination-out",a.fillStyle="rgb(0, 0, 0)",a.fillText(k,c,b),a.globalCompositeOperation=
"source-over",a.fillStyle=this.parameters.fillStyle,a.fillText(k,c,b),b+=d;a.restore()};c.prototype.renderHalo=function(a,c,b,e,f){var g=this.renderedWidth,k=this.renderedHeight,m=h(l,Math.max(g,d),Math.max(k,d)),p=m.getContext("2d");p.clearRect(0,0,g,k);this.setFontProperties(p,this.renderedFontSize);p.fillStyle=this.parameters.haloStyle;p.strokeStyle=this.parameters.haloStyle;var r=3>this.renderedHaloSize;p.lineJoin=r?"miter":"round";r?this.renderHaloEmulated(p,c,b):this.renderHaloNative(p,c,b);
a.globalAlpha=this.parameters.definition.halo.color[3];a.drawImage(m,0,0,g,k,e,f,g,k);a.globalAlpha=1};c.prototype.renderHaloEmulated=function(a,c,b){for(var d=this.renderedLineHeight,e=this.renderedHaloSize,g=0,k=this.textLines;g<k.length;g++){for(var h=k[g],l=0,m=f;l<m.length;l++){var p=m[l];a.fillText(h,c+e*p[0],b+e*p[1])}b+=d}};c.prototype.renderHaloNative=function(a,c,b){for(var d=this.renderedLineHeight,e=this.renderedHaloSize,f=0,g=this.textLines;f<g.length;f++){for(var k=g[f],h=2*e,l=0;5>
l;l++)a.lineWidth=(.6+.1*l)*h,a.strokeText(k,c,b);b+=d}};c.prototype.setFontProperties=function(a,c){var b=this.parameters.definition.font;a.font=b.style+" "+b.weight+" "+c+"px "+b.family+", sans-serif";a.textAlign="left";a.textBaseline="top"};c.prototype.computeTextWidth=function(){var a=h(l,d,d).getContext("2d");this.setFontProperties(a,this.parameters.definition.size);for(var c=0,b=0,e=this.textLines;b<e.length;b++)c=Math.max(c,a.measureText(e[b]).width);b=this.parameters.definition.font;if("italic"===
b.style||"oblique"===b.style||"string"===typeof b.weight&&("bold"===b.weight||"bolder"===b.weight)||"number"===typeof b.weight&&600<b.weight)c+=.3*a.measureText("A").width;c+=2*this.parameters.haloSize;return Math.round(c)};c.prototype.computeLineHeight=function(){return Math.ceil(1.275*this.parameters.definition.size+2*this.parameters.haloSize)+e};return c}();b.TextRenderer=n;for(var e=1,f=[],g=0;360>g;g+=22.5)f.push([Math.cos(Math.PI*g/180),Math.sin(Math.PI*g/180)]);b.getTextHelperCanvas=h;var l=
{canvas:null},d=512;b.default=n})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("require exports tslib ../../../../Color ../../../../core/maybe ../../../../core/unitUtils ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/math/common ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./polygonUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/WaterMaterial ../../webgl-engine/materials/internal/waterMaterialUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function q(a,c,d,e){return b.call(this,a,c,d,e)||this}a.__extends(q,b);q.prototype.doLoad=function(){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return[2]})})};q.prototype.destroy=function(){b.prototype.destroy.call(this);h.isSome(this._material)&&(this._context.stage.remove(3,this._material.id),this._material=null)};q.prototype.createGraphics3DGraphic=
function(a){a=a.graphic;if(!this._validateGeometryType(a.geometry,q.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(a.geometry))return null;var c="graphic"+a.uid,b=this.setGraphicElevationContext(a,new v.ElevationContext);this.ensureDrapedStatus("on-the-ground"===b.mode);this.ensureMaterial();return this.draped?this._createAsOverlay(a,c):this._createAs3DShape(a,b,c,a.uid)};q.prototype.ensureMaterial=function(){if(!h.isSome(this._material)){var c=a.__assign({},H.defaultWaterMaterialParameters),
b=this.symbolLayer.color;h.isSome(b)&&(c.color=m.toUnitRGBA(b));b=this._getCombinedOpacity(b,{hasIntrinsicColor:!0});c.color=[c.color[0],c.color[1],c.color[2],b];c.transparent=1>b||this.needsDrivenTransparentPass;c.waveDirection=h.isSome(this.symbolLayer.waveDirection)?q.headingVectorFromAngle(this.symbolLayer.waveDirection):d.vec2f64.fromValues(0,0);b=H.wavePresets[this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize];c.waveStrength=b.waveStrength;c.waveTextureRepeat=b.textureRepeat;
c.waveVelocity=b.waveVelocity;c.flowStrength=b.perturbationStrength;c.slicePlaneEnabled=this._context.slicePlaneEnabled;c.isDraped=this.draped;this._material=new F.WaterMaterial(c,"water");this._context.stage.add(3,this._material)}};q.prototype.layerOpacityChanged=function(){if(h.isNone(this._material))return!0;var a=this._material.getParameters().color,c=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});this._material.setParameterValues({color:[a[0],a[1],a[2],c],transparent:1>
c||this.needsDrivenTransparentPass});return!0};q.prototype.layerElevationInfoChanged=function(a,c,b){var d=this._elevationContext.mode;b=u.elevationModeChangeUpdateType(q.elevationModeChangeTypes,b,d);if(b!==u.SymbolUpdateType.UPDATE)return b;var e=u.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(a,c,function(){return e})};q.prototype.slicePlaneEnabledChanged=function(){h.isSome(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});
return!0};q.prototype.physicalBasedRenderingChanged=function(){return!0};q.prototype.pixelRatioChanged=function(){return!0};q.prototype._createAs3DShape=function(a,c,b,d){a=y.geometryAsPolygon(a.geometry);if(h.isNone(a))return null;L.renderData=y.geometryToRenderInfo(a,this._context.elevationProvider,this._context.renderCoordsHelper,c);var e=L.renderData.position.length/3;L.uvCoords=new Float64Array(2*e);L.idHint=b;L.outNum=0;L.outGeometries=[];L.outTransforms=[];L.outMaterials=[];this._create3DShapeGeometries(L);
this._logGeometryCreationWarnings(L.renderData,a.rings,"rings","WaterSymbol3DLayer");if(0===L.outNum)return null;this._createUVCoordsFromVertices(L.uvCoords,L.renderData.mapPosition,e,this._context.elevationProvider.spatialReference);b=new B({geometries:L.outGeometries,materials:L.outMaterials,transformations:L.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:d},idHint:b});b=new w(this,b,L.outGeometries,null,null,t.perVertexElevationAligner,c);b.alignedSampledElevation=
L.renderData.sampledElevation;b.needsElevationUpdates=u.needsElevationUpdates2D(c.mode);return b};q.prototype._createUVCoordsFromVertices=function(a,b,d,f){f=e.getMetersPerUnitForSR(f);r.empty(G);for(var g=0;g<d;g++)l.vec2.set(J,b[3*g+0],b[3*g+1]),r.expandPointInPlace(G,J);c.vec4.scale(G,G,f);g=G[1]%q.unitSizeOfTexture;I[0]=G[0]-G[0]%q.unitSizeOfTexture;I[1]=G[1]-g;for(g=0;g<d;g++)a[2*g+0]=(b[3*g+0]*f-I[0])/q.unitSizeOfTexture,a[2*g+1]=(b[3*g+1]*f-I[1])/q.unitSizeOfTexture};q.prototype._create3DShapeGeometries=
function(a){for(var c=a.uvCoords,b=0,d=a.renderData.polygons;b<d.length;b++){var e=d[b],k=e.count,l=e.index,m=e.position,q=e.mapPosition,e=e.holeIndices;if(h.isSome(this._context.clippingExtent)&&(p.empty(E),p.expandWithBuffer(E,q),!p.intersectsClippingArea(E,this._context.clippingExtent)))continue;e=f.earcut(q,e,3);0!==e.length&&(e=new Uint32Array(e),k=new Float64Array(c.buffer,2*l*c.BYTES_PER_ELEMENT,2*k),m=y.createWaterGeometryData({indices:e,attributeData:{position:m,uv0:k,mapPosition:q}}),m=
new A(m,a.idHint),a.outGeometries.push(m),a.outMaterials.push(h.unwrap(this._material)),a.outTransforms.push(g.mat4f64.IDENTITY),a.outNum++)}};q.prototype._createAsOverlay=function(a,c){var b=y.geometryAsPolygon(a.geometry);if(h.isNone(b))return null;h.unwrap(this._material).renderPriority=this._renderPriority;M.renderData=y.geometryToRenderInfoDraped(b,this._context.overlaySR);M.idHint=c;c=M.renderData.position.length/3;M.uvCoords=new Float64Array(2*c);M.outNum=0;M.outGeometries=[];M.outBoundingBox=
p.empty();M.layerUid=this._context.layer.uid;M.graphicsUid=a.uid;this._createAsOverlayWater(M);this._logGeometryCreationWarnings(M.renderData,b.rings,"rings","WaterSymbol3DLayer");if(0===M.outNum)return null;this._createUVCoordsFromVertices(M.uvCoords,M.renderData.position,c,b.spatialReference);return 0<M.outNum?new z(this,M.outGeometries,M.outBoundingBox):null};q.prototype._createAsOverlayWater=function(a){for(var c=a.uvCoords,b=0,d=a.renderData.polygons;b<d.length;b++){var e=d[b],g=e.position,k=
e.holeIndices,l=e.index,e=e.count;p.empty(E);p.expandWithBuffer(E,g);p.intersectsClippingArea(E,this._context.clippingExtent)&&(p.expand(a.outBoundingBox,E),k=f.earcut(g,k,3),0!==k.length&&(k=new Uint32Array(k),l=new Float64Array(c.buffer,2*l*c.BYTES_PER_ELEMENT,2*e),g=y.createWaterGeometryData({indices:k,attributeData:{position:g,uv0:l}}),g=new C(g),g.data.layerUid=a.layerUid,g.data.graphicUid=a.graphicsUid,g.material=h.unwrap(this._material),l=E,g.center=[.5*(l[0]+l[3]),.5*(l[1]+l[4]),0],g.bsRadius=
.5*Math.sqrt((l[3]-l[0])*(l[3]-l[0])+(l[4]-l[1])*(l[4]-l[1])),a.outGeometries.push(g),a.outNum++))}};q.headingVectorFromAngle=function(a){var c=d.vec2f64.create();a=k.toRadian(a);c[0]=Math.sin(a);c[1]=Math.cos(a);return c};Object.defineProperty(q.prototype,"test",{get:function(){var a=this;return{create3DShape:function(c){return a._createAs3DShape(c.graphic,c.elevationContext,c.idHint,c.graphicUid)},ensureMaterial:function(){return a.ensureMaterial()}}},enumerable:!0,configurable:!0});q.validGeometryTypes=
["polyline","polygon","extent"];q.unitSizeOfTexture=100;q.elevationModeChangeTypes={definedChanged:u.SymbolUpdateType.RECREATE,staysOnTheGround:u.SymbolUpdateType.NONE,onTheGroundChanged:u.SymbolUpdateType.RECREATE};return q}(q.default);b.Graphics3DWaterSymbolLayer=n;var I=d.vec2f64.create(),G=r.create(),J=d.vec2f64.create(),E=p.create(),L={idHint:null,renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},M={idHint:null,renderData:null,
uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};b.default=n})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("require exports tslib ../lib/AnimationTimer ../lib/Material ./WaterGLMaterial ./WaterTechnique ./internal/DefaultBufferWriter ./internal/MaterialUtil ./internal/waterMaterialUtils ./renderers/MergedRenderer".split(" "),function(n,b,a,m,h,e,f,g,l,d,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function h(a,
c){c=b.call(this,c)||this;c.animation=new m.AnimationTimer;c.techniqueConfig=new f.WaterTechniqueConfiguration;c.params=l.copyParameters(a,d.defaultWaterMaterialParameters);return c}a.__extends(h,b);h.prototype.setParameterValues=function(c){this.params=a.__assign(a.__assign({},this.params),c);this.parametersChanged()};h.prototype.getParameters=function(){return this.params};h.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.writeDepth=this.params.writeDepth;
this.techniqueConfig.receiveShadows=this.params.receiveShadows;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.useSSR=this.params.ssrEnabled;this.techniqueConfig.isDraped=this.params.isDraped;return this.techniqueConfig};h.prototype.update=function(a){this.animation.enabled=Math.sqrt(this.params.waveTextureRepeat/this.params.waveStrength)*Math.min(a.camera.relativeElevation,a.camera.distance)<k;this.animation.advance(a.dt);
return this.animation.enabled};h.prototype.intersect=function(a,c,b,d,e,f,g){l.intersectTriangleGeometry(a,c,d,e,f,void 0,g)};h.prototype.getGLMaterial=function(a){if(2===a.output)return new e.WaterGLMaterial(a);if(0===a.output)return this.params.isDraped&&(a.output=5),new e.WaterGLMaterial(a)};h.prototype.createBufferWriter=function(){return new g.DefaultBufferWriter(g.PositionUVLayout)};h.prototype.createRenderer=function(a,b){return new c(a,b,this)};return h}(h.Material);b.WaterMaterial=n;var k=
35E3})},"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["require","exports","../../../../core/maybe","../../../../layers/support/timeUtils"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){void 0===a&&(a=!0);this.enabled=a;this._time=0}Object.defineProperty(b.prototype,"time",{get:function(){return a.isSome(this._forcedTime)?this._forcedTime:m.Milliseconds(this._time)},enumerable:!0,configurable:!0});b.prototype.advance=function(a){this.enabled&&
(this._time+=a)};b.prototype.stopAtTime=function(a){this._forcedTime=a};return b}();b.AnimationTimer=n})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec2f64"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.defaultWaterMaterialParameters={waveStrength:.06,waveTextureRepeat:32,waveDirection:a.vec2f64.fromValues(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,
color:[0,0,0,0],transparent:!0,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0,ssrEnabled:!1};b.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,
perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,
waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}}})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define("require exports tslib ../../../../core/maybe ./Loadable ./symbolComplexity".split(" "),function(n,b,a,m,h,e){return function(b){function f(a,d){var c=b.call(this)||this;c.symbol=a;c.convert=d;c.graphics3DSymbol=null;c.referenced=
0;return c}a.__extends(f,b);f.prototype.getSymbolLayerSize=function(a){return m.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(a):null};f.prototype.doLoad=function(b){return a.__awaiter(this,void 0,void 0,function(){var d;return a.__generator(this,function(a){switch(a.label){case 0:return[4,this.symbol.fetchSymbol({signal:b})];case 1:return d=a.sent(),d.id=this.symbol.id,this.graphics3DSymbol=this.convert(d),[4,this.graphics3DSymbol.load()];case 2:return a.sent(),[2]}})})};
f.prototype.createGraphics3DGraphic=function(a){return m.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(a,this):null};Object.defineProperty(f.prototype,"complexity",{get:function(){return m.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:e.emptySymbolComplexity},enumerable:!0,configurable:!0});f.prototype.globalPropertyChanged=function(a,b){return m.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.globalPropertyChanged(a,b):!1};f.prototype.applyRendererDiff=
function(a,b){return m.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(a,b):!1};f.prototype.prepareSymbolPatch=function(a){m.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(a)};f.prototype.updateGeometry=function(a,b){return m.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.updateGeometry(a,b):!1};f.prototype.onRemoveGraphic=function(){};f.prototype.getFastUpdateStatus=function(){return m.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():
{loading:1,fast:0,slow:0}};f.prototype.destroy=function(){m.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;this.abortLoad()};Object.defineProperty(f.prototype,"destroyed",{get:function(){return void 0===this.graphics3DSymbol},enumerable:!0,configurable:!0});return f}(h.Loadable)})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ./graphicSymbolUtils ../../webgl-engine/materials/HUDMaterial".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k){function p(a){a=c.getGraphics3DSymbol(a.graphics3DGraphic.graphics3DSymbol);return h.isSome(a)?a.symbol.symbolLayers.getItemAt(0):null}function r(c,b){var d=b.graphics3DGraphic.graphic.geometry;if(h.isNone(d))return null;if(h.isSome(b.disablePlacement))return(d=b.labelClass.labelPlacement)?(q.warnOncePerTick(t(c.placement,b.disablePlacement.logEntityDescription)),u(b)):c;var e=d.type;switch(e){case "polyline":case "polygon":case "extent":case "multipoint":if(d=b.labelClass.labelPlacement)return q.warnOncePerTick(t(c.placement,
"'"+e+"' geometries")),u(b);break;case "point":case "mesh":break;default:a.neverReached(e)}return c}function t(a,c){return"the requested label placement '"+a+"' is currently unsupported for "+c+" in SceneView"}function u(c){var b=c.graphics3DGraphic.graphic.geometry;if(h.isNone(b))return null;b=b.type;switch(b){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return c=p(c),h.isSome(c)&&"extrude"===c.type?y["above-center"]:
{placement:"center-center",normalizedOffset:null,anchor:"center"};case "point":return y["above-center"];case "mesh":return y["above-center"];default:a.neverReached(b)}}function v(a,c,b){b=b.graphics3DGraphic._graphics[0];b=h.isSome(b)?b.getBoundingBoxObjectSpace(H):H;b=g.vec3f64.fromValues(b[3]-b[0],b[4]-b[1],b[5]-b[2]);a.centerOffset[0]=Math.sqrt(b[0]*b[0]+b[1]*b[1])/2*c.normalizedOffset[0];var d=a.translation[2],e=b[2]/2*c.normalizedOffset[1];a.translation[2]=0;a.elevationOffset=d+e;b=f.vec3.length(b);
a.centerOffset[2]=b/2*c.normalizedOffset[2]}function z(a){var b=a.labelClass.labelPlacement,d=a.labelSymbol,e=a.graphics3DGraphic,f=c.getGraphics3DSymbol(e.graphics3DSymbol),f=h.isSome(f)?f.symbol:null;a=y[b]||u(a);if("point-3d"===f.type&&f.supportsCallout()&&f.hasVisibleVerticalOffset()&&!e.isDraped)return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:w(f.verticalOffset),anchor:null,normalizedOffset:null};if(d&&d.hasVisibleVerticalOffset()&&("point-3d"!==f.type||!f.supportsCallout()||!f.verticalOffset||
e.isDraped)){a:switch(a.placement){case "above-center":e=!0;break a;default:e=!1}return e?{placement:"above-center",verticalOffset:w(d.verticalOffset),anchor:"bottom",normalizedOffset:[0,a.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(q.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+b+" placement)"),null)}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}
function w(a){return{screenLength:a.screenLength,minWorldLength:a.minWorldLength,maxWorldLength:a.maxWorldLength}}Object.defineProperty(b,"__esModule",{value:!0});var q=m.getLogger("esri.views.3d.layers.graphics.labelPlacement");b.get=function(a){var c=z(a);if(h.isNone(c))return null;var b;if(c.anchor)b=c;else{b=a.labelClass.labelPlacement;var f=y[b],m=f||u(a);b&&!f&&q.warnOncePerTick("the requested label placement '"+b+"' is not currently supported in SceneView");b=r(m,a)}if(h.isNone(b))return null;
f=!!c.hasLabelVerticalOffset;c={anchor:b.anchor,verticalOffset:c.verticalOffset,screenOffset:e.vec2f64.create(),centerOffset:l.vec4f64.fromValues(0,0,0,-1),centerOffsetUnits:"world",translation:g.vec3f64.create(),elevationOffset:0,hasLabelVerticalOffset:f};f=a.graphics3DGraphic.graphic.geometry;if(h.isNone(f))a=null;else{switch(f.type){case "point":f=p(a);if(!h.isNone(f))switch(a.graphics3DGraphic.getCenterObjectSpace(c.translation),f.type){case "icon":case "text":m=a.graphics3DGraphic;f=m._graphics[0];
f=h.isSome(f)?f.getScreenSize():null;!m.isDraped&&h.isSome(f)?(m=void 0,void 0===m&&(m=F),a=a.graphics3DGraphic._graphics[0],(a=h.isSome(a)?a.stageObject.geometryRecords[0].material:null)&&a instanceof k.default?(a=a.getParameters().anchorPos,m[0]=2*(a[0]-.5),m[1]=2*(a[1]-.5)):(m[0]=0,m[1]=0),a=m,C[0]=f[0]/2*(b.normalizedOffset[0]-a[0]),C[1]=f[1]/2*(b.normalizedOffset[1]-a[1]),c.screenOffset[0]=C[0],c.hasLabelVerticalOffset?(c.centerOffset[1]=C[1],c.centerOffsetUnits="screen"):c.screenOffset[1]=C[1]):
c.hasLabelVerticalOffset||"center"===c.anchor||(y[a.labelClass.labelPlacement]&&q.warnOncePerTick("the requested placement '"+b.placement+"' is currently unsupported for draped graphics"),c.anchor="center");break;case "object":v(c,b,a)}break;case "polygon":f=p(a);if(!h.isNone(f))switch(f.type){case "extrude":f=a.graphics3DGraphic._graphics[0],h.isSome(f)&&f.getBoundingBoxObjectSpace(H),d.center(H,c.translation),c.translation[2]=d.height(H)/2,v(c,b,a)}break;case "mesh":v(c,b,a)}a=c}return a};var y=
{"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},
"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},A={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],
"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};n=function(a){var c=y[a];A[a].forEach(function(a){y[a]=c})};for(var B in A)n(B);Object.freeze&&(Object.freeze(y),Object.keys(y).forEach(function(a){Object.freeze(y[a]);Object.freeze(y[a].normalizedOffset)}));var C=[0,0],F=[0,0],H=d.create()})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["require",
"exports"],function(n,b){return function(){function a(a){this.materials={};this.stage=a}a.prototype.getMaterial=function(a){return this.materials[a]};a.prototype.addMaterial=function(a,b){this.materials[a]=b;this.stage.add(3,b)};a.prototype.dispose=function(){for(var a in this.materials)this.stage.remove(3,this.materials[a].id);this.materials={}};return a}()})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Evented ../../../../core/MapUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators ./Texture ../../../support/Scheduler ../../../webgl/Texture".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function m(a){a=b.call(this,a)||this;a.events=new h;a.glTexture=null;a.dirty=!1;a.needsClear=!1;a.elementsToAddOrUpdate=new Map;a.elementsToRemove=new Map;a.elementsToRender=new Map;a.elements=new Map;a.stageObjects=new Map;return a}a.__extends(m,b);u=m;m.prototype.initialize=function(){this.id=d.idGen.gen(this.idHint);this.stage=this.view._stage;this.canvas=this.create2DCanvas();this.ctx=this.canvas.getContext("2d");
this.stage.add(4,this);var a=this.computeAtlasResolution(this.view.width,this.view.height);this.createAtlasRegion(a);this.update2DCanvasSize();this.resetAtlasCursor()};m.prototype.unload=function(){g.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null);this.events.emit("unloaded")};Object.defineProperty(m.prototype,"width",{get:function(){return this.atlas.size.width},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"height",{get:function(){return this.atlas.size.height},
enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"requiresFrameUpdates",{get:function(){return!1},enumerable:!0,configurable:!0});m.prototype.createDescriptor=function(a){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:a.parameters.maxMaxAnisotropy}};m.prototype.load=function(a){var b=this;if(g.isSome(this.glTexture))return this.glTexture;this.glTexture=new k(a,this.createDescriptor(a),this.canvas);
this.frameWorker=this.view.resourceController.scheduler.registerTask(c.Task.TEXT_TEXTURE_ATLAS,function(a){return b.run(b.makeRunContext(a))},function(){return b.dirty});this.setDirty();return this.glTexture};m.prototype.dispose=function(){this.elementsToRender=this.elementsToRemove=this.elementsToAddOrUpdate=this.elements=null;this.frameWorker&&(this.frameWorker.remove(),this.frameWorker=null);this.glTexture&&(this.glTexture=null,this.stage.remove(4,this.id));this.canvas.width=0;this.canvas.height=
0;this.ctx=this.canvas=null};m.prototype.create2DCanvas=function(){var a=document.createElement("canvas");a.setAttribute("id","canvas2d");a.setAttribute("style","display:none");a.setAttribute("width",(512).toString());a.setAttribute("height",(512).toString());return a};m.prototype.update2DCanvasSize=function(){this.canvas.setAttribute("width",this.atlas.size.width.toString());this.canvas.setAttribute("height",this.atlas.size.height.toString())};m.prototype.createAtlasRegion=function(a){void 0===a&&
(a=512);this.atlas={size:{width:a,height:a},cursor:{x:0,y:0},lineHeight:0}};m.prototype.computeAtlasResolution=function(a,c){a=Math.max(a,c);a=f.nextHighestPowerOfTwo(a+256);return a=Math.min(a,4096)};m.prototype.resizeAtlas=function(a,c){c=c||a;var b=this.atlas;b.size.width=a;b.size.height=c;g.isSome(this.glTexture)&&this.glTexture.resize(a,c);this.update2DCanvasSize()};m.prototype.resetAtlasCursor=function(){var a=this.atlas;a.cursor.x=p;a.cursor.y=p+r;a.lineHeight=0;this.needsClear=!0};m.prototype.getAtlasUsage=
function(){var a=this.atlas;return(a.cursor.x+a.cursor.y*a.size.width)/(a.size.width*a.size.height)};m.prototype.getExpectedAtlasUsage=function(){var a=this.elementsToRemove.size,c=this.elementsToAddOrUpdate.size,b=this.elements.size;return this.getAtlasUsage()/b*(b+c-a)};m.prototype.addAtlasElement=function(a,c,b,d){var e=this.atlas,f=a.textRenderer,g=f.renderedWidth,k=f.renderedHeight,h=f.displayWidth,f=f.displayHeight;a.placement.offset.x=e.cursor.x;a.placement.offset.y=e.cursor.y;a.placement.size.width=
g;a.placement.size.height=k;a.placement.size.displayWidth=h;a.placement.size.displayHeight=f;a.placement.uvMinMax=[a.placement.offset.x/e.size.width,1-(a.placement.offset.y+k)/e.size.height,(a.placement.offset.x+g)/e.size.width,1-a.placement.offset.y/e.size.height];e.cursor.x+=b;e.lineHeight=Math.max(e.lineHeight,d);this.elements.set(c,a)};m.prototype.removeAtlasElement=function(a){if(a&&this.elements.has(a.textId)){var c=a.placement.offset,b=a.placement.size;this.ctx.clearRect(c.x,c.y,b.width,b.height);
this.elements.delete(a.textId)}};m.prototype.ensureStageObjects=function(a){var c=this.stageObjects.get(a);if(c)return c;c=new Set;this.stageObjects.set(a,c);return c};m.prototype.addStageObject=function(a,c){this.ensureStageObjects(a).add(c)};m.prototype.removeStageObject=function(a,c){(a=this.stageObjects.get(a))&&a.delete(c)&&(c.geometries[0].data.vertexAttributes.size.data=new Float32Array([0,0]),c.geometryVertexAttrsUpdated(0))};m.prototype.processAdditionRequest=function(a,c){var b=this.atlas,
d=a.textId,e=a.textRenderer.renderedWidth+p,f=a.textRenderer.renderedHeight+p+r;c=c.repackingEnabled;if(b.cursor.x+e<b.size.width&&b.cursor.y+f<b.size.height)this.addAtlasElement(a,d,e,f),this.elementsToRender.set(d,a),this.elementsToAddOrUpdate.delete(d);else if(b.cursor.y+f+b.lineHeight<b.size.height)b.cursor.x=p,b.cursor.y+=b.lineHeight,b.lineHeight=0,this.addAtlasElement(a,d,e,f),this.elementsToRender.set(d,a),this.elementsToAddOrUpdate.delete(d);else{a=this.getExpectedAtlasUsage();(d=.85<a&&
4096>b.size.width)&&this.resizeAtlas(2*b.size.width,2*b.size.height);if(!c||!d&&.95<a&&4096===b.size.width)return this.processRemovals(),0;this.repack();return 1}return 0};m.prototype.processRemovals=function(){var a=this;this.elementsToRemove.forEach(function(c,b){var d=a.stageObjects.get(b);d&&0!==d.size||a.removeAtlasElement(c);d&&0===d.size&&a.stageObjects.delete(b)});this.elementsToRemove.clear()};m.prototype.repack=function(){var a=this;this.processRemovals();this.elements.forEach(function(c,
b){c.rendered=!1;a.elementsToAddOrUpdate.set(b,c)});this.elements.clear();this.resetAtlasCursor();this.elementsToRender.clear()};m.prototype.processRenderingRequest=function(a){this.ctx.clearRect(a.placement.offset.x,a.placement.offset.y,a.placement.size.width,a.placement.size.height);a.textRenderer.render(this.ctx,a.placement.offset.x,a.placement.offset.y);var c=this.stageObjects.get(a.textId);c&&c.forEach(function(c){c.geometries[0].data.vertexAttributes.uv0.data=new Float32Array(a.placement.uvMinMax);
c.geometries[0].data.vertexAttributes.size.data=new Float32Array([a.placement.size.displayWidth,a.placement.size.displayHeight]);c.geometryVertexAttrsUpdated(0)});a.rendered=!0};m.prototype.run=function(a){var c=this;if(this.glTexture){var b=a.budget,d=!1;e.someMap(this.elementsToAddOrUpdate,function(b,e){return(b=c.elements.get(e))&&b.rendered?((b=c.stageObjects.get(e))&&b.forEach(function(a){var b=a.geometries[0].data.vertexAttributes,d=c.elements.get(e);b.uv0.data=new Float32Array(d.placement.uvMinMax);
b.size.data=new Float32Array([d.placement.size.displayWidth,d.placement.size.displayHeight]);a.geometryVertexAttrsUpdated(0)}),c.elementsToAddOrUpdate.delete(e),!1):1===c.processAdditionRequest(c.elementsToAddOrUpdate.get(e),a)?d=!0:!1});if(d)a.budget=null,a.repackingEnabled=!1,this.run(a);else{var f=!1;0<this.elementsToRender.size&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1);e.someMap(this.elementsToRender,function(a,d){c.processRenderingRequest(a);
c.elementsToRender.delete(d);f=!0;return b&&(b.madeProgress(),b.done)?!0:!1});f&&g.isSome(this.glTexture)&&this.glTexture.setData(this.canvas);this.dirty=0<this.elementsToRender.size;this.dirty||(u.test.orderedRepackingEnabled&&this.repackOrdered(),this.notifyChange("updating"))}}};m.prototype.makeRunContext=function(a){void 0===a&&(a=null);t.budget=a;t.repackingEnabled=!0;return t};m.prototype.addTextTexture=function(a,c){var b=a.key;this.elementsToAddOrUpdate.has(b)||this.elementsToAddOrUpdate.set(b,
{textId:b,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:a,rendered:!1});this.addStageObject(b,c);this.elementsToRemove.delete(b);this.setDirty()};m.prototype.removeTextTexture=function(a,c){a=a.key;this.elementsToRemove.set(a,this.elements.get(a));this.removeStageObject(a,c)};Object.defineProperty(m.prototype,"textureId",{get:function(){return this.id},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"isDirty",{get:function(){return this.dirty},
enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"updating",{get:function(){return this.dirty&&!!this.frameWorker},enumerable:!0,configurable:!0});m.prototype.setDirty=function(){this.dirty||(this.dirty=!0,this.notifyChange("updating"))};Object.defineProperty(m.prototype,"test",{get:function(){var a=this;return{elements:this.elements,stageObjects:this.stageObjects,elementsToRemove:this.elementsToRemove,atlas:this.atlas,resizeAtlas:function(c,b){return a.resizeAtlas(c,b)},run:function(c){return a.run(c)}}},
enumerable:!0,configurable:!0});m.prototype.repackOrdered=function(){if(0!==this.elements.size){var a=[];this.elements.forEach(function(c,b){return a.push({element:c,key:b})});for(var c=!0,b=0;b<a.length-1;b++)if(0<a[b].key.localeCompare(a[b+1].key)){c=!1;break}if(!c||this.elementsToRemove.size){a.sort(function(a,c){return a.key.localeCompare(c.key)});this.elements.clear();for(c=0;c<a.length;c++)b=a[c],this.elements.set(b.key,b.element);this.repack();this.setDirty()}}};var u;m.test={orderedRepackingEnabled:!1};
a.__decorate([l.property({constructOnly:!0})],m.prototype,"idHint",void 0);a.__decorate([l.property({constructOnly:!0})],m.prototype,"view",void 0);a.__decorate([l.property({type:Boolean,readOnly:!0})],m.prototype,"updating",null);return m=u=a.__decorate([l.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],m)}(m);b.TextTextureAtlas=n;var p=2,r=2,t={budget:null,repackingEnabled:!0};b.default=n})},"esri/views/3d/layers/graphics/ObjectResourceCache":function(){define("require exports tslib ../../../../core/Handles ../../../../core/handleUtils ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),
function(n,b,a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this.gltfCache=new Map;this.wosrCache=new Map;this.evictHandles=new m}b.prototype.loadGLTF=function(a,c){return this.fromCache(this.gltfCache,"gltf:"+a,function(c){return l.load(new g.DefaultLoadingContext(c.streamDataRequester),a,c)},c)};b.prototype.loadWOSR=function(a,c){return this.fromCache(this.wosrCache,"wosr:"+a+":"+c.disableTextures,function(c){return d.load(a,c)},c)};b.prototype.destroy=
function(){this.evictHandles.destroy();this.gltfCache.clear();this.wosrCache.clear()};Object.defineProperty(b.prototype,"size",{get:function(){return this.wosrCache.size+this.gltfCache.size},enumerable:!0,configurable:!0});b.prototype.fromCache=function(c,b,d,g){var k=this;return f.create(function(h,l){if(f.isAborted(g))l(f.createAbortError());else{var m=f.onAbort(g,function(){k.remove(c,b);l(f.createAbortError())}),p=c.get(b);if(p)k.evictHandles.remove(b),p.refCount++,p.item.then(h,l);else{var p=
f.createAbortController(),r=a.__assign(a.__assign({},g),{signal:p.signal}),t={refCount:1,abortController:p,item:d(r).then(function(a){t.abortController=null;a.remove=function(){return k.remove(c,b)};return a})};c.set(b,t);t.item.then(function(a){e.isSome(m)&&m.remove();h(a)},function(a){e.isSome(m)&&m.remove();l(a)})}}})};b.prototype.remove=function(a,b){var d=a.get(b);d&&(d.refCount--,0===d.refCount&&this.evictHandles.add(h.timeoutHandle(function(){a.delete(b);e.isSome(d.abortController)&&d.abortController.abort()},
c),b))};return b}();b.ObjectResourceCache=n;var c=1E4;b.test={overrideEvictDelay:function(a){c=a;return{remove:function(){c=1E4}}}}})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/PooledArray ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/projectionUtils ../../../support/Scheduler".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t){Object.defineProperty(b,"__esModule",{value:!0});var u=f.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");n=function(b){function f(a){a=b.call(this,a)||this;a.tiles=new h;a.tileSize=512;a._idToTile=new Map;a._handles=new e;a._clients=new Set;a._dirty=!1;a._newTiles=new g;return a}a.__extends(f,b);Object.defineProperty(f.prototype,"tilingScheme",{get:function(){var a=this.tilingSchemeOwner.tilingScheme;return a?a.clone():null},enumerable:!0,configurable:!0});
Object.defineProperty(f.prototype,"filterExtent",{set:function(a){if(a&&!a.spatialReference.equals(this.viewState.spatialReference))u.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");else{var c=this._get("filterExtent");c===a||c&&a&&c.equals(a)||(a=a?a.clone():null,this._set("filterExtent",a),this._setDirty())}},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"filterExtentRect",{get:function(){if(!this.filterExtent||!this.tilingScheme)return null;
var a=c.create();r.extentToBoundingRect(this.filterExtent,a,this.tilingScheme.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"rootTileIds",{get:function(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"suspended",{set:function(a){a!==this._get("suspended")&&(this._set("suspended",a),this._setDirty())},enumerable:!0,configurable:!0});
Object.defineProperty(f.prototype,"updating",{get:function(){return this._dirty||!!this._pendingTiles},enumerable:!0,configurable:!0});f.prototype.initialize=function(){var a=this;this._handles.add(this.watch(["tilingScheme","tileSize"],function(){return a._reset()},!0));this._handles.add(l.init(this,["tileSize","cameraOnSurface.location","tilingScheme","viewState.camera","focus.locationOnSurface"],function(){return a._setDirty()},!0));this.scheduler&&(this._frameWorker=this.scheduler.registerTask(t.Task.FEATURE_TILE_TREE,
function(c){return a._update(c)},function(){return a.updating}))};f.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this._handles&&(this._handles.destroy(),this._handles=null)};f.prototype.addClient=function(){var a=this,c=v++;this._clients.add(c);1===this._clients.size&&this._setDirty();return{remove:function(){return a._removeClient(c)}}};f.prototype._removeClient=function(a){this._clients.delete(a);this._hasClients||this._clear()};Object.defineProperty(f.prototype,
"_hasClients",{get:function(){return 0<this._clients.size},enumerable:!0,configurable:!0});f.prototype._setDirty=function(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this._update(t.noBudget))};f.prototype._clear=function(){this.tiles.removeAll();this._idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")};f.prototype._update=function(a){this._dirty=!1;this._pendingTiles||(this._startUpdate(),this._frameWorker&&
(this._frameWorker.task=t.Task.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(a);!this._pendingTiles&&this._frameWorker&&(this._frameWorker.task=t.Task.FEATURE_TILE_TREE);this.notifyChange("updating")};f.prototype._startUpdate=function(){if(!this.suspended)if(this.tilingScheme){this._tileMeasurements||(this._tileMeasurements=new p.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,maxVerticalScreenSize:w}));var a=this.cameraOnSurface.location;
this._tileMeasurements.begin(this.viewState.camera,this.focus?this.focus.locationOnSurface:a,a.z);this._pendingTiles=this._getRootTiles()}else this._clear()};f.prototype._reset=function(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()};f.prototype._getRootTiles=function(){var a=this;return this.rootTileIds.map(function(c){return new k.FeatureTileDescriptor3D(c[0],c[1],c[2],a.tilingScheme)})};f.prototype._purgeHorizonTiles=function(a){a.sort(function(a,c){a=
a.measures.screenRect;c=c.measures.screenRect;return a[1]+a[3]-(c[1]+c[3])});c.empty(z);for(var b=0;b<a.length;b++)if(c.expand(z,a.data[b].measures.screenRect),c.height(z)>w)return a.data.slice(b,a.length);return[]};f.prototype._subdivideTilesForView=function(a){var b;if(this._pendingTiles){for(;0<this._pendingTiles.length&&!a.done;){var d=this._pendingTiles.pop();a.madeProgress();if(!this.filterExtentRect||c.intersects(this.filterExtentRect,d.extent))this._tileMeasurements.updateTile(d),0!==d.measures.visibility&&
(d.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(d.lij[0]+1),(b=this._pendingTiles).push.apply(b,d.getChildren())):this._newTiles.push(d))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}};f.prototype._updateTiles=function(a){for(var c=this,b=0,d=this.tiles.items;b<d.length;b++)d[b].used=!1;a=a.filter(function(a){var b=c._idToTile.get(a.id);b?(b.copyMeasurementsFrom(a),b.used=
!0):c._idToTile.set(a.id,a);return!b});b=this.tiles.items.filter(function(a){return a.used?!1:(c._idToTile.delete(a.id),!0)});this.tiles.removeMany(b);this.tiles.addMany(a);this.sortTiles()};f.prototype.sortTiles=function(){this.tiles.sort(function(a,c){return a.measures.visibility!==c.measures.visibility?2===a.measures.visibility?-1:1:a.measures.distance-c.measures.distance});this.tiles.forEach(function(a,c){return a.loadPriority=c})};a.__decorate([d.property({constructOnly:!0})],f.prototype,"scheduler",
void 0);a.__decorate([d.property({constructOnly:!0})],f.prototype,"renderCoordsHelper",void 0);a.__decorate([d.property({constructOnly:!0})],f.prototype,"tilingSchemeOwner",void 0);a.__decorate([d.property({constructOnly:!0})],f.prototype,"cameraOnSurface",void 0);a.__decorate([d.property({constructOnly:!0})],f.prototype,"focus",void 0);a.__decorate([d.property({constructOnly:!0})],f.prototype,"viewState",void 0);a.__decorate([d.property()],f.prototype,"tiles",void 0);a.__decorate([d.property()],
f.prototype,"tileSize",void 0);a.__decorate([d.property({readOnly:!0,dependsOn:["tilingSchemeOwner.tilingScheme"]})],f.prototype,"tilingScheme",null);a.__decorate([d.property()],f.prototype,"filterExtent",null);a.__decorate([d.property({readOnly:!0,dependsOn:["filterExtent","tilingScheme"]})],f.prototype,"filterExtentRect",null);a.__decorate([d.property({readOnly:!0,dependsOn:["filterExtentRect"]})],f.prototype,"rootTileIds",null);a.__decorate([d.property({value:!1})],f.prototype,"suspended",null);
a.__decorate([d.property({readOnly:!0})],f.prototype,"updating",null);return f=a.__decorate([d.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],f)}(m);b.FeatureTileTree3D=n;var v=0,z=c.create(),w=10;b.default=n})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["require","exports","../../../../geometry/support/aaBoundingRect"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,e,f,g){void 0===g&&(g=null);this.lij=[0,0,0];
this.extent=a.create();this.loadPriority=this.resolution=0;this.measures={visibility:2,screenRect:a.create(),distance:0,shouldSplit:!1};this.used=!1;g&&this.acquire(b,e,f,g)}b.prototype.acquire=function(a,e,f,g){this.tilingScheme=g;this.id=b.id(a,e,f);this.lij[0]=a;this.lij[1]=e;this.lij[2]=f;g.getExtent(a,e,f,this.extent);this.resolution=g.resolutionAtLevel(a)};b.prototype.release=function(){this.tilingScheme=null};b.prototype.getChildren=function(a){var e=this.lij[0]+1,f=2*this.lij[1],g=2*this.lij[2];
if(!a)return[new b(e,f,g,this.tilingScheme),new b(e,f+1,g,this.tilingScheme),new b(e,f,g+1,this.tilingScheme),new b(e,f+1,g+1,this.tilingScheme)];a[0].acquire(e,f,g,this.tilingScheme);a[1].acquire(e,f+1,g,this.tilingScheme);a[2].acquire(e,f,g+1,this.tilingScheme);a[3].acquire(e,f+1,g+1,this.tilingScheme);return a};b.prototype.copyMeasurementsFrom=function(b){this.measures.visibility=b.measures.visibility;this.measures.shouldSplit=b.measures.shouldSplit;this.measures.distance=b.measures.distance;a.set(b.measures.screenRect,
this.measures.screenRect)};b.id=function(a,b,f){return a+"/"+b+"/"+f};return b}();b.FeatureTileDescriptor3D=n;b.default=n})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("require exports ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ./FeatureTileVisibility3D ../../support/geometryUtils ../../webgl-engine/lib/Camera".split(" "),function(n,b,a,m,h,e,f,g,l){Object.defineProperty(b,
"__esModule",{value:!0});n=function(){function a(a){this.camera=new l.default;this.pointOfInterestInMap=[0,0];this.screenRect=e.create();this.tileSize=a.tileSize;this.maxVerticalScreenSize=a.maxVerticalScreenSize;this.renderCoordsHelper=a.renderCoordsHelper;this.tilingScheme=a.tilingScheme;this.visibility=new f.FeatureTileVisibility3D({renderCoordsHelper:a.renderCoordsHelper})}a.prototype.begin=function(a,c,b){this.camera.copyFrom(a);this.z=b;this.pointOfInterestInMap[0]=c.x;this.pointOfInterestInMap[1]=
c.y;e.fromValues(0,0,a.fullWidth,a.fullHeight,this.screenRect);this.visibility.begin(this.camera,b)};a.prototype.end=function(){this.visibility.end()};a.prototype.updateTile=function(a){a.measures.visibility=this.visibility.calculate(a);0!==a.measures.visibility&&this.updateScreenMeasure(a);this.updateDistanceMeasure(a)};a.prototype.updateDistanceMeasure=function(a){a.measures.distance=e.distance(a.extent,this.pointOfInterestInMap)};a.prototype.updateScreenMeasure=function(a){var c=k,b=1<<c,d=a.measures.screenRect;
e.empty(d);for(var f=0,g=a.lij[0]+c,h=a.lij[1]<<c,c=a.lij[2]<<c,l=this.tileSizeWithBias(a),l=l*l,m=!1,p=0;p<b;p++){for(var q=0;q<b&&!(m=this.computeScreenArea(a,g,h+p,c+q,d),f+=m.area,m=f>l&&e.height(d)>this.maxVerticalScreenSize);q++);if(m)break}a.measures.shouldSplit=f>l};a.prototype.tileSizeWithBias=function(a){return 1===a.measures.visibility?this.tileSize*p:this.tileSize};a.prototype.computeScreenArea=function(a,b,f,k,h){var l=r.points;this.projectToScreen(b,f,k,1===a.measures.visibility,l);
e.empty(d);for(a=0;4>a;a++)e.expandPointInPlace(d,l[a]);e.expand(h,d);e.intersection(d,this.screenRect,c);r.screenOverlap=e.area(c)/e.area(d);r.area=g.triangle.areaPoints2d(l[0],l[1],l[2])+g.triangle.areaPoints2d(l[0],l[2],l[3]);return r};a.prototype.projectToScreen=function(a,c,b,d,e){this.tilingScheme.ensureMaxLod(a);this.tilingScheme.getExtent(a,c,b,t);this.toRenderCoords(t,0,3,v[0]);this.toRenderCoords(t,2,3,v[1]);this.toRenderCoords(t,2,1,v[2]);this.toRenderCoords(t,0,1,v[3]);d&&(this.projectToPlane(v,
this.camera.frustum.planes[4]),this.projectToPlane(v,this.camera.frustum.planes[3]),this.projectToPlane(v,this.camera.frustum.planes[2]));for(a=0;4>a;a++)this.camera.projectPoint(v[a],w),this.camera.renderToScreen(w,e[a])};a.prototype.projectToPlane=function(a,c){for(var b=0;4>b;b++)z[b]=g.plane.signedDistance(c,a[b]);b=Math.max(z[0],z[1],z[2],z[3]);if(0<b)for(c=m.vec3.scale(u,g.plane.normal(c),-b),b=0;4>b;b++)m.vec3.add(a[b],a[b],c)};a.prototype.toRenderCoords=function(a,c,b,d){u[0]=a[c];u[1]=a[b];
u[2]=this.z;this.renderCoordsHelper.toRenderCoords(u,this.tilingScheme.spatialReference,d);return d};return a}();b.FeatureTileMeasurements3D=n;var d=e.create(),c=e.create(),k=2,p=5,r={points:[a.createScreenPointArray(),a.createScreenPointArray(),a.createScreenPointArray(),a.createScreenPointArray()],area:0,screenOverlap:0},t=e.create(),u=h.vec3f64.create(),v=[h.vec3f64.create(),h.vec3f64.create(),h.vec3f64.create(),h.vec3f64.create()],z=[0,0,0,0],w=a.createRenderScreenPointArray3();b.default=n})},
"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("require exports ../../../../core/mathUtils ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection ../../support/geometryUtils".split(" "),function(n,b,a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this.surfaceElevation=0;this.cache=new Map;
a=a.renderCoordsHelper;this.frustum=new g.Frustum({renderCoordsHelper:a});this.extendedFrustum=new g.Frustum({renderCoordsHelper:a});this.intersector=new l.FrustumExtentIntersection({renderCoordsHelper:a});this.renderCoordsHelper=a}b.prototype.begin=function(a,c){this.surfaceElevation=c;this.aboveGround=this.renderCoordsHelper.getAltitude(a.eye)>c;this.frustum.update(a);this.shortenFrustumFarPlane(this.frustum);this.updateExtendedFrustum(a,c)};b.prototype.end=function(){this.cache.clear()};b.prototype.calculate=
function(a){if(this.allTilesInvisible)return 0;var b="global"===this.renderCoordsHelper.type&&a.lij[0]>=c&&a.lij[0]<k,d=this.getOrCalculateSingleTileVisibility(a,!b);return 0!==d&&b?this.calculateAggregatedChildrenVisibility(a):d};b.prototype.shortenFrustumFarPlane=function(a){for(var c=a.mutablePoints,b=0,d=g.Frustum.nearFarLineIndices;b<d.length;b++){var e=d[b],f=e[1],e=c[e[0]];h.vec3.subtract(t,c[f],e);h.vec3.scale(t,t,r);h.vec3.add(c[f],e,t)}a.updatePoints(c)};b.prototype.calculateAggregatedChildrenVisibility=
function(a){var c=0,b=this.cache.get(a.id);if(null!=b)return b;b=z.acquire();a.getChildren(b);for(var d=0;d<b.length;d++){var e=this.calculate(b[d]);if(0!==e&&(c=e,2===e))break}z.release(b);this.cache.set(a.id,c);return c};b.prototype.getOrCalculateSingleTileVisibility=function(a,c){var b=this.cache.get(a.id);if(null!=b)return b;b=this.calculateSingleTileVisibility(a);c&&this.cache.set(a.id,b);return b};b.prototype.calculateSingleTileVisibility=function(a){if(!this.aboveGround&&"global"===this.renderCoordsHelper.type&&
a.lij[0]<p){if(0===this.calculateSingleTileVisibilitySided(a,!1))return this.calculateSingleTileVisibilitySided(a,!0)}else return this.calculateSingleTileVisibilitySided(a,this.aboveGround)};b.prototype.calculateSingleTileVisibilitySided=function(a,c){this.intersector.update(a.extent,a.tilingScheme.spatialReference,this.surfaceElevation,c);return this.intersector.isVisibleInFrustum(this.extendedFrustum)?this.intersector.isVisibleInFrustum(this.frustum,!0)?2:1:0};b.prototype.updateExtendedFrustum=
function(c,b){var e=this.renderCoordsHelper;this.extendedFrustum.update(c);this.shortenFrustumFarPlane(this.extendedFrustum);var f=this.renderCoordsHelper.worldUpAtPosition(c.eye,t);this.aboveGround||h.vec3.negate(f,f);f=a.acosClamped(-h.vec3.dot(f,c.viewForward));this.allTilesInvisible=f>(Math.PI+c.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=f>c.fovY/2)){c=this.extendedFrustumParameters(b);b=this.extendedFrustum.mutablePoints;for(f=0;4>f;f++){var g=c.pointIndices[f],k=b[g],l=e.getAltitude(k);
if(c.needsAltitudeAdjustment(l)){this.renderCoordsHelper.worldUpAtPosition(k,t);switch(g){case 4:case 7:case 0:case 3:d.plane.projectVector(this.extendedFrustum.planes[0],t,t);break;case 5:case 6:case 1:case 2:d.plane.projectVector(this.extendedFrustum.planes[1],t,t)}h.vec3.scale(t,t,c.direction);this.renderCoordsHelper.intersectInfiniteManifold(d.ray.wrap(k,t),c.zWithMargin,k)}}this.extendedFrustum.updatePoints(b);d.plane.fromPoints(b[0],b[1],b[2],u);d.plane.fromPoints(b[1],b[2],b[3],v);0>h.vec3.dot(d.plane.normal(u),
d.plane.normal(v))&&(e=this.extendedFrustum.mutablePoints,this.aboveGround?(c=[e[1],e[0]],e[0]=c[0],e[1]=c[1]):(c=[e[2],e[3]],e[3]=c[0],e[2]=c[1]),this.extendedFrustum.updatePoints(e))}};b.prototype.extendedFrustumParameters=function(a){return this.aboveGround?this.extendedFrustumParametersAboveSurface(a,1):this.extendedFrustumParametersBelowSurface(a,1)};b.prototype.extendedFrustumParametersAboveSurface=function(a,c){var b=a-c;return{zWithMargin:b,pointIndices:g.Frustum.planePointIndices.bottom,
direction:-1,needsAltitudeAdjustment:function(a){return a>b}}};b.prototype.extendedFrustumParametersBelowSurface=function(a,c){var b=a+c;return{zWithMargin:b,pointIndices:g.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment:function(a){return a<b}}};return b}();b.FeatureTileVisibility3D=n;var c=2,k=6,p=12,r=.95,t=e.vec3f64.create(),u=d.plane.create(),v=d.plane.create(),z=new m(Array,function(a){4!==a.length&&(a[0]=new f.FeatureTileDescriptor3D,a[1]=new f.FeatureTileDescriptor3D,a[2]=
new f.FeatureTileDescriptor3D,a[3]=new f.FeatureTileDescriptor3D)},function(a){a[0].release();a[1].release();a[2].release();a[3].release()});b.default=n})},"esri/views/3d/state/Frustum":function(){define("require exports ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/mathUtils ../support/geometryUtils/frustum".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this.frustum=e.create();this.lines=Array(12);
this.origin=m.vec3f64.create();this.direction=m.vec3f64.create();this._altitude=null;this.renderCoordsHelper=a?a.renderCoordsHelper:null;for(a=0;12>a;a++)this.lines[a]={origin:null,direction:m.vec3f64.create(),endpoint:null}}Object.defineProperty(b.prototype,"planes",{get:function(){return this.frustum.planes},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"points",{get:function(){return this.frustum.points},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"mutablePoints",
{get:function(){return this.frustum.points},enumerable:!0,configurable:!0});b.prototype.update=function(b){e.fromMatrix(b.viewMatrix,b.projectionMatrix,this.frustum);a.vec3.copy(this.origin,b.eye);a.vec3.copy(this.direction,b.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this.origin);this.updateLines()};b.prototype.updatePoints=function(b){for(var f=0;f<this.frustum.points.length;f++)a.vec3.copy(this.frustum.points[f],b[f]);e.recomputePlanes(this.frustum);this.updateLines()};Object.defineProperty(b.prototype,
"altitude",{get:function(){return this._altitude},enumerable:!0,configurable:!0});b.prototype.intersectsSphere=function(a){return e.intersectsSphere(this.frustum.planes,a)};b.prototype.intersectsRay=function(a){return e.intersectsRay(this.frustum.planes,a)};b.prototype.intersectsLineSegment=function(a,b){return e.intersectsLineSegment(this.frustum.planes,a,b)};b.prototype.intersectsPoint=function(a){return e.intersectsPoint(this.frustum.planes,a)};b.prototype.updateLines=function(){for(var a=this.frustum.points,
b=0;4>b;b++){var d=b,c=b+4;this.updateLine(this.lines[b],a[d],a[c]);this.updateLine(this.lines[b+4],a[d],3===b?a[0]:a[d+1]);this.updateLine(this.lines[b+8],a[c],3===b?a[4]:a[c+1])}};b.prototype.updateLine=function(a,b,d){a.origin=b;a.endpoint=d;h.directionFromTo(a.direction,b,d)};b.planePointIndices=e.planePointIndices;b.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]];return b}();b.Frustum=n;b.default=n})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("require exports ../../../core/compilerUtils ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ./earthUtils ./geometryUtils ./intersectionUtils ./mathUtils ./projectionUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t){Object.defineProperty(b,"__esModule",{value:!0});n=.5*Math.PI;var u=n/Math.PI*180,v=n*c.earthRadius,z=.9*c.earthRadius;c=function(){function c(a){this.renderCoordsHelper=a.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:g.vec3f64.create(),direction:g.vec3f64.create()};for(a=0;4>a;a++)this.extent[a]={origin:g.vec3f64.create(),direction:g.vec3f64.create(),cap:{next:null,direction:g.vec3f64.create()}},this.planes[a]=
k.plane.create();this.planes[4]=k.plane.create();this.planes[5]=k.plane.create();this.planesWithoutFar=this.planes.slice(0,5)}c.prototype.update=function(a,c,b,d){void 0===d&&(d=!0);var e=this.extent;this.toRenderBoundingExtent(a,c,b);f.vec3.add(this.center.origin,e[0].origin,e[2].origin);f.vec3.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);d||f.vec3.scale(this.center.direction,this.center.direction,-1);for(b=0;4>
b;b++){var g=e[b];this.renderCoordsHelper.worldUpAtPosition(g.origin,g.direction);var h=e[3===b?0:b+1];g.cap.next=h.origin;r.directionFromTo(g.cap.direction,g.origin,h.origin);k.plane.fromVectorsAndPoint(g.direction,g.cap.direction,g.origin,this.planes[b]);d||f.vec3.scale(g.direction,g.direction,-1)}k.plane.fromVectorsAndPoint(e[0].cap.direction,e[1].cap.direction,e[0].origin,this.planes[4]);d?k.plane.negate(this.planes[4],this.planes[5]):(k.plane.copy(this.planes[4],this.planes[5]),k.plane.negate(this.planes[4],
this.planes[4]));this.maxSpan=Math.max(Math.abs(a[0]-a[2]),Math.abs(a[1]-a[3]));this.maxSpanSpatialReference=c};c.prototype.isVisibleInFrustum=function(a,c){void 0===c&&(c=!1);if(null==a)return!1;if("global"===this.renderCoordsHelper.type){if(this.maxSpan>(this.maxSpanSpatialReference.isGeographic?u:v))return!0;if(a.altitude>=z)return this.isVisibleInFrustumGlobal(a)}if(0===this.maxSpan){var b=this.extent[0];return!c&&a.intersectsRay(k.ray.wrap(b.origin,b.direction))?!0:!1}for(var d=0;d<this.extent.length;d++)if(b=
this.extent[d],!c&&a.intersectsRay(k.ray.wrap(b.origin,b.direction))||a.intersectsLineSegment(k.lineSegment.fromPoints(b.origin,b.cap.next,C),b.cap.direction))return!0;c=c?this.planes:this.planesWithoutFar;for(d=0;d<a.lines.length;d++)if(b=a.lines[d],p.frustumLineSegment(c,b.origin,b.endpoint,b.direction))return!0;return!1};c.prototype.toRenderBoundingExtentGlobal=function(a,c,b){d.center(a,q);q[2]=b;t.computeLinearTransformation(c,q,y,this.renderCoordsHelper.spatialReference);h.mat4.invert(A,y);
l.empty(B);for(var e=0,g=w;e<g.length;e++)for(var k=g[e],p=k.x0,r=k.x1,u=k.y0,k=k.y1,v=0;5>v;v++){var z=v/4;q[0]=m.lerp(a[p],a[r],z);q[1]=m.lerp(a[u],a[k],z);q[2]=b;t.vectorToVector(q,c,q,this.renderCoordsHelper.spatialReference);f.vec3.transformMat4(q,q,A);l.expandPointInPlace(B,q)}f.vec3.set(this.extent[0].origin,B[0],B[1],B[2]);f.vec3.set(this.extent[1].origin,B[3],B[1],B[2]);f.vec3.set(this.extent[2].origin,B[3],B[4],B[2]);f.vec3.set(this.extent[3].origin,B[0],B[4],B[2]);for(v=0;4>v;++v)f.vec3.transformMat4(this.extent[v].origin,
this.extent[v].origin,y)};c.prototype.toRenderBoundingExtentLocal=function(a,c){f.vec3.set(this.extent[0].origin,a[0],a[1],c);f.vec3.set(this.extent[1].origin,a[2],a[1],c);f.vec3.set(this.extent[2].origin,a[2],a[3],c);f.vec3.set(this.extent[3].origin,a[0],a[3],c)};c.prototype.toRenderBoundingExtent=function(c,b,d){switch(this.renderCoordsHelper.type){case "global":this.toRenderBoundingExtentGlobal(c,b,d);break;case "local":this.toRenderBoundingExtentLocal(c,d);break;default:a.neverReached(this.renderCoordsHelper.type)}};
c.prototype.isVisibleInFrustumGlobal=function(a){if(0>f.vec3.dot(this.center.direction,a.direction))return!0;for(var c=0;4>c;c++)if(0>f.vec3.dot(this.extent[c].direction,a.direction))return!0;return!1};return c}();b.FrustumExtentIntersection=c;var w=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],q=g.vec3f64.create(),y=e.mat4f64.create(),A=e.mat4f64.create(),B=l.create(),C=k.lineSegment.create();b.default=c})},"esri/views/3d/state/ViewState":function(){define("require exports tslib ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/accessorSupport/watch ../../../core/libs/gl-matrix-2/vec3f64 ../../ViewAnimation ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/earthUtils ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function m(a){a=b.call(this,a)||this;a.propertiesPool=new t.default({camera:u.default},a);a.lastSeenCameraProjectionValues=new u.default;a.events=new h;a._cameraChanged=!1;a.updateQueue=[];a.processingUpdates=!1;return a}a.__extends(m,b);m.prototype.destroy=function(){this.cameraController=null;this.propertiesPool=e.destroyMaybe(this.propertiesPool)};m.prototype.normalizeCtorArgs=function(a){return{camera:this.createInitialCamera(a.viewingMode),
mode:a.viewingMode,spatialReference:a.spatialReference,constraints:new c.default({mode:a.viewingMode})}};Object.defineProperty(m.prototype,"animation",{get:function(){return this.cameraController instanceof k.AnimationController&&e.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"camera",{get:function(){return this._get("camera")},set:function(a){var c=this;a!==v&&v.copyFrom(a);v.markViewDirty();
v.computeUp(this.mode);z.camera=v;this.events.emit("before-camera-change",z);a=this._get("camera");this.cameraProjectionChanged(this.lastSeenCameraProjectionValues,v)&&(this.lastSeenCameraProjectionValues.copyFrom(v),w.camera=this.lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",w));if(!a||!a.equals(v))if(this._set("camera",this.propertiesPool.get("camera").copyFrom(v)),this._cameraChanged=!a||!a.almostEquals(v))var b=g.afterDispatch(function(){c._cameraChanged=!1;b.remove()})},
enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"isLocal",{get:function(){return"local"===this.mode},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"navigating",{get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"stationary",{get:function(){return!this._cameraChanged&&
!this.navigating},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"cameraController",{get:function(){return this._get("cameraController")},set:function(a){var c=this;this.stopActiveCameraController()?(a&&(a.watch("state",function(b){if(b===p.State.Finished||b===p.State.Stopped)c._set("cameraController",null),c.updateCamera(function(c){return a.onControllerEnd(c)})},!0),a.onControllerStart(this.camera)),this._set("cameraController",a)):a&&(a.state=p.State.Rejected)},enumerable:!0,
configurable:!0});m.prototype.switchCameraController=function(a){this.cameraController=a;return a.state!==p.State.Rejected};m.prototype.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};m.prototype.updateCamera=function(a){this.updateQueue.push(a);this.processUpdateQueue()};m.prototype.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var a=this.updateQueue.shift();v.copyFrom(this._get("camera"));
a(v);this.camera=v;this.processingUpdates=!1;this.processUpdateQueue()}};m.prototype.createInitialCamera=function(a){return"global"===a?new u.default(l.vec3f64.fromValues(4*r.earthRadius,0,0),l.vec3f64.fromValues(r.earthRadius,0,0),l.vec3f64.fromValues(0,0,1)):new u.default(l.vec3f64.fromValues(0,0,100),l.vec3f64.fromValues(0,0,0),l.vec3f64.fromValues(0,1,0))};m.prototype.cameraProjectionChanged=function(a,c){return a.fov!==c.fov||a.fullViewport[0]!==c.fullViewport[0]||a.fullViewport[1]!==c.fullViewport[1]||
a.fullViewport[2]!==c.fullViewport[2]||a.fullViewport[3]!==c.fullViewport[3]||a.padding[0]!==c.padding[0]||a.padding[1]!==c.padding[1]||a.padding[2]!==c.padding[2]||a.padding[3]!==c.padding[3]?!0:!1};a.__decorate([f.property({readOnly:!0,type:d,dependsOn:["cameraController"]})],m.prototype,"animation",null);a.__decorate([f.property({type:u.default})],m.prototype,"camera",null);a.__decorate([f.property({constructOnly:!0})],m.prototype,"constraints",void 0);a.__decorate([f.property({readOnly:!0})],
m.prototype,"events",void 0);a.__decorate([f.property({readOnly:!0,dependsOn:["isLocal"]})],m.prototype,"isGlobal",null);a.__decorate([f.property({readOnly:!0,dependsOn:["mode"]})],m.prototype,"isLocal",null);a.__decorate([f.property({constructOnly:!0})],m.prototype,"mode",void 0);a.__decorate([f.property({constructOnly:!0})],m.prototype,"spatialReference",void 0);a.__decorate([f.property({readOnly:!0,dependsOn:["cameraController"]})],m.prototype,"navigating",null);a.__decorate([f.property({readOnly:!0,
dependsOn:["navigating","_cameraChanged"]})],m.prototype,"stationary",null);a.__decorate([f.property()],m.prototype,"_cameraChanged",void 0);a.__decorate([f.property()],m.prototype,"cameraController",null);return m=a.__decorate([f.subclass("esri.views.3d.state.ViewState")],m)}(m);b.ViewState=n;var v=new u.default,z={camera:null},w={camera:null};b.default=n})},"esri/views/3d/support/PropertiesPool":function(){define(["require","exports","../../../core/ReentrantObjectPool","../../../core/accessorSupport/watch"],
function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,f){var e=this;this.owner=f;this.properties={};this.afterDispatchHandle=null;for(var h in b)f=new a.ReentrantObjectPool(b[h],null,null,2,2),this.properties[h]={pool:f,acquired:[]};this.afterDispatchHandle=m.afterDispatch(function(){return e.release()})}b.prototype.destroy=function(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(var a in this.properties){for(var b=
this.properties[a],g=0,h=b.acquired;g<h.length;g++){var d=h[g];m.isValueInUse(d)||b.pool.release(d)}b.pool.destroy();b.pool=null;b.acquired=null}this.owner=this.properties=null};b.prototype.get=function(a){var b=this.owner._get(a);a=this.properties[a];var e=a.pool.acquire();for(a.acquired.push(e);e===b;)a.acquired.push(e),e=a.pool.acquire();return e};b.prototype.release=function(){for(var a in this.properties){for(var b=this.properties[a],g=0,h=0,d=b.acquired;h<d.length;h++){var c=d[h];m.isValueInUse(c)?
b.acquired[g++]=c:b.pool.release(c)}b.acquired.length=g}};return b}();b.PropertiesPool=n;b.default=n})},"esri/views/3d/state/ViewStateManager":function(){define("require exports tslib ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Error ../../../core/Handles ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera ../../animation/easing".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L){Object.defineProperty(b,"__esModule",{value:!0});var M=l.getLogger("esri.views.3d.state.ViewStateManager");n=function(b){function e(a){a=b.call(this,a)||this;a.propertiesPool=new G.default({frustum:C.default},a);a.handles=new g;a.cameraSetByUser=!1;a.internalSetOrder=[];a.immediateGoToController=null;a.animatedGoToController=null;a.ready=!1;a.updateDevicePixelRatio=null;return a}a.__extends(e,b);Object.defineProperty(e.prototype,
"camera",{get:function(){if(!this.ready)return this._get("camera");var a=I.internalToExternal(this.view,this.view.state.camera),c=this._get("camera");return a&&c&&a.equals(c)?c:a},set:function(a){this.updatePropertyBeforeReady("camera",a)||this.setStateCamera(I.externalToInternal(this.view,a),{applyConstraints:!1})||M.error("#camera\x3d","Invalid camera",a)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"center",{get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:
this._get("center")},set:function(a){this.updatePropertyBeforeReady("center",a)||(a?this.isCompatible(a)?this.setStateCamera(this.centerToCamera(a),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.update():M.error("#center\x3d","Invalid center",a):M.error("#center\x3d","Center has an incompatible spatial reference (center: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):M.error("#center\x3d","Center may not be null or undefined"))},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"extent",{get:function(){return this.ready?I.toExtent(this.view,this.view.state.camera,this.view.pointsOfInterest.centerOnContent.renderLocation):this._get("extent")},set:function(a){this.updatePropertyBeforeReady("extent",a)||(a?this.isCompatible(a)?this.setStateCamera(this.extentToCamera(a),{applyConstraints:!0})||M.error("#extent\x3d","Invalid extent",a):M.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+
(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):M.error("#extent\x3d","Extent may not be null or undefined"))},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"frustum",{get:function(){var a=this.propertiesPool.get("frustum");a.renderCoordsHelper=this.view.renderCoordsHelper;a.update(this.view.state.camera);return a},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"hasInitialView",{get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"scale",{get:function(){if(!this.ready)return this._get("scale");var a=this.view.pointsOfInterest.centerOnContent;return I.distanceToScale(this.view,a.distance,a.location.latitude)},set:function(a){this.updatePropertyBeforeReady("scale",a)||this.setStateCamera(this.scaleToCamera(a),{applyConstraints:!0})||M.error("#scale\x3d","Invalid scale",a)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"padding",{get:function(){if(!this.ready)return this._get("padding");
var a=this.view.state.camera,c=a.padding,b=a.pixelRatio,a=this._get("padding"),d=Math.round(c[0]/b),e=Math.round(c[1]/b),f=Math.round(c[2]/b),c=Math.round(c[3]/b);return null!=a&&a.top===d&&a.right===e&&a.bottom===f&&a.left===c?a:{top:d,right:e,bottom:f,left:c}},set:function(a){this.updatePropertyBeforeReady("padding",a)||(this.paddingToArray(a,this.view.state.camera.pixelRatio,U),this.view.state.updateCamera(function(a){return a.padding=U}))},enumerable:!0,configurable:!0});e.prototype.paddingToArray=
function(a,c,b){a?u.vec4.set(b,a.top||0,a.right||0,a.bottom||0,a.left||0):u.vec4.set(b,0,0,0,0);for(a=0;4>a;a++)b[a]=Math.round(b[a]*c)};Object.defineProperty(e.prototype,"screenCenter",{get:function(){var a=this.padding;return p.createScreenPoint((this.view.width-(a.left+a.right))/2+a.left,(this.view.height-(a.top+a.bottom))/2+a.top)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"viewpoint",{get:function(){return this.ready?J.fromCamera(this.view,this.camera):this._get("viewpoint")},
set:function(a){if(!this.updatePropertyBeforeReady("viewpoint",a))if(a)if(this.isCompatible(a))this.setStateCamera(this.viewpointToCamera(a),{applyConstraints:!a.camera})||M.error("#viewpoint\x3d","Invalid viewpoint",a);else{var c=a.camera?a.camera.position:a.targetGeometry,c=c&&c.spatialReference;M.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(c?c.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a)}else M.error("#viewpoint\x3d","Viewpoint may not be null or undefined")},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"zoom",{get:function(){return this.ready?I.scaleToZoom(this.view,this.scale):this._get("zoom")},set:function(a){this.updatePropertyBeforeReady("zoom",a)||this.setStateCamera(this.zoomToCamera(a),{applyConstraints:!0})||M.error("#zoom\x3d","Invalid zoom",a)},enumerable:!0,configurable:!0});e.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch("state.camera",function(c){return a.cameraChangedSync(c)},!0),r.on(this.view,
"state.events","before-camera-change",function(c){return a.updateElevation(c.camera)})]);r.once(this.view,"state.camera",function(c){return a.updateElevation(c)},!0);this.handles.add(k.addFrameTask({prepare:function(){return a.prepareFrame()}}));this.handles.add(this.view.watch("state.cameraController",function(){a.cameraSetByUser=!0;a.handles.remove(P);a.cancelImmediateGoTo()}));this.handles.add(r.on(this.view,"state.events","camera-projection-changed",function(){return a.notifyChange("scale")}))};
e.prototype.destroy=function(){this.deinit();this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};e.prototype.init=function(){var a=this;this.constraintsManager=new B.default({view:this.view});this.prepareFrame();var c=this.getInitialProperties();this.cameraSetByUser=!1;this._set("ready",!0);for(var b=0;b<c.length;b++){var d=c[b];this.set(d.name,d.value)}this.cameraSetByUser||((c=this.view.get("map.initialViewProperties.viewpoint")||
this.view.initialExtent)&&this.isCompatible(c)?this.setInitialView(c):"local"===this.view.state.mode&&this.handles.add(r.whenOnce(this.view.basemapTerrain,"ready",function(){a.handles.remove(P);a.setInitialView(a.view.groundExtent)}),P))};e.prototype.deinit=function(){this.ready&&(this._override("padding",this.padding),this.cancelImmediateGoTo(),this.cancelAnimatedGoTo(),this._set("ready",!1),this._clearOverride("hasInitialView"),this.internalSetOrder.length=0,this.cameraSetByUser=!1,this.handles.remove(P),
this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};e.prototype.goTo=function(c,b){return a.__awaiter(this,void 0,void 0,function(){var d;return a.__generator(this,function(e){d=a.__assign({animate:!0},b);return d.animate?[2,this.goToAnimated(c,d)]:[2,this.goToImmediate(c,d)]})})};e.prototype.debugSetCameraOnContent=function(){this.setStateCamera(A.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};e.prototype.step=function(a){var c=this.view.state,
b=c&&this.view.state.cameraController;b&&(c.updateCamera(function(c){b.stepController(a,c)}),b.steppingFinished&&b.finishController())};e.prototype.cancelImmediateGoTo=function(){var a=this.immediateGoToController;d.isSome(a)&&(this.immediateGoToController=null,a.abort())};e.prototype.cancelAnimatedGoTo=function(){var a=this.animatedGoToController;d.isSome(a)&&(this.animatedGoToController=null,a.abort())};e.prototype.getInitialProperties=function(){for(var a=new Set,c=[],b=0,d=Q;b<d.length;b++){var e=
d[b],f=e.propertyName,e=e.overrides,g=a.has(f),k=this._isOverridden(f);!g&&k&&c.push({name:f,value:this._get(f)});this._clearOverride(f);(g||k)&&e.forEach(function(c){return a.add(c)})}return c};e.prototype.setInitialView=function(a){if(a&&!this.cameraSetByUser)if(a instanceof m)this.setStateCamera(I.externalToInternal(this.view,a),{applyConstraints:!1});else if(a instanceof h)if(a.targetGeometry instanceof z){var c=I.fromExtent(this.view,a.targetGeometry,0,.5,0);this.setStateCamera(I.externalToInternal(this.view,
c),{applyConstraints:!0})}else c={applyConstraints:!a.camera},a=this.viewpointToCamera(a),this.setStateCamera(a,c);else c=I.fromExtent(this.view,a,0,.5,0),this.setStateCamera(I.externalToInternal(this.view,c),{applyConstraints:!0})};e.prototype.updatePropertyBeforeReady=function(a,c){if(!this.ready){this._override(a,c);var b=this.internalSetOrder.indexOf(a);-1!==b&&(this.internalSetOrder=this.internalSetOrder.splice(b,1));c&&(this.internalSetOrder.push(a),-1!==N.indexOf(a)&&this._override("hasInitialView",
!0));return!0}return!1};e.prototype.isCompatible=function(a){return a?a instanceof h?a.camera?this.isCompatible(a.camera):this.isCompatible(a.targetGeometry):a instanceof m?this.isCompatible(a.position):a.spatialReference&&q.canProject(a.spatialReference,this.view.spatialReference):!1};e.prototype.getPreservingHeadingTilt=function(a){void 0===a&&(a=R);this.cameraSetByUser?(a.heading=this.camera.heading,a.tilt=this.camera.tilt):(a.heading=0,a.tilt=.5);return a};e.prototype.centerPointAtDistanceToCamera=
function(a,c,b){void 0===b&&(b=O);var d=this.getPreservingHeadingTilt();return(a=I.getObserverForPointAtDistance(this.view,d.heading,d.tilt,a,c,1))?(b.copyFrom(this.view.state.camera),b.eye=a.eye,b.center=a.center,b.up=a.up,b):null};e.prototype.centerToCamera=function(a){var c=this.view.pointsOfInterest.centerOnContent;c.update();return this.centerPointAtDistanceToCamera(a,c.distance)};e.prototype.extentToCamera=function(a){var c=this.getPreservingHeadingTilt();a=I.fromExtent(this.view,a,c.heading,
c.tilt,1,W);return I.externalToInternal(this.view,a)};e.prototype.scaleToCamera=function(a){if(null==a)return null;var c=this.view.pointsOfInterest.centerOnContent;c.update();var b=c.renderLocation;a=I.scaleToDistance(this.view,a,c.location.latitude);return this.centerPointAtDistanceToCamera(b,a)};e.prototype.zoomToCamera=function(a){return this.scaleToCamera(I.zoomToScale(this.view,a))};e.prototype.viewpointToCamera=function(a){return(a=J.toCamera(this.view,a))?I.externalToInternal(this.view,a):
null};e.prototype.setStateCamera=function(a,c){var b=this;if(!a||!this.view.state.stopActiveCameraController())return!1;this.cameraSetByUser=!0;this.cancelImmediateGoTo();this.view.state.updateCamera(function(d){c.positionAndOrientationOnly?(d.eye=a.eye,d.center=a.center,d.up=a.up):d.copyFrom(a);c.applyConstraints&&y.applyAll(b.view,d)});c.applyConstraints||(this.view.state.cameraController=new H.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:a}));return!0};e.prototype.prepareFrame=
function(){var a=this.view,c=a.container,b=a.canvas;if(c&&b){d.isSome(this.updateDevicePixelRatio)&&this.updateDevicePixelRatio();var a=this.view.pixelRatio,e=Math.round(c.clientWidth*a),c=Math.round(c.clientHeight*a);if(0!==e&&0!==c){if(b.width!==e||b.height!==c)b.width=e,b.height=c;this.view.state&&(b=this.view.state.camera,b.fullWidth!==e||b.fullHeight!==c||b.pixelRatio!==a)&&(O.copyFrom(b),O.pixelRatio!==a&&(this.paddingToArray(this.padding,a,U),O.padding=U),O.fullWidth=e,O.fullHeight=c,O.pixelRatio=
a,this.view.state.camera=O)}}};e.prototype.updateElevation=function(a){var c=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,b=this.view.renderCoordsHelper.getAltitude(a.eye),c=c?A.surfaceElevationBelowEye(this.view,a):0;a.relativeElevation=b-c};e.prototype.cameraChangedSync=function(a){a&&this.view._stage&&this.view._stage.setCamera(a)};e.prototype.createGoToCamera=function(b,d){return a.__awaiter(this,void 0,void 0,function(){var e,g,k,l,p,q,t,u;return a.__generator(this,function(a){switch(a.label){case 0:return[4,
r.whenOnce(this,"ready",d.signal,!0)];case 1:return a.sent(),c.throwIfAborted(d),[4,J.create(this.view,b,d.signal)];case 2:e=a.sent();g=!!(b instanceof h&&b.camera||b instanceof m);k=e.camera;if(!this.isCompatible(k))throw q=(p=(l=k.position)&&l.spatialReference)?p.wkid:"none",t=this.view.spatialReference.wkid,new f("goto:incompatible-spatialreference","Resulting camera has an incompatible spatial reference (camera: "+q+", view: "+t+")",{camera:k});u=I.externalToInternal(this.view,k);if(!u)throw new f("goto:invalid-camera",
"Resulting camera is invalid");return[2,{viewpoint:e,camera:u,isFullySpecified:g}]}})})};e.prototype.cancellableGoTo=function(a,b){var d=this,e;return c.create(function(f,g){e={resolve:f,reject:g};a.asyncResult=e;c.onAbort(b,function(){d.view.state.cameraController===a&&a.active&&a.asyncResult===e&&a.stopController()})})};e.prototype.goToImmediate=function(b,d){return a.__awaiter(this,void 0,void 0,function(){var e,g,k,h=this;return a.__generator(this,function(l){this.cancelAnimatedGoTo();this.cancelImmediateGoTo();
e=c.createAbortController();c.onAbort(d,function(){return e.abort()});g=this.createGoToCamera(b,a.__assign(a.__assign({},d),{signal:e.signal}));k=function(){h.immediateGoToController===e&&(h.immediateGoToController=null)};this.immediateGoToController=e;return[2,g.then(function(a){k();h.setStateCamera(a.camera,{applyConstraints:!a.isFullySpecified,positionAndOrientationOnly:!0})}).catch(function(a){k();!c.isAbortError(a)&&a instanceof f&&a.message&&M.error("#goTo()","Failed to create camera from target, "+
a.message[0].toLowerCase()+a.message.slice(1));throw a;})]})})};e.prototype.goToAnimatedBeforeReady=function(b,d){return a.__awaiter(this,void 0,void 0,function(){var e;return a.__generator(this,function(f){switch(f.label){case 0:return this.cancelAnimatedGoTo(),e=c.createAbortController(),c.onAbort(d,function(){return e.abort()}),this.animatedGoToController=e,d=a.__assign(a.__assign({},d),{signal:e.signal}),[4,r.whenOnce(this.view,"ready",e.signal)];case 1:return f.sent(),this.animatedGoToController=
null,[2,this.goToAnimated(b,d)]}})})};e.prototype.goToAnimated=function(b,e){return a.__awaiter(this,void 0,void 0,function(){var g,k,h,l,m,p,q=this;return a.__generator(this,function(r){this.cancelAnimatedGoTo();if(!this.ready)return[2,this.goToAnimatedBeforeReady(b,e)];g=this.view.state.cameraController;g instanceof F.PointToPointAnimationController&&(g.updateStateFromViewAnimation(),g.active&&(k=g));null==k&&(k=new F.PointToPointAnimationController({view:this.view,mode:"animation"}));h=k.viewAnimation;
if(d.isNone(h))return M.warn("Unreachable code in ViewStateManager"),[2];l=this.createGoToCamera(b,e);h.update(l.then(function(a){return a.viewpoint}));if(k!==g&&!this.view.state.switchCameraController(k))return h.stop(),M.error("#goTo()","Cannot start an animation while interacting"),[2,c.reject(new f("view:goto-cannot-interrupt","Cannot start an animation while interacting"))];m=h.target;p=function(){return q.view.state.cameraController===k&&d.isSome(k.viewAnimation)&&k.viewAnimation.target===m&&
k.active};l.then(function(c){var b=c.viewpoint,f=c.camera,g=c.isFullySpecified;return a.__awaiter(q,void 0,void 0,function(){var c,l,q=this;return a.__generator(this,function(a){switch(a.label){case 0:if(!p())return[2];d.isSome(k.viewAnimation)&&(k.viewAnimation.update(b),m=k.viewAnimation.target);g?(c=new H.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:f}),y.applySurfaceCollisionConstraint(this.view,f,1)):y.applyAll(this.view,f);k.begin(f,this.internalAnimateOptions(e));l=function(){var a=
q.view.state.cameraController;c&&(a&&a.active?a instanceof F.PointToPointAnimationController&&d.isSome(a.viewAnimation)&&a.viewAnimation.target===m&&(q.view.state.cameraController=c):d.isSome(k.viewAnimation)&&k.viewAnimation.target===m&&"finished"===k.state&&(q.view.state.cameraController=c))};return[4,h.when(l,l)];case 1:return a.sent(),[2]}})})}).catch(function(a){!c.isAbortError(a)&&a instanceof f&&a.message&&M.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+
a.message.slice(1));if(p())throw q.view.state.cameraController.stopController(),a;});return[2,this.cancellableGoTo(k,e)]})})};e.prototype.internalAnimateOptions=function(a){var c={};a&&(null!=a.speedFactor&&(c.speedFactor=a.speedFactor),null!=a.duration&&(c.duration=a.duration/1E3),null!=a.maxDuration&&(c.maxDuration=a.maxDuration/1E3),null!=a.easing&&(c.easing="string"===typeof a.easing?L.named[a.easing]:a.easing));return c};a.__decorate([t.property({type:m,dependsOn:["view.state.camera","ready"]})],
e.prototype,"camera",null);a.__decorate([t.property({type:w,dependsOn:["view.pointsOfInterest.centerOnContent.location","ready"]})],e.prototype,"center",null);a.__decorate([t.property({type:z,dependsOn:["view.state.camera","ready","view.pointsOfInterest.centerOnContent.location"]})],e.prototype,"extent",null);a.__decorate([t.property({readOnly:!0,dependsOn:["view.state.camera","ready"]})],e.prototype,"frustum",null);a.__decorate([t.property({readOnly:!0,dependsOn:["view.map.initialViewProperties?.viewpoint"]})],
e.prototype,"hasInitialView",null);a.__decorate([t.property({readOnly:!0,type:Boolean})],e.prototype,"ready",void 0);a.__decorate([t.property({dependsOn:["view.pointsOfInterest.centerOnContent.distance","ready"],type:Number})],e.prototype,"scale",null);a.__decorate([t.property({dependsOn:["view.state.camera","ready"]})],e.prototype,"padding",null);a.__decorate([t.property({readOnly:!0,dependsOn:["view.width","view.height","padding"]})],e.prototype,"screenCenter",null);a.__decorate([t.property({constructOnly:!0})],
e.prototype,"view",void 0);a.__decorate([t.property({type:h,dependsOn:["camera","ready"]})],e.prototype,"viewpoint",null);a.__decorate([t.property({type:Number,dependsOn:["scale"]})],e.prototype,"zoom",null);a.__decorate([t.property({constructOnly:!0})],e.prototype,"updateDevicePixelRatio",void 0);return e=a.__decorate([t.subclass("esri.views.3d.state.ViewStateManager")],e)}(e);b.ViewStateManager=n;var N="camera viewpoint extent scale center zoom".split(" "),Q=[{propertyName:"camera",overrides:["viewpoint"]},
{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],R={heading:0,tilt:0},W=new m,O=new E.default,U=v.vec4f64.create(),P="pending-initial-view";b.default=n})},"esri/views/3d/state/ConstraintsManager":function(){define("require exports tslib ../../../core/Accessor ../../../core/Handles ../../../core/mathUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function m(a){var d=b.call(this,a)||this;d.handles=new h;d.nearFarHeuristic=c.createNearFarHeuristic(a.view.state.mode,a.view.basemapTerrain,a.view.renderCoordsHelper.spatialReference);return d}a.__extends(m,b);m.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],function(){return a.handleClipDistanceNearFarChanged()}),
this.view.watch("constraints.clipDistance.mode",function(){return a.handleClipDistanceModeChanged()}),this.view.state.events.on("before-camera-change",function(c){return a.cameraUpdateNearFar(c.camera)}),this.view.watch("dataExtent",function(){return a.updateNearFar()},!0)]);this.handles.add([this.view.watch(["constraints.altitude.min","constraints.altitude.max"],function(){return a.handleAltitudeMinMaxChanged()},!0)]);this.handles.add([this.view.watch("constraints.tilt.max",function(){return a.handleTiltMaxChanged()},
!0),this.view.watch("constraints.tilt.mode",function(){return a.handleTiltModeChanged()},!0),this.view.watch("state.camera",function(){return a.tiltAutoUpdateMax()},!0)]);this.handles.add(this.view.watch(["map.ground.navigationConstraint.type","constraints.collision.enabled"],function(){return a.updateCollision()},!0));this.view.state.isLocal&&this.handles.add(f.init(this.view,"dataExtent",function(c){return a.updateLocalSurfaceDistance(c)}));this.updateNearFar();"local"!==this.view.state.mode&&this.updateAltitude();
this.updateTilt();this.updateCollision();this._set("surfaceCollisionConstraint",new k.default({view:this.view}))};m.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))};m.prototype.handleClipDistanceNearFarChanged=function(){var a=this,c=this.view.constraints&&this.view.constraints.clipDistance;c&&"auto"!==c.mode&&this.view.state.updateCamera(function(b){a.cameraUpdateNearFarManual(b,
c);return!0})};m.prototype.handleClipDistanceModeChanged=function(){this.updateNearFar()};m.prototype.updateNearFar=function(){var a=this;this.view.state.updateCamera(function(c){a.cameraUpdateNearFar(c);return!0})};m.prototype.cameraUpdateNearFar=function(a){var c=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(c?c.mode:"auto")?this.cameraUpdateNearFarManual(a,c):this.cameraUpdateNearFarAuto(a,c)};m.prototype.cameraUpdateNearFarAuto=function(a,c){this.nearFarHeuristic.compute(a.eye,
a.center,this.view.dataExtent,d.surfaceElevationBelowEye(this.view,a),a);c&&c.autoUpdate(a.near,a.far)};m.prototype.cameraUpdateNearFarManual=function(a,c){c&&(a.near=c.near,a.far=c.far)};m.prototype.updateCollision=function(){var a=this.view.map&&this.view.map.ground&&this.view.map.ground.navigationConstraint,c=this.view.constraints&&this.view.constraints.collision.enabled,a=a?"stay-above"===a.type:c,c=this.view.state.constraints.collision;a!==c.enabled&&((c.enabled=a)&&this.reapplyConstraints(8),
(a=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==a.mode||this.updateTiltAuto())};m.prototype.handleAltitudeMinMaxChanged=function(){this.updateAltitude()};m.prototype.updateAltitude=function(){var a=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=a&&"local"!==this.view.state.mode?{min:a.min,max:a.max}:null;this.reapplyConstraints()};m.prototype.handleTiltModeChanged=function(){this.updateTilt()};m.prototype.handleTiltMaxChanged=function(){var a=
this.view.constraints&&this.view.constraints.tilt;a&&"auto"!==a.mode&&(this.updateTiltManual(a),this.reapplyConstraints())};m.prototype.updateTilt=function(){var a=this.view.constraints&&this.view.constraints.tilt;"manual"===(a?a.mode:"auto")?this.updateTiltManual(a):this.updateTiltAuto();this.reapplyConstraints()};m.prototype.updateTiltManual=function(a){var c=this.view.state.constraints;c.tilt=c.createConstantMaxTilt(e.deg2rad(a.max))};m.prototype.updateTiltAuto=function(){var a=this.view.state.constraints;
a.tilt=a.createDefaultTilt();this.tiltAutoUpdateMax()};m.prototype.tiltAutoUpdateMax=function(){var a=this.view.constraints&&this.view.constraints.tilt;if(a&&"auto"===a.mode){var c=this.view.state.constraints;c.tilt&&(c=c.tilt(this.view.state.camera.distance).max,a.autoUpdate(e.rad2deg(c)))}};m.prototype.updateLocalSurfaceDistance=function(a){var c=Math.max(a.width,a.height);0>=c||(a.hasZ&&(c=Math.max(c,a.zmax-a.zmin)),a=this.view.state,c=3*c/Math.atan(a.camera.fov/2),c!==a.constraints.distance&&
(a.constraints.distance=c))};m.prototype.reapplyConstraints=function(a){var c=this;void 0===a&&(a=15);this.view.state.updateCamera(function(b){return l.applyAll(c.view,b,{selection:a,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:0})})};a.__decorate([g.property({constructOnly:!0})],m.prototype,"view",void 0);a.__decorate([g.property({readOnly:!0})],m.prototype,"surfaceCollisionConstraint",void 0);return m=a.__decorate([g.subclass("esri.views.3d.state.ConstraintsManager")],
m)}(m);b.ConstraintsManager=n;b.default=n})},"esri/views/3d/state/NearFarHeuristic":function(){define("require exports ../../../core/mathUtils ../../../core/mathUtils ../../../core/unitUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/earthUtils".split(" "),function(n,b,a,m,h,e,f,g){function l(a,c,b,d){b=p/b;a/c>b?(d.far=a,d.near=d.far/c):(d.near=b,d.far=d.near*c);return d}Object.defineProperty(b,"__esModule",{value:!0});b.createNearFarHeuristic=function(a,
b,e){return"global"===a?new c:new d(b,e)};var d=function(){function c(a,c){this.elevationProvider=a;this.unitInMeters=h.getMetersPerUnitForSR(c)}c.prototype.compute=function(c,b,d,f,h){h||(h={near:0,far:0});var p=c[2]*this.unitInMeters,q=p;f=p-f;var w=this.elevationProvider?this.elevationProvider.elevationBounds:null;w&&(p=0<=f?q-this.unitInMeters*w.min:this.unitInMeters*w.max-q);q=Math.max(d.xmax-d.xmin,d.ymax-d.ymin,4*Math.max(d.xmax-d.xmin,d.ymax-d.ymin));e.vec3.subtract(v,b,c);u[0]=0<v[0]?d.xmax:
d.xmin;u[1]=0<v[1]?d.ymax:d.ymin;u[2]=0<v[2]?q/2:-q/2;e.vec3.subtract(u,u,c);e.vec3.normalize(v,v);c=1.1*e.vec3.dot(u,v)*this.unitInMeters;b=Math.sqrt(p*(p+2*g.earthRadius));d=Math.max(d.xmax-d.xmin,d.ymax-d.ymin);w=d*t*this.unitInMeters;p=a.clamp((p-w)/(d*r*this.unitInMeters-w),0,1);p=m.lerp(b,c,p*p*p);p*=Math.max(Math.log(Math.abs(f)),1);p=Math.min(p,Math.max(34064E4,q));p/=this.unitInMeters;return l(p,k,this.unitInMeters,h)};return c}(),c=function(){function c(){}c.prototype.compute=function(c,
b,d,f,k){k||(k={near:0,far:0});c=e.vec3.length(c)-g.earthRadius;c=Math.max(Math.abs(c-f),Math.abs(c));f=Math.sqrt(c*(c+2*(g.earthRadius+Math.min(0,f))));c=a.clamp(2E4-(Math.log(c)-7.983)/9.011*19E3,1E3,2E4);return l(1.2*f,c,1,k)};return c}(),k=2E4,p=2,r=.001,t=1E-4,u=f.vec3f64.create(),v=f.vec3f64.create()})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("require exports tslib ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils".split(" "),
function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a){a=b.call(this,a)||this;a.handles=new h;return a}a.__extends(d,b);d.prototype.initialize=function(){var a=this;this.handles.add(this.view.basemapTerrain.on("elevation-change",function(c){return a.handleElevationChangeEvent(c)}))};d.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};d.prototype.handleElevationChangeEvent=function(a){this.view.state.cameraController||
g.eyeWithinExtent(this.view,this.view.state.camera,a.extent,a.spatialReference)&&this.applyToCurrentCamera()};d.prototype.applyToCurrentCamera=function(){var a=this;this.view.state.updateCamera(function(c){f.applySurfaceCollisionConstraint(a.view,c,1)})};a.__decorate([e.property({constructOnly:!0})],d.prototype,"view",void 0);return d=a.__decorate([e.subclass("esri.views.3d.state.ElevationCollisionConstraint")],d)}(m);b.SurfaceCollisionConstraint=n;b.default=n})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("require exports tslib ../../../../core/Handles ../../../../core/accessorSupport/decorators ../../camera/constraintUtils ../../camera/intersectionUtils ./CameraController".split(" "),
function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a){a=b.call(this,a)||this;a.handles=new m;return a}a.__extends(d,b);Object.defineProperty(d.prototype,"desiredCamera",{set:function(a){this._set("desiredCamera",a.clone())},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"constraintEnabled",{get:function(){return this.view.state.constraints.collision.enabled},
enumerable:!0,configurable:!0});d.prototype.onControllerStart=function(){var a=this;this.state=g.State.Running;this.handles.add(this.view.basemapTerrain.on("elevation-change",function(c){return a.handleElevationChangeEvent(c)}));this.applyCorrection()};d.prototype.onControllerEnd=function(){this.handles.removeAll()};d.prototype.stepController=function(){};d.prototype.handleElevationChangeEvent=function(a){f.eyeWithinExtent(this.view,this.desiredCamera,a.extent,a.spatialReference)&&this.applyCorrection()};
d.prototype.applyCorrection=function(){var a=this;this.view.state.updateCamera(function(c){c.copyViewFrom(a.desiredCamera);e.applySurfaceCollisionConstraint(a.view,c,1)||a.constraintEnabled||(a.state=g.State.Stopped)})};a.__decorate([h.property({constructOnly:!0})],d.prototype,"view",void 0);a.__decorate([h.property({constructOnly:!0})],d.prototype,"desiredCamera",null);return d=a.__decorate([h.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],d)}(g.CameraController);
b.SurfaceCollisionCorrectionController=n})},"esri/views/3d/support/viewpointUtils":function(){define("require exports tslib ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/asyncUtils ../../../core/compilerUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtils ./ElevationProvider ./geometryUtils ./mathUtils ./projectionUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H){function I(a){return 360-F.cyclicalDeg.normalize(a)}function G(a){return F.cyclicalDeg.normalize(360-a)}function J(a,c){a&&a.resolver&&(null==c?a.resolver.reject():a.resolver.resolve(c));return c}function E(a,c,b,d){if(!c)return J(d);var e=a.spatialReference||h.SpatialReference.WGS84;if(c.camera){a=c.get("camera.position.spatialReference");if(!q.canProject(a,e))return J(d);c=c.camera.clone();a.equals(e)||(c.position=q.project(c.position,
e));return J(d,c)}var f=c.get("targetGeometry.spatialReference");if(f&&!q.canProject(f,e))return J(d);e=A.internalToExternal(a,a.state.camera);f=1;null!=c.rotation&&(e.heading=I(c.rotation),f=0);null!=b&&(e.tilt=b);if("point"===c.targetGeometry.type){b=c.targetGeometry;var g=void 0,k=c.targetGeometry.clone(),g=null!=c.scale?A.scaleToDistance(a,c.scale,b.latitude):a.state.camera.distance;return A.fromCenterDistance(a,k,g,e,f,d)}return A.fromExtent(a,c.targetGeometry.extent,e.heading,e.tilt,f,d)}function L(a,
c){return null==c.scale&&null!=c.zoom?A.zoomToScale(a,c.zoom):c.scale}function M(a,c){var b=!1;null!=c.heading?(a.heading=c.heading,b=!0):null!=c.rotation&&(a.heading=I(c.rotation),b=!0);null!=c.tilt&&(a.tilt=c.tilt,b=!0);null!=c.fov&&(a.fov=c.fov);return b}function N(a,c,b){var d=a.spatialReference||h.SpatialReference.WGS84;c=c||A.externalToInternal(a,b.camera);b.targetGeometry=H.vectorToPoint(c.center,a.renderSpatialReference,d);b.scale=A.computeScale(a,c);b.rotation=G(b.camera.heading);return b}
function Q(a,c,b){if(c){if(!q.canProject(c.spatialReference,a.spatialReference))throw new d("viewpointutils:incompatible-spatialreference","Spatial reference ("+(c.spatialReference?c.spatialReference.wkid:"unknown")+") is incompatible with the view ("+a.spatialReference.wkid+")",{geometry:c});var e=[];if(!c.hasZ&&a.basemapTerrain){var f=void 0;switch(c.type){case "point":f=c;break;case "multipoint":case "polyline":case "mesh":f=c.extent.center;break;case "extent":f=c.center;break;case "polygon":f=
c.centroid;break;default:l.neverReached(c)}f&&q.canProject(f,a.basemapTerrain.spatialReference)?Y[2]=B.getElevationAtPoint(a.elevationProvider,f)||0:Y[2]=0}(0,na[c.type])(c,function(a){e.push(a[0],a[1],a[2])},Y);var g=e.length/3;if(0!==g&&(f=Array(e.length),H.bufferToBuffer(e,c.spatialReference,0,f,a.spatialReference,0,g)))for(c.hasZ&&(b.hasZ=!0),a=0;a<f.length;a+=3)c.hasZ?(Y[0]=f[a+0],Y[1]=f[a+1],Y[2]=f[a+2]):(Y[0]=f[a+0],Y[1]=f[a+1]),z.expand(b.boundingBox,Y)}}function R(b,d,e,f){return a.__awaiter(this,
void 0,void 0,function(){var k,h,l,m,p,q;return a.__generator(this,function(a){switch(a.label){case 0:return[4,g.result(b.whenViewForGraphic(d))];case 1:k=a.sent();if(!1===k.ok||c.isNone(k.value)||!("whenGraphicBounds"in k.value))return Q(b,d.geometry,f),[2];h=k.value;return[4,g.result(h.whenGraphicBounds(d,{minDemResolution:e}))];case 2:l=a.sent();if(!1===l.ok)return Q(b,d.geometry,f),[2];m=l.value;p=m.screenSpaceObjects;q=m.boundingBox;z.expand(f.boundingBox,q);p&&p.forEach(function(a){f.screenSpaceObjects.push(a)});
isFinite(q[2])&&(f.hasZ=!0);return[2]}})})}function W(c,b,d,f){return a.__awaiter(this,void 0,void 0,function(){var g,l;return a.__generator(this,function(a){switch(a.label){case 0:return Array.isArray(b)&&2===b.length&&(g=b[0],l=b[1],"number"===typeof g&&"number"===typeof l)?(aa.x=g,aa.y=l,aa.z=void 0,aa.spatialReference=c.spatialReference.isGeographic?c.spatialReference:h.SpatialReference.WGS84,Q(c,aa,f),[2]):b&&"function"===typeof b.map?[4,k.eachAlways(b.map(function(a){return W(c,a,d,f)}))]:[3,
2];case 1:return a.sent(),[2];case 2:if(!(b instanceof h.BaseGeometry))return[3,3];Q(c,b,f);return[3,5];case 3:return b instanceof e?[4,R(c,b,d,f)]:[3,5];case 4:a.sent(),a.label=5;case 5:return[2]}})})}function O(c,b,d,e,f){return a.__awaiter(this,void 0,void 0,function(){var g,k,h;return a.__generator(this,function(a){switch(a.label){case 0:if(b.camera)return[2,U(c,b.camera,f)];f.scale=b.scale;f.rotation=b.rotation;f.targetGeometry=b.targetGeometry?b.targetGeometry.clone():null;f.camera=null;null!=
d.heading?f.rotation=G(d.heading):null!=d.rotation&&(f.rotation=d.rotation);g=L(c,d);null!=g&&(f.scale=g);k=A.createAsyncContext(e);E(c,f,d.tilt,k);h=f;return[4,k.resolver.promise];case 1:return h.camera=a.sent(),[2,f]}})})}function U(a,c,b){b.camera=c.clone();b.camera.fov=a.camera.fov;c=a.spatialReference;var d=b.camera.position.spatialReference;if(!q.canProject(d,c))return null;d.equals(c)||(b.camera.position=q.project(b.camera.position,c));return N(a,null,b)}function P(c,b,e,f,g){return a.__awaiter(this,
void 0,void 0,function(){var k,l,m,p,q,r;return a.__generator(this,function(a){switch(a.label){case 0:if(!e)throw new d("createfromcenter","invalid point");g.targetGeometry=e.clone();k=y.cameraOnContentAlongViewDirection(c);if(b.position){a=g.targetGeometry;var t=k,w=c.renderSpatialReference;H.pointToVector(b.position,ia,w);H.pointToVector(a,Z,w);g.targetGeometry=new h.Point(a);g.camera.position=new h.Point(b.position);u.vec3.subtract(la,Z,ia);A.directionToHeadingTilt(c,ia,la,t.up,g.camera);g.scale=
A.distanceToScale(c,u.vec3.distance(ia,Z),g.targetGeometry.latitude);g.rotation=G(g.camera.heading);return[2,g]}b.zoomFactor&&(l=k.distance/b.zoomFactor,m=u.vec3.scale(Y,k.viewForward,-l),u.vec3.add(k.eye,k.center,m),k.markViewDirty(),g.scale=A.distanceToScale(c,l,e.latitude));A.internalToExternal(c,k,g.camera);p=M(g.camera,b)?0:1;if(b.zoomFactor)return[3,2];g.scale=L(c,b);null==g.scale&&(H.pointToVector(e,Y,c.renderSpatialReference),C.frustum.intersectsPoint(k.frustum.planes,Y)?g.scale=A.distanceToScale(c,
u.vec3.distance(k.eye,Y),e.latitude):g.scale=A.computeScale(c,k));q=A.createAsyncContext(f);A.fromCenterScale(c,g.targetGeometry,g.scale,g.camera,p,q);r=g;return[4,q.resolver.promise];case 1:r.camera=a.sent(),a.label=2;case 2:return[2,g]}})})}function ba(c,b,d,e){return a.__awaiter(this,void 0,void 0,function(){var f,g;return a.__generator(this,function(a){f=y.cameraOnContentAlongViewDirection(c);g=H.vectorToPoint(f.center,c.renderSpatialReference,aa,c.spatialReference);return[2,P(c,b,g,d,e)]})})}
function V(c,b,d,e,f){return a.__awaiter(this,void 0,void 0,function(){var g,k,h,l;return a.__generator(this,function(a){switch(a.label){case 0:return f.targetGeometry=d.clone(),g=y.cameraOnContentAlongViewDirection(c),A.internalToExternal(c,g,f.camera),k=M(f.camera,b)?0:1,h=A.createAsyncContext(e),A.fromExtent(c,d,f.camera.heading,f.camera.tilt,k,h),l=f,[4,h.resolver.promise];case 1:return l.camera=a.sent(),[2,f]}})})}function T(c,b,d,e,f,g,k){return a.__awaiter(this,void 0,void 0,function(){var h,
l,m,q,r;return a.__generator(this,function(a){switch(a.label){case 0:k.targetGeometry=d.clone();a=h=y.cameraOnContentAlongViewDirection(c);var t=0;d.hasZ?t=d.z:c.basemapTerrain&&(t=B.getElevationAtPoint(c.elevationProvider,d));u.vec3.set(Y,d.x,d.y,t);H.computeLinearTransformation(c.spatialReference,Y,da,c.renderSpatialReference);p.mat3.fromMat4(fa,da);p.mat3.transpose(fa,fa);z.empty(ga);for(var w=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],v=0;v<w.length;v++){var n=w[v],C=e[n[2]];
isFinite(C)||(C=t);u.vec3.set(Y,e[n[0]],e[n[1]],C);H.vectorToVector(Y,c.spatialReference,Y,c.renderSpatialReference);z.expand(ga,u.vec3.transformMat3(Y,Y,fa))}t=z.width(ga);w=z.height(ga);v=z.depth(ga);n=1/Math.tan(a.fovY/2);l=Math.max(.5*Math.sqrt(t*t+v*v)*Math.max(n,1/Math.tan(a.fovX/2))+.5*w,.5*w*n+.5*Math.max(t,v))/f;A.internalToExternal(c,h,k.camera);m=M(k.camera,b)?0:1;k.scale=A.distanceToScale(c,l,k.targetGeometry.latitude);q=A.createAsyncContext(g);A.fromCenterScale(c,k.targetGeometry,k.scale,
k.camera,m,q);r=k;return[4,q.resolver.promise];case 1:return r.camera=a.sent(),[2,k]}})})}function X(a){a&&(a.rotation=G(a.camera.heading));return a}Object.defineProperty(b,"__esModule",{value:!0});b.DEFAULT_FRAME_COVERAGE=.66;b.rotationToHeading=I;b.headingToRotation=G;b.toCamera=E;b.fromInternalCamera=function(a,c,b){b||(b=new f({camera:new m}));A.internalToExternal(a,c,b.camera);return N(a,c,b)};b.fromCamera=function(a,c,b){b||(b=new f);b.camera=c.clone();return N(a,null,b)};b.create=function(c,
e,g){return a.__awaiter(this,void 0,void 0,function(){var k,l,p,q,r,t,v,n,B,C,E,H,F;return a.__generator(this,function(a){switch(a.label){case 0:if(e&&c.spatialReference){a={target:null};if("declaredClass"in e||Array.isArray(e))a.target=e;else{for(var G in e)a[G]=e[G];e.center&&!a.target&&(a.target=e.center)}k=a}else k=null;if(!k)throw new d("viewpointutils-create:no-target","Missing target for creating viewpoint");l=new f({camera:new m({fov:c.camera.fov})});return k.target instanceof f?[4,O(c,k.target,
k,g,l)]:[3,2];case 1:return p=a.sent(),[2,X(p)];case 2:if(k.target instanceof m)return[2,X(U(c,k.target,l))];q=null!=k.scale||null!=k.zoom;if(!(k.target instanceof h.Extent))return[3,6];r=k.target.xmin===k.target.xmax||k.target.ymin===k.target.ymax;if(!q&&!r)return[3,4];t=X;return[4,P(c,k,k.target.center,g,l)];case 3:return[2,t.apply(void 0,[a.sent()])];case 4:return v=X,[4,V(c,k,k.target,g,l)];case 5:return[2,v.apply(void 0,[a.sent()])];case 6:return n={boundingBox:z.empty(),hasZ:!1,screenSpaceObjects:[]},
B=q?A.scaleToResolution(c,L(c,k)):void 0,[4,W(c,k.target,B,n)];case 7:a.sent();if(!isFinite(n.boundingBox[0]))return[3,11];z.center(n.boundingBox,Y);aa.x=Y[0];aa.y=Y[1];aa.z=Y[2];aa.spatialReference=c.spatialReference;r=void 0;isFinite(aa.z)&&n.hasZ?r=z.isPoint(n.boundingBox):(aa.z=void 0,r=w.isPoint(z.toRect(n.boundingBox,ka)));if(!q&&!r)return[3,9];C=X;return[4,P(c,k,aa,g,l)];case 8:return[2,C.apply(void 0,[a.sent()])];case 9:G=n.screenSpaceObjects;a=b.DEFAULT_FRAME_COVERAGE;if(G.length){for(var I=
Number.NEGATIVE_INFINITY,J=0;J<G.length;J++)var x=G[J].screenSpaceBoundingRect,I=Math.max(I,Math.abs(x[0]),Math.abs(x[1]),Math.abs(x[2]),Math.abs(x[3]));E=a-I/Math.min(c.width,c.height)*2}else E=a;H=X;return[4,T(c,k,aa,n.boundingBox,E,g,l)];case 10:return[2,H.apply(void 0,[a.sent()])];case 11:if(k.position)return G=k,a=l,I=y.cameraOnContentAlongViewDirection(c),u.vec3.copy(la,I.viewForward),A.directionToHeadingTilt(c,I.eye,la,I.up,oa),a.camera.position=new h.Point(G.position),a.camera.heading=null!=
G.heading?G.heading:oa.heading,a.camera.tilt=null!=G.tilt?G.tilt:oa.tilt,G=N(c,null,a),[2,X(G)];F=X;return[4,ba(c,k,g,l)];case 12:return[2,F.apply(void 0,[a.sent()])]}})})};var Y=v.vec3f64.create(),da=t.mat4f64.create(),fa=r.mat3f64.create(),ga=z.create(),ka=w.create(),la=v.vec3f64.create(),ia=v.vec3f64.create(),Z=v.vec3f64.create(),oa={heading:0,tilt:0},aa=new h.Point,na={point:function(a,c,b){b[0]=a.x;b[1]=a.y;a.hasZ&&(b[2]=a.z);c(b)},polygon:function(a,c,b){for(var d=a.hasZ,e=0;e<a.rings.length;e++)for(var f=
a.rings[e],g=0;g<f.length;g++)b[0]=f[g][0],b[1]=f[g][1],d&&(b[2]=f[g][2]),c(b)},polyline:function(a,c,b){for(var d=a.hasZ,e=0;e<a.paths.length;e++)for(var f=a.paths[e],g=0;g<f.length;g++)b[0]=f[g][0],b[1]=f[g][1],d&&(b[2]=f[g][2]),c(b)},multipoint:function(a,c,b){var d=a.points;a=a.hasZ;for(var e=0;e<d.length;e++)b[0]=d[e][0],b[1]=d[e][1],a&&(b[2]=d[e][2]),c(b)},extent:function(a,c,b){a.hasZ?(c(u.vec3.set(b,a.xmin,a.ymin,a.zmin)),c(u.vec3.set(b,a.xmax,a.ymin,a.zmin)),c(u.vec3.set(b,a.xmin,a.ymax,
a.zmin)),c(u.vec3.set(b,a.xmax,a.ymax,a.zmin)),c(u.vec3.set(b,a.xmin,a.ymin,a.zmax)),c(u.vec3.set(b,a.xmax,a.ymin,a.zmax)),c(u.vec3.set(b,a.xmin,a.ymax,a.zmax)),c(u.vec3.set(b,a.xmax,a.ymax,a.zmax))):(c(u.vec3.set(b,a.xmin,a.ymin,b[2])),c(u.vec3.set(b,a.xmax,a.ymin,b[2])),c(u.vec3.set(b,a.xmin,a.ymax,b[2])),c(u.vec3.set(b,a.xmax,a.ymax,b[2])))},mesh:function(a,c,b){if(a=a.vertexAttributes&&a.vertexAttributes.position)for(var d=0;d<a.length;d+=3)c(u.vec3.set(b,a[d+0],a[d+1],a[d+2]))}}})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("require exports ../../../../core/maybe ../../../../core/PooledArray ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/stack ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/intersectorUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c){function k(a,c,b){for(var d=0;d<a.length;d++){var e=a[d];c&&!c(e)||b.push(e)}return b}function p(a){r||(r=new d.Intersector(a));r.viewingMode=a;return r}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,c,b){this.viewingMode=a;this.layerProvider=c;this.view=b;this.externalIntersectionHandlers=new m;this.tolerance=d.Intersector.DEFAULT_TOLERANCE;this.tmpRay=g.ray.create();this.validateHUDIntersector=new d.Intersector(this.viewingMode);this.validateHUDIntersector.options.hud=
!1}b.prototype.intersectScreen=function(a,c){return this.intersectRay(this.getPickRay(a,this.tmpRay),p(this.viewingMode),c)};b.prototype.intersectScreenFreePointFallback=function(a,c){return this.intersectRayFreePointFallback(this.getPickRay(a,this.tmpRay),c)};b.prototype.intersectRayFreePointFallback=function(a,c){return this.intersectRay(a,p(this.viewingMode),c)||this.intersectRayFreePointLocal(a,c)};b.prototype.intersectRay=function(a,c,b,d){c.options.selectionMode=!1;c.options.store=0;this.computeIntersection(a,
c,d);return c.results.min?c.results.min.getIntersectionPoint(b):!1};b.prototype.getCenterRayWithSubpixelOffset=function(a,c,b,d){void 0===b&&(b=.5);void 0===d&&(d=.5);a.getRenderCenter(v,b,d);v[0]+=.0466;v[1]-=.0123;return g.ray.fromRenderAtEye(a,v,c)};b.prototype.intersectIntersectorScreen=function(a,c,b){this.computeIntersection(this.getPickRay(a,this.tmpRay),c,b)};b.prototype.intersectToolIntersectorScreen=function(a,c,b){a=this.getPickRay(a,this.tmpRay);this.intersectToolIntersectorRay(a,c,b)};
b.prototype.intersectToolIntersectorRay=function(a,c,b){c.options.selectionMode=!0;this.computeIntersection(a,c,b);var d=c.results.min;this.view.basemapTerrain&&this.view.basemapTerrain.isOpaque()||d.hasIntersectionPoint&&"TerrainRenderer"!==d.intersector||(c.options.selectionMode=!1,this.computeIntersection(a,c,b))};b.prototype.setTolerance=function(a){void 0===a&&(a=d.Intersector.DEFAULT_TOLERANCE);this.tolerance=a};b.prototype.addIntersectionHandler=function(a){this.externalIntersectionHandlers.push(a);
this.externalIntersectionHandlers.sort(function(a,c){return"Terrain"===a.type?1:"Terrain"===c.type?-1:0})};b.prototype.removeIntersectionHandler=function(a){this.externalIntersectionHandlers.removeUnordered(a);this.externalIntersectionHandlers.sort(function(a,c){return"Terrain"===a.type?1:"Terrain"===c.type?-1:0})};b.prototype.getPickRay=function(a,c){void 0===c&&(c=g.ray.create());return g.ray.fromScreen(this.view.state.camera,a,c)};b.prototype.intersectRayFreePointLocal=function(a,c){if("local"!==
this.viewingMode)return!1;var b=this.view.dataExtent,d=Math.max(b.xmax-b.xmin,b.ymax-b.ymin,8*Math.max(b.xmax-b.xmin,b.ymax-b.ymin));if(0===d)return e.vec3.add(c,a.origin,e.vec3.normalize(l.sv3d.get(),a.direction)),!0;var f=this.view.state.camera,g=Math.max(0,b.xmin-f.eye[0],f.eye[0]-b.xmax),b=Math.max(0,b.ymin-f.eye[1],f.eye[1]-b.ymax),f=d/Math.max(1,Math.pow(Math.max(0,Math.log(d/(Math.abs(f.relativeElevation)+Number.MIN_VALUE))),2)),f=Math.max(f,Math.min(Math.sqrt(g*g+b*b),d)),d=e.vec3.scale(l.sv3d.get(),
a.direction,f/e.vec3.length(a.direction));e.vec3.add(c,a.origin,d);return!0};b.prototype.intersectElevationFromScreen=function(a,c,b){void 0===b&&(b=0);return this.intersectElevation(this.getPickRay(a,this.tmpRay),c,b)};b.prototype.intersectElevation=function(b,f,g){void 0===g&&(g=0);var k=a.isSome(f)?f.mode:"absolute-height",m=a.isSome(f)?a.unwrapOr(f.offset,0):0,p="on-the-ground"!==k?m+g:0;f=p/this.view.renderCoordsHelper.unitInMeters;if("absolute-height"===k)return this.view.renderCoordsHelper.intersectManifold(b,
p,u)?(g=this.view.computeMapPointFromVec3d(u),g.z-=m,g):null;var m=this.view.state.camera,q=h.castRenderScreenPointArray3(l.sv3d.get());m.projectPoint(b.origin,q);var p=this.prepareFilters(null,t),r=this.view.slicePlane,w=a.isSome(r)?c.sliceFilterPredicate(r):null,v=new d.Intersector(this.viewingMode);v.options.store=0;v.options.verticalOffset=f;f=b.origin;b=e.vec3.add(l.sv3d.get(),f,b.direction);v.reset(f,b);v.point=q;v.camera=m;v.filterPredicate=null;switch(k){case "relative-to-scene":v.intersect(p.layers,
q,m,this.tolerance,null,function(a){return a.metadata&&a.metadata.isElevationSource});this.externalIntersectionHandlers.forEach(function(a){"I3S"!==a.type&&"Terrain"!==a.type||a.intersect(v,a.slicePlane?w:null,v.rayBeginPoint,v.rayEndPoint,q)});break;case "on-the-ground":case "relative-to-ground":this.externalIntersectionHandlers.forEach(function(a){a.isGround&&a.intersect(v,a.slicePlane?w:null,v.rayBeginPoint,v.rayEndPoint,q)})}return v.results.min.getIntersectionPoint(u)?(k=this.view.computeMapPointFromVec3d(u),
k.z=g,k):null};b.prototype.computeIntersection=function(b,d,f){var g=this,k=this.view.state.camera,m=h.castRenderScreenPointArray3(l.sv3d.get());k.projectPoint(b.origin,m);var p=this.prepareFilters(f,t);d.options.storeTerrainResults=p.filterLayerUid(c.TERRAIN_ID);d.options.selectOpaqueTerrainOnly=!f||!("include"in f||"exclude"in f);var q=b.origin,r=e.vec3.add(l.sv3d.get(),b.origin,b.direction);d.reset(q,r);d.intersect(p.layers,m,k,this.tolerance);b=this.view.slicePlane;var u=a.isSome(b)?c.sliceFilterPredicate(b):
null;d.intersect(p.sliceableLayers,m,k,this.tolerance,u);var v=f&&(f.terrainLocationFeedbackEnabled||f.enableDraped);this.externalIntersectionHandlers.forEach(function(a){if(a.intersectionHandlerId===c.TERRAIN_ID){if(!v&&!p.filterLayerUid(c.TERRAIN_ID))return}else if(!p.filterLayerUid(a.intersectionHandlerId))return;a.intersect(d,a.slicePlane?u:null,q,r,m)});b=l.sv3d.get();if(f&&f.enableDraped&&d.results.ground.getIntersectionPoint(b)){f=this.view.basemapTerrain.overlayManager.renderer;var w=this.view.renderCoordsHelper.spatialReference,
y=l.sv3d.get();this.view.renderCoordsHelper.fromRenderCoords(b,y,this.view.spatialReference);y[2]=this.view.elevationProvider.getElevation(b[0],b[1],b[2],w)||0;f.intersect(d,y,p.filterRenderGeometry)}d.sortResults();b=d.results.hud;if(b.hasIntersectionPoint){var z=h.castRenderScreenPointArray3(l.sv3d.get()),n=l.sv3d.get(),Q=l.sv3d.get();this.unprojectHUDResultRay(b.center,z,n,Q);f=e.vec3.distance(b.center,n)/e.vec3.distance(n,Q)*.99;this.validateHUDIntersector.reset(n,Q);this.validateHUDIntersector.intersect(p.layers,
z,k,this.tolerance);this.validateHUDIntersector.intersect(p.sliceableLayers,z,k,this.tolerance,u);this.externalIntersectionHandlers.forEach(function(a){p.filterLayerUid(a.intersectionHandlerId)&&a.intersect(g.validateHUDIntersector,a.slicePlane?u:null,n,Q,z)});k=this.validateHUDIntersector.results.min;if(null==k.dist||f<=k.dist)d.results.min.copyFrom(b),d.results.all.splice(0,0,b)}};b.prototype.prepareFilters=function(a,c){var b=[],d=[];this.layerProvider.forEachLayer(function(a){a.isPickable&&(a.isSliceable?
d:b).push(a)});c.include=a&&a.include;c.exclude=a&&a.exclude;c.layers.length=0;c.sliceableLayers.length=0;k(b,c.filterLayer,c.layers);k(d,c.filterLayer,c.sliceableLayers);return c};b.prototype.unprojectHUDResultRay=function(a,c,b,d){var e=this.view.state.camera;e.projectPoint(a,c);a=h.castRenderScreenPointArray3(l.sv3d.get());a[0]=c[0];a[1]=c[1];a[2]=0;e.unprojectPoint(a,b);a[2]=1;e.unprojectPoint(a,d)};return b}();b.SceneIntersectionHelper=n;var r,t={include:null,exclude:null,layers:[],sliceableLayers:[],
filterLayer:function(a){return t.filterLayerUid(a.apiLayerUid)},filterLayerUid:function(c){var b=t.include,d=t.exclude;return a.isNone(c)?null==b&&null==d:(null==b||b.has(c))&&(null==d||!d.has(c))},filterRenderGeometry:function(a){return t.filterLayerUid(a.data.layerUid)}},u=f.vec3f64.create(),v=h.createRenderScreenPointArray()})},"esri/views/3d/support/CombinedElevationProvider":function(){define("require exports tslib ../../../core/Accessor ../../../core/Evented ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../layers/graphics/ElevationQuery".split(" "),
function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a){a=b.call(this,a)||this;a.providers={im:[],ground:[],scene:[]};a.handles=new Map;return a}a.__extends(d,b);d.prototype.getElevation=function(a,b,d,e,f){var c;c=this._updateElevation(null,this.providers.im,a,b,d,e,f);null==c&&(c=this._updateElevation(c,this.providers.ground,a,b,d,e,f));"scene"===f&&(c=this._updateElevation(c,this.providers.scene,a,b,d,e,f));return c};d.prototype._updateElevation=function(a,
b,d,e,f,g,h){for(var c=0;c<b.length;c++){var k=b[c].getElevation(d,e,f,g,h);null!=k&&(a=null!=a?Math.max(k,a):k)}return a};d.prototype.queryElevation=function(a,b,d,f,h,l,m){var c=this;void 0===h&&(h=null);void 0===l&&(l=0);this._elevationService||(this._elevationService=new g.ElevationQuery(this.view.spatialReference,function(){return c.view.map&&c.view.map.ground},{maximumAutoTileRequests:4}));var k=e.createResolver();this._elevationService.queryElevation(a,b,h,l).then(function(e){"scene"===m&&
(e=c._updateElevation(e,c.providers.scene,a,b,d,f,m));k.resolve(e)}).catch(function(g){e.isAbortError(g)?k.reject(g):k.resolve(c.getElevation(a,b,d,f,m))});return k.promise};d.prototype.register=function(a,b){var c=this;this.handles.set(b,b.on("elevation-change",function(a){return c.emit("elevation-change",a)}));this.providers[a].push(b)};d.prototype.unregister=function(a){this.handles.has(a)&&(this.handles.get(a).remove(),this.handles.delete(a));for(var c=0,b=Object.keys(this.providers);c<b.length;c++){var d=
b[c],e=this.providers[d].indexOf(a);-1<e&&this.providers[d].splice(e,1)}};a.__decorate([f.property({constructOnly:!0})],d.prototype,"view",void 0);a.__decorate([f.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],d.prototype,"spatialReference",void 0);return d=a.__decorate([f.subclass("esri.views.3d.support.CombinedElevationProvider")],d)}(h.EventedMixin(m));b.CombinedElevationProvider=n})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("require exports tslib ../../../../geometry ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/scheduling".split(" "),
function(n,b,a,m,h,e,f,g,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b){this.spatialReference=a;this.view=b}b.prototype.getElevation=function(a,b,d){return this.view.elevationProvider.getElevation(a,b,0,this.spatialReference,d)};b.prototype.queryElevation=function(c,b,d,e,f){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return[2,this.view.elevationProvider.queryElevation(c,b,0,this.spatialReference,d,e,f)]})})};return b}();
b.ViewElevationProvider=n;n=function(){function b(c,b,d){this.spatialReference=c;this._getElevationQueryProvider=b;this._queries=[];this._isScheduled=!1;this._queryOptions=a.__assign(a.__assign({},d),{ignoreInvisibleLayers:!0})}b.prototype.queryElevation=function(c,b,d,e){void 0===e&&(e=0);return a.__awaiter(this,void 0,void 0,function(){var f=this;return a.__generator(this,function(a){return[2,g.create(function(a,k){var l={x:c,y:b,minDemResolution:e,result:{resolve:a,reject:k},signal:d};f._queries.push(l);
g.onAbort(d,function(){h.remove(f._queries,l);k(g.createAbortError())});f._scheduleDoQuery()})]})})};b.prototype._scheduleDoQuery=function(){var a=this;this._isScheduled||(l.schedule(function(){return a._doQuery()}),this._isScheduled=!0)};b.prototype._doQuery=function(){return a.__awaiter(this,void 0,void 0,function(){var c,b,d,h,l,u,v,z,w,q,y,n;return a.__generator(this,function(k){switch(k.label){case 0:this._isScheduled=!1;c=this._queries;this._queries=[];if(0===c.length)return[2];b=c.map(function(a){return[a.x,
a.y]});d=c.reduce(function(a,c){return Math.min(a,c.minDemResolution)},Infinity);h=new m.Multipoint({points:b,spatialReference:this.spatialReference});l=this._getElevationQueryProvider();if(!l)return c.forEach(function(a){return a.result.reject()}),[2];u=1<c.length&&c.some(function(a){return!!a.signal})?g.createAbortController():null;v=f.isSome(u)?u.signal:c[0].signal;f.isSome(u)&&(z=0,c.forEach(function(a){return g.onAbort(a.signal,function(){z++;a.result.reject(g.createAbortError());z===c.length&&
u.abort()})}));w=a.__assign(a.__assign({},this._queryOptions),{minDemResolution:d,signal:v});return[4,e.result(l.queryElevation(h,w))];case 1:q=k.sent();for(y=0;y<c.length;y++)n=c[y],f.isSome(n.signal)&&n.signal.aborted?n.result.reject(g.createAbortError()):!1===q.ok?n.result.reject(q.error):n.result.resolve(q.value.geometry.points[y][2]);return[2]}})})};return b}();b.ElevationQuery=n})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["require","exports","../../../core/has"],function(n,
b,a){function m(){var b=!!a("esri-mobile");return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxTotalNumberOfPrimitives:85E4,polygonLodFactor:.5,polylineLodFactor:1},sceneService:{"3dObject":{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,memoryLimit:200,additionalCacheMemory:0,
frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:b?.8:1,polylineLodFactor:b?1.2:1.5},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:b},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,
physicalBasedRenderingEnabled:!1,memoryLimit:b?600:750,additionalCacheMemory:b?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:b?1.2:2,polylineLodFactor:b?1.2:2},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),
textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,memoryLimit:b?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:b?null:4096,maximumPixelRatio:b?1:null}}}n=function(){function b(){}b.isValidProfile=function(a){return a in b.profiles};b.getDefaultProfile=function(){return a("trident")||a("esri-iPhone")?"low":"medium"};b.apply=function(a,f){a=b.profiles[a];f.graphics3D.maxTotalNumberOfFeatures=a.graphics3D.maxTotalNumberOfFeatures;f.graphics3D.maxTotalNumberOfPrimitives=
a.graphics3D.maxTotalNumberOfPrimitives;f.graphics3D.polygonLodFactor=a.graphics3D.polygonLodFactor;f.graphics3D.polylineLodFactor=a.graphics3D.polylineLodFactor;f.sceneService["3dObject"].lodFactor=a.sceneService["3dObject"].lodFactor;f.sceneService.point.lodFactor=a.sceneService.point.lodFactor;f.sceneService.integratedMesh.lodFactor=a.sceneService.integratedMesh.lodFactor;f.sceneService.pointCloud.lodFactor=a.sceneService.pointCloud.lodFactor;f.sceneService.uncompressedTextureDownsamplingEnabled=
a.sceneService.uncompressedTextureDownsamplingEnabled;f.tiledSurface.lodBias=a.tiledSurface.lodBias;f.tiledSurface.angledSplitBias=a.tiledSurface.angledSplitBias;f.tiledSurface.reduceTileLevelDifferences=a.tiledSurface.reduceTileLevelDifferences;f.tiledSurface.textureFadeDuration=a.tiledSurface.textureFadeDuration;f.antialiasingEnabled=a.antialiasingEnabled;f.physicallyBasedRenderingEnabled=a.physicalBasedRenderingEnabled;f.memoryLimit=a.memoryLimit;f.additionalCacheMemory=a.additionalCacheMemory;
f.frameRate=a.frameRate;f.maximumRenderResolution=a.maximumRenderResolution;f.maximumPixelRatio=a.maximumPixelRatio};b.debug={reset:function(){var a=m(),f;for(f in a)b.profiles[f]=a[f]}};return b}();(n||(n={})).profiles=m();return n})},"esri/views/3d/support/HighlightOptions":function(){define("require exports tslib ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec4f32".split(" "),function(n,b,a,m,h,e,f,g){return function(b){function d(){var a=
null!==b&&b.apply(this,arguments)||this;a.color=new m([0,255,255]);a.haloColor=null;a.haloOpacity=1;a.fillOpacity=.25;return a}a.__extends(d,b);d.toEngineOptions=function(a){var c=m.toUnitRGBA(a.color),b=e.isSome(a.haloColor)?m.toUnitRGBA(a.haloColor):c;return{color:g.vec4f32.fromValues(c[0],c[1],c[2],c[3]),haloColor:g.vec4f32.fromValues(b[0],b[1],b[2],b[3]),haloOpacity:a.haloOpacity,haloOpacityOccluded:.25*a.haloOpacity,fillOpacity:a.fillOpacity,fillOpacityOccluded:.25*a.fillOpacity}};a.__decorate([f.property({type:m})],
d.prototype,"color",void 0);a.__decorate([f.property({type:m})],d.prototype,"haloColor",void 0);a.__decorate([f.property()],d.prototype,"haloOpacity",void 0);a.__decorate([f.property()],d.prototype,"fillOpacity",void 0);return d=a.__decorate([f.subclass("esri.views.3d.support.HighlightOptions")],d)}(h)})},"esri/core/libs/gl-matrix-2/vec4f32":function(){define(["require","exports","./factories/vec4f32"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.vec4f32=a})},"esri/core/libs/gl-matrix-2/factories/vec4f32":function(){define(["require",
"exports"],function(n,b){function a(){return new Float32Array(4)}function m(a,c,b,e){var d=new Float32Array(4);d[0]=a;d[1]=c;d[2]=b;d[3]=e;return d}function h(){return m(1,1,1,1)}function e(){return m(1,0,0,0)}function f(){return m(0,1,0,0)}function g(){return m(0,0,1,0)}function l(){return m(0,0,0,1)}Object.defineProperty(b,"__esModule",{value:!0});b.create=a;b.clone=function(a){var c=new Float32Array(4);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};b.fromValues=m;b.createView=function(a,c){return new Float32Array(a,
c,4)};b.zeros=function(){return a()};b.ones=h;b.unitX=e;b.unitY=f;b.unitZ=g;b.unitW=l;b.ZEROS=a();b.ONES=h();b.UNIT_X=e();b.UNIT_Y=f();b.UNIT_Z=g();b.UNIT_W=l()})},"esri/views/3d/support/index":function(){define(["require","exports","../../../core/MapUtils","./ResourceController","./MemoryController"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.ResourceControllerMaster=m.ResourceControllerMaster;b.newResourceController=m.newResourceController;b.newMemoryController=h.newMemoryController;
b.downloadSlotsPerClient=a.MapFromValues([[0,15],[1,15],[2,20],[3,5]]);b.maxDownloadSlots=30})},"esri/views/3d/support/ResourceController":function(){define("require exports tslib ../../../core/Accessor ../../../core/Handles ../../../core/scheduling ../../../core/accessorSupport/decorators ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),function(n,b,a,m,h,e,f,g,l,d,c){Object.defineProperty(b,"__esModule",{value:!0});var k=function(c){function b(){var a=null!==c&&
c.apply(this,arguments)||this;a.updating=!1;return a}a.__extends(b,c);a.__decorate([f.property({readOnly:!0})],b.prototype,"updating",void 0);return b=a.__decorate([f.subclass("esri.views.3d.support.ResourceController")],b)}(m);b.ResourceControllerMaster=k;b.newResourceController=function(a,c){void 0===c&&(c=function(){return performance.now()});return new p.ResourceController({view:a,now:c})};var p;(function(b){var m=function(b){function k(){var a=null!==b&&b.apply(this,arguments)||this;a._scheduler=
null;a._memoryController=null;a._streamDataLoader=null;a._cameraChangeTime=0;a._handles=new h;a._frameTask=null;return a}a.__extends(k,b);k.prototype.initialize=function(){var a=this;this._cameraChangeTime=this.now();this._scheduler=c.newScheduler(this.now);this._memoryController=l.newMemoryController(this.view);this._streamDataLoader=new d.default;this._streamDataLoader.setup(g.maxDownloadSlots,g.downloadSlotsPerClient,this._scheduler);this._handles.add([this.view.watch("state.camera",function(c,
b){return a._cameraChangedHandler(c,b)},!0),this.view.watch("stationary",function(){return a._stationaryChangedHandler()}),this._memoryController.events.on("updating-changed",function(){return a.notifyChange("updating")})]);this._frameTask=e.addFrameTask({update:function(c){return a.frame(c)}})};k.prototype.destroy=function(){this._handles.destroy();this._handles=null;this._frameTask&&(this._frameTask.remove(),this._frameTask=null);this._streamDataLoader&&(this._streamDataLoader.destroy(),this._streamDataLoader=
null);this._memoryController.destroy();this._memoryController=null;this._scheduler.destroy();this._scheduler=null};Object.defineProperty(k.prototype,"updating",{get:function(){return!!(this._memoryController&&this._memoryController.updating||this._streamDataLoader&&this._streamDataLoader.updating)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"scheduler",{get:function(){return this._scheduler},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"memoryController",
{get:function(){return this._memoryController},enumerable:!0,configurable:!0});k.prototype.createStreamDataRequester=function(a){var c=this._streamDataLoader;return{request:function(b,d,e){return c.request(b,d,a,e)},get busy(){return c.busy}}};k.prototype.frame=function(a){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(a.deltaTime/1E3),!this._scheduler))return;this._scheduler.state=this.state;this._scheduler.updateBudget(a)?(this._memoryController.update(),this._scheduler.frame()):
this._memoryController.updating&&this._memoryController.update()}};k.prototype._cameraChangedHandler=function(a,c){a&&c&&a.almostEquals(c)||(this._cameraChangeTime=this._scheduler.now,this._scheduler.state=this.state)};k.prototype._stationaryChangedHandler=function(){this.memoryController.resetStableQuality()};Object.defineProperty(k.prototype,"state",{get:function(){var a=this.view;return a.animation?0:a.interacting||this._scheduler.now-this._cameraChangeTime<=p?1:2},enumerable:!0,configurable:!0});
Object.defineProperty(k.prototype,"test",{get:function(){var a=this;return{getQueueStats:function(c){return a._streamDataLoader.test.loadQueue.getStatsForType(c)},state:this.state}},enumerable:!0,configurable:!0});a.__decorate([f.property({constructOnly:!0})],k.prototype,"view",void 0);a.__decorate([f.property({constructOnly:!0})],k.prototype,"now",void 0);a.__decorate([f.property()],k.prototype,"_streamDataLoader",void 0);a.__decorate([f.property({readOnly:!0,dependsOn:["_streamDataLoader.updating"]})],
k.prototype,"updating",null);return k=a.__decorate([f.subclass("esri.views.3d.support.ResourceController")],k)}(k);b.ResourceController=m;var p=300})(p||(p={}))})},"esri/views/3d/support/MemoryController":function(){define("require exports ../../../core/Evented ../../../core/Logger ../../../core/MemCache ../layers/support/MemoryManagedLayerView".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});var f=m.getLogger("esri.views.3d.support.MemoryController");b.newMemoryController=
function(a){return new g(a)};var g=function(){function b(b){this._view=b;this.events=new a;this.minQuality=.1;this._maxMemory=500;this._additionalCacheMemory=100;this._quality=1;this._downscaleMemoryUsed=this._stableQuality=0;this._canFastRecover=!1;this._memoryPredicted=this._memoryUsed=0;this._cacheStorage=new h.MemCacheStorage;this._numQualityChanges=0;this._updating=!1}b.prototype.destroy=function(){this.events=null};b.prototype.getMemCache=function(a,c){return new h.MemCache(a,this._cacheStorage,
c)};Object.defineProperty(b.prototype,"maxMemory",{get:function(){return this._maxMemory},set:function(a){null!=a&&0<a&&(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<a&&this._updateQuality(1),this._maxMemory=a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"additionalCacheMemory",{set:function(a){null!=a&&0<=a&&(this._additionalCacheMemory=a)},enumerable:!0,configurable:!0});b.prototype.disableMemCache=function(){this._additionalCacheMemory=-4096};Object.defineProperty(b.prototype,
"memoryFactor",{get:function(){return this._quality},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"updating",{get:function(){return this._updating},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"usedMemory",{get:function(){return this._memoryUsed},enumerable:!0,configurable:!0});b.prototype.resetStableQuality=function(){this._stableQuality=0};b.prototype.update=function(){this._updateMemory();if(!(0>=this._memoryPredicted)||this._updating){var a=this._layersUpdating();
if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(a){if(1.1<this._memoryPredicted||1<this._memoryUsed)0<this._stableQuality?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1)}else this._downscaleMemoryUsed=
0,1<this._memoryUsed?(this._stableQuality=0,this._canFastRecover=!1,a=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._memoryUsed&&1>this._quality?(this._stableQuality=this._quality,a=this._updateQuality(this._quality+.05)):1>this._quality&&(this._canFastRecover=!0));this.updating!==a&&(this._updating=a,this.events.emit("updating-changed",this.updating))}};b.prototype._updateQuality=function(a){a=Math.min(Math.max(a,
this.minQuality),1);if(a===this._quality)return!1;this._quality=a;this.events.emit("quality-changed",this._quality);++this._numQualityChanges;return!0};b.prototype._layersUpdating=function(){return this._view.allLayerViews.some(function(a){return!!a.updating})};b.prototype._updateMemory=function(){var a=this,c=0,b=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(c+=this._view.basemapTerrain.getUsedMemory());var g=this._view._stage&&this._view._stage.renderView&&this._view._stage.renderView.edgeView;
g&&(c+=g.getUsedMemory());this._view.allLayerViews&&this._view.allLayerViews.forEach(function(d){if(e.isMemoryManagedLayerView(d)){var f=d.ignoresMemoryFactor()?a._quality:1;c+=d.getUsedMemory()*f;b+=d.getUnloadedMemory()*f}});var h=null==this._warnMemoryUsage||Math.round(10*c)!==Math.round(10*this._warnMemoryUsage),g=1048576*this._maxMemory;if(c>g&&h){this._warnMemoryUsage=c;var h=function(a){return(a/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB"},l=Math.round(100*this._quality);
f.warn("Memory Limit exceeded! Limit: "+h(g)+" Current: "+h(c)+" Projected: "+h(c+b)+" Quality: "+l+"%")}this._memoryUsed=c/g;this._memoryPredicted=(c+b)/g;this._cacheStorage.maxSize=Math.max(0,g-c+1048576*this._additionalCacheMemory);this.events.emit("memory-used",this._memoryUsed)};Object.defineProperty(b.prototype,"test",{get:function(){return{cacheStorage:this._cacheStorage,numQualityChanges:this._numQualityChanges}},enumerable:!0,configurable:!0});return b}()})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.isMemoryManagedLayerView=function(a){return"function"===typeof a.getUsedMemory}})},"esri/views/3d/support/StreamDataLoader":function(){define("require exports tslib ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators ./AsyncWorkerQueue ./StreamDataLoaderTask ../webgl-engine/lib/Util ../../../views/support/Scheduler".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t){function u(a){if(2>a.byteLength)return"unknown";a=new Uint8Array(a,0,a.byteLength);return 137===a[0]&&80===a[1]?"image/png":71===a[0]&&73===a[1]?"image/gif":66===a[0]&&77===a[1]?"image/bmp":255===a[0]&&216===a[1]?"image/jpeg":"unknown"}Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function h(){var a=null!==b&&b.apply(this,arguments)||this;a.tasks=new Map;a.onLoadQueue=[];a.doneQueue=[];a.updating=!1;return a}a.__extends(h,b);h.prototype.setup=
function(a,c,b){var d=this;this.loadQueue=new k.AsyncWorkerQueue(function(a,c){return d.startLoading(a,c)},function(a,c){return d.doneLoadingCallback(a,c)},a,c);b&&(this.taskHandle=b.registerTask(t.Task.STREAM_DATA_LOADER,function(a){return d.update(a)},function(){return 0<d.doneQueue.length||0<d.onLoadQueue.length}))};h.prototype.destroy=function(){this.taskHandle&&(this.taskHandle.remove(),this.taskHandle=null);this.tasks.forEach(function(a){a.abortController&&a.abortController.abort()});this.loadQueue.clear();
this.tasks=this.doneQueue=this.onLoadQueue=this.loadQueue=null};Object.defineProperty(h.prototype,"busy",{get:function(){return this.loadQueue.busy},enumerable:!0,configurable:!0});h.prototype.request=function(a,c,b,e){var f=this;void 0===e&&(e={});var g=d.createResolver();g.__signal=l.isSome(e)?e.signal:null;var k=this.createOrUpdateTask(a,c,b,e,g);d.onAbort(e,function(){return f.cancelRequest(k,g)});return g.promise};h.prototype.createTask=function(a,c,b,d,e,f){a=new p.default(a,c,b,d,e);this.updateTask(a,
f);this.tasks.set(e,a);1===this.tasks.size&&this._set("updating",!0);this.loadQueue.push(a);return a};h.prototype.cancelRequest=function(a,c){e.removeUnordered(a.resolvers,c);c.reject(d.createAbortError());0===a.resolvers.length&&(2===a.status&&(a.status=4,this.loadQueue.cancel(a),a.abortController.abort(),a.request=null,a.abortController=null),a.status=4,this.tasks.delete(a.key),0===this.tasks.size&&this._set("updating",!1))};h.prototype.taskKey=function(a,c,b){return a+":"+c+":"+b};h.prototype.updateTask=
function(a,c){a.resolvers.push(c)};h.prototype.createOrUpdateTask=function(a,c,b,d,e){var f=l.isSome(d)&&d.uid||a,f=this.taskKey(f,c,b),g=this.tasks.get(f);return g?(this.updateTask(g,e),g):this.createTask(a,d,c,b,f,e)};h.prototype.doneLoadingCallback=function(a,c){this.loadQueue&&(r.assert(2===a.status),a.status=3,this.taskHandle?this.doneQueue.push({task:a,err:c}):this.doneLoading(a,c))};h.prototype.update=function(a){for(;!a.done&&0<this.onLoadQueue.length;){var c=this.onLoadQueue.shift();d.throwIfAborted(c.task.abortController);
c.task.abortController=null;c.callback(c.task);a.madeProgress()}for(;!a.done&&0<this.doneQueue.length;)c=this.doneQueue.shift(),3!==c.task.status&&(c.err=c.err||d.createAbortError()),this.doneLoading(c.task,c.err),a.madeProgress()};h.prototype.doneLoading=function(a,c){for(var b=a.result instanceof HTMLImageElement?0:a.resolvers.length,e=0,k=a.resolvers;e<k.length;e++){var h=k[e];if(c)d.isAbortError(c)?h.reject(c):h.reject(new f("stream-data-loader:request-error","Failed to request resource at '"+
a.url+"'. "+c,{url:a.url,error:c}));else{--b;var l=0>=b?a.result:g.clone(a.result);h.resolve(l)}}this.tasks.delete(a.key);0===this.tasks.size&&this._set("updating",!1)};h.prototype.startLoading=function(c,b){var e=this;if(4===c.status)return!1;c.startTime=performance.now();c.status=2;var f,g;switch(c.docType){case "binary":g="array-buffer";f=0;break;case "image":g="image";break;case "image+type":g="array-buffer";break;default:g="json"}c.abortController=d.createAbortController();var k=c.abortController.signal;
c.request=m(c.url,a.__assign(a.__assign({},c.options),{responseType:g,timeout:f,signal:k}));var h=function(){},l=function(a){c.duration=performance.now()-c.startTime;c.size=a instanceof ArrayBuffer?a.byteLength:c.size||0;c.result=a;e.taskHandle?e.onLoadQueue.push({callback:b,task:c}):(c.abortController=null,b(c))},p=function(a){2===c.status&&b(c,a);h()};if("image+type"!==c.docType)return c.request.then(function(a){return l(a.data)},p),!0;c.request.then(function(a){a=a.data;var b=u(a);g="image";c.size=
a.byteLength;if("unknown"===b)c.request=m(c.url,{responseType:g,timeout:f,signal:k}),c.request.then(function(a){return l(a.data)},p);else{a=new Blob([a],{type:b});var d=window.URL.createObjectURL(a);h=function(){return window.URL.revokeObjectURL(d)};c.request=m(d,{responseType:g,timeout:f,signal:k});c.request.then(function(a){return l(new v(a.data,b,h))},p)}},p);return!0};Object.defineProperty(h.prototype,"test",{get:function(){return{loadQueue:this.loadQueue}},enumerable:!0,configurable:!0});a.__decorate([c.property({readOnly:!0})],
h.prototype,"updating",void 0);return h=a.__decorate([c.subclass("esri.views.3d.support.StreamDataLoader")],h)}(h);b.StreamDataLoader=n;var v=function(){function a(a,c,b){this.image=a;this.type=c;this.release=b}Object.defineProperty(a.prototype,"isOpaque",{get:function(){return"image/jpeg"===this.type},enumerable:!0,configurable:!0});return a}();b.ImageWithType=v;b.default=n})},"esri/views/3d/support/AsyncWorkerQueue":function(){define(["require","exports","../webgl-engine/lib/Util"],function(n,b,
a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(a){this.clientType=a;this._cancelled=!1;this.duration=this.size=0}}();b.BaseTask=n;n=function(){function b(a,b,f,g){var e=this;this._workerFunc=a;this._callbackFunc=b;this._maxTotalNumWorkers=f;this._type2id=new Map;this._tasks=[];this._typeNumWorkers=[];this._typeWorkerQuota=[];this._typeStatistics=[];this._totalNumWorkers=0;g.forEach(function(a,c){e._type2id.set(c,e._tasks.length);e._tasks.push([]);e._typeNumWorkers.push(0);
e._typeStatistics.push({requests:0,size:0,duration:0,speed:0});e._typeWorkerQuota.push(a)})}Object.defineProperty(b.prototype,"numTypes",{get:function(){return this._tasks.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"busy",{get:function(){return this._totalNumWorkers>=this._maxTotalNumWorkers},enumerable:!0,configurable:!0});b.prototype.push=function(a){var b=this,f=this._type2id.get(a.clientType);this._totalNumWorkers<this._maxTotalNumWorkers?(this._typeNumWorkers[f]++,
this._totalNumWorkers++,this._workerFunc(a,function(a,e){return b._taskCallback(a,e)})):this._tasks[f].push(a)};b.prototype.getStatsForType=function(a){a=this._type2id.get(a);return{quota:this._typeWorkerQuota[a],workers:this._typeNumWorkers[a],queueSize:this._tasks[a].length,requestStats:this._typeStatistics[a]}};b.prototype.cancel=function(a){this._taskFinished(a);a._cancelled=!0};b.prototype.clear=function(){for(var a=0;a<this._tasks.length;a++)this._tasks[a]=[]};b.prototype._taskFinished=function(b){var e=
this._type2id.get(b.clientType);this._typeNumWorkers[e]--;this._totalNumWorkers--;this._typeStatistics[e].requests++;this._typeStatistics[e].size+=b.size||0;this._typeStatistics[e].duration+=b.duration||0;this._typeStatistics[e].speed=0<this._typeStatistics[e].duration?this._typeStatistics[e].size/this._typeStatistics[e].duration:0;a.assert(0<=this._typeNumWorkers[e]);this._next()};b.prototype._next=function(){for(var a=0;a<this.numTypes;++a){if(this._typeNumWorkers[a]<this._typeWorkerQuota[a]&&this._processQueue(a))return;
++a}for(a=0;a<this.numTypes&&!this._processQueue(a);++a);};b.prototype._processQueue=function(a){for(var b=this;0<this._tasks[a].length;)if(this._workerFunc(this._tasks[a].shift(),function(a,e){return b._taskCallback(a,e)}))return this._typeNumWorkers[a]++,this._totalNumWorkers++,!0;return!1};b.prototype._taskCallback=function(a,b){a._cancelled||(this._callbackFunc(a,b),this._taskFinished(a))};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{set workerFunc(b){a._workerFunc=
b}}},enumerable:!0,configurable:!0});return b}();b.AsyncWorkerQueue=n})},"esri/views/3d/support/StreamDataLoaderTask":function(){define(["require","exports","tslib","./AsyncWorkerQueue"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(a,e,h,d,c){d=b.call(this,d)||this;d.url=a;d.options=e;d.docType=h;d.key=c;d.result=null;d.status=1;d.request=null;d.abortController=null;d.resolvers=[];d.startTime=0;return d}a.__extends(e,b);return e}(m.BaseTask);b.default=
n})},"esri/views/3d/support/MapCoordsHelper":function(){define("require exports tslib ../../../geometry ../../../core/Error ../../../core/unitUtils ../../../portal/support/geometryServiceUtils ../../../tasks/support/ProjectParameters".split(" "),function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,c,b){void 0===b&&(b=null);this.spatialReference=c;this.unitInMeters=e.getMetersPerUnitForSR(this.spatialReference);this._geometryServicePromise=this.loadGeometryService(a,
b)}b.prototype.loadGeometryService=function(b,c){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){switch(a.label){case 0:if(c)return[2,c];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,f.create(b&&b.get("portalItem"))];case 2:return[2,a.sent()];case 3:throw a.sent(),new h("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");case 4:return[2]}})})};b.prototype.toGeographic=function(b){return a.__awaiter(this,void 0,void 0,
function(){var c,d,e,f,h,l,v,z=this;return a.__generator(this,function(a){switch(a.label){case 0:return[4,this._geometryServicePromise];case 1:return c=a.sent(),d=!0,Array.isArray(b[0])&&"number"!==typeof b[0]?e=b:(e=[b],d=!1),f=e.map(function(a){return a instanceof m.Point?a:new m.Point(a,z.spatialReference)}),h=new g({geometries:f,outSpatialReference:m.SpatialReference.WGS84}),[4,c.project(h)];case 2:return l=a.sent(),v=l.map(function(a){return"point"===a.type?[a.x,a.y]:void 0}),[2,d?v:v[0]]}})})};
return b}();b.MapCoordsHelper=n;b.default=n})},"esri/portal/support/geometryServiceUtils":function(){define("require exports tslib ../../config ../../core/Error ../Portal ../../tasks/GeometryService ../../tasks/support/ProjectParameters @dojo/framework/shim/Promise".split(" "),function(n,b,a,m,h,e,f,g){function l(b,c){void 0===b&&(b=null);return a.__awaiter(this,void 0,void 0,function(){var d;return a.__generator(this,function(a){switch(a.label){case 0:if(m.geometryServiceUrl)return[2,new f({url:m.geometryServiceUrl})];
if(!b)throw new h("internal:geometry-service-url-not-configured");d="portal"in b?b.portal||e.getDefault():b;return[4,d.load({signal:c})];case 1:a.sent();if(d.helperServices&&d.helperServices.geometry&&d.helperServices.geometry.url)return[2,new f({url:d.helperServices.geometry.url})];throw new h("internal:geometry-service-url-not-configured");}})})}Object.defineProperty(b,"__esModule",{value:!0});b.create=l;b.projectGeometry=function(b,c,e,f){void 0===e&&(e=null);return a.__awaiter(this,void 0,void 0,
function(){var d,k,m;return a.__generator(this,function(a){switch(a.label){case 0:return[4,l(e,f)];case 1:return d=a.sent(),k=new g,k.geometries=[b],k.outSpatialReference=c,[4,d.project(k,{signal:f})];case 2:if((m=a.sent())&&Array.isArray(m)&&1===m.length)return[2,m[0]];throw new h("internal:geometry-service-projection-failed");}})})}})},"esri/tasks/GeometryService":function(){define("require exports tslib ../geometry ../request ../core/jsonMap ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../geometry/support/jsonUtils ./Task ./operations/generalize ./operations/lengths ./operations/offset ./operations/relation ./operations/trimExtend ./support/GeneralizeParameters ./support/LengthsParameters ./support/OffsetParameters ./support/ProjectParameters ./support/RelationParameters ./support/TrimExtendParameters".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y){var A=new e.JSONMap({MGRS:"mgrs",USNG:"usng",UTM:"utm",GeoRef:"geo-ref",GARS:"gars",DMS:"dms",DDM:"ddm",DD:"dd"}),B=g.ensureType(w);return function(b){function d(a){a=b.call(this,a)||this;a.url=null;return a}a.__extends(d,b);d.prototype.areasAndLengths=function(c,b){c=a.__assign(a.__assign(a.__assign({},this.parsedUrl.query),{f:"json"}),c.toJSON());b=this._asValidOptions(c,b);return h(this.parsedUrl.path+"/areasAndLengths",b).then(function(a){return a.data})};
d.prototype.autoComplete=function(c,b,d){var e=c[0].spatialReference;c=a.__assign(a.__assign({},this.parsedUrl.query),{f:"json",sr:JSON.stringify(e.toJSON()),polygons:JSON.stringify(this._encodeGeometries(c).geometries),polylines:JSON.stringify(this._encodeGeometries(b).geometries)});d=this._asValidOptions(c,d);return h(this.parsedUrl.path+"/autoComplete",d).then(function(a){return(a.data.geometries||[]).map(function(a){return new m.Polygon({spatialReference:e,rings:a.rings})})})};d.prototype.buffer=
function(c,b){var d=a.__assign(a.__assign(a.__assign({},this.parsedUrl.query),{f:"json"}),c.toJSON()),e=c.outSpatialReference||c.geometries[0].spatialReference;c=this._asValidOptions(d,b);return h(this.parsedUrl.path+"/buffer",c).then(function(a){return(a.data.geometries||[]).map(function(a){return new m.Polygon({spatialReference:e,rings:a.rings})})})};d.prototype.convexHull=function(c,b){var d=c[0].spatialReference;c=a.__assign(a.__assign({},this.parsedUrl.query),{f:"json",sr:JSON.stringify(d.toJSON()),
geometries:JSON.stringify(this._encodeGeometries(c))});b=this._asValidOptions(c,b);return h(this.parsedUrl.path+"/convexHull",b).then(function(a){return l.fromJSON(a.data.geometry).set({spatialReference:d})})};d.prototype.cut=function(c,b,d){var e=c[0].spatialReference,f=c.map(function(a){return a.toJSON()});c=a.__assign(a.__assign({},this.parsedUrl.query),{f:"json",sr:JSON.stringify(e.toJSON()),target:JSON.stringify({geometryType:l.getJsonType(c[0]),geometries:f}),cutter:JSON.stringify(b.toJSON())});
d=this._asValidOptions(c,d);return h(this.parsedUrl.path+"/cut",d).then(function(a){a=a.data;return{cutIndexes:a.cutIndexes,geometries:(a.geometries||[]).map(function(a){return l.fromJSON(a).set({spatialReference:e})})}})};d.prototype.densify=function(c,b){var d=c.geometries[0].spatialReference;c=a.__assign(a.__assign(a.__assign({},this.parsedUrl.query),{f:"json"}),c.toJSON());b=this._asValidOptions(c,b);return h(this.parsedUrl.path+"/densify",b).then(function(a){return(a.data.geometries||[]).map(function(a){return l.fromJSON(a).set({spatialReference:d})})})};
d.prototype.difference=function(c,b,d){var e=c[0].spatialReference;c={query:a.__assign(a.__assign({},this.parsedUrl.query),{f:"json",sr:JSON.stringify(e.toJSON()),geometries:JSON.stringify(this._encodeGeometries(c)),geometry:JSON.stringify({geometryType:l.getJsonType(b),geometry:b.toJSON()})})};if(this.requestOptions||d)c=a.__assign(a.__assign(a.__assign({},this.requestOptions),d),c);return h(this.parsedUrl.path+"/difference",c).then(function(a){return(a.data.geometries||[]).map(function(a){return l.fromJSON(a).set({spatialReference:e})})})};
d.prototype.distance=function(c,b){c=a.__assign(a.__assign(a.__assign({},this.parsedUrl.query),{f:"json"}),c.toJSON());b=this._asValidOptions(c,b);return h(this.parsedUrl.path+"/distance",b).then(function(a){return(a=a.data)&&a.distance})};d.prototype.fromGeoCoordinateString=function(c,b){var d={};d.sr=null!=c.sr&&"object"===typeof c.sr?c.sr.wkid||JSON.stringify(c.sr):c.sr;d.strings=JSON.stringify(c.strings);d.conversionType=A.toJSON(c.conversionType||"mgrs");d.conversionMode=c.conversionMode;c=a.__assign(a.__assign(a.__assign({},
this.parsedUrl.query),{f:"json"}),d);b=this._asValidOptions(c,b);return h(this.parsedUrl.path+"/fromGeoCoordinateString",b).then(function(a){return a.data.coordinates})};d.prototype.generalize=function(b,d){b=u.from(b);var e=b.toJSON();b=c.generalizeToRESTParameters(b);b=a.__assign(a.__assign(a.__assign({},this.parsedUrl.query),{f:"json"}),b);var f=e.geometries[0].spatialReference;d=this._asValidOptions(b,d);return h(this.parsedUrl.path+"/generalize",d).then(function(a){return(a.data.geometries||
[]).map(function(a){return l.fromJSON(a).set({spatialReference:f})})})};d.prototype.intersect=function(c,b,d){var e=c[0].spatialReference;c=a.__assign(a.__assign({},this.parsedUrl.query),{f:"json",sr:JSON.stringify(e.toJSON()),geometries:JSON.stringify(this._encodeGeometries(c)),geometry:JSON.stringify({geometryType:l.getJsonType(b),geometry:b.toJSON()})});d=this._asValidOptions(c,d);return h(this.parsedUrl.path+"/intersect",d).then(function(a){return(a.data.geometries||[]).map(function(a){return l.fromJSON(a).set({spatialReference:e})})})};
d.prototype.labelPoints=function(c,b){var d=c.map(function(a){return a.toJSON()}),e=c[0].spatialReference;c=a.__assign(a.__assign({},this.parsedUrl.query),{f:"json",sr:e.wkid?e.wkid:JSON.stringify(e.toJSON()),polygons:JSON.stringify(d)});b=this._asValidOptions(c,b);return h(this.parsedUrl.path+"/labelPoints",b).then(function(a){return(a.data.labelPoints||[]).map(function(a){return l.fromJSON(a).set({spatialReference:e})})})};d.prototype.lengths=function(c,b){c=v.from(c);c=k.lengthsToRESTParameters(c);
c=a.__assign(a.__assign(a.__assign({},this.parsedUrl.query),{f:"json"}),c);b=this._asValidOptions(c,b);return h(this.parsedUrl.path+"/lengths",b).then(function(a){return a.data})};d.prototype.offset=function(c,b){c=z.from(c);var d=p.offsetToRESTParameters(c),d=a.__assign(a.__assign(a.__assign({},this.parsedUrl.query),{f:"json"}),d),e=c.geometries[0].spatialReference;c=this._asValidOptions(d,b);return h(this.parsedUrl.path+"/offset",c).then(function(a){return(a.data.geometries||[]).map(function(a){return l.fromJSON(a).set({spatialReference:e})})})};
d.prototype.project=function(c,b){var d=this;c=B(c);var e=a.__assign(a.__assign(a.__assign({},this.parsedUrl.query),{f:"json"}),c.toJSON()),f=c.outSpatialReference,g=l.getJsonType(c.geometries[0]);c=this._asValidOptions(e,b);return h(this.parsedUrl.path+"/project",c).then(function(a){return d._decodeGeometries(a.data,g,f)})};d.prototype.relation=function(c,b){c=q.from(c);c=r.relationToRESTParameters(c);c=a.__assign(a.__assign(a.__assign({},this.parsedUrl.query),{f:"json"}),c);b=this._asValidOptions(c,
b);return h(this.parsedUrl.path+"/relation",b).then(function(a){return a.data.relations})};d.prototype.reshape=function(c,b,d){var e=c.spatialReference;c=a.__assign(a.__assign({},this.parsedUrl.query),{f:"json",sr:JSON.stringify(e.toJSON()),target:JSON.stringify({geometryType:l.getJsonType(c),geometry:c.toJSON()}),reshaper:JSON.stringify(b.toJSON())});d=this._asValidOptions(c,d);return h(this.parsedUrl.path+"/reshape",d).then(function(a){return l.fromJSON(a.data.geometry).set({spatialReference:e})})};
d.prototype.simplify=function(c,b){var d=this,e=c[0].spatialReference,f=a.__assign(a.__assign({},this.parsedUrl.query),{f:"json",sr:e.wkid?e.wkid:JSON.stringify(e.toJSON()),geometries:JSON.stringify(this._encodeGeometries(c))}),g=l.getJsonType(c[0]);c=this._asValidOptions(f,b);return h(this.parsedUrl.path+"/simplify",c).then(function(a){return d._decodeGeometries(a.data,g,e)})};d.prototype.toGeoCoordinateString=function(c,b){var d={};d.sr=null!=c.sr&&"object"===typeof c.sr?c.sr.wkid||JSON.stringify(c.sr):
c.sr;d.coordinates=JSON.stringify(c.coordinates);d.conversionType=A.toJSON(c.conversionType||"mgrs");d.conversionMode=c.conversionMode;d.numOfDigits=c.numOfDigits;d.rounding=c.rounding;d.addSpaces=c.addSpaces;c=a.__assign(a.__assign(a.__assign({},this.parsedUrl.query),{f:"json"}),d);b=this._asValidOptions(c,b);return h(this.parsedUrl.path+"/toGeoCoordinateString",b).then(function(a){return a.data.strings})};d.prototype.trimExtend=function(c,b){c=y.from(c);var d=t.trimExtendToRESTParameters(c),d=a.__assign(a.__assign(a.__assign({},
this.parsedUrl.query),{f:"json"}),d),e=c.sr;c=this._asValidOptions(d,b);return h(this.parsedUrl.path+"/trimExtend",c).then(function(a){return(a.data.geometries||[]).map(function(a){return new m.Polyline({spatialReference:e,paths:a.paths})})})};d.prototype.union=function(c,b){var d=c[0].spatialReference;c=a.__assign(a.__assign({},this.parsedUrl.query),{f:"json",sr:JSON.stringify(d.toJSON()),geometries:JSON.stringify(this._encodeGeometries(c))});b=this._asValidOptions(c,b);return h(this.parsedUrl.path+
"/union",b).then(function(a){return l.fromJSON(a.data.geometry).set({spatialReference:d})})};d.prototype._asValidOptions=function(c,b){c={query:c};if(this.requestOptions||b)c=a.__assign(a.__assign(a.__assign({},this.requestOptions),b),c);return c};d.prototype._encodeGeometries=function(a){for(var c=[],b=a.length,d=0;d<b;d++)c.push(a[d].toJSON());return{geometryType:l.getJsonType(a[0]),geometries:c}};d.prototype._decodeGeometries=function(c,b,d){var e=l.getGeometryType(b);c=c.geometries;var f=[],g=
{spatialReference:d.toJSON()};c.forEach(function(c,b){f[b]=new e(a.__assign(a.__assign({},c),g))});return f};d.prototype._toProjectGeometry=function(a){var c=a.spatialReference.toJSON();return a instanceof m.Extent?new m.Polygon({rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]],spatialReference:c}):new m.Polyline({paths:[[].concat(a.points)],spatialReference:c})};d.prototype._fromProjectedGeometry=function(a,c,b){return"extent"===c?(a=a.rings[0],new m.Extent(a[0][0],
a[0][1],a[2][0],a[2][1],b)):new m.Multipoint({points:a.paths[0],spatialReference:b.toJSON()})};d.UNIT_METER=9001;d.UNIT_GERMAN_METER=9031;d.UNIT_FOOT=9002;d.UNIT_SURVEY_FOOT=9003;d.UNIT_CLARKE_FOOT=9005;d.UNIT_FATHOM=9014;d.UNIT_NAUTICAL_MILE=9030;d.UNIT_SURVEY_CHAIN=9033;d.UNIT_SURVEY_LINK=9034;d.UNIT_SURVEY_MILE=9035;d.UNIT_KILOMETER=9036;d.UNIT_CLARKE_YARD=9037;d.UNIT_CLARKE_CHAIN=9038;d.UNIT_CLARKE_LINK=9039;d.UNIT_SEARS_YARD=9040;d.UNIT_SEARS_FOOT=9041;d.UNIT_SEARS_CHAIN=9042;d.UNIT_SEARS_LINK=
9043;d.UNIT_BENOIT_1895A_YARD=9050;d.UNIT_BENOIT_1895A_FOOT=9051;d.UNIT_BENOIT_1895A_CHAIN=9052;d.UNIT_BENOIT_1895A_LINK=9053;d.UNIT_BENOIT_1895B_YARD=9060;d.UNIT_BENOIT_1895B_FOOT=9061;d.UNIT_BENOIT_1895B_CHAIN=9062;d.UNIT_BENOIT_1895B_LINK=9063;d.UNIT_INDIAN_FOOT=9080;d.UNIT_INDIAN_1937_FOOT=9081;d.UNIT_INDIAN_1962_FOOT=9082;d.UNIT_INDIAN_1975_FOOT=9083;d.UNIT_INDIAN_YARD=9084;d.UNIT_INDIAN_1937_YARD=9085;d.UNIT_INDIAN_1962_YARD=9086;d.UNIT_INDIAN_1975_YARD=9087;d.UNIT_FOOT_1865=9070;d.UNIT_RADIAN=
9101;d.UNIT_DEGREE=9102;d.UNIT_ARCMINUTE=9103;d.UNIT_ARCSECOND=9104;d.UNIT_GRAD=9105;d.UNIT_GON=9106;d.UNIT_MICRORADIAN=9109;d.UNIT_ARCMINUTE_CENTESIMAL=9112;d.UNIT_ARCSECOND_CENTESIMAL=9113;d.UNIT_MIL6400=9114;d.UNIT_BRITISH_1936_FOOT=9095;d.UNIT_GOLDCOAST_FOOT=9094;d.UNIT_INTERNATIONAL_CHAIN=109003;d.UNIT_INTERNATIONAL_LINK=109004;d.UNIT_INTERNATIONAL_YARD=109001;d.UNIT_STATUTE_MILE=9093;d.UNIT_SURVEY_YARD=109002;d.UNIT_50KILOMETER_LENGTH=109030;d.UNIT_150KILOMETER_LENGTH=109031;d.UNIT_DECIMETER=
109005;d.UNIT_CENTIMETER=109006;d.UNIT_MILLIMETER=109007;d.UNIT_INTERNATIONAL_INCH=109008;d.UNIT_US_SURVEY_INCH=109009;d.UNIT_INTERNATIONAL_ROD=109010;d.UNIT_US_SURVEY_ROD=109011;d.UNIT_US_NAUTICAL_MILE=109012;d.UNIT_UK_NAUTICAL_MILE=109013;d.UNIT_SQUARE_INCHES="esriSquareInches";d.UNIT_SQUARE_FEET="esriSquareFeet";d.UNIT_SQUARE_YARDS="esriSquareYards";d.UNIT_ACRES="esriAcres";d.UNIT_SQUARE_MILES="esriSquareMiles";d.UNIT_SQUARE_MILLIMETERS="esriSquareMillimeters";d.UNIT_SQUARE_CENTIMETERS="esriSquareCentimeters";
d.UNIT_SQUARE_DECIMETERS="esriSquareDecimeters";d.UNIT_SQUARE_METERS="esriSquareMeters";d.UNIT_ARES="esriAres";d.UNIT_HECTARES="esriHectares";d.UNIT_SQUARE_KILOMETERS="esriSquareKilometers";a.__decorate([f.property()],d.prototype,"url",void 0);return d=a.__decorate([f.subclass("esri.tasks.GeometryService")],d)}(d)})},"esri/tasks/operations/generalize":function(){define(["require","exports","../../core/jsonMap","../../geometry/support/jsonUtils"],function(n,b,a,m){Object.defineProperty(b,"__esModule",
{value:!0});var h=new a.default({109006:"centimeters",9102:"decimal-degrees",109005:"decimeters",9002:"feet",109009:"inches",9036:"kilometers",9001:"meters",9035:"miles",109007:"millimeters",109012:"nautical-miles",9096:"yards"});b.generalizeToRESTParameters=function(a){var b=a.toJSON();a=b.geometries;var e=b.deviationUnit,b={maxDeviation:b.maxDeviation};a&&a.length&&(b.geometries=JSON.stringify({geometryType:m.getJsonType(a[0]),geometries:a}),b.sr=JSON.stringify(a[0].spatialReference));h.write(e,
b,"deviationUnit");return b}})},"esri/tasks/operations/lengths":function(){define(["require","exports","../../core/jsonMap"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});var m=new a.default({preserveShape:"preserve-shape"});b.lengthsToRESTParameters=function(a){var b=a.toJSON(),f=b.lengthUnit,g=b.geodesic,h=b.calculationType,d={};d.polylines=JSON.stringify(b.polylines);a=a.polylines[0].spatialReference;d.sr=a.wkid?a.wkid:JSON.stringify(a.toJSON());f&&(d.lengthUnit=f);g&&(d.geodesic=
g);h&&(d.calculationType=m.toJSON(h));return d}})},"esri/tasks/operations/offset":function(){define(["require","exports","../../core/jsonMap","../../geometry/support/jsonUtils"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});var h=new a.default({esriGeometryOffsetBevelled:"bevelled",esriGeometryOffsetMitered:"mitered",esriGeometryOffsetRounded:"rounded"}),e=new a.default({9001:"meters",9002:"feet",9036:"kilometers",9093:"miles",109012:"nautical-miles",109001:"yards"});b.offsetToRESTParameters=
function(a){var b=a.toJSON();a=b.geometries;var f=b.offsetHow,d=b.offsetUnit,b={bevelRatio:b.bevelRatio,offsetDistance:b.offsetDistance};a&&a.length&&(b.geometries=JSON.stringify({geometryType:m.getJsonType(a[0]),geometries:a}),b.sr=JSON.stringify(a[0].spatialReference));f&&(b.offsetHow=h.toJSON(f));d&&(b.offsetUnit=e.toJSON(d));return b}})},"esri/tasks/operations/relation":function(){define(["require","exports","../../core/jsonMap","../../geometry/support/jsonUtils"],function(n,b,a,m){Object.defineProperty(b,
"__esModule",{value:!0});var h=new a.default({esriGeometryRelationCross:"cross",esriGeometryRelationDisjoint:"disjoint",esriGeometryRelationIn:"in",esriGeometryRelationInteriorIntersection:"interior-intersection",esriGeometryRelationIntersection:"intersection",esriGeometryRelationLineCoincidence:"line-coincidence",esriGeometryRelationLineTouch:"line-touch",esriGeometryRelationOverlap:"overlap",esriGeometryRelationPointTouch:"point-touch",esriGeometryRelationTouch:"touch",esriGeometryRelationWithin:"within",
esriGeometryRelationRelation:"relation"});b.relationToRESTParameters=function(a){var b=a.toJSON(),e=b.geometries1;a=b.geometries2;var l=b.relation,b=b.relationParameter,d={};e&&e.length&&(d.geometries1=JSON.stringify({geometryType:m.getJsonType(e[0]),geometries:e}),e=e[0].spatialReference,d.sr=e.wkid?e.wkid:JSON.stringify(e));a&&0<a.length&&(d.geometries2=JSON.stringify({geometryType:m.getJsonType(a[0]),geometries:a}));l&&(d.relation=h.toJSON(l));b&&(d.relationParam=b);return d}})},"esri/tasks/operations/trimExtend":function(){define(["require",
"exports","../../core/jsonMap"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});var m=new a.default({0:"default-curve-extension",1:"relocate-ends",2:"keep-end-attributes",4:"no-end-attributes",8:"no-extend-at-from",16:"no-extend-at-to"});b.trimExtendToRESTParameters=function(a){a=a.toJSON();var b=a.polylines,f=a.trimExtendTo,g={};g.extendHow=m.toJSON(a.extendHow);b&&b.length&&(g.polylines=JSON.stringify(b),g.sr=JSON.stringify(b[0].spatialReference));f&&(g.trimExtendTo=JSON.stringify(f));
return g}})},"esri/tasks/support/GeneralizeParameters":function(){define("require exports tslib ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils".split(" "),function(n,b,a,m,h,e,f){n=function(b){function e(a){a=b.call(this,a)||this;a.deviationUnit=null;a.geometries=null;a.maxDeviation=null;return a}a.__extends(e,b);a.__decorate([h.property({type:String,json:{write:!0}})],e.prototype,"deviationUnit",void 0);a.__decorate([h.property({json:{read:{reader:function(a){return a?
a.map(function(a){return f.fromJSON(a)}):null}},write:{writer:function(a,c){c.geometries=a.map(function(a){return a.toJSON()})}}}})],e.prototype,"geometries",void 0);a.__decorate([h.property({type:Number,json:{write:!0}})],e.prototype,"maxDeviation",void 0);return e=a.__decorate([h.subclass("esri.tasks.support.GeneralizeParameters")],e)}(m.JSONSupport);n.from=e.default(n);return n})},"esri/tasks/support/LengthsParameters":function(){define("require exports tslib ../../geometry ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils".split(" "),
function(n,b,a,m,h,e,f,g){n=function(b){function d(a){a=b.call(this,a)||this;a.calculationType=null;a.geodesic=null;a.lengthUnit=null;a.polylines=null;return a}a.__extends(d,b);a.__decorate([e.property({type:String,json:{write:!0}})],d.prototype,"calculationType",void 0);a.__decorate([e.property({type:Boolean,json:{write:!0}})],d.prototype,"geodesic",void 0);a.__decorate([e.property({json:{write:!0}})],d.prototype,"lengthUnit",void 0);a.__decorate([e.property({type:[m.Polyline],json:{read:{reader:function(a){return a?
a.map(function(a){return g.fromJSON(a)}):null}},write:{writer:function(a,b){b.polylines=a.map(function(a){return a.toJSON()})}}}})],d.prototype,"polylines",void 0);return d=a.__decorate([e.subclass("esri.tasks.support.LengthsParameters")],d)}(h.JSONSupport);n.from=f.default(n);return n})},"esri/tasks/support/OffsetParameters":function(){define("require exports tslib ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils".split(" "),
function(n,b,a,m,h,e,f){n=function(b){function e(a){a=b.call(this,a)||this;a.bevelRatio=null;a.geometries=null;a.offsetDistance=null;a.offsetHow=null;a.offsetUnit=null;return a}a.__extends(e,b);a.__decorate([h.property({type:Number,json:{write:!0}})],e.prototype,"bevelRatio",void 0);a.__decorate([h.property({json:{read:{reader:function(a){return a?a.map(function(a){return f.fromJSON(a)}):null}},write:{writer:function(a,c){c.geometries=a.map(function(a){return a.toJSON()})}}}})],e.prototype,"geometries",
void 0);a.__decorate([h.property({type:Number,json:{write:!0}})],e.prototype,"offsetDistance",void 0);a.__decorate([h.property({type:String,json:{write:!0}})],e.prototype,"offsetHow",void 0);a.__decorate([h.property({type:String,json:{write:!0}})],e.prototype,"offsetUnit",void 0);return e=a.__decorate([h.subclass("esri.tasks.support.OffsetParameters")],e)}(m.JSONSupport);n.from=e.default(n);return n})},"esri/tasks/support/ProjectParameters":function(){define("require exports tslib ../../core/JSONSupport ../../core/Logger ../../core/accessorSupport/decorators ../../geometry/support/jsonUtils".split(" "),
function(n,b,a,m,h,e,f){var g=h.getLogger("esri.tasks.support.ProjectParameters");return function(b){function d(a){a=b.call(this,a)||this;a.geometries=null;a.outSpatialReference=null;a.transformation=null;a.transformForward=null;return a}a.__extends(d,b);Object.defineProperty(d.prototype,"outSR",{get:function(){g.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");return this.outSpatialReference},set:function(a){g.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");
this.outSpatialReference=a},enumerable:!0,configurable:!0});d.prototype.toJSON=function(){var a=this.geometries.map(function(a){return a.toJSON()}),b=this.geometries[0],d={};d.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());d.inSR=b.spatialReference.wkid||JSON.stringify(b.spatialReference.toJSON());d.geometries=JSON.stringify({geometryType:f.getJsonType(b),geometries:a});this.transformation&&(d.transformation=this.transformation.wkid||JSON.stringify(this.transformation));
null!=this.transformForward&&(d.transformForward=this.transformForward);return d};a.__decorate([e.property()],d.prototype,"geometries",void 0);a.__decorate([e.property({json:{read:{source:"outSR"}}})],d.prototype,"outSpatialReference",void 0);a.__decorate([e.property({json:{read:!1}})],d.prototype,"outSR",null);a.__decorate([e.property()],d.prototype,"transformation",void 0);a.__decorate([e.property()],d.prototype,"transformForward",void 0);return d=a.__decorate([e.subclass("esri.tasks.support.ProjectParameters")],
d)}(m.JSONSupport)})},"esri/tasks/support/RelationParameters":function(){define("require exports tslib ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils".split(" "),function(n,b,a,m,h,e,f){n=function(b){function e(a){a=b.call(this,a)||this;a.geometries1=null;a.geometries2=null;a.relation=null;a.relationParameter=null;return a}a.__extends(e,b);a.__decorate([h.property({json:{read:{reader:function(a){return a?a.map(function(a){return f.fromJSON(a)}):
null}},write:{writer:function(a,c){c.geometries1=a.map(function(a){return a.toJSON()})}}}})],e.prototype,"geometries1",void 0);a.__decorate([h.property({json:{read:{reader:function(a){return a?a.map(function(a){return f.fromJSON(a)}):null}},write:{writer:function(a,c){c.geometries2=a.map(function(a){return a.toJSON()})}}}})],e.prototype,"geometries2",void 0);a.__decorate([h.property({type:String,json:{write:!0}})],e.prototype,"relation",void 0);a.__decorate([h.property({type:String,json:{write:!0}})],
e.prototype,"relationParameter",void 0);return e=a.__decorate([h.subclass("esri.tasks.support.RelationParameters")],e)}(m.JSONSupport);n.from=e.default(n);return n})},"esri/tasks/support/TrimExtendParameters":function(){define("require exports tslib ../../geometry ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils".split(" "),function(n,b,a,m,h,e,f,g){n=function(b){function d(a){a=b.call(this,a)||this;a.extendHow="default-curve-extension";
a.polylines=null;a.trimExtendTo=null;return a}a.__extends(d,b);a.__decorate([e.property({type:String,json:{write:!0}})],d.prototype,"extendHow",void 0);a.__decorate([e.property({type:[m.Polyline],json:{read:{reader:function(a){return a?a.map(function(a){return g.fromJSON(a)}):null}},write:{writer:function(a,b){b.polylines=a.map(function(a){return a.toJSON()})}}}})],d.prototype,"polylines",void 0);a.__decorate([e.property({json:{read:{reader:function(a){return a?g.fromJSON(a):null}},write:{writer:function(a,
b){b.trimExtendTo=a.toJSON()}}}})],d.prototype,"trimExtendTo",void 0);return d=a.__decorate([e.subclass("esri.tasks.support.TrimExtendParameters")],d)}(h.JSONSupport);n.from=f.default(n);return n})},"esri/views/3d/support/QualitySettings":function(){define(["require","exports","tslib","../../../core/Accessor","../../../core/accessorSupport/decorators"],function(n,b,a,m,h){var e=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.minTotalNumberOfFeatures=2E3;a.maxTotalNumberOfFeatures=
5E4;a.maxTotalNumberOfPrimitives=17E5;a.polygonLodFactor=1;a.polylineLodFactor=1;return a}a.__extends(c,b);a.__decorate([h.property()],c.prototype,"minTotalNumberOfFeatures",void 0);a.__decorate([h.property()],c.prototype,"maxTotalNumberOfFeatures",void 0);a.__decorate([h.property()],c.prototype,"maxTotalNumberOfPrimitives",void 0);a.__decorate([h.property()],c.prototype,"polygonLodFactor",void 0);a.__decorate([h.property()],c.prototype,"polylineLodFactor",void 0);return c=a.__decorate([h.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],
c)}(m),f=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.lodFactor=1;return a}a.__extends(c,b);a.__decorate([h.property()],c.prototype,"lodFactor",void 0);return c=a.__decorate([h.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],c)}(m),g=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a["3dObject"]=new f;a.point=new f;a.integratedMesh=new f;a.pointCloud=new f;a.uncompressedTextureDownsamplingEnabled=!1;return a}a.__extends(c,b);a.__decorate([h.property({type:f})],
c.prototype,"3dObject",void 0);a.__decorate([h.property({type:f})],c.prototype,"point",void 0);a.__decorate([h.property({type:f})],c.prototype,"integratedMesh",void 0);a.__decorate([h.property({type:f})],c.prototype,"pointCloud",void 0);a.__decorate([h.property()],c.prototype,"uncompressedTextureDownsamplingEnabled",void 0);return c=a.__decorate([h.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],c)}(m),l=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;
a.lodBias=0;a.angledSplitBias=1;a.reduceTileLevelDifferences=!0;a.textureFadeDuration=500;return a}a.__extends(c,b);a.__decorate([h.property()],c.prototype,"lodBias",void 0);a.__decorate([h.property()],c.prototype,"angledSplitBias",void 0);a.__decorate([h.property()],c.prototype,"reduceTileLevelDifferences",void 0);a.__decorate([h.property()],c.prototype,"textureFadeDuration",void 0);return c=a.__decorate([h.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],c)}(m);return function(b){function c(){var a=
null!==b&&b.apply(this,arguments)||this;a.graphics3D=new e;a.sceneService=new g;a.tiledSurface=new l;a.antialiasingEnabled=!0;return a}a.__extends(c,b);a.__decorate([h.property({type:e})],c.prototype,"graphics3D",void 0);a.__decorate([h.property({type:g})],c.prototype,"sceneService",void 0);a.__decorate([h.property({type:l})],c.prototype,"tiledSurface",void 0);a.__decorate([h.property()],c.prototype,"antialiasingEnabled",void 0);a.__decorate([h.property()],c.prototype,"physicallyBasedRenderingEnabled",
void 0);a.__decorate([h.property()],c.prototype,"memoryLimit",void 0);a.__decorate([h.property()],c.prototype,"additionalCacheMemory",void 0);a.__decorate([h.property()],c.prototype,"frameRate",void 0);a.__decorate([h.property()],c.prototype,"maximumRenderResolution",void 0);a.__decorate([h.property()],c.prototype,"maximumPixelRatio",void 0);return c=a.__decorate([h.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],c)}(m)})},"esri/views/3d/support/RenderCoordsHelper":function(){define("require exports ../../../core/compilerUtils ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../geometry/SpatialReference ../../../layers/graphics/dehydratedFeatures ./earthUtils ./geometryUtils ./projectionUtils ./stack ./geometryUtils/coordinateSystem".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,c,b,d){this.type=a;this.spatialReference=c;this.unitInMeters=b;this.coordinateSystem=d;this.tmpCoordinateSystem=p.create(d)}Object.defineProperty(b.prototype,"extent",{set:function(a){a&&p.setExtent(this.coordinateSystem,a,this.coordinateSystem)},enumerable:!0,configurable:!0});b.prototype.getAltitude=function(a){return p.altitudeAt(this.coordinateSystem,a)};b.prototype.setAltitude=function(a,
c){p.setAltitudeAt(this.coordinateSystem,c,a,c)};b.prototype.setAltitudeOfTransformation=function(a,c){p.setAltitudeOfTransformation(this.coordinateSystem,c,a,c)};b.prototype.worldUpAtPosition=function(a,c){return p.normalAt(this.coordinateSystem,a,c)};b.prototype.worldBasisAtPosition=function(a,c,b){return p.axisAt(this.coordinateSystem,a,c,b)};b.prototype.basisMatrixAtPosition=function(a,c){var b=this.worldBasisAtPosition(a,0,k.sv3d.get()),d=this.worldBasisAtPosition(a,1,k.sv3d.get());a=this.worldBasisAtPosition(a,
2,k.sv3d.get());h.mat4.set(c,b[0],b[1],b[2],0,d[0],d[1],d[2],0,a[0],a[1],a[2],0,0,0,0,1);return c};b.prototype.intersectManifoldClosestSilhouette=function(a,c,b){p.elevate(this.coordinateSystem,c,this.tmpCoordinateSystem);p.intersectRayClosestSilhouette(this.tmpCoordinateSystem,a,b);return b};b.prototype.intersectManifold=function(a,c,b){p.elevate(this.coordinateSystem,c,this.tmpCoordinateSystem);c=k.sv3d.get();return p.intersectRay(this.tmpCoordinateSystem,a,c)?(e.vec3.copy(b,c),!0):!1};b.prototype.intersectInfiniteManifold=
function(a,c,b){if("global"===this.type)return this.intersectManifold(a,c,b);p.elevate(this.coordinateSystem,c,this.tmpCoordinateSystem);c=this.tmpCoordinateSystem.value;var f=k.sv3d.get();return d.plane.intersectRay(c.plane,a,f)?(e.vec3.copy(b,f),!0):!1};b.prototype.toRenderCoords=function(a,b,d){return g.isPoint(a)?c.pointToVector(a,b,this.spatialReference):c.vectorToVector(a,b,d,this.spatialReference)};b.prototype.fromRenderCoords=function(a,b,d){return g.isPoint(b)?c.vectorToPoint(a,this.spatialReference,
b,d):b instanceof f?c.vectorToPoint(a,this.spatialReference,b):c.vectorToVector(a,this.spatialReference,b,d)};b.createGlobal=function(a){var c=p.fromValues(d.sphere,d.sphere.fromValues(l.earthRadius,[0,0,0]));return new b("global",a,1,c)};b.createLocal=function(a){var c=p.fromValues(d.boundedPlane,d.boundedPlane.fromValues([0,0,0],[r,0,0],[0,r,0])),e=m.getMetersPerUnitForSR(a);return new b("local",a,e,c)};b.createMode=function(c,d){switch(c){case "local":return b.createLocal(d);case "global":return b.createGlobal(d);
default:a.neverReached(c)}};return b}();b.RenderCoordsHelper=n;var r=Math.pow(2,50)})},"esri/views/3d/support/SceneViewPerformanceInfo":function(){define(["require","exports","../layers/support/MemoryManagedLayerView","./LayerPerformanceInfo","../terrain/terrainUtils"],function(n,b,a,m,h){return function(){return function(b){var e=this;this.usedMemory=this.totalMemory=0;this.quality=1;this.edgesMemory=this.terrainMemory=this.load=0;this.layerPerformanceInfos=[];var g=b.resourceController.memoryController;
this.totalMemory=1048576*g.maxMemory;this.usedMemory=Math.round(g.usedMemory*this.totalMemory);this.quality=g.memoryFactor;this.load=b.resourceController.scheduler.load;this.terrainMemory=b.basemapTerrain?b.basemapTerrain.getUsedMemory():0;this.edgesMemory=(g=b._stage&&b._stage.renderView&&b._stage.renderView.edgeView)?g.getUsedMemory():0;b.allLayerViews.items.forEach(function(f){(a.isMemoryManagedLayerView(f)||h.isSurfaceLayerView(f))&&e.layerPerformanceInfos.push(new m(f,b))});this.layerPerformanceInfos.sort(function(a,
b){return b.memory-a.memory})}}()})},"esri/views/3d/support/LayerPerformanceInfo":function(){define(["require","exports","../layers/support/PerformanceInfoLayerView","../terrain/terrainUtils"],function(n,b,a,m){return function(){return function(b,e){this.layer=null;this.displayedNumberOfFeatures=this.memory=0;this.totalNumberOfFeatures=this.maximumNumberOfFeatures=null;this.layer=b.layer;this.memory=m.isSurfaceLayerView(b)?e.basemapTerrain.getUsedMemoryForLayerView(b):b.getUsedMemory();a.isPerformanceInfoLayerView(b)&&
(b=b.performanceInfo,this.displayedNumberOfFeatures=b.displayedNumberOfFeatures,this.maximumNumberOfFeatures=b.maximumNumberOfFeatures,this.totalNumberOfFeatures=b.totalNumberOfFeatures)}}()})},"esri/views/3d/layers/support/PerformanceInfoLayerView":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.isPerformanceInfoLayerView=function(a){return"performanceInfo"in a}})},"esri/views/3d/terrain/terrainUtils":function(){define("require exports ../../../layers/ElevationLayer ../../../layers/TileLayer ../../../layers/VectorTileLayer ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./RasterTile ./terrainUtilsPlanar ./terrainUtilsSpherical ./TileTexture".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c){function k(a){return a&&"esri.views.3d.layers.ImageryTileLayerView3D"===a.declaredClass}function p(a){return a&&"esri.views.3d.layers.TileLayerView3D"===a.declaredClass}function r(a){return a&&"esri.views.3d.layers.VectorTileLayerView3D"===a.declaredClass}function t(a){return a&&"esri.views.3d.layers.WMTSLayerView3D"===a.declaredClass}function u(a){return a&&"esri.views.3d.layers.ElevationLayerView3D"===a.declaredClass}function v(a,c,b,d){return z["local"===d||"planar"===
d?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(a,b,c)}Object.defineProperty(b,"__esModule",{value:!0});var z={planar:l,spherical:d};b.weakAssert=function(a,c){a||console.warn("Terrain: "+c)};var w=80/180*Math.PI,q=110/180*Math.PI;b.autoUpdateSkirtsVisibility=function(a,c,b,d){var e=z[a.manifold],f=e.isInsideExtent(a,c);f?b=a.getElevation(c[0],c[1],c[1],b):(b=a.elevationBounds,b=.5*(b.min+b.max));b=c[2]-b;d=Math.abs(b)<d?0:0>b?-1:1;f||(e.isInsideExtent(a,c,1.2)?(c=e.tiltToExtentEdge(a,c),
c>w&&c<q&&(d=0)):d=0);a.skirtScale=d};b.getLayerWithExtentRange=function(a){return k(a)?{fullExtent:a.fullExtent,minScale:a.layer.minScale,maxScale:a.layer.maxScale,tilemapCache:null}:a.layer};b.isVectorTileLayer=function(a){return a&&a instanceof h};b.isImageryTileLayerView=k;b.isTileLayerView=p;b.isVectorTileLayerView=r;b.isWMTSLayerView=t;b.isElevationLayerView=u;b.isSurfaceLayerView=function(a){return a&&(p(a)||k(a)||u(a)||r(a)||t(a))};b.isImageryTileRenderInfo=function(a){return a&&a.sourceLayerInfo&&
a.sourceLayerInfo.data instanceof g.default};b.isVectorTileRenderInfo=function(a){return a&&a.sourceLayerInfo&&a.sourceLayerInfo.data instanceof e.VectorTile};b.isTextureTileRenderInfo=function(a){return a&&a.sourceLayerInfo&&a.sourceLayerInfo.data instanceof c.TileTexture};b.isRasterTileRenderInfo=function(a){a=a&&a.sourceLayerInfo&&a.sourceLayerInfo.data;return a instanceof HTMLImageElement||a instanceof f.ImageWithType||a instanceof HTMLCanvasElement||a instanceof ImageData};b.useFetchTileForLayer=
function(c){return c.fetchTile&&!(c.fetchTile===m.prototype.fetchTile||c.fetchTile===a.prototype.fetchTile)};b.checkIfTileInfoSupportedForView=v;b.getTiledLayerInfo=function(a,c,d){var e,f;if("wmts"===a.type){if(a=a.activeLayer){var g=a.tileMatrixSet;if(g)e=g.tileInfo,f=g.fullExtent;else if(a=a.tileMatrixSets)if(a=a.find(function(a){return null==v(a.tileInfo,a.fullExtent,c,d)}))return{tileInfo:a.tileInfo,fullExtent:a.fullExtent}}}else f="imagery-tile"===a.type?a.getCompatibleFullExtent(c):a.fullExtent,
e="vector-tile"!==a.type||b.test.force512VTL?"imagery-tile"===a.type?a.getCompatibleTileInfo(c,f):a.tileInfo:a.compatibleTileInfo256;return e&&f&&null==v(e,f,c,d)?{tileInfo:e,fullExtent:f}:{tileInfo:null,fullExtent:null}};b.test={force512VTL:!1}})},"esri/layers/ElevationLayer":function(){define("require exports tslib ../request ../core/deprecate ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/HeightModelInfo ./Layer ./mixins/ArcGISCachedService ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./support/commonProperties ./support/LercDecoder @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q){var y=f.getLogger("esri.layers.ElevationLayer");return function(b){function f(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];a=b.apply(this,a)||this;a.copyright=null;a.heightModelInfo=null;a.path=null;a.opacity=1;a.operationalLayerType="ArcGISTiledElevationServiceLayer";a.sourceJSON=null;a.type="elevation";a.url=null;a.version=null;a._lercDecoder=q.acquireInstance();return a}a.__extends(f,b);f.prototype.normalizeCtorArgs=function(c,b){return"string"===
typeof c?a.__assign({url:c},b):c};f.prototype.destroy=function(){q.releaseInstance(this._lercDecoder);this._lercDecoder=null};Object.defineProperty(f.prototype,"minScale",{get:function(){},set:function(a){this.constructed&&y.warn(this.declaredClass+".minScale support has been removed (since 4.5)")},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"maxScale",{get:function(){},set:function(a){this.constructed&&y.warn(this.declaredClass+".maxScale support has been removed (since 4.5)")},
enumerable:!0,configurable:!0});f.prototype.readVersion=function(a,c){(a=c.currentVersion)||(a=9.3);return a};f.prototype.load=function(a){var c=this,b=g.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:function(a){for(var c=0;c<a.typeKeywords.length;c++)if("elevation 3d layer"===a.typeKeywords[c].toLowerCase())return!0;throw new e("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",
{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"});}},a).then(function(){return c._fetchImageService(b)},function(){return c._fetchImageService(b)}));return d.resolve(this)};f.prototype.fetchTile=function(a,c,b,d){var e=this;void 0===d&&(d={});null!=d&&"number"===typeof d&&(h.deprecated(y,"Passing 'noDataValue' directly as a parameter",{replacement:"use { noDataValue } options object instead",version:"4.12"}),d={noDataValue:d});var f={responseType:"array-buffer",signal:d.signal},
g={noDataValue:d.noDataValue,returnFileInfo:!0};return this.load().then(function(){return e._fetchTileAvailability(a,c,b,d)}).then(function(){return m(e.getTileUrl(a,c,b),f)}).then(function(a){return e._lercDecoder.decode(a.data,g,d.signal)}).then(function(a){return{values:a.pixelData,width:a.width,height:a.height,maxZError:a.fileInfo.maxZError,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue}})};f.prototype.getTileUrl=function(b,d,e){var f=!this.tilemapCache&&this.supportsBlankTile,
f=c.objectToQuery(a.__assign(a.__assign({},this.parsedUrl.query),{blankTile:f?!1:null}));return this.parsedUrl.path+"/tile/"+b+"/"+d+"/"+e+(f?"?"+f:"")};f.prototype.queryElevation=function(a,c){var b=this;return this._importElevationQuery().then(function(d){return(new d.ElevationQuery).query(b,a,c)})};f.prototype.createElevationSampler=function(a,c){var b=this;return this._importElevationQuery().then(function(d){return(new d.ElevationQuery).createSampler(b,a,c)})};f.prototype._fetchTileAvailability=
function(a,c,b,e){return this.tilemapCache?this.tilemapCache.fetchAvailability(a,c,b,e):d.resolve("unknown")};f.prototype._fetchImageService=function(c){return a.__awaiter(this,void 0,void 0,function(){var b,d;return a.__generator(this,function(e){switch(e.label){case 0:if(this.sourceJSON)return[2,this.sourceJSON];b={query:a.__assign({f:"json"},this.parsedUrl.query),responseType:"json",signal:c};return[4,m(this.parsedUrl.path,b)];case 1:return d=e.sent(),d.ssl&&(this.url=this.url.replace(/^http:/i,
"https:")),this.sourceJSON=d.data,this.read(d.data,{origin:"service",url:this.parsedUrl}),[2]}})})};f.prototype._importElevationQuery=function(){return new Promise(function(a,c){n(["./support/ElevationQuery"],a,c)})};a.__decorate([k.property({json:{read:{source:"copyrightText"}}})],f.prototype,"copyright",void 0);a.__decorate([k.property({readOnly:!0,type:p})],f.prototype,"heightModelInfo",void 0);a.__decorate([k.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],f.prototype,
"path",void 0);a.__decorate([k.property({type:["show","hide"]})],f.prototype,"listMode",void 0);a.__decorate([k.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],f.prototype,"minScale",null);a.__decorate([k.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],f.prototype,"maxScale",null);a.__decorate([k.property({json:{read:!1,
write:!1,origins:{"web-document":{read:!1,write:!1}}}})],f.prototype,"opacity",void 0);a.__decorate([k.property({type:["ArcGISTiledElevationServiceLayer"]})],f.prototype,"operationalLayerType",void 0);a.__decorate([k.property()],f.prototype,"sourceJSON",void 0);a.__decorate([k.property({json:{read:!1},value:"elevation",readOnly:!0})],f.prototype,"type",void 0);a.__decorate([k.property(w.url)],f.prototype,"url",void 0);a.__decorate([k.property()],f.prototype,"version",void 0);a.__decorate([k.reader("version",
["currentVersion"])],f.prototype,"readVersion",null);return f=a.__decorate([k.subclass("esri.layers.ElevationLayer")],f)}(t.ArcGISCachedService(u.ArcGISService(v.OperationalLayer(z.PortalLayer(l.MultiOriginJSONMixin(r))))))})},"esri/layers/mixins/ArcGISCachedService":function(){define("require exports tslib ../../geometry ../../core/accessorSupport/decorators ../support/serviceTileInfoProperty ../support/TilemapCache".split(" "),function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});
b.ArcGISCachedService=function(b){return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.copyright=null;a.minScale=0;a.maxScale=0;a.spatialReference=null;a.tileInfo=null;a.tilemapCache=null;return a}a.__extends(d,b);d.prototype.readMinScale=function(a,b){return null!=b.minLOD&&null!=b.maxLOD?a:0};d.prototype.readMaxScale=function(a,b){return null!=b.minLOD&&null!=b.maxLOD?a:0};Object.defineProperty(d.prototype,"supportsBlankTile",{get:function(){return 10.2<=this.version},
enumerable:!0,configurable:!0});d.prototype.readTilemapCache=function(a,b){return b.capabilities&&-1<b.capabilities.indexOf("Tilemap")?new f.TilemapCache({layer:this}):null};a.__decorate([h.property({json:{read:{source:"copyrightText"}}})],d.prototype,"copyright",void 0);a.__decorate([h.property()],d.prototype,"minScale",void 0);a.__decorate([h.reader("service","minScale")],d.prototype,"readMinScale",null);a.__decorate([h.property()],d.prototype,"maxScale",void 0);a.__decorate([h.reader("service",
"maxScale")],d.prototype,"readMaxScale",null);a.__decorate([h.property({type:m.SpatialReference})],d.prototype,"spatialReference",void 0);a.__decorate([h.property({readOnly:!0,dependsOn:["version"]})],d.prototype,"supportsBlankTile",null);a.__decorate([h.property(e.serviceTileInfoProperty)],d.prototype,"tileInfo",void 0);a.__decorate([h.property()],d.prototype,"tilemapCache",void 0);a.__decorate([h.reader("service","tilemapCache",["capabilities"])],d.prototype,"readTilemapCache",null);a.__decorate([h.property()],
d.prototype,"version",void 0);return d=a.__decorate([h.subclass("esri.layers.mixins.ArcGISCachedService")],d)}(b)}})},"esri/layers/support/serviceTileInfoProperty":function(){define(["require","exports","tslib","./TileInfo"],function(n,b,a,m){function h(b,f,g,h){if(!b)return null;g=f.minScale;var d=f.maxScale,c=f.minLOD,e=f.maxLOD;if(null!=c&&null!=e)return h&&h.ignoreMinMaxLOD?m.fromJSON(b):m.fromJSON(a.__assign(a.__assign({},b),{lods:b.lods.filter(function(a){a=a.level;return null!=a&&a>=c&&a<=
e})}));if(0!==g&&0!==d){var l=g?Math.round(1E4*g)/1E4:Infinity,r=d?Math.round(1E4*d)/1E4:-Infinity;return m.fromJSON(a.__assign(a.__assign({},b),{lods:b.lods.filter(function(a){a=Math.round(1E4*a.scale)/1E4;return a<=l&&a>=r})}))}return m.fromJSON(b)}Object.defineProperty(b,"__esModule",{value:!0});b.serviceTileInfoProperty={type:m,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:h}}}}};b.readServiceTileInfo=h})},"esri/layers/support/TilemapCache":function(){define("require exports tslib ../../request ../../core/Accessor ../../core/Error ../../core/Handles ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/urlUtils ../../core/watchUtils ../../core/accessorSupport/decorators ./Tilemap".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u){Object.defineProperty(b,"__esModule",{value:!0});var v=g.getLogger("esri.layers.support.TilemapCache");n=function(b){function g(a){a=b.call(this,a)||this;a._handles=new f;a._pendingTilemapRequests={};a._availableLevels={};a.levels=5;a.cacheByteSize=2097152;a.request=m;a._prefetchingEnabled=!0;return a}a.__extends(g,b);h=g;g.prototype.initialize=function(){var a=this;this._tilemapCache=new l(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl",
"layer.tileServers?"],function(){return a._initializeTilemapDefinition()}),r.init(this,"layer.tileInfo.lods",function(c){return a._initializeAvailableLevels(c)},!0)]);this._initializeTilemapDefinition()};g.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};g.prototype.castLevels=function(a){return 2>=a?(v.error("Minimum levels for Tilemap is 3, but got ",a),3):a};Object.defineProperty(g.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0});
g.prototype.fetchTilemap=function(b,d,f,g){var k=this;if(!this._availableLevels[b])return c.reject(new e("tilemap-cache:level-unavailable","Level "+b+" is unavailable in the service"));var h=this._tmpTilemapDefinition;if(b=this._tilemapFromCache(b,d,f,h))return c.resolve(b);var l=g&&g.signal;g=a.__assign(a.__assign({},g),{signal:null});return c.create(function(a,b){c.onAbort(l,function(){return b(c.createAbortError())});var d=u.tilemapDefinitionId(h),e=k._pendingTilemapRequests[d];if(!e){var e=u.Tilemap.fromDefinition(h,
g).then(function(a){k._tilemapCache.put(d,a,a.byteSize);return a}),f=function(){return delete k._pendingTilemapRequests[d]};k._pendingTilemapRequests[d]=e;e.then(f,f)}e.then(a,b)})};g.prototype.getAvailability=function(a,c,b){return this._availableLevels[a]?(a=this._tilemapFromCache(a,c,b,this._tmpTilemapDefinition))?a.getAvailability(c,b):"unknown":"unavailable"};g.prototype.getAvailabilityUpsample=function(a,c,b,d){d.level=a;d.row=c;d.col=b;a=this.layer.tileInfo;for(a.updateTileInfo(d);;)if(c=this.getAvailability(d.level,
d.row,d.col),"unavailable"===c){if(!a.upsampleTile(d))return"unavailable"}else return c};g.prototype.fetchAvailability=function(a,b,d,f){return this._availableLevels[a]?this.fetchTilemap(a,b,d,f).catch(function(a){return a}).then(function(f){if(f instanceof u.Tilemap)return f=f.getAvailability(b,d),"unavailable"===f?c.reject(new e("tile-map:tile-unavailable","Tile is not available",{level:a,row:b,col:d})):f;if(c.isAbortError(f))throw f;return"unknown"}):c.reject(new e("tilemap-cache:level-unavailable",
"Level "+a+" is unavailable in the service"))};g.prototype.fetchAvailabilityUpsample=function(a,b,d,e,f){var g=this;e.level=a;e.row=b;e.col=d;var k=this.layer.tileInfo;k.updateTileInfo(e);var h=this.fetchAvailability(a,b,d,f).catch(function(a){if(c.isAbortError(a))throw a;if(k.upsampleTile(e))return g.fetchAvailabilityUpsample(e.level,e.row,e.col,e);throw a;});this._fetchAvailabilityUpsamplePrefetch(e.id,a,b,d,f,h);return h};g.prototype._fetchAvailabilityUpsamplePrefetch=function(b,d,e,f,g,l){return a.__awaiter(this,
void 0,void 0,function(){var m,p,q,r,t,u,v,w,z,n;return a.__generator(this,function(y){switch(y.label){case 0:if(!this._prefetchingEnabled)return[2];m="prefetch-"+b;if(this._handles.has(m))return[2];p=c.createAbortController();l.then(function(){return p.abort()},function(){return p.abort()});q=!1;r={remove:function(){q||(q=!0,p.abort())}};this._handles.add(r,m);y.label=1;case 1:return y.trys.push([1,3,,4]),[4,k.waitTicks(10,p.signal)];case 2:return y.sent(),[3,4];case 3:return y.sent(),[3,4];case 4:q||
(q=!0,this._handles.remove(m));if(c.isAborted(p))return[2];t={id:b,level:d,row:e,col:f};u=a.__assign(a.__assign({},g),{signal:p.signal});v=this.layer.tileInfo;w=function(a){var c=z.fetchAvailability(t.level,t.row,t.col,u);h._prefetches.push(c);a=function(){h._prefetches.removeUnordered(c)};c.then(a,a)};z=this;for(n=0;h._prefetches.length<h._maxPrefetch&&v.upsampleTile(t);++n)w(n);return[2]}})})};g.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var a=this.layer.parsedUrl,
c=a.query;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:a.path,query:c?p.objectToQuery(c):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};g.prototype._tilemapFromCache=function(a,c,b,d){d.level=a;d.row=c-c%this.size;d.col=b-b%this.size;a=u.tilemapDefinitionId(d);return this._tilemapCache.get(a)};g.prototype._initializeAvailableLevels=function(a){var c=this;this._availableLevels={};a&&a.forEach(function(a){return c._availableLevels[a.level]=
!0})};Object.defineProperty(g.prototype,"test",{get:function(){var a=this;return{get prefetchingEnabled(){return a._prefetchingEnabled},set prefetchingEnabled(c){a._prefetchingEnabled=c},hasTilemap:function(c,b,d){return!!a._tilemapFromCache(c,b,d,a._tmpTilemapDefinition)}}},enumerable:!0,configurable:!0});var h;g._maxPrefetch=4;g._prefetches=new d({initialSize:h._maxPrefetch});a.__decorate([t.property({constructOnly:!0,type:Number})],g.prototype,"levels",void 0);a.__decorate([t.cast("levels")],g.prototype,
"castLevels",null);a.__decorate([t.property({readOnly:!0,dependsOn:["levels"],type:Number})],g.prototype,"size",null);a.__decorate([t.property({constructOnly:!0,type:Number})],g.prototype,"cacheByteSize",void 0);a.__decorate([t.property({constructOnly:!0})],g.prototype,"layer",void 0);a.__decorate([t.property({constructOnly:!0})],g.prototype,"request",void 0);return g=h=a.__decorate([t.subclass("esri.layers.support.TilemapCache")],g)}(h);b.TilemapCache=n})},"esri/layers/support/Tilemap":function(){define("require exports tslib ../../request ../../core/arrayUtils ../../core/Error ../../core/lang".split(" "),
function(n,b,a,m,h,e,f){function g(a){var b;"vector-tile"===a.service.type?b=a.service.url+"/tilemap/"+a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height:(b=a.service.tileServers,b=(b&&b.length?b[a.row%b.length]:a.service.url)+"/tilemap/"+a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height);(a=a.service.query)&&(b=b+"?"+a);return b}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this.location={left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=
40}b.prototype.getAvailability=function(a,c){if("unknown"!==this._allAvailability)return this._allAvailability;a=(a-this.location.top)*this.location.width+(c-this.location.left);c=a>>3;var b=this._tileAvailabilityBitSet;return 0>c||c>b.length?"unknown":b[c]&1<<a%8?"available":"unavailable"};b.prototype._updateFromData=function(a){for(var c=!0,b=!0,d=new Uint8Array(Math.ceil(this.location.width*this.location.height/8)),e=0,f=0;f<a.length;f++){var g=f%8;a[f]?(b=!1,d[e]|=1<<g):c=!1;7===g&&++e}b?this._allAvailability=
"unavailable":c?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=d,this.byteSize+=d.length)};b.fromDefinition=function(d,c){var f=d.service.request||m,l=d.row,r=d.col,t=d.width,u=d.height,v={query:{f:"json"}};c=c?a.__assign(a.__assign({},v),c):v;return f(g(d),c).then(function(a){return a.data}).catch(function(a){if(a&&a.details&&422===a.details.httpStatus)return{location:{top:l,left:r,width:t,height:u},valid:!0,data:h.constant(t*u,0)};throw a;}).then(function(a){if(a.location&&
(a.location.top!==l||a.location.left!==r||a.location.width!==t||a.location.height!==u))throw new e("tilemap:location-mismatch","Tilemap response for different location than requested",{response:a,definition:{top:l,left:r,width:t,height:u}});return b.fromJSON(a)})};b.fromJSON=function(a){b.validateJSON(a);var c=new b;c.location=Object.freeze(f.clone(a.location));c._updateFromData(a.data);return Object.freeze(c)};b.validateJSON=function(a){if(!a||!a.location)throw new e("tilemap:missing-location","Location missing from tilemap response");
if(!1===a.valid)throw new e("tilemap:invalid","Tilemap response was marked as invalid");if(!a.data)throw new e("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(a.data))throw new e("tilemap:data-mismatch","Data must be an array of numbers");if(a.data.length!==a.location.width*a.location.height)throw new e("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");};return b}();b.Tilemap=n;b.tilemapDefinitionId=function(a){return a.level+"/"+
a.row+"/"+a.col+"/"+a.width+"/"+a.height};b.tilemapDefinitionUrl=g;b.default=n})},"esri/layers/support/LercDecoder":function(){define("require exports tslib ../../core/promiseUtils ../../views/3d/support/WorkerHandle @dojo/framework/shim/Promise".split(" "),function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});var e=function(b){function e(a){var c=b.call(this,"LercWorker","_decode",a,{strategy:"dedicated"})||this;c.scheduler=a;return c}a.__extends(e,b);e.prototype.decode=function(a,
c,b){return a&&0!==a.byteLength?this.invoke({buffer:a,options:c},b):m.resolve(null)};e.prototype.getTransferList=function(a){return[a.buffer]};return e}(h.WorkerHandle),f=new Map;b.acquireInstance=function(a){var b=f.get(a);b||(b={instance:new e(a),ref:0},f.set(a,b));++b.ref;return b.instance};b.releaseInstance=function(a){if(null!=a){a=a.scheduler;var b=f.get(a);b&&0>=--b.ref&&(b.instance.destroy(),f.delete(a))}}})},"esri/views/3d/support/WorkerHandle":function(){define("require exports tslib ../../../core/Logger ../../../core/promiseUtils ../../../core/workers".split(" "),
function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});var f=m.getLogger("esri.views.3d.support.WorkerHandle");n=function(){function b(b,d,c,g){var k=this;void 0===g&&(g={});this._methodName=d;this._promise=e.open(b,a.__assign(a.__assign({},g),{scheduler:c})).then(function(a){void 0===k._thread?(k._thread=a,k._promise=null):a.close()});this._promise.catch(function(a){return f.error("Failed to initialize "+b+" worker: "+a)})}b.prototype.destroy=function(){this._thread&&(this._thread.close(),
this._thread=null);this._promise=null};b.prototype.invoke=function(a,b){var c=this;void 0===b&&(b=null);if(this._thread){var d=this.getTransferList(a);return this._thread.invoke(this._methodName,a,{transferList:d,signal:b})}return this._promise?this._promise.then(function(){h.throwIfAborted(b);return c.invoke(a,b)}):h.reject(null)};b.prototype.broadcast=function(a,b){var c=this;return this._thread?h.all(this._thread.broadcast(b,a)).then(function(){}):this._promise?this._promise.then(function(){return c.broadcast(a,
b)}):h.reject()};Object.defineProperty(b.prototype,"promise",{get:function(){return this._promise},enumerable:!0,configurable:!0});return b}();b.WorkerHandle=n})},"esri/layers/TileLayer":function(){define("require exports tslib ../geometry ../request ../core/Error ../core/HandleOwner ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ./Layer ./mixins/ArcGISCachedService ./mixins/ArcGISMapService ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./support/arcgisLayerUrl ./support/arcgisLayerUrl ./support/commonProperties ./support/Sublayer".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F){var H="Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" ");return function(b){function f(){for(var a=[],
c=0;c<arguments.length;c++)a[c]=arguments[c];a=b.apply(this,a)||this;a.listMode="show";a.isReference=null;a.operationalLayerType="ArcGISTiledMapServiceLayer";a.resampling=!0;a.sourceJSON=null;a.spatialReference=null;a.path=null;a.sublayers=null;a.type="tile";a.url=null;return a}a.__extends(f,b);f.prototype.normalizeCtorArgs=function(c,b){return"string"===typeof c?a.__assign({url:c},b):c};f.prototype.load=function(a){var c=this,b=g.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},
a).then(function(){return c._fetchService(b)},function(){return c._fetchService(b)}));return d.resolve(this)};Object.defineProperty(f.prototype,"attributionDataUrl",{get:function(){return this._getDefaultAttribution(this._getMapName(this.parsedUrl.path.toLowerCase()))},enumerable:!0,configurable:!0});f.prototype.readSpatialReference=function(a,c){return(a=a||c.tileInfo&&c.tileInfo.spatialReference)&&m.SpatialReference.fromJSON(a)};f.prototype.writeSublayers=function(c,b,d,e){if(this.loaded&&c){c=
c.slice().reverse().flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).toArray();var f=[],g=a.__assign({writeSublayerStructure:!1},e);c.forEach(function(a){a=a.write({},g);f.push(a)});f.some(function(a){return 1<Object.keys(a).length})&&(b.layers=f)}};Object.defineProperty(f.prototype,"tileServers",{get:function(){return this._getDefaultTileServers(this.parsedUrl.path)},enumerable:!0,configurable:!0});f.prototype.castTileServers=function(a){return Array.isArray(a)?a.map(function(a){return c.urlToObject(a).path}):
null};f.prototype.fetchTile=function(a,c,b,d){void 0===d&&(d={});var e=d.signal,f=d.timestamp;a=this.getTileUrl(a,c,b);e={responseType:"image",signal:e};null!=f&&(e.query={_ts:d.timestamp});return h(a,e).then(function(a){return a.data})};f.prototype.getTileUrl=function(b,d,e){var f=!this.tilemapCache&&this.supportsBlankTile,f=c.objectToQuery(a.__assign(a.__assign({},this.parsedUrl.query),{blankTile:f?!1:null})),g=this.tileServers;return(g&&g.length?g[d%g.length]:this.parsedUrl.path)+"/tile/"+b+"/"+
d+"/"+e+(f?"?"+f:"")};f.prototype._fetchService=function(c){var b=this;return d.create(function(d,f){if(b.sourceJSON){if(null!=b.sourceJSON.bandCount&&null!=b.sourceJSON.pixelSizeX)throw new e("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");d({data:b.sourceJSON})}else{if(!b.parsedUrl)throw new e("tile-layer:undefined-url","layer's url is not defined");var g=B.parse(b.parsedUrl.path);if(g&&"ImageServer"===g.serverType)throw new e("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");
h(b.parsedUrl.path,{query:a.__assign({f:"json"},b.parsedUrl.query),responseType:"json",signal:c}).then(d,f)}}).then(function(a){a.ssl&&(b.url=b.url.replace(/^http:/i,"https:"));b.sourceJSON=a.data;b.read(a.data,{origin:"service",url:b.parsedUrl});if(10.1===b.version&&!B.isHostedAgolService(b.url))return b._fetchServerVersion(b.url,c).then(function(a){b.read({currentVersion:a})}).catch(function(){})})};f.prototype._fetchServerVersion=function(a,c){if(!A.isArcGISUrl(a))return d.reject();a=a.replace(/(.*\/rest)\/.*/i,
"$1")+"/info";return h(a,{query:{f:"json"},responseType:"json",signal:c}).then(function(a){if(a.data&&a.data.currentVersion)return a.data.currentVersion;throw new e("tile-layer:version-not-available");})};f.prototype._getMapName=function(a){return(a=a.match(/^(?:https?:)?\/\/(server|services)\.arcgisonline\.com\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i))&&a[2]};f.prototype._getDefaultAttribution=function(a){if(a){var b;a=a.toLowerCase();for(var d=0,e=H.length;d<e;d++)if(b=H[d],-1<
b.toLowerCase().indexOf(a))return c.makeAbsolute("//static.arcgis.com/attribution/"+b)}};f.prototype._getDefaultTileServers=function(a){var c=-1!==a.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),b=-1!==a.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);return c||b?[a,a.replace(c?/server\.arcgisonline/i:/services\.arcgisonline/i,c?"services.arcgisonline":"server.arcgisonline")]:[]};a.__decorate([k.property({readOnly:!0,dependsOn:["parsedUrl"]})],f.prototype,"attributionDataUrl",null);
a.__decorate([k.property({type:["show","hide","hide-children"]})],f.prototype,"listMode",void 0);a.__decorate([k.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],f.prototype,"isReference",void 0);a.__decorate([k.property({readOnly:!0})],f.prototype,"operationalLayerType",void 0);a.__decorate([k.property({type:Boolean})],f.prototype,"resampling",void 0);a.__decorate([k.property()],f.prototype,"sourceJSON",void 0);a.__decorate([k.property({type:m.SpatialReference})],
f.prototype,"spatialReference",void 0);a.__decorate([k.reader("spatialReference",["spatialReference","tileInfo"])],f.prototype,"readSpatialReference",null);a.__decorate([k.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],f.prototype,"path",void 0);a.__decorate([k.property({readOnly:!0})],f.prototype,"sublayers",void 0);a.__decorate([k.writer("sublayers",{layers:{type:[F]}})],f.prototype,"writeSublayers",null);a.__decorate([k.property({json:{read:!1,write:!1}})],f.prototype,
"popupEnabled",void 0);a.__decorate([k.property({dependsOn:["parsedUrl"]})],f.prototype,"tileServers",null);a.__decorate([k.cast("tileServers")],f.prototype,"castTileServers",null);a.__decorate([k.property({readOnly:!0,json:{read:!1}})],f.prototype,"type",void 0);a.__decorate([k.property(C.url)],f.prototype,"url",void 0);return f=a.__decorate([k.subclass("esri.layers.TileLayer")],f)}(y.SublayersOwner(q.ScaleRangeLayer(w.RefreshableLayer(v.OperationalLayer(z.PortalLayer(r.ArcGISCachedService(t.ArcGISMapService(u.ArcGISService(l.MultiOriginJSONMixin(f.HandleOwnerMixin(p)))))))))))})},
"esri/layers/mixins/ArcGISMapService":function(){define("require exports tslib ../../request ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),function(n,b,a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",{value:!0});b.ArcGISMapService=function(c){return function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.capabilities=void 0;a.copyright=null;a.fullExtent=
null;a.legendEnabled=!0;a.spatialReference=null;a.version=null;return a}a.__extends(b,c);b.prototype.readCapabilities=function(a,c){var b=c.capabilities&&c.capabilities.split(",").map(function(a){return a.toLowerCase().trim()});if(!b)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};a=this.type;var d=-1!==b.indexOf("query"),e=-1!==b.indexOf("map"),f=!!c.exportTilesAllowed,b=-1!==b.indexOf("tilemap"),g="tile"!==a&&!!c.supportsDynamicLayers,
k="tile"!==a&&(!c.tileInfo||g),h="tile"!==a&&(!c.tileInfo||g);return{operations:{supportsQuery:d,supportsExportMap:e,supportsExportTiles:f,supportsTileMap:b},exportMap:e?{supportsSublayersChanges:"tile"!==a,supportsDynamicLayers:g,supportsSublayerVisibility:k,supportsSublayerDefinitionExpression:h}:null,exportTiles:f?{maxExportTilesCount:+c.maxExportTilesCount}:null}};b.prototype.readVersion=function(a,c){(a=c.currentVersion)||(a=c.hasOwnProperty("capabilities")||c.hasOwnProperty("tables")?10:c.hasOwnProperty("supportedImageFormatTypes")?
9.31:9.3);return a};b.prototype.fetchSublayerInfo=function(c,b){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){switch(a.label){case 0:return[4,this.fetchAllLayersAndTables(b)];case 1:return a.sent(),[2,this._allLayersAndTablesMap.get(c)]}})})};b.prototype.fetchAllLayersAndTables=function(c){return a.__awaiter(this,void 0,void 0,function(){var b,d=this;return a.__generator(this,function(a){switch(a.label){case 0:return[4,this.load(c)];case 1:return a.sent(),
this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=m(e.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json"}}).then(function(a){d._allLayersAndTablesMap=new Map;for(var c=0,b=a.data.layers;c<b.length;c++){var e=b[c];d._allLayersAndTablesMap.set(e.id,e)}return{result:a.data}},function(a){return{error:a}})),[4,this._allLayersAndTablesPromise];case 2:b=a.sent();h.throwIfAborted(c);if("result"in b)return[2,b.result];throw b.error;}})})};a.__decorate([f.property({readOnly:!0})],
b.prototype,"capabilities",void 0);a.__decorate([f.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],b.prototype,"readCapabilities",null);a.__decorate([f.property({json:{read:{source:"copyrightText"}}})],b.prototype,"copyright",void 0);a.__decorate([f.property({type:g})],b.prototype,"fullExtent",void 0);a.__decorate([f.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],b.prototype,"id",void 0);a.__decorate([f.property({type:Boolean,
json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],b.prototype,"legendEnabled",void 0);a.__decorate([f.property(d.popupEnabled)],b.prototype,"popupEnabled",void 0);a.__decorate([f.property({type:l})],b.prototype,"spatialReference",void 0);a.__decorate([f.property()],b.prototype,"version",void 0);a.__decorate([f.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],b.prototype,"readVersion",null);return b=a.__decorate([f.subclass("esri.layers.mixins.ArcGISMapService")],
b)}(c)}})},"esri/layers/mixins/SublayersOwner":function(){define("require exports tslib ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/accessorSupport/decorators ../../core/accessorSupport/PropertyOrigin ../../core/accessorSupport/utils ../support/Sublayer ../support/sublayerUtils".split(" "),function(n,b,a,m,h,e,f,g,l,d,c,k){function p(a,b){var d=[],e={};if(!a)return d;a.forEach(function(a){var f=new c;f.read(a,b);e[f.id]=f;null!=a.parentLayerId&&
-1!==a.parentLayerId?(a=e[a.parentLayerId],a.sublayers||(a.sublayers=[]),a.sublayers.unshift(f)):d.unshift(f)});return d}function r(a,c){a&&a.forEach(function(a){c(a);a.sublayers&&a.sublayers.length&&r(a.sublayers,c)})}Object.defineProperty(b,"__esModule",{value:!0});var t=f.getLogger("esri.layers.TileLayer"),u=m.ofType(c);b.forEachSublayer=r;b.SublayersOwner=function(b){return function(b){function f(){for(var a,c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];var e=b.apply(this,c)||this;e.allSublayers=
new h({root:e,rootCollectionNames:["sublayers"],getChildrenFunction:function(a){return a.sublayers}});e.sublayersSourceJSON=(a={},a[2]={},a[3]={},a[4]={},a[5]={},a);e.watch("sublayers",function(a,c){return e._handleSublayersChange(a,c)},!0);return e}a.__extends(f,b);f.prototype.readSublayers=function(a,c){if(c&&a){var b=this.sublayersSourceJSON,e=l.nameToId(c.origin);2>e||(b[e]={context:c,visibleLayers:a.visibleLayers||b[e].visibleLayers,layers:a.layers||b[e].layers},2<e||(this._set("serviceSublayers",
this.createSublayersForOrigin("service").sublayers),c=this.createSublayersForOrigin("web-document"),a=c.sublayers,c=c.origin,b=d.getProperties(this),b.setDefaultOrigin(c),this._set("sublayers",new u(a)),b.setDefaultOrigin("user")))}};f.prototype.findSublayerById=function(a){return this.allSublayers.find(function(c){return c.id===a})};f.prototype.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers};f.prototype.createSublayersForOrigin=function(a){var c="web-document"===
a?l.nameToId("web-map"):l.nameToId(a),b=2;a=this.sublayersSourceJSON[2].layers;for(var d=this.sublayersSourceJSON[2].context,e=null,f=0,g=[3,4,5].filter(function(a){return a<=c});f<g.length;f++){var h=g[f],m=this.sublayersSourceJSON[h];k.isSublayerOverhaul(m.layers)&&(b=h,a=m.layers,d=m.context,m.visibleLayers&&(e={visibleLayers:m.visibleLayers,context:m.context}))}for(var q=null,f=0,g=[3,4,5].filter(function(a){return a>b&&a<=c});f<g.length;f++){var t=this.sublayersSourceJSON[g[f]],h=t.layers,m=
t.visibleLayers,t=t.context;h&&(q={layers:h,context:t});m&&(e={visibleLayers:m,context:t})}a=p(a,d);var v=new Map,w=new Set;if(q)for(d=0,f=q.layers;d<f.length;d++)g=f[d],v.set(g.id,g);if(e)for(d=0,f=e.visibleLayers;d<f.length;d++)w.add(f[d]);r(a,function(a){q&&a.read(v.get(a.id),q.context);e&&a.read({defaultVisibility:w.has(a.id)},e.context)});return{origin:l.idToName(b),sublayers:new u({items:a})}};f.prototype.read=function(a,c){b.prototype.read.call(this,a,c);this.readSublayers(a,c)};f.prototype._handleSublayersChange=
function(a,c){var b=this;c&&(c.forEach(function(a){a.parent=null;a.layer=null}),this.handles.remove("sublayers-owner"));a&&(a.forEach(function(a){a.parent=b;a.layer=b}),this.handles.add([a.on("after-add",function(a){a=a.item;a.parent=b;a.layer=b}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null})],"sublayers-owner"),"tile"===this.type&&this.handles.add(a.on("before-changes",function(a){t.error(new e("tilelayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",
{layer:b}));a.preventDefault()}),"sublayers-owner"))};a.__decorate([g.property({readOnly:!0})],f.prototype,"allSublayers",void 0);a.__decorate([g.property({readOnly:!0,type:m.ofType(c)})],f.prototype,"serviceSublayers",void 0);a.__decorate([g.property({value:null,type:u,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],f.prototype,"sublayers",void 0);a.__decorate([g.property({readOnly:!0})],f.prototype,"sublayersSourceJSON",void 0);return f=a.__decorate([g.subclass("esri.layers.mixins.SublayersOwner")],
f)}(b)}})},"esri/layers/support/Sublayer":function(){define("require exports tslib ../../geometry ../../PopupTemplate ../../renderers ../../request ../../symbols ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ../../core/accessorSupport/utils ./FeatureType ./Field ./FieldsIndex ./fieldUtils ./LabelClass ./layerSourceUtils ../../renderers/support/jsonUtils ../../support/popupUtils ../../tasks/support/Query @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L){function M(a){return a&&"esriSMS"===a.type}function N(a,c,b){return{ignoreOrigin:!0,enabled:b&&b.writeSublayerStructure||!1}}function Q(a,c,b){return{ignoreOrigin:!0,enabled:b?b.writeSublayerStructure||this.originIdOf(c)>=y.nameToId(b.origin):!1}}var R=t.getLogger("esri.layers.support.Sublayer"),W=0,O=new Set;O.add("layer");O.add("parent");O.add("loaded");O.add("loadStatus");O.add("loadError");O.add("loadWarnings");return function(c){function b(a){a=
c.call(this,a)||this;a.capabilities=void 0;a.fields=null;a.fullExtent=null;a.globalIdField=null;a.legendEnabled=!0;a.objectIdField=null;a.popupEnabled=!0;a.popupTemplate=null;a.sourceJSON=null;a.title=null;a.typeIdField=null;a.types=null;return a}a.__extends(b,c);k=b;b.prototype.load=function(c){return a.__awaiter(this,void 0,void 0,function(){var b=this;return a.__generator(this,function(e){this.addResolvingPromise(function(){return a.__awaiter(b,void 0,void 0,function(){var b,e,g;return a.__generator(this,
function(k){switch(k.label){case 0:if(!this.layer&&!this.url)throw new d("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});b=null;return!this.layer||2<this.originIdOf("url")||G.isDataLayerSource(this.source)?[4,f(this.url,a.__assign({responseType:"json",query:{f:"json"}},c))]:[3,2];case 1:return e=k.sent(),b=e.data,[3,4];case 2:return g=this.id,this.source&&null!=this.source.mapLayerId&&(g=this.source.mapLayerId),[4,this.layer.fetchSublayerInfo(g,c)];
case 3:b=k.sent(),k.label=4;case 4:return b&&(this.sourceJSON=b,this.read({layerDefinition:b},{origin:"service"})),[2]}})})}());return[2,this]})})};b.prototype.readCapabilities=function(a,c){c=c.layerDefinition||c;a=(a=c.capabilities||a)?a.toLowerCase().split(",").map(function(a){return a.trim()}):[];return{exportMap:{supportsModification:!!c.canModifyLayer},operations:{supportsQuery:-1!==a.indexOf("query")}}};Object.defineProperty(b.prototype,"definitionExpression",{set:function(a){this._setAndNotifyLayer("definitionExpression",
a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fieldsIndex",{get:function(){return new F(this.fields||[])},enumerable:!0,configurable:!0});b.prototype.readGlobalIdFieldFromService=function(a,c){c=c.layerDefinition||c;if(c.globalIdField)return c.globalIdField;if(c.fields)for(a=0,c=c.fields;a<c.length;a++){var b=c[a];if("esriFieldTypeGlobalID"===b.type)return b.name}};Object.defineProperty(b.prototype,"id",{get:function(){var a=this._get("id");return null==a?W++:a},set:function(a){this._get("id")!==
a&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",a))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"labelingInfo",{set:function(a){this._setAndNotifyLayer("labelingInfo",a)},enumerable:!0,configurable:!0});b.prototype.writeLabelingInfo=function(a,c,b,d){a&&a.length&&(c.layerDefinition={drawingInfo:{labelingInfo:a.map(function(a){return a.write({},
d)})}})};Object.defineProperty(b.prototype,"labelsVisible",{set:function(a){this._setAndNotifyLayer("labelsVisible",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"layer",{set:function(a){this._set("layer",a);this.sublayers&&this.sublayers.forEach(function(c){return c.layer=a})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"listMode",{set:function(a){this._set("listMode",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"minScale",{set:function(a){this._setAndNotifyLayer("minScale",
a)},enumerable:!0,configurable:!0});b.prototype.readMinScale=function(a,c){return c.minScale||c.layerDefinition&&c.layerDefinition.minScale||0};Object.defineProperty(b.prototype,"maxScale",{set:function(a){this._setAndNotifyLayer("maxScale",a)},enumerable:!0,configurable:!0});b.prototype.readMaxScale=function(a,c){return c.maxScale||c.layerDefinition&&c.layerDefinition.maxScale||0};b.prototype.readObjectIdFieldFromService=function(a,c){c=c.layerDefinition||c;if(c.objectIdField)return c.objectIdField;
if(c.fields)for(a=0,c=c.fields;a<c.length;a++){var b=c[a];if("esriFieldTypeOID"===b.type)return b.name}};Object.defineProperty(b.prototype,"opacity",{set:function(a){this._setAndNotifyLayer("opacity",a)},enumerable:!0,configurable:!0});b.prototype.readOpacity=function(a,c){a=c.layerDefinition;return 1-.01*(null!=a.transparency?a.transparency:a.drawingInfo.transparency)};b.prototype.writeOpacity=function(a,c,b,d){c.layerDefinition={drawingInfo:{transparency:100-100*a}}};b.prototype.writeParent=function(a,
c){c.parentLayerId=this.parent&&this.parent!==this.layer?this.parent.id:-1};Object.defineProperty(b.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderer",{set:function(a){if(a)for(var c=0,b=a.getSymbols();c<b.length;c++)if(g.isSymbol3D(b[c])){R.warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",a)},enumerable:!0,configurable:!0});b.prototype.readRenderer=
function(a,c,b){if(a=c.layerDefinition.drawingInfo.renderer||void 0)(a=J.read(a,c,b)||void 0)||R.error("Failed to create renderer",{rendererDefinition:c.drawingInfo.renderer,layer:this,context:b});return a};b.prototype.writeRenderer=function(a,c,b,d){c.layerDefinition={drawingInfo:{renderer:a.write({},d)}}};b.prototype.writeWebSceneRenderer=function(a,c,b,d){c.layerDefinition={drawingInfo:{renderer:a.write({},d)}}};Object.defineProperty(b.prototype,"source",{get:function(){return this._get("source")||
{mapLayerId:this.id,type:G.MAPLAYER}},set:function(a){this._setAndNotifyLayer("source",a)},enumerable:!0,configurable:!0});b.prototype.writeSource=function(a,c){c.layerDefinition={source:G.sourceToJSON(a)}};Object.defineProperty(b.prototype,"sublayers",{set:function(a){this._handleSublayersChange(a,this._get("sublayers"));this._set("sublayers",a)},enumerable:!0,configurable:!0});b.prototype.castSublayers=function(a){return q.default(l.ofType(k),a)};b.prototype.writeSublayers=function(a,c,b){this.get("sublayers.length")&&
(c[b]=this.sublayers.map(function(a){return a.id}).toArray().reverse())};b.prototype.readTypeIdField=function(a,c){c=c.layerDefinition||c;if(a=c.typeIdField)if(c=H.getField(c.fields,a))return c.name;return null};Object.defineProperty(b.prototype,"url",{get:function(){var a,c,b=null!==(c=null===(a=this.layer)||void 0===a?void 0:a.parsedUrl)&&void 0!==c?c:this._lastParsedUrl;a=this.source;if(!b)return null;this._lastParsedUrl=b;if(G.isMapLayerSource(a))return b.path+"/"+a.mapLayerId;a={layer:JSON.stringify({source:G.sourceToJSON(this.source)})};
return b.path+"/dynamicLayer?"+z.objectToQuery(a)},set:function(a){a?this._override("url",a):this._clearOverride("url")},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"visible",{set:function(a){this._setAndNotifyLayer("visible",a)},enumerable:!0,configurable:!0});b.prototype.writeVisible=function(a,c,b,d){c[b]=this.getAtOrigin("defaultVisibility","service")||a};b.prototype.clone=function(){var a=A.getProperties(this).store,c=new k;A.getProperties(c).store=a.clone(O);this.url;c._lastParsedUrl=
this._lastParsedUrl;return c};b.prototype.createPopupTemplate=function(a){return E.createPopupTemplate(this,a)};b.prototype.createQuery=function(){return new L({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};b.prototype.createFeatureLayer=function(){return a.__awaiter(this,void 0,void 0,function(){var c,b,d,e,f;return a.__generator(this,function(a){switch(a.label){case 0:if(this.hasOwnProperty("sublayers"))return[2,null];c=this.layer&&this.layer.parsedUrl;b=this.source;d=null;c&&(d=
G.isMapLayerSource(b)?c.path+"/"+b.mapLayerId:c.path+"/dynamicLayer");return[4,new Promise(function(a,c){n(["../FeatureLayer"],a,c)})];case 1:return e=a.sent(),f=new e({url:d}),null!=this.layer.refreshInterval&&(f.refreshInterval=this.layer.refreshInterval),this.definitionExpression&&(f.definitionExpression=this.definitionExpression),2<this.originIdOf("labelingInfo")&&(f.labelingInfo=p.clone(this.labelingInfo)),0<this.originIdOf("labelsVisible")&&(f.labelsVisible=this.labelsVisible),0<this.originIdOf("legendEnabled")&&
(f.legendEnabled=this.legendEnabled),0<this.originIdOf("visible")&&(f.visible=this.visible),0<this.originIdOf("minScale")&&(f.minScale=this.minScale),0<this.originIdOf("maxScale")&&(f.maxScale=this.maxScale),0<this.originIdOf("opacity")&&(f.opacity=this.opacity),0<this.originIdOf("popupTemplate")&&(f.popupTemplate=p.clone(this.popupTemplate)),2<this.originIdOf("renderer")&&(f.renderer=p.clone(this.renderer)),G.isDataLayerSource(this.source)&&(f.dynamicDataSource=p.clone(this.source)),0<this.originIdOf("title")&&
(f.title=this.title),[2,f]}})})};b.prototype.getFeatureType=function(a){var c=this.typeIdField;if(!c||!a)return null;var b=a.attributes?a.attributes[c]:void 0;if(null==b)return null;var d=null;this.types.some(function(a){var c=a.id;if(null==c)return!1;c.toString()===b.toString()&&(d=a);return!!d});return d};b.prototype.getFieldDomain=function(a,c){return(c=this.getFeatureType(c&&c.feature))&&(c=c.domains&&c.domains[a])&&"inherited"!==c.type?c:this._getLayerDomain(a)};b.prototype.queryFeatures=function(a,
c){var b=this;void 0===a&&(a=this.createQuery());return this.load().then(function(){if(!b.get("capabilities.operations.supportsQuery"))throw new d("Sublayer.queryFeatures","this layer doesn't support queries.");return v.all([new Promise(function(a,c){n(["../../tasks/operations/query"],a,c)}),new Promise(function(a,c){n(["../../tasks/support/FeatureSet"],a,c)})])}).then(function(d){var e=d[0].executeQuery,f=d[1];return e(b.url,L.from(a),b.layer?b.layer.spatialReference:null,c).then(function(a){return f.fromJSON(a.data)})}).then(function(a){a&&
a.features&&a.features.forEach(function(a){a.sourceLayer=b});return a})};b.prototype.toExportImageJSON=function(){var a=this,c={id:this.id,source:G.sourceToJSON(this.source)};this.definitionExpression&&(c.definitionExpression=this.definitionExpression);var b=["renderer","labelingInfo","opacity","labelsVisible"].reduce(function(c,b){c[b]=a.originIdOf(b);return c},{});if(Object.keys(b).some(function(a){return 2<=b[a]})){var d=c.drawingInfo={};2<=b.renderer&&(d.renderer=this.renderer?this.renderer.toJSON():
null);2<=b.labelsVisible&&(d.showLabels=this.labelsVisible);this.labelsVisible&&2<=b.labelingInfo&&(d.labelingInfo=this.labelingInfo?this.labelingInfo.map(function(a){return a.write({},{origin:"service"})}):null,d.showLabels=!0);2<=b.opacity&&(d.transparency=100-100*this.opacity);this._assignDefaultSymbolColors(d.renderer)}return c};b.prototype._assignDefaultSymbolColors=function(a){this._forEachSimpleMarkerSymbols(a,function(a){a.color||"esriSMSX"!==a.style&&"esriSMSCross"!==a.style||(a.color=a.outline&&
a.outline.color?a.outline.color:[0,0,0,0])})};b.prototype._forEachSimpleMarkerSymbols=function(a,c){if(a){var b=0,d="uniqueValueInfos"in a?a.uniqueValueInfos:"classBreakInfos"in a?a.classBreakInfos:[];for(;b<d.length;b++){var e=d[b];M(e.symbol)&&c(e.symbol)}"symbol"in a&&M(a.symbol)&&c(a.symbol);"defaultSymbol"in a&&M(a.defaultSymbol)&&c(a.defaultSymbol)}};b.prototype._setAndNotifyLayer=function(a,c){var b=this.layer,d=this._get(a),e,f;switch(a){case "definitionExpression":e="supportsSublayerDefinitionExpression";
case "minScale":case "maxScale":case "visible":e="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":e="supportsDynamicLayers",f="supportsModification"}var g=A.getProperties(this).getDefaultOrigin();if("service"!==g){if(e&&!1===this.get("layer.capabilities.exportMap."+e)){this._logLockedError(a,"capability not available 'layer.capabilities.exportMap."+e+"'");return}if(f&&!1===this.get("capabilities.exportMap."+f)){this._logLockedError(a,
"capability not available 'capabilities.exportMap."+f+"'");return}}"source"===a&&"not-loaded"!==this.loadStatus?this._logLockedError(a,"'source' can't be changed after calling sublayer.load()"):(this._set(a,c),"service"!==g&&d!==c&&b&&b.emit&&b.emit("sublayer-update",{propertyName:a}))};b.prototype._handleSublayersChange=function(a,c){var b=this;c&&(c.forEach(function(a){a.parent=null;a.layer=null}),this.handles.removeAll());a&&(a.forEach(function(a){a.parent=b;a.layer=b.layer}),this.handles.add([a.on("after-add",
function(a){a=a.item;a.parent=b;a.layer=b.layer}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null}),a.on("before-changes",function(a){var c=b.get("layer.capabilities.exportMap.supportsSublayersChanges");null==c||c||(R.error(new d("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:b,layer:b.layer})),a.preventDefault())})]))};b.prototype._logLockedError=function(a,c){R.error(new d("sublayer:locked","Property '"+a+
"' can't be changed on Sublayer from the layer '"+this.layer.id+"'",{reason:c,sublayer:this,layer:this.layer}))};b.prototype._getLayerDomain=function(a){return(a=this.fieldsIndex.get(a))?a.domain:null};var k;a.__decorate([w.property({readOnly:!0})],b.prototype,"capabilities",void 0);a.__decorate([w.reader("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],b.prototype,"readCapabilities",null);a.__decorate([w.property({type:String,value:null,json:{read:{source:"layerDefinition.definitionExpression"},
write:{target:"layerDefinition.definitionExpression",overridePolicy:Q}}})],b.prototype,"definitionExpression",null);a.__decorate([w.property({type:[C],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],b.prototype,"fields",void 0);a.__decorate([w.property({readOnly:!0,dependsOn:["fields"]})],b.prototype,"fieldsIndex",null);a.__decorate([w.property({type:m.Extent,json:{read:{source:"layerDefinition.extent"}}})],b.prototype,"fullExtent",void 0);a.__decorate([w.property({type:String})],
b.prototype,"globalIdField",void 0);a.__decorate([w.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],b.prototype,"readGlobalIdFieldFromService",null);a.__decorate([w.property({type:Number,json:{write:{ignoreOrigin:!0}}})],b.prototype,"id",null);a.__decorate([w.property({value:null,type:[I],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:N}}})],b.prototype,"labelingInfo",
null);a.__decorate([w.writer("labelingInfo")],b.prototype,"writeLabelingInfo",null);a.__decorate([w.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:N}}})],b.prototype,"labelsVisible",null);a.__decorate([w.property({value:null})],b.prototype,"layer",null);a.__decorate([w.property({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",
overridePolicy:Q}}})],b.prototype,"legendEnabled",void 0);a.__decorate([w.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],b.prototype,"listMode",null);a.__decorate([w.property({type:Number,value:0,json:{write:{enabled:!1,overridePolicy:N}}})],b.prototype,"minScale",null);a.__decorate([w.reader("minScale",["minScale","layerDefinition.minScale"])],b.prototype,"readMinScale",null);a.__decorate([w.property({type:Number,value:0,
json:{write:{enabled:!1,overridePolicy:N}}})],b.prototype,"maxScale",null);a.__decorate([w.reader("maxScale",["maxScale","layerDefinition.maxScale"])],b.prototype,"readMaxScale",null);a.__decorate([w.property({type:String})],b.prototype,"objectIdField",void 0);a.__decorate([w.reader("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],b.prototype,"readObjectIdFieldFromService",null);a.__decorate([w.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",
overridePolicy:N}}})],b.prototype,"opacity",null);a.__decorate([w.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],b.prototype,"readOpacity",null);a.__decorate([w.writer("opacity")],b.prototype,"writeOpacity",null);a.__decorate([w.property({json:{type:Number,write:{target:"parentLayerId",allowNull:!0,overridePolicy:N}}})],b.prototype,"parent",void 0);a.__decorate([w.writer("parent")],b.prototype,"writeParent",null);a.__decorate([w.property({type:Boolean,
value:!0,json:{read:{source:"disablePopup",reader:function(a,c){return!c.disablePopup}},write:{target:"disablePopup",overridePolicy:Q,writer:function(a,c,b){c[b]=!a}}}})],b.prototype,"popupEnabled",void 0);a.__decorate([w.property({type:h,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:Q}}})],b.prototype,"popupTemplate",void 0);a.__decorate([w.property({readOnly:!0,dependsOn:["fields","title"]})],b.prototype,"defaultPopupTemplate",null);a.__decorate([w.property({types:e.rendererTypes,
value:null,json:{write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:N}}})],b.prototype,"renderer",null);a.__decorate([w.reader("renderer",["layerDefinition.drawingInfo.renderer"])],b.prototype,"readRenderer",null);a.__decorate([w.writer("renderer")],b.prototype,"writeRenderer",null);a.__decorate([w.writer("web-scene","renderer",{"layerDefinition.drawingInfo.renderer":{types:e.webSceneRendererTypes}})],b.prototype,"writeWebSceneRenderer",null);a.__decorate([w.property({cast:G.castSource,
json:{read:{source:"layerDefinition.source",reader:G.sourceFromJSON},write:{target:"layerDefinition.source",overridePolicy:N}}})],b.prototype,"source",null);a.__decorate([w.writer("source")],b.prototype,"writeSource",null);a.__decorate([w.property()],b.prototype,"sourceJSON",void 0);a.__decorate([w.property({value:null,json:{type:[q.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:N}}})],b.prototype,"sublayers",null);a.__decorate([w.cast("sublayers")],b.prototype,"castSublayers",null);
a.__decorate([w.writer("sublayers")],b.prototype,"writeSublayers",null);a.__decorate([w.property({type:String,json:{read:{source:"name"},write:{target:"name",allowNull:!0,overridePolicy:Q}}})],b.prototype,"title",void 0);a.__decorate([w.property({type:String})],b.prototype,"typeIdField",void 0);a.__decorate([w.reader("typeIdField",["layerDefinition.typeIdField"])],b.prototype,"readTypeIdField",null);a.__decorate([w.property({type:[B],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],
b.prototype,"types",void 0);a.__decorate([w.property({type:String,dependsOn:["layer","source"],json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:function(){return{enabled:this._isOverridden("url")}}}}})],b.prototype,"url",null);a.__decorate([w.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:N}}})],b.prototype,"visible",null);a.__decorate([w.writer("visible")],b.prototype,"writeVisible",null);return b=k=a.__decorate([w.subclass("esri.layers.support.Sublayer")],
b)}(c.HandleOwnerMixin(u.MultiOriginJSONMixin(k.IdentifiableMixin(r))))})},"esri/layers/support/sublayerUtils":function(){define(["require","exports","./layerSourceUtils"],function(n,b,a){function m(a,b){if(!a||!a.length)return!0;b=b.slice().reverse().flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).map(function(a){return a.id}).toArray();if(a.length>b.length)return!1;for(var e=0,g=b.length,h=0;h<a.length;h++){for(var d=a[h].id;e<g&&b[e]!==d;)e++;if(e>=g)return!1}return!0}Object.defineProperty(b,
"__esModule",{value:!0});b.shouldWriteSublayerStructure=function(a,b,f){return b.flatten(function(a){return a.sublayers}).length!==a.length||a.some(function(a){return a.originIdOf("minScale")>f||a.originIdOf("maxScale")>f||a.originIdOf("renderer")>f||a.originIdOf("labelingInfo")>f||a.originIdOf("opacity")>f||a.originIdOf("labelsVisible")>f||a.originIdOf("source")>f})?!0:!m(a,b)};b.isExportDynamic=function(b,e,f){return b.some(function(b){var e=b.source;return!(!e||e.type===a.MAPLAYER&&e.mapLayerId===
b.id&&(!e.gdbVersion||e.gdbVersion===f.gdbVersion))||2<b.originIdOf("renderer")||2<b.originIdOf("labelingInfo")||2<b.originIdOf("opacity")||2<b.originIdOf("labelsVisible")})?!0:!m(b,e)};b.isSublayerOverhaul=function(a){return!!a&&a.some(function(a){return null!=a.minScale||a.layerDefinition&&null!=a.layerDefinition.minScale})}})},"esri/layers/VectorTileLayer":function(){define("require exports tslib ../request ../core/Error ../core/global ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ./Layer ./mixins/ArcGISCachedService ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/SpriteSource ./support/TileInfo ./support/TilemapCache ./support/vectorTileLayerLoader ../portal/support/jsonContext ../views/2d/engine/vectorTiles/SchemaHelper ../views/2d/engine/vectorTiles/tileInfoUtils ../views/2d/engine/vectorTiles/style/StyleRepository".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I){return function(b){function f(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];a=b.apply(this,a)||this;a._spriteSourceMap=new Map;a.currentStyleInfo=null;a.style=null;a.isReference=null;a.operationalLayerType="VectorTileLayer";a.type="vector-tile";a.url=null;return a}a.__extends(f,b);f.prototype.normalizeCtorArgs=function(c,b){return"string"===typeof c?a.__assign({url:c},b):c};f.prototype.destroy=function(){this._spriteSourceMap.clear()};
f.prototype.prefetchResources=function(c){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){switch(a.label){case 0:return[4,this.loadSpriteSource(e.devicePixelRatio||1,c)];case 1:return a.sent(),[2]}})})};f.prototype.load=function(c){var b=this,d=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1},c).then(function(){return a.__awaiter(b,void 0,void 0,function(){var b,d;return a.__generator(this,function(e){switch(e.label){case 0:if(!this.portalItem||
!this.portalItem.id)return[2];b=this.portalItem.itemUrl+"/resources/styles/root.json";return[4,m(b,a.__assign(a.__assign({},c),{query:{f:"json"}}))];case 1:return d=e.sent(),d.data&&this.read({url:b},C.createForItem(this.portalItem)),[2]}})})}).then(function(){return b._loadStyle(c)},function(){return b._loadStyle(c)});this.addResolvingPromise(d);return g.resolve(this)};Object.defineProperty(f.prototype,"attributionDataUrl",{get:function(){var a=this.currentStyleInfo;return(a=a&&a.serviceUrl&&d.urlToObject(a.serviceUrl))?
this._getDefaultAttribution(a.path):null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"capabilities",{get:function(){var a=this._getPrimarySource();return a?a.capabilities:{operations:{supportsExportTiles:!1,supportsTileMap:!1},exportTiles:null}},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"fullExtent",{get:function(){var a=this._getPrimarySource();return a?a.fullExtent:null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"parsedUrl",
{get:function(){return this.serviceUrl?l.urlToObject(this.serviceUrl):null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"serviceUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.serviceUrl||null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"spatialReference",{get:function(){return this.tileInfo&&this.tileInfo.spatialReference||null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"styleUrl",{get:function(){return this.currentStyleInfo&&
this.currentStyleInfo.styleUrl||null},enumerable:!0,configurable:!0});f.prototype.writeStyleUrl=function(a,c){a&&d.isProtocolRelative(a)&&(a="https:"+a);c.styleUrl=a};Object.defineProperty(f.prototype,"tileIndexType",{get:function(){var a=this._getPrimarySource();return a?a.type:""},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"tileIndexUrl",{get:function(){var a=this._getPrimarySource();return a?a.tileMapURL:""},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"tileInfo",{get:function(){var a=[],c;for(c in this.sourceNameToSource)a.push(this.sourceNameToSource[c]);c=this._getPrimarySource().tileInfo;if(1<a.length)for(var b=0;b<a.length;b++)H.areSchemasOverlapping(c,a[b].tileInfo)&&(c=H.unionTileInfos(c,a[b].tileInfo));return c},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"tilemapCache",{get:function(){var a=this._getPrimarySource();return a?a.capabilities.operations.supportsTileMap?a.tilemapCache:null:null},enumerable:!0,configurable:!0});
Object.defineProperty(f.prototype,"tileServers",{get:function(){var a=this._getPrimarySource();return a?a.tileServers:[]},enumerable:!0,configurable:!0});f.prototype.readVersion=function(a,c){return c.version?parseFloat(c.version):parseFloat(c.currentVersion)};Object.defineProperty(f.prototype,"compatibleTileInfo256",{get:function(){return F.create256x256CompatibleTileInfo(this.tileInfo)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"compatibleTileInfo512",{get:function(){return F.create512x512CompatibleTileInfo(this.tileInfo)},
enumerable:!0,configurable:!0});f.prototype.loadSpriteSource=function(c,b){void 0===c&&(c=1);return a.__awaiter(this,void 0,void 0,function(){var d,e;return a.__generator(this,function(a){this._spriteSourceMap.has(c)||(d=new q.default(this.styleRepository.sprite,c),this._spriteSourceMap.set(c,d.load()));e=this._spriteSourceMap.get(c);return[2,g.create(function(a,c){e.then(a,c);g.onAbortOrThrow(b,c)})]})})};f.prototype.loadStyle=function(c,b){return a.__awaiter(this,void 0,void 0,function(){var d,
e,f,k=this;return a.__generator(this,function(a){d=c||this.style||this.url;if(this._loadingPromise&&"string"===typeof d&&this.url===d&&!g.isAborted(this._abortController))return[2,this._loadingPromise];(e=this._abortController)&&e.abort();f=g.createAbortController();this._loadingPromise=g.create(function(a,c){var e={signal:f.signal};k._spriteSourceMap.clear();k._getSourceAndStyle(d,e).then(a,c);g.onAbort(b,function(){f.abort()})});this._abortController=f;return[2,this._loadingPromise]})})};f.prototype.getStyleLayerId=
function(a){return this.styleRepository.getStyleLayerId(a)};f.prototype.getPaintProperties=function(a){return this.styleRepository.getPaintProperties(a)};f.prototype.setPaintProperties=function(a,c){var b=this.styleRepository.isPainterDataDriven(a),d=this.styleRepository.setPaintProperties(a,c),e=this.styleRepository.isPainterDataDriven(a);this.emit("paint-change",{layer:d,paint:c});(b||e)&&this.emit("layout-change",{layer:d,layout:this.styleRepository.getLayoutProperties(a)})};f.prototype.getLayoutProperties=
function(a){return this.styleRepository.getLayoutProperties(a)};f.prototype.setLayoutProperties=function(a,c){a=this.styleRepository.setLayoutProperties(a,c);this.emit("layout-change",{layer:a,layout:c})};f.prototype.getTileUrl=function(a,c,b){var d=this.tileServers[c%this.tileServers.length];return d=d.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,c.toString()).replace(/\{x\}/gi,b.toString())};f.prototype.write=function(a,c){return c&&c.origin&&!this.styleUrl?(c.messages&&c.messages.push(new h("vectortilelayer:unsupported",
"VectorTileLayer ("+this.title+", "+this.id+") with style defined by JSON only are not supported",{layer:this})),null):b.prototype.write.call(this,a,c)};f.prototype._getSourceAndStyle=function(c,b){return a.__awaiter(this,void 0,void 0,function(){var d;return a.__generator(this,function(a){switch(a.label){case 0:if(!c)throw Error("invalid style!");return[4,B.loadMetadata(c,b)];case 1:return d=a.sent(),this._set("currentStyleInfo",{serviceUrl:d.serviceUrl,styleUrl:d.styleUrl,spriteUrl:d.spriteUrl,
glyphsUrl:d.glyphsUrl,style:d.style,layerDefinition:d.layerDefinition}),"string"===typeof c?(this.url=c,this.style=null):(this.url=null,this.style=c),this._set("sourceNameToSource",d.sourceNameToSource),this._set("primarySourceName",d.primarySourceName),this._set("styleRepository",new I(d.style,d)),this.read(d.layerDefinition,{origin:"service"}),[2]}})})};f.prototype._getDefaultAttribution=function(a){var c=a.match(/^https?:\/\/(basemaps|basemapsbeta|basemapsdev)\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i);
if(c&&(a=c[3]&&c[3].toLowerCase()))for(var c=c[2]||"",b=0,e="OpenStreetMap_v2 OpenStreetMap_Export_v2 OpenStreetMap_FTS_v2 OpenStreetMap_GCS_v2 World_Basemap World_Basemap_v2 World_Basemap_Export_v2 World_Basemap_GCS_v2 World_Basemap_WGS84".split(" ");b<e.length;b++){var f=e[b];if(-1<f.toLowerCase().indexOf(a))return d.normalize("//static.arcgis.com/attribution/Vector"+c+"/"+f)}};f.prototype._getPrimarySource=function(){return this.sourceNameToSource&&this.primarySourceName in this.sourceNameToSource?
this.sourceNameToSource[this.primarySourceName]:null};f.prototype._loadStyle=function(c){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return this._loadingPromise?[2,this._loadingPromise]:[2,this.loadStyle(null,c)]})})};a.__decorate([c.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],f.prototype,"attributionDataUrl",null);a.__decorate([c.property({type:["show","hide"]})],f.prototype,"listMode",void 0);a.__decorate([c.property({json:{read:!1},readOnly:!0,
dependsOn:["sourceNameToSource","primarySourceName"]})],f.prototype,"capabilities",null);a.__decorate([c.property({readOnly:!0})],f.prototype,"currentStyleInfo",void 0);a.__decorate([c.property({json:{read:!1},readOnly:!0,type:k,dependsOn:["sourceNameToSource","primarySourceName"]})],f.prototype,"fullExtent",null);a.__decorate([c.property()],f.prototype,"style",void 0);a.__decorate([c.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],f.prototype,
"isReference",void 0);a.__decorate([c.property({type:["VectorTileLayer"]})],f.prototype,"operationalLayerType",void 0);a.__decorate([c.property({readOnly:!0,dependsOn:["serviceUrl"]})],f.prototype,"parsedUrl",null);a.__decorate([c.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],f.prototype,"serviceUrl",null);a.__decorate([c.property({type:p,dependsOn:["tileInfo"],readOnly:!0})],f.prototype,"spatialReference",null);a.__decorate([c.property({readOnly:!0})],f.prototype,"styleRepository",void 0);
a.__decorate([c.property({readOnly:!0})],f.prototype,"sourceNameToSource",void 0);a.__decorate([c.property({readOnly:!0})],f.prototype,"primarySourceName",void 0);a.__decorate([c.property({type:String,readOnly:!0,dependsOn:["currentStyleInfo"],json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],f.prototype,"styleUrl",null);a.__decorate([c.writer(["portal-item","web-document"],"styleUrl")],f.prototype,"writeStyleUrl",null);a.__decorate([c.property({json:{read:!1},
readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],f.prototype,"tileIndexType",null);a.__decorate([c.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],f.prototype,"tileIndexUrl",null);a.__decorate([c.property({json:{read:!1,origins:{service:{read:!1}}},readOnly:!0,type:y,dependsOn:["sourceNameToSource","primarySourceName"]})],f.prototype,"tileInfo",null);a.__decorate([c.property({json:{read:!1},readOnly:!0,type:A.TilemapCache,dependsOn:["sourceNameToSource",
"primarySourceName"]})],f.prototype,"tilemapCache",null);a.__decorate([c.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],f.prototype,"tileServers",null);a.__decorate([c.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],f.prototype,"type",void 0);a.__decorate([c.property({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],f.prototype,"url",void 0);a.__decorate([c.property({readOnly:!0})],
f.prototype,"version",void 0);a.__decorate([c.reader("version",["version","currentVersion"])],f.prototype,"readVersion",null);a.__decorate([c.property({readOnly:!0,dependsOn:["tileInfo"]})],f.prototype,"compatibleTileInfo256",null);a.__decorate([c.property({readOnly:!0,dependsOn:["tileInfo"]})],f.prototype,"compatibleTileInfo512",null);return f=a.__decorate([c.subclass("esri.layers.VectorTileLayer")],f)}(w.ScaleRangeLayer(t.ArcGISCachedService(u.ArcGISService(v.OperationalLayer(z.PortalLayer(f.MultiOriginJSONMixin(r)))))))})},
"esri/layers/support/SpriteSource":function(){define("require exports tslib ../../request ../../core/Error ../../core/has ../../core/Logger ../../core/promiseUtils".split(" "),function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});var l=f.getLogger("esri.layers.support.SpriteSource");n=function(){function b(a,b){this.baseURL=a;this.devicePixelRatio=b;this._isRetina=!1;this._spritesData={};this.height=this.width=this.image=null;this.loadStatus="not-loaded"}Object.defineProperty(b.prototype,
"spriteNames",{get:function(){var a=[],b;for(b in this._spritesData)a.push(b);a.sort();return a},enumerable:!0,configurable:!0});b.prototype.getSpriteInfo=function(a){return this._spritesData[a]};b.prototype.load=function(c){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){switch(a.label){case 0:g.throwIfAborted(c);this.loadStatus="loading";if(!this.baseURL)return[2,g.resolve(this)];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this._loadSprites(c)];case 2:return a.sent(),
this.loadStatus="loaded",[3,4];case 3:return a.sent(),this.loadStatus="failed",[3,4];case 4:return[2,this]}})})};b.prototype._loadSprites=function(c){var b=this;this._isRetina=1.15<this.devicePixelRatio?!0:!1;var d=this.baseURL,f=this._isRetina?"@2x":"",t=""+d+f+".png";return g.all([m(d+f+".json",c),m(t,a.__assign({responseType:"image"},c))]).then(function(a){var c=a[0];a=a[1];var f=Object.keys(c.data);if(!f||0===f.length||1===f.length&&"_ssl"===f[0]||!a||!a.data)return b._spritesData=b.image=null,
b.width=b.height=0,g.resolve(null);b._spritesData=c.data;c=a.data;a=Math.max(e("esri-webgl-max-texture-size"),4096);if(c.width>a||c.height>a)throw c="Sprite resource for style "+d+" is bigger than the maximum allowed of "+a+" pixels}",l.error(c),new h("SpriteSource",c);b.width=c.width;b.height=c.height;a=document.createElement("canvas");f=a.getContext("2d");a.width=c.width;a.height=c.height;f.drawImage(c,0,0,c.width,c.height);c=f.getImageData(0,0,c.width,c.height);c=new Uint8Array(c.data);for(f=0;f<
c.length;f+=4)a=c[f+3]/255,c[f]*=a,c[f+1]*=a,c[f+2]*=a;b.image=c})};return b}();b.default=n})},"esri/layers/support/vectorTileLayerLoader":function(){define("require exports tslib ../../config ../../request ../../core/promiseUtils ../../core/urlUtils ../../views/2d/engine/vectorTiles/style/VectorTileSource".split(" "),function(n,b,a,m,h,e,f,g){function l(a){a&&(a=f.getOrigin(a),r&&-1===r.indexOf(a)&&r.push(a))}function d(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];for(var c=void 0,
b=0;b<a.length;++b)f.isProtocolRelative(a[b])?c&&(c=c.split("://")[0]+":"+a[b].trim()):c=f.isAbsolute(a[b])?a[b]:f.join(c,a[b]);return f.removeTrailingSlash(c)}function c(c,b,d,g,m){return a.__awaiter(this,void 0,void 0,function(){var q,r,t,u,v,w;return a.__generator(this,function(n){switch(n.label){case 0:e.throwIfAborted(m);if("string"!==typeof d)return[3,2];u=f.normalize(d);l(u);v=f.urlToObject(u);return[4,h(v.path,a.__assign({query:{f:"json"},responseType:"json"},m))];case 1:return t=n.sent(),
r=q=u,[3,3];case 2:t={data:d},q=d.jsonUrl||null,r=g,n.label=3;case 3:return w=t.data,t.ssl&&(q&&(q=q.replace(/^http:/i,"https:")),r&&(r=r.replace(/^http:/i,"https:"))),w.sources?(c.styleUrl=q||null,[2,k(c,w,r,m)]):w.sources?[2,e.reject("You must specify the URL or the JSON for a service or for a style.")]:c.sourceUrl?[2,p(c,w,r,!1,b,m)]:(c.sourceUrl=q||null,[2,p(c,w,r,!0,b,m)])}})})}function k(b,g,k,h){return a.__awaiter(this,void 0,void 0,function(){var m,p,r,t,u,v;return a.__generator(this,function(a){switch(a.label){case 0:m=
k?f.removeFile(k):f.appBaseUrl;b.styleBase=m;b.style=g;b.styleUrl&&l(b.styleUrl);p=[];if(!g.sources||!g.sources.esri)return[3,3];r=g.sources.esri;return r.url?[4,c(b,"esri",d(m,r.url),void 0,h)]:[3,2];case 1:return a.sent(),[3,3];case 2:p.push(c(b,"esri",r,m,h)),a.label=3;case 3:t=0;for(u=Object.keys(g.sources);t<u.length;t++)v=u[t],"esri"!==v&&"vector"===g.sources[v].type&&(g.sources[v].url?p.push(c(b,v,d(m,g.sources[v].url),void 0,h)):p.push(c(b,v,g.sources[v],m,h)));return[4,e.all(p)];case 4:return a.sent(),
[2]}})})}function p(b,k,h,m,p,q){return a.__awaiter(this,void 0,void 0,function(){var r,t,u,v;return a.__generator(this,function(a){r=h?f.removeTrailingSlash(h)+"/":f.appBaseUrl;a=r;if(k.hasOwnProperty("tileInfo"))t=k;else{for(var w={xmin:-2.0037507067161843E7,ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,spatialReference:{wkid:102100}},n=78271.51696400007,z=2.958287637957775E8,y=[],A=k.hasOwnProperty("minzoom")?parseFloat(k.minzoom):0,B=k.hasOwnProperty("maxzoom")?
parseFloat(k.maxzoom):22,C=0;C<=B;C++)C>=A&&y.push({level:C,scale:z,resolution:n}),n/=2,z/=2;n=0;for(z=k.tiles;n<z.length;n++)l(d(a,z[n]));t={capabilities:"TilesOnly",initialExtent:w,fullExtent:w,minScale:0,maxScale:0,tiles:k.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,y:2.0037508342787E7},lods:y,spatialReference:{wkid:102100}}}}u=new g(p,r,t);if(!m&&b.primarySourceName in b.sourceNameToSource){v=b.sourceNameToSource[b.primarySourceName];if(!v.isCompatibleWith(u))return[2,
e.resolve()];null!=u.fullExtent&&(null!=v.fullExtent?v.fullExtent.union(u.fullExtent):v.fullExtent=u.fullExtent.clone());v.tileInfo.lods.length<u.tileInfo.lods.length&&(v.tileInfo=u.tileInfo)}m?(b.sourceBase=r,b.source=k,b.validatedSource=t,b.primarySourceName=p,b.sourceUrl&&l(b.sourceUrl)):l(r);b.sourceNameToSource[p]=u;return b.style?[2]:null==k.defaultStyles?[2,e.reject()]:"string"===typeof k.defaultStyles?[2,c(b,"",d(r,k.defaultStyles,"root.json"),void 0,q)]:[2,c(b,"",k.defaultStyles,d(r,"root.json"),
q)]})})}Object.defineProperty(b,"__esModule",{value:!0});var r=m.defaults&&m.defaults.io.corsEnabledServers;b.loadMetadata=function(b,e){return a.__awaiter(this,void 0,void 0,function(){var g,k,h,m,p,r;return a.__generator(this,function(a){switch(a.label){case 0:return g={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,sourceNameToSource:{},primarySourceName:""},k="string"===typeof b?[b,null]:[null,b.jsonUrl],h=k[0],m=k[1],p=h?f.urlToObject(h):
null,[4,c(g,"esri",b,m,e)];case 1:return a.sent(),r={layerDefinition:g.validatedSource,url:h,parsedUrl:p,serviceUrl:g.sourceUrl,style:g.style,styleUrl:g.styleUrl,spriteUrl:g.style.sprite&&d(g.styleBase,g.style.sprite),glyphsUrl:g.style.glyphs&&d(g.styleBase,g.style.glyphs),sourceNameToSource:g.sourceNameToSource,primarySourceName:g.primarySourceName},l(r.spriteUrl),l(r.glyphsUrl),[2,r]}})})}})},"esri/views/2d/engine/vectorTiles/style/VectorTileSource":function(){define("require exports tslib ../../../../../core/lang ../../../../../core/urlUtils ../../../../../geometry/Extent ../../../../../layers/support/serviceTileInfoProperty ../../../../../layers/support/TilemapCache ../TileIndex".split(" "),
function(n,b,a,m,h,e,f,g,l){return function(){function b(a,b,d){this.tileMapURL="";this.fullExtent=this.tileIndex=this.capabilities=this.tileInfo=this.parsedUrl=this.tilemapCache=null;this.name=a;if(this.sourceUrl=b)this.parsedUrl=h.urlToObject(this.sourceUrl);a=m.clone(d);var c=a.tiles;b&&c.forEach(function(a,d){h.isAbsolute(a)||(c[d]=h.join(b,a))});this.tileServers=c;d.tileMap&&(this.tileMapURL=h.join(b,d.tileMap));var k=d.capabilities&&d.capabilities.split(",").map(function(a){return a.toLowerCase().trim()}),
p=!!d.exportTilesAllowed,k=!!k&&-1!==k.indexOf("tilemap"),v=p&&d.hasOwnProperty("maxExportTilesCount")?d.maxExportTilesCount:0;this.capabilities={operations:{supportsExportTiles:p,supportsTileMap:k},exportTiles:p?{maxExportTilesCount:+v}:null};this.tileInfo=f.readServiceTileInfo(a.tileInfo,a,null,{ignoreMinMaxLOD:!0});k&&(this.type="vector-tile",this.tilemapCache=new g.TilemapCache({layer:this}),this.tileIndex=new l(this.tilemapCache));this.fullExtent=e.fromJSON(d.fullExtent)}b.prototype.getRefKey=
function(c,b){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return this.tileIndex?[2,this.tileIndex.dataKey(c,b)]:[2,c]})})};b.prototype.getSourceTileUrl=function(a,b,d){var c=this.tileServers[b%this.tileServers.length];return c=c.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,b.toString()).replace(/\{x\}/gi,d.toString())};b.prototype.isCompatibleWith=function(a){var c=this.tileInfo;a=a.tileInfo;if(!c.spatialReference.equals(a.spatialReference)||!c.origin.equals(a.origin)||
Math.round(c.dpi)!==Math.round(a.dpi))return!1;c=c.lods;a=a.lods;for(var b=Math.min(c.length,a.length),d=0;d<b;d++){var e=c[d],f=a[d];if(e.level!==f.level||Math.round(e.scale)!==Math.round(f.scale))return!1}return!0};return b}()})},"esri/views/2d/engine/vectorTiles/TileIndex":function(){define(["require","exports","../../../../core/promiseUtils","../../../../layers/support/TilemapCache","../../tiling/TileKey"],function(n,b,a,m,h){return function(){function b(a){if(a instanceof m.TilemapCache)this._tilemapCache=
a;else if(a&&"index"in a)this._tilemap=a.index;else throw Error("Invalid tilemap!");}b.prototype.dataKey=function(b,e){if(this._tilemapCache){var f=b.level,d=b.row,c=b.col,g=new h(b);return this._tilemapCache.fetchAvailabilityUpsample(f,d,c,g,e).then(function(){return g}).catch(function(c){if(a.isAbortError(c))throw c;return null})}return this._getIndexedDataKey(b)};b.prototype.forEach=function(a,b,e,d,c){this._callback=c;this._maxLevel=b+a;this._forEach(this._tilemap,b,e,d)};b.prototype._forEach=
function(a,b,e,d){0!==a&&(this._callback(b,e,d),b!==this._maxLevel&&"object"===typeof a&&(this._forEach(a[0],b+1,2*e,2*d),this._forEach(a[1],b+1,2*e,2*d+1),this._forEach(a[2],b+1,2*e+1,2*d),this._forEach(a[3],b+1,2*e+1,2*d+1)))};b.prototype._getIndexedDataKey=function(b){var e=[b];if(0>b.level||0>b.row||0>b.col||0<b.row>>b.level||0<b.col>>b.level)return a.resolve(null);for(;0!==b.level;)b=new h(b.level-1,b.row>>1,b.col>>1,b.world),e.push(b);b=this._tilemap;var f=e.pop(),d,c;if(1===b)return a.resolve(f);
for(;e.length;)if(d=e.pop(),c=(d.col&1)+((d.row&1)<<1),b){if(0===b[c]){f=null;break}if(1===b[c]){f=d;break}f=d;b=b[c]}return a.resolve(f)};return b}()})},"esri/views/2d/tiling/TileKey":function(){define(["require","exports","../../../core/ObjectPool"],function(n,b,a){return function(){function b(a,b,f,g){this.set(a,b,f,g)}b.getId=function(a,b,f,g){return"object"===typeof a?a.level+"/"+a.row+"/"+a.col+"/"+a.world:a+"/"+b+"/"+f+"/"+g};Object.defineProperty(b.prototype,"key",{get:function(){return this},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"id",{get:function(){return this.toString()},enumerable:!0,configurable:!0});b.prototype.acquire=function(a,b,f,g){this.set(a,b,f,g)};b.prototype.equals=function(a){return this.level===a.level&&this.row===a.row&&this.col===a.col&&this.world===a.world};b.prototype.release=function(){this.world=this.col=this.row=this.level=0};b.prototype.set=function(a,b,f,g){null==a?this.world=this.col=this.row=this.level=0:"object"===typeof a?(this.level=
a.level||0,this.row=a.row||0,this.col=a.col||0,this.world=a.world||0):"string"===typeof a?(a=a.split("/"),b=a[1],f=a[2],g=a[3],this.level=parseFloat(a[0]),this.row=parseFloat(b),this.col=parseFloat(f),this.world=parseFloat(g)):(this.level=+a,this.row=+b,this.col=+f,this.world=+g||0);return this};b.prototype.toString=function(){return this.level+"/"+this.row+"/"+this.col+"/"+this.world};b.prototype.getChildKeys=function(){var a=this.level+1,e=this.row<<1,f=this.col<<1,g=this.world;return[new b(a,e,
f,g),new b(a,e,f+1,g),new b(a,e+1,f,g),new b(a,e+1,f+1,g)]};b.prototype.compareRowMajor=function(a){return this.row<a.row?-1:this.row>a.row?1:this.col<a.col?-1:this.col>a.col?1:0};b.pool=new a(b,null,null,25,50);return b}()})},"esri/portal/support/jsonContext":function(){define(["require","exports","../../core/urlUtils","../Portal"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.createForItem=function(b){return{origin:"portal-item",url:a.urlToObject(b.itemUrl),portal:b.portal||
m.getDefault(),portalItem:b,readResourcePaths:[]}}})},"esri/views/2d/engine/vectorTiles/SchemaHelper":function(){define(["require","exports","../../../../layers/support/LOD","../../../../layers/support/TileInfo"],function(n,b,a,m){return function(){function b(a,b){this.lockedSchemaPixelSize=a;this.isGCS=b}b.prototype.getLevelRowColumn=function(a){return this.isGCS?[a[0],a[1]>>1,a[2]>>1]:256===this.lockedSchemaPixelSize&&0<a[0]?[a[0]-1,a[1]>>1,a[2]>>1]:a};b.prototype.adjustLevel=function(a){return this.isGCS?
a:256===this.lockedSchemaPixelSize?0<a?a-1:0:a};b.prototype.getShift=function(a,b){var e=0,f=0;if(256===this.lockedSchemaPixelSize||this.isGCS)a[2]%2&&(e=b),a[1]%2&&(f=b);return[e,f]};b.prototype.getScale=function(a){if(this.isGCS){if(512===this.lockedSchemaPixelSize)return 4}else if(256===this.lockedSchemaPixelSize&&0===a)return 1;return 2};b.create256x256CompatibleTileInfo=function(b){if(!b)return null;if(256===b.size[0]&&256===b.size[1])return b;for(var e=b.spatialReference.isGeographic,g=[],h=
b.lods.length,d=0;d<h;d++){var c=b.lods[d];g.push(new a({level:c.level,scale:c.scale,resolution:e?c.resolution:2*c.resolution}))}return new m({size:[256,256],dpi:b.dpi,format:b.format,compressionQuality:b.compressionQuality,origin:b.origin,spatialReference:b.spatialReference,lods:g})};b.create512x512CompatibleTileInfo=function(b){if(!b||256===b.size[0]||256===b.size[1])return null;for(var e=[],g=b.lods.length,h=0;h<g;h++){var d=b.lods[h];e.push(new a({level:d.level,scale:d.scale,resolution:.5*d.resolution}))}return new m({size:[512,
512],dpi:b.dpi,format:b.format,compressionQuality:b.compressionQuality,origin:b.origin,spatialReference:b.spatialReference,lods:e})};return b}()})},"esri/views/2d/engine/vectorTiles/tileInfoUtils":function(){define(["require","exports","../../../../layers/support/TileInfo"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.areSchemasOverlapping=function(a,b){if(a===b)return!0;if(!a&&null!=b||null!=a&&!b||!a.spatialReference.equals(b.spatialReference)||a.dpi!==b.dpi)return!1;var e=
a.origin,f=b.origin;if(1E-6<=Math.abs(e.x-f.x)||1E-6<=Math.abs(e.y-f.y))return!1;a.lods[0].scale>b.lods[0].scale?(e=a,a=b):e=b;for(b=e.lods[0].scale;b>=a.lods[a.lods.length-1].scale-1E-6;b/=2)if(1E-6>Math.abs(b-a.lods[0].scale))return!0;return!1};b.unionTileInfos=function(b,h){if(b===h)return b;if(!b&&null!=h)return h;if(null!=b&&!h)return b;var e=b.size[0],f=b.format,g=b.dpi,l={x:b.origin.x,y:b.origin.y},d=b.spatialReference.toJSON(),c=b.lods[0].scale>h.lods[0].scale?b.lods[0]:h.lods[0];b=(b.lods[b.lods.length-
1].scale<=h.lods[h.lods.length-1].scale?b.lods[b.lods.length-1]:h.lods[h.lods.length-1]).scale;h=[];for(var k=c.scale,c=c.resolution,m=0;k>b;)h.push({level:m,resolution:c,scale:k}),m++,k/=2,c/=2;return new a({size:[e,e],dpi:g,format:f||"pbf",origin:l,lods:h,spatialReference:d})}})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["require","exports","../../../../../core/has","./StyleLayer"],function(n,b,a,m){return function(){function a(b,f){this.backgroundBucketIds=[];
this._layerByName={};this.styleJSON=b;this.version=parseFloat(b.version);this.sprite=f?f.spriteUrl:b.sprite;this.glyphs=f?f.glyphsUrl:b.glyphs;if(this.layers=(b.layers||[]).map(a._create))for(b=void 0,f=0;f<this.layers.length;f++)b=this.layers[f],this._layerByName[b.id.toLowerCase()]=b,0===b.type&&this.backgroundBucketIds.push(f);this._identifyRefLayers()}a.prototype.isPainterDataDriven=function(a){return(a=this._layerByName[a.toLowerCase()])?a.isPainterDataDriven():!1};a.prototype.getStyleLayerId=
function(a){return a>=this.layers.length?null:this.layers[a].id};a.prototype.getLayoutProperties=function(a){return(a=this._layerByName[a.toLowerCase()])?a.layout:null};a.prototype.getPaintProperties=function(a){return(a=this._layerByName[a.toLowerCase()])?a.paint:null};a.prototype.setPaintProperties=function(b,f){b=this._layerByName[b.toLowerCase()];if(!b)return"";var e=this.layers.indexOf(b);this.styleJSON.layers[e].paint=f;f=a._recreateLayer({id:b.id,type:b.typeName,source:b.source,sourceLayer:b["source-layer"],
minzoom:b.minzoom,maxzoom:b.maxzoom,filter:b.filter,layout:b.layout,paint:f},b);this.layers[e]=f;this._layerByName[b.id.toLowerCase()]=f;return b.id};a.prototype.setLayoutProperties=function(b,f){b=this._layerByName[b.toLowerCase()];if(!b)return"";var e=this.layers.indexOf(b);this.styleJSON.layers[e].layout=f;f=a._recreateLayer({id:b.id,type:b.typeName,source:b.source,sourceLayer:b["source-layer"],minzoom:b.minzoom,maxzoom:b.maxzoom,filter:b.filter,layout:f,paint:b.paint},b);this.layers[e]=f;this._layerByName[b.id.toLowerCase()]=
f;return b.id};a.prototype._identifyRefLayers=function(){for(var a=[],b=[],g=0,h=0,d=this.layers;h<d.length;h++){var c=d[h];if(1===c.type){var k=c,m=c.source+"|"+c.sourceLayer,m=m+("|"+JSON.stringify(c.layout&&c.layout.visibility)),m=m+("|"+JSON.stringify(c.minzoom)),m=m+("|"+JSON.stringify(c.maxzoom)),m=m+("|"+JSON.stringify(c.filter));if(k.hasDataDrivenFill||k.hasDataDrivenOutline)m+="|"+JSON.stringify(g);a.push({key:m,layer:c})}2===c.type&&(k=c,m=c.source+"|"+c.sourceLayer,m+="|"+JSON.stringify(c.layout&&
c.layout.visibility),m+="|"+JSON.stringify(c.minzoom),m+="|"+JSON.stringify(c.maxzoom),m+="|"+JSON.stringify(c.filter),m+="|"+JSON.stringify(c.layout&&c.layout["line-cap"]),m+="|"+JSON.stringify(c.layout&&c.layout["line-join"]),k.hasDataDrivenLine&&(m+="|"+JSON.stringify(g)),b.push({key:m,layer:c}));++g}this._assignRefLayers(a);this._assignRefLayers(b)};a.prototype._assignRefLayers=function(a){a.sort(function(a,c){return a.key<c.key?-1:a.key>c.key?1:0});for(var b,e,h=a.length,d=0;d<h;d++){var c=a[d];
if(c.key===b)c.layer.refLayerId=e;else if(b=c.key,e=c.layer.id,1===c.layer.type&&!c.layer.getPaintProperty("fill-outline-color"))for(var k=d+1;k<h;k++){var m=a[k];if(m.key===b){if(m.layer.getPaintProperty("fill-outline-color")){a[d]=m;a[k]=c;e=m.layer.id;break}}else break}}};a._create=function(a,b,g){b=1-1/(g.length+1)*(1+b);switch(a.type){case "background":return new m.BackgroundStyleLayer(0,a,b);case "fill":return new m.FillStyleLayer(1,a,b);case "line":return new m.LineStyleLayer(2,a,b);case "symbol":return new m.SymbolStyleLayer(3,
a,b);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new m.CircleStyleLayer(4,a,b)}throw Error("Unknown vector tile layer");};a._recreateLayer=function(a,b){switch(a.type){case "background":return new m.BackgroundStyleLayer(0,a,b.z);case "fill":return new m.FillStyleLayer(1,a,b.z);case "line":return new m.LineStyleLayer(2,a,b.z);case "symbol":return new m.SymbolStyleLayer(3,a,b.z);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new m.CircleStyleLayer(4,
a,b.z)}};return a}()})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("require exports tslib ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a,c,b){this.type=a;this.typeName=c.type;this.id=c.id;this.source=c.source;this.sourceLayer=c["source-layer"];this.minzoom=c.minzoom;this.maxzoom=c.maxzoom;this.filter=c.filter;this.layout=c.layout;this.paint=
c.paint;this.z=b;switch(a){case 0:this._layoutDefinition=h.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=h.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=h.StyleDefinition.fillLayoutDefinition;this._paintDefinition=h.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=h.StyleDefinition.lineLayoutDefinition;this._paintDefinition=h.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=h.StyleDefinition.symbolLayoutDefinition;
this._paintDefinition=h.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=h.StyleDefinition.circleLayoutDefinition,this._paintDefinition=h.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}a.prototype.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=m.createFilter(this.filter)};a.prototype.getLayoutProperty=function(a){var c=this._layoutProperties;
if(c)return c[a]};a.prototype.getPaintProperty=function(a){var c=this._paintProperties;if(c)return c[a]};a.prototype.getLayoutValue=function(a,c,b){var d,e=this._layoutProperties;e&&(e=e[a])&&(d=e.getValue(c,b));var f=this._layoutDefinition[a];void 0===d&&(d=f["default"]);"enum"===f.type?d=f.values.indexOf(d):"array"===f.type&&"enum"===f.value&&(d=d.map(function(a){return f.values.indexOf(a)}));return d};a.prototype.getPaintValue=function(a,c,b){var d,e=this._paintProperties;e&&(e=e[a])&&(d=e.getValue(c,
b));a=this._paintDefinition[a];void 0===d&&(d=a["default"]);"enum"===a.type&&(d=a.values.indexOf(d));return d};a.prototype.isPainterDataDriven=function(){var a=this._paintProperties;if(a)for(var c in a)if(a[c].isDataDriven)return!0;return!1};a.prototype._parseLayout=function(a){var c={},b;for(b in a){var d=this._layoutDefinition[b];d&&(c[b]=new e(d,a[b]))}return c};a.prototype._parsePaint=function(a){var c={},b;for(b in a){var d=this._paintDefinition[b];d&&(c[b]=new e(d,a[b]))}return c};return a}();
b.StyleLayer=n;var g=function(b){function d(a,d,e){return b.call(this,a,d,e)||this}a.__extends(d,b);return d}(n);b.BackgroundStyleLayer=g;g=function(b){function d(a,d,e){a=b.call(this,a,d,e)||this;d=a.getPaintProperty("fill-color");a.hasDataDrivenColor=d?d.isDataDriven:!1;d=a.getPaintProperty("fill-opacity");a.hasDataDrivenOpacity=d?d.isDataDriven:!1;a.hasDataDrivenFill=a.hasDataDrivenColor||a.hasDataDrivenOpacity;d=a.getPaintProperty("fill-outline-color");a.outlineUsesFillColor=!d;a.hasDataDrivenOutlineColor=
d?d.isDataDriven:!1;a.hasDataDrivenOutline=(d?a.hasDataDrivenOutlineColor:a.hasDataDrivenColor)||a.hasDataDrivenOpacity;return a}a.__extends(d,b);return d}(n);b.FillStyleLayer=g;g=function(b){function d(a,d,e){a=b.call(this,a,d,e)||this;e=a.getPaintProperty("line-color");a.hasDataDrivenColor=e?e.isDataDriven:!1;e=a.getPaintProperty("line-opacity");a.hasDataDrivenOpacity=e?e.isDataDriven:!1;e=a.getPaintProperty("line-width");a.hasDataDrivenWidth=e?e.isDataDriven:!1;a.hasDataDrivenLine=a.hasDataDrivenColor||
a.hasDataDrivenOpacity||a.hasDataDrivenWidth;d=d.paint["line-width"];d||(d=h.StyleDefinition.linePaintDefinition["line-width"].default);a.isThinLine=!a.hasDataDrivenWidth&&"number"===typeof d&&d<f.THIN_LINE_THRESHOLD;return a}a.__extends(d,b);return d}(n);b.LineStyleLayer=g;g=function(b){function d(a,d,e){a=b.call(this,a,d,e)||this;d=a.getPaintProperty("icon-color");a.hasDataDrivenIconColor=d?d.isDataDriven:!1;d=a.getPaintProperty("icon-opacity");a.hasDataDrivenIconOpacity=d?d.isDataDriven:!1;d=a.getLayoutProperty("icon-size");
a.hasDataDrivenIconSize=d?d.isDataDriven:!1;a.hasDataDrivenIcon=a.hasDataDrivenIconColor||a.hasDataDrivenIconOpacity||a.hasDataDrivenIconSize;d=a.getPaintProperty("text-color");a.hasDataDrivenTextColor=d?d.isDataDriven:!1;d=a.getPaintProperty("text-opacity");a.hasDataDrivenTextOpacity=d?d.isDataDriven:!1;d=a.getLayoutProperty("text-size");a.hasDataDrivenTextSize=d?d.isDataDriven:!1;a.hasDataDrivenText=a.hasDataDrivenTextColor||a.hasDataDrivenTextOpacity||a.hasDataDrivenTextSize;return a}a.__extends(d,
b);return d}(n);b.SymbolStyleLayer=g;n=function(b){function d(a,d,e){a=b.call(this,a,d,e)||this;d=a.getPaintProperty("circle-radius");a.hasDataDrivenRadius=d?d.isDataDriven:!1;d=a.getPaintProperty("circle-color");a.hasDataDrivenColor=d?d.isDataDriven:!1;d=a.getPaintProperty("circle-opacity");a.hasDataDrivenOpacity=d?d.isDataDriven:!1;d=a.getPaintProperty("circle-stroke-width");a.hasDataDrivenStrokeWidth=d?d.isDataDriven:!1;d=a.getPaintProperty("circle-stroke-color");a.hasDataDrivenStrokeColor=d?d.isDataDriven:
!1;d=a.getPaintProperty("circle-stroke-opacity");a.hasDataDrivenStrokeOpacity=d?d.isDataDriven:!1;d=a.getPaintProperty("circle-blur");a.hasDataDrivenBlur=d?d.isDataDriven:!1;return a}a.__extends(d,b);return d}(n);b.CircleStyleLayer=n;n=function(){return function(a,b,c){this.cap=a.getLayoutValue("line-cap",b,c);this.join=a.getLayoutValue("line-join",b,c);this.miterLimit=a.getLayoutValue("line-miter-limit",b,c);this.roundLimit=a.getLayoutValue("line-round-limit",b,c)}}();b.LineLayout=n;n=function(){return function(a,
b,c,e){this.allowOverlap=a.getLayoutValue("icon-allow-overlap",b,e);this.ignorePlacement=a.getLayoutValue("icon-ignore-placement",b,e);this.optional=a.getLayoutValue("icon-optional",b,e);this.rotationAlignment=a.getLayoutValue("icon-rotation-alignment",b,e);this.size=a.getLayoutValue("icon-size",b,e);this.rotate=a.getLayoutValue("icon-rotate",b,e);this.padding=a.getLayoutValue("icon-padding",b,e);this.keepUpright=a.getLayoutValue("icon-keep-upright",b,e);this.offset=a.getLayoutValue("icon-offset",
b,e);2===this.rotationAlignment&&(this.rotationAlignment=c?0:1)}}();b.IconLayout=n;n=function(){return function(a,b,c,e){this.allowOverlap=a.getLayoutValue("text-allow-overlap",b,e);this.ignorePlacement=a.getLayoutValue("text-ignore-placement",b,e);this.optional=a.getLayoutValue("text-optional",b,e);this.rotationAlignment=a.getLayoutValue("text-rotation-alignment",b,e);this.fontArray=a.getLayoutValue("text-font",b,e);this.maxWidth=a.getLayoutValue("text-max-width",b,e);this.lineHeight=a.getLayoutValue("text-line-height",
b,e);this.letterSpacing=a.getLayoutValue("text-letter-spacing",b,e);this.justify=a.getLayoutValue("text-justify",b,e);this.anchor=a.getLayoutValue("text-anchor",b,e);this.maxAngle=a.getLayoutValue("text-max-angle",b,e);this.size=a.getLayoutValue("text-size",b,e);this.rotate=a.getLayoutValue("text-rotate",b,e);this.padding=a.getLayoutValue("text-padding",b,e);this.keepUpright=a.getLayoutValue("text-keep-upright",b,e);this.transform=a.getLayoutValue("text-transform",b,e);this.offset=a.getLayoutValue("text-offset",
b,e);this.writingMode=a.getLayoutValue("text-writing-mode",b,e);2===this.rotationAlignment&&(this.rotationAlignment=c?0:1)}}();b.TextLayout=n})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["require","exports"],function(n,b){return function(){function a(b,h,e){this._op=b;"$type"===h?(this._val=e instanceof Array?e.map(function(b){return a._types.indexOf(b)}):a._types.indexOf(e),this._op+=11):(this._key=h,this._val=e)}a.prototype.filter=function(a){switch(this._op){case 0:return this._val;
case 1:return a.values[this._key]===this._val;case 2:return a.values[this._key]!==this._val;case 3:return a.values[this._key]<this._val;case 4:return a.values[this._key]>this._val;case 5:return a.values[this._key]<=this._val;case 6:return a.values[this._key]>=this._val;case 7:return-1!==this._val.indexOf(a.values[this._key]);case 8:return-1===this._val.indexOf(a.values[this._key]);case 9:for(var b=0,e=this._val;b<e.length;b++){var f=e[b];if(f.filter(a))return!0}return!1;case 10:b=0;for(e=this._val;b<
e.length;b++)if(f=e[b],!f.filter(a))return!1;return!0;case 11:b=0;for(e=this._val;b<e.length;b++)if(f=e[b],f.filter(a))return!1;return!0;case 12:return a.type===this._val;case 13:return a.type!==this._val;case 14:return a.type<this._val;case 15:return a.type>this._val;case 16:return a.type>=this._val;case 17:return a.type<=this._val;case 18:return-1!==this._val.indexOf(a.type);case 19:return-1===this._val.indexOf(a.type);case 20:return void 0!==a.values[this._key];case 21:return void 0===a.values[this._key]}};
a.createFilter=function(b){if(!b)return new a(0,void 0,!0);var h=b[0];if(1>=b.length)return new a(0,void 0,"any"!==h);switch(h){case "\x3d\x3d":return new a(1,b[1],b[2]);case "!\x3d":return new a(2,b[1],b[2]);case "\x3e":return new a(4,b[1],b[2]);case "\x3c":return new a(3,b[1],b[2]);case "\x3e\x3d":return new a(6,b[1],b[2]);case "\x3c\x3d":return new a(5,b[1],b[2]);case "in":return new a(7,b[1],b.slice(2));case "!in":return new a(8,b[1],b.slice(2));case "any":return new a(9,void 0,b.slice(1).map(a.createFilter.bind(this)));
case "all":return new a(10,void 0,b.slice(1).map(a.createFilter.bind(this)));case "none":return new a(11,void 0,b.slice(1).map(a.createFilter.bind(this)));case "has":return new a(20,b[1],void 0);case "!has":return new a(21,b[1],void 0);default:throw Error("invalid operator: "+h);}};a._types=["Unknown","Point","LineString","Polygon"];return a}()})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});
n=function(){function a(){}a.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};a.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};a.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"line-cap":{type:"enum",values:["butt","round","square"],default:"butt"},"line-join":{type:"enum",values:["bevel","round","miter"],default:"miter"},"line-miter-limit":{type:"number",default:2},
"line-round-limit":{type:"number",default:1.05}};a.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line"],default:"point"},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",
value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:"center"},"text-field":{type:"string"},
"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["left","center","right"],default:"center"},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",
value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:"none"},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:["horizontal"]}};
a.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};a.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}};a.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,
0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"}};a.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,
default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"line-width":{type:"number",minimum:0,default:1}};a.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,
maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},
"text-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"}};a.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",
minimum:0,default:300}};a.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,
default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"}};return a}();b.StyleDefinition=n})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["require","exports","../../../../../Color","../GeometryUtils"],function(n,b,a,m){return function(){function b(a,f){this.isDataDriven=!1;var e;switch(a.type){case "number":e=!0;break;case "color":e=!0;f=b._parseColor(f);break;case "array":e="number"===a.value;break;default:e=!1}null==f&&(f=a.default);
e&&"interval"===f.type&&(e=!1);var h=f&&f.stops&&0<f.stops.length;if(h)for(var d=0,c=f.stops;d<c.length;d++){var k=c[d];k[1]=this._validate(k[1],a)}if(this.isDataDriven=f?!!f.property:!1)if(void 0!==f.default&&(f.default=this._validate(f.default,a)),h)switch(f.type){case "identity":this.getValue=this._buildIdentity(f,a);break;case "categorical":this.getValue=this._buildCategorical(f,a);break;default:this.getValue=e?this._buildInterpolate(f,a):this._buildInterval(f,a)}else this.getValue=this._buildIdentity(f,
a);else h?this.getValue=e?this._buildZoomInterpolate(f):this._buildZoomInterval(f):(f=this._validate(f,a),this.getValue=this._buildSimple(f))}b.prototype._validate=function(a,b){if("number"===b.type){if(a<b.minimum)return b.minimum;if(a>b.maximum)return b.maximum}return a};b.prototype._buildSimple=function(a){return function(){return a}};b.prototype._buildIdentity=function(a,f){var e=this;return function(g,d){var c;d&&(c=d.values[a.property],"color"===f.type&&(c=b._parseColor(c)));void 0===c&&(c=
a.default);return void 0!==c?e._validate(c,f):f.default}};b.prototype._buildCategorical=function(a,b){var e=this;return function(f,d){var c;d&&(c=d.values[a.property]);c=e._categorical(c,a.stops);return void 0!==c?c:void 0!==a.default?a.default:b.default}};b.prototype._buildInterval=function(a,b){var e=this;return function(f,d){var c;d&&(c=d.values[a.property]);return"number"===typeof c?e._interval(c,a.stops):void 0!==a.default?a.default:b.default}};b.prototype._buildInterpolate=function(a,b){var e=
this;return function(f,d){var c;d&&(c=d.values[a.property]);return"number"===typeof c?e._interpolate(c,a.stops,a.base||1):void 0!==a.default?a.default:b.default}};b.prototype._buildZoomInterpolate=function(a){var b=this;return function(e){return b._interpolate(e,a.stops,a.base||1)}};b.prototype._buildZoomInterval=function(a){var b=this;return function(e){return b._interval(e,a.stops)}};b.prototype._categorical=function(a,b){for(var e=b.length,f=0;f<e;f++)if(b[f][0]===a)return b[f][1]};b.prototype._interval=
function(a,b){for(var e=b.length,f=0,d=0;d<e;d++)if(b[d][0]<=a)f=d;else break;return b[f][1]};b.prototype._interpolate=function(a,b,g){for(var e,d,c=b.length,f=0;f<c;f++){var h=b[f];if(h[0]<=a)e=h;else{d=h;break}}if(e&&d){f=d[0]-e[0];a-=e[0];g=1===g?a/f:(Math.pow(g,a)-1)/(Math.pow(g,f)-1);if(Array.isArray(e[1])){e=e[1];d=d[1];a=[];for(f=0;f<e.length;f++)a.push(m.interpolate(e[f],d[f],g));return a}return m.interpolate(e[1],d[1],g)}if(e)return e[1];if(d)return d[1]};b._isEmpty=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;
return!0};b._parseColor=function(e){if(Array.isArray(e))return e;if("string"===typeof e){if(e=new a(e),!this._isEmpty(e))return a.toUnitRGBA(e)}else return e&&e.default&&(e.default=b._parseColor(e.default)),e&&e.stops&&(e.stops=e.stops.map(function(a){return[a[0],b._parseColor(a[1])]})),e};return b}()})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["require","exports"],function(n,b){function a(a,b){a%=b;return 0<=a?a:a+b}Object.defineProperty(b,"__esModule",{value:!0});b.C_INFINITY=
Number.POSITIVE_INFINITY;b.C_PI=Math.PI;b.C_2PI=2*b.C_PI;b.C_PI_BY_2=b.C_PI/2;b.C_RAD_TO_256=128/b.C_PI;b.C_256_TO_RAD=b.C_PI/128;b.C_DEG_TO_256=256/360;b.C_DEG_TO_RAD=b.C_PI/180;b.C_SQRT2=1.414213562;b.C_SQRT2_INV=1/b.C_SQRT2;var m=1/Math.LN2;b.positiveMod=a;b.radToByte=function(h){return a(h*b.C_RAD_TO_256,256)};b.degToByte=function(h){return a(h*b.C_DEG_TO_256,256)};b.log2=function(a){return Math.log(a)*m};b.sqr=function(a){return a*a};b.interpolate=function(a,b,f){return a*(1-f)+b*f};b.between=
function(a,b,f){return a>=b&&a<=f||a>=f&&a<=b}})},"esri/views/2d/engine/webgl/definitions":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.WEBGL_MAX_STOPS=8;b.WEBGL_MAX_INNER_STOPS=b.WEBGL_MAX_STOPS-2;b.NAN_MAGIC_NUMBER=1E-30;b.EXTRUDE_SCALE=64;b.PICTURE_FILL_COLOR=4294967295;b.TILE_SIZE=512;b.RASTER_TILE_SIZE=256;b.ANGLE_FACTOR_256=256/360;b.DEBUG_LABELS=!1;b.COLLISION_BUCKET_SIZE=128;b.DOT_DENSITY_MAX_FIELDS=8;b.MAGIC_LABEL_LINE_HEIGHT=29;
b.COLLISION_MAX_ZOOM_DELTA=1;b.COLLISION_EARLY_REJECT_BUCKET_SIZE=16;b.COLLISION_BOX_PADDING=16;b.COLLISION_TILE_BOX_SIZE=b.TILE_SIZE/b.COLLISION_BUCKET_SIZE;b.COLLISION_PLACEMENT_PADDING=8;b.HEURISTIC_GLYPHS_PER_LINE=50;b.HEURISTIC_GLYPHS_PER_FEATURE=10;b.GLYPH_SIZE=24;b.TEXT_PLACEMENT_PADDING=8;b.AVERAGE_GLYPH_MOSAIC_ITEM={metrics:{width:15,height:17,left:0,top:-7,advance:14}};b.ATTRIBUTE_STORE_TEXTURE_SIZE=1024;b.TEXTURE_BINDING_SPRITE_ATLAS=0;b.TEXTURE_BINDING_GLYPH_ATLAS=0;b.TEXTURE_BINDING_BITMAP=
0;b.TEXTURE_BINDING_ATTRIBUTE_DATA_0=1;b.TEXTURE_BINDING_ATTRIBUTE_DATA_1=2;b.TEXTURE_BINDING_ATTRIBUTE_DATA_2=3;b.TEXTURE_BINDING_ATTRIBUTE_DATA_3=4;b.TEXTURE_BINDING_HIGHLIGHT_0=5;b.TEXTURE_BINDING_HIGHLIGHT_1=6;b.TEXTURE_BINDING_RENDERER_0=5;b.TEXTURE_BINDING_RENDERER_1=6;b.ATTRIBUTE_DATA_FILTER_FLAGS=0;b.ATTRIBUTE_DATA_ANIMATION=1;b.ATTRIBUTE_DATA_VV=2;b.ATTRIBUTE_DATA_DD0=3;b.ATTRIBUTE_DATA_DD1=3;b.MAX_FILTERS=2;b.HIGHLIGHT_FLAG=1;b.FILTER_FLAG_0=2;b.EFFECT_FLAG_0=4;b.THIN_LINE_THRESHOLD=2.5;
b.HITTEST_SEARCH_SIZE=24;b.MAX_ANIMATION_TIME_MS=2E3;b.VTL_TEXTURE_BINDING_UNIT_SPRITES=5;b.VTL_TEXTURE_BINDING_UNIT_GLYPHS=6;b.VTL_HIGH_RES_CUTOFF=1.15;b.MAX_GPU_UPLOADS_PER_FRAME=2})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("require exports tslib ../../../webgl ./RenderBucket ../webgl/TiledDisplayObject".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a,d,e,g,h,l){e=b.call(this,a,e,g,[4096,4096])||this;e._referenced=
0;e._symbolFadeHold=null;e._vectorTileData=null;e._symbolUpdateData=null;e._memoryUsed=f;e.rotation=0;e.layerData={};e.status="loading";e._referenced=1;e.styleLayers=d;e.id=a.id;e.rotation=h;e._cacheWorkerTiles=l;return e}a.__extends(d,b);Object.defineProperty(d.prototype,"hasSymbolBuckets",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isHoldingForFade",{get:function(){return null!==this._symbolFadeHold},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"isSymbolFadeDone",{get:function(){return!this._symbolFadeHold||this._symbolFadeHold<performance.now()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"wasRequested",{get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status},enumerable:!0,configurable:!0});d.prototype.setData=function(a,b,d){this._vectorTileData=a;this.client=b;this.refKeys=d;this._memoryUsed=f;this.ready()};d.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=
a,this.requestRender())};d.prototype.updateTileData=function(a){this._vectorTileData=a;this.stage.requestRender();this._memoryUsed=f};d.prototype.clearSymbolFadeHold=function(){this._symbolFadeHold=null};d.prototype.setSymbolHoldDuration=function(a){this._symbolFadeHold=performance.now()+a};d.prototype.hasData=function(){return 0<Object.keys(this.layerData).length};d.prototype.dispose=function(){this._cacheWorkerTiles&&this.client&&this.client.invoke("destructTileData",this.id).catch(function(){});
this._deleteBufferMemory();this.destroy();this._memoryUsed=f};d.prototype.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};d.prototype.reference=function(){++this._referenced};Object.defineProperty(d.prototype,"referenced",{get:function(){return this._referenced},enumerable:!0,configurable:!0});d.prototype.getMemoryUsage=function(){var a=this;this._memoryUsed===f&&(this._memoryUsed=g.reduce(function(c,b){return a[b]?c+a[b].size:c},0),this.texture&&(this._memoryUsed+=
this.texture.descriptor.width*this.texture.descriptor.height*4),this._vectorTileData&&this._vectorTileData.bufferData&&(this._memoryUsed+=this._vectorTileData.bufferData.reduce(function(a,c){return a+c.byteLength},this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength)));return this._memoryUsed/(this._referenced||1)};d.prototype.commitChanges=function(){if(this._vectorTileData||this._symbolUpdateData)this._vectorTileData?(this._deleteBufferMemory(),this._createRenderBuckets(),
this._createBufferObjects(),this._vectorTileData=null):this._symbolUpdateData&&(this._updateSymbolData(this._symbolUpdateData),this._symbolUpdateData=null)};d.prototype._deleteBufferMemory=function(){for(var a=0,b="fillVertexArrayObject fillDDVertexArrayObject outlineVertexArrayObject lineVertexArrayObject lineDDVertexArrayObject iconVertexArrayObject iconDDVertexArrayObject textVertexArrayObject textDDVertexArrayObject circleVertexArrayObject fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer texture".split(" ");a<
b.length;a++){var d=b[a];this[d]&&(this[d].dispose(),this[d]=null)}this.layerData={};this.triangleCount=0};d.prototype._createRenderBuckets=function(){for(var a=new Uint32Array(this._vectorTileData.bucketDataInfo),b=a.length,d=0;d<b;){var e=a[d];switch(a[d+1]){case 0:(new h.BackgroundRenderBucket).layerID=e;d+=2;break;case 1:var f=new h.FillRenderBucket;f.layerID=e;f.triangleElementStart=a[d+2];f.triangleElementCount=a[d+3];f.outlineElementStart=a[d+4];f.outlineElementCount=a[d+5];if(0!==f.triangleElementCount||
0!==f.outlineElementCount)this.layerData[e]=f;d+=6;break;case 2:f=new h.LineRenderBucket;f.layerID=e;f.triangleElementStart=a[d+2];f.triangleElementCount=a[d+3];0<f.triangleElementCount&&(this.layerData[e]=f);d+=4;break;case 3:f=new h.SymbolRenderBucket;f.layerID=e;f.isSDF=0!==a[d+2];var g=d+3,l=a[g];g++;for(var m=0;m<l;m++){var w=a[g],q=a[g+1],n=a[g+2];f.iconPerPageElementsMap.set(w,[q,n]);g+=3}var A=a[g];g++;for(m=0;m<A;m++)w=a[g],q=a[g+1],n=a[g+2],f.glyphPerPageElementsMap.set(w,[q,n]),g+=3;if(0<
f.iconPerPageElementsMap.size||0<f.glyphPerPageElementsMap.size)this.layerData[e]=f;d+=5+3*l+3*A;break;case 4:f=new h.CircleRenderBucket;f.layerID=e;f.triangleElementStart=a[d+2];f.triangleElementCount=a[d+3];0<f.triangleElementCount&&(this.layerData[e]=f);d+=4;break;default:console.error("Bad bucket type!"),d+=2}}};d.prototype.attachWithContext=function(a){this.stage={context:a,trashDisplayObject:function(a){a.processDetach()},untrashDisplayObject:function(){return!1}}};d.prototype._updateSymbolData=
function(a){if(!a||!a.bucketDataInfo)return!0;var c=new Uint32Array(a.bucketDataInfo),b=c.length;if(0===b)return!0;if(!this.isReady)return this.requestRender(),!1;for(var d=this.stage.context,e=new Uint32Array(a.bufferDataInfo),f=e.length,g=0,l=0;l<f;l+=2,g++)switch(e[l]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=m.BufferObject.createVertex(d,35044,a.bufferData[g]);break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),
this.iconDDVertexBuffer=null);this.iconDDVertexBuffer=m.BufferObject.createVertex(d,35044,a.bufferData[g]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);this.iconIndexBuffer=m.BufferObject.createIndex(d,35044,a.bufferData[g]);break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=m.BufferObject.createVertex(d,35044,a.bufferData[g]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),
this.textDDVertexBuffer=null);this.textDDVertexBuffer=m.BufferObject.createVertex(d,35044,a.bufferData[g]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=m.BufferObject.createIndex(d,35044,a.bufferData[g])}a={};for(var w in this.layerData)3!==this.layerData[w].type&&(a[w]=this.layerData[w]);this.layerData=a;d=this.styleLayers.layers;for(e=0;e<b;){w=c[e];f=new h.SymbolRenderBucket;f.layerID=w;f.isSDF=0!==c[e+2];d.length>f.layerID&&
d[f.layerID].type===f.type&&(a[f.layerID]=f);var q=e+3;w=c[q];q++;for(g=0;g<w;g++){var l=c[q],n=c[q+1],A=c[q+2];f.iconPerPageElementsMap.set(l,[n,A]);q+=3}var B=c[q];q++;for(g=0;g<B;g++)l=c[q],n=c[q+1],A=c[q+2],f.glyphPerPageElementsMap.set(l,[n,A]),q+=3;e+=5+3*w+3*B}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),
this.textVertexArrayObject=null);this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);return!0};d._createBufferToObject=function(){var a=[];a[1]={create:m.BufferObject.createVertex,var:"fillVertexBuffer"};a[2]={create:m.BufferObject.createVertex,var:"fillDDVertexBuffer"};a[3]={create:m.BufferObject.createIndex,var:"fillIndexBuffer"};a[4]={create:m.BufferObject.createVertex,var:"outlineVertexBuffer"};a[5]={create:m.BufferObject.createVertex,var:"outlineDDVertexBuffer"};
a[6]={create:m.BufferObject.createIndex,var:"outlineIndexBuffer"};a[7]={create:m.BufferObject.createVertex,var:"lineVertexBuffer"};a[8]={create:m.BufferObject.createVertex,var:"lineDDVertexBuffer"};a[9]={create:m.BufferObject.createIndex,var:"lineIndexBuffer"};a[10]={create:m.BufferObject.createVertex,var:"iconVertexBuffer"};a[11]={create:m.BufferObject.createVertex,var:"iconDDVertexBuffer"};a[12]={create:m.BufferObject.createIndex,var:"iconIndexBuffer"};a[13]={create:m.BufferObject.createVertex,
var:"textVertexBuffer"};a[14]={create:m.BufferObject.createVertex,var:"textDDVertexBuffer"};a[15]={create:m.BufferObject.createIndex,var:"textIndexBuffer"};a[16]={create:m.BufferObject.createVertex,var:"circleVertexBuffer"};a[17]={create:m.BufferObject.createIndex,var:"circleIndexBuffer"};return a};d.prototype._createBufferObjects=function(){for(var a=this.stage.context,b=new Uint32Array(this._vectorTileData.bufferDataInfo),e=b.length,f=0;f<e;f+=2){var g=f/2;if(!(0>=b[f+1]||0===this._vectorTileData.bufferData[g].byteLength)){var h=
b[f],l=d.bufferToObject[h];l?this[l.var]?this[l.var].setData(this._vectorTileData.bufferData[g]):this[l.var]=l.create(a,35044,this._vectorTileData.bufferData[g]):console.error("Bad buffer type "+h)}}};d.bufferToObject=d._createBufferToObject();return d}(e.TiledDisplayObject);b.VectorTile=n;var f=-1,g="fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer".split(" ")})},
"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define(["require","exports","tslib"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(a){this.type=a}}();b.RenderBucket=n;var m=function(b){function e(){var a=b.call(this,2)||this;a.triangleElementStart=0;a.triangleElementCount=0;return a}a.__extends(e,b);e.prototype.hasData=function(){return 0<this.triangleElementCount};e.prototype.triangleCount=function(){return this.triangleElementCount/3};return e}(n);
b.LineRenderBucket=m;m=function(b){function e(){var a=b.call(this,1)||this;a.triangleElementStart=0;a.triangleElementCount=0;a.outlineElementStart=0;a.outlineElementCount=0;return a}a.__extends(e,b);e.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.outlineElementCount};e.prototype.triangleCount=function(){return(this.triangleElementCount+this.outlineElementCount)/3};return e}(n);b.FillRenderBucket=m;m=function(b){function e(){var a=b.call(this,3)||this;a.iconPerPageElementsMap=
new Map;a.glyphPerPageElementsMap=new Map;a.isSDF=!1;return a}a.__extends(e,b);e.prototype.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};e.prototype.triangleCount=function(){var a=0;this.iconPerPageElementsMap.forEach(function(b){a+=b[1]});this.glyphPerPageElementsMap.forEach(function(b){a+=b[1]});return a/3};return e}(n);b.SymbolRenderBucket=m;m=function(b){function e(){var a=b.call(this,4)||this;a.triangleElementStart=0;a.triangleElementCount=
0;return a}a.__extends(e,b);e.prototype.hasData=function(){return 0<this.triangleElementCount};e.prototype.triangleCount=function(){return this.triangleElementCount/3};return e}(n);b.CircleRenderBucket=m;n=function(b){function e(){return b.call(this,0)||this}a.__extends(e,b);e.prototype.hasData=function(){return!0};e.prototype.triangleCount=function(){return 2};return e}(n);b.BackgroundRenderBucket=n})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define("require exports tslib ../../../../core/has ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f32 ../DisplayObject ../../tiling/TileKey".split(" "),
function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a,d,f,h){void 0===h&&(h=f);var c=b.call(this)||this;c.transforms={dvs:e.mat3f32.create(),tileMat3:e.mat3f32.create()};c.triangleCount=0;c.key=g.pool.acquire(a);c.bounds=d;c.size=f;c.coordRange=h;return c}a.__extends(d,b);d.prototype.destroy=function(){g.pool.release(this.key);this.key=null;this.texture&&(this.texture.dispose(),this.texture=null)};Object.defineProperty(d.prototype,"coords",{get:function(){return this._coords},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"bounds",{get:function(){return this._bounds},set:function(a){this._coords=[a[0],a[3]];this._bounds=a},enumerable:!0,configurable:!0});d.prototype.setTransform=function(a,b){b/=a.resolution*a.pixelRatio;var c=this.transforms.tileMat3,d=a.toScreenNoRotation([0,0],this.coords);h.mat3.set(c,this.size[0]/this.coordRange[0]*b,0,0,0,this.size[1]/this.coordRange[1]*b,0,d[0],d[1],1);h.mat3.multiply(this.transforms.dvs,a.displayViewMat3,c)};
return d}(f.DisplayObject);b.TiledDisplayObject=n})},"esri/core/libs/gl-matrix-2/mat3f32":function(){define(["require","exports","./factories/mat3f32"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.mat3f32=a})},"esri/core/libs/gl-matrix-2/factories/mat3f32":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var a=new Float32Array(9);a[0]=1;a[4]=1;a[8]=1;return a};b.clone=function(a){var b=new Float32Array(9);
b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};b.fromValues=function(a,b,h,e,f,g,l,d,c){var k=new Float32Array(9);k[0]=a;k[1]=b;k[2]=h;k[3]=e;k[4]=f;k[5]=g;k[6]=l;k[7]=d;k[8]=c;return k};b.createView=function(a,b){return new Float32Array(a,b,9)}})},"esri/views/2d/engine/DisplayObject":function(){define(["require","exports","tslib","../../../core/Evented"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(){var a=
null!==b&&b.apply(this,arguments)||this;a._clips=null;a._isReady=!1;a._opacity=1;a._stage=null;a._visible=!0;return a}a.__extends(e,b);Object.defineProperty(e.prototype,"clips",{get:function(){return this._clips},set:function(a){this._clips=a;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"isReady",{get:function(){return this._isReady},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"opacity",{get:function(){return this._opacity},set:function(a){this._opacity!==
a&&(this._opacity=a,this.requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"stage",{get:function(){return this._stage},set:function(a){if(this._stage!==a){var b=this._stage;(this._stage=a)?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):b.trashDisplayObject(this)}},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible!==a&&(this._visible=a,this.requestRender())},
enumerable:!0,configurable:!0});e.prototype.setTransform=function(a){};e.prototype.processRender=function(a){this.visible&&this.stage&&this.doRender(a)};e.prototype.requestRender=function(){this.stage&&this.stage.requestRender()};e.prototype.processDetach=function(){this.onDetach();this.emit("detach")};e.prototype.onAttach=function(){};e.prototype.onDetach=function(){};e.prototype.doRender=function(a){};e.prototype.ready=function(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())};
return e}(m);b.DisplayObject=n})},"esri/views/3d/terrain/RasterTile":function(){define(["require","exports","../../../core/maybe","../../webgl/rasterUtils"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});var h={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,type:"stretch"};n=function(){function b(a,b,e,d){void 0===e&&(e=null);void 0===d&&(d=null);
this._interpolation=this._bandIds=this._symbolizerParameters=this._source=this._memoryUsed=null;this._dirty=!1;this.lij=this.rawPixelData=this.symbolizerRenderer=this._transformGrid=null;this.scale=1;this.offset=[0,0];this.opacity=1;this.lij=a;this.source=b;this.width=e||b.width;this.height=d||b.height}Object.defineProperty(b.prototype,"source",{get:function(){return this._source},set:function(a){this._source=a;this._rasterTexture&&(this._rasterTexture.dispose(),this._memoryUsed=this._rasterTexture=
null)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"symbolizerParameters",{get:function(){return this._symbolizerParameters||h},set:function(a){this._symbolizerParameters=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"bandIds",{get:function(){return this._bandIds},set:function(b){var e=this;a.isSome(b)&&0<b.length?this._bandIds&&b.every(function(a,b){return e._bandIds[b]?a===e._bandIds[b]:!1})||(this._bandIds=b,this._dirty=!0):this._bandIds=null},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"interpolation",{get:function(){return this._interpolation},set:function(a){this._interpolation=a;this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===a?9729:9728)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"transformGrid",{get:function(){return this._transformGrid},set:function(a){this._transformGrid=a;this._transformGridTexture&&(this._transformGridTexture.dispose(),this._memoryUsed=this._transformGridTexture=
null)},enumerable:!0,configurable:!0});b.prototype.bind=function(a){if(!(this.source&&this.source.pixels&&0<this.source.pixels.length))return!1;this._rasterTexture&&!this._dirty||this._updateRasterTexture(a,this.bandIds);this._rasterTexture&&(this._updateColormapTexture(a),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=m.createTransformTexture(a,this.transformGrid)));return!0};b.prototype.getUniforms=function(){var a=m.getBasicGridUniforms(this.scale,this.offset),b=this.symbolizerParameters,
e=m.getCommonUniforms(this.transformGrid,[this.width,this.height],[this.source.width,this.source.height],this.opacity),b=b.colormap?m.getColormapUniforms(b.colormap,b.colormapOffset):null,d="stretch"===this.symbolizerParameters.type?m.getStretchUniforms(this.symbolizerParameters):null,c="hillshade"===this.symbolizerParameters.type?m.getShadedReliefUniforms(this.symbolizerParameters):null;return{basic:a,common:e,colormap:b,stretch:d,hillshade:c}};b.prototype.getTextures=function(){if(!this._rasterTexture)return null;
var a=[],b=[];this._transformGridTexture&&(b.push(this._transformGridTexture),a.push("u_transformGrid"));this._rasterTexture&&(b.push(this._rasterTexture),a.push("u_image"));this._colormapTexture&&(b.push(this._colormapTexture),a.push("u_colormap"));return{names:a,textures:b}};b.prototype.getMemoryUsage=function(){if(a.isNone(this._memoryUsed)){var b=this.getTextures();if(null==b)return 0;this._memoryUsed=b.textures.map(function(a){return a.descriptor.width*a.descriptor.height*4}).reduce(function(a,
b){return a+b})}return this._memoryUsed};b.prototype.release=function(){this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null);this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null);this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null);this.rawPixelData=this.transformGrid=this.source=null;return!0};b.prototype._updateRasterTexture=function(b,e){var f=this.source?this.source.extractBands(e):null;if(f&&
f.pixels&&0<f.pixels.length){e=a.isNone(e)&&a.isNone(this.bandIds)||a.isSome(e)&&a.isSome(this.bandIds)&&e.join("")===this.bandIds.join("");if(this._rasterTexture){if(e)return;this._rasterTexture.dispose();this._rasterTexture=null}this._rasterTexture=m.createRasterTexture(b,f,this.interpolation||"nearest")}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null)};b.prototype._updateColormapTexture=function(a){var b=this._colormap,e=this.symbolizerParameters.colormap;if(!e)this._colormapTexture&&
(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormap=null;else if(!b)this._colormapTexture=m.createColormapTexture(a,e),this._colormap=e;else if(e.length!==b.length||e.some(function(a,c){return a!==b[c]}))this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=m.createColormapTexture(a,e),this._colormap=e};return b}();b.default=n})},"esri/views/webgl/rasterUtils":function(){define(["require","exports","../webgl"],function(n,
b,a){Object.defineProperty(b,"__esModule",{value:!0});b.createRasterTexture=function(b,h,e,f){void 0===e&&(e="nearest");void 0===f&&(f=!1);var g=!(f&&"u8"===h.pixelType);f=g?5126:5121;g=null==h.pixels||0===h.pixels.length?null:g?h.getAsRGBAFloat():h.getAsRGBA();return new a.Texture(b,{width:h.width,height:h.height,target:3553,pixelFormat:6408,internalFormat:6408,samplingMode:"bilinear"===e||"cubic"===e?9729:9728,dataType:f,wrapMode:33071,flipped:!1},g)};b.createFrameBuffer=function(b,h,e,f){f=new a.Texture(b,
{width:h,height:e,target:3553,pixelFormat:6408,internalFormat:6408,samplingMode:9728,dataType:f?5121:5126,wrapMode:33071,flipped:!1});return new a.FramebufferObject(b,{colorTarget:0,depthStencilTarget:3,width:h,height:e},f)};b.createTransformTexture=function(b,h){for(var e=4*h.size[0],f=h.size[1],g={width:e,height:f,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5126,samplingMode:9728,wrapMode:33071,flipped:!1},e=new Float32Array(e*f*4),l=f=0;l<h.coefficients.length;l++)e[f++]=h.coefficients[l],
2===l%3&&(e[f++]=1);return new a.Texture(b,g,e)};b.createColormapTexture=function(b,h){return new a.Texture(b,{width:h.length/4,height:1,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,flipped:!1},h)};b.getCommonUniforms=function(a,b,e,f,g,l){void 0===f&&(f=1);void 0===g&&(g=!0);void 0===l&&(l=!1);return{u_flipY:g,u_isFloatTexture:l,u_applyTransform:a?!0:!1,u_opacity:f,u_transformSpacing:a?a.spacing:null,u_transformGridSize:a?a.size:null,u_targetImageSize:b,
u_srcImageSize:e}};b.getColormapUniforms=function(a,b){return{u_colormapOffset:b||0,u_colormapMaxIndex:a?a.length/4-1:null}};b.getBasicGridUniforms=function(a,b){return{u_scale:a,u_offset:b}};b.getStretchUniforms=function(a){return{u_bandCount:a.bandCount,u_minOutput:a.outMin,u_maxOutput:a.outMax,u_minCutOff:a.minCutOff,u_maxCutOff:a.maxCutOff,u_factor:a.factor,u_useGamma:a.useGamma,u_gamma:a.gamma,u_gammaCorrection:a.gammaCorrection}};b.getShadedReliefUniforms=function(a){return{u_hillshadeType:a.hillshadeType,
u_sinZcosAs:a.sinZcosAs,u_sinZsinAs:a.sinZsinAs,u_cosZs:a.cosZs,u_weights:a.weights,u_factor:a.factor,u_minValue:a.minValue,u_maxValue:a.maxValue}};b.getUniformLocationInfos=function(a,b){a=a.gl;b=b.glName;for(var e=a.getProgramParameter(b,a.ACTIVE_UNIFORMS),f=new Map,g,h=0;h<e;h++)(g=a.getActiveUniform(b,h))&&f.set(g.name,{location:a.getUniformLocation(b,g.name),info:g});return f};b.setUniforms=function(a,b,e){Object.keys(e).forEach(function(f){var g=b.get(f)||b.get(f+"[0]");if(g){var h=e[f];if(null!==
g&&null!=h)switch(g=g.info,g.type){case 5126:1<g.size?a.setUniform1fv(f,h):a.setUniform1f(f,h);break;case 35664:a.setUniform2fv(f,h);break;case 35665:a.setUniform3fv(f,h);break;case 35666:a.setUniform4fv(f,h);break;case 35675:a.setUniformMatrix3fv(f,h);break;case 35676:a.setUniformMatrix4fv(f,h);break;case 5124:1<g.size?a.setUniform1iv(f,h):a.setUniform1i(f,h);break;case 35670:a.setUniform1i(f,h?1:0);break;case 35667:case 35671:a.setUniform2iv(f,h);break;case 35668:case 35672:a.setUniform3iv(f,h);
break;case 35669:case 35673:a.setUniform4iv(f,h)}}})};b.setTextures=function(a,b,e,f){e.length===f.length&&(f.some(function(a){return null==a})||e.some(function(a){return null==a})||e.forEach(function(e,h){b.setUniform1i(e,h);a.bindTexture(f[h],h)}))}})},"esri/views/3d/terrain/terrainUtilsPlanar":function(){define("require exports ../../../core/Error ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingRect ./TerrainConst ./TilingScheme".split(" "),
function(n,b,a,m,h,e,f,g){function l(a,b,e,f){m.vec3.copy(d,e);d[f]=b[f];f=m.vec3.subtract(d,d,b);var g=m.vec3.subtract(c,a,b),g=m.vec3.dot(g,f),k=m.vec3.dot(f,f);b=0>=g?b:k<=g?e:m.vec3.add(d,b,m.vec3.scale(f,f,g/k));a=m.vec3.subtract(d,a,b);return Math.PI/2-Math.atan(a[2]/Math.sqrt(a[0]*a[0]+a[1]*a[1]))}Object.defineProperty(b,"__esModule",{value:!0});var d=h.vec3f64.create(),c=h.vec3f64.create(),k=h.vec3f64.create(),p=h.vec3f64.create();b.isInsideExtent=function(a,c,b){void 0===b&&(b=0);a=a.extent;
return 0===b?e.containsPoint(a,c):e.containsPointWithMargin(a,c,b*Math.min(a[2]-a[0],a[3]-a[1]))};b.tiltOnEdge=l;b.tiltToExtentEdge=function(a,c){var b=a.elevationBounds;a=a.extent;b=.5*(b.min+b.max);k[0]=a[0];k[1]=a[1];k[2]=b;p[0]=a[2];p[1]=a[3];p[2]=b;a=b=Infinity;c[0]<k[0]?b=l(c,k,p,0):c[0]>p[0]&&(b=l(c,p,k,0));c[1]<k[1]?a=l(c,k,p,1):c[1]>p[1]&&(a=l(c,p,k,1));return Math.min(b,a)};b.checkIfTileInfoSupportedForViewSR=function(c,b,d){if(c.spatialReference.isGeographic)return new a("tilingscheme:local-gcs-not-supported",
"Geographic coordinate systems are not supported in local scenes");var k=g.checkUnsupported(c);if(k)return k;var h=c.lods,k=h[0].resolution*Math.pow(2,h[0].level),l=[k*c.size[0],k*c.size[1]],m=[c.origin.x,c.origin.y];d=e.fromExtent(d);var p=e.create();g.computeRowColExtent(d,l,m,p);l=(p[2]-p[0])*(p[3]-p[1]);l>f.MAX_ROOT_TILES?(h=h[0].scale*Math.pow(2,h[0].level),k=Math.max((d[3]-d[1])/c.size[1],(d[2]-d[0])/c.size[0])*h/k,d=Math.floor(Math.log(k)/Math.log(10)),k=Math.ceil(k/Math.pow(10,d))*Math.pow(10,
d),k=new a("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(h).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+k.toLocaleString()+".",{level0Scale:h,suggestedLevel0Scale:k,requiredNumRootTiles:l,allowedNumRootTiles:f.MAX_ROOT_TILES})):k=null;return k?k:b&&!c.spatialReference.equals(b)?new a("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}})},"esri/views/3d/terrain/terrainUtilsSpherical":function(){define(["require",
"exports","../../../core/Error","../support/projectionUtils","./TilingScheme"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.isInsideExtent=function(){return!0};b.tiltToExtentEdge=function(){return 0};b.checkIfTileInfoSupportedForViewSR=function(b,f){var e=b.lods.length-1;if(b.spatialReference.isWebMercator){if(!h.makeWebMercatorAuxiliarySphere(e).compatibleWith(b))return new a("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(m.canProjectToWGS84ComparableLonLat(b.spatialReference)){if(!h.makeGCSWithTileSize(b.spatialReference,
b.size[0],e).compatibleWith(b))return b.spatialReference.isWGS84?new a("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new a("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new a("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(f&&!b.spatialReference.equals(f))return new a("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the global scene")}})},"esri/views/3d/terrain/TileTexture":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a){this._texture=a;this._refCount=1}a.prototype.retain=function(){++this._refCount};a.prototype.release=function(){--this._refCount;0===this._refCount&&this._texture.dispose()};Object.defineProperty(a.prototype,"texture",{get:function(){return this._texture},
enumerable:!0,configurable:!0});a.prototype.generateMipmap=function(){this._texture.generateMipmap()};Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._texture.descriptor},enumerable:!0,configurable:!0});return a}();b.TileTexture=n})},"esri/views/3d/support/SharedSymbolResources":function(){define("require exports ../../../core/arrayUtils ../../../core/Handles ./TextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,
"__esModule",{value:!0});n=function(){function b(a){this.streamDataRequester=this.textures=null;this.graphicsOwners=[];this.cimSymbolRasterizer=this.screenSizePerspectiveHandles=null;this.viewState=a.viewState;this.stage=a.stage;this.pointsOfInterest=a.pointsOfInterest;this.resourceController=a.resourceController;this.objectResourceCache=a.objectResourceCache;this.streamDataRequester=this.resourceController.createStreamDataRequester(3);this.textures=new h.default(this.streamDataRequester,a.stage,
{preMultiplyAlpha:!0,wrap:{s:33071,t:33071}});this.screenSizePerspectiveSettings=e.getSettings(a.viewingMode);this.screenSizePerspectiveSettingsLabels=e.getLabelSettings(a.viewingMode)}b.prototype.destroy=function(){this.textures.destroy();this.streamDataRequester=this.textures=null};b.prototype.addGraphicsOwner=function(b){var d=this;if(!b)return{remove:function(){}};this.graphicsOwners.push(b);var c="layer"in b?b.watch("layer.screenSizePerspectiveEnabled",function(){return d.updateScreenSizePerspectiveEnabled()}):
null;this.updateScreenSizePerspectiveEnabled();return{remove:function(){c&&(c.remove(),a.removeUnordered(d.graphicsOwners,b),d.updateScreenSizePerspectiveEnabled())}}};b.prototype.updateScreenSizePerspectiveEnabled=function(){var a=this,b=this.graphicsOwners.some(function(a){return!0===a.get("layer.screenSizePerspectiveEnabled")});b&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new m,b=function(){return a.updateScreenSizePerspectiveSettings()},this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",
b,!0),this.viewState.events.on("camera-projection-changed",b)]),this.updateScreenSizePerspectiveSettings()):!b&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)};b.prototype.updateScreenSizePerspectiveSettings=function(){f.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;f.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(f);this.screenSizePerspectiveSettingsLabels.update(f);this.stage.renderView.setNeedsRender()};
return b}();b.SharedSymbolResources=n;var f={distance:0,fovY:0};b.default=n})},"esri/views/3d/support/TextureCollection":function(){define("require exports tslib ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/urlUtils ../webgl-engine/lib/Texture".split(" "),function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,c,b,f){void 0===f&&(f=e.schedule);this._streamDataRequester=a;this._stage=c;this._textureOptions=b;this._schedule=
f;this._textureRequests=new Map}b.prototype.destroy=function(){var a=this;this._textureRequests.forEach(function(c){return a.releaseTextureRequest(c)});this._textureRequests=null};b.prototype.fromUrl=function(b,c,e){return a.__awaiter(this,void 0,void 0,function(){var d,f,g,k,l,n=this;return a.__generator(this,function(a){h.throwIfAborted(e);d=m.isSome(e)&&e.signal;f=this.makeUid(b,c);g=this._textureRequests.get(f);g||(k=h.createAbortController(),l=this._streamDataRequester.request(b,"image",{uid:f,
signal:k.signal}),g={referenceCount:0,texture:null,textureAsync:null,abortController:k},this._textureRequests.set(f,g),g.textureAsync=l.then(function(a){a=n.createTexture(b,a,c);g.texture=a;g.abortController=null;n.addToStage(a);return{uid:f,texture:a}},function(a){g.abortController=null;throw a;}));g.referenceCount++;return[2,h.create(function(a,c){h.onAbort(d,function(){c(h.createAbortError())});g.textureAsync.then(a,c)}).catch(function(a){n.release(f);throw a;})]})})};b.prototype.fromData=function(a,
c){a=this.makeUid(a);var b=this._textureRequests.get(a);b||(b={referenceCount:0,texture:c(),textureAsync:null,abortController:null},this.addToStage(b.texture),this._textureRequests.set(a,b));b.referenceCount++;return{uid:a,texture:b.texture}};b.prototype.release=function(a){var c=this;if(this._textureRequests){var b=this._textureRequests.get(a);b?(1>b.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),b.referenceCount--,1>b.referenceCount&&this._schedule(function(){return c.releaseNow(a)})):
console.warn("TextureCollection: texture doesn't exist: '"+a+"'")}};Object.defineProperty(b.prototype,"test",{get:function(){return{textureRequests:this._textureRequests}},enumerable:!0,configurable:!0});b.prototype.releaseNow=function(a){if(this._textureRequests){var c=this._textureRequests.get(a);!c||0<c.referenceCount||(this.releaseTextureRequest(c),this._textureRequests.delete(a))}};b.prototype.releaseTextureRequest=function(a){a.texture?this.removeFromStage(a.texture):a.abortController&&(a.abortController.abort(),
a.abortController=null)};b.prototype.createTexture=function(b,c,e){f.isSVG(b)&&(e||0===c.width&&0===c.height)&&(b=c.width?c.height/c.width:1,e=e||64,1<b?(c.width=Math.round(e/b),c.height=e):(c.width=e,c.height=Math.round(e*b)));e=a.__assign(a.__assign({},this._textureOptions),{width:c.width,height:c.height,powerOfTwoResizeMode:2});return new g(c,"symbol",e)};b.prototype.addToStage=function(a){this._stage.add(4,a)};b.prototype.removeFromStage=function(a){this._stage.remove(4,a.id)};b.prototype.makeUid=
function(a,c){return null!=c?a+"."+c+"px":a};return b}();b.TextureCollection=n;b.default=n})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Handles ../../../../core/SetUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../PropertiesPool ../geometryUtils/ray ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./disposeMembers ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/intersectorUtils ../../../support/Scheduler".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y){Object.defineProperty(b,"__esModule",{value:!0});n=function(c){function b(a){a=c.call(this,a)||this;a.handles=new h;a.surfaceAltitudeAtCenter=0;a.surfaceAltitudeAtCenterDirty=!0;a.surfaceAltitudeAtCenterWithContent=0;a.surfaceAltitudeAtCenterWithContentDirty=!0;a.propertiesPool=new d.PropertiesPool({renderPointOfView:A},a);a.renderPointOfView=l.vec3f64.create();return a}a.__extends(b,c);b.prototype.initialize=function(){var c=this,b=this.view,d=
b.state,f=b.basemapTerrain,g=b.renderCoordsHelper,b=b.map;this.surfaceIntersector=new w.Intersector(d.mode);this.surfaceIntersector.options.backfacesTerrain=d.isGlobal?!1:!0;this.surfaceIntersector.options.invisibleTerrain=!1;this.contentIntersector=new w.Intersector(d.mode);this.contentIntersectorOptions={exclude:e.SetFromValues([q.TERRAIN_ID])};var h=function(){return c.estimateSurfaceAltitudeAtCenter()},l={state:d,scheduler:this.view.resourceController.scheduler,surface:f,renderCoordsHelper:g};
this._set("centerOnSurfaceInfrequent",new p.default(a.__assign(a.__assign({},l),{task:y.Task.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:h})));this._set("centerOnSurfaceFrequent",new p.default(a.__assign(a.__assign({},l),{task:y.Task.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:h})));this._set("centerOnContent",new p.default(a.__assign(a.__assign({},l),{task:y.Task.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:function(){return c.estimateSurfaceAltitudeAtCenterWithContent()}})));
this._set("cameraOnSurface",new k.default(a.__assign(a.__assign({},l),{task:y.Task.POINT_OF_INTEREST_INFREQUENT,map:b})));this._set("surfaceGeometryUpdates",new z.default(a.__assign(a.__assign({},l),{centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})));this._set("contentGeometryUpdates",new r.default({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:g}));this._set("surfaceOrigin",new v.default({view:this.view}));this._set("focus",new u.default({state:d,
surface:f,renderCoordsHelper:g,centerOnSurface:this.centerOnSurfaceFrequent}));this.handles.add([d.watch("camera",function(a){return c.cameraChanged(a)},!0),f.watch("extent",function(){return c.updateCenterPointsOfInterest()}),this.surfaceGeometryUpdates.events.on("request-update",function(){return c.updateCenterPointsOfInterest()}),this.contentGeometryUpdates.events.on("request-update",function(){return c.updateCenterOnContent()})]);this.cameraChanged(this.view.state.camera);this.centerOnContent.update();
this.centerOnSurfaceFrequent.update();this.centerOnSurfaceInfrequent.update();this.cameraOnSurface.update()};b.prototype.destroy=function(){t.default(this,"handles","centerOnSurfaceInfrequent","centerOnSurfaceFrequent","cameraOnSurface","centerOnContent","surfaceOrigin","focus","propertiesPool")};Object.defineProperty(b.prototype,"updating",{get:function(){return!!(this.surfaceGeometryUpdates&&this.surfaceGeometryUpdates.updating||this.centerOnContent&&this.centerOnContent.updating||this.centerOnSurfaceInfrequent&&
this.centerOnSurfaceInfrequent.updating||this.centerOnSurfaceFrequent&&this.centerOnSurfaceFrequent.updating||this.cameraOnSurface&&this.cameraOnSurface.updating||this.focus&&this.focus.updating)},enumerable:!0,configurable:!0});b.prototype.estimateSurfaceAltitudeAtCenterWithContent=function(){if(!this.surfaceAltitudeAtCenterWithContentDirty)return this.surfaceAltitudeAtCenterWithContent;this.surfaceAltitudeAtCenterWithContentDirty=!1;var a=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,
C);this.view.sceneIntersectionHelper.intersectRay(a,this.contentIntersector,B,this.contentIntersectorOptions)?this.surfaceAltitudeAtCenterWithContent=this.view.renderCoordsHelper.getAltitude(B):this.surfaceAltitudeAtCenterWithContent=this.estimateSurfaceAltitudeAtCenter(a);return this.surfaceAltitudeAtCenterWithContent};b.prototype.estimateSurfaceAltitudeAtCenter=function(a){if(!this.view.basemapTerrain)return 0;if(!this.surfaceAltitudeAtCenterDirty)return this.surfaceAltitudeAtCenter;this.surfaceAltitudeAtCenterDirty=
!1;var c=this.view.state.camera;a||(a=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(c,C));var b=a.origin,d=g.vec3.add(B,a.origin,a.direction);this.surfaceIntersector.resetWithRay(a);this.surfaceIntersector.intersect(null,null,c);this.view.basemapTerrain.intersect(this.surfaceIntersector,null,b,d);this.surfaceIntersector.results.min.getIntersectionPoint(B)&&(this.surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(B));return this.surfaceAltitudeAtCenter};b.prototype.cameraChanged=
function(a){this.updateCenterPointsOfInterest();a=a.eye;g.vec3.exactEquals(this.renderPointOfView,a)||this._set("renderPointOfView",g.vec3.copy(this.propertiesPool.get("renderPointOfView"),a))};b.prototype.updateCenterPointsOfInterest=function(){this.surfaceAltitudeAtCenterWithContentDirty=this.surfaceAltitudeAtCenterDirty=!0;this.centerOnSurfaceFrequent.updateRenderLocation();this.centerOnSurfaceInfrequent.updateRenderLocation();this.cameraOnSurface.updateRenderLocation();this.focus.updateRenderLocation();
this.centerOnContent.updateRenderLocation()};b.prototype.updateCenterOnContent=function(){this.surfaceAltitudeAtCenterWithContentDirty=!0;this.centerOnContent.updateRenderLocation()};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{update:function(){a.surfaceGeometryUpdates.update();a.centerOnSurfaceFrequent.update();a.centerOnSurfaceInfrequent.update()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}},enumerable:!0,configurable:!0});a.__decorate([f.property({readOnly:!0})],
b.prototype,"centerOnContent",void 0);a.__decorate([f.property({readOnly:!0})],b.prototype,"centerOnSurfaceFrequent",void 0);a.__decorate([f.property({readOnly:!0})],b.prototype,"centerOnSurfaceInfrequent",void 0);a.__decorate([f.property({readOnly:!0})],b.prototype,"cameraOnSurface",void 0);a.__decorate([f.property({readOnly:!0})],b.prototype,"focus",void 0);a.__decorate([f.property({readOnly:!0})],b.prototype,"renderPointOfView",void 0);a.__decorate([f.property({readOnly:!0})],b.prototype,"surfaceOrigin",
void 0);a.__decorate([f.property({readOnly:!0})],b.prototype,"contentGeometryUpdates",void 0);a.__decorate([f.property({readOnly:!0})],b.prototype,"surfaceGeometryUpdates",void 0);a.__decorate([f.property({constructOnly:!0})],b.prototype,"view",void 0);a.__decorate([f.property({readOnly:!0,dependsOn:"surfaceGeometryUpdates.updating centerOnContent.updating centerOnSurfaceInfrequent.updating centerOnSurfaceFrequent.updating cameraOnSurface.updating focus.updating".split(" ")})],b.prototype,"updating",
null);return b=a.__decorate([f.subclass("esri.views.3d.support.PointsOfInterest")],b)}(m);b.PointsOfInterest=n;var A=Array,B=l.vec3f64.create(),C=c.create();b.default=n})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("require exports tslib ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../PropertiesPool ./PointOfInterest".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c){Object.defineProperty(b,"__esModule",{value:!0});var k=Array;n=function(c){function b(a){a=c.call(this,a)||this;a._dirty=!1;a._propertiesPool=new d.default({location:l,renderLocation:k},a);a._estimatedSurfaceAltitude=0;a._pendingElevationQueryController=null;a.renderLocation=g.vec3f64.create();return a}a.__extends(b,c);b.prototype.initialize=function(){var a=this;this.handles.add(this.scheduler.registerTask(this.task,function(){return a._measureSurfaceAltitude()},function(){return a._needsUpdate()}));
this._measureSurfaceAltitude();if(this.map){var c=function(){return a._setDirty()};this.handles.add([h.on(this.map,"ground.layers","change",c,c,c)])}};b.prototype.destroy=function(){this._cancelPendingRequest();this._propertiesPool.destroy();this._propertiesPool=null};Object.defineProperty(b.prototype,"location",{get:function(){var a=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"updating",{get:function(){return this._dirty||null!=this._pendingElevationQueryController},enumerable:!0,configurable:!0});b.prototype.updateRenderLocation=function(){this._setDirty();this._updateRenderLocation()};b.prototype.update=function(){this._measureSurfaceAltitude();this._updateRenderLocation()};b.prototype._setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};b.prototype._needsUpdate=function(){return!this._pendingElevationQueryController&&
this._dirty};b.prototype._cancelPendingRequest=function(){var a=this._pendingElevationQueryController;a&&(this._pendingElevationQueryController=null,a.abort(),this.notifyChange("updating"))};b.prototype._measureSurfaceAltitude=function(){var a=this;this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(this.map&&this.map.ground){this.renderCoordsHelper.fromRenderCoords(this.state.camera.eye,r,this.state.spatialReference);var c=m.createAbortController();this.map.ground.queryElevation(r,
{signal:c.signal}).then(function(c){return a._updateSurfaceAltitude(c.geometry.z)}).catch(function(c){m.isAbortError(c)||a._updateSurfaceAltitude(0)}).catch(function(){}).then(function(){a._pendingElevationQueryController===c&&(a._pendingElevationQueryController=null,a.notifyChange("updating"));c=null});this._pendingElevationQueryController=c}else this._updateSurfaceAltitude(0)};b.prototype._updateSurfaceAltitude=function(a){this._estimatedSurfaceAltitude!==a&&(this._estimatedSurfaceAltitude=a,this._updateRenderLocation())};
b.prototype._updateRenderLocation=function(){f.vec3.copy(p,this.state.camera.eye);this.renderCoordsHelper.setAltitude(this._estimatedSurfaceAltitude,p);f.vec3.exactEquals(this._get("renderLocation"),p)||this._set("renderLocation",f.vec3.copy(this._propertiesPool.get("renderLocation"),p))};a.__decorate([e.property({constructOnly:!0})],b.prototype,"scheduler",void 0);a.__decorate([e.property({constructOnly:!0})],b.prototype,"task",void 0);a.__decorate([e.property({readOnly:!0,dependsOn:["renderLocation"]})],
b.prototype,"location",null);a.__decorate([e.property({constructOnly:!0})],b.prototype,"map",void 0);a.__decorate([e.property({readOnly:!0})],b.prototype,"renderLocation",void 0);a.__decorate([e.property({readOnly:!0})],b.prototype,"updating",null);return b=a.__decorate([e.subclass("esri.views.3d.support.CameraOnSurface")],b)}(c.PointOfInterest);b.CameraOnSurface=n;var p=g.vec3f64.create(),r=new l;b.default=n})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ./disposeMembers".split(" "),
function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function g(a){a=b.call(this,a)||this;a.handles=new h;return a}a.__extends(g,b);g.prototype.destroy=function(){f.default(this,"handles")};a.__decorate([e.property({constructOnly:!0})],g.prototype,"renderCoordsHelper",void 0);a.__decorate([e.property({constructOnly:!0})],g.prototype,"surface",void 0);a.__decorate([e.property({constructOnly:!0})],g.prototype,"state",void 0);return g=a.__decorate([e.subclass("esri.views.3d.support.PointOfInterest")],
g)}(m);b.PointOfInterest=n;b.default=n})},"esri/views/3d/support/pointsOfInterest/disposeMembers":function(){define(["require","exports","../../../../core/Accessor"],function(n,b,a){function m(b){for(var e=[],f=1;f<arguments.length;f++)e[f-1]=arguments[f];if(b instanceof a&&b.destroyed)try{throw Error("instance is already destroyed");}catch(d){console.warn(d.stack)}else for(f=0;f<e.length;f++){var g=e[f];if(!(g in b))throw Error("Property '"+g+"' does not exist and cannot be disposed");var h=b[g];
h&&("function"===typeof h.destroy?h.destroy():"function"===typeof h.dispose?h.dispose():"function"===typeof h.remove&&h.remove());b instanceof a&&g in b.__accessor__.metadatas?b._set(g,null):b[g]=null}}Object.defineProperty(b,"__esModule",{value:!0});b.disposeMembers=m;b.default=m})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("require exports tslib ../../../../core/mathUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../debugFlags ../earthUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k){Object.defineProperty(b,"__esModule",{value:!0});var p=Array;n=function(b){function k(a){a=b.call(this,a)||this;a.propertiesPool=new c.default({location:g,renderLocation:p},a);a.currentSurfaceAltitude=0;a.latestSurfaceAltitude=0;a.distance=0;a.renderLocation=f.vec3f64.create();a.updating=!1;return a}a.__extends(k,b);k.prototype.initialize=function(){var a=this;this._frameWorker=this.scheduler.registerTask(this.task,function(){return a._measureSurfaceAltitude()},function(){return a.updating});
this._measureSurfaceAltitude()};k.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this.propertiesPool.destroy();this.propertiesPool=null};Object.defineProperty(k.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});k.prototype.updateRenderLocation=function(){this._set("updating",!0);this._updateRenderLocation()};
k.prototype.update=function(){this._measureSurfaceAltitude();this._updateRenderLocation()};Object.defineProperty(k.prototype,"estimatedSurfaceAltitude",{get:function(){return this.latestSurfaceAltitude},enumerable:!0,configurable:!0});k.prototype._measureSurfaceAltitude=function(){this.latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this._updateRenderLocation();this._set("updating",!1)};k.prototype._updateRenderLocation=function(){var a=t,c=this.calculateSurfaceIntersection(this.currentSurfaceAltitude,
a),b=this.currentSurfaceAltitude!==this.latestSurfaceAltitude;!c&&b&&(c=this.calculateSurfaceIntersection(this.latestSurfaceAltitude,a))&&(this.currentSurfaceAltitude=this.latestSurfaceAltitude);b=u;c&&this.latestSurfaceAltitudeChangesDistanceSignificantly(a,b)&&(e.vec3.copy(a,b),this.currentSurfaceAltitude=this.latestSurfaceAltitude);c?(c=e.vec3.distance(this.state.camera.eye,a),c!==this._get("distance")&&this._set("distance",c)):(c=this.state.camera,e.vec3.scale(a,c.viewForward,this._get("distance")),
e.vec3.add(a,a,c.eye));e.vec3.exactEquals(this._get("renderLocation"),a)||this._set("renderLocation",e.vec3.copy(this.propertiesPool.get("renderLocation"),a))};k.prototype.calculateSurfaceIntersection=function(a,c){var b=this.state.camera;if(!this.renderCoordsHelper.intersectManifold(b.ray,a,c))return!1;if(this.state.isGlobal){a=d.earthRadius+a;var f=e.vec3.squaredLength(b.eye),g=f<a*a,k=e.vec3.distance(b.eye,c);g&&k>d.earthRadius/4&&(e.vec3.scale(c,b.viewForward,a-Math.sqrt(f)),e.vec3.add(c,c,b.eye))}else if(b=
this.surface.ready&&this.surface.extent)c[0]=m.clamp(c[0],b[0],b[2]),c[1]=m.clamp(c[1],b[1],b[3]);return!0};k.prototype.latestSurfaceAltitudeChangesDistanceSignificantly=function(a,c){if(this.latestSurfaceAltitude===this.currentSurfaceAltitude||null==a)return!1;if(this.calculateSurfaceIntersection(this.latestSurfaceAltitude,c)){var b=this.state.camera.eye;a=e.vec3.distance(b,a);c=e.vec3.distance(b,c);if(l.TESTS_DISABLE_UPDATE_THRESHOLDS||Math.abs(c-a)/a>r)return!0}return!1};a.__decorate([h.property({constructOnly:!0})],
k.prototype,"scheduler",void 0);a.__decorate([h.property({constructOnly:!0})],k.prototype,"task",void 0);a.__decorate([h.property({readOnly:!0})],k.prototype,"distance",void 0);a.__decorate([h.property({constructOnly:!0})],k.prototype,"estimateSurfaceAltitudeAtCenter",void 0);a.__decorate([h.property({readOnly:!0,dependsOn:["renderLocation"]})],k.prototype,"location",null);a.__decorate([h.property({readOnly:!0})],k.prototype,"renderLocation",void 0);a.__decorate([h.property({readOnly:!0})],k.prototype,
"updating",void 0);return k=a.__decorate([h.subclass("esri.views.3d.support.CenterOnSurface")],k)}(k.PointOfInterest);b.CenterOnSurface=n;var r=.05,t=f.vec3f64.create(),u=f.vec3f64.create();b.default=n})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["require","exports","../../../../core/Evented","../../../../core/Handles"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){var e=this;this.handles=new m;this.events=new a;
this.contentLayerViews=b.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",function(a){return e.layerViewsChanged(a)}));this.layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}b.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};b.prototype.layerViewsChanged=function(a){var b=this;a.added.forEach(function(a){"esri.views.3d.layers.SceneLayerView3D"===a.declaredClass&&b.handles.add(a.on("visible-geometry-changed",
function(){return b.contentChanged()}),a.uid)});a.removed.forEach(function(a){return b.handles.remove(a.uid)})};b.prototype.contentChanged=function(){this.events.emit("request-update",h)};return b}();b.ContentGeometryUpdates=n;var h={};b.default=n})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("require exports tslib ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../geometryUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k){Object.defineProperty(b,"__esModule",{value:!0});var p=Array;n=function(b){function g(a){a=b.call(this,a)||this;a.propertiesPool=new c.default({locationOnSurface:l,renderLocationOnSurface:p},a);a.centerOnSurface=null;return a}a.__extends(g,b);g.prototype.destroy=function(){this.propertiesPool.destroy();this.propertiesPool=null};Object.defineProperty(g.prototype,"locationOnSurface",{get:function(){var a=this.propertiesPool.get("locationOnSurface");this.renderCoordsHelper.fromRenderCoords(this.renderLocationOnSurface,
a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"renderLocationOnSurface",{get:function(){var a=this.centerOnSurface.renderLocation,c=this.renderCoordsHelper,b=this.calculateScreenHorizontalEdgeOnSurface(v);f.vec3.subtract(r,a,this.state.camera.eye);f.vec3.normalize(r,r);c.worldUpAtPosition(a,t);var d=Math.abs(Math.acos(f.vec3.dot(t,r))-.5*Math.PI),c=this.propertiesPool.get("renderLocationOnSurface"),d=1-m.clamp(d/(.5*Math.PI),0,1);f.vec3.lerp(c,
a,b,d*d*d);return c},enumerable:!0,configurable:!0});g.prototype.calculateScreenHorizontalEdgeOnSurface=function(a){var c=this.state.camera,b=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation),e=this.renderCoordsHelper.getAltitude(c.eye)>=b,g=c.getRenderCenter(h.createRenderScreenPointArray3());g[1]=e?c.padding[2]:c.fullHeight-c.padding[0];c.unprojectPoint(g,u);f.vec3.subtract(u,u,c.eye);e=f.vec3.normalize(u,u);if(this.renderCoordsHelper.intersectManifold(d.ray.wrap(c.eye,e),
b,a))return a;f.vec3.copy(a,c.eye);this.renderCoordsHelper.setAltitude(b,a);return a};g.prototype.updateRenderLocation=function(){};a.__decorate([e.property({constructOnly:!0})],g.prototype,"centerOnSurface",void 0);a.__decorate([e.property({readOnly:!0,dependsOn:["renderLocationOnSurface"]})],g.prototype,"locationOnSurface",null);a.__decorate([e.property({readOnly:!0,dependsOn:["centerOnSurface.renderLocation"]})],g.prototype,"renderLocationOnSurface",null);a.__decorate([e.property({readOnly:!0,
aliasOf:"centerOnSurface.updating"})],g.prototype,"updating",void 0);return g=a.__decorate([e.subclass("esri.views.3d.support.CenterOnSurface")],g)}(k.PointOfInterest);b.Focus=n;var r=g.vec3f64.create(),t=g.vec3f64.create(),u=g.vec3f64.create(),v=g.vec3f64.create();b.default=n})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function k(a){a=b.call(this,a)||this;a.location=null;a._updateController=null;a._handles=new h;return a}a.__extends(k,b);Object.defineProperty(k.prototype,"renderLocation",{get:function(){if(!this.location)return null;var a=l.vec3f64.create();this.view.renderCoordsHelper.toRenderCoords(this.location,a);return a},enumerable:!0,configurable:!0});k.prototype.initialize=function(){var a=this;this.view.state.isLocal&&
(this._handles.add([this.watch(["surfaceView.spatialReference","surfaceView.extent"],function(){return a._update()}),f.on(this,"surface.layers","change",function(){return a._update()})]),this._update())};k.prototype.destroy=function(){this._handles.destroy()};k.prototype._update=function(){var a=this;this._updateController&&(this._updateController.abort(),this._updateController=null);if(this.surfaceView&&this.surfaceView.extent&&this.surfaceView.spatialReference){var b=c.center(this.surfaceView.extent),
b=new d({x:b[0],y:b[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=e.createAbortController(),this.surface.queryElevation(b,{noDataValue:0,signal:this._updateController.signal}).then(function(c){a._updateController=null;a._set("location",c.geometry)}).catch(function(a){e.isAbortError(a)||a&&"elevation-query:invalid-layer"===a.name||console.error("StableSurfaceCenter failed to update: ",a)})):
this._set("location",b)}else this._set("location",null)};a.__decorate([g.property({constructOnly:!0})],k.prototype,"view",void 0);a.__decorate([g.property({readOnly:!0,aliasOf:"view.map.ground"})],k.prototype,"surface",void 0);a.__decorate([g.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],k.prototype,"surfaceView",void 0);a.__decorate([g.property({readOnly:!0})],k.prototype,"location",void 0);a.__decorate([g.property({readOnly:!0,dependsOn:["location"]})],k.prototype,"renderLocation",null);
return k=a.__decorate([g.subclass("esri.views.3d.terrain.StableSurfaceCenter")],k)}(m);b.StableSurfaceCenter=n;b.default=n})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler".split(" "),function(n,b,a,m,h,e,f,g,
l,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function g(){var a=null!==b&&b.apply(this,arguments)||this;a.handles=new e;a._tileGeometryUpdateExtent=l.empty();a._tileGeometryUpdateSpatialReference=null;a.events=new h;a.updating=!1;return a}a.__extends(g,b);g.prototype.initialize=function(){var a=this;this.handles.add([this.surface.on("elevation-change",function(c){return a._tileGeometryChanged(c)}),this.scheduler.registerTask(d.Task.SURFACE_GEOMETRY_UPDATES,function(){return a.update()},
function(){return a.updating})])};g.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};g.prototype.update=function(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",c),l.empty(this._tileGeometryUpdateExtent),this._set("updating",!1))};g.prototype._tileGeometryChanged=function(a){this._tileGeometryUpdateSpatialReference=a.spatialReference;l.expand(this._tileGeometryUpdateExtent,
a.tile.extent);this._set("updating",!0)};g.prototype._furthestCenterOnSurface=function(){for(var a=this.centerOnSurfaces[0],c=1;c<this.centerOnSurfaces.length;c++){var b=this.centerOnSurfaces[c];b.distance>a.distance&&(a=b)}return a};g.prototype._centerIntersectsExtent=function(a,c){var b=this.state.camera.eye,d=r,e=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(b,k,c);this.renderCoordsHelper.fromRenderCoords(e.renderLocation,p,c);k[0]<p[0]?(d[0]=k[0],d[2]=p[0]):(d[0]=p[0],
d[2]=k[0]);k[1]<p[1]?(d[1]=k[1],d[3]=p[1]):(d[1]=p[1],d[3]=k[1]);return l.intersects(d,a)};a.__decorate([f.property({constructOnly:!0})],g.prototype,"state",void 0);a.__decorate([f.property({constructOnly:!0})],g.prototype,"centerOnSurfaces",void 0);a.__decorate([f.property({constructOnly:!0})],g.prototype,"renderCoordsHelper",void 0);a.__decorate([f.property({constructOnly:!0})],g.prototype,"scheduler",void 0);a.__decorate([f.property({constructOnly:!0})],g.prototype,"surface",void 0);a.__decorate([f.property({readOnly:!0})],
g.prototype,"updating",void 0);return g=a.__decorate([f.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],g)}(m);b.SurfaceGeometryUpdates=n;var c={},k=g.vec3f64.create(),p=g.vec3f64.create(),r=l.empty();b.default=n})},"esri/views/3d/terrain/TerrainSurface":function(){define("require exports tslib ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/asyncUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/mathUtils ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ../../../layers/support/LercDecoder ../layers/ElevationLayerView3D ../support/debugFlags ../support/geometryUtils ../support/projectionUtils ./ElevationBounds ./ElevationData ./ElevationTileAgent ./MapTileAgent ./OverlayManager ./PlanarPatch ./SphericalPatch ./SurfaceExtentHelper ./SurfaceTilingSchemeLogic ./TerrainConst ./TerrainRenderer ./terrainUtils ./Tile ./tileUtils ./UpsampleInfo ../../support/Scheduler @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L,M,N,Q,R,W,O,U,P,ba,V,T,X,Y,da){function fa(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]}function ga(a){return a.isLeaf?!1:a.children[0].shouldRender||a.children[1].shouldRender||a.children[2].shouldRender||a.children[3].shouldRender||ga(a.children[0])||ga(a.children[1])||ga(a.children[2])||ga(a.children[3])}var ka=c.getLogger("esri.views.3d.terrain.TerrainSurface");b=function(c){function b(a){a=c.call(this,a)||this;a._clippingExtent=
null;a._dataExtent=null;a._elevationBounds=new E.ElevationBounds;a._rootExtent=B.create();a._iteratorPool=new p(X.IteratorPreorder);a._postorderIterator=new X.IteratorPostorder;a._visible=!1;a._pendingUpdates=!1;a._asyncWorkItems=0;a._usedMemory=la;a._isFrameProcessing=!1;a._viewChangeUpdateDirty=!1;a._overlayOpacity=1;a._eyePosRenderSR=y.vec3f64.create();a._eyePosSurfaceSR=y.vec3f64.create();a._splitLimits=new T.SplitLimits;a._snapLevel=Infinity;a._frustum=G.frustum.create();a._viewProjectionMatrix=
w.mat4f64.create();a._layerViews=[[],[]];a._layerIndexByLayerViewId=[new Map,new Map];a._basemapLayerViewHandles=new Map;a._handles=new d;a._allTiles=new r;a._upsampleInfoPool=new p(Y.UpsampleInfo);a._visibleLevels=new r({deallocator:null});a._getElevationData={spatialReference:null,rootTiles:null};a.maxTextureScale=1.2;a.rootTiles=null;a.backgroundImage=P.DEFAULT_TILE_BACKGROUND;a.backgroundColor=null;a._layerViewsDirty=!1;return a}a.__extends(b,c);b.prototype.initialize=function(){var a=this;this._stage=
this.view._stage;this._lercDecoder=F.acquireInstance(this.view.resourceController.scheduler);this._tilePool="planar"===this.manifold?new p(R.PlanarPatch):new p(W.SphericalPatch);this._upsampleMapCache=this.view.resourceController.memoryController.getMemCache("esri.views.3d.terrain.upsample",function(a){return a.unloadMapData()});this._set("overlayManager",new Q.OverlayManager({terrainSurface:this,view:this.view}));this._handles.add([this.watch("overlayManager.hasHighlights",function(b){return a._renderer.setNeedsHighlight(b)}),
this.watch("overlayManager.rendersOccluded",function(b){return a._renderer.setRenderOccludedOverlay(b)})],"overlayManager");this._renderer=new ba({manifold:this.manifold,overlayRenderer:this.overlayManager.renderer});this._renderer.install(this.view._stage);this._handles.add([u.init(this,"baseOpacity",function(b){a._handleLayerViewChanges();a._updateBaseOpacity(b)},!0),u.init(this,"_background",function(){a._handleLayerViewChanges();a._renderer.setTileBackground(a._background)},!0),this.view.watch("pointsOfInterest",
function(b){return a._renderer.pointsOfInterest=b}),u.whenTrue(I,"TERRAIN_DEBUG_POPUP",function(){(new Promise(function(a,b){n(["./support/TerrainDebugPopupOpener"],a,b)})).then(function(b){var c=new b.TerrainDebugPopupOpener({surface:a});u.whenFalseOnce(I,"TERRAIN_DEBUG_POPUP",function(){return c.destroy()})})})]);var b={layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,spatialReference:this.view.spatialReference};this.extentHelper="spherical"===this.manifold?new O.SurfaceExtentHelperGlobal(b):
new O.SurfaceExtentHelperLocal(b);this._handles.add(u.init(this.extentHelper,"stencilEnabledExtents",function(b){return a._renderer.setStencilEnabledLayerExtents(b)}),"extentHelper");b=this.view.defaultsFromMap?new g({root:this.view.map,rootCollectionNames:this.view.defaultsFromMap.mapCollectionPaths,getChildrenFunction:function(a){return a.layers}}):this.view.map.allLayers;b=new U({layers:b,extentHelper:this.extentHelper,manifold:this.manifold,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",
b);this._handles.add([this.tilingSchemeLogic.watch("tilingScheme",function(){return a._updateTilingSchemeAndExtent()},!0),this.tilingSchemeLogic.watch("extent",function(){return a._updateTilingSchemeAndExtent()},!0)],"tilingSchemeLogic");this._updateTilingSchemeAndExtent();this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(0);this._mapDataRequester=this.view.resourceController.createStreamDataRequester(1);this._handles.add(this.view.resourceController.scheduler.registerTask(da.Task.TERRAIN_SURFACE,
function(b){return a._frame(b)},function(){return a.updating}));this.view.resourceController.memoryController.events.on("quality-changed",function(){return a._viewChangeUpdate()});this._handles.add([this.view.on("resize",function(){return a._viewChangeUpdate()}),this.view.watch("state.camera",function(){return a._viewChangeUpdate()},!0),this.view.watch("qualitySettings.tiledSurface.lodBias",function(){return a._viewChangeUpdate()}),u.init(this.view,"qualitySettings.tiledSurface.textureFadeDuration",
function(b){return a._renderer.textureFadingEnabled=0<b}),this.view.watch("lodSnapping",function(){return a._viewChangeUpdate()}),this.view.watch("clippingArea",function(){return a._clippingChanged()})]);this._handles.add(this.view.allLayerViews.on("after-changes",function(){return a._setLayerViewsDirty()}));this._layerViewsDirty=!0;this._handleLayerViewChanges();this._updateClippingExtent();this.notifyChange("extent")};b.prototype.destroy=function(){var a=this;this._handles.destroy();F.releaseInstance(this._lercDecoder);
this._lercDecoder=null;this._removeAllTiles();this._upsampleMapCache.destroy();this._upsampleMapCache=null;this.tilingSchemeLogic.destroy();this._set("tilingSchemeLogic",null);this.extentHelper.destroy();this.extentHelper=null;this._basemapLayerViewHandles.forEach(function(b,c){return a._unregisterTiledLayerView(c)});this._mapDataRequester=this._elevationDataRequester=null;this.overlayManager&&(this.overlayManager.destroy(),this._set("overlayManager",null));this._tilePool.destroy();this._tilePool=
null;M.Pool.prune(0);N.Pool.prune(0);this._renderer.uninstall(this._stage);this._renderer.destroy();this._renderer=null;this._iteratorPool.destroy();this._iteratorPool=null;this._set("view",null);this._stage=null;this._upsampleInfoPool.destroy();this._upsampleInfoPool=null};Object.defineProperty(b.prototype,"renderer",{get:function(){return this._renderer},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"frustum",{get:function(){return this._frustum},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"snapLevel",{get:function(){return Math.round(this._snapLevel)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"upsampleInfoPool",{get:function(){return this._upsampleInfoPool},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"upsampleMapCache",{get:function(){return this._upsampleMapCache},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"extent",{get:function(){return this._clippingExtent||this._rootExtent},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"updating",{get:function(){return!(!(this._pendingUpdates||this._renderer.updating||this.overlayManager.updating||this._layerViewsDirty)||!this.ready||this.suspended)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"ready",{get:function(){return!!this.rootTiles},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderOrder",{set:function(a){this._renderer.renderOrder=a;this._set("renderOrder",a)},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"skirtScale",{get:function(){return this._renderer.skirtScale},set:function(a){this._renderer.skirtScale=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"spatialReference",{get:function(){var a=this.tilingScheme&&this.tilingScheme.spatialReference||null;return this._getElevationData.spatialReference=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"_background",{get:function(){return null!=this.backgroundColor?
this.backgroundColor:this.backgroundImage},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"slicePlaneEnabled",{set:function(a){this._renderer.slicePlane=a;this._set("slicePlaneEnabled",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"velvetOverground",{set:function(a){a!==this.velvetOverground&&(this._renderer.velvetOverground=a);this._set("velvetOverground",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"visible",{set:function(a){a!==
this._visible&&(this._visible=a,this._renderer.setVisibility(a),this.suspended=!a)},enumerable:!0,configurable:!0});b.prototype.isOpaque=function(){return this._renderer.opaque};Object.defineProperty(b.prototype,"suspended",{set:function(a){this._set("suspended",a);this._viewChangeUpdate()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"lodSnapping",{get:function(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?0:1},enumerable:!0,configurable:!0});b.prototype.intersect=
function(a,b,c,d){this._renderer.intersect(a,b,c,d)};b.prototype.getElevation=function(a,b,c,d){var e=this._getElevationData.rootTiles;if(!e||!e.length||0===e[0].layerInfo[0].length)return null;var f=ia;f[0]=a;f[1]=b;f[2]=c;if(!J.vectorToVector(f,d,f,this._getElevationData.spatialReference))return ka.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(b=0;b<e.length;b++)if(a=e[b],a.containsPoint(f)){for(;a&&!a.rendered&&!a.isLeaf;)e=0,
f[0]>.5*(a.extent[0]+a.extent[2])&&(e+=1),f[1]<.5*(a.extent[1]+a.extent[3])&&(e+=2),a=a.children[e];if(e=(e=a.renderData)&&e.geometryState?e.geometryState.samplerData:null)return L.ElevationData.sample(f[0],f[1],e);break}return null};Object.defineProperty(b.prototype,"elevationBounds",{get:function(){return this._elevationBounds},enumerable:!0,configurable:!0});b.prototype.getScale=function(a){if(this.tilingScheme){if(!J.pointToVector(a,ia,this.spatialReference))return ka.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),
null;var b=this.rootTiles;if(b)for(var c=0;c<b.length;c++)if(a=b[c],a.containsPoint(ia)){for(;null!=a.children[0];)b=0,ia[0]>a.children[0].extent[2]&&(b+=1),ia[1]<a.children[0].extent[1]&&(b+=2),a=a.children[b];return this._getLodBiasCorrectedScale(a.level)}}return 1E100};b.prototype.queryVisibleScaleRange=function(a,b,c,d){b=b?this.tilingScheme.levelAtScale(b):0;c=c?this.tilingScheme.levelAtScale(c):Infinity;var e=this.lodBias;this._renderer.queryVisibleLevelRange(a,b+e,c+e,d)};b.prototype._updateBaseOpacity=
function(a){var b=this._renderer.opaque;this._renderer.opaque=1<=a;this._renderer.isTransparent=this.allTransparentSurfaceLayers();this._updateTileTextures(b!==this._renderer.opaque)};b.prototype._updateTilingSchemeAndExtent=function(){var a=this.tilingSchemeLogic.extent,b=a&&!B.equals(a,this._dataExtent);b&&(this._dataExtent?B.set(this._dataExtent,a):this._dataExtent=B.create(a));var a=this.tilingSchemeLogic.tilingScheme,c=a!==this.tilingScheme;c&&(V.weakAssert(!!a,"tiling scheme cannot be reset to undefined"),
this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",a),this._updateClippingExtent(),a&&(this._updateTiledLayers(),this._renderer.setTileSize(a.pixelSize),this.overlayManager.setSpatialReference(a.spatialReference,"spherical"===this.manifold)));(b||c)&&this._updateRootTiles()};b.prototype._acquireTile=function(a,b,c,d){var e=this._tilePool.acquire();oa[0]=a;oa[1]=b;oa[2]=c;e.init(oa,d,this);return e};b.prototype._updateRootTiles=function(){var a=this,b=this._clippingExtent||this._dataExtent,
c=this.tilingScheme;if(b&&c){var d=Z,f=c.rootTilesInExtent(b,d,5*P.MAX_ROOT_TILES),g=function(b){b=a._acquireTile(0,b[1],b[2],null);2===b.shouldSplit(a._splitLimits,a._eyePosRenderSR,a.lodSnapping)&&b.setPendingUpdate(2);a._loadTile(b);return b};if(this.rootTiles){if(f.length>P.MAX_ROOT_TILES){ka.warn(P.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}var b=this.rootTiles.map(function(a){return a.lij}),k=e.difference(b,f,fa);if(0<k.removed.length||0<k.added.length){var h=this.rootTiles.filter(function(b){return-1<
e.findIndex(k.removed,fa.bind(null,b.lij))?(a._purgeTile(b),!1):!0});k.added.forEach(function(a){return h.push(g(a))});this._setRootTiles(h)}}else f.length>P.MAX_ROOT_TILES&&(ka.warn(P.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),f=c.rootTilesInExtent(b,d,P.MAX_ROOT_TILES)),this._setRootTiles(f.map(function(a){return g(a)}));B.equals(d,this._rootExtent)||(this._rootExtent=B.create(d),this._hasFixedExtent()||this.notifyChange("extent"));this.visible=!0;this._viewChangeUpdate();this.overlayManager.setOverlayPlacementDirty();
this.notifyChange("ready")}};b.prototype._setRootTiles=function(a){this._set("rootTiles",a);this._allTiles.clear();if(a){var b=this._iteratorPool.acquire();for(b.reset(a);!b.done;)this._allTiles.push(b.next());this._iteratorPool.release(b)}this._getElevationData.rootTiles=a;this._renderer.setRootTiles(this.rootTiles);this._updateTiles(a)};b.prototype._runViewChangeUpdateIfDirty=function(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())};b.prototype._viewChangeUpdate=
function(){this._stage&&!this.suspended&&this.tilingScheme&&this._visible&&(this._isFrameProcessing?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateSkirts(),this.updateOverlayOpacity(),this._updateTiles(this.rootTiles)))};b.prototype._updateClippingStatus=function(a){a.updateClippingStatus(this._clippingExtent)&&a.resetPendingUpdate(32)&&this._updateTileGeometry(a)};b.prototype._updateTiles=function(a){if(a){var b=this._iteratorPool.acquire();
b.reset(a);var c;X.hasVisibleSiblings(a)?(a=this._elevationBounds.min,c=this._elevationBounds.max):(a=Infinity,c=-Infinity);for(;!b.done;){var d=b.next();this._updateClippingStatus(d);d.updateVisibility();d.setPendingUpdate(16);if(d.visible){d.updateScreenDepth(this._viewProjectionMatrix);d.renderData&&(a=Math.min(d.elevationBounds[0],a),c=Math.max(d.elevationBounds[1],c));var e=d.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(2===e){d.resetPendingUpdate(8);d.isLeaf&&(d.setPendingUpdate(2),
b.skipSubtree());continue}d.resetPendingUpdate(2)&&d.updateAgentSuspension();4===e&&d.updateAgents(0)}b.skipSubtree();if(!d.isLeaf){d.setPendingUpdate(8);d.resetPendingUpdate(2);e=this._iteratorPool.acquire();e.resetOne(d);for(d=e.next();!e.done;d=e.next())this._updateClippingStatus(d),d.updateVisibility(),d.visible&&d.updateScreenDepth(this._viewProjectionMatrix);this._iteratorPool.release(e)}}this._iteratorPool.release(b);this.setPendingUpdates();isFinite(a)&&isFinite(c)&&(this._elevationBounds.min!==
a||this._elevationBounds.max!==c)&&(this._elevationBounds.min=a,this._elevationBounds.max=c,this.emit("elevation-bounds-change",null))}};b.prototype._updateViewDependentParameters=function(){var a=this.view.state.camera,b=Math.tan(.5*a.fovX),c=Math.tan(.5*a.fovY),d=this.tilingScheme.pixelSize,e=Math.pow(2,-this.lodBias)*a.pixelRatio;this._splitLimits.aboveGround=a.aboveGround;this._splitLimits.fovX=b;this._splitLimits.fovY=c;this._splitLimits.relativeWidthLimit=d/a.width*this.maxTextureScale*e;this._splitLimits.relativeHeightLimit=
d/a.height*this.maxTextureScale*e;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias;G.frustum.copy(a.frustum,this._frustum);z.mat4.multiply(this._viewProjectionMatrix,a.projectionMatrix,a.viewMatrix);q.vec3.copy(this._eyePosRenderSR,a.eye);J.vectorToVector(this._eyePosRenderSR,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};b.prototype._updateSnapLevel=function(){if(1!==this.lodSnapping){var a=
this._findSnapLevel();if(!(.1>Math.abs(this._snapLevel-a))){var b=this.snapLevel;this._snapLevel=a;b!==this.snapLevel&&this._updateTiles(this.rootTiles)}}};b.prototype._findSnapLevel=function(){if(0>=this._visibleLevels.length)return this._snapLevel;var a=this._visibleLevels,b=Math.round(a.length*(Math.abs(this.view.camera.tilt-90)/90*.4+.3));if(b>=a.length)return this._snapLevel;a.sort(function(a,b){return a-b});for(var c=0,d=b;d<a.length;++d)c+=a.getItemAt(d);d=a.getItemAt(Math.round(.95*a.length)-
1);return k.clamp(c/(a.length-b),d-1,this._splitLimits.maxLod)};b.prototype._updateSkirts=function(){var a=this.view.state.camera;V.autoUpdateSkirtsVisibility(this,this._eyePosSurfaceSR,this.spatialReference,this.view.state.constraints.collision.enabled?0:1.11*a.near)};b.prototype._updateRenderData=function(a){a.rendered&&!a.shouldRender&&(ga(a)?this._loadChildren(a):a.isLeaf&&a.parent&&a.parent.shouldRender&&this._loadParent(a))};b.prototype._updateTileGeometry=function(a){a.updateVisibility();this._renderer.updateTileGeometry(a);
this._elevationUpdate(a);this._usedMemory=la};b.prototype._elevationUpdate=function(a){na.spatialReference=this.spatialReference;na.tile=a;na.extent=a.extent;this.emit("elevation-change",na);B.containsPoint(a.extent,this._eyePosSurfaceSR)&&this._updateSkirts()};b.prototype._frame=function(a){var b=this;this._handleLayerViewChanges();this._isFrameProcessing=!0;this._frameTraversal(a);a.run(function(){return b._processElevation(a)});a.run(function(){return b._processTextures(a)});0!==this._asyncWorkItems&&
this.setPendingUpdates();this._isFrameProcessing=!1;this._runViewChangeUpdateIfDirty()};b.prototype._frameTraversal=function(a){var b=this;if(!this.suspended&&this._pendingUpdates){this._resetPendingUpdates();for(var c=this._eyePosRenderSR,d=0,e=!1,f=!1,g=0===this.lodSnapping?function(a){var d=a.shouldSplit(b._splitLimits,c,1);a.visible&&2!==d&&a.parent&&2===a.parent.shouldSplit(b._splitLimits,c,1)&&(1===d?b._visibleLevels.fill(a.level+1,4):b._visibleLevels.push(a.level))}:function(){};!a.done;){this._visibleLevels.clear();
var k=!this._allTiles.some(function(c){d+=c.usedMemory;g(c);c.resetPendingUpdate(8)?(b._mergeTile(c),e=!0,a.madeProgress()):c.resetPendingUpdate(2)&&(b._splitTile(c),e=!0,a.madeProgress());c.resetPendingUpdate(16)&&(b._updateRenderData(c),a.madeProgress());f=f||c.updating;return a.done});k?this._updateSnapLevel():f=!0;if(e)f=!0,e=!1,X.sortTiles(this._renderer.renderOrder,this._allTiles);else if(k){this._usedMemory=d;break}}f&&this.setPendingUpdates();this._visibleLevels.clear()}};b.prototype._processElevation=
function(a){var b=this;this._allTiles.some(function(c){c.resetPendingUpdate(32)&&(b._updateTileGeometry(c),a.madeProgress());return a.done});return a.hasProgressed};b.prototype._processTextures=function(a){var b=this;this._allTiles.some(function(c){c.resetPendingUpdate(64)&&(b._renderer.updateTileTexture(c),b._usedMemory=la,a.madeProgress());return a.done});return a.hasProgressed};b.prototype._updateClippingExtent=function(){if(!this.spatialReference)return!1;var a=B.create(),b=null;J.extentToBoundingRect(this.view.clippingArea,
a,this.spatialReference)&&(b=a);if(B.equals(b,this._clippingExtent))return!1;this._clippingExtent=b;this._renderer.clippingExtent=b;this.notifyChange("extent");this.updateTileOverlayParams();this.overlayManager.setOverlayPlacementDirty();return!0};b.prototype._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()};Object.defineProperty(b.prototype,"lodBias",{get:function(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.resourceController.memoryController.memoryFactor)*
P.MAX_MEMORY_LOD_BIAS},enumerable:!0,configurable:!0});b.prototype._getLodBiasCorrectedScale=function(a){var b=this.tilingScheme.levels;a=k.clamp(a-this.lodBias,0,b.length-1);var c=a-Math.floor(a);return b[Math.floor(a)].scale*(1-c)+b[Math.ceil(a)].scale*c};b.prototype._removeAllTiles=function(){var a=this;this.rootTiles&&(this.rootTiles.forEach(function(b){return a._purgeTile(b)}),this._setRootTiles(null),this.notifyChange("ready"));this._allTiles.clear();this.visible=!1};b.prototype._purgeChildTiles=
function(a){if(a.isLeaf)return!1;var b=this._purgeTile(a.children[0]),b=this._purgeTile(a.children[1])||b,b=this._purgeTile(a.children[2])||b,b=this._purgeTile(a.children[3])||b;a.unsetChildren();return b};b.prototype._purgeTile=function(a){var b=this._purgeChildTiles(a)||a.rendered;this._allTiles.removeUnordered(a);a.unload(this._renderer);this._tilePool.release(a);return b};b.prototype._splitTile=function(a){V.weakAssert(a.isLeaf,"tile that is already split should not be split again!");var b=a.level+
1,c=2*a.lij[1],d=2*a.lij[2];a.setChildren(this._createTile(b,c,d,a),this._createTile(b,c,d+1,a),this._createTile(b,c+1,d,a),this._createTile(b,c+1,d+1,a));a.setPendingUpdate(16);a.updateAgentSuspension();this._allTiles.pushArray(a.children);this.setPendingUpdates();this._emitTileScaleChange(a,b);return a.children[0].hasPendingUpdate(2)||a.children[1].hasPendingUpdate(2)||a.children[2].hasPendingUpdate(2)||a.children[3].hasPendingUpdate(2)};b.prototype._emitTileScaleChange=function(a,b){void 0===b&&
(b=a.level);ja.spatialReference=this.spatialReference;ja.extent=a.extent;ja.scale=this._getLodBiasCorrectedScale(b);this.emit("scale-change",ja)};b.prototype._createTile=function(a,b,c,d){V.weakAssert(!!d,"_createTile sanity check");a=this._acquireTile(a,b,c,d);a.updateClippingStatus(this._clippingExtent);a.visible&&(a.updateScreenDepth(this._viewProjectionMatrix),2===a.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)&&a.setPendingUpdate(2));return a};b.prototype._mergeTile=function(a){V.weakAssert(!a.hasPendingUpdate(2),
"_mergeTile sanity check");this._purgeChildTiles(a)&&(V.weakAssert(!a.renderData,"_mergeTile sanity check"),this._loadTile(a));this.setPendingUpdates();this._emitTileScaleChange(a)};b.prototype._loadChildren=function(a){V.weakAssert(a.rendered,"parent should be rendered");a.unload(this._renderer);this._loadTile(a.children[0]);this._loadTile(a.children[1]);this._loadTile(a.children[2]);this._loadTile(a.children[3])};b.prototype._loadParent=function(a){a=a.parent;this._unloadChildren(a);this._loadTile(a)};
b.prototype._unloadChildren=function(a){a.isLeaf||(this._unloadChildren(a.children[0]),a.children[0].unload(this._renderer),this._unloadChildren(a.children[1]),a.children[1].unload(this._renderer),this._unloadChildren(a.children[2]),a.children[2].unload(this._renderer),this._unloadChildren(a.children[3]),a.children[3].unload(this._renderer))};b.prototype._loadTile=function(a){a.load(this._renderer);a.setPendingUpdate(16);this.overlayManager&&this.overlayManager.hasOverlays()&&this.overlayManager.setTileParameters(a,
a.renderData,this._overlayOpacity);this._elevationUpdate(a)};b.prototype._elevationDataArrived=function(a,b,c){c=new L.ElevationData(a.lij,a.extent,c);a.dataArrived(b,0,c);c=[a];a=a.level;var d=this._iteratorPool.acquire();for(d.reset(c);!d.done;){var e=d.next();e.findElevationBoundsForLayer(b,a);e.computeElevationBounds()}this._iteratorPool.release(d);this._updateTiles(c)};b.prototype._setLayerViewsDirty=function(){this._layerViewsDirty=!0};b.prototype._handleLayerViewChanges=function(){var a=this;
if(this._layerViewsDirty){for(var b=this._layerViewsDirty=!1,c=new Set,d=-1,e=0,f=this.view.allLayerViews.items;e<f.length;e++){var g=f[e];c.add(g.uid);if(V.isSurfaceLayerView(g))if(this._basemapLayerViewHandles.has(g.uid)){var k=this.layerClassFromLayerView(g),g=this._layerIndexByLayerViewId[k].get(g.uid);g<d&&(b=!0);d=g}else this._registerTiledLayerView(g),g.layer.loaded&&(b=!0)}this._basemapLayerViewHandles.forEach(function(d,e){c.has(e)||(a._unregisterTiledLayerView(e),b=!0)});this.overlayManager&&
this.overlayManager.updateLayerViews(c);b&&this._updateTiledLayers();this._renderer.isTransparent=this.allTransparentSurfaceLayers()}};b.prototype.allTransparentSurfaceLayers=function(){for(var a=0===this.view.map.ground.opacity,b=0,c=this.view.allLayerViews.items;b<c.length;b++){var d=c[b];if(V.isSurfaceLayerView(d)&&!V.isElevationLayerView(d)&&!C.isBaseLayer(d.layer)&&0!==d.fullOpacity){a=!1;break}}return a};b.prototype.layerClassFromLayerView=function(a){return V.isElevationLayerView(a)?0:1};b.prototype._registerTiledLayerView=
function(a){var b=this,c=[],d=this.layerClassFromLayerView(a);c.push(a.watch("suspended",function(){return b._updateTiledLayers()}));c.push(a.watch("fullOpacity",function(){return b._updateTileTextures(!1)}));c.push(a.layer.watch("scaleRangeId",function(){return b._restartAllAgents(d)}));a.on("data-changed",function(){var c=b._layerIndexByLayerViewId[d].get(a.uid);null!=c&&b._invalidateLayerData(c,d)});this._basemapLayerViewHandles.set(a.uid,c)};b.prototype._unregisterTiledLayerView=function(a){var b=
this._basemapLayerViewHandles.get(a);if(b){for(var c=0;c<b.length;c++)b[c].remove();this._basemapLayerViewHandles.delete(a)}};b.prototype._updateTiledLayers=function(){var a=this;if(this.tilingScheme&&!this.view.suspended){var b=this.view.allLayerViews,c=[[],[]],d=null,e=B.empty();b.forEach(function(b){var f=b.layer;if(f&&!b.suspended&&V.isSurfaceLayerView(b)){var g=b.fullExtent;g?a.tilingScheme.compatibleWith(b.tileInfo)?(B.expand(e,g),f=a.layerClassFromLayerView(b),1===f&&(g=b.displayLevelRange,
Infinity!==g.maxLevel&&(null===d||g.maxLevel>d)&&(d=g.maxLevel)),c[f].push(b)):ka.warn("Terrain: tiling scheme of layer "+f.id+" is incompatible with other tiled layers, will not be drawn"):ka.warn("Terrain: Map or elevation layer does not have fullExtent: "+f.id)}});for(b=0;2>b;b++){var f=this._layerViews[b],g=c[b];g.reverse();var k=g.length,h=f.length!==k,l=Array(k),m=Array(f.length);this._layerIndexByLayerViewId[b].clear();for(var p=0;p<k;p++){this._layerIndexByLayerViewId[b].set(g[p].uid,p);var q=
f.indexOf(g[p]);l[p]=q;p!==q&&(h=!0);-1<q&&(m[q]=p)}if(h){f=this._postorderIterator;for(f.reset(this.rootTiles);!f.done;)f.next().modifyLayers(m,l,b);this._layerViews[b]=g;this._restartAllAgents(b);this._updateTiles(this.rootTiles)}}this.tilingScheme.ensureMaxLod(d)&&this._viewChangeUpdate()}};b.prototype._restartAllAgents=function(a){var b=this._postorderIterator;for(b.reset(this.rootTiles);!b.done;){var c=b.next();c.restartAgents(a);0===a&&c.computeElevationBounds()}};b.prototype._hasFixedExtent=
function(){return!!this._clippingExtent};b.prototype.layerViewByIndex=function(a,b){return this._layerViews[b][a]};b.prototype.numLayers=function(a){return this._layerViews[a].length};b.prototype._updateTileTextures=function(a){var b=this;this._allTiles.forEach(function(c){c.updateAgents(1);a?b.renderer.updateTileTexture(c):c.updateRenderData(1)});this._renderer.isTransparent=this.allTransparentSurfaceLayers()};b.prototype._invalidateLayerData=function(a,b){this._allTiles.forEach(function(c){return c.removeLayerAgent(a,
b)});this._allTiles.forEach(function(c){return c.invalidateLayerData(a,b)})};b.prototype.requestRender=function(a){void 0===a&&(a=1);this.renderer.setNeedsRender(a)};b.prototype.setPendingUpdates=function(){this._pendingUpdates||(this._pendingUpdates=!0,this.notifyChange("updating"))};b.prototype._resetPendingUpdates=function(){this._pendingUpdates&&(this._pendingUpdates=!1,this.notifyChange("updating"))};b.prototype.requestTileData=function(b,c,d,e){return a.__awaiter(this,void 0,void 0,function(){var g,
k,h;return a.__generator(this,function(l){switch(l.label){case 0:g=this.layerViewByIndex(c,d);k=g.layer;if(!k.tilemapCache||V.isVectorTileLayerView(g))return[3,2];++this._asyncWorkItems;return[4,f.result(k.tilemapCache.fetchAvailability(b.lij[0],b.lij[1],b.lij[2],a.__assign(a.__assign({},e),{timeout:6E3})))];case 1:h=l.sent();--this._asyncWorkItems;if(!1===h.ok)throw t.isAbortError(h.error)||this._dataMissing(b,d,g,{notInTilemap:!0}),h.error;l.label=2;case 2:return[2,this._requestTileData(b,d,g,e)]}})})};
b.prototype._requestTileData=function(a,b,c,d){return 0===b?this._requestElevationTileData(a,c,d):this._requestMapTileData(a,c,d)};b.prototype._requestElevationTileData=function(a,b,c){var d=this;if(V.isElevationLayerView(b)){var e=function(e){--d._asyncWorkItems;if(!t.isAborted(c)){var f=d._layerIndexByLayerViewId[0].get(b.uid);null==f?ka.warn("TerrainSurface: received data from unknown layer %d %s",0,a.lij.toString()):(d._usedMemory=la,d.setPendingUpdates(),d._elevationDataArrived(a,f,e))}},f=function(c){--d._asyncWorkItems;
t.isAbortError(c)||d._dataMissing(a,0,b,c)};++this._asyncWorkItems;if(V.useFetchTileForLayer(b.layer))return b.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2],{noDataValue:P.ELEVATION_NODATA_VALUE,signal:c.signal}).then(function(a){t.isAborted(c)?(ka.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),f(t.createAbortError())):e(a)},f);var g=b.getTileUrl(a.lij[0],a.lij[1],a.lij[2]);return this._elevationDataRequester.request(g,
"binary",c).then(function(a){return d._lercDecoder.decode(a,{noDataValue:P.ELEVATION_NODATA_VALUE},c.signal)}).then(function(a){e({values:a.pixelData,width:a.width,height:a.height,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue})},f)}V.weakAssert(!1,"_requestElevationTileData can only be called for elevation layer views")};b.prototype._requestMapTileData=function(a,b,c){var d=this;if(b instanceof H)return t.reject();++this._asyncWorkItems;var e=function(e){--d._asyncWorkItems;t.isAborted(c)||
d._dataArrived(a,1,b,e)},f=function(e){--d._asyncWorkItems;t.isAborted(c)||d._dataMissing(a,1,b,e)};if(V.isVectorTileLayerView(b)){var g=b.schemaHelper.getLevelRowColumn(a.lij);return b.tileHandler.getVectorTile(g[0],g[1],g[2],c).then(e,f)}if(V.isImageryTileLayerView(b))return b.fetchTile(a.lij[0],a.lij[1],a.lij[2],c).then(e,f);if(V.useFetchTileForLayer(b.layer)&&V.isTileLayerView(b))return b.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2],c).then(function(a){t.isAborted(c)?(ka.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),
f(t.createAbortError())):e(a)},f);g=b.getTileUrl(a.lij[0],a.lij[1],a.lij[2]);null!=b.refreshInterval&&b.refreshTimestamp&&(g+=(-1<g.indexOf("?")?"\x26":"?")+"_ts\x3d"+b.refreshTimestamp);return this._mapDataRequester.request(g,b.hasMixedImageFormats?"image+type":"image",c).then(e,f)};b.prototype._dataArrived=function(a,b,c,d){c=this._layerIndexByLayerViewId[b].get(c.uid);null!=c?a.dataArrived(c,b,d):ka.warn("TerrainSurface: received data from unknown layer")};b.prototype._dataMissing=function(a,b,
c,d){c=this._layerIndexByLayerViewId[b].get(c.uid);null!=c?a.dataMissing(c,b,d):ka.warn("TerrainSurface: received data from unknown layer")};b.prototype.updateTileOverlayParams=function(){var a=this;this.rootTiles&&(this._allTiles.forEach(function(b){b.renderData&&a.overlayManager&&a.overlayManager.setTileParameters(b,b.renderData,a._overlayOpacity)}),this._renderer.setNeedsRender())};b.prototype.updateOverlayOpacity=function(){if(this.overlayManager){var a=this.overlayManager.updateOpacity(this._eyePosSurfaceSR[2]);
isNaN(a)||a===this._overlayOpacity||(this._allTiles.forEach(function(b){return b.renderData&&(b.renderData.overlayOpacity=a)}),this._overlayOpacity=a,this._renderer.setNeedsRender())}};b.prototype.getStats=function(){var a={numNodes:this._allTiles.length,numLeaves:0,numVisible:0,numRendered:0,numRenderedPerLevel:[],numLoadedPerLevel:[]};this._allTiles.forEach(function(b){b.isLeaf&&a.numLeaves++;var c=b.level;b.renderData&&(a.numLoadedPerLevel[c]=(a.numLoadedPerLevel[c]||0)+1);b.visible&&(a.numVisible++,
b.rendered&&(a.numRenderedPerLevel[c]=(a.numRenderedPerLevel[c]||0)+1,a.numRendered++))});return a};b.prototype.getUsedMemory=function(){var a=this;if(!this.tilingScheme)return 0;this._usedMemory===la&&(this._usedMemory=0,this._allTiles.forEach(function(b){return a._usedMemory+=b.usedMemory}));return this._usedMemory};b.prototype.getUsedMemoryForLayerView=function(a){var b=0,c=this.layerClassFromLayerView(a),d=this._layerIndexByLayerViewId[c].get(a.uid);this._allTiles.forEach(function(a){return b+=
a.getUsedMemoryForLayer(c,d)});return b};b.prototype.getTile=function(a){var b=a.split("/").map(function(a){return+a});if(0===b[0])return e.find(this.rootTiles,function(a){return a.lij[1]===b[1]&&a.lij[2]===b[2]});a=Math.pow(2,b[0]);var c=Math.floor(b[1]/a),d=Math.floor(b[2]/a),f;this.rootTiles.some(function(a){return a.lij[1]===c&&a.lij[2]===d?(f=a,!0):!1});if(f){for(a=1<<b[0]-1;f.lij[0]<b[0];){var g=b[1]&a?2:0;0<(b[2]&a)&&g++;if(!f.children[g])return null;f=f.children[g];a>>=1}V.weakAssert(f.lij[0]===
b[0]&&f.lij[1]===b[1]&&f.lij[2]===b[2],"not the right tile?");return f}return null};b.prototype.getRenderedTiles=function(){aa.clear();this._allTiles.forEach(function(a){a.visible&&a.rendered&&aa.push(a)});X.sortTiles(this.renderOrder,aa);return aa.toArray()};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{renderer:this._renderer,lercDecoder:this._lercDecoder,mergeTile:function(b){return a._mergeTile(b)},updateTiles:function(b){return a._updateTiles(b)},getTiles:function(){return a._allTiles.toArray()}}},
enumerable:!0,configurable:!0});a.__decorate([v.property()],b.prototype,"_renderer",void 0);a.__decorate([v.property({constructOnly:!0})],b.prototype,"view",void 0);a.__decorate([v.aliasOf("_renderer.cullBackFaces")],b.prototype,"cullBackFaces",void 0);a.__decorate([v.property({readOnly:!0})],b.prototype,"extent",null);a.__decorate([v.property({readOnly:!0,dependsOn:["ready","_renderer.updating","_layerViewsDirty","overlayManager.updating"]})],b.prototype,"updating",null);a.__decorate([v.property({aliasOf:"view.map.ground.opacity"})],
b.prototype,"baseOpacity",void 0);a.__decorate([v.property({readOnly:!0})],b.prototype,"overlayManager",void 0);a.__decorate([v.property({constructOnly:!0})],b.prototype,"manifold",void 0);a.__decorate([v.property()],b.prototype,"maxTextureScale",void 0);a.__decorate([v.property({readOnly:!0})],b.prototype,"ready",null);a.__decorate([v.property({value:1})],b.prototype,"renderOrder",null);a.__decorate([v.property({readOnly:!0})],b.prototype,"rootTiles",void 0);a.__decorate([v.property({readOnly:!0,
dependsOn:["tilingScheme.spatialReference"]})],b.prototype,"spatialReference",null);a.__decorate([v.property()],b.prototype,"backgroundImage",void 0);a.__decorate([v.property({type:m,aliasOf:"view.map.ground.surfaceColor"})],b.prototype,"backgroundColor",void 0);a.__decorate([v.property({dependsOn:["backgroundColor","backgroundImage"]})],b.prototype,"_background",null);a.__decorate([v.property({value:!1})],b.prototype,"slicePlaneEnabled",null);a.__decorate([v.property({readOnly:!0})],b.prototype,
"tilingScheme",void 0);a.__decorate([v.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],b.prototype,"tilingSchemeLocked",void 0);a.__decorate([v.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],b.prototype,"tilingSchemeDone",void 0);a.__decorate([v.property({readOnly:!0})],b.prototype,"tilingSchemeLogic",void 0);a.__decorate([v.property({value:!0})],b.prototype,"velvetOverground",null);a.__decorate([v.aliasOf("_renderer.wireframe")],b.prototype,"wireframe",
void 0);a.__decorate([v.property({value:!1})],b.prototype,"suspended",null);a.__decorate([v.property({readOnly:!0,dependsOn:["view.qualitySettings.tiledSurface.reduceTileLevelDifferences"]})],b.prototype,"lodSnapping",null);a.__decorate([v.property({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],b.prototype,"textureFadeDuration",void 0);a.__decorate([v.property()],b.prototype,"_layerViewsDirty",void 0);a.__decorate([v.aliasOf("_renderer.renderPatchBorders")],b.prototype,
"renderPatchBorders",void 0);a.__decorate([v.aliasOf("_renderer.renderingDisabled")],b.prototype,"renderingDisabled",void 0);return b=a.__decorate([v.subclass("esri.views.3d.terrain.TerrainSurface")],b)}(l.EventedMixin(h));var la=-1,ia=A.vec4f64.create(),Z=B.create(),oa=[0,0,0],aa=new r,na={spatialReference:null,tile:null,extent:null,context:"ground"},ja={spatialReference:null,extent:null,scale:0};return b})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("require exports tslib ../../../core/Error ../../../core/promiseUtils ../../../core/accessorSupport/decorators ./LayerView3D ./TiledLayerView3D ./support/tiledLayerUtils ../../layers/LayerView".split(" "),
function(n,b,a,m,h,e,f,g,l,d){return function(b){function c(){return null!==b&&b.apply(this,arguments)||this}a.__extends(c,b);c.prototype.initialize=function(){var a=this.get("view.map.allLayers"),a=a&&a.includes(this.layer),b=this.get("view.map.ground.layers"),b=b&&b.includes(this.layer);a&&!b&&(a=new m("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added in the map ground"),this.addResolvingPromise(h.reject(a)));this._addTilingSchemeMatchPromise();this.addResolvingPromise(l.checkArcGISServiceVersionCompatibility(this.layer))};
a.__decorate([e.property({readOnly:!0,aliasOf:"layer.fullExtent"})],c.prototype,"fullExtent",void 0);a.__decorate([e.property()],c.prototype,"layer",void 0);a.__decorate([e.property({readOnly:!0,aliasOf:"layer.tileInfo"})],c.prototype,"tileInfo",void 0);return c=a.__decorate([e.subclass("esri.views.3d.layers.ElevationLayerView3D")],c)}(g.TiledLayerView3D(f.LayerView3D(d)))})},"esri/views/3d/layers/LayerView3D":function(){define("require exports tslib ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/heightModelInfoUtils".split(" "),
function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});b.LayerView3D=function(b){return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.slicePlaneEnabled=!1;a.supportsHeightUnitConversion=!1;return a}a.__extends(d,b);d.prototype.destroy=function(){this.view=null};d.prototype.postscript=function(a){b.prototype.postscript.call(this,a);f.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};d.prototype._validateHeightModelInfo=
function(){var a=this;return m.create(function(b,c){h.whenFalseOnce(a.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var d=f.rejectLayerError(a.layer,a.view.heightModelInfo,a.supportsHeightUnitConversion);d?c(d):b()})})};a.__decorate([e.property()],d.prototype,"view",void 0);a.__decorate([e.property()],d.prototype,"slicePlaneEnabled",void 0);return d=a.__decorate([e.subclass("esri.views.3d.layers.LayerView3D")],d)}(b)}})},"esri/views/3d/layers/TiledLayerView3D":function(){define("require exports tslib ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ./support/layerViewUpdatingProperties ../terrain/terrainUtils".split(" "),
function(n,b,a,m,h,e,f,g,l){Object.defineProperty(b,"__esModule",{value:!0});b.TiledLayerView3D=function(b){return function(b){function c(){return null!==b&&b.apply(this,arguments)||this}a.__extends(c,b);Object.defineProperty(c.prototype,"imageFormatIsOpaque",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"isOpaque",{get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"dataLevelRange",
{get:function(){var a=this.tileInfo.lods;return this.levelRangeFromScaleRange(a[0].scale,a[a.length-1].scale)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"displayLevelRange",{get:function(){var a=this.tileInfo.lods,a=this.levelRangeFromScaleRange(this.layer.minScale||a[0].scale,this.layer.maxScale||a[a.length-1].scale);this.layer.maxScale&&a.maxLevel++;return a},enumerable:!0,configurable:!0});c.prototype.getTileUrl=function(a,b,c){return this.layer.getTileUrl(a,b,c)};c.prototype._addTilingSchemeMatchPromise=
function(){var a=this,b=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent);b?this.addResolvingPromise(h.reject(b)):(b=e.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(function(){var b=a._getTileInfoCompatibilityError(a.tileInfo,a.view.basemapTerrain.tilingScheme);if(b)throw b;}),this.addResolvingPromise(b))};c.prototype._getTileInfoSupportError=function(a,b){if(a=l.checkIfTileInfoSupportedForView(a,b,this.view.spatialReference,this.view.basemapTerrain.manifold)){b=
{layer:this.layer,error:a};var c=void 0;switch(a.name){case "tilingscheme:local-gcs-not-supported":c=new m("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",b);break;case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":c=new m("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",b);break;default:c=new m("layerview:tiling-scheme-unsupported",
"The tiling scheme of this layer is not supported by SceneView",b)}return c}return null};c.prototype._getTileInfoCompatibilityError=function(a,b){return b.compatibleWith(a)?null:new m("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};c.prototype.levelRangeFromScaleRange=function(a,b){var c={minLevel:0,maxLevel:Infinity},d=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!d)return c;var e=d.levels[0],
d=function(a){a=Math.log(e.scale/a)/Math.LN2;return 1E-9>.5-Math.abs(.5-a%1)?Math.round(a):Math.ceil(a)};null!=a&&0<a&&(c.minLevel=Math.max(0,d(a)));null!=b&&0<b&&(c.maxLevel=Math.max(0,d(b)));return c};c.prototype.isUpdating=function(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)};a.__decorate([f.property({readOnly:!0})],c.prototype,"imageFormatIsOpaque",null);a.__decorate([f.property({readOnly:!0,dependsOn:["view.basemapTerrain.updating"]})],c.prototype,"updating",
void 0);a.__decorate([f.property(g.updatingProgress)],c.prototype,"updatingProgress",void 0);a.__decorate([f.property(g.updatingProgressValue)],c.prototype,"updatingProgressValue",void 0);a.__decorate([f.property({readOnly:!0})],c.prototype,"fullExtent",void 0);a.__decorate([f.property({readOnly:!0,dependsOn:["fullOpacity","imageFormatIsOpaque"]})],c.prototype,"isOpaque",null);a.__decorate([f.property({readOnly:!0,dependsOn:["tileInfo","view.basemapTerrain.tilingScheme"]})],c.prototype,"dataLevelRange",
null);a.__decorate([f.property({readOnly:!0,dependsOn:["tileInfo","view.basemapTerrain.tilingScheme","layer.minScale","layer.maxScale"]})],c.prototype,"displayLevelRange",null);a.__decorate([f.property()],c.prototype,"layer",void 0);a.__decorate([f.property({readOnly:!0})],c.prototype,"tileInfo",void 0);return c=a.__decorate([f.subclass("esri.views.3d.layers.TiledLayerView3D")],c)}(b)}})},"esri/views/3d/layers/support/layerViewUpdatingProperties":function(){define(["require","exports"],function(n,
b){Object.defineProperty(b,"__esModule",{value:!0});b.updatingProgressValue={value:.5,readOnly:!0};b.updatingProgress={dependsOn:["updating","updatingProgressValue"],readOnly:!0,value:.5,get:function(){return this.updating?this.updatingProgressValue:1}}})},"esri/views/3d/layers/support/tiledLayerUtils":function(){define("require exports ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../../../layers/support/arcgisLayerUrl".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,
"__esModule",{value:!0});var f=m.getLogger("esri.views.3d.layers.support.tiledLayerUtils");b.checkArcGISServiceVersionCompatibility=function(b){if(!e.isHostedAgolService(b.url)){if(10.22>b.version)return b=new a("layerview:service-version-too-old","Tiled Map Layers on servers prior to 10.2.2 are not supported. Detected version: "+b.version,{minVersion:10.22,detectedVersion:b.version}),h.reject(b);10.22!==b.version||e.isHostedSecuredProxyService(b.url,b.get("portalItem.id"))||f.warnOnce("ArcGIS server version 10.2.2 needs the following patch installed in order for map layers to work properly: https://support.esri.com/en/download/2146");
return h.resolve()}}})},"esri/views/3d/terrain/ElevationBounds":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.min=a;this.max=b;this.level=0;this.hasNoDataValues=!1}a.prototype.copyFrom=function(a){this.min=a.min;this.max=a.max;this.level=a.level;this.hasNoDataValues=a.hasNoDataValues};return a}();b.ElevationBounds=n})},"esri/views/3d/terrain/ElevationData":function(){define(["require",
"exports","../../../core/mathUtils","../support/mathUtils","./TerrainConst"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,e){this.samplerData=null;this.level=a[0];this.i=a[1];this.j=a[2];this.extent=b;a=e.noDataValue;for(var d=e.values,c=Infinity,f=-Infinity,g=!0,h=!1,l=0;l<d.length;l++){var m=d[l];m!==a?(c=m<c?m:c,f=m>f?m:f,g=!1):h=!0}g&&(f=c=0);this.samplerData={pixelData:e.values,width:e.width,height:e.height,noDataValue:a,safeWidth:.99999999*
(e.width-1),dx:(e.width-1)/(b[2]-b[0]),dy:(e.width-1)/(b[3]-b[1]),x0:b[0],y1:b[3]};this.bounds=[c,-3E38<f?f:0];this.hasNoDataValues=h}b.prototype.release=function(){this.bounds=this.samplerData=null};b.prototype.computeMinMaxValue=function(a,b,e,d){d.min=Infinity;d.max=-Infinity;d.hasNoDataValues=!1;a-=this.level;if(0>=a)return d;var c=Math.pow(2,a);if(Math.floor(b/c)!==this.i||Math.floor(e/c)!==this.j)return d;var f=Infinity,g=-Infinity,l=this.samplerData.width,t=this.samplerData.pixelData,u=.5*
h.ELEVATION_NODATA_VALUE;a=(l-1)/c;e=(e-this.j*c)*a;var v=(b-this.i*c)*a;if(1>a){var n=Math.floor(e),w=Math.floor(v),q=n+w*l;b=t[q];var c=t[q+1],y=t[q+l],q=t[q+l+1];if(b+c+y+q<u)return f=e-n,u=v-w,g=m.bilerp(b,c,y,q,f,u),l=m.bilerp(b,c,y,q,f+a,u),t=m.bilerp(b,c,y,q,f,u+a),a=m.bilerp(b,c,y,q,f+a,u+a),d.min=Math.min(g,l,t,a),d.max=Math.max(g,l,t,a),d;e=n;v=w;a=1}else e=Math.floor(e),v=Math.floor(v),a=Math.ceil(a);for(b=e;b<=e+a;b++)for(c=v;c<=v+a;c++)q=b+c*l,y=t[q],y<u?(f=Math.min(f,y),g=Math.max(g,
y)):d.hasNoDataValues=!0;d.min=f;d.max=g;return d};b.sample=function(b,e,l){for(var d=0;d<l.length;d++){var c=l[d];if(c){var f=c.safeWidth,g=c.width,m=c.pixelData,t=a.clamp(c.dy*(c.y1-e),0,f),c=a.clamp(c.dx*(b-c.x0),0,f),f=Math.floor(t),u=Math.floor(c),v=f*g+u,n=v+g,w=m[v],g=m[n],v=m[v+1],m=m[n+1];if(w+g+v+m<.5*h.ELEVATION_NODATA_VALUE)return t-=f,c-=u,b=w+(v-w)*c,b+(g+(m-g)*c-b)*t}}return null};return b}();b.ElevationData=n})},"esri/views/3d/terrain/ElevationTileAgent":function(){define("require exports tslib ../../../core/ObjectPool ./TerrainConst ./TileAgent".split(" "),
function(n,b,a,m,h,e){return function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a._scaleRangeEnabled=!1;return a}a.__extends(e,b);Object.defineProperty(e.prototype,"_desiredMinLevelDelta",{get:function(){return h.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-this.tile.lij[0])},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"_loadingLevelDelta",{get:function(){return 0},enumerable:!0,configurable:!0});e.Pool=new m(e);return e}(e.TileAgent)})},"esri/views/3d/terrain/TileAgent":function(){define("require exports tslib ../../../core/maybe ./TerrainConst ./terrainUtils ./tileUtils".split(" "),
function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});var g=Error("Abstract method called on TileAgent");n=function(){function a(){}Object.defineProperty(a.prototype,"updating",{get:function(){return!!this._tileRequested},enumerable:!0,configurable:!0});a.prototype.init=function(a,b,e,f){this.tile=a;this._layerIdx=b;this._layerClass=e;this._suspended=f;this._tileLayerInfo=a.getLayerInfo(b,e);this._tileRequested=null;a=this._findAncestorWithData();this._setUpsampleTile(a)};a.prototype.startLoading=
function(){return this._requestNext()};a.prototype.dispose=function(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=this.tile=null};a.prototype.setSuspension=function(a){a!==this._suspended&&((this._suspended=a)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())};a.prototype.update=function(){var a=
this._findAncestorWithData();this._setUpsampleTile(a);return this._requestNext()};a.prototype.dataArrived=function(a){this._setUpsampleTile(a);this._tileRequested=null;a===this.tile?this.tile.updateRenderData(this._layerClass):this._requestNext()};a.prototype.dataMissing=function(){this._tileRequested=null;this._tileLayerInfo.disposeData();this._requestNext()};a.prototype._agentDone=function(){this.tile.agentDone(this._layerIdx,this._layerClass);this.dispose()};a.prototype._requestNext=function(){if(this._suspended)return!0;
var a=this._findNextDownload();h.TILE_LOADING_DEBUGLOG&&console.log(f.tile2str(this.tile),"next",f.tile2str(a));if(this._tileRequested){if(a===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=null}a?a.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=a):this._agentDone();return!!this._tileRequested};a.prototype._findNextDownload=function(){for(var a=this._layerIdx,b=this._layerClass,g=this.tile.surface.layerViewByIndex(a,
b),l=e.getLayerWithExtentRange(g),r=g.dataLevelRange,g=r.minLevel,r=r.maxLevel,t=this._desiredMinLevelDelta,u=this._loadingLevelDelta+t,v=this._scaleRangeEnabled?f.fallsWithinLayer:function(){return!0},n,w=this.tile,q=0,y=this._tileLayerInfo.upsampleInfo,y=y?y.tile.level:-1,A=m.get(l,"tilemapCache");w&&v(w,l,!1)&&w.level>=g;){var B=w.level,C=w.layerInfo[b][a];if(C.data&&q>=t){B>y&&this._setUpsampleTile(w);C.dataInvalidated&&(n=w);break}if((m.isNone(A)||"unavailable"!==A.getAvailability(w.lij[0],w.lij[1],
w.lij[2]))&&B<=r&&!C.data&&!C.dataMissing){if(!n||0===B%h.LOADING_LEVEL_MODULO||this.tile.level-n.level<t)n=w;if(q>=u)break}w=w.parent;q++}n&&this.tile.level-n.level<t&&this._tileLayerInfo.upsampleInfo&&(n=null);return n};a.prototype._findAncestorWithData=function(){for(var a=this.tile.vlevel,b=this._desiredMinLevelDelta,e,f=this.tile;f;f=f.parent)if(f.hasLayerData(this._layerIdx,this._layerClass)){if(a-f.level>=b)return f;e=f}return e};a.prototype._setUpsampleTile=function(a){this._tileLayerInfo.setUpsampleInfo(this.tile,
a);this.tile.updateRenderData(this._layerClass)};Object.defineProperty(a.prototype,"test",{get:function(){var a=this;return{findNextDownload:function(){return a._findNextDownload()},tileLayerInfo:this._tileLayerInfo}},enumerable:!0,configurable:!0});return a}();b.TileAgent=n;n=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}a.__extends(d,b);Object.defineProperty(d.prototype,"_desiredMinLevelDelta",{get:function(){throw g;},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"_loadingLevelDelta",{get:function(){throw g;},enumerable:!0,configurable:!0});return d}(n);b.TILE_AGENT_DONE=new n})},"esri/views/3d/terrain/tileUtils":function(){define(["require","exports","../../../core/maybe","../../../core/PooledArray"],function(n,b,a,m){function h(a){return a?a[0]+"/"+a[1]+"/"+a[2]:"null"}function e(a,b){b(a);if(!a.isLeaf){var d=0;for(a=a.children;d<a.length;d++)e(a[d],b)}}function f(a,b,d){a=a.screenDepth;b=b.screenDepth;return a<b?-d:a>b?d:0}Object.defineProperty(b,"__esModule",
{value:!0});n=function(){function a(){this.q=new m;this._last=null}Object.defineProperty(a.prototype,"done",{get:function(){return 0===this.q.length&&(!this._last||this._last.isLeaf)},enumerable:!0,configurable:!0});a.prototype.resetOne=function(a){this.q.clear();this.q.push(a);this._last=null};a.prototype.reset=function(a){this.q.clear();a&&this.q.pushArray(a);this._last=null};a.prototype.skipSubtree=function(){this._last=null};a.prototype.next=function(){this._last&&!this._last.isLeaf&&this.q.pushArray(this._last.children);
return this._last=this.q.pop()};return a}();b.IteratorPreorder=n;n=function(){function a(){this.q=new m}Object.defineProperty(a.prototype,"done",{get:function(){return 0===this.q.length},enumerable:!0,configurable:!0});a.prototype.reset=function(a){this.q.clear();if(a)for(this.q.pushArray(a),a=0;a<this.q.length;++a){var b=this.q.data[a];b.isLeaf||this.q.pushArray(b.children)}};a.prototype.next=function(){return this.q.pop()};return a}();b.IteratorPostorder=n;b.lij2str=h;b.tile2str=function(a){return a?
h(a.lij):"null"};b.traverseTilesPreorder=function(a,b){if(Array.isArray(a))for(var d=0;d<a.length;d++)e(a[d],b);else e(a,b)};b.fallsWithinLayer=function(b,e,d){if(a.isNone(e))return!1;var c=e.fullExtent,f=b.extent;if(d){if(f[0]<c.xmin||f[1]<c.ymin||f[2]>c.xmax||f[3]>c.ymax)return!1}else if(c.xmin>f[2]||c.ymin>f[3]||c.xmax<f[0]||c.ymax<f[1])return!1;b=b.surface.tilingScheme.levels[b.lij[0]].scale;return 0<e.minScale&&b>1.00000001*e.minScale||0<e.maxScale&&b<.99999999*e.maxScale?!1:!0};b.sortTiles=
function(a,b){b.sort(function(b,c){return f(b,c,a)})};b.compareTiles=f;b.computeUpsampleInfo=function(a,b,d){for(var c=1,e=0,f=0;a!==b;)if(c*=.5,e*=.5,f*=.5,a.lij[2]&1&&(e+=.5),0===(a.lij[1]&1)&&(f+=.5),a=a.parent,null==a)throw Error("tile was not a descendant of upsampleTile");d.init(b,e,f,c)};b.hasVisibleSiblings=function(a){for(var b=0;b<a.length;b++){var d=a[b],c=d.parent;if(c)for(var e=0;4>e;e++){var f=c.children[e];if(f&&f!==d&&f.visible)return!0}}return!1};b.tilesAreRelated=function(a,b){if(!a||
!b)return!1;var d=a[0]<b[0],c=d?a:b;a=d?b:a;b=a[0]-c[0];if(0===b)return!1;b=1<<b;return Math.floor(a[1]/b)===c[1]&&Math.floor(a[2]/b)===c[2]}})},"esri/views/3d/terrain/MapTileAgent":function(){define(["require","exports","tslib","../../../core/ObjectPool","./TileAgent"],function(n,b,a,m,h){return function(b){function e(){var a=b.call(this)||this;a._scaleRangeEnabled=!0;return a}a.__extends(e,b);Object.defineProperty(e.prototype,"_desiredMinLevelDelta",{get:function(){return 0},enumerable:!0,configurable:!0});
Object.defineProperty(e.prototype,"_loadingLevelDelta",{get:function(){return 8},enumerable:!0,configurable:!0});e.Pool=new m(e);return e}(h.TileAgent)})},"esri/views/3d/terrain/OverlayManager":function(){define("require exports tslib ../../../Graphic ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/mathUtils ../../../core/mathUtils ../../../core/scheduling ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../../../layers/support/timeUtils ../../../symbols/SimpleMarkerSymbol ../state/utils/viewUtils ../support/animationUtils ../support/debugFlags ../support/earthUtils ../support/geometryUtils ../support/mathUtils ../support/projectionUtils ./OverlayRenderer ../webgl-engine/lib/Intersector ../webgl-engine/lib/localOrigin ../webgl-engine/parts/requireUtils ../../support/Scheduler".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L,M){function N(a,b){for(var c=B.TESTS_DISABLE_UPDATE_THRESHOLDS?0:1E-5*Math.max(a[2]-a[0],a[3]-a[1],b[2]-b[0],b[3]-b[1]),d=0;4>d;d++)if(Math.abs(b[d]-a[d])>c)return!0;return!1}function Q(a){a=a.renderTargets;return+a.color.valid|+a.colorWithoutRasterImage.valid<<1|+a.highlight.valid<<2|+a.water.valid<<3|+a.occluded.valid<<4}Object.defineProperty(b,"__esModule",{value:!0});var R=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,
-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]],W;n=function(b){function h(){var a=null!==b&&b.apply(this,arguments)||this;a._handles=new e;a._overlaySR=null;a._renderSR=null;a._overlaySREqualsRenderSR=!0;a._drapeSources=new Map;a._drapeTargets=new Set;a._overlays=null;a._drapeSourceTypes=[0,0];a._drapeTargetTypes=[0,0];a._renderedAltitude=0;a._placementDirty=!1;a._drawTexturesDirty=!1;a._drawTexturesAnimateDirty=!1;a._hasUnusedRenderTargets=!1;a._isSpherical=!1;a._longitudeCyclical=
null;a._latestOriginId=0;a._maxResolution=f("esri-mobile")?2048:4096;a._animationTimeLast=0;a._forceAnimation=!1;return a}a.__extends(h,b);Object.defineProperty(h.prototype,"updating",{get:function(){return this.needsUpdate()||this.renderer.updating},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"hasHighlights",{get:function(){return this.renderer.hasHighlights},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"rendersOccluded",{get:function(){return this.renderer.rendersOccluded},
enumerable:!0,configurable:!0});h.prototype.initialize=function(){var a=this;this._stage=this.view._stage;this.renderer=new G.OverlayRenderer({renderView:this._stage.renderView});this._stage.renderView.updateLogicClients.add(this.renderer);this._drapeTargetTypes[0]++;this.renderer.onHasHighlightsChanged=function(){a.setDrawTexturesDirty();a.notifyChange("hasHighlights")};this.renderer.onRendersOccludedChanged=function(){a.setDrawTexturesDirty();a.notifyChange("rendersOccluded")};this.renderer.onContentChanged=
function(){a.setDrawTexturesDirty()};this.groundIntersector=new J.Intersector(this.view.viewingMode);this.groundIntersector.options.backfacesTerrain=!0;this.groundIntersector.options.invisibleTerrain=!0;this.groundIntersector.options.hud=!1;this._handles.add([this.view.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location","pixelRatio"],function(){return a.setOverlayPlacementDirty()}),this.terrainSurface.on("elevation-change",function(){return a.setOverlayPlacementDirty()}),
this.view.on("resize",function(){return a.setOverlayPlacementDirty()}),d.addFrameTask({preRender:function(b){a.renderer.commitChanges();a.hasOverlays()&&(a._dispatchRendererUpdate(b),a._drawOverlayTextures());a._hasUnusedRenderTargets&&a._collectUnusedRenderTargetMemory()}}),this.view.resourceController.scheduler.registerTask(M.Task.OVERLAY_MANAGER,function(){return a.updateOverlays()},function(){return a.needsUpdate()}),this.view._stage.renderView.events.on("force-camera-for-screenshot",function(b){a.updateOverlays(b);
a._drawOverlayTextures()})])};h.prototype.destroy=function(){var a=this;this._drapeSources.forEach(function(b,c){return a._unregisterDrapeSource(c)});this._drapeTargets.forEach(function(b,c){return a._unregisterDrapeTarget(c)});this._drapeTargetTypes[0]--;this._disposeOverlays();this._stage.renderView.updateLogicClients.remove(this.renderer);this.renderer.dispose();this._handles&&(this._handles.destroy(),this._handles=null)};h.prototype.hasOverlays=function(){return!!this._overlays};h.prototype.setSpatialReference=
function(a,b){this._overlaySR=a;this._longitudeCyclical=null;if(a){if(this._renderSR=this.view.renderSpatialReference,this._overlaySREqualsRenderSR=this._overlaySR.equals(this._renderSR),this._isSpherical=b)this._longitudeCyclical=a.isWebMercator?new H.Cyclical(-2.0037508342787E7,2.0037508342787E7):new H.Cyclical(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical}else this._disposeOverlays();this.notifyChange("updating")};h.prototype.getGpuMemoryUsage=function(){return this.renderer.getGpuMemoryUsage()};
h.prototype.updateLayerViews=function(a){for(var b=this,c=0,d=this.view.allLayerViews.items;c<d.length;c++){var e=d[c];"drapeSourceType"in e&&!this._drapeSources.has(e)&&this._registerDrapeSource(e);"drapeTargetType"in e&&!this._drapeTargets.has(e)&&this._registerDrapeTarget(e)}this._drapeSources.forEach(function(c,d){a.has(d.uid)||b._unregisterDrapeSource(d)});this._drapeTargets.forEach(function(c){a.has(c.uid)||b._unregisterDrapeTarget(c)});this.renderer.updateLayerOrder();this.setDrawTexturesDirty()};
h.prototype._registerDrapeSource=function(a){var b=this,c=a.on("draped-data-change",function(){return b.setOverlayContentDirty()});this._drapeSourceTypes[a.drapeSourceType]++;this._drapeSources.set(a,[c]);this._overlays&&a.setDrapingExtent&&this._overlays.forEach(function(c,d){return b._updateDrapeSource(a,d,c)});this.setOverlayContentDirty()};h.prototype._updateDrapeSource=function(a,b,c){a.setDrapingExtent&&a.setDrapingExtent(b,c.extent,this._overlaySR,c.resolution,c.renderLocalOrigin,c.pixelRatio)};
h.prototype._unregisterDrapeSource=function(a){if(this._drapeSources.has(a)){var b=this._drapeSources.get(a);b&&b.forEach(function(a){return a.remove()});this._drapeSourceTypes[a.drapeSourceType]--;this._drapeSources.delete(a);this.setOverlayContentDirty()}};h.prototype._registerDrapeTarget=function(a){this._drapeTargets.add(a);this._updateDrapeTarget(a);this._drapeTargetTypes[a.drapeTargetType]++};h.prototype._updateDrapeTarget=function(a){var b=this;this._overlays&&this._overlays.forEach(function(c,
d){var e=c.renderTargets,f=b.needsColorWithoutRasterImage()?e.colorWithoutRasterImage:b.hasDrapedFeatures()?e.color:null,g=e.highlight,e=e.water;a.setDrapingTextures(d,c.extent,f&&f.valid?b.renderer.getRenderTargetTexture(f.id):null,g.valid?b.renderer.getRenderTargetTexture(g.id):null,e.valid?b.renderer.getRenderTargetTexture(e.id):null)})};h.prototype._unregisterDrapeTarget=function(a){this._drapeTargets.delete(a);this._drapeTargetTypes[a.drapeTargetType]--};h.prototype.setOverlayContentDirty=function(){this.setOverlayPlacementDirty();
this.setDrawTexturesDirty()};h.prototype.setOverlayPlacementDirty=function(){this._placementDirty=!0;this.notifyChange("updating")};h.prototype.updateOverlays=function(a){void 0===a&&(a=this.view.state.camera);if(this._overlaySR){var b;b=g.nextHighestPowerOfTwo(Math.max(a.fullWidth,a.fullHeight)+256);var c=Math.min(b,this._maxResolution);this._computeOverlayExtents(a,b,V);b=z.width(V.inner)/z.width(V.outer);this._initOverlays();a=this._updateOverlay(0,V.inner,c,1);c=this._updateOverlay(1,V.outer,
c,b);if(a||c)this.terrainSurface.updateTileOverlayParams(),this.setDrawTexturesDirty();this._placementDirty=!1;this.terrainSurface.updateOverlayOpacity();this.notifyChange("updating")}};h.prototype._updateOverlay=function(a,b,c,d){var e=this,f=this._overlays[a];if(!N(b,f.extent)&&c===f.resolution&&f.pixelRatio===d)return!1;z.set(f.extent,b);f.resolution=c;f.pixelRatio=d;b=z.center(f.extent);f.renderLocalOrigin=E.fromValues(b[0],b[1],0,"OV_"+this._latestOriginId++);this._drapeSources.forEach(function(b,
c){return e._updateDrapeSource(c,a,f)});return!0};h.prototype.needsUpdate=function(){return this._placementDirty&&(0<this._drapeSources.size||0<this.view.graphics.length||B.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._overlaySR&&!this._get("suspended")&&this.terrainSurface.ready};h.prototype.updateOpacity=function(a){return this._overlays?this._getAltitudeBasedOpacity(a,this._renderedAltitude):1};h.prototype._getAltitudeBasedOpacity=function(a,b){return 3.5*a<b?Math.sqrt(g.clamp((a-b/10)/(b/3.5-b/10),0,1)):
1};h.prototype.setTileParameters=function(a,b,c){if(this._overlays){var d=this._overlays[0],e=this._overlays[1];a=z.intersection(a.extent,a.surface.extent,T);this._rectInsideRect(a,d.extent)?(this._setTileOverlayData(a,d,b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1])):this._rectanglesOverlap(a,d.extent)?(this._setTileOverlayData(a,d,b.overlays[0]),this._setTileOverlayData(a,e,b.overlays[1])):(this._rectanglesOverlap(a,e.extent)?this._setTileOverlayData(a,e,b.overlays[0]):this._invalidateTileOverlayData(b.overlays[0]),
this._invalidateTileOverlayData(b.overlays[1]))}else this._invalidateTileOverlayData(b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1]);b.overlayOpacity=void 0!==c?c:1};h.prototype.overlayPixelSizeInMapUnits=function(a){if(!this._overlays)return 0;var b=this._overlays[0],c=this._overlays[1];a=this._pointIsInExtent(a,b.extent)?b:c;return(a.extent[2]-a.extent[0])/a.resolution};h.prototype._setTileOverlayData=function(a,b,c){var d=b.extent;c.texScale[0]=(a[2]-a[0])/(d[2]-d[0]);c.texScale[1]=
(a[3]-a[1])/(d[3]-d[1]);var e=a[0];if(this._longitudeCyclical){var e=this._longitudeCyclical.minimalMonotonic(d[0],e),f=this._longitudeCyclical.minimalMonotonic(d[0],a[2]);e>f&&(e=f-(a[2]-a[0]))}c.texOffset[0]=(e-d[0])/(d[2]-d[0]);c.texOffset[1]=(a[1]-d[1])/(d[3]-d[1]);a=b.renderTargets;c.renderTargetIds.color=a.color.valid?a.color.id:null;c.renderTargetIds.highlight=a.highlight.valid?a.highlight.id:null;c.renderTargetIds.water=a.water.valid?a.water.id:null;c.renderTargetIds.occluded=a.occluded.valid?
a.occluded.id:null};h.prototype._invalidateTileOverlayData=function(a){a.renderTargetIds.color=null;a.renderTargetIds.highlight=null;a.renderTargetIds.water=null;a.renderTargetIds.occluded=null};h.prototype._createEmptyOverlay=function(a){return{extent:z.create(),resolution:0,renderTargets:{color:{id:this.renderer.createRenderTarget("overlay"+a,!0),valid:!1,lastUsed:Infinity},colorWithoutRasterImage:{id:this.renderer.createRenderTarget("overlayWithoutRasterImage"+a,!0),valid:!1,lastUsed:Infinity},
highlight:{id:this.renderer.createRenderTarget("overlayHighlight"+a,!1),valid:!1,lastUsed:Infinity},water:{id:this.renderer.createRenderTarget("overlayWaterMask"+a,!0),valid:!1,lastUsed:Infinity},occluded:{id:this.renderer.createRenderTarget("overlayOccluded"+a,!0),valid:!1,lastUsed:Infinity}},renderLocalOrigin:E.fromValues(0,0,0,"O"),pixelRatio:1}};h.prototype._initOverlays=function(){this._overlays||(this._overlays=[this._createEmptyOverlay(0),this._createEmptyOverlay(1)])};h.prototype._disposeOverlays=
function(){var a=this;this._overlays&&(this._overlays.forEach(function(b){a.renderer.disposeRenderTarget(b.renderTargets.color.id);a.renderer.disposeRenderTarget(b.renderTargets.colorWithoutRasterImage.id);a.renderer.disposeRenderTarget(b.renderTargets.highlight.id);a.renderer.disposeRenderTarget(b.renderTargets.water.id);a.renderer.disposeRenderTarget(b.renderTargets.occluded.id)}),this._overlays=null)};h.prototype.hotReloadShaders=function(){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,
function(a){switch(a.label){case 0:return L.removeLoadedShaderModules(),[4,this.renderer.hotReloadShaders()];case 1:return a.sent(),this.updateOverlays(),this.needsUpdate(),[2]}})})};h.prototype.stopAnimationsAtTime=function(a){this.renderer.stopAnimationsAtTime(a);this._forceAnimation=!0};h.prototype._dispatchRendererUpdate=function(a){var b=w.Milliseconds(a.time-this._animationTimeLast);b<A.DESIRED_DRAPED_ANIMATION_MS&&!this._forceAnimation||(this._animationTimeLast=a.time,this.renderer.updateLogic({dt:b,
camera:this._stage.getCamera()})&&(this._drawTexturesAnimateDirty=!0))};h.prototype.setDrawTexturesDirty=function(){this._overlays?this._drawTexturesDirty=!0:this.setOverlayPlacementDirty()};h.prototype._intersectGroundFromView=function(a,b,c,d){c=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(a,Y,b,c);b=c.origin;c=p.vec3.add(ba,c.origin,c.direction);this.groundIntersector.reset(b,c);this.groundIntersector.intersect([],null,a);this.view.basemapTerrain.intersect(this.groundIntersector,
null,b,c);return this.groundIntersector.results.min.getIntersectionPoint(d)};h.prototype._findHorizonBasedPointOfInterest=function(a,b,c){var d=.5;if("global"===this.view.viewingMode){d=r.vec3f64.clone(a.eye);p.vec3.normalize(d,d);p.vec3.negate(d,d);b=p.vec3.length(b);b=Math.asin(b/p.vec3.length(a.eye));var e=Math.acos(p.vec3.dot(a.viewForward,d)),d=g.clamp((b-(e-.5*a.fovY))/a.fovY,0,1);b=g.clamp((-b-(e-.5*a.fovY))/a.fovY,0,1);d=1===d&&0===b?.5:b+.55*(d-b)}else d=u.vec4f64.fromValues(0,Math.tan(.5*
Math.PI-Math.acos(-a.viewForward[2])),1,0),d=t.vec4.transformMat4(d,d,a.projectionMatrix)[1],d=g.clamp(.5+.5*d,0,1),d=1===d||0===d?.5:0<a.eye[2]?.55*d:1-.55*(1-d);return this._intersectGroundFromView(a,.5,d,c)?!0:!1};h.prototype._computeOverlayExtents=function(a,b,c){var d=this.terrainSurface.extent,e=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,f=r.vec3f64.create();this._findHorizonBasedPointOfInterest(a,e,f)||p.vec3.copy(f,e);this._renderedAltitude=this.view.renderCoordsHelper.getAltitude(a.eye);
var g=p.vec3.distance(a.eye,f),e=y.viewAngle(this.view.renderCoordsHelper,e,a.eye),e=Math.PI/2-Math.abs(e-Math.PI/2);if(B.OVERLAY_SHOW_CENTER){var h=new q({color:[255,0,0],outline:{color:[255,255,255],width:2}}),u=new v;I.vectorToPoint(f,this._renderSR,u,this._overlaySR);h=new m({geometry:u,symbol:h});void 0!==W&&this.view.graphics.remove(W);this.view.graphics.add(h);W=h}this._overlaySREqualsRenderSR||I.vectorToVector(f,this._renderSR,f,this._overlaySR);var g=b*a.perRenderPixelRatio*g/2,w=!1,h=Infinity;
this._isSpherical&&(this._overlaySR.isWebMercator?(g/=Math.cos(I.webMercator.y2lat(f[1])),h=this.terrainSurface.extent[3]):(w=!0,g/=C.metersPerDegree,h=90),g>=h&&(g=h,f[1]=0,this._overlaySR.isWebMercator&&(f[0]=0)));u=1;w&&(u=1/Math.max(.2,Math.cos(Math.abs(l.deg2rad(f[1])))),180<g*u&&(u=180/g));var w=Math.log(2)/12,g=Math.exp(Math.round(Math.log(g)/w)*w),w=g*u,n=.5*b/(32*w);b=.5*b/(32*g);f[0]=Math.round(f[0]*n)/n;f[1]=Math.round(f[1]*b)/b;b=c.inner;b[0]=f[0]-w;b[1]=f[1]-g;b[2]=f[0]+w;b[3]=f[1]+g;
this._isSpherical&&this._shiftExtentToFitBounds(b,Infinity,h);c=c.outer;z.set(c,b);6*w>d[2]-d[0]?z.set(c,d):e<=.25*Math.PI?(c[0]-=w,c[1]-=g,c[2]+=w,c[3]+=g):(I.vectorToVector(a.eye,this._renderSR,ba,this._overlaySR),k.vec2.subtract(P,f,ba),a=-Math.atan2(P[1],P[0])+.125*Math.PI,0>a&&(a+=2*Math.PI),t.vec4.scale(P,R[Math.floor(a/(.25*Math.PI))],2*g),P[0]*=u,P[2]*=u,t.vec4.add(c,c,P));this._isSpherical&&(c[0]=this._longitudeCyclical.clamp(c[0]),c[2]=this._longitudeCyclical.clamp(c[2]),c[1]=Math.max(c[1],
-h),c[3]=Math.min(c[3],h));!this._isSpherical&&d&&(a=z.intersection(b,d,T),d=z.intersection(c,d,X),z.contains(a,d)&&(c[2]=c[0],c[3]=c[1]))};h.prototype._drawOverlayTextures=function(){var a=this;if(this._drawTexturesDirty||this._drawTexturesAnimateDirty){var b=this._drawOverlay(0),c=this._drawOverlay(1);0!==b&&0!==c||this.terrainSurface.updateTileOverlayParams();this._collectUnusedRenderTargetMemory();this._drapeTargets.forEach(function(b){return a._updateDrapeTarget(b)});this._drawTexturesDirty?
(this._drawTexturesAnimateDirty=this._drawTexturesDirty=!1,this.terrainSurface.requestRender(),this.terrainSurface.setPendingUpdates()):(this._drawTexturesAnimateDirty=!1,this.terrainSurface.requestRender(0))}};h.prototype._setupGeometryViewsCyclical=function(a,b,c){this._setupGeometryViewsDirect(a,b,c);var d=.001*this._longitudeCyclical.range;if(b[0]-d<=this._longitudeCyclical.min){var e=a.views[a.numViews++];t.vec4.set(e.viewport,0,0,c,c);z.offset(b,this._longitudeCyclical.range,0,e.extent)}b[2]+
d>=this._longitudeCyclical.max&&(e=a.views[a.numViews++],t.vec4.set(e.viewport,0,0,c,c),z.offset(b,-this._longitudeCyclical.range,0,e.extent))};h.prototype._setupGeometryViewsDirect=function(a,b,c){a.numViews=1;a=a.views[0];z.set(a.extent,b);t.vec4.set(a.viewport,0,0,c,c)};h.prototype._drawOverlay=function(a){var b=this._overlays[a],c=Q(b),d=b.extent,e=b.resolution,f=b.pixelRatio;this._longitudeCyclical?this._setupGeometryViewsCyclical(U,d,e):this._setupGeometryViewsDirect(U,d,e);U.width=e;U.height=
e;U.pixelRatio=f*this.view.state.camera.pixelRatio;U.index=a;a=this.renderer;d=b.renderTargets;d.color.valid=a.draw(d.color.id,U);d.highlight.valid=a.drawHighlights(d.highlight.id,U);d.water.valid=a.drawNormals(d.water.id,U);d.occluded.valid=a.drawOccluded(d.occluded.id,U);d.colorWithoutRasterImage.valid=this.needsColorWithoutRasterImage()&&a.drawWithoutRasterImage(d.colorWithoutRasterImage.id,U);b=Q(b);return c^b?0:1};h.prototype.needsColorWithoutRasterImage=function(){return 0<this._drapeSourceTypes[0]&&
0<this._drapeSourceTypes[1]&&0<this._drapeTargetTypes[1]};h.prototype.hasDrapedFeatures=function(){return 0<this._drapeSourceTypes[1]};h.prototype._collectUnusedRenderTargetMemory=function(){var a=performance.now();this._hasUnusedRenderTargets=!1;for(var b=0,c=this._overlays;b<c.length;b++){var d=c[b],e;for(e in d.renderTargets){var f=d.renderTargets[e];f.valid?f.lastUsedTimestamp=a:a-f.lastUsedTimestamp>O?(this.renderer.disposeRenderTargetMemory(f.id),f.lastUsedTimestamp=Infinity):Infinity>f.lastUsedTimestamp&&
(this._hasUnusedRenderTargets=!0)}}};h.prototype._rectanglesOverlap=function(a,b){return this._longitudeCyclical?(this._longitudeCyclical.contains(b[0],b[2],a[0])||this._longitudeCyclical.contains(b[0],b[2],a[2])||this._longitudeCyclical.contains(a[0],a[2],b[0]))&&!(a[1]>b[3]||a[3]<b[1]):z.intersects(a,b)};h.prototype._rectInsideRect=function(a,b){return this._longitudeCyclical?this._longitudeCyclical.contains(b[0],b[2],a[0])&&this._longitudeCyclical.contains(b[0],b[2],a[2])&&a[1]>b[1]&&a[3]<b[3]:
z.contains(b,a)};h.prototype._pointIsInExtent=function(a,b){if(this._longitudeCyclical)return this._longitudeCyclical.contains(b[0],b[2],a.x)&&a.y>=b[1]&&a.y<=b[3];var c=a.x;a=a.y;return c>b[0]&&c<b[2]&&a>b[1]&&a<b[3]};h.prototype._shiftExtentToFitBounds=function(a,b,c){var d=0,e=0;a[0]<-b?d=a[0]+b:a[2]>b&&(d=b-a[2]);a[1]<-c?e=a[1]+c:a[3]>c&&(e=c-a[3]);z.offset(a,d,e)};Object.defineProperty(h.prototype,"test",{get:function(){return{overlays:this._overlays,renderer:this.renderer}},enumerable:!0,configurable:!0});
a.__decorate([c.property()],h.prototype,"renderer",void 0);a.__decorate([c.property()],h.prototype,"view",void 0);a.__decorate([c.property()],h.prototype,"terrainSurface",void 0);a.__decorate([c.property({readOnly:!0,aliasOf:"terrainSurface.suspended"})],h.prototype,"suspended",void 0);a.__decorate([c.property({readOnly:!0,dependsOn:["terrainSurface.ready","suspended","renderer.updating"]})],h.prototype,"updating",null);a.__decorate([c.property({type:Boolean})],h.prototype,"hasHighlights",null);a.__decorate([c.property({type:Boolean})],
h.prototype,"rendersOccluded",null);return h=a.__decorate([c.subclass("esri.views.3d.terrain.OverlayManager")],h)}(h);b.OverlayManager=n;var O=1E3,U={width:0,height:0,pixelRatio:0,views:[{viewport:z.create(),extent:z.create()},{viewport:z.create(),extent:z.create()},{viewport:z.create(),extent:z.create()}],numViews:0,index:0},P=u.vec4f64.create(),ba=r.vec3f64.create(),V={inner:z.create(),outer:z.create()},T=z.create(),X=z.create(),Y=F.ray.create()})},"esri/views/3d/support/animationUtils":function(){define(["require",
"exports","../../../layers/support/timeUtils"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.DESIRED_ANIMATION_FPS=25;b.DESIRED_ANIMATION_MS=a.Milliseconds(1E3/b.DESIRED_ANIMATION_FPS);b.DESIRED_DRAPED_ANIMATION_FPS=20;b.DESIRED_DRAPED_ANIMATION_MS=a.Milliseconds(1E3/b.DESIRED_DRAPED_ANIMATION_FPS)})},"esri/views/3d/webgl-engine/parts/requireUtils":function(){define(["require","exports","../../../../core/global"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});
b.removeLoadedShaderModules=function(){var b,h=null===(b=a.require)||void 0===b?void 0:b.modules;if(h){b=0;for(var e=Object.keys(h);b<e.length;b++){var f=e[b];-1!==f.search(".glsl")&&delete h[f]}}}})},"esri/views/3d/terrain/PlanarPatch":function(){define("require exports tslib ../../../core/mathUtils ../../../geometry/support/aaBoundingBox ../support/geometryUtils ./PatchGeometryFactory ./Tile".split(" "),function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a,
e,f){var c=b.call(this,d.NumSubdivisionsAtLevel)||this;void 0!==a&&c.init(a,e,f);return c}a.__extends(d,b);d.prototype.init=function(a,d,e){b.prototype.init.call(this,a,d,e);this._edgeLen=this.extent[2]-this.extent[0];this._edgeLen2=this._edgeLen*this._edgeLen;this.centerAtSeaLevel[0]=m.lerp(this.extent[0],this.extent[2],.5);this.centerAtSeaLevel[1]=m.lerp(this.extent[1],this.extent[3],.5);this.centerAtSeaLevel[2]=0;this.updateRadiusAndCenter()};d.prototype.updateRadiusAndCenter=function(){this._updateCenter();
var a=(this.extent[2]-this.extent[0])*Math.SQRT1_2,b=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this._radius=Math.sqrt(a*a+b*b)};d.prototype._isVisible=function(){return this.intersectsClippingArea&&e.frustum.intersectsAABB(this.surface.frustum.planes,h.wrap(this.extent[0],this.extent[1],this.elevationBounds[0],this.extent[2],this.extent[3],this.elevationBounds[1]))};d.prototype.createGeometry=function(a,b){f.createPlanarGlobePatch(a,this.extent,b,this.renderData);this.setMemoryDirty()};
d.NumSubdivisionsAtLevel=[2,2,2,2,2,2,2,2];return d}(g.Tile);b.PlanarPatch=n})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../geometry/support/aaBoundingBox ../support/earthUtils ../support/buffer/BufferPool ../support/buffer/InterleavedLayout ./ElevationData ./TerrainConst ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t){function u(a,b,c,d){var e=0<(c&2),f=b+(d?1024:0)+(e?2048:0),g=A.get(f);if(!g){var g=b-1,k=b-1,h=b*b,l=2*g+2*k,m=g*k*6,p=6*l,q=6*(2*g+k-1);d&&(m*=2,p*=2,q*=2);for(var l=65536<h+l?new Uint32Array(m+p):new Uint16Array(m+p),r=0,t=0,u=m,v,n,z,y,B=0,C=0;C<=k;C++){e&&(B=0===C?q:C===k?-q:0);for(var u=u+B,E=0;E<=g;E++)z=w(E,C,g,k),-1<z&&(y=0===C&&E!==g?1:E===g&&C!==k?g+1:C===k&&0!==E?-1:0===E&&0!==C?-(g+1):0,0!==y&&(v=r,n=h+z,z=h+(0===E&&1===C?0:z+1),y=r+y,d?(l[u+0]=
v,l[u+1]=n,l[u+2]=n,l[u+3]=z,l[u+4]=z,l[u+5]=v,l[u+6]=z,l[u+7]=y,l[u+8]=y,l[u+9]=v,l[u+10]=v,l[u+11]=z,u+=12):(l[u+0]=v,l[u+1]=n,l[u+2]=z,l[u+3]=z,l[u+4]=y,l[u+5]=v,u+=6))),++r,E<g&&C<k&&(v=C*(g+1)+E,n=v+1,z=n+(g+1),y=z-1,d?(l[t+0]=v,l[t+1]=n,l[t+2]=n,l[t+3]=z,l[t+4]=z,l[t+5]=v,l[t+6]=z,l[t+7]=y,l[t+8]=y,l[t+9]=v,l[t+10]=v,l[t+11]=z,t+=12):(l[t+0]=v,l[t+1]=n,l[t+2]=z,l[t+3]=z,l[t+4]=y,l[t+5]=v,t+=6));u-=B}g={values:l,numSurfaceIndices:m,numSkirtIndices:p};A.set(f,g)}a.indices=g.values;a.numSurfaceIndices=
g.numSurfaceIndices;a.numSkirtIndices=g.numSkirtIndices;a.numWithoutSkirtIndices=a.numSurfaceIndices+(c?6*(b-1)*(d?2:1):0)}function v(a,b,c,d){a<d[0]&&(d[0]=a);a>d[3]&&(d[3]=a);b<d[1]&&(d[1]=b);b>d[4]&&(d[4]=b);c<d[2]&&(d[2]=c);c>d[5]&&(d[5]=c)}function z(a,b){var c=b>a?1:0;return 2+4*c+(1-2*c)*(a+b)}function w(a,b,c,d){return 0===b?a:a===c?c+b:b===d?c+d+(c-a):0===a&&0<b?2*c+d+(d-b):-1}Object.defineProperty(b,"__esModule",{value:!0});var q=c.newLayout().vec3f(r.VertexAttrConstants.POSITION).vec2f(r.VertexAttrConstants.UV0),
y=new d.BufferPool(function(a){return q.createBuffer(a)},function(a){return a.count});b.clearCaches=function(){y.clear();A.clear()};b.releaseGeometry=function(a){y.release(a.vertexAttributes);a.vertexAttributes=null;a.indices=null};b.createSphericalGlobePatch=function(b,c,d,e,h,m,q){var r=h[0],t=h[1],n=h[2];h=h[3];var A=.1*l.earthRadius*(h-t),B=b.numVertsPerRow-1,E=b.numVertsPerRow-1,G=b.numVertsPerRow*b.numVertsPerRow,Q=y.acquire(G+(2*B+2*E)),L=Q.position.typedBuffer,J=Q.uv0.typedBuffer,R=e.geometryInfo.boundingBox;
g.empty(R);var N=c[2]-c[0],M=c[3]-c[1],ia=n-r,n=d[0],W=d[1];d=d[2];for(var oa=0;oa<=B;oa++){var aa=oa/B,na=r+aa*ia;C[oa]=Math.sin(na);F[oa]=Math.cos(na);H[oa]=aa;I[oa]=c[0]+aa*N}r=m&&!!(q&1);N=m&&!!(q&2);for(na=ia=0;na<=E;na++){var ja=na/E,oa=a.lerp(t,h,ja),ta=Math.cos(oa),ra=Math.sin(oa),xa=void 0;m?(xa=l.halfEarthRadius*Math.log((1+ra)/(1-ra)),ja=(xa-c[1])/M):xa=180*oa/Math.PI;for(oa=0;oa<=B;oa++){var aa=H[oa],ua=C[oa],va=F[oa],ma=l.earthRadius;b.samplerData&&(ma+=k.ElevationData.sample(I[oa],xa,
b.samplerData)||0);va=va*ta*ma-n;ua=ua*ta*ma-W;ma=ra*ma-d;v(va,ua,ma,R);var sa=p.GEOMETRY_VERTEX_STRIDE*ia;L[sa+0]=va;L[sa+1]=ua;L[sa+2]=ma;J[sa+0]=aa;J[sa+1]=ja;sa=w(oa,na,B,E);if(-1<sa){var sa=p.GEOMETRY_VERTEX_STRIDE*(G+sa),qa=r&&0===na?-1:N&&na===E?1:0,va=0===qa?va:-n,ua=0===qa?ua:-W,ma=0===qa?ma:l.earthRadius*qa-d;L[sa+0]=va;L[sa+1]=ua;L[sa+2]=ma;J[sa+0]=0===qa?z(aa,ja):aa;J[sa+1]=0===qa?A:ja;0!==qa&&v(va,ua,ma,R)}++ia}}e.geometryInfo.numVertsPerRow=b.numVertsPerRow;e.geometryInfo.vertexAttributes=
Q;e.geometryInfo.skirtLength=A;f.vec4.set(e.geometryInfo.uvOffsetAndScale,0,0,1,1);u(e.geometryInfo,b.numVertsPerRow,m?q:0,b.wireframe)};b.createPlanarGlobePatch=function(a,b,c,d){var e=b[0],h=b[1],l=b[2]-e,m=b[3]-h,q=a.clippingArea,r=q?Math.max(0,(q[0]-b[0])/l):0,t=q?Math.max(0,(q[1]-b[1])/m):0,n=q?Math.min(1,(q[2]-b[0])/l):1;b=q?Math.min(1,(q[3]-b[1])/m):1;var A=n>r?1/(n-r):1,B=b>t?1/(b-t):1,C=-r*A,E=-t*B,G=.1*l,H=a.numVertsPerRow-1,F=a.numVertsPerRow-1,I=a.numVertsPerRow*a.numVertsPerRow,J=y.acquire(I+
(2*H+2*F)),L=J.position.typedBuffer,N=J.uv0.typedBuffer,M=d.geometryInfo.boundingBox;g.empty(M);for(var na=0,ja=0;ja<=F;ja++){var ta=ja/F,ra=E+ta*B,ta=h+ta*m;q&&(ta<q[1]?(ta=q[1],ra=0):ta>q[3]&&(ta=q[3],ra=1));for(var xa=0;xa<=H;xa++){var ua=xa/H,va=C+ua*A,ua=e+ua*l;q&&(ua<q[0]?(ua=q[0],va=0):ua>q[2]&&(ua=q[2],va=1));var ma=a.samplerData?k.ElevationData.sample(ua,ta,a.samplerData)||0:0,ua=ua-c[0],sa=ta-c[1],ma=ma-c[2];v(ua,sa,ma,M);var qa=p.GEOMETRY_VERTEX_STRIDE*na;L[qa+0]=ua;L[qa+1]=sa;L[qa+2]=
ma;N[qa+0]=va;N[qa+1]=ra;qa=w(xa,ja,H,H);-1<qa&&(qa=p.GEOMETRY_VERTEX_STRIDE*(I+qa),L[qa+0]=ua,L[qa+1]=sa,L[qa+2]=ma,N[qa+0]=z(va,ra),N[qa+1]=G);++na}}d.geometryInfo.numVertsPerRow=a.numVertsPerRow;d.geometryInfo.vertexAttributes=J;d.geometryInfo.skirtLength=G;f.vec4.set(d.geometryInfo.uvOffsetAndScale,r,t,n-r,b-t);u(d.geometryInfo,a.numVertsPerRow,0,a.wireframe)};var A=new Map,B=Math.pow(2,-52);b.intersectSkirts=function(a,b,c,d,e,f,g,k,l){var p,q,r,u=f.position;f=f.uv0;var v=a[0],w=a[1];a=a[2];
var n=b[0]-v,z=b[1]-w;b=b[2]-a;d*=3;for(c*=3;c<d;c+=3){var y=e[c],A=e[c+1],C=e[c+2],E=u.get(y,0),H=u.get(y,1);p=u.get(y,2);var F=u.get(A,0),I=u.get(A,1);q=u.get(A,2);var Q=u.get(C,0),L=u.get(C,1);r=u.get(C,2);y=f.get(y,0);A=f.get(A,0);C=f.get(C,0);2<=y&&(h.vec3.set(G,E,H,p),g(G),E+=G[0],H+=G[1],p+=G[2]);2<=A&&(h.vec3.set(G,F,I,q),g(G),F+=G[0],I+=G[1],q+=G[2]);2<=C&&(h.vec3.set(G,Q,L,r),g(G),Q+=G[0],L+=G[1],r+=G[2]);m.isSome(k)&&(p=k.applyToVertex(E,H,p),E=p[0],H=p[1],p=p[2],q=k.applyToVertex(F,I,
q),F=q[0],I=q[1],q=q[2],r=k.applyToVertex(Q,L,r),Q=r[0],L=r[1],r=r[2]);F-=E;I-=H;q-=p;Q-=E;L-=H;r-=p;var y=z*r-L*b,A=b*Q-r*n,R=n*L-Q*z,C=F*y+I*A+q*R,E=v-E,N=w-H,M=a-p,H=N*q-I*M;p=M*F-q*E;var O=E*I-F*N;if(C>B){E=E*y+N*A+M*R;if(0>E||E>C)continue;y=n*H+z*p+b*O;if(0>y||E+y>C)continue}else if(C<-B){E=E*y+N*A+M*R;if(0<E||E<C)continue;y=n*H+z*p+b*O;if(0<y||E+y<C)continue}else continue;H=(Q*H+L*p+r*O)/C;0<=H&&(p=t.computeNormal(F,I,q,Q,L,r,J),l(H,p))}};var C=Array(p.MAX_PATCH_TESSELATION+1),F=Array(p.MAX_PATCH_TESSELATION+
1),H=Array(p.MAX_PATCH_TESSELATION+1),I=Array(p.MAX_PATCH_TESSELATION+1),G=e.vec3f64.create(),J=e.vec3f64.create()})},"esri/views/3d/support/buffer/BufferPool":function(){define(["require","exports","../../../../core/PooledArray"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b){this._factoryCallback=a;this._lengthCallback=b;this._pool=new Map}b.prototype.acquire=function(a){if(!b.test.disabled){var e=this._pool.get(a);if(e&&0!==e.length)return e.pop()}try{return this._factoryCallback(a)}catch(g){var e=
window.performance&&window.performance.memory,f="";e&&(f="\n  totalJSHeapSize: "+e.totalJSHeapSize+", usedJSHeapSize: "+e.usedJSHeapSize+", jsHeapSizeLimit: "+e.jsHeapSizeLimit);console.log("Array allocation of size "+a+" failed: "+g+f);throw g;}};b.prototype.release=function(h){if(!b.test.disabled){var e=this._lengthCallback(h),f=this._pool.get(e);f||(f=new a({shrink:!0}),this._pool.set(e,f));f.push(h)}};b.prototype.clear=function(){this._pool.clear()};Object.defineProperty(b.prototype,"test",{get:function(){return{size:this._pool.size}},
enumerable:!0,configurable:!0});b.test={disabled:!1};return b}();b.BufferPool=n})},"esri/views/3d/terrain/Tile":function(){define("require exports ../../../core/arrayUtils ../../../core/mathUtils ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingRect ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./ElevationBounds ./ElevationTileAgent ./MapTileAgent ./RasterTile ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./TileTexture ./tileUtils ../../webgl/Util".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F){function H(a){a.dispose();a instanceof u?u.Pool.release(a):a instanceof v&&v.Pool.release(a)}Object.defineProperty(b,"__esModule",{value:!0});var I=q.weakAssert,G=l.vec3f64.create(),J=l.vec3f64.create(),E=l.vec3f64.create(),L=c.vec4f64.create();n=function(){return function(){this.angledSplitBias=this.maxLod=this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;this.aboveGround=!0}}();b.SplitLimits=n;n=function(){function b(a){this._numSubdivisionAtLevel=
a;this.lij=[0,0,0];this._children=[null,null,null,null];this._dirty=!0;this._previouslyRendered=!1;this.extent=k.create();this._elevationBounds=f.vec2f64.create();this.layerInfo=Array(2);this.extentInRadians=k.create();this.centerAtSeaLevel=l.vec3f64.create();this._center=[l.vec3f64.create(),l.vec3f64.create(),l.vec3f64.create()];this.up=l.vec3f64.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._maxTesselation=0;this._usedMemory=N;this._curvatureHeight=
this._radius=this._edgeLen2=this._edgeLen=this.renderOrder=this._screenDepth=this._mapDataRefCount=this._mapTileMemory=0}Object.defineProperty(b.prototype,"usedMemory",{get:function(){this._usedMemory===N&&this._updateMemoryUsed();return this._usedMemory+(this.isCached?0:this.mapTileMemory)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"cachedMemory",{get:function(){return this.isCached?this.mapTileMemory:0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"mapTileMemory",
{get:function(){this._usedMemory===N&&this._updateMemoryUsed();for(var a=this._mapTileMemory,b=0,c=this.layerInfo[1];b<c.length;b++){var d=c[b].data;d instanceof p.VectorTile&&(a+=d.getMemoryUsage())}return a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isCached",{get:function(){return!this.shouldRender&&0>=this._mapDataRefCount},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maxTesselation",{get:function(){return this._maxTesselation},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"numSubdivisionsAtLevel",{get:function(){return this._numSubdivisionAtLevel},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isWithinClippingArea",{get:function(){return this._isWithinClippingArea},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"intersectsClippingArea",{get:function(){return this._intersectsClippingArea},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"clippingArea",{get:function(){return this._clippingArea},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"surface",{get:function(){return this._surface},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"elevationBounds",{get:function(){return this._elevationBounds},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"level",{get:function(){return this.lij[0]},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"edgeLen",{get:function(){return this._edgeLen},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"radius",{get:function(){return this._radius},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"screenDepth",{get:function(){return this._screenDepth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"visible",
{get:function(){if(this._dirty){var a=this._isVisible();a!==this._visible&&(this._visible=a,this.updateAgentSuspension(),this.surface.emit("tiles-visibility-changed"),this.surface.renderer.setNeedsRender());this._dirty=!1}return this._visible},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"rendered",{get:function(){var a=!!this.renderData;a!==this._previouslyRendered&&(this.surface.emit("tiles-visibility-changed"),this._previouslyRendered=a,this.surface.renderer.setNeedsRender());
return a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"shouldRender",{get:function(){if(!this.visible)return!1;if(0===this.surface.lodSnapping){var a=this.level-this._surface.snapLevel;if(0===a)return!0;if(1===a)return!1}return this.isLeaf},enumerable:!0,configurable:!0});b.prototype.init=function(a,b,c){this.lij[0]=a[0];this.lij[1]=a[1];this.lij[2]=a[2];c.tilingScheme.getExtent(a[0],a[1],a[2],this.extent,this.extentInRadians);this._intersectsClippingArea=this._isWithinClippingArea=
!0;this._clippingArea=null;this._mapDataRefCount=0;c.upsampleMapCache.pop(C.tile2str(this));this._radius=this._edgeLen2=this._edgeLen=0;this.vlevel=a?a[0]:0;b&&b._elevationBounds?e.vec2.copy(this._elevationBounds,b.elevationBounds):e.vec2.set(this._elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this._screenDepth=0;this._previouslyRendered=this._visible=!1;this._parent=b;this.unsetChildren();this._surface=c;this.updateVisibility();for(a=0;2>a;a++){b=c.numLayers(a);var d=this.layerInfo[a];
this.layerInfo[a]?d.length=b:(d=Array(b),this.layerInfo[a]=d);for(var f=0;f<b;f++)d[f]=A.TilePerLayerInfo.makeEmptyLayerInfo(a,this._surface.upsampleInfoPool,d[f]),0===a&&this.findElevationBoundsForLayer(f,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(c.tilingScheme.pixelSize,w.MAX_PATCH_TESSELATION)};b.prototype.release=function(){I(!this.renderData,"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(C.tile2str(this));for(var a=0;2>a;a++)for(var b=0,c=this.layerInfo[a];b<
c.length;b++)c[b].dispose();this._surface=this._parent=null;this._usedMemory=N};b.prototype.refMapData=function(){++this._mapDataRefCount;this.isCached||this._surface.upsampleMapCache.pop(C.tile2str(this))};b.prototype.unrefMapData=function(){--this._mapDataRefCount;if(this.isCached){var a=this.cachedMemory;0<a&&(this._surface.upsampleMapCache.put(C.tile2str(this),this,a),this.setMemoryDirty())}};b.prototype.setMemoryDirty=function(){this._usedMemory=N};Object.defineProperty(b.prototype,"cpuImageMemorySize",
{get:function(){var a=this._surface.tilingScheme.pixelSize;return a*a*4},enumerable:!0,configurable:!0});b.prototype._updateMemoryUsed=function(){this._mapTileMemory=this._usedMemory=0;for(var a=this.cpuImageMemorySize,b=0,c=this.layerInfo[1];b<c.length;b++){var d=c[b],d=d.data;d instanceof B.TileTexture?this._mapTileMemory+=F.getGpuMemoryUsage(d.texture):d instanceof HTMLImageElement||d instanceof r.ImageWithType?this._mapTileMemory+=a:d instanceof z.default&&(this._mapTileMemory+=d.getMemoryUsage())}b=
0;for(c=this.layerInfo[0];b<c.length;b++)d=c[b],this._usedMemory+=d.data?a:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,a=this.renderData.textureDescriptor)&&(this._mapTileMemory+=F.getGpuMemoryUsage(a));this.isCached&&this._surface.upsampleMapCache.updateSize(C.tile2str(this),this,this.cachedMemory)};b.prototype.getUsedMemoryForLayer=function(a,b){b=this.layerInfo[a][b];if(!b||!b.data)return 0;if(1===a&&!this.isCached){a=b.data;if(a instanceof B.TileTexture)return F.getGpuMemoryUsage(a.texture);
if(a instanceof HTMLImageElement||a instanceof r.ImageWithType)return this.cpuImageMemorySize;if(a instanceof p.VectorTile||a instanceof z.default)return a.getMemoryUsage()}else if(0===a)return this.cpuImageMemorySize;return 0};b.prototype.updateScreenDepth=function(a){g.vec3.copy(L,this._center[0]);L[3]=1;d.vec4.transformMat4(L,L,a);this._screenDepth=0>L[2]?0:L[2]/L[3]};b.prototype.shouldSplit=function(a,b,c){var d=this.level;g.vec3.subtract(G,this._center[0],b);var e=g.vec3.squaredLength(G),f=0;
g.vec3.subtract(J,this._center[1],b);var k=g.vec3.squaredLength(J);k<e&&(e=k,f=1);g.vec3.subtract(J,this._center[2],b);k=g.vec3.squaredLength(J);k<e&&(e=k,f=2);if(this._edgeLen2>e&&d<a.maxLod||0===c&&1===this._surface.snapLevel-d)return 2;c=Math.sqrt(e);var k=g.vec3.dot(this.up,G),e=this._elevationBounds[1]-this._elevationBounds[0],h=e/this.edgeLen;if(a.aboveGround&&0<k&&.001>h&&0<k/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-h)return 0;h=this._edgeLen/(a.fovX*c*2);return h<
a.relativeWidthLimit?this.vlevel!==this.level?(this.vlevel=this.level,4):0:d>=a.maxLod?(a=d+Math.ceil(-m.log2(a.relativeWidthLimit/h)),a!==this.vlevel?(this.vlevel=a,4):1):6<d&&(g.vec3.subtract(J,this._center[f],b),g.vec3.scale(E,this.up,k),g.vec3.subtract(E,E,J),d=g.vec3.squaredLength(E),d>this._radius*this._radius&&(g.vec3.scale(E,E,this._radius/Math.sqrt(d)),g.vec3.add(E,E,this._center[f]),g.vec3.subtract(E,b,E),Math.min(1,(Math.abs(g.vec3.dot(E,this.up))+.5*e+this._curvatureHeight)/g.vec3.length(E))*
(this._edgeLen/(a.fovY*c*2))<.1/a.angledSplitBias*a.relativeHeightLimit))?0:2};b.prototype.setChildren=function(a,b,c,d){I(!!(a&&b&&c&&d),"Null child passed");this._children[0]=a;this._children[1]=b;this._children[2]=c;this._children[3]=d};b.prototype.unsetChildren=function(){this._children[0]=null;this._children[1]=null;this._children[2]=null;this._children[3]=null};b.prototype.load=function(a){this.refMapData();for(var b=0;2>b;b++)this.layerInfo[b]&&this._createOrUpdateAgents(0,b);a.loadTile(this)};
b.prototype.unload=function(a){a.unloadTile(this);for(a=0;2>a;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++){var d=c[b];d.loadingAgent&&d.loadingAgent!==y.TILE_AGENT_DONE&&(H(d.loadingAgent),d.loadingAgent=null);d.pendingUpdates=0}this.resetPendingUpdate(32);this.resetPendingUpdate(64);this.unrefMapData()};b.prototype.unloadMapData=function(){for(var a=0,b=this.layerInfo[1];a<b.length;a++){var c=b[a];c.loadingAgent&&c.loadingAgent!==y.TILE_AGENT_DONE&&(H(c.loadingAgent),c.loadingAgent=null);
c.pendingUpdates=0}this.renderData&&this.renderData.releaseTexture();this.setMemoryDirty()};b.prototype.updateClippingStatus=function(a){if(k.equals(a,this._clippingArea))return!1;var b=this._intersectsClippingArea,c=this._isWithinClippingArea;a?(this._intersectsClippingArea=this.intersectsExtent(a),this._isWithinClippingArea=this.isWithinExtent(a)):this._isWithinClippingArea=this._intersectsClippingArea=!0;this._clippingArea=a;this.updateVisibility();a=c&&this._isWithinClippingArea;b=!c&&!b&&!this._isWithinClippingArea&&
!this._intersectsClippingArea;!this.renderData||a||b||this.setPendingUpdate(32);return!0};b.prototype.updateVisibility=function(){this._dirty=!0;this._surface.setPendingUpdates()};b.prototype.getLayerInfo=function(a,b){return this.layerInfo[b][a]};b.prototype.hasLayerData=function(a,b){a=this.layerInfo[b][a];return!(!a||!a.data||a.dataInvalidated)};Object.defineProperty(b.prototype,"updating",{get:function(){if(this.hasPendingUpdates)return!0;for(var a=0;2>a;a++)for(var b=0,c=this.layerInfo[a];b<
c.length;b++){var d=c[b];if(d.loadingAgent&&d.loadingAgent!==y.TILE_AGENT_DONE&&d.loadingAgent.updating)return!0}return!1},enumerable:!0,configurable:!0});b.prototype.isSuspended=function(a){return this.hasPendingUpdate(2)?!0:0===a?!1:!this.visible};Object.defineProperty(b.prototype,"hasPendingUpdates",{get:function(){return 0!==this._pendingUpdates},enumerable:!0,configurable:!0});b.prototype.hasPendingUpdate=function(a){return(this._pendingUpdates&a)===a};b.prototype.setPendingUpdate=function(a){this._pendingUpdates|=
a;this._surface.setPendingUpdates()};b.prototype.resetPendingUpdate=function(a){return this.hasPendingUpdate(a)?(this._pendingUpdates&=~a,!0):!1};b.prototype.requestLayerData=function(a,b,c){w.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d requested by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a];if(-1<d.waitingAgents.indexOf(c))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),
c.tile.lij.toString(),b,a),!0;d.waitingAgents.push(c);if(d.data&&!d.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),c.dataArrived(this),!0;if(d.requestPromise)return!0;d.requestAbort=h.createAbortController();var e=this._surface.requestTileData(this,a,b,d.requestAbort);if(!e)return d.requestAbort=null,!1;a=function(){d.requestPromise===e&&(d.requestPromise=null,d.requestAbort=null)};d.requestPromise=
e;e.then(a,a);return!!d.requestPromise};Object.defineProperty(b.prototype,"isLeaf",{get:function(){return null==this._children[0]},enumerable:!0,configurable:!0});b.prototype.hasLij=function(a){return this.lij[0]===a[0]&&this.lij[1]===a[1]&&this.lij[2]===a[2]};b.prototype.findByLij=function(a){return this.hasLij(a)?this:this.isLeaf?null:(a=this._children[0].findByLij(a)||this._children[1].findByLij(a)||this._children[2].findByLij(a)||this._children[3].findByLij(a))?a:null};b.prototype.distanceToSquared=
function(a){return g.vec3.squaredLength(g.vec3.subtract(E,this._center[0],a))};b.prototype.containsPoint=function(a){var b=this.extent;return a[0]>=b[0]&&a[1]>=b[1]&&a[0]<=b[2]&&a[1]<=b[3]};b.prototype.unrequestLayerData=function(b,c,d){w.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d canceled by tile %s",this.lij.toString(),c,b,d.tile.lij.toString());var e=this.layerInfo[c][b],f=e.waitingAgents;d=null!=a.removeUnordered(f,d);I(d,"agent has not requested this piece of map data");1>f.length&&
(e.abortRequest(),w.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d request/loading canceled",this.lij.toString(),c,b),this._updateMemoryUsed())};b.prototype.dataArrived=function(a,b,c){a=this.layerInfo[b][a];a.data=c;a.dataInvalidated=!1;for(c=0;c<a.waitingAgents.length;c++)a.waitingAgents[c].dataArrived(this);a.waitingAgents.length=0;this._updateMemoryUsed()};b.prototype.dataMissing=function(a,b,c){c.notInTilemap||console.error("Tile "+this.lij.toString()+" layer "+b+"/"+a+" error "+c);
a=this.layerInfo[b][a];a.dataMissing=!0;for(b=0;b<a.waitingAgents.length;b++)a.waitingAgents[b].dataMissing();a.waitingAgents.length=0;this._updateMemoryUsed()};b.prototype.updateRenderData=function(a){switch(a){case 1:return this.updateTexture();case 0:return this.updateGeometry()}};b.prototype.updateTexture=function(){this.renderData&&this.setPendingUpdate(64)};b.prototype.updateGeometry=function(){this.setPendingUpdate(32);for(var a=0,b=this.layerInfo[0];a<b.length;a++)b[a].pendingUpdates|=32};
b.prototype.invalidateLayerData=function(a,b){this.layerInfo[b][a].invalidateSourceData();this.restartAgents(b)};b.prototype.computeElevationBounds=function(){e.vec2.set(this._elevationBounds,Number.MAX_VALUE,-Number.MAX_VALUE);for(var a=!0,b=0,c=this.layerInfo[0];b<c.length;b++){var d=c[b];d.elevationBounds&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],d.elevationBounds.min),this._elevationBounds[1]=Math.max(this._elevationBounds[1],d.elevationBounds.max),d.elevationBounds.hasNoDataValues||
(a=!1))}a&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],0),this._elevationBounds[1]=Math.max(this._elevationBounds[1],0));this.updateRadiusAndCenter()};b.prototype._updateCenter=function(){g.vec3.scale(E,this.up,.5*(this._elevationBounds[0]+this._elevationBounds[1]));g.vec3.add(this._center[0],this.centerAtSeaLevel,E);g.vec3.scale(E,this.up,this._elevationBounds[0]);g.vec3.add(this._center[1],this.centerAtSeaLevel,E);g.vec3.scale(E,this.up,this._elevationBounds[1]);g.vec3.add(this._center[2],
this.centerAtSeaLevel,E)};b.prototype.findElevationBoundsForLayer=function(a,b){var c=this.layerInfo[0][a];if(!c.elevationBounds||c.elevationBounds.level<b)if(b=this._surface.layerViewByIndex(a,0),b=q.getLayerWithExtentRange(b),C.fallsWithinLayer(this,b,!1)){b=M;var d=!1;if(c.data){var e=c.data;b.min=e.bounds[0];b.max=e.bounds[1];b.hasNoDataValues=e.hasNoDataValues;b.level=this.lij[0];d=!0}else{for(var f=0,g=void 0,e=void 0,k=this._parent;k&&(!e||f<w.ELEVATION_DESIRED_RESOLUTION_LEVEL)&&!(f=this.vlevel-
k.level,g=e||g,e=k.layerInfo[0][a].data,!e&&g&&f>=w.ELEVATION_DESIRED_RESOLUTION_LEVEL);k=k._parent);if(e=e||g)e.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],b),Infinity!==b.min&&(b.level=e.level,d=!0)}d&&(c.elevationBounds||(c.elevationBounds=new t.ElevationBounds),c.elevationBounds.copyFrom(b))}};b.prototype.modifyLayers=function(a,b,c){for(var d=this.layerInfo[c],e=0;e<d.length;e++){var f=d[e];f.loadingAgent&&f.loadingAgent!==y.TILE_AGENT_DONE&&(H(f.loadingAgent),f.loadingAgent=null);
f.waitingAgents.length=0}if(1===c)for(e=0;e<d.length;++e)void 0===a[e]&&d[e].dispose();a=b.length;f=Array(a);for(e=0;e<a;e++){var g=b[e];f[e]=-1<g?d[g]:A.TilePerLayerInfo.makeEmptyLayerInfo(c,this._surface.upsampleInfoPool)}this.layerInfo[c]=f;this._updateMemoryUsed()};b.prototype.restartAgents=function(a){this.renderData&&(this._createOrUpdateAgents(0,a),this.updateRenderData(a))};b.prototype.updateAgents=function(a){if(this.renderData){for(var b=this.layerInfo[a],c=0;c<b.length;c++){var d=b[c];
d.loadingAgent===y.TILE_AGENT_DONE&&(d.loadingAgent=null)}this._createOrUpdateAgents(0,a)}};b.prototype.updateAgentSuspension=function(){for(var a=0;2>a;a++)for(var b=this.isSuspended(a),c=0,d=this.layerInfo[a];c<d.length;c++){var e=d[c];e.loadingAgent&&e.loadingAgent!==y.TILE_AGENT_DONE&&(e.loadingAgent.setSuspension(b),e.loadingAgent===y.TILE_AGENT_DONE&&this.updateRenderData(a))}};b.prototype.removeLayerAgent=function(a,b){a=this.layerInfo[b][a];a.loadingAgent&&a.loadingAgent!==y.TILE_AGENT_DONE&&
a.loadingAgent.dispose();a.loadingAgent=null};b.prototype.agentDone=function(a,b){var c=this.layerInfo[b][a];c.loadingAgent=y.TILE_AGENT_DONE;c.data||c.upsampleInfo||this._createOrUpdateAgents(a+1,b)};b.prototype._createOrUpdateAgents=function(a,b){for(var c=this.isSuspended(b),d=this.layerInfo[b];a<d.length;++a){var e=d[a],f=!1,g=this._surface.layerViewByIndex(a,b),k=q.getLayerWithExtentRange(g);if(e.loadingAgent)C.fallsWithinLayer(this,k,!1)?(e.loadingAgent!==y.TILE_AGENT_DONE&&(w.TILE_LOADING_DEBUGLOG&&
console.log(C.tile2str(this),"update suspended",c),e.loadingAgent.setSuspension(c)),e.loadingAgent!==y.TILE_AGENT_DONE&&(f=e.loadingAgent.update(),w.TILE_LOADING_DEBUGLOG&&console.log(C.tile2str(this),"update"))):e.dispose();else if(C.fallsWithinLayer(this,k,!1)){var f=e,k=a,h=b,l=c,m=0===h?u.Pool.acquire():v.Pool.acquire();m.init(this,k,h,l);f.loadingAgent=m;f=e.loadingAgent.startLoading();w.TILE_LOADING_DEBUGLOG&&console.log(C.tile2str(this),"start");f?e.loadingAgent===y.TILE_AGENT_DONE&&(w.TILE_LOADING_DEBUGLOG&&
console.log(C.tile2str(this),"done"),this.setPendingUpdate(32)):(H(e.loadingAgent),e.loadingAgent=y.TILE_AGENT_DONE,w.TILE_LOADING_DEBUGLOG&&console.log(C.tile2str(this),"done"))}e.loadingAgent===y.TILE_AGENT_DONE&&this.updateRenderData(b);if(f&&g.isOpaque)break}};b.prototype.isWithinExtent=function(a){var b=this.extent;return b[0]>=a[0]&&a[2]>=b[2]&&b[1]>=a[1]&&a[3]>=b[3]};b.prototype.intersectsExtent=function(a){var b=this.extent;return b[2]>=a[0]&&a[2]>=b[0]&&b[3]>=a[1]&&a[3]>=b[1]};Object.defineProperty(b.prototype,
"test",{get:function(){return{cachedMemory:this.cachedMemory}},enumerable:!0,configurable:!0});return b}();b.Tile=n;var M=new t.ElevationBounds,N=-1})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define(["require","exports","./TileAgent","./tileUtils"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b){this._pool=b;this.waitingAgents=[];this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=this.data=null;this.pendingUpdates=
0;this.elevationBounds=void 0;this.init(a)}b.prototype.init=function(a){this.waitingAgents.length=0;this.data=null;this.dataInvalidated=this.dataMissing=!1;this._unsetUpsampleInfo();this.requestAbort=this.requestPromise=this.loadingAgent=null;this.pendingUpdates=0;0===a&&(this.elevationBounds=null)};b.prototype.invalidateSourceData=function(){this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()};b.prototype.abortRequest=function(){this.requestPromise&&(this.requestAbort.abort(),this.requestAbort=
this.requestPromise=null)};b.prototype.dispose=function(){this.loadingAgent&&this.loadingAgent!==a.TILE_AGENT_DONE&&this.loadingAgent.dispose();this.loadingAgent=null;this.abortRequest();this._unsetUpsampleInfo();this.pendingUpdates=0;this.disposeData()};b.prototype.disposeData=function(){!this.data||this.data instanceof HTMLImageElement||this.data instanceof HTMLCanvasElement||this.data instanceof ImageData||this.data.release();this.data=null};Object.defineProperty(b.prototype,"upsampleInfo",{get:function(){return this._upsampleInfo},
enumerable:!0,configurable:!0});b.prototype._unsetUpsampleInfo=function(){this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)};b.prototype.setUpsampleInfo=function(a,b){if(a===b||null==b)this._unsetUpsampleInfo();else{if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===b)return;this._upsampleInfo.tile.unrefMapData()}b.refMapData();m.computeUpsampleInfo(a,b,this._upsampleInfo)}};
b.makeEmptyLayerInfo=function(a,f,g){return g?(g.init(a),g):new b(a,f)};return b}();b.TilePerLayerInfo=n})},"esri/views/3d/terrain/SphericalPatch":function(){define("require exports tslib ../../../core/mathUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/earthUtils ../support/geometryUtils ../support/projectionUtils ../support/geometryUtils/plane ./PatchGeometryFactory ./Tile".split(" "),function(n,b,a,m,h,e,f,g,l,d,c,k){Object.defineProperty(b,"__esModule",
{value:!0});n=function(b){function k(a,c,d){var f=b.call(this,p)||this;f.obb=Array(8);f.isWebMercator=!1;for(var g=0;8>g;g++)f.obb[g]=e.vec3f64.create();void 0!==a&&f.init(a,c,d);return f}a.__extends(k,b);k.prototype.init=function(a,c,d){b.prototype.init.call(this,a,c,d);this.isWebMercator=d.tilingScheme.spatialReference.isWebMercator;c=this.extentInRadians[0];d=this.extentInRadians[1];var g=this.extentInRadians[2],k=this.extentInRadians[3];a=a[0];var p=m.lerp(d,k,.5),r=m.lerp(c,g,.5);this._edgeLen=
(g-c)*Math.cos(0===a?0:Math.min(Math.abs(d),Math.abs(k)))*f.earthRadius;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=f.earthRadius-Math.sqrt(f.earthRadius*f.earthRadius-this._edgeLen2/4);l.wgs84ComparableLonLatToECEF(this.centerAtSeaLevel,r,p,0);c=e.vec3f64.fromArray(this.centerAtSeaLevel);h.vec3.normalize(c,c);this.up=c;this._updateOBB();this.updateRadiusAndCenter()};k.prototype.updateRadiusAndCenter=function(){if(0===this.lij[0])h.vec3.set(this._center[0],0,0,0),h.vec3.set(this._center[1],
0,0,0),h.vec3.set(this._center[2],0,0,0),this._radius=f.earthRadius+this.elevationBounds[1];else{this._updateCenter();var a=Math.max(h.vec3.squaredDistance(this._center[0],this.obb[0]),h.vec3.squaredDistance(this._center[0],this.obb[1]));this._radius=Math.sqrt(a)}};k.prototype._isVisible=function(){if(!this.intersectsClippingArea)return!1;var a=this.surface.frustum.planes;if(10>this.lij[0])return g.frustum.intersectsSphere(a,g.sphere.wrap(this._radius,this._center[0]));for(var b=this.obb,c=0;6>c;c++){var e=
a[c];4===c&&(e=d.copy(e,r),r[3]-=this.surface.view.state.camera.near);for(var f=void 0,f=0;8>f&&!d.isPointOutside(e,b[f]);f++);if(8===f)return!1}return!0};k.prototype.computeElevationBounds=function(){b.prototype.computeElevationBounds.call(this);this._updateOBB()};k.prototype.createGeometry=function(a,b){var d=this._isPole(this.lij[1],this.lij[0]);c.createSphericalGlobePatch(a,this.extent,b,this.renderData,this.extentInRadians,this.isWebMercator,d);this.setMemoryDirty()};k.prototype._updateOBB=function(){for(var a=
this.extentInRadians,b=this.obb,c=0;2>c;c++){var d=this.elevationBounds[c],e=4*c;l.wgs84ComparableLonLatToECEF(b[e++],a[0],a[1],d);l.wgs84ComparableLonLatToECEF(b[e++],a[0],a[3],d);l.wgs84ComparableLonLatToECEF(b[e++],a[2],a[3],d);l.wgs84ComparableLonLatToECEF(b[e++],a[2],a[1],d)}this.isWebMercator&&(a=this._isPole(this.lij[1],this.lij[0]),2===a?(h.vec3.set(b[1],0,0,f.earthRadius),h.vec3.set(b[2],0,0,f.earthRadius),h.vec3.set(b[5],0,0,f.earthRadius),h.vec3.set(b[6],0,0,f.earthRadius)):1===a&&(h.vec3.set(b[0],
0,0,-f.earthRadius),h.vec3.set(b[3],0,0,-f.earthRadius),h.vec3.set(b[4],0,0,-f.earthRadius),h.vec3.set(b[7],0,0,-f.earthRadius)))};k.prototype._isPole=function(a,b){var c=0;a===(1<<b)-1&&(c+=1);0===a&&(c+=2);return c};return k}(k.Tile);b.SphericalPatch=n;var p=[128,64,32,16,16,8,8,4],r=d.create()})},"esri/views/3d/terrain/SurfaceExtentHelper":function(){define("require exports tslib ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../../../layers/support/layerUtils ./TerrainConst ./terrainUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k){function p(a,b){a&&!a.spatialReference.equals(b)&&(a=l.canProject(a.spatialReference,b)?l.project(a,b):null);return a}Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function c(a){a=b.call(this,a)||this;a._handles=new h;return a}a.__extends(c,b);c.prototype.initialize=function(){var a=this;this._handles.add([this.layerViews.on("change",function(){return a.notifyChange("stencilEnabledExtents")})])};c.prototype.destroy=function(){this._handles.destroy();
this._handles=null};Object.defineProperty(c.prototype,"layerViewsExtent",{get:function(){return this._computeLayerViewsExtent()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"tiledLayersExtent",{get:function(){return this._computeTiledLayersExtent()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"stencilEnabledExtents",{get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"spatialReference",{set:function(a){this.tilingScheme||this._set("spatialReference",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"tilingScheme",{set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)},enumerable:!0,configurable:!0});c.prototype._computeStencilEnabledExtents=function(a,b){var c=[],d=0;for(a=a.items;d<a.length;d++){var e=a[d].layer;"IntegratedMeshLayer"===e.operationalLayerType&&null!=b&&(e=p(e.fullExtent,b),null!=e&&c.push(g.fromExtent(e)))}return c};
a.__decorate([f.property({readOnly:!0})],c.prototype,"layerViewsExtent",null);a.__decorate([f.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],c.prototype,"tiledLayersExtent",null);a.__decorate([f.property({readOnly:!0,dependsOn:["spatialReference"]})],c.prototype,"stencilEnabledExtents",null);a.__decorate([f.property()],c.prototype,"spatialReference",null);a.__decorate([f.property()],c.prototype,"tilingScheme",null);a.__decorate([f.property()],c.prototype,"defaultTiledLayersExtent",
void 0);a.__decorate([f.property({constructOnly:!0})],c.prototype,"layers",void 0);a.__decorate([f.property({constructOnly:!0})],c.prototype,"layerViews",void 0);return c=a.__decorate([f.subclass("esri.views.3d.terrain.SurfaceExtentHelperBase")],c)}(m);m=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}a.__extends(d,b);d.prototype._computeLayerViewsExtent=function(){return this._getGlobalExtent()};d.prototype._computeTiledLayersExtent=function(){return this._getGlobalExtent()};
d.prototype._getGlobalExtent=function(){return this.spatialReference.isWebMercator?c.WEBMERCATOR_WORLD_EXTENT:c.GEOGRAPHIC_WORLD_EXTENT};a.__decorate([f.property({dependsOn:["spatialReference"]})],d.prototype,"layerViewsExtent",void 0);return d=a.__decorate([f.subclass("esri.views.3d.terrain.SurfaceExtentHelperGlobal")],d)}(n);b.SurfaceExtentHelperGlobal=m;n=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}a.__extends(c,b);c.prototype.initialize=function(){var a=this;this._handles.add([this.layers.on("change",
function(b){return a._handleLayersChanged(b)}),this.layerViews.on("change",function(){return a.notifyChange("layerViewsExtent")})])};c.prototype._handleLayersChanged=function(a){for(var b=this,c=0,d=a.removed;c<d.length;c++)this._handles.remove(d[c].uid);c=0;for(a=a.added;c<a.length;c++)d=a[c],this._handles.add(e.init(d,"loaded",function(){return b.notifyChange("tiledLayersExtent")}),d.uid)};c.prototype._computeLayerViewsExtent=function(){var a=g.empty(),b=this.spatialReference;this.layerViews.forEach(function(c){c.isResolved()&&
(c=p("fullExtentInLocalViewSpatialReference"in c&&c.fullExtentInLocalViewSpatialReference||c.layer.fullExtent,b))&&g.expand(a,c)});var c=g.allFinite(a)?a:null,d=this._get("layerViewsExtent");return g.equals(c,d)?d:c};c.prototype._computeTiledLayersExtent=function(){var a=this.tilingScheme;if(!a)return null;var b=this.spatialReference,c=g.empty();this.layers.forEach(function(e){if(e.loaded&&d.isTiledLayer(e)){var f=k.getTiledLayerInfo(e,b,"local"),h=f.tileInfo,f=f.fullExtent;h&&"imagery-tile"===e.type&&
f?g.expand(c,f):h&&a.compatibleWith(h)&&f&&f.spatialReference.equals(b)&&g.expand(c,f)}});this.defaultTiledLayersExtent&&g.expand(c,this.defaultTiledLayersExtent);var e=g.allFinite(c)?c:null,f=this._get("tiledLayersExtent");return g.equals(e,f)?f:e};return c=a.__decorate([f.subclass("esri.views.3d.terrain.SurfaceExtentHelperLocal")],c)}(n);b.SurfaceExtentHelperLocal=n})},"esri/views/3d/terrain/SurfaceTilingSchemeLogic":function(){define("require exports tslib ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../../../layers/support/layerUtils ../support/projectionUtils ./terrainUtils ./TilingScheme".split(" "),
function(n,b,a,m,h,e,f,g,l,d){return function(b){function c(a){a=b.call(this,a)||this;a._changeHandles=new h;return a}a.__extends(c,b);c.prototype.initialize=function(){var a=this;this._changeHandles.add(this.layers.on("change",function(){return a._update()}));this._changeHandles.add(this.extentHelper.watch("layerViewsExtent",function(){return a._setAdHocTilingScheme()}));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};c.prototype.destroy=function(){this._changeHandles.destroy();
this._changeHandles=null};c.prototype._update=function(){var a=this;this._waitTask=null;if(!this.tilingSchemeLocked){this._set("tilingSchemeDone",!1);var b;this.layers.some(function(c){return!f.isTiledLayer(c)||c.isRejected()?!1:!c.isFulfilled()||l.getTiledLayerInfo(c,a.viewSpatialReference,a.manifold).tileInfo?(b=c,"vector-tile"!==c.type&&"imagery-tile"!==c.type):!1});if(b)if(b.isResolved()){var c=l.getTiledLayerInfo(b,this.viewSpatialReference,this.manifold).tileInfo,c=new d(c);this._set("tilingSchemeDone",
!0);this._lockTilingScheme(c)}else this._updateWhen(b);else this._set("tilingSchemeDone",!0)}};c.prototype._updateWhen=function(a){var b=this,c=a.when().catch(function(a){return a}).then(function(){c===b._waitTask&&b._update()});this._waitTask=c};c.prototype._lockTilingScheme=function(a){var b=this;if("spherical"===this.manifold){var c=a.levels.length-1;a.spatialReference.isWebMercator?a=d.makeWebMercatorAuxiliarySphere(c):g.canProjectToWGS84ComparableLonLat(a.spatialReference)&&(a=d.makeGCSWithTileSize(a.spatialReference,
a.pixelSize,c))}this.tilingSchemeLocked=!0;this.tilingScheme=a;this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this._changeHandles.removeAll();this._changeHandles.add(this.extentHelper.watch("tiledLayersExtent",function(){return b._updateTiledLayerExtent()}))};c.prototype._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent};c.prototype._setAdHocTilingScheme=function(){if("spherical"===this.manifold){var a=this.extentHelper.spatialReference;
a.isWebMercator?this.tilingScheme=d.WebMercatorAuxiliarySphere:g.canProjectToWGS84ComparableLonLat(a)&&(this.tilingScheme=d.makeGCSWithTileSize(a,256));this.extent=this.extentHelper.layerViewsExtent}else if(a=this.extentHelper.layerViewsExtent)this.tilingScheme=d.fromExtent(a,this.extentHelper.spatialReference),this.extent=a};a.__decorate([e.property()],c.prototype,"tilingScheme",void 0);a.__decorate([e.property()],c.prototype,"extent",void 0);a.__decorate([e.property({value:!1})],c.prototype,"tilingSchemeLocked",
void 0);a.__decorate([e.property({readOnly:!0,value:!1})],c.prototype,"tilingSchemeDone",void 0);a.__decorate([e.property({constructOnly:!0})],c.prototype,"viewSpatialReference",void 0);a.__decorate([e.property({constructOnly:!0})],c.prototype,"layers",void 0);a.__decorate([e.property({constructOnly:!0})],c.prototype,"extentHelper",void 0);a.__decorate([e.property({constructOnly:!0})],c.prototype,"manifold",void 0);return c=a.__decorate([e.subclass("esri.views.3d.terrain.SurfaceTilingSchemeLogic")],
c)}(m)})},"esri/views/3d/terrain/TerrainRenderer":function(){define("require exports tslib ../../../Color ../../../core/Accessor ../../../core/compilerUtils ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ../support/imageUtils ../support/buffer/BufferView ./OverlayRenderer ./PatchGeometryFactory ./PatchRenderData ./TileRenderer ./tileUtils ../webgl-engine/core/shaderLibrary/Slice.glsl ../webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/tracer ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainTechnique".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L,M,N){function Q(a,b,c){u.vec4.set(c,a[0]*b[2]+b[0],a[1]*b[3]+b[1],a[2]*b[2],a[3]*b[3])}var R=p.vec2f64.create(),W=z.create(),O=v.vec4f64.create(),U=v.vec4f64.create(),P=v.vec4f64.create(),ba=function(){return function(){this.extent=v.vec4f64.create();this.maxLevel=this.minLevel=0;this.callback=null}}();n=function(b){function h(a){a=b.call(this,a)||this;a.type="Terrain";a.isGround=!0;a.tileSize=256;a.rctx=null;a._isTransparent=
!1;a.renderDataPool=new g(B.PatchRenderData);a.patchGroups=new l({allocator:function(a){return a||{root:null,origin:null,patches:new l}},deallocator:function(a){a.root=null;a.origin=null;a.patches.clear();return a}});a.patchGroupsDirty=!0;a.patchGroupsMap=new Map;a.tileIterator=new F.IteratorPreorder;a.highestVisibleLODTile=null;a.visible=!0;a._opaque=!0;a._skirtScale=1;a._velvetOverground=!0;a.castShadows=!0;a._ssrEnabled=!1;a.emptyTex=null;a.tileRenderer=null;a.tileBackgroundInitialized=!1;a.tileBackgroundUpdating=
!1;a.stencilEnabledLayerExtents=[];a.numTrianglesRendered=0;a.numTilesRendered=0;a.numTilesCulled=0;a.numOriginsRendered=0;a.clippingExtent=null;a.needsHighlight=!1;a.renderOccludedFlags=1;a.visibleScaleRangeQueries=new l({initialSize:10});a.visibleScaleRangeQueriesInvPtr=0;a.visibleScaleRangeQueryQueue=new l({initialSize:30});a.visibleScaleRangeQueryPool=new g(ba);return a}a.__extends(h,b);h.prototype.destroy=function(){A.clearCaches()};h.prototype.install=function(a){a.addRenderPlugin([2,7,9],this)};
h.prototype.uninstall=function(a){a.removeRenderPlugin(this)};Object.defineProperty(h.prototype,"updating",{get:function(){return!this.tileBackgroundInitialized||this.tileBackgroundUpdating},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"canRender",{get:function(){return this.visible&&!!this.rootTiles&&this.tileBackgroundInitialized&&!this.renderingDisabled},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"renderingDisabled",{set:function(a){this._set("renderingDisabled",
!!a);this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"opaque",{get:function(){return this._opaque&&!this.shaderTechniqueConfig.slicePlaneEnabled},set:function(a){this._opaque!==a&&(this._opaque=a,this.setNeedsRender())},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"needsLinearDepth",{get:function(){return this.overlayRenderer.hasWater},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"isTransparent",{get:function(){return this._isTransparent},
set:function(a){this._isTransparent!==a&&(this._isTransparent=a,this.setNeedsRender())},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"skirtScale",{get:function(){return this._skirtScale},set:function(a){a!==this._skirtScale&&(this._skirtScale=a,this.setNeedsRender())},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"renderPatchBorders",{get:function(){return!!this.shaderTechniqueConfig.tileBorders},set:function(a){this.shaderTechniqueConfig.tileBorders!==a&&
(this.shaderTechniqueConfig.tileBorders=a,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"cullBackFaces",{get:function(){return this.shaderTechniqueConfig.backfaceCullingEnabled},set:function(a){this.shaderTechniqueConfig.backfaceCullingEnabled!==a&&(this.shaderTechniqueConfig.backfaceCullingEnabled=a,this.notifyChange("cullBackFaces"),this.setNeedsRender())},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,
"renderOrder",{set:function(a){this._set("renderOrder",a);this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"velvetOverground",{set:function(a){this._velvetOverground!==a&&(this._velvetOverground=a,this.setNeedsRender())},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"intersectionHandlerId",{get:function(){return J.TERRAIN_ID},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"slicePlane",{get:function(){return this.shaderTechniqueConfig.slicePlaneEnabled},
set:function(a){this.shaderTechniqueConfig.slicePlaneEnabled!==a&&(this.shaderTechniqueConfig.slicePlaneEnabled=a,this.setNeedsRender())},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"textureFadingEnabled",{set:function(a){this.shaderTechniqueConfig.textureFadingEnabled!==a&&(this.shaderTechniqueConfig.textureFadingEnabled=a,this.setNeedsRender())},enumerable:!0,configurable:!0});h.prototype.setDebugScreenSizePerspective=function(a){this.shaderTechniqueConfig.screenSizePerspective!==
a&&(this.shaderTechniqueConfig.screenSizePerspective=a,this.setNeedsRender())};h.prototype.setRootTiles=function(a){this.rootTiles=a;this.setNeedsRender()};h.prototype.setNeedsHighlight=function(a){this.needsHighlight=a;this.setNeedsRender()};h.prototype.setRenderOccludedOverlay=function(a){this.renderOccludedFlags=a?y.overlayRenderOccludedFlag:1;this.setNeedsRender()};h.prototype.setStencilEnabledLayerExtents=function(a){this.stencilEnabledLayerExtents=a;this.setNeedsRender()};h.prototype.setTileSize=
function(a){this.tileSize=a;this.tileRenderer&&(this.tileRenderer.tileSize=a);this.setNeedsRender()};h.prototype.loadTile=function(a){a.renderData||(a.renderData=this.renderDataPool.acquire(),a.renderData.init(a),a.renderData.localOrigin=this._getLocalOriginOfTile(a));this.updateTileGeometry(a);this.updateTileTexture(a)};h.prototype.queryVisibleLevelRange=function(a,b,c,d){var e=this.visibleScaleRangeQueryPool.acquire();u.vec4.copy(e.extent,a);e.minLevel=b?b:-Number.MAX_VALUE;e.maxLevel=null!=c?c:
Number.MAX_VALUE;e.callback=d;this.visibleScaleRangeQueryQueue.push(e);this.setNeedsRender()};h.prototype.updateTileTexture=function(a){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(a),this.setNeedsRender(),a.resetPendingUpdate(64))};h.prototype.updateTileGeometry=function(a){for(var b=0,c=a.layerInfo[0];b<c.length;b++)c[b].pendingUpdates&=-33;a.resetPendingUpdate(32);a.renderData.updateGeometry(this.rctx,this.wireframe)&&this.setNeedsRender()};h.prototype.unloadTile=
function(a){a.renderData&&(this.releaseTileGeometry(a.renderData),a.renderData.clear(),a.renderData=null,a.setMemoryDirty(),this.setNeedsRender())};h.prototype._getLocalOriginOfTile=function(a){var b=Math.max(0,7*Math.floor((a.lij[0]-3)/7));if("spherical"===this.manifold&&0===b)return t.vec3f64.ZEROS;for(;a.parent&&a.lij[0]>b;)a=a.parent;return a.centerAtSeaLevel};h.prototype.setVisibility=function(a){this.visible=a;this.setNeedsRender()};h.prototype.getStats=function(){return{numTilesRendered:this.numTilesRendered,
numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,numOriginsRendered:this.numOriginsRendered}};Object.defineProperty(h.prototype,"wireframe",{set:function(a){var b=this;this._get("wireframe")!==a&&(this._set("wireframe",a),this.rootTiles&&(F.traverseTilesPreorder(this.rootTiles,function(c){c.renderData&&c.renderData.updateGeometry(b.rctx,a)}),this.setNeedsRender()))},enumerable:!0,configurable:!0});h.prototype.setNeedsRender=function(a){void 0===a&&(a=1);this.patchGroupsDirty=
!0;this.initContext.requestRender(a)};h.prototype.setTileBackground=function(a){this.tileBackground=a;this._updateTileBackground()};h.prototype.initializeRenderContext=function(a){this.initContext=a;this.rctx=a.rctx;this.shaderTechniques=a.shaderTechniqueRep;this.shaderTechniqueConfig=new N.TerrainTechniqueConfiguration;this.tileRenderer=new C(this.rctx,this.tileSize,this.shaderTechniques);this.tileBackground&&this._updateTileBackground();this.emptyTex=G.createEmptyTexture(this.rctx)};h.prototype.uninitializeRenderContext=
function(){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null);this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)};h.prototype.intersect=function(a,b,c,d){if(this.rootTiles&&(!a.options.selectOpaqueTerrainOnly||!a.options.selectionMode||this._opaque)){var e=X,g=Y;r.vec3.subtract(e,d,c);r.vec3.set(g,1/e[0],1/e[1],1/e[2]);var h=a.results.min,l=a.results.max,m=a.results.ground,p=0===a.options.store,t=!!a.results.ground.target,u=null,n=this.clippingExtent,v=this.tileIterator;
v.reset(this.rootTiles);for(var w=J.getVerticalOffsetTerrain(a.verticalOffset),y=function(){var y=v.next();if(null===y.renderData||t&&B._useStencilForTile(y))return"continue";if(a.options.invisibleTerrain){if(!y.visible&&n&&!y.intersectsExtent(n))return"continue"}else if(!y.visible)return"continue";var C=y.renderData.geometryInfo,E=y.renderData.localOrigin,G=-B._skirtScale*C.skirtLength;z.set(W,C.boundingBox);f.isSome(w)&&(w.localOrigin=E,w.applyToAABB(W));if(0!==G){var H=y.up;z.expandWithOffset(W,
G*H[0],G*H[1],G*H[2])}r.vec3.subtract(da,c,E);if(!M.intersectAabbInvDirBefore(W,da,g,a.tolerance,p&&null!=h.dist?h.dist:Infinity))return"continue";var I=function(a,b,c,d){a.set(void 0,F.tile2str(b),c,d,k.mat4f64.IDENTITY,void 0);a.intersector=ga;a.target={type:"external",metadata:{tile:b}}},H=function(g,k){0<=g&&(a.options.backfacesTerrain||0>r.vec3.dot(k,e))&&(a.options.invisibleTerrain||!a.options.selectionMode||null==b||b(c,d,g))&&((null==m.dist||g<m.dist)&&I(m,y,g,k),a.options.storeTerrainResults&&
(2===a.options.store&&(f.isNone(u)?(u=new J.IntersectorResult(a.ray),I(u,y,g,k),a.results.all.push(u)):g<u.dist&&I(u,y,g,k)),(null==h.dist||g<h.dist)&&I(h,y,g,k),0!==a.options.store&&(null==l.dist||g>l.dist)&&I(l,y,g,k)))},L=fa;r.vec3.subtract(L,d,E);var E=C.indices,Q=C.vertexAttributes,P={data:Q.getField("position",q.BufferViewVec3f).typedBuffer,size:3,offsetIdx:0,strideIdx:Q.stride/4},C=C.numWithoutSkirtIndices/3;M.intersectTriangles(da,L,0,C,E,P,null,w,H);0!==G&&A.intersectSkirts(da,L,C,E.length/
3,E,Q,"spherical"===B.manifold?function(a){return r.vec3.scale(a,a,G/r.vec3.length(a))}:function(a){return r.vec3.set(a,0,0,G)},w,H)},B=this;!v.done;)y()}};h.prototype.render=function(a){if(9===a.slot){if(0===(a.renderOccludedMask&y.overlayRenderOccludedFlag))return!1}else if(a.slot!==(this.opaque?2:7))return!1;L.trace("# BEGIN RENDER TERRAIN");var b=a.pass,c=1===a.scenelightingData.globalFactor,d=this._updatePatchGroups();switch(b){case 0:b=a.shadowMap&&a.shadowMap.enabled;this.shaderTechniqueConfig.receiveShadows!==
b&&(this.shaderTechniqueConfig.receiveShadows=b);b=this.overlayRenderer.isEmpty()?0:this.overlayRenderer.hasWater?2:1;this.shaderTechniqueConfig.overlayMode!==b&&(this.shaderTechniqueConfig.overlayMode=b);this._renderMaterialPass(a,0,d,9===a.slot?"occluded":"colorAndWater");break;case 3:this.castShadows&&c&&this._renderAuxiliaryPass(a,3,d,"none");break;case 1:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(a,1,d,"none");break;case 2:this._renderAuxiliaryPass(a,2,d,"none");
break;case 4:this.needsHighlight&&(this._renderAuxiliaryPass(a,4,d,"highlight"),a.rctx.clearSafe(256))}L.trace("# END RENDER TERRAIN");0!==this.visibleScaleRangeQueryQueue.length&&this.setNeedsRender();return!0};h.prototype._renderMaterialPass=function(a,b,c,d){var e=this,f=a.rctx,g=a.camera;this._ssrEnabled=a.ssrParams.ssrEnabled;this._setTerrainTechnique(b,"occluded"===d);var k=this.shaderTechnique.program;a.rctx.bindProgram(k);f.bindProgram(k);"colorAndWater"===d&&a.ssrParams&&(a.ssrParams.lastFrameColorTextureID=
9,a.ssrParams.linearDepthTextureID=8,I.ScreenSpaceReflections.bindUniforms(k,f,a.ssrParams));a.shadowMap&&a.shadowMap.bind(k,7);a.ssaoHelper&&a.ssaoHelper.setUniforms(k,6);k.setUniform1i("tex",0);k.setUniform1i("texNext",1);this._bindOverlayUniforms(k);k.setUniformMatrix4fv("viewNormal",g.viewInverseTransposeMatrix);k.setUniformMatrix4fv("proj",g.projectionMatrix);a.scenelightingData.setUniforms(k,!0);b=g.viewMatrix;r.vec3.set(T,b[12],b[13],b[14]);r.vec3.normalize(T,T);k.setUniform3fv("viewDirection",
T);this.numOriginsRendered=this.numTrianglesRendered=this.numTilesCulled=this.numTilesRendered=0;this._prepareScaleRangeQueries();this.opaque?this._renderPatchGroups(a,k,c,d):a.offscreenRenderingHelper.renderToTargets(function(){return e._renderPatchGroups(a,k,c,d)},a.offscreenRenderingHelper.tmpColor,a.offscreenRenderingHelper.mainDepth,[0,0,0,0]);this._processScaleRangeQueries()};h.prototype._renderAuxiliaryPass=function(a,b,c,d){this._setTerrainTechnique(b,"occluded"===d);b=this.shaderTechnique.program;
a.rctx.bindProgram(b);if(4===a.pass){var e=a.offscreenRenderingHelper;a.rctx.bindTexture(e.depthTexture,6);b.setUniform1i("depthTex",6);b.setUniform4f("highlightViewportPixelSz",0,0,1/e.width,1/e.height)}else if(b.setUniformMatrix4fv("viewNormal",a.camera.viewInverseTransposeMatrix),1===a.pass||3===a.pass)R[0]=a.camera.near,R[1]=a.camera.far,b.setUniform2fv("nearFar",R);this._renderPatchGroupsAuxiliary(a,b,c,d)};h.prototype._updateTileBackground=function(){var a=this;if(this.tileRenderer){this.tileBackgroundUpdating=
!0;var b=function(){a.tileBackgroundInitialized=!0;a.tileBackgroundUpdating=!1;a.rootTiles&&F.traverseTilesPreorder(a.rootTiles,function(b){a.tileRenderer.updateTileTexture(b);a.setNeedsRender()});a.setNeedsRender()};if("string"===typeof this.tileBackground){var c=this.tileBackground;w.requestImage(c).then(function(d){c===a.tileBackground&&a.tileRenderer&&(a.tileRenderer.setBackground(d),b())})}else{var d=this.tileBackground?m.toUnitRGBA(this.tileBackground):[0,0,0,0];this.tileRenderer.setBackground(d);
b()}}};h.prototype._updatePatchGroups=function(){var a=this,b=this.patchGroups;if(!this.patchGroupsDirty)return b;this.highestVisibleLODTile=null;this._renderCollectOrigins(b);if(0!==this.renderOrder){for(var c=0;c<b.length;c++)F.sortTiles(this.renderOrder,b.data[c].patches);b.sort(function(b,c){var d=a.renderOrder;b=0===b.patches.length?-d:0===c.patches.length?d:F.compareTiles(b.patches.data[0],c.patches.data[0],d);return b})}this.patchGroupsDirty=!1;return b};h.prototype._renderCollectOrigins=function(a){var b=
this.rootTiles,c="spherical"===this.manifold;a.clear();for(var d=0;d<b.length;d++){var e=b[d],f=a.pushNew();f.root=e;f.origin=c?t.vec3f64.ZEROS:e.centerAtSeaLevel;f.patches.clear();this._renderCollectOriginsForRoot(a,f)}a.filterInPlace(function(a){return 0<a.patches.length})};h.prototype._renderCollectOriginsForRoot=function(a,b){var c=this.tileIterator;c.resetOne(b.root);var d=this.patchGroupsMap;d.clear();for(d.set(b.origin,b);!c.done;){b=c.next();var e=b.renderData;if(e&&!b.visible)this.numTilesCulled++,
c.skipSubtree();else{if(0===b.lij[0]%7){var f=a.pushNew();f.root=b;f.origin=b.centerAtSeaLevel;d.set(b.centerAtSeaLevel,f);f.patches.clear()}if(!b.rendered)this.numTilesCulled++;else if(e){(f=d.get(e.localOrigin))&&f.patches.push(b);if(!this.highestVisibleLODTile||b.vlevel>this.highestVisibleLODTile.vlevel)this.highestVisibleLODTile=b;c.skipSubtree()}}}};h.prototype._scaleQueriesForTile=function(a){var b=a.extent;a=a.lij[0];for(var c=0;c<this.visibleScaleRangeQueriesInvPtr;){var d=this.visibleScaleRangeQueries.data[c],
e=d.extent;a>=d.minLevel&&a<=d.maxLevel&&e[0]<=b[2]&&e[2]>=b[0]&&e[1]<=b[3]&&e[3]>=b[1]?(this.visibleScaleRangeQueries.swapElements(c,this.visibleScaleRangeQueriesInvPtr-1),this.visibleScaleRangeQueriesInvPtr--):c++}};h.prototype._useStencilForTile=function(a){for(var b=0,c=this.stencilEnabledLayerExtents;b<c.length;b++)if(a.intersectsExtent(c[b]))return!0;return!1};h.prototype._renderPatchGroupsAuxiliary=function(a,b,c,d){this.shaderTechnique.bindPipelineState(a.rctx);var e=0<this.stencilEnabledLayerExtents.length;
b.setUniformMatrix4fv("proj",a.camera.projectionMatrix);b.setUniform1f("skirtScale",this._skirtScale);"none"!==d&&this._bindOverlayUniforms(b);for(var f=0;f<c.length;f++){var g=c.data[f];this._bindViewForPatchGroup(b,g,a.camera.eye,a.camera.viewMatrix);for(var k=0;k<g.patches.length;k++)this._renderPatch(a.rctx,b,g.patches.data[k],4,e,d)}a.rctx.bindVAO(null)};h.prototype._renderPatchGroups=function(a,b,c,d){var e=a.rctx,g=a.camera,k=g.viewMatrix;this.shaderTechnique.bindPipelineState(e);if(this.shaderTechniqueConfig.screenSizePerspective&&
this.pointsOfInterest){var h=E.getSettings("spherical"===this.manifold?"global":"local");h.update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:g.fovY});M.bindScreenSizePerspective(h,b,"screenSizePerspective")}var h=0<this.stencilEnabledLayerExtents.length,l="occluded"===d;l&&(e.bindTexture(this.emptyTex,0),b.setUniform1f("blend",1),b.setUniform4fv("texOffsetAndScale",v.vec4f64.ZEROS));b.setUniform1f("skirtScale",l?0:this._skirtScale);for(var m=this.wireframe?1:4,p=0;p<c.length;p++){var q=
c.data[p],r=q.patches;if(0!==r.length)for(this._bindViewForPatchGroup(b,q,g.eye,k),H.Slice.bindUniforms(b,this.shaderTechnique.configuration,a.sliceHelper&&a.sliceHelper.plane,q.origin),a.shadowMap&&a.shadowMap.bindView(b,q.origin),this.numOriginsRendered++,q=0;q<r.length;q++){var t=r.data[q],u=t.renderData.textureReference;if(!f.isNone(u)){L.trace("# RENDER TILE "+F.tile2str(t)+", screenDepth:"+t.screenDepth);if(!l){this._scaleQueriesForTile(t);Q(t.renderData.geometryInfo.uvOffsetAndScale,u.offsetAndScale,
P);b.setUniform4fv("texOffsetAndScale",P);e.bindTexture(u.texture.texture,0);var u=t.renderData.textureFadeFactor,n=1>u?t.renderData.nextTextureReference:null;this.shaderTechniqueConfig.textureFadingEnabled&&f.isSome(n)?(Q(t.renderData.geometryInfo.uvOffsetAndScale,n.offsetAndScale,P),b.setUniform1f("textureFadeFactor",u),b.setUniform4fv("nextTexOffsetAndScale",P),e.bindTexture(n.texture.texture,1)):(b.setUniform1f("textureFadeFactor",1),e.bindTexture(this.emptyTex,1));t.renderData.textureIsFading&&
this.setNeedsRender();b.setUniform1f("opacity",t.renderData.opacity)}u=this._renderPatch(e,b,t,m,h,d);t.renderOrder=this.numTilesRendered;this.numTilesRendered++;this.numTrianglesRendered+=u/3}}}e.bindVAO(null)};h.prototype._renderPatch=function(a,b,c,d,e,f){"none"!==f&&(this._bindOverlayTextures(b,c.renderData.overlays,f),b.setUniform1f("overlayOpacity",c.renderData.overlayOpacity));e&&(this._useStencilForTile(c)?this.stencilShaderTechnique.bindPipelineState(a):this.shaderTechnique.bindPipelineState(a));
e=0===this._skirtScale?c.renderData.geometryInfo.numWithoutSkirtIndices:c.renderData.vao.indexBuffer.size;a.bindVAO(c.renderData.vao);b.assertCompatibleVertexAttributeLocations(c.renderData.vao);a.drawElements(d,e,c.renderData.vao.indexBuffer.indexType,0);return e};h.prototype._bindViewForPatchGroup=function(a,b,d,e){a.setUniform3fv("origin",b.origin);c.mat4.translate(V,e,b.origin);a.setUniformMatrix4fv("view",V);a.setUniform3f("camPos",d[0]-b.origin[0],d[1]-b.origin[1],d[2]-b.origin[2])};h.prototype._bindOverlayUniforms=
function(a){a.setUniform1i("ovInnerColorTex",2);a.setUniform1i("ovOuterColorTex",3);a.setUniform1i("ovInnerWaterTex",4);a.setUniform1i("ovOuterWaterTex",5)};h.prototype._bindOverlayTextures=function(a,b,c){for(var d=0;2>d;d++){var f=2*d,g=b[d],k=void 0,h=void 0;switch(c){case "colorAndWater":k=g.renderTargetIds.color;h=g.renderTargetIds.water;break;case "highlight":k=g.renderTargetIds.highlight;break;case "occluded":k=g.renderTargetIds.occluded;break;case "none":break;default:e.neverReached(c)}k?
(O[f]=g.texOffset[0],O[f+1]=g.texOffset[1],U[f]=g.texScale[0],U[f+1]=g.texScale[1],f=this.overlayRenderer.getRenderTargetTexture(k),this.rctx.bindTexture(f,2+d),h?(h=this.overlayRenderer.getRenderTargetTexture(h),this.rctx.bindTexture(h,4+d)):this.rctx.bindTexture(this.emptyTex,4+d)):(O[f]=0,O[f+1]=0,U[f]=0,U[f+1]=0,this.rctx.bindTexture(this.emptyTex,2+d),this.rctx.bindTexture(this.emptyTex,4+d))}a.setUniform4fv("overlayTexOffset",O);a.setUniform4fv("overlayTexScale",U)};h.prototype._setTerrainTechnique=
function(a,b){this.shaderTechniqueConfig.output=a;0===a&&(this.shaderTechniqueConfig.atmosphere="spherical"===this.manifold&&this._velvetOverground,this.shaderTechniqueConfig.ssrEnabled=this._ssrEnabled);this.shaderTechniqueConfig.renderOccluded=b;this.shaderTechniqueConfig.stencilEnabled=!1;this.shaderTechnique=this.shaderTechniques.acquireAndReleaseExisting(N.TerrainTechnique,this.shaderTechniqueConfig,this.shaderTechnique);this.shaderTechniqueConfig.stencilEnabled=!0;this.stencilShaderTechnique=
this.shaderTechniques.acquireAndReleaseExisting(N.TerrainTechnique,this.shaderTechniqueConfig,this.stencilShaderTechnique)};h.prototype.releaseTileGeometry=function(a){a.releaseGeometry()&&this.setNeedsRender();this.renderDataPool.release(a)};h.prototype._prepareScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryQueue;a.length<a.data.length&&0<b.length;){var c=b.pop();a.push(c)}this.visibleScaleRangeQueriesInvPtr=a.length};h.prototype._processScaleRangeQueries=
function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryPool,c=0;c<a.length;c++){var d=a.data[c];b.release(d);d.callback(c>=this.visibleScaleRangeQueriesInvPtr);d.callback=null}a.clear()};Object.defineProperty(h.prototype,"test",{get:function(){return{tileRenderer:this.tileRenderer}},enumerable:!0,configurable:!0});a.__decorate([d.property()],h.prototype,"tileBackgroundInitialized",void 0);a.__decorate([d.property()],h.prototype,"tileBackgroundUpdating",void 0);a.__decorate([d.property({constructOnly:!0})],
h.prototype,"manifold",void 0);a.__decorate([d.property({constructOnly:!0})],h.prototype,"overlayRenderer",void 0);a.__decorate([d.property({readOnly:!0,dependsOn:["tileBackgroundInitialized","tileBackgroundUpdating"]})],h.prototype,"updating",null);a.__decorate([d.property({value:!1})],h.prototype,"renderingDisabled",null);a.__decorate([d.property()],h.prototype,"renderPatchBorders",null);a.__decorate([d.property()],h.prototype,"cullBackFaces",null);a.__decorate([d.property({value:1})],h.prototype,
"renderOrder",null);a.__decorate([d.property()],h.prototype,"wireframe",null);return h=a.__decorate([d.subclass("esri.views.3d.terrain.TerrainRenderer")],h)}(h);var V=k.mat4f64.create(),T=t.vec3f64.create(),X=t.vec3f64.create(),Y=t.vec3f64.create(),da=t.vec3f64.create(),fa=t.vec3f64.create(),ga="TerrainRenderer";return n})},"esri/views/3d/terrain/PatchRenderData":function(){define("require exports ../../../core/arrayUtils ../../../core/mathUtils ../../../core/maybe ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ../support/buffer/glUtil ./PatchGeometryFactory ./TerrainConst ./TextureFader ./tileUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){var a=this;this.overlayTexOffset=f.vec2f64.create();this.geometryInfo={indices:null,vertexAttributes:null,boundingBox:l.empty(),numSurfaceIndices:0,numSkirtIndices:0,numWithoutSkirtIndices:0,numVertsPerRow:0,skirtLength:0,uvOffsetAndScale:g.vec4f64.create()};this._textureRef=new p.default(function(){return a.tile.surface.textureFadeDuration})}b.prototype.init=function(a){this.tile=
a;this.clear();a=this.geometryInfo;a.indices=null;a.vertexAttributes=null;l.empty(a.boundingBox);a.numSurfaceIndices=0;a.numSkirtIndices=0;a.numWithoutSkirtIndices=0;a.numVertsPerRow=0;this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1};this.opacity=1;if(this.overlays){a=0;for(var b=this.overlays;a<b.length;a++){var c=b[a];c.renderTargetIds.color=null;c.renderTargetIds.highlight=null;c.renderTargetIds.water=null;c.renderTargetIds.occluded=null;e.vec2.set(c.texScale,
1,1);e.vec2.set(c.texOffset,0,0)}}else for(this.overlays=[null,null],a=0;2>a;a++)this.overlays[a]={renderTargetIds:{color:null,highlight:null,water:null,occluded:null},texScale:[1,1],texOffset:[0,0]};this.overlayOpacity=1;this.localOrigin=null};b.prototype.clear=function(){this.releaseGeometry();this.releaseTexture();this._textureRef.clear()};b.prototype.updateGeometry=function(a,b){if(!this._updateGeometryState(b))return!1;this._releaseGeometry();this._createGeometry(a);return!0};b.prototype.releaseGeometry=
function(){return this._releaseGeometry()?(this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1},!0):!1};b.prototype.ensureTexture=function(a,b){h.isSome(this._texture)&&this._texture.descriptor.width!==a&&this.releaseTexture();this._texture||(this._texture=b(),this.tile.setMemoryDirty());return this._texture};b.prototype.releaseTexture=function(){h.isSome(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())};b.prototype._updateGeometryState=
function(b){var c=this._getElevationInfo(),d=this.tile.level,e=8>d?this.tile.numSubdivisionsAtLevel[d]+1:2;c.samplerData&&(e=this.tile.maxTesselation,e=m.clamp((e>>Math.max(d-c.maxTileLevel,k.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-d)))+1,2,e+1));d=this.tile.clippingArea;if(!this.tile.intersectsClippingArea||this.tile.isWithinClippingArea)d=null;var f=this.geometryState,g=!1;f.numVertsPerRow!==e&&(f.numVertsPerRow=e,g=!0);c.changed&&(f.samplerData=c.samplerData,g=!0);a.equals(f.clippingArea,
d)||(f.clippingArea=d,g=!0);f.wireframe!==b&&(f.wireframe=b,g=!0);return g};b.prototype._createGeometry=function(a){this.tile.createGeometry(this.geometryState,this.localOrigin);var b=this.geometryInfo.vertexAttributes,c=this.geometryInfo.indices,e=a.gl;this._vao=new v(a,t.Default3D,{geometry:d.glLayout(b.layout)},{geometry:u.createVertex(a,e.STATIC_DRAW,b.buffer)},u.createIndex(a,e.STATIC_DRAW,c))};b.prototype._releaseGeometry=function(){if(!this._vao)return!1;this._vao.dispose();this._vao=null;
c.releaseGeometry(this.geometryInfo);return!0};Object.defineProperty(b.prototype,"vao",{get:function(){return this._vao},enumerable:!0,configurable:!0});b.prototype.setTextureReference=function(a,b,c,d,e){void 0===e&&(e=0);a!==this._texture&&this.releaseTexture();this._textureRef.push(a,b,c,d,e)};Object.defineProperty(b.prototype,"textureReference",{get:function(){return this._textureRef.current},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"nextTextureReference",{get:function(){return this._textureRef.next},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"textureFadeFactor",{get:function(){return this._textureRef.fadeFactor},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"textureIsFading",{get:function(){return this._textureRef.isFading},enumerable:!0,configurable:!0});b.prototype._getElevationInfo=function(){for(var a=this.geometryState.samplerData,b=this.tile.layerInfo[0],c=b.length,d=Array(c),e=0,f=0,g=!1,k=0;k<c;k++){var h=b[k];if(h.upsampleInfo){var h=h.upsampleInfo.tile,
l=h.layerInfo[0][k].data,l=l&&l.samplerData;a&&a[e]===l||(g=!0);d[e++]=l;f=Math.max(f,h.lij[0])}else h.data&&(l=this.tile.surface.layerViewByIndex(k,0),r.fallsWithinLayer(this.tile,l.layer,!1)&&(l=h.data,a&&a[e]===l.samplerData||(g=!0),d[e++]=l.samplerData,f=this.tile.lij[0]))}a&&a.length!==e&&(g=!0);0<e?d.length=e:d=null;return{changed:g,samplerData:d,maxTileLevel:f}};Object.defineProperty(b.prototype,"estimatedGeometryMemoryUsage",{get:function(){return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"textureDescriptor",{get:function(){return h.isSome(this._texture)?this._texture.descriptor:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"test",{get:function(){return{hasTexture:null!=this._texture}},enumerable:!0,configurable:!0});return b}();b.PatchRenderData=n})},"esri/views/3d/terrain/TextureFader":function(){define(["require","exports","../../../core/maybe","../../../core/libs/gl-matrix-2/vec4f64"],function(n,
b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this._getFadeDuration=a;this._delayedTime=this._fadeStart=0}b.prototype.clear=function(){this._current=a.destroyMaybe(this._current);this._next=a.destroyMaybe(this._next);this._waiting=a.destroyMaybe(this._waiting);this._delayed=a.destroyMaybe(this._delayed)};Object.defineProperty(b.prototype,"current",{get:function(){if(a.isNone(this._current))return null;if(!this._isFading){var b=this._delayed||this._waiting||this._next||
this._current;b!==this._current&&(this._current=null,this.clear(),this._current=b)}b=performance.now();a.isSome(this._delayed)&&b>=this._delayedTime&&(this._push(this._delayed,0),this._delayed=null);a.isSome(this._next)&&b-this._fadeStart>=this._fadeDuration&&(a.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=b);return this._current},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"next",{get:function(){return this._next},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fadeFactor",{get:function(){if(a.isNone(this._next))return 1;var b=performance.now()-this._fadeStart,e=this._fadeDuration;return b>e?0:1-b/e},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isFading",{get:function(){return a.isSome(this._next)||a.isSome(this._delayed)},enumerable:!0,configurable:!0});b.prototype.push=function(b,e,l,d,c){void 0===c&&(c=0);this._delayed=a.destroyMaybe(this._delayed);b=a.isSome(b)?
new h(b,e,l,d):null;this._push(b,c)};b.prototype._push=function(b,e){this._isFading||this.clear();if(a.isNone(this._current))this._current=b;else{var f=performance.now();0!==e?(this._delayed=b,this._delayedTime=f+e):a.isNone(this._next)?(this._next=b,this._fadeStart=f):a.isNone(b)||(a.destroyMaybe(this._waiting),this._waiting=b)}};Object.defineProperty(b.prototype,"_fadeDuration",{get:function(){return a.isNone(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"_isFading",{get:function(){return 0<this._getFadeDuration()},enumerable:!0,configurable:!0});return b}();b.default=n;var h=function(){function a(a,b,e,d){this.texture=a;a.retain();this.offsetAndScale=m.vec4f64.fromValues(b,e,d,d)}a.prototype.destroy=function(){this.texture.release()};return a}();b.TextureReference=h})},"esri/views/3d/terrain/TileRenderer":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../layers/support/layerUtils ../../webgl ../../2d/engine/vectorTiles/tileRendererHelper3D ../support/StreamDataLoader ./BlendLayersTechnique ./RasterColorizerTechnique ./terrainUtils ./terrainUtils ./TileTexture ./support/FBOPool ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/rasterUtils ../../webgl/Util".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q){function y(a,b,c){c.layerIndex=b;var d=a.layerInfo[1][b];return d.data?(h.vec2.set(c.offset,0,0),c.tile=a,c.scale=1,c.sourceLod=a.lij,c.sourceLayerInfo=d,c):(a=d.upsampleInfo)?(b=a.tile.layerInfo[1][b],c.tile=a.tile,h.vec2.copy(c.offset,a.offset),c.scale=a.scale,c.sourceLod=a.tile.lij,c.sourceLayerInfo=b,c):null}var A=[],B={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0};return function(){function b(a,b,d){this._rctx=
a;this.tileSize=b;this._blackTex=this._backgroundTexture=null;this._vectorTileHelper=new l.VectorTileRendererHelper3D;this._rctx.capabilities.textureFilterAnisotropic&&(this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy);this._vaoQuad=z.createQuadVAO(this._rctx,v.Pos2Tex);a=new c.BlendLayersTechniqueConfiguration;a.mode=2;this._blendLayersTechnique=d.acquireAndReleaseExisting(c.BlendLayersTechnique,a,this._blendLayersTechnique);a.mode=1;this._applyOpacityTechnique=d.acquireAndReleaseExisting(c.BlendLayersTechnique,
a,this._applyOpacityTechnique);this._techniqueRep=d;this._blackTex=new t.TileTexture(z.createColorTexture(this._rctx,[0,0,0,1]));this._fboPool=new u.FBOPool(this._rctx)}b.prototype.dispose=function(){this._fboPool&&(this._fboPool.clear(),this._fboPool=null);this._vaoQuad&&(this._vaoQuad.dispose(),this._vaoQuad=null);m.isSome(this._backgroundTexture)&&(this._backgroundTexture.release(),this._backgroundTexture=null);this._blackTex&&(this._blackTex.release(),this._blackTex=null);this._blendLayersTechnique&&
(this._blendLayersTechnique.dispose(),this._blendLayersTechnique=null);this._applyOpacityTechnique&&(this._applyOpacityTechnique.dispose(),this._applyOpacityTechnique=null);this._rasterColorizerTechnique&&(this._rasterColorizerTechnique.dispose(),this._rasterColorizerTechnique=null);this._vectorTileHelper&&(this._vectorTileHelper.dispose(),this._vectorTileHelper=null)};b.prototype.updateTileTexture=function(b){for(var c=b.layerInfo[1],d=0;d<c.length;d++)c[d].pendingUpdates&=-65;if(b.renderData){for(var e=
b.surface,g=e.baseOpacity,k=0,d=0,h=this.tileSize,l=!1,q=e.view.pixelRatio,r=c.length,t=0;t<c.length&&!l;t++){var u=e.layerViewByIndex(t,1),n=u.fullOpacity;A[t]=n;f.isBaseLayer(u.layer)&&r>=c.length&&(r=t);if(0!==n){++d;var v=y(b,t,B);v&&(p.isVectorTileLayerView(u)?h=Math.max(h,this.tileSize*q):1===g&&1===n&&(u.isOpaque||this._dataToTexture(v)&&m.isSome(v.sourceLayerInfo.data)&&v.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++k)}}this._cleanupFBOPool(q,c.length);g=h;h=a.nextHighestPowerOfTwo(g);
c=h*h;e=g*g;c===e?h=g:(g=h/2,h=c-e<e-g*g?h:g);c=h/this.tileSize;--t;if(0===k){k=0;if(b.surface.view.layerViewManager.updating||0<d)k=5E3;this._backgroundTexture&&m.isNone(b.renderData.textureReference)&&(k=0);this._useBackgroundTexture(b,k)}else 1===k&&l?this._useLayerTexture(b,t):this._composeMapLayers(b,t,r,l,A,h,c)}};b.prototype.setBackground=function(a){m.isSome(this._backgroundTexture)&&this._backgroundTexture.release();this._backgroundTexture=a instanceof HTMLImageElement?this._buildTexture(a):
new t.TileTexture(z.createColorTexture(this._rctx,a))};b.prototype._buildTexture=function(a){if(m.isNone(a))return null;var b={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},c=this._rctx,e;if("number"===typeof a)b.width=b.height=a,e=new t.TileTexture(new g.Texture(c,b));else if(a instanceof d.ImageWithType)b.isOpaque=a.isOpaque,e=new t.TileTexture(new g.Texture(c,b,a.image)),a.release();else try{e=new t.TileTexture(new g.Texture(c,
b,a))}catch(J){e=new t.TileTexture(z.createEmptyTexture(c)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}c.bindTexture(e.texture);e.generateMipmap();return e};b.prototype._drawQuad=function(a){this._rctx.bindVAO(this._vaoQuad);a.assertCompatibleVertexAttributeLocations(this._vaoQuad);this._rctx.drawArrays(5,0,q.vertexCount(this._vaoQuad,"geometry"))};b.prototype._drawRasterData=function(a,b,c,d,e){void 0===e&&(e=1);if(!m.isNone(b)){var f=this._rctx,
g=a.program;f.setPipelineState(a.pipeline);f.bindProgram(g);f.bindTexture(b,0);g.setUniform1i("tex",0);g.setUniform1f("scale",c);g.setUniform2f("offset",d[0],d[1]);g.setUniform1f("opacity",e);this._drawQuad(g)}};b.prototype._drawImageryTileData=function(a,b){void 0===b&&(b=1);var c=a.sourceLayerInfo.data;if(!m.isNone(c)&&c.source){a.tile.surface.layerViewByIndex(a.layerIndex,1).ensureSymbolizerParameters(c);var d=this._getRasterColorizerTechnique(c.symbolizerParameters.type,!!c.symbolizerParameters.colormap),
e=this._rctx,f=d.program;e.setPipelineState(d.pipeline);e.bindProgram(f);c.bind(e)&&(c.opacity=b,c.scale=a.scale,c.offset=a.offset,a=c.getTextures(),w.setTextures(e,f,a.names,a.textures),c=c.getUniforms(),d.bindPass(e,c),this._drawQuad(f),e.bindVAO())}};b.prototype._getRasterColorizerTechnique=function(a,b){a=["stretch","lut","hillshade"].indexOf(a);this._rasterColorizerConfig||(this._rasterColorizerConfig=new k.RasterColorizerTechniqueConfiguration,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),
this._rctx.gl.getExtension("OES_texture_float"));this._rasterColorizerConfig.colorizerType=a;this._rasterColorizerConfig.applyColormap=b;return this._rasterColorizerTechnique=this._techniqueRep.acquireAndReleaseExisting(k.RasterColorizerTechnique,this._rasterColorizerConfig,this._rasterColorizerTechnique)};b.prototype._drawVectorData=function(a,b,c,d,e,f,g){var k=b.sourceLayerInfo.data;if(m.isNone(k))return g;var h=this._rctx,l=b.tile.surface.layerViewByIndex(b.layerIndex,1),p;h.setPipelineState(a.pipeline);
var q=1>d;q?(p=this._fboPool.acquire(e),h.bindFramebuffer(p),h.setClearColor(1,1,1,0),h.clearSafe(16640)):g&&h.clearSafe(256);this._vectorTileHelper.render(h,b.sourceLod,k,l.painter,l.layer.styleRepository,l.schemaHelper,Math.round(1/b.scale),b.offset,this.tileSize,c);return q?(h.bindFramebuffer(f),this._drawRasterData(a,p.colorTexture,1,[0,0],d),this._fboPool.release(p),g):!0};b.prototype._useBackgroundTexture=function(a,b){a.renderData.opacity=a.surface.baseOpacity;a.renderData.setTextureReference(this._backgroundTexture,
0,0,1,b)};b.prototype._useLayerTexture=function(a,b){a.renderData.opacity=a.surface.baseOpacity;b=y(a,b,B);if(this._dataToTexture(b)){var c=b.offset;a.renderData.setTextureReference(b.sourceLayerInfo.data,c[0],c[1],b.scale)}};b.prototype._composeMapLayers=function(a,b,c,d,f,g,k){var h=this,l=a.renderData.ensureTexture(g,function(){return h._buildTexture(g)});if(!m.isNone(l)){var q=this._rctx,r=this._fboPool.acquire(g);q.bindFramebuffer(r);q.setViewport(0,0,g,g);q.setClearColor(0,0,0,0);q.setClearDepth(1);
q.clearSafe(16640);var t=!1;!d&&m.isSome(this._backgroundTexture)&&this._drawRasterData(this._blendLayersTechnique,this._backgroundTexture.texture,1,e.vec2f64.ZEROS);d=a.surface.baseOpacity;for(var u=!1;0<=b;b--){var n=y(a,b,B);n&&(b<c&&1>d&&!u&&(this._drawRasterData(this._applyOpacityTechnique,this._blackTex.texture,1,e.vec2f64.ZEROS,d),u=!0),0!==f[b]&&(p.isVectorTileRenderInfo(n)?t=this._drawVectorData(this._blendLayersTechnique,n,k,f[b],g,r,t):p.isImageryTileRenderInfo(n)?this._drawImageryTileData(n,
f[b]):this._dataToTexture(n)&&m.isSome(n.sourceLayerInfo.data)&&this._drawRasterData(this._blendLayersTechnique,n.sourceLayerInfo.data.texture,n.scale,n.offset,f[b])))}q.bindTexture(l.texture);c=l.descriptor;q.gl.copyTexImage2D(q.gl.TEXTURE_2D,0,c.pixelFormat,0,0,c.width,c.height,0);l.generateMipmap();q.bindFramebuffer(null);this._fboPool.release(r);a.renderData.opacity=u?1:d;a.renderData.setTextureReference(l,0,0,1)}};b.prototype._dataToTexture=function(a){r.isRasterTileRenderInfo(a)&&this._rasterDataToTexture(a);
return p.isTextureTileRenderInfo(a)};b.prototype._rasterDataToTexture=function(a){var b=a.sourceLayerInfo;b.data=this._buildTexture(b.data);a.tile.setMemoryDirty()};b.prototype._cleanupFBOPool=function(a,b){if(a!==this._lastPixelRatio||b!==this._lastNumLayers)this._fboPool.clear(),this._lastPixelRatio=a,this._lastNumLayers=b};return b}()})},"esri/views/2d/engine/vectorTiles/tileRendererHelper3D":function(){define(["require","exports","../../../../geometry","../../../../Viewpoint","../../ViewState"],
function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this.renderParams={context:null,drawPhase:1,state:new h({viewpoint:new m({targetGeometry:new a.Point(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerId:-1,painter:null,glyphMosaic:null,spriteMosaic:null,fadeRecorder:null,driverTestResult:null,profiler:null,renderingOptions:null,timeDelta:-1,
timeline:null,hasClipping:!1,blendMode:null}}b.prototype.dispose=function(){this.renderParams=null};b.prototype.render=function(a,b,e,d,c,k,h,m,t,u){var f=k.adjustLevel(b[0]),g=this.renderParams;g.context=a;g.painter=d;g.glyphMosaic=d.glyphMosaic;g.spriteMosaic=d.spriteMosaic;g.fadeRecorder=d.fadeRecorder;g.pixelRatio=u;g.displayLevel=f;g.requiredLevel=f;d.setContext(a);u=k.getScale(b[0]);k=k.getShift(b,h*u);b=k[0];k=k[1];u=.125*h*u/t;f=e.transforms.dvs;f[0]=u;f[4]=-u;f[6]=-1-b-m[0]*h*2;f[7]=1+k+
(1-m[1])*h*2-2;g.state.size[0]=t;g.state.size[1]=t;e.stage||e.attachWithContext(a);e.triangleCount=0;d.drawTile(g,e,c)};return b}();b.VectorTileRendererHelper3D=n})},"esri/views/2d/ViewState":function(){define("require exports tslib ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/libs/gl-matrix-2/common ../../core/libs/gl-matrix-2/mat2d ../../core/libs/gl-matrix-2/mat2df32 ../../core/libs/gl-matrix-2/mat2df64 ../../core/libs/gl-matrix-2/mat3 ../../core/libs/gl-matrix-2/mat3f32 ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f32 ../../core/libs/gl-matrix-2/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ./viewpointUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z){var w=[0,0];return function(b){function e(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];a=b.apply(this,a)||this;a._viewpoint2D={center:u.vec2f64.create(),rotation:0,scale:0,spatialReference:null};a.center=[0,0];a.extent=new m.Extent;a.id=0;a.inverseTransform=c.mat2df64.create();a.resolution=0;a.rotation=0;a.scale=0;a.transform=c.mat2df64.create();a.transformNoRotation=c.mat2df64.create();a.displayMat3=p.mat3f32.create();a.displayViewMat3=
p.mat3f32.create();a.viewMat3=p.mat3f32.create();a.viewMat2d=d.mat2df32.create();a.worldScreenWidth=0;a.size=[0,0];return a}a.__extends(e,b);q=e;Object.defineProperty(e.prototype,"pixelRatio",{set:function(a){this._set("pixelRatio",a);this._update()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"size",{set:function(a){this._set("size",a);this._update()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"viewpoint",{set:function(a){if(a){var b=this._viewpoint2D,
c=a.targetGeometry;b.center[0]=c.x;b.center[1]=c.y;b.rotation=a.rotation;b.scale=a.scale;b.spatialReference=c.spatialReference}this._update()},enumerable:!0,configurable:!0});e.prototype.copy=function(a){var b=this.size,c=this.viewpoint;c&&b?(this.viewpoint=z.copy(c,a.viewpoint),this._set("size",r.vec2.copy(b,a.size))):(this.viewpoint=a.viewpoint.clone(),this._set("size",[a.size[0],a.size[1]]));this._set("pixelRatio",a.pixelRatio);return this};e.prototype.clone=function(){return new q({size:this.size,
viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})};e.prototype.toMap=function(a,b,c){if(v.isVec2(b))return r.vec2.transformMat2d(a,b,this.inverseTransform);w[0]=b;w[1]=c;return r.vec2.transformMat2d(a,w,this.inverseTransform)};e.prototype.toScreen=function(a,b,c){if(v.isVec2(b))return r.vec2.transformMat2d(a,b,this.transform);w[0]=b;w[1]=c;return r.vec2.transformMat2d(a,w,this.transform)};e.prototype.toScreenNoRotation=function(a,b,c){if(v.isVec2(b))return r.vec2.transformMat2d(a,b,this.transformNoRotation);
w[0]=b;w[1]=c;return r.vec2.transformMat2d(a,w,this.transformNoRotation)};e.prototype.getScreenTransform=function(a,b){var c=this._viewpoint2D.center,d=this._get("pixelRatio")||1,e=this._get("size");z.getMatrix(a,c,e,b,0,d);return a};e.prototype._update=function(){var a=this._viewpoint2D,b=a.center,c=a.spatialReference,d=a.scale,e=a.rotation,a=this._get("pixelRatio")||1,f=this._get("size"),p=new h({targetGeometry:new m.Point(b[0],b[1],c),scale:d,rotation:e});this._set("viewpoint",p);if(f&&c&&d)return this.resolution=
z.getResolution(p),this.rotation=e,this.scale=d,this.spatialReference=c,r.vec2.copy(this.center,b),k.mat3.set(this.displayMat3,0!==f[0]?2/f[0]:0,0,0,0,0!==f[1]?-2/f[1]:0,0,-1,1,1),d=k.mat3.identity(this.viewMat3),b=t.vec2f32.fromValues(f[0]/2,f[1]/2),c=t.vec2f32.fromValues(-f[0]/2,-f[1]/2),e=g.common.toRadian(e),k.mat3.translate(d,d,b),k.mat3.rotate(d,d,e),k.mat3.translate(d,d,c),k.mat3.multiply(this.displayViewMat3,this.displayMat3,d),d=l.mat2d.identity(this.viewMat2d),l.mat2d.translate(d,d,b),l.mat2d.rotate(d,
d,e),l.mat2d.translate(d,d,c),z.getExtent(this.extent,p,f),z.getTransform(this.transform,p,f,a),l.mat2d.invert(this.inverseTransform,this.transform),z.getTransformNoRotation(this.transformNoRotation,p,f,a),this.worldScreenWidth=z.getWorldScreenWidth(this.spatialReference,this.resolution),this._set("id",this.id+1),this};var q;a.__decorate([f.property({readOnly:!0})],e.prototype,"id",void 0);a.__decorate([f.property({value:1,json:{write:!0}})],e.prototype,"pixelRatio",null);a.__decorate([f.property({json:{write:!0}})],
e.prototype,"size",null);a.__decorate([f.property({type:h,json:{write:!0}})],e.prototype,"viewpoint",null);return e=q=a.__decorate([f.subclass("esri.views.2d.ViewState")],e)}(e.JSONSupport)})},"esri/core/libs/gl-matrix-2/common":function(){define(["require","exports","./math/common"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.common=a})},"esri/core/libs/gl-matrix-2/mat2d":function(){define(["require","exports","./math/mat2d"],function(n,b,a){Object.defineProperty(b,"__esModule",
{value:!0});b.mat2d=a})},"esri/core/libs/gl-matrix-2/math/mat2d":function(){define(["require","exports","./common"],function(n,b,a){function m(a,b,g){var e=b[0],d=b[1],c=b[2],f=b[3],h=b[4];b=b[5];var m=g[0],t=g[1],u=g[2],n=g[3],z=g[4];g=g[5];a[0]=e*m+c*t;a[1]=d*m+f*t;a[2]=e*u+c*n;a[3]=d*u+f*n;a[4]=e*z+c*g+h;a[5]=d*z+f*g+b;return a}function h(a,b,g){a[0]=b[0]-g[0];a[1]=b[1]-g[1];a[2]=b[2]-g[2];a[3]=b[3]-g[3];a[4]=b[4]-g[4];a[5]=b[5]-g[5];return a}Object.defineProperty(b,"__esModule",{value:!0});b.copy=
function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a};b.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a};b.set=function(a,b,g,h,d,c,k){a[0]=b;a[1]=g;a[2]=h;a[3]=d;a[4]=c;a[5]=k;return a};b.invert=function(a,b){var e=b[0],f=b[1],d=b[2],c=b[3],k=b[4];b=b[5];var h=e*c-f*d;if(!h)return null;h=1/h;a[0]=c*h;a[1]=-f*h;a[2]=-d*h;a[3]=e*h;a[4]=(d*b-c*k)*h;a[5]=(f*k-e*b)*h;return a};b.determinant=function(a){return a[0]*a[3]-a[1]*a[2]};b.multiply=m;b.rotate=
function(a,b,g){var e=b[0],d=b[1],c=b[2],f=b[3],h=b[4];b=b[5];var m=Math.sin(g);g=Math.cos(g);a[0]=e*g+c*m;a[1]=d*g+f*m;a[2]=e*-m+c*g;a[3]=d*-m+f*g;a[4]=h;a[5]=b;return a};b.scale=function(a,b,g){var e=b[1],d=b[2],c=b[3],f=b[4],h=b[5],m=g[0];g=g[1];a[0]=b[0]*m;a[1]=e*m;a[2]=d*g;a[3]=c*g;a[4]=f;a[5]=h;return a};b.translate=function(a,b,g){var e=b[0],d=b[1],c=b[2],f=b[3],h=b[4];b=b[5];var m=g[0];g=g[1];a[0]=e;a[1]=d;a[2]=c;a[3]=f;a[4]=e*m+c*g+h;a[5]=d*m+f*g+b;return a};b.fromRotation=function(a,b){var e=
Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=e;a[2]=-e;a[3]=b;a[4]=0;a[5]=0;return a};b.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=b[1];a[4]=0;a[5]=0;return a};b.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=b[0];a[5]=b[1];return a};b.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)};b.add=function(a,
b,g){a[0]=b[0]+g[0];a[1]=b[1]+g[1];a[2]=b[2]+g[2];a[3]=b[3]+g[3];a[4]=b[4]+g[4];a[5]=b[5]+g[5];return a};b.subtract=h;b.multiplyScalar=function(a,b,g){a[0]=b[0]*g;a[1]=b[1]*g;a[2]=b[2]*g;a[3]=b[3]*g;a[4]=b[4]*g;a[5]=b[5]*g;return a};b.multiplyScalarAndAdd=function(a,b,g,h){a[0]=b[0]+g[0]*h;a[1]=b[1]+g[1]*h;a[2]=b[2]+g[2]*h;a[3]=b[3]+g[3]*h;a[4]=b[4]+g[4]*h;a[5]=b[5]+g[5]*h;return a};b.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]};b.equals=
function(b,f){var e=b[0],h=b[1],d=b[2],c=b[3],k=b[4];b=b[5];var m=f[0],r=f[1],t=f[2],u=f[3],n=f[4];f=f[5];return Math.abs(e-m)<=a.EPSILON*Math.max(1,Math.abs(e),Math.abs(m))&&Math.abs(h-r)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(r))&&Math.abs(d-t)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(t))&&Math.abs(c-u)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(u))&&Math.abs(k-n)<=a.EPSILON*Math.max(1,Math.abs(k),Math.abs(n))&&Math.abs(b-f)<=a.EPSILON*Math.max(1,Math.abs(b),Math.abs(f))};b.mul=m;b.sub=h})},
"esri/core/libs/gl-matrix-2/mat2df32":function(){define(["require","exports","./factories/mat2df32"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.mat2df32=a})},"esri/core/libs/gl-matrix-2/factories/mat2df32":function(){define(["require","exports"],function(n,b){function a(a,b,e,f){var g=b[f];b=b[f+1];a[f]=e[0]*g+e[2]*b+e[4];a[f+1]=e[1]*g+e[3]*b+e[5]}Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var a=new Float32Array(6);a[0]=1;a[3]=1;return a};b.clone=
function(a){var b=new Float32Array(6);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];return b};b.fromValues=function(a,b,e,f,g,l){var d=new Float32Array(6);d[0]=a;d[1]=b;d[2]=e;d[3]=f;d[4]=g;d[5]=l;return d};b.createView=function(a,b){return new Float32Array(a,b,6)};b.transform=a;b.transformMany=function(b,h,e,f,g,l){void 0===f&&(f=0);void 0===g&&(g=0);void 0===l&&(l=2);for(g=g||h.length/l;f<g;f++)a(b,h,e,f*l)}})},"esri/core/libs/gl-matrix-2/mat2df64":function(){define(["require","exports",
"./factories/mat2df64"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.mat2df64=a})},"esri/core/libs/gl-matrix-2/factories/mat2df64":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[1,0,0,1,0,0]};b.clone=function(a){return[a[0],a[1],a[2],a[3],a[4],a[5]]};b.fromValues=function(a,b,h,e,f,g){return[a,b,h,e,f,g]};b.createView=function(a,b){return new Float64Array(a,b,6)}})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["require",
"exports"],function(n,b){function a(a){return a instanceof Float32Array&&2<=a.length}function m(a){return Array.isArray(a)&&2<=a.length}Object.defineProperty(b,"__esModule",{value:!0});b.isVec2f32=a;b.isVec2f64=m;b.isVec2=function(b){return a(b)||m(b)}})},"esri/views/2d/viewpointUtils":function(){define("require exports tslib ../../Viewpoint ../../core/Collection ../../core/maybe ../../core/promiseUtils ../../core/unitUtils ../../core/wgs84Constants ../../core/libs/gl-matrix-2/common ../../core/libs/gl-matrix-2/mat2d ../../core/libs/gl-matrix-2/mat2df64 ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ../../geometry/support/webMercatorUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y){function A(a,b,c,e){return e&&c&&!e.equals(c)&&q.canProject(e,c)&&e.isWebMercator?(e.isWebMercator?(c=b[1],89.99999<c?c=89.99999:-89.99999>c&&(c=-89.99999),c=Math.sin(d.common.toRadian(c)),a=p.vec2.set(a,d.common.toRadian(b[0])*O,.5*O*Math.log((1+c)/(1-c)))):(c=d.common.toDegree(b[0]/O),a=p.vec2.set(a,c-360*Math.floor((c+180)/360),d.common.toDegree(.5*Math.PI-2*Math.atan(Math.exp(-1*b[1]/O))))),a):p.vec2.copy(a,b)}function B(a){return a.wkid?a:a.spatialReference||
z.WGS84}function C(a,b){return b.type?p.vec2.set(a,b.x,b.y):p.vec2.copy(a,b)}function F(a,b){return Math.max(a.width/b[0],a.height/b[1])*R(a.spatialReference)}function H(b,c,d,g){return a.__awaiter(this,void 0,void 0,function(){var k,l,m,p,r,n,w,z,y,A,B,C,E,G,F,I,Q,L,J,P,N,M,R,ba,O,W,x,V;return a.__generator(this,function(a){switch(a.label){case 0:if(!b||Array.isArray(b)&&!b.length)return[2,null];h.isCollection(b)&&(b=b.toArray());if(!Array.isArray(b)||!b.length||"object"!==typeof b[0])return[3,7];
l=b.every(function(a){return"attributes"in a});m=b.some(function(a){return!a.geometry});p=b;if(!(l&&m&&c&&c.allLayerViews))return[3,2];r=new Map;n=0;for(w=b;n<w.length;n++)z=w[n],y=z.layer,A=r.get(y)||[],B=z.attributes[y.objectIdField],null!=B&&A.push(B),r.set(y,A);C=[];r.forEach(function(a,b){var d=c.allLayerViews.find(function(a){return a.layer.id===b.id});if("queryFeatures"in d){var e=b.createQuery();e.objectIds=a;e.returnGeometry=!0;C.push(d.queryFeatures(e))}});return[4,f.all(C)];case 1:E=a.sent();
G=[];F=0;for(I=E;F<I.length;F++)if((Q=I[F])&&Q.features&&Q.features.length)for(L=0,J=Q.features;L<J.length;L++)z=J[L],e.isSome(z.geometry)&&G.push(z.geometry);p=G;a.label=2;case 2:P=0,N=p,a.label=3;case 3:if(!(P<N.length))return[3,6];M=N[P];return[4,H(M,c,d,g)];case 4:g=a.sent(),a.label=5;case 5:return P++,[3,3];case 6:return[2,g];case 7:if(!Array.isArray(b)||2!==b.length||"number"!==typeof b[0]||"number"!==typeof b[1])return[3,8];k=new v(b);return[3,12];case 8:if(!(b instanceof u))return[3,9];k=
b;return[3,12];case 9:if(!("geometry"in b))return[3,12];if(!b.geometry)return[3,10];k=b.geometry;return[3,12];case 10:if(!b.layer)return[3,12];R=b.layer;ba=c.allLayerViews.find(function(a){return a.layer.id===R.id});if(!("queryFeatures"in ba))return[3,12];O=R.createQuery();O.objectIds=[b.attributes[R.objectIdField]];O.returnGeometry=!0;return[4,ba.queryFeatures(O)];case 11:W=a.sent(),k=e.get(W,"features",0,"geometry"),a.label=12;case 12:if(e.isNone(k))return[2,null];x="point"===k.type?new t({xmin:k.x,
ymin:k.y,xmax:k.x,ymax:k.y,spatialReference:k.spatialReference}):k.extent;if(!x)return[2,null];V=q.canProject(x,d);if(!x.spatialReference.equals(d)&&V)x=q.project(x,d);else if(!V)return[2,null];g=g?g.union(x):x.clone();return[2,g]}})})}function I(a){if(a&&(!Array.isArray(a)||"number"!==typeof a[0])&&("object"===typeof a||Array.isArray(a)&&"object"===typeof a[0])){if("layer"in a&&a.layer&&a.layer.minScale&&a.layer.maxScale){var b=a.layer;return{min:b.minScale,max:b.maxScale}}if(Array.isArray(a)&&a.length&&
a.every(function(a){return"layer"in a})){for(var c=0,d=0,e=0;e<a.length;e++)(b=a[e].layer)&&b.minScale&&b.maxScale&&(c=b.minScale<c?b.minScale:c,d=b.maxScale>d?b.maxScale:d);return c&&d?{min:c,max:d}:null}}}function G(b,c){return a.__awaiter(this,void 0,void 0,function(){var d,e,f,g,k,h,l,p,u,n,w,z,E,G,Q,L,J,P,N,M;return a.__generator(this,function(a){switch(a.label){case 0:if(!b||!c)return[2,new m({targetGeometry:new v,scale:0,rotation:0})];d=c.spatialReference;e=c.constraints;f=c.padding;g=c.viewpoint;
k=c.size;h=f?k[0]-f.left-f.right:k[0];l=f?k[1]-f.top-f.bottom:k[1];p=[h,l];u=null;b instanceof m?u=b:b.viewpoint?u=b.viewpoint:b.target&&"esri.Viewpoint"===b.target.declaredClass&&(u=b.target);n=null;if(!u||!u.targetGeometry)return[3,1];n=u.targetGeometry;return[3,10];case 1:if(!(b instanceof t))return[3,2];n=b;return[3,10];case 2:return b||b&&("center"in b||"extent"in b||"target"in b)?[4,H(b.center,c,d)]:[3,10];case 3:return(E=a.sent())?[3,5]:[4,H(b.extent,c,d)];case 4:E=a.sent(),a.label=5;case 5:return(z=
E)?[3,7]:[4,H(b.target,c,d)];case 6:z=a.sent(),a.label=7;case 7:return(w=z)?[3,9]:[4,H(b,c,d)];case 8:w=a.sent(),a.label=9;case 9:n=w,a.label=10;case 10:!n&&g&&g.targetGeometry?n=g.targetGeometry:!n&&c.extent&&(n=c.extent);G=B(n);d||(d=B(c.spatialReference||c.extent||n));if(!y.canProject(n,d)&&G&&!G.equals(d))return[2,null];Q=C(r.vec2f64.create(),n.center?n.center:n);L=new v(A(Q,Q,G,d),d);J=null;J=u&&u.targetGeometry&&"point"===u.targetGeometry.type?u.scale:b.hasOwnProperty("scale")&&b.scale?b.scale:
b.hasOwnProperty("zoom")&&-1!==b.zoom&&e&&e.effectiveLODs?e.zoomToScale(b.zoom):Array.isArray(n)||"point"===n.type||"extent"===n.type&&0===n.width&&0===n.height?c.extent&&q.canProject(c.extent,d)?F(q.project(c.extent,d),p):c.extent?F(c.extent,p):g.scale:q.canProject(n.extent,d)?F(q.project(n.extent,d),p):F(n.extent,p);if(P=I(b))P.min&&P.min>J?J=P.min:P.max&&P.max<J&&(J=P.max);N=0;u?N=u.rotation:b.hasOwnProperty("rotation")?N=b.rotation:g&&(N=g.rotation);M=new m({targetGeometry:L,scale:J,rotation:N});
e&&(M=e.fit(M),e.rotationEnabled||(M.rotation=N));return[2,M]}})})}function J(a,b){var c=a.targetGeometry,d=b.targetGeometry;c.x=d.x;c.y=d.y;c.spatialReference=d.spatialReference;a.scale=b.scale;a.rotation=b.rotation;return a}function E(a,b,c){return c?p.vec2.set(a,.5*(b[0]-c.right+c.left),.5*(b[1]-c.bottom+c.top)):p.vec2.scale(a,b,.5)}function L(a,d,e,f){b.getTransform(a,d,e,f);return c.mat2d.invert(a,a)}function M(a,b,c){var d=Q(b);b=Math.abs(Math.cos(d));d=Math.abs(Math.sin(d));return p.vec2.set(a,
Math.round(c[1]*d+c[0]*b),Math.round(c[1]*b+c[0]*d))}function N(a){var b=a.scale;a=a.targetGeometry.spatialReference;a=w.isValid(a)?1/(39.37*g.getMetersPerUnitForSR(a)*96):1;return b*a}function Q(a){return d.common.toRadian(a.rotation)||0}function R(a){return w.isValid(a)?39.37*g.getMetersPerUnitForSR(a)*96:1}function W(a){return a.isWrappable?(a=w.getInfo(a),a.valid[1]-a.valid[0]):0}Object.defineProperty(b,"__esModule",{value:!0});var O=l.wgs84Radius,U=180/Math.PI;b.extentToScale=F;b.create=G;b.copy=
J;b.getAnchor=E;b.getExtent=function(){var a=r.vec2f64.create();return function(b,c,d){var e=c.targetGeometry;C(a,e);c=.5*N(c);b.xmin=a[0]-c*d[0];b.ymin=a[1]-c*d[1];b.xmax=a[0]+c*d[0];b.ymax=a[1]+c*d[1];b.spatialReference=e.spatialReference;return b}}();b.setExtent=function(a,c,d,e,f){b.centerAt(a,c,d.center);a.scale=F(d,e);f&&f.constraints&&f.constraints.constrain(a);return a};b.getOuterExtent=function(){var a=r.vec2f64.create(),b=r.vec2f64.create();return function(c,d,e){C(a,d.targetGeometry);M(b,
d,e);e=.5*N(d);c.set({xmin:a[0]-e*b[0],ymin:a[1]-e*b[1],xmax:a[0]+e*b[0],ymax:a[1]+e*b[1],spatialReference:d.targetGeometry.spatialReference});return c}}();b.getOuterSize=M;b.getPaddingScreenTranslation=function(){var a=r.vec2f64.create();return function(b,c,d){return p.vec2.sub(b,p.vec2.scale(b,c,.5),E(a,c,d))}}();b.getPaddingMapTranslation=function(){var a=k.mat2df64.create(),d=r.vec2f64.create();return function(e,f,g,k){var h=N(f);f=Q(f);p.vec2.set(d,h,h);c.mat2d.fromScaling(a,d);c.mat2d.rotate(a,
a,f);c.mat2d.translate(a,a,b.getPaddingScreenTranslation(d,g,k));c.mat2d.translate(a,a,[0,k.top-k.bottom]);return p.vec2.set(e,a[4],a[5])}}();b.getResolution=N;b.getResolutionToScaleFactor=R;b.getMatrix=function(){var a=r.vec2f64.create(),b=r.vec2f64.create(),d=r.vec2f64.create();return function(e,f,g,k,h,l){p.vec2.negate(a,f);p.vec2.scale(b,g,.5*l);p.vec2.set(d,1/k*l,-1/k*l);c.mat2d.identity(e);c.mat2d.translate(e,e,b);h&&c.mat2d.rotate(e,e,h);c.mat2d.scale(e,e,d);c.mat2d.translate(e,e,a);return e}}();
b.getTransform=function(){var a=r.vec2f64.create();return function(c,d,e,f){var g=N(d),k=Q(d);C(a,d.targetGeometry);return b.getMatrix(c,a,e,g,k,f)}}();b.getTransformNoRotation=function(){var a=r.vec2f64.create();return function(c,d,e,f){var g=N(d);C(a,d.targetGeometry);return b.getMatrix(c,a,e,g,0,f)}}();b.getWorldWidth=W;b.getWorldScreenWidth=function(a,b){return Math.round(W(a)/b)};b.createAsync=function(a,b){return G(a,b)};b.angleBetween=function(){var a=r.vec2f64.create(),b=r.vec2f64.create(),
c=[0,0,0];return function(d,e,f){p.vec2.subtract(a,d,e);p.vec2.normalize(a,a);p.vec2.subtract(b,d,f);p.vec2.normalize(b,b);p.vec2.cross(c,a,b);d=Math.acos(p.vec2.dot(a,b)/(p.vec2.length(a)*p.vec2.length(b)))*U;0>c[2]&&(d=-d);isNaN(d)&&(d=0);return d}}();b.addPadding=function(){var a=r.vec2f64.create();return function(c,d,e,f){var g=c.targetGeometry;J(c,d);b.getPaddingMapTranslation(a,d,e,f);g.x+=a[0];g.y+=a[1];return c}}();b.removePadding=function(){var a=r.vec2f64.create();return function(c,d,e,
f){var g=c.targetGeometry;J(c,d);b.getPaddingMapTranslation(a,d,e,f);g.x-=a[0];g.y-=a[1];return c}}();b.centerAt=function(){var a=r.vec2f64.create();return function(b,c,d){J(b,c);c=b.targetGeometry;var e=B(d),f=B(c);C(a,d);A(a,a,e,f);c.x=a[0];c.y=a[1];return b}}();b.pixelSize=function(a){return N(a)};b.resize=function(){var a=r.vec2f64.create();return function(c,d,e,f,g){g||(g="center");p.vec2.sub(a,e,f);p.vec2.scale(a,a,.5);e=a[0];f=a[1];switch(g){case "center":p.vec2.set(a,0,0);break;case "left":p.vec2.set(a,
-e,0);break;case "top":p.vec2.set(a,0,f);break;case "right":p.vec2.set(a,e,0);break;case "bottom":p.vec2.set(a,0,-f);break;case "top-left":p.vec2.set(a,-e,f);break;case "bottom-left":p.vec2.set(a,-e,-f);break;case "top-right":p.vec2.set(a,e,f);break;case "bottom-right":p.vec2.set(a,e,-f)}b.translateBy(c,d,a);return c}}();b.rotateBy=function(a,b,c){J(a,b);a.rotation+=c;return a};b.rotateTo=function(a,b,c){J(a,b);a.rotation=c;return a};b.scaleBy=function(){var a=r.vec2f64.create();return function(c,
d,e,f,g){J(c,d);isNaN(e)||0===e||(b.toMap(a,f,d,g),c.scale=d.scale*e,b.toScreen(a,a,c,g),b.translateBy(c,c,p.vec2.set(a,a[0]-f[0],f[1]-a[1])));return c}}();b.scaleTo=function(a,b,c){J(a,b);a.scale=c;return a};b.scaleAndRotateBy=function(){var a=r.vec2f64.create();return function(c,d,e,f,g,k){J(c,d);isNaN(e)||0===e||(b.toMap(a,g,d,k),c.scale=d.scale*e,c.rotation+=f,b.toScreen(a,a,c,k),b.translateBy(c,c,p.vec2.set(a,a[0]-g[0],g[1]-a[1])));return c}}();b.padAndScaleAndRotateBy=function(){var a=r.vec2f64.create(),
c=r.vec2f64.create();return function(d,e,f,g,k,h,l){b.getPaddingScreenTranslation(c,h,l);p.vec2.add(a,k,c);return g?b.scaleAndRotateBy(d,e,f,g,a,h):b.scaleBy(d,e,f,a,h)}}();b.toMap=function(){var a=k.mat2df64.create();return function(b,c,d,e){return p.vec2.transformMat2d(b,c,L(a,d,e,1))}}();b.toScreen=function(){var a=k.mat2df64.create();return function(c,d,e,f){return p.vec2.transformMat2d(c,d,b.getTransform(a,e,f,1))}}();b.translateBy=function(){var a=r.vec2f64.create(),b=k.mat2df64.create();return function(d,
e,f){J(d,e);var g=N(e),k=d.targetGeometry;c.mat2d.fromRotation(b,Q(e));c.mat2d.scale(b,b,r.vec2f64.fromValues(g,g));p.vec2.transformMat2d(a,f,b);k.x+=a[0];k.y+=a[1];return d}}()})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports tslib ../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",{value:!0});e=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}a.__extends(c,b);c.prototype.initializeProgram=function(a){var b=c.shader.get().build();return new l(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),g.Default3D)};c.prototype.initializePipeline=function(){var a=2===this.configuration.mode?d.simpleBlendingParams(1,771):1===this.configuration.mode?d.simpleBlendingParams(0,770):null;return d.makePipelineState({blending:a,
colorWrite:d.defaultColorWriteParams})};c.shader=new h.ReloadableShaderModule(m,function(){return new Promise(function(a,b){n(["../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl"],a,b)})});return c}(e.ShaderTechnique);b.BlendLayersTechnique=e;e=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.mode=0;return a}a.__extends(c,b);a.__decorate([f.parameter({count:3})],c.prototype,"mode",void 0);return c}(f.ShaderTechniqueConfiguration);b.BlendLayersTechniqueConfiguration=
e})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/BlendLayers.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces","../../shaderModules/ShaderBuilder"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(){var b=new h.ShaderBuilder;b.attributes.add("position","vec2");b.attributes.add("uv0","vec2");b.vertex.uniforms.add("scale","float");b.vertex.uniforms.add("offset","vec2");b.varyings.add("uv","vec2");b.vertex.code.add(m.glsl(e||
(e=a.__makeTemplateObject(["\n    void main(void) {\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n      uv \x3d uv0 * scale + offset;\n    }\n  "],["\n    void main(void) {\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n      uv \x3d uv0 * scale + offset;\n    }\n  "]))));b.fragment.uniforms.add("tex","sampler2D");b.fragment.uniforms.add("opacity","float");b.fragment.code.add(m.glsl(f||(f=a.__makeTemplateObject(["\n    void main() {\n      vec4 color \x3d texture2D(tex, uv);\n\n      // Note: output in pre-multiplied alpha for correct alpha compositing\n      gl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\n    }\n  "],
["\n    void main() {\n      vec4 color \x3d texture2D(tex, uv);\n\n      // Note: output in pre-multiplied alpha for correct alpha compositing\n      gl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\n    }\n  "]))));return b};var e,f})},"esri/views/3d/terrain/RasterColorizerTechnique":function(){define("require exports tslib ../../../core/maybe ../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/rasterUtils ../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k){Object.defineProperty(b,"__esModule",{value:!0});f=function(b){function f(){return null!==b&&b.apply(this,arguments)||this}a.__extends(f,b);Object.defineProperty(f.prototype,"uniformLocationInfos",{get:function(){this._uniformLocationInfos||(this._uniformLocationInfos=c.getUniformLocationInfos(this._context,this.program));return this._uniformLocationInfos},enumerable:!0,configurable:!0});f.prototype.initializeProgram=function(a){var b=f.shader.get(),c=this.configuration,
b=b.build({output:c.colorizerType,applyColormap:c.applyColormap});this._context=a.rctx;return new d(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),l.Default3D)};f.prototype.initializePipeline=function(){var a=2===this.configuration.mode?k.simpleBlendingParams(1,771):1===this.configuration.mode?k.simpleBlendingParams(0,770):null;return k.makePipelineState({blending:a,colorWrite:k.defaultColorWriteParams})};f.prototype.bindPass=function(a,b){c.setUniforms(this.program,this.uniformLocationInfos,
b.basic);c.setUniforms(this.program,this.uniformLocationInfos,b.common);m.isSome(b.colormap)&&c.setUniforms(this.program,this.uniformLocationInfos,b.colormap);0===this.configuration.colorizerType&&m.isSome(b.stretch)?c.setUniforms(this.program,this.uniformLocationInfos,b.stretch):2===this.configuration.colorizerType&&m.isSome(b.hillshade)&&c.setUniforms(this.program,this.uniformLocationInfos,b.hillshade)};f.shader=new e.ReloadableShaderModule(h,function(){return new Promise(function(a,b){n(["../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl"],
a,b)})});return f}(f.ShaderTechnique);b.RasterColorizerTechnique=f;f=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.mode=2;a.colorizerType=0;a.applyColormap=!0;return a}a.__extends(c,b);a.__decorate([g.parameter({count:3})],c.prototype,"mode",void 0);a.__decorate([g.parameter({count:3})],c.prototype,"colorizerType",void 0);a.__decorate([g.parameter()],c.prototype,"applyColormap",void 0);return c}(g.ShaderTechniqueConfiguration);b.RasterColorizerTechniqueConfiguration=f})},
"esri/views/3d/webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl":function(){define("require exports tslib ./BasicGrid.glsl ./Colormap.glsl ./Common.glsl ../util/ColorConversion.glsl ../../shaderModules/interfaces ../../shaderModules/ShaderBuilder".split(" "),function(n,b,a,m,h,e,f,g,l){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var q=new l.ShaderBuilder;q.include(m.BasicGrid);q.include(e.Common);q.include(h.Colormap);0===b.output?(b=b.applyColormap,q.fragment.uniforms.add("u_bandCount",
"int"),q.fragment.uniforms.add("u_minCutOff","float",3),q.fragment.uniforms.add("u_maxCutOff","float",3),q.fragment.uniforms.add("u_factor","float",3),q.fragment.uniforms.add("u_minOutput","float"),q.fragment.uniforms.add("u_maxOutput","float"),q.fragment.uniforms.add("u_useGamma","bool"),q.fragment.uniforms.add("u_gamma","float",3),q.fragment.uniforms.add("u_gammaCorrection","float",3),q.fragment.code.add(g.glsl(c||(c=a.__makeTemplateObject(["\n      float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {\n        // clamp values\n        if (val \x3e\x3d maxCutOff) {\n          return maxOutput;\n        } else if (val \x3c\x3d minCutOff) {\n          return minOutput;\n        }\n\n        // stretch a single value based on whether to use gamma\n        float stretchedVal;\n        if (useGamma) {\n          float tempf \x3d 1.0;\n          float outRange \x3d maxOutput - minOutput;\n          float relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\n          if (gamma \x3e 1.0) {\n            tempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n          }\n          stretchedVal \x3d (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;\n        } else {\n          stretchedVal \x3d minOutput + (val - minCutOff) * factor;\n        }\n        return stretchedVal;\n      }\n    "],
["\n      float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {\n        // clamp values\n        if (val \x3e\x3d maxCutOff) {\n          return maxOutput;\n        } else if (val \x3c\x3d minCutOff) {\n          return minOutput;\n        }\n\n        // stretch a single value based on whether to use gamma\n        float stretchedVal;\n        if (useGamma) {\n          float tempf \x3d 1.0;\n          float outRange \x3d maxOutput - minOutput;\n          float relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\n          if (gamma \x3e 1.0) {\n            tempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n          }\n          stretchedVal \x3d (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;\n        } else {\n          stretchedVal \x3d minOutput + (val - minCutOff) * factor;\n        }\n        return stretchedVal;\n      }\n    "])))),
b=b?g.glsl(k||(k=a.__makeTemplateObject(["gl_FragColor \x3d colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma);"],["gl_FragColor \x3d colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma);"]))):g.glsl(p||(p=a.__makeTemplateObject(["gl_FragColor \x3d vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;"],["gl_FragColor \x3d vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;"]))),q.fragment.code.add(g.glsl(r||(r=a.__makeTemplateObject(["\n      void main() {\n        vec2 pixelLocation \x3d getPixelLocation(v_texcoord);\n        if (isOutside(pixelLocation)) {\n          gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n          return;\n        }\n\n        vec4 currentPixel \x3d getPixel(pixelLocation);\n        if (currentPixel.a \x3d\x3d 0.0) {\n          gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n          return;\n        }\n\n        if (u_bandCount \x3d\x3d 1) {\n          float grayVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n          ",
"\n        } else {\n          float redVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n          float greenVal \x3d stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);\n          float blueVal \x3d stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);\n          gl_FragColor \x3d vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;\n        }\n      }\n    "],
["\n      void main() {\n        vec2 pixelLocation \x3d getPixelLocation(v_texcoord);\n        if (isOutside(pixelLocation)) {\n          gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n          return;\n        }\n\n        vec4 currentPixel \x3d getPixel(pixelLocation);\n        if (currentPixel.a \x3d\x3d 0.0) {\n          gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n          return;\n        }\n\n        if (u_bandCount \x3d\x3d 1) {\n          float grayVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n          ",
"\n        } else {\n          float redVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n          float greenVal \x3d stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);\n          float blueVal \x3d stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);\n          gl_FragColor \x3d vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;\n        }\n      }\n    "])),
b))):1===b.output?q.fragment.code.add(g.glsl(d||(d=a.__makeTemplateObject(["\n      void main() {\n        // get pixel location\n        vec2 pixelLocation \x3d getPixelLocation(v_texcoord);\n        if (isOutside(pixelLocation)) {\n          gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n          return;\n        }\n\n        vec4 currentPixel \x3d getPixel(pixelLocation);\n        // apply colormap we use float texture here\n        gl_FragColor \x3d colormap(currentPixel, true);\n      }\n    "],
["\n      void main() {\n        // get pixel location\n        vec2 pixelLocation \x3d getPixelLocation(v_texcoord);\n        if (isOutside(pixelLocation)) {\n          gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n          return;\n        }\n\n        vec4 currentPixel \x3d getPixel(pixelLocation);\n        // apply colormap we use float texture here\n        gl_FragColor \x3d colormap(currentPixel, true);\n      }\n    "])))):2===b.output&&(b=b.applyColormap,q.fragment.uniforms.add("u_hillshadeType",
"int"),q.fragment.uniforms.add("u_sinZcosAs","float",6),q.fragment.uniforms.add("u_sinZsinAs","float",6),q.fragment.uniforms.add("u_cosZs","float",6),q.fragment.uniforms.add("u_weights","float",6),q.fragment.uniforms.add("u_factor","vec2"),q.fragment.uniforms.add("u_applyColormap","bool"),q.fragment.uniforms.add("u_minValue","float"),q.fragment.uniforms.add("u_maxValue","float"),q.fragment.uniforms.add("u_srcImageSize","vec2"),q.include(f.ColorConversion,{stages:1}),q.fragment.code.add(g.glsl(t||
(t=a.__makeTemplateObject(["\n  vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {\n    val \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\n    vec4 rgb \x3d colormap(vec4(val, val, val, 1.0), false);\n    vec3 hsv \x3d rgb2hsv(rgb.xyz);\n    hsv.z \x3d hillshade;\n    return vec4(hsv2rgb(hsv) * alpha, alpha);\n  }\n"],["\n  vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {\n    val \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\n    vec4 rgb \x3d colormap(vec4(val, val, val, 1.0), false);\n    vec3 hsv \x3d rgb2hsv(rgb.xyz);\n    hsv.z \x3d hillshade;\n    return vec4(hsv2rgb(hsv) * alpha, alpha);\n  }\n"])))),
q.fragment.code.add(g.glsl(u||(u=a.__makeTemplateObject(["\n    float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\n      if (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\n        return 0.0;\n      }  else {\n        return e;\n      }\n    }\n  "],["\n    float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\n      if (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\n        return 0.0;\n      }  else {\n        return e;\n      }\n    }\n  "])))),
b=b?g.glsl(v||(v=a.__makeTemplateObject(["gl_FragColor \x3d overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);"],["gl_FragColor \x3d overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);"]))):g.glsl(z||(z=a.__makeTemplateObject(["\n       hillshade *\x3d alpha;\n       gl_FragColor \x3d vec4(hillshade, hillshade, hillshade, alpha);\n       "],["\n       hillshade *\x3d alpha;\n       gl_FragColor \x3d vec4(hillshade, hillshade, hillshade, alpha);\n       "]))),q.fragment.code.add(g.glsl(w||
(w=a.__makeTemplateObject(["\n    void main() {\n      vec2 pixelLocation \x3d getPixelLocation(v_texcoord);\n      if (isOutside(pixelLocation)) {\n        gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n        return;\n      }\n\n      vec4 currentPixel \x3d getPixel(pixelLocation);\n      if (currentPixel.a \x3d\x3d 0.0) {\n        gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n        return;\n      }\n\n      //mirror edge pixels\n      vec2 axy \x3d vec2(-1.0, -1.0);\n      vec2 bxy \x3d vec2(0.0, -1.0);\n      vec2 cxy \x3d vec2(1.0, -1.0);\n      vec2 dxy \x3d vec2(-1.0, 0.0);\n      vec2 fxy \x3d vec2(1.0, 0.0);\n      vec2 gxy \x3d vec2(-1.0, 1.0);\n      vec2 hxy \x3d vec2(0.0, 1.0);\n      vec2 ixy \x3d vec2(1.0, 1.0);\n      vec2 onePixel \x3d 1.0 / u_srcImageSize;\n      if (pixelLocation.s \x3c onePixel.s) {\n        axy[0] \x3d 1.0;\n        dxy[0] \x3d 1.0;\n        gxy[0] \x3d 1.0;\n      }\n      if (pixelLocation.t \x3c onePixel.t) {\n        axy[1] \x3d 1.0;\n        bxy[1] \x3d 1.0;\n        cxy[1] \x3d 1.0;\n      }\n      if (pixelLocation.s \x3e 1.0 - onePixel.s) {\n        cxy[0] \x3d -1.0;\n        fxy[0] \x3d -1.0;\n        ixy[0] \x3d -1.0;\n      }\n      if (pixelLocation.t \x3e 1.0 - onePixel.t) {\n        gxy[1] \x3d -1.0;\n        hxy[1] \x3d -1.0;\n        ixy[1] \x3d -1.0;\n      }\n\n      // calculate hillshade\n      vec4 va \x3d texture2D(u_image, pixelLocation + onePixel * axy);\n      vec4 vb \x3d texture2D(u_image, pixelLocation + onePixel * bxy);\n      vec4 vc \x3d texture2D(u_image, pixelLocation + onePixel * cxy);\n      vec4 vd \x3d texture2D(u_image, pixelLocation + onePixel * dxy);\n      vec4 ve \x3d texture2D(u_image, pixelLocation);\n      vec4 vf \x3d texture2D(u_image, pixelLocation + onePixel * fxy);\n      vec4 vg \x3d texture2D(u_image, pixelLocation + onePixel * gxy);\n      vec4 vh \x3d texture2D(u_image, pixelLocation + onePixel * hxy);\n      vec4 vi \x3d texture2D(u_image, pixelLocation + onePixel * ixy);\n\n      // calculate the rate of z change along the x, y, and diagonal direction\n      float dzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;\n      float dzy \x3d (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;\n      float dzd \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\n      float hillshade \x3d 0.0;\n\n      // traditional single light source\n      if (u_hillshadeType \x3d\x3d 0){\n        float cosDelta \x3d u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;\n        float z \x3d (u_cosZs[0] + cosDelta) / dzd;\n        if (z \x3c 0.0)  z \x3d 0.0;\n        hillshade \x3d z;\n      } else {\n        // multi-directional with 6 light sources\n        for (int k \x3d 0; k \x3c 6; k++) {\n        float cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\n        float z \x3d (u_cosZs[k] + cosDelta) / dzd;\n        if (z \x3c 0.0) z \x3d 0.0;\n        hillshade \x3d hillshade + z * u_weights[k];\n        if (k \x3d\x3d 5) break;\n        }\n      }\n\n      // set color\n      float alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\n      alpha *\x3d u_opacity;\n      ",
"\n    }\n  "],["\n    void main() {\n      vec2 pixelLocation \x3d getPixelLocation(v_texcoord);\n      if (isOutside(pixelLocation)) {\n        gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n        return;\n      }\n\n      vec4 currentPixel \x3d getPixel(pixelLocation);\n      if (currentPixel.a \x3d\x3d 0.0) {\n        gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n        return;\n      }\n\n      //mirror edge pixels\n      vec2 axy \x3d vec2(-1.0, -1.0);\n      vec2 bxy \x3d vec2(0.0, -1.0);\n      vec2 cxy \x3d vec2(1.0, -1.0);\n      vec2 dxy \x3d vec2(-1.0, 0.0);\n      vec2 fxy \x3d vec2(1.0, 0.0);\n      vec2 gxy \x3d vec2(-1.0, 1.0);\n      vec2 hxy \x3d vec2(0.0, 1.0);\n      vec2 ixy \x3d vec2(1.0, 1.0);\n      vec2 onePixel \x3d 1.0 / u_srcImageSize;\n      if (pixelLocation.s \x3c onePixel.s) {\n        axy[0] \x3d 1.0;\n        dxy[0] \x3d 1.0;\n        gxy[0] \x3d 1.0;\n      }\n      if (pixelLocation.t \x3c onePixel.t) {\n        axy[1] \x3d 1.0;\n        bxy[1] \x3d 1.0;\n        cxy[1] \x3d 1.0;\n      }\n      if (pixelLocation.s \x3e 1.0 - onePixel.s) {\n        cxy[0] \x3d -1.0;\n        fxy[0] \x3d -1.0;\n        ixy[0] \x3d -1.0;\n      }\n      if (pixelLocation.t \x3e 1.0 - onePixel.t) {\n        gxy[1] \x3d -1.0;\n        hxy[1] \x3d -1.0;\n        ixy[1] \x3d -1.0;\n      }\n\n      // calculate hillshade\n      vec4 va \x3d texture2D(u_image, pixelLocation + onePixel * axy);\n      vec4 vb \x3d texture2D(u_image, pixelLocation + onePixel * bxy);\n      vec4 vc \x3d texture2D(u_image, pixelLocation + onePixel * cxy);\n      vec4 vd \x3d texture2D(u_image, pixelLocation + onePixel * dxy);\n      vec4 ve \x3d texture2D(u_image, pixelLocation);\n      vec4 vf \x3d texture2D(u_image, pixelLocation + onePixel * fxy);\n      vec4 vg \x3d texture2D(u_image, pixelLocation + onePixel * gxy);\n      vec4 vh \x3d texture2D(u_image, pixelLocation + onePixel * hxy);\n      vec4 vi \x3d texture2D(u_image, pixelLocation + onePixel * ixy);\n\n      // calculate the rate of z change along the x, y, and diagonal direction\n      float dzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;\n      float dzy \x3d (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;\n      float dzd \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\n      float hillshade \x3d 0.0;\n\n      // traditional single light source\n      if (u_hillshadeType \x3d\x3d 0){\n        float cosDelta \x3d u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;\n        float z \x3d (u_cosZs[0] + cosDelta) / dzd;\n        if (z \x3c 0.0)  z \x3d 0.0;\n        hillshade \x3d z;\n      } else {\n        // multi-directional with 6 light sources\n        for (int k \x3d 0; k \x3c 6; k++) {\n        float cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\n        float z \x3d (u_cosZs[k] + cosDelta) / dzd;\n        if (z \x3c 0.0) z \x3d 0.0;\n        hillshade \x3d hillshade + z * u_weights[k];\n        if (k \x3d\x3d 5) break;\n        }\n      }\n\n      // set color\n      float alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\n      alpha *\x3d u_opacity;\n      ",
"\n    }\n  "])),b)));return q};var d,c,k,p,r,t,u,v,z,w})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/BasicGrid.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.BasicGrid=function(b){b.attributes.add("position","vec2");b.attributes.add("uv0","vec2");b.vertex.uniforms.add("u_scale","float");b.vertex.uniforms.add("u_offset","vec2");b.varyings.add("v_texcoord","vec2");b.vertex.code.add(m.glsl(h||
(h=a.__makeTemplateObject(["\n    void main(void) {\n      v_texcoord \x3d uv0 * u_scale + u_offset;\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n    }\n  "],["\n    void main(void) {\n      v_texcoord \x3d uv0 * u_scale + u_offset;\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n    }\n  "]))))};var h})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,
"__esModule",{value:!0});b.Colormap=function(b){b.fragment.uniforms.add("u_colormap","sampler2D");b.fragment.uniforms.add("u_colormapOffset","float");b.fragment.uniforms.add("u_colormapMaxIndex","float");b.fragment.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n    vec4 colormap(vec4 currentPixel, bool isFloat) {\n      // colormap is only applicable to integer data but could be already normalized to 0-1 float\n      float clrIndex \x3d isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;\n      vec4 result;\n      // handle no data and out of range pixels\n      if (currentPixel.a \x3d\x3d 0.0 || clrIndex \x3e u_colormapMaxIndex) {\n        result \x3d vec4(0.0, 0.0, 0.0, 0.0);\n      } else {\n        // colormap lookup\n        vec2 clrPosition \x3d vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);\n        vec4 color \x3d texture2D(u_colormap, clrPosition);\n        result \x3d vec4(color.rgb, 1.0) * color.a * u_opacity;\n      }\n      return result;\n    }\n  "],
["\n    vec4 colormap(vec4 currentPixel, bool isFloat) {\n      // colormap is only applicable to integer data but could be already normalized to 0-1 float\n      float clrIndex \x3d isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;\n      vec4 result;\n      // handle no data and out of range pixels\n      if (currentPixel.a \x3d\x3d 0.0 || clrIndex \x3e u_colormapMaxIndex) {\n        result \x3d vec4(0.0, 0.0, 0.0, 0.0);\n      } else {\n        // colormap lookup\n        vec2 clrPosition \x3d vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);\n        vec4 color \x3d texture2D(u_colormap, clrPosition);\n        result \x3d vec4(color.rgb, 1.0) * color.a * u_opacity;\n      }\n      return result;\n    }\n  "]))))};
var h})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl":function(){define(["require","exports","tslib","./Projection.glsl","../../shaderModules/interfaces"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.Common=function(b){b.include(m.Projection);b.fragment.uniforms.add("u_image","sampler2D");b.fragment.uniforms.add("u_isFloatTexture","bool");b.fragment.uniforms.add("u_flipY","bool");b.fragment.uniforms.add("u_applyTransform","bool");b.fragment.uniforms.add("u_opacity",
"float");b.fragment.code.add(h.glsl(e||(e=a.__makeTemplateObject(["\n    vec2 getPixelLocation(vec2 coords) {\n      vec2 targetLocation \x3d u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n      if (!u_applyTransform) {\n        return targetLocation;\n      }\n      return projectPixelLocation(targetLocation);\n    }\n\n    bool isOutside(vec2 coords){\n      if (coords.t\x3e1.00001 ||coords.t\x3c-0.00001 || coords.s\x3e1.00001 ||coords.s\x3c-0.00001) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n\n    vec4 getPixel(vec2 pixelLocation) {\n      return texture2D(u_image, pixelLocation);\n    }\n  "],
["\n    vec2 getPixelLocation(vec2 coords) {\n      vec2 targetLocation \x3d u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n      if (!u_applyTransform) {\n        return targetLocation;\n      }\n      return projectPixelLocation(targetLocation);\n    }\n\n    bool isOutside(vec2 coords){\n      if (coords.t\x3e1.00001 ||coords.t\x3c-0.00001 || coords.s\x3e1.00001 ||coords.s\x3c-0.00001) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n\n    vec4 getPixel(vec2 pixelLocation) {\n      return texture2D(u_image, pixelLocation);\n    }\n  "]))))};
var e})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Projection.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.Projection=function(b){b.fragment.uniforms.add("u_transformGrid","sampler2D");b.fragment.uniforms.add("u_transformSpacing","vec2");b.fragment.uniforms.add("u_transformGridSize","vec2");b.fragment.uniforms.add("u_targetImageSize","vec2");b.fragment.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n    vec2 projectPixelLocation(vec2 coords) {\n      // pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]\n      vec2 index_image \x3d floor(coords * u_targetImageSize);\n\n      // pixel's corresponding cell index in transform grid\n      // each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle\n      vec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\n      vec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\n\n      // correspoding position in transform grid cell, cell center coordinates\n      vec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\n      vec2 srcLocation;\n      // pixel's corresponding transform cell location, center cell coordinates\n      vec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\n\n      // use lower triangle or upper triangle\n      if (pos.s \x3c\x3d pos.t) {\n        vec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\n        vec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\n        srcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\n        srcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n      } else {\n        vec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\n        vec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\n        srcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\n        srcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n      }\n      return srcLocation;;\n    }\n  "],
["\n    vec2 projectPixelLocation(vec2 coords) {\n      // pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]\n      vec2 index_image \x3d floor(coords * u_targetImageSize);\n\n      // pixel's corresponding cell index in transform grid\n      // each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle\n      vec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\n      vec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\n\n      // correspoding position in transform grid cell, cell center coordinates\n      vec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\n      vec2 srcLocation;\n      // pixel's corresponding transform cell location, center cell coordinates\n      vec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\n\n      // use lower triangle or upper triangle\n      if (pos.s \x3c\x3d pos.t) {\n        vec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\n        vec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\n        srcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\n        srcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n      } else {\n        vec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\n        vec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\n        srcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\n        srcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n      }\n      return srcLocation;;\n    }\n  "]))))};
var h})},"esri/views/3d/terrain/support/FBOPool":function(){define(["require","exports","../../../../core/ObjectPool","../../../webgl/FramebufferObject"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this.renderingContext=a;this._pools=new Map}b.prototype.acquire=function(a){return this.getPool(a).acquire()};b.prototype.release=function(a){this.getPool(a.width).release(a)};b.prototype.clear=function(){this._pools.forEach(function(a){a.destroy()});this._pools.clear()};
b.prototype.getPool=function(b){var e=this._pools.get(b);e||(e=m.bind(m,this.renderingContext,{colorTarget:0,depthStencilTarget:1,width:b,height:b}),e=new a(e),this._pools.set(b,e));return e};return b}();b.FBOPool=n})},"esri/views/3d/webgl-engine/lib/tracer":function(){define(["require","exports","./webgl-debug","../../../webgl/capabilities/isWebGL2Context"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});var h=null,e=[];b.enabled=!1;b.setEnabled=function(a){b.enabled=a};b.begin=
function(){b.enabled&&(h=[])};b.trace=function(a){b.enabled&&null!=h&&h.push(a)};b.end=function(){if(b.enabled){var a=h;h=null;a&&(e.forEach(function(b){return b(a)}),e.length=0);return a}return null};b.instrumentContext=function(e){return b.enabled?m.default(e)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),e):a.makeDebugContext(e,void 0,function(e,f){b.enabled&&h&&h.push("gl."+e+"("+a.glFunctionArgsToString(e,f)+")")}):e};b.request=function(a){e.push(a)}})},"esri/views/3d/webgl-engine/lib/webgl-debug":function(){define([],
function(){function n(a){if(null==l){l={};d={};for(var b in a)"number"==typeof a[b]&&(l[a[b]]=b,d[b]=a[b])}}function b(){if(null==l)throw"WebGLDebugUtils.init(ctx) not called";}function a(a){b();var c=l[a];return void 0!==c?"gl."+c:"/*UNKNOWN WebGL ENUM*/ 0x"+a.toString(16)+""}function m(b,e,f,h){b=g[b];if(void 0!==b&&(b=b[e],void 0!==b&&b[f])){if("object"===typeof b[f]&&void 0!==b[f].enumBitwiseOr){e=b[f].enumBitwiseOr;f=0;b=[];for(var c=0;c<e.length;++c){var k=d[e[c]];0!==(h&k)&&(f|=k,b.push(a(k)))}return f===
h?b.join(" | "):a(h)}return a(h)}return null===h?"null":void 0===h?"undefined":h.toString()}function h(a,b,d){a.__defineGetter__(d,function(){return b[d]});a.__defineSetter__(d,function(a){b[d]=a})}function e(b,d,f,g){function c(a,b){return function(){f&&f(b,arguments);var c=a[b].apply(a,arguments),e=g.getError();0!=e&&(k[e]=!0,d(e,b,arguments));return c}}g=g||b;n(b);d=d||function(b,c,d){for(var e="",f=d.length,g=0;g<f;++g)e+=(0==g?"":", ")+m(c,f,g,d[g]);b="WebGL error "+a(b)+" in "+c+"("+e+")";window.console&&
window.console.error?window.console.error(b):window.console&&window.console.log&&window.console.log(b)};var k={},l={},p;for(p in b)if("function"==typeof b[p])if("getExtension"!=p)l[p]=c(b,p);else{var r=c(b,p);l[p]=function(){var a=r.apply(b,arguments);return e(a,d,f,g)}}else h(l,b,p);l.getError=function(){for(var a in k)if(k.hasOwnProperty(a)&&k[a])return k[a]=!1,a;return b.NO_ERROR};return l}function f(a){var b=a.getParameter(a.MAX_VERTEX_ATTRIBS),c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c);
for(var d=0;d<b;++d)a.disableVertexAttribArray(d),a.vertexAttribPointer(d,4,a.FLOAT,!1,0,0),a.vertexAttrib1f(d,0);a.deleteBuffer(c);b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(d=0;d<b;++d)a.activeTexture(a.TEXTURE0+d),a.bindTexture(a.TEXTURE_CUBE_MAP,null),a.bindTexture(a.TEXTURE_2D,null);a.activeTexture(a.TEXTURE0);a.useProgram(null);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.disable(a.BLEND);
a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);a.blendColor(0,0,0,0);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.ONE,a.ZERO);a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(-1);a.colorMask(!0,!0,!0,!0);a.cullFace(a.BACK);a.depthFunc(a.LESS);a.depthMask(!0);a.depthRange(0,1);a.frontFace(a.CCW);a.hint(a.GENERATE_MIPMAP_HINT,a.DONT_CARE);a.lineWidth(1);a.pixelStorei(a.PACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,
!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);a.UNPACK_COLORSPACE_CONVERSION_WEBGL&&a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL);a.polygonOffset(0,0);a.sampleCoverage(1,!1);a.scissor(0,0,a.canvas.width,a.canvas.height);a.stencilFunc(a.ALWAYS,0,4294967295);a.stencilMask(4294967295);a.stencilOp(a.KEEP,a.KEEP,a.KEEP);a.viewport(0,0,a.canvas.width,a.canvas.height);for(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);a.getError(););}var g={enable:{1:{0:!0}},
disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,
6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,
1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,
2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},l=null,d=null;return{init:n,mightBeEnum:function(a){b();return void 0!==l[a]},glEnumToString:a,glFunctionArgToString:m,glFunctionArgsToString:function(a,b){for(var c="",d=b.length,e=0;e<d;++e)c+=(0==e?"":", ")+m(a,d,e,b[e]);return c},makeDebugContext:e,makeLostContextSimulatingCanvas:function(a){function b(a){return"function"==
typeof a?a:function(b){a.handleEvent(b)}}function c(){for(var a=Object.keys(J),b=0;b<a.length;++b)delete J[a]}function d(){++H;B||F==H&&a.loseContext()}function e(a,b){var c=a[b];return function(){d();if(!B)return c.apply(a,arguments)}}function g(a){return{statusMessage:a,preventDefault:function(){I=!0}}}function l(a){for(var b in a)"function"==typeof a[b]?n[b]=e(a,b):h(n,a,b);n.getError=function(){d();if(!B)for(var a;a=m.getError();)J[a]=!0;for(a in J)if(J[a])return delete J[a],a;return n.NO_ERROR};
var c="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");for(b=0;b<c.length;++b){var f=c[b];n[f]=function(b){return function(){d();if(B)return null;var c=b.apply(a,arguments);c.__webglDebugContextLostId__=A;C.push(c);return c}}(a[f])}c="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");
for(b=0;b<c.length;++b)f=c[b],n[f]=function(b){return function(){d();return B?null:b.apply(a,arguments)}}(n[f]);c="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(b=0;b<c.length;++b)f=c[b],n[f]=function(b){return function(){d();return B?!1:b.apply(a,arguments)}}(n[f]);n.checkFramebufferStatus=function(b){return function(){d();return B?n.FRAMEBUFFER_UNSUPPORTED:b.apply(a,arguments)}}(n.checkFramebufferStatus);n.getAttribLocation=function(b){return function(){d();
return B?-1:b.apply(a,arguments)}}(n.getAttribLocation);n.getVertexAttribOffset=function(b){return function(){d();return B?0:b.apply(a,arguments)}}(n.getVertexAttribOffset);n.isContextLost=function(){return B};return n}var m,n,q=[],y=[];n={};var A=1,B=!1,C=[],F=0,H=0,I=!1,G=0,J={};a.getContext=function(b){return function(){var c=b.apply(a,arguments);if(c instanceof WebGLRenderingContext){if(c!=m){if(m)throw"got different context";m=c;n=l(m)}return n}return c}}(a.getContext);(function(a){var c=a.addEventListener;
a.addEventListener=function(d,e,f){switch(d){case "webglcontextlost":q.push(b(e));break;case "webglcontextrestored":y.push(b(e));break;default:c.apply(a,arguments)}}})(a);a.loseContext=function(){if(!B){B=!0;F=0;for(++A;m.getError(););c();J[m.CONTEXT_LOST_WEBGL]=!0;var b=g("context lost"),d=q.slice();setTimeout(function(){for(var c=0;c<d.length;++c)d[c](b);0<=G&&setTimeout(function(){a.restoreContext()},G)},0)}};a.restoreContext=function(){B&&y.length&&setTimeout(function(){if(!I)throw"can not restore. webglcontestlost listener did not call event.preventDefault";
for(var a=0;a<C.length;++a){var b=C[a];b instanceof WebGLBuffer?m.deleteBuffer(b):b instanceof WebGLFramebuffer?m.deleteFramebuffer(b):b instanceof WebGLProgram?m.deleteProgram(b):b instanceof WebGLRenderbuffer?m.deleteRenderbuffer(b):b instanceof WebGLShader?m.deleteShader(b):b instanceof WebGLTexture&&m.deleteTexture(b)}f(m);B=!1;H=0;I=!1;for(var a=y.slice(),b=g("context restored"),c=0;c<a.length;++c)a[c](b)},0)};a.loseContextInNCalls=function(a){if(B)throw"You can not ask a lost contet to be lost";
F=H+a};a.getNumCalls=function(){return H};a.setRestoreTimeout=function(a){G=a};return a},resetToInitialState:f}})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports tslib ../core/shaderLibrary/terrain/Terrain.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/StencilUtils ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c){Object.defineProperty(b,"__esModule",{value:!0});e=function(b){function e(){return null!==b&&b.apply(this,arguments)||this}a.__extends(e,b);e.prototype.initializeProgram=function(a){var b=e.shader.get(),c=this.configuration,b=b.build({overlayMode:c.overlayMode,output:c.output,viewingMode:a.viewingMode,slicePlaneEnabled:c.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,textureFadingEnabled:c.textureFadingEnabled&&!c.renderOccluded,receiveShadows:c.receiveShadows&&
!c.renderOccluded,receiveAmbientOcclusion:!1,useOldSceneLightInterface:!0,atmosphere:c.atmosphere,tileBorders:c.tileBorders,screenSizePerspective:c.screenSizePerspective,pbrMode:0,ssrEnabled:c.ssrEnabled,highStepCount:!1});return new d(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),g.Default3D)};e.prototype.initializePipeline=function(){var a=this.configuration,b=a.backfaceCullingEnabled&&!a.renderOccluded;return c.makePipelineState({blending:a.renderOccluded?c.simpleBlendingParams(1,
771):null,culling:b&&c.backFaceCullingParams,depthTest:!a.renderOccluded&&{func:513},depthWrite:!a.renderOccluded&&c.defaultDepthWriteParams,colorWrite:c.defaultColorWriteParams,stencilTest:a.stencilEnabled?l.renderWhenBitIsNotSet(1):null})};e.shader=new h.ReloadableShaderModule(m,function(){return new Promise(function(a,b){n(["../core/shaderLibrary/terrain/Terrain.glsl"],a,b)})});return e}(e.ShaderTechnique);b.TerrainTechnique=e;e=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||
this;a.output=0;a.overlayMode=0;a.atmosphere=!1;a.receiveShadows=!1;a.slicePlaneEnabled=!1;a.backfaceCullingEnabled=!1;a.stencilEnabled=!1;a.textureFadingEnabled=!1;a.renderOccluded=!1;a.ssrEnabled=!1;a.tileBorders=!1;a.screenSizePerspective=!1;return a}a.__extends(c,b);a.__decorate([f.parameter({count:7})],c.prototype,"output",void 0);a.__decorate([f.parameter({count:3})],c.prototype,"overlayMode",void 0);a.__decorate([f.parameter()],c.prototype,"atmosphere",void 0);a.__decorate([f.parameter()],
c.prototype,"receiveShadows",void 0);a.__decorate([f.parameter()],c.prototype,"slicePlaneEnabled",void 0);a.__decorate([f.parameter()],c.prototype,"backfaceCullingEnabled",void 0);a.__decorate([f.parameter()],c.prototype,"stencilEnabled",void 0);a.__decorate([f.parameter()],c.prototype,"textureFadingEnabled",void 0);a.__decorate([f.parameter()],c.prototype,"renderOccluded",void 0);a.__decorate([f.parameter()],c.prototype,"ssrEnabled",void 0);a.__decorate([f.parameter()],c.prototype,"tileBorders",
void 0);a.__decorate([f.parameter()],c.prototype,"screenSizePerspective",void 0);return c}(f.ShaderTechniqueConfiguration);b.TerrainTechniqueConfiguration=e})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Terrain.glsl":function(){define("require exports tslib ../Slice.glsl ../Transform.glsl ../attributes/VertexTangent.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/EvaluateSceneLighting.glsl ../shading/NormalUtils.glsl ./Overlay.glsl ./Skirts.glsl ./TerrainTexture.glsl ../util/HeaderComment.glsl ../util/RgbaFloatEncoding.glsl ../../shaderModules/interfaces ../../shaderModules/ShaderBuilder".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var n=new v.ShaderBuilder;n.include(r.HeaderComment,{name:"Terrain Shader",output:b.output});n.include(k.Skirts);n.attributes.add("position","vec3");n.attributes.add("uv0","vec2");n.vertex.uniforms.add("proj","mat4").add("view","mat4").add("origin","vec3").add("skirtScale","float");if(0===b.output){n.include(h.Transform,{linearDepth:!1});n.include(d.NormalUtils,b);n.include(p.TerrainTexture,
b);var Y=0!==b.overlayMode,da=2===b.overlayMode;Y&&n.include(c.Overlay,{pbrMode:3,useCustomDTRExponentForWater:!1,ssrEnabled:b.ssrEnabled,highStepCount:b.highStepCount});da&&n.include(e.VertexTangent,b);n.varyings.add("vnormal","vec3");n.varyings.add("vpos","vec3");n.vertex.uniforms.add("viewNormal","mat4");b.receiveShadows&&n.varyings.add("linearDepth","float");b.tileBorders&&n.varyings.add("vuv","vec2");b.atmosphere&&(n.vertex.uniforms.add("lightingMainDirection","vec3"),n.varyings.add("wnormal",
"vec3"),n.varyings.add("wlight","vec3"));b.screenSizePerspective&&(n.vertex.uniforms.add("screenSizePerspective","vec4"),n.varyings.add("screenSizeDistanceToCamera","float"),n.varyings.add("screenSizeCosAngle","float"));n.vertex.code.add(u.glsl(F||(F=a.__makeTemplateObject(["\n      void main(void) {\n        vpos \x3d position;\n        vnormal \x3d getLocalUp(vpos, origin);\n\n        vec2 uv \x3d uv0;\n        vpos \x3d applySkirts(uv, vpos, vnormal, skirtScale);\n        ","\n        ","\n        ",
"\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        ","\n        forwardTextureCoordinates(uv);\n        ","\n        ","\n      }\n    "],["\n      void main(void) {\n        vpos \x3d position;\n        vnormal \x3d getLocalUp(vpos, origin);\n\n        vec2 uv \x3d uv0;\n        vpos \x3d applySkirts(uv, vpos, vnormal, skirtScale);\n        ","\n        ","\n        ","\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        ","\n        forwardTextureCoordinates(uv);\n        ",
"\n        ","\n      }\n    "])),b.atmosphere?u.glsl(z||(z=a.__makeTemplateObject(["\n        wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\n        wlight \x3d (view  * vec4(-lightingMainDirection, 1.0)).xyz;"],["\n        wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\n        wlight \x3d (view  * vec4(-lightingMainDirection, 1.0)).xyz;"]))):"",b.tileBorders?u.glsl(w||(w=a.__makeTemplateObject(["vuv \x3d uv;"],["vuv \x3d uv;"]))):"",b.screenSizePerspective?
u.glsl(q||(q=a.__makeTemplateObject(["\n        vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\n        screenSizeDistanceToCamera \x3d length(viewPos);\n        vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\n        screenSizeCosAngle \x3d abs(viewSpaceNormal.z);"],["\n        vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\n        screenSizeDistanceToCamera \x3d length(viewPos);\n        vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\n        screenSizeCosAngle \x3d abs(viewSpaceNormal.z);"]))):
"",b.receiveShadows?u.glsl(y||(y=a.__makeTemplateObject(["linearDepth \x3d gl_Position.w;"],["linearDepth \x3d gl_Position.w;"]))):"",Y?u.glsl(A||(A=a.__makeTemplateObject(["setOverlayVTC(uv);"],["setOverlayVTC(uv);"]))):"",da?u.glsl(B||(B=a.__makeTemplateObject(["forwardVertexTangent(vnormal);"],["forwardVertexTangent(vnormal);"]))):u.glsl(C||(C=a.__makeTemplateObject([""],[""])))));n.extensions.add("GL_OES_standard_derivatives");n.extensions.add("GL_EXT_shader_texture_lod");n.include(m.Slice,b);
n.include(l.EvaluateSceneLighting,b);n.fragment.uniforms.add("camPos","vec3").add("viewDirection","vec3").add("ssaoTex","sampler2D").add("viewportPixelSz","vec4").add("opacity","float");b.screenSizePerspective&&n.fragment.uniforms.add("screenSizePerspective","vec4");da&&(n.fragment.uniforms.add("ovInnerWaterTex","sampler2D"),n.fragment.uniforms.add("ovOuterWaterTex","sampler2D"),n.fragment.uniforms.add("view","mat4"));n.fragment.code.add(u.glsl(H||(H=a.__makeTemplateObject(["\n      const vec3 ambient \x3d vec3(0.2, 0.2, 0.2);\n      const vec3 diffuse \x3d vec3(0.8, 0.8, 0.8);\n      const float diffuseHardness \x3d 2.5;\n      const float sliceOpacity \x3d 0.2;\n\n      float lum(vec3 c) {\n        float max \x3d max(max(c.r, c.g), c.b);\n        float min \x3d min(min(c.r, c.g), c.b);\n        return (min + max) * 0.5;\n      }\n      "],
["\n      const vec3 ambient \x3d vec3(0.2, 0.2, 0.2);\n      const vec3 diffuse \x3d vec3(0.8, 0.8, 0.8);\n      const float diffuseHardness \x3d 2.5;\n      const float sliceOpacity \x3d 0.2;\n\n      float lum(vec3 c) {\n        float max \x3d max(max(c.r, c.g), c.b);\n        float min \x3d min(min(c.r, c.g), c.b);\n        return (min + max) * 0.5;\n      }\n      "]))));b.atmosphere&&n.fragment.code.add(u.glsl(I||(I=a.__makeTemplateObject(["\n      vec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\n        vec3 surfaceColor   \x3d vec3(0.0);\n        vec3 fuzzySpecColor \x3d vec3(1.0);\n        vec3 subColor       \x3d vec3(0.0);\n        float rollOff       \x3d 1.0;\n\n        vec3 Ln \x3d normalize(lightPos);\n        vec3 Nn \x3d normalize(normal);\n        vec3 Hn \x3d normalize(view + Ln);\n\n        float ldn \x3d dot(Ln, Nn);\n        float diffComp \x3d max(0.0, ldn);\n        // clamp necessary here because values might cause flickering: #21549\n        float vdn \x3d clamp(1.0 - dot(view, Nn), 0.0, 1.0);\n        float ndv \x3d dot(view, Ln);\n\n        vec3 diffContrib \x3d surfaceColor * diffComp;\n        float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\n\n        vec3 subContrib \x3d subLamb * subColor;\n        vec3 vecColor \x3d vec3(vdn);\n\n        vec3 diffuseContrib \x3d (subContrib + diffContrib);\n        vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\n\n        return (diffContrib + specularContrib) * rollOff;\n      }\n      "],
["\n      vec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\n        vec3 surfaceColor   \x3d vec3(0.0);\n        vec3 fuzzySpecColor \x3d vec3(1.0);\n        vec3 subColor       \x3d vec3(0.0);\n        float rollOff       \x3d 1.0;\n\n        vec3 Ln \x3d normalize(lightPos);\n        vec3 Nn \x3d normalize(normal);\n        vec3 Hn \x3d normalize(view + Ln);\n\n        float ldn \x3d dot(Ln, Nn);\n        float diffComp \x3d max(0.0, ldn);\n        // clamp necessary here because values might cause flickering: #21549\n        float vdn \x3d clamp(1.0 - dot(view, Nn), 0.0, 1.0);\n        float ndv \x3d dot(view, Ln);\n\n        vec3 diffContrib \x3d surfaceColor * diffComp;\n        float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\n\n        vec3 subContrib \x3d subLamb * subColor;\n        vec3 vecColor \x3d vec3(vdn);\n\n        vec3 diffuseContrib \x3d (subContrib + diffContrib);\n        vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\n\n        return (diffContrib + specularContrib) * rollOff;\n      }\n      "]))));
n.fragment.code.add(u.glsl(R||(R=a.__makeTemplateObject(["\n      void main() {\n        ","\n        float vndl \x3d dot(normalize(vnormal), -lightingMainDirection);\n        float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\n        vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\n\n        float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        vec4 tileColor \x3d getTileColor() * opacity;\n        ",
"\n        if (rejectBySlice(vpos)) {\n          tileColor *\x3d sliceOpacity;\n        }\n        vec3 atm \x3d vec3(0.0);\n        ","\n        vec3 albedo \x3d atm + tileColor.rgb;\n        vec3 normal \x3d normalize(vnormal);\n\n        // heuristic shading function used in the old terrain, now used to add ambient lighting\n        float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n\n        gl_FragColor \x3d vec4(evaluateSceneLightingExt(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\n        ",
"\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "],["\n      void main() {\n        ","\n        float vndl \x3d dot(normalize(vnormal), -lightingMainDirection);\n        float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\n        vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\n\n        float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        vec4 tileColor \x3d getTileColor() * opacity;\n        ",
"\n        if (rejectBySlice(vpos)) {\n          tileColor *\x3d sliceOpacity;\n        }\n        vec3 atm \x3d vec3(0.0);\n        ","\n        vec3 albedo \x3d atm + tileColor.rgb;\n        vec3 normal \x3d normalize(vnormal);\n\n        // heuristic shading function used in the old terrain, now used to add ambient lighting\n        float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n\n        gl_FragColor \x3d vec4(evaluateSceneLightingExt(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\n        ",
"\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "])),b.receiveShadows?u.glsl(G||(G=a.__makeTemplateObject(["float shadow \x3d readShadowMap(vpos, linearDepth);"],["float shadow \x3d readShadowMap(vpos, linearDepth);"]))):u.glsl(J||(J=a.__makeTemplateObject(["float shadow \x3d 0.0;"],["float shadow \x3d 0.0;"]))),Y?u.glsl(E||(E=a.__makeTemplateObject(["\n            vec4 overlayColorOpaque \x3d getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n            vec4 overlayColor \x3d overlayOpacity * overlayColorOpaque;\n            vec4 groundColor \x3d tileColor;\n            tileColor \x3d tileColor * (1.0 - overlayColor.a) + overlayColor;"],
["\n            vec4 overlayColorOpaque \x3d getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n            vec4 overlayColor \x3d overlayOpacity * overlayColorOpaque;\n            vec4 groundColor \x3d tileColor;\n            tileColor \x3d tileColor * (1.0 - overlayColor.a) + overlayColor;"]))):"",b.atmosphere?u.glsl(L||(L=a.__makeTemplateObject(["\n            float ndotl \x3d max(0.0, min(1.0, vndl));\n            atm \x3d atmosphere(wlight, wnormal, -viewDirection);\n            atm *\x3d max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps\n            atm *\x3d max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\n            atm *\x3d tileColor.a; // premultiply with tile alpha"],
["\n            float ndotl \x3d max(0.0, min(1.0, vndl));\n            atm \x3d atmosphere(wlight, wnormal, -viewDirection);\n            atm *\x3d max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps\n            atm *\x3d max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\n            atm *\x3d tileColor.a; // premultiply with tile alpha"]))):"",da?u.glsl(M||(M=a.__makeTemplateObject(["\n            vec4 overlayWaterMask \x3d getOverlayColor(ovInnerWaterTex, ovOuterWaterTex, vtcOverlay);\n            float waterNormalLength \x3d length(overlayWaterMask);\n            if (waterNormalLength \x3e 0.95) {\n              mat3 tbnMatrix \x3d mat3(tbnTangent, tbnBiTangent, vnormal);\n              vec4 waterOverlayColor \x3d vec4(overlayColor.w \x3e 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);\n              vec4 viewPosition \x3d view*vec4(vpos, 1.0);\n              vec4 waterColorLinear \x3d getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - camPos), shadow, vnormal, tbnMatrix, viewPosition.xyz);\n              vec4 waterColorNonLinear \x3d delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));\n              // un-gamma the ground color to mix in linear space\n              gl_FragColor \x3d mix(groundColor, waterColorNonLinear, waterColorLinear.w);\n            }"],
["\n            vec4 overlayWaterMask \x3d getOverlayColor(ovInnerWaterTex, ovOuterWaterTex, vtcOverlay);\n            float waterNormalLength \x3d length(overlayWaterMask);\n            if (waterNormalLength \x3e 0.95) {\n              mat3 tbnMatrix \x3d mat3(tbnTangent, tbnBiTangent, vnormal);\n              vec4 waterOverlayColor \x3d vec4(overlayColor.w \x3e 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);\n              vec4 viewPosition \x3d view*vec4(vpos, 1.0);\n              vec4 waterColorLinear \x3d getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - camPos), shadow, vnormal, tbnMatrix, viewPosition.xyz);\n              vec4 waterColorNonLinear \x3d delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));\n              // un-gamma the ground color to mix in linear space\n              gl_FragColor \x3d mix(groundColor, waterColorNonLinear, waterColorLinear.w);\n            }"]))):
"",b.screenSizePerspective?u.glsl(N||(N=a.__makeTemplateObject(["\n          float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\n          if (perspectiveScale \x3c\x3d 0.25) {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);\n          }\n          else if (perspectiveScale \x3c\x3d 0.5) {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);\n          }\n          else if (perspectiveScale \x3e\x3d 0.99) {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);\n          }\n          else {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);\n          }"],
["\n          float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\n          if (perspectiveScale \x3c\x3d 0.25) {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);\n          }\n          else if (perspectiveScale \x3c\x3d 0.5) {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);\n          }\n          else if (perspectiveScale \x3e\x3d 0.99) {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);\n          }\n          else {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);\n          }"]))):
"",b.tileBorders?u.glsl(Q||(Q=a.__makeTemplateObject(["\n            vec2 dVuv \x3d fwidth(vuv);\n            vec2 edgeFactors \x3d smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));\n            float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\n            gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);"],["\n            vec2 dVuv \x3d fwidth(vuv);\n            vec2 edgeFactors \x3d smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));\n            float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\n            gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);"]))):
""))}if(1===b.output||3===b.output)n.include(h.Transform,{linearDepth:!0}),n.include(t.RgbaFloatEncoding),n.include(f.OutputDepth,{output:b.output}),n.include(d.NormalUtils,b),n.varyings.add("linearDepth","float"),n.vertex.uniforms.add("nearFar","vec2"),n.vertex.code.add(u.glsl(W||(W=a.__makeTemplateObject(["\n        void main(void) {\n          vec3 normal \x3d getLocalUp(position, origin);\n          vec2 uv \x3d uv0;\n          vec3 vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\n\n          gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);\n        }\n    "],
["\n        void main(void) {\n          vec3 normal \x3d getLocalUp(position, origin);\n          vec2 uv \x3d uv0;\n          vec3 vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\n\n          gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);\n        }\n    "])))),n.fragment.code.add(u.glsl(O||(O=a.__makeTemplateObject(["\n        void main() {\n          outputDepth(linearDepth);\n        }\n    "],["\n        void main() {\n          outputDepth(linearDepth);\n        }\n    "]))));
2===b.output&&(n.include(h.Transform,{linearDepth:!1}),n.include(d.NormalUtils,b),n.varyings.add("vnormal","vec3"),n.varyings.add("vpos","vec3"),n.vertex.uniforms.add("viewNormal","mat4"),n.vertex.code.add(u.glsl(U||(U=a.__makeTemplateObject(["\n        void main(void) {\n          vec3 normal \x3d getLocalUp(position, origin);\n          vec2 uv \x3d uv0;\n          vpos \x3d applySkirts(uv, position, normal, skirtScale);\n\n          gl_Position \x3d transformPosition(proj, view, vpos);\n          vnormal \x3d normalize((viewNormal * vec4(normal, 1.0)).xyz);\n        }\n    "],
["\n        void main(void) {\n          vec3 normal \x3d getLocalUp(position, origin);\n          vec2 uv \x3d uv0;\n          vpos \x3d applySkirts(uv, position, normal, skirtScale);\n\n          gl_Position \x3d transformPosition(proj, view, vpos);\n          vnormal \x3d normalize((viewNormal * vec4(normal, 1.0)).xyz);\n        }\n    "])))),n.fragment.code.add(u.glsl(P||(P=a.__makeTemplateObject(["\n        void main() {\n          vec3 normal \x3d normalize(vnormal);\n          if (gl_FrontFacing \x3d\x3d false) {\n            normal \x3d -normal;\n          }\n          gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 0.0);\n        }\n    "],
["\n        void main() {\n          vec3 normal \x3d normalize(vnormal);\n          if (gl_FrontFacing \x3d\x3d false) {\n            normal \x3d -normal;\n          }\n          gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 0.0);\n        }\n    "])))));4===b.output&&(n.include(h.Transform,{linearDepth:!1}),n.include(d.NormalUtils,b),n.include(c.Overlay,{pbrMode:0}),n.vertex.code.add(u.glsl(ba||(ba=a.__makeTemplateObject(["\n          void main() {\n            vec3 vnormal \x3d getLocalUp(position, origin);\n            vec2 uv \x3d uv0;\n            vec3 vpos \x3d applySkirts(uv, position, vnormal, skirtScale);\n            setOverlayVTC(uv);\n\n            gl_Position \x3d transformPosition(proj, view, vpos);\n          }\n      "],
["\n          void main() {\n            vec3 vnormal \x3d getLocalUp(position, origin);\n            vec2 uv \x3d uv0;\n            vec3 vpos \x3d applySkirts(uv, position, vnormal, skirtScale);\n            setOverlayVTC(uv);\n\n            gl_Position \x3d transformPosition(proj, view, vpos);\n          }\n      "])))),n.include(g.OutputHighlight),n.fragment.code.add(u.glsl(V||(V=a.__makeTemplateObject(["\n        void main() {\n          vec4 overlayColor \x3d getCombinedOverlayColor();\n\n          if (overlayColor.a \x3d\x3d 0.0) {\n            gl_FragColor \x3d vec4(0.0);\n            return;\n          }\n\n          outputHighlight();\n        }\n      "],
["\n        void main() {\n          vec4 overlayColor \x3d getCombinedOverlayColor();\n\n          if (overlayColor.a \x3d\x3d 0.0) {\n            gl_FragColor \x3d vec4(0.0);\n            return;\n          }\n\n          outputHighlight();\n        }\n      "])))));return n};var z,w,q,y,A,B,C,F,H,I,G,J,E,L,M,N,Q,R,W,O,U,P,ba,V})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,
b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.VertexTangent=function(b,l){b.varyings.add("tbnTangent","vec3");b.varyings.add("tbnBiTangent","vec3");0===l.viewingMode?b.vertex.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n      void forwardVertexTangent(vec3 n) {\n        tbnTangent \x3d normalize(cross(vec3(0.0, 0.0, 1.0), n));\n        tbnBiTangent \x3d normalize(cross(n, tbnTangent));\n      }\n    "],["\n      void forwardVertexTangent(vec3 n) {\n        tbnTangent \x3d normalize(cross(vec3(0.0, 0.0, 1.0), n));\n        tbnBiTangent \x3d normalize(cross(n, tbnTangent));\n      }\n    "])))):
b.vertex.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n      void forwardVertexTangent(vec3 n) {\n        tbnTangent \x3d vec3(1.0, 0.0, 0.0);\n        tbnBiTangent \x3d normalize(cross(n, tbnTangent));\n      }\n    "],["\n      void forwardVertexTangent(vec3 n) {\n        tbnTangent \x3d vec3(1.0, 0.0, 0.0);\n        tbnBiTangent \x3d normalize(cross(n, tbnTangent));\n      }\n    "]))));b.fragment.code.add(m.glsl(f||(f=a.__makeTemplateObject(["\n      mat3 getTBNMatrix(vec3 n) {\n        return mat3(tbnTangent, tbnBiTangent, n);\n      }\n    "],
["\n      mat3 getTBNMatrix(vec3 n) {\n        return mat3(tbnTangent, tbnBiTangent, n);\n      }\n    "]))))};var h,e,f})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl":function(){define("require exports tslib ../shading/EvaluateMainLighting.glsl ../shading/Water.glsl ../../shaderModules/interfaces".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});b.Overlay=function(b,k){3!==k.pbrMode&&4!==k.pbrMode||b.include(h.Water,k);b.vertex.uniforms.add("overlayTexOffset",
"vec4");b.vertex.uniforms.add("overlayTexScale","vec4");b.varyings.add("vtcOverlay","vec4");b.vertex.code.add(e.glsl(f||(f=a.__makeTemplateObject(["\n    void setOverlayVTC(in vec2 uv) {\n      vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n    }\n  "],["\n    void setOverlayVTC(in vec2 uv) {\n      vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n    }\n  "]))));b.fragment.uniforms.add("ovInnerColorTex","sampler2D");b.fragment.uniforms.add("ovOuterColorTex",
"sampler2D");b.fragment.uniforms.add("overlayOpacity","float");b.fragment.code.add(e.glsl(g||(g=a.__makeTemplateObject(["\n    vec4 getOverlayColor(sampler2D ov0Tex, sampler2D ov1Tex, vec4 texCoords) {\n      vec4 color \x3d vec4(0.0);\n\n      // read textures outside of conditions, to avoid artifacts likely related to non-uniform flow control:\n      // - https://www.khronos.org/opengl/wiki/Sampler_(GLSL)#Non-uniform_flow_control\n      // - https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13657\n      vec4 color0 \x3d texture2D(ov0Tex, texCoords.xy);\n      vec4 color1 \x3d texture2D(ov1Tex, texCoords.zw);\n\n      if ((texCoords.x \x3e\x3d 0.0) \x26\x26 (texCoords.x \x3c\x3d 1.0) \x26\x26 (texCoords.y \x3e\x3d 0.0) \x26\x26 (texCoords.y \x3c\x3d 1.0)) {\n        color \x3d color0;\n      } else if ((texCoords.z \x3e\x3d 0.0) \x26\x26 (texCoords.z \x3c\x3d 1.0) \x26\x26 (texCoords.w \x3e\x3d 0.0) \x26\x26 (texCoords.w \x3c\x3d 1.0)) {\n        color \x3d color1;\n      }\n\n      return color;\n    }\n  "],
["\n    vec4 getOverlayColor(sampler2D ov0Tex, sampler2D ov1Tex, vec4 texCoords) {\n      vec4 color \x3d vec4(0.0);\n\n      // read textures outside of conditions, to avoid artifacts likely related to non-uniform flow control:\n      // - https://www.khronos.org/opengl/wiki/Sampler_(GLSL)#Non-uniform_flow_control\n      // - https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13657\n      vec4 color0 \x3d texture2D(ov0Tex, texCoords.xy);\n      vec4 color1 \x3d texture2D(ov1Tex, texCoords.zw);\n\n      if ((texCoords.x \x3e\x3d 0.0) \x26\x26 (texCoords.x \x3c\x3d 1.0) \x26\x26 (texCoords.y \x3e\x3d 0.0) \x26\x26 (texCoords.y \x3c\x3d 1.0)) {\n        color \x3d color0;\n      } else if ((texCoords.z \x3e\x3d 0.0) \x26\x26 (texCoords.z \x3c\x3d 1.0) \x26\x26 (texCoords.w \x3e\x3d 0.0) \x26\x26 (texCoords.w \x3c\x3d 1.0)) {\n        color \x3d color1;\n      }\n\n      return color;\n    }\n  "]))));
b.fragment.code.add(e.glsl(l||(l=a.__makeTemplateObject(["\n    vec4 getCombinedOverlayColor() {\n      return overlayOpacity * getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n    }\n  "],["\n    vec4 getCombinedOverlayColor() {\n      return overlayOpacity * getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n    }\n  "]))));if(3===k.pbrMode||4===k.pbrMode)b.include(m.EvaluateMainLighting),b.fragment.code.add(e.glsl(d||(d=a.__makeTemplateObject(["\n    vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,\n       float shadow, vec3 localUp, mat3 tbn, vec3 position) {\n\n      // reproject normal from 0...1 \x3d\x3e -1...1\n      // and project it to worldspace.\n      vec3 n \x3d normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));\n      vec3 v \x3d vposEyeDir;\n      vec3 l \x3d normalize(-lightingMainDirection);\n      vec3 final \x3d getSeaColor(n, v, l, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position);\n\n      // the terrain renderer assumes a premultiplied color output without gamma.\n      return vec4(final, colorInput.w);\n    }\n    "],
["\n    vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,\n       float shadow, vec3 localUp, mat3 tbn, vec3 position) {\n\n      // reproject normal from 0...1 \x3d\x3e -1...1\n      // and project it to worldspace.\n      vec3 n \x3d normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));\n      vec3 v \x3d vposEyeDir;\n      vec3 l \x3d normalize(-lightingMainDirection);\n      vec3 final \x3d getSeaColor(n, v, l, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position);\n\n      // the terrain renderer assumes a premultiplied color output without gamma.\n      return vec4(final, colorInput.w);\n    }\n    "]))))};
var f,g,l,d})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Skirts.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.Skirts=function(b){b.vertex.code.add(m.glsl(h||(h=a.__makeTemplateObject(['\n    vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {\n      float skirtLength \x3d 0.0;\n\n      if (uv.x \x3e\x3d 2.0) {\n        skirtLength \x3d uv.y * skirtScale;\n        // decode original uv-coordinates (see "encodeSkirtPos")\n        vec2 x \x3d vec2(uv.x) - vec2(3.5, 4.5);\n        uv \x3d clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\n      }\n\n      return vpos - vnormal * skirtLength;\n    }\n    '],
['\n    vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {\n      float skirtLength \x3d 0.0;\n\n      if (uv.x \x3e\x3d 2.0) {\n        skirtLength \x3d uv.y * skirtScale;\n        // decode original uv-coordinates (see "encodeSkirtPos")\n        vec2 x \x3d vec2(uv.x) - vec2(3.5, 4.5);\n        uv \x3d clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\n      }\n\n      return vpos - vnormal * skirtLength;\n    }\n    ']))))};var h})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl":function(){define(["require",
"exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.TerrainTexture=function(b,k){b.varyings.add("vtc","vec2");b.vertex.uniforms.add("texOffsetAndScale","vec4");b.fragment.uniforms.add("tex","sampler2D");k.textureFadingEnabled&&(b.vertex.uniforms.add("nextTexOffsetAndScale","vec4"),b.varyings.add("nvtc","vec2"),b.fragment.uniforms.add("texNext","sampler2D"),b.fragment.uniforms.add("textureFadeFactor","float"));b.vertex.code.add(m.glsl(f||
(f=a.__makeTemplateObject(["\n  void forwardTextureCoordinates(in vec2 uv) {\n    vtc \x3d uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\n    ","\n  }\n  "],["\n  void forwardTextureCoordinates(in vec2 uv) {\n    vtc \x3d uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\n    ","\n  }\n  "])),k.textureFadingEnabled?m.glsl(h||(h=a.__makeTemplateObject(["nvtc \x3d uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;"],["nvtc \x3d uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;"]))):
m.glsl(e||(e=a.__makeTemplateObject([""],[""])))));b.fragment.code.add(m.glsl(d||(d=a.__makeTemplateObject(["\n  vec4 getTileColor() {\n    ","\n  }\n  "],["\n  vec4 getTileColor() {\n    ","\n  }\n  "])),k.textureFadingEnabled?m.glsl(g||(g=a.__makeTemplateObject(["return textureFadeFactor \x3c 1.0 ? mix(texture2D(texNext, nvtc), texture2D(tex, vtc), textureFadeFactor) : texture2D(tex, vtc);"],["return textureFadeFactor \x3c 1.0 ? mix(texture2D(texNext, nvtc), texture2D(tex, vtc), textureFadeFactor) : texture2D(tex, vtc);"]))):
m.glsl(l||(l=a.__makeTemplateObject(["return texture2D(tex, vtc);"],["return texture2D(tex, vtc);"])))))};var h,e,f,g,l,d})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec2f64"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this.offset=a.vec2f64.create();this.scale=0;this.tile=null}b.prototype.init=function(a,b,f,g){this.tile=a;this.offset[0]=b;this.offset[1]=f;this.scale=g};b.prototype.dispose=
function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};return b}();b.UpsampleInfo=n})},"esri/views/3d/webgl-engine/Stage":function(){define("require exports tslib ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ./lib/AutoDisposable ./lib/GeometryRecord ./lighting/Lightsources ./parts/Model ./parts/RenderView".split(" "),function(n,b,a,m,h,e,f,g,l,d,c,k,p){function r(a){return"function"===
typeof a.addParentStage&&"function"===typeof a.removeParentStage}Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function m(){var a=null!==b&&b.apply(this,arguments)||this;a.model=new k.Model;a._viewContent=[];a._mainLightDirection=g.vec3f64.fromValues(0,1,0);return a}a.__extends(m,b);t=m;m.prototype.initialize=function(){this._set("renderView",new p.RenderView(this.container,this,this.options));this.setLighting({lights:[new c.MainLight(g.vec3f64.fromValues(.7,.7,.7)),new c.AmbientLight(g.vec3f64.fromValues(.3,
.3,.3))],groundLightingFactor:.5,globalFactor:.5})};m.prototype.destroy=function(){d.pool.prune(0);this.dispose()};Object.defineProperty(m.prototype,"dirty",{get:function(){return this.model.getDirtySet().hasDirtyGeometryRecords()},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"mainLightDirection",{get:function(){return this._mainLightDirection},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"lighting",{get:function(){return this._lighting},enumerable:!0,configurable:!0});
m.prototype.setLighting=function(a){f.vec3.set(this._mainLightDirection,0,0,0);for(var b=0,d=a.lights;b<d.length;b++){var e=d[b];if(e instanceof c.MainLight){f.vec3.negate(this._mainLightDirection,e.direction);break}}this._lighting=a;this.renderView.setNeedsRender()};m.prototype.stopAnimationsAtTime=function(a){this.getAll(3).forEach(function(b){h.applySome(b.animation,function(b){return b.stopAtTime(a)})});this.renderView.setNeedsRender()};m.prototype.add=function(a,b){this.model.add(a,b);r(b)&&
b.addParentStage(this);this.renderView.setNeedsRender()};m.prototype.remove=function(a,b){this.renderView.setNeedsRender();a=this.model.remove(a,b);r(a)&&a.removeParentStage(this);return a};m.prototype.notifyDirty=function(a,b,c){this.model.notifyDirty(a,b,c);this.renderView.setNeedsRender()};m.prototype.processDirty=function(){var a=this.model.getDirtySet();if(a.hasDirtyGeometryRecords()){t.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo());var b=a.commitLayers(this._viewContent);
0<b[0].length+b[1].length+b[2].length&&this.renderView.modify(b[0],b[1],b[2]);t.DebugSettings.logDirtySet&&(console.log("RGs add: "+b[0].map(function(a){return a.uniqueName})),console.log("RGs remove: "+b[1].map(function(a){return a.uniqueName})));a.commit();this.renderView.setNeedsRender()}};m.prototype.processDirtyLayer=function(a){a=this.model.getDirtySet().commitLayers([a]);0<a[0].length+a[1].length+a[2].length&&this.renderView.modify(a[0],a[1],a[2]);this.renderView.setNeedsRender()};m.prototype.getContent=
function(a,b){return this.model.get(a,b)};m.prototype.getAll=function(a){return this.model.getAll(a)};m.prototype.getCount=function(a){return this.model.getAll(a).size};m.prototype.getCamera=function(){return this.renderView.getCamera()};m.prototype.setCamera=function(a){this.renderView.setCamera(a)};m.prototype.getLayers=function(){return this.model.getAll(0)};m.prototype.getViewContent=function(){return this._viewContent.slice(0)};m.prototype.addToViewContent=function(a){for(var b=[],c=0;c<a.length;c++)-1===
this._viewContent.indexOf(a[c])&&b.push(a[c]);0<a.length&&(this.processDirty(),a=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(b),this.renderView.modify(a,[],[]),this._viewContent.push.apply(this._viewContent,b))};m.prototype.removeFromViewContent=function(a){this.processDirty();for(var b=this.model.getDirtySet(),c=this._viewContent,d=[],e=0;e<a.length;e++){var f=c.indexOf(a[e]);-1<f&&(c[f]=c[c.length-1],c.pop(),d.push(a[e]))}a=b.getResidentRenderGeometriesFilteredByLayers(d);
this.renderView.modify([],a,[])};m.prototype.addRenderPlugin=function(a,b){"intersect"in b&&this.sceneIntersectionHelper.addIntersectionHandler(b);this.renderView.renderPlugins.add(a,b)};m.prototype.removeRenderPlugin=function(a){"intersect"in a&&this.sceneIntersectionHelper.removeIntersectionHandler(a);this.renderView.renderPlugins.remove(a)};m.prototype.getCombinedStats=function(){return{renderView:this.renderView.getCombinedStats(),model:this.model.getStats()}};var t;m.DebugSettings={endFrameContentValidation:!1,
logDirtySet:!1};a.__decorate([e.property({constructOnly:!0})],m.prototype,"options",void 0);a.__decorate([e.property({constructOnly:!0})],m.prototype,"sceneIntersectionHelper",void 0);a.__decorate([e.property({constructOnly:!0})],m.prototype,"viewingMode",void 0);a.__decorate([e.property({constructOnly:!0})],m.prototype,"container",void 0);a.__decorate([l.autoDispose(),e.property()],m.prototype,"renderView",void 0);return m=t=a.__decorate([e.subclass("esri.views.3d.webgl-engine.Stage")],m)}(l.AutoDisposableMixin(m));
b.Stage=n})},"esri/views/3d/webgl-engine/parts/Model":function(){define("require exports ../../support/mathUtils ../lib/localOrigin ../lib/ModelContentType ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util".split(" "),function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});var l=g.assert,d=g.logWithBase;n=function(){function b(){var a=this;this.dirtySet=new e(this);this._id2origin={};this._content=new Map;h.allModelContentTypes.forEach(function(b){return a._content.set(b,new Map)})}
b.prototype.getAll=function(a){a=this._content.get(a);l(void 0!==a);return a};b.prototype.get=function(a,b){return this.getAll(a).get(b)};b.prototype.add=function(a,b){var c=this._content.get(a);l(void 0!==c);var d=b.id;l(!c.has(d),"Model/Stage already contains object to be added");c.set(d,b);0===a&&this.notifyDirty(b,"layerAdded")};b.prototype.remove=function(a,b){var c=this._content.get(a);l(void 0!==c);var d=c.get(b);l(void 0!==d,"Model/Stage doesn't contain object to be removed");c.delete(b);
4===a&&d.unload();0===a&&this.notifyDirty(d,"layerRemoved");return d};b.prototype.getDirtySet=function(){return this.dirtySet};b.prototype.notifyDirty=function(a,b,c){this.dirtySet.handleUpdate(a,b,c)};b.prototype.getOrigin=function(a,b,c){void 0===c&&(c=10);var e=0;b=b*c/1E4;1<b&&(e=Math.ceil(d(b,2)));b=1E4*Math.pow(2,e);c=Math.round(a[0]/b);var f=Math.round(a[1]/b);a=Math.round(a[2]/b);var e=e+"_"+c+"_"+f+"_"+a,g=this._id2origin[e];null==g&&(g=m.fromValues(c*b,f*b,a*b,e),this._id2origin[e]=g);return g};
b.prototype.getGeometryRenderGeometries=function(b,c,d){var e=c.geometry,g=b.getCombinedStaticTransformation(c),k=a.maxScale(g),h=c.origin;b=new f(e.data,e.boundingInfo,c.material,g,c.shaderTransformation,k,b.castShadow);b.uniqueName=c.id;b.origin=h||this.getOrigin(b.center,b.bsRadius);b.instanceParameters=c.instanceParameters;d.push(b)};b.prototype.updateRenderGeometryTransformation=function(a,b,c){a=a.getCombinedStaticTransformation(b,c.transformation);c.updateTransformation(a);a=this.getOrigin(c.center,
c.bsRadius);return c.origin!==a};b.prototype.getStats=function(){var a=this;return{contentTypes:h.allModelContentTypes.reduce(function(b,c){b[c]=a.getAll(c).size;return b},{}),dirtySet:this.dirtySet.formatDebugInfo()}};b.prototype.validateObject=function(a){a=a.geometryRecords;for(var b=0;b<a.length;++b){var c=a[b];l(null!=this.get(2,c.geometry.id));l(null!=this.get(3,c.material.id))}};b.prototype.validateLayer=function(a){a=a.getObjects();for(var b=0;b<a.length;++b){var c=this.get(1,a[b].id);l(null!=
c)}};return b}();b.Model=n})},"esri/views/3d/webgl-engine/lib/ModelContentType":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.allModelContentTypes=[0,1,2,3,4];b.modelContentTypes={LAYER:0,OBJECT:1,GEOMETRY:2,MATERIAL:3,TEXTURE:4}})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define(["require","exports","../../../../core/arrayUtils","../../../../core/MapUtils","./Util"],function(n,b,a,m,h){return function(){function b(a){this._residentGeomRecords=
new Map;this._dirtyGeomRecords=new Map;this._model=a}Object.defineProperty(b.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"residentObjectCount",{get:function(){var a=0;this._residentGeomRecords.forEach(function(b){a+=b.size});return a},enumerable:!0,configurable:!0});b.prototype.hasDirtyGeometryRecords=function(){return m.someMap(this._dirtyGeomRecords,function(a){return m.someMap(a,function(a){return a&&
0<a.size})})};b.prototype.handleUpdate=function(a,b,e){h.assert(this[b],"ModelDirtySet doesn't know how to process "+b);return this[b](a,e)};b.prototype.shaderTransformationChanged=function(a){var b=this;(a=this._residentGeomRecords.get(a.id))&&a.forEach(function(a,d){(d=b._model.get(1,d))&&d.hasVolativeTransformation()&&a.forEach(function(a){var b=0;for(a=a[1];b<a.length;b++)a[b].shaderTransformationChanged()})})};b.prototype.commit=function(){return this.commitLayers(a.keysOfMap(this._dirtyGeomRecords))};
b.prototype.commitLayers=function(a){for(var b=this,e=[],d=[],c=[],f=function(f){var g=a[f];f=m._dirtyGeomRecords.get(g);if(!f)return"continue";f.forEach(function(a,f){var k=b._ensureGeomRecord(g,f);a.forEach(function(a,g){var l=a[0],m=a[1];a=a[2];var p=!1;if(m&2){var q=k.get(g);if(q){q=q[1];if(a&4)for(var r=b._model.get(1,f),t=0;t<q.length;t++){var n=q[t];if(b._model.updateRenderGeometryTransformation(r,l,n)){p=!0;break}}if(!p)for(r=0;r<q.length;r++)n=q[r],c.push({renderGeometry:n,updateType:a})}else h.assert(!1,
"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(m&4||p)(q=k.get(g))?d.push.apply(d,q[1]):4===m&&h.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove"),q&&k.delete(g);if(m&1||p)m=[l,[]],r=b._model.get(1,f),b._model.getGeometryRenderGeometries(r,l,m[1]),e.push.apply(e,m[1]),k.set(g,m)});0===k.size&&b._residentGeomRecords.get(g).delete(f)});0===m._residentGeomRecords.get(g).size&&m._residentGeomRecords.delete(g);m._dirtyGeomRecords.delete(g)},m=this,r=0;r<
a.length;r++)f(r);return[e,d,c]};b.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(a.keysOfMap(this._residentGeomRecords))};b.prototype.getResidentRenderGeometriesFilteredByLayers=function(a){for(var b=[],e=0;e<a.length;e++){var d=this._residentGeomRecords.get(a[e]);d&&d.forEach(function(a){a.forEach(function(a){b.push.apply(b,a[1])})})}return b};b.prototype._objectStateChanged=function(a,b,e,d){if(null!=e)this._componentPropertyChanged(b,e,
d,a);else{e=0;for(var c=b.geometryRecords;e<c.length;e++)this._componentPropertyChanged(b,c[e],d,a)}};b.prototype.visibilityChanged=function(a,b,e){this._objectStateChanged(1,a,b,e)};b.prototype.highlightChanged=function(a,b,e){this._objectStateChanged(8,a,b,e)};b.prototype.occlusionChanged=function(a,b,e){this._objectStateChanged(16,a,b,e)};b.prototype.vertexAttrsUpdated=function(a,b,e){this._updateOrCreateDirtyRecord(a,b,e,2,0,0,2,5,2)};b.prototype.layerAdded=function(a){for(var b=a.getObjects(),
e=0;e<b.length;e++)this.layerObjectAdded(a,b[e])};b.prototype.layerRemoved=function(a){for(var b=a.getObjects(),e=0;e<b.length;e++)this.layerObjectRemoved(a,b[e])};b.prototype.layerObjectAdded=function(a,b){a=a.id;for(var e=b.geometryRecords,d=0;d<e.length;d++)this.objGeometryAdded(b,e[d],a)};b.prototype.layerObjectRemoved=function(a,b){a=a.id;for(var e=b.geometryRecords,d=0;d<e.length;d++)this.objGeometryRemoved(b,e[d],a)};b.prototype.layObjectReplaced=function(a,b){this.layerObjectRemoved(a,b[0]);
this.layerObjectAdded(a,b[1])};b.prototype.objTransformation=function(a,b){var e=this;b=b||this._getParentLayerId(a);this._ensureGeomRecord(b,a.id).forEach(function(d){e._updateOrCreateDirtyRecord(a,d[0],b,2,0,0,2,5,4)})};b.prototype.objGeometryAdded=function(a,b,e){this._updateOrCreateDirtyRecord(a,b,e,1,4,0,0,0)};b.prototype.objGeometryRemoved=function(a,b,e){this._updateOrCreateDirtyRecord(a,b,e,4,1,2,0,0)};b.prototype.objGeometryReplaced=function(a,b){this.objGeometryRemoved(a,b[0]);this.objGeometryAdded(a,
b[1])};b.prototype.objGeometryTransformation=function(a,b){this.objGeometryReplaced(a,b)};b.prototype._componentPropertyChanged=function(a,b,e,d){this._updateOrCreateDirtyRecord(a,b,e,2,0,0,2,5,d)};b.prototype._updateOrCreateDirtyRecord=function(a,b,e,d,c,k,m,r,t){e=e||this._getParentLayerId(a);var f=b.id;a=this._ensureDirtyRecord(e,a.id);(e=a.get(f))?(b=e[1],b&c?a.delete(f):b&k?(e[1]=d,e[2]=t):b&m?e[2]|=t:b&r||h.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")):a.set(f,[b,d,t])};b.prototype._ensureGeomRecord=
function(a,b){var e=this._residentGeomRecords.get(a);e||(e=new Map,this._residentGeomRecords.set(a,e));a=e.get(b);a||(a=new Map,e.set(b,a));return a};b.prototype._ensureDirtyRecord=function(a,b){var e=this._dirtyGeomRecords.get(a);e||(e=new Map,this._dirtyGeomRecords.set(a,e));a=e.get(b);a||(a=new Map,e.set(b,a));return a};b.prototype._getParentLayerId=function(a){return a.parentLayer.id};b.prototype.formatDebugInfo=function(){var a=["ADD","UPD",void 0,"REM"],b="";this._dirtyGeomRecords.forEach(function(e,
d){e.forEach(function(c,e){0<b.length&&(b+="\n");b+=d+"."+e;var f=[];c.forEach(function(a){var b=a[1];f[b]||(f[b]=[]);f[b].push(a[0].geometry.id)});for(c=0;c<f.length;c++)if(f[c])for(b+=" "+a[c-1]+": ",e=0;e<f[c].length;e++)b+=f[c][e]+", "})});return b};return b}()})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Collection ../../../../core/Evented ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/scheduling ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../layers/support/timeUtils ../../support/animationUtils ../collections/Component/ComponentObjectCollection ../core/renderPasses/RenderPassManager ../core/shaderTechnique/CommonUniformStore ../core/shaderTechnique/ShaderTechniqueRepository ../lib/AutoDisposable ../lib/Camera ../lib/CompositingHelper ../lib/GLMaterialRep ../lib/Renderer ../lib/TextureRepository ../lib/tracer ../lib/WebGLDriverTest ../materials/lineStippleUtils ../materials/internal/WaterTextureRepository ./requireUtils ./ScreenshotManager ../../../webgl/context-util ../../../webgl/RenderingContext".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L,M,N){Object.defineProperty(b,"__esModule",{value:!0});var Q=g.getLogger("esri.views.3d.webgl-engine.parts.View");n=function(b){function g(a,d,f){var g=b.call(this)||this;g._stage=d;g.events=new e;g.updateLogicClients=new h;g._camera=new y.default(p.vec3f64.fromValues(0,100,-100));g._stippleTextureRepository=new G.StippleTextureRepository;g.waterTextureRepository=new J.WaterTextureRepository;g._commonUniformStore=new z.CommonUniformStore;
g._componentObjectCollection=null;g._needsUpdate=!0;g._needsRender=!0;g._idleSuspend=!0;g._logicUpdateLast=0;g._stats={renderTimeTotal:0,renderTimeLast:0,frameCount:0};g._container=a;g._initializeContext(f);c.init(g.waterTextureRepository,"loadingState",function(){return g.setNeedsRender()});g._shaderTechniqueRepository=new w.ShaderTechniqueRepository({rctx:g._rctx,viewingMode:"local"===f.viewingMode?1:0,commonUniformStore:g._commonUniformStore,stippleTextureRepository:g._stippleTextureRepository,
waterTextureRepository:g.waterTextureRepository});g._textureRepository=new F.TextureRepository(g._stage.getAll(4),g._shaderTechniqueRepository,g._rctx);g._textureRepository.events.on("changed",function(a){return g.setNeedsRender(a.requestType)});g._materialRepository=new B(g._textureRepository,g._shaderTechniqueRepository,function(){return g.setNeedsRender()});g._compositingHelper=new A.default(g._rctx,g._shaderTechniqueRepository);g._initializeViewportCamera();g._renderer=new C(g._materialRepository,
g._textureRepository,g._shaderTechniqueRepository,g._rctx,g._compositingHelper,function(a){void 0===a&&(a=1);return g.setNeedsRender(a)},g._stage);g.updateLogicClients.add(g._renderer);g._screenshotManager=new L.ScreenshotManager(g._rctx,function(a,b,c){return g._render(a,b,c)},function(){return g.setNeedsRender()},f.screenshot.renderOverlay,function(a){return g.events.emit("force-camera-for-screenshot",a)});g._renderPassManager=new v.RenderPassManager(g,g._rctx,g._shaderTechniqueRepository);g.renderPlugins.add(g._renderPassManager.slots(),
g._renderPassManager);g._registerFrameTask();return g}a.__extends(g,b);g.prototype.dispose=function(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask&&(this._frameTask.remove(),this._frameTask=null);this._shaderTechniqueRepository.dispose();this._shaderTechniqueRepository=null;I.clearTestWebGLDriver(this._rctx);b.prototype.dispose.call(this);this._rctx=null};g.prototype.getCombinedStats=function(){var b=this._rctx.gl;return a.__assign(a.__assign({},
this._stats),{scene:this._renderer.getStats(),textureMemory:void 0!==b.getUsedTextureMemory?b.getUsedTextureMemory():void 0,renderbufferMemory:void 0!==b.getUsedRenderbufferMemory?b.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==b.getUsedVBOMemory?b.getUsedVBOMemory():void 0})};g.prototype.setNeedsRender=function(a){void 0===a&&(a=1);1===a?this._needsUpdate||(this._needsUpdate=!0,this.notifyChange("updating")):this._needsRender=!0};Object.defineProperty(g.prototype,"canRender",{get:function(){var a=
this._camera;return 0<a.fullWidth&&0<a.fullHeight&&this._renderer.canRender},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"needsUpdate",{get:function(){return this._needsUpdate},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"updating",{get:function(){return this.needsUpdate||this._renderer.updating||0<this._textureRepository.loadingCount||this.waterTextureRepository.updating||this._stage.dirty},enumerable:!0,configurable:!0});g.prototype.ensureEdgeView=function(){return this._renderer.ensureEdgeView()};
Object.defineProperty(g.prototype,"edgeView",{get:function(){return this._renderer.edgeView},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"textureRepository",{get:function(){return this._textureRepository},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"compositingHelper",{get:function(){return this._compositingHelper},enumerable:!0,configurable:!0});g.prototype.setRenderParameters=function(a){this.setNeedsRender();void 0!==a.idleSuspend&&(this._idleSuspend=
!!a.idleSuspend);void 0!==a.shadowMap&&(this._renderPassManager.shadowCastingEnabled=a.shadowMap);void 0!==a.ssrEnable&&(this._renderPassManager.screenSpaceReflectionsEnabled=a.ssrEnable);this._renderer.setRenderParams(a)};g.prototype.getRenderParameters=function(){var a=this._renderer.getRenderParams();a.anisotropicFiltering=this._rctx.parameters.maxMaxAnisotropy;a.idleSuspend=this._idleSuspend;return a};Object.defineProperty(g.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,
configurable:!0});g.prototype.has=function(a){return"s3tc"===a?!!this._rctx.capabilities.compressedTextureS3TC:"shaderTextureLOD"===a?!!this._rctx.capabilities.shaderTextureLOD:!1};g.prototype.modify=function(a,b,c){this._renderer.modify(a,a.length,b,b.length,c,c.length)};g.prototype.setCamera=function(a){this._camera.copyFrom(a);this.setNeedsRender()};g.prototype.getCamera=function(){return this._camera};g.prototype.getCanvas=function(){return this._canvas};g.prototype.takeScreenshot=function(a){return this._screenshotManager.takeScreenshot(a)};
Object.defineProperty(g.prototype,"renderPlugins",{get:function(){return this._renderer.renderPlugins},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"test",{get:function(){return{renderer:this._renderer}},enumerable:!0,configurable:!0});g.prototype.getGpuMemoryUsage=function(){return this._renderer.getGpuMemoryUsage()};g.prototype.hotReloadShaders=function(){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){switch(a.label){case 0:return E.removeLoadedShaderModules(),
[4,this._shaderTechniqueRepository.hotReload()];case 1:return a.sent(),this.setNeedsRender(),[2]}})})};g.prototype._registerFrameTask=function(){var a=this,b={viewCamera:this._camera,frameHasSlicePlane:!1};this._frameTask=d.addFrameTask({preRender:function(b){H.begin();var c=!1;a._stage.processDirty();var d=r.Milliseconds(b.time-a._logicUpdateLast);if(d>t.DESIRED_ANIMATION_MS){var e={camera:a._stage.getCamera(),dt:d};a.updateLogicClients.forEach(function(a){a.updateLogic(e)&&(c=!0)});a._logicUpdateLast=
b.time}c&&a.setNeedsRender(0)},render:function(){(a.needsUpdate||a._needsRender||!a._idleSuspend)&&a.canRender&&(a._needsRender=!1,a._needsUpdate=!1,a._render(null,a._camera,!1))},postRender:function(){a.notifyChange("updating");H.end()},update:function(){b.viewCamera=a._camera;b.frameHasSlicePlane=a._renderer.hasSlicePlane;a._textureRepository.update();a._screenshotManager.update(b)}})};g.prototype._initializeViewportCamera=function(){var a=this._container.getBoundingClientRect(),b=this.getCamera();
b.viewport[2]=a.width;b.viewport[3]=a.height;this.setCamera(b)};g.prototype._initializeContext=function(a){this._canvas=a.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var b=H.instrumentContext(M.createContextOrErrorHTML(this._canvas,{alpha:a.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==a.stencil?!0:a.stencil,powerPreference:"high-performance"},a.renderContext));this._rctx=new N(b,
{disabledExtensions:a.deactivatedWebGLExtensions||{},debugWebGLExtensions:a.debugWebGLExtensions||{}});null!=this._rctx.parameters.maxMaxAnisotropy&&(this._rctx.parameters.maxMaxAnisotropy=Math.min(this._rctx.parameters.maxMaxAnisotropy,8));this._loadShaderOnlyExtensions(this._rctx);!a.alpha&&this._rctx.contextAttributes.alpha&&Q.error("WebGL context has alpha channel even though no alpha channel was requested");!this._rctx.contextAttributes.alpha&&11<=f("safari")&&(this._container.style.backgroundColor=
"black");this._container.appendChild(this._canvas)};g.prototype._render=function(a,b,c){this._renderer.setLighting(this._stage.lighting);this._rctx.bindFramebuffer(a);b.setGLViewport(this._rctx);this._renderer.render({fbo:a,camera:b,disableSlice:c,lightDirection:this._stage.mainLightDirection})};g.prototype._loadShaderOnlyExtensions=function(a){a=a.capabilities;a.standardDerivatives;a.shaderTextureLOD};Object.defineProperty(g.prototype,"componentObjectCollection",{get:function(){l.isNone(this._componentObjectCollection)&&
(this._componentObjectCollection=new u.ComponentObjectCollection(this._renderPassManager));return this._componentObjectCollection},enumerable:!0,configurable:!0});a.__decorate([k.property({type:Boolean,readOnly:!0,dependsOn:["waterTextureRepository.updating"]})],g.prototype,"updating",null);a.__decorate([q.autoDispose()],g.prototype,"_rctx",void 0);a.__decorate([q.autoDispose()],g.prototype,"_container",void 0);a.__decorate([q.autoDispose()],g.prototype,"_canvas",void 0);a.__decorate([q.autoDispose()],
g.prototype,"_stippleTextureRepository",void 0);a.__decorate([q.autoDispose(),k.property()],g.prototype,"waterTextureRepository",void 0);a.__decorate([q.autoDispose()],g.prototype,"_textureRepository",void 0);a.__decorate([q.autoDispose()],g.prototype,"_commonUniformStore",void 0);a.__decorate([q.autoDispose()],g.prototype,"_compositingHelper",void 0);a.__decorate([q.autoDispose()],g.prototype,"_renderer",void 0);a.__decorate([q.autoDispose()],g.prototype,"_screenshotManager",void 0);a.__decorate([q.autoDispose()],
g.prototype,"componentObjectCollection",null);a.__decorate([q.autoDispose()],g.prototype,"_componentObjectCollection",void 0);return g=a.__decorate([k.subclass("esri.views.3d.webgl-engine.parts.RenderView")],g)}(q.AutoDisposableMixin(m));b.RenderView=n})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("require exports tslib ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/typedArrayUtil ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../../geometry/support/aaBoundingBox ../../../layers/support/symbolColorUtils ../../../support/orientedBoundingBox ../../../support/buffer/BufferView ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ./interface ./RenderSubmitSystem ./SourceGeometry ./IndexRange/ComponentRangeRunLengthEncoded ./Material/ComponentMaterial ./Material/ComponentTechnique ../../core/util/BucketedObjectStore ../../core/util/TwoVectorPosition ../../lib/AutoDisposable ../../lib/ComponentUtils ../../lib/geometryDataUtils ../../lib/Util ../../lib/TextureBackedBuffer/BufferManager ../../materials/internal/MaterialUtil ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L,M,N,Q){function R(a,b,c){var d=[],e=c.length;b.forEachComponent(function(b){0<a[b]&&(e!==b-1&&(d.length&&d.push(c[e+1]-d[d.length-1]),d.push(c[b])),e=b);return!0});d.length&&d.push(c[e+1]-d[d.length-1]);return d}Object.defineProperty(b,"__esModule",{value:!0});var W=m.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");n=function(){function a(a){this._renderManager=a;this._objects=new F.BucketedObjectStore;
this._renderSubmit=new q.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);this._componentBufferManager=new L.BufferManager(a.rctx)}a.prototype.dispose=function(){E.assert(0===this.count,"ObjectCollection should be empty upon disposal")};a.prototype.createObject=function(a){var b=new T;b.toMapSpace=a.toMapSpace.slice();b.transform=a.transform;b.obb=t.clone(a.obb);b.components=new O(this._componentBufferManager,a.geometry.componentOffsets);b.renderable=this._createRenderable(a,
b.components);b.intersectionGeometry=new U(a.geometry.positionData,b.components);this._objects.add(a.visible?ka:0,b);return b};a.prototype.destroyObject=function(a){this._objects.remove(a);a.dispose();this._notifyDirty()};a.prototype.setObjectVisibility=function(a,b){b!==a.visible&&(this._objects.updateKey(a,b?a.bucketKey|ka:a.bucketKey&~ka),this._notifyDirty())};Object.defineProperty(a.prototype,"count",{get:function(){return this._objects.count},enumerable:!0,configurable:!0});a.prototype.preSubmit=
function(a){var b=a.camera.eye;this._objects.forEach(function(a,c){c&ka&&a.forEach(function(a){var c=l.vec3.squaredDistance(b,a.obb.center);a.renderable.meta.cameraDepthSquared=c})})};a.prototype.updateMaterial=function(a,b){a=a.renderable.material;b(a);a.dirty&&this._notifyDirty()};a.prototype.setAllComponentVisibilities=function(a,b){a.components.visibility.reset(b);a.components.visibilityDirty();this._notifyDirty()};a.prototype.forEachVisibleComponent=function(a,b){return a.components.visibility.forEachComponent(b)};
a.prototype.getComponentCount=function(a){var b=a.components.visibility.componentCount();return{visible:b,invisible:a.components.count-b}};a.prototype.setComponentData=function(a,b){var c=a.renderable.material;if(w.isVaryingComponentParameters(b)){a=a.components;for(var d=a.materialDataBuffer,e=a.materialDataIndices,f={castShadows:!0,pickable:!0,externalColor:k.vec4f32.create(),externalColorMixMode:1},d=d.textureBuffer,g=new Uint8Array(4),h=new Uint32Array(g.buffer),l=0,m=0,p=0,q=!1,t=0,n=0;n<a.count;n++)b(n,
f),l+=+(1>f.externalColor[3]),m+=+(3===f.externalColorMixMode&&1===f.externalColor[3]),p+=+f.castShadows,r.encodeSymbolColor(f.externalColor,f.externalColorMixMode,g),g[2]=g[2]&254|+f.castShadows,d.setData(e[n],0,g[0],g[1],g[2],g[3]),q=q||0<n&&t!==h[0],t=h[0],f.pickable!==G.getVisibility(a.pickability,n)&&(a.pickability=G.updateVisibilityWithCount(a.pickability,a.count,n,f.pickable));q?(c.componentParameters=new B.ComponentParametersVarying,c.componentParameters.castShadows=p===a.count?0:0===p?2:
1,c.componentParameters.transparent=l===a.count?0:0===l?2:1,c.componentParameters.opaqueOverride=m===a.count?0:0===m?2:1,c.componentParameters.texture=d,d.updateTexture()):(c.componentParameters=new B.ComponentParametersUniform,c.componentParameters.castShadows=f.castShadows?0:2,c.componentParameters.externalColor=f.externalColor,c.componentParameters.externalColorMixMode=f.externalColorMixMode)}else c.componentParameters=new B.ComponentParametersUniform,c.componentParameters.castShadows=b.castShadows?
0:2,c.componentParameters.externalColor=b.externalColor,c.componentParameters.externalColorMixMode=b.externalColorMixMode;this._notifyDirty()};a.prototype.getComponentAABB=function(a,b,c){return a.intersectionGeometry.getComponentAABB(b,c)};a.prototype.getObjectTransform=function(a){return a.transform};a.prototype.getComponentPositions=function(a,b,c){return a.intersectionGeometry.getComponentPositions(b,c)};a.prototype.intersect=function(a,b,c,d,e,g){h.isSome(e)&&(e.localOrigin=a.transform.position);
var k=f.mat3.invert(X,a.transform.rotationScale);l.vec3.sub(da,b,a.transform.position);l.vec3.sub(fa,c,a.transform.position);l.vec3.transformMat3(da,da,k);l.vec3.transformMat3(fa,fa,k);b=f.mat3.transpose(X,k);return a.intersectionGeometry.intersect(da,fa,d,b,e,g)};a.prototype.addEdges=function(a,b,c,d){var e=a.intersectionGeometry;return b.addComponentObject(a,a.transform,a.obb.center,e.positions,e.indices,a.components.offsets,c,d)};a.prototype.addComponentHighlight=function(a,b){a=a.components;h.isNone(a.highlightCounts)&&
(a.highlightCounts=new Uint32Array(a.count+1));0===a.highlightCounts[b]++&&(a.highlightsDirty(),this._notifyDirty());a.highlightCounts[a.count]++};a.prototype.removeComponentHighlight=function(a,b){a=a.components;if(h.isNone(a.highlightCounts))W.warn("Removing non-existing highlight.");else{var c=a.highlightCounts[b],d=a.highlightCounts[a.count];0===c?W.warn("Removing non-existing highlight."):1<c?(a.highlightCounts[b]=c-1,a.highlightCounts[a.count]=d-1):(a.highlightCounts[b]=0,a.highlightsDirty(),
this._notifyDirty(),1===d?a.highlightCounts=null:a.highlightCounts[a.count]=d-1)}};a.prototype.clearHighlights=function(a){a=a.components;h.isSome(a.highlightCounts)&&(a.highlightCounts=null,a.highlightsDirty(),this._notifyDirty())};a.prototype.getObjectMemoryUsageGPU=function(a){return a.renderable.meta.gpuMemoryEstimate};Object.defineProperty(a.prototype,"visibleObjects",{get:function(){return this._objects.getBucket(ka)},enumerable:!0,configurable:!0});a.prototype._createRenderable=function(a,
b){for(var d=this._renderManager.rctx,e=a.geometry,k=e.vertices.layoutParameters,m=N.createVertex(d,35044,e.vertices.data),p=h.applySome(e.indices,function(a){return N.createIndex(d,35044,a)}),q=v.glLayout(y.createVertexBufferLayout(k)),r=new Uint16Array(e.vertices.count),t=0;t<b.count;t++){var n=b.offsets[t],u=b.offsets[t+1],w=b.materialDataIndices[t];if(h.isSome(e.indices))for(;n<u;n++)r[e.indices[n]]=w;else for(;n<u;n++)r[n]=w}b=N.createVertex(d,35044,r.buffer);t=new H.TwoVectorPosition(a.transform.position);
u=g.mat3f32.clone(a.transform.rotationScale);f.mat3.invert(u,u);f.mat3.transpose(u,u);r=new C.ComponentDrawParameters;l.vec3.copy(r.worldFromModel_TL,t.low);l.vec3.copy(r.worldFromModel_TH,t.high);f.mat3.copy(r.worldFromModel_RS,a.transform.rotationScale);f.mat3.copy(r.transformNormal_GlobalFromModel,u);c.vec4.copy(r.toMapSpace,a.toMapSpace);a=new B.ComponentMaterial;q=new Q(d,a.attributeLocations,{data:q,componentIndices:V},{data:m,componentIndices:b},h.unwrap(p));t=new ba;t.material=a;t.drawParameters=
r;t.geometry=new P(q,e.primitiveType,k,h.isSome(p));t.meta.cameraDepthSquared=.5;t.meta.gpuMemoryEstimate=m.byteSize+b.byteSize+(h.isSome(p)?p.byteSize:0);return t};a.prototype._notifyDirty=function(){this._renderManager.notifyDirty()};return a}();b.ComponentObjectCollection=n;var O=function(b){function c(a,c){var d=b.call(this)||this;d.pickability=null;d.highlightCounts=null;d.cachedGeometryRanges=null;d.cachedHighlightRanges=null;d.offsets=e.slice(c);c=d.count;d.visibility=new A.ComponentRangeRunLengthEncoded(c);
d.materialDataBuffer=a.getBuffer(c);d.materialDataIndices=new Uint16Array(c);for(a=0;a<c;a++)d.materialDataIndices[a]=d.materialDataBuffer.acquireIndex();return d}a.__extends(c,b);c.prototype.dispose=function(){b.prototype.dispose.call(this);for(var a=0;a<this.count;a++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[a])};Object.defineProperty(c.prototype,"count",{get:function(){return this.offsets.length-1},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"geometryRanges",
{get:function(){h.isNone(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"highlightRanges",{get:function(){if(h.isNone(this.highlightCounts))return null;h.isNone(this.cachedHighlightRanges)&&(this.cachedHighlightRanges=R(this.highlightCounts,this.visibility,this.offsets));return this.cachedHighlightRanges},enumerable:!0,configurable:!0});c.prototype.highlightsDirty=
function(){this.cachedHighlightRanges=null};c.prototype.visibilityDirty=function(){this.cachedHighlightRanges=this.cachedGeometryRanges=null};return c}(I.AutoDisposable),U=function(){function a(a,b){this._indices=h.isSome(a.indices)?a.indices:J.generateDefaultIndexArray(a.positions.length/3);this._positions=new u.BufferViewVec3f(a.positions);this._components=b}a.prototype.getComponentAABB=function(a,b){if(h.isSome(this._perComponentAABBs)){for(var c=0;6>c;c++)b[c]=this._perComponentAABBs[6*a+c];return b}this._computePerComponentAABBs();
return this.getComponentAABB(a,b)};a.prototype.getComponentPositions=function(a,b){b.indices=this._indices;b.data=this._positions.typedBuffer;b.stride=this._positions.typedBufferStride;b.startIndex=this._components.offsets[a];b.endIndex=this._components.offsets[a+1]};a.prototype.intersect=function(a,b,c,d,e,f){var g=this,k={data:this._positions.typedBuffer,strideIdx:this._positions.typedBufferStride,offsetIdx:0,size:3},m=this._indices,p=this._components.offsets,q=M.computeInvDir(a,b,Y);this._components.visibility.forEachComponent(function(r){if(!G.getVisibility(g._components.pickability,
r))return!0;var t=g.getComponentAABB(r,ga);h.isSome(e)&&e.applyToAABB(t);if(!M.intersectAabbInvDir(t,a,q,c))return!0;M.intersectTriangles(a,b,p[r]/3,p[r+1]/3,m,k,void 0,e,function(a,b,c){return f(r,a,l.vec3.transformMat3(b,b,d),c)});return!0})};a.prototype._computePerComponentAABBs=function(){var a=this._components.count;this._perComponentAABBs=new Float32Array(6*a);for(var b=0;b<a;b++)this._computeAABB(b)};a.prototype._computeAABB=function(a){for(var b=this._indices,c=this._positions,d=this._components.offsets,
e=d[a+1],f=[0,0,0],g=[Infinity,Infinity,Infinity],k=[-Infinity,-Infinity,-Infinity],d=d[a];d<e;d++)c.getVec(b[d],f),l.vec3.min(g,g,f),l.vec3.max(k,k,f);a*=6;this._perComponentAABBs[a++]=g[0];this._perComponentAABBs[a++]=g[1];this._perComponentAABBs[a++]=g[2];this._perComponentAABBs[a++]=k[0];this._perComponentAABBs[a++]=k[1];this._perComponentAABBs[a]=k[2]};Object.defineProperty(a.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0});return a}(),P=function(b){function c(a,c,d,e){var f=b.call(this)||this;f.vao=a;f.primitiveType=c;f.parameters=d;f.indexed=e;return f}a.__extends(c,b);a.__decorate([I.autoDispose()],c.prototype,"vao",void 0);return c}(I.AutoDisposable);b.RenderGeometry=P;var ba=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.meta={cameraDepthSquared:0,gpuMemoryEstimate:0};return a}a.__extends(c,b);a.__decorate([I.autoDispose()],
c.prototype,"geometry",void 0);return c}(I.AutoDisposable);b.Renderable=ba;var V=v.glLayout(z.newLayout().u16("componentIndex")),T=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}a.__extends(c,b);Object.defineProperty(c.prototype,"visible",{get:function(){return!!(this.bucketKey&ka)},enumerable:!0,configurable:!0});a.__decorate([I.autoDispose()],c.prototype,"renderable",void 0);a.__decorate([I.autoDispose()],c.prototype,"components",void 0);return c}(F.BucketStorable);b.ComponentObject=
T;var X=g.mat3f32.create(),Y=d.vec3f64.create(),da=d.vec3f64.create(),fa=d.vec3f64.create(),ga=p.create(),ka=1})},"esri/views/3d/support/orientedBoundingBox":function(){define("require exports ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/quat ../../../core/libs/gl-matrix-2/quatf32 ../../../core/libs/gl-matrix-2/quatf64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f32 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ./dito ./geometryUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t){function u(a,b,c){void 0===a&&(a=[0,0,0]);void 0===b&&(b=[-1,-1,-1]);void 0===c&&(c=[0,0,0,1]);return{center:d.vec3f64.clone(a),halfSize:l.vec3f32.clone(b),quaternion:e.quatf32.clone(c)}}function v(a,b){var c=t.plane.signedDistance(b,a.center);a=z(a,b);return c>a?1:c<-a?-1:0}function z(a,b){h.quat.conjugate(w,a.quaternion);g.vec3.transformQuat(q,b,w);a=a.halfSize;return Math.abs(q[0]*a[0])+Math.abs(q[1]*a[1])+Math.abs(q[2]*a[2])}Object.defineProperty(b,"__esModule",
{value:!0});var w=f.quatf64.create(),q=d.vec3f64.create(),y=d.vec3f64.create(),A=k.vec4f64.create(),B=m.mat3f64.create();n=function(){return function(a){this.buffer=new ArrayBuffer(56*a);this.obbs=Array(a);for(var b=0;b<a;b++)this.obbs[b]={center:d.vec3f64.createView(this.buffer,56*b+0),halfSize:l.vec3f32.createView(this.buffer,56*b+24),quaternion:e.quatf32.createView(this.buffer,56*b+36)}}}();b.ObbArray=n;b.create=u;b.clone=function(a){return u(a.center,a.halfSize,a.quaternion)};b.set=function(a,
b){g.vec3.copy(b.center,a.center);g.vec3.copy(b.halfSize,a.halfSize);h.quat.copy(b.quaternion,a.quaternion)};b.compute=function(a,b){b=b||u();r.computeOBB(a,b);return b};b.intersectPlane=v;b.toAaBoundingBox=function(b,c){c||(c=p.create());var d=a.mat3.fromQuat(B,b.quaternion),e=b.halfSize[0]*Math.abs(d[0])+b.halfSize[1]*Math.abs(d[3])+b.halfSize[2]*Math.abs(d[6]),f=b.halfSize[0]*Math.abs(d[1])+b.halfSize[1]*Math.abs(d[4])+b.halfSize[2]*Math.abs(d[7]),d=b.halfSize[0]*Math.abs(d[2])+b.halfSize[1]*Math.abs(d[5])+
b.halfSize[2]*Math.abs(d[8]);c[0]=b.center[0]-e;c[1]=b.center[1]-f;c[2]=b.center[2]-d;c[3]=b.center[0]+e;c[4]=b.center[1]+f;c[5]=b.center[2]+d;return c};b.minimumDistancePlane=function(a,b){var c=t.plane.signedDistance(b,a.center);a=z(a,b);return c-a};b.maximumDistancePlane=function(a,b){var c=t.plane.signedDistance(b,a.center);a=z(a,b);return c+a};b.isVisible=function(a,b){return 0>=v(a,b.planes[0])&&0>=v(a,b.planes[1])&&0>=v(a,b.planes[2])&&0>=v(a,b.planes[3])&&0>=v(a,b.planes[4])&&0>=v(a,b.planes[5])};
b.intersectLine=function(a,b,c,d){void 0===d&&(d=0);h.quat.conjugate(w,a.quaternion);g.vec3.subtract(q,b,a.center);b=g.vec3.transformQuat(q,q,w);c=g.vec3.transformQuat(y,c,w);for(var e=-Infinity,f=Infinity,k=0;3>k;k++)if(1E-6<Math.abs(c[k]))var l=(d+a.halfSize[k]-b[k])/c[k],m=(-d-a.halfSize[k]-b[k])/c[k],e=Math.max(e,Math.min(l,m)),f=Math.min(f,Math.max(l,m));else if(b[k]>a.halfSize[k]+d||b[k]<-a.halfSize[k]-d)return!1;return e<=f};b.projectedArea=function(b,d,e,f,k){h.quat.conjugate(w,b.quaternion);
g.vec3.sub(q,d,b.center);g.vec3.transformQuat(q,q,w);var l=q[0]<-b.halfSize[0]?-1:q[0]>b.halfSize[0]?1:0,m=q[1]<-b.halfSize[1]?-1:q[1]>b.halfSize[1]?1:0,p=q[2]<-b.halfSize[2]?-1:q[2]>b.halfSize[2]?1:0;d=Math.abs(l)+Math.abs(m)+Math.abs(p);if(0===d)return Infinity;d=1===d?4:6;m=6*(l+3*m+9*p+13);a.mat3.fromQuat(B,b.quaternion);a.mat3.scale(B,B,b.halfSize);for(l=0;l<d;l++)p=F[m+l],g.vec3.set(q,((p&1)<<1)-1,(p&2)-1,((p&4)>>1)-1),g.vec3.transformMat3(q,q,B),g.vec3.add(A,b.center,q),A[3]=1,c.vec4.transformMat4(A,
A,e),p=1/Math.max(1E-6,A[3]),C[2*l]=A[0]*p,C[2*l+1]=A[1]*p;b=2*d-2;e=C[0]*(C[3]-C[b+1])+C[b]*(C[1]-C[b-1]);for(l=2;l<b;l+=2)e+=C[l]*(C[l+3]-C[l-1]);return Math.abs(e)*f*k*.125};var C=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],F=function(){var a=new Int8Array(162),b=0,c=function(c){for(var d=0;d<c.length;d++)a[b+d]=c[d];b+=6};c([6,2,3,1,5,4]);c([0,2,3,1,5,4]);c([0,2,3,7,5,4]);c([0,1,3,2,6,4]);c([0,1,3,2,0,0]);c([0,1,5,7,3,2]);c([0,1,3,7,6,4]);c([0,1,3,7,6,2]);c([0,1,5,7,6,2]);c([0,1,5,4,6,2]);c([0,1,5,
4,0,0]);c([0,1,3,7,5,4]);c([0,2,6,4,0,0]);c([0,0,0,0,0,0]);c([1,3,7,5,0,0]);c([2,3,7,6,4,0]);c([2,3,7,6,0,0]);c([2,3,1,5,7,6]);c([0,1,5,7,6,2]);c([0,1,5,7,6,4]);c([0,1,3,7,6,4]);c([4,5,7,6,2,0]);c([4,5,7,6,0,0]);c([4,5,1,3,7,6]);c([0,2,3,7,5,4]);c([6,2,3,7,5,4]);c([6,2,3,1,5,4]);return a}();b.projectedRadius=z;b.corners=function(a,b){for(var c=0;8>c;++c){var d=b[c];d[0]=c&1?-a.halfSize[0]:a.halfSize[0];d[1]=c&2?-a.halfSize[1]:a.halfSize[1];d[2]=c&4?-a.halfSize[2]:a.halfSize[2];g.vec3.transformQuat(d,
d,a.quaternion);g.vec3.add(d,d,a.center)}}})},"esri/core/libs/gl-matrix-2/quatf32":function(){define(["require","exports","./factories/quatf32"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.quatf32=a})},"esri/core/libs/gl-matrix-2/factories/quatf32":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var a=new Float32Array(4);a[3]=1;return a};b.clone=function(a){var b=new Float32Array(4);b[0]=a[0];b[1]=a[1];
b[2]=a[2];b[3]=a[3];return b};b.fromValues=function(a,b,h,e){var f=new Float32Array(4);f[0]=a;f[1]=b;f[2]=h;f[3]=e;return f};b.createView=function(a,b){return new Float32Array(a,b,4)}})},"esri/views/3d/support/dito":function(){define(["require","exports"],function(n,b){function a(a,b,c,d,e,f){if(!(1E-6>b[0]*b[0]+b[1]*b[1]+b[2]*b[2]))for(p(G,c,b),p(J,d,b),p(E,e,b),m(a,b,I),M[1]=I[0],L[1]=I[1],N[1]=L[1]-M[1],c=[c,d,e],d=[G,J,E],e=0;3>e;++e){m(a,c[e],I);M[0]=I[0];L[0]=I[1];m(a,d[e],I);M[2]=I[0];L[2]=
I[1];N[0]=L[0]-M[0];N[2]=L[2]-M[2];var h=g(N);h<f.quality&&(k(f.b0,c[e]),k(f.b1,b),k(f.b2,d[e]),f.quality=h)}}function m(a,b,c){var d=a.data,e=a.offsetIdx;a=a.strideIdx;c[0]=Number.POSITIVE_INFINITY;for(c[1]=Number.NEGATIVE_INFINITY;e<d.length;e+=a){var f=d[e]*b[0]+d[e+1]*b[1]+d[e+2]*b[2];c[0]=Math.min(c[0],f);c[1]=Math.max(c[1],f)}}function h(a,b,d){k(d.center,a);c(d.halfSize,b,.5);d.quaternion[0]=0;d.quaternion[1]=0;d.quaternion[2]=0;d.quaternion[3]=1}function e(a,b,c,d,e,f){m(a,b,I);e[0]=I[0];
f[0]=I[1];m(a,c,I);e[1]=I[0];f[1]=I[1];m(a,d,I);e[2]=I[0];f[2]=I[1]}function f(a,b,d,e,f,g,k){T[0]=a[0];T[1]=a[1];T[2]=a[2];T[3]=b[0];T[4]=b[1];T[5]=b[2];T[6]=d[0];T[7]=d[1];T[8]=d[2];var h=k.quaternion,m=T,p=m[0]+m[4]+m[8];if(0<p)p=Math.sqrt(p+1),h[3]=.5*p,p=.5/p,h[0]=(m[5]-m[7])*p,h[1]=(m[6]-m[2])*p,h[2]=(m[1]-m[3])*p;else{var q=0;m[4]>m[0]&&(q=1);m[8]>m[3*q+q]&&(q=2);var r=(q+1)%3,t=(q+2)%3,p=Math.sqrt(m[3*q+q]-m[3*r+r]-m[3*t+t]+1);h[q]=.5*p;p=.5/p;h[3]=(m[3*r+t]-m[3*t+r])*p;h[r]=(m[3*r+q]+m[3*
q+r])*p;h[t]=(m[3*t+q]+m[3*q+t])*p}l(X,e,f);c(X,X,.5);c(k.center,a,X[0]);c(V,b,X[1]);l(k.center,k.center,V);c(V,d,X[2]);l(k.center,k.center,V);c(k.halfSize,g,.5)}function g(a){return a[0]*a[1]+a[0]*a[2]+a[1]*a[2]}function l(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2]}function d(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2]}function c(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c}function k(a,b,c){void 0===c&&(c=0);a[0]=b[c+0];a[1]=b[c+1];a[2]=b[c+2]}function p(a,b,c){var d=b[0],e=b[1];
b=b[2];var f=c[0],g=c[1];c=c[2];a[0]=e*c-b*g;a[1]=b*f-d*c;a[2]=d*g-e*f}function r(a,b){var c=b[0]*b[0]+b[1]*b[1]+b[2]*b[2];0<c&&(c=1/Math.sqrt(c),a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c)}function t(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return c*c+d*d+a*a}Object.defineProperty(b,"__esModule",{value:!0});var u=[0,0,0],v=[0,0,0];b.computeOBB=function(b,m){var n=b.data.length/b.strideIdx;if(!(0>=n)){var E=new Y(b);l(u,E.minProj,E.maxProj);c(u,u,.5);d(v,E.maxProj,E.minProj);var G=g(v),J=new da;J.quality=
G;14>n&&(b={data:new Float64Array(E.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});var L=[0,0,0],N=[0,0,0],M=[0,0,0],n=[0,0,0],fa=[0,0,0],V=[0,0,0],T=[0,0,0],ga;ga=b;for(var X=t(E.maxVert[0],E.minVert[0]),va=0,ma=1;7>ma;++ma){var sa=t(E.maxVert[ma],E.minVert[ma]);sa>X&&(X=sa,va=ma)}k(L,E.minVert[va]);k(N,E.maxVert[va]);if(1E-6>t(L,N))ga=1;else{d(n,L,N);r(n,n);E=ga.data;X=ga.strideIdx;va=Number.NEGATIVE_INFINITY;ma=0;for(sa=ga.offsetIdx;sa<E.length;sa+=X){H[0]=E[sa]-L[0];H[1]=E[sa+1]-L[1];H[2]=E[sa+
2]-L[2];var qa=n[0]*H[0]+n[1]*H[1]+n[2]*H[2],qa=H[0]*H[0]+H[1]*H[1]+H[2]*H[2]-qa*qa/(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);qa>va&&(va=qa,ma=sa)}k(M,E,ma);1E-6>va?ga=2:(d(fa,N,M),r(fa,fa),d(V,M,L),r(V,V),p(T,fa,n),r(T,T),a(ga,T,n,fa,V,J),ga=0)}switch(ga){case 1:h(u,v,m);return;case 2:G=b;k(R,n);Math.abs(n[0])>Math.abs(n[1])&&Math.abs(n[0])>Math.abs(n[2])?R[0]=0:Math.abs(n[1])>Math.abs(n[2])?R[1]=0:R[2]=0;1E-6>R[0]*R[0]+R[1]*R[1]+R[2]*R[2]&&(R[0]=R[1]=R[2]=1);p(W,n,R);r(W,W);p(O,n,W);r(O,O);e(G,n,W,O,U,P);
d(ba,P,U);f(n,W,O,U,P,ba,m);return}ga=b;E=z;X=w;va=I;ma=ga.data;qa=ga.offsetIdx;sa=ga.strideIdx;k(X,ma,qa);k(E,X);va[0]=Q[0]*T[0]+Q[1]*T[1]+Q[2]*T[2];va[1]=va[0];for(qa+=sa;qa<ma.length;qa+=sa){var Ca=ma[qa]*T[0]+ma[qa+1]*T[1]+ma[qa+2]*T[2];Ca<va[0]&&(va[0]=Ca,k(X,ma,qa));Ca>va[1]&&(va[1]=Ca,k(E,ma,qa))}T=L[0]*T[0]+L[1]*T[1]+L[2]*T[2];I[1]-1E-6<=T&&(E[0]=void 0);I[0]+1E-6>=T&&(X[0]=void 0);void 0!==z[0]&&(d(q,z,L),r(q,q),d(y,z,N),r(y,y),d(A,z,M),r(A,A),p(B,y,n),r(B,B),p(C,A,fa),r(C,C),p(F,q,V),r(F,
F),a(ga,B,n,y,q,J),a(ga,C,fa,A,y,J),a(ga,F,V,q,A,J));void 0!==w[0]&&(d(q,w,L),r(q,q),d(y,w,N),r(y,y),d(A,w,M),r(A,A),p(B,y,n),r(B,B),p(C,A,fa),r(C,C),p(F,q,V),r(F,F),a(ga,B,n,y,q,J),a(ga,C,fa,A,y,J),a(ga,F,V,q,A,J));e(b,J.b0,J.b1,J.b2,U,P);b=[0,0,0];d(b,P,U);J.quality=g(b);J.quality<G?f(J.b0,J.b1,J.b2,U,P,b,m):h(u,v,m)}};var z=[0,0,0],w=[0,0,0],q=[0,0,0],y=[0,0,0],A=[0,0,0],B=[0,0,0],C=[0,0,0],F=[0,0,0],H=[0,0,0],I=[0,0],G=[0,0,0],J=[0,0,0],E=[0,0,0],L=[0,0,0],M=[0,0,0],N=[0,0,0],Q=[0,0,0],R=[0,0,
0],W=[0,0,0],O=[0,0,0],U=[0,0,0],P=[0,0,0],ba=[0,0,0],V=[0,0,0],T=[1,0,0,0,1,0,0,0,1],X=[0,0,0],Y=function(){return function(a){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var b=0;this.minProj=new Float64Array(this.buffer,b,7);b+=56;this.maxProj=new Float64Array(this.buffer,b,7);for(var b=b+56,c=0;7>c;++c)this.minVert[c]=new Float64Array(this.buffer,b,3),b+=24;for(c=0;7>c;++c)this.maxVert[c]=new Float64Array(this.buffer,b,3),b+=24;for(c=0;7>c;++c)this.minProj[c]=Number.POSITIVE_INFINITY,
this.maxProj[c]=Number.NEGATIVE_INFINITY;for(var b=Array(7),d=Array(7),e=a.data,f=a.strideIdx,c=a.offsetIdx;c<e.length;c+=f)a=e[c],a<this.minProj[0]&&(this.minProj[0]=a,b[0]=c),a>this.maxProj[0]&&(this.maxProj[0]=a,d[0]=c),a=e[c+1],a<this.minProj[1]&&(this.minProj[1]=a,b[1]=c),a>this.maxProj[1]&&(this.maxProj[1]=a,d[1]=c),a=e[c+2],a<this.minProj[2]&&(this.minProj[2]=a,b[2]=c),a>this.maxProj[2]&&(this.maxProj[2]=a,d[2]=c),a=e[c]+e[c+1]+e[c+2],a<this.minProj[3]&&(this.minProj[3]=a,b[3]=c),a>this.maxProj[3]&&
(this.maxProj[3]=a,d[3]=c),a=e[c]+e[c+1]-e[c+2],a<this.minProj[4]&&(this.minProj[4]=a,b[4]=c),a>this.maxProj[4]&&(this.maxProj[4]=a,d[4]=c),a=e[c]-e[c+1]+e[c+2],a<this.minProj[5]&&(this.minProj[5]=a,b[5]=c),a>this.maxProj[5]&&(this.maxProj[5]=a,d[5]=c),a=e[c]-e[c+1]-e[c+2],a<this.minProj[6]&&(this.minProj[6]=a,b[6]=c),a>this.maxProj[6]&&(this.maxProj[6]=a,d[6]=c);for(c=0;7>c;++c)a=b[c],k(this.minVert[c],e,a),a=d[c],k(this.maxVert[c],e,a)}}(),da=function(){return function(){this.b0=[1,0,0];this.b1=
[0,1,0];this.b2=[0,0,1];this.quality=0}}()})},"esri/views/3d/webgl-engine/collections/Component/interface":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.isVaryingComponentParameters=function(a){return"function"===typeof a}})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["require","exports","./DepthRange"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this._objects=
a}b.prototype.submit=function(a,b){this._objects.preSubmit(b);b=this._objects.visibleObjects;for(var e=0;e<b.length;e++){var g=b[e];g.renderable.material.submit(a,g)}};b.prototype.queryShadowCasterDepthRange=function(b){return this._objects.visibleObjects.length?a.computeDepthRange(b,this._objects.visibleObjects):null};return b}();b.RenderSubmitSystem=n})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("require exports ../../../../../core/PooledArray ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/quat ../../../../../core/libs/gl-matrix-2/quatf64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/orientedBoundingBox ../../../support/geometryUtils/plane ../../lib/depthRange".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k){function p(a,b,c){return g.vec3.set(a,b.data[c+0],b.data[c+1],b.data[c+2])}function r(a,b){a.push(b[0]);a.push(b[1]);a.push(b[2])}function t(a,b,c,d){e.quat.conjugate(H,a.quaternion);g.vec3.sub(I,b,a.center);g.vec3.transformQuat(I,I,H);var f=8*((I[0]<-a.halfSize[0]?-1:I[0]>a.halfSize[0]?1:0)+3*(I[1]<-a.halfSize[1]?-1:I[1]>a.halfSize[1]?1:0)+9*(I[2]<-a.halfSize[2]?-1:I[2]>a.halfSize[2]?1:0)+13);b=B[f];if(0===b)return b;m.mat3.fromQuat(F,a.quaternion);m.mat3.scale(F,
F,a.halfSize);var k=function(b,c){c=B[f+c+1];g.vec3.set(b,((c&1)<<1)-1,(c&2)-1,((c&4)>>1)-1);g.vec3.transformMat3(b,b,F);return g.vec3.add(b,a.center,b)};c.length=0;r(c,k(G,0));r(c,k(J,1));r(c,k(I,2));r(c,k(E,3));d(c);if(1===b)return b;c.length=0;r(c,G);r(c,E);r(c,k(I,4));r(c,k(L,5));d(c);if(2===b)return b;c.length=0;r(c,G);r(c,L);r(c,k(I,6));r(c,J);d(c);return b}function u(a,b){for(var c=0,e=0;e<C;e++){var f=d.intersectPlane(a,b[e]);if(0<f)return-1;0===f&&(c|=1<<e)}return c}Object.defineProperty(b,
"__esModule",{value:!0});b.computeDepthRange=function(a,b){var e=k.empty(),f=a.eye,h=a.viewForward,l=a.frustum.planes;for(a=0;a<b.length;a++){var m=b[a].obb,n=g.vec3.dot(g.vec3.sub(I,m.center,f),h),B=d.projectedRadius(m,h);if(!k.within(e,n-B)||!k.within(e,n+B))if(m=u(m,l),-1!==m)if(0===m)z.far=n+B,z.near=n-B,k.union(e,z);else{var E=v.pushNew();E.near=n-B;E.far=n+B;E.mask=m;E.object=b[a]}}b=function(a){var b=v.data[a];if(k.within(e,b.near)&&k.within(e,b.far))return"continue";z.far=b.far;z.near=Infinity;
0===t(b.object.obb,f,y,function(a){for(var d=A,e=0;e<C&&0<a.length;e++)if(0!==(b.mask&1<<e)){var k=l[e],m=a,t=d;t.length=0;var n=m.length-3;p(w,m,n);var u=c.signedDistance(k,w);0>=u&&(t.push(w[0]),t.push(w[1]),t.push(w[2]));var v=0,y=u;for(v;v<n;v+=3){p(q,m,v);var B=c.signedDistance(k,q);0>y*B&&(g.vec3.lerp(w,q,w,B/(B-y)),r(t,w));0>=B&&r(t,q);y=B;g.vec3.copy(w,q)}0>y*u&&(p(q,m,n),g.vec3.lerp(w,q,w,u/(u-y)),r(t,w));k=a;a=d;d=k}for(d=0;d<a.length;d+=3)g.vec3.set(w,a.data[d+0],a.data[d+1],a.data[d+2]),
e=g.vec3.dot(g.vec3.sub(w,w,f),h),z.near=Math.min(z.near,e)})&&(z.near=0);k.union(e,z)};for(a=0;a<v.length;a++)b(a);v.length=0;return e};var v=new a({allocator:function(a){return a||{near:Infinity,far:-Infinity,mask:0,object:null}},deallocator:function(a){a.object=null;return a}}),z=k.empty(),w=l.vec3f64.create(),q=l.vec3f64.create(),y=new a({deallocator:null}),A=new a({deallocator:null}),B=function(){var a=new Int8Array(216),b=0,c=function(c){for(var d=0;d<c.length;d++)a[b+d]=c[d];b+=8};c([3,0,6,
2,3,1,5,4]);c([2,0,2,3,1,5,4,0]);c([3,1,0,2,3,7,5,4]);c([2,0,1,3,2,6,4,0]);c([1,0,1,3,2,0,0,0]);c([2,1,5,7,3,2,0,0]);c([3,2,0,1,3,7,6,4]);c([2,2,0,1,3,7,6,0]);c([3,3,0,1,5,7,6,2]);c([2,0,1,5,4,6,2,0]);c([1,0,1,5,4,0,0,0]);c([2,1,3,7,5,4,0,0]);c([1,0,2,6,4,0,0,0]);c([0,0,0,0,0,0,0,0]);c([1,1,3,7,5,0,0,0]);c([2,2,3,7,6,4,0,0]);c([1,2,3,7,6,0,0,0]);c([2,3,1,5,7,6,2,0]);c([3,4,0,1,5,7,6,2]);c([2,5,7,6,4,0,1,0]);c([3,5,0,1,3,7,6,4]);c([2,4,5,7,6,2,0,0]);c([1,4,5,7,6,0,0,0]);c([2,5,1,3,7,6,4,0]);c([3,6,
0,2,3,7,5,4]);c([2,6,2,3,7,5,4,0]);c([3,7,6,2,3,1,5,4]);return a}(),C=4,F=h.mat3f64.create(),H=f.quatf64.create(),I=l.vec3f64.create(),G=l.vec3f64.create(),J=l.vec3f64.create(),E=l.vec3f64.create(),L=l.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["require","exports"],function(n,b){function a(a,b){return{near:a,far:b}}function m(a,b,f){a.near=b;a.far=f;return a}Object.defineProperty(b,"__esModule",{value:!0});b.create=a;b.empty=function(b){return b?m(b,Infinity,
-Infinity):a(Infinity,-Infinity)};b.set=m;b.union=function(a,b,f){void 0===f&&(f=a);f.near=Math.min(a.near,b.near);f.far=Math.max(a.far,b.far);return f};b.within=function(a,b){return a.near<=b&&b<=a.far}})},"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["require","exports","../../../support/buffer/InterleavedLayout"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.createVertexBufferLayout=function(b){var h=a.newLayout().vec3f("position");b.normals&&
h.vec2i16("normalCompressed",{glNormalized:!0});1===b.textureCoordinates?h.vec2f("uv0"):2===b.textureCoordinates&&(h.vec2f("uv0"),h.vec4u16("uvRegion",{glNormalized:!0}));b.colors&&h.vec4u8("color",{glNormalized:!0});return h.alignTo(4)}})},"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a){this._totalCount=a;this._indexRanges=
[0,a]}a.prototype.componentCount=function(){for(var a=this._indexRanges,b=0,e=0;e<a.length;e+=2)b+=a[e+1];return b};a.prototype.reset=function(a){if("all"===a||a.length===this._totalCount)this._indexRanges=[0,this._totalCount];else{var b=[];if(0!==a.length){for(var e=a[0],f=1,g=1;g<a.length;g++){var l=a[g];e+f===l?f+=1:(b.push(e),b.push(f),e=l,f=1)}b.push(e);b.push(f)}this._indexRanges=b}};a.prototype.forEachComponent=function(a){for(var b=this._indexRanges,e=0;e<b.length;e+=2)for(var f=b[e],g=f+
b[e+1];f<g;f++)if(!a(f))return!1;return!0};a.prototype.forEachComponentRange=function(a){for(var b=this._indexRanges,e=0;e<b.length;e+=2){var f=b[e];if(!a(f,f+b[e+1]))return!1}return!0};a.prototype.computeOffsetRanges=function(a){for(var b=Array(this._indexRanges.length),e=this._indexRanges,f=0;f<e.length;f+=2){var g=e[f],l=a[g],g=a[g+e[f+1]];b[f]=l;b[f+1]=g-l}return b};return a}();b.ComponentRangeRunLengthEncoded=n})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("require exports tslib ../../../../../../core/maybe ../../../../../../core/libs/gl-matrix-2/vec3 ../../../../../../core/libs/gl-matrix-2/vec3f32 ../../../../../../core/libs/gl-matrix-2/vec4 ../../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../../../core/libs/gl-matrix-2/vec4f64 ./ComponentTechnique ./shader/ComponentShader.glsl ../../../core/material/MaterialBase ../../../core/shaderLibrary/util/AlphaDiscard.glsl".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p){function r(a){switch(a){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 7}}Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function n(){var a=b.call(this)||this;a.baseColor=g.vec4f32.fromValues(1,1,1,1);a.usePBR=!1;a.mrrFactors=e.vec3f32.fromValues(1,1,.5);a.emissiveFactor=e.vec3f32.fromValues(0,0,0);a.baseColorTexture=null;a.metallicRoughnessTexture=null;a.emissionTexture=null;a.occlusionTexture=null;a.normalTexture=null;a.overlayTexOffset=
l.vec4f64.fromValues(-1,-1,-1,-1);a.overlayTexScale=l.vec4f64.fromValues(0,0,0,0);a.overlayColorInner=null;a.overlayColorOuter=null;a.overlayHighlightInner=null;a.overlayHighlightOuter=null;a.overlayNormalInner=null;a.overlayNormalOuter=null;a.objectOpacity=1;a.commonMaterialParameters=new t;a.componentParameters=new u;a.alphaCutoff=p.defaultMaskAlphaCutoff;a.alphaDiscardMode=1;a.isIntegratedMesh=!1;a.polygonOffsetEnabled=!1;a.sceneHasOcludees=!1;a._techniqueConfig=new d.ComponentTechniqueConfiguration;
return a}a.__extends(n,b);n.prototype.dispose=function(a){this._technique&&(a.release(this._technique),this._technique=void 0);this.baseColorTexture=null};n.prototype.getTechnique=function(a,b,c){var e=this._techniqueConfig;e.hasVertexColors=c.colors;e.hasNormals=c.normals;e.vertexTextureCoordinates=c.textureCoordinates;e.usePBR=this.usePBR;e.hasMetalnessAndRoughnessTexture=m.isSome(this.metallicRoughnessTexture);e.hasEmissionTexture=m.isSome(this.emissionTexture);e.hasOcclusionTexture=m.isSome(this.occlusionTexture);
e.hasNormalTexture=m.isSome(this.normalTexture);this.dirty&&(e.componentData=this.componentParameters.type,e.cullFace=this.commonMaterialParameters.cullFace,e.doubleSidedMode=this.commonMaterialParameters.doubleSided?1:0,e.baseColorTexture=m.isSome(this.baseColorTexture),c=this._computeWhichMaterialPass(),e.blendingEnabled=1===c||2===c,e.alphaDiscardMode=this.alphaDiscardMode,e.integratedMeshMode=this.isIntegratedMesh?this.overlayColorInner||this.overlayColorOuter?this.overlayNormalInner||this.overlayNormalOuter?
3:2:1:0,e.polygonOffsetEnabled=this.polygonOffsetEnabled,this._setClean());e.slicePlaneEnabled=b.slicePlaneEnabled&&this.commonMaterialParameters.slicePlaneEnabled;1===b.identifier?(e.output=3,e.vertexDiscardMode=0):2===b.identifier?(e.output=4,e.vertexDiscardMode=0):(2===this._computeWhichMaterialPass()?e.vertexDiscardMode=b.transparent?2:1:e.vertexDiscardMode=0,e.output=r(b.subPass),0===b.subPass?(e.receiveAmbientOcclusion=b.ambientOcclusionEnabled,e.sceneHasOcludees=b.sceneHasOcludees,e.receiveShadows=
b.shadowsEnabled,e.ssrEnabled=b.ssrParams.ssrEnabled):(e.receiveAmbientOcclusion=!1,e.receiveShadows=!1));return this._technique=a.repository.acquireAndReleaseExisting(d.ComponentTechnique,e,this._technique)};n.prototype.submit=function(a,b){var c=b.renderable.geometry,d=b.components,e=b.renderable.drawParameters;b=b.renderable.meta.cameraDepthSquared;var f=d.geometryRanges,d=d.highlightRanges;switch(this._computeWhichMaterialPass()){case 0:a.materialOpaque.submitDraw(this,c,f,e,b);break;case 1:a.materialTransparent.submitDraw(this,
c,f,e,b);break;case 2:a.materialOpaque.submitDraw(this,c,f,e,b);a.materialTransparent.submitDraw(this,c,f,e,b);break;case 3:a.materialIntegratedMesh.submitDraw(this,c,f,e,b),(this.overlayHighlightInner||this.overlayHighlightOuter)&&a.highlightIntegratedMesh.submitDraw(this,c,f,e,b)}m.isSome(a.shadowMap)&&2!==this.componentParameters.castShadows&&a.shadowMap.submitDraw(this,c,f,e,b);m.isSome(a.highlight)&&m.isSome(d)&&a.highlight.submitDraw(this,c,d,e,b)};Object.defineProperty(n.prototype,"attributeLocations",
{get:function(){return c.attributeLocations},enumerable:!0,configurable:!0});n.prototype._computeWhichMaterialPass=function(){return this.isIntegratedMesh?3:1>this.objectOpacity?1:0===this.componentParameters.opaqueOverride?0:1>this.baseColor[3]||0===this.alphaDiscardMode||3===this.alphaDiscardMode?1:2===this.componentParameters.transparent?0:0===this.componentParameters.transparent?1:2};a.__decorate([k.parameter({vectorOps:f.vec4})],n.prototype,"baseColor",void 0);a.__decorate([k.parameter()],n.prototype,
"usePBR",void 0);a.__decorate([k.parameter({vectorOps:h.vec3})],n.prototype,"mrrFactors",void 0);a.__decorate([k.parameter({vectorOps:h.vec3})],n.prototype,"emissiveFactor",void 0);a.__decorate([k.parameter({dispose:!0})],n.prototype,"baseColorTexture",void 0);a.__decorate([k.parameter({dispose:!0})],n.prototype,"metallicRoughnessTexture",void 0);a.__decorate([k.parameter({dispose:!0})],n.prototype,"emissionTexture",void 0);a.__decorate([k.parameter({dispose:!0})],n.prototype,"occlusionTexture",void 0);
a.__decorate([k.parameter({dispose:!0})],n.prototype,"normalTexture",void 0);a.__decorate([k.parameter({vectorOps:{equals:f.vec4.exactEquals,copy:f.vec4.copy}})],n.prototype,"overlayTexOffset",void 0);a.__decorate([k.parameter({vectorOps:{equals:f.vec4.exactEquals,copy:f.vec4.copy}})],n.prototype,"overlayTexScale",void 0);a.__decorate([k.parameter()],n.prototype,"overlayColorInner",void 0);a.__decorate([k.parameter()],n.prototype,"overlayColorOuter",void 0);a.__decorate([k.parameter()],n.prototype,
"overlayHighlightInner",void 0);a.__decorate([k.parameter()],n.prototype,"overlayHighlightOuter",void 0);a.__decorate([k.parameter()],n.prototype,"overlayNormalInner",void 0);a.__decorate([k.parameter()],n.prototype,"overlayNormalOuter",void 0);a.__decorate([k.parameter()],n.prototype,"objectOpacity",void 0);a.__decorate([k.parameterBlock()],n.prototype,"commonMaterialParameters",void 0);a.__decorate([k.parameterBlock()],n.prototype,"componentParameters",void 0);a.__decorate([k.parameter()],n.prototype,
"alphaCutoff",void 0);a.__decorate([k.parameter()],n.prototype,"alphaDiscardMode",void 0);a.__decorate([k.parameter()],n.prototype,"isIntegratedMesh",void 0);a.__decorate([k.parameter()],n.prototype,"polygonOffsetEnabled",void 0);a.__decorate([k.parameter()],n.prototype,"sceneHasOcludees",void 0);return n}(k.MaterialBase);b.ComponentMaterial=n;var t=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.doubleSided=!1;a.cullFace=2;a.slicePlaneEnabled=!0;return a}a.__extends(c,b);
a.__decorate([k.parameter()],c.prototype,"doubleSided",void 0);a.__decorate([k.parameter()],c.prototype,"cullFace",void 0);a.__decorate([k.parameter()],c.prototype,"slicePlaneEnabled",void 0);return c}(k.MaterialParameterBlock);b.CommonMaterialParameters=t;var u=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.externalColor=g.vec4f32.fromValues(1,1,1,1);a.externalColorMixMode=1;a.castShadows=0;return a}a.__extends(c,b);Object.defineProperty(c.prototype,"transparent",{get:function(){return 1>
this.externalColor[3]?0:2},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"opaqueOverride",{get:function(){return 3===this.externalColorMixMode&&1===this.externalColor[3]?0:2},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"visible",{get:function(){return 0<this.externalColor[3]?0:2},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"type",{get:function(){return 0},enumerable:!0,configurable:!0});a.__decorate([k.parameter({vectorOps:f.vec4})],
c.prototype,"externalColor",void 0);a.__decorate([k.parameter()],c.prototype,"externalColorMixMode",void 0);a.__decorate([k.parameter()],c.prototype,"castShadows",void 0);return c}(k.MaterialParameterBlock);b.ComponentParametersUniform=u;n=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.texture=null;a.transparent=2;a.opaqueOverride=2;a.castShadows=2;return a}a.__extends(c,b);Object.defineProperty(c.prototype,"type",{get:function(){return 1},enumerable:!0,configurable:!0});
a.__decorate([k.parameter()],c.prototype,"texture",void 0);a.__decorate([k.parameter()],c.prototype,"transparent",void 0);a.__decorate([k.parameter()],c.prototype,"opaqueOverride",void 0);a.__decorate([k.parameter()],c.prototype,"castShadows",void 0);return c}(k.MaterialParameterBlock);b.ComponentParametersVarying=n})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports tslib ../../../../../../core/maybe ../../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../../core/libs/gl-matrix-2/vec4f64 ./shader/ComponentShader.glsl ../../../core/shaderLibrary/Slice.glsl ../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../core/shaderLibrary/output/OutputHighlight.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/StencilUtils ../../../../../webgl/Program ../../../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w){Object.defineProperty(b,"__esModule",{value:!0});b.TextureUnits={DIFFUSE:0,COMPONENT_COLOR:1,NORMAL:2,EMISSION:3,OCCLUSION:4,METALLIC_ROUGHNESS:5,OVERLAY0_COLOR:2,OVERLAY1_COLOR:3,OVERLAY0_NORMAL:4,OVERLAY1_NORMAL:5,SSAO:6,SHADOW_MAP:7,PREPASS_LINEAR_DEPTH:8,LAST_FRAME_COLOR:9};t=function(e){function h(){return null!==e&&e.apply(this,arguments)||this}a.__extends(h,e);h.prototype.bindPass=function(a,c){var e=this.program;l.VertexPosition.bindViewProjTransform(e,
c.viewTransform);g.Slice.bindUniforms(this.program,this.configuration,c.slicePlane);0===c.identifier&&void 0!==c.ssrParams&&(c.ssrParams.lastFrameColorTextureID=b.TextureUnits.LAST_FRAME_COLOR,c.ssrParams.linearDepthTextureID=b.TextureUnits.PREPASS_LINEAR_DEPTH,k.ScreenSpaceReflections.bindUniforms(this.program,a,c.ssrParams));0===c.identifier&&(e.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",c.transformNormal_ViewFromGlobal),1===c.subPass&&e.setUniform2fv("uCameraNearFar",c.cameraNearFar),
0===c.subPass&&(c.ambientOcclusionEnabled&&c.ambientOcclusion.bind(e,b.TextureUnits.SSAO),c.shadowsEnabled&&c.shadowMap.bind(e,b.TextureUnits.SHADOW_MAP),c.lighting.setUniforms(this.program,c.integratedMesh)));1===c.identifier&&this.program.setUniform2fv("uCameraNearFar",c.cameraNearFar);2===c.identifier&&d.OutputHighlight.bindOutputHighlight(a,this.program,c)};h.prototype.bindDraw=function(a,b){l.VertexPosition.bindModelTransform(this.program,a);this.program.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",
a.transformNormal_GlobalFromModel);if(b.isIntegratedMesh){var c=b.overlayTexScale;b=b.overlayTexOffset;this.program.setUniform4fv("overlayTexOffset",[a.toMapSpace[0]*c[0]+b[0],a.toMapSpace[1]*c[1]+b[1],a.toMapSpace[0]*c[2]+b[2],a.toMapSpace[1]*c[3]+b[3]]);this.program.setUniform4fv("overlayTexScale",[a.toMapSpace[2]*c[0],a.toMapSpace[3]*c[1],a.toMapSpace[2]*c[2],a.toMapSpace[3]*c[3]])}};h.prototype.bindMaterial=function(a,d,e){var f=this.program;f.setUniform4fv("uBaseColor",d.baseColor);f.setUniform1f("uObjectOpacity",
d.objectOpacity);f.setUniform1f("textureAlphaCutoff",d.alphaCutoff);1===d.componentParameters.type?d.componentParameters.texture.bind(f,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:b.TextureUnits.COMPONENT_COLOR}):(f.setUniform4fv("uExternalColor",d.componentParameters.externalColor),f.setUniform1i("uExternalColorMixMode",d.componentParameters.externalColorMixMode));m.isSome(d.baseColorTexture)&&d.baseColorTexture.bind(a,f,"uBaseColorTexture",b.TextureUnits.DIFFUSE,"uBaseColorTextureSize");
0===this.configuration.output&&(c.PhysicallyBasedRenderingParameters.bindUniforms(this.program,d),m.isSome(d.metallicRoughnessTexture)&&d.metallicRoughnessTexture.bind(a,f,"texMetallicRoughness",b.TextureUnits.METALLIC_ROUGHNESS,"texMetallicRoughnessSize"),m.isSome(d.emissionTexture)&&d.emissionTexture.bind(a,f,"texEmission",b.TextureUnits.EMISSION,"texEmissionSize"),m.isSome(d.occlusionTexture)&&d.occlusionTexture.bind(a,f,"texOcclusion",b.TextureUnits.OCCLUSION,"texOcclusionSize"),m.isSome(d.normalTexture)&&
d.normalTexture.bind(a,f,"normalTexture",b.TextureUnits.NORMAL,"normalTextureSize"));d.isIntegratedMesh&&(0===e.identifier&&0===e.subPass?(a.bindTexture(m.unwrap(d.overlayColorInner),b.TextureUnits.OVERLAY0_COLOR),a.bindTexture(m.unwrap(d.overlayColorOuter),b.TextureUnits.OVERLAY1_COLOR),a.bindTexture(m.unwrap(d.overlayNormalInner),b.TextureUnits.OVERLAY0_NORMAL),a.bindTexture(m.unwrap(d.overlayNormalOuter),b.TextureUnits.OVERLAY1_NORMAL),f.setUniform1i("ovInnerNormalTex",b.TextureUnits.OVERLAY0_NORMAL),
f.setUniform1i("ovOuterNormalTex",b.TextureUnits.OVERLAY1_NORMAL)):2===e.identifier&&(a.bindTexture(m.unwrap(d.overlayHighlightInner),b.TextureUnits.OVERLAY0_COLOR),a.bindTexture(m.unwrap(d.overlayHighlightOuter),b.TextureUnits.OVERLAY1_COLOR)),f.setUniform1i("ovInnerColorTex",b.TextureUnits.OVERLAY0_COLOR),f.setUniform1i("ovOuterColorTex",b.TextureUnits.OVERLAY1_COLOR),f.setUniform1f("overlayOpacity",1))};h.prototype.initializeProgram=function(a){var b=h.shader.get(),c=this.configuration,c=b.build({output:c.output,
normalType:0===c.integratedMeshMode?c.hasNormals?1:3:2,attributeColor:c.hasVertexColors,attributeTextureCoordinates:c.vertexTextureCoordinates,componentData:c.componentData,alphaDiscardMode:c.alphaDiscardMode,baseColorTexture:c.baseColorTexture,doubleSidedMode:c.doubleSidedMode,receiveAmbientOcclusion:c.receiveAmbientOcclusion,receiveShadows:c.receiveShadows,slicePlaneEnabled:c.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,viewingMode:a.viewingMode,vertexDiscardMode:c.vertexDiscardMode,
pbrMode:3===c.integratedMeshMode?4:c.usePBR?1:0,hasMetalnessAndRoughnessTexture:c.hasMetalnessAndRoughnessTexture,hasEmissionTexture:c.hasEmissionTexture,hasOcclusionTexture:c.hasOcclusionTexture,hasNormalTexture:c.hasNormalTexture,vertexTangets:!1,useOldSceneLightInterface:!1,supportsTextureAtlas:!0,doublePrecisionRequiresObfuscation:p.doublePrecisionRequiresObfuscation(a.rctx),overlayEnabled:2===c.integratedMeshMode||3===c.integratedMeshMode,ssrEnabled:c.ssrEnabled,highStepCount:!1});return new z(a.rctx,
c.generateSource("vertex"),c.generateSource("fragment"),b.attributeLocations)};h.prototype.initializePipeline=function(){var a=this.configuration,b=0!==a.integratedMeshMode;return w.makePipelineState({blending:0===a.output&&a.blendingEnabled?q:null,culling:A[a.cullFace],depthTest:{func:513},depthWrite:w.defaultDepthWriteParams,colorWrite:w.defaultColorWriteParams,stencilWrite:b||a.sceneHasOcludees?v.stencilWriteMaskOn:null,stencilTest:b?v.replaceBitWhenDepthTestPasses(1):a.sceneHasOcludees?v.stencilBaseAllZerosParams:
null,polygonOffset:a.polygonOffsetEnabled?y:null})};h.shader=new r.ReloadableShaderModule(f,function(){return new Promise(function(a,b){n(["./shader/ComponentShader.glsl"],a,b)})});return h}(t.ShaderTechnique);b.ComponentTechnique=t;var q=w.separateBlendingParams(770,1,771,771),y={factor:2,units:2},A=[null,{face:1028,mode:2305},{face:1029,mode:2305}];t=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.transformNormal_GlobalFromModel=h.mat3f64.create();a.toMapSpace=e.vec4f64.create();
return a}a.__extends(c,b);return c}(l.VertexPosition.ModelTransform);b.ComponentDrawParameters=t;t=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.output=0;a.hasVertexColors=!1;a.hasNormals=!1;a.vertexTextureCoordinates=0;a.componentData=0;a.slicePlaneEnabled=!1;a.cullFace=2;a.baseColorTexture=!1;a.receiveAmbientOcclusion=!0;a.receiveShadows=!0;a.vertexDiscardMode=0;a.doubleSidedMode=2;a.blendingEnabled=!0;a.alphaDiscardMode=1;a.integratedMeshMode=0;a.ssrEnabled=!1;a.polygonOffsetEnabled=
!1;a.usePBR=!1;a.hasMetalnessAndRoughnessTexture=!1;a.hasEmissionTexture=!1;a.hasOcclusionTexture=!1;a.hasNormalTexture=!1;a.sceneHasOcludees=!1;return a}a.__extends(c,b);a.__decorate([u.parameter({count:7})],c.prototype,"output",void 0);a.__decorate([u.parameter()],c.prototype,"hasVertexColors",void 0);a.__decorate([u.parameter()],c.prototype,"hasNormals",void 0);a.__decorate([u.parameter({count:3})],c.prototype,"vertexTextureCoordinates",void 0);a.__decorate([u.parameter({count:2})],c.prototype,
"componentData",void 0);a.__decorate([u.parameter()],c.prototype,"slicePlaneEnabled",void 0);a.__decorate([u.parameter({count:3})],c.prototype,"cullFace",void 0);a.__decorate([u.parameter()],c.prototype,"baseColorTexture",void 0);a.__decorate([u.parameter()],c.prototype,"receiveAmbientOcclusion",void 0);a.__decorate([u.parameter()],c.prototype,"receiveShadows",void 0);a.__decorate([u.parameter({count:3})],c.prototype,"vertexDiscardMode",void 0);a.__decorate([u.parameter({count:3})],c.prototype,"doubleSidedMode",
void 0);a.__decorate([u.parameter()],c.prototype,"blendingEnabled",void 0);a.__decorate([u.parameter({count:4})],c.prototype,"alphaDiscardMode",void 0);a.__decorate([u.parameter({count:4})],c.prototype,"integratedMeshMode",void 0);a.__decorate([u.parameter()],c.prototype,"ssrEnabled",void 0);a.__decorate([u.parameter()],c.prototype,"polygonOffsetEnabled",void 0);a.__decorate([u.parameter()],c.prototype,"usePBR",void 0);a.__decorate([u.parameter()],c.prototype,"hasMetalnessAndRoughnessTexture",void 0);
a.__decorate([u.parameter()],c.prototype,"hasEmissionTexture",void 0);a.__decorate([u.parameter()],c.prototype,"hasOcclusionTexture",void 0);a.__decorate([u.parameter()],c.prototype,"hasNormalTexture",void 0);a.__decorate([u.parameter()],c.prototype,"sceneHasOcludees",void 0);return c}(u.ShaderTechniqueConfiguration);b.ComponentTechniqueConfiguration=t})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentShader.glsl":function(){define("require exports tslib ../../../../../support/earthUtils ./ComponentData.glsl ./VertexDiscardByOpacity.glsl ../../../../core/shaderLibrary/ForwardLinearDepth.glsl ../../../../core/shaderLibrary/Slice.glsl ../../../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../../../../core/shaderLibrary/attributes/VertexColor.glsl ../../../../core/shaderLibrary/attributes/VertexNormal.glsl ../../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../../core/shaderLibrary/output/OutputDepth.glsl ../../../../core/shaderLibrary/output/OutputHighlight.glsl ../../../../core/shaderLibrary/shading/ComputeMaterialColor.glsl ../../../../core/shaderLibrary/shading/ComputeNormalTexture.glsl ../../../../core/shaderLibrary/shading/ComputeShadingNormal.glsl ../../../../core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../../core/shaderLibrary/shading/ReadBaseColorTexture.glsl ../../../../core/shaderLibrary/shading/ReadShadowMap.glsl ../../../../core/shaderLibrary/terrain/Overlay.glsl ../../../../core/shaderLibrary/util/AlphaDiscard.glsl ../../../../core/shaderModules/interfaces ../../../../core/shaderModules/ShaderBuilder".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F){Object.defineProperty(b,"__esModule",{value:!0});b.attributeLocations={position:0,normal:1,normalCompressed:1,color:2,uv0:3,uvRegion:4,componentIndex:5};b.build=function(b){var n=new F.ShaderBuilder;n.include(k.VertexPosition,b);n.include(c.VertexNormal,b);n.include(d.VertexColor,b);n.include(l.TextureCoordinateAttribute,b);n.include(f.ForwardLinearDepth,b);n.include(h.ComponentData,b);n.include(B.DiscardOrAdjustAlpha,b);n.include(g.Slice,
b);n.include(q.ReadBaseColorTexture,b);n.include(e.VertexDiscardByOpacity,b);n.fragment.uniforms.add("view","mat4");if(1===b.pbrMode||2===b.pbrMode)n.include(w.PhysicallyBasedRenderingParameters,b),n.include(u.ComputeNormalTexture,b);3===b.output&&1===b.componentData?n.vertex.code.add(C.glsl(H||(H=a.__makeTemplateObject(["\n      #define discardShadows(castShadows) { if(!castShadows) { gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n    "],["\n      #define discardShadows(castShadows) { if(!castShadows) { gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n    "])))):
n.vertex.code.add(C.glsl(I||(I=a.__makeTemplateObject(["\n      #define discardShadows(castShadows) {}\n    "],["\n      #define discardShadows(castShadows) {}\n    "]))));var ua=b.overlayEnabled&&0===b.output&&4===b.pbrMode;b.overlayEnabled&&(n.include(A.Overlay,b),0===b.viewingMode?n.vertex.code.add(C.glsl(G||(G=a.__makeTemplateObject(["\n      const float invEarthRadius \x3d ",";\n      vec2 projectOverlay(vec3 pos) {\n        return pos.xy / (1.0 + invEarthRadius * pos.z);\n      }\n      "],
["\n      const float invEarthRadius \x3d ",";\n      vec2 projectOverlay(vec3 pos) {\n        return pos.xy / (1.0 + invEarthRadius * pos.z);\n      }\n      "])),C.glsl.float(1/m.earthRadius))):n.vertex.code.add(C.glsl(J||(J=a.__makeTemplateObject(["\n      vec2 projectOverlay(vec3 pos) { return pos.xy; }\n      "],["\n      vec2 projectOverlay(vec3 pos) { return pos.xy; }\n      "])))));ua&&(n.varyings.add("tbnTangent","vec3"),n.varyings.add("tbnBiTangent","vec3"),n.varyings.add("groundNormal",
"vec3"),n.varyings.add("positionView","vec3"));n.vertex.code.add(C.glsl(Q||(Q=a.__makeTemplateObject(["\n    void main() {\n      bool castShadows;\n      vec4 externalColor \x3d forwardExternalColor(castShadows);\n      discardShadows(castShadows);\n\n      vertexDiscardByOpacity(externalColor.a);\n\n      if (externalColor.a \x3c ",") {\n        // Discard this vertex\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n      forwardPosition();\n      forwardNormal();\n      ",
"\n\n      ","\n      forwardTextureCoordinates();\n      forwardVertexColor();\n      forwardLinearDepth(); // depends on forwardPosition()\n    }\n  "],["\n    void main() {\n      bool castShadows;\n      vec4 externalColor \x3d forwardExternalColor(castShadows);\n      discardShadows(castShadows);\n\n      vertexDiscardByOpacity(externalColor.a);\n\n      if (externalColor.a \x3c ",") {\n        // Discard this vertex\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n      forwardPosition();\n      forwardNormal();\n      ",
"\n\n      ","\n      forwardTextureCoordinates();\n      forwardVertexColor();\n      forwardLinearDepth(); // depends on forwardPosition()\n    }\n  "])),C.glsl.float(B.symbolAlphaCutoff),ua?C.glsl(M||(M=a.__makeTemplateObject(["\n        positionView \x3d position_view();\n        ","\n        "],["\n        positionView \x3d position_view();\n        ","\n        "])),0===b.viewingMode?C.glsl(E||(E=a.__makeTemplateObject(["\n        groundNormal \x3d normalize(positionWorld());\n        tbnTangent \x3d normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));\n        tbnBiTangent \x3d normalize(cross(groundNormal, tbnTangent));"],
["\n        groundNormal \x3d normalize(positionWorld());\n        tbnTangent \x3d normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));\n        tbnBiTangent \x3d normalize(cross(groundNormal, tbnTangent));"]))):C.glsl(L||(L=a.__makeTemplateObject(["\n        groundNormal \x3d vec3(0.0, 0.0, 1.0);\n        tbnTangent \x3d vec3(1.0, 0.0, 0.0);\n        tbnBiTangent \x3d normalize(cross(groundNormal, tbnTangent));"],["\n        groundNormal \x3d vec3(0.0, 0.0, 1.0);\n        tbnTangent \x3d vec3(1.0, 0.0, 0.0);\n        tbnBiTangent \x3d normalize(cross(groundNormal, tbnTangent));"])))):
"",b.overlayEnabled?C.glsl(N||(N=a.__makeTemplateObject(["setOverlayVTC(projectOverlay(position));"],["setOverlayVTC(projectOverlay(position));"]))):""));0===b.output&&(n.include(t.ComputeMaterialColor,b),n.include(v.ComputeShadingNormal,b),n.include(z.EvaluateSceneLighting,b),ua&&(n.fragment.uniforms.add("ovInnerNormalTex","sampler2D"),n.fragment.uniforms.add("ovOuterNormalTex","sampler2D")),b.receiveShadows?(n.include(y.ReadShadowMap,b),n.fragment.code.add(C.glsl(R||(R=a.__makeTemplateObject(["\n        float evaluateShadow() {\n          return readShadowMap(vPositionWorldCameraRelative, linearDepth);\n        }\n      "],
["\n        float evaluateShadow() {\n          return readShadowMap(vPositionWorldCameraRelative, linearDepth);\n        }\n      "]))))):n.fragment.code.add(C.glsl(W||(W=a.__makeTemplateObject(["\n        float evaluateShadow() { return 0.0; }\n      "],["\n        float evaluateShadow() { return 0.0; }\n      "])))),n.fragment.code.add(C.glsl(U||(U=a.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        vec4 externalColor;\n        int externalColorMixMode;\n        readExternalColor(externalColor, externalColorMixMode);\n\n        vec4 materialColor \x3d computeMaterialColor(\n          textureColor,\n          externalColor,\n          externalColorMixMode\n        );\n        ",
"\n    "],["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        vec4 externalColor;\n        int externalColorMixMode;\n        readExternalColor(externalColor, externalColorMixMode);\n\n        vec4 materialColor \x3d computeMaterialColor(\n          textureColor,\n          externalColor,\n          externalColorMixMode\n        );\n        ","\n    "])),b.overlayEnabled?
C.glsl(O||(O=a.__makeTemplateObject(["\n        vec4 overlayColorOpaque \x3d getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n        vec4 overlayColor \x3d overlayOpacity * overlayColorOpaque;\n        materialColor \x3d materialColor * (1.0 - overlayColor.a) + overlayColor;"],["\n        vec4 overlayColorOpaque \x3d getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n        vec4 overlayColor \x3d overlayOpacity * overlayColorOpaque;\n        materialColor \x3d materialColor * (1.0 - overlayColor.a) + overlayColor;"]))):
"")),1===b.pbrMode||2===b.pbrMode?(n.fragment.code.add(C.glsl(ba||(ba=a.__makeTemplateObject(["\n        ","\n        vec3 normalVertex \x3d shadingNormalWorld();\n        float additionalIrradiance \x3d 0.02 * lightingMainIntensity[2];\n      "],["\n        ","\n        vec3 normalVertex \x3d shadingNormalWorld();\n        float additionalIrradiance \x3d 0.02 * lightingMainIntensity[2];\n      "])),1===b.pbrMode?C.glsl(P||(P=a.__makeTemplateObject(["\n        applyPBRFactors();\n        if (int(externalColorMixMode) \x3d\x3d 3) {\n          mrr \x3d vec3(0.0, 0.6, 0.2);\n        }"],
["\n        applyPBRFactors();\n        if (int(externalColorMixMode) \x3d\x3d 3) {\n          mrr \x3d vec3(0.0, 0.6, 0.2);\n        }"]))):"")),b.hasNormalTexture?n.fragment.code.add(C.glsl(V||(V=a.__makeTemplateObject(["\n        mat3 tangentSpace \x3d computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);\n        vec3 shadingNormal \x3d computeTextureNormal(tangentSpace, vuv0);\n        "],["\n        mat3 tangentSpace \x3d computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);\n        vec3 shadingNormal \x3d computeTextureNormal(tangentSpace, vuv0);\n        "])))):
n.fragment.code.add(C.glsl(T||(T=a.__makeTemplateObject(["\n        vec3 shadingNormal \x3d normalVertex;\n        "],["\n        vec3 shadingNormal \x3d normalVertex;\n        "])))),n.fragment.code.add(C.glsl(da||(da=a.__makeTemplateObject(["","\n      "],["","\n      "])),0===b.viewingMode?C.glsl(X||(X=a.__makeTemplateObject(["vec3 normalGround \x3d normalize(positionWorld());"],["vec3 normalGround \x3d normalize(positionWorld());"]))):C.glsl(Y||(Y=a.__makeTemplateObject(["vec3 normalGround \x3d vec3(0.0, 0.0, 1.0);"],
["vec3 normalGround \x3d vec3(0.0, 0.0, 1.0);"]))))),n.fragment.code.add(C.glsl(fa||(fa=a.__makeTemplateObject(["\n        vec3 viewDir \x3d normalize(vPositionWorldCameraRelative);\n        float ssao \x3d 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());\n        vec3 additionalLight \x3d evaluateAdditionalLighting(ssao, positionWorld());\n        vec4 shadedColor \x3d vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);\n        "],
["\n        vec3 viewDir \x3d normalize(vPositionWorldCameraRelative);\n        float ssao \x3d 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());\n        vec3 additionalLight \x3d evaluateAdditionalLighting(ssao, positionWorld());\n        vec4 shadedColor \x3d vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);\n        "]))))):(b.receiveShadows?n.fragment.code.add(C.glsl(ga||
(ga=a.__makeTemplateObject(["\n      float shadow \x3d evaluateShadow();\n        "],["\n      float shadow \x3d evaluateShadow();\n        "])))):0===b.viewingMode?n.fragment.code.add(C.glsl(ka||(ka=a.__makeTemplateObject(["\n      float additionalAmbientScale \x3d _oldHeuristicLighting(positionWorld());\n      float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n        "],["\n      float additionalAmbientScale \x3d _oldHeuristicLighting(positionWorld());\n      float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n        "])))):
n.fragment.code.add(C.glsl(la||(la=a.__makeTemplateObject(["\n      float shadow \x3d 0.0;\n      "],["\n      float shadow \x3d 0.0;\n      "])))),n.fragment.code.add(C.glsl(Z||(Z=a.__makeTemplateObject(["\n      float ambientOcclusion \x3d evaluateAmbientOcclusion();\n      // At global scale we create some additional ambient light based on the main light to simulate global illumination\n      vec3 additionalLight \x3d evaluateAdditionalLighting(ambientOcclusion, positionWorld());\n      vec4 shadedColor \x3d vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);\n      ",
"\n      "],["\n      float ambientOcclusion \x3d evaluateAmbientOcclusion();\n      // At global scale we create some additional ambient light based on the main light to simulate global illumination\n      vec3 additionalLight \x3d evaluateAdditionalLighting(ambientOcclusion, positionWorld());\n      vec4 shadedColor \x3d vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);\n      ","\n      "])),ua?C.glsl(ia||(ia=a.__makeTemplateObject(["\n          vec4 overlayWaterMask \x3d getOverlayColor(ovInnerNormalTex, ovOuterNormalTex, vtcOverlay);\n          float waterNormalLength \x3d length(overlayWaterMask);\n          if (waterNormalLength \x3e 0.95) {\n            mat3 tbnMatrix \x3d mat3(tbnTangent, tbnBiTangent, groundNormal);\n            vec4 waterOverlayColor \x3d vec4(overlayColorOpaque.xyz, overlayColor.w);\n            vec4 waterColorLinear \x3d getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, positionView);\n            vec4 waterColorNonLinear \x3d delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));\n            // un-gamma the ground color to mix in linear space\n            shadedColor \x3d mix(shadedColor, waterColorNonLinear, waterColorLinear.w);\n          }"],
["\n          vec4 overlayWaterMask \x3d getOverlayColor(ovInnerNormalTex, ovOuterNormalTex, vtcOverlay);\n          float waterNormalLength \x3d length(overlayWaterMask);\n          if (waterNormalLength \x3e 0.95) {\n            mat3 tbnMatrix \x3d mat3(tbnTangent, tbnBiTangent, groundNormal);\n            vec4 waterOverlayColor \x3d vec4(overlayColorOpaque.xyz, overlayColor.w);\n            vec4 waterColorLinear \x3d getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, positionView);\n            vec4 waterColorNonLinear \x3d delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));\n            // un-gamma the ground color to mix in linear space\n            shadedColor \x3d mix(shadedColor, waterColorNonLinear, waterColorLinear.w);\n          }"]))):
""))),n.fragment.code.add(C.glsl(oa||(oa=a.__makeTemplateObject(["\n        gl_FragColor \x3d highlightSlice(shadedColor, vPositionWorldCameraRelative);\n      }\n    "],["\n        gl_FragColor \x3d highlightSlice(shadedColor, vPositionWorldCameraRelative);\n      }\n    "])))));if(1===b.output||3===b.output)n.include(p.OutputDepth,b),n.fragment.code.add(C.glsl(aa||(aa=a.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        outputDepth(linearDepth);\n      }\n    "],
["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        outputDepth(linearDepth);\n      }\n    "]))));2===b.output&&(n.include(v.ComputeShadingNormal,b),n.fragment.code.add(C.glsl(na||(na=a.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        // note: the alpha component needs to be 1.0 in order for this material\n        // to influence ambient occlusion, see the ssao fragment shader\n        float alpha \x3d ",
";\n        gl_FragColor \x3d vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);\n      }\n    "],["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        // note: the alpha component needs to be 1.0 in order for this material\n        // to influence ambient occlusion, see the ssao fragment shader\n        float alpha \x3d ",";\n        gl_FragColor \x3d vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);\n      }\n    "])),
2===b.normalType?"0.0":"1.0")));4===b.output&&(n.include(r.OutputHighlight),n.fragment.code.add(C.glsl(ta||(ta=a.__makeTemplateObject(["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        ","\n\n        outputHighlight();\n      }\n    "],["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        ",
"\n\n        outputHighlight();\n      }\n    "])),b.overlayEnabled?C.glsl(ja||(ja=a.__makeTemplateObject(["\n        vec4 overlayColor \x3d getCombinedOverlayColor();\n\n        if (overlayColor.a \x3d\x3d 0.0) {\n          gl_FragColor \x3d vec4(0.0);\n          return;\n        }"],["\n        vec4 overlayColor \x3d getCombinedOverlayColor();\n\n        if (overlayColor.a \x3d\x3d 0.0) {\n          gl_FragColor \x3d vec4(0.0);\n          return;\n        }"]))):"")));return n};var H,I,G,J,E,L,
M,N,Q,R,W,O,U,P,ba,V,T,X,Y,da,fa,ga,ka,la,ia,Z,oa,aa,na,ja,ta})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define(["require","exports","tslib","./DecodeSymbolColor.glsl","../../../../core/shaderModules/interfaces"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.ComponentData=function(b,c){1===c.componentData&&(b.vertex.uniforms.add("uComponentColorTex","sampler2D"),b.vertex.uniforms.add("uComponentColorTexInvDim","vec2"),
b.attributes.add("componentIndex","float"),b.varyings.add("vExternalColorMixMode","mediump float"),b.varyings.add("vExternalColor","vec4"),b.include(m.DecodeSymbolColor),b.vertex.code.add(h.glsl(e||(e=a.__makeTemplateObject(["\n      vec4 _readComponentColor() {\n        float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n        vec2 indexCoord \x3d vec2(\n          mod(normalizedIndex, 1.0),\n          (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n        );\n        return texture2D(uComponentColorTex, indexCoord);\n       }\n\n      vec4 forwardExternalColor(out bool castShadows) {\n        vec4 componentColor \x3d _readComponentColor() * 255.0;\n\n        float shadowFlag \x3d mod(componentColor.b * 255.0, 2.0);\n        componentColor.b -\x3d shadowFlag;\n        castShadows \x3d shadowFlag \x3e\x3d 1.0;\n\n        int decodedColorMixMode;\n        vExternalColor \x3d decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // \x3d 1/255;\n        vExternalColorMixMode \x3d float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n\n        return vExternalColor;\n      }\n    "],
["\n      vec4 _readComponentColor() {\n        float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n        vec2 indexCoord \x3d vec2(\n          mod(normalizedIndex, 1.0),\n          (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n        );\n        return texture2D(uComponentColorTex, indexCoord);\n       }\n\n      vec4 forwardExternalColor(out bool castShadows) {\n        vec4 componentColor \x3d _readComponentColor() * 255.0;\n\n        float shadowFlag \x3d mod(componentColor.b * 255.0, 2.0);\n        componentColor.b -\x3d shadowFlag;\n        castShadows \x3d shadowFlag \x3e\x3d 1.0;\n\n        int decodedColorMixMode;\n        vExternalColor \x3d decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // \x3d 1/255;\n        vExternalColorMixMode \x3d float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n\n        return vExternalColor;\n      }\n    "])))),
b.fragment.code.add(h.glsl(f||(f=a.__makeTemplateObject(["\n      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {\n        externalColor \x3d vExternalColor;\n        externalColorMixMode \x3d int(vExternalColorMixMode);\n      }\n    "],["\n      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {\n        externalColor \x3d vExternalColor;\n        externalColorMixMode \x3d int(vExternalColorMixMode);\n      }\n    "])))));0===c.componentData&&
(b.vertex.uniforms.add("uExternalColor","vec4"),b.fragment.uniforms.add("uExternalColorMixMode","int"),b.varyings.add("vExternalColor","vec4"),b.vertex.code.add(h.glsl(g||(g=a.__makeTemplateObject(["\n      vec4 forwardExternalColor(out bool castShadows) {\n        vExternalColor \x3d uExternalColor;\n        castShadows \x3d true;\n        return uExternalColor;\n      }\n    "],["\n      vec4 forwardExternalColor(out bool castShadows) {\n        vExternalColor \x3d uExternalColor;\n        castShadows \x3d true;\n        return uExternalColor;\n      }\n    "])))),
b.fragment.code.add(h.glsl(l||(l=a.__makeTemplateObject(["\n      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {\n        externalColor \x3d vExternalColor;\n        externalColorMixMode \x3d uExternalColorMixMode;\n      }\n    "],["\n      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {\n        externalColor \x3d vExternalColor;\n        externalColorMixMode \x3d uExternalColorMixMode;\n      }\n    "])))))};var e,f,g,l})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["require",
"exports","tslib","../../../../core/shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.VertexDiscardByOpacity=function(b,d){b=b.vertex;b.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n  #define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)\n  "],["\n  #define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)\n  "]))));switch(d.vertexDiscardMode){case 0:b.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n        #define vertexDiscardByOpacity(_opacity_) {}\n      "],
["\n        #define vertexDiscardByOpacity(_opacity_) {}\n      "]))));break;case 2:b.code.add(m.glsl(f||(f=a.__makeTemplateObject(["\n        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ \x3e  VERTEX_DISCARD_CUTOFF) {  gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n      "],["\n        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ \x3e  VERTEX_DISCARD_CUTOFF) {  gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n      "]))));break;case 1:b.code.add(m.glsl(g||
(g=a.__makeTemplateObject(["\n        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ \x3c\x3d VERTEX_DISCARD_CUTOFF) {  gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n      "],["\n        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ \x3c\x3d VERTEX_DISCARD_CUTOFF) {  gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n      "]))))}};var h,e,f,g})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define("require exports tslib ../attributes/VertexColor.glsl ../util/MixExternalColor.glsl ../../shaderModules/interfaces".split(" "),
function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});b.ComputeMaterialColor=function(b,c){b.include(m.VertexColor,c);b.include(h.MixExternalColor,{stages:1});b=b.fragment;b.uniforms.add("uBaseColor","vec4");b.uniforms.add("uObjectOpacity","float");c.attributeColor?b.code.add(e.glsl(f||(f=a.__makeTemplateObject(["\n      vec3 _baseColor() {\n        // combine the old material parameters into a single one\n        return uBaseColor.rgb * vColor.rgb;\n      }\n\n      float _baseOpacity() {\n        return uBaseColor.a * vColor.a;\n      }\n    "],
["\n      vec3 _baseColor() {\n        // combine the old material parameters into a single one\n        return uBaseColor.rgb * vColor.rgb;\n      }\n\n      float _baseOpacity() {\n        return uBaseColor.a * vColor.a;\n      }\n    "])))):b.code.add(e.glsl(g||(g=a.__makeTemplateObject(["\n      vec3 _baseColor() {\n        // combine the old material parameters into a single one\n        return uBaseColor.rgb;\n      }\n\n      float _baseOpacity() {\n        return uBaseColor.a;\n      }\n    "],
["\n      vec3 _baseColor() {\n        // combine the old material parameters into a single one\n        return uBaseColor.rgb;\n      }\n\n      float _baseOpacity() {\n        return uBaseColor.a;\n      }\n    "]))));b.code.add(e.glsl(l||(l=a.__makeTemplateObject(["\n    vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {\n      vec3 baseColor \x3d _baseColor();\n      float baseOpacity \x3d _baseOpacity();\n\n      vec3 color \x3d mixExternalColor(\n        baseColor,\n        textureColor.rgb,\n        externalColor.rgb,\n        externalColorMixMode\n      );\n      float opacity \x3d uObjectOpacity * mixExternalOpacity(\n        baseOpacity,\n        textureColor.a,\n        externalColor.a,\n        externalColorMixMode\n      );\n\n      return vec4(color, opacity);\n    }\n  "],
["\n    vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {\n      vec3 baseColor \x3d _baseColor();\n      float baseOpacity \x3d _baseOpacity();\n\n      vec3 color \x3d mixExternalColor(\n        baseColor,\n        textureColor.rgb,\n        externalColor.rgb,\n        externalColorMixMode\n      );\n      float opacity \x3d uObjectOpacity * mixExternalOpacity(\n        baseOpacity,\n        textureColor.a,\n        externalColor.a,\n        externalColorMixMode\n      );\n\n      return vec4(color, opacity);\n    }\n  "]))))};
var f,g,l})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":function(){define("require exports tslib ../attributes/VertexNormal.glsl ../attributes/VertexPosition.glsl ../../shaderModules/interfaces".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});b.ComputeShadingNormal=function(b,n){var t=b.fragment;0===n.doubleSidedMode?t.code.add(e.glsl(f||(f=a.__makeTemplateObject(["\n      vec3 _adjustDoublesided(vec3 normal) {\n        return normal;\n      }\n    "],
["\n      vec3 _adjustDoublesided(vec3 normal) {\n        return normal;\n      }\n    "])))):1===n.doubleSidedMode?(b.include(h.VertexPosition,n),t.uniforms.add("uTransform_ViewFromCameraLocal_T","vec3"),t.code.add(e.glsl(g||(g=a.__makeTemplateObject(["\n      vec3 _adjustDoublesided(vec3 normal) {\n        vec3 viewDir \x3d vPositionWorldCameraRelative + uTransform_ViewFromCameraLocal_T;\n        return dot(normal, viewDir) \x3e 0.0 ? -normal : normal;\n      }\n    "],["\n      vec3 _adjustDoublesided(vec3 normal) {\n        vec3 viewDir \x3d vPositionWorldCameraRelative + uTransform_ViewFromCameraLocal_T;\n        return dot(normal, viewDir) \x3e 0.0 ? -normal : normal;\n      }\n    "]))))):
2===n.doubleSidedMode&&t.code.add(e.glsl(l||(l=a.__makeTemplateObject(["\n      vec3 _adjustDoublesided(vec3 normal) {\n        return gl_FrontFacing ? normal : -normal;\n      }\n    "],["\n      vec3 _adjustDoublesided(vec3 normal) {\n        return gl_FrontFacing ? normal : -normal;\n      }\n    "]))));0===n.normalType||1===n.normalType?(b.include(m.VertexNormal,n),t.code.add(e.glsl(d||(d=a.__makeTemplateObject(["\n      vec3 shadingNormalWorld() {\n        return _adjustDoublesided(normalize(vNormalWorld));\n      }\n\n      vec3 shadingNormal_view() {\n        vec3 normal \x3d normalize(vNormalView);\n        return gl_FrontFacing ? normal : -normal;\n      }\n    "],
["\n      vec3 shadingNormalWorld() {\n        return _adjustDoublesided(normalize(vNormalWorld));\n      }\n\n      vec3 shadingNormal_view() {\n        vec3 normal \x3d normalize(vNormalView);\n        return gl_FrontFacing ? normal : -normal;\n      }\n    "]))))):3===n.normalType?(b.extensions.add("GL_OES_standard_derivatives"),b.include(h.VertexPosition,n),t.code.add(e.glsl(c||(c=a.__makeTemplateObject(["\n      vec3 shadingNormalWorld() {\n        return normalize(cross(\n          dFdx(vPositionWorldCameraRelative),\n          dFdy(vPositionWorldCameraRelative)\n        ));\n      }\n\n      vec3 shadingNormal_view() {\n        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));\n      }\n    "],
["\n      vec3 shadingNormalWorld() {\n        return normalize(cross(\n          dFdx(vPositionWorldCameraRelative),\n          dFdy(vPositionWorldCameraRelative)\n        ));\n      }\n\n      vec3 shadingNormal_view() {\n        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));\n      }\n    "]))))):2===n.normalType&&(0===n.viewingMode?(b.include(h.VertexPosition,n),t.code.add(e.glsl(k||(k=a.__makeTemplateObject(["\n        vec3 shadingNormalWorld() {\n          return normalize(positionWorld());\n        }\n      "],
["\n        vec3 shadingNormalWorld() {\n          return normalize(positionWorld());\n        }\n      "]))))):1===n.viewingMode&&t.code.add(e.glsl(p||(p=a.__makeTemplateObject(["\n        vec3 shadingNormalWorld() {\n          return vec3(0.0, 0.0, 1.0);\n        }\n      "],["\n        vec3 shadingNormalWorld() {\n          return vec3(0.0, 0.0, 1.0);\n        }\n      "])))),b.extensions.add("GL_OES_standard_derivatives"),t.code.add(e.glsl(r||(r=a.__makeTemplateObject(["\n      vec3 shadingNormal_view() {\n        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;\n      }\n    "],
["\n      vec3 shadingNormal_view() {\n        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;\n      }\n    "])))))};var f,g,l,d,c,k,p,r})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define("require exports tslib ../attributes/VertexTextureCoordinates.glsl ../util/TextureAtlasLookup.glsl ../../shaderModules/interfaces".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});b.ReadBaseColorTexture=
function(b,c){var d=b.fragment;c.baseColorTexture?(b.include(m.VertexTextureCoordinates,c),d.uniforms.add("uBaseColorTexture","sampler2D"),d.uniforms.add("uBaseColorTextureSize","vec2"),2===c.attributeTextureCoordinates?(b.include(h.TextureAtlasLookup),d.code.add(e.glsl(f||(f=a.__makeTemplateObject(["\n        vec4 readBaseColorTexture() {\n          return textureAtlasLookup(\n            uBaseColorTexture,\n            uBaseColorTextureSize,\n            vuv0,\n            vuvRegion\n          );\n        }\n      "],
["\n        vec4 readBaseColorTexture() {\n          return textureAtlasLookup(\n            uBaseColorTexture,\n            uBaseColorTextureSize,\n            vuv0,\n            vuvRegion\n          );\n        }\n      "]))))):d.code.add(e.glsl(g||(g=a.__makeTemplateObject(["\n        vec4 readBaseColorTexture() {\n          return texture2D(uBaseColorTexture, vuv0);\n        }\n      "],["\n        vec4 readBaseColorTexture() {\n          return texture2D(uBaseColorTexture, vuv0);\n        }\n      "]))))):
d.code.add(e.glsl(l||(l=a.__makeTemplateObject(["\n      vec4 readBaseColorTexture() { return vec4(1.0); }\n    "],["\n      vec4 readBaseColorTexture() { return vec4(1.0); }\n    "]))))};var f,g,l})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(){this._dirty=!0}a.prototype._setDirty=function(){this._dirty=!0};a.prototype._setClean=function(){this._dirty=!1;for(var a=
0,b=this.__proto__.__parameterBlocks||[];a<b.length;a++)this[b[a]]._setClean()};Object.defineProperty(a.prototype,"dirty",{get:function(){return this._dirty||this._checkParameterBlocksDirty()},enumerable:!0,configurable:!0});a.prototype._checkParameterBlocksDirty=function(){for(var a=0,b=this.__proto__.__parameterBlocks||[];a<b.length;a++)if(this[b[a]].dirty)return!0;return!1};return a}();b.MaterialBase=n;n=function(){function a(){this._dirty=!0}a.prototype._setDirty=function(){this._dirty=!0};a.prototype._setClean=
function(){this._dirty=!1};Object.defineProperty(a.prototype,"dirty",{get:function(){return this._dirty},enumerable:!0,configurable:!0});return a}();b.MaterialParameterBlock=n;b.parameter=function(a){void 0===a&&(a={});return function(b,h){b.__materialParameters=b.__materialParameters||[];b.__materialParameters.push(h);var e="_"+h;if(a.vectorOps){var f=a.vectorOps;Object.defineProperty(b,h,{get:function(){return this[e]},set:function(a){if(this[e]){if(f.equals(this[e],a))return;f.copy(this[e],a)}else this[e]=
a;this._setDirty()}})}else Object.defineProperty(b,h,{get:function(){return this[e]},set:function(b){this[e]!==b&&(a.dispose&&this[e]&&this[e].dispose(),this[e]=b,this._setDirty())}})}};b.parameterBlock=function(){return function(a,b){a.__parameterBlocks=a.__parameterBlocks||[];a.__parameterBlocks.push(b);var h="_"+b;Object.defineProperty(a,b,{get:function(){return this[h]},set:function(a){this[h]!==a&&(this[h]=a,this._setDirty())}})}}})},"esri/views/3d/webgl-engine/core/util/BucketedObjectStore":function(){define(["require",
"exports","tslib","../../lib/AutoDisposable"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(){return null!==b&&b.apply(this,arguments)||this}a.__extends(e,b);Object.defineProperty(e.prototype,"bucketKey",{get:function(){return this._bucket.key},enumerable:!0,configurable:!0});return e}(m.AutoDisposable);b.BucketStorable=n;n=function(){function a(){this._buckets=new Map;this._count=0}a.prototype.add=function(a,b){a=this._getBucket(a);b._bucket=a;b._bucketIndex=
a.count;a._data.push(b);this._count++};a.prototype.remove=function(a){var b=a._bucket._data,e=b[b.length-1];b[a._bucketIndex]=e;e._bucketIndex=a._bucketIndex;b.pop();this._count--};a.prototype.updateKey=function(a,b){this.remove(a);this.add(b,a)};a.prototype.getBucket=function(a){return this._getBucket(a).data};a.prototype.forEach=function(a){this._buckets.forEach(function(b){a(b.data,b.key)})};Object.defineProperty(a.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0});
a.prototype._getBucket=function(a){var b=this._buckets.get(a);if(b)return b;b=new h(a);this._buckets.set(a,b);return b};return a}();b.BucketedObjectStore=n;var h=function(){function a(a){this.key=a;this._data=[]}Object.defineProperty(a.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"count",{get:function(){return this._data.length},enumerable:!0,configurable:!0});return a}()})},"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["require",
"exports","../../../../../core/libs/gl-matrix-2/vec3","../../../../../core/libs/gl-matrix-2/vec3f32","../../../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this._low=m.vec3f32.create();this._high=m.vec3f32.create();a&&this.set(a)}Object.defineProperty(b.prototype,"low",{get:function(){return this._low},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"high",{get:function(){return this._high},
enumerable:!0,configurable:!0});b.prototype.set=function(b){var e=this._low,d=this._high;a.vec3.copy(e,b);a.vec3.sub(d,b,e)};b.prototype.setElements=function(b,f,d){a.vec3.set(e,b,f,d);this.set(e)};b.prototype.get=function(b){return a.vec3.add(b,this._low,this._high)};b.prototype.getLowScaled=function(b){return a.vec3.scale(b,this._low,1)};return b}();b.TwoVectorPosition=n;var e=h.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["require","exports"],function(n,
b){function a(a){void 0===a&&(a=!0);return{isVisibleBit:!a,data:new Uint32Array(0)}}Object.defineProperty(b,"__esModule",{value:!0});b.updateVisibilityWithCount=function(b,h,e,f){if(e>=h)return b;null==b&&(b=a());var g=b.data,l=8*g.BYTES_PER_ELEMENT,d=e/l|0,c=e-l*d,k=g;f=f===b.isVisibleBit;e<k.length*l||!f||(e=Math.max(d+1,Math.ceil(1.5*k.length)),e=Math.min(e,((h-1)/l|0)+1),g=new Uint32Array(e),g.set(k));d<g.length&&(g[d]=g[d]&~(1<<c)|(f?1:0)<<c);b.data=g;return b};b.getVisibility=function(a,b){if(null==
a)return!0;var e=a.isVisibleBit,f=a.data,g=8*f.BYTES_PER_ELEMENT;return b<f.length*g?(a=b/g|0,0!==(f[a]&1<<b-a*g)===e):!a.isVisibleBit};b.defaultVisibilities=a;n=[];for(b=0;65>b;b++)n.push(Math.pow(2,b)-1)})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["require","exports","./ManagedTextureBackedBuffer"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b){void 0===b&&(b=1);this.rctx=a;this.fieldCount=b;this.buffers=
[]}b.prototype.garbageCollect=function(){this.buffers=this.buffers.filter(function(a){return 0===a.activeCount?(a.dispose(),!1):!0})};b.prototype.getBuffer=function(b){for(var e=0,f=this.buffers;e<f.length;e++){var g=f[e];if(g.availableCount>=b)return g}if(b>a.MAX_INDEX_COUNT)return null;b=new a.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);this.buffers.push(b);return b};b.prototype.updateTextures=function(){for(var a=0,b=this.buffers;a<b.length;a++)b[a].textureBuffer.updateTexture()};return b}();
b.BufferManager=n})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["require","exports","./SimpleIndexManager","./TextureBackedBuffer"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.MAX_INDEX_COUNT=65536;n=function(){function h(e,f){void 0===f&&(f=1);this.textureBuffer=new m.TextureBackedBuffer(e,f);this.indexManager=new a.SimpleIndexManager(b.MAX_INDEX_COUNT)}h.prototype.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=
void 0};Object.defineProperty(h.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0});h.prototype.acquireIndex=function(){var a=this.indexManager.acquire();this.textureBuffer.resizeToFit(a);return a};h.prototype.releaseIndex=function(a){this.indexManager.release(a)};return h}();b.ManagedTextureBackedBuffer=
n})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a){this.maxCount=a;this._nextIndex=0;this.recycledIndices=[]}Object.defineProperty(a.prototype,"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"availableCount",{get:function(){return this.recycledIndices.length+
this.maxCount-this._nextIndex},enumerable:!0,configurable:!0});a.prototype.acquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();if(this.availableCount)return this._nextIndex++};a.prototype.release=function(a){this.recycledIndices.push(a)};return a}();b.SimpleIndexManager=n})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["require","exports","../../../support/buffer/BufferView","../../../../webgl/Texture"],function(n,b,
a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,f){void 0===f&&(f=1);this.rctx=b;this.fieldCount=f;this.textureWidth=4096;this.dirty=!0;this.texture=new m(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1});this.data=new a.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}b.prototype.dispose=function(){this.texture.dispose();this.data=this.texture=void 0};b.prototype.setData=function(a,
b,g,h,d,c){a=a*this.fieldCount+b;this.dirty=!0;this.data.set(a,0,g);this.data.set(a,1,h);this.data.set(a,2,d);this.data.set(a,3,c)};b.prototype.setDataElement=function(a,b,g,h){a=a*this.fieldCount+b;this.dirty=!0;this.data.set(a,g,h)};b.prototype.resizeToFit=function(b){b*=this.fieldCount;b>=this.data.count&&(b=new a.BufferViewVec4u8(new ArrayBuffer(Math.ceil((b+1)/this.textureWidth)*this.textureWidth*4)),b.typedBuffer.set(this.data.typedBuffer),this.data=b)};b.prototype.updateTexture=function(){if(this.dirty){var a=
this.texture.descriptor.width;this.data.count>a*this.texture.descriptor.height&&this.texture.resize(a,this.data.count/a);this.texture.setData(this.data.typedBuffer);this.dirty=!1}};b.prototype.bind=function(a,b){this.rctx.bindTexture(this.texture,b.unit);a.setUniform1i(b.texName,b.unit);a.setUniform2f(b.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return b}();b.TextureBackedBuffer=n})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("require exports ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4 ../../../support/geometryUtils ./AllRenderPasses ./RenderPass ../util/TwoVectorPosition ../../lib/depthRange".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,c){this._renderView=a;this.rctx=b;this.shaderTechniqueRepository=c;this.canRender=!0;this._materialPassParams=new k.MaterialPassesParameters;this._shadowPassParams=new k.ShadowMapPassParameters;this._highlightPassParams=new k.HighlightPassParameters;this._systems=new Set;this._passes=[];this._shadowMapPass=this._registerPass(new p.RenderPass(b,this.shaderTechniqueRepository));this.passes=
{materialOpaque:this._registerPass(new p.RenderPass(b,this.shaderTechniqueRepository)),materialTransparent:this._registerPass(new p.RenderPass(b,this.shaderTechniqueRepository,1)),materialIntegratedMesh:this._registerPass(new p.RenderPass(b,this.shaderTechniqueRepository)),shadowMap:this._shadowMapPass,highlight:this._registerPass(new p.RenderPass(b,this.shaderTechniqueRepository)),highlightIntegratedMesh:this._registerPass(new p.RenderPass(b,this.shaderTechniqueRepository))}}b.prototype.register=
function(a){this._systems.add(a)};b.prototype.prepareRender=function(){var a=this;this._passes.forEach(function(a){return a.prepareSubmit()});var b={camera:this._renderView.getCamera()};this._systems.forEach(function(c){c.submit(a.passes,b)});this._passes.forEach(function(a){return a.finishSubmit()});this.shaderTechniqueRepository.frameUpdate()};b.prototype.render=function(a){if(4===a.slot)switch(this._configure(a),a.pass){case 0:this._materialPassParams.subPass=0;this._configureMaterialColorPass(a);
this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 1:this._materialPassParams.subPass=1;this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2;this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 4:this.passes.highlight.dispatch(this._highlightPassParams);break;case 3:this._shadowMapPass.dispatch(this._shadowPassParams)}if(6===a.slot)switch(this._configure(a),a.pass){case 0:this._materialPassParams.subPass=
0;this._configureMaterialColorPass(a);this.passes.materialTransparent.dispatch(this._materialPassParams);break;case 1:this._materialPassParams.subPass=1;this.passes.materialTransparent.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2,this.passes.materialTransparent.dispatch(this._materialPassParams)}if(1===a.slot)switch(this._configure(a),a.pass){case 0:this._materialPassParams.subPass=0;this._configureMaterialColorPass(a);this._materialPassParams.ssrParams=a.ssrParams;
this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 1:this._materialPassParams.subPass=1;this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2;this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 4:this.passes.highlightIntegratedMesh.dispatch(this._highlightPassParams)}return!0};b.prototype.notifyDirty=function(){this._renderView.setNeedsRender()};b.prototype.slots=function(){return[4,
6,1]};b.prototype.initializeRenderContext=function(){};b.prototype.uninitializeRenderContext=function(){};b.prototype.queryDepthRange=function(b){var c={near:Infinity,far:-Infinity};this._systems.forEach(function(d){d=d.queryShadowCasterDepthRange(b);a.isSome(d)&&t.union(c,d,c)});return c};Object.defineProperty(b.prototype,"shadowCastingEnabled",{get:function(){return a.isSome(this.passes.shadowMap)},set:function(a){a?(this._materialPassParams.shadowsEnabled=!0,this.passes.shadowMap=this._shadowMapPass):
(this._materialPassParams.shadowsEnabled=!1,this.passes.shadowMap=null)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"screenSpaceReflectionsEnabled",{get:function(){return a.isSome(this._materialPassParams.ssrParams.ssrEnabled)},set:function(a){this._materialPassParams.ssrParams.ssrEnabled=a?!0:!1},enumerable:!0,configurable:!0});b.prototype._configureMaterialColorPass=function(a){var b=this;this._materialPassParams.shadowMap={bind:function(c,d){a.shadowMap.bind(c,d);d=b._materialPassParams.viewTransform;
g.vec3.add(u,d.worldFromView_TL,d.worldFromView_TH);a.shadowMap.bindView(c,u)}};this._materialPassParams.ambientOcclusion={bind:function(b,c){a.ssaoHelper.setUniforms(b,c)}};this._materialPassParams.ambientOcclusionEnabled=a.ssaoHelper.enabled;this._materialPassParams.sceneHasOcludees=a.hasOccludees};b.prototype._configure=function(a){this._updateParameters(a,3===a.pass?this._shadowPassParams:4===a.pass?this._highlightPassParams:this._materialPassParams)};b.prototype._updateParameters=function(a,
b){var k=a.camera,h=k.viewInverseTransposeMatrix;g.vec3.set(u,h[3],h[7],h[11]);z.set(u);g.vec3.copy(b.viewTransform.worldFromView_TH,z.high);g.vec3.copy(b.viewTransform.worldFromView_TL,z.low);m.mat3.fromMat4(b.viewTransform.viewFromCameraRelative_RS,k.viewMatrix);e.mat4.copy(b.viewTransform.projFromView,k.projectionMatrix);0===b.identifier?(this._materialPassParams.transparent=6===a.slot,this._materialPassParams.integratedMesh=1===a.slot,this._materialPassParams.lighting=a.scenelightingData,m.mat3.transpose(v,
b.viewTransform.viewFromCameraRelative_RS),m.mat3.invert(b.transformNormal_ViewFromGlobal,v),f.vec2.set(b.cameraNearFar,k.near,k.far)):1===b.identifier?f.vec2.set(b.cameraNearFar,k.near,k.far):2===b.identifier&&(b.highlightDepthTexture=a.highlightDepthTexture,d.vec4.copy(b.viewport,k.fullViewport));c.boundedPlane.copy(a.sliceHelper.plane,b.slicePlane);g.vec3.subtract(b.slicePlane.origin,b.slicePlane.origin,u);b.slicePlaneEnabled=a.sliceHelper.isEnabled};b.prototype._registerPass=function(a){this._passes.push(a);
return a};Object.defineProperty(b.prototype,"needsHighlight",{get:function(){return 0<this.passes.highlight.count||0<this.passes.highlightIntegratedMesh.count},enumerable:!0,configurable:!0});return b}();b.RenderPassManager=n;var u=l.vec3f64.create(),v=h.mat3f64.create(),z=new r.TwoVectorPosition})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec4f64 ../../../support/geometryUtils ../shaderLibrary/attributes/VertexPosition.glsl".split(" "),
function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(){this.identifier=0;this.integratedMesh=this.transparent=!1;this.viewTransform=new f.VertexPosition.ViewProjectionTransform;this.transformNormal_ViewFromGlobal=a.mat3f64.create();this.cameraNearFar=m.vec2f64.create();this.slicePlane=e.boundedPlane.create();this.shadowsEnabled=this.ambientOcclusionEnabled=this.slicePlaneEnabled=!0;this.sceneHasOcludees=!1}}();b.MaterialPassesParameters=n;n=function(){return function(){this.identifier=
1;this.viewTransform=new f.VertexPosition.ViewProjectionTransform;this.cameraNearFar=m.vec2f64.create();this.slicePlane=e.boundedPlane.create()}}();b.ShadowMapPassParameters=n;n=function(){return function(){this.identifier=2;this.viewTransform=new f.VertexPosition.ViewProjectionTransform;this.slicePlane=e.boundedPlane.create();this.viewport=h.vec4f64.create()}}();b.HighlightPassParameters=n})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define(["require","exports","../../../../../core/PooledArray"],
function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,f,g){void 0===g&&(g=0);this._rctx=b;this._techniqueRepository=f;this._sorting=g;this._draws=new a({initialSize:32,allocator:function(a){return a||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}});this._passBoundTechniques=new Set;this._previouslyBoundMaterials=new Map;this._previouslyBoundDraw=new Map}b.prototype.submitDraw=function(a,b,g,h,d){var c=this._draws.pushNew();
c.geometry=b;c.geometryRanges=g;c.material=a;c.bindDrawParams=h;c.depthSquaredHint=d;c.indexType=b.indexed?b.vao.indexBuffer.indexType:0};b.prototype.dispatch=function(a){var b=this._rctx;this._passBoundTechniques.clear();this._previouslyBoundMaterials.clear();this._previouslyBoundDraw.clear();for(var e=null,h={repository:this._techniqueRepository},d=this._draws.length,c=0;c<d;c++){var k=this._draws.data[c],p=k.geometry,r=k.material.getTechnique(h,a,p.parameters);this._passBoundTechniques.has(r)||
(r.bindPass(b,a),this._passBoundTechniques.add(r));b.bindVAO(p.vao);r!==e&&(b.bindProgram(r.program),b.setPipelineState(r.pipeline),e=r);this._previouslyBoundMaterials.get(r)!==k.material&&(r.bindMaterial(b,k.material,a),this._previouslyBoundMaterials.set(r,k.material));this._previouslyBoundDraw.get(r)!==k.bindDrawParams&&(r.bindDraw(k.bindDrawParams,k.material,a),this._previouslyBoundMaterials.set(r,k.material));if(0!==k.indexType)for(var r=m.get(k.indexType),n=0;n<k.geometryRanges.length;n+=2){var u=
k.geometryRanges[n],v=k.geometryRanges[n+1];b.drawElements(p.primitiveType,v,k.indexType,u*r)}else for(n=0;n<k.geometryRanges.length;n+=2)u=k.geometryRanges[n],v=k.geometryRanges[n+1],b.drawArrays(p.primitiveType,u,v)}};b.prototype.prepareSubmit=function(){this._draws.clear()};b.prototype.finishSubmit=function(){var a=0===this._sorting?1:-1;this._draws.sort(function(b,e){var f=a*(b.depthSquaredHint-e.depthSquaredHint);return 0!==f?f:b.geometry.vao.size-e.geometry.vao.size})};Object.defineProperty(b.prototype,
"count",{get:function(){return this._draws.length},enumerable:!0,configurable:!0});return b}();b.RenderPass=n;var m=new Map;m.set(5121,1);m.set(5123,2);m.set(5125,4)})},"esri/views/3d/webgl-engine/lib/CompositingHelper":function(){define("require exports ../../../../core/maybe ./glUtil3D ../shaders/CompositingTechnique ../../../webgl/Util".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b){this._rctx=a;this._techniqueRepository=b;this._techniques=
new Set}b.prototype.dispose=function(){var b=this;this._techniques.forEach(function(a){return b._techniqueRepository.release(a)});this._techniques.clear();a.isSome(this._vao)&&(this._vao.dispose(),this._vao=null)};b.prototype.composite=function(a,b,c){void 0===b&&(b=0);void 0===c&&(c=1);this.compositeInternal(a,b,c,0)};b.prototype.compositeSpecial=function(a,b){this.compositeInternal(a,0,1,b)};b.prototype.compositeInternal=function(a,b,c,g){var d=this._rctx;f.alphaMode=b;f.function=g;f.hasOpacityFactor=
1!==c;b=this._techniqueRepository.acquire(h.CompositingTechnique,f);d.bindProgram(b.program);b.bindPipelineState(d);b.program.setUniform1i("tex",1);f.hasOpacityFactor&&b.program.setUniform1f("opacity",c);d.bindTexture(a,1);a=this.ensureVAO();d.bindVAO(a);d.drawArrays(5,0,e.vertexCount(a,"geometry"));d.bindVAO(null);this._techniqueRepository.release(b)};b.prototype.ensureVAO=function(){a.isNone(this._vao)&&(this._vao=m.createQuadVAO(this._rctx));return this._vao};return b}();b.default=n;var f=new h.CompositingTechniqueConfiguration})},
"esri/views/3d/webgl-engine/shaders/CompositingTechnique":function(){define("require exports tslib ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ./Compositing.glsl ../../../webgl/Program ../../../webgl/renderState ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),function(n,b,a,m,h,e,f,g,l,d,c){Object.defineProperty(b,"__esModule",{value:!0});h=function(b){function e(){return null!==
b&&b.apply(this,arguments)||this}a.__extends(e,b);e.prototype.initializeProgram=function(a){var b=e.shader.get().build(this.configuration);return new l(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),f.Default3D)};e.prototype.initializePipeline=function(){if(2===this.configuration.function)return c.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case 0:return c.makePipelineState({colorWrite:c.defaultColorWriteParams});case 1:return c.makePipelineState({blending:d.separateBlendingParams(770,
1,771,771),colorWrite:c.defaultColorWriteParams});default:return c.makePipelineState({blending:d.simpleBlendingParams(1,771),colorWrite:c.defaultColorWriteParams})}};e.shader=new m.ReloadableShaderModule(g,function(){return new Promise(function(a,b){n(["./Compositing.glsl"],a,b)})});return e}(h.ShaderTechnique);b.CompositingTechnique=h;h=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.function=0;a.alphaMode=0;a.hasOpacityFactor=!1;return a}a.__extends(c,b);a.__decorate([e.parameter({count:3})],
c.prototype,"function",void 0);a.__decorate([e.parameter({count:3})],c.prototype,"alphaMode",void 0);a.__decorate([e.parameter()],c.prototype,"hasOpacityFactor",void 0);return c}(e.ShaderTechniqueConfiguration);b.CompositingTechniqueConfiguration=h})},"esri/views/3d/webgl-engine/shaders/Compositing.glsl":function(){define("require exports tslib ../core/shaderLibrary/ScreenSpacePass ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,
"__esModule",{value:!0});b.build=function(b){var c=new e.ShaderBuilder;c.include(m.ScreenSpacePass);c.fragment.uniforms.add("tex","sampler2D");0===b.function&&(b.hasOpacityFactor?(c.fragment.uniforms.add("opacity","float"),c.fragment.code.add(h.glsl(f||(f=a.__makeTemplateObject(["\n      void main() {\n        gl_FragColor \x3d texture2D(tex, uv) * opacity;\n      }"],["\n      void main() {\n        gl_FragColor \x3d texture2D(tex, uv) * opacity;\n      }"]))))):c.fragment.code.add(h.glsl(g||(g=
a.__makeTemplateObject(["\n      void main() {\n        gl_FragColor \x3d texture2D(tex, uv);\n      }"],["\n      void main() {\n        gl_FragColor \x3d texture2D(tex, uv);\n      }"])))));2===b.function&&c.fragment.code.add(h.glsl(l||(l=a.__makeTemplateObject(["\n    void main() {\n      gl_FragColor \x3d vec4(1.0 - texture2D(tex, uv).a);\n    }"],["\n    void main() {\n      gl_FragColor \x3d vec4(1.0 - texture2D(tex, uv).a);\n    }"]))));return c};var f,g,l})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Handles ../../../../core/MapUtils ../../../../core/maybe ../../../../core/TimeProfiler ../../../../core/watchUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2f64 ../../support/debugFlags ../core/shaderLibrary/hud/HUD.glsl ./BoundingInfo ./Camera ./depthRange ./depthRangeUtils ./FxaaRenderPass ./glUtil3D ./HighlightHelper ./Material ./OffscreenRenderingHelper ./RenderContext ./rendererUtils ./RenderPluginManager ./renderStats ./ShadowMap ./SliceHelper ./SmaaRenderPass ./SSAOHelper ./edgeRendering/EdgeView ../lighting/SceneLighting ../materials/HUDMaterial ../../../webgl/Profiling".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L,M,N,Q){n=function(){function b(a,b,c,d,e,f,h){var l=this;this._materialRep=a;this._rctx=d;this._compositingHelper=e;this.requestRender=f;this._stage=h;this._materialRenderers=new Map;this._hasWater=this._hasOccludees=this._hasHighlights=!1;this._lighting=new M.SceneLighting;this._content=new Map;this._isRendering=!1;this._fallbackDepthStencilTexture=null;this._stats=new H.RenderStatsAggregator;this._antialiasing=1;this._edgeView=
null;this._handles=new m;this._cameraPrevious=new t.default;this._cameraCurrent=new t.default;this.renderHiddenTransparentEdges=function(){};this._shaderTechniqueRepository=c;this._fxaaPass=new z(this._rctx);this._smaaPass=new J(this._rctx);this._bindParameters={slot:null,view:null,proj:null,viewInvTransp:null,fovY:0,nearFar:null,viewport:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null,slicePlane:null,highlightDepthTexture:null,hasOccludees:!1,linearDepthTexture:null,linearDepthTextureID:0,
lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,ssrViewMat:null,rpProjectionMat:null,ssrEnabled:!1};this._offscreenRendering=new A(this._rctx,this._compositingHelper);this._sliceHelper=new G;this._shadowMap=new I(this._rctx,c.viewingMode);this._ssaoHelper=new E(c,this._rctx,function(){return l.requestRender()});this._highlightHelper=new q(c,this._rctx);this._renderPlugins=new F.RenderPluginManager({rctx:this._rctx,shaderTechniqueRep:c,textureRep:b,materialRep:this._materialRep,
requestRender:this.requestRender});this._renderContext=new B(this._rctx,this._offscreenRendering,this._lighting,this._shadowMap,this._ssaoHelper,this._sliceHelper);this._renderContext.ssrParams={nearFar:null,linearDepthTexture:null,linearDepthTextureID:0,lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,ssrViewMat:null,rpProjectionMat:null,ssrEnabled:!1};this._handles.add(g.init(k,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",function(a){l.renderHiddenTransparentEdges=a?function(){return l.renderEdges(1)}:
function(){};l.requestRender()}))}b.prototype.dispose=function(){this._handles.destroy();this._fxaaPass.disable();this._smaaPass.disable();this._materialRenderers.forEach(function(a){return a.dispose()});this._materialRenderers=null;this._edgeView&&(this._edgeView.destroy(),this._edgeView=null);this._offscreenRendering.enabled=!1;this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null);this._shadowMap&&(this._shadowMap.enabled=!1,this._shadowMap.dispose());
this._ssaoHelper&&(this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose());this._highlightHelper&&(this._highlightHelper.enabled=!1);r.tmpIndices.prune();this._content.clear();this._content=null};Object.defineProperty(b.prototype,"updating",{get:function(){return 1===this._antialiasing&&this._smaaPass.isLoadingResources},enumerable:!0,configurable:!0});b.prototype.ensureEdgeView=function(){var a=this;null==this._edgeView&&(this._edgeView=new L.EdgeView(this._rctx,this._shaderTechniqueRepository,{setNeedsRender:function(){return a.requestRender()}}),
this._edgeView.initialize());return this._edgeView};Object.defineProperty(b.prototype,"edgeView",{get:function(){return this._edgeView},enumerable:!0,configurable:!0});b.prototype.setLighting=function(a){this._lighting.set(a)};b.prototype.setRenderParams=function(a){void 0!==a.shadowMap&&(this._shadowMap.enabled=a.shadowMap);void 0!==a.shadowMapMaxCascades&&(this._shadowMap.maxCascades=a.shadowMapMaxCascades);this._highlightHelper.enabled=!0;void 0!==a.ssao&&(this._ssaoHelper.enabled=a.ssao);void 0!==
a.ssaoAttenuation&&(this._ssaoHelper.attenuation=a.ssaoAttenuation);void 0!==a.ssaoRadius&&(this._ssaoHelper.radius=a.ssaoRadius);void 0!==a.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter.");void 0!==a.ssaoSamples&&(this._ssaoHelper.samples=a.ssaoSamples);a.background&&(this._offscreenRendering.background=a.background);void 0!==a.antialiasingEnabled&&(this._antialiasing=a.antialiasingEnabled?1:0);void 0!==a.defaultHighlightOptions&&this._highlightHelper.setDefaultOptions(a.defaultHighlightOptions);
void 0!==a.slicePlane&&(this._sliceHelper.plane=e.unwrap(a.slicePlane));void 0!==a.waterReflectionEnabled&&(this._waterReflectionEnabled=10<=this._rctx.parameters.maxTextureImageUnits&&a.waterReflectionEnabled);this.requestRender()};Object.defineProperty(b.prototype,"hasSlicePlane",{get:function(){return!!this._sliceHelper.plane},enumerable:!0,configurable:!0});b.prototype.getRenderParams=function(){var a={};this._shadowMap&&(a.shadowMap=this._shadowMap.enabled,a.shadowMapMaxCascades=this._shadowMap.maxCascades);
this._ssaoHelper&&this._ssaoHelper.isSupported&&(a.ssao=this._ssaoHelper.enabled,a.ssaoAttenuation=this._ssaoHelper.attenuation,a.ssaoRadius=this._ssaoHelper.radius,a.ssaoFilterRadius=this._ssaoHelper.filterRadius,a.ssaoSamples=this._ssaoHelper.samples);this._waterReflectionEnabled&&(a.waterReflectionEnabled=this._waterReflectionEnabled);return a};Object.defineProperty(b.prototype,"renderPlugins",{get:function(){return this._renderPlugins},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"canRender",{get:function(){return!0},enumerable:!0,configurable:!0});b.prototype.getStats=function(){return this._stats.getAggregatedStats()};b.prototype.getFramebufferTexture=function(b){switch(b){case "color":return this._offscreenRendering.colorTexture;case "hudVisibility":return this._offscreenRendering.hudVisibilityTexture;case "shadowMap":return this._shadowMap&&this._shadowMap.getDepthTexture();case "linearDepth":return this._offscreenRendering.linearDepthTexture;case "normals":return this._offscreenRendering.normalTexture;
case "highlight":return this._offscreenRendering.highlightTexture;default:return a.neverReached(b),null}};b.prototype.isEmpty=function(){return 0===this._materialRenderers.size};b.prototype.modify=function(a,b,c,d,e,f){var g=this;void 0===b&&(b=a?a.length:0);void 0===d&&(d=c?c.length:0);void 0===f&&(f=e?e.length:0);this._isRendering&&console.warn("Renderer.modify called while rendering");for(var k=0;k<d;++k)this._content.delete(c[k].uniqueName);for(k=0;k<b;++k)this._content.set(a[k].uniqueName,a[k]);
if(b||d||f){var l=!1;C.splitRenderGeometryChangeSetByMaterial({toAdd:a,numToAdd:b,toRemove:c,numToRemove:d,toUpdate:e,numToUpdate:f}).forEach(function(a,b){var c=g._materialRenderers.get(b);!c&&0<a.toAdd.length&&(c=b.createRenderer(g._rctx,g._materialRep),g._materialRenderers.set(b,c));c&&(c.modify(a),c.isEmpty&&(l=!0))});l&&this._materialRenderers.forEach(function(a,b){a.isEmpty&&(g._materialRenderers.delete(b),a.dispose())});this._hasHighlights=h.someMap(this._materialRenderers,function(a){return a.hasHighlights});
this._hasOccludees=h.someMap(this._materialRenderers,function(a){return a.hasOccludees});this._hasWater=h.someMap(this._materialRenderers,function(a){return a.hasWater});this.requestRender()}};b.prototype.updateLogic=function(a){var b=!1;this._materialRenderers.forEach(function(c){c.updateLogic&&(b=c.updateLogic(a)||b)});return b};b.prototype.render=function(a){this.renderScene(a);if(this.onPostRender)this.onPostRender()};b.prototype.renderScene=function(a){var b=this;this._isRendering=!0;var c=this._rctx,
d=this._offscreenRendering,e=a.camera,f=a.fbo;d.needLastFrameColorTexture=this._waterReflectionEnabled;d.advanceCurrentRenderTarget();this._waterReflectionEnabled?this.setBindParametersSSR(e):this.removeBindParametersSSR();var g=this._sliceHelper.plane;a.disableSlice&&(this._sliceHelper.plane=null);this._renderPlugins.prepareRender(e);this.renderShadowMap(a);d.enabled=!0;d.initializeFrame(e);this.renderLinearDepth(e);this.renderNormal(e);this._ssaoHelper.enabled&&this._ssaoHelper.computeSSAO(e,d.linearDepthTexture,
d.normalTexture);this._ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository);this._stats.reset();this.updateGlobalUniforms(e.projectionMatrix);this._renderContext.pass=0;this._renderContext.camera=e;this._renderContext.hasOccludees=this._hasOccludees;d.bindFramebuffer();this._renderPlugins.render(0,this._renderContext);this.renderOpaqueGeometry(this._renderContext);this.renderEdges(2);this.renderHiddenTransparentEdges();this.renderTransparentGeometry(this._renderContext);this.renderEdges(1);
var k=a=!1;a=this.renderHUDVisibility(this._renderContext);this.renderInternalSlot(20,this._renderContext);(k=this.renderTransparentTerrain(this._renderContext))&&a&&(d.compositeTransparentTerrainOntoHUDVisibility(),d.renderToTargets(function(){return b.renderHUD(p.HUD.TransparentRenderStyle.OCCLUDED)},d.currentColorTarget,d.tmpDepth,void 0,!0,!0));k&&d.compositeTransparentTerrainOntoMain();d.renderToTargets(function(){b.renderInternalSlot(8,b._renderContext);b._renderPlugins.render(15,b._renderContext);
b._renderPlugins.render(16,b._renderContext)},d.currentColorTarget,d.mainDepth);this._renderPlugins.needsLaserlineWithContrastControl&&d.renderAndComposite(function(){b._renderPlugins.render(17,b._renderContext)},2);this.renderOccluded();this.renderAntiAliasing(f,this._antialiasing);c.bindFramebuffer(f);c.clearSafe(256);this.renderHUD(p.HUD.TransparentRenderStyle.NOTOCCLUDED);this.renderHighlights(e,f);this._sliceHelper.plane=g;this._isRendering=!1};b.prototype.renderEdges=function(a){var b=this,
c=this._edgeView;c&&c.shouldRender()&&this._offscreenRendering.renderAndComposite(function(){return c.render(b._bindParameters,a)},1)};b.prototype.renderShadowMap=function(a){var b=this._shadowMap;if(b.enabled){k.ENABLE_PROFILE_DEPTH_RANGE&&f.begin("depthRange");var c=a.camera,d=a.fbo,e=a.lightDirection,g=this.computeDepthRange(c);k.ENABLE_PROFILE_DEPTH_RANGE&&f.end("depthRange");b.prepare(c,e,g);e=b.getCascades();for(g=0;g<e.length;++g){var h=e[g];h.camera.setGLViewport(this._rctx);this.renderGeometryPass(3,
h.camera)}a.camera=c;b.finish(d);c.setGLViewport(this._rctx)}b.bindToAllPrograms(this._shaderTechniqueRepository)};b.prototype.renderLinearDepth=function(a){var b=this;this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled?this._offscreenRendering.renderToTargets(function(){return b.renderGeometryPass(1,a)},this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth)};
b.prototype.renderNormal=function(a){var b=this;this._ssaoHelper.enabled?this._offscreenRendering.renderToTargets(function(){b.renderGeometryPass(2,a)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)};b.prototype.computeDepthRange=function(a){var b=v.depthRangeFromScene(a,this._content,this._stage.getLayers());u.union(b,this.renderPlugins.queryDepthRange(a));b.near=Math.max(a.near,b.near);b.far=
Math.min(a.far,b.far);return b};b.prototype.renderGeometryPass=function(a,b){this.updateGlobalUniforms(b.projectionMatrix);this._renderContext.pass=a;this._renderContext.camera=b;this.renderOpaqueGeometry(this._renderContext);this.renderTransparentGeometry(this._renderContext);this.renderTransparentTerrain(this._renderContext)};b.prototype.renderOpaqueGeometry=function(a){this._renderPlugins.render(1,a);this._renderPlugins.render(2,a);this.renderInternalSlot(3,a);this._renderPlugins.render(4,a);a.ssaoHelper&&
a.ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository);this._renderPlugins.render(14,this._renderContext)};b.prototype.renderTransparentGeometry=function(a){this.renderInternalSlot(5,a);this._renderPlugins.render(6,a);a.ssaoHelper&&a.ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository)};b.prototype.renderTransparentTerrain=function(a){return this._renderPlugins.render(7,a)};b.prototype.renderHUDVisibility=function(a){var b=this,c=N.default.shouldRenderVisibilityDuringRenderPass(a.pass),
d=a.offscreenRenderingHelper&&a.offscreenRenderingHelper.enabled,e=!1;c&&d&&a.offscreenRenderingHelper.renderHUDVisibility(function(){e=b.renderInternalSlot(12,a)});return e};b.prototype.renderHUD=function(a){this._bindParameters.renderTransparentlyOccludedHUD=a;this.renderInternalSlot(21,this._renderContext);this.renderInternalSlot(18,this._renderContext);this.renderInternalSlot(19,this._renderContext)};b.prototype.renderHighlights=function(a,b){var c=this,d=this._highlightHelper;if(d&&d.enabled&&
(this._hasHighlights||this._renderPlugins.needsHighlight)){var e=null;d.profilingCallback&&(e=Q.startMeasurement(this._renderContext.rctx));var f=this._offscreenRendering;this._renderContext.highlightDepthTexture=this._bindParameters.highlightDepthTexture;f=f.renderToTargets(function(){c.renderGeometryPass(4,a);c._rctx.clearSafe(256);c.renderHUD(p.HUD.TransparentRenderStyle.BOTH)},f.highlight,f.tmpDepth,[0,0,0,0],!0,!0);d.render(a,f,b);null!==e&&d.profilingCallback&&e.stop(function(a){d.profilingCallback&&
d.profilingCallback(a)})}else this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight)};b.prototype.renderOccluded=function(){var a=this,b=0;this._materialRenderers.forEach(function(a,c){c&&c.isVisible()&&8===c.renderOccluded&&(b|=c.renderOccluded,U.push(c))});var c=this._offscreenRendering,d=this._renderContext,e=function(a,d,e,f,k){void 0===e&&(e=function(){return g(d)});void 0===f&&(f=!0);void 0===k&&(k=!0);0!==(b&d)&&(c.renderToTargets(e,c.tmpColor,c.mainDepth,[0,0,0,0],f,k),
c.compositeOccludedOntoMain(a))};0!==U.length&&(this.renderInternalSlot(10,d,U),e(.2,8,function(){return a.renderInternalSlot(11,d,U)},!1,!1),U.length=0);this._materialRenderers.forEach(function(a,c){c&&c.isVisible()&&(4===c.renderOccluded||2===c.renderOccluded||32===c.renderOccluded||16===c.renderOccluded)&&(b|=c.renderOccluded,O.push(c))});var f=this._renderPlugins.renderOccludedFlags;if(b|=f){var g=function(b){d.renderOccludedMask=b;1<f&&a._renderPlugins.render(9,d);a.renderInternalSlot(3,d,O);
a.renderInternalSlot(5,d,O);a.renderInternalSlot(8,d,O);d.resetRenderOccludedMask()};d.pass=0;e(.5,4,function(){return g(4)},!0,2);e(.5,2,function(){return g(2)},!0,2);e(1,48,function(){g(16);g(32)},!0,2);O.length=0}};b.prototype.renderAntiAliasing=function(a,b){var c=this;switch(b){case 1:this._smaaPass.loadResources(function(){return c.requestRender()});this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:this._offscreenRendering.colorTexture},a)):(this._rctx.bindFramebuffer(a),
this._offscreenRendering.composite());break;case 2:this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:this._offscreenRendering.colorTexture},a)):(this._rctx.bindFramebuffer(a),this._offscreenRendering.composite());break;default:this._rctx.bindFramebuffer(a),this._offscreenRendering.composite(),this._fxaaPass.disable(),this._smaaPass.disable()}};b.prototype.renderInternalSlot=function(a,b,c){this._bindParameters.slot=a;this._bindParameters.view=b.camera.viewMatrix;
this._bindParameters.proj=b.camera.projectionMatrix;this._bindParameters.viewInvTransp=b.camera.viewInverseTransposeMatrix;this._bindParameters.cameraAboveGround=b.camera.aboveGround;this._bindParameters.fovY=b.camera.fovY;R[0]=b.camera.near;R[1]=b.camera.far;var d=this._renderContext.offscreenRenderingHelper;this._bindParameters.nearFar=R;this._bindParameters.viewport=b.camera.fullViewport;this._bindParameters.shadowMap=b.shadowMap;this._bindParameters.shadowMappingEnabled=!!b.shadowMap&&b.shadowMap.enabled;
this._bindParameters.ssaoEnabled=!!b.ssaoHelper&&b.ssaoHelper.enabled;this._bindParameters.pixelRatio=b.camera.pixelRatio;this._bindParameters.slicePlane=b.sliceHelper&&b.sliceHelper.plane;this._bindParameters.hasOccludees=b.hasOccludees;this._bindParameters.linearDepthTextureID=3;this._bindParameters.lastFrameColorTextureID=4;this._bindParameters.hudVisibilityTexture=d?d.hudVisibilityTexture:null;this._bindParameters.highlightDepthTexture=d&&d.depthTexture||this.getFallbackDepthTexture();return this.renderInternalSlotMaterials(a,
b,c)};b.prototype.renderInternalSlotMaterials=function(a,b,c){var d=this,f=0===b.pass?this._stats:null,g=!1;e.isSome(c)?c.forEach(function(c){y.materialPredicate(c,b)&&(c=d._materialRenderers.get(c),e.isSome(c)&&(g=c.render(a,b,d._bindParameters)||g))}):this._materialRenderers.forEach(function(c,e){y.materialPredicate(e,b)&&(e=f?f.getMaterialRenderStatsObject(c.type):null,g=c.render(a,b,d._bindParameters,e)||g)});return g};b.prototype.updateGlobalUniforms=function(a){for(var b=this._shaderTechniqueRepository.getProgramsUsingUniform("proj"),
c=0;c<b.length;c++)b[c].setUniformMatrix4fv("proj",a);if(this._lighting)for(b=this._shaderTechniqueRepository.getProgramsUsingUniform("lightingMainDirection"),c=0;c<b.length;c++)this._lighting.setUniforms(b[c])};b.prototype.getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=w.createEmptyDepthTexture(this._rctx));return this._fallbackDepthStencilTexture};b.prototype.getGpuMemoryUsage=function(){return{offscreen:this._offscreenRendering?this._offscreenRendering.getGpuMemoryUsage():
0,highlights:this._highlightHelper?this._highlightHelper.getGpuMemoryUsage():0,shadows:this._shadowMap?this._shadowMap.getGpuMemoryUsage():0,ssao:this._ssaoHelper?this._ssaoHelper.getGpuMemoryUsage():0}};Object.defineProperty(b.prototype,"test",{get:function(){return{antialiasing:this._antialiasing,offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlightHelper,materialRenderers:this._materialRenderers}},enumerable:!0,configurable:!0});b.prototype.setBindParametersSSR=
function(a){this._cameraCurrent.copyFrom(a);this._renderContext.ssrParams.linearDepthTexture=this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture;this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture;l.mat4.translate(P,this._cameraPrevious.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]);l.mat4.translate(V,this._cameraCurrent.viewMatrix,this._bindParameters.origin?
this._bindParameters.origin:[0,0,0]);l.mat4.invert(V,V);l.mat4.invert(ba,this._cameraCurrent.projectionMatrix);l.mat4.multiply(T,V,ba);l.mat4.multiply(T,P,T);l.mat4.multiply(T,this._cameraPrevious.projectionMatrix,T);this._renderContext.ssrParams.reprojectionMat=this._bindParameters.reprojectionMat=T;this._renderContext.ssrParams.ssrViewMat=this._bindParameters.ssrViewMat=a.viewMatrix;this._renderContext.ssrParams.rpProjectionMat=this._bindParameters.rpProjectionMat=a.projectionMatrix;W[0]=a.near;
W[1]=a.far;this._renderContext.ssrParams.nearFar=W;this._renderContext.ssrParams.ssrEnabled=this._bindParameters.ssrEnabled=!0;this._cameraPrevious.copyFrom(this._cameraCurrent)};b.prototype.removeBindParametersSSR=function(){this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=null;this._renderContext.ssrParams.ssrEnabled=this._bindParameters.ssrEnabled=!1};return b}();var R=c.vec2f64.create(),W=c.vec2f64.create(),O=[],U=[],P=d.mat4f64.create(),ba=d.mat4f64.create(),
V=d.mat4f64.create(),T=d.mat4f64.create();return n})},"esri/core/TimeProfiler":function(){define(["require","exports"],function(n,b){n=function(){function a(a,b){void 0===b&&(b=.9);this._alpha=.9;this._name=a;this._alpha=b;this.reset()}a.prototype.reset=function(){this._smooth=this._sum=this._count=0;this._min=Infinity;this._max=0};Object.defineProperty(a.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"count",{get:function(){return this._count},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"average",{get:function(){return 0<this._count?this._sum/this._count:0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"smooth",{get:function(){return this._smooth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0});a.prototype.begin=
function(){this._startTime=performance.now()};a.prototype.end=function(){var a=performance.now()-this._startTime;this._count+=1;this._sum+=a;this._smooth=this._alpha*a+(1-this._alpha)*this._smooth;this._min=Math.min(this._min,a);this._max=Math.max(this._max,a)};a.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}};return a}();(function(a){function b(b){b in e||(e[b]=new a(b));return e[b]}function h(a){console.log(b(a).toJSON())}
var e={},f={};a.get=b;a.begin=function(a){b(a).begin()};a.end=function(a,e){void 0===e&&(e=!0);b(a).end();var d=performance.now();!e||a in f&&!(d>=f[a]+1E3)||(h(a),f[a]=d)};a.log=h;a.logAll=function(){for(var a in e)h(a)}})(n||(n={}));return n})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("require exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/mathUtils ./depthRange ./Util".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p){function r(a,b){if(b.isVisible){var c=k.empty(),d=b.getObjects();b.getSpatialQueryAccelerator()?t(c,a,b.getSpatialQueryAccelerator()):u(c,a,d);return c}}function t(a,b,c){var d=b.eye,e=b.viewForward,f=b.frustum,g=function(a){return a.isVisible},h=c.objectCount;500>h?(k.set(C,b.near,Math.min(a.near,b.far)),c.forEachInDepthRange(d,e,"front-to-back",C,function(c,d){v(a,b,c);C.far=a.near;d.setRange(C)},f,g),k.set(C,Math.max(a.far,b.near),b.far),c.forEachInDepthRange(d,
e,"back-to-front",C,function(c,d){v(a,b,c);C.near=a.far;d.setRange(C)},f,g)):(h=Math.max(Math.min(h,500),Math.ceil(.1*h)),d=c.findClosest(e,"front-to-back",f,g,h),c=c.findClosest(e,"back-to-front",f,g,h),d&&c&&(w(a,b,d.getCenter(),d.getBSRadius()),w(a,b,c.getCenter(),c.getBSRadius())))}function u(a,b,c){F.clear();c.forEach(function(a){a.isVisible&&F.add(a)});F.empty||(F.sort(b),k.set(C,b.near,Math.min(a.near,b.far)),F.forEachInDepthRange(C,"front-to-back",function(c,d){d<a.near&&v(a,b,c)}),k.set(C,
Math.max(a.far,b.near),b.far),F.forEachInDepthRange(C,"back-to-front",function(b,c,d){a.far=Math.max(a.far,d)}))}function v(a,b,e){if(e.isVisible&&d.frustum.intersectsSphere(b.frustum.planes,d.sphere.wrap(e.getBSRadius(),e.getCenter()))){var f=e.objectTransformation,g=B;e.geometryRecords.forEach(function(d){m.mat4.multiply(g,f,d.getShaderTransformation());var e=c.maxScale(g);z(a,b,d.geometry.boundingInfo,g,e)})}}function z(a,b,c,f,g){var k=b.eye,h=b.viewForward;e.vec3.transformMat4(A,c.center,f);
k=h[0]*(A[0]-k[0])+h[1]*(A[1]-k[1])+h[2]*(A[2]-k[2]);h=c.bsRadius*g;if(!(k-h>a.near&&k+h<a.far)&&d.frustum.intersectsSphere(b.frustum.planes,d.sphere.wrap(h,A)))if(100<c.bsRadius&&c.getChildren())for(c=c.getChildren(),k=0;8>k;++k)c[k]&&z(a,b,c[k],f,g);else I.unionDepthRangeWithAABB(a,b.viewProjectionMatrix,f,c.bbMin,c.bbMax)}function w(a,b,c,d){var e=b.eye;b=b.viewForward;c=(c[0]-e[0])*b[0]+(c[1]-e[1])*b[1]+(c[2]-e[2])*b[2];a.near=Math.min(a.near,c-d);a.far=Math.max(a.far,c+d)}Object.defineProperty(b,
"__esModule",{value:!0});b.depthRangeFromScene=function(a,b,c){if(1E4>b.size)return H.compute(a,b);var d=k.empty();c.forEach(function(b){b.isVisible&&k.union(d,r(a,b))});return d};b.depthRangeFromLayer=r;n=function(){function b(){this._items=new a({allocator:function(a){return a||{obj:null,distance:0,near:0,far:0}},deallocator:function(a){a.obj=null;a.distance=0;a.near=0;a.far=0;return a}})}Object.defineProperty(b.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!0,configurable:!0});b.prototype.clear=function(){this._items.clear()};b.prototype.add=function(a){this._items.pushNew().obj=a};b.prototype.sort=function(a){var b=a.eye,c=a.viewForward;this._items.forEach(function(a){var d=a.obj,e=d.getCenter(),d=d.getBSRadius(),e=(e[0]-b[0])*c[0]+(e[1]-b[1])*c[1]+(e[2]-b[2])*c[2];a.distance=e;a.near=e-d;a.far=e+d});this._items.sort(function(a,b){return a.distance-
b.distance})};b.prototype.forEachInDepthRange=function(a,b,c){if("front-to-back"===b)for(b=0;b<this._items.length;++b){var d=this._items.data[b];d.far<a.near||d.near>a.far||c(d.obj,d.near,d.far)}else for(b=this._items.length-1;0<=b;--b)d=this._items.data[b],d.far<a.near||d.near>a.far||c(d.obj,d.near,d.far)};return b}();var q=function(){function a(){this.view=h.mat4f64.create();this.viewProj=h.mat4f64.create();this.frustum=d.frustum.create();this.geometries=[];this.near=[];this.far=[];this.nearCandidates=
[];this.farCandidates=[];this.range={near:0,far:0};this.looseRange={near:0,far:0}}a.prototype.compute=function(a,b){var c=this;this.reset();m.mat4.copy(this.view,a.viewMatrix);m.mat4.multiply(this.viewProj,a.projectionMatrix,this.view);d.frustum.copy(a.frustum,this.frustum);a=this.view;var e=a[2],f=a[6],g=a[10],k=a[14];a=this.range;var h=0;b.forEach(function(a){if(a.instanceParameters.visible&&a.castShadow){var b,d;a.hasShaderTransformation?(b=a.getBoundingSphere(a.getShaderTransformation(),1,A),
d=A):(b=a.bsRadius,d=a.center);d=e*d[0]+f*d[1]+g*d[2]+k;c.geometries[h]=a;c.near[h]=-(d+b);c.far[h]=-(d-b);++h}});if(0===this.geometries.length)return a;for(b=0;b<this.geometries.length;++b)this.near[b]>a.far&&(a.far=this.near[b]),2<this.near[b]&&this.far[b]<a.near&&(a.near=this.far[b]);var l=this.looseRange;l.near=Math.max(.5*a.near,2);l.far=2*a.far;var p=0,q=0;for(b=0;b<this.geometries.length;++b)this.near[b]<a.near&&(this.near[b]>=l.near?a.near=this.near[b]:this.nearCandidates[p++]=b),this.far[b]>
a.far&&(this.far[b]<=l.far?a.far=this.far[b]:this.farCandidates[q++]=b);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return a;this.nearCandidates.sort(function(a,b){return c.near[a]<c.near[b]?-1:c.near[a]>c.near[b]?1:0});this.farCandidates.sort(function(a,b){return c.far[a]<c.far[b]?1:c.far[a]>c.far[b]?-1:0});for(b=0;b<this.nearCandidates.length;++b)l=this.nearCandidates[b],this.near[l]<a.near&&(l=this.geometries[l],p=l.boundingInfo,this.includeNearBoundingInfoRec(p,l.getShaderTransformation()));
for(b=0;b<this.farCandidates.length;++b)l=this.farCandidates[b],this.far[l]>a.far&&(l=this.geometries[l],p=l.boundingInfo,this.includeFarBoundingInfoRec(p,l.getShaderTransformation()));return a};a.prototype.reset=function(){this.geometries.length=0;this.near.length=0;this.far.length=0;this.nearCandidates.length=0;this.farCandidates.length=0;this.range.near=Number.MAX_VALUE;this.range.far=-Number.MAX_VALUE};a.prototype.includeNearBoundingInfoRec=function(a,b){var d=a.getBSRadius(),f=a.getCenter();
e.vec3.transformMat4(A,f,b);var g=c.maxScale(b),f=A[0],k=A[1],h=A[2],d=d*g,g=this.frustum.planes;if(!(g[0][0]*f+g[0][1]*k+g[0][2]*h+g[0][3]>d||g[1][0]*f+g[1][1]*k+g[1][2]*h+g[1][3]>d||g[2][0]*f+g[2][1]*k+g[2][2]*h+g[2][3]>d||g[3][0]*f+g[3][1]*k+g[3][2]*h+g[3][3]>d||(f=this.view[2]*f+this.view[6]*k+this.view[10]*h+this.view[14],k=f+d,2>-(f-d)||-k>=this.range.near)))if(-k>this.looseRange.near)this.range.near=-k;else{if(100<d&&(d=a.getChildren(),void 0!==d)){for(a=0;8>a;++a)void 0!==d[a]&&this.includeNearBoundingInfoRec(d[a],
b);return}I.unionDepthRangeWithAABB(this.range,this.viewProj,b,a.getBBMin(),a.getBBMax())}};a.prototype.includeFarBoundingInfoRec=function(a,b){var d=a.getBSRadius(),f=a.getCenter();e.vec3.transformMat4(A,f,b);var g=c.maxScale(b),f=A[0],k=A[1],h=A[2],d=d*g,g=this.frustum.planes;if(!(g[0][0]*f+g[0][1]*k+g[0][2]*h+g[0][3]>d||g[1][0]*f+g[1][1]*k+g[1][2]*h+g[1][3]>d||g[2][0]*f+g[2][1]*k+g[2][2]*h+g[2][3]>d||g[3][0]*f+g[3][1]*k+g[3][2]*h+g[3][3]>d||(f=this.view[2]*f+this.view[6]*k+this.view[10]*h+this.view[14]-
d,-f<=this.range.far)))if(-f<this.looseRange.far)this.range.far=-f;else{if(100<d&&(d=a.getChildren(),void 0!==d)){for(a=0;8>a;++a)void 0!==d[a]&&this.includeFarBoundingInfoRec(d[a],b);return}I.unionDepthRangeWithAABB(this.range,this.viewProj,b,a.getBBMin(),a.getBBMax())}};return a}();b.DepthRangeFromRenderGeometries=q;b=function(){function a(){this.modelViewProj=h.mat4f64.create();this.clipPosition=[l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create(),
l.vec4f64.create(),l.vec4f64.create()]}a.prototype.unionDepthRangeWithAABB=function(a,b,c,d,e){var f=this.modelViewProj;m.mat4.multiply(f,b,c);b=!1;for(c=0;8>c;++c){var g=this.clipPosition[c],k=0===c||3===c||4===c||7===c?d[0]:e[0],h=0===c||1===c||4===c||5===c?d[1]:e[1],l=4>c?d[2]:e[2];g[0]=f[0]*k+f[4]*h+f[8]*l+f[12];g[1]=f[1]*k+f[5]*h+f[9]*l+f[13];g[2]=f[2]*k+f[6]*h+f[10]*l+f[14];g[3]=f[3]*k+f[7]*h+f[11]*l+f[15]}for(c=0;12>c;++c){d=this.clipTriangle(this.clipPosition[y[c][0]],this.clipPosition[y[c][1]],
this.clipPosition[y[c][2]]);e=!0;for(f=0;f<d.length;++f)if(g=d[f][3],2<=g){e=!1;break}if(!e)for(b=!0,f=0;f<d.length;++f)g=d[f][3],g<a.near&&(a.near=g),g>a.far&&(a.far=g)}return b};a.prototype.inside=function(a,b){if(0===b)return a[0]>=-a[3];if(1===b)return a[1]>=-a[3];if(2===b)return a[0]<=a[3];if(3===b)return a[1]<=a[3];p.assert(!1)};a.prototype.intersect=function(a,b,c){var d=0;0===c?d=(-a[3]-a[0])/(b[0]-a[0]+b[3]-a[3]):1===c?d=(-a[3]-a[1])/(b[1]-a[1]+b[3]-a[3]):2===c?d=(a[3]-a[0])/(b[0]-a[0]-b[3]+
a[3]):3===c&&(d=(a[3]-a[1])/(b[1]-a[1]-b[3]+a[3]));return g.vec4.lerp(l.vec4f64.create(),a,b,d)};a.prototype.clipTriangle=function(a,b,c){a=[a,b,c];for(b=0;4>b;++b){c=a;a=[];for(var d=0;d<c.length;++d){var e=c[d],f=c[(d+1)%c.length];this.inside(f,b)?(this.inside(e,b)||a.push(this.intersect(e,f,b)),a.push(f)):this.inside(e,b)&&a.push(this.intersect(e,f,b))}}return a};return a}();var y=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],A=f.vec3f64.create(),
B=h.mat4f64.create(),C=k.empty(),F=new n,H=new q,I=new b})},"esri/views/3d/webgl-engine/lib/FxaaRenderPass":function(){define("require exports ../../../../core/maybe ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/Program ../../../webgl/renderState ../../../webgl/VertexArrayObject".split(" "),function(n,b,a,m,h,e,f,g){return function(){function b(a){this.isEnabled=!1;this.vertexAttributeLocations={position:0};this.rctx=a}b.prototype.enable=function(){if(this.isEnabled)return!0;
var a=this.rctx;this.program=new e(a,"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate \x3d (position + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(position, -1, 1);\n      }","\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x \x3d pos.x + float(off.x) * rcpFrame.x;\n        float y \x3d pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -\x3e actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN \x3d FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN \x3d FxaaLuma(rgbN);\n        float lumaW \x3d FxaaLuma(rgbW);\n        float lumaM \x3d FxaaLuma(rgbM);\n        float lumaE \x3d FxaaLuma(rgbE);\n        float lumaS \x3d FxaaLuma(rgbS);\n        float rangeMin \x3d min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax \x3d max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range \x3d rangeMax - rangeMin;\n        if (range \x3c max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL \x3d rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL \x3d (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL \x3d abs(lumaL - lumaM);\n        float blendL \x3d max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL \x3d min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL +\x3d (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *\x3d vec3(1.0/9.0);\n        float lumaNW \x3d FxaaLuma(rgbNW);\n        float lumaNE \x3d FxaaLuma(rgbNE);\n        float lumaSW \x3d FxaaLuma(rgbSW);\n        float lumaSE \x3d FxaaLuma(rgbSE);\n        float edgeVert \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan \x3d edgeHorz \x3e\x3d edgeVert;\n        float lengthSign \x3d horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN \x3d lumaW;\n          lumaS \x3d lumaE;\n        }\n        float gradientN \x3d abs(lumaN - lumaM);\n        float gradientS \x3d abs(lumaS - lumaM);\n        lumaN \x3d (lumaN + lumaM) * 0.5;\n        lumaS \x3d (lumaS + lumaM) * 0.5;\n        if (gradientN \x3c gradientS)\n        {\n          lumaN \x3d lumaS;\n          lumaN \x3d lumaS;\n          gradientN \x3d gradientS;\n          lengthSign *\x3d -1.0;\n        }\n        vec2 posN;\n        posN.x \x3d pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y \x3d pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *\x3d FXAA_SEARCH_THRESHOLD;\n        vec2 posP \x3d posN;\n        vec2 offNP \x3d horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN \x3d lumaN;\n        float lumaEndP \x3d lumaN;\n        bool doneN \x3d false;\n        bool doneP \x3d false;\n        posN +\x3d offNP * vec2(-1.0, -1.0);\n        posP +\x3d offNP * vec2( 1.0,  1.0);\n        for(int i \x3d 0; i \x3c FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN \x3d FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP \x3d FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN \x3d doneN || (abs(lumaEndN - lumaN) \x3e\x3d gradientN);\n          doneP \x3d doneP || (abs(lumaEndP - lumaN) \x3e\x3d gradientN);\n          if(doneN \x26\x26 doneP) { break; }\n          if(!doneN) {\n            posN -\x3d offNP;\n          }\n          if(!doneP) {\n            posP +\x3d offNP;\n          }\n        }\n        float dstN \x3d horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP \x3d horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN \x3d dstN \x3c dstP;\n        lumaEndN \x3d directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) \x3c 0.0) \x3d\x3d ((lumaEndN - lumaN) \x3c 0.0)) {\n          lengthSign \x3d 0.0;\n        }\n        float spanLength \x3d (dstP + dstN);\n        dstN \x3d directionN ? dstN : dstP;\n        float subPixelOffset \x3d (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF \x3d texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord \x3d fCoordinate;\n        // if (screenCoord.x \x3c 0.5) {\n          color.rgb \x3d FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x \x3c 0.501 \x26\x26 screenCoord.x \x3e 0.499) {\n        //   color.rgb \x3d vec3(1,0,0);\n        // } else {\n        //   color \x3d texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a \x3d 1.0;\n        gl_FragColor \x3d color;\n      }",
this.vertexAttributeLocations);this.pipelineState=f.makePipelineState({colorWrite:f.defaultColorWriteParams});var b=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new g(a,this.vertexAttributeLocations,{geometry:m.Pos2},{geometry:new h(a,34962,35044,b)});return this.isEnabled=!0};b.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)};b.prototype.render=function(b,c){this.enable();var d=this.rctx;d.bindVAO(this.vao);
d.bindFramebuffer(c);var e=0,f=0;a.isSome(c)?(e=c.descriptor.width,f=c.descriptor.height):(e=d.gl.canvas.width,f=d.gl.canvas.height);d.bindProgram(this.program);d.setPipelineState(this.pipelineState);d.bindTexture(b.colorTexture,0);this.program.setUniform1i("uColorTexture",0);this.program.setUniform2f("uRcpFrameDimension",1/e,1/f);d.drawArrays(4,0,3)};return b}()})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f32 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/debugFlags ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./Util ../shaders/HighlightTechnique ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t){return function(){function b(a,b){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0};this.blur1Fbo=this.blur0Fbo=this.quadVAO=null;this._rctx=b;this.viewportToRestore=h.vec4f64.create();this.defaultOptions={color:m.vec4f32.fromValues(1,0,1,1),haloColor:m.vec4f32.fromValues(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05};b=new c.HighlightCompositionTechniqueConfiguration;
b.highlightStage=0;b.gridOptimization=!1;this.blurTechnique=a.acquireAndReleaseExisting(c.HighlightCompositionTechnique,b,this.blurTechnique);b.highlightStage=0;b.gridOptimization=!0;this.blurGridTechnique=a.acquireAndReleaseExisting(c.HighlightCompositionTechnique,b,this.blurGridTechnique);b.highlightStage=1;b.gridOptimization=!1;this.applyTechnique=a.acquireAndReleaseExisting(c.HighlightCompositionTechnique,b,this.applyTechnique);b.highlightStage=1;b.gridOptimization=!0;this.applyGridTechnique=
a.acquireAndReleaseExisting(c.HighlightCompositionTechnique,b,this.applyGridTechnique);b.highlightStage=2;b.gridOptimization=!1;this.downsampleTechnique=a.acquireAndReleaseExisting(c.HighlightCompositionTechnique,b,this.downsampleTechnique)}Object.defineProperty(b.prototype,"enabled",{get:function(){return null!==this.blur0Fbo},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"profilingCallback",{get:function(){return e.HIGHLIGHTS_PROFILE_TO_CONSOLE?
function(a){return console.log(a)}:null},enumerable:!0,configurable:!0});b.prototype.setDefaultOptions=function(a){this.defaultOptions=a};b.prototype.render=function(b,c,f){var g=b.pixelRatio,k=!e.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,h=this._rctx;d.assert(this.enabled);a.vec4.copy(this.viewportToRestore,b.fullViewport);var l=Math.ceil(b.fullWidth/g),g=Math.ceil(b.fullHeight/g);this.blur0Fbo.resize(l,g);this.blur1Fbo.resize(l,g);h.bindVAO(this.quadVAO);var m=b=null;k&&(this._gridUpdateResources(c,
32),this._gridComputeMipmap());k?(b=this._grid.vao,m=this.blurGridTechnique,h.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,1),m.program.setUniform1i("coverageTex",1)):(b=this.quadVAO,m=this.blurTechnique);m.bindPipelineState(h);h.bindProgram(m.program);h.bindVAO(b);h.bindFramebuffer(this.blur0Fbo);h.setViewport(0,0,l,g);h.setClearColor(0,0,0,0);h.clear(16384);m.program.setUniform1i("tex",0);h.bindTexture(c.colorTexture,0);m.program.setUniform2f("blurSize",1/l,0);h.drawArrays(m.primitiveType,
0,r.vertexCount(b,"geometry"));h.bindFramebuffer(this.blur1Fbo);h.clear(16384);h.bindTexture(this.blur0Fbo.colorTexture,0);m.program.setUniform2f("blurSize",0,1/g);h.drawArrays(m.primitiveType,0,r.vertexCount(b,"geometry"));l=k?this.applyGridTechnique:this.applyTechnique;h.bindFramebuffer(f);l.bindPipelineState(h);h.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);h.bindProgram(l.program);h.bindTexture(this.blur1Fbo.colorTexture,
0);h.bindTexture(c.colorTexture,1);k&&h.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,2);l.bindApplyPass(this.defaultOptions);h.drawArrays(l.primitiveType,0,r.vertexCount(b,"geometry"));h.bindVAO(null)};b.prototype.enable=function(){if(!this.enabled){this.quadVAO=l.createQuadVAO(this._rctx);var a={colorTarget:0,depthStencilTarget:0,width:0,height:0},b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=new p(this._rctx,
a,b);this.blur1Fbo=new p(this._rctx,a,b)}};b.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.blur1Fbo=this.blur0Fbo=this.quadVAO=null)};b.prototype._gridUpdateResources=function(a,b){var c=this._rctx,d=this._grid,e=!1;null===d.coverageMipmap&&(d.coverageMipmap=[a],e=!0);if(d.viewportWidth!==a.width||d.viewportHeight!==a.height)e=!0,d.viewportWidth=a.width,d.viewportHeight=a.height;d.coverageMipmap[0]=a;d.cellPixelSize!==b&&
(d.cellPixelSize=b,e=!0);if(e){for(b=1;b<d.coverageMipmap.length;b++)d.coverageMipmap[b].dispose();d.mipmapLevels=Math.ceil(Math.log(d.cellPixelSize)*Math.LOG2E);d.coverageMipmap.length=d.mipmapLevels+1;for(b=0;b<d.mipmapLevels;b++)e=d.coverageMipmap[b],e=new p(c,{colorTarget:0,depthStencilTarget:0,width:Math.ceil(e.width/2),height:Math.ceil(e.height/2)},{target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(e.width/2),height:Math.ceil(e.height/2)}),d.coverageMipmap[b+
1]=e}var e=Math.ceil(a.height/d.cellPixelSize),h=Math.ceil(a.width/d.cellPixelSize);if(!d.vao||d.verticalCellCount!==e||d.horizontalCellCount!==h){d.verticalCellCount=e;d.horizontalCellCount=h;a=e+1;b=h+1;for(var e=1/e,h=1/h,l=new Float32Array(24*a*b),m=0,r=0;r<a;r++)for(var n=0;n<b;n++)l[m+0]=(n-.5)*h*2-1,l[m+1]=(r-.5)*e*2-1,l[m+2]=n*h,l[m+3]=r*e,l[m+4]=(n+.5)*h*2-1,l[m+5]=(r-.5)*e*2-1,l[m+6]=n*h,l[m+7]=r*e,l[m+8]=(n-.5)*h*2-1,l[m+9]=(r+.5)*e*2-1,l[m+10]=n*h,l[m+11]=r*e,l[m+12]=(n-.5)*h*2-1,l[m+
13]=(r+.5)*e*2-1,l[m+14]=n*h,l[m+15]=r*e,l[m+16]=(n+.5)*h*2-1,l[m+17]=(r-.5)*e*2-1,l[m+18]=n*h,l[m+19]=r*e,l[m+20]=(n+.5)*h*2-1,l[m+21]=(r+.5)*e*2-1,l[m+22]=n*h,l[m+23]=r*e,m+=24;d.vao&&d.vao.dispose(!0);d.vao=new t(c,f.Default3D,{geometry:g.Pos2Tex},{geometry:k.createVertex(c,35044,l)})}};b.prototype._gridComputeMipmap=function(){var a=this._rctx,b=this._grid,c=this.downsampleTechnique.program;this.downsampleTechnique.bindPipelineState(a);a.bindVAO(this.quadVAO);for(var d=0;d<b.mipmapLevels;d++){a.bindFramebuffer(b.coverageMipmap[d+
1]);a.bindTexture(b.coverageMipmap[d].colorTexture,0);var e=b.coverageMipmap[d+1].width,f=b.coverageMipmap[d+1].height;a.bindProgram(c);c.setUniform1i("tex",0);c.setUniform2f("invFramebufferDim",1/e,1/f);a.setViewport(0,0,e,f);a.drawArrays(5,0,r.vertexCount(this.quadVAO,"geometry"))}};b.prototype.getGpuMemoryUsage=function(){var a=r.getGpuMemoryUsage(this.blur0Fbo)+r.getGpuMemoryUsage(this.blur1Fbo);if(this._grid&&this._grid.coverageMipmap)for(var b=0,c=this._grid.coverageMipmap;b<c.length;b++)a+=
r.getGpuMemoryUsage(c[b]);return a};Object.defineProperty(b.prototype,"test",{get:function(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}},enumerable:!0,configurable:!0});return b}()})},"esri/views/3d/webgl-engine/shaders/HighlightTechnique":function(){define("require exports tslib ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ./HighlightComposition.glsl ../../../webgl/Program ../../../webgl/renderState ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c){Object.defineProperty(b,"__esModule",{value:!0});h=function(b){function e(){return null!==b&&b.apply(this,arguments)||this}a.__extends(e,b);e.prototype.initializeProgram=function(a){var b=e.shader.get().build(this.configuration);return new l(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),f.Default3D)};e.prototype.bindApplyPass=function(a){this.program.setUniform1i("tex",0);this.program.setUniform1i("origin",1);this.configuration.gridOptimization&&this.program.setUniform1i("coverageTex",
2);this.program.setUniform4fv("color",a.color);this.program.setUniform4fv("haloColor",a.haloColor);this.program.setUniform1f("outlineSize",8.6);this.program.setUniform1f("blurSize",.4);this.program.setUniform4f("opacities",a.haloOpacity,a.haloOpacityOccluded,a.fillOpacity,a.fillOpacityOccluded)};e.prototype.initializePipeline=function(){return 1===this.configuration.highlightStage?c.makePipelineState({blending:d.separateBlendingParams(770,1,771,771),colorWrite:c.defaultColorWriteParams}):c.makePipelineState({colorWrite:c.defaultColorWriteParams})};
Object.defineProperty(e.prototype,"primitiveType",{get:function(){return this.configuration.gridOptimization?4:5},enumerable:!0,configurable:!0});e.shader=new m.ReloadableShaderModule(g,function(){return new Promise(function(a,b){n(["./HighlightComposition.glsl"],a,b)})});return e}(h.ShaderTechnique);b.HighlightCompositionTechnique=h;h=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.highlightStage=0;a.gridOptimization=!1;return a}a.__extends(c,b);a.__decorate([e.parameter({count:3})],
c.prototype,"highlightStage",void 0);a.__decorate([e.parameter()],c.prototype,"gridOptimization",void 0);return c}(e.ShaderTechniqueConfiguration);b.HighlightCompositionTechniqueConfiguration=h})},"esri/views/3d/webgl-engine/shaders/HighlightComposition.glsl":function(){define(["require","exports","tslib","../core/shaderModules/interfaces","../core/shaderModules/ShaderBuilder"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var n=new h.ShaderBuilder,v=n.vertex.code,
q=n.fragment.code;n.attributes.add("position","vec2");2===b.highlightStage&&(v.add(m.glsl(e||(e=a.__makeTemplateObject(["\n    void main() {\n      gl_Position \x3d vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);\n    }"],["\n    void main() {\n      gl_Position \x3d vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);\n    }"])))),n.fragment.uniforms.add("tex","sampler2D"),n.fragment.uniforms.add("invFramebufferDim","vec2"),q.add(m.glsl(f||(f=a.__makeTemplateObject(["\n      void main() {\n        vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\n        vec4 value \x3d texture2D(tex, coord);\n        float mx \x3d floor(max(value.g, value.b));\n        gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\n      }"],
["\n      void main() {\n        vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\n        vec4 value \x3d texture2D(tex, coord);\n        float mx \x3d floor(max(value.g, value.b));\n        gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\n      }"])))));0===b.highlightStage&&(n.attributes.add("uv0","vec2"),b.gridOptimization?(n.vertex.uniforms.add("coverageTex","sampler2D"),n.fragment.uniforms.add("blurSize","vec2"),n.varyings.add("blurCoordinate","vec3")):(n.vertex.uniforms.add("blurSize",
"vec2"),n.varyings.add("blurCoordinates[5]","vec2")),v.add(m.glsl(d||(d=a.__makeTemplateObject(["\n    void main() {\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n      ","\n    }"],["\n    void main() {\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n      ","\n    }"])),b.gridOptimization?m.glsl(g||(g=a.__makeTemplateObject(["\n      vec4 cov \x3d texture2D(coverageTex, uv0);\n      if (cov.r \x3d\x3d 0.0) {\n        gl_Position \x3d vec4(0.0);\n      }\n      blurCoordinate \x3d vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));\n      "],
["\n      vec4 cov \x3d texture2D(coverageTex, uv0);\n      if (cov.r \x3d\x3d 0.0) {\n        gl_Position \x3d vec4(0.0);\n      }\n      blurCoordinate \x3d vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));\n      "]))):m.glsl(l||(l=a.__makeTemplateObject(["\n      vec2 uv \x3d position.xy * 0.5 + vec2(0.5);\n      blurCoordinates[0] \x3d uv;\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\n          "],
["\n      vec2 uv \x3d position.xy * 0.5 + vec2(0.5);\n      blurCoordinates[0] \x3d uv;\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\n          "]))))),n.fragment.uniforms.add("tex","sampler2D"),q.add(m.glsl(p||(p=a.__makeTemplateObject(["\n    void main() {\n      ","\n    }"],["\n    void main() {\n      ","\n    }"])),
b.gridOptimization?m.glsl(c||(c=a.__makeTemplateObject(["\n          vec2 uv \x3d blurCoordinate.xy;\n          vec4 center \x3d texture2D(tex, uv);\n\n          // do not blur if no pixel or all pixels in neighborhood are set\n          if (blurCoordinate.z \x3d\x3d 1.0) {\n            gl_FragColor \x3d center;\n          } else {\n            vec4 sum \x3d vec4(0.0);\n            sum +\x3d center * 0.204164;\n            sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n            sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n            sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n            sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n            gl_FragColor \x3d sum;\n          }"],
["\n          vec2 uv \x3d blurCoordinate.xy;\n          vec4 center \x3d texture2D(tex, uv);\n\n          // do not blur if no pixel or all pixels in neighborhood are set\n          if (blurCoordinate.z \x3d\x3d 1.0) {\n            gl_FragColor \x3d center;\n          } else {\n            vec4 sum \x3d vec4(0.0);\n            sum +\x3d center * 0.204164;\n            sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n            sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n            sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n            sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n            gl_FragColor \x3d sum;\n          }"]))):
m.glsl(k||(k=a.__makeTemplateObject(["\n          vec4 sum \x3d vec4(0.0);\n          sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\n          sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\n          sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\n          sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\n          sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\n          gl_FragColor \x3d sum;"],["\n          vec4 sum \x3d vec4(0.0);\n          sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\n          sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\n          sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\n          sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\n          sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\n          gl_FragColor \x3d sum;"]))))));
1===b.highlightStage&&(n.varyings.add("uv","vec2"),b.gridOptimization&&(n.attributes.add("uv0","vec2"),n.vertex.uniforms.add("coverageTex","sampler2D")),v.add(m.glsl(t||(t=a.__makeTemplateObject(["\n      void main() {\n        ","\n        gl_Position \x3d vec4(position, 0.0, 1.0);\n        uv \x3d position.xy * 0.5 + vec2(0.5);\n      }"],["\n      void main() {\n        ","\n        gl_Position \x3d vec4(position, 0.0, 1.0);\n        uv \x3d position.xy * 0.5 + vec2(0.5);\n      }"])),b.gridOptimization?
m.glsl(r||(r=a.__makeTemplateObject(["\n            vec4 cov \x3d texture2D(coverageTex, uv0);\n            // if no highlight pixel set in this block, hide block\n            if (cov.r \x3d\x3d 0.0) {\n              gl_Position \x3d vec4(0.0);\n              return;\n            }"],["\n            vec4 cov \x3d texture2D(coverageTex, uv0);\n            // if no highlight pixel set in this block, hide block\n            if (cov.r \x3d\x3d 0.0) {\n              gl_Position \x3d vec4(0.0);\n              return;\n            }"]))):
"")),n.fragment.uniforms.add("tex","sampler2D"),n.fragment.uniforms.add("origin","sampler2D"),n.fragment.uniforms.add("color","vec4"),n.fragment.uniforms.add("haloColor","vec4"),n.fragment.uniforms.add("outlineSize","float"),n.fragment.uniforms.add("blurSize","float"),n.fragment.uniforms.add("opacities","vec4"),q.add(m.glsl(u||(u=a.__makeTemplateObject(["\n      void main() {\n        // Read the highlight intensity from the blurred highlight image\n        vec4 blurredHighlightValue \x3d texture2D(tex, uv);\n        float highlightIntensity \x3d blurredHighlightValue.a;\n\n        // Discard all pixels which are not affected by highlight\n        if (highlightIntensity \x3d\x3d 0.0) {\n          discard;\n        }\n\n        vec4 origin_color \x3d texture2D(origin, uv);\n\n        float outlineIntensity;\n        float fillIntensity;\n\n        // if occluded\n        if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\n          outlineIntensity \x3d haloColor.w * opacities[1];\n          fillIntensity \x3d color.w * opacities[3];\n        }\n        // if unoccluded\n        else {\n          outlineIntensity \x3d haloColor.w * opacities[0];\n          fillIntensity \x3d color.w * opacities[2];\n        }\n\n        float inner \x3d 1.0 - outlineSize / 9.0;\n        float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\n\n        float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\n        //float fillFactor \x3d smoothstep(0.6, 0.72, highlightIntensity);\n        float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\n        float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\n\n        // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n        // I.e., color should not be premultiplied with alpha\n        gl_FragColor \x3d vec4(mix(haloColor.rgb, color.rgb, fillFactor), intensity);\n      }"],
["\n      void main() {\n        // Read the highlight intensity from the blurred highlight image\n        vec4 blurredHighlightValue \x3d texture2D(tex, uv);\n        float highlightIntensity \x3d blurredHighlightValue.a;\n\n        // Discard all pixels which are not affected by highlight\n        if (highlightIntensity \x3d\x3d 0.0) {\n          discard;\n        }\n\n        vec4 origin_color \x3d texture2D(origin, uv);\n\n        float outlineIntensity;\n        float fillIntensity;\n\n        // if occluded\n        if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\n          outlineIntensity \x3d haloColor.w * opacities[1];\n          fillIntensity \x3d color.w * opacities[3];\n        }\n        // if unoccluded\n        else {\n          outlineIntensity \x3d haloColor.w * opacities[0];\n          fillIntensity \x3d color.w * opacities[2];\n        }\n\n        float inner \x3d 1.0 - outlineSize / 9.0;\n        float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\n\n        float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\n        //float fillFactor \x3d smoothstep(0.6, 0.72, highlightIntensity);\n        float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\n        float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\n\n        // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n        // I.e., color should not be premultiplied with alpha\n        gl_FragColor \x3d vec4(mix(haloColor.rgb, color.rgb, fillFactor), intensity);\n      }"])))));
return n};var e,f,g,l,d,c,k,p,r,t,u})},"esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":function(){define(["require","exports","./RenderTargetHelper","./Util"],function(n,b,a,m){var h=[0,0,0,0],e=[0,1,0,1];return function(){function b(b,e){this._rctx=b;this._compositingHelper=e;this._currentRenderTarget=0;this.dimensions={width:4,height:4};this._enabled=this._needLastFrameColorTexture=!1;this._background={type:"color",color:[0,0,0,1]};b=this.renderTargetHelper=new a.RenderTargetHelper(this._rctx);
this.mainColorTarget0=b.registerColorTarget({name:"mainColorTarget0"});this.mainColorTarget1=b.registerColorTarget({name:"mainColorTarget1"});this.mainDepth=b.registerDepthTarget({name:"mainDepth"});this.linearDepth=b.registerColorTarget({name:"linearDepth",samplingMode:9728});this.normal=b.registerColorTarget({name:"normal"});this.highlight=b.registerColorTarget({name:"highlight",dataType:32819});this.hudVisibility=b.registerColorTarget({name:"hudVisibility",dataType:32819});this.tmpColor=b.registerColorTarget({name:"tmpColor"});
this.tmpDepth=b.registerDepthTarget({name:"tmpDepth"})}Object.defineProperty(b.prototype,"width",{get:function(){return this.dimensions.width},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this.dimensions.height},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"background",
{get:function(){return this._background},set:function(a){this._background=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"currentColorTarget",{get:function(){return 0===this._currentRenderTarget?this.mainColorTarget0:this.mainColorTarget1},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"previousColorTarget",{get:function(){return 0===this._currentRenderTarget?this.mainColorTarget1:this.mainColorTarget0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"currentRenderTarget",{get:function(){return this._currentRenderTarget},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"framebuffer",{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.currentColorTarget,this.mainDepth)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"colorTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"depthTexture",{get:function(){return this.renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"linearDepthTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.linearDepth)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"lastFrameColorTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"normalTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.normal)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"highlightTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.highlight)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hudVisibilityTexture",{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"tmpColorTexture",{get:function(){return this.getColorTexture(this.tmpColor)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"mainColorTexture",{get:function(){return this.getColorTexture(this.currentColorTarget)},enumerable:!0,configurable:!0});b.prototype.advanceCurrentRenderTarget=function(){this._currentRenderTarget=0===this._currentRenderTarget&&this._needLastFrameColorTexture?1:0};b.prototype.initializeFrame=function(a){m.assert(this.enabled);var b=this._rctx;this.dimensions.width=
a.fullWidth;this.dimensions.height=a.fullHeight;this.bindTarget(this.currentColorTarget,this.mainDepth);b.setClearStencil(0);a=this._background.color;b.setClearColor(a[0]*a[3],a[1]*a[3],a[2]*a[3],a[3]);b.clearSafe(17664)};b.prototype.composite=function(){this._compositingHelper.composite(this.colorTexture,0)};b.prototype.renderAndComposite=function(a,b){this.renderToTargets(a,this.tmpColor,this.mainDepth,h);this._compositingHelper.composite(this.getColorTexture(this.tmpColor),b)};b.prototype.renderHUDVisibility=
function(a){this.renderToTargets(a,this.hudVisibility,this.mainDepth,e)};b.prototype.compositeTransparentTerrainOntoHUDVisibility=function(){var a=this;this.renderToTargets(function(){a._compositingHelper.compositeSpecial(a.getColorTexture(a.tmpColor),2)},this.hudVisibility,this.mainDepth)};b.prototype.compositeTransparentTerrainOntoMain=function(){this.bindFramebuffer();this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2)};b.prototype.compositeOccludedOntoMain=function(a){this.bindFramebuffer();
this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2,a)};b.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};b.prototype.renderDepthDetached=function(a){var b=this.bindTarget(this.currentColorTarget);a(b);this.bindTarget(this.currentColorTarget,this.mainDepth)};b.prototype.disposeTarget=function(a){this.renderTargetHelper.disposeTargetResource(a)};b.prototype.enable=function(){this.enabled||(this._enabled=!0)};b.prototype.disable=function(){this.enabled&&
(this._enabled=!1,this.renderTargetHelper.dispose())};Object.defineProperty(b.prototype,"needLastFrameColorTexture",{get:function(){return this._needLastFrameColorTexture},set:function(a){!a&&this._needLastFrameColorTexture&&(this._currentRenderTarget=0,this.disposeTarget(this.mainColorTarget1));this._needLastFrameColorTexture=a},enumerable:!0,configurable:!0});b.prototype.renderToTargets=function(a,b,d,c,e,f){var g=this._rctx;b=this.bindTarget(b,d);d=0;c&&(g.setClearColor(c[0],c[1],c[2],Math.max(1E-13,
c[3])),d|=16384);e&&(d|=256);f&&(d|=1024);g.clearSafe(d,!0===f?255:!1===f?0:f);a(b);g.gl.flush();this.bindTarget(this.currentColorTarget,this.mainDepth);return b};b.prototype.bindTarget=function(a,b){a=this.renderTargetHelper.getFramebuffer(this.dimensions,a,b);this._rctx.bindFramebuffer(a);return a};b.prototype.getColorTexture=function(a){return this.renderTargetHelper.getColorTexture(a,this.dimensions)};b.prototype.getGpuMemoryUsage=function(){var a=0;this.renderTargetHelper&&(a+=this.renderTargetHelper.getGpuMemoryUsage());
return a};return b}()})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define("require exports tslib ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/Texture ../../../webgl/Util".split(" "),function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});var g={dataType:5121},l={};n=function(){function b(a){this.rctx=a;this._activeTargets=new Set;this._depthTextures=new Map;this._depthBuffers=new Map;this._colorTextures=new Map;this._framebuffers=
new Map;this._nextId=1;this.depthTextureSupported=a.capabilities.depthTexture}b.prototype.dispose=function(){this._depthBuffers.forEach(function(a){return a.dispose()});this._depthBuffers.clear();this._depthTextures.forEach(function(a){return a.dispose()});this._depthTextures.clear();this._colorTextures.forEach(function(a){return a.dispose()});this._colorTextures.clear();this._framebuffers.forEach(function(a){return a.dispose()});this._framebuffers.clear()};b.prototype.disposeTargetResource=function(a){a=
a.id;this._activeTargets.has(a)&&(this._activeTargets.delete(a),this._depthTextures.has(a)&&(this._depthTextures.get(a).dispose(),this._depthTextures.delete(a)),this._depthBuffers.has(a)&&(this._depthBuffers.get(a).dispose(),this._depthBuffers.delete(a)),this._colorTextures.has(a)&&(this._colorTextures.get(a).dispose(),this._colorTextures.delete(a)))};b.prototype.getDepthTexture=function(a,b){if(this.depthTextureSupported){var c=this._depthTextures.get(a.id);!c||c.descriptor.width===b.width&&c.descriptor.height===
b.height||(c.dispose(),c=void 0);c||(c=new e(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:b.width,height:b.height}),this._depthTextures.set(a.id,c),this._activeTargets.add(a.id));return c}};b.prototype.getAllocatedDepthTexture=function(a){return this._depthTextures.get(a.id)};b.prototype.getDepthBuffer=function(b,d){if(!this.depthTextureSupported){var c=this._depthBuffers.get(b.id);c?c.descriptor.width===d.width&&c.descriptor.height===d.height||c.resize(d.width,
d.height):(c=new h(this.rctx,a.__assign({internalFormat:34041},d)),this._depthBuffers.set(b.id,c),this._activeTargets.add(b.id));return c}};b.prototype.getColorTexture=function(a,b){var c=this._colorTextures.get(a.id);!c||c.descriptor.width===b.width&&c.descriptor.height===b.height||(c.dispose(),c=void 0);c||(c=new e(this.rctx,{target:3553,pixelFormat:6408,dataType:a.dataType,samplingMode:null!=a.samplingMode?a.samplingMode:9729,wrapMode:33071,width:b.width,height:b.height}),this._colorTextures.set(a.id,
c),this._activeTargets.add(a.id));return c};b.prototype.getAllocatedColorTexture=function(a){return this._colorTextures.get(a.id)};b.prototype.registerDepthTarget=function(b){void 0===b&&(b={});var c=this._nextId++;return a.__assign(a.__assign({id:c},l),b)};b.prototype.registerColorTarget=function(b){void 0===b&&(b={});var c=this._nextId++;return a.__assign(a.__assign({id:c},g),b)};b.prototype.getFramebuffer=function(a,b,d){var c=this.getKey(b,d),e=this._framebuffers.get(c);b=this.getColorTexture(b,
a);if(this.depthTextureSupported){var f=d?this.getDepthTexture(d,a):void 0;if(!e)return e=d?new m(this.rctx,{colorTarget:0,depthStencilTarget:4},b,f):new m(this.rctx,{colorTarget:0,depthStencilTarget:0},b),this._framebuffers.set(c,e),e;if(d=e.width!==a.width||e.height!==a.height||e.colorTexture!==b||e.depthStencilTexture!==f)e.detachColorTexture(),e.detachDepthStencilTexture(),e.resize(a.width,a.height),e.attachColorTexture(b),e.attachDepthStencilTexture(f);return e}f=d?this.getDepthBuffer(d,a):void 0;
if(!e)return e=new m(this.rctx,{colorTarget:0,depthStencilTarget:d?3:0},b,f),this._framebuffers.set(c,e),e;if(d=e.width!==a.width||e.height!==a.height||e.colorTexture!==b)e.detachColorTexture(),e.detachDepthStencilBuffer(),e.resize(a.width,a.height),e.attachColorTexture(b),e.attachDepthStencilBuffer(f);return e};b.prototype.getKey=function(a,b){return a.id+"_"+(b?b.id:"X")+"_"+a.name+(b?"_"+b.name:"")};b.prototype.getGpuMemoryUsage=function(){var a=0,b=new Set,d=function(c){b.has(c)||(b.add(c),a+=
f.getGpuMemoryUsage(c))};this._depthTextures.forEach(d);this._colorTextures.forEach(d);this._depthBuffers.forEach(d);this._framebuffers.forEach(d);return a};return b}();b.RenderTargetHelper=n})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define(["require","exports","./depthRange","./Util"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this.pluginContext=a;this.renderPlugins=[];this.slots=[];for(a=0;23>a;++a)this.slots[a]=[]}b.prototype.add=
function(a,b){this.renderPlugins.push(b);for(var e=0;e<a.length;++e)this.slots[a[e]].push(b);b.initializeRenderContext(this.pluginContext);this.pluginContext.requestRender()};b.prototype.remove=function(a){var b=this.renderPlugins.length;this.renderPlugins=this.renderPlugins.filter(function(b){return b!==a});m.assert(this.renderPlugins.length<b,"Removing non-added render plugin");for(b=0;b<this.slots.length;++b)this.slots[b]=this.slots[b].filter(function(b){return b!==a});a.uninitializeRenderContext();
this.pluginContext.requestRender()};b.prototype.prepareRender=function(a){for(var b=0,e=this.renderPlugins;b<e.length;b++){var d=e[b];d.prepareRender&&d.prepareRender(a)}};b.prototype.render=function(a,b){b.slot=a;var e=!1,d=0;for(a=this.slots[a];d<a.length;d++){var c=a[d];c.canRender&&c.render(b)&&(e=!0)}return e};b.prototype.queryDepthRange=function(b){var e=h;e.near=Infinity;e.far=-Infinity;for(var f=0,d=this.renderPlugins;f<d.length;f++){var c=d[f];c.queryDepthRange&&(c=c.queryDepthRange(b))&&
a.union(e,c,e)}return e};Object.defineProperty(b.prototype,"needsHighlight",{get:function(){return this.renderPlugins.some(function(a){return a.needsHighlight})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"needsLinearDepth",{get:function(){return this.renderPlugins.some(function(a){return a.needsLinearDepth})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"needsLaserlineWithContrastControl",{get:function(){var a=this.slots[17];return!!a&&0<a.length},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"renderOccludedFlags",{get:function(){var a=0;this.renderPlugins.forEach(function(b){b.renderOccludedFlags&&(a|=b.renderOccludedFlags)});return a},enumerable:!0,configurable:!0});return b}();b.RenderPluginManager=n;var h={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ./Camera ./DefaultTextureUnits ./glUtil3D ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w){function q(a,b){f.vec2.set(la,a[b],a[b+3]);return la}var y=function(){return function(){this.camera=new p.default;this.lightMat=e.mat4f64.create()}}();n=function(){function b(a,b){this.rctx=a;this.viewingMode=b;this._enabled=!1;this.maxTextureSize=this.textureSize=0;this.numCascades=1;this.maxNumCascades=4;this.splitSchemeLambda=0;this.warp=!0;this.cascadeDistances=[0,0,0,0,0];this.cascades=[];this.emptyTexture=t.createEmptyTexture(this.rctx);this.maxTextureSize=
this.rctx.parameters.maxTextureSize;for(a=0;4>a;++a)this.cascades.push(new y)}b.prototype.dispose=function(){this.emptyTexture.dispose();this.emptyTexture=null;this.discardDepthTexture()};Object.defineProperty(b.prototype,"maxCascades",{get:function(){return this.maxNumCascades},set:function(b){this.maxNumCascades=a.clamp(Math.floor(b),1,4)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"enabled",{get:function(){return this._enabled},set:function(a){(this._enabled=a)||this.discardDepthTexture()},
enumerable:!0,configurable:!0});b.prototype.getDepthTexture=function(){return this.depthTexture};b.prototype.getCascades=function(){for(var a=0;a<this.numCascades;++a)W[a]=this.cascades[a];W.length=this.numCascades;return W};b.prototype.prepare=function(b,d,e){u.assert(this.enabled);this.textureSize=this.computeTextureSize(b.fullWidth,b.fullHeight);this.assertDepthTexture();h.mat4.multiply(B,b.projectionMatrix,b.viewMatrix);var g=e.near,k=e.far;2>g&&(g=2);2>k&&(k=2);g>=k&&(g=2,k=4);this.numCascades=
Math.min(1+Math.floor(u.logWithBase(k/g,4)),this.maxNumCascades);var m=(k-g)/this.numCascades,p=Math.pow(k/g,1/this.numCascades),k=g;for(e=0;e<this.numCascades+1;++e)this.cascadeDistances[e]=a.lerp(k,g,this.splitSchemeLambda),k*=p,g+=m;h.mat4.invert(C,B);e=0===this.viewingMode?b.eye:l.vec3.set(R,0,0,1);h.mat4.lookAt(Q,[0,0,0],[-d[0],-d[1],-d[2]],e);m=b.viewMatrix;b=b.projectionMatrix;for(e=0;e<this.numCascades;++e){p=this.cascades[e];g=-this.cascadeDistances[e];k=-this.cascadeDistances[e+1];g=(b[10]*
g+b[14])/Math.abs(b[11]*g+b[15]);k=(b[10]*k+b[14])/Math.abs(b[11]*k+b[15]);u.assert(g<k);for(var r=0;8>r;++r){c.vec4.set(F,0===r%4||3===r%4?-1:1,0===r%4||1===r%4?-1:1,4>r?g:k,1);c.vec4.transformMat4(H[r],F,C);for(var n=0;3>n;++n)H[r][n]/=H[r][3]}l.vec3.negate(R,H[0]);h.mat4.translate(A,Q,R);p.camera.viewMatrix=A;for(r=0;8>r;++r)l.vec3.transformMat4(H[r],H[r],p.camera.viewMatrix);l.vec3.copy(I,H[0]);l.vec3.copy(G,H[0]);for(r=1;8>r;++r)for(n=0;3>n;++n)I[n]=Math.min(I[n],H[r][n]),G[n]=Math.max(G[n],
H[r][n]);I[2]-=200;G[2]+=200;p.camera.near=-G[2];p.camera.far=-I[2];if(this.warp){g=1/H[0][3];k=1/H[4][3];u.assert(g<k);var r=g+Math.sqrt(g*k),k=Math.sin(a.acosClamped(m[2]*d[0]+m[6]*d[1]+m[10]*d[2])),r=r/k,g=H,t=r,v=k,k=J,w=E,y=L,n=M,r=N;f.vec2.set(P,0,0);for(var z=0;4>z;++z)f.vec2.add(P,P,g[z]);f.vec2.scale(P,P,.25);f.vec2.set(ba,0,0);for(z=4;8>z;++z)f.vec2.add(ba,ba,g[z]);f.vec2.scale(ba,ba,.25);f.vec2.lerp(V[0],g[4],g[5],.5);f.vec2.lerp(V[1],g[5],g[6],.5);f.vec2.lerp(V[2],g[6],g[7],.5);f.vec2.lerp(V[3],
g[7],g[4],.5);for(var O=0,U=f.vec2.squaredDistance(V[0],P),z=1;4>z;++z){var x=f.vec2.squaredDistance(V[z],P);x<U&&(U=x,O=z)}f.vec2.subtract(T,V[O],g[O+4]);z=T[0];T[0]=-T[1];T[1]=z;f.vec2.subtract(X,ba,P);0>f.vec2.dot(X,T)&&f.vec2.negate(T,T);f.vec2.lerp(T,T,X,v);f.vec2.normalize(T,T);O=v=void 0;v=O=f.vec2.dot(f.vec2.subtract(Y,g[0],P),T);for(z=1;8>z;++z)U=f.vec2.dot(f.vec2.subtract(Y,g[z],P),T),U<v?v=U:U>O&&(O=U);f.vec2.copy(k,P);f.vec2.scale(Y,T,v-t);f.vec2.add(k,k,Y);for(var x=-1,W=1,z=t=U=0;8>
z;++z){f.vec2.subtract(da,g[z],k);f.vec2.normalize(da,da);var Va=T[0]*da[1]-T[1]*da[0];0<Va?Va>x&&(x=Va,U=z):Va<W&&(W=Va,t=z)}u.verify(0<x,"leftArea");u.verify(0>W,"rightArea");f.vec2.scale(fa,T,v);f.vec2.add(fa,fa,P);f.vec2.scale(ga,T,O);f.vec2.add(ga,ga,P);ka[0]=-T[1];ka[1]=T[0];w=u.rayRay2D(k,g[t],ga,f.vec2.add(Y,ga,ka),1,w);y=u.rayRay2D(k,g[U],ga,Y,1,y);n=u.rayRay2D(k,g[U],fa,f.vec2.add(Y,fa,ka),1,n);g=u.rayRay2D(k,g[t],fa,Y,1,r);u.verify(w,"rayRay");u.verify(y,"rayRay");u.verify(n,"rayRay");
u.verify(g,"rayRay");y=J;g=E;k=M;n=N;r=p.camera.projectionMatrix;f.vec2.subtract(ia,k,n);f.vec2.scale(ia,ia,.5);Z[0]=ia[0];Z[1]=ia[1];Z[2]=0;Z[3]=ia[1];Z[4]=-ia[0];Z[5]=0;Z[6]=ia[0]*ia[0]+ia[1]*ia[1];Z[7]=ia[0]*ia[1]-ia[1]*ia[0];Z[8]=1;Z[6]=-f.vec2.dot(q(Z,0),y);Z[7]=-f.vec2.dot(q(Z,1),y);y=f.vec2.dot(q(Z,0),k)+Z[6];w=f.vec2.dot(q(Z,1),k)+Z[7];z=f.vec2.dot(q(Z,0),n)+Z[6];n=f.vec2.dot(q(Z,1),n)+Z[7];y=-(y+z)/(w+n);Z[0]+=Z[1]*y;Z[3]+=Z[4]*y;Z[6]+=Z[7]*y;y=1/(f.vec2.dot(q(Z,0),k)+Z[6]);w=1/(f.vec2.dot(q(Z,
1),k)+Z[7]);Z[0]*=y;Z[3]*=y;Z[6]*=y;Z[1]*=w;Z[4]*=w;Z[7]*=w;Z[2]=Z[1];Z[5]=Z[4];Z[8]=Z[7];Z[7]+=1;y=f.vec2.dot(q(Z,1),g)+Z[7];w=f.vec2.dot(q(Z,2),g)+Z[8];z=f.vec2.dot(q(Z,1),k)+Z[7];n=f.vec2.dot(q(Z,2),k)+Z[8];y=-.5*(y/w+z/n);Z[1]+=Z[2]*y;Z[4]+=Z[5]*y;Z[7]+=Z[8]*y;y=f.vec2.dot(q(Z,1),g)+Z[7];w=f.vec2.dot(q(Z,2),g)+Z[8];z=-w/y;Z[1]*=z;Z[4]*=z;Z[7]*=z;r[0]=Z[0];r[1]=Z[1];r[2]=0;r[3]=Z[2];r[4]=Z[3];r[5]=Z[4];r[6]=0;r[7]=Z[5];r[8]=0;r[9]=0;r[10]=1;r[11]=0;r[12]=Z[6];r[13]=Z[7];r[14]=0;r[15]=Z[8];p.camera.projectionMatrix[10]=
2/(I[2]-G[2]);p.camera.projectionMatrix[14]=-(I[2]+G[2])/(I[2]-G[2])}else h.mat4.ortho(p.camera.projectionMatrix,I[0],G[0],I[1],G[1],p.camera.near,p.camera.far);h.mat4.multiply(p.lightMat,p.camera.projectionMatrix,p.camera.viewMatrix);g=this.textureSize/2;p.camera.viewport[0]=0===e%2?0:g;p.camera.viewport[1]=0===Math.floor(e/2)?0:g;p.camera.viewport[2]=g;p.camera.viewport[3]=g}this.lastOrigin=null;d=this.rctx;d.bindFramebuffer(this.fbo);d.bindTexture(null,7);d.setClearColor(1,1,1,1);d.clearSafe(16640)};
b.prototype.finish=function(a){u.assert(this.enabled);this.rctx.bindFramebuffer(a)};b.prototype.bind=function(a,b){var c=this.rctx;c.bindTexture(this.enabled?this.depthTexture:this.emptyTexture,b);c.bindProgram(a);a.setUniform1i("depthTex",b);a.setUniform1f("depthHalfPixelSz",this.enabled?.5/this.textureSize:-1);a.setUniform1i("shadowMapNum",this.numCascades);a.setUniform4f("shadowMapDistance",this.cascadeDistances[0],1<this.numCascades?this.cascadeDistances[1]:Infinity,2<this.numCascades?this.cascadeDistances[2]:
Infinity,3<this.numCascades?this.cascadeDistances[3]:Infinity)};b.prototype.bindToAllPrograms=function(a){a=a.getProgramsUsingUniform("shadowMapDistance");for(var b=0;b<a.length;b++)this.bind(a[b],r.DefaultTextureUnits.SHADOW_MAP)};b.prototype.bindView=function(a,b){if(this.enabled){var c=this.lastOrigin;if(!c||c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2])for(this.lastOrigin=this.lastOrigin||d.vec3f64.create(),l.vec3.copy(this.lastOrigin,b),c=0;c<this.numCascades;++c){h.mat4.translate(O,this.cascades[c].lightMat,
b);for(var e=0;16>e;++e)U[16*c+e]=O[e]}a.setUniformMatrix4fv("shadowMapMatrix",U)}};b.prototype.computeTextureSize=function(a,b){return Math.min(this.maxTextureSize,2*Math.pow(2,Math.round(.5*Math.log(a*a+b*b)*Math.LOG2E+.35)))};b.prototype.assertDepthTexture=function(){if(null==this.depthTexture||this.depthTexture.descriptor.width!==this.textureSize)this.discardDepthTexture(),this.depthTexture=new z(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,
width:this.textureSize,height:this.textureSize}),this.fbo=new v(this.rctx,{colorTarget:0,depthStencilTarget:1,width:this.textureSize,height:this.textureSize},this.depthTexture)};b.prototype.discardDepthTexture=function(){this.fbo&&(this.fbo.dispose(),this.fbo=null);this.depthTexture&&(this.depthTexture.dispose(),this.depthTexture=null)};b.prototype.getGpuMemoryUsage=function(){return w.getGpuMemoryUsage(this.fbo)};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{maxNumCascades:this.maxNumCascades,
cascades:this.cascades,textureSize:this.textureSize,set splitSchemeLambda(b){a.splitSchemeLambda=b},get splitSchemeLambda(){return a.splitSchemeLambda},set warp(b){a.warp=b},get warp(){return a.warp}}},enumerable:!0,configurable:!0});return b}();var A=e.mat4f64.create(),B=e.mat4f64.create(),C=e.mat4f64.create(),F=k.vec4f64.create(),H=[];for(b=0;8>b;++b)H.push(k.vec4f64.create());var I=d.vec3f64.create(),G=d.vec3f64.create(),J=g.vec2f64.create(),E=g.vec2f64.create(),L=g.vec2f64.create(),M=g.vec2f64.create(),
N=g.vec2f64.create(),Q=e.mat4f64.create(),R=d.vec3f64.create(),W=[],O=e.mat4f64.create(),U=new Float32Array(64),P=g.vec2f64.create(),ba=g.vec2f64.create(),V=[g.vec2f64.create(),g.vec2f64.create(),g.vec2f64.create(),g.vec2f64.create()],T=g.vec2f64.create(),X=g.vec2f64.create(),Y=g.vec2f64.create(),da=g.vec2f64.create(),fa=g.vec2f64.create(),ga=g.vec2f64.create(),ka=g.vec2f64.create(),la=g.vec2f64.create(),ia=g.vec2f64.create(),Z=m.mat3f64.create();return n})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["require",
"exports","../../support/geometryUtils"],function(n,b,a){var m=a.boundedPlane.create();return function(){function a(){this._worldPlane=m}Object.defineProperty(a.prototype,"isEnabled",{get:function(){return this.plane!==m},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"plane",{get:function(){return this._worldPlane},set:function(a){this._worldPlane=a?a:m},enumerable:!0,configurable:!0});return a}()})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../../../core/maybe ../../../../core/promiseUtils ../../support/imageUtils ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/VertexArrayObject @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c){return function(){function b(a){this.resourceLoadingPromise=null;this.isEnabled=!1;this.vertexAttributeLocations={vPosition:0};this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}b.prototype.loadResources=function(a){var b=this;if(!this.data||!this.textureArea||!this.textureSearch){var c=this.resourceLoadingPromise||this.loadDataModule().then(function(){return b.loadTextures()});a&&c.then(a);this.resourceLoadingPromise||
(this.resourceLoadingPromise=c,c.then(function(){return b.resourceLoadingPromise=null}));return!1}return!0};b.prototype.loadDataModule=function(){var a=this;return this.data?m.resolve():(new Promise(function(a,b){n(["./SmaaRenderPassData"],a,b)})).then(function(b){a.data=b})};b.prototype.loadTextures=function(){var a=this;return m.all([this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.loadTextureFromBase64(this.data.searchTexure,9728,6409)]).then(function(b){var c=b[1];a.textureArea=
b[0];a.textureSearch=c})};Object.defineProperty(b.prototype,"isLoadingResources",{get:function(){return null!=this.resourceLoadingPromise},enumerable:!0,configurable:!0});b.prototype.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;var a=this.rctx;this.programEdgeDetect=new g(a,this.data.edgeDetectShader.vertex,this.data.edgeDetectShader.fragment,this.vertexAttributeLocations);this.programBlendWeights=new g(a,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,
this.vertexAttributeLocations);this.programBlur=new g(a,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations);this.pipelineState=l.makePipelineState({colorWrite:l.defaultColorWriteParams});var b=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new c(a,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new e(a,34962,35044,b)});this.tmpFramebufferEdges=new f(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6407,dataType:5121,
samplingMode:9729,wrapMode:33071,width:4,height:4});this.tmpFramebufferBlend=new f(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4});return this.isEnabled=!0};b.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=
null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)};b.prototype.render=function(b,c){this.enable();var d=this.rctx,e=0,f=0;a.isSome(c)?(e=c.descriptor.width,f=c.descriptor.height):(e=d.gl.canvas.width,f=d.gl.canvas.height);d.bindVAO(this.vao);d.setPipelineState(this.pipelineState);d.setViewport(0,
0,e,f);this.tmpFramebufferEdges.resize(e,f);d.bindFramebuffer(this.tmpFramebufferEdges);d.setClearColor(0,0,0,1);d.clear(16384);d.bindProgram(this.programEdgeDetect);d.bindTexture(b.colorTexture,0);this.programEdgeDetect.setUniform1i("tColor",0);this.programEdgeDetect.setUniform4f("uResolution",1/e,1/f,e,f);d.drawArrays(4,0,3);this.tmpFramebufferBlend.resize(e,f);d.bindFramebuffer(this.tmpFramebufferBlend);d.setClearColor(0,0,1,1);d.clear(16384);d.bindProgram(this.programBlendWeights);this.programBlendWeights.setUniform4f("uResolution",
1/e,1/f,e,f);d.bindTexture(this.textureSearch,1);this.programBlendWeights.setUniform1i("tSearch",1);d.bindTexture(this.textureArea,2);this.programBlendWeights.setUniform1i("tArea",2);d.bindTexture(this.tmpFramebufferEdges.colorTexture,3);this.programBlendWeights.setUniform1i("tEdges",3);d.drawArrays(4,0,3);d.bindFramebuffer(c);d.setClearColor(0,1,0,1);d.clear(16384);d.bindProgram(this.programBlur);this.programBlur.setUniform4f("uResolution",1/e,1/f,e,f);d.bindTexture(b.colorTexture,0);this.programBlur.setUniform1i("tColor",
0);d.bindTexture(this.tmpFramebufferBlend.colorTexture,1);this.programBlur.setUniform1i("tBlendWeights",1);d.drawArrays(4,0,3)};b.prototype.loadTextureFromBase64=function(a,b,c){var e=new d(this.rctx,{pixelFormat:c,dataType:5121,wrapMode:33071,samplingMode:b},null);return h.requestImage(a).then(function(a){e.resize(a.width,a.height);e.setData(a);return e})};return b}()})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require exports ../../../../core/Logger ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/imageUtils ./DefaultTextureUnits ./glUtil3D ./SSAOTechnique ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t){var u=a.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper");b=function(){function a(a,b,e){this._enabled=!1;this._BLUR_F=2;this._attenuation=.5;this._radius=3;this._samples=16;this._viewportToRestore=f.vec4f64.create();this._rctx=b;this._techniqueRep=a;this._requestRender=e;this._ssaoTechniqueConfig=new c.SSAOTechniqueConfiguration;this._emptyTexture=d.createColorTexture(b,[1,1,1,1])}a.prototype.dispose=function(){this._emptyTexture.dispose();this._emptyTexture=
null};Object.defineProperty(a.prototype,"isSupported",{get:function(){var a=this._rctx,b=-1!==a.parameters.versionString.indexOf("WebGL 0.93"),a=-1!==a.parameters.versionString.indexOf("WebGL 0.94");return!(b||a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"attenuation",{get:function(){return this._attenuation},set:function(a){this._attenuation=
a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"radius",{get:function(){return this._radius},set:function(a){this._radius=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"filterRadius",{get:function(){return 4},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"samples",{get:function(){return this._samples},set:function(a){this._samples=a;this._enabled&&this.selectPrograms()},enumerable:!0,configurable:!0});a.prototype.computeSSAO=function(a,
b,c){if(this._noiseTexture){k.assert(this.enabled);var f=this._rctx,g=a.fullViewport,l=g[2],m=g[3],g=l/this._BLUR_F,p=m/this._BLUR_F;this._ssaoFBO.resize(l,m);this._blur0FBO.resize(g,p);this._blur1FBO.resize(g,p);g=1*l;p=1*m;f.bindFramebuffer(this._ssaoFBO);e.vec4.copy(this._viewportToRestore,a.fullViewport);f.setViewport(0,0,l,m);var q=this._ssaoTechnique.program,r=this._blurTechnique.program;f.bindProgram(q);f.setPipelineState(this._ssaoTechnique.pipeline);q.setUniform2f("rnmScale",l/this._noiseTexture.descriptor.width,
m/this._noiseTexture.descriptor.height);q.setUniform3fv("pSphere",8>=this._samples?this._data.random8:16>=this._samples?this._data.random16:32>=this._samples?this._data.random32:this._data.random64);l=this._data.minDiscrepancy;q.setUniform1f("numSpiralTurns",this._samples<l.length?l[this._samples]:5779);l=z;m=v;k.inverseProjectionInfo(a.projectionMatrix,a.fullWidth,a.fullHeight,l,m);q.setUniform4fv("projInfo",l);q.setUniform2fv("zScale",m);q.setUniform2f("nearFar",a.near,a.far);l=1/a.computeRenderPixelSizeAtDist(1);
q.setUniform1f("projScale",1*l);q.setUniform2f("screenDimensions",g,p);var n=2*this._radius,m=h.vec3.distance(a.eye,a.center),n=20*a.computeRenderPixelSizeAtDist(m),n=Math.max(.1,n);q.setUniform1f("radius",n);q.setUniform1f("intensity",4*this._attenuation/Math.pow(n,6));q.setUniform1i("rnm",0);q.setUniform1i("normalMap",1);q.setUniform1i("depthMap",2);f.bindTexture(this._noiseTexture,0);f.bindTexture(c,1);f.bindTexture(b,2);b=d.createQuadVAO(this._rctx);f.bindVAO(b);f.drawArrays(5,0,t.vertexCount(b,
"geometry"));f.bindTexture(this._ssaoFBO.colorTexture,0);f.setViewport(0,0,g/this._BLUR_F,p/this._BLUR_F);f.bindFramebuffer(this._blur0FBO);f.bindProgram(r);r.setUniform2f("screenDimensions",g,p);r.setUniform1i("tex",0);r.setUniform1i("normalMap",1);r.setUniform1i("depthMap",2);r.setUniform2f("blurSize",0,1*this._BLUR_F/p);r.setUniform1i("radius",4);r.setUniform1f("g_BlurFalloff",.08);r.setUniform2f("nearFar",a.near,a.far);5E4<m&&(l=Math.max(0,l-(m-5E4)));r.setUniform1f("projScale",l);r.setUniform2f("zScale",
1,0);f.drawArrays(5,0,t.vertexCount(b,"geometry"));r.setUniform2f("blurSize",1*this._BLUR_F/g,0);f.bindFramebuffer(this._blur1FBO);f.bindTexture(this._blur0FBO.colorTexture,0);f.drawArrays(5,0,t.vertexCount(b,"geometry"));f.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]);b.dispose(!0)}};a.prototype.setUniforms=function(a,b){var c=this.enabled&&this._noiseTexture,d=this._rctx;d.bindTexture(c?this._blur1FBO.colorTexture:this._emptyTexture,
b);d.setActiveTexture(0);a.setUniform1i("ssaoTex",b);c?a.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):a.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};a.prototype.bindToAllPrograms=function(a){a=a.getProgramsUsingUniform("viewportPixelSz");for(var b=0;b<a.length;b++)this.setUniforms(a[b],l.DefaultTextureUnits.SSAO)};a.prototype.selectPrograms=function(){this._ssaoTechniqueConfig.samples=8>=this._samples?8:16>=this._samples?
16:32>=this._samples?32:64;this._ssaoTechniqueConfig.radius=4;this._ssaoTechniqueConfig.output=0;this._ssaoTechnique=this._techniqueRep.acquireAndReleaseExisting(c.SSAOTechnique,this._ssaoTechniqueConfig,this._ssaoTechnique);this._ssaoTechniqueConfig.output=1;this._blurTechnique=this._techniqueRep.acquireAndReleaseExisting(c.SSAOTechnique,this._ssaoTechniqueConfig,this._blurTechnique)};a.prototype.enable=function(){var a=this;this.enabled||(this.isSupported?(this._enabled=!0,this.loadResources(function(){a._enabled&&
a.initialize()})):u.warn("SSAO is not supported for this browser or hardware"))};a.prototype.loadResources=function(a){var b=this;this._data?a():(new Promise(function(a,b){n(["./SSAOHelperData"],a,b)})).then(function(c){b._data=c;a()})};a.prototype.initialize=function(){var a=this,b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},c={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=new p(this._rctx,c,b);this._blur0FBO=new p(this._rctx,c,b);this._blur1FBO=
new p(this._rctx,c,b);g.requestImage(this._data.noiseTexture).then(function(b){a._enabled&&(a._noiseTexture=new r(a._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:b.width,height:b.height},b),a._requestRender())});this.selectPrograms()};a.prototype.disable=function(){this.enabled&&(this._enabled=!1,this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),
this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))};a.prototype.getGpuMemoryUsage=function(){return t.getGpuMemoryUsage(this._blur0FBO)+t.getGpuMemoryUsage(this._blur1FBO)+t.getGpuMemoryUsage(this._ssaoFBO)};Object.defineProperty(a.prototype,"test",{get:function(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}},enumerable:!0,configurable:!0});return a}();var v=m.vec2f64.create(),z=f.vec4f64.create();return b})},"esri/views/3d/webgl-engine/lib/SSAOTechnique":function(){define("require exports tslib ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../shaders/SSAO.glsl ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",{value:!0});h=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}a.__extends(c,b);c.prototype.initializeProgram=function(a){var b=c.shader.get(),d=this.configuration,b=b.build({output:d.output,samples:d.samples,radius:d.radius});return new l(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),f.Default3D)};c.prototype.initializePipeline=function(){return d.makePipelineState({colorWrite:d.defaultColorWriteParams})};
c.shader=new m.ReloadableShaderModule(g,function(){return new Promise(function(a,b){n(["../shaders/SSAO.glsl"],a,b)})});return c}(h.ShaderTechnique);b.SSAOTechnique=h;h=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.output=0;a.samples=64;a.radius=4;return a}a.__extends(c,b);a.__decorate([e.parameter({count:2})],c.prototype,"output",void 0);a.__decorate([e.parameter()],c.prototype,"samples",void 0);a.__decorate([e.parameter()],c.prototype,"radius",void 0);return c}(e.ShaderTechniqueConfiguration);
b.SSAOTechniqueConfiguration=h})},"esri/views/3d/webgl-engine/shaders/SSAO.glsl":function(){define("require exports tslib ../core/shaderLibrary/ScreenSpacePass ../core/shaderLibrary/output/ReadLinearDepth.glsl ../core/shaderLibrary/util/CameraSpace.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var n=new g.ShaderBuilder;n.include(m.ScreenSpacePass);1===b.output&&(n.include(h.ReadLinearDepth),
n.fragment.code.add(f.glsl(l||(l=a.__makeTemplateObject(["\n      #ifndef RADIUS\n        #define RADIUS "],["\n      #ifndef RADIUS\n        #define RADIUS "])))+b.radius+"\n      #endif\n    "),n.fragment.uniforms.add("normalMap","sampler2D").add("depthMap","sampler2D").add("tex","sampler2D").add("blurSize","vec2").add("g_BlurFalloff","float").add("projScale","float").add("nearFar","vec2").add("zScale","vec2"),n.fragment.code.add(f.glsl(d||(d=a.__makeTemplateObject(["\n      float blurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {\n        float c \x3d texture2D(tex, uv).r;\n        float d \x3d linearDepthFromTexture(depthMap, uv, nearFar);\n\n        float ddiff \x3d d - center_d;\n\n        float w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\n\n        w_total +\x3d w;\n\n        return w*c;\n      }\n\n      void main(void) {\n        float b \x3d 0.0;\n        float w_total \x3d 0.0;\n\n        float center_d \x3d linearDepthFromTexture(depthMap, uv, nearFar);\n\n        float sharpness \x3d -0.05 * projScale/(center_d*zScale.x+zScale.y);\n        for (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r) {\n          float rf \x3d float(r);\n          vec2 uvOffset \x3d uv + rf*blurSize;\n          b +\x3d blurFunction(uvOffset, rf, center_d, w_total, sharpness);\n        }\n\n        gl_FragColor \x3d vec4(b/w_total);\n      }\n    "],
["\n      float blurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {\n        float c \x3d texture2D(tex, uv).r;\n        float d \x3d linearDepthFromTexture(depthMap, uv, nearFar);\n\n        float ddiff \x3d d - center_d;\n\n        float w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\n\n        w_total +\x3d w;\n\n        return w*c;\n      }\n\n      void main(void) {\n        float b \x3d 0.0;\n        float w_total \x3d 0.0;\n\n        float center_d \x3d linearDepthFromTexture(depthMap, uv, nearFar);\n\n        float sharpness \x3d -0.05 * projScale/(center_d*zScale.x+zScale.y);\n        for (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r) {\n          float rf \x3d float(r);\n          vec2 uvOffset \x3d uv + rf*blurSize;\n          b +\x3d blurFunction(uvOffset, rf, center_d, w_total, sharpness);\n        }\n\n        gl_FragColor \x3d vec4(b/w_total);\n      }\n    "])))));
0===b.output&&(n.include(h.ReadLinearDepth),n.include(e.CameraSpace),n.fragment.uniforms.add("projMatrixInv","mat4").add("normalMap","sampler2D").add("depthMap","sampler2D").add("intensity","float").add("projScale","float").add("radius","float").add("nearFar","vec2").add("screenDimensions","vec2").add("rnmScale","vec2").add("rnm","sampler2D"),n.fragment.code.add(f.glsl(c||(c=a.__makeTemplateObject(["\n      #ifndef SAMPLES\n        #define SAMPLES "],["\n      #ifndef SAMPLES\n        #define SAMPLES "])))+
b.samples+"\n      #endif\n      uniform vec3 pSphere[SAMPLES]; //tap position\n    "),n.fragment.code.add(f.glsl(k||(k=a.__makeTemplateObject(["\n      float fallOffFunction(float vv, float vn, float bias) {\n        float radius2 \x3d radius * radius;\n\n        // A: From the HPG12 paper\n        // Note large epsilon to avoid overdarkening within cracks\n        // return float(vv \x3c radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\n\n        // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\n        float f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\n\n        // C: Medium contrast (which looks better at high radii), no division.  Note that the\n        // contribution still falls off with radius^2, but we've adjusted the rate in a way that is\n        // more computationally efficient and happens to be aesthetically pleasing.\n        // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\n\n        // D: Low contrast, no division operation\n        // return 2.0 * float(vv \x3c radius * radius) * max(vn - bias, 0.0);\n      }\n    "],
["\n      float fallOffFunction(float vv, float vn, float bias) {\n        float radius2 \x3d radius * radius;\n\n        // A: From the HPG12 paper\n        // Note large epsilon to avoid overdarkening within cracks\n        // return float(vv \x3c radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\n\n        // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\n        float f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\n\n        // C: Medium contrast (which looks better at high radii), no division.  Note that the\n        // contribution still falls off with radius^2, but we've adjusted the rate in a way that is\n        // more computationally efficient and happens to be aesthetically pleasing.\n        // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\n\n        // D: Low contrast, no division operation\n        // return 2.0 * float(vv \x3c radius * radius) * max(vn - bias, 0.0);\n      }\n    "])))),
n.fragment.code.add(f.glsl(p||(p=a.__makeTemplateObject(["\n      float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\n        vec3 v \x3d Q - C;\n        float vv \x3d dot(v, v);\n        float vn \x3d dot(normalize(v), n_C);\n        return fallOffFunction(vv, vn, 0.1);\n      }\n    "],["\n      float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\n        vec3 v \x3d Q - C;\n        float vv \x3d dot(v, v);\n        float vn \x3d dot(normalize(v), n_C);\n        return fallOffFunction(vv, vn, 0.1);\n      }\n    "])))),
n.fragment.code.add(f.glsl(r||(r=a.__makeTemplateObject(["\n      void main(void) {\n        //Hash function used in the HPG12 AlchemyAO paper\n        //Not supported in WebGL -\x3e using texture lookup as in old SSAO shader instead\n        //ivec2 ssC \x3d ivec2(gl_FragCoord.xy);\n        //float randomPatternRotationAngle \x3d float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\n        vec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n\n        float currentPixelDepth \x3d linearDepthFromTexture(depthMap, uv, nearFar);\n\n        if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\n          gl_FragColor \x3d vec4(0.0);\n          return;\n        }\n\n        vec3 currentPixelPos \x3d reconstructPosition(gl_FragCoord.xy,currentPixelDepth);\n\n        // get the normal of current fragment\n        vec4 norm4 \x3d texture2D(normalMap, uv);\n        vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\n        bool isTerrain \x3d norm4.w\x3c0.5;\n\n        float sum \x3d .0;\n\n        vec4 occluderFragment;\n        vec3 ray;\n\n        vec3 tapPixelPos;\n\n        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\n        // bug or deviation from CE somewhere else?\n        float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\n\n        for(int i \x3d 0; i \x3c SAMPLES; ++i) {\n          // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\n          //float ssR;\n          //vec2 unitOffset \x3d tapLocation(i, randomPatternRotationAngle, ssR);\n          // get the depth of the occluder fragment\n          //vec2 offset \x3d vec2(-unitOffset*radius*ssR*ps);\n\n          vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\n          vec2 offset \x3d vec2(-unitOffset*radius*ps);\n\n          //don't use current or very nearby samples\n          if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\n\n          vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\n          if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\n          vec2 tcTap \x3d tc/screenDimensions;\n          float occluderFragmentDepth \x3d linearDepthFromTexture(depthMap, tcTap, nearFar);\n\n          if (isTerrain) {\n            bool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\n            if (isTerrainTap) {\n              continue;\n            }\n          }\n\n          tapPixelPos \x3d reconstructPosition(tc, occluderFragmentDepth);\n\n          sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\n        }\n\n        // output the result\n\n        float A \x3d max(1.0-sum*intensity/float(SAMPLES),0.0);\n\n        // Anti-tone map to reduce contrast and drag dark region farther\n        // (x^0.2 + 1.2 * x^4)/2.2\n        A \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n\n        //gl_FragColor \x3d vec4(norm/2.0+0.5, 1.0);\n        //gl_FragColor \x3d vec4(-currentPixelDepth/1000.0);\n        //gl_FragColor \x3d vec4(tapPixelPos.x/100.0);\n        gl_FragColor \x3d vec4(A);\n      }\n    "],
["\n      void main(void) {\n        //Hash function used in the HPG12 AlchemyAO paper\n        //Not supported in WebGL -\x3e using texture lookup as in old SSAO shader instead\n        //ivec2 ssC \x3d ivec2(gl_FragCoord.xy);\n        //float randomPatternRotationAngle \x3d float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\n        vec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n\n        float currentPixelDepth \x3d linearDepthFromTexture(depthMap, uv, nearFar);\n\n        if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\n          gl_FragColor \x3d vec4(0.0);\n          return;\n        }\n\n        vec3 currentPixelPos \x3d reconstructPosition(gl_FragCoord.xy,currentPixelDepth);\n\n        // get the normal of current fragment\n        vec4 norm4 \x3d texture2D(normalMap, uv);\n        vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\n        bool isTerrain \x3d norm4.w\x3c0.5;\n\n        float sum \x3d .0;\n\n        vec4 occluderFragment;\n        vec3 ray;\n\n        vec3 tapPixelPos;\n\n        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\n        // bug or deviation from CE somewhere else?\n        float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\n\n        for(int i \x3d 0; i \x3c SAMPLES; ++i) {\n          // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\n          //float ssR;\n          //vec2 unitOffset \x3d tapLocation(i, randomPatternRotationAngle, ssR);\n          // get the depth of the occluder fragment\n          //vec2 offset \x3d vec2(-unitOffset*radius*ssR*ps);\n\n          vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\n          vec2 offset \x3d vec2(-unitOffset*radius*ps);\n\n          //don't use current or very nearby samples\n          if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\n\n          vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\n          if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\n          vec2 tcTap \x3d tc/screenDimensions;\n          float occluderFragmentDepth \x3d linearDepthFromTexture(depthMap, tcTap, nearFar);\n\n          if (isTerrain) {\n            bool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\n            if (isTerrainTap) {\n              continue;\n            }\n          }\n\n          tapPixelPos \x3d reconstructPosition(tc, occluderFragmentDepth);\n\n          sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\n        }\n\n        // output the result\n\n        float A \x3d max(1.0-sum*intensity/float(SAMPLES),0.0);\n\n        // Anti-tone map to reduce contrast and drag dark region farther\n        // (x^0.2 + 1.2 * x^4)/2.2\n        A \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n\n        //gl_FragColor \x3d vec4(norm/2.0+0.5, 1.0);\n        //gl_FragColor \x3d vec4(-currentPixelDepth/1000.0);\n        //gl_FragColor \x3d vec4(tapPixelPos.x/100.0);\n        gl_FragColor \x3d vec4(A);\n      }\n    "])))));
return n};var l,d,c,k,p,r})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.CameraSpace=function(b){b.fragment.uniforms.add("projInfo","vec4");b.fragment.uniforms.add("zScale","vec2");b.fragment.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n    vec3 reconstructPosition(vec2 fragCoord, float depth) {\n      return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n    }\n  "],
["\n    vec3 reconstructPosition(vec2 fragCoord, float depth) {\n      return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n    }\n  "]))))};var h})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("require exports tslib ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/promiseUtils ../../../../../core/typedArrayUtil ../../../../../core/workers ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/buffer/utils ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/util/TwoVectorPosition ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../Object3D ./bufferLayouts ./edgeBufferWriters ./EdgeProcessingWorker ./EdgeRenderer ./strokes ./util ../TextureBackedBuffer/BufferManager ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E){function L(a){for(var b=null,c=null,d=0;d<a.geometries.length;d++){var e=a.geometryRecords[d];if(e.material.supportsEdges){if(!b)b=e.transformation;else if(!m.equals(b,e.transformation))return!1;if(!c&&e.origin)c=e;else if(c&&e.origin&&c.origin.id!==e.origin.id)return!1}}return!0}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,c){this.rctx=a;this.techniqueRepository=b;this.callbacks=c;this.profilingCallback=
null;this.perObjectData=new Map;this.renderers=new Map;this.localOrigins=new q.LocalOriginManager(new z);this.gpuMemoryUsage=this.numberOfRenderedEdges=0;this.worker=new C;this.workerThread=null;this.destroyed=!1;this.tmpModelPosition=r.vec3f64.create();this.tmpCameraPosition=r.vec3f64.create();this.componentColorManager=new G.BufferManager(this.rctx,2)}b.prototype.initialize=function(){var a=this;g.open("EdgeProcessingWorker").then(function(b){a.destroyed?b.close():a.workerThread=b});for(var b=A.VertexLayout.createBuffer(4),
c=0;4>c;c++)b.sideness.set(c,0,0===c||3===c?0:1),b.sideness.set(c,1,0===c||1===c?0:1);this.verticesBufferObject=J.createVertex(this.rctx,35044,b.buffer)};b.prototype.destroy=function(){this.destroyed||(this.workerThread&&(this.workerThread.close(),this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.perObjectData.clear(),this.renderers.clear(),this.destroyed=!0)};b.prototype.getUsedMemory=function(){return this.gpuMemoryUsage};
Object.defineProperty(b.prototype,"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0});b.prototype.shouldRender=function(){return 0<this.renderers.size};b.prototype.addComponentObject=function(b,c,d,f,g,k,h,l){return a.__awaiter(this,void 0,void 0,function(){var m,p;return a.__generator(this,function(a){switch(a.label){case 0:if(this.hasObject(b))return[2];p={loaded:e.create(function(a){return m=a}),renderables:[],center:d};this.perObjectData.set(b,
p);return[4,this.addComponentGeometry(c,p,f,g,k,h,l)];case 1:return a.sent(),this.callbacks.setNeedsRender(),m(),[2]}})})};b.prototype.addOrUpdateObject=function(b,c,d,f,g){return a.__awaiter(this,void 0,void 0,function(){var k,h,l,m,p,q,r,n,t=this;return a.__generator(this,function(a){switch(a.label){case 0:k=[];l={loaded:e.create(function(a){return h=a}),renderables:[]};m=this.perObjectData.get(b);this.perObjectData.set(b,l);if(g&&g.mergeGeometries&&1<b.geometries.length&&L(b))k.push(this.addObjectMergedGeometries(b,
l,c,d));else for(p=0;p<b.geometries.length;p++)q=b.geometries[p],r=b.geometryRecords[p],n=r.material,n.supportsEdges&&k.push(this.addGeometryData(b,l,q.data,r,c[0],d,f));return[4,e.all(k)];case 1:return a.sent(),m&&m.loaded.then(function(){m.renderables.forEach(function(a){return t.removeRenderable(a)});t.callbacks.setNeedsRender()}),this.callbacks.setNeedsRender(),h(),[2]}})})};b.prototype.hasObject=function(a){return this.perObjectData.has(a)};b.prototype.updateAllComponentOpacities=function(b,
c){return a.__awaiter(this,void 0,void 0,function(){var d,e,f=this;return a.__generator(this,function(a){switch(a.label){case 0:return d=c instanceof Array?function(a){return c[a]}:function(){return c},[4,this.getObjectEntry(b)];case 1:return e=a.sent(),e.renderables.forEach(function(a){for(var b=a.components.meta.length,c=0;c<b;c++){var e=d(c),g=a.components.meta[c],k=g.index;g.material.opacity=e;a.components.buffer.textureBuffer.setDataElement(k,1,3,255*e)}f.updateTransparency(a)}),this.callbacks.setNeedsRender(),
[2]}})})};b.prototype.updateAllComponentMaterials=function(b,c,d,e){return a.__awaiter(this,void 0,void 0,function(){var f,g,k,h,l,m=this;return a.__generator(this,function(a){switch(a.label){case 0:return f=b instanceof y,g=!!d.slicePlaneEnabled,k=I.determineRendererType(c),h=F.EdgeRenderer.getKey(k,g,f),[4,this.getObjectEntry(b)];case 1:return l=a.sent(),l.renderables.forEach(function(a){if(h!==a.rendererKey){var b=m.renderers.get(a.rendererKey),d=m.acquireRenderer(k,g,f);b.removeRenderable(a);
b.refCount.decrement();a.rendererKey=h;d.addRenderable(a)}for(b=0;b<c.length;b++)a.components.meta[b].material=c[b];e&&m.updateComponentBuffer(a.components);m.updateTransparency(a)}),this.callbacks.setNeedsRender(),[2]}})})};b.prototype.updateObjectVisibility=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var d;return a.__generator(this,function(a){switch(a.label){case 0:return[4,this.getObjectEntry(b)];case 1:return d=a.sent(),d.renderables.forEach(function(a){return a.visible=c}),
this.callbacks.setNeedsRender(),[2]}})})};b.prototype.removeObject=function(a){var b=this,c=this.perObjectData.get(a);c&&(this.perObjectData.delete(a),c.loaded.then(function(){c.renderables.forEach(function(a){return b.removeRenderable(a)});b.callbacks.setNeedsRender()}))};b.prototype.getObjectEntry=function(b){return a.__awaiter(this,void 0,void 0,function(){var c;return a.__generator(this,function(a){switch(a.label){case 0:c=this.perObjectData.get(b);if(!c)throw"no object";return[4,c.loaded];case 1:return a.sent(),
[2,c]}})})};b.prototype.removeAll=function(){var a=this;this.perObjectData.forEach(function(b,c){a.removeObject(c)})};b.prototype.render=function(a,b){var e=this;this.localOrigins.updateViewMatrices(a.view);var f=a.viewInvTransp,g=r.vec3f64.create(),k=new v.TwoVectorPosition,h=new u.VertexPosition.ViewProjectionTransform,m=d.mat3f64.create();p.vec3.set(g,f[3],f[7],f[11]);k.set(g);p.vec3.copy(h.worldFromView_TH,k.high);p.vec3.copy(h.worldFromView_TL,k.low);l.mat3.fromMat4(h.viewFromCameraRelative_RS,
a.view);c.mat4.copy(h.projFromView,a.proj);f=d.mat3f64.create();l.mat3.transpose(f,h.viewFromCameraRelative_RS);l.mat3.invert(m,f);this.renderers.forEach(function(a){0===a.refCount.value&&(e.renderers.delete(a.key),a.dispose())});this.componentColorManager.garbageCollect();this.componentColorManager.updateTextures();var q=0,n=0;this.renderers.forEach(function(a){return a.forEachRenderable(function(a){q+=a.statistics.averageEdgeLength;n++},b)});if(0!==n){var f=a.view,g=40*q/n,k=I.estimateLengthAtDistance(a.viewport[3],
a.fovY,1,3.5*a.pixelRatio),t={distanceFalloffFactor:g,minimumEdgeLength:k,transparency:b,viewProjectionTransform:h,transformNormal_ViewFromGlobal:m};this.updateObjectCameraDistances(a);this.numberOfRenderedEdges=0;this.renderers.forEach(function(b){e.renderRegularEdges(b,a,t);e.renderSilhouetteEdges(b,a,t)});a.view=f}};b.prototype.updateTransparency=function(a){var b=I.determineEdgeTransparency(a.components.meta),c=I.determineObjectTransparency(a.components.meta);if(b!==a.edgeTransparency||c!==a.objectTransparency)a.edgeTransparency=
b,a.objectTransparency=c,this.renderers.get(a.rendererKey).setRenderablesDirty()};b.prototype.computeModelTransformWithLocalOrigin=function(a,b,c){a.getCombinedStaticTransformation(b,c);b.origin?this.localOrigins.register(b.origin):(a=p.vec3.set(this.tmpModelPosition,c[12],c[13],c[14]),b.origin=this.localOrigins.acquire(a));w.applyToModelMatrix(b.origin.vec3,c);return c};b.prototype.updateComponentBuffer=function(a){var b=a.meta;a=a.buffer;for(var c=0;c<b.length;c++){var d=b[c].material,e=b[c].index,
f=h.clamp(Math.round(d.size*F.LINE_WIDTH_FRACTION_FACTOR),0,255),g=h.clamp(d.extensionLength,-F.EXTENSION_LENGTH_OFFSET,255-F.EXTENSION_LENGTH_OFFSET)+F.EXTENSION_LENGTH_OFFSET,k="solid"===d.type?0:1,l=255*d.opacity,d=d.color;a.textureBuffer.setData(e,0,255*d[0],255*d[1],255*d[2],255*d[3]);a.textureBuffer.setData(e,1,f,g,k,l)}};b.prototype.createComponentBuffers=function(a){for(var b=[],c=this.componentColorManager.getBuffer(a.length),d=0;d<a.length;d++){var e=a[d],f=c.acquireIndex();b.push({index:f,
material:e})}a={meta:b,buffer:c};this.updateComponentBuffer(a);return a};b.prototype.extractEdges=function(a,b,c,d,e){return this.worker.process({data:b,originalIndices:e,writerSettings:a,skipDeduplicate:c},d?null:this.workerThread)};b.prototype.createEdgeResources=function(a){var b={};if(0<a.regular.lodInfo.lengths.length){var c=new E(this.rctx,A.EdgeShaderAttributeLocations,{vertices:A.glVertexLayout,instances:B.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:J.createVertex(this.rctx,
35044,a.regular.instancesData.buffer)});b.regular={vao:c,lod:a.regular.lodInfo}}0<a.silhouette.lodInfo.lengths.length&&(c=new E(this.rctx,A.EdgeShaderAttributeLocations,{vertices:A.glVertexLayout,instances:B.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:J.createVertex(this.rctx,35044,a.silhouette.instancesData.buffer)}),b.silhouette={vao:c,lod:a.silhouette.lodInfo});return b};b.prototype.addGeometryData=function(b,c,d,e,f,g,h){return a.__awaiter(this,void 0,void 0,
function(){var l,m,p,q;return a.__generator(this,function(a){l=d.getAttribute("position");m=this.computeModelTransformWithLocalOrigin(b,e,k.mat4f64.create());p=e.origin;q={position:l,indices:d.getIndices("position"),modelTransform:m,origin:p};return[2,this.addPositionData(c,q,f,g,h)]})})};b.prototype.addPositionData=function(b,c,d,e,f){void 0===f&&(f=!1);return a.__awaiter(this,void 0,void 0,function(){var g,k,h,l,m,p,q,r,n,t,u,v,w,y,z;return a.__generator(this,function(a){switch(a.label){case 0:g=
this.acquireRenderer(d.type,e.slicePlaneEnabled||!1);k=c.modelTransform;h=c.origin;l=c.indices;m=c.position;p=m.data.length/m.strideIdx;q=A.EdgeInputBufferLayout.createBuffer(p);for(r=0;r<p;r++)q.position.set(r,0,m.data[m.offsetIdx+r*m.strideIdx+0]),q.position.set(r,1,m.data[m.offsetIdx+r*m.strideIdx+1]),q.position.set(r,2,m.data[m.offsetIdx+r*m.strideIdx+2]);n=this.createComponentBuffers([d]);I.fillComponenBufferIndices(n.meta,[0,q.componentIndex.count],q.componentIndex);return[4,this.extractEdges(g.writerSettings,
q,!1,f,l)];case 1:return t=a.sent(),u=this.createEdgeResources(t),v=u.regular,w=u.silhouette,y=(v?v.vao.size:0)+(w?w.vao.size:0),z={regular:v,silhouette:w,transform:{modelMatrix:k,origin:h},statistics:{gpuMemoryUsage:y,averageEdgeLength:t.averageEdgeLength},components:n,visible:!0,edgeTransparency:I.determineEdgeTransparency(n.meta),objectTransparency:I.determineObjectTransparency(n.meta),distanceToCamera:0,rendererKey:g.key},b.renderables.push(z),g.addRenderable(z),this.gpuMemoryUsage+=y,[2]}})})};
b.prototype.addComponentGeometry=function(b,c,d,e,f,g,k){return a.__awaiter(this,void 0,void 0,function(){var h,l,m,p,q,r,n,u,v,w,y;return a.__generator(this,function(a){switch(a.label){case 0:return h=I.determineRendererType(g),l=this.acquireRenderer(h,k.slicePlaneEnabled||!1,!1),m=A.EdgeInputBufferLayout.createBuffer(d.count),t.vec3.copy(m.position,d),p=this.createComponentBuffers(g),I.fillComponenBufferIndices(p.meta,f,m.componentIndex,e),q=l.writerSettings,[4,this.extractEdges(q,m,!0,!1,e)];case 1:return r=
a.sent(),n=this.createEdgeResources(r),u=n.regular,v=n.silhouette,w=(u?u.vao.size:0)+(v?v.vao.size:0),y={regular:u,silhouette:v,transform:b,statistics:{gpuMemoryUsage:w,averageEdgeLength:r.averageEdgeLength},components:p,visible:!0,edgeTransparency:I.determineEdgeTransparency(p.meta),objectTransparency:I.determineObjectTransparency(p.meta),distanceToCamera:0,rendererKey:l.key},c.renderables.push(y),l.addRenderable(y),this.gpuMemoryUsage+=w,[2]}})})};b.prototype.addObjectMergedGeometries=function(b,
c,d,e){return a.__awaiter(this,void 0,void 0,function(){var g,h,l,m,p,q,r,n,t,u,v,w,y,z,A,B,C,E,G,F,I;return a.__generator(this,function(a){switch(a.label){case 0:g=new Map;h=0;m=l=null;for(p=0;p<b.geometries.length;p++)if(q=b.geometries[p],r=b.geometryRecords[p],n=r.material,n.supportsEdges&&(!m&&r.origin&&(m=r),t=q.data.getIndices("position"),h+=t?t.length:0,t&&null==l||l===Uint16Array))l=f.isUint16Array(t)?Uint16Array:Uint32Array;u=h?new l(h):null;v=[];for(p=w=0;p<b.geometries.length;p++)if(q=
b.geometries[p],y=b.geometryRecords[p],n=y.material,n.supportsEdges){z=q.data.getAttribute("position");t=q.data.getIndices("position");A=g.get(z.data);if(null==A){A=v.length/3;for(B=z.offsetIdx;B<z.data.length;B+=z.strideIdx)v.push(z.data[B+0]),v.push(z.data[B+1]),v.push(z.data[B+2]);g.set(z.data,A)}if(t)for(C=0;C<t.length;C++)u[w++]=A+t[C]}E=m||b.geometryRecords[0];G=this.computeModelTransformWithLocalOrigin(b,E,k.mat4f64.create());F=E.origin;for(p=0;p<b.geometryRecords.length;p++)b.geometryRecords[p].origin=
F;I={position:{data:v,offsetIdx:0,strideIdx:3},indices:u,modelTransform:G,origin:F};return[4,this.addPositionData(c,I,d[0],e)];case 1:return a.sent(),[2]}})})};b.prototype.acquireRenderer=function(a,b,c){void 0===c&&(c=!0);var d=F.EdgeRenderer.getKey(a,b,c),e=this.renderers.get(d);this.strokesTexture||(this.strokesTexture=H.generateStrokesTexture(this.rctx));e||(e=new F.EdgeRenderer(this.rctx,this.techniqueRepository,{type:a,slicePlaneEnabled:b,strokesTexture:this.strokesTexture,legacy:c}),this.renderers.set(d,
e));e.refCount.increment();return e};b.prototype.removeRenderable=function(a){var b=this.renderers.get(a.rendererKey);if(b){b.removeRenderable(a);b.refCount.decrement();a.regular&&(a.regular.vao.vertexBuffers.instances.dispose(),a.regular.vao.dispose(!1),a.regular.vao=null);a.silhouette&&(a.silhouette.vao.vertexBuffers.instances.dispose(),a.silhouette.vao.dispose(!1),a.silhouette.vao=null);"origin"in a.transform&&this.localOrigins.release(a.transform.origin);this.gpuMemoryUsage-=a.statistics.gpuMemoryUsage;
for(var b=0,c=a.components.meta;b<c.length;b++)a.components.buffer.releaseIndex(c[b].index)}};b.prototype.updateObjectCameraDistances=function(a){var b=this;a=a.viewInvTransp;p.vec3.set(this.tmpCameraPosition,a[3],a[7],a[11]);this.perObjectData.forEach(function(a,c){c="getCenter"in c?c.getCenter():a.center;var d=p.vec3.distance(c,b.tmpCameraPosition);a.renderables.forEach(function(a){return a.distanceToCamera=d})})};b.prototype.renderRegularEdges=function(a,b,c){var d=this;a.bindRegularEdges(b,c);
a.forEachRenderable(function(e){if(e.visible&&e.regular){var f=I.computeEdgeCount(e.regular.lod.lengths,e.distanceToCamera,c);"origin"in e.transform&&(b.view=d.localOrigins.getViewMatrix(e.transform.origin));a.renderRegularEdges(e,b,f);d.numberOfRenderedEdges+=f}},c.transparency)};b.prototype.renderSilhouetteEdges=function(a,b,c){var d=this;a.bindSilhouetteEdges(b,c);a.forEachRenderable(function(e){if(e.visible&&e.silhouette){var f=I.computeEdgeCount(e.silhouette.lod.lengths,e.distanceToCamera,c);
"origin"in e.transform&&(b.view=d.localOrigins.getViewMatrix(e.transform.origin));a.renderSilhouetteEdges(e,b,f);d.numberOfRenderedEdges+=f}},c.transparency)};return b}();b.EdgeView=n})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.applyToModelMatrix=function(a,b){var h=-a[0],e=-a[1];a=-a[2];var f=b[3],g=b[7],l=b[11],d=b[15];b[0]+=f*h;b[1]+=f*e;b[2]+=f*a;b[4]+=g*h;b[5]+=g*e;b[6]+=g*a;b[8]+=
l*h;b[9]+=l*e;b[10]+=l*a;b[12]+=d*h;b[13]+=d*e;b[14]+=d*a};b.applyToViewMatrix=function(a,b){var h=a[0],e=a[1];a=a[2];b[12]+=h*b[0]+e*b[4]+a*b[8];b[13]+=h*b[1]+e*b[5]+a*b[9];b[14]+=h*b[2]+e*b[6]+a*b[10];b[14]+=h*b[3]+e*b[7]+a*b[11]}})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/mat4","../../../../core/libs/gl-matrix-2/mat4f64","./localOriginHelper"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});
n=function(){function b(a){this.factory=a;this.originData=new Map}b.prototype.acquire=function(a){return this.register(this.factory.getOrigin(a))};b.prototype.register=function(a){var b=this.originData.get(a.id);if(b)return b.refCount++,b.origin;this.originData.set(a.id,{refCount:1,viewMatrix:m.mat4f64.create(),origin:a});return a};b.prototype.release=function(a){var b=this.originData.get(a.id);b&&(b.refCount--,0===b.refCount&&this.originData.delete(a.id))};b.prototype.updateViewMatrices=function(b){this.originData.forEach(function(e){a.mat4.copy(e.viewMatrix,
b);h.applyToViewMatrix(e.origin.vec3,e.viewMatrix)})};b.prototype.getViewMatrix=function(a){return this.originData.get(a.id).viewMatrix};return b}();b.LocalOriginManager=n})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["require","exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.EdgeInputBufferLayout=m.newLayout().vec3f("position").u16("componentIndex").u16("_padding");
b.VertexLayout=m.newLayout().vec2u8("sideness");b.glVertexLayout=a.glLayout(b.VertexLayout);b.CommonInstancesLayout=m.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("_padding",{glPadding:!0}).u16("_padding2",{glPadding:!0});b.RegularEdgeInstancesLayout=b.CommonInstancesLayout.clone().vec3f("normal");b.SilhouetteEdgeInstancesLayout=b.CommonInstancesLayout.clone().vec3f("normalA").vec3f("normalB");
b.EdgeShaderAttributeLocations={position0:0,position1:1,componentIndex:2,variantOffset:4,variantStroke:5,variantExtension:6,normal:7,normalA:7,normalB:8,sideness:9}})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("require exports ../../../../../core/RandomLCG ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",
{value:!0});var g=function(){function a(){}a.prototype.updateSettings=function(a){this.settings=a};a.prototype.write=function(a,b,e){var f=l;f[0]=e.position0[0];f[1]=e.position0[1];f[2]=e.position0[2];f[3]=e.position1[0];f[4]=e.position1[1];f[5]=e.position1[2];c[0]=5381;for(f=0;f<d.length;f++)c[0]=31*c[0]+d[f];k.seed=c[0];var f=k.getIntRange(0,255),g=k.getIntRange(0,this.settings.variants-1),h=k.getFloat(),h=-(1-Math.min(h/.7,1))+Math.max(0,h-.7)/(1-.7),h=255*(Math.pow(Math.abs(h),1.2)*(0>h?-1:1)*
.5+.5);a.position0.setVec(b,e.position0);a.position1.setVec(b,e.position1);a.componentIndex.set(b,e.componentIndex);a.variantOffset.set(b,f);a.variantStroke.set(b,g);a.variantExtension.set(b,h)};a.prototype.trim=function(a,b){return a.slice(0,b)};return a}();b.CommonBufferWriter=g;var l=new Float32Array(6),d=new Uint32Array(l.buffer),c=new Uint32Array(1),k=new a;n=function(){function a(){this.commonWriter=new g}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};a.prototype.allocate=
function(a){return f.RegularEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,b,c){this.commonWriter.write(a,b,c);m.vec3.add(p,c.faceNormal0,c.faceNormal1);m.vec3.normalize(p,p);a.normal.setVec(b,p)};a.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};a.Layout=f.RegularEdgeInstancesLayout;a.glLayout=e.glLayout(f.RegularEdgeInstancesLayout,{divisor:1});return a}();b.RegularEdgeBufferWriter=n;n=function(){function a(){this.commonWriter=new g}a.prototype.updateSettings=
function(a){this.commonWriter.updateSettings(a)};a.prototype.allocate=function(a){return f.SilhouetteEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,b,c){this.commonWriter.write(a,b,c);a.normalA.setVec(b,c.faceNormal0);a.normalB.setVec(b,c.faceNormal1)};a.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};a.Layout=f.SilhouetteEdgeInstancesLayout;a.glLayout=e.glLayout(f.SilhouetteEdgeInstancesLayout,{divisor:1});return a}();b.SilhouetteEdgeBufferWriter=n;var p=h.vec3f64.create()})},
"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("require exports tslib ../../../../../core/typedArrayUtil ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/workerHelper ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),function(n,b,a,m,h,e,f,g,l,d){return function(){function b(){this.regularWriter=new l.RegularEdgeBufferWriter;this.silhouetteWriter=new l.SilhouetteEdgeBufferWriter}b.prototype.process=
function(b,c){return a.__awaiter(this,void 0,void 0,function(){var d,e,f;return a.__generator(this,function(a){switch(a.label){case 0:if(!c)return[3,2];d=[];e=this.packInput(b,d);return[4,c.invoke("wrappedWork",e,{transferList:d})];case 1:return f=a.sent(),[2,this.unpackOutput(f)];case 2:return[2,this.work(b)]}})})};b.prototype.wrappedWork=function(b){return a.__awaiter(this,void 0,void 0,function(){var c,d,e,f;return a.__generator(this,function(a){c=this.unpackInput(b);d=this.work(c);e=[];this.packInputTransferables(c,
e);f=this.packOutput(d,e);return[2,{result:f,transferList:e}]})})};b.prototype.work=function(a){var b=this.extractEdgeInformation(a.data,a.skipDeduplicate,a.originalIndices);this.regularWriter.updateSettings(a.writerSettings);this.silhouetteWriter.updateSettings(a.writerSettings);return d.extractEdges(b,this.regularWriter,this.silhouetteWriter)};b.prototype.packInputTransferables=function(a,b){b.push(a.data.buffer)};b.prototype.packInput=function(a,b){this.packInputTransferables(a,b);b={dataBuffer:a.data.buffer,
writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate};a.originalIndices&&(b.originalIndicesBuffer=a.originalIndices.buffer,b.originalIndicesType=m.isUint32Array(a.originalIndices)?"Uint32Array":"Uint16Array");return b};b.prototype.unpackInput=function(a){return{data:g.EdgeInputBufferLayout.createView(a.dataBuffer),originalIndices:"Uint32Array"===a.originalIndicesType?new Uint32Array(a.originalIndicesBuffer):"Uint16Array"===a.originalIndicesType?new Uint16Array(a.originalIndicesBuffer):
void 0,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate}};b.prototype.packOutput=function(a,b){b.push(a.regular.lodInfo.lengths.buffer);b.push(a.silhouette.lodInfo.lengths.buffer);return{regular:{instancesData:f.packInterleavedBuffer(a.regular.instancesData,b),lodInfo:{lengths:a.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:f.packInterleavedBuffer(a.silhouette.instancesData,b),lodInfo:{lengths:a.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:a.averageEdgeLength}};
b.prototype.unpackOutput=function(a){return{regular:{instancesData:f.unpackInterleavedBuffer(a.regular.instancesData),lodInfo:{lengths:new Float32Array(a.regular.lodInfo.lengths)}},silhouette:{instancesData:f.unpackInterleavedBuffer(a.silhouette.instancesData),lodInfo:{lengths:new Float32Array(a.silhouette.lodInfo.lengths)}},averageEdgeLength:a.averageEdgeLength}};b.prototype.extractEdgeInformation=function(a,b,c){if(b&&c)return b=e.computeNeighbors(c,a.count),{faces:c,neighbors:b,vertices:a};a=h.default(a.buffer,
a.stride/4,{originalIndices:c});b=e.computeNeighbors(a.indices,a.uniqueCount);return{faces:a.indices,neighbors:b,vertices:g.EdgeInputBufferLayout.createView(a.buffer)}};return b}()})},"esri/views/3d/support/meshProcessing":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.computeNeighbors=function(a,b){for(var h=a.length/3,e=new Uint32Array(b+1),f=new Uint32Array(b+1),g=function(a,b){a<b?e[a+1]++:f[b+1]++},l=0;l<h;l++){var d=a[3*l],c=a[3*l+1],
k=a[3*l+2];g(d,c);g(c,k);g(k,d)}for(l=c=d=0;l<b;l++)k=e[l+1],g=f[l+1],e[l+1]=d,f[l+1]=c,d+=k,c+=g;for(var m=new Uint32Array(6*h),r=e[b],g=function(a,b,c){if(a<b){var d=e[a+1]++;m[2*d]=b;m[2*d+1]=c}else d=f[b+1]++,m[2*r+2*d]=a,m[2*r+2*d+1]=c},l=0;l<h;l++)d=a[3*l],c=a[3*l+1],k=a[3*l+2],g(d,c,l),g(c,k,l),g(k,d,l);d=function(a,b){var c=2*a;a=b-a;for(b=1;b<a;b++){var d=m[c+2*b],e=m[c+2*b+1],f=b-1;for(f;0<=f&&m[c+2*f]>d;f--)m[c+2*f+2]=m[c+2*f],m[c+2*f+3]=m[c+2*f+1];m[c+2*f+2]=d;m[c+2*f+3]=e}};for(l=0;l<
b;l++)d(e[l],e[l+1]),d(r+f[l],r+f[l+1]);for(var n=new Int32Array(3*h),u=function(b,c){return b===a[3*c]?0:b===a[3*c+1]?1:b===a[3*c+2]?2:-1},h=function(a,b){a=u(a,b);n[3*b+a]=-1},d=function(a,b,c,d){a=u(a,b);n[3*b+a]=d;c=u(c,d);n[3*d+c]=b},l=0;l<b;l++){for(var c=e[l],k=e[l+1],g=f[l],v=f[l+1];c<k&&g<v;){var z=m[2*c],w=m[2*r+2*g];z===w?(d(l,m[2*c+1],w,m[2*r+2*g+1]),c++,g++):z<w?(h(l,m[2*c+1]),c++):(h(w,m[2*r+2*g+1]),g++)}for(;c<k;)h(l,m[2*c+1]),c++;for(;g<v;)w=m[2*r+2*g],h(w,m[2*r+2*g+1]),g++}return n}})},
"esri/views/3d/support/buffer/workerHelper":function(){define(["require","exports","tslib","./BufferView","./InterleavedLayout"],function(n,b,a,m,h){function e(b){var c=[];b.fields.forEach(function(b,d){b=a.__assign(a.__assign({},b),{constructor:g(b.constructor)});c.push([d,b])});return{stride:b.stride,fields:c,fieldNames:b.fieldNames}}function f(b){var c=h.newLayout();c.stride=b.stride;c.fieldNames=b.fieldNames;b.fields.forEach(function(b){return c.fields.set(b[0],a.__assign(a.__assign({},b[1]),
{constructor:l.get(b[1].constructor)}))});return c}function g(a){return a.ElementType+"_"+a.ElementCount}Object.defineProperty(b,"__esModule",{value:!0});b.packInterleavedBuffer=function(a,b){b.push(a.buffer);return{buffer:a.buffer,layout:e(a.layout)}};b.unpackInterleavedBuffer=function(a){return f(a.layout).createView(a.buffer)};b.packLayout=e;b.unpackLayout=f;n=[m.BufferViewFloat,m.BufferViewVec2f,m.BufferViewVec3f,m.BufferViewVec4f,m.BufferViewMat3f,m.BufferViewMat4f,m.BufferViewFloat64,m.BufferViewVec2f64,
m.BufferViewVec3f64,m.BufferViewVec4f64,m.BufferViewMat3f64,m.BufferViewMat4f64,m.BufferViewUint8,m.BufferViewVec2u8,m.BufferViewVec3u8,m.BufferViewVec4u8,m.BufferViewUint16,m.BufferViewVec2u16,m.BufferViewVec3u16,m.BufferViewVec4u16,m.BufferViewUint32,m.BufferViewVec2u32,m.BufferViewVec3u32,m.BufferViewVec4u32,m.BufferViewInt8,m.BufferViewVec2i8,m.BufferViewVec3i8,m.BufferViewVec4i8,m.BufferViewInt16,m.BufferViewVec2i16,m.BufferViewVec3i16,m.BufferViewVec4i16,m.BufferViewInt32,m.BufferViewVec2i32,
m.BufferViewVec3i32,m.BufferViewVec4i32];var l=new Map;n.forEach(function(a){return l.set(g(a),a)})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("require exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/typedArrayUtil ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils".split(" "),function(n,b,a,m,h,e,f,g){function l(a,b){var c=m.acosClamped(a.cosAngle),d=
k.fwd,f=k.ortho;g.directionFromTo(d,a.position1,a.position0);a=0<e.vec3.dot(e.vec3.cross(f,a.faceNormal0,a.faceNormal1),d)?-1:1;return c*a>b}function d(a){var b=a.faces.length/3,c=a.faces;a=a.neighbors;for(var d=0,e=0;e<b;e++)var f=a[3*e+0],g=a[3*e+1],h=a[3*e+2],k=c[3*e+0],l=c[3*e+1],m=c[3*e+2],d=d+(-1===f||k<l?1:0),d=d+(-1===g||l<m?1:0),d=d+(-1===h||m<k?1:0);for(var d=new Int32Array(4*d),p=0,e=0;e<b;e++){f=a[3*e+0];g=a[3*e+1];h=a[3*e+2];k=c[3*e+0];l=c[3*e+1];m=c[3*e+2];if(-1===f||k<l)d[p++]=k,d[p++]=
l,d[p++]=e,d[p++]=f;if(-1===g||l<m)d[p++]=l,d[p++]=m,d[p++]=e,d[p++]=g;if(-1===h||m<k)d[p++]=m,d[p++]=k,d[p++]=e,d[p++]=h}return d}function c(a){var b=a.faces.length/3,c=a.vertices.position;a=a.faces;for(var d=p.v0,f=p.v1,g=p.v2,h=new Float32Array(3*b),k=0;k<b;k++){var l=a[3*k+1],m=a[3*k+2];c.getVec(a[3*k+0],d);c.getVec(l,f);c.getVec(m,g);e.vec3.subtract(f,f,d);e.vec3.subtract(g,g,d);e.vec3.cross(d,f,g);e.vec3.normalize(d,d);h[3*k+0]=d[0];h[3*k+1]=d[1];h[3*k+2]=d[2]}return h}Object.defineProperty(b,
"__esModule",{value:!0});b.extractEdges=function(b,f,g,p){void 0===p&&(p=r);var n=b.vertices.position,q=b.vertices.componentIndex,t=m.deg2rad(p.anglePlanar);p=m.deg2rad(p.angleSignificantEdge);var u=Math.cos(p),v=Math.cos(t),z=k.edge,F=z.position0,H=z.position1,I=z.faceNormal0,G=z.faceNormal1,J=c(b),E=d(b),L=E.length/4;b=f.allocate(L);p=0;var M=g.allocate(L),N=0,Q=0,R=0,W=a.range(0,L),O=new Float32Array(L);h.forEach(O,function(a,b,c){n.getVec(E[4*b+0],F);n.getVec(E[4*b+1],H);c[b]=e.vec3.distance(F,
H)});W.sort(function(a,b){return O[b]-O[a]});for(var U=[],P=[],ba=0;ba<L;ba++){var V=W[ba],T=O[V],X=E[4*V+0],Y=E[4*V+1],da=E[4*V+2],V=E[4*V+3],fa=-1===V;n.getVec(X,F);n.getVec(Y,H);if(fa)e.vec3.set(I,J[3*da+0],J[3*da+1],J[3*da+2]),e.vec3.copy(G,I),z.componentIndex=q.get(X),z.cosAngle=e.vec3.dot(I,G);else{e.vec3.set(I,J[3*da+0],J[3*da+1],J[3*da+2]);e.vec3.set(G,J[3*V+0],J[3*V+1],J[3*V+2]);z.componentIndex=q.get(X);z.cosAngle=e.vec3.dot(I,G);if(z.cosAngle>v)continue;-.9999>z.cosAngle&&e.vec3.copy(G,
I)}Q+=T;R++;fa||z.cosAngle<u?(f.write(b,p++,z),U.push(T)):l(z,t)&&(g.write(M,N++,z),P.push(T))}q=new Float32Array(U.reverse());t=new Float32Array(P.reverse());return{regular:{instancesData:f.trim(b,p),lodInfo:{lengths:q}},silhouette:{instancesData:g.trim(M,N),lodInfo:{lengths:t}},averageEdgeLength:Q/R}};var k={edge:{position0:f.vec3f64.create(),position1:f.vec3f64.create(),faceNormal0:f.vec3f64.create(),faceNormal1:f.vec3f64.create(),componentIndex:0,cosAngle:0},ortho:f.vec3f64.create(),fwd:f.vec3f64.create()},
p={v0:f.vec3f64.create(),v1:f.vec3f64.create(),v2:f.vec3f64.create()},r={anglePlanar:4,angleSignificantEdge:35}})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("require exports tslib ../../../../../core/mathUtils ../../../../../core/PooledArray ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../collections/Component/Material/ComponentTechnique ../../core/shaderLibrary/Slice.glsl ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/shaderLibrary/util/DoublePrecision.glsl ../../core/util/TwoVectorPosition ./EdgeShaderTechnique".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t){Object.defineProperty(b,"__esModule",{value:!0});b.LINE_WIDTH_FRACTION_FACTOR=8;b.EXTENSION_LENGTH_OFFSET=128;var u={type:"uber",slicePlaneEnabled:!1,sliceHighlightDisabled:!1,strokesTexture:null,legacy:!0},v=function(){function a(){this._value=0}Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0});a.prototype.increment=function(){this._value++};a.prototype.decrement=function(){this._value--};return a}(),
z={solid:0,sketch:1,uber:2};n=function(){function f(b,c,d){var e,g,k;this.rctx=b;this.shaderTechniqueRepository=c;this.config=new t.EdgeShaderTechnique.Configuration;this.technique=null;this.refCount=new v;this.renderables=new Set;this.sortedRenderables=(e={},e[1]=(g={},g[1]=new h,g[2]=new h,g),e[2]=(k={},k[1]=new h,k[2]=new h,k),e);this.renderablesDirty=!1;this.settings=a.__assign(a.__assign({},u),d);this.key=f.getKey(this.settings.type,this.settings.slicePlaneEnabled,this.settings.legacy);this.writerSettings=
{variants:this.settings.strokesTexture.variants};this.config.legacy=this.settings.legacy;this.config.mode=z[this.settings.type];this.config.silhouette=!1;this.config.antialiasing=!!this.rctx.capabilities.blendMinMax;this.config.slicePlaneEnabled=this.settings.slicePlaneEnabled;this.config.doublePrecisionRequiresObfuscation=p.doublePrecisionRequiresObfuscation(b)}f.prototype.dispose=function(){this.technique&&(this.shaderTechniqueRepository.release(this.technique),this.technique=null)};f.prototype.addRenderable=
function(a){this.renderables.add(a);this.renderablesDirty=!0};f.prototype.removeRenderable=function(a){this.renderables.delete(a);this.renderablesDirty=!0};f.prototype.setRenderablesDirty=function(){this.renderablesDirty=!0};f.prototype.forEachRenderable=function(a,b){this.renderablesDirty&&this.sortRenderables();this.sortedRenderables[b][1].forEach(a);this.sortedRenderables[b][2].forEach(a)};f.prototype.bindRegularEdges=function(a,b){this.config.silhouette=!1;this.technique=this.shaderTechniqueRepository.acquireAndReleaseExisting(t.EdgeShaderTechnique,
this.config,this.technique);this.technique.bindPass(this.rctx,{renderParameters:a,edgeRenderParameters:b});this.rctx.setPipelineState(this.technique.pipeline);this.rctx.bindProgram(this.technique.program)};f.prototype.bindSilhouetteEdges=function(a,b){this.config.silhouette=!0;this.technique=this.shaderTechniqueRepository.acquireAndReleaseExisting(t.EdgeShaderTechnique,this.config,this.technique);this.technique.bindPass(this.rctx,{renderParameters:a,edgeRenderParameters:b});this.rctx.setPipelineState(this.technique.pipeline);
this.rctx.bindProgram(this.technique.program)};f.prototype.renderRegularEdges=function(a,b,c){this.render(this.technique.program,a,a.regular.vao,b,c)};f.prototype.renderSilhouetteEdges=function(a,b,c){this.render(this.technique.program,a,a.silhouette.vao,b,c)};f.prototype.render=function(a,b,c,d,e){this.setUniforms(a,b,d);this.rctx.bindVAO(c);this.rctx.capabilities.instancing.drawArraysInstanced(6,0,4,e)};f.prototype.setUniforms=function(a,f,h){f.components.buffer.textureBuffer.bind(a,b.componentDataBindParameters);
if("origin"in f.transform)a.setUniformMatrix4fv("uView",h.view),a.setUniformMatrix4fv("uModel",f.transform.modelMatrix),c.Slice.bindUniforms(a,this.settings,h.slicePlane,f.transform.origin.vec3);else{var l=new r.TwoVectorPosition(f.transform.position),m=e.mat3.transpose(w,e.mat3.invert(w,f.transform.rotationScale)),p=new d.ComponentDrawParameters;g.vec3.copy(p.worldFromModel_TL,l.low);g.vec3.copy(p.worldFromModel_TH,l.high);e.mat3.copy(p.worldFromModel_RS,f.transform.rotationScale);e.mat3.copy(p.transformNormal_GlobalFromModel,
m);k.VertexPosition.bindModelTransform(a,p);a.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",p.transformNormal_GlobalFromModel);f=h.viewInvTransp;f=g.vec3.set(q,f[3],f[7],f[11]);c.Slice.bindUniforms(a,this.settings,h.slicePlane,f)}"uber"!==this.settings.type&&"sketch"!==this.settings.type||this.setSketchUniforms(a);a.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(h.fovY/2)/(h.viewport[3]/2))};f.prototype.setSketchUniforms=function(a){var b=this.settings.strokesTexture,c=b.texture;this.rctx.bindTexture(c,
0);a.setUniform1i("uStrokesTexture",0);a.setUniform2f("uStrokesTextureScale",1/c.descriptor.width,1/c.descriptor.height);a.setUniform1f("uStrokesLog2Resolution",m.log2(b.resolution));a.setUniform1f("uStrokesNormalizationScale",b.normalizationScale);a.setUniform1f("uStrokesAmplitude",b.amplitude);a.setUniform1f("uStrokeVariants",b.variants)};f.prototype.sortRenderables=function(){var a=this;this.renderablesDirty=!1;this.sortedRenderables[1][1].clear();this.sortedRenderables[1][2].clear();this.sortedRenderables[2][1].clear();
this.sortedRenderables[2][2].clear();this.renderables.forEach(function(b){0!==b.objectTransparency&&0!==b.edgeTransparency&&a.sortedRenderables[b.objectTransparency][b.edgeTransparency].push(b)});var b=function(a,b){return"origin"in a.transform&&"origin"in b.transform?a.transform.origin.id<b.transform.origin.id?-1:a.transform.origin.id>b.transform.origin.id?1:0:0};this.sortedRenderables[1][1].sort(b);this.sortedRenderables[1][2].sort(b);this.sortedRenderables[2][1].sort(b);this.sortedRenderables[2][2].sort(b)};
f.getKey=function(a,b,c){return"edges-t:"+a+":"+b+":"+c};return f}();b.EdgeRenderer=n;b.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2};var w=f.mat3f32.create(),q=l.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":function(){define("require exports tslib ../../../../webgl ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../core/shaderTechnique/ShaderTechniqueConfiguration ../../shaders/sources/edgeRenderer/EdgeShaderProgram.glsl ../../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",{value:!0});f=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}a.__extends(c,b);c.prototype.bindPass=function(a,b){a=this.program;var c=b.edgeRenderParameters;b=b.renderParameters;h.VertexPosition.bindViewProjTransform(a,c.viewProjectionTransform);a.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",c.transformNormal_ViewFromGlobal);a.setUniformMatrix4fv("uProj",b.proj);a.setUniform2f("uDepthBias",.5,-4E-4);
a.setUniform2f("uPixelToNDC",2/b.viewport[2],2/b.viewport[3]);a.setUniform2f("uNDCToPixel",b.viewport[2]/2,b.viewport[3]/2);a.setUniform1f("uDistanceFalloffFactor",c.distanceFalloffFactor);a.setUniform2f("uViewportDimInv",1/b.viewport[2],1/b.viewport[3]);a.setUniform1f("uPixelRatio",b.pixelRatio||1)};c.prototype.initializeProgram=function(a){var b=c.shader.get(),d=this.configuration,d=b.build({slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:d.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,
silhouette:d.silhouette,legacy:d.legacy,antialiasing:d.antialiasing,mode:d.mode,doublePrecisionRequiresObfuscation:d.doublePrecisionRequiresObfuscation});return new m.Program(a.rctx,d.generateSource("vertex"),d.generateSource("fragment"),b.attributeLocations)};c.prototype.initializePipeline=function(a){return(a=a.rctx.capabilities.blendMinMax)?d.makePipelineState({blending:d.separateBlendingParams(1,1,0,1,32774,a.MAX),depthTest:{func:515},colorWrite:d.defaultColorWriteParams}):d.makePipelineState({depthTest:{func:515},
depthWrite:d.defaultDepthWriteParams,colorWrite:d.defaultColorWriteParams})};c.shader=new e.ReloadableShaderModule(l,function(){return new Promise(function(a,b){n(["../../shaders/sources/edgeRenderer/EdgeShaderProgram.glsl"],a,b)})});return c}(f.ShaderTechnique);b.EdgeShaderTechnique=f;(function(b){var c=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.slicePlaneEnabled=!1;a.sliceHighlightDisabled=!1;a.silhouette=!1;a.legacy=!1;a.antialiasing=!1;a.mode=0;a.doublePrecisionRequiresObfuscation=
!1;return a}a.__extends(c,b);a.__decorate([g.parameter()],c.prototype,"slicePlaneEnabled",void 0);a.__decorate([g.parameter()],c.prototype,"sliceHighlightDisabled",void 0);a.__decorate([g.parameter()],c.prototype,"silhouette",void 0);a.__decorate([g.parameter()],c.prototype,"legacy",void 0);a.__decorate([g.parameter()],c.prototype,"antialiasing",void 0);a.__decorate([g.parameter({count:3})],c.prototype,"mode",void 0);a.__decorate([g.parameter()],c.prototype,"doublePrecisionRequiresObfuscation",void 0);
return c}(g.ShaderTechniqueConfiguration);b.Configuration=c})(f=b.EdgeShaderTechnique||(b.EdgeShaderTechnique={}));b.EdgeShaderTechnique=f})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeShaderProgram.glsl":function(){define("require exports tslib ../../../core/shaderLibrary/Slice.glsl ../../../core/shaderModules/interfaces ../../../core/shaderModules/ShaderBuilder ./AdjustProjectedPosition.glsl ./DiscardByCoverage.glsl ./DiscardNonSilhouetteEdges.glsl ./DiscardShortEdges.glsl ./EdgeUtil.glsl ./LineAmplitude.glsl ./LineOffset.glsl ./UnpackAttributes.glsl".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r){Object.defineProperty(b,"__esModule",{value:!0});b.attributeLocations={position0:0,position1:1,componentIndex:2,packedAttributes:3,variantOffset:4,variantStroke:5,variantExtension:6,normal:7,normalA:7,normalB:8,sideness:9};b.build=function(b){var q=new e.ShaderBuilder,n=q.vertex,w=q.fragment;b.legacy&&n.uniforms.add("uModel","mat4");b.antialiasing&&(n.code.add(h.glsl(t||(t=a.__makeTemplateObject(["\n      #define ANTIALIASING 1\n    "],["\n      #define ANTIALIASING 1\n    "])))),
w.code.add(h.glsl(u||(u=a.__makeTemplateObject(["\n      #define ANTIALIASING 1\n    "],["\n      #define ANTIALIASING 1\n    "])))));q.include(f.AdjustProjectedPosition,b);q.include(k.LineAmplitude,b);q.include(c.EdgeUtil,b);q.include(r.UnpackAttributes,b);q.include(p.LineOffset,b);q.include(m.Slice,b);q.include(l.DiscardNonSilhouetteEdges,b);q.include(g.DiscardByCoverage,b);q.include(d.DiscardShortEdges,b);q.varyings.add("vColor","vec4");q.varyings.add("vRadius","float");q.varyings.add("vPosition",
"vec3");q.varyings.add("vWorldPosition","vec3");q.varyings.add("vLineLengthPixels","float");q.varyings.add("vSizeFalloffFactor","float");n.uniforms.add("uPixelToNDC","vec2");n.uniforms.add("uNDCToPixel","vec2");n.uniforms.add("uPixelRatio","float");q.attributes.add("position0","vec3");q.attributes.add("position1","vec3");q.attributes.add("variantOffset","float");q.attributes.add("variantStroke","float");q.attributes.add("variantExtension","float");n.code.add(h.glsl(v||(v=a.__makeTemplateObject(["\n    const float opaqueCutoff \x3d 1.0 / 255.0;\n\n    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n      vec2 sideness \x3d unpackedAttributes.sideness;\n      vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n\n      vWorldPosition \x3d mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;\n\n      vec3 viewPos \x3d mix(viewPosV0, viewPosV1, sidenessNorm.y);\n\n      vec4 projPosV0 \x3d projFromViewPosition(viewPosV0);\n      vec4 projPosV1 \x3d projFromViewPosition(viewPosV1);\n      vec4 projPos \x3d projFromViewPosition(viewPos);\n\n      vec3 screenSpaceLineNDC \x3d (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\n      vec2 screenSpaceLinePixels \x3d screenSpaceLineNDC.xy * uNDCToPixel;\n      float lineLengthPixels \x3d length(screenSpaceLinePixels);\n\n      float dzPerPixel \x3d screenSpaceLineNDC.z / lineLengthPixels;\n      vec2 screenSpaceDirection \x3d screenSpaceLinePixels / lineLengthPixels;\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\n\n      float falloffFactor \x3d distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;\n      float lineWidthPixels \x3d unpackedAttributes.lineWidthPixels * falloffFactor;\n\n      float extensionLengthPixels \x3d calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\n      float lineAmplitudePixels \x3d calculateLineAmplitude(unpackedAttributes) * uPixelRatio;\n\n      vSizeFalloffFactor \x3d falloffFactor;\n\n      float lineWidthAndAmplitudePixels \x3d lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\n      float extendedLineLengthPixels \x3d lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\n\n    #ifdef ANTIALIASING\n      const float aaPaddingPixels \x3d 1.0;\n\n      // Line size with padding\n      float halfAAPaddedLineWidthAndAmplitudePixels \x3d lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\n      float aaPaddedRoundedCapSizePixels \x3d lineWidthPixels * 0.5 + aaPaddingPixels;\n    #else /* ANTIALIASING */\n\n      // Even if there is no AA, we still want to do proper \x3c1px rendering,\n      // so we effectively clamp the pixel sizes to minimum of 1px and compute\n      // coverage in the fragment shader\n      float halfAAPaddedLineWidthAndAmplitudePixels \x3d max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\n      float aaPaddedRoundedCapSizePixels \x3d max(lineWidthPixels, 1.0) * 0.5;\n    #endif /* ANTIALIASING */\n\n      // Half line width in NDC including padding for anti aliasing\n      vec2 halfAAPaddedLineWidthAndAmplitudeNDC \x3d halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\n      vec2 aaPaddedRoundedCapSizeNDC \x3d aaPaddedRoundedCapSizePixels * uPixelToNDC;\n      vec2 extensionLengthNDC \x3d extensionLengthPixels * uPixelToNDC;\n\n      // Compute screen space position of vertex, offsetting for line size and end caps\n      vec2 ndcOffset \x3d (\n          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\n        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\n      );\n\n      projPos.xy +\x3d ndcOffset * projPos.w;\n      projPos.z +\x3d (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\n\n      projPos \x3d adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\n\n      // Line length with end caps\n      float aaPaddedLineWithCapsLengthPixels \x3d extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\n\n      float pixelPositionAlongLine \x3d aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\n\n      // Position in pixels with origin at first vertex of line segment\n      vPosition \x3d vec3(\n        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\n        pixelPositionAlongLine,\n        pixelPositionAlongLine / extendedLineLengthPixels\n      );\n\n      // The line width radius in pixels\n      vRadius \x3d lineWidthPixels * 0.5;\n      vLineLengthPixels \x3d extendedLineLengthPixels;\n\n      // discard edges below a certain length threshold\n      discardShortEdges(unpackedAttributes, lineLengthPixels);\n\n      gl_Position \x3d projPos;\n    }\n\n    void main() {\n      ComponentData component \x3d readComponentData();\n      UnpackedAttributes unpackedAttributes \x3d unpackAttributes(component);\n\n      vec3 worldPosV0 \x3d worldFromModelPosition(position0);\n      vec3 worldPosV1 \x3d worldFromModelPosition(position1);\n      vec3 viewPosV0 \x3d viewFromModelPosition(position0);\n      vec3 viewPosV1 \x3d viewFromModelPosition(position1);\n\n      // Component color\n      vColor \x3d component.color;\n\n      // Discard fully transparent edges\n      if (vColor.a \x3c opaqueCutoff) {\n        gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n        return;\n      }\n\n      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {\n        return;\n      }\n\n      // General geometric computation for all types of edges\n      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);\n\n      // Specific computation for different edge styles\n      calculateStyleOutputs(unpackedAttributes);\n    }\n  "],
["\n    const float opaqueCutoff \x3d 1.0 / 255.0;\n\n    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n      vec2 sideness \x3d unpackedAttributes.sideness;\n      vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n\n      vWorldPosition \x3d mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;\n\n      vec3 viewPos \x3d mix(viewPosV0, viewPosV1, sidenessNorm.y);\n\n      vec4 projPosV0 \x3d projFromViewPosition(viewPosV0);\n      vec4 projPosV1 \x3d projFromViewPosition(viewPosV1);\n      vec4 projPos \x3d projFromViewPosition(viewPos);\n\n      vec3 screenSpaceLineNDC \x3d (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\n      vec2 screenSpaceLinePixels \x3d screenSpaceLineNDC.xy * uNDCToPixel;\n      float lineLengthPixels \x3d length(screenSpaceLinePixels);\n\n      float dzPerPixel \x3d screenSpaceLineNDC.z / lineLengthPixels;\n      vec2 screenSpaceDirection \x3d screenSpaceLinePixels / lineLengthPixels;\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\n\n      float falloffFactor \x3d distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;\n      float lineWidthPixels \x3d unpackedAttributes.lineWidthPixels * falloffFactor;\n\n      float extensionLengthPixels \x3d calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\n      float lineAmplitudePixels \x3d calculateLineAmplitude(unpackedAttributes) * uPixelRatio;\n\n      vSizeFalloffFactor \x3d falloffFactor;\n\n      float lineWidthAndAmplitudePixels \x3d lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\n      float extendedLineLengthPixels \x3d lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\n\n    #ifdef ANTIALIASING\n      const float aaPaddingPixels \x3d 1.0;\n\n      // Line size with padding\n      float halfAAPaddedLineWidthAndAmplitudePixels \x3d lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\n      float aaPaddedRoundedCapSizePixels \x3d lineWidthPixels * 0.5 + aaPaddingPixels;\n    #else /* ANTIALIASING */\n\n      // Even if there is no AA, we still want to do proper \x3c1px rendering,\n      // so we effectively clamp the pixel sizes to minimum of 1px and compute\n      // coverage in the fragment shader\n      float halfAAPaddedLineWidthAndAmplitudePixels \x3d max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\n      float aaPaddedRoundedCapSizePixels \x3d max(lineWidthPixels, 1.0) * 0.5;\n    #endif /* ANTIALIASING */\n\n      // Half line width in NDC including padding for anti aliasing\n      vec2 halfAAPaddedLineWidthAndAmplitudeNDC \x3d halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\n      vec2 aaPaddedRoundedCapSizeNDC \x3d aaPaddedRoundedCapSizePixels * uPixelToNDC;\n      vec2 extensionLengthNDC \x3d extensionLengthPixels * uPixelToNDC;\n\n      // Compute screen space position of vertex, offsetting for line size and end caps\n      vec2 ndcOffset \x3d (\n          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\n        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\n      );\n\n      projPos.xy +\x3d ndcOffset * projPos.w;\n      projPos.z +\x3d (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\n\n      projPos \x3d adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\n\n      // Line length with end caps\n      float aaPaddedLineWithCapsLengthPixels \x3d extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\n\n      float pixelPositionAlongLine \x3d aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\n\n      // Position in pixels with origin at first vertex of line segment\n      vPosition \x3d vec3(\n        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\n        pixelPositionAlongLine,\n        pixelPositionAlongLine / extendedLineLengthPixels\n      );\n\n      // The line width radius in pixels\n      vRadius \x3d lineWidthPixels * 0.5;\n      vLineLengthPixels \x3d extendedLineLengthPixels;\n\n      // discard edges below a certain length threshold\n      discardShortEdges(unpackedAttributes, lineLengthPixels);\n\n      gl_Position \x3d projPos;\n    }\n\n    void main() {\n      ComponentData component \x3d readComponentData();\n      UnpackedAttributes unpackedAttributes \x3d unpackAttributes(component);\n\n      vec3 worldPosV0 \x3d worldFromModelPosition(position0);\n      vec3 worldPosV1 \x3d worldFromModelPosition(position1);\n      vec3 viewPosV0 \x3d viewFromModelPosition(position0);\n      vec3 viewPosV1 \x3d viewFromModelPosition(position1);\n\n      // Component color\n      vColor \x3d component.color;\n\n      // Discard fully transparent edges\n      if (vColor.a \x3c opaqueCutoff) {\n        gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n        return;\n      }\n\n      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {\n        return;\n      }\n\n      // General geometric computation for all types of edges\n      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);\n\n      // Specific computation for different edge styles\n      calculateStyleOutputs(unpackedAttributes);\n    }\n  "]))));
q.fragment.code.add(h.glsl(z||(z=a.__makeTemplateObject(["\n    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\n      float lineOffset \x3d calculateLineOffset();\n      float positionX \x3d position.x - lineOffset;\n\n      if (radius \x3c 1.0) {\n        // Handle this specifically for subpixel sizes:\n        // 1. Compute correct coverage (note coverage is computed by\n        //    0.5 - dist, so we make sure that that will lead to correct\n        //    subpixel coverage\n        // 2. Ignore rounded caps\n        float coverageX \x3d clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\n        float coverageY \x3d clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\n\n        float coverage \x3d min(coverageX, coverageY);\n\n        return vec2(0.5 - coverage, 0.0);\n      }\n      else {\n        // Between -radius -\x3e 0 for start cap, 0 for line, 0 -\x3e radius\n        float positionOnCap \x3d position.y - clamp(position.y, 0.0, lineLength);\n\n        vec2 lineToPosition \x3d vec2(positionX, positionOnCap);\n        return vec2(length(lineToPosition) - radius, positionOnCap / radius);\n      }\n    }\n\n    void main() {\n      float radius \x3d vRadius * calculateLinePressure();\n\n      vec2 distance \x3d lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\n      float coverage \x3d clamp(0.5 - distance.x, 0.0, 1.0);\n\n      discardByCoverage(radius, coverage);\n      discardBySlice(vWorldPosition);\n\n      float alpha \x3d vColor.a * coverage;\n\n      gl_FragColor \x3d vec4(vColor.rgb, alpha);\n\n    }\n  "],
["\n    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\n      float lineOffset \x3d calculateLineOffset();\n      float positionX \x3d position.x - lineOffset;\n\n      if (radius \x3c 1.0) {\n        // Handle this specifically for subpixel sizes:\n        // 1. Compute correct coverage (note coverage is computed by\n        //    0.5 - dist, so we make sure that that will lead to correct\n        //    subpixel coverage\n        // 2. Ignore rounded caps\n        float coverageX \x3d clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\n        float coverageY \x3d clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\n\n        float coverage \x3d min(coverageX, coverageY);\n\n        return vec2(0.5 - coverage, 0.0);\n      }\n      else {\n        // Between -radius -\x3e 0 for start cap, 0 for line, 0 -\x3e radius\n        float positionOnCap \x3d position.y - clamp(position.y, 0.0, lineLength);\n\n        vec2 lineToPosition \x3d vec2(positionX, positionOnCap);\n        return vec2(length(lineToPosition) - radius, positionOnCap / radius);\n      }\n    }\n\n    void main() {\n      float radius \x3d vRadius * calculateLinePressure();\n\n      vec2 distance \x3d lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\n      float coverage \x3d clamp(0.5 - distance.x, 0.0, 1.0);\n\n      discardByCoverage(radius, coverage);\n      discardBySlice(vWorldPosition);\n\n      float alpha \x3d vColor.a * coverage;\n\n      gl_FragColor \x3d vec4(vColor.rgb, alpha);\n\n    }\n  "]))));
return q};var t,u,v,z})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":function(){define("require exports tslib ../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../core/shaderLibrary/util/IsNaN.glsl ../../../core/shaderModules/interfaces".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});b.AdjustProjectedPosition=function(b,c){b.include(h.IsNaN);b.include(m.VertexPosition,c);b=b.vertex;b.uniforms.add("uDepthBias",
"vec2");b.uniforms.add("uViewportDimInv","vec2");c.legacy?(b.uniforms.add("uView","mat4"),b.uniforms.add("uProj","mat4")):b.uniforms.add("uTransformNormal_ViewFromGlobal","mat3");c.legacy?b.code.add(e.glsl(f||(f=a.__makeTemplateObject(["\n      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {\n        float offsetXY \x3d uDepthBias.x;\n        float offsetZ  \x3d uDepthBias.y;\n\n        // screen space pixel offset\n        // we multiply by two to account for the fact that NDC go from -1 to 1\n        // we multiply by projPos.w to compensate for the perspective division that happens later\n        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n        // towards the camera\n        vec4 projNormal \x3d uProj * uView * vec4(globalNormal, 0.0);\n\n        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n      }\n    "],
["\n      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {\n        float offsetXY \x3d uDepthBias.x;\n        float offsetZ  \x3d uDepthBias.y;\n\n        // screen space pixel offset\n        // we multiply by two to account for the fact that NDC go from -1 to 1\n        // we multiply by projPos.w to compensate for the perspective division that happens later\n        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n        // towards the camera\n        vec4 projNormal \x3d uProj * uView * vec4(globalNormal, 0.0);\n\n        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n      }\n    "])))):
b.code.add(e.glsl(g||(g=a.__makeTemplateObject(["\n      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {\n        float offsetXY \x3d uDepthBias.x;\n        float offsetZ  \x3d uDepthBias.y;\n\n        // screen space pixel offset\n        // we multiply by two to account for the fact that NDC go from -1 to 1\n        // we multiply by projPos.w to compensate for the perspective division that happens later\n        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n        // towards the camera\n        vec4 projNormal \x3d uTransform_ProjFromView * vec4(uTransformNormal_ViewFromGlobal * globalNormal, 0.0);\n\n        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n      }\n    "],
["\n      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {\n        float offsetXY \x3d uDepthBias.x;\n        float offsetZ  \x3d uDepthBias.y;\n\n        // screen space pixel offset\n        // we multiply by two to account for the fact that NDC go from -1 to 1\n        // we multiply by projPos.w to compensate for the perspective division that happens later\n        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n        // towards the camera\n        vec4 projNormal \x3d uTransform_ProjFromView * vec4(uTransformNormal_ViewFromGlobal * globalNormal, 0.0);\n\n        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n      }\n    "]))));
b.code.add(e.glsl(l||(l=a.__makeTemplateObject(["\n    // A z-offset, using a depth based heuristic.\n    float _calculateProjectedBiasZ(vec4 projPos) {\n      float offsetZ \x3d uDepthBias.y;\n      return sqrt(projPos.z) * offsetZ;\n    }\n\n    vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\n      vec2 offsetXY \x3d calculateProjectedBiasXY(projPos, worldNormal);\n\n      // we currently have to do this check because some geometries come with 0 length edge normals.\n      // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\n      if (!isNaN(offsetXY.x) \x26\x26 !isNaN(offsetXY.y)) {\n        projPos.xy +\x3d offsetXY;\n      }\n\n      projPos.z +\x3d _calculateProjectedBiasZ(projPos);\n\n      return projPos;\n    }\n  "],
["\n    // A z-offset, using a depth based heuristic.\n    float _calculateProjectedBiasZ(vec4 projPos) {\n      float offsetZ \x3d uDepthBias.y;\n      return sqrt(projPos.z) * offsetZ;\n    }\n\n    vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\n      vec2 offsetXY \x3d calculateProjectedBiasXY(projPos, worldNormal);\n\n      // we currently have to do this check because some geometries come with 0 length edge normals.\n      // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\n      if (!isNaN(offsetXY.x) \x26\x26 !isNaN(offsetXY.y)) {\n        projPos.xy +\x3d offsetXY;\n      }\n\n      projPos.z +\x3d _calculateProjectedBiasZ(projPos);\n\n      return projPos;\n    }\n  "]))))};
var f,g,l})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":function(){define(["require","exports","tslib","../../shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.IsNaN=function(b){var e=m.glsl(h||(h=a.__makeTemplateObject(["\n    bool isNaN( float val )\n    {\n      return ( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 ) ? false : true;\n      // important: some nVidias failed to cope with version below.\n      // Probably wrong optimization.\n      /*return ( val \x3c\x3d 0.0 || 0.0 \x3c\x3d val ) ? false : true;*/\n    }\n  "],
["\n    bool isNaN( float val )\n    {\n      return ( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 ) ? false : true;\n      // important: some nVidias failed to cope with version below.\n      // Probably wrong optimization.\n      /*return ( val \x3c\x3d 0.0 || 0.0 \x3c\x3d val ) ? false : true;*/\n    }\n  "])));b.fragment.code.add(e);b.vertex.code.add(e)};var h})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":function(){define(["require","exports","tslib",
"../../../core/shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.DiscardByCoverage=function(b,g){b=b.fragment;b.defines.addFloat("COVERAGE_TEST_THRESHOLD",.01);g.antialiasing?b.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n      #define discardByCoverage(radius, coverage) { if (coverage \x3c COVERAGE_TEST_THRESHOLD) discard; }\n    "],["\n      #define discardByCoverage(radius, coverage) { if (coverage \x3c COVERAGE_TEST_THRESHOLD) discard; }\n    "])))):
b.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n      #define discardByCoverage(radius, coverage) { float coverageLimit \x3d radius \x3c\x3d 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75; if (coverage \x3c coverageLimit) discard; }\n    "],["\n      #define discardByCoverage(radius, coverage) { float coverageLimit \x3d radius \x3c\x3d 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75; if (coverage \x3c coverageLimit) discard; }\n    "]))))};var h,e})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":function(){define(["require",
"exports","tslib","../../../core/shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.DiscardNonSilhouetteEdges=function(b,d){b=b.vertex;d.silhouette?(b.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n      bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {\n        float faceAVisible \x3d dot(viewDir, normalA);\n        float faceBVisible \x3d dot(viewDir, normalB);\n        return faceAVisible * faceBVisible \x3c 0.0;\n      }\n    "],["\n      bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {\n        float faceAVisible \x3d dot(viewDir, normalA);\n        float faceBVisible \x3d dot(viewDir, normalB);\n        return faceAVisible * faceBVisible \x3c 0.0;\n      }\n    "])))),
d.legacy?b.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n          vec3 viewNormalA \x3d _modelToViewNormal(normalA);\n          vec3 viewNormalB \x3d _modelToViewNormal(normalB);\n          vec3 viewDir \x3d -viewPos;\n\n          if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {\n            return false;\n          }\n\n          gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n          return true;\n        }\n      "],
["\n        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n          vec3 viewNormalA \x3d _modelToViewNormal(normalA);\n          vec3 viewNormalB \x3d _modelToViewNormal(normalB);\n          vec3 viewDir \x3d -viewPos;\n\n          if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {\n            return false;\n          }\n\n          gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n          return true;\n        }\n      "])))):b.code.add(m.glsl(f||(f=a.__makeTemplateObject(["\n        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n          vec3 worldNormalA \x3d _modelToWorldNormal(normalA);\n          vec3 worldNormalB \x3d _modelToWorldNormal(normalB);\n          vec3 viewDir \x3d -worldPos;\n\n          if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {\n            return false;\n          }\n\n          gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n          return true;\n        }\n      "],
["\n        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n          vec3 worldNormalA \x3d _modelToWorldNormal(normalA);\n          vec3 worldNormalB \x3d _modelToWorldNormal(normalB);\n          vec3 viewDir \x3d -worldPos;\n\n          if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {\n            return false;\n          }\n\n          gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n          return true;\n        }\n      "]))))):b.code.add(m.glsl(g||(g=a.__makeTemplateObject(["\n      bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n        return false;\n      }\n    "],
["\n      bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n        return false;\n      }\n    "]))))};var h,e,f,g})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl":function(){define(["require","exports","tslib","../../../core/shaderModules/interfaces"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.DiscardShortEdges=function(b,l){b=b.vertex;switch(l.mode){case 1:b.code.add(m.glsl(h||(h=a.__makeTemplateObject(["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels \x3c\x3d 3.0) { gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0); return; }}\n      "],
["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels \x3c\x3d 3.0) { gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0); return; }}\n      "]))));break;case 2:b.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type \x3c\x3d 0.0 \x26\x26 lineLengthPixels \x3c\x3d 3.0) { gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0); return; }}\n      "],["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type \x3c\x3d 0.0 \x26\x26 lineLengthPixels \x3c\x3d 3.0) { gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0); return; }}\n      "]))));
break;case 0:b.code.add(m.glsl(f||(f=a.__makeTemplateObject(["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) {}\n      "],["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) {}\n      "]))))}};var h,e,f})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define(["require","exports","tslib","../../../core/shaderLibrary/util/DoublePrecision.glsl","../../../core/shaderModules/interfaces"],function(n,b,a,m,h){function e(b,
e){var n=b.vertex;n.uniforms.add("uDistanceFalloffFactor","float");n.code.add(h.glsl(f||(f=a.__makeTemplateObject(["\n    float distanceBasedPerspectiveFactor(float distance) {\n      return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\n    }\n  "],["\n    float distanceBasedPerspectiveFactor(float distance) {\n      return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\n    }\n  "]))));n.uniforms.add("uComponentDataTex","sampler2D");n.uniforms.add("uComponentDataTexInvDim",
"vec2");b.attributes.add("componentIndex","float");n.defines.addFloat("COMPONENT_COLOR_FIELD_OFFSET",0);n.defines.addFloat("COMPONENT_OTHER_FIELDS_OFFSET",1);n.defines.addFloat("COMPONENT_FIELD_COUNT",2);n.defines.addFloat("LINE_WIDTH_FRACTION_FACTOR",8);n.defines.addFloat("EXTENSION_LENGTH_OFFSET",128);n.defines.addFloat("COMPONENT_TEX_WIDTH",4096);n.code.add(h.glsl(g||(g=a.__makeTemplateObject(["\n    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {\n      float fieldIndex \x3d COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\n\n      float rowIndex \x3d floor(fieldIndex / COMPONENT_TEX_WIDTH);\n      float colIndex \x3d mod(fieldIndex, COMPONENT_TEX_WIDTH);\n\n      vec2 linearIndex \x3d vec2(\n        (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\n        (rowIndex + 0.5) * uComponentDataTexInvDim.y\n      );\n\n      return linearIndex;\n    }\n\n    struct ComponentData {\n      vec4 color;\n      float lineWidth;\n      float extensionLength;\n      float type;\n    };\n\n    ComponentData readComponentData() {\n      vec2 colorIndex \x3d _componentTextureCoords(componentIndex, COMPONENT_COLOR_FIELD_OFFSET);\n      vec2 otherIndex \x3d _componentTextureCoords(componentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\n\n      vec4 colorValue \x3d texture2D(uComponentDataTex, colorIndex);\n      vec4 otherValue \x3d texture2D(uComponentDataTex, otherIndex);\n\n      return ComponentData(\n        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\n        otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\n        otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\n        -(otherValue.z * 255.0) + 0.5 // SOLID (\x3d0/255) needs to be \x3e 0.0, SKETCHY (\x3d1/255) needs to be \x3c\x3d 0;\n      );\n    }\n  "],
["\n    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {\n      float fieldIndex \x3d COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\n\n      float rowIndex \x3d floor(fieldIndex / COMPONENT_TEX_WIDTH);\n      float colIndex \x3d mod(fieldIndex, COMPONENT_TEX_WIDTH);\n\n      vec2 linearIndex \x3d vec2(\n        (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\n        (rowIndex + 0.5) * uComponentDataTexInvDim.y\n      );\n\n      return linearIndex;\n    }\n\n    struct ComponentData {\n      vec4 color;\n      float lineWidth;\n      float extensionLength;\n      float type;\n    };\n\n    ComponentData readComponentData() {\n      vec2 colorIndex \x3d _componentTextureCoords(componentIndex, COMPONENT_COLOR_FIELD_OFFSET);\n      vec2 otherIndex \x3d _componentTextureCoords(componentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\n\n      vec4 colorValue \x3d texture2D(uComponentDataTex, colorIndex);\n      vec4 otherValue \x3d texture2D(uComponentDataTex, otherIndex);\n\n      return ComponentData(\n        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\n        otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\n        otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\n        -(otherValue.z * 255.0) + 0.5 // SOLID (\x3d0/255) needs to be \x3e 0.0, SKETCHY (\x3d1/255) needs to be \x3c\x3d 0;\n      );\n    }\n  "]))));
e.legacy?n.code.add(h.glsl(l||(l=a.__makeTemplateObject(["\n      vec3 _modelToWorldNormal(vec3 normal) {\n        return (uModel * vec4(normal, 0.0)).xyz;\n      }\n\n      vec3 _modelToViewNormal(vec3 normal) {\n        return (uView * uModel * vec4(normal, 0.0)).xyz;\n      }\n    "],["\n      vec3 _modelToWorldNormal(vec3 normal) {\n        return (uModel * vec4(normal, 0.0)).xyz;\n      }\n\n      vec3 _modelToViewNormal(vec3 normal) {\n        return (uView * uModel * vec4(normal, 0.0)).xyz;\n      }\n    "])))):
(n.uniforms.add("uTransformNormal_GlobalFromModel ","mat3"),n.code.add(h.glsl(d||(d=a.__makeTemplateObject(["\n      vec3 _modelToWorldNormal(vec3 normal) {\n        return uTransformNormal_GlobalFromModel * normal;\n      }\n    "],["\n      vec3 _modelToWorldNormal(vec3 normal) {\n        return uTransformNormal_GlobalFromModel * normal;\n      }\n    "])))));e.silhouette?(b.attributes.add("normalA","vec3"),b.attributes.add("normalB","vec3"),n.code.add(h.glsl(c||(c=a.__makeTemplateObject(["\n      vec3 worldNormal() {\n        return _modelToWorldNormal(normalize(normalA + normalB));\n      }\n    "],
["\n      vec3 worldNormal() {\n        return _modelToWorldNormal(normalize(normalA + normalB));\n      }\n    "]))))):(b.attributes.add("normal","vec3"),n.code.add(h.glsl(k||(k=a.__makeTemplateObject(["\n      vec3 worldNormal() {\n        return _modelToWorldNormal(normal);\n      }\n    "],["\n      vec3 worldNormal() {\n        return _modelToWorldNormal(normal);\n      }\n    "])))));e.legacy?n.code.add(h.glsl(p||(p=a.__makeTemplateObject(["\n      vec3 worldFromModelPosition(vec3 position) {\n        return (uModel * vec4(position, 1.0)).xyz;\n      }\n\n      vec3 viewFromModelPosition(vec3 position) {\n        return (uView * vec4(worldFromModelPosition(position), 1.0)).xyz;\n      }\n\n      vec4 projFromViewPosition(vec3 position) {\n        return uProj * vec4(position, 1.0);\n      }\n    "],
["\n      vec3 worldFromModelPosition(vec3 position) {\n        return (uModel * vec4(position, 1.0)).xyz;\n      }\n\n      vec3 viewFromModelPosition(vec3 position) {\n        return (uView * vec4(worldFromModelPosition(position), 1.0)).xyz;\n      }\n\n      vec4 projFromViewPosition(vec3 position) {\n        return uProj * vec4(position, 1.0);\n      }\n    "])))):(b.include(m.DoublePrecision,e),n.code.add(h.glsl(r||(r=a.__makeTemplateObject(["\n      vec3 worldFromModelPosition(vec3 position) {\n        vec3 rotatedModelPosition \x3d uTransform_WorldFromModel_RS * position;\n\n        vec3 transform_CameraRelativeFromModel \x3d dpAdd(\n          uTransform_WorldFromModel_TL,\n          uTransform_WorldFromModel_TH,\n          -uTransform_WorldFromView_TL,\n          -uTransform_WorldFromView_TH\n        );\n\n        return transform_CameraRelativeFromModel + rotatedModelPosition;\n      }\n\n      vec3 viewFromModelPosition(vec3 position) {\n        return uTransform_ViewFromCameraRelative_RS * worldFromModelPosition(position);\n      }\n\n      vec4 projFromViewPosition(vec3 position) {\n        return uTransform_ProjFromView * vec4(position, 1.0);\n      }\n    "],
["\n      vec3 worldFromModelPosition(vec3 position) {\n        vec3 rotatedModelPosition \x3d uTransform_WorldFromModel_RS * position;\n\n        vec3 transform_CameraRelativeFromModel \x3d dpAdd(\n          uTransform_WorldFromModel_TL,\n          uTransform_WorldFromModel_TH,\n          -uTransform_WorldFromView_TL,\n          -uTransform_WorldFromView_TH\n        );\n\n        return transform_CameraRelativeFromModel + rotatedModelPosition;\n      }\n\n      vec3 viewFromModelPosition(vec3 position) {\n        return uTransform_ViewFromCameraRelative_RS * worldFromModelPosition(position);\n      }\n\n      vec4 projFromViewPosition(vec3 position) {\n        return uTransform_ProjFromView * vec4(position, 1.0);\n      }\n    "])))));
n.code.add(h.glsl(t||(t=a.__makeTemplateObject(["\n    float calculateExtensionLength(float extensionLength, float lineLength) {\n      return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\n    }\n  "],["\n    float calculateExtensionLength(float extensionLength, float lineLength) {\n      return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\n    }\n  "]))))}Object.defineProperty(b,"__esModule",{value:!0});b.EdgeUtil=e;(function(a){a.usesSketchLogic=function(a){return 1===
a.mode||2===a.mode};a.usesSolidLogic=function(a){return 0===a.mode||2===a.mode}})(e=b.EdgeUtil||(b.EdgeUtil={}));var f,g,l,d,c,k,p,r,t})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":function(){define("require exports tslib ../../../core/shaderModules/interfaces ./EdgeUtil.glsl ./UnpackAttributes.glsl".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});b.LineAmplitude=function(b,c){var d=b.vertex;b.include(e.UnpackAttributes,c);h.EdgeUtil.usesSketchLogic(c)&&
d.uniforms.add("uStrokesAmplitude","float");switch(c.mode){case 0:d.code.add(m.glsl(f||(f=a.__makeTemplateObject(["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          return 0.0;\n        }\n      "],["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          return 0.0;\n        }\n      "]))));break;case 1:d.code.add(m.glsl(g||(g=a.__makeTemplateObject(["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          return uStrokesAmplitude;\n        }\n      "],
["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          return uStrokesAmplitude;\n        }\n      "]))));break;case 2:d.code.add(m.glsl(l||(l=a.__makeTemplateObject(["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          float type \x3d unpackedAttributes.type;\n\n          if (type \x3c\x3d 0.0) {\n            return uStrokesAmplitude;\n          }\n          else {\n            return 0.0;\n          }\n        }\n      "],
["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          float type \x3d unpackedAttributes.type;\n\n          if (type \x3c\x3d 0.0) {\n            return uStrokesAmplitude;\n          }\n          else {\n            return 0.0;\n          }\n        }\n      "]))))}};var f,g,l})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":function(){define(["require","exports","tslib","../../../core/shaderModules/interfaces","./EdgeUtil.glsl"],
function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.UnpackAttributes=function(b,k){var c=b.vertex;b.include(h.EdgeUtil,k);b.attributes.add("sideness","vec2");2===k.mode?c.code.add(m.glsl(e||(e=a.__makeTemplateObject(["\n      struct UnpackedAttributes {\n        vec2 sideness;\n        vec2 sidenessNorm;\n        float lineWidthPixels;\n        float extensionLengthPixels;\n        float type;\n      };\n    "],["\n      struct UnpackedAttributes {\n        vec2 sideness;\n        vec2 sidenessNorm;\n        float lineWidthPixels;\n        float extensionLengthPixels;\n        float type;\n      };\n    "])))):
c.code.add(m.glsl(f||(f=a.__makeTemplateObject(["\n      struct UnpackedAttributes {\n        vec2 sideness;\n        vec2 sidenessNorm;\n        float lineWidthPixels;\n        float extensionLengthPixels;\n      };\n  "],["\n      struct UnpackedAttributes {\n        vec2 sideness;\n        vec2 sidenessNorm;\n        float lineWidthPixels;\n        float extensionLengthPixels;\n      };\n  "]))));switch(k.mode){case 2:c.code.add(m.glsl(g||(g=a.__makeTemplateObject(["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float fType \x3d component.type;\n          float extensionLengthPixels \x3d component.extensionLength;\n          float lineWidth \x3d component.lineWidth;\n\n          if (fType \x3c\x3d 0.0) {\n            extensionLengthPixels *\x3d variantExtension * 2.0 - 1.0;\n          }\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\n        }\n      "],
["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float fType \x3d component.type;\n          float extensionLengthPixels \x3d component.extensionLength;\n          float lineWidth \x3d component.lineWidth;\n\n          if (fType \x3c\x3d 0.0) {\n            extensionLengthPixels *\x3d variantExtension * 2.0 - 1.0;\n          }\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\n        }\n      "]))));
break;case 1:c.code.add(m.glsl(l||(l=a.__makeTemplateObject(["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float extensionLengthPixels \x3d component.extensionLength;\n          extensionLengthPixels *\x3d variantExtension * 2.0 - 1.0;\n          float lineWidth \x3d component.lineWidth;\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n        }\n      "],
["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float extensionLengthPixels \x3d component.extensionLength;\n          extensionLengthPixels *\x3d variantExtension * 2.0 - 1.0;\n          float lineWidth \x3d component.lineWidth;\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n        }\n      "]))));break;case 0:c.code.add(m.glsl(d||
(d=a.__makeTemplateObject(["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float extensionLengthPixels \x3d component.extensionLength;\n          float lineWidth \x3d component.lineWidth;\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n        }\n      "],["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float extensionLengthPixels \x3d component.extensionLength;\n          float lineWidth \x3d component.lineWidth;\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n        }\n      "]))))}};
var e,f,g,l,d})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":function(){define("require exports tslib ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/interfaces ./EdgeUtil.glsl ./UnpackAttributes.glsl".split(" "),function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});b.LineOffset=function(b,n){var u=b.vertex;b.include(f.UnpackAttributes,n);var v=b.fragment;b.include(m.RgbaFloatEncoding);e.EdgeUtil.usesSketchLogic(n)&&
(u.uniforms.add("uStrokesTextureScale","vec2"),u.uniforms.add("uStrokesLog2Resolution","float"),u.uniforms.add("uStrokeVariants","float"),b.varyings.add("vStrokeUV","vec2"),v.uniforms.add("uStrokesTexture","sampler2D"),v.uniforms.add("uStrokesNormalizationScale","float"),u.code.add(h.glsl(g||(g=a.__makeTemplateObject(["\n      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\n        vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n\n        float lineIndex \x3d clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\n\n        vStrokeUV \x3d vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + variantStroke + 0.5) * uStrokesTextureScale;\n        vStrokeUV.x +\x3d variantOffset;\n      }\n    "],
["\n      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\n        vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n\n        float lineIndex \x3d clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\n\n        vStrokeUV \x3d vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + variantStroke + 0.5) * uStrokesTextureScale;\n        vStrokeUV.x +\x3d variantOffset;\n      }\n    "])))),v.code.add(h.glsl(l||(l=a.__makeTemplateObject(["\n      float calculateLineOffsetSketch() {\n        float offsetNorm \x3d rgba2float(texture2D(uStrokesTexture, vStrokeUV));\n        return (offsetNorm - 0.5) * uStrokesNormalizationScale;\n      }\n\n      float calculateLinePressureSketch() {\n        return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));\n      }\n    "],
["\n      float calculateLineOffsetSketch() {\n        float offsetNorm \x3d rgba2float(texture2D(uStrokesTexture, vStrokeUV));\n        return (offsetNorm - 0.5) * uStrokesNormalizationScale;\n      }\n\n      float calculateLinePressureSketch() {\n        return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));\n      }\n    "])))));switch(n.mode){case 0:u.code.add(h.glsl(d||(d=a.__makeTemplateObject(["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}\n      "],
["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}\n      "]))));v.code.add(h.glsl(c||(c=a.__makeTemplateObject(["\n        float calculateLineOffset() {\n          return 0.0;\n        }\n\n        float calculateLinePressure() {\n          return 1.0;\n        }\n      "],["\n        float calculateLineOffset() {\n          return 0.0;\n        }\n\n        float calculateLinePressure() {\n          return 1.0;\n        }\n      "]))));break;case 1:u.code.add(h.glsl(k||
(k=a.__makeTemplateObject(["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)\n        {\n          calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n        }\n      "],["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)\n        {\n          calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n        }\n      "]))));v.code.add(h.glsl(p||(p=a.__makeTemplateObject(["\n        float calculateLineOffset() {\n          return calculateLineOffsetSketch();\n        }\n\n        float calculateLinePressure() {\n          return calculateLinePressureSketch();\n        }\n      "],
["\n        float calculateLineOffset() {\n          return calculateLineOffsetSketch();\n        }\n\n        float calculateLinePressure() {\n          return calculateLinePressureSketch();\n        }\n      "]))));break;case 2:b.varyings.add("vType","float"),u.code.add(h.glsl(r||(r=a.__makeTemplateObject(["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)\n        {\n          vType \x3d unpackedAttributes.type;\n\n          if (unpackedAttributes.type \x3c\x3d 0.0) {\n            calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n          }\n        }\n      "],
["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)\n        {\n          vType \x3d unpackedAttributes.type;\n\n          if (unpackedAttributes.type \x3c\x3d 0.0) {\n            calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n          }\n        }\n      "])))),v.code.add(h.glsl(t||(t=a.__makeTemplateObject(["\n        float calculateLineOffset() {\n          if (vType \x3c\x3d 0.0) {\n            return calculateLineOffsetSketch();\n          }\n          else {\n            return 0.0;\n          }\n        }\n\n        float calculateLinePressure() {\n          if (vType \x3c\x3d 0.0) {\n            return calculateLinePressureSketch();\n          }\n          else {\n            return 1.0;\n          }\n        }\n      "],
["\n        float calculateLineOffset() {\n          if (vType \x3c\x3d 0.0) {\n            return calculateLineOffsetSketch();\n          }\n          else {\n            return 0.0;\n          }\n        }\n\n        float calculateLinePressure() {\n          if (vType \x3c\x3d 0.0) {\n            return calculateLinePressureSketch();\n          }\n          else {\n            return 1.0;\n          }\n        }\n      "]))))}};var g,l,d,c,k,p,r,t})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define(["require",
"exports","../../../../../core/mathUtils","../Util","../../../../webgl/Texture"],function(n,b,a,m,h){function e(a,b){if(!a)return null;var c=a.length/2,d=f*c,c=Array(c),e=0;b=1===b;for(var h=0;h<a.length;h+=2){var l=(a[h]+a[h+1])/2;b?c[e++]=Math.min(d,1-(1-l)*g):c[e++]=Math.min(d,l*g)}return c}Object.defineProperty(b,"__esModule",{value:!0});b.generateStrokesTexture=function(f){for(var d=b.strokesDefinition.resolution,c=d/2,g=new Uint8Array(4*d*d),l=4*d*c,c=b.strokesDefinition.amplitude,r=2*c,n=4*
d,u=a.log2(d)+1,v=b.strokesDefinition.strokes.length,z=(u-1)*v*n,w=0,q=b.strokesDefinition.strokes;w<q.length;w++){for(var y=q[w],A=y.distance,y=y.pressure,B=z,C=0;C<u;C++){0!==C&&(A=e(A,0),y=e(y,1));for(var F=0;F<b.strokesDefinition.resolution;F++){var H=y?y[F%y.length]:1;m.packFloatRGBA((A?A[F%A.length]/r:0)+.5,g,B);m.packFloatRGBA(H,g,B+l);B+=4}B-=n*(v+1)}z+=n}f=new h(f,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:d,height:d,wrapMode:10497},g);return{resolution:d,texture:f,
normalizationScale:r,amplitude:c,variants:v}};b.rasterizeStrokes=function(){for(var f=b.strokesDefinition.resolution,d=a.log2(f)+1,c=b.strokesDefinition.strokes.length,g=b.strokesDefinition.amplitude,h=Math.ceil(2*g+.5),m=0;1<=f;)m+=f,f/=2;var m=m+6*(d+1),c=c*h,f=new Uint8ClampedArray(4*m*c),n=4*m;f.fill(255);for(var u=24,v=0,z=b.strokesDefinition.strokes;v<z.length;v++){for(var w=z[v],q=w.distance,w=w.pressure,y=u,A=0;A<d;A++){0!==A&&(q=e(q,0),w=e(w,1));for(var B=0;B<q.length;B++){for(var C=q?q[B]:
0,F=w?a.clamp(w[B],0,1):1,H=y,I=-g;I<h-g;I++){var G=255-255*a.clamp(1-(Math.abs(I-C+.5)-.5*F),0,1);f[H+0]=G;f[H+1]=G;f[H+2]=G;f[H+3]=255;H+=n}y+=4}y+=24}u+=h*n}return new ImageData(f,m,c)};var f=.1,g=.5;b.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,
-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,
.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,
.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,
-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,
.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,
.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,
.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,
-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,
.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,
1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,
-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,
-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,
.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,
.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,
.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,
2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,
4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,
2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,
.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,
.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,
.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,
.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,
2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,
.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,
.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,
1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,
.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,
.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,
.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,
.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,
-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,
1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,
.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,
-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,
.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,
.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,
.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,
5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,
3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,
-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,
.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,
.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,
.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,
.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,
.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["require","exports","../../../../../core/arrayUtils","../../../../../core/maybe","../../../../../core/typedArrayUtil"],function(n,b,a,m,h){function e(a){return 0<a.size*a.color[3]*a.opacity}function f(b,e){var d=a.binaryIndexOf(b,e,!0);return-1===d?e<b[0]?0:b.length:d}Object.defineProperty(b,
"__esModule",{value:!0});b.determineRendererType=function(a){for(var b=null,d=0;d<a.length;d++){var c=a[d],f=c.type;if(e(c))if(m.isNone(b))b=f;else if(b!==f)return"uber"}return m.isSome(b)?b:"solid"};b.determineEdgeTransparency=function(a){for(var b=0,d=0;d<a.length;d++){var c=a[d].material;if(e(c)){if(1>c.color[3]*c.opacity)return 1;b=2}}return b};b.determineObjectTransparency=function(a){for(var b=0,d=0;d<a.length;d++){var c=a[d].material;if(e(c)){switch(c.objectTransparency){case 1:case 0:return 1;
case 2:if(1>c.opacity)return 1}b=2}}return b};b.cloneIndices=function(a){if(Uint16Array.from)return h.isUint16Array(a)?Uint16Array.from(a):Uint32Array.from(a);for(var b=h.isUint16Array(a)?new Uint16Array(a.length):new Uint32Array(a.length),d=0;d<a.length;d++)b[d]=a[d];return b};b.estimateLengthAtDistance=function(a,b,d,c){return c/a*d*2*Math.tan(.5*b)};b.findLowerBoundIndex=f;b.computeEdgeCount=function(a,b,d){return a.length-f(a,b*d.minimumEdgeLength)};b.fillComponenBufferIndices=function(a,b,d,
c){for(var e=0;e<a.length;e++){var f=a[e].index,g=b[e],h=b[e+1];if(c)for(;g<h;g++)d.set(c[g],f);else for(;g<h;g++)d.set(g,f)}}})},"esri/views/webgl/Profiling":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.startMeasurement=function(b){return(b=b.capabilities.disjointTimerQuery)?new a(b):null};b.getTimestamp=function(a,b,e){void 0===e&&(e=50);var f=a.capabilities.disjointTimerQuery;if(!f||0>=f.timestampBits())return!1;var g=f.createQuery();
f.createTimestamp(g);var h=function(){var a=f.resultAvailable(g),c=f.disjoint();a&&!c?(a=f.getResult(g),b(a/1E6)):c?b():setTimeout(h,e)};h();return!0};b.supportsTimestamps=function(a){a=a.capabilities.disjointTimerQuery;if(!a)return!1;a=a.timestampBits();console.log({bits:a});return 0<a};var a=function(){function a(a){this.timer=a;this.query=a.createQuery();this.timer.beginTimeElapsed(this.query)}a.prototype.stop=function(a,b){void 0===b&&(b=50);this.cb=a;this.checkInterval=b;this.timer.endTimeElapsed();
this.checkQueryResult()};a.prototype.checkQueryResult=function(){var a=this.timer.resultAvailable(this.query),b=this.timer.disjoint();a&&!b?(a=this.timer.getResult(this.query),this.cb(a/1E6)):b?this.cb():setTimeout(this.checkQueryResult.bind(this),this.checkInterval)};return a}()})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("require exports ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/scheduling ./TextureTechnique ./Util ../../../webgl/Texture".split(" "),
function(n,b,a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",{value:!0});var c=m.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");n=function(){function b(b,c,d){this._textures=b;this.rctx=d;this._idToRefCountedTexture=new Map;this._textureTechniqueConfig=new g.TextureTechniqueConfiguration;this._loadingCount=0;this._frameUpdates=new Map;this._fallbackTextureData=new Uint8Array(256);this._fallbackTextureTransparentData=new Uint8Array(256);this._texturesToUnload=[];this.events=new a;
this._textureTechnique=c.acquireAndReleaseExisting(g.TextureTechnique,this._textureTechniqueConfig,this._textureTechnique);for(b=0;b<this._fallbackTextureData.length;++b)this._fallbackTextureData[b]=255,this._fallbackTextureTransparentData[b]=0!==(b+1)%4?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:this.rctx.parameters.maxMaxAnisotropy}}b.prototype.dispose=function(){h.isSome(this._unloadDeferredHandle)&&(this._unloadDeferredHandle.remove(),
this._unloadDeferredHandle=null,this._unloadDeferred());h.isSome(this._fallbackTexture)&&(this._fallbackTexture.dispose(),this._fallbackTexture=null);h.isSome(this._fallbackTextureTransparent)&&(this._fallbackTextureTransparent.dispose(),this._fallbackTextureTransparent=null);this._textures.forEach(function(a){return a.unload()})};b.prototype.acquire=function(a,b,c){a=this._getOrCreateRef(a,b,c);a.ref();return a};b.prototype.update=function(){var a=this,b=!1;this._frameUpdates.forEach(function(c){var d=
c.texture.frameUpdate(a.rctx,a._textureTechnique,c.previousToken);0<=d&&d!==c.previousToken&&(c.previousToken=d,b=!0)});b&&this.events.emit("changed",{requestType:0})};b.prototype._getOrCreateRef=function(a,b,c){var d=this._idToRefCountedTexture.get(a);return d?d:this._createNewRef(a,b,c)};b.prototype._createNewRef=function(a,b,d){var f=this,g=this._textures.get(a);l.assert(void 0!==g);var h=g.events.on("unloaded",function(){h.remove();f._onTextureUnloaded(a)});b=!0===b;var m=new k;this._idToRefCountedTexture.set(a,
m);var p=g.load(this.rctx,this._textureTechnique);this._loadingCount++;var n=function(b){f._loadingCount--;f._updateGLTexture(m,b);d&&d(m);g.requiresFrameUpdates&&f._frameUpdates.set(a,{texture:g,previousToken:-1});return m},r=function(a){f._loadingCount--;e.isAbortError(a)||c.error(a)};e.isThenable(p)?(this._updateGLTexture(m,b?this.fallbackTextureTransparent:this.fallbackTexture),p.then(n,r)):n(p);return m};b.prototype._updateGLTexture=function(a,b){a.glTexture=b;this.events.emit("changed",{requestType:1})};
b.prototype.release=function(a){var b=this,c=this._idToRefCountedTexture.get(a);c&&(c.unref(),c.isUnreferenced&&(this._texturesToUnload.push(a),h.isNone(this._unloadDeferredHandle)&&(this._unloadDeferredHandle=f.schedule(function(){return b._unloadDeferred()}))))};b.prototype._unloadDeferred=function(){for(var a=0,b=this._texturesToUnload;a<b.length;a++){var c=b[a],d=this._textures.get(c),c=this._idToRefCountedTexture.get(c);d&&c&&c.isUnreferenced&&d.unload()}this._texturesToUnload.length=0;this._unloadDeferredHandle=
null};b.prototype.getTexture=function(a){return this._textures.get(a)};Object.defineProperty(b.prototype,"loadingCount",{get:function(){return this._loadingCount},enumerable:!0,configurable:!0});b.prototype._onTextureUnloaded=function(a){this._idToRefCountedTexture.delete(a);this._frameUpdates.delete(a)};Object.defineProperty(b.prototype,"fallbackTexture",{get:function(){h.isNone(this._fallbackTexture)&&(this._fallbackTexture=new d(this.rctx,this._fallbackTextureDesc,this._fallbackTextureData));return this._fallbackTexture},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fallbackTextureTransparent",{get:function(){h.isNone(this._fallbackTextureTransparent)&&(this._fallbackTextureTransparent=new d(this.rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData));return this._fallbackTextureTransparent},enumerable:!0,configurable:!0});return b}();b.TextureRepository=n;var k=function(){function a(){this._refCount=0;this.glTexture=null}Object.defineProperty(a.prototype,"isUnreferenced",{get:function(){return 0===
this._refCount},enumerable:!0,configurable:!0});a.prototype.ref=function(){++this._refCount};a.prototype.unref=function(){0===this._refCount?c.error("Cannot dereference texture that has no references!"):--this._refCount};return a}();b.RefCountedTexture=k})},"esri/views/3d/webgl-engine/materials/internal/WaterTextureRepository":function(){define("require exports tslib ../../../../../assets ../../../../../core/Accessor ../../../../../core/Logger ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators ../../../support/imageUtils ../../../../webgl/Texture".split(" "),
function(n,b,a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",{value:!0});var c=e.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");b.waveAndPertubationTextureUrls=[m.getAssetUrl("esri/images/materials/water/normals.jpg"),m.getAssetUrl("esri/images/materials/water/perturbation.jpg")];n=function(e){function h(){var a=null!==e&&e.apply(this,arguments)||this;a.data=[];a.loadingState=0;return a}a.__extends(h,e);h.prototype.dispose=function(){this.loadingState=0;this.data.forEach(function(a){a.dispose();
a=null});this.data=null};h.prototype.getTextureProps=function(a,b,c){void 0===c&&(c=!1);return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:10497,samplingMode:9987,hasMipmap:c,maxAnisotropy:8,width:a,height:b}};Object.defineProperty(h.prototype,"updating",{get:function(){return 1===this.loadingState},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"ready",{get:function(){return 2===this.loadingState},enumerable:!0,configurable:!0});h.prototype.loadTextures=function(a){var e=
this;this.loadingState=1;f.all(b.waveAndPertubationTextureUrls.map(function(a){return l.requestImage(a)})).then(function(b){b.forEach(function(b,c){e.data[c]=new d(a,e.getTextureProps(b.width,b.height,!0),b)});e.loadingState=2}).catch(function(a){c.error("Failed to load textures for water material.",a);e.loadingState=0})};h.prototype.bindRepo=function(a){for(var b=0;b<this.data.length;b++)a.bindTexture(this.data[b],b)};a.__decorate([g.property()],h.prototype,"loadingState",void 0);a.__decorate([g.property({type:Boolean,
readOnly:!0,dependsOn:["loadingState"]})],h.prototype,"updating",null);return h=a.__decorate([g.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],h)}(h);b.WaterTextureRepository=n})},"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("require exports tslib ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/vec4f64 ../lib/AutoDisposable ../../../support/screenshotUtils ../../../webgl/FramebufferObject".split(" "),
function(n,b,a,m,h,e,f,g,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function c(a,c,d,e,f,g){void 0===e&&(e=null);void 0===g&&(g=!0);var h=b.call(this)||this;h._rctx=a;h._renderScene=c;h._requestRenderScene=d;h._renderOverlay=e;h.forceCameraHook=f;h.supersample=g;h._screenshotQueue=[];return h}a.__extends(c,b);c.prototype.dispose=function(){this._rctx=null};c.prototype.takeScreenshot=function(a){this._requestRenderScene();var b=h.createResolver();this._screenshotQueue.push({settings:a,
resolver:b});return b.promise};c.prototype.update=function(b){if(0!==this._screenshotQueue.length){for(var c=0,d=this._screenshotQueue;c<d.length;c++){var e=d[c];if(this.isDisposed)e.resolver.reject();else{var f=a.__assign(a.__assign({},e.settings),{pixelRatio:e.settings.pixelRatio*b.viewCamera.pixelRatio}),h=this._ensureScreenshotEncodeCanvas(),k=this._renderScreenshot(b,f),f=g.encodeResult(k,f,h,{flipY:!0,premultipliedAlpha:!0});e.resolver(f)}}this._screenshotQueue=[]}};c.prototype._renderScreenshotOverlay=
function(a,b,c){if(!m.isNone(this._renderOverlay)){a.width=b.width;a.height=b.height;var d=a.getContext("2d"),e=c.pixelRatio;d.save();d.translate(0,b.height);d.scale(1,-1);c.region&&d.translate(-c.region.x,-c.region.y);d.scale(e,e);this._renderOverlay(a,b);d.restore()}};c.prototype._readbackScreenshot=function(a){return a.resample?this._readbackScreenshotResampled(a):this._readbackScreenshotImmediate(a)};c.prototype._readbackScreenshotResampled=function(b){var c=b.framebufferWidth,d=b.framebufferHeight,
e=b.region,f=b.resample,h=this._ensureScreenshotEncodeCanvas(),k=g.createEmptyImageData(c,d,h);this._rctx.gl.readPixels(0,0,c,d,6408,5121,new Uint8Array(k.data.buffer));this._renderScreenshotOverlay(h,k,a.__assign(a.__assign({},b),{region:null}));b=g.createEmptyImageData(e.width,e.height,h);return g.resampleHermite(k,b,!0,f.region.x,d-(f.region.y+f.region.height),f.region.width,f.region.height)};c.prototype._readbackScreenshotImmediate=function(a){var b=a.framebufferHeight,c=a.region,d=this._ensureScreenshotEncodeCanvas(),
e=g.createEmptyImageData(c.width,c.height,d);this._rctx.gl.readPixels(c.x,b-(c.y+c.height),c.width,c.height,6408,5121,new Uint8Array(e.data.buffer));this._renderScreenshotOverlay(d,e,a);return e};c.prototype._renderScreenshot=function(a,b){var c=null,d=a.viewCamera,f=b.framebufferWidth,g=b.framebufferHeight,h=!1;a=a.frameHasSlicePlane&&b.disableSlice;var k=b.ignorePadding&&d.pixelRatio!==b.pixelRatio;if(a=f!==d.fullWidth||g!==d.fullHeight||a||k){k=d.clone();if(b.ignorePadding){for(var c=e.vec4f64.clone(k.padding),
m=0;4>m;m++)c[m]=Math.round(c[m]/k.pixelRatio*b.pixelRatio);k.padding=c}k.fullWidth=f;k.fullHeight=g;k.pixelRatio=b.pixelRatio;c=d.fovX-k.fovX;f=d.fovY-k.fovY;0>c&&c<f?k.fovX=d.fovX:0>f&&f<c&&(k.fovY=d.fovY);this.forceCameraHook(k);h=!0;c=new l(this._rctx,{width:k.fullWidth,height:k.fullHeight,colorTarget:0,depthStencilTarget:3});this._renderScene(c,k,b.disableSlice)}b=this._readbackScreenshot(b);if(a&&!this._rctx.contextAttributes.alpha)for(m=3;m<b.data.length;m+=4)b.data[m]=255;c&&c.dispose();this._rctx.bindFramebuffer(null);
h&&this.forceCameraHook(d);return b};c.prototype._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};return c}(f.AutoDisposable);b.ScreenshotManager=n})},"esri/views/support/WebGLRequirements":function(){define(["require","exports","tslib","../../core/Error","../../core/has"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});var e={checkMajorWebPerformanceCaveat:!0};
b.check=function(b){b=a.__assign(a.__assign({},e),b);return h("esri-webgl")?b.checkMajorWebPerformanceCaveat&&h("esri-webgl-major-performance-caveat")?new m("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is blacklisted."):h("esri-webgl-high-precision-fragment")?h("esri-webgl-vertex-shader-samplers")?h("esri-webgl-element-index-uint")?h("esri-webgl-standard-derivatives")?h("esri-webgl-instanced-arrays")?
null:new m("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):new m("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):new m("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):new m("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new m("webgl:high-precision-fragment-required",
"WebGL support for high precision fragment shaders is required but not supported."):new m("webgl:required","WebGL is required but not supported.")}})},"esri/views/ui/3d/DefaultUI3D":function(){define(["require","exports","tslib","../../../core/accessorSupport/decorators","../DefaultUI"],function(n,b,a,m,h){return function(b){function e(a){a=b.call(this,a)||this;a.components=["attribution","zoom","navigation-toggle","compass"];return a}a.__extends(e,b);a.__decorate([m.property()],e.prototype,"components",
void 0);return e=a.__decorate([m.subclass("esri.views.ui.3d.DefaultUI3D")],e)}(h)})},"esri/views/ui/DefaultUI":function(){define("require exports tslib ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),function(n,b,a,m,h,e,f,g,l,d,c){return function(b){function f(a){a=b.call(this,a)||this;a._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",
zoom:"top-leading"};a.components=[];return a}a.__extends(f,b);f.prototype.initialize=function(){this._handles.add([m.init(this,"components",this._componentsWatcher.bind(this)),m.init(this,"view",this._updateViewAwareWidgets.bind(this))])};f.prototype._removeComponents=function(a){var b=this;a.forEach(function(a){if(a=b._find(a))b.remove(a),a.destroy()})};f.prototype._updateViewAwareWidgets=function(a){var b=this;this.components.forEach(function(c){(c=(c=b._find(c))&&c.widget)&&void 0!==c.view&&(c.view=
a)})};f.prototype._componentsWatcher=function(a,b){this._removeComponents(b);this._addComponents(a);this._adjustPadding(a)};f.prototype._adjustPadding=function(a){-1!==a.indexOf("attribution")||this._isOverridden("padding")||(this.padding=this.padding.top)};f.prototype._addComponents=function(a){var b=this;this.initialized&&a.forEach(function(a){return b.add(b._createComponent(a),b._defaultPositionLookup[a])})};f.prototype._createComponent=function(a){var b=this._createWidget(a);if(b)return new e({id:a,
node:b})};f.prototype._createWidget=function(a){if("attribution"===a)return this._createAttribution();if("compass"===a)return this._createCompass();if("navigation-toggle"===a)return this._createNavigationToggle();if("zoom"===a)return this._createZoom()};f.prototype._createAttribution=function(){return new g({view:this.view})};f.prototype._createCompass=function(){return new l({view:this.view})};f.prototype._createNavigationToggle=function(){return new d({view:this.view})};f.prototype._createZoom=
function(){return new c({view:this.view})};a.__decorate([h.property()],f.prototype,"components",void 0);return f=a.__decorate([h.subclass("esri.views.ui.DefaultUI")],f)}(f)})},"esri/views/ui/Component":function(){define("require exports tslib ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators".split(" "),function(n,b,a,m,h,e){return function(b){function f(){var a=null!==b&&b.apply(this,arguments)||this;a.widget=null;return a}a.__extends(f,b);f.prototype.destroy=function(){this.widget&&
this.widget.destroy();this.node=null};Object.defineProperty(f.prototype,"id",{get:function(){return this.get("widget.id")||this.get("node.id")},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"node",{set:function(a){var b=this._get("node");a!==b&&(a&&a.classList.add("esri-component"),b&&b.classList.remove("esri-component"),this._set("node",a))},enumerable:!0,configurable:!0});f.prototype.castNode=function(a){if(!a)return this._set("widget",null),null;if("string"===typeof a||a&&"nodeType"in
a)return this._set("widget",null),h.byId(a);a&&"function"===typeof a.render&&!a.domNode&&(a.domNode=document.createElement("div"));this._set("widget",a);return a.domNode};a.__decorate([e.property()],f.prototype,"id",null);a.__decorate([e.property()],f.prototype,"node",null);a.__decorate([e.cast("node")],f.prototype,"castNode",null);a.__decorate([e.property({readOnly:!0})],f.prototype,"widget",void 0);return f=a.__decorate([e.subclass("esri.views.ui.Component")],f)}(m)})},"esri/views/ui/UI":function(){define("require exports tslib ../../core/domUtils ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ../../widgets/support/widgetUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d){function c(a){return"object"!==typeof a||a instanceof l||"declaredClass"in a||!("component"in a||"index"in a||"position"in a)?null:a}function k(a,b){var c=b.bottom,d=b.left,e=b.right;a.style.top=b.top;a.style.bottom=c;a.style.left=d;a.style.right=e}var p={left:0,top:0,bottom:0,right:0},r={bottom:30,top:15,right:15,left:15};return function(b){function h(a){a=b.call(this,a)||this;a._cornerNameToContainerLookup={};a._positionNameToContainerLookup={};a._components=[];a._componentToKey=
new Map;a._handles=new e;a.view=null;a._initContainers();return a}a.__extends(h,b);h.prototype.initialize=function(){this._handles.add([f.init(this,"view.padding, container",this._applyViewPadding.bind(this)),f.init(this,"padding",this._applyUIPadding.bind(this))])};h.prototype.destroy=function(){this.container=null;for(var a=0,b=this._components;a<b.length;a++)b[a].destroy();this._components.length=0;this._handles.destroy();this._componentToKey.clear()};Object.defineProperty(h.prototype,"container",
{set:function(a){var b=this._get("container");a!==b&&(a&&(a.classList.add("esri-ui"),this._attachContainers(a)),b&&(b.classList.remove("esri-ui"),k(b,{top:"",bottom:"",left:"",right:""}),m.empty(b)),this._set("container",a))},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"height",{get:function(){var a=this.get("view.height")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.top+b.bottom),0)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,
"padding",{get:function(){return this._get("padding")},set:function(a){a?this._override("padding",a):this._clearOverride("padding")},enumerable:!0,configurable:!0});h.prototype.castPadding=function(b){return"number"===typeof b?{bottom:b,top:b,right:b,left:b}:a.__assign(a.__assign({},r),b)};Object.defineProperty(h.prototype,"width",{get:function(){var a=this.get("view.width")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.left+b.right),0)},enumerable:!0,configurable:!0});h.prototype.add=
function(a,b){var d=this,e,f;if(Array.isArray(a))a.forEach(function(a){return d.add(a,b)});else{var g=c(a);g&&(e=g.index,b=g.position,a=g.component,f=g.key);b&&"object"===typeof b&&(e=b.index,f=b.key,b=b.position);!a||b&&!this._isValidPosition(b)||(a instanceof l||(a=new l({node:a})),this._place({component:a,position:b,index:e}),this._components.push(a),f&&this._componentToKey.set(a,f))}};h.prototype.remove=function(a,b){var c=this;if(a){if(Array.isArray(a))return a.map(function(a){return c.remove(a,
b)});var d=this._find(a);if(d){var e=this._componentToKey;if(!e.has(a)||e.get(a)===b)return e=this._components.indexOf(d),d.node.parentNode&&d.node.parentNode.removeChild(d.node),this._componentToKey.delete(a),this._components.splice(e,1)[0]}}};h.prototype.empty=function(a){var b=this;if(Array.isArray(a))return a.map(function(a){return b.empty(a)}).reduce(function(a,b){return a.concat(b)});a=a||"manual";return"manual"===a?Array.prototype.slice.call(this._manualContainer.children).filter(function(a){return!a.classList.contains("esri-ui-corner")}).map(function(a){return b.remove(a)}):
this._isValidPosition(a)?Array.prototype.slice.call(this._cornerNameToContainerLookup[a].children).map(this.remove,this):null};h.prototype.move=function(a,b){var d=this;Array.isArray(a)&&a.forEach(function(a){return d.move(a,b)});if(a){var e,f=c(a)||c(b);f&&(e=f.index,b=f.position,a=f.component||a);(!b||this._isValidPosition(b))&&(a=this.remove(a))&&this.add(a,{position:b,index:e})}};h.prototype.find=function(a){return a?(a=this._findById(a))&&(a.widget||a.node):null};h.prototype._find=function(a){return a?
a instanceof l?this._findByComponent(a):"string"===typeof a?this._findById(a):this._findByNode(a.domNode||a):null};h.prototype._getViewPadding=function(){return this.get("view.padding")||p};h.prototype._attachContainers=function(a){a.appendChild(this._innerContainer);a.appendChild(this._manualContainer)};h.prototype._initContainers=function(){var b=document.createElement("div");b.classList.add("esri-ui-inner-container");b.classList.add("esri-ui-corner-container");var c=document.createElement("div");
c.classList.add("esri-ui-inner-container");c.classList.add("esri-ui-manual-container");var e=document.createElement("div");e.classList.add("esri-ui-top-left");e.classList.add("esri-ui-corner");b.appendChild(e);var f=document.createElement("div");f.classList.add("esri-ui-top-right");f.classList.add("esri-ui-corner");b.appendChild(f);var g=document.createElement("div");g.classList.add("esri-ui-bottom-left");g.classList.add("esri-ui-corner");b.appendChild(g);var h=document.createElement("div");h.classList.add("esri-ui-bottom-right");
h.classList.add("esri-ui-corner");b.appendChild(h);this._innerContainer=b;this._manualContainer=c;b=d.isRTL();this._cornerNameToContainerLookup={"top-left":e,"top-right":f,"bottom-left":g,"bottom-right":h,"top-leading":b?f:e,"top-trailing":b?e:f,"bottom-leading":b?h:g,"bottom-trailing":b?g:h};this._positionNameToContainerLookup=a.__assign({manual:c},this._cornerNameToContainerLookup)};h.prototype._isValidPosition=function(a){return!!this._positionNameToContainerLookup[a]};h.prototype._place=function(a){var b=
a.component,c=a.index;a=this._positionNameToContainerLookup[a.position||"manual"];var d=-1<c,e=b.widget;e&&!e._started&&"function"===typeof e.postMixInProperties&&"function"===typeof e.buildRendering&&"function"===typeof e.postCreate&&"function"===typeof e.startup&&b.widget.startup();d?(d=Array.prototype.slice.call(a.children),0===c?a.firstChild?m.insertBefore(b.node,a.firstChild):a.appendChild(b.node):c>=d.length?a.appendChild(b.node):m.insertBefore(b.node,d[c])):a.appendChild(b.node)};h.prototype._applyViewPadding=
function(){var a=this.container;a&&k(a,this._toPxPosition(this._getViewPadding()))};h.prototype._applyUIPadding=function(){var a=this._innerContainer;a&&k(a,this._toPxPosition(this.padding))};h.prototype._toPxPosition=function(a){return{top:this._toPxUnit(a.top),left:this._toPxUnit(a.left),right:this._toPxUnit(a.right),bottom:this._toPxUnit(a.bottom)}};h.prototype._toPxUnit=function(a){return 0===a?"0":a+"px"};h.prototype._findByComponent=function(a){var b=null,c;this._components.some(function(d){(c=
d===a)&&(b=d);return c});return b};h.prototype._findById=function(a){var b=null,c;this._components.some(function(d){(c=d.id===a)&&(b=d);return c});return b};h.prototype._findByNode=function(a){var b=null,c;this._components.some(function(d){(c=d.node===a)&&(b=d);return c});return b};a.__decorate([g.property()],h.prototype,"container",null);a.__decorate([g.property({dependsOn:["view.height"]})],h.prototype,"height",null);a.__decorate([g.property({value:r})],h.prototype,"padding",null);a.__decorate([g.cast("padding")],
h.prototype,"castPadding",null);a.__decorate([g.property()],h.prototype,"view",void 0);a.__decorate([g.property({dependsOn:["view.width"]})],h.prototype,"width",null);return h=a.__decorate([g.subclass("esri.views.ui.UI")],h)}(h.EventedAccessor)})},"esri/widgets/Attribution":function(){define("require exports tslib ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Attribution/AttributionViewModel ./support/widget".split(" "),function(n,b,a,m,h,e,f,g){return function(b){function d(a,
d){a=b.call(this,a,d)||this;a._isOpen=!1;a._attributionTextOverflowed=!1;a._prevSourceNodeHeight=0;a.iconClass="esri-icon-description";a.itemDelimiter=" | ";a.label=void 0;a.messages=null;a.view=null;a.viewModel=new f;return a}a.__extends(d,b);d.prototype.initialize=function(){var a=this;this.own(m.on(this,"viewModel.items","change",function(){return a.scheduleRender()}))};Object.defineProperty(d.prototype,"attributionText",{get:function(){return this.viewModel.items.reduce(function(a,b){-1===a.indexOf(b.text)&&
a.push(b.text);return a},[]).join(this.itemDelimiter)},enumerable:!0,configurable:!0});d.prototype.render=function(){var a,b=(a={},a["esri-attribution--open"]=this._isOpen,a);return g.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",b),onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())};d.prototype.renderPoweredBy=function(){return g.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",g.tsx("a",{class:this.classes("esri-attribution__link",
"esri-widget__anchor"),href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))};d.prototype.renderSourcesNode=function(){var a,b=this._isOpen,d=this._isInteractive(),e=d?0:-1,f=this.attributionText,h=d?"button":void 0,b=(a={},a["esri-attribution__sources--open"]=b,a["esri-interactive"]=d,a);return g.tsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",b),innerHTML:f,role:h,tabIndex:e})};
d.prototype._afterSourcesNodeCreate=function(a){this._prevSourceNodeHeight=a.clientWidth};d.prototype._afterSourcesNodeUpdate=function(a){var b=!1,c=a.clientHeight;a=a.scrollWidth>=a.clientWidth;var d=this._attributionTextOverflowed!==a;this._attributionTextOverflowed=a;d&&(b=!0);this._isOpen&&(a=c<this._prevSourceNodeHeight,this._prevSourceNodeHeight=c,a&&(this._isOpen=!1,b=!0));b&&this.scheduleRender()};d.prototype._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)};d.prototype._isInteractive=
function(){return this._isOpen||this._attributionTextOverflowed};a.__decorate([h.property({dependsOn:["viewModel.items.length","itemDelimiter"],readOnly:!0}),g.renderable()],d.prototype,"attributionText",null);a.__decorate([h.property()],d.prototype,"iconClass",void 0);a.__decorate([h.property(),g.renderable()],d.prototype,"itemDelimiter",void 0);a.__decorate([h.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],d.prototype,"label",void 0);a.__decorate([h.property(),g.renderable(),
g.messageBundle("esri/widgets/Attribution/t9n/Attribution")],d.prototype,"messages",void 0);a.__decorate([h.aliasOf("viewModel.view")],d.prototype,"view",void 0);a.__decorate([h.property({type:f}),g.renderable(["state","view.size"])],d.prototype,"viewModel",void 0);a.__decorate([g.accessibleHandler()],d.prototype,"_toggleState",null);return d=a.__decorate([h.subclass("esri.widgets.Attribution")],d)}(e)})},"esri/widgets/Attribution/AttributionViewModel":function(){define("require exports tslib ../../geometry ../../core/arrayUtils ../../core/asyncUtils ../../core/Collection ../../core/HandleOwner ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k){function p(a,b){return a.length!==b.length||a.some(function(a,c){return a.text!==b[c].text})}function r(a,b,c){c&&b&&(h.find(a,function(a){return a.layerView===b&&a.text===c})||a.push({text:c,layerView:b}))}var t=[];return function(b){function g(a){var c=b.call(this,a)||this;c.clear=function(){c._fetchedAttributionData.clear();c._pendingAttributions.clear();c.handles.remove("suspension");c.notifyChange("state")};c._pendingAttributions=new Set;c._fetchedAttributionData=
new Map;c.items=new f;c.view=null;c._allLayerViewsChange=function(a){c.handles.remove("suspension");var b=c.get("view.allLayerViews");b&&c.handles.add(b.map(function(a){return a.watch(["suspended","attributionVisible"],c._updateAttributionItems)}),"suspension");a&&a.removed&&a.removed.forEach(function(a){c._pendingAttributions.delete(a);c._fetchedAttributionData.delete(a)});c._updateAttributionItems()};c._updateAttributionItems=function(){var a=c.get("view.allLayerViews");t.length=0;a?(a.forEach(function(a){if(!a.suspended&&
a.get("layer.attributionVisible")){var b=a.layer;if(b&&"copyright"in b&&"function"===typeof b.originOf&&"user"===b.originOf("copyright"))r(t,a,b.copyright);else if(b.hasAttributionData)if(c._fetchedAttributionData.has(a)){var d=c._fetchedAttributionData.get(a);d&&r(t,a,c._getDynamicAttribution(d,c.view,b))}else c._fetchAttributionData(a);else(d=b.get("portalItem.accessInformation"))?r(t,a,d):r(t,a,b.copyright)}}),p(c.items,t)&&(c.items.removeAll(),c.items.addMany(t)),c.notifyChange("state")):c.clear()};
c.handles.add([l.on(c,"view.allLayerViews","change",c._allLayerViewsChange,c._allLayerViewsChange,c.clear),l.whenTrue(c,"view.stationary",function(){return c._updateAttributionItems()})]);return c}a.__extends(g,b);g.prototype.destroy=function(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear()};Object.defineProperty(g.prototype,"state",{get:function(){return this.get("view.ready")?0<this._pendingAttributions.size?"loading":"ready":"disabled"},enumerable:!0,configurable:!0});
g.prototype._fetchAttributionData=function(b){return a.__awaiter(this,void 0,void 0,function(){var c,d;return a.__generator(this,function(a){switch(a.label){case 0:if(this._pendingAttributions.has(b))return[2];this._pendingAttributions.add(b);return[4,e.result(b.layer.fetchAttributionData())];case 1:return c=a.sent(),this._pendingAttributions.has(b)&&(d=c.ok?this._createContributionIndex(c.value,"bing-maps"===b.layer.type):null,this._pendingAttributions.delete(b),this._fetchedAttributionData.set(b,
d)),this._updateAttributionItems(),[2]}})})};g.prototype._createContributionIndex=function(a,b){a=a.contributors;var c={};if(!a)return c;for(var d=0;d<a.length;d++){var e=a[d],f=e.coverageAreas;if(!f)return;for(var g=0;g<f.length;g++)for(var h=f[g],l=h.bbox,p=h.zoomMin-(b&&h.zoomMin?1:0),n=h.zoomMax-(b&&h.zoomMax?1:0),h={extent:k.geographicToWebMercator({xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:m.SpatialReference.WGS84}),attribution:e.attribution||"",score:null!=h.score?h.score:100,
id:d};p<=n;p++)c[p]=c[p]||[],c[p].push(h)}c.maxKey=Math.max.apply(null,Object.keys(c));return c};g.prototype._getDynamicAttribution=function(a,b,d){var e=b.extent;d=d.tileInfo.scaleToZoom(b.scale);d=Math.min(a.maxKey,Math.round(d));if(!e||null==d||-1>=d)return"";a=a[d];var f=k.project(e.center.clone().normalize(),b.spatialReference),g={};return a?a.filter(function(a){var b=!g[a.id]&&f&&c.extentContainsPoint(a.extent,f);b&&(g[a.id]=!0);return b}).sort(function(a,b){return b.score-a.score||a.objectId-
b.objectId}).map(function(a){return a.attribution}).join(", "):""};a.__decorate([d.property({readOnly:!0,type:f})],g.prototype,"items",void 0);a.__decorate([d.property({dependsOn:["view.ready"],readOnly:!0})],g.prototype,"state",null);a.__decorate([d.property()],g.prototype,"view",void 0);return g=a.__decorate([d.subclass("esri.widgets.Attribution.AttributionViewModel")],g)}(g.HandleOwner)})},"esri/widgets/Compass":function(){define("require exports tslib ../core/accessorSupport/decorators ./Widget ./Compass/CompassViewModel ./support/widget".split(" "),
function(n,b,a,m,h,e,f){return function(b){function g(a,c){a=b.call(this,a,c)||this;a.goToOverride=null;a.iconClass="esri-icon-locate-circled";a.label=void 0;a.messages=null;a.view=null;a.viewModel=new e;return a}a.__extends(g,b);g.prototype.reset=function(){};g.prototype.render=function(){var a,b,e=this.viewModel,g=e.orientation,e=e.state,h="disabled"===e,l="compass"===("rotation"===e?"rotation":"compass"),e=h?-1:0,h=(a={},a["esri-disabled"]=h,a["esri-interactive"]=!h,a);a=(b={},b["esri-icon-compass"]=
l,b["esri-icon-dial"]=!l,b);b=this.messages;return f.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",h),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:e,"aria-label":b.reset,title:b.reset},f.tsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",a),styles:this._toRotationTransform(g)}),f.tsx("span",{class:"esri-icon-font-fallback-text"},b.reset))};g.prototype._reset=function(){this.viewModel.reset()};g.prototype._toRotationTransform=
function(a){return{transform:"rotateZ("+a.z+"deg)"}};a.__decorate([m.aliasOf("viewModel.goToOverride")],g.prototype,"goToOverride",void 0);a.__decorate([m.property()],g.prototype,"iconClass",void 0);a.__decorate([m.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],g.prototype,"label",void 0);a.__decorate([m.property(),f.renderable(),f.messageBundle("esri/widgets/Compass/t9n/Compass")],g.prototype,"messages",void 0);a.__decorate([m.aliasOf("viewModel.view")],g.prototype,"view",void 0);
a.__decorate([m.property({type:e}),f.renderable(["viewModel.orientation","viewModel.state"])],g.prototype,"viewModel",void 0);a.__decorate([m.aliasOf("viewModel.reset")],g.prototype,"reset",null);a.__decorate([f.accessibleHandler()],g.prototype,"_reset",null);return g=a.__decorate([m.subclass("esri.widgets.Compass")],g)}(h)})},"esri/widgets/Compass/CompassViewModel":function(){define("require exports tslib ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ../support/GoTo".split(" "),
function(n,b,a,m,h,e,f,g){return function(b){function d(a){a=b.call(this,a)||this;a._handles=new h;a.orientation={x:0,y:0,z:0};a.view=null;a._updateForCamera=a._updateForCamera.bind(a);a._updateForRotation=a._updateForRotation.bind(a);a._updateRotationWatcher=a._updateRotationWatcher.bind(a);a.view;return a}a.__extends(d,b);d.prototype.initialize=function(){this._handles.add(e.init(this,"view",this._updateRotationWatcher))};d.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=
null};Object.defineProperty(d.prototype,"canShowNorth",{get:function(){var a=this.get("view.spatialReference");return!(!a||!a.isWebMercator&&!a.isGeographic)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"state",{get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"},enumerable:!0,configurable:!0});d.prototype.reset=function(){if(this.get("view.ready")){var a={};"2d"===this.view.type?a.rotation=0:a.heading=0;this.callGoTo({target:a})}};
d.prototype._updateForRotation=function(a){void 0!==a&&null!==a&&(this.orientation={z:a})};d.prototype._updateForCamera=function(a){a&&(this.orientation={x:0,y:0,z:-a.heading})};d.prototype._updateRotationWatcher=function(a){this._handles.removeAll();a&&("2d"===a.type?this._handles.add(e.init(this,"view.rotation",this._updateForRotation)):this._handles.add(e.init(this,"view.camera",this._updateForCamera)))};a.__decorate([f.property({dependsOn:["view.spatialReference.isWebMercator","view.spatialReference.wkid"],
readOnly:!0})],d.prototype,"canShowNorth",null);a.__decorate([f.property()],d.prototype,"orientation",void 0);a.__decorate([f.property({dependsOn:["view.ready","canShowNorth"],readOnly:!0})],d.prototype,"state",null);a.__decorate([f.property()],d.prototype,"view",void 0);a.__decorate([f.property()],d.prototype,"reset",null);return d=a.__decorate([f.subclass("esri.widgets.CompassViewModel")],d)}(g.GoToMixin(m))})},"esri/widgets/NavigationToggle":function(){define("require exports tslib ../core/accessorSupport/decorators ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/widget".split(" "),
function(n,b,a,m,h,e,f){return function(b){function g(a,c){a=b.call(this,a,c)||this;a.iconClass="esri-icon-pan2";a.label=void 0;a.messages=null;a.view=null;a.viewModel=new e;return a}a.__extends(g,b);Object.defineProperty(g.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});g.prototype.toggle=function(){};g.prototype.render=function(){var a,b,e,g="disabled"===this.get("viewModel.state"),h="pan"===this.get("viewModel.navigationMode"),
l=(a={},a["esri-disabled"]=g,a["esri-navigation-toggle--horizontal"]="horizontal"===this.layout,a);a=(b={},b["esri-navigation-toggle__button--active"]=h,b);b=(e={},e["esri-navigation-toggle__button--active"]=!h,e);e=g?-1:0;g=this.messages.toggle;return f.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",l),onclick:this._toggle,onkeydown:this._toggle,tabIndex:e,"aria-label":g,title:g},f.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",
a)},f.tsx("span",{class:"esri-icon-pan"})),f.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--rotate",b)},f.tsx("span",{class:"esri-icon-rotate"})))};g.prototype._toggle=function(){this.toggle()};a.__decorate([m.property()],g.prototype,"iconClass",void 0);a.__decorate([m.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],g.prototype,"label",void 0);a.__decorate([m.property({value:"vertical"}),f.renderable()],g.prototype,
"layout",null);a.__decorate([m.property(),f.renderable(),f.messageBundle("esri/widgets/NavigationToggle/t9n/NavigationToggle")],g.prototype,"messages",void 0);a.__decorate([m.aliasOf("viewModel.view"),f.renderable()],g.prototype,"view",void 0);a.__decorate([m.property({type:e}),f.renderable(["viewModel.state","viewModel.navigationMode"])],g.prototype,"viewModel",void 0);a.__decorate([m.aliasOf("viewModel.toggle")],g.prototype,"toggle",null);a.__decorate([f.accessibleHandler()],g.prototype,"_toggle",
null);return g=a.__decorate([m.subclass("esri.widgets.NavigationToggle")],g)}(h)})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("require exports tslib ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),function(n,b,a,m,h,e,f){return function(b){function g(a){a=b.call(this,a)||this;a._handles=new h;a.navigationMode="pan";a.view=null;a.toggle=a.toggle.bind(a);return a}a.__extends(g,b);g.prototype.initialize=
function(){this._handles.add(e.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};g.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(g.prototype,"state",{get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"},enumerable:!0,configurable:!0});g.prototype.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};g.prototype._setNavigationMode=
function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};a.__decorate([f.property({dependsOn:["view.ready"],readOnly:!0})],g.prototype,"state",null);a.__decorate([f.property()],g.prototype,"navigationMode",void 0);a.__decorate([f.property()],g.prototype,"view",void 0);a.__decorate([f.property()],g.prototype,"toggle",null);return g=a.__decorate([f.subclass("esri.widgets.NavigationToggleViewModel")],g)}(m)})},"esri/widgets/Zoom":function(){define("require exports tslib ../core/accessorSupport/decorators ./Widget ./support/widget ./Zoom/IconButton ./Zoom/ZoomViewModel".split(" "),
function(n,b,a,m,h,e,f,g){return function(b){function d(a,d){a=b.call(this,a,d)||this;a.iconClass="esri-icon-zoom-in-magnifying-glass";a.label=void 0;a.messages=null;a.view=null;a.viewModel=new g;return a}a.__extends(d,b);d.prototype.initialize=function(){this._zoomInButton=new f({action:this.zoomIn,iconClass:"esri-icon-plus"});this._zoomOutButton=new f({action:this.zoomOut,iconClass:"esri-icon-minus"})};d.prototype.destroy=function(){this._zoomInButton.destroy();this._zoomOutButton.destroy();this._zoomOutButton=
this._zoomInButton=null};Object.defineProperty(d.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});d.prototype.render=function(){var a,b=this.viewModel,d=(a={},a["esri-zoom--horizontal"]="horizontal"===this.layout,a);this._zoomInButton.enabled="ready"===b.state&&b.canZoomIn;this._zoomOutButton.enabled="ready"===b.state&&b.canZoomOut;this._zoomInButton.title=this.messages.zoomIn;this._zoomOutButton.title=this.messages.zoomOut;
return e.tsx("div",{class:this.classes("esri-zoom esri-widget",d)},this._zoomInButton.render(),this._zoomOutButton.render())};d.prototype.zoomIn=function(){};d.prototype.zoomOut=function(){};a.__decorate([m.property()],d.prototype,"iconClass",void 0);a.__decorate([m.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],d.prototype,"label",void 0);a.__decorate([m.property({value:"vertical"}),e.renderable()],d.prototype,"layout",null);a.__decorate([m.property(),e.renderable(),e.messageBundle("esri/widgets/Zoom/t9n/Zoom")],
d.prototype,"messages",void 0);a.__decorate([m.aliasOf("viewModel.view"),e.renderable()],d.prototype,"view",void 0);a.__decorate([m.property({type:g}),e.renderable(["viewModel.canZoomIn","viewModel.canZoomOut","viewModel.state"])],d.prototype,"viewModel",void 0);a.__decorate([m.aliasOf("viewModel.zoomIn")],d.prototype,"zoomIn",null);a.__decorate([m.aliasOf("viewModel.zoomOut")],d.prototype,"zoomOut",null);return d=a.__decorate([m.subclass("esri.widgets.Zoom")],d)}(h)})},"esri/widgets/Zoom/IconButton":function(){define("require exports tslib ../../core/accessorSupport/decorators ../Widget ../support/widget".split(" "),
function(n,b,a,m,h,e){return function(b){function f(){var a=null!==b&&b.apply(this,arguments)||this;a.enabled=!0;a.iconClass="";a.title="";return a}a.__extends(f,b);f.prototype.render=function(){var a,b,c=this.enabled?0:-1,f=(a={},a["esri-disabled"]=!this.enabled,a["esri-interactive"]=this.enabled,a);a=(b={},b[this.iconClass]=!!this.iconClass,b);return e.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",f),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",
tabIndex:c,title:this.title},e.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",a)}),e.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};f.prototype._triggerAction=function(){this.action.call(this)};a.__decorate([m.property()],f.prototype,"action",void 0);a.__decorate([m.property(),e.renderable()],f.prototype,"enabled",void 0);a.__decorate([m.property(),e.renderable()],f.prototype,"iconClass",void 0);a.__decorate([m.property(),e.renderable()],f.prototype,
"title",void 0);a.__decorate([e.accessibleHandler()],f.prototype,"_triggerAction",null);return f=a.__decorate([m.subclass("esri.widgets.IconButton")],f)}(h)})},"esri/widgets/Zoom/ZoomViewModel":function(){define("require exports tslib ../../core/Accessor ../../core/promiseUtils ../../core/accessorSupport/decorators ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(n,b,a,m,h,e,f,g){return function(b){function d(a){a=b.call(this,a)||this;a.canZoomIn=!1;a.canZoomOut=!1;a.zoomIn=a.zoomIn.bind(a);
a.zoomOut=a.zoomOut.bind(a);return a}a.__extends(d,b);d.prototype.destroy=function(){this.view=null};Object.defineProperty(d.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"view",{set:function(a){a?"2d"===a.type?this._zoomConditions=new f({view:a}):"3d"===a.type&&(this._zoomConditions=new g({view:a})):this._zoomConditions=null;this._set("view",a)},enumerable:!0,configurable:!0});d.prototype.zoomIn=
function(){if(this.canZoomIn){var a=this.view;"2d"===a.type?a.mapViewNavigation.zoomIn():h.ignoreAbortErrors(a.goTo({zoomFactor:2}))}};d.prototype.zoomOut=function(){if(this.canZoomOut){var a=this.view;"2d"===a.type?a.mapViewNavigation.zoomOut():h.ignoreAbortErrors(a.goTo({zoomFactor:.5}))}};a.__decorate([e.property()],d.prototype,"_zoomConditions",void 0);a.__decorate([e.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],d.prototype,"canZoomIn",void 0);a.__decorate([e.property({aliasOf:"_zoomConditions.canZoomOut",
readOnly:!0})],d.prototype,"canZoomOut",void 0);a.__decorate([e.property({dependsOn:["view.ready"],readOnly:!0})],d.prototype,"state",null);a.__decorate([e.property()],d.prototype,"view",null);a.__decorate([e.property()],d.prototype,"zoomIn",null);a.__decorate([e.property()],d.prototype,"zoomOut",null);return d=a.__decorate([e.subclass("esri.widgets.Zoom.ZoomViewModel")],d)}(m)})},"esri/widgets/Zoom/ZoomConditions2D":function(){define(["require","exports","tslib","../../core/Accessor","../../core/accessorSupport/decorators"],
function(n,b,a,m,h){return function(b){function e(){return null!==b&&b.apply(this,arguments)||this}a.__extends(e,b);Object.defineProperty(e.prototype,"canZoomIn",{get:function(){if(!this.get("view.ready"))return!1;var a=this.get("view.animation.target.scale")||this.get("view.scale"),b=this.get("view.constraints.effectiveMaxScale");return 0===b||a>b},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"canZoomOut",{get:function(){if(!this.get("view.ready"))return!1;var a=this.get("view.animation.target.scale")||
this.get("view.scale"),b=this.get("view.constraints.effectiveMinScale");return 0===b||a<b},enumerable:!0,configurable:!0});a.__decorate([h.property({dependsOn:["view.ready","view.scale","view.animation.target.scale","view.constraints.effectiveMaxScale"],readOnly:!0})],e.prototype,"canZoomIn",null);a.__decorate([h.property({dependsOn:["view.ready","view.scale","view.animation.target.scale","view.constraints.effectiveMinScale"],readOnly:!0})],e.prototype,"canZoomOut",null);a.__decorate([h.property()],
e.prototype,"view",void 0);return e=a.__decorate([h.subclass("esri.widgets.Zoom.ZoomConditions2D")],e)}(m)})},"esri/widgets/Zoom/ZoomConditions3D":function(){define(["require","exports","tslib","../../core/Accessor","../../core/accessorSupport/decorators"],function(n,b,a,m,h){return function(b){function e(){return null!==b&&b.apply(this,arguments)||this}a.__extends(e,b);Object.defineProperty(e.prototype,"canZoomIn",{get:function(){return!!this.get("view.ready")},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,
"canZoomOut",{get:function(){return!!this.get("view.ready")},enumerable:!0,configurable:!0});a.__decorate([h.property({dependsOn:["view.ready"],readOnly:!0})],e.prototype,"canZoomIn",null);a.__decorate([h.property({dependsOn:["view.ready"],readOnly:!0})],e.prototype,"canZoomOut",null);a.__decorate([h.property()],e.prototype,"view",void 0);return e=a.__decorate([h.subclass("esri.widgets.Zoom.ZoomConditions3D")],e)}(m)})},"esri/layers/SceneLayer":function(){define("require exports tslib ../PopupTemplate ../renderers ../request ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/watchUtils ../core/accessorSupport/decorators ../core/accessorSupport/utils ./Layer ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./support/commonProperties ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/FetchAssociatedFeatureLayer ./support/fieldProperties ./support/FieldsIndex ./support/fieldUtils ./support/I3SLayerDefinitions ./support/LabelClass ./support/labelingInfo ./support/RangeInfo ../renderers/support/jsonUtils ../renderers/support/styleUtils ../support/popupUtils ../tasks/support/Query @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L,M,N,Q,R,W,O){function U(a,b,c){a&&((a=Q.read(a,b,c)||void 0)||ba.error("Failed to create renderer",{rendererDefinition:a,layer:this,context:c}));return a}var P=["3DObject","Point"],ba=g.getLogger("esri.layers.SceneLayer"),V=I.defineFieldProperties(),T={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",
polygons:"polygons","features-polygons":"polygons"},X={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return function(b){function d(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];a=b.apply(this,a)||this;a.featureReduction=null;a.rangeInfos=null;a.operationalLayerType="ArcGISSceneServiceLayer";a.type="scene";a.fields=null;a.outFields=null;a.nodePages=null;a.materialDefinitions=null;a.textureSetDefinitions=null;a.geometryDefinitions=null;a.serviceUpdateTimeStamp=
null;a.definitionExpression=null;a.path=null;a.labelsVisible=!0;a.labelingInfo=null;a.legendEnabled=!0;a.cachedDrawingInfo={color:!1};a.popupEnabled=!0;a.popupTemplate=null;a.objectIdField=null;a.objectIdFilter=null;a._fieldUsageInfo={};a.screenSizePerspectiveEnabled=!0;return a}a.__extends(d,b);d.prototype.normalizeCtorArgs=function(b,c){return"string"===typeof b?a.__assign({url:b},c):b};d.prototype.getField=function(a){return this.fieldsIndex.get(a)};d.prototype.getFieldDomain=function(a){return(a=
this.getField(a))&&a.domain?a.domain:null};Object.defineProperty(d.prototype,"fieldsIndex",{get:function(){return new G(this.fields)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"elevationInfo",{set:function(a){this._set("elevationInfo",a);this.loaded&&this._validateElevationInfo()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"geometryType",{get:function(){return X[this.profile]||"mesh"},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"renderer",{set:function(a){J.fixRendererFields(a,this.fields);this._set("renderer",a)},enumerable:!0,configurable:!0});d.prototype.readCachedDrawingInfo=function(a){if(null==a||"object"!==typeof a)a={};null==a.color&&(a.color=!1);return a};Object.defineProperty(d.prototype,"defaultPopupTemplate",{get:function(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null},enumerable:!0,configurable:!0});d.prototype.readObjectIdField=function(a,b){!a&&b.fields&&b.fields.some(function(b){"esriFieldTypeOID"===
b.type&&(a=b.name);return!!a});return a||void 0};d.prototype.readProfile=function(a,b){a=b.store.profile;if(null!=a&&T[a])return T[a];ba.error("Unknown or missing profile",{profile:a,layer:this});return"mesh-pyramids"};d.prototype.load=function(a){var b=this,d=l.isSome(a)?a.signal:null;a=this.loadFromPortal({supportedTypes:["Scene Service"]},a).then(function(){return b._fetchService(d)},function(){return b._fetchService(d)}).then(function(){return c.all([b._verifyRootNodeAndUpdateExtent(b.nodePages,
d),b._setAssociatedFeatureLayer(d)])}).then(function(){return b._validateElevationInfo()}).then(function(){return b._applyAssociatedLayerOverrides()}).then(function(){return b._populateFieldUsageInfo()}).then(function(){return R.loadStyleRenderer(b,{origin:"service"},d)}).then(function(){return J.fixRendererFields(b.renderer,b.fields)});this.addResolvingPromise(a);return c.resolve(this)};d.prototype.createQuery=function(){var a=new O;"mesh"!==this.geometryType&&(a.returnGeometry=!0,a.returnZ=!0);
a.where=this.definitionExpression||"1\x3d1";a.sqlFormat="standard";return a};d.prototype.queryExtent=function(a,b){var c=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryExtent(a||c.createQuery(),b)})};d.prototype.queryFeatureCount=function(a,b){var c=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryFeatureCount(a||c.createQuery(),b)})};d.prototype.queryFeatures=function(a,b){var c=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryFeatures(a||
c.createQuery(),b)}).then(function(a){if(a&&a.features)for(var b=0,d=a.features;b<d.length;b++){var e=d[b];e.layer=c;e.sourceLayer=c}return a})};d.prototype.queryObjectIds=function(a,b){var c=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryObjectIds(a||c.createQuery(),b)})};d.prototype.getFieldUsageInfo=function(a){var b={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[a]||b:(ba.error("#getFieldUsageInfo()",
"Unavailable until layer is loaded"),b)};d.prototype.createPopupTemplate=function(a){return W.createPopupTemplate(this,a)};d.prototype._getAssociatedLayerForQuery=function(){var a=this;if(!this.loaded)return this.load().then(function(){return a._getAssociatedLayerForQuery()});var b=this.associatedLayer;return null!=b?c.resolve(b):c.reject(new f("scenelayer:query-not-available","SceneLayer queries are not available without associated feature layer"))};d.prototype.hasCachedStatistics=function(a){return null!=
this.statisticsInfo&&this.statisticsInfo.some(function(b){return b.name===a})};d.prototype.queryCachedStatistics=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var d,g,h,l,m;return a.__generator(this,function(a){switch(a.label){case 0:return[4,this.load(c)];case 1:a.sent();if(!this.statisticsInfo)throw new f("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");d=this.fieldsIndex.get(b);if(!d)throw new f("scenelayer:field-unexisting","Field '"+b+"' does not exist on the layer");
g=0;for(h=this.statisticsInfo;g<h.length;g++)if(l=h[g],l.name===d.name)return m=k.join(this.parsedUrl.path,l.href),[2,e(m,{query:{f:"json"},responseType:"json",signal:c?c.signal:null}).then(function(a){return a.data})];throw new f("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available");}})})};d.prototype.saveAs=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var d=this;return a.__generator(this,function(e){return[2,this._saveAs(b,a.__assign(a.__assign({},
c),{getTypeKeywords:function(){return d._getTypeKeywords()},portalItemLayerType:"scene"}))]})})};d.prototype.save=function(){return a.__awaiter(this,void 0,void 0,function(){var b,c=this;return a.__generator(this,function(a){b={getTypeKeywords:function(){return c._getTypeKeywords()},portalItemLayerType:"scene"};return[2,this._save(b)]})})};d.prototype.validateLayer=function(a){if(a.layerType&&-1===P.indexOf(a.layerType))throw new f("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",
{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new f("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new f("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});a=this.normalReferenceFrame;var b=this.spatialReference,c=!1,d=!1;if(null==a)d=c=!0;else switch(b=
b&&b.isGeographic,a){case "east-north-up":case "earth-centered":c=!0;d=b;break;case "vertex-reference-frame":c=!0;d=!b;break;default:c=!1}if(!c)throw new f("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!d)throw new f("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");};d.prototype._getTypeKeywords=function(){var a=[];if("points"===this.profile)a.push("Point");else if("mesh-pyramids"===
this.profile)a.push("3DObject");else throw new f("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);return a};d.prototype._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(var a=function(a){var c=!(!b.attributeStorageInfo||!b.attributeStorageInfo.some(function(b){return b.name===a.name})),d=!!(b.associatedLayer&&b.associatedLayer.fields&&b.associatedLayer.fields.some(function(b){return b&&a.name===b.name}));b._fieldUsageInfo[a.name]=
{supportsLabelingInfo:c,supportsRenderer:c,supportsPopupTemplate:c||d,supportsLayerQuery:d}},b=this,c=0,d=this.fields;c<d.length;c++)a(d[c])};d.prototype._applyAssociatedLayerOverrides=function(){if(this.associatedLayer){if(this.associatedLayer.fields){for(var a=null,b=0,c=this.associatedLayer.fields;b<c.length;b++){var d=c[b];this.getField(d.name)||(a||(a=this.fields?this.fields.slice():[]),a.push(d.clone()))}a&&this._set("fields",a)}a=["popupTemplate","popupEnabled"];b=t.getProperties(this);for(c=
0;c<a.length;c++)d=a[c],this._buddyIsMoreImportant(d)&&(b.setDefaultOrigin(this.associatedLayer.originOf(d)),b.set(d,this.associatedLayer[d]),b.setDefaultOrigin("user"))}};d.prototype._setAssociatedFeatureLayer=function(b){return a.__awaiter(this,void 0,void 0,function(){var d,e,f;return a.__generator(this,function(a){switch(a.label){case 0:d=new H.FetchAssociatedFeatureLayer(this,b),a.label=1;case 1:return a.trys.push([1,3,,4]),e=this,[4,d.fetch()];case 2:return e.associatedLayer=a.sent(),[3,4];
case 3:return f=a.sent(),c.isAbortError(f)||this._logWarningOnPopupEnabled(),[3,4];case 4:return[2]}})})};d.prototype._logWarningOnPopupEnabled=function(){var a=this;p.whenValidOnce(this,["popupTemplate","popupEnabled"],function(){return a.popupEnabled&&null!=a.popupTemplate}).then(function(){return function(){var b="this SceneLayer: "+a.title;null==a.attributeStorageInfo?ba.warn("Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on "+b):ba.info("Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on "+
b)}})};d.prototype._buddyIsMoreImportant=function(a){if(!this.associatedLayer)return!1;var b=this.originIdOf(a);a=this.associatedLayer.originIdOf(a);return null!=a&&2>=a?null==b||2>b:null!=a&&3>=a?null==b||3>b:!1};d.prototype._validateElevationInfo=function(){var a=this.elevationInfo;a&&("mesh-pyramids"===this.profile&&"absolute-height"!==a.mode&&ba.warn(".elevationInfo\x3d","Mesh scene layers only support absolute-height elevation mode"),a.featureExpressionInfo&&"0"!==a.featureExpressionInfo.expression&&
ba.warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};a.__decorate([r.property({types:{key:"type",base:C.default,typeMap:{selection:F}},json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],d.prototype,"featureReduction",void 0);a.__decorate([r.property({type:[N.default],json:{read:!1,origins:{"web-scene":{read:{source:"layerDefinition.rangeInfos"},write:{target:"layerDefinition.rangeInfos"}}}}})],
d.prototype,"rangeInfos",void 0);a.__decorate([r.property({json:{read:!1}})],d.prototype,"associatedLayer",void 0);a.__decorate([r.property({type:["show","hide"]})],d.prototype,"listMode",void 0);a.__decorate([r.property({type:["ArcGISSceneServiceLayer"]})],d.prototype,"operationalLayerType",void 0);a.__decorate([r.property({json:{read:!1},readOnly:!0})],d.prototype,"type",void 0);a.__decorate([r.property(a.__assign(a.__assign({},V.fields),{readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}}))],
d.prototype,"fields",void 0);a.__decorate([r.property({readOnly:!0,dependsOn:["fields"]})],d.prototype,"fieldsIndex",null);a.__decorate([r.property(V.outFields)],d.prototype,"outFields",void 0);a.__decorate([r.property({type:E.I3SNodePageDefinition,readOnly:!0})],d.prototype,"nodePages",void 0);a.__decorate([r.property({type:[E.I3SMaterialDefinition],readOnly:!0})],d.prototype,"materialDefinitions",void 0);a.__decorate([r.property({type:[E.I3STextureSetDefinition],readOnly:!0})],d.prototype,"textureSetDefinitions",
void 0);a.__decorate([r.property({type:[E.I3SGeometryDefinition],readOnly:!0})],d.prototype,"geometryDefinitions",void 0);a.__decorate([r.property({readOnly:!0})],d.prototype,"serviceUpdateTimeStamp",void 0);a.__decorate([r.property({readOnly:!0})],d.prototype,"attributeStorageInfo",void 0);a.__decorate([r.property({readOnly:!0})],d.prototype,"statisticsInfo",void 0);a.__decorate([r.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},
write:{target:"layerDefinition.definitionExpression"}}})],d.prototype,"definitionExpression",void 0);a.__decorate([r.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],d.prototype,"path",void 0);a.__decorate([r.property(A.elevationInfo)],d.prototype,"elevationInfo",null);a.__decorate([r.property({type:String,dependsOn:["profile"]})],d.prototype,"geometryType",null);a.__decorate([r.property(A.labelsVisible)],d.prototype,"labelsVisible",void 0);a.__decorate([r.property({type:[L],
json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:M.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:M.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],d.prototype,"labelingInfo",void 0);a.__decorate([r.property(A.legendEnabled)],d.prototype,"legendEnabled",void 0);a.__decorate([r.property(A.opacityDrawingInfo)],d.prototype,"opacity",void 0);a.__decorate([r.property({types:h.webSceneRendererTypes,
json:{origins:{service:{read:{source:"drawingInfo.renderer",reader:U}}},read:{source:"layerDefinition.drawingInfo.renderer",reader:U},write:{target:"layerDefinition.drawingInfo.renderer"}},value:null})],d.prototype,"renderer",null);a.__decorate([r.property({json:{read:!1}})],d.prototype,"cachedDrawingInfo",void 0);a.__decorate([r.reader("service","cachedDrawingInfo")],d.prototype,"readCachedDrawingInfo",null);a.__decorate([r.property(A.popupEnabled)],d.prototype,"popupEnabled",void 0);a.__decorate([r.property({type:m,
json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],d.prototype,"popupTemplate",void 0);a.__decorate([r.property({readOnly:!0,json:{read:!1},dependsOn:["fields","title","attributeStorageInfo","associatedLayer"]})],d.prototype,"defaultPopupTemplate",null);a.__decorate([r.property({type:String,json:{read:!1}})],d.prototype,"objectIdField",void 0);a.__decorate([r.reader("service","objectIdField",["objectIdField","fields"])],d.prototype,"readObjectIdField",null);a.__decorate([r.property({json:{read:!1}})],
d.prototype,"objectIdFilter",void 0);a.__decorate([r.property({type:String,json:{read:!1}})],d.prototype,"profile",void 0);a.__decorate([r.reader("service","profile",["store.profile"])],d.prototype,"readProfile",null);a.__decorate([r.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],d.prototype,"normalReferenceFrame",void 0);a.__decorate([r.property(B.screenSizePerspectiveEnabled)],d.prototype,"screenSizePerspectiveEnabled",void 0);
return d=a.__decorate([r.subclass("esri.layers.SceneLayer")],d)}(y.SceneService(v.ArcGISService(z.OperationalLayer(w.PortalLayer(q.ScaleRangeLayer(d.MultiOriginJSONMixin(u)))))))})},"esri/layers/mixins/SceneService":function(){define("require exports tslib ../../request ../../core/Error ../../core/has ../../core/Logger ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/originUtils ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../support/arcgisLayerUrl ../support/commonProperties ../../portal/Portal ../../portal/PortalItem ../../webdoc/support/saveUtils @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w){Object.defineProperty(b,"__esModule",{value:!0});var q=f.getLogger("esri.layers.mixins.SceneService");b.SceneService=function(e){return function(e){function f(){var a=null!==e&&e.apply(this,arguments)||this;a.spatialReference=null;a.fullExtent=null;a.heightModelInfo=null;a.minScale=0;a.maxScale=0;a.version={major:Number.NaN,minor:Number.NaN,versionString:""};a.copyright=null;a.sublayerTitleMode="item-title";a.title=null;a.layerId=null;return a}a.__extends(f,
e);f.prototype.readSpatialReference=function(a,b){return this._readSpatialReference(b)};f.prototype._readSpatialReference=function(a){if(null!=a.spatialReference)return r.fromJSON(a.spatialReference);a=a.store;a=(a=a.indexCRS||a.geographicCRS)&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10);return null!=a?new r(a):null};f.prototype.readFullExtent=function(a,b){a=b.store;b=this._readSpatialReference(b);return null==b||null==a||null==a.extent||!Array.isArray(a.extent)||a.extent.some(function(a){return a<
y})?null:new k({xmin:a.extent[0],ymin:a.extent[1],xmax:a.extent[2],ymax:a.extent[3],spatialReference:b})};f.prototype.readVersion=function(a,b){a=b.store;b=null!=a.version?a.version.toString():"";a={major:Number.NaN,minor:Number.NaN,versionString:b};b=b.split(".");2<=b.length&&(a.major=parseInt(b[0],10),a.minor=parseInt(b[1],10));return a};f.prototype.readTitlePortalItem=function(a){return"item-title"!==this.sublayerTitleMode?void 0:a};f.prototype.readTitleService=function(a,b){a=this.portalItem&&
this.portalItem.title;if("item-title"===this.sublayerTitleMode)return t.titleFromUrlAndName(this.url,b.name);b=b.name||t.parse(this.url).title;"item-title-and-service-name"===this.sublayerTitleMode&&a&&(b=a+" - "+b);return t.cleanTitle(b)};Object.defineProperty(f.prototype,"url",{set:function(a){a=t.sanitizeUrlWithLayerId(this,a,q);this._set("url",a.url);null!=a.layerId&&this._set("layerId",a.layerId)},enumerable:!0,configurable:!0});f.prototype.writeUrl=function(a,b,c,d){t.writeUrlWithLayerId(this,
a,"layers",b,d)};Object.defineProperty(f.prototype,"parsedUrl",{get:function(){var a=this._get("url");if(!a)return null;a=l.urlToObject(a);null!=this.layerId&&t.isArcGISUrl(a.path)&&(a.path=a.path+"/layers/"+this.layerId);return a},enumerable:!0,configurable:!0});f.prototype._verifyRootNodeAndUpdateExtent=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var d,e,f;return a.__generator(this,function(a){switch(a.label){case 0:if(!b)return[3,4];a.label=1;case 1:return a.trys.push([1,3,,
4]),d=this._updateExtentFromRootPage,e=[b],[4,this._fetchRootPage(b,c)];case 2:return[2,d.apply(this,e.concat([a.sent()]))];case 3:return a.sent(),[3,4];case 4:return f=this._updateExtentFromRootNode,[4,this._fetchRootNode(c)];case 5:return[2,f.apply(this,[a.sent()])]}})})};f.prototype._fetchRootPage=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var d,e,f;return a.__generator(this,function(a){switch(a.label){case 0:if(!b)return[2,g.reject()];d=Math.floor(b.rootIndex/b.nodesPerPage);
e=this.parsedUrl.path+"/nodepages/"+d;return[4,m(e,{responseType:"json",signal:c})];case 1:return f=a.sent(),[2,f.data]}})})};f.prototype._updateExtentFromRootPage=function(a,b){if(null==b||null==b.nodes)throw new h("sceneservice:invalid-node-page","Inavlid node page.");b=b.nodes[a.rootIndex%a.nodesPerPage];if(null==b||null==b.obb||null==b.obb.center||null==b.obb.halfSize)throw new h("sceneservice:invalid-node-page","Inavlid node page.");b.obb.center[0]<y||(a=b.obb.halfSize,b=b.obb.center[2],a=Math.sqrt(a[0]*
a[0]+a[1]*a[1]+a[2]*a[2]),this.fullExtent.zmin=b-a,this.fullExtent.zmax=b+a)};f.prototype._updateExtentFromRootNode=function(a){if(null!=a&&null!=this.fullExtent&&!this.fullExtent.hasZ&&Array.isArray(a.mbs)&&4===a.mbs.length&&!(a.mbs[0]<y)){var b=a.mbs[2];a=a.mbs[3];this.fullExtent.zmin=b-a;this.fullExtent.zmax=b+a}};f.prototype._fetchRootNode=function(b){return a.__awaiter(this,void 0,void 0,function(){var c,d,e;return a.__generator(this,function(a){switch(a.label){case 0:if(!this.rootNode)return[2];
c=l.join(this.parsedUrl.path,this.rootNode);a.label=1;case 1:return a.trys.push([1,3,,4]),[4,m(c,{query:{f:"json"},responseType:"json",signal:b})];case 2:return d=a.sent(),[2,d.data];case 3:throw e=a.sent(),new h("sceneservice:root-node-missing","Root node missing.",{error:e,url:c});case 4:return[2]}})})};f.prototype._fetchService=function(b){return a.__awaiter(this,void 0,void 0,function(){var c;return a.__generator(this,function(a){switch(a.label){case 0:return null==this.layerId&&/SceneServer\/*$/i.test(this.url)?
[4,this._fetchFirstLayerId(b)]:[3,2];case 1:c=a.sent(),null!=c&&(this.layerId=c),a.label=2;case 2:return[2,this._fetchServiceLayer(b)]}})})};f.prototype._fetchFirstLayerId=function(b){return a.__awaiter(this,void 0,void 0,function(){var c;return a.__generator(this,function(a){switch(a.label){case 0:return[4,m(this.url,{query:{f:"json"},responseType:"json",signal:b})];case 1:return c=a.sent(),c.data&&Array.isArray(c.data.layers)&&0<c.data.layers.length?[2,c.data.layers[0].id]:[2,void 0]}})})};f.prototype._fetchServiceLayer=
function(b){return a.__awaiter(this,void 0,void 0,function(){var c,d;return a.__generator(this,function(a){switch(a.label){case 0:return[4,m(this.parsedUrl.path,{query:{f:"json"},responseType:"json",signal:b})];case 1:return c=a.sent(),c.ssl&&(this.url=this.url.replace(/^http:/i,"https:")),d=c.data,this.read(d,{origin:"service",url:this.parsedUrl}),this.validateLayer(d),[2]}})})};f.prototype._ensureLoadBeforeSave=function(){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,
function(a){switch(a.label){case 0:return[4,this.load()];case 1:return a.sent(),"beforeSave"in this&&"function"===typeof this.beforeSave?[4,this.beforeSave()]:[3,3];case 2:a.sent(),a.label=3;case 3:return[2]}})})};f.prototype.validateLayer=function(a){};f.prototype._updateTypeKeywords=function(a,b){a.typeKeywords||(a.typeKeywords=[]);var c=0;for(b=b.getTypeKeywords();c<b.length;c++)a.typeKeywords.push(b[c]);a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a,b,c){return c.indexOf(a)===
b}))};f.prototype._saveAs=function(d,e){return a.__awaiter(this,void 0,void 0,function(){var f,k,l,m,p;return a.__generator(this,function(n){switch(n.label){case 0:f=a.__assign(a.__assign({},B),e);if(k=z.from(d))return[3,2];q.error("_saveAs(): requires a portal item parameter");return[4,g.reject(new h("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))];case 1:n.sent(),n.label=2;case 2:return k.id&&(k=k.clone(),k.id=null),l=k.portal||v.getDefault(),[4,this._ensureLoadBeforeSave()];
case 3:return n.sent(),k.type=b.SCENE_SERVICE_ITEM_TYPE,k.portal=l,m={origin:"portal-item",url:null,messages:[],portal:l,portalItem:k,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},p={layers:[this.write(null,m)]},[4,g.all(m.resources.pendingOperations)];case 4:return n.sent(),[4,this._validateAgainstJSONSchema(p,m,f)];case 5:return n.sent(),k.url=this.url,k.title||(k.title=this.title),this._updateTypeKeywords(k,f),[4,l._signIn()];case 6:return n.sent(),
[4,l.user.addItem({item:k,folder:f&&f.folder,data:p})];case 7:return n.sent(),[4,w.saveResources(this.resourceReferences,m,null)];case 8:return n.sent(),this.portalItem=k,c.updateOrigins(m),m.portalItem=k,[2,k]}})})};f.prototype._save=function(d){return a.__awaiter(this,void 0,void 0,function(){var e,f,k;return a.__generator(this,function(m){switch(m.label){case 0:e=a.__assign(a.__assign({},B),d);if(this.portalItem)return[3,2];q.error("_save(): requires the .portalItem property to be set");return[4,
g.reject(new h("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService"))];case 1:m.sent(),m.label=2;case 2:if(this.portalItem.type===b.SCENE_SERVICE_ITEM_TYPE)return[3,4];q.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected "+b.SCENE_SERVICE_ITEM_TYPE);return[4,g.reject(new h("sceneservice:portal-item-wrong-type",'Portal item needs to have type "'+b.SCENE_SERVICE_ITEM_TYPE+'"'))];case 3:m.sent(),m.label=4;case 4:return[4,
this._ensureLoadBeforeSave()];case 5:return m.sent(),f={origin:"portal-item",url:this.portalItem.itemUrl&&l.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||v.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},k={layers:[this.write(null,f)]},[4,g.all(f.resources.pendingOperations)];case 6:return m.sent(),[4,this._validateAgainstJSONSchema(k,f,e)];case 7:return m.sent(),
this.portalItem.url=this.url,this.portalItem.title||(this.portalItem.title=this.title),this._updateTypeKeywords(this.portalItem,e),[4,this.portalItem.update({data:k})];case 8:return m.sent(),[4,w.saveResources(this.resourceReferences,f,null)];case 9:return m.sent(),c.updateOrigins(f),[2,this.portalItem]}})})};f.prototype._validateAgainstJSONSchema=function(b,c,d){return a.__awaiter(this,void 0,void 0,function(){var e,f,g,k,l,m;return a.__generator(this,function(a){switch(a.label){case 0:return e=
c.messages.filter(function(a){return"error"===a.type}).map(function(a){return new h(a.name,a.message,a.details)}),d&&d.validationOptions.ignoreUnsupported&&(e=e.filter(function(a){return"layer:unsupported"!==a.name&&"symbol:unsupported"!==a.name&&"symbol-layer:unsupported"!==a.name&&"property:unsupported"!==a.name&&"url:unsupported"!==a.name&&"scenemodification:unsupported"!==a.name})),d.validationOptions.enabled||A?[4,new Promise(function(a,b){n(["../../portal/schemas/validator"],a,b)})]:[3,2];case 1:f=
a.sent();g=f.validate(b,d.portalItemLayerType);if(0<g.length&&(k="Layer item did not validate:\n"+g.join("\n"),q.error("_validateAgainstJSONSchema(): "+k),"throw"===d.validationOptions.failPolicy))throw l=g.map(function(a){return new h("sceneservice:schema-validation",a)}),m=l.concat(e),new h("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:m});a.label=2;case 2:if(0<e.length)throw new h("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",
{errors:e});return[2]}})})};a.__decorate([d.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],f.prototype,"id",void 0);a.__decorate([d.property({type:r})],f.prototype,"spatialReference",void 0);a.__decorate([d.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],f.prototype,"readSpatialReference",null);a.__decorate([d.property({type:k})],f.prototype,"fullExtent",void 0);a.__decorate([d.reader("fullExtent",["store.extent","spatialReference",
"store.indexCRS","store.geographicCRS"])],f.prototype,"readFullExtent",null);a.__decorate([d.property({readOnly:!0,type:p})],f.prototype,"heightModelInfo",void 0);a.__decorate([d.property({type:Number,json:{read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"},origins:{service:{read:{source:"minScale"},write:!1}}}})],f.prototype,"minScale",void 0);a.__decorate([d.property({type:Number,json:{read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"},
origins:{service:{read:{source:"maxScale"},write:!1}}}})],f.prototype,"maxScale",void 0);a.__decorate([d.property({readOnly:!0})],f.prototype,"version",void 0);a.__decorate([d.reader("version",["store.version"])],f.prototype,"readVersion",null);a.__decorate([d.property({type:String,json:{read:{source:"copyrightText"}}})],f.prototype,"copyright",void 0);a.__decorate([d.property({type:String,json:{read:!1}})],f.prototype,"sublayerTitleMode",void 0);a.__decorate([d.property({type:String})],f.prototype,
"title",void 0);a.__decorate([d.reader("portal-item","title")],f.prototype,"readTitlePortalItem",null);a.__decorate([d.reader("service","title",["name"])],f.prototype,"readTitleService",null);a.__decorate([d.property({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],f.prototype,"layerId",void 0);a.__decorate([d.property(u.url)],f.prototype,"url",null);a.__decorate([d.writer("url")],f.prototype,"writeUrl",null);a.__decorate([d.property({dependsOn:["layerId"]})],
f.prototype,"parsedUrl",null);a.__decorate([d.property({readOnly:!0})],f.prototype,"store",void 0);a.__decorate([d.property({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],f.prototype,"rootNode",void 0);return f=a.__decorate([d.subclass("esri.layers.mixins.SceneService")],f)}(e)};var y=-1E38,A=0;b.SCENE_SERVICE_ITEM_TYPE="Scene Service";var B={getTypeKeywords:function(){return[]},portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}}})},
"esri/core/accessorSupport/originUtils":function(){define(["require","exports","../multiOriginJSONSupportUtils"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.updateOrigins=function(b){b&&b.writtenProperties&&b.writtenProperties.forEach(function(b){var e=b.target;b.newOrigin&&b.oldOrigin!==b.newOrigin&&a.isMultiOriginJSONMixin(e)&&e.updateOrigin(b.propName,b.newOrigin)})}})},"esri/webdoc/support/saveUtils":function(){define("require exports tslib ../../core/asyncUtils ../../core/Error ../../core/promiseUtils ../../core/SetUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),
function(n,b,a,m,h,e,f,g,l){function d(b,c){return a.__awaiter(this,void 0,void 0,function(){var d;return a.__generator(this,function(a){switch(a.label){case 0:return[4,m.result(b.resource.portalItem.addResource(b.resource,b.content,c))];case 1:d=a.sent();if(!0===d.ok)b.finish&&b.finish(b.resource);else throw b.error&&b.error(d.error),d.error;return[2]}})})}function c(b,c){return a.__awaiter(this,void 0,void 0,function(){var d;return a.__generator(this,function(a){switch(a.label){case 0:return[4,
m.result(b.resource.update(b.content,c))];case 1:d=a.sent();if(!0===d.ok)b.finish(b.resource);else throw b.error(d.error),d.error;return[2]}})})}Object.defineProperty(b,"__esModule",{value:!0});b.saveResources=function(b,m,n){return a.__awaiter(this,void 0,void 0,function(){var k,p,r,z,w,q,y,A,B,C,F,H,I,G,J,E,L;return a.__generator(this,function(a){switch(a.label){case 0:if(!m||!m.resources)return[2];k=m.portalItem===b.portalItem?f.SetFromValues(b.paths):new Set;b.paths.length=0;b.portalItem=m.portalItem;
p=f.SetFromValues(m.resources.toKeep.map(function(a){return a.resource.path}));r=new Set;z=[];p.forEach(function(a){k.delete(a);b.paths.push(a)});w=0;for(q=m.resources.toUpdate;w<q.length;w++)y=q[w],k.delete(y.resource.path),p.has(y.resource.path)||r.has(y.resource.path)?(A=y.resource,B=y.content,C=y.finish,F=y.error,H=l.getSiblingOfSameType(A,g.generateUUID()),b.paths.push(H.path),z.push(d({resource:H,content:B,finish:C,error:F},n))):(b.paths.push(y.resource.path),z.push(c(y,n)),r.add(y.resource.path));
I=0;for(G=m.resources.toAdd;I<G.length;I++)J=G[I],z.push(d(J,n)),b.paths.push(J.resource.path);k.forEach(function(a){a=m.portalItem.resourceFromPath(a);z.push(a.portalItem.removeResource(a).catch(function(){}))});return 0===z.length?[2]:[4,e.eachAlways(z)];case 1:E=a.sent();e.throwIfAborted(n);L=E.filter(function(a){return"error"in a}).map(function(a){return a.error});if(0<L.length)throw new h("save:resources","Failed to save one or more resources",{errors:L});return[2]}})})}})},"esri/layers/support/FetchAssociatedFeatureLayer":function(){define("require exports tslib ../../kernel ../../request ../../core/arrayUtils ../../core/maybe ../../core/promiseUtils ../FeatureLayer ../../portal/Portal ../../portal/PortalItem".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b){this.layer=a;this.signal=b;this.rootDocument=null;if(a=this.layer.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i))this.urlParts={root:a[1],layerId:parseInt(a[2],10)}}b.prototype.fetch=function(){return a.__awaiter(this,void 0,void 0,function(){var b,c,d;return a.__generator(this,function(a){switch(a.label){case 0:if(!this.urlParts||-1===["mesh-pyramids","points"].indexOf(this.layer.profile))return[2,
null];if(!this.layer.portalItem)return[3,1];c=this.layer.portalItem;return[3,3];case 1:return[4,this.portalItemFromServiceItemId()];case 2:c=a.sent(),a.label=3;case 3:return b=c,f.isNone(b)?[2,this.loadFromUrl()]:[4,this.findAndLoadRelatedPortalItem(b)];case 4:return d=a.sent(),f.isNone(d)?[2,null]:[2,this.loadFeatureLayerFromPortalItem(d)]}})})};b.prototype.fetchRootDocument=function(){return a.__awaiter(this,void 0,void 0,function(){var b,c,d;return a.__generator(this,function(a){switch(a.label){case 0:if(f.isSome(this.rootDocument))return[2,
this.rootDocument];if(f.isNone(this.urlParts))return this.rootDocument={},[2,{}];b={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal};c=this.urlParts.root+"/SceneServer";a.label=1;case 1:return a.trys.push([1,3,,4]),[4,h(c,b)];case 2:return d=a.sent(),this.rootDocument=d.data,[3,4];case 3:return a.sent(),this.rootDocument={},[3,4];case 4:return[2,this.rootDocument]}})})};b.prototype.fetchServiceOwningPortalUrl=function(){return a.__awaiter(this,void 0,void 0,function(){var b,
c,d,e,f;return a.__generator(this,function(a){switch(a.label){case 0:if((b=m.id&&m.id.findServerInfo(this.layer.parsedUrl.path))&&b.owningSystemUrl)return[2,b.owningSystemUrl];c=this.layer.parsedUrl.path.replace(/(.*\/rest)\/.*/i,"$1")+"/info";a.label=1;case 1:return a.trys.push([1,3,,4]),[4,h(c,{query:{f:"json"},responseType:"json",signal:this.signal})];case 2:return d=a.sent(),(e=d.data.owningSystemUrl)?[2,e]:[3,4];case 3:return f=a.sent(),g.throwIfAbortError(f),[3,4];case 4:return[2,null]}})})};
b.prototype.findAndLoadRelatedPortalItem=function(b){return a.__awaiter(this,void 0,void 0,function(){var c,d;return a.__generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,b.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})];case 1:return c=a.sent(),[2,e.find(c,function(a){return"Feature Service"===a.type})||null];case 2:return d=a.sent(),g.throwIfAbortError(d),[2,null];case 3:return[2]}})})};b.prototype.loadFeatureLayerFromPortalItem=
function(b){return a.__awaiter(this,void 0,void 0,function(){var c,d;return a.__generator(this,function(a){switch(a.label){case 0:return[4,b.load({signal:this.signal})];case 1:return a.sent(),[4,this.findMatchingAssociatedSublayerUrl(b.url)];case 2:return c=a.sent(),d=new l({url:c,portalItem:b}),[2,d.load({signal:this.signal})]}})})};b.prototype.loadFromUrl=function(){return a.__awaiter(this,void 0,void 0,function(){var b,c;return a.__generator(this,function(a){switch(a.label){case 0:return[4,this.findMatchingAssociatedSublayerUrl(this.urlParts.root+
"/FeatureServer")];case 1:return b=a.sent(),c=new l({url:b}),[2,c.load({signal:this.signal})]}})})};b.prototype.findMatchingAssociatedSublayerUrl=function(b){return a.__awaiter(this,void 0,void 0,function(){var c,d,e,f,k,l,m,p,n,B,C,F;return a.__generator(this,function(a){switch(a.label){case 0:return c=b.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),d={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal},e=this.urlParts.layerId,f=this.fetchRootDocument(),k=h(c,d),[4,
g.all([k,f])];case 1:l=a.sent();m=l[0];n=(p=l[1])&&p.layers;B=m.data&&m.data.layers;if(!Array.isArray(B))throw Error("expected layers array");if(Array.isArray(n))for(C=0;C<Math.min(n.length,B.length);C++){if(F=n[C],F.id===e)return[2,c+"/"+B[C].id]}else if(e<B.length)return[2,c+"/"+B[e].id];throw Error("could not find matching associated sublayer");}})})};b.prototype.portalItemFromServiceItemId=function(){return a.__awaiter(this,void 0,void 0,function(){var b,e,h,k;return a.__generator(this,function(a){switch(a.label){case 0:return[4,
this.fetchRootDocument()];case 1:b=a.sent();e=b.serviceItemId;if(!e)return[2,null];h=new c({id:e});return[4,this.fetchServiceOwningPortalUrl()];case 2:k=a.sent();f.isSome(k)&&(h.portal=new d({url:k}));try{return[2,h.load({signal:this.signal})]}catch(z){return g.throwIfAbortError(z),[2,null]}}})})};return b}();b.FetchAssociatedFeatureLayer=n})},"esri/layers/support/I3SLayerDefinitions":function(){define(["require","exports","tslib","../../core/JSONSupport","../../core/accessorSupport/decorators"],
function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.nodesPerPage=null;a.rootIndex=0;a.lodSelectionMetricType=null;return a}a.__extends(c,b);a.__decorate([h.property({type:Number})],c.prototype,"nodesPerPage",void 0);a.__decorate([h.property({type:Number})],c.prototype,"rootIndex",void 0);a.__decorate([h.property({type:String})],c.prototype,"lodSelectionMetricType",void 0);return c=a.__decorate([h.subclass("esri.layer.support.I3SNodePageDefinition")],
c)}(m.JSONSupport);b.I3SNodePageDefinition=n;var e=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.factor=1;return a}a.__extends(c,b);a.__decorate([h.property({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],c.prototype,"id",void 0);a.__decorate([h.property({type:Number})],c.prototype,"factor",void 0);return c=a.__decorate([h.subclass("esri.layer.support.I3SMaterialTexture")],c)}(m.JSONSupport);b.I3SMaterialTexture=e;var f=function(b){function c(){var a=null!==
b&&b.apply(this,arguments)||this;a.baseColorFactor=[1,1,1,1];a.baseColorTexture=null;a.metallicRoughnessTexture=null;a.metallicFactor=1;a.roughnessFactor=1;return a}a.__extends(c,b);a.__decorate([h.property({type:[Number]})],c.prototype,"baseColorFactor",void 0);a.__decorate([h.property({type:e})],c.prototype,"baseColorTexture",void 0);a.__decorate([h.property({type:e})],c.prototype,"metallicRoughnessTexture",void 0);a.__decorate([h.property({type:Number})],c.prototype,"metallicFactor",void 0);a.__decorate([h.property({type:Number})],
c.prototype,"roughnessFactor",void 0);return c=a.__decorate([h.subclass("esri.layer.support.I3SMaterialPBRMetallicRoughness")],c)}(m.JSONSupport);b.I3SMaterialPBRMetallicRoughness=f;n=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.alphaMode="opaque";a.alphaCutoff=.25;a.doubleSided=!1;a.cullFace="none";a.normalTexture=null;a.occlusionTexture=null;a.emissiveTexture=null;a.emissiveFactor=null;a.pbrMetallicRoughness=null;return a}a.__extends(c,b);a.__decorate([h.enumeration({opaque:"opaque",
mask:"mask",blend:"blend"})],c.prototype,"alphaMode",void 0);a.__decorate([h.property({type:Number})],c.prototype,"alphaCutoff",void 0);a.__decorate([h.property({type:Boolean})],c.prototype,"doubleSided",void 0);a.__decorate([h.enumeration({none:"none",back:"back",front:"front"})],c.prototype,"cullFace",void 0);a.__decorate([h.property({type:e})],c.prototype,"normalTexture",void 0);a.__decorate([h.property({type:e})],c.prototype,"occlusionTexture",void 0);a.__decorate([h.property({type:e})],c.prototype,
"emissiveTexture",void 0);a.__decorate([h.property({type:[Number]})],c.prototype,"emissiveFactor",void 0);a.__decorate([h.property({type:f})],c.prototype,"pbrMetallicRoughness",void 0);return c=a.__decorate([h.subclass("esri.layer.support.I3SMaterialDefinition")],c)}(m.JSONSupport);b.I3SMaterialDefinition=n;var g=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}a.__extends(c,b);a.__decorate([h.property({type:String,json:{read:{source:["name","index"],reader:function(a,b){return null!=
a?a:""+b.index}}}})],c.prototype,"name",void 0);a.__decorate([h.enumeration({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2"})],c.prototype,"format",void 0);return c=a.__decorate([h.subclass("esri.layer.support.I3STextureFormat")],c)}(m.JSONSupport);b.I3STextureFormat=g;n=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.atlas=!1;return a}a.__extends(c,b);a.__decorate([h.property({type:[g]})],c.prototype,"formats",void 0);a.__decorate([h.property({type:Boolean})],c.prototype,
"atlas",void 0);return c=a.__decorate([h.subclass("esri.layer.support.I3STextureSetDefinition")],c)}(m.JSONSupport);b.I3STextureSetDefinition=n;var l=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}a.__extends(c,b);a.__decorate([h.enumeration({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],c.prototype,"type",void 0);a.__decorate([h.property({type:Number})],c.prototype,"component",void 0);return c=a.__decorate([h.subclass("esri.layer.support.I3SGeometryAttribute")],
c)}(m.JSONSupport);b.I3SGeometryAttribute=l;var d=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}a.__extends(c,b);a.__decorate([h.enumeration({draco:"draco"})],c.prototype,"encoding",void 0);a.__decorate([h.property({type:[String]})],c.prototype,"attributes",void 0);return c=a.__decorate([h.subclass("esri.layer.support.I3SGeometryCompressedAttributes")],c)}(m.JSONSupport);b.I3SGeometryCompressedAttributes=d;n=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||
this;a.offset=0;return a}a.__extends(c,b);a.__decorate([h.property({type:Number})],c.prototype,"offset",void 0);a.__decorate([h.property({type:l})],c.prototype,"position",void 0);a.__decorate([h.property({type:l})],c.prototype,"normal",void 0);a.__decorate([h.property({type:l})],c.prototype,"uv0",void 0);a.__decorate([h.property({type:l})],c.prototype,"color",void 0);a.__decorate([h.property({type:l})],c.prototype,"uvRegion",void 0);a.__decorate([h.property({type:l})],c.prototype,"featureId",void 0);
a.__decorate([h.property({type:l})],c.prototype,"faceRange",void 0);a.__decorate([h.property({type:d})],c.prototype,"compressedAttributes",void 0);return c=a.__decorate([h.subclass("esri.layer.support.I3SGeometryBuffer")],c)}(m.JSONSupport);b.I3SGeometryBuffer=n;m=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}a.__extends(c,b);a.__decorate([h.enumeration({triangle:"triangle"})],c.prototype,"topology",void 0);a.__decorate([h.property()],c.prototype,"geometryBuffers",void 0);
return c=a.__decorate([h.subclass("esri.layer.support.I3SGeometryDefinition")],c)}(m.JSONSupport);b.I3SGeometryDefinition=m})},"esri/layers/support/RangeInfo":function(){define(["require","exports","tslib","../../core/JSONSupport","../../core/accessorSupport/decorators"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a.name=null;a.field=null;a.currentRangeExtent=null;a.fullRangeExtent=null;a.type="rangeInfo";
return a}a.__extends(e,b);a.__decorate([h.property({type:String,json:{read:!0,write:!0}})],e.prototype,"name",void 0);a.__decorate([h.property({type:String,json:{read:!0,write:!0}})],e.prototype,"field",void 0);a.__decorate([h.property({type:[Number],json:{read:!0,write:!0}})],e.prototype,"currentRangeExtent",void 0);a.__decorate([h.property({type:[Number],json:{read:!0,write:!0}})],e.prototype,"fullRangeExtent",void 0);a.__decorate([h.property({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],
e.prototype,"type",void 0);return e=a.__decorate([h.subclass("esri.layers.support.RangeInfo")],e)}(m.JSONSupport);b.RangeInfo=n;b.default=n})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("require exports tslib ../../../core/compilerUtils ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ./FeatureLikeLayerView3D ./LayerView3D ./support/FeatureTileFetcher3DLayerViewContext ./support/layerViewUpdatingProperties ../support/EventedSet ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z){return function(b){function c(a){a=b.call(this,a)||this;a._controllerTotal=0;a._graphicsCoreTotal=0;a.suspendResumeExtentMode="data";return a}a.__extends(c,b);c.prototype.destroy=function(){this.fetcherContext&&(this.fetcherContext.destroy(),this.fetcherContext=null)};Object.defineProperty(c.prototype,"updatingProgressValue",{get:function(){var a=1;if(this.controller&&this.controller.updating){var b=this.controller.updatingRemaining,c=this.controller.updatingTotal;
0<c&&(this._controllerTotal=Math.max(c,this._controllerTotal),a=(c-b)/c)}var d=1;this.graphics3d&&this.graphics3d.graphicsCore&&(b=this.graphics3d.graphicsCore.updatingRemaining,c=this.graphics3d.graphicsCore.updatingTotal,0<c&&(this._graphicsCoreTotal=Math.max(c,this._graphicsCoreTotal),d=(c-b)/c));1===a&&1===d&&(this._graphicsCoreTotal=this._controllerTotal=0);return.5*(a+d)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return this.controller?
!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded):!1},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"asyncGraphicsUpdates",{get:function(){if(this.controller)switch(this.controller.mode){case "snapshot":return 5E3<this.controller.serviceDataCount;case "tiles":break;default:m.neverReached(this.controller.mode)}return!0},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"hasZ",{get:function(){var a=this.layer,b=a.capabilities&&a.capabilities.data;
return b&&b.supportsZ?"returnZ"in a&&null!=a.returnZ?a.returnZ:b.supportsZ:!1},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"hasM",{get:function(){var a=this.layer,b=a.capabilities&&a.capabilities.data;return b&&b.supportsM?"returnM"in a&&null!=a.returnM?a.returnM:!1:!1},enumerable:!0,configurable:!0});c.prototype.fetchPopupFeatures=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var b;return a.__generator(this,function(a){return(b=this.validateFetchPopupFeatures(c))?
[2,e.reject(b)]:[2,this.fetchClientPopupFeatures(c)]})})};c.prototype.setVisibility=function(a,b){this.graphics3d&&this.graphics3d.graphicsCore.setObjectIdVisibility(a,b)};c.prototype.createQuery=function(){return b.prototype.createQuery.call(this)};c.prototype.queryFeatures=function(a,c){var d=this,e=function(){return b.prototype.queryFeatures.call(d,a,c)};return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(a),e):e()};c.prototype.createController=function(){return a.__awaiter(this,
void 0,void 0,function(){var b,c=this;return a.__generator(this,function(a){this.fetcherContext=new p.FeatureTileFetcher3DLayerViewContext({layerView:this,returnZ:this.hasZ,returnM:this.hasM});b=new d({layerView:this,context:this.fetcherContext,graphics:new t.EventedSet,extent:this.clippingExtent});this.updatingHandles.add(b,"serviceDataExtent",function(a){c.graphics3d&&(c.graphics3d.dataExtent=a)},2);this.handles.add(f.init(this,"suspended",function(a){a?b.suspend():b.resume()},!0));this.updatingHandles.add(this.graphics3d.graphicsCore,
"displayFeatureLimit",function(){return c.updateDisplayFeatureLimit(b)},2);this.handles.add(this.view.resourceController.memoryController.events.on("quality-changed",function(){return c.updateDisplayFeatureLimit()}));return[2,b]})})};c.prototype.doRefresh=function(){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){!this.suspended&&this.controller&&this.controller.refetch();return[2]})})};c.prototype.getUsedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;
return(a?a.usedMemory:0)+(this.controller?this.controller.memoryForUnusedFeatures:0)};c.prototype.getUnloadedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return(a?a.unprocessedMemoryEstimate:0)+(this.controller?this.controller.expectedFeatureDiff*a.usedMemoryPerGraphic:0)};c.prototype.ignoresMemoryFactor=function(){return this.controller&&this.controller.hasMaximumNumberOfFeaturesOverride};c.prototype.updateDisplayFeatureLimit=function(b){void 0===b&&(b=this.controller);if(b&&
this.graphics3d&&this.graphics3d.graphicsCore){var c=this.graphics3d.graphicsCore.displayFeatureLimit,d=this.view.resourceController.memoryController.memoryFactor;if(1===d)b.displayFeatureLimit=c;else{var e=Math.ceil(c.maximumNumberOfFeatures*d),f=Math.ceil(c.maximumTotalNumberOfFeatures*d),d=Math.ceil(c.minimumTotalNumberOfFeatures*d);b.displayFeatureLimit=a.__assign(a.__assign({},c),{maximumNumberOfFeatures:e,maximumTotalNumberOfFeatures:f,minimumTotalNumberOfFeatures:d})}}};c.prototype._queryFeaturesMesh=
function(b,c){return a.__awaiter(this,void 0,void 0,function(){var d,e,f,g,h,k,m,p;return a.__generator(this,function(a){switch(a.label){case 0:return[4,this._validateQueryFeaturesMesh(b)];case 1:return a.sent(),[4,c()];case 2:d=a.sent();if(b&&b.outStatistics)return[2,d];e=this.layer.objectIdField;f=this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID;g=[];h=0;for(k=d.features;h<k.length;h++)if(m=k[h],m.geometry){if(p=f.get(m.attributes[e]))m.geometry=l.hydrateGeometry(p.graphic.geometry),g.push(m)}else g.push(m);
d.features=g;return[2,d]}})})};c.prototype._validateQueryFeaturesMesh=function(b){return a.__awaiter(this,void 0,void 0,function(){var c,d,e,f,g;return a.__generator(this,function(a){if(!b)return[2];c=function(a){throw new h("feature-layer-view:unsupported-query","Queries on Mesh feature collection layers do not support '"+a+"'");};d=["quantizationParameters","geometryPrecision","maxAllowableOffset"];e=0;for(f=d;e<f.length;e++)g=f[e],null!=b[g]&&c(g);"returnM"in b&&b.returnM&&c("returnM");"returnCentroid"in
b&&b.returnCentroid&&c("returnCentroid");b.outSpatialReference&&!b.outSpatialReference.equals(this.view.spatialReference)&&c("outSpatialReference");return[2]})})};Object.defineProperty(c.prototype,"performanceInfo",{get:function(){var b=this.controller&&this.controller.displayFeatureLimit,b=(b=b&&b.maximumSymbolComplexity)?"f:"+b.primitivesPerFeature+",v:"+b.primitivesPerCoordinate:"n/a",b=a.__assign(a.__assign({},this._getResourceInfo()),{storedFeatures:0,totalVertices:0,partial:this.maximumNumberOfFeaturesExceeded,
mode:this.controller?this.controller.mode:"n/a",symbolComplexity:b,nodes:this.controller?this.controller.tileDescriptors.length:0});if(this.controller&&b.displayedNumberOfFeatures){var c=this.controller.debug;b.storedFeatures=c.storedFeatures;b.totalVertices=c.totalVertices}return b},enumerable:!0,configurable:!0});a.__decorate([g.property()],c.prototype,"layer",void 0);a.__decorate([g.property()],c.prototype,"controller",void 0);a.__decorate([g.property({readOnly:!0,dependsOn:["controller.updatingRemaining",
"controller.updatingTotal","graphics3d.graphicsCore.updatingRemaining","graphics3d.graphicsCore.updatingTotal"]})],c.prototype,"updatingProgressValue",null);a.__decorate([g.property({aliasOf:"controller.maximumNumberOfFeatures",set:null,get:null})],c.prototype,"maximumNumberOfFeatures",void 0);a.__decorate([g.property({dependsOn:["suspended","controller.maximumNumberOfFeaturesExceeded"]})],c.prototype,"maximumNumberOfFeaturesExceeded",null);a.__decorate([g.property(r.updatingProgress)],c.prototype,
"updatingProgress",void 0);a.__decorate([g.property({readOnly:!0,dependsOn:["controller.mode"]})],c.prototype,"asyncGraphicsUpdates",null);a.__decorate([g.property({readOnly:!0})],c.prototype,"hasZ",null);a.__decorate([g.property({readOnly:!0})],c.prototype,"hasM",null);a.__decorate([g.property()],c.prototype,"suspendResumeExtentMode",void 0);return c=a.__decorate([g.subclass("esri.views.3d.layers.FeatureLayerView3D")],c)}(z.RefreshableLayerView(c.FeatureLikeLayerView3D(u.FeatureLayerView(k.LayerView3D(v)))))})},
"esri/layers/graphics/controllers/FeatureTileController3D":function(){define("require exports tslib ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/compilerUtils ../../../core/Error ../../../core/Handles ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../support/arcgisLayerUrl ../../../portal/support/geometryServiceUtils ../../../tasks/support/StatisticDefinition ../../../views/3d/layers/support/FeatureTileFetcher3D ../../../views/3d/layers/support/FeatureTileFetcher3DDebugger ../../../views/3d/support/debugFlags ../../../views/support/WatchUpdatingTracking".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B){function C(a,b){if(!b)return!1;for(var c=0;c<b.length;c++)if(!a.has(b[c]))return!0;return!1}var F=c.getLogger("esri.layers.graphics.controllers.FeatureTileController3D");n=function(b){function c(a){a=b.call(this,a)||this;a.type="feature-tile-3d";a.watchUpdatingTracking=new B.WatchUpdatingTracking;a.serviceDataExtent=null;a.serviceDataCount=m.constants.NO_SERVICE_DATA_COUNT;a.vertexLimitExceeded=!1;a.displayFeatureLimit=null;a.suspended=!1;a.tileFetcher=
null;a.handles=new l;a.fetchDataInfoPromise=null;a.fetchDataInfoAbortController=null;a.lifeCycleAbortController=r.createAbortController();return a}a.__extends(c,b);m=c;Object.defineProperty(c.prototype,"extent",{set:function(a){if(a&&!a.spatialReference.equals(this.layerView.view.spatialReference))F.error("#extent\x3d","extent needs to be in the same spatial reference as the view");else{var b=this._get("extent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("extent",a))}},enumerable:!0,
configurable:!0});Object.defineProperty(c.prototype,"updating",{get:function(){return!!(this.tileFetcher&&this.tileFetcher.updating||null!=this.fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"updatingTotal",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingTotal:0},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"updatingRemaining",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingRemaining:0},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"expectedFeatureDiff",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.expectedFeatureDiff:0},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"memoryForUnusedFeatures",{get:function(){return this.tileFetcher?this.tileFetcher.memoryForUnusedFeatures:
0},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!(!this.tileFetcher||!this.tileFetcher.maximumNumberOfFeaturesExceeded)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"filteredDataExtent",{get:function(){return this.extent},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"maximumNumberOfFeatures",{get:function(){return this.displayFeatureLimit?this.displayFeatureLimit.maximumNumberOfFeatures:
0},set:function(a){a!==this.maximumNumberOfFeatures&&(null==a?this._clearOverride("maximumNumberOfFeatures"):this._override("maximumNumberOfFeatures",a))},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"hasMaximumNumberOfFeaturesOverride",{get:function(){return this._isOverridden("maximumNumberOfFeatures")},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"mode",{get:function(){if(this.serviceDataCount===m.constants.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";
var a=this.layerView,b=a.layer,a=(a=(a=a.view)&&a.featureTiles)&&a.tilingScheme;return b&&b.minScale&&this.serviceDataExtent&&a&&(b=this.approximateExtentSizeAtScale(b.minScale,a),(this.serviceDataExtent.width/b+this.serviceDataExtent.height/b)/2>m.constants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)?"tiles":!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"maxTotalSnapshotVertices",{get:function(){var a=
this._get("maxTotalSnapshotVertices")||0;return Math.max(a,"snapshot"===this.mode&&this.tileFetcher&&this.tileFetcher.totalVertices||0)},enumerable:!0,configurable:!0});c.prototype.approximateExtentSizeAtScale=function(a,b){var c=this.layerView.view,d=b.levels[0];return(d.tileSize[0]/(d.scale/a)+d.tileSize[1]/(d.scale/a))/2*Math.ceil((c.width/b.pixelSize+c.height/b.pixelSize)/2)};Object.defineProperty(c.prototype,"tileDescriptors",{get:function(){return"snapshot"===this.mode?new e([{id:"dummy-tile-full-extent",
lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new e},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"test",{get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise,tileFetcher:this.tileFetcher}},enumerable:!0,configurable:!0});c.prototype.initialize=function(){var a=this;this.watchUpdatingTracking.add(this,"vertexLimitInfo",function(){return a.watchUpdatingTracking.addPromise(a.updateVertexLimitExceeded(null,a.lifeCycleAbortController.signal))});
this.watchUpdatingTracking.add(this,"mode",function(){return a.modeChanged()},2);var b=r.resolve().then(function(){return a.verifyCapabilities()}).then(function(){return a.watchUpdatingTracking.addPromise(a.fetchServiceDataInfo())}).then(function(){return a.initializeTileFetcher()});this.addResolvingPromise(b)};c.prototype.verifyCapabilities=function(){var a=this.layerView.layer;if(!a.get("capabilities.operations.supportsQuery"))throw new g("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",
{layer:a});};c.prototype.destroy=function(){this.cancelFetchServiceDataInfo();this.tileFetcher&&(this.tileFetcher.destroy(),this.tileFetcher=null);this.handles&&(this.handles.destroy(),this.handles=null);this.tilesHandle&&(this.tilesHandle.remove(),this.tilesHandle=null);this.lifeCycleAbortController&&(this.lifeCycleAbortController.abort(),this.lifeCycleAbortController=null);this.watchUpdatingTracking.destroy();this._set("watchUpdatingTracking",null)};c.prototype.suspend=function(){this.suspended||
(this.suspended=!0,this.tileFetcher&&this.tileFetcher.suspend())};c.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.tileFetcher&&this.tileFetcher.resume())};c.prototype.restart=function(){var a=this,b=function(){a.tileFetcher&&a.tileFetcher.restart()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(b,b))};c.prototype.refetch=function(){var a=this,b=function(){a.tileFetcher&&a.tileFetcher.refetch()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(b,
b))};c.prototype.initializeTileFetcher=function(){var a=this,b=this.layerView.view,c=t.whenOnce(b.featureTiles,"tilingScheme",this.lifeCycleAbortController.signal);this.watchUpdatingTracking.addPromise(c);c.then(function(){var c=a.layerView,d=c.layer;a.tileFetcher=new q.FeatureTileFetcher3D({context:a.context,filterExtent:a.filteredDataExtent,tileDescriptors:a.tileDescriptors,features:a.graphics});a.suspended?a.tileFetcher.suspend():a.tileFetcher.resume();var e=a.layerView.view.resourceController;
e&&(a.handles.add(e.memoryController.events.on("quality-changed",function(b){a.tileFetcher.memoryFactor=b})),a.tileFetcher.memoryFactor=e.memoryController.memoryFactor);(e="polygon"===a.context.geometryType?"polygonLodFactor":"polyline"===a.context.geometryType?"polylineLodFactor":null)&&a.handles.add(t.init(a.layerView.view,"qualitySettings.graphics3D."+e,function(b){a.tileFetcher.lodFactor=b||1}));a.watchUpdatingTracking.add(d,"createQueryVersion",function(){return a.dataFilterChanged()});a.watchUpdatingTracking.add(c,
"availableFields",function(b,c){return a.availableFieldsChanged(c,b)});a.watchUpdatingTracking.add(c,"requiredFields",function(b,c){return a.requiredFieldsChanged(c,b)});a.handles.add([d.on("apply-edits",function(b){return a.applyEdits(b)}),a.watch("filteredDataExtent",function(b){return a.tileFetcher.filterExtent=b},!0),a.watch("tileDescriptors",function(b){return a.tileFetcher.tileDescriptors=b},!0),t.init(a,"maximumNumberOfFeatures",function(b){a.tileFetcher.maximumNumberOfFeatures=b;a.tileFetcher.useTileCount=
a.serviceDataCount>b},!0),t.init(a,"serviceDataCount",function(b){return a.tileFetcher.useTileCount=b>a.maximumNumberOfFeatures},!0),t.init(A,"FEATURE_TILE_FETCH_SHOW_TILES",function(c){c&&a.tileFetcher&&!a.tileFetcher.debugger?(a.tileFetcher.debugger=new y.FeatureTileFetcher3DDebugger(a.tileFetcher,b.featureTiles.tilingScheme.toTileInfo(),b),a.tileFetcher.debugger.update()):!c&&a.tileFetcher&&a.tileFetcher.debugger&&(a.tileFetcher.debugger.destroy(),a.tileFetcher.debugger=null)})]);a.supportsExceedsLimitQuery||
a.watchUpdatingTracking.add(a,"maxTotalSnapshotVertices",function(){return a.watchUpdatingTracking.addPromise(a.updateVertexLimitExceeded(null,a.lifeCycleAbortController.signal))})}).catch(function(){})};c.prototype.modeChanged=function(){switch(this.mode){case "tiles":this.tilesHandle||(this.tilesHandle=this.layerView.view.featureTiles.addClient());break;default:F.warn("Unhandled feature layer mode "+this.mode);case "snapshot":this.tilesHandle&&(this.tilesHandle.remove(),this.tilesHandle=null)}};
c.prototype.dataFilterChanged=function(){this._set("maxTotalSnapshotVertices",0);this.notifyChange("maxTotalSnapshotVertices");this.refetch()};c.prototype.applyEdits=function(a){var b=this;this.tileFetcher.applyEdits(a).then(function(a){a&&(a.deletedFeatures.length||a.updatedFeatures.length||a.addedFeatures.length)&&b.watchUpdatingTracking.addPromise(b.updateServiceDataExtent(b.lifeCycleAbortController.signal))})};c.prototype.availableFieldsChanged=function(a,b){this.tileFetcher&&C(this.tileFetcher.availableFields,
b)&&this.refetch()};c.prototype.requiredFieldsChanged=function(a,b){this.tileFetcher&&C(this.tileFetcher.availableFields,b)&&this.restart()};c.prototype.createVertexLimitExceededQuery=function(a){var b=this.layerView.layer,c=b.createQuery();c.outStatistics=[new w({statisticType:"exceedslimit",maxVertexCount:a,outStatisticFieldName:"exceedslimit",maxPointCount:1E8,maxRecordCount:1E8})];b.capabilities.query.supportsCacheHint&&(c.cacheHint=!0);return c};c.prototype.createDataInfoQuery=function(){var a=
this.layerView.layer,b=a.createQuery();b.outSpatialReference=this.layerView.view.spatialReference;a.capabilities.query.supportsCacheHint&&(b.cacheHint=!0);return b};c.prototype.fullExtentIsAccurate=function(){var a=this.layerView.layer;if(a.definitionExpression)return!1;switch(a.type){case "feature":return v.isHostedAgolService(a.url);case "csv":case "geojson":case "ogc-feature":return!0;default:f.neverReached(a)}};c.prototype.updateServiceDataExtent=function(b){return a.__awaiter(this,void 0,void 0,
function(){var c;return a.__generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.tryUpdateServiceDataExtent(b)];case 1:return a.sent(),[3,3];case 2:return c=a.sent(),r.isAbortError(c)||this._set("serviceDataExtent",d.clone(this.layerView.fullExtentInLocalViewSpatialReference)),[3,3];case 3:return[2]}})})};c.prototype.tryUpdateServiceDataExtent=function(b){return a.__awaiter(this,void 0,void 0,function(){var c,e,f,g,h,k,l,p,n,q,r,t;return a.__generator(this,function(a){switch(a.label){case 0:c=
this.layerView;e=c.layer;f=e.capabilities.query.supportsExtent;g=d.clone(c.fullExtentInLocalViewSpatialReference);h=e.fullExtent;k=this.fullExtentIsAccurate();l=this.serviceDataCount;p=f&&l<=m.constants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!g||!k);if(!(p&&"queryExtent"in e))return[3,2];n=this.createDataInfoQuery();return[4,e.queryExtent(n,{timeout:m.constants.QUERY_EXTENT_TIMEOUT,signal:b})];case 1:return q=a.sent(),this._set("serviceDataExtent",q.extent),[3,6];case 2:if(!g)return[3,3];this._set("serviceDataExtent",
g);return[3,6];case 3:if(!h)return[3,5];r="portalItem"in e?e.portalItem:null;return[4,z.projectGeometry(h,c.view.spatialReference,r,b)];case 4:return t=a.sent(),this._set("serviceDataExtent",t),[3,6];case 5:this._set("serviceDataExtent",null),a.label=6;case 6:return[2]}})})};c.prototype.updateServiceDataCount=function(b){return a.__awaiter(this,void 0,void 0,function(){var c,d,e;return a.__generator(this,function(a){switch(a.label){case 0:return c=this.layerView.layer,"queryFeatureCount"in c?[4,h.result(c.queryFeatureCount(this.createDataInfoQuery(),
{timeout:m.constants.QUERY_STATISTICS_TIMEOUT,signal:b}))]:(d=m.constants.NO_SERVICE_DATA_COUNT,this._set("serviceDataCount",d),[2]);case 1:e=a.sent();if(!0===e.ok)this._set("serviceDataCount",e.value);else{if(r.isAbortError(e.error))throw e.error;d=m.constants.NO_SERVICE_DATA_COUNT;this._set("serviceDataCount",d)}return[2]}})})};Object.defineProperty(c.prototype,"vertexLimitInfo",{get:function(){if(!this.displayFeatureLimit||!this.displayFeatureLimit.maximumSymbolComplexity)return null;var a=this.displayFeatureLimit,
b=a.maximumSymbolComplexity,a=a.maximumTotalNumberOfPrimitives,c=b.primitivesPerCoordinate,b=b.primitivesPerFeature,d=this._get("vertexLimitInfo");return k.isNone(d)||d.maximumTotalNumberOfPrimitives!==a||d.primitivesPerCoordinate!==c||d.primitivesPerFeature!==b?{primitivesPerCoordinate:c,primitivesPerFeature:b,maximumTotalNumberOfPrimitives:a}:d},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"supportsExceedsLimitQuery",{get:function(){var a=this.layerView.layer;return a.capabilities&&
a.capabilities.operations&&a.capabilities.operations.supportsExceedsLimitStatistics},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"minimumNumberOfVerticesForGeometry",{get:function(){var a=this.layerView.layer.geometryType;switch(a){case "point":return 1;case "multipoint":return 1;case "polygon":return 4;case "polyline":return 2;case "multipatch":case "mesh":return 3;default:return f.neverReached(a),0}},enumerable:!0,configurable:!0});c.prototype.updateVertexLimitExceeded=function(b,
c){return a.__awaiter(this,void 0,void 0,function(){var d,e,f,g,l,p,n,q,t,u,v,w,y,A,z;return a.__generator(this,function(a){switch(a.label){case 0:d=k.isSome(this.vertexLimitInfo)&&0>=this.vertexLimitInfo.primitivesPerFeature;e=1<this.minimumNumberOfVerticesForGeometry;f=this.layerView.layer;g=this.supportsExceedsLimitQuery;if(k.isNone(this.vertexLimitInfo)||!d&&!e)return this._set("vertexLimitExceeded",!1),[2];l=this.vertexLimitInfo;p=l.primitivesPerFeature;n=l.primitivesPerCoordinate;q=l.maximumTotalNumberOfPrimitives;
return(t=0!==p)&&k.isSome(b)?[4,b]:[3,2];case 1:a.sent(),a.label=2;case 2:return u=this.serviceDataCount,v=(w=u!==m.constants.NO_SERVICE_DATA_COUNT)?Math.ceil((q-u*p)/(n||1)):Math.ceil(q/(n||1)),e&&(v=Math.min(v,H)),w&&this.minimumNumberOfVerticesForGeometry*u>v?(this._set("vertexLimitExceeded",!0),[2]):g?[4,h.result(f.queryFeatures(this.createVertexLimitExceededQuery(v),{timeout:m.constants.QUERY_STATISTICS_TIMEOUT,signal:c}))]:(this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>v),[2]);
case 3:y=a.sent();if(!1===y.ok){if(r.isAbortError(y.error))throw y.error;this._set("vertexLimitExceeded",!1);return[2]}A=y.value;(z=A.features[0])&&z.attributes?this._set("vertexLimitExceeded",!!z.attributes.exceedslimit):this._set("vertexLimitExceeded",!1);return[2]}})})};c.prototype.fetchServiceDataInfo=function(){return a.__awaiter(this,void 0,void 0,function(){var b,c,d,e,f,g=this;return a.__generator(this,function(a){this.cancelFetchServiceDataInfo();b=r.createAbortController();c=b.signal;d=
this.updateServiceDataCount(c);e=r.eachAlways([d,this.updateVertexLimitExceeded(d,c)]);f=e.then(function(){return g.updateServiceDataExtent(c)}).catch(function(a){r.isAbortError(a)||F.error("#fetchServiceDataInfo()",a)}).then(function(){f===g.fetchDataInfoPromise&&(g.fetchDataInfoPromise=null,g.fetchDataInfoAbortController=null);b=null});b&&(this.fetchDataInfoPromise=f);this.fetchDataInfoAbortController=b;return[2,e.then(function(){},function(){})]})})};c.prototype.cancelFetchServiceDataInfo=function(){var a=
this.fetchDataInfoAbortController;a&&(this.fetchDataInfoPromise=this.fetchDataInfoAbortController=null,a.abort())};Object.defineProperty(c.prototype,"debug",{get:function(){return{storedFeatures:this.tileFetcher?this.tileFetcher.storedFeatures:0,totalFeatures:this.tileFetcher?this.tileFetcher.totalFeatures:0,totalVertices:this.tileFetcher?this.tileFetcher.totalVertices:0}},enumerable:!0,configurable:!0});var m;a.__decorate([u.property({readOnly:!0})],c.prototype,"type",void 0);a.__decorate([u.property({constructOnly:!0})],
c.prototype,"graphics",void 0);a.__decorate([u.property({constructOnly:!0})],c.prototype,"layerView",void 0);a.__decorate([u.property({constructOnly:!0})],c.prototype,"context",void 0);a.__decorate([u.property()],c.prototype,"extent",null);a.__decorate([u.property({dependsOn:["tileFetcher.updating","mode","layerView.view.featureTiles.updating","fetchDataInfoPromise","watchUpdatingTracking.updating"]})],c.prototype,"updating",null);a.__decorate([u.property({readOnly:!0})],c.prototype,"watchUpdatingTracking",
void 0);a.__decorate([u.property({dependsOn:["updating","tileFetcher.updatingTotal"]})],c.prototype,"updatingTotal",null);a.__decorate([u.property({dependsOn:["updating","tileFetcher.updatingRemaining"]})],c.prototype,"updatingRemaining",null);a.__decorate([u.property({dependsOn:["updating","tileFetcher.expectedFeatureDiff"]})],c.prototype,"expectedFeatureDiff",null);a.__decorate([u.property({dependsOn:["tileFetcher.memoryForUnusedFeatures"]})],c.prototype,"memoryForUnusedFeatures",null);a.__decorate([u.property({dependsOn:["tileFetcher.maximumNumberOfFeaturesExceeded"]})],
c.prototype,"maximumNumberOfFeaturesExceeded",null);a.__decorate([u.property({readOnly:!0})],c.prototype,"serviceDataExtent",void 0);a.__decorate([u.property({readOnly:!0})],c.prototype,"serviceDataCount",void 0);a.__decorate([u.property({readOnly:!0})],c.prototype,"vertexLimitExceeded",void 0);a.__decorate([u.property({readOnly:!0,dependsOn:["extent"]})],c.prototype,"filteredDataExtent",null);a.__decorate([u.property()],c.prototype,"displayFeatureLimit",void 0);a.__decorate([u.property({type:Number,
dependsOn:["displayFeatureLimit"]})],c.prototype,"maximumNumberOfFeatures",null);a.__decorate([u.property({readOnly:!0,dependsOn:"serviceDataCount displayFeatureLimit maximumNumberOfFeatures vertexLimitExceeded serviceDataExtent layerView.layer.minScale layerView.view.featureTiles.tilingScheme".split(" ")})],c.prototype,"mode",null);a.__decorate([u.property({readOnly:!0,dependsOn:["mode","tileFetcher.totalVertices"]})],c.prototype,"maxTotalSnapshotVertices",null);a.__decorate([u.property({readOnly:!0,
dependsOn:["mode"]})],c.prototype,"tileDescriptors",null);a.__decorate([u.property()],c.prototype,"tileFetcher",void 0);a.__decorate([u.property()],c.prototype,"fetchDataInfoPromise",void 0);a.__decorate([u.property({readOnly:!0,dependsOn:["displayFeatureLimit"]})],c.prototype,"vertexLimitInfo",null);return c=m=a.__decorate([u.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],c)}(p.EsriPromiseMixin(m));var H=5E6;(function(a){(function(a){a.NO_SERVICE_DATA_COUNT=Infinity;a.MAX_SNAPSHOT_MIN_SCALE_FACTOR=
5;a.reset=function(){a.MAX_FEATURE_COUNT_FOR_EXTENT=1E4;a.QUERY_STATISTICS_TIMEOUT=12E3;a.QUERY_EXTENT_TIMEOUT=1E4}})(a.constants||(a.constants={}))})(n||(n={}));n.constants.reset();return n})},"esri/views/3d/layers/support/FeatureTileFetcher3D":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/SetUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../tasks/support/QuantizationParameters ../../../../tasks/support/Query ./featureReference ./FeatureTile ../../terrain/tileUtils ../../../support/Scheduler".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y){function A(a){return"dummy-tile-full-extent"===a.id}function B(a){for(var b=0,c=0;c<a.length;c++){var d=a[c];d.features&&0<d.features.length&&d.alive&&(b=Math.max(b,d.descriptor.lij[0]))}return b}function C(a){return g.isNone(a)?new Set:c.SetFromValues(a.map(function(a){return a.name}))}function F(a,b){if(g.isNone(a)||g.isNone(b))return C(b);for(var c=new Set,d=0;d<b.length;d++){var e=b[d].name;a.has(e)&&c.add(e)}return c}Object.defineProperty(b,
"__esModule",{value:!0});var H=f.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");n=function(b){function f(a){a=b.call(this,a)||this;a._useTileCount=!1;a.updating=!1;a.updatingTotal=0;a.updatingRemaining=0;a.expectedFeatureDiff=0;a.maximumNumberOfFeaturesExceeded=!1;a.maximumNumberOfFeaturesExceededThrottle=1E3;a.maximumNumberOfFeaturesExceededNext=0;a._fullRatio=1;a._farRatio=1;a.changes={updates:{adds:[],removes:[]},adds:[],removes:[]};a.handles=new e;a._dirty=!1;a.featureTiles=new Map;
a.displayingFeatureReferences=new Map;a.numDisplayingFeatureReferences=0;a.suspended=!0;a.pendingEdits=null;return a}a.__extends(f,b);Object.defineProperty(f.prototype,"maximumNumberOfFeatures",{set:function(a){a=a||Infinity;var b=this._get("maximumNumberOfFeatures");a===b||1>a||(this._set("maximumNumberOfFeatures",a),this.maximumFeaturesUpdated(b,a))},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"memoryFactor",{set:function(a){this.memoryFactor!==a&&(this._set("memoryFactor",
a),this.setDirty())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"lodFactor",{set:function(a){this.lodFactor!==a&&(this._set("lodFactor",a),this.supportsResolution&&this.refetch())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"useTileCount",{get:function(){return this._useTileCount&&g.isSome(this.context.query.queryFeatureCount)},set:function(a){this._useTileCount=a;this.notifyChange("useTileCount")},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"memoryForUnusedFeatures",{get:function(){var a=0;this.featureTiles.forEach(function(b){return a+=b.estimatedUnusedSize});return a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"totalVertices",{get:function(){var a=0;this.featureTiles.forEach(function(b){return a+=b.numVertices});return a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"totalFeatures",{get:function(){var a=0;this.featureTiles.forEach(function(b){return a+=b.numFeatures});return a},enumerable:!0,
configurable:!0});Object.defineProperty(f.prototype,"filterExtent",{set:function(a){if(a&&this.context.tilingScheme&&!a.spatialReference.equals(this.context.tilingScheme.spatialReference))H.error("#filterExtent\x3d","extent needs to be in the same spatial reference as the tiling scheme");else{var b=this._get("filterExtent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("filterExtent",a),this.reclip(a,b))}},enumerable:!0,configurable:!0});f.prototype.initialize=function(){var a=this;this.handles.add(k.on(this,
"tileDescriptors","change",function(){return a.setDirty()},function(){return a.setDirty()}));this.objectIdField=this.context.objectIdField;this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?z.MultiFeatureReference:z.SingleFeatureReference;var b=this.context.scheduler;g.isSome(b)&&this.handles.add(b.registerTask(y.Task.FEATURE_TILE_FETCHER,function(b){return a.update(b)},function(){return a._dirty||0<a.maximumNumberOfFeaturesExceededNext}));this.setDirty()};f.prototype.destroy=
function(){var a=this;this.handles&&(this.handles.destroy(),this.handles=null);this.featureTiles.forEach(function(b){a.cancelFetchTile(b);a.removeTile(b)});this.featureTiles.clear();this.displayingFeatureReferences.clear();this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)};Object.defineProperty(f.prototype,"paused",{get:function(){return this.suspended||!!this.pendingEdits},enumerable:!0,configurable:!0});f.prototype.restart=function(){var a=this;this.featureTiles.forEach(function(b){a.cancelFetchTile(b);
a.clearTile(b);a.resetFetchTile(b)});g.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this.setDirty()};f.prototype.refetch=function(){var a=this;this.featureTiles.forEach(function(b){a.cancelFetchTile(b);a.resetFetchTile(b)});g.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this.setDirty()};f.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.pause(),this.setDirty())};f.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.unpause())};
f.prototype.pause=function(){var a=this;this.paused&&(this.featureTiles.forEach(function(b){return a.cancelFetchTile(b)}),this.updated())};f.prototype.unpause=function(){this.paused||(this.setDirty(),this.updated())};Object.defineProperty(f.prototype,"availableFields",{get:function(){var a=null;this.featureTiles.forEach(function(b){b.displayingFeatures&&0!==b.displayingFeatures.length&&(g.isNone(a)?a=c.SetFromValues(h.keysOfSet(b.availableFields)):a.forEach(function(c){b.availableFields.has(c)||g.unwrap(a).delete(c)}))});
return g.isSome(a)?a:new Set},enumerable:!0,configurable:!0});f.prototype.applyEdits=function(a){var b=this;this.pendingEdits||(this.pendingEdits={edits:l.resolve(),count:0,controller:l.createAbortController()},this.pause());this.pendingEdits.count++;var c=this.pendingEdits.edits.then(function(){return a.result.catch(function(a){if(l.isAbortError(a))throw a;return null}).then(function(a){return a?(b.applyEditsDeleteFeatures(a.deletedFeatures),b.applyEditsAddUpdateFeatures(a.addedFeatures,a.updatedFeatures,
b.pendingEdits.controller.signal).then(function(){return a})):a}).then(function(a){0===--b.pendingEdits.count&&(b.pendingEdits=null,g.isSome(b.context.memoryCache)&&b.context.memoryCache.clear(),b.unpause(),b.updated());return a})});this.pendingEdits.edits=c;this.updated();return c};f.prototype.applyEditsDeleteFeatures=function(a){var b=this;if(0!==a.length){var c=new Set;a.forEach(function(a){return c.add(a.objectId)});this.featureTiles.forEach(function(a){if(a.features){var d=a.features.filter(function(a){return!c.has(t.getObjectId(a,
b.objectIdField))});d.length!==a.features.length&&(a.setFeatures(d,0,a.availableFields),b.invalidateCounts())}})}};f.prototype.applyEditsAddUpdateFeatures=function(b,c,d){return a.__awaiter(this,void 0,void 0,function(){var e,f,g,h=this;return a.__generator(this,function(a){switch(a.label){case 0:e=[];f=new Set;b.forEach(function(a){return e.push(a.objectId)});c.forEach(function(a){e.push(a.objectId);f.add(a.objectId)});if(0===e.length)return[2];g=[];this.featureTiles.forEach(function(a){(a=h.applyEditsAddUpdateTile(a,
e,f,d))&&g.push(a)});return[4,l.eachAlways(g)];case 1:return a.sent(),[2]}})})};f.prototype.applyEditsAddUpdateTile=function(b,c,d,e){return a.__awaiter(this,void 0,void 0,function(){var f,g,h,k,l,m,p,n=this;return a.__generator(this,function(a){switch(a.label){case 0:if(!b.features)return[2];f=this.createQuery(b);f.resultType=void 0;f.cacheHint=!1;f.objectIds=c;return[4,this.queryFeatures(f,e)];case 1:g=a.sent();h=null;0<d.size&&(k=b.features.filter(function(a){return!d.has(t.getObjectId(a,n.objectIdField))}),
k.length!==b.features.length&&(h=k));if(0<g.features.length)for(h||(h=b.features.slice()),l=0,m=g.features;l<m.length;l++)p=m[l],h.push(p);h&&(b.setFeatures(h,0,F(b.availableFields,g.fields)),this.invalidateCounts());return[2]}})})};f.prototype.queryFeatures=function(a,b){return this.context.query.queryFeaturesDehydrated(a,{signal:b,timeout:E})};f.prototype.setDirty=function(){this._dirty=!0;this.updated()};f.prototype.update=function(a){var b=this;this.maximumNumberOfFeaturesExceededNext&&performance.now()>=
this.maximumNumberOfFeaturesExceededNext&&this.updateMaximumNumberOfFeaturesExceeded();if(this._dirty&&this.constructed){this._dirty=!1;var c=this.getListOfTiles();this.markTilesNotAlive(c);if(a.run(function(){return b.addTiles(c,a)})&&a.run(function(){return b.filterExtentTiles(c,a)})&&a.run(function(){return b.removeTiles(c,a)})&&!a.done){var d=this.sortTiles(c);a.run(function(){return b.displayTiles(d,a)})&&a.run(function(){return b.fetchTiles(d,a)})&&a.run(function(){return b.updateMemoryEstimates(d,
a)})||this.setDirty();this.updated()}else this.setDirty()}};f.prototype.markTilesNotAlive=function(a){for(var b=0;b<a.length;b++)a[b].alive=!1};f.prototype.addTiles=function(a,b){var c=this;if(this.suspended)return!1;this.tileDescriptors.forEach(function(d){var e=c.featureTiles.get(d.id);e?e.alive=!0:b.done||(a.push(c.addTile(d)),b.madeProgress())});return b.hasProgressed};f.prototype.filterExtentTiles=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(b.done)break;d.alive&&(d.filtered=!d.intersects(this.filterExtent),
d.filtered&&(this.clearTile(d),b.madeProgress()))}return b.hasProgressed};f.prototype.removeTiles=function(a,b){for(var c=a.length-1;0<=c&&!b.done;c--){var d=a[c];d.alive||(this.removeTile(d),c!==a.length-1&&(a[c]=a[a.length-1]),a.pop(),b.madeProgress())}return b.hasProgressed};f.prototype.sortTiles=function(a){a.sort(function(a,b){return a.descriptor.loadPriority-b.descriptor.loadPriority});return a};f.prototype.displayTiles=function(a,b){for(var c=this,d=this.updateRatio(a),e=function(a){if(!b.run(function(){var b=
1>c._fullRatio?d(a)*c._farRatio:1;a.reduceFeatures(b,c.memoryFactor,c.objectIdField)&&c.setDirty();return c.showTile(a)}))return f.setDirty(),"break"},f=this,g=0;g<a.length&&"break"!==e(a[g]);g++);return b.hasProgressed};f.prototype.fetchTiles=function(a,b){var c=this;if(this.paused)return!1;for(var d=!1,e=function(a){if(!a.needsFetching)return"continue";var c=g.isSome(f.context.memoryCache)?f.context.memoryCache.pop(a.id):null;if(g.isSome(c))return a.cache=c,f.setDirty(),f.scheduleUpdated(),b.madeProgress(),
"continue";if(f.needsNumFeatures(a)){var c=l.createAbortController(),e=f.fetchTileCount(a,c.signal);f._handleRequest(a,e,c,function(){return a.numFeatures=w.FAILED_FEATURE_COUNT});d=!0;b.madeProgress()}if(b.done)return{value:!0}},f=this,h=0;h<a.length;h++){var k=a[h],k=e(k);if("object"===typeof k)return k.value}if(d)return b.hasProgressed;for(var e=function(a){if(a.needsFetching){var d=l.createAbortController(),e=m.fetchTile(a,d.signal);m._handleRequest(a,e,d,function(b){a.setFeatures([],0,null);
c.invalidateCounts();a.featuresMissing=!1;c.context.logFetchError(H,b)});b.madeProgress();if(b.done)return{value:!0}}},m=this,h=0;h<a.length;h++)if(k=a[h],k=e(k),"object"===typeof k)return k.value;return b.hasProgressed};f.prototype.updateMemoryEstimates=function(a,b){var c=this;a.some(function(a){return b.run(function(){return a.updateMemoryEstimates()})?!1:(c.setDirty(),!0)});return b.hasProgressed};f.prototype.reclip=function(a,b){var c=this;this.constructed&&(this.featureTiles.forEach(function(d){d.displayingFeatures&&
0!==d.displayingFeatures.length&&(d.intersection(b,G),d.intersection(a,J),r.equals(G,J)||c.hideTileFeatures(d))}),this.featureTiles.forEach(function(a){return c.showTile(a)}),this.updated())};f.prototype.updated=function(){var a=this,b=0;this.paused||this.featureTiles.forEach(function(a){return a.isFetching?++b:0});var c=this._dirty||0<b||!!this.pendingEdits;this._set("updating",c);if(c){var d=c=0,e=0,f=0,g=0,h=0,k=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.featureTiles.forEach(function(b){++e;
if(b.isFetching&&b.hasPreciseFeatureCount){var c=a.maximumFeaturesForTile(b)*(1-b.emptyFeatureRatio);h+=c-(b.displayingFeatures?b.displayingFeatures.length*k:0)}b.needsFetching?++g:0<b.numFeatures&&(++f,d+=b.numFeatures)});var g=g+b,l=0;d?(c=d,l=Math.min(g*d/f,d)):(c=e,l=g);h=Math.min(this.maximumNumberOfFeatures-this.features.length,h);this._set("updatingTotal",c);this._set("updatingRemaining",l);this._set("expectedFeatureDiff",h)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),
this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update();this.updating||(this.maximumNumberOfFeaturesExceededNext=this.maximumNumberOfFeaturesExceededNext||performance.now()+this.maximumNumberOfFeaturesExceededThrottle)};f.prototype.updateMaximumNumberOfFeaturesExceeded=function(){if(!this.updating){var a=!1;this.featureTiles.forEach(function(b){a=a||b.perTileMaximumNumberOfFeaturesExceeded});this.maximumNumberOfFeaturesExceededNext=0;this._set("maximumNumberOfFeaturesExceeded",a)}};
f.prototype.updateRatio=function(a){for(var b=B(a),c=function(a){return 1/(1<<Math.max(0,b-a.descriptor.lij[0]))},d=0,e=0,f=0;f<a.length;f++)var g=a[f],h=g.numFeatures,d=d+h,e=e+h*c(g);this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/d);this._farRatio=this.maximumNumberOfFeatures/e;this.scheduleUpdated();return c};f.prototype.maximumFeaturesUpdated=function(a,b){var c=this;a!==b&&(b>a&&this.featureTiles.forEach(function(a){if(a.featuresMissing){var b=c.maximumFeaturesForTile(a);a.features&&
(a.features.length>=b||5===a.fetchStatus)||(c.cancelFetchTile(a),c.resetFetchTile(a))}}),this.setDirty())};f.prototype.addTile=function(a){a=new w.FeatureTile(a);this.featureTiles.set(a.id,a);this.resetFetchTile(a);this.referenceDisplayingFeaturesFromRelatedTiles(a);return a};f.prototype.referenceDisplayingFeaturesFromRelatedTiles=function(a){var b=this,c=a.descriptor.resolution;this.featureTiles.forEach(function(d){if(d.displayingFeatures&&a!==d&&(!a.descriptor.lij||!d.descriptor.lij||q.tilesAreRelated(a.descriptor.lij,
d.descriptor.lij))){a.displayingFeatures=a.displayingFeatures||[];var e=0;for(d=d.displayingFeatures;e<d.length;e++){var f=d[e];a.displayingFeatures.push(f);f=b.displayingFeatureReferences.get(t.getObjectId(f,b.objectIdField));f.ref(f.feature,c);b.numDisplayingFeatureReferences++}}});a.featureLimit=a.displayingFeatures?a.displayingFeatures.length:0};f.prototype.removeTile=function(a){this.clearTile(a);this.featureTiles.delete(a.id)};f.prototype.resetFetchTile=function(a){a.filtered=!a.intersects(this.filterExtent);
a.filtered?a.needsFetching&&(a.fetchStatus=4):a.fetchStatus=0};f.prototype.cancelFetchTile=function(a){var b=a.requestController;g.isSome(b)&&(a.requestController=null,a.resetFetching(),b.abort())};f.prototype.fetchTileCount=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var d;return a.__generator(this,function(a){switch(a.label){case 0:return d=b,[4,this.fetchCount(b,c)];case 1:return d.numFeatures=a.sent(),this.updateRatio(this.getListOfTiles()),[2,3===b.fetchStatus?1:0]}})})};f.prototype.fetchTile=
function(b,c){return a.__awaiter(this,void 0,void 0,function(){var d,e,f,g,h,k,l,m,p,n,q;return a.__generator(this,function(a){switch(a.label){case 0:d=this.maximumFeaturesForTile(b);if(0>=d)return b.setFeatures([],0,null),b.featuresMissing=!1,[2,4];e=this.getMaxRecordCount(b);f=Math.ceil(d/e);if(A(b)||!this.context.capabilities.supportsMaxRecordCountFactor||b.numFeatures<=d&&f>v.MAX_MAX_RECORD_COUNT_FACTOR)return[2,this.fetchPagedTile(b,c)];g=this.createQuery(b);g.maxRecordCountFactor=Math.ceil(d/
e);b.isRefetching&&b.features&&0<b.features.length&&(h=Math.ceil(b.features.length/(1-b.emptyFeatureRatio)/e),g.maxRecordCountFactor=Math.max(h+1,g.maxRecordCountFactor));return[4,this.queryFeatures(g,c)];case 1:return k=a.sent(),l=k.features,m=k.exceededTransferLimit,p=k.fields,n=m?g.maxRecordCountFactor>=v.MAX_MAX_RECORD_COUNT_FACTOR?5:4:5,b.featuresMissing=l.length<b.numFeatures||m,q=this._removeEmptyFeatures(l),b.setFeatures(l,q,C(p)),this.invalidateCounts(),[2,n]}})})};f.prototype.fetchCount=
function(b,c){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return[2,this.context.query.queryFeatureCount(this.createFeatureCountQuery(b),{signal:c})]})})};f.prototype.fetchPagedTile=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var d,e,f,g,h,k,l,m,p,n,q,r,t;return a.__generator(this,function(a){switch(a.label){case 0:g=e=d=0,h=this.maximumFeaturesForTile(b)-g,k=this.getMaxRecordCount(b),l=null,a.label=1;case 1:return m=this.createQuery(b),
p=this.setPagingParameters(m,d,h,k),[4,this.queryFeatures(m,c)];case 2:return n=a.sent(),q=n.features,r=n.exceededTransferLimit,t=n.fields,p&&(d+=m.num),g+=q.length,e+=this._removeEmptyFeatures(q),b.featuresMissing=d<b.numFeatures||r,f=f?f.concat(q):q,l=F(l,t),b.setFeatures(f,e,l),this.invalidateCounts(),this.setDirty(),h=this.maximumFeaturesForTile(b)-g,!p||!r||0>=h?[2,r?4:5]:[3,1];case 3:return[2]}})})};f.prototype.createFeatureCountQuery=function(a){a=this.createQuery(a);this.context.capabilities.supportsCacheHint&&
(a.resultType=void 0,a.cacheHint=!0);return a};f.prototype.createQuery=function(a){var b=this.context.createQuery(),c=a.descriptor.extent;c&&(b.geometry=r.toExtent(c,this.context.tilingScheme.spatialReference));this.setResolutionParams(b,a);this.useTileQuery(a)?b.resultType="tile":this.context.capabilities.supportsCacheHint&&(b.cacheHint=!0);return b};f.prototype.setPagingParameters=function(a,b,c,d){if(!this.context.capabilities.supportsPagination)return!1;a.start=b;0<c&&this.context.capabilities.supportsMaxRecordCountFactor?
(a.maxRecordCountFactor=Math.ceil(c/d),a.num=Math.min(a.maxRecordCountFactor*d,c)):a.num=Math.min(d);return!0};f.prototype.getEffectiveTileResolution=function(a){if(null==a.descriptor.resolution)return null;var b="global"===this.context.viewingMode?this.context.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(a.descriptor.resolution,b)/this.lodFactor};Object.defineProperty(f.prototype,"supportsResolution",{get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==
this.context.geometryType},enumerable:!0,configurable:!0});f.prototype.setResolutionParams=function(a,b){this.supportsResolution&&(b=this.getEffectiveTileResolution(b),null!=b&&(this.context.capabilities.supportsQuantization?a.quantizationParameters=new u.default({mode:"view",originPosition:"upper-left",tolerance:b,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(a.maxAllowableOffset=b)))};f.prototype._removeEmptyFeatures=function(a){for(var b=a.length,c=0;c<a.length;)t.hasVertices(a[c].geometry)?
++c:(a[c]=a[a.length-1],--a.length);return b-a.length};f.prototype.needsNumFeatures=function(a){return this.useTileCount&&a.needsFeatureCount&&!A(a)};f.prototype.getMaxRecordCount=function(a){var b=this.context,c=b.tileMaxRecordCount,b=b.maxRecordCount;return this.useTileQuery(a)&&g.isSome(c)&&0<c&&this.context.capabilities.supportsResultType?c:g.isSome(b)&&0<b?b:I};f.prototype.useTileQuery=function(a){return A(a)&&this.context.capabilities.supportsCacheHint?!1:this.context.capabilities.supportsResultType};
f.prototype._handleRequest=function(a,b,c,d){var e=this;a.fetchStatus=a.needsRefetching?3:2;a.requestController=c;var f=!1;b.then(function(b){a.requestController=null;a.fetchStatus=b}).catch(function(b){a.requestController===c&&(a.requestController=null,a.fetchStatus=4);l.isAbortError(b)?f=!0:d(b)}).then(function(){f||e.setDirty();e.scheduleUpdated()})};f.prototype.scheduleUpdated=function(){var a=this;this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add(d.schedule(function(){a.handles.remove("scheduleUpdated");
a.updated()}),"scheduleUpdated")};f.prototype.showTile=function(a){if(a.displayingFeatures&&!a.needsDisplayUpdate)return!1;var b=a.features;if(0===a.featureLimit||!b)return b=a.displayingFeatures&&0<a.displayingFeatures.length,this.hideTileFeatures(a),a.displayingFeatures=[],b;var c=a.descriptor.resolution,d=this.changes.updates,e=this.changes.adds,f=Math.min(a.featureLimit,b.length);a.featureLimit=f;for(var g=0;g<f;++g){var h=b[g],k=t.getObjectId(h,this.objectIdField),l=this.displayingFeatureReferences.get(k);
l?(h=l.ref(h,c),h.oldVersion!==h.newVersion&&(d.removes.push(h.oldVersion),d.adds.push(h.newVersion))):(this.displayingFeatureReferences.set(k,new this.FeatureReferenceClass(h,c)),e.push(h));this.numDisplayingFeatureReferences++}this.hideTileFeatures(a);this.applyChanges();a.displayingFeatures=b.slice(0,f);return!0};f.prototype.hideTile=function(a){this.cancelFetchTile(a);this.hideTileFeatures(a)};f.prototype.hideTileFeatures=function(a){if(a.displayingFeatures){for(var b=this.changes.updates,c=this.changes.removes,
d=0,e=a.displayingFeatures;d<e.length;d++){var f=t.getObjectId(e[d],this.objectIdField),g=this.displayingFeatureReferences.get(f);g&&((g=g.unref(a.descriptor.resolution),this.numDisplayingFeatureReferences--,g)?g.oldVersion!==g.newVersion&&(null==g.newVersion?(this.displayingFeatureReferences.delete(f),c.push(g.oldVersion)):(b.adds.push(g.newVersion),b.removes.push(g.oldVersion))):console.error("Hiding unreferenced feature"))}this.applyChanges();a.displayingFeatures=null}};f.prototype.applyChanges=
function(){var a=this.changes.updates;0<a.removes.length&&(this.features.removeMany(a.removes),a.removes.length=0);0<a.adds.length&&(this.features.addMany(a.adds),a.adds.length=0);for(var a=this.changes.adds,b=this.changes.removes,c=Math.min(a.length,b.length),d=0;d<c;){var e=Math.min(d+L,c);this.features.addMany(a.slice(d,e));this.features.removeMany(b.slice(d,e));d=e}a.length>c&&this.features.addMany(0===d?a:a.slice(d));b.length>c&&this.features.removeMany(0===d?b:b.slice(d));a.length=0;b.length=
0};f.prototype.clearTile=function(a){this.hideTile(a);a.features&&g.isSome(this.context.memoryCache)&&this.context.memoryCache.put(a.id,a.cache,16+a.estimatedSize);a.setFeatures(null,0,null);this.invalidateCounts()};f.prototype.invalidateCounts=function(){this.notifyChange("totalVertices");this.notifyChange("totalFeatures");this.notifyChange("memoryForUnusedFeatures")};f.prototype.getListOfTiles=function(){var a=Array(this.featureTiles.size),b=0;this.featureTiles.forEach(function(c){return a[b++]=
c});return a};Object.defineProperty(f.prototype,"storedFeatures",{get:function(){return this.getListOfTiles().reduce(function(a,b){return a+(b.features?b.features.length:0)},0)},enumerable:!0,configurable:!0});f.prototype.maximumFeaturesForTile=function(a){var b=a.hasPreciseFeatureCount?a.numFeatures:Infinity;return Math.min(Math.ceil((a.hasPreciseFeatureCount?b:this.maximumNumberOfFeatures)*(1>this._fullRatio?this._farRatio:1)/(1-a.emptyFeatureRatio)),b)};Object.defineProperty(f.prototype,"test",
{get:function(){var a=this;return{update:function(b){return a.update(b)},getFeatureTileById:function(b){return a.featureTiles.get(b)},forEachFeatureTile:function(b){return a.featureTiles.forEach(b)}}},enumerable:!0,configurable:!0});a.__decorate([p.property({constructOnly:!0})],f.prototype,"features",void 0);a.__decorate([p.property()],f.prototype,"tileDescriptors",void 0);a.__decorate([p.property({value:Infinity})],f.prototype,"maximumNumberOfFeatures",null);a.__decorate([p.property({value:1})],
f.prototype,"memoryFactor",null);a.__decorate([p.property({value:1})],f.prototype,"lodFactor",null);a.__decorate([p.property({dependsOn:["context"]})],f.prototype,"useTileCount",null);a.__decorate([p.property({readOnly:!0})],f.prototype,"updating",void 0);a.__decorate([p.property({readOnly:!0})],f.prototype,"updatingTotal",void 0);a.__decorate([p.property({readOnly:!0})],f.prototype,"updatingRemaining",void 0);a.__decorate([p.property({readOnly:!0})],f.prototype,"expectedFeatureDiff",void 0);a.__decorate([p.property({readOnly:!0})],
f.prototype,"memoryForUnusedFeatures",null);a.__decorate([p.property({readOnly:!0})],f.prototype,"maximumNumberOfFeaturesExceeded",void 0);a.__decorate([p.property({constructOnly:!0})],f.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0);a.__decorate([p.property({readOnly:!0})],f.prototype,"totalVertices",null);a.__decorate([p.property({readOnly:!0})],f.prototype,"totalFeatures",null);a.__decorate([p.property()],f.prototype,"filterExtent",null);a.__decorate([p.property({constructOnly:!0})],
f.prototype,"context",void 0);return f=a.__decorate([p.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],f)}(m);b.FeatureTileFetcher3D=n;b.contextCapabilitiesFromLayer=function(a){var b=a.capabilities.query;a:switch(a.geometryType){case "polyline":a=!0;break a;case "polygon":a=a.capabilities&&a.capabilities.query&&a.capabilities.query.supportsQuantization;break a;default:a=!1}return{supportsMultipleResolutions:a,supportsPagination:!(!b||!b.supportsPagination),supportsResultType:!(!b||
!b.supportsResultType),supportsCacheHint:!(!b||!b.supportsCacheHint),supportsQuantization:!(!b||!b.supportsQuantization),supportsQuantizationEditMode:!(!b||!b.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!b||!b.supportsMaxRecordCountFactor),supportsFormatPBF:!(!b||!b.supportsFormatPBF)}};var I=2E3,G=r.create(),J=r.create(),E=6E5,L=200;b.default=n})},"esri/views/3d/layers/support/featureReference":function(){define(["require","exports","../../../../layers/graphics/dehydratedFeatures"],
function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b){this.highestResolutionVersion=null;this.versions=[];this.ref(a,b)}Object.defineProperty(b.prototype,"isReferenced",{get:function(){return 0!==this.versions.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isSingle",{get:function(){return 1===this.versions.length&&1===this.versions[0].refCount},enumerable:!0,configurable:!0});b.prototype.ref=function(b,f){var e=this.feature;m.oldVersion=
e;this.feature&&(b.uid=this.feature.uid);for(var h=0,d=this.versions;h<d.length;h++){var c=d[h];if(c.resolution===f){c.refCount++;if((f=this.highestResolutionVersion===c&&!a.equals(b,c.feature))||this.highestResolutionVersion!==c)c.feature=b;m.newVersion=f?b:e;return m}}c={feature:b,resolution:f,refCount:1};this.versions.push(c);!this.highestResolutionVersion||f<this.highestResolutionVersion.resolution?(m.newVersion=b,this.highestResolutionVersion=c):m.newVersion=e;return m};b.prototype.unref=function(a){for(var b=
0;b<this.versions.length;b++){var e=this.versions[b];if(e.resolution===a)return e.refCount--,m.oldVersion=this.feature,0===e.refCount&&(this.versions[b]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===e&&(this.recalculateHighestResolutionVersion(),m.oldVersion=e.feature)),m.newVersion=this.feature,m}return null};Object.defineProperty(b.prototype,"feature",{get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null},enumerable:!0,
configurable:!0});b.prototype.recalculateHighestResolutionVersion=function(){if(0===this.versions.length)this.highestResolutionVersion=null;else{for(var a=this.versions[0],b=1;b<this.versions.length;b++){var g=this.versions[b];g.resolution<a.resolution&&(a=g)}this.highestResolutionVersion=a}};return b}();b.MultiFeatureReference=n;n=function(){function b(a){this._feature=a;this.refCount=1}Object.defineProperty(b.prototype,"isReferenced",{get:function(){return 0!==this.refCount},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"isSingle",{get:function(){return 1===this.refCount},enumerable:!0,configurable:!0});b.prototype.ref=function(b){++this.refCount;m.oldVersion=this._feature;this.feature&&(b.uid=this.feature.uid);a.equals(this._feature,b)||(this._feature=b);m.newVersion=this._feature;return m};b.prototype.unref=function(){m.oldVersion=this._feature;if(0<this.refCount&&(this.refCount--,!this.isReferenced))return m.newVersion=null,m;m.newVersion=this._feature;return m};Object.defineProperty(b.prototype,
"feature",{get:function(){return this._feature},enumerable:!0,configurable:!0});return b}();b.SingleFeatureReference=n;var m={oldVersion:null,newVersion:null}})},"esri/views/3d/layers/support/FeatureTile":function(){define("require exports ../../../../core/arrayUtils ../../../../core/maybe ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});var f=new Set;n=function(){function b(a){this.descriptor=
a;this.fetchStatus=0;this._features=null;this._featureLimit=this._numVertices=0;this.featuresMissing=!0;this._shuffled=!1;this._numFeatures=g;this._emptyFeatureRatio=0;this._estimatedSize=-1;this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;this._availableFields=f;this.displayingFeatures=null;this.alive=!0;this.filtered=!1}Object.defineProperty(b.prototype,"perTileMaximumNumberOfFeaturesExceeded",{get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==
this.features.length)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"features",{get:function(){return this._features},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"featureLimit",{get:function(){return this._featureLimit},set:function(a){this._featureLimit!==a&&(this._featureLimit=a,this._estimatedUnusedSizeDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"availableFields",{get:function(){return this._availableFields},enumerable:!0,
configurable:!0});b.prototype.setFeatures=function(a,b,d){this._availableFields=m.unwrapOr(d,f);this._features=a;this._shuffled=!1;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0;a&&0<a.length?(this._emptyFeatureRatio=b/(a.length+b),this._numVertices=a.reduce(function(a,b){return a+e.numVertices(b.geometry)},0)):this._numVertices=this._emptyFeatureRatio=0};Object.defineProperty(b.prototype,"emptyFeatureRatio",{get:function(){return this._emptyFeatureRatio},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"numFeatures",{get:function(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0},set:function(a){this._numFeatures=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasPreciseFeatureCount",{get:function(){return this._numFeatures>g},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"needsFeatureCount",{get:function(){return this._numFeatures===g},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"id",{get:function(){return this.descriptor.id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"estimatedSize",{get:function(){this.updateMemoryEstimates();return this._estimatedSize},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"estimatedUnusedSize",{get:function(){return this._estimatedUnusedSize},enumerable:!0,configurable:!0});b.prototype.updateMemoryEstimates=
function(){if(0>this._estimatedSize){this._estimatedUnusedSize=this._estimatedSize=0;if(this._features)for(var a=0;a<this._features.length;++a){var b=e.estimateSize(this._features[a]);this._estimatedSize+=b;a>=this.featureLimit&&(this._estimatedUnusedSize+=b)}return!0}if(this._estimatedUnusedSizeDirty){this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;if(this._features)for(a=this.featureLimit;a<this._features.length;++a)this._estimatedUnusedSize+=e.estimateSize(this._features[a]);return!0}return!1};
Object.defineProperty(b.prototype,"isFetching",{get:function(){return 2===this.fetchStatus||3===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isRefetching",{get:function(){return 3===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"needsFetching",{get:function(){return 0===this.fetchStatus||1===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"needsRefetching",{get:function(){return 1===this.fetchStatus},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isFetched",{get:function(){return 4===this.fetchStatus||5===this.fetchStatus},enumerable:!0,configurable:!0});b.prototype.resetFetching=function(){this.fetchStatus=3===this.fetchStatus?1:0};Object.defineProperty(b.prototype,"needsDisplayUpdate",{get:function(){var a;if(a=!!this._features){a:{a=this._features;var b=this.displayingFeatures,d=this.featureLimit;if(!b||!a||d!==b.length||d>a.length)a=!1;else{for(var e=0;e<d;++e)if(a[e]!==
b[e]){a=!1;break a}a=!0}}a=!a}return a},enumerable:!0,configurable:!0});b.prototype.intersects=function(a){if(!a||!this.descriptor.extent)return!0;h.fromExtent(a,l);return h.intersects(this.descriptor.extent,l)};b.prototype.intersection=function(a,b){if(!a&&!this.descriptor.extent)return h.set(b,h.POSITIVE_INFINITY),b;a?(h.fromExtent(a,b),this.descriptor.extent&&h.intersection(b,this.descriptor.extent,b)):h.set(b,this.descriptor.extent);return b};b.prototype._shuffle=function(b){this._features.sort(function(a,
c){return e.getObjectId(a,b)-e.getObjectId(c,b)});a.shuffle(this._features,16438);this._estimatedUnusedSizeDirty=this._shuffled=!0};b.prototype.reduceFeatures=function(a,b,d){if(0>=a)return!1;var c=!1;this._features?(this.featureLimit=Math.ceil(this.numFeatures*a),this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,4===this.fetchStatus&&0<this._features.length&&(this.fetchStatus=1,c=!0)),!this._shuffled&&1>a&&this._shuffle(d),a=Math.max(this.featureLimit,Math.ceil(b*
this.numFeatures)),this._features.length>a&&(this._features.length=a,this.featuresMissing=!0,5===this.fetchStatus&&(this.fetchStatus=4))):this.featureLimit=0;return c};Object.defineProperty(b.prototype,"cache",{get:function(){return{availableFields:this._availableFields,features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},set:function(a){this.requestController=null;this._availableFields=a.availableFields;
this._features=a.features;this._numFeatures=a.numFeatures;this._emptyFeatureRatio=a.emptyFeatureRatio;this.fetchStatus=a.fetchStatus;this.featuresMissing=a.featuresMissing;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0},enumerable:!0,configurable:!0});return b}();b.FeatureTile=n;var g=-1;b.FAILED_FEATURE_COUNT=-2;var l=h.create()})},"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":function(){define("require exports ../../../../Graphic ../../../../geometry/Polygon ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../terrain/TilingScheme".split(" "),
function(n,b,a,m,h,e,f,g,l){Object.defineProperty(b,"__esModule",{value:!0});var d=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];n=function(){function b(a,b,c){this.loadingGraphics=new Map;this.loadedGraphics=new Map;this.pendingGraphics=new Map;this._enabled=!0;this.tileFetcher=a;this.view=c;this.tilingScheme=
new l(b);this.loadedSymbols=d.map(function(a){return new f(new h({material:{color:[a[0],a[1],a[2],.6]},outline:{color:"black",size:1}}))});this.loadingSymbols=[new f(new h({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))];this.pendingSymbols=[new f(new h({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))];this.dataExtentSymbol=new f(new h({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}b.prototype.destroy=function(){this.enabled=!1};Object.defineProperty(b.prototype,
"enabled",{get:function(){return this._enabled},set:function(a){this._enabled=a;this.update()},enumerable:!0,configurable:!0});b.prototype.update=function(){var a=this;this._enabled?(this.synchronizeMaps(this.loadingGraphics,{filter:function(a){return a.isFetching},symbols:this.loadingSymbols}),this.synchronizeMaps(this.loadedGraphics,{filter:function(a){return!a.isFetching},symbols:this.loadedSymbols}),this.synchronizeMaps(this.pendingGraphics,{filter:function(a){return!a.isFetching},symbols:this.pendingSymbols}),
this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach(function(b){a.view.graphics.removeMany(b)}),this.loadingGraphics.clear(),this.loadedGraphics.forEach(function(b){a.view.graphics.removeMany(b)}),this.loadedGraphics.clear(),this.pendingGraphics.forEach(function(b){a.view.graphics.removeMany(b)}),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))};b.prototype.showDataExtent=function(b){this.dataExtentGraphic&&
(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null);b&&(b=m.fromExtent(b),this.dataExtentGraphic=new a({geometry:b,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic))};b.prototype.synchronizeMaps=function(b,c){var d=this,f=[];b.forEach(function(a,b){var e=d.tileFetcher.test.getFeatureTileById(b);e&&c.filter(e)||(d.view.graphics.removeMany(a),f.push(b))});f.forEach(function(a){return b.delete(a)});this.tileFetcher.test.forEachFeatureTile(function(f){if(c.filter(f)&&
!b.has(f.id)){var h=f.descriptor.lij,k=h[0],l=h[1],m=h[2];d.tilingScheme.ensureMaxLod(k);var p=d.tilingScheme.getExtentGeometry(k,l,m),h=new a({geometry:p,symbol:c.symbols[k%c.symbols.length]}),k=new a({geometry:p.center,symbol:new e({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new g({text:k+"/"+l+"/"+m,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})}),k=[h,k];b.set(f.id,k);d.view.graphics.addMany(k)}})};return b}();
b.FeatureTileFetcher3DDebugger=n;b.default=n})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("require exports tslib ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ../../../renderers/support/renderingInfoUtils ../../../tasks/support/Query ./graphics/Graphics3DFeatureLikeLayerView ./graphics/QueryEngine ./support/projectExtentUtils ../../support/Scheduler".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u){Object.defineProperty(b,"__esModule",{value:!0});b.FeatureLikeLayerView3D=function(b){return function(b){function n(){var a=null!==b&&b.apply(this,arguments)||this;a.controller=null;a.asyncGraphicsUpdates=!1;a.suspendResumeExtentMode="computed";a.slicePlaneEnabled=!1;a.drapeSourceType=1;a.fullExtentInLocalViewSpatialReference=null;a.suspendResumeExtent=null;a._controllerCreated=!1;a.clippingExtent=null;a.supportsHeightUnitConversion=!0;a.pendingController=
null;a.queryEngine=null;return a}a.__extends(n,b);n.prototype.initialize=function(){var a=this,b=this.layer;"isTable"in b&&b.isTable?this.addResolvingPromise(e.reject(new m("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:b}))):(this._set("graphics3d",new p.default({owner:this,layer:b,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,
preferredUpdatePolicy:this.asyncGraphicsUpdates?1:0,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(b){return a.updateClippingExtent(b)}})),this.updatingHandles.add(this,"asyncGraphicsUpdates",function(b){a.graphics3d.graphicsCore.preferredUpdatePolicy=b?1:0}),this.updatingHandles.add(this,"suspendResumeExtentMode",function(b){a.graphics3d.suspendResumeExtentMode=b}),this.addResolvingPromise(this.graphics3d.setup().then(function(){return a.validateGeometryType()}).then(function(){return a.queryEngine=
new r.default({layerView:a,task:u.Task.FEATURE_QUERY_ENGINE})}).then(function(){return t.toViewIfLocal(a)}).then(function(b){return a.fullExtentInLocalViewSpatialReference=b}).then(function(){return a.initializeController()})),this.notifyChange("updating"))};n.prototype.destroy=function(){this.destroyPendingController();this.controller&&(this.controller.destroy(),this.controller=null);this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null));this.queryEngine&&(this.queryEngine.destroy(),
this.queryEngine=null);this.loadedGraphics=null};n.prototype.destroyPendingController=function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)};n.prototype.notifyGraphicUpdate=function(a,b){this.graphics3d.graphicsCore.notifyGraphicUpdate(a,b)};n.prototype.getRenderingInfo=function(a,b,d){(a=c.getRenderingInfo(a,{renderer:b,arcade:d}))&&a.color&&(b=a.color,b[0]/=255,b[1]/=255,b[2]/=255);return a};n.prototype.getRenderingInfoAsync=function(b,d,e,f){return a.__awaiter(this,
void 0,void 0,function(){return a.__generator(this,function(g){return[2,c.getRenderingInfoAsync(b,a.__assign({renderer:d,arcade:e},f))]})})};n.prototype.getGraphicFromGraphicUid=function(a){var b=this,c=null;this.loadedGraphics&&this.loadedGraphics.forEach(function(d){d.uid===a&&(c=l.hydrateGraphic(d,b.layer))});return c};Object.defineProperty(n.prototype,"graphics3DGraphics",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null},enumerable:!0,configurable:!0});
Object.defineProperty(n.prototype,"graphics3DGraphicsByObjectID",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"symbolUpdateType",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null},enumerable:!0,configurable:!0});n.prototype.whenGraphicBounds=function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(a,b):null};
n.prototype.computeAttachmentOrigin=function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(a,b):null};n.prototype.getSymbolLayerSize=function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.getSymbolLayerSize(a,b):null};n.prototype.queryFeatures=function(a,b){return this.queryEngine.executeQuery(this._ensureQuery(a),h.get(b,"signal"))};n.prototype.queryObjectIds=function(a,b){return this.queryEngine.executeQueryForIds(this._ensureQuery(a),h.get(b,"signal"))};
n.prototype.queryFeatureCount=function(a,b){return this.queryEngine.executeQueryForCount(this._ensureQuery(a),h.get(b,"signal"))};n.prototype.queryExtent=function(a,b){return this.queryEngine.executeQueryForExtent(this._ensureQuery(a),h.get(b,"signal"))};n.prototype._ensureQuery=function(a){return h.isNone(a)?this.createQuery():k.from(a)};n.prototype.highlight=function(a){return this.graphics3d.highlight(a,this.layer.objectIdField)};n.prototype.canResume=function(){return!b.prototype.canResume.call(this)||
this.graphics3d&&this.graphics3d.suspended?!1:!0};n.prototype.getSuspendInfo=function(){var c=b.prototype.getSuspendInfo.call(this);return this.graphics3d?a.__assign(a.__assign({},c),this.graphics3d.suspendInfo):c};n.prototype.isUpdating=function(){return!this.graphics3d||this.graphics3d.destroyed?!1:!(!(!this._controllerCreated||this.controller&&this.controller.updating)&&this.view.basemapTerrain&&this.view.basemapTerrain.ready&&!this.graphics3d.updating)};n.prototype.initializeController=function(){return a.__awaiter(this,
void 0,void 0,function(){var b;return a.__generator(this,function(a){switch(a.label){case 0:return[4,this.createController()];case 1:return this.pendingController=b=a.sent(),[4,b.when()];case 2:return a.sent(),this.setControllerWhenInitialized(b),[2]}})})};n.prototype.setControllerWhenInitialized=function(b){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.when()];case 1:return a.sent(),[3,3];case 2:return a.sent(),
[3,3];case 3:return this._controllerCreated=!0,this.notifyChange("updating"),this.isResolved()?[4,f.whenTrueOnce(this.view,"basemapTerrain.ready")]:(this.destroyPendingController(),[2]);case 4:return a.sent(),this.pendingController=null,this.controller=b,this.loadedGraphics=b.graphics,this.notifyChange("updating"),[2]}})})};n.prototype.updateClippingExtent=function(a){this.clippingExtent=a;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=
a,!0}};n.prototype.validateGeometryType=function(){switch(this.layer.geometryType){case "multipatch":case "multipoint":return e.reject(new m("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType}))}};n.prototype._getResourceInfo=function(){var a=this.controller&&this.controller instanceof d?this.controller:null;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:a?a.maximumNumberOfFeatures:-1,
totalNumberOfFeatures:a?a.serviceDataCount:-1,nodes:0,core:this.graphics3d.graphicsCore.performanceInfo,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.graphics3d.frustumVisibility.suspended,visibilityScale:!this.graphics3d.scaleVisibility.suspended}};Object.defineProperty(n.prototype,"performanceInfo",{get:function(){return this._getResourceInfo()},enumerable:!0,configurable:!0});a.__decorate([g.property()],n.prototype,"loadedGraphics",void 0);a.__decorate([g.property({dependsOn:["graphics3d.suspended"]})],
n.prototype,"suspended",void 0);a.__decorate([g.property({dependsOn:["graphics3d.updating","controller.updating"]})],n.prototype,"updating",void 0);a.__decorate([g.property()],n.prototype,"controller",void 0);a.__decorate([g.property()],n.prototype,"graphics3d",void 0);a.__decorate([g.property({readOnly:!0})],n.prototype,"asyncGraphicsUpdates",void 0);a.__decorate([g.property({readOnly:!0})],n.prototype,"suspendResumeExtentMode",void 0);a.__decorate([g.property({type:Boolean})],n.prototype,"slicePlaneEnabled",
void 0);a.__decorate([g.property({readOnly:!0,dependsOn:["graphics3d.suspendInfo"]})],n.prototype,"suspendInfo",void 0);a.__decorate([g.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],n.prototype,"hasDraped",void 0);return n=a.__decorate([g.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],n)}(b)}})},"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":function(){define("require exports tslib ../../../../Graphic ../../../../core/Accessor ../../../../core/compilerUtils ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/accessorSupport/diffUtils ../../../../geometry/support/webMercatorUtils ../../../../tasks/support/Query ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFilterVisibility ./Graphics3DFrustumVisibility ./Graphics3DObjectStates ./Graphics3DScaleVisibility ./graphicUtils ../support/attributeUtils ../../../support/WatchUpdatingTracking".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function h(a){a=b.call(this,a)||this;a._handles=new f;a.watchUpdatingTracking=new B.WatchUpdatingTracking;a.suspendResumeExtentMode="computed";a.dataExtent=null;a.suspendResumeExtent=null;return a}a.__extends(h,b);Object.defineProperty(h.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},
enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"suspendInfo",{get:function(){var a={};this.scaleVisibility&&this.scaleVisibility.suspended&&(a.outsideScaleRange=!0);this.frustumVisibility&&this.frustumVisibility.suspended&&(a.outsideOfView=!0);return a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating||this.watchUpdatingTracking&&
this.watchUpdatingTracking.updating)},enumerable:!0,configurable:!0});h.prototype.normalizeCtorArgs=function(a){var b=a.frustumVisibilityEnabled?new z:null,c=a.scaleVisibilityEnabled?new q:null,d=(a.filterVisibilityEnabled||a.timeExtentVisibilityEnabled)&&"multipatch"!==a.layer.geometryType?new v.Graphics3DFilterVisibility:null,e=a.elevationAlignmentEnabled?new u.default:null;return{graphicsCore:new t.Graphics3DCore({owner:a.owner,layer:a.layer,preferredUpdatePolicy:a.preferredUpdatePolicy,elevationFeatureExpressionEnabled:a.elevationFeatureExpressionEnabled,
graphicSymbolSupported:!1,hasZ:a.owner.hasZ,hasM:a.owner.hasM}),frustumVisibility:b,scaleVisibility:c,filterVisibility:d,elevationAlignment:e,updateClippingExtent:a.updateClippingExtent,suspendResumeExtentMode:a.suspendResumeExtentMode,dataExtent:a.dataExtent}};h.prototype.initialize=function(){var a=this;this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",function(){return a.scaleVisibility.layerMinMaxScaleChangeHandler()});this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,
"filter",function(){return a.filterVisibility.filterChanged()}),this.watchUpdatingTracking.add(this.owner,"timeExtent",function(){return a.filterVisibility.filterChanged()}));this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",function(b,d){c.diff(b,d)&&a.watchUpdatingTracking.addPromise(a.graphicsCore.elevationInfoChange())});this.watchUpdatingTracking.add(this.layer,"labelsVisible",function(){return a.graphicsCore.updateVisibilityInfo()});this.watchUpdatingTracking.add(this.layer,
"labelingInfo",function(b,d){c.diff(b,d)&&a.graphicsCore.updateLabelingInfo()})};h.prototype.setup=function(){return a.__awaiter(this,void 0,void 0,function(){var b,c,d,e,f=this;return a.__generator(this,function(a){switch(a.label){case 0:return this.frustumVisibility&&this.frustumVisibility.setup(this.owner),b=this.owner,c=this.owner.view.basemapTerrain,d=function(a,b,c){return f.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(a,b,c)},this.scaleVisibility&&this.scaleVisibility.setup(b,this.layer,
d,this.graphicsCore,c),this.filterVisibility&&("filter"in b||"timeExtent"in b)&&this.filterVisibility.setup(b,this.graphicsCore),this.elevationAlignment&&(e=b.view.elevationProvider,this.elevationAlignment.setup(b,d,this.graphicsCore,e)),this._set("objectStates",new w.Graphics3DObjectStates(this.graphicsCore)),this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set("deconfliction",b.view.deconflictor.addGraphicsOwner(this.graphicsCore)),[4,
g.logOnError(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates}))];case 1:return a.sent(),this.watchUpdatingTracking.add(this.layer,"renderer",function(a){return f.watchUpdatingTracking.addPromise(f.graphicsCore.rendererChange(a))}),this.watchUpdatingTracking.add(b,"fullOpacity",function(){return f.graphicsCore.opacityChange()}),
this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this.watchUpdatingTracking.add(b.view,"clippingArea",function(){return f._updateClippingExtent()}),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled?[4,g.logOnError(this.graphicsCore.updateLabelingInfo())]:[3,3];case 2:a.sent(),a.label=3;case 3:return[2]}})})};h.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);for(var a=0,b="watchUpdatingTracking frustumVisibility scaleVisibility filterVisibility elevationAlignment objectStates graphicsCore".split(" ");a<
b.length;a++){var c=b[a],d=this[c];d&&(d.destroy(),this._set(c,null))}this._set("layer",null);this._set("owner",null)};h.prototype.highlight=function(a,b){var c=this;if(a instanceof p){var d=this.objectStates.acquireSet(0,b),e=d.set,d=d.handle;this.owner.queryObjectIds(a).then(function(a){return c.objectStates.setObjectIds(e,a)});return d}if("number"===typeof a||"string"===typeof a||a instanceof m)return this.highlight([a],b);"toArray"in a&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof
m)if(b&&a[0].attributes&&null!==A.attributeLookup(a[0].attributes,b))a=a.map(function(a){return A.attributeLookup(a.attributes,b)});else{var f=a.map(function(a){return a.uid}),d=this.objectStates.acquireSet(0,null);a=d.set;d=d.handle;this.objectStates.setUids(a,f);return d}if("number"===typeof a[0]||"string"===typeof a[0])return f=a,d=this.objectStates.acquireSet(0,b),a=d.set,d=d.handle,this.objectStates.setObjectIds(a,f),d}return F};h.prototype._updateClippingExtent=function(){var a=this.owner.view.clippingArea;
this.graphicsCore.setClippingExtent(a,this.owner.view.spatialReference)&&(this.updateClippingExtent(a)||this.graphicsCore.recreateAllGraphics())};h.prototype.setupSuspendResumeExtent=function(){var a=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(l.init(this,"suspendResumeExtentMode",function(){a._handles.remove(C);switch(a.suspendResumeExtentMode){case "computed":a._handles.add(l.init(a.graphicsCore,"computedExtent",function(b){return a.updateSuspendResumeExtent(b)}),C);break;
case "data":a._handles.add(l.init(a,"dataExtent",function(b){return a.updateSuspendResumeExtent(b)}),C);break;default:e.neverReached(a.suspendResumeExtentMode)}}))};h.prototype.updateSuspendResumeExtent=function(a){a?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(a,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)};h.prototype.extentToSuspendResumeRect=function(a,b){var c=this.owner.view.spatialReference;if(!a.spatialReference.equals(c)){if(!k.canProject(a,c))return;
a=k.project(a,c)}return y.enlargeExtent(a,b,r.SUSPEND_RESUME_EXTENT_OPTIMISM)};h.prototype.suspendResumeExtentChanged=function(a){this.frustumVisibility&&this.frustumVisibility.setExtent(a);this.scaleVisibility&&this.scaleVisibility.setExtent(a)};a.__decorate([d.property({aliasOf:"graphicsCore.layer"})],h.prototype,"layer",void 0);a.__decorate([d.property({aliasOf:"graphicsCore.owner"})],h.prototype,"owner",void 0);a.__decorate([d.property({constructOnly:!0})],h.prototype,"updateClippingExtent",void 0);
a.__decorate([d.property({constructOnly:!0})],h.prototype,"graphicsCore",void 0);a.__decorate([d.property({constructOnly:!0})],h.prototype,"scaleVisibility",void 0);a.__decorate([d.property({constructOnly:!0})],h.prototype,"filterVisibility",void 0);a.__decorate([d.property({constructOnly:!0})],h.prototype,"elevationAlignment",void 0);a.__decorate([d.property({constructOnly:!0})],h.prototype,"frustumVisibility",void 0);a.__decorate([d.property({readOnly:!0})],h.prototype,"deconfliction",void 0);a.__decorate([d.property({readOnly:!0})],
h.prototype,"labeling",void 0);a.__decorate([d.property({readOnly:!0})],h.prototype,"objectStates",void 0);a.__decorate([d.property({readOnly:!0})],h.prototype,"watchUpdatingTracking",void 0);a.__decorate([d.property()],h.prototype,"suspendResumeExtentMode",void 0);a.__decorate([d.property()],h.prototype,"dataExtent",void 0);a.__decorate([d.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],h.prototype,"suspended",null);a.__decorate([d.property({readOnly:!0,
dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],h.prototype,"suspendInfo",null);a.__decorate([d.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","watchUpdatingTracking.updating"]})],h.prototype,"updating",null);return h=a.__decorate([d.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],h)}(h);b.default=n;var C="suspendResumeExtentMode",F={remove:function(){},pause:function(){},resume:function(){}}})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("require exports tslib ../../../../geometry ../../../../renderers ../../../../symbols ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/compilerUtils ../../../../core/Error ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/accessorSupport/diffUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../renderers/support/rendererConversion ../../../../support/arcadeOnDemand ../../../../symbols/support/defaults3D ../../../../symbols/support/symbolConversion ./ElevationQuery ./featureExpressionInfoUtils ./Graphics3DFeatureStore ./Graphics3DGraphic ./Graphics3DSymbolCreationContext ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./GraphicStateTracking ./graphicUtils ./SpatialIndex2D ./symbolComplexity ../support/StageLayerElevationProvider ../../support/projectionUtils ../../support/PropertiesPool ../../webgl-engine/lib/GridLocalOriginFactory ../../webgl-engine/lib/Layer ../../../support/Scheduler".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L,M,N,Q,R,W,O,U,P,ba,V,T,X,Y,da,fa,ga,ka,la){Object.defineProperty(b,"__esModule",{value:!0});var ia=C.vec3f64.create(),Z=F.create(),oa=k.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");n=function(b){function f(a){a=b.call(this,a)||this;a.propertiesPool=new fa.PropertiesPool({computedExtent:m.Extent},a);a.computedExtent=null;a.currentRenderer=null;a.rendererHasGeometryOperations=!1;a.graphicStateTracking=null;a.symbolCreationContext=
new O.Graphics3DSymbolCreationContext;a.graphics3DGraphics=new Map;a.stageLayer=null;a.stage=null;a.graphicsDrapedUids=new Set;a.graphicsBySymbol=new Map;a.symbolConversionCache=new Map;a.symbols=new Map;a.graphicsWithoutSymbol=new Map;a.graphicsWaitingForSymbol=new Set;a.handles=new c;a.suspendSymbolCleanup=!1;a._spatialReference=null;a.arcadeOnDemand=null;a.rendererChangeAbortController=null;a.elevationInfoChangeAbortController=null;a.setupAbortController=null;a.elevationAlignment=null;a.scaleVisibility=
null;a.filterVisibility=null;a._spatialIndex=null;a._updatingPendingLoadedGraphicsChange=null;a.featureStore=null;a.deconflictor=null;a.labeler=null;a.objectStates=null;a.viewElevationProvider=null;a.stageLayerElevationProvider=null;a.sharedSymbolResourcesOwnerHandle=null;a.whenGraphics3DGraphicRequests={};a.pendingUpdates=new Map;a.numberOfGraphics=0;a.numberOfGraphicsProvidingElevation=0;a.pendingAdds=0;a.pendingRemoves=0;a.pendingUpdatesPool=new v({allocator:function(a){return a||{add:null,renderingInfo:null,
abortController:null,state:0,remove:null}},deallocator:function(a){a.add=null;a.renderingInfo=null;a.remove=null;a.state=0;a.abortController=null;return a}});a.symbolWarningLogged=!1;a.geometryWarningLogged=!1;a.objectIdInvisibleSet=new Set;a._whenSymbolRemoved=new v;a.preferredUpdatePolicy=0;a._asyncUpdates=!1;a.elevationFeatureExpressionEnabled=!0;a.owner=null;a.layer=null;a.hasDraped=!1;a.graphicSymbolSupported=!0;a.getRenderingInfoWithoutRenderer=!1;a.hasZ=null;a.hasM=null;a._usedMemory=0;a._visible=
void 0;a._startCreateGraphics=!1;a.maxPendingUpdates=0;return a}a.__extends(f,b);k=f;Object.defineProperty(f.prototype,"spatialIndex",{get:function(){if(!this._spatialIndex){this._spatialIndex=new T.default({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,spatialReference:this._spatialReference,hasZ:this.hasZ,hasM:this.hasM});var a=0,b=Array(this.graphics3DGraphics.size);this.graphics3DGraphics.forEach(function(c){return b[a++]=c});this._spatialIndex.addMany(b)}return this._spatialIndex},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"asyncUpdates",{get:function(){return this._asyncUpdates},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"updating",{get:function(){return!!(0<this.graphicsWaitingForSymbol.size||this.needsUpdate()||this.elevationAlignment&&this.elevationAlignment.updating||this.scaleVisibility&&this.scaleVisibility.updating||this.filterVisibility&&this.filterVisibility.updating||this.rendererChangeAbortController||this.elevationInfoChangeAbortController||
this._updatingPendingLoadedGraphicsChange)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"updatingRemaining",{get:function(){return this.updating?this.pendingUpdates.size:0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"updatingTotal",{get:function(){return this.updating?this.maxPendingUpdates:0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"displayFeatureLimit",{get:function(){var a=this.owner&&this.owner.view&&this.owner.view.qualitySettings,
b=a?a.graphics3D.minTotalNumberOfFeatures:0,c=a?a.graphics3D.maxTotalNumberOfFeatures:0,a=a?a.graphics3D.maxTotalNumberOfPrimitives:0,d=this.maxSymbolComplexity,e=Math.max(b,Math.min(c,Math.ceil(a/Math.max(1,d?d.primitivesPerFeature:1)))),f=this._get("displayFeatureLimit");return f&&f.minimumTotalNumberOfFeatures===b&&f.maximumTotalNumberOfFeatures===c&&f.maximumTotalNumberOfPrimitives===a&&f.maximumSymbolComplexity===d&&f.maximumNumberOfFeatures===e?f:{minimumTotalNumberOfFeatures:b,maximumTotalNumberOfFeatures:c,
maximumTotalNumberOfPrimitives:a,maximumSymbolComplexity:d,maximumNumberOfFeatures:e}},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"maxSymbolComplexity",{get:function(){for(var a=null,b=this.symbolComplexities,c=this._get("maxSymbolComplexity"),d=!1,e=0;e<b.length;e++){var f=b[e];if(!a||0===a.primitivesPerCoordinate&&f.primitivesPerFeature>a.primitivesPerFeature||0!==a.primitivesPerCoordinate&&f.primitivesPerCoordinate>a.primitivesPerCoordinate)a=f;d=d||f.estimated}return!a||
d&&c&&(c.primitivesPerFeature>=a.primitivesPerFeature||c.primitivesPerCoordinate>=a.primitivesPerCoordinate)||c&&c.primitivesPerFeature===a.primitivesPerFeature&&c.primitivesPerCoordinate===a.primitivesPerCoordinate?c:a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"spatialReference",{get:function(){return this._spatialReference},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"usedMemory",{get:function(){return this._usedMemory+(this.maxSymbolComplexity&&this.labelsEnabled?
this.maxSymbolComplexity.memory.bytesPerFeatureLabel*this.numberOfGraphics:0)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"usedMemoryPerGraphic",{get:function(){return this._usedMemory&&this.numberOfGraphics?this._usedMemory/this.numberOfGraphics:this.maxSymbolComplexity?this.maxSymbolComplexity.memory.bytesPerFeature+(this.labelsEnabled?this.maxSymbolComplexity.memory.bytesPerFeatureLabel:0):0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"unprocessedMemoryEstimate",
{get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"symbolComplexities",{get:function(){return this.currentRenderer?this.getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this.getSymbolComplexitiesUsed()},enumerable:!0,configurable:!0});f.prototype.getConvertedSymbol=function(a){if("web-style"===a.type)return a.clone();var b=this.symbolConversionCache.get(a.id);if(void 0!==b)return b;
var b=M.to3D(a,!0,!1,this.hasLabelingContext(a)),c=b.symbol||null;c||b.error&&oa.error(b.error.message);this.symbolConversionCache.set(a.id,c);return c};f.prototype.getSymbolComplexitiesUsedOrRenderer=function(a){if(t.isNone(a))return[];var b=a.getSymbols(),c="backgroundFillSymbol"in a&&a.backgroundFillSymbol;if(!(c||b&&b.length))return[];a=[];c=this.getSymbolComplexityUsedOrRenderer(c);t.isSome(c)&&a.push(c);for(c=0;c<b.length;c++){var d=this.getSymbolComplexityUsedOrRenderer(b[c]);t.isSome(d)&&
a.push(d)}return a};f.prototype.getSymbolComplexityUsedOrRenderer=function(a){if(t.isNone(a))return null;var b=this.symbols.get(a.id);return t.isSome(b)?b.complexity:(a=this.getConvertedSymbol(a))?X.defaultSymbolComplexity(a):null};f.prototype.getSymbolComplexitiesUsed=function(){var a=[];this.symbols.forEach(function(b){t.isSome(b)&&a.push(b.complexity)});return a};f.prototype.initialize=function(){var a=this;this._spatialReference=this.owner.view.spatialReference;this._set("featureStore",new R.default({objectIdField:this.owner.layer&&
this.owner.layer.objectIdField,hasZ:this.hasZ,hasM:this.hasM,spatialReference:this._spatialReference,getSpatialIndex:function(){return a.spatialIndex},forAllGraphics:function(b){return a.graphics3DGraphics.forEach(b)}}))};f.prototype.setup=function(b){return a.__awaiter(this,void 0,void 0,function(){var c,d,e,f,g,h=this;return a.__generator(this,function(a){switch(a.label){case 0:return this.setupAbortController=z.createAbortController(),c=this.setupAbortController.signal,this._set("elevationAlignment",
b.elevationAlignment),this._set("scaleVisibility",b.scaleVisibility),this._set("filterVisibility",b.filterVisibility),this._set("deconflictor",b.deconflictor),this._set("labeler",b.labeler),this._set("objectStates",b.objectStates),d=this.owner.view,this.viewElevationProvider=new N.ViewElevationProvider(this._spatialReference,d),this.initializeStage(d,this.layer.uid),this.symbolCreationContext.sharedResources=d.sharedSymbolResources,this.sharedSymbolResourcesOwnerHandle=d.sharedSymbolResources.addGraphicsOwner(this.owner),
t.isSome(this.currentRenderer)&&(this.symbolCreationContext.renderer=this.currentRenderer),this.symbolCreationContext.stage=this.stage,this.symbolCreationContext.streamDataRequester=d.sharedSymbolResources.streamDataRequester,this.symbolCreationContext.renderCoordsHelper=d.renderCoordsHelper,this.symbolCreationContext.layer=this.layer,this.symbolCreationContext.layerView=this.owner,this.symbolCreationContext.localOriginFactory=new ga,this.symbolCreationContext.elevationProvider=d.elevationProvider,
this.symbolCreationContext.notifyGraphicUpdate=function(a,b){return h.notifyGraphicUpdate(a,b)},e=Q.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled),f=this.symbolCreationContext,[4,Q.createContext(e,this._spatialReference,oa)];case 1:f.featureExpressionInfoContext=a.sent(),z.throwIfAborted(c),this.symbolCreationContext.screenSizePerspectiveEnabled=d.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=
!!this.owner.slicePlaneEnabled,this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings.physicallyBasedRenderingEnabled,this.handles.add(this.owner.watch("suspended",function(){return h.updateLayerVisibility()})),g="layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled",this.handles.add([this.owner.watch(g,function(){var a=d.screenSizePerspectiveEnabled&&h.layer.screenSizePerspectiveEnabled;
a!==h.symbolCreationContext.screenSizePerspectiveEnabled&&(h.symbolCreationContext.screenSizePerspectiveEnabled=a,h.recreateAllGraphics())}),q.init(this,"preferredUpdatePolicy",function(){return h.updateUpdatePolicy()},!0),this.owner.watch("slicePlaneEnabled",function(a){return h.slicePlaneEnabledChange(!!a)}),this.owner.view.watch("pixelRatio",function(){return h.pixelRatioChange()}),this.owner.view.watch("qualitySettings.physicallyBasedRenderingEnabled",function(a){return h.physicalBasedRenderingChange(a)}),
q.when(d.basemapTerrain,"tilingScheme",function(a){a.spatialReference.equals(h.symbolCreationContext.overlaySR)||(h.symbolCreationContext.overlaySR=d.basemapTerrain.spatialReference);h.handles.has("loaded-graphics")?h.recreateAllGraphics():h.handles.add([q.on(h.owner,"loadedGraphics","change",function(a){return h.graphicsCollectionChanged(a)},function(){return h.recreateAllGraphics()}),q.on(h.owner,"loadedGraphics","after-changes",function(){return h._signalUpdatingDuringAsyncLoadedGraphicsChange()},
function(){return h._signalUpdatingDuringAsyncLoadedGraphicsChange()})],"loaded-graphics")}),d.resourceController.scheduler.registerTask(la.Task.GRAPHICS_CORE,function(a){return h.update(a)},function(){return h.needsUpdate()})]),this.owner.layer&&"featureReduction"in this.owner.layer&&this.handles.add(this.owner.watch("layer.featureReduction",function(){return h.deconflictor.featureReductionChange()})),this.notifyChange("maxSymbolComplexity"),a.label=2;case 2:return a.trys.push([2,4,,5]),[4,this.rendererChange(this.layer.renderer)];
case 3:return a.sent(),[3,5];case 4:return a.sent(),[3,5];case 5:return z.throwIfAborted(c),this.setupAbortController=null,[2]}})})};f.prototype.abortSetup=function(){this.setupAbortController&&(this.setupAbortController.abort(),this.setupAbortController=null)};f.prototype.destroy=function(){this.abortSetup();this.abortRendererChange();this.abortElevationInfoChange();this.owner.view.deconflictor.removeGraphicsOwner(this);this.owner.view.labeler.removeGraphicsOwner(this);this._updatingPendingLoadedGraphicsChange&&
(this._updatingPendingLoadedGraphicsChange.remove(),this._updatingPendingLoadedGraphicsChange=null);this.clear();t.isSome(this.graphicStateTracking)&&(this.graphicStateTracking.destroy(),this.graphicStateTracking=null);this.stage&&(this.stage.removeFromViewContent([this.stageLayer.id]),this.stage.remove(0,this.stageLayer.id),this.stage=this.stageLayer=null);this.handles.destroy();this._spatialReference=this.handles=null;this._set("owner",null);for(var a in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[a].reject(new d("graphic:layer-destroyed",
"Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null;this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null);this.pendingUpdatesPool=null;this.symbolConversionCache.clear();this.objectIdInvisibleSet.clear();this._spatialIndex&&(this._spatialIndex.destroy(),this._spatialIndex=null);this.featureStore&&(this.featureStore.destroy(),this._set("featureStore",
null))};f.prototype.clear=function(){this.objectStates&&this.objectStates.allGraphicsDeleted();t.isSome(this.graphicStateTracking)&&this.graphicStateTracking.allGraphicsDeleted();this.graphics3DGraphics.forEach(function(a){return a.destroy()});this._spatialIndex&&this._spatialIndex.clear();this.graphics3DGraphics.clear();this._usedMemory=this.numberOfGraphics=0;this.updateLayerVisibility();this.symbols.forEach(function(a){t.isSome(a)&&a.destroy()});this.symbols.clear();this.graphicsBySymbol.clear();
this.graphicsWithoutSymbol.clear();this.graphicsWaitingForSymbol.clear();this.pendingUpdates.clear();this.pendingUpdatesPool.clear();this.pendingRemoves=this.pendingAdds=this.maxPendingUpdates=0;this._set("hasDraped",!1);this.notifyChange("updating");this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining");this.featureStore.events.emit("changed")};f.prototype.initializeStage=function(a,b){var c=this;this.stage=a._stage;this.stageLayer=new ka(b,{isPickable:!this.owner.suspended},b);
this.stage.add(0,this.stageLayer);this.stage.addToViewContent([this.stageLayer.id]);this.stageLayer.on("dirty",function(a){if(c.graphicStateTracking)switch(a.dirtyType){case "objTransformation":case "objGeometryAdded":case "objGeometryRemoved":case "objGeometryReplaced":case "objGeometryTransformation":case "shaderTransformationChanged":case "vertexAttrsUpdated":a=a.origin.metadata.graphicUid;c.notifyGraphicUpdate(a,2);break;case "visibilityChanged":a=a.origin.metadata.graphicUid,c.notifyGraphicUpdate(a,
1)}})};f.prototype.notifyGraphicUpdate=function(a,b){switch(b){case 1:this.notifyGraphicVisibilityChanged(a);break;case 2:this.notifyGraphicGeometryChanged(a)}};f.prototype.notifyGraphicGeometryChanged=function(a){t.isNone(this.graphicStateTracking)||(a=this.graphics3DGraphics.get(a))&&this.graphicStateTracking.updateGraphicGeometry(a)};f.prototype.notifyGraphicVisibilityChanged=function(a){t.isNone(this.graphicStateTracking)||(a=this.graphics3DGraphics.get(a))&&this.graphicStateTracking.updateGraphicVisibility(a)};
f.prototype.updateLayerVisibility=function(){var a=this.numberOfGraphics>this.displayFeatureLimit.maximumNumberOfFeatures*ta,a=!this.owner.suspended&&!a;a!==this._visible&&((this._visible=a)?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()),this.updateStageLayerVisibility())};f.prototype.updateStageLayerVisibility=function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||0<this.layer.opacity)};f.prototype.getGraphics3DGraphicById=
function(a){return this.graphics3DGraphics.get(a)};f.prototype.getGraphics3DGraphicByObjectId=function(a){var b=this;if(!this.owner.layer||!this.owner.layer.objectIdField)return null;var c=null;p.someMap(this.graphics3DGraphics,function(d){return b._getGraphicObjectID(d.graphic)===a?(c=d,!1):!0});return c};f.prototype._getGraphicObjectID=function(a,b){void 0===b&&(b=this.owner.layer&&this.owner.layer.objectIdField);return G.getObjectId(a,b)};Object.defineProperty(f.prototype,"graphics3DGraphicsByObjectID",
{get:function(){var a=this,b=this.owner.layer&&this.owner.layer.objectIdField;if(!b)return null;var c=new Map;this.graphics3DGraphics.forEach(function(d){if(d){var e=a._getGraphicObjectID(d.graphic,b);t.isSome(e)&&c.set(e,d)}});return c},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"labelsEnabled",{get:function(){return!(!this.labeler||!this.labeler.layerLabelsEnabled())},enumerable:!0,configurable:!0});f.prototype.updateLabelingInfo=function(b){return a.__awaiter(this,void 0,
void 0,function(){var c,d;return a.__generator(this,function(a){switch(a.label){case 0:return c=this.deconflictor&&this.deconflictor.labelingInfoChange(b),d=this.labeler&&this.labeler.labelingInfoChange(b),[4,z.eachAlways([c,d])];case 1:return a.sent(),[2]}})})};f.prototype.updateVisibilityInfo=function(){this.deconflictor&&this.deconflictor.labelingInfoChange();this.labeler&&this.labeler.visibilityInfoChange()};Object.defineProperty(f.prototype,"symbolUpdateType",{get:function(){var a=this;if(0<
this.pendingUpdates.size)return"unknown";var b=0,c=0;return p.someMap(this.symbols,function(d,e){if(t.isSome(d)){d=d.getFastUpdateStatus();if(0<d.loading)return!0;a.graphicsBySymbol.has(e)&&(c+=d.fast,b+=d.slow)}return!1})?"unknown":0<=c&&0===b?"fast":0<=b&&0===c?"slow":"mixed"},enumerable:!0,configurable:!0});f.prototype.needsUpdate=function(){return 0<this.pendingUpdates.size};f.prototype.update=function(a){this._applyPendingUpdates(a);this.needsUpdate()||this.notifyChange("updating")};f.prototype.setObjectIdVisibility=
function(a,b){b?this.objectIdInvisibleSet.delete(a):this.objectIdInvisibleSet.add(a);a=this._findGraphics3DGraphicByObjectId(a);t.isSome(a)&&this._updateUserVisibility(a)};f.prototype._findGraphics3DGraphicByObjectId=function(a){var b=this,c;p.someMap(this.graphics3DGraphics,function(d){return b._getGraphicObjectID(d.graphic)===a?(c=d,!0):!1});return c};f.prototype._updateUserVisibility=function(a){if(t.isNone(a))return!1;var b=a.graphic,c=this._getGraphicObjectID(b),b=b.visible&&!this.owner.suspended&&
(t.isNone(c)||!this.objectIdInvisibleSet.has(c));return a.setVisibilityFlag(0,b,0)};f.prototype.whenGraphics3DGraphic=function(a){var b=this.graphics3DGraphics.get(a.uid);if(b)return z.resolve(b);if(b=this.whenGraphics3DGraphicRequests[a.uid])return b.promise;b=z.createDeferred();this.whenGraphics3DGraphicRequests[a.uid]=b;return b.promise};f.prototype.boundsForGraphics3DGraphic=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var d,e,f,g,h,k,l,m,p,n;return a.__generator(this,function(a){switch(a.label){case 0:return d=
this._spatialReference,e=this.owner.view.renderSpatialReference,f=this.owner.view.basemapTerrain.spatialReference,g=function(a,b,c){return da.bufferToBuffer(a,e,b,a,d,b,c)},h=function(a,b,c){return da.bufferToBuffer(a,f,b,a,d,b,c)},k=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:t.isSome(c)&&c.useViewElevation,minDemResolution:t.isSome(c)&&c.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null,[4,b.getProjectedBoundingBox(g,h,k,t.get(c,"signal"))];
case 1:l=a.sent();if(!l)return[2,null];m=l.boundingBox;l.requiresDrapedElevation&&(p=this.symbolCreationContext.elevationProvider)&&(F.center(m,ia),n=p.getElevation(ia[0],ia[1],0,d)||0,m[2]=Math.min(m[2],n),m[5]=Math.max(m[5],n));return[2,{boundingBox:m,screenSpaceObjects:l.screenSpaceObjects}]}})})};f.prototype.whenGraphicBounds=function(a,b){var c=this;return q.whenOnce(this.owner,"loadedGraphics").then(function(){var b=c.owner.layer&&c.owner.layer.objectIdField,e=c.owner.loadedGraphics.find(function(c){return c===
a?!0:b&&c.attributes&&a.attributes&&c.attributes[b]===a.attributes[b]});if(e)return c.whenGraphics3DGraphic(e);throw new d("internal:graphic-not-part-of-view","Graphic is not part of this view");}).then(function(a){return c.boundsForGraphics3DGraphic(a,b)})};f.prototype.computeAttachmentOrigin=function(a,b){a=this.graphics3DGraphics.get(a.uid);if(!a)return null;var c=a.computeAttachmentOrigin();if(0===c.render.num&&0===c.draped.num)return null;B.vec3.set(ra,0,0,0);a=0;if(0<c.render.num){if(!da.vectorToVector(c.render.origin,
this.symbolCreationContext.renderCoordsHelper.spatialReference,xa,b))return null;B.vec3.add(ra,ra,xa);a++}if(0<c.draped.num){var d=c.draped.origin,c=d[0],d=d[1],e=this.viewElevationProvider.getElevation(c,d,"ground")||0;B.vec3.set(xa,c,d,e);if(!da.vectorToVector(xa,this.viewElevationProvider.spatialReference,xa,b))return null;B.vec3.add(ra,ra,xa);a++}1<a&&B.vec3.scale(ra,ra,1/a);return new m.Point({x:ra[0],y:ra[1],z:ra[2],spatialReference:b})};f.prototype.getSymbolLayerSize=function(a,b){var c=this.symbols.get(a.id);
if(t.isNone(c))throw new d("internal:symbol-not-part-of-view","Symbol is not part of this view");a=a.symbolLayers.indexOf(b);if(-1===a)throw new d("internal:missing-symbol-layer","Symbol layer is not in symbol");c=c.getSymbolLayerSize(a);if(null==c)throw new d("internal:missing-size","Symbol layer has no valid size");return c};f.prototype.graphicsCollectionChanged=function(a){this._startCreateGraphics&&(this.add(a.added),this.remove(a.removed))};f.prototype.graphicUpdateHandler=function(a){var b=
a.graphic.uid,c=this.graphics3DGraphics.get(b),b=this.graphicsWithoutSymbol.get(b);if(c||b)switch(a.property){case "visible":this.graphicUpdateVisibleHandler(c);break;case "geometry":this.graphicUpdateGeometryHandler(c,a);break;case "symbol":this.graphicUpdateSymbolHandler(c,a);break;case "attributes":break;default:l.neverReached(a)}};f.prototype.graphicUpdateGeometryHandler=function(a,b){var c=b.graphic.geometry;if(t.isNone(c))this.recreateGraphic(b.graphic);else if(t.isNone(a)){if(a=b.graphic.symbol&&
b.graphic.symbol.id)if(a=this.symbols.get(a),t.isSome(a)&&0===a.loadStatus)return;this.recreateGraphic(b.graphic)}else a.graphics3DSymbol.updateGeometry(a,b.newValue)||this.recreateGraphic(a.graphic),this.expandComputedExtent(c)};f.prototype.graphicUpdateSymbolHandler=function(a,b){var c=b.graphic,d=t.isSome(a)?a.graphics3DSymbol:b.oldValue&&this.symbols.get(b.oldValue.id);if(t.isNone(d))this.recreateGraphic(c);else{var e=d.symbol;b=this.getConvertedSymbol(b.newValue);if(b.type!==e.type||"web-style"===
b.type||"web-style"===e.type)this.recreateGraphic(c);else{var f=this.graphicsBySymbol.get(e.id);if(f&&1!==f.size)this.recreateGraphic(c);else if(f=A.diff(e,b),t.isNone(f))this.updateSymbolMapping(e.id,b);else if(f={diff:f,graphics3DGraphicPatches:[],symbolStatePatches:[]},d.prepareSymbolPatch(f),A.isEmpty(f.diff)){for(var g=0,h=f.symbolStatePatches;g<h.length;g++)d=h[g],d();c=this._getRenderingInfo(c);if(t.isSome(a))for(g=0,f=f.graphics3DGraphicPatches;g<f.length;g++)d=f[g],d(a,c);this.updateSymbolMapping(e.id,
b)}else this.recreateGraphic(c)}}};f.prototype.graphicUpdateVisibleHandler=function(a){this._updateUserVisibility(a)&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())};f.prototype.recreateGraphic=function(a){a=[a];this.suspendSymbolCleanup=!0;this.remove(a);this.add(a);this.suspendSymbolCleanup=!1;this.asyncUpdates||this._cleanupSymbols()};f.prototype._beginGraphicUpdate=function(a){this.graphicsWaitingForSymbol.add(a.uid);1===this.graphicsWaitingForSymbol.size&&
this.notifyChange("updating");this._get("symbolsUpdating")||this._set("symbolsUpdating",!0)};f.prototype._endGraphicUpdate=function(a){a&&(this.graphicsWaitingForSymbol.delete(a.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"),this._get("symbolsUpdating")&&(this.owner.view.flushDisplayModifications(),this._set("symbolsUpdating",!1))))};f.prototype.expandComputedExtent=function(a){var b=a.spatialReference;G.computeAABB(a,Z);a=this._spatialReference;
var c=k.tmpVec;!b.equals(a)&&da.xyzToVector(Z[0],Z[1],0,b,c,a)&&(Z[0]=c[0],Z[1]=c[1],da.xyzToVector(Z[3],Z[4],0,b,c,a),Z[3]=c[0],Z[4]=c[1]);if(r.isFinite(Z[0])&&r.isFinite(Z[3])&&r.isFinite(Z[1])&&r.isFinite(Z[4])){var b=this.computedExtent,c=null,d=r.isFinite(Z[2])&&r.isFinite(Z[5]),e=d&&(!b||null==b.zmin||Z[2]<b.zmin),d=d&&(!b||null==b.zmax||Z[5]>b.zmax);if(b){if(Z[0]<b.xmin||Z[1]<b.ymin||Z[3]>b.xmax||Z[4]>b.ymax||e||d)c=this.propertiesPool.get("computedExtent"),c.xmin=Math.min(Z[0],b.xmin),c.ymin=
Math.min(Z[1],b.ymin),c.xmax=Math.max(Z[3],b.xmax),c.ymax=Math.max(Z[4],b.ymax),c.spatialReference=a}else c=this.propertiesPool.get("computedExtent"),c.xmin=Z[0],c.ymin=Z[1],c.xmax=Z[3],c.ymax=Z[4],c.spatialReference=a;c&&(e&&(c.zmin=Z[2]),d&&(c.zmax=Z[5]),this._set("computedExtent",c))}};f.prototype.updateHasDraped=function(){this._set("hasDraped",0<this.graphicsDrapedUids.size)};f.prototype.abortElevationInfoChange=function(){this.elevationInfoChangeAbortController&&(this.elevationInfoChangeAbortController.abort(),
this.elevationInfoChangeAbortController=null)};f.prototype.elevationInfoChange=function(){return a.__awaiter(this,void 0,void 0,function(){var b,c,d,e=this;return a.__generator(this,function(a){switch(a.label){case 0:return this.abortElevationInfoChange(),this.elevationInfoChangeAbortController=b=z.createAbortController(),c=Q.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled),d=this.symbolCreationContext,[4,Q.createContext(c,this._spatialReference,oa)];case 1:return d.featureExpressionInfoContext=
a.sent(),z.throwIfAborted(b),this.elevationInfoChangeAbortController=null,this.labeler&&this.labeler.elevationInfoChange(),this.forEachGraphics3DSymbol(function(a,b,c){a.globalPropertyChanged("elevationInfo",b)?b.forEach(function(a){var b=a.graphic,c=0;for(a=a.labelGraphics;c<a.length;c++){var d=a[c];d.graphics3DSymbolLayer.updateGraphicElevationContext(b,d)}}):e._recreateSymbol(c)}),this.updateStageLayerElevationProvider(),this.elevationAlignment&&this.elevationAlignment.elevationInfoChange(),[2]}})})};
f.prototype.updateStageLayerElevationProvider=function(){if(this.stageLayerElevationProvider){if(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this.numberOfGraphicsProvidingElevation)this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null}else(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&0<this.numberOfGraphicsProvidingElevation&&
(this.stageLayerElevationProvider=new Y.StageLayerElevationProvider({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this.stageLayerElevationProvider))};f.prototype.clearSymbolsAndGraphics=function(){this.clear();this.filterVisibility&&this.filterVisibility.clear();this.labeler&&this.labeler.reset();this.deconflictor&&this.deconflictor.clear();this.elevationAlignment&&this.elevationAlignment.clear();this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator();
this.stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null)};f.prototype.startCreateGraphics=function(){this._startCreateGraphics=!0;this.recreateAllGraphics()};f.prototype.recreateAllGraphics=function(){this._startCreateGraphics&&(this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&
this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.loadedGraphics.length&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))};f.prototype._recreateSymbol=function(a){var b=this,c=this.graphicsBySymbol.get(a),d=[];c&&(c.forEach(function(a,c){var e=a.usedMemory;b._conditionalRemove(a,c);b._spatialIndex&&b._spatialIndex.remove(a);d.push(a.graphic);a.destroy();
b.removeGraphics3DGraphic(c,e);b.updateLayerVisibility();b.featureStore.events.emit("changed")}),this.graphicsBySymbol.set(a,new Map));c=this.symbols.get(a);t.isSome(c)&&c.destroy();this.symbols.delete(a);this.updateHasDraped();this.add(d)};f.prototype._conditionalRemove=function(a,b){a.isDraped&&this.graphicsDrapedUids.delete(b);this.objectStates&&this.objectStates.removeGraphic(a);this.labeler&&this.labeler.removeGraphic(a);this.deconflictor&&this.deconflictor.removeGraphic(a);t.isSome(this.graphicStateTracking)&&
this.graphicStateTracking.removeGraphic(a)};f.prototype.add=function(a){a&&0!==a.length&&(this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(this.asyncUpdates?this._addDelayed(a):this._addImmediate(a),this.notifyChange("updating")):oa.error("#add()","Cannot add graphics before terrain surface has been initialized"))};f.prototype._addImmediate=function(a){var b=this;this.symbolWarningLogged=this.geometryWarningLogged=!1;aa.clear();for(var c=0;c<a.length;c++){var d=a[c];this._startAddGraphic(d,
this._getRenderingInfo(d,oa),aa)}aa.forEach(function(a){return b._finishAddGraphics(a)});aa.clear();this.updateHasDraped();this._cleanupSymbols();this.labeler&&(this.owner.view.labeler.setDirty(),this._cleanupSymbols());this.owner.view.deconflictor.setDirty()};f.prototype._addDelayed=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.uid,e=this.pendingUpdates.get(d);e?e.add?0!==e.state&&e.abortController.abort():this.pendingAdds++:(e=this.pendingUpdatesPool.pushNew(),this.pendingAdds++,this.pendingUpdates.set(d,
e));e.add=c}this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size);this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};f.prototype.remove=function(a){this.asyncUpdates?this._removeDelayed(a):this._removeImmediate(a);this.notifyChange("updating")};f.prototype._removeImmediate=function(a){for(var b=0;b<a.length;b++)this._removeGraphic(a[b]);this.updateHasDraped();this._cleanupSymbols();this.labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};
f.prototype._removeDelayed=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.uid,e=this.pendingUpdates.get(d);e?e.add&&(e.remove?e.add=null:this.pendingUpdates.delete(d),1===e.state&&e.abortController.abort(),this.pendingAdds--):(e=this.pendingUpdatesPool.pushNew(),e.remove=c,this.pendingUpdates.set(d,e),this.pendingRemoves++)}0===this.pendingUpdates.size&&this._finishPendingUpdates();this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size);this.notifyChange("updatingTotal");
this.notifyChange("updatingRemaining")};f.prototype._finishPendingUpdates=function(){this.pendingUpdatesPool.clear();this.maxPendingUpdates=0;this._cleanupSymbols();(this.pendingAdds||this.pendingRemoves)&&oa.warn("pendingAdds/Removes in inconsistent state!");this.pendingRemoves=this.pendingAdds=0};f.prototype._applyPendingUpdates=function(a){var b=this;this.symbolWarningLogged=this.geometryWarningLogged=!1;var c=2===a.state?1E3:100,d=0;aa.clear();p.someMap(this.pendingUpdates,function(e,f){e.add&&
0===e.state&&b._startAddRenderingInfo(e);!e.remove||e.add&&2!==e.state||(b.pendingRemoves--,b._removeGraphic(e.remove),e.remove=null);if(e.add)switch(e.state){case 2:b._startAddGraphic(e.add,e.renderingInfo,aa)&&d++;e.add=null;b.pendingAdds--;break;case 3:e.add=null,b.pendingAdds--}d>c&&(aa.forEach(function(a){return b._finishAddGraphics(a)}),aa.clear(),d=0);null==e.remove&&null==e.add&&(b.pendingUpdates.delete(f),a.madeProgress());return a.done});aa.forEach(function(a){return b._finishAddGraphics(a)});
aa.clear();0===this.pendingUpdates.size&&this._finishPendingUpdates();this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining");this.updateHasDraped()};f.prototype._startAddRenderingInfo=function(a){var b=this;t.isSome(this.layer.renderer)&&"dictionary"===this.layer.renderer.type?(a.state=1,a.abortController=z.createAbortController(),this._getRenderingInfoAsync(a.add,{signal:a.abortController.signal}).then(function(c){t.isNone(c)||t.isNone(c.symbol)?(oa&&!b.symbolWarningLogged&&(b.symbolWarningLogged=
!0,oa.warn("Graphic in layer "+b.layer.id+" has no symbol and will not render")),a.renderingInfo=null):a.renderingInfo=c;a.state=2},function(b){a.abortController=null;z.isAbortError(b)?a.state=0:a.state=3})):(a.renderingInfo=this._getRenderingInfo(a.add,oa),a.state=2)};f.prototype._startAddGraphic=function(a,b,c){this.graphicsWithoutSymbol.set(a.uid,a);if(!b||t.isNone(b.symbol)||!G.hasGeometry(a))return!1;var d=this.getOrCreateGraphics3DSymbol(b.symbol,b.renderer);if(t.isNone(d))return!1;this.expandComputedExtent(a.geometry);
this._beginGraphicUpdate(a);a={graphic:a,renderingInfo:b,layer:this.layer};b=d.symbol.id;var e=c.get(b);e?e.graphics.push(a):(e=ja.acquire(),e.clear(),e.push(a),c.set(b,{asyncSymbol:d,graphics:e}));return!0};f.prototype._finishAddGraphics=function(a){var b=this,c=!1,d=function(b){b===a.asyncSymbol.symbol.id&&(c=!0)};this._whenSymbolRemoved.push(d);a.asyncSymbol.load(function(){if(!b.destroyed){b._whenSymbolRemoved.removeUnordered(d);na.clear();for(var e=0;e<a.graphics.length;e++){var f=a.graphics.data[e],
g=f.graphic;c||a.asyncSymbol.destroyed||b.graphicSymbolSupported&&g.symbol&&g.symbol.id!==a.asyncSymbol.symbol.id||(b.graphicsWaitingForSymbol.has(g.uid)&&(f=b.createGraphics3DGraphic(a.asyncSymbol,f),b._spatialIndex&&t.isSome(f)&&na.push(f)),b._endGraphicUpdate(g));--a.asyncSymbol.referenced}0<na.length&&(b._spatialIndex.addMany(na.data,na.length),na.clear());b.featureStore.events.emit("changed");a.graphics.clear();ja.release(a.graphics);b.labeler&&b.owner.view.labeler.setDirty()}},function(e){if(!b.destroyed){b._whenSymbolRemoved.removeUnordered(d);
if(!c)if(z.isAbortError(e))b.add(a.graphics.map(function(a){return a.graphic}));else if(!a.asyncSymbol.destroyed)for(e=0;e<a.graphics.length;e++)b._endGraphicUpdate(a.graphics.data[e].graphic);a.graphics.clear();ja.release(a.graphics)}})};f.prototype._removeGraphic=function(a){a=a.uid;var b=this.graphics3DGraphics.get(a);if(b){b.graphics3DSymbol.onRemoveGraphic(b);var c=b.usedMemory,d=b.isElevationSource;this._conditionalRemove(b,a);this._spatialIndex&&this._spatialIndex.remove(b);this.graphicsBySymbol.get(b.graphics3DSymbol.symbol.id).delete(a);
this.graphicsWithoutSymbol.delete(a);this.removeGraphics3DGraphic(a,c,d);b.destroy();this.featureStore.events.emit("changed")}else this.graphicsWithoutSymbol.delete(a),this.graphicsWaitingForSymbol.delete(a)};f.prototype.hasLabelingContext=function(a){if(a instanceof e.LabelSymbol3D||a instanceof e.TextSymbol){var b=this.symbolCreationContext.layer;return b.labelingInfo?b.labelingInfo.some(function(b){return b.symbol===a}):!1}return!1};f.prototype.hasValidSymbolCreationContext=function(a){return a instanceof
e.LabelSymbol3D&&!this.hasLabelingContext(a)?(oa.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};f.prototype._getRenderingInfo=function(a,b){var c=a.geometry;if(t.isNone(c))return b&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render")),null;if(!da.canProject(c.spatialReference,this._spatialReference))return b&&!this.geometryWarningLogged&&
(this.geometryWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+" has incompatible spatial reference and will not render")),null;if(!this.graphicSymbolSupported&&t.isSome(a.symbol))return b&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+" is not allowed to have a symbol, use a renderer instead")),null;a=this.rendererHasGeometryOperations?G.hydrateGraphic(a,this.layer):a;a=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||
t.isSome(this.currentRenderer))?this.owner.getRenderingInfo(a,this.currentRenderer,t.unwrap(this.arcadeOnDemand)):{symbol:a.symbol||L.getDefaultSymbol3D(a.geometry)};return!a||t.isNone(a.symbol)?(b&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render")),null):a};f.prototype._getRenderingInfoAsync=function(a,b){if(t.isNone(a.geometry))return oa&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,oa.warn("Graphic in layer "+
this.layer.id+" has no geometry and will not render")),null;if(!this.graphicSymbolSupported&&t.isSome(a.symbol))return oa&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,oa.warn("Graphic in layer "+this.layer.id+" is not allowed to have a symbol, use a renderer instead")),null;a=this.rendererHasGeometryOperations?G.hydrateGraphic(a,this.layer):a;return this.owner.getRenderingInfoAsync(a,t.unwrap(this.currentRenderer),t.unwrap(this.arcadeOnDemand),b)};f.prototype.createGraphics3DSymbol=function(a,
b){var c=this;if(!this.hasValidSymbolCreationContext(a))return null;a=this.getConvertedSymbol(a);if(!a)return null;var d;t.isSome(b)&&"backgroundFillSymbol"in b&&b.backgroundFillSymbol&&(b=M.to3D(b.backgroundFillSymbol,!1,!0),b.symbol&&"web-style"!==b.symbol.type&&(d=b.symbol.symbolLayers));d=U.make(a,this.symbolCreationContext,d);d.load(function(){return c.notifyChange("maxSymbolComplexity")},function(){});return d};f.prototype.getOrCreateGraphics3DSymbol=function(a,b){var c=this,d=this.symbols.get(a.id);
void 0===d&&(d=a instanceof e.WebStyleSymbol?new P(a,function(a){return c.createGraphics3DSymbol(a,b)}):this.createGraphics3DSymbol(a,b),this.symbols.set(a.id,d));t.isSome(d)&&++d.referenced;return d};f.prototype.trackGraphicState=function(a){t.isNone(this.graphicStateTracking)&&(this.graphicStateTracking=new ba.GraphicStateTracking(this));return this.graphicStateTracking.add(a)};f.prototype.addGraphics3DGraphic=function(a){this._usedMemory+=a.usedMemory;this.graphics3DGraphics.set(a.graphic.uid,
a);this.numberOfGraphics++;a.isElevationSource&&(this.numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider());this.updateLayerVisibility()};f.prototype.removeGraphics3DGraphic=function(a,b,c){void 0===c&&(c=!1);this._usedMemory-=b;this.graphics3DGraphics.delete(a);this.numberOfGraphics--;c&&(this.numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider());this.updateLayerVisibility()};f.prototype.createGraphics3DGraphic=function(a,b){var c=b.graphic;this.graphicsWithoutSymbol.delete(c.uid);
if(!this.symbols.has(a.symbol.id))return this.add([c]),null;if(this.graphics3DGraphics.has(c.uid))return null;b=a.createGraphics3DGraphic(b);if(t.isNone(b))return null;this.addGraphics3DGraphic(b);a=a.symbol.id;this.graphicsBySymbol.has(a)||this.graphicsBySymbol.set(a,new Map);this.graphicsBySymbol.get(a).set(c.uid,b);b.isDraped&&(this.graphicsDrapedUids.add(c.uid),this._set("hasDraped",!0));b.centroid=null;t.isSome(c.geometry)&&"point"!==c.geometry.type&&b instanceof W&&(b.centroid=V.computeCentroid(c.geometry,
this._spatialReference));this._updateUserVisibility(b);this.scaleVisibility&&this.scaleVisibility.updateVisibility(b);this.filterVisibility&&this.filterVisibility.updateVisibility(b);this.deconflictor&&this.deconflictor.addGraphic(b);this.labeler&&this.labeler.addGraphic(b);this.objectStates&&this.objectStates.addGraphic(b);this.deconflictor&&this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,b);b.initialize(this.stage,this.stageLayer,this.owner);t.isSome(this.graphicStateTracking)&&this.graphicStateTracking.addGraphic(b);
if(a=this.whenGraphics3DGraphicRequests[c.uid])delete this.whenGraphics3DGraphicRequests[c.uid],a.resolve(b);return b};f.prototype.abortRendererChange=function(){this.rendererChangeAbortController&&(this.rendererChangeAbortController.abort(),this.rendererChangeAbortController=null)};f.prototype.rendererChange=function(b){return a.__awaiter(this,void 0,void 0,function(){var c,d;return a.__generator(this,function(a){switch(a.label){case 0:this.abortRendererChange();if(b===this.currentRenderer)return[2];
this.validateRenderer(b);if(!J.isSupportedRenderer3D(b))return this.currentRendererChange(null,!1),[2];if(!t.isSome(b)||!b.arcadeRequired)return[3,4];this.rendererChangeAbortController=c=z.createAbortController();return[4,this.ensureArcade()];case 1:return d=a.sent().arcadeUtils,z.throwIfAborted(c),d.hasGeometryOperations(b)?[4,d.enableGeometryOperations()]:[3,3];case 2:a.sent(),z.throwIfAborted(c),a.label=3;case 3:return this.rendererChangeAbortController=null,this.currentRendererChange(b,!0),[3,
5];case 4:this.currentRendererChange(b,!1),a.label=5;case 5:return[2]}})})};f.prototype.ensureArcade=function(){return a.__awaiter(this,void 0,void 0,function(){var b;return a.__generator(this,function(a){switch(a.label){case 0:if(!t.isNone(this.arcadeOnDemand))return[3,2];b=this;return[4,E.loadArcade()];case 1:return b.arcadeOnDemand=a.sent(),[2,this.arcadeOnDemand];case 2:return[2,this.arcadeOnDemand]}})})};f.prototype.currentRendererChange=function(a,b){this.currentRenderer=a;this.rendererHasGeometryOperations=
b;this.symbolCreationContext.arcade=t.unwrap(this.arcadeOnDemand);b=this.symbolCreationContext.renderer;if(a!==b)if(this.updateUpdatePolicy(),this.symbolConversionCache.clear(),t.isNone(a))this.symbolCreationContext.renderer=null,this.recreateAllGraphics();else{var c=A.diff(b,a);this.updateUnchangedSymbolMappings(c,a,b);this.symbolCreationContext.renderer=a;t.isNone(c)||("complete"===c.type?this.recreateAllGraphics():"partial"===c.type&&(this.applyRendererDiff(c,a,b)?this.volatileGraphicsUpdated():
this.recreateAllGraphics()),this.notifyChange("maxSymbolComplexity"))}};f.prototype.diffHasSymbolChange=function(a){for(var b in a.diff)switch(b){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;case "authoringInfo":case "fieldDelimiter":delete a.diff[b];break;default:return!0}return!1};f.prototype.applySymbolSetDiff=function(a,b,c){var d=this;a=a||[];b=b||[];for(var e=[],f=function(b){var f=g.graphicsBySymbol.get(b.id);f&&f.forEach(function(g,h){var k=g.graphic,l=d.layer instanceof
I?d.layer:null,m=t.unwrap(d.arcadeOnDemand);if(b!==c.defaultSymbol||c.getSymbol(G.hydrateGraphic(k,l),{arcade:m})!==c.defaultSymbol)l=g.usedMemory,a.length||c.defaultSymbol?e.push(k):d.graphicsWithoutSymbol.set(h,k),k=d.graphics3DGraphics.get(h),d._conditionalRemove(k,h),g.destroy(),f.delete(h),d.removeGraphics3DGraphic(h,l),d.updateLayerVisibility()});g._whenSymbolRemoved.forEach(function(a){return a(b.id)})},g=this,h=0;h<b.length;h++)f(b[h]);if(a.length||e.length)this.graphicsWithoutSymbol.forEach(function(a){return e.push(a)}),
this.graphicsWithoutSymbol.clear(),this.add(e);this.updateHasDraped();this._cleanupSymbols();this.labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};f.prototype.applyUniqueValueRendererDiff=function(a,b,c){var d=a.diff.defaultSymbol,e=a.diff.uniqueValueInfos;if(d||e){var f=e?e.added.map(function(a){return a.symbol}):[],g=e?e.removed.map(function(a){return a.symbol}):[];if(e)for(var h=0;h<e.changed.length;h++)f.push(e.changed[h].newValue.symbol),g.push(e.changed[h].oldValue.symbol);
d?(c.defaultSymbol&&g.push(c.defaultSymbol),b.defaultSymbol&&f.push(b.defaultSymbol)):c.defaultSymbol&&f.length&&g.push(b.defaultSymbol);this.applySymbolSetDiff(f,g,b);delete a.diff.defaultSymbol;delete a.diff.uniqueValueInfos;return!0}return!1};f.prototype.calculateUnchangedSymbolMapping=function(a,b,c){var d=function(a){return t.isSome(a)?a.id:null};if(b instanceof h.UniqueValueRenderer&&c instanceof h.UniqueValueRenderer&&(t.isNone(a)||"partial"===a.type)){var e=a&&a.diff;a=e&&e.defaultSymbol;
var e=e&&e.uniqueValueInfos,f=void 0,f=e?e.unchanged.map(function(a){return{oldId:d(a.oldValue.symbol),newId:d(a.newValue.symbol)}}):c.uniqueValueInfos.map(function(a,c){return{oldId:d(a.symbol),newId:d(b.uniqueValueInfos[c].symbol)}});!a&&c.defaultSymbol&&f.push({oldId:d(c.defaultSymbol),newId:d(b.defaultSymbol)});return f}return[]};f.prototype.updateSymbolMapping=function(a,b){var c=b?"string"===typeof b?b:b.id:null;b="string"===typeof b?null:b;if(a&&a!==c){var d=this.graphicsBySymbol.get(a);this.graphicsBySymbol.delete(a);
void 0!==d&&this.graphicsBySymbol.set(c,d);d=this.symbols.get(a);void 0!==d&&(this.symbols.delete(a),this.symbols.set(c,d),t.isSome(d)&&(t.isSome(b)?d.symbol=b:d.symbol.id=c))}};f.prototype.updateUnchangedSymbolMappings=function(a,b,c){var d=0;for(a=this.calculateUnchangedSymbolMapping(a,b,c);d<a.length;d++)b=a[d],this.updateSymbolMapping(b.oldId,b.newId)};f.prototype.applyRendererDiff=function(a,b,c){var d=this;return this.diffHasSymbolChange(a)?!1:b instanceof h.UniqueValueRenderer&&c instanceof
h.UniqueValueRenderer&&this.applyUniqueValueRendererDiff(a,b,c)&&0===Object.keys(a.diff).length?!0:!p.someMap(this.graphicsBySymbol,function(c,e){c=d.symbols.get(e);return t.isSome(c)&&!c.applyRendererDiff(a,b)})};f.prototype.opacityChange=function(){this.forEachGraphics3DSymbol(function(a,b){return a.globalPropertyChanged("opacity",b)});this.updateStageLayerVisibility()};f.prototype.updateUpdatePolicy=function(){var a=t.isSome(this.currentRenderer)&&"dictionary"===this.currentRenderer.type;this._asyncUpdates=
1===this.preferredUpdatePolicy||a;(this.symbolCreationContext.isAsync=this._asyncUpdates)||this.update(la.noBudget)};f.prototype.slicePlaneEnabledChange=function(a){a!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=a,this.stageLayer.isSliceable=a,this.forEachGraphics3DSymbol(function(a,b){return a.globalPropertyChanged("slicePlaneEnabled",b)}),this.deconflictor&&this.deconflictor.slicePlaneEnabledChange(),this.labeler&&this.labeler.slicePlaneEnabledChange())};
f.prototype.physicalBasedRenderingChange=function(a){a!==this.symbolCreationContext.physicalBasedRenderingEnabled&&(this.symbolCreationContext.physicalBasedRenderingEnabled=a,this.forEachGraphics3DSymbol(function(a,b){return a.globalPropertyChanged("physicalBasedRenderingEnabled",b)}))};f.prototype.pixelRatioChange=function(){var a=this;this.forEachGraphics3DSymbol(function(b,c,d){b.globalPropertyChanged("pixelRatio",c)||a._recreateSymbol(d)})};f.prototype._signalUpdatingDuringAsyncLoadedGraphicsChange=
function(){var a=this;this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove();this._updatingPendingLoadedGraphicsChange=w.schedule(function(){a._updatingPendingLoadedGraphicsChange=null})};f.prototype.setClippingExtent=function(a,b){var c=this.symbolCreationContext.clippingExtent,d=H.create();da.extentToBoundingRect(a,d,b)?this.symbolCreationContext.clippingExtent=F.fromRect(F.create(),d):this.symbolCreationContext.clippingExtent=null;return!F.equals(this.symbolCreationContext.clippingExtent,
c)};f.prototype.modifyGraphics3DGraphicVisibilities=function(a){var b=!1;this.graphics3DGraphics.forEach(function(c){a(c)&&(b=!0)});b&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())};f.prototype.forEachGraphics3DSymbol=function(a){for(var b=0,c=g.keysOfMap(this.symbols);b<c.length;b++){var d=c[b],e=this.symbols.get(d);if(t.isNone(e))break;var f=this.graphicsBySymbol.get(d);a(e,f||ua,d)}};f.prototype.updateAllGraphicsVisibility=function(){var a=this;this.filterVisibility&&
(this.filterVisibility.dirty=!0);this.modifyGraphics3DGraphicVisibilities(function(b){var c=a._updateUserVisibility(b);b=a.scaleVisibility&&a.scaleVisibility.updateVisibility(b);return c||b})};f.prototype.hideAllGraphics=function(){this.modifyGraphics3DGraphicVisibilities(function(a){return a.setVisibilityFlag(0,!1,0)})};f.prototype.validateRenderer=function(a){(a=J.validateTo3D(a))&&oa.warn("Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView",
a.message)};f.prototype.volatileGraphicsUpdated=function(){this.labeler&&this.labeler.reset();this.stageLayer.invalidateSpatialQueryAccelerator();this.stageLayer.shaderTransformationChanged();this.notifyChange("updating")};f.prototype._cleanupSymbols=function(){var a=this;if(!(0<this.graphicsWaitingForSymbol.size||this.suspendSymbolCleanup)){var b=!1;this.symbols.forEach(function(c,d){if(!(t.isNone(c)||0<c.referenced)){var e=a.graphicsBySymbol.get(d);e&&0!==e.size||(a.graphicsBySymbol.delete(d),a.symbols.delete(d),
c&&c.destroy(),b=!0)}});b&&this.notifyChange("maxSymbolComplexity")}};f.prototype.snapshotInternals=function(){var a=this;return{graphics:g.keysOfMap(this.graphics3DGraphics).sort(),symbols:g.keysOfMap(this.symbols).sort(),graphicsBySymbol:g.keysOfMap(this.graphicsBySymbol).sort().map(function(b){return{symbolId:b,graphics:g.keysOfMap(a.graphicsBySymbol.get(b)).sort()}}),graphicsWithoutSymbol:g.keysOfMap(this.graphicsWithoutSymbol).sort(),graphicsDrapedUids:g.keysOfSet(this.graphicsDrapedUids).sort(),
pendingUpdates:this.pendingUpdates}};Object.defineProperty(f.prototype,"test",{get:function(){return{symbols:this.symbols,filterVisibility:this.filterVisibility,numPending:this.pendingUpdates.size}},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"performanceInfo",{get:function(){return{visible:this.graphics3DGraphics.size,missing:this.graphicsWithoutSymbol.size,pending:this.pendingUpdates.size}},enumerable:!0,configurable:!0});var k;f.tmpVec=C.vec3f64.create();a.__decorate([y.property({readOnly:!0})],
f.prototype,"computedExtent",void 0);a.__decorate([y.property()],f.prototype,"currentRenderer",void 0);a.__decorate([y.property()],f.prototype,"rendererHasGeometryOperations",void 0);a.__decorate([y.property()],f.prototype,"rendererChangeAbortController",void 0);a.__decorate([y.property()],f.prototype,"elevationInfoChangeAbortController",void 0);a.__decorate([y.property()],f.prototype,"setupAbortController",void 0);a.__decorate([y.property({readOnly:!0})],f.prototype,"elevationAlignment",void 0);
a.__decorate([y.property({readOnly:!0})],f.prototype,"scaleVisibility",void 0);a.__decorate([y.property({readOnly:!0})],f.prototype,"filterVisibility",void 0);a.__decorate([y.property()],f.prototype,"_updatingPendingLoadedGraphicsChange",void 0);a.__decorate([y.property({readOnly:!0})],f.prototype,"featureStore",void 0);a.__decorate([y.property({readOnly:!0})],f.prototype,"deconflictor",void 0);a.__decorate([y.property({readOnly:!0})],f.prototype,"labeler",void 0);a.__decorate([y.property({readOnly:!0})],
f.prototype,"objectStates",void 0);a.__decorate([y.property()],f.prototype,"preferredUpdatePolicy",void 0);a.__decorate([y.property({constructOnly:!0})],f.prototype,"elevationFeatureExpressionEnabled",void 0);a.__decorate([y.property({constructOnly:!0})],f.prototype,"owner",void 0);a.__decorate([y.property({constructOnly:!0})],f.prototype,"layer",void 0);a.__decorate([y.property({readOnly:!0})],f.prototype,"hasDraped",void 0);a.__decorate([y.property({readOnly:!0})],f.prototype,"symbolsUpdating",
void 0);a.__decorate([y.property({constructOnly:!0})],f.prototype,"graphicSymbolSupported",void 0);a.__decorate([y.property({constructOnly:!0})],f.prototype,"getRenderingInfoWithoutRenderer",void 0);a.__decorate([y.property({readOnly:!0,dependsOn:"elevationAlignment.updating scaleVisibility.updating filterVisibility.updating rendererChangeAbortController elevationInfoChangeAbortController _updatingPendingLoadedGraphicsChange".split(" ")})],f.prototype,"updating",null);a.__decorate([y.property({readOnly:!0})],
f.prototype,"updatingRemaining",null);a.__decorate([y.property({readOnly:!0})],f.prototype,"updatingTotal",null);a.__decorate([y.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","maxSymbolComplexity"]})],f.prototype,"displayFeatureLimit",null);a.__decorate([y.property({readOnly:!0})],f.prototype,"maxSymbolComplexity",null);a.__decorate([y.property({constructOnly:!0})],f.prototype,"hasZ",
void 0);a.__decorate([y.property({constructOnly:!0})],f.prototype,"hasM",void 0);return f=k=a.__decorate([y.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],f)}(f);b.Graphics3DCore=n;var aa=new Map,na=new v,ja=new u(v);(function(){return function(){this.renderingInfo=this.add=null;this.state=0;this.remove=null}})();var ta=10,ra=C.vec3f64.create(),xa=C.vec3f64.create(),ua=new Map})},"esri/renderers/support/rendererConversion":function(){define("require exports ../../core/compilerUtils ../../core/Error ../../core/maybe ../../symbols/support/symbolConversion".split(" "),
function(n,b,a,m,h,e){function f(a){return h.isNone(a)||"simple"===a.type||"unique-value"===a.type||"class-breaks"===a.type||"dictionary"===a.type}function g(a,b){if(!b)return null;b=Array.isArray(b)?b:[b];if(0<b.length){var c=b.map(function(a){return a.details.symbol.type||a.details.symbol.declaredClass}).filter(function(a){return!!a});c.sort();var d=[];c.forEach(function(a,b){0!==b&&a===c[b-1]||d.push(a)});return new m("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+d.join(", ")+
") which are not supported in 3D",{renderer:a,symbolErrors:b})}return null}function l(a){var b=a.uniqueValueInfos.map(function(a){return e.to3D(a.symbol).error}).filter(function(a){return!!a}),c=e.to3D(a.defaultSymbol);c.error&&b.unshift(c.error);return g(a,b)}function d(a){var b=a.classBreakInfos.map(function(a){return e.to3D(a.symbol).error}).filter(function(a){return!!a}),c=e.to3D(a.defaultSymbol);c.error&&b.unshift(c.error);return g(a,b)}Object.defineProperty(b,"__esModule",{value:!0});b.isSupportedRenderer3D=
f;b.validateTo3D=function(b){if(h.isNone(b))return null;if(!f(b))return new m("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+(b.type||b.declaredClass)+"'",{renderer:b});switch(b.type){case "simple":return g(b,e.to3D(b.symbol).error);case "unique-value":return l(b);case "class-breaks":return d(b);case "dictionary":break;default:a.neverReached(b)}return null}})},"esri/symbols/support/defaults3D":function(){define("require exports ../../core/compilerUtils ../../core/maybe ../FillSymbol3DLayer ../LineSymbol3D ../MeshSymbol3D ../PointSymbol3D ../PolygonSymbol3D ./defaults ./defaultsJSON".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c){Object.defineProperty(b,"__esModule",{value:!0});var k=g.fromSimpleMarkerSymbol(d.defaultPointSymbol2D),p=e.fromSimpleLineSymbol(d.defaultPolylineSymbol2D),r=l.fromSimpleFillSymbol(d.defaultPolygonSymbol2D),t=new f({symbolLayers:[new h({material:{color:c.defaultColor},edges:{type:"solid",size:"1px",color:c.defaultOutlineColor}})]});b.getDefaultSymbol3D=function(b){if(m.isNone(b))return null;switch(b.type){case "mesh":return t;case "point":case "multipoint":return k;
case "polyline":return p;case "polygon":case "extent":return r;default:a.neverReached(b)}return null}})},"esri/views/3d/layers/graphics/Graphics3DFeatureStore":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Evented ../../../../core/maybe ../../../../core/accessorSupport/decorators ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter ../../support/projectionUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function m(a){var f=b.call(this,a)||this;f.events=new h;f.hasZ=null;f.hasM=null;f.objectIdField=null;f.spatialReference=null;f.featureAdapter={getAttribute:function(a,b){return"graphic"in a?a.graphic.attributes[b]:c.default.getAttribute(a,b)},getAttributes:function(a){return"graphic"in a?a.graphic.attributes:c.default.getAttributes(a)},getObjectId:function(a){return"graphic"in a?g.getObjectId(a.graphic,
f.objectIdField):c.default.getObjectId(a)},getGeometry:function(a){return"graphic"in a?a.getAsOptimizedGeometry(f.hasZ,f.hasM):c.default.getGeometry(a)},getCentroid:function(a,b){if("graphic"in a){var g=null;e.isSome(a.centroid)?g=a.centroid:"point"===a.graphic.geometry.type&&k.pointToPoint(a.graphic.geometry,p,f.spatialReference)&&(g=p);a=Array(2+(b.hasZ?1:0)+(b.hasM?1:0));e.isNone(g)?(a[0]=0,a[1]=0,a[2]=0,a[3]=0):(a[0]=g.x,a[1]=g.y,b.hasZ&&(a[2]=g.hasZ?g.z:0),b.hasM&&(a[b.hasZ?3:2]=g.hasM?g.m:0));
return new d.default([],a)}return c.default.getCentroid(a,b)},cloneWithGeometry:function(a,b){return"graphic"in a?new l.default(b,f.featureAdapter.getAttributes(a),null,f.featureAdapter.getObjectId(a)):c.default.cloneWithGeometry(a,b)}};return f}a.__extends(m,b);m.prototype.forEach=function(a){this.forAllGraphics(function(b){a(b)})};m.prototype.forEachInBounds=function(a,b){this.getSpatialIndex().forEachInBounds(a,b)};m.prototype.forEachBounds=function(a,b,c){for(var d=this.getSpatialIndex(),f=0;f<
a.length;f++){var g=this.featureAdapter.getObjectId(a[f]);e.isSome(d.getBounds(g,c))&&b(c)}};a.__decorate([f.property({constructOnly:!0})],m.prototype,"getSpatialIndex",void 0);a.__decorate([f.property({constructOnly:!0})],m.prototype,"forAllGraphics",void 0);a.__decorate([f.property({constructOnly:!0})],m.prototype,"hasZ",void 0);a.__decorate([f.property({constructOnly:!0})],m.prototype,"hasM",void 0);a.__decorate([f.property({constructOnly:!0})],m.prototype,"objectIdField",void 0);a.__decorate([f.property({constructOnly:!0})],
m.prototype,"spatialReference",void 0);return m=a.__decorate([f.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],m)}(m);b.Graphics3DFeatureStore=n;var p={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};b.default=n})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["require","exports","../centroid","../OptimizedFeature","../OptimizedGeometry"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.optimizedFeatureQueryEngineAdapter=
{getObjectId:function(a){return a.objectId},getAttributes:function(a){return a.attributes},getAttribute:function(a,b){return a.attributes[b]},cloneWithGeometry:function(a,b){return new m.default(b,a.attributes,null,a.objectId)},getGeometry:function(a){return a.geometry},getCentroid:function(b,f){b.centroid||(b.centroid=a.getCentroidOptimizedGeometry(new h.default,b.geometry,f.hasZ,f.hasM));return b.centroid}};b.default=b.optimizedFeatureQueryEngineAdapter})},"esri/layers/graphics/centroid":function(){define(["require",
"exports"],function(n,b){function a(a,b,f,g,l,d){d=l?d?4:3:d?3:2;var c=f,e=f+d,h=0,m=0,n=f=0,u=0,v=0;for(--g;v<g;v++,c+=d,e+=d){var z=b[c],w=b[c+1],q=b[c+2],y=b[e],A=b[e+1],B=b[e+2],C=z*A-y*w,n=n+C,h=h+(z+y)*C,m=m+(w+A)*C;l&&(C=z*B-y*q,f+=(q+B)*C,u+=C);z<a[0]&&(a[0]=z);z>a[1]&&(a[1]=z);w<a[2]&&(a[2]=w);w>a[3]&&(a[3]=w);l&&(q<a[4]&&(a[4]=q),q>a[5]&&(a[5]=q))}0<n&&(n*=-1);0<u&&(u*=-1);if(!n)return null;a=[h,m,.5*n];l&&(a[3]=f,a[4]=.5*u);return a}function m(a,b,f,g,l){l=g?l?4:3:l?3:2;for(var d=b,c=b+
l,e=0,h=0,m=0,n=0,u=0,v=f-1;u<v;u++,d+=l,c+=l){var z=a[d],w=a[d+1],q=a[d+2],y=a[c],A=a[c+1],B=a[c+2],C;if(g){C=y-z;var F=A-w,H=B-q;C=Math.sqrt(C*C+F*F+H*H)}else C=y-z,F=A-w,C=Math.sqrt(C*C+F*F);C&&(e+=C,g?(z=[z+.5*(y-z),w+.5*(A-w),q+.5*(B-q)],h+=C*z[0],m+=C*z[1],n+=C*z[2]):(z=[z+.5*(y-z),w+.5*(A-w)],h+=C*z[0],m+=C*z[1]))}return 0<e?g?[h/e,m/e,n/e]:[h/e,m/e]:0<f?g?[a[b],a[b+1],a[b+2]]:[a[b],a[b+1]]:null}Object.defineProperty(b,"__esModule",{value:!0});b.getCentroidOptimizedGeometry=function(b,e,f,
g){if(!e||!e.lengths.length)return null;b.lengths.length&&(b.lengths.length=0);b.coords.length&&(b.coords.length=0);for(var h=b.coords,d=[],c=f?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],k=e.lengths,p=e.coords,n=f?g?4:3:g?3:2,t=0,u=0;u<k.length;u++){var v=k[u],z=a(c,p,t,v,f,g);z&&d.push(z);
t+=v*n}d.sort(function(a,b){var c=a[2]-b[2];0===c&&f&&(c=a[4]-b[4]);return c});d.length&&(n=6*d[0][2],h[0]=d[0][0]/n,h[1]=d[0][1]/n,f&&(n=6*d[0][4],h[2]=0!==n?d[0][3]/n:0),h[0]<c[0]||h[0]>c[1]||h[1]<c[2]||h[1]>c[3]||f&&(h[2]<c[4]||h[2]>c[5]))&&(h.length=0);if(!h.length)if(e=e.lengths[0]?m(p,0,k[0],f,g):null)h[0]=e[0],h[1]=e[1],f&&2<e.length&&(h[2]=e[2]);else return null;return b};b.lineCentroid=m})},"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":function(){define(["require","exports"],
function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(){this.featureExpressionInfoContext=this.localOriginFactory=this.layerView=this.layer=this.overlaySR=this.renderCoordsHelper=this.clippingExtent=this.stage=this.renderer=this.elevationProvider=this.streamDataRequester=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.isAsync=this.physicalBasedRenderingEnabled=this.slicePlaneEnabled=!1}}();b.Graphics3DSymbolCreationContext=n;n=function(){return function(){}}();
b.Graphics3DSymbolLayerCreationContext=n})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["require","exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.make=function(b,e,f){var g;switch(b.type){case "point-3d":g=a;break;default:g=m}return new g(b,e,f)}})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define("require exports tslib ../../../../core/promiseUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DSymbol".split(" "),
function(n,b,a,m,h,e){return function(b){function e(a,d,c){a=b.call(this,a,d,c)||this;a.calloutSymbolLayer=null;a.symbol.hasVisibleCallout()&&(a.calloutSymbolLayer=h.make(a.symbol,d));return a}a.__extends(e,b);e.prototype.doLoad=function(e){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){switch(a.label){case 0:return[4,b.prototype.doLoad.call(this,e)];case 1:return a.sent(),this.calloutSymbolLayer?[4,this.calloutSymbolLayer.load()]:[3,3];case 2:a.sent(),a.label=
3;case 3:if(m.isAborted(e))throw m.createAbortError();return[2]}})})};e.prototype.destroy=function(){b.prototype.destroy.call(this);this.calloutSymbolLayer&&this.calloutSymbolLayer.destroy()};e.prototype.createGraphics3DGraphic=function(a,d){d=b.prototype.createGraphics3DGraphic.call(this,a,d);this.calloutSymbolLayer&&(a=this.createCalloutGraphic(a))&&d.addAuxiliaryGraphic(a);return d};e.prototype.globalPropertyChanged=function(a,d){var c=this;return b.prototype.globalPropertyChanged.call(this,a,
d)?this.calloutSymbolLayer?this.calloutSymbolLayer.globalPropertyChanged(a,d,function(a){return c._getCalloutGraphicLayer(a)}):!0:!1};e.prototype.updateGeometry=function(a,d){var c=b.prototype.updateGeometry.call(this,a,d);return c&&this.calloutSymbolLayer&&(a=this._getCalloutGraphicLayer(a))?this.calloutSymbolLayer.updateGeometry(a,d):c};e.prototype.createCalloutGraphic=function(a){var b=a.renderingInfo;a.renderingInfo={renderer:b.renderer,symbol:b.symbol,translation:[0,0,0],centerOffset:[0,0,0,
0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return this.calloutSymbolLayer.createGraphics3DGraphic(a)};e.prototype._getCalloutGraphicLayer=function(a){var b=0;for(a=a._auxiliaryGraphics;b<a.length;b++){var c=a[b];if(c.graphics3DSymbolLayer===this.calloutSymbolLayer)return c}};return e}(e)})},"esri/views/3d/layers/graphics/GraphicStateTracking":function(){define(["require","exports","../../../../core/arrayUtils","../../../../core/maybe","../../../../layers/graphics/dehydratedFeatures"],
function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){var b=this;this.graphicsCore=a;this.idToState=new Map;this.states=new Set;var e=a.owner.layer&&a.owner.layer.objectIdField;e?(this.getGraphicId=function(a){return h.getObjectId(a,e)},this.getGraphics3DGraphicById=function(a){return b.graphicsCore.getGraphics3DGraphicByObjectId(a)}):(this.getGraphicId=function(a){return a.uid},this.getGraphics3DGraphicById=function(a){return b.graphicsCore.getGraphics3DGraphicById(a)})}
b.prototype.destroy=function(){var a=this;this.idToState.clear();this.states.forEach(function(b,e){return a.remove(e)})};b.prototype.add=function(a){var b=this,e={remove:function(){return b.remove(a)}};if(this.states.has(a))return e;var d=this.getGraphicId(a.graphic),c=this.getGraphics3DGraphicById(d);this.states.has(a)||this.states.add(a);this.ensureStateList(d).push(a);a.displaying=m.isSome(c)?c.isVisible():!1;a.isDraped=m.isSome(c)?c.isDraped:!1;a.tracking=!0;return e};b.prototype.remove=function(b){if(this.states.has(b)){if(this.idToState.size){var e=
this.getGraphicId(b.graphic),f=this.idToState.get(e);f&&(a.remove(f,b),0===f.length&&this.idToState.delete(e))}this.states.delete(b);b.tracking=!1;b.displaying=!1}};b.prototype.addGraphic=function(a){this.forEachState(a,function(b){b.displaying=a.isVisible();b.isDraped=a.isDraped;b.emit("changed",{})})};b.prototype.removeGraphic=function(a){this.forEachState(a,function(a){a.displaying=!1;a.isDraped=!1})};b.prototype.updateGraphicGeometry=function(a){this.forEachState(a,function(a){a.emit("changed",
{})})};b.prototype.updateGraphicVisibility=function(a){this.forEachState(a,function(b){b.displaying=a.isVisible()})};b.prototype.allGraphicsDeleted=function(){this.states.forEach(function(a){a.displaying=!1})};b.prototype.ensureStateList=function(a){var b=this.idToState.get(a);if(b)return b;b=[];this.idToState.set(a,b);return b};b.prototype.forEachState=function(a,b){0!==this.states.size&&0!==this.idToState.size&&(a=this.getGraphicId(a.graphic),a=this.idToState.get(a),null!=a&&a.forEach(b))};return b}();
b.GraphicStateTracking=n})},"esri/views/3d/layers/graphics/SpatialIndex2D":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/has ../../../../core/accessorSupport/decorators ../../../../core/libs/rbush/PooledRBush ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures".split(" "),function(n,b,a,m,h,e,f,g,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function c(a){a=b.call(this,a)||this;a.index=new f.default(9,
h("csp-restrictions")?function(a){return{minX:a.extent[0],minY:a.extent[1],maxX:a.extent[2],maxY:a.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);a.boundsByFeature=new Map;a.spatialReference=null;a.hasZ=null;a.hasM=null;a.objectIdField=null;return a}a.__extends(c,b);c.prototype.destroy=function(){this.index.destroy();this.index=null;this.boundsByFeature.clear();this.boundsByFeature=null};c.prototype.queryGraphicUIDsInExtent=function(a,b,c){b.equals(this.spatialReference)&&(d.minX=
a[0],d.minY=a[1],d.maxX=a[2],d.maxY=a[3],this.index.search(d,function(a){return c(a.graphic.uid)}))};c.prototype.add=function(a){a.computeExtent(this.spatialReference);this.index.insert(a);var b=l.getObjectId(a.graphic,this._get("objectIdField"));null!=b&&this.boundsByFeature.set(b,a.extent)};c.prototype.addMany=function(a,b){void 0===b&&(b=a.length);for(var c=this._get("objectIdField"),d=0;d<b;d++){var e=a[d];e.computeExtent(this.spatialReference);var f=l.getObjectId(e.graphic,c);null!=f&&this.boundsByFeature.set(f,
e.extent)}this.index.load(a,b)};c.prototype.remove=function(a){this.index.remove(a);a=l.getObjectId(a.graphic,this._get("objectIdField"));null!=a&&this.boundsByFeature.delete(a)};c.prototype.clear=function(){this.index.clear();this.boundsByFeature.clear()};c.prototype.forEachInBounds=function(a,b){d.minX=a[0];d.minY=a[1];d.maxX=a[2];d.maxY=a[3];this.index.search(d,function(a){b(a)})};c.prototype.getBounds=function(a,b){return(a=this.boundsByFeature.get(a))?g.fromRect(b,a):null};a.__decorate([e.property({constructOnly:!0})],
c.prototype,"spatialReference",void 0);a.__decorate([e.property({constructOnly:!0})],c.prototype,"hasZ",void 0);a.__decorate([e.property({constructOnly:!0})],c.prototype,"hasM",void 0);a.__decorate([e.property({constructOnly:!0})],c.prototype,"objectIdField",void 0);return c=a.__decorate([e.subclass("esri.views.3d.layers.graphics.SpatialIndex2D")],c)}(m);b.SpatialIndex2D=n;var d={minX:0,minY:0,maxX:0,maxY:0};b.default=n})},"esri/core/libs/rbush/PooledRBush":function(){define("require exports tslib ../../arrayUtils ../../PooledArray ../quickselect/quickselect".split(" "),
function(n,b,a,m,h,e){function f(a,b){g(a,0,a.children.length,b,a)}function g(a,b,c,d,e){e||(e=new y(null));e.minX=Infinity;e.minY=Infinity;e.maxX=-Infinity;e.maxY=-Infinity;for(var f=void 0;b<c;b++)f=a.children[b],l(e,a.leaf?d(f):f);return e}function l(a,b){a.minX=Math.min(a.minX,b.minX);a.minY=Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=Math.max(a.maxY,b.maxY)}function d(a,b){return a.minX-b.minX}function c(a,b){return a.minY-b.minY}function k(a){return(a.maxX-a.minX)*(a.maxY-
a.minY)}function p(a){return a.maxX-a.minX+(a.maxY-a.minY)}function r(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function t(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function u(a,b,c,d,f){for(var g=[b,c];g.length;)if(c=g.pop(),b=g.pop(),!(c-b<=d)){var h=b+Math.ceil((c-b)/d/2)*d;e(a,h,b,c,f);g.push(b,h,h,c)}}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a,b){void 0===a&&(a=9);this.compareMinX=d;this.compareMinY=
c;this.toBBox=function(a){return a};this._maxEntries=Math.max(4,a||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));b&&("function"===typeof b?this.toBBox=b:this._initFormat(b));this.clear()}a.prototype.destroy=function(){this.clear();v.prune();z.prune();w.prune();q.prune()};a.prototype.all=function(a){this._all(this.data,a)};a.prototype.search=function(a,b){var c=this.data,d=this.toBBox;if(t(a,c))for(v.clear();c;){for(var e=0,f=c.children.length;e<f;e++){var g=c.children[e],h=c.leaf?
d(g):g;t(a,h)&&(c.leaf?b(g):r(a,h)?this._all(g,b):v.push(g))}c=v.pop()}};a.prototype.collides=function(a){var b=this.data,c=this.toBBox;if(!t(a,b))return!1;for(v.clear();b;){for(var d=0,e=b.children.length;d<e;d++){var f=b.children[d],g=b.leaf?c(f):f;if(t(a,g)){if(b.leaf||r(a,g))return!0;v.push(f)}}b=v.pop()}return!1};a.prototype.load=function(a,b){void 0===b&&(b=a.length);if(!b)return this;if(b<this._minEntries){for(var c=0;c<b;c++)this.insert(a[c]);return this}a=this._build(a.slice(0,b),0,b-1,0);
this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(c=this.data,this.data=a,a=c),this._insert(a,this.data.height-a.height-1,!0)):this.data=a;return this};a.prototype.insert=function(a){a&&this._insert(a,this.data.height-1);return this};a.prototype.clear=function(){this.data=new y([]);return this};a.prototype.remove=function(a){if(!a)return this;var b=this.data,c,d,e,f,g=this.toBBox(a);w.clear();for(q.clear();b||w.length;){b||(b=w.pop(),c=
w.data[w.length-1],d=q.pop(),e=!0);if(b.leaf&&(f=m.indexOf(b.children,a,b.children.length,b.indexHint),-1!==f)){b.children.splice(f,1);w.push(b);this._condense(w);break}e||b.leaf||!r(b,g)?c?(d++,b=c.children[d],e=!1):b=null:(w.push(b),q.push(d),d=0,c=b,b=b.children[0])}return this};a.prototype.toJSON=function(){return this.data};a.prototype.fromJSON=function(a){this.data=a;return this};a.prototype._all=function(a,b){for(z.clear();a;){if(!0===a.leaf){var c=0;for(a=a.children;c<a.length;c++)b(a[c])}else z.pushArray(a.children);
a=z.pop()}};a.prototype._build=function(a,b,c,d){var e=c-b+1,g=this._maxEntries;if(e<=g)return a=new y(a.slice(b,c+1)),f(a,this.toBBox),a;d||(d=Math.ceil(Math.log(e)/Math.log(g)),g=Math.ceil(e/Math.pow(g,d-1)));var h=new A([]);h.height=d;e=Math.ceil(e/g);g=e*Math.ceil(Math.sqrt(g));for(u(a,b,c,g,this.compareMinX);b<=c;b+=g){var k=Math.min(b+g-1,c);u(a,b,k,e,this.compareMinY);for(var l=b;l<=k;l+=e)h.children.push(this._build(a,l,Math.min(l+e-1,k),d-1))}f(h,this.toBBox);return h};a.prototype._chooseSubtree=
function(a,b,c,d){for(;;){d.push(b);if(!0===b.leaf||d.length-1===c)break;for(var e=Infinity,f=Infinity,g=void 0,h=0,l=b.children.length;h<l;h++){var m=b.children[h],n=k(m),p=(Math.max(m.maxX,a.maxX)-Math.min(m.minX,a.minX))*(Math.max(m.maxY,a.maxY)-Math.min(m.minY,a.minY))-n;p<f?(f=p,e=n<e?n:e,g=m):p===f&&n<e&&(e=n,g=m)}b=g||b.children[0]}return b};a.prototype._insert=function(a,b,c){var d=this.toBBox;c=c?a:d(a);w.clear();d=this._chooseSubtree(c,this.data,b,w);d.children.push(a);for(l(d,c);0<=b;)if(w.data[b].children.length>
this._maxEntries)this._split(w,b),b--;else break;this._adjustParentBBoxes(c,w,b)};a.prototype._split=function(a,b){var c=a.data[b],d=c.children.length,e=this._minEntries;this._chooseSplitAxis(c,e,d);d=this._chooseSplitIndex(c,e,d);d=c.children.splice(d,c.children.length-d);d=c.leaf?new y(d):new A(d);d.height=c.height;f(c,this.toBBox);f(d,this.toBBox);b?a.data[b-1].children.push(d):this._splitRoot(c,d)};a.prototype._splitRoot=function(a,b){this.data=new A([a,b]);this.data.height=a.height+1;f(this.data,
this.toBBox)};a.prototype._chooseSplitIndex=function(a,b,c){var d,e,f;d=e=Infinity;for(var h=b;h<=c-b;h++){var l=g(a,0,h,this.toBBox),m=g(a,h,c,this.toBBox),n;n=Math.max(0,Math.min(l.maxX,m.maxX)-Math.max(l.minX,m.minX))*Math.max(0,Math.min(l.maxY,m.maxY)-Math.max(l.minY,m.minY));l=k(l)+k(m);n<d?(d=n,f=h,e=l<e?l:e):n===d&&l<e&&(e=l,f=h)}return f};a.prototype._chooseSplitAxis=function(a,b,e){var f=a.leaf?this.compareMinX:d,g=a.leaf?this.compareMinY:c,h=this._allDistMargin(a,b,e,f);b=this._allDistMargin(a,
b,e,g);h<b&&a.children.sort(f)};a.prototype._allDistMargin=function(a,b,c,d){a.children.sort(d);d=this.toBBox;for(var e=g(a,0,b,d),f=g(a,c-b,c,d),h=p(e)+p(f),k=b;k<c-b;k++){var m=a.children[k];l(e,a.leaf?d(m):m);h+=p(e)}for(k=c-b-1;k>=b;k--)m=a.children[k],l(f,a.leaf?d(m):m),h+=p(f);return h};a.prototype._adjustParentBBoxes=function(a,b,c){for(;0<=c;c--)l(b.data[c],a)};a.prototype._condense=function(a){for(var b=a.length-1;0<=b;b--){var c=a.data[b];if(0===c.children.length)if(0<b){var d=a.data[b-
1],e=d.children;e.splice(m.indexOf(e,c,e.length,d.indexHint),1)}else this.clear();else f(c,this.toBBox)}};a.prototype._initFormat=function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0]));this.compareMinY=new Function("a","b",b.join(a[1]));this.toBBox=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")};return a}();b.PooledRBush=n;var v=new h,z=new h,w=new h,q=new h({deallocator:null});h=function(){return function(){this.minY=
this.minX=Infinity;this.maxY=this.maxX=-Infinity}}();b.BBox=h;h=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.height=1;a.indexHint=new m.PositionHint;return a}a.__extends(c,b);return c}(h);var y=function(b){function c(a){var c=b.call(this)||this;c.children=a;c.leaf=!0;return c}a.__extends(c,b);return c}(h),A=function(b){function c(a){var c=b.call(this)||this;c.children=a;c.leaf=!1;return c}a.__extends(c,b);return c}(h);b.default=n})},"esri/core/libs/quickselect/quickselect":function(){define([],
function(){function n(a,h,e,f,g){for(;f>e;){if(600<f-e){var l=f-e+1,d=h-e+1,c=Math.log(l),k=.5*Math.exp(2*c/3),c=.5*Math.sqrt(c*k*(l-k)/l)*(0>d-l/2?-1:1);n(a,h,Math.max(e,Math.floor(h-d*k/l+c)),Math.min(f,Math.floor(h+(l-d)*k/l+c)),g)}l=a[h];d=e;k=f;b(a,e,h);for(0<g(a[f],l)&&b(a,e,f);d<k;){b(a,d,k);d++;for(k--;0>g(a[d],l);)d++;for(;0<g(a[k],l);)k--}0===g(a[e],l)?b(a,e,k):(k++,b(a,k,f));k<=h&&(e=k+1);h<=k&&(f=k-1)}}function b(a,b,e){var f=a[b];a[b]=a[e];a[e]=f}function a(a,b){return a<b?-1:a>b?1:0}
return function(b,h,e,f,g){n(b,h,e||0,f||b.length-1,g||a)}})},"esri/views/3d/layers/support/StageLayerElevationProvider":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/unitUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../symbols/support/unitConversionUtils ../../webgl-engine/lib/Intersector".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t){Object.defineProperty(b,"__esModule",{value:!0});var u=e.getLogger("esri.views.3d.layers.support.StageLayerElevationProvider");n=function(b){function c(a){a=b.call(this,a)||this;a.elevationOffset=0;a.layerDirtyNotificationHandle=null;return a}a.__extends(c,b);c.prototype.initialize=function(){var a=this;this.renderCoordsHelper=this.view.renderCoordsHelper;this.intersectLayers=[this.stageLayer];this.intersector=new t.Intersector(this.view.viewingMode);this.intersector.options.store=
0;var b=this.computeLayerExtent(this.stageLayer);this.zmin=b[2];this.zmax=b[5];this.layerDirtyNotificationHandle=this.stageLayer.on("dirty",function(b){return a.stageLayerChanged(b.origin,b.dirtyType,b.subObject)})};c.prototype.dispose=function(){this.layerDirtyNotificationHandle.remove()};c.prototype.elevationInfoChanged=function(){var a=null!=this.layer?this.layer.elevationInfo:null;if(null!=a&&"on-the-ground"!==a.mode){var b=g.getMetersPerVerticalUnitForSR(this.layer.spatialReference),c=r.getMetersPerUnit(a.unit);
this.elevationOffset=f.unwrapOr(a.offset,0)*c/b}else this.elevationOffset=0};c.prototype.getElevation=function(a,b,c,e){q[0]=a;q[1]=b;q[2]=c;if(!this.renderCoordsHelper.toRenderCoords(q,e,q))return u.error("could not project point for elevation alignment"),null;b=this.elevationOffset;a=this.zmin+b;b=this.zmax+b;d.vec3.copy(y,q);d.vec3.copy(A,q);this.renderCoordsHelper.setAltitude(b,y);this.renderCoordsHelper.setAltitude(a,A);this.intersector.reset(y,A);this.intersector.intersect(this.intersectLayers,
null,null,1,null,function(a){return a.metadata&&a.metadata.isElevationSource});return this.intersector.results.min.getIntersectionPoint(q)?this.renderCoordsHelper.getAltitude(q):null};c.prototype.stageLayerChanged=function(a,b,c){switch(b){case "layerObjectAdded":case "layerObjectRemoved":case "objGeometryAdded":a=c;a.metadata&&a.metadata.isElevationSource&&this.objectChanged(a);break;case "objGeometryRemoved":case "objGeometryReplaced":case "objGeometryTransformation":case "vertexAttrsUpdated":case "objTransformation":a.metadata&&
a.metadata.isElevationSource&&this.objectChanged(a)}};c.prototype.objectChanged=function(a){if(this.spatialReference){k.empty(v);a.metadata.lastValidElevationBB.isEmpty()||this.expandExtent(a.metadata.lastValidElevationBB.bbMin,a.metadata.lastValidElevationBB.bbMax,v);var b=a.getBBMin(!1),c=a.getBBMax(!1);this.expandExtent(b,c,v);k.toRect(v,z);this.zmin=Math.min(this.zmin,v[2]);this.zmax=Math.max(this.zmax,v[5]);w.extent=z;w.spatialReference=this.spatialReference;this.emit("elevation-change",w);d.vec3.copy(a.metadata.lastValidElevationBB.bbMin,
b);d.vec3.copy(a.metadata.lastValidElevationBB.bbMax,c)}};c.prototype.computeLayerExtent=function(a){k.empty(v);var b=0;for(a=a.getObjects();b<a.length;b++){var c=a[b];this.expandExtent(c.getBBMin(!1),c.getBBMax(!1),v)}return v};c.prototype.expandExtent=function(a,b,c){for(var d=0;8>d;++d)q[0]=d&1?a[0]:b[0],q[1]=d&2?a[1]:b[1],q[2]=d&4?a[2]:b[2],this.renderCoordsHelper.fromRenderCoords(q,q,this.spatialReference),k.expand(c,q);return c};a.__decorate([l.property({constructOnly:!0})],c.prototype,"layer",
void 0);a.__decorate([l.property({constructOnly:!0})],c.prototype,"stageLayer",void 0);a.__decorate([l.property({constructOnly:!0})],c.prototype,"view",void 0);a.__decorate([l.property({readOnly:!0,aliasOf:"view.spatialReference"})],c.prototype,"spatialReference",void 0);return c=a.__decorate([l.subclass("esri.views.3d.layers.support.StageLayerElevationProvider")],c)}(h.EventedMixin(m));b.StageLayerElevationProvider=n;var v=k.empty(),z=p.empty(),w={spatialReference:null,extent:z,context:"scene"},
q=c.vec3f64.create(),y=c.vec3f64.create(),A=c.vec3f64.create()})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/SetUtils ../../../../core/accessorSupport/decorators ./ExtentSet ../../../support/Scheduler".split(" "),function(n,b,a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||
this;a.dirtyExtents=new l.ExtentSet;a.globalDirty=!1;a.dirtyGraphicsSet=new Set;a.handles=new e;a.updateElevation=!1;a.layerView=null;a.graphicsCore=null;a.events=new h;return a}a.__extends(c,b);Object.defineProperty(c.prototype,"updating",{get:function(){return this.needsUpdate()},enumerable:!0,configurable:!0});c.prototype.setup=function(a,b,c,e){var f=this;this.layerView=a;this.queryGraphicUIDsInExtent=b;this.graphicsCore=c;this.elevationProvider=e;a=this.layerView.view.resourceController.scheduler;
this.handles.add([e.on("elevation-change",function(a){return f.elevationUpdateHandler(a)}),this.layerView.watch("suspended",function(){return f.suspendedChange()}),a.registerTask(d.Task.ELEVATION_ALIGNMENT,function(a){return f.update(a)},function(){return f.needsUpdate()})])};c.prototype.destroy=function(){this.dirtyGraphicsSet=null;this.handles.destroy();this.queryGraphicUIDsInExtent=this.graphicsCore=this.layerView=this.handles=null};c.prototype.clear=function(){this.dirtyGraphicsSet.clear();this.notifyChange("updating")};
c.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))};c.prototype.elevationInfoChange=function(){this.globalDirty=!0;this.notifyChange("updating")};c.prototype.needsUpdate=function(){return this.dirtyGraphicsSet&&0<this.dirtyGraphicsSet.size||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty};c.prototype.update=function(a){var b=this;this.globalDirty&&
(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,a.madeProgress());for(a.run(function(){return b.dirtyExtents.merge(a)});this.needsUpdate()&&!a.done;)this._updateDirtyGraphics(a),this._updateDirtyExtents(a);this.layerView.view.deconflictor.setDirty();this.notifyChange("updating")};c.prototype._updateDirtyGraphics=function(a){for(var b=this,c=this.layerView.view,d=this.graphicsCore.stageLayer.id,e=this.layerView.labeling,g=function(){var g=Math.min(h.dirtyGraphicsSet.size,100);f.someSet(h.dirtyGraphicsSet,
function(d){var e=b.graphicsCore.getGraphics3DGraphicById(d);b.dirtyGraphicsSet.delete(d);e&&e.alignWithElevation(b.elevationProvider,c.renderCoordsHelper,b.graphicsCore.asyncUpdates);a.madeProgress();return 0>=--g||a.done});c._stage.processDirtyLayer(d);e&&e.processStageDirty()},h=this;0<this.dirtyGraphicsSet.size&&!a.done;)g()};c.prototype._updateDirtyExtents=function(a){for(var b=this;!this.dirtyExtents.empty&&100>this.dirtyGraphicsSet.size&&!a.done;){var c=this.dirtyExtents.pop();this.events.emit("invalidate-elevation",
{extent:c,spatialReference:this.spatialReference});this.queryGraphicUIDsInExtent(c,this.spatialReference,function(a){var c=b.graphicsCore.getGraphics3DGraphicById(a);c&&c.needsElevationUpdates()&&b.dirtyGraphicsSet.add(a)});a.madeProgress()}};c.prototype.markAllGraphicsElevationDirty=function(){var a=this;this.dirtyExtents.clear();this.dirtyGraphicsSet.clear();this.graphicsCore.graphics3DGraphics.forEach(function(b,c){return a.dirtyGraphicsSet.add(c)})};c.prototype.elevationUpdateHandler=function(a){if("scene"!==
a.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var b=a.extent;this.spatialReference=a.spatialReference;this.layerView.suspended?(this.updateElevation||(a=this.graphicsCore.computedExtent)&&b[2]>a.xmin&&b[0]<a.xmax&&b[3]>a.ymin&&b[1]<a.ymax&&(this.updateElevation=!0),this.events.emit("invalidate-elevation",{extent:b,spatialReference:this.spatialReference})):(-Infinity===b[0]?this.globalDirty=!0:this.dirtyExtents.add(b),this.notifyChange("updating"))}};
a.__decorate([g.property({readOnly:!0})],c.prototype,"updating",null);return c=a.__decorate([g.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],c)}(m);b.default=n})},"esri/views/3d/layers/graphics/ExtentSet":function(){define(["require","exports","../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this.extents=new a({allocator:function(a){return a||
m.create()}});this.tempExtent=m.create();this.dirty=!1}Object.defineProperty(b.prototype,"empty",{get:function(){return 0===this.extents.length},enumerable:!0,configurable:!0});b.prototype.clear=function(){this.extents.clear()};b.prototype.add=function(a){this.contains(a)||(this.removeContained(a),m.set(this.extents.pushNew(),a),this.dirty=!0)};b.prototype.pop=function(){this.dirty&&this.mergeTight();return this.extents.pop()};b.prototype.merge=function(a){this.mergeTight(a);return a.hasProgressed};
b.prototype.mergeTight=function(a){var b=this;void 0===a&&(a=h.noBudget);for(var e=this.extents,d=new Set,c=0;c!==e.length;){e.sort(function(a,b){return a[0]-b[0]});c=e.length;d.clear();for(var f=function(c){if(a.done)return{value:void 0};var f=e.getItemAt(c);for(c+=1;c<e.length;++c){var g=e.getItemAt(c);if(g[0]>=f[2])break;d.add(g)}d.forEach(function(c){if(f!==c)if(c[2]<=f[0])d.delete(c);else{var g=m.area(f),h=m.area(c),k=b.tempExtent;m.expand(f,c,k);g+=h;.05>(m.area(k)-g)/g&&(m.set(f,k),d.delete(c),
e.remove(c),a.madeProgress())}});d.add(f)},n=0;n<e.length;++n){var r=f(n);if("object"===typeof r)return r.value}}this.dirty=!1};b.prototype.contains=function(a){return this.extents.some(function(b){return m.contains(b,a)})};b.prototype.removeContained=function(a){this.extents.filterInPlace(function(b){return!m.contains(a,b)})};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{containsPoint:function(b){return a.extents.some(function(a){return m.containsPoint(a,b)})}}},enumerable:!0,
configurable:!0});return b}();b.ExtentSet=n})},"esri/views/3d/layers/graphics/Graphics3DFilterVisibility":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ./QueryEngine ../../../layers/support/FeatureFilter ../../../support/Scheduler".split(" "),function(n,b,a,m,h,e,f,g,l,d,c,k,p){Object.defineProperty(b,"__esModule",
{value:!0});var r=e.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility");n=function(b){function e(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];a=b.apply(this,a)||this;a.filter=null;a._dirty=!1;a._querying=!1;a._handles=new h;return a}a.__extends(e,b);Object.defineProperty(e.prototype,"updating",{get:function(){return this._dirty||this._querying||null!=this._queryResult},enumerable:!0,configurable:!0});e.prototype.setup=function(a,b){var d=this;this._layerView=a;this._core=
b;this._objectIdField=a.layer.objectIdField;this._queryEngine=new c.default({layerView:this._layerView,task:p.Task.FILTER_VISIBILITY});this._handles.add(this._layerView.view.resourceController.scheduler.registerTask(p.Task.FILTER_VISIBILITY,function(a){return d._update(a)},function(){return d._needsUpdate()}));this._handles.add(l.on(b.owner,"loadedGraphics","after-changes",function(a){return d._graphicsChanged(a)},function(){return d.dirty=!0}));this.filterChanged()};e.prototype.destroy=function(){this._handles.destroy();
this._handles=null;this.clear();this._core=this._layerView=null};e.prototype.clear=function(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities(function(a){return a.clearVisibilityFlag(2)}),this._queryResult=null,this._querying=!1);this.dirty=!1;this.notifyChange("updating")};e.prototype._graphicsChanged=function(a){this._queryEngine&&0===(a.type&1)||(this.dirty=!0)};e.prototype.updateVisibility=function(a){this.active&&(a.hasVisibilityFlag(2,0)||a.setVisibilityFlag(2,!1,
0),this.dirty=!0)};e.prototype.filterChanged=function(){var a=this.recomputeFilter();a!==this.filter&&(this.filter=a,this.dirty=!0)};Object.defineProperty(e.prototype,"active",{get:function(){return this.filter&&0<this._core.graphics3DGraphics.size},enumerable:!0,configurable:!0});e.prototype.recomputeFilter=function(){var a="filter"in this._layerView?this._layerView.filter:null,b="timeExtent"in this._layerView?this._layerView.timeExtent:null;if(!b)return a;a=f.isSome(a)?a.clone():new k;a.timeExtent=
a.timeExtent?a.timeExtent.intersection(b):b;return a};e.prototype._needsUpdate=function(){return this._dirty&&!this._querying||null!=this._queryResult};e.prototype._update=function(a){var b=this;this.active?(!this._dirty||this._querying||a.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then(function(a){b._queryResult=a;b._querying=!1}).catch(function(a){g.isAbortError(a)||(r.warn("FeatureFilter query failed: "+a,{error:a}),b._queryResult=new Set,b._core.graphics3DGraphics.forEach(function(a){return b._queryResult.add(b._getFeatureId(a.graphic))}),
b._querying=!1)}),a.madeProgress()),this._queryResult&&!a.done&&(this._core.modifyGraphics3DGraphicVisibilities(function(c){if(a.done)return!1;var d=b._queryResult.has(b._getFeatureId(c.graphic));return c.setVisibilityFlag(2,d,0)?(a.madeProgress(),!0):!1}),a.done||(this._queryResult=null)),this.notifyChange("updating")):this.clear()};e.prototype._getFeatureId=function(a){return null==a.objectId?a.attributes[this._objectIdField]:a.objectId};Object.defineProperty(e.prototype,"dirty",{set:function(a){this._dirty!==
a&&(this._dirty=a,this.notifyChange("updating"))},enumerable:!0,configurable:!0});a.__decorate([d.property({readOnly:!0})],e.prototype,"updating",null);return e=a.__decorate([d.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],e)}(m);b.Graphics3DFilterVisibility=n})},"esri/views/3d/layers/graphics/QueryEngine":function(){define("require exports tslib ../../../../geometry ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../tasks/support/FeatureSet ../../../../tasks/support/Query".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c){Object.defineProperty(b,"__esModule",{value:!0});var k=l.default;n=function(b){function h(a){a=b.call(this,a)||this;a._dataQueryEngineInstance=null;return a}a.__extends(h,b);Object.defineProperty(h.prototype,"queryGeometryType",{get:function(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;case "mesh":return"polygon"}},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"defaultQueryJSON",
{get:function(){return(new c({outSpatialReference:this.spatialReference})).toJSON()},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"dataQueryEngine",{get:function(){return this.ensureDataQueryEngine()},enumerable:!0,configurable:!0});h.prototype.destroy=function(){this.clear()};h.prototype.clear=function(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1};h.prototype.executeQueryForIdSet=function(b,c){return a.__awaiter(this,
void 0,void 0,function(){return a.__generator(this,function(a){return[2,this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(b),c)]})})};h.prototype.executeQueryForCount=function(b,c){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return[2,this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(b),c)]})})};h.prototype.executeQueryForExtent=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var d,e,f,h;return a.__generator(this,
function(a){switch(a.label){case 0:return[4,this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(b),c)];case 1:return d=a.sent(),e=d.count,f=d.extent,h=g.fromJSON(f),[2,{count:e,extent:h}]}})})};h.prototype.executeQueryForIds=function(b,c){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return[2,this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(b),c)]})})};h.prototype.executeQueryForLatestObservations=function(b,c){return a.__awaiter(this,
void 0,void 0,function(){var e,f,g=this;return a.__generator(this,function(a){switch(a.label){case 0:return[4,this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(b),c)];case 1:return e=a.sent(),f=d.fromJSON(e),f.features.forEach(function(a){a.layer=g.layer;a.sourceLayer=g.layer}),[2,f]}})})};h.prototype.executeQuery=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var e,f,g=this;return a.__generator(this,function(a){switch(a.label){case 0:return[4,this.dataQueryEngine.executeQuery(this._ensureQueryJSON(b),
c)];case 1:return e=a.sent(),f=d.fromJSON(e),f.features.forEach(function(a){a.layer=g.layer;a.sourceLayer=g.layer}),[2,f]}})})};h.prototype._ensureQueryJSON=function(a){if(e.isNone(a))return this.defaultQueryJSON;"outSpatialReference"in a&&!a.outSpatialReference&&(a.outSpatialReference=this.spatialReference);return a.toJSON()};h.prototype.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;var a="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||
null,b=this.layer.objectIdField,c=m.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),d=this.layer.fields.map(function(a){return a.toJSON()}),e=this.layerView.view.resourceController.scheduler,f=this.task,g=this.spatialReference.toJSON(),h=this.layerView;return this._dataQueryEngineInstance=new k({hasZ:h.hasZ,hasM:h.hasM,geometryType:c,fields:d,timeInfo:a,spatialReference:g,objectIdField:b,featureStore:this.layerView.graphics3d.graphicsCore.featureStore,scheduler:e,task:f})};a.__decorate([f.property({constructOnly:!0})],
h.prototype,"layerView",void 0);a.__decorate([f.property({constructOnly:!0})],h.prototype,"task",void 0);a.__decorate([f.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],h.prototype,"spatialReference",void 0);a.__decorate([f.property({readOnly:!0,aliasOf:"layerView.layer"})],h.prototype,"layer",void 0);a.__decorate([f.property({readOnly:!0,dependsOn:["layer.geometryType"]})],h.prototype,"queryGeometryType",null);a.__decorate([f.property({readOnly:!0,dependsOn:["spatialReference"]})],
h.prototype,"defaultQueryJSON",null);return h=a.__decorate([f.subclass("esri.views.3d.layers.graphics.QueryEngine")],h)}(h);b.QueryEngine=n;b.default=n})},"esri/layers/graphics/data/QueryEngine":function(){define("require exports tslib ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/MemCache ../../../core/promiseUtils ../../../core/SetUtils ../../../core/unitUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ./attributeSupport ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./spatialQuerySupport ./timeSupport ./utils ../../support/FieldsIndex ../../support/PromiseQueue".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C){function F(a){return a.every(function(a){return"exceedslimit"!==a.statisticType})}Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(a,b,c,d,e){void 0===b&&(b=null);this.attributes=a;this.geometry=c;this.centroid=d;this.filterFlags=e;this.groupId=-1;this.localId=b}}();b.Feature=n;var H=new Set,I=new f.MemCacheStorage(2E6),G=0;n=function(){function b(a){var b=this;this.capabilities={query:z.queryCapabilities};this.geometryType=
a.geometryType;this.hasM=a.hasM;this.hasZ=a.hasZ;this.objectIdField=a.objectIdField;this.spatialReference=a.spatialReference;this.definitionExpression=a.definitionExpression;this.featureStore=a.featureStore;this._changeHandle=this.featureStore.events.on("changed",function(){return b.clearCache()});this.timeInfo=a.timeInfo;a.cacheSpatialQueries&&(this._geometryQueryCache=new f.MemCache(G++ +"$$",I));this.fieldsIndex=new B(a.fields);a.scheduler&&a.task&&(this._frameQueue=new C.default,this._frameTask=
a.scheduler.registerTask(a.task,function(a){return b._update(a)},function(){return 0<b._frameQueue.length}))}b.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null);this.clearCache();this._geometryQueryCache&&this._geometryQueryCache.destroy();this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null);this.fieldsIndex.destroy()};Object.defineProperty(b.prototype,"featureAdapter",{get:function(){return this.featureStore.featureAdapter},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fullExtent",{get:function(){var a=this.featureStore.fullBounds;return a?{xmin:a[0],ymin:a[1],xmax:a[2],ymax:a[3],spatialReference:A.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"timeExtent",{get:function(){return this.timeInfo?this._timeExtent?this._timeExtent:this._timeExtent=y.getTimeExtent(this.timeInfo,this.featureStore):null},enumerable:!0,configurable:!0});
b.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear();this._timeExtent=this._allItems=null};b.prototype.executeQuery=function(b,c){void 0===b&&(b={});return a.__awaiter(this,void 0,void 0,function(){var c,d,e,f=this;return a.__generator(this,function(a){switch(a.label){case 0:c=h.clone(b),a.label=1;case 1:return a.trys.push([1,8,,9]),[4,this._schedule(function(){return A.normalizeQuery(c,f.definitionExpression,f.spatialReference)})];case 2:return c=a.sent(),
[4,this._reschedule(function(){return f._checkQuerySupport(c)})];case 3:return c=a.sent(),[4,this._reschedule(function(){return f._executeGeometryQuery(c)})];case 4:return d=a.sent(),[4,this._reschedule(function(){return d.executeObjectIdsQuery(c)})];case 5:return d=a.sent(),[4,this._reschedule(function(){return d.executeTimeQuery(c)})];case 6:return d=a.sent(),[4,this._reschedule(function(){return d.executeAttributesQuery(c)})];case 7:return d=a.sent(),[3,9];case 8:e=a.sent();if(e!==A.QUERY_ENGINE_EMPTY_RESULT)throw e;
d=new w.default([],null,this);return[3,9];case 9:return[2,d.createQueryResponse(c)]}})})};b.prototype.executeQueryForCount=function(b,c){void 0===b&&(b={});return a.__awaiter(this,void 0,void 0,function(){var c,d,e,f=this;return a.__generator(this,function(a){switch(a.label){case 0:c=h.clone(b),c.returnGeometry=!1,c.returnCentroid=!1,c.outSR=null,a.label=1;case 1:return a.trys.push([1,8,,9]),[4,this._schedule(function(){return A.normalizeQuery(c,f.definitionExpression,f.spatialReference)})];case 2:return c=
a.sent(),[4,this._reschedule(function(){return f._checkQuerySupport(c)})];case 3:return c=a.sent(),[4,this._reschedule(function(){return f._executeGeometryQuery(c)})];case 4:return d=a.sent(),[4,this._reschedule(function(){return d.executeObjectIdsQuery(c)})];case 5:return d=a.sent(),[4,this._reschedule(function(){return d.executeTimeQuery(c)})];case 6:return d=a.sent(),[4,this._reschedule(function(){return d.executeAttributesQuery(c)})];case 7:return d=a.sent(),[2,d.size];case 8:e=a.sent();if(e!==
A.QUERY_ENGINE_EMPTY_RESULT)throw e;return[2,0];case 9:return[2]}})})};b.prototype.executeQueryForExtent=function(b,e){void 0===b&&(b={});return a.__awaiter(this,void 0,void 0,function(){var e,f,g,k,l,m,n,p,q=this;return a.__generator(this,function(a){switch(a.label){case 0:e=h.clone(b),g=e.outSR,a.label=1;case 1:return a.trys.push([1,8,,9]),[4,this._schedule(function(){return A.normalizeQuery(e,q.definitionExpression,q.spatialReference)})];case 2:return e=a.sent(),[4,this._reschedule(function(){return q._checkQuerySupport(e)})];
case 3:return e=a.sent(),e.returnGeometry=!0,e.returnCentroid=!1,e.outSR=null,[4,this._reschedule(function(){return q._executeGeometryQuery(e)})];case 4:return f=a.sent(),[4,this._reschedule(function(){return f.executeObjectIdsQuery(e)})];case 5:return f=a.sent(),[4,this._reschedule(function(){return f.executeTimeQuery(e)})];case 6:return f=a.sent(),[4,this._reschedule(function(){return f.executeAttributesQuery(e)})];case 7:f=a.sent();k=f.size;if(!k)return[2,{count:k,extent:null}];c.set(E,c.NEGATIVE_INFINITY);
this.featureStore.forEachBounds(f.items,function(a){return c.expand(E,a)},J);l={xmin:E[0],ymin:E[1],xmax:E[3],ymax:E[4],spatialReference:A.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(E[2])&&isFinite(E[5])&&(l.zmin=E[2],l.zmax=E[5]);m=v.project(l,f.spatialReference,g);m.spatialReference=A.cleanFromGeometryEngine(g||this.spatialReference);0===m.xmax-m.xmin&&(n=d.getMetersPerUnitForSR(m.spatialReference),m.xmin-=n,m.xmax+=n);0===m.ymax-m.ymin&&(n=d.getMetersPerUnitForSR(m.spatialReference),
m.ymin-=n,m.ymax+=n);this.hasZ&&null!=m.zmin&&null!=m.zmax&&0===m.zmax-m.zmin&&(n=d.getMetersPerUnitForSR(m.spatialReference),m.zmin-=n,m.zmax+=n);return[2,{count:k,extent:m}];case 8:p=a.sent();if(p===A.QUERY_ENGINE_EMPTY_RESULT)return[2,{count:0,extent:null}];throw p;case 9:return[2]}})})};b.prototype.executeQueryForIds=function(b,c){void 0===b&&(b={});return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return[2,this.executeQueryForIdSet(b,c).then(function(a){return l.valuesOfSet(a)})]})})};
b.prototype.executeQueryForIdSet=function(b,c){void 0===b&&(b={});return a.__awaiter(this,void 0,void 0,function(){var c,d,e,f,g,k=this;return a.__generator(this,function(a){switch(a.label){case 0:c=h.clone(b),c.returnGeometry=!1,c.returnCentroid=!1,c.outSR=null,a.label=1;case 1:return a.trys.push([1,9,,10]),[4,this._schedule(function(){return A.normalizeQuery(c,k.definitionExpression,k.spatialReference)})];case 2:return c=a.sent(),[4,this._reschedule(function(){return k._checkQuerySupport(c)})];
case 3:return c=a.sent(),[4,this._reschedule(function(){return k._executeGeometryQuery(c)})];case 4:return d=a.sent(),[4,this._reschedule(function(){return d.executeObjectIdsQuery(c)})];case 5:return d=a.sent(),[4,this._reschedule(function(){return d.executeTimeQuery(c)})];case 6:return d=a.sent(),[4,this._reschedule(function(){return d.executeAttributesQuery(c)})];case 7:return d=a.sent(),e=d.items,f=new Set,[4,this._reschedule(function(){for(var a=0,b=e;a<b.length;a++)f.add(d.featureAdapter.getObjectId(b[a]))})];
case 8:return a.sent(),[2,f];case 9:g=a.sent();if(g===A.QUERY_ENGINE_EMPTY_RESULT)return[2,new Set];throw g;case 10:return[2]}})})};b.prototype.executeQueryForLatestObservations=function(b,c){void 0===b&&(b={});return a.__awaiter(this,void 0,void 0,function(){var c,d,e,f=this;return a.__generator(this,function(a){switch(a.label){case 0:if(!this.timeInfo||!this.timeInfo.trackIdField)throw new m("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:b,timeInfo:this.timeInfo});
c=h.clone(b);a.label=1;case 1:return a.trys.push([1,9,,10]),[4,this._schedule(function(){return A.normalizeQuery(c,f.definitionExpression,f.spatialReference)})];case 2:return c=a.sent(),[4,this._reschedule(function(){return f._checkQuerySupport(c)})];case 3:return c=a.sent(),[4,this._reschedule(function(){return f._executeGeometryQuery(c)})];case 4:return d=a.sent(),[4,this._reschedule(function(){return d.executeObjectIdsQuery(c)})];case 5:return d=a.sent(),[4,this._reschedule(function(){return d.executeTimeQuery(c)})];
case 6:return d=a.sent(),[4,this._reschedule(function(){return d.executeAttributesQuery(c)})];case 7:return d=a.sent(),[4,this._reschedule(function(){return d.filterLatest()})];case 8:return d=a.sent(),[3,10];case 9:e=a.sent();if(e!==A.QUERY_ENGINE_EMPTY_RESULT)throw e;d=new w.default([],null,this);return[3,10];case 10:return[2,d.createQueryResponse(c)]}})})};b.prototype._schedule=function(b){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return this._frameQueue?
[2,this._frameQueue.push(b)]:[2,b()]})})};b.prototype._reschedule=function(b){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return this._frameQueue?[2,this._frameQueue.unshift(b)]:[2,b()]})})};b.prototype._update=function(a){for(this._budget=a;!a.done&&this._frameQueue&&this._frameQueue.process();)a.madeProgress();this._budget=null};b.prototype._getAll=function(){if(!this._allItems){var a=[];this.featureStore.forEach(function(b){return a.push(b)});this._allItems=
new w.default(a,null,this)}return this._allItems};b.prototype._executeGeometryQuery=function(b){return a.__awaiter(this,void 0,void 0,function(){var c,d,f,g,h,k,l,m,n,p,r,u,v,A,y,z,B,C,E,F,H=this;return a.__generator(this,function(G){switch(G.label){case 0:c=b.geometry;d=b.outSR;f=b.spatialRel;g=t.isValid(d)&&!t.equals(this.spatialReference,d);if(h=this._geometryQueryCache?g?JSON.stringify({geometry:c,spatialRelationship:f,outSpatialReference:d}):JSON.stringify({geometry:c,spatialRelationship:f}):
null)if(k=this._geometryQueryCache.get(h),!e.isUndefined(k))return[2,k];l=function(c){return a.__awaiter(H,void 0,void 0,function(){var e;return a.__generator(this,function(a){switch(a.label){case 0:return g&&(b.returnGeometry||b.returnCentroid)?[4,c.project(d)]:[3,2];case 1:return e=a.sent(),h&&this._geometryQueryCache.put(h,e,e.size||1),[2,e];case 2:return h&&this._geometryQueryCache.put(h,c,c.size||1),[2,c]}})})};if(!c)return[2,l(this._getAll())];m=this.featureAdapter;if("esriSpatialRelDisjoint"!==
f)return[3,3];n=this._searchFeatures(this._getQueryBBoxes(c));if(!n.length)return[2,l(this._getAll())];u=new Set;v=0;for(A=n;v<A.length;v++)y=A[v],u.add(m.getObjectId(y));return[4,this._reschedule(function(){var a=0;p=Array(u.size);H.featureStore.forEach(function(b){return p[a++]=b});r=u})];case 1:return G.sent(),[4,this._reschedule(function(){return a.__awaiter(H,void 0,void 0,function(){var b,d,e;return a.__generator(this,function(a){switch(a.label){case 0:return[4,q.getSpatialQueryOperator(f,c,
this.geometryType,this.hasZ,this.hasM)];case 1:return b=a.sent(),d=function(a){return!r.has(m.getObjectId(a))||b(m.getGeometry(a))},e=w.default.bind,[4,this._runSpatialFilter(p,d)];case 2:return[2,new (e.apply(w.default,[void 0,a.sent(),c,this]))]}})})})];case 2:return z=G.sent(),[2,l(z)];case 3:return B=this._searchFeatures(this._getQueryBBoxes(c)),B.length?(C=this._canExecuteSoloPass(c,b))?[2,l(new w.default(B,c,this))]:[4,q.getSpatialQueryOperator(f,c,this.geometryType,this.hasZ,this.hasM)]:(z=
new w.default([],c,this),h&&this._geometryQueryCache.put(h,z,z.size||1),[2,z]);case 4:return E=G.sent(),[4,this._runSpatialFilter(B,function(a){return E(m.getGeometry(a))})];case 5:return F=G.sent(),[2,l(new w.default(F,c,this))]}})})};b.prototype._runSpatialFilter=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var d,e,f,g=this;return a.__generator(this,function(h){if(!c)return[2,b];if(!this._budget)return[2,b.filter(function(a){return c(a)})];d=0;e=[];f=function(){return a.__awaiter(g,
void 0,void 0,function(){var g;return a.__generator(this,function(a){switch(a.label){case 0:if(!(d<b.length))return[3,3];g=b[d];c(g)&&e.push(g);return this._budget.done?[4,this._reschedule(function(){return f()})]:[3,2];case 1:a.sent(),a.label=2;case 2:return++d,[3,0];case 3:return[2]}})})};return[2,this._reschedule(function(){return f()}).then(function(){return e})]})})};b.prototype._canExecuteSoloPass=function(a,b){var c=this.geometryType;b=b.spatialRel;return q.canQueryWithRBush(a)&&("esriSpatialRelEnvelopeIntersects"===
b||"esriGeometryPoint"===c&&("esriSpatialRelIntersects"===b||"esriSpatialRelContains"===b||"esriSpatialRelWithin"===b))};b.prototype._getQueryBBoxes=function(a){if(q.canQueryWithRBush(a)){if(r.isExtent(a))return[k.fromValues(a.xmin,a.ymin,a.xmax,a.ymax)];if(r.isPolygon(a))return a.rings.map(function(a){return k.fromValues(Math.min(a[0][0],a[2][0]),Math.min(a[0][1],a[2][1]),Math.max(a[0][0],a[2][0]),Math.max(a[0][1],a[2][1]))})}return[p.getBoundsXY(k.create(),a)]};b.prototype._searchFeatures=function(a){for(var b=
0;b<a.length;b++)this.featureStore.forEachInBounds(a[b],function(a){H.add(a)});var c=Array(H.size),d=0;H.forEach(function(a){return c[d++]=a});H.clear();return c};b.prototype._checkQuerySupport=function(b){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){if(0>b.distance||null!=b.geometryPrecision||b.multipatchOption||b.pixelSize||b.relationParam||b.text)throw new m("feature-store:unsupported-query","Unsupported query options",{query:b});return[2,g.all([this._checkAttributesQuerySupport(b),
this._checkStatisticsQuerySupport(b),q.checkSpatialQuerySupport(b,this.geometryType,this.spatialReference),v.checkProjectionSupport(this.spatialReference,b.outSR)]).then(function(){return b})]})})};b.prototype._checkAttributesQuerySupport=function(a){var b=a.outFields,c=a.orderByFields,d=a.returnDistinctValues,e=a.outStatistics,f=e?e.map(function(a){return a.outStatisticFieldName&&a.outStatisticFieldName.toLowerCase()}):[];c&&0<c.length&&(c=c.map(function(a){var b=a.toLowerCase();return-1<b.indexOf(" asc")?
b.split(" asc")[0]:-1<b.indexOf(" desc")?b.split(" desc")[0]:a}).filter(function(a){return-1===f.indexOf(a)}),u.validateFields(this.fieldsIndex,c,"orderByFields contains missing fields"));if(b&&0<b.length)u.validateFields(this.fieldsIndex,b,"outFields contains missing fields");else if(d)throw new m("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:a});u.validateWhere(this.fieldsIndex,a.where)};b.prototype._checkStatisticsQuerySupport=function(b){return a.__awaiter(this,
void 0,void 0,function(){var c,d,e,f,g,h,k,l,n,p,q,r,t;return a.__generator(this,function(a){c=b.outStatistics;d=b.groupByFieldsForStatistics;e=b.having;f=d&&d.length;g=c&&c.length;if(e){if(!f||!g)throw new m("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:b});u.validateHaving(this.fieldsIndex,e,c)}if(g){if(!F(c))return[2];h=c.map(function(a){return a.onStatisticField});u.validateFields(this.fieldsIndex,h,"onStatisticFields contains missing fields");
f&&u.validateFields(this.fieldsIndex,d,"groupByFieldsForStatistics contains missing fields");k=0;for(l=c;k<l.length;k++)if(n=l[k],p=n.onStatisticField,q=n.statisticType,(r="percentile_disc"===q||"percentile_cont"===q)&&"statisticParameters"in n){if(t=n.statisticParameters,!t)throw new m("feature-store:unsupported-query","statisticParamters should be set for percentile type",{definition:n,query:b});}else if("count"!==q&&p&&u.hasInvalidFieldType(p,this.fieldsIndex))throw new m("feature-store:unsupported-query",
"outStatistics contains non-numeric fields",{definition:n,query:b});}return[2]})})};return b}();b.default=n;var J=c.create(),E=c.create()})},"esri/layers/graphics/data/attributeSupport":function(){define(["require","exports","../../../core/Error","../../../core/SetUtils","../../../core/sql/WhereClauseCache"],function(n,b,a,m,h){function e(a,b){return a?l.get(a,b):null}function f(b,d,h,l){void 0===l&&(l=!0);for(var c=[],k=0;k<d.length;k++){var m=d[k];if("*"!==m&&!b.has(m))if(l){var n=g(m);try{var p=
e(n,b);if(!p)throw new a("feature-store:unsupported-query","invalid SQL expression",{where:n});if(!p.isStandardized)throw new a("feature-store:unsupported-query","expression is not standard",{clause:p});f(b,p.fieldNames,"expression contains missing fields")}catch(q){if((n=q&&q.details)&&(n.clause||n.where))throw q;n&&n.missingFields?c.push.apply(c,n.missingFields):c.push(m)}}else c.push(m)}if(c.length)throw new a("feature-store:unsupported-query",h,{missingFields:c});}function g(a){return a.split(" as ")[0]}
Object.defineProperty(b,"__esModule",{value:!0});var l=new h.WhereClauseCache(50,500),d=m.SetFromValues("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeDate".split(" "));b.validateWhere=function(b,d){if(!d)return!0;var c=l.get(d,b);if(!c)throw new a("feature-store:unsupported-query","invalid SQL expression",{where:d});if(!c.isStandardized)throw new a("feature-store:unsupported-query","where clause is not standard",
{where:d});f(b,c.fieldNames,"where clause contains missing fields");return!0};b.validateHaving=function(b,d,e){if(!d)return!0;var c=l.get(d,b);if(!c)throw new a("feature-store:unsupported-query","invalid SQL expression",{having:d});if(!c.isAggregate)throw new a("feature-store:unsupported-query","having does not contain a valid aggregate function",{having:d});f(b,c.fieldNames,"having contains missing fields");if(!c.getExpressions().every(function(a){var c=a.aggregateType;a=a.field;var d=b.has(a)&&
b.get(a).name;return e.some(function(a){var e=a.onStatisticField;a=a.statisticType;return(b.has(e)&&b.get(e).name)===d&&a.toLowerCase().trim()===c})}))throw new a("feature-store:unsupported-query","expressions in having should also exist in outStatistics",{having:d});return!0};b.getWhereClause=e;b.validateFields=f;b.getExpressionFromFieldName=g;b.getAliasFromFieldName=function(a){return a.split(" as ")[1]};b.hasInvalidFieldType=function(a,b){return(a=b.get(a))?!d.has(a.type):!1}})},"esri/core/sql/WhereClauseCache":function(){define(["require",
"exports","../ItemCache","./WhereClause"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,f){this._cache=new a(b);this._invalidCache=new a(f)}b.prototype.get=function(a,b){var e=b.uid+":"+a,f=this._cache.get(e);if(f)return f;if(void 0!==this._invalidCache.get(e))return null;try{var d=m.WhereClause.create(a,b);this._cache.put(e,d);return d}catch(c){return this._invalidCache.put(e,null),null}};return b}();b.WhereClauseCache=n})},"esri/core/sql/WhereClause":function(){define("require exports ../has ../MapUtils ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),
function(n,b,a,m,h,e,f){function g(a,b){a+="";return a.length>=b?a:Array(b-a.length+1).join("0")+a}function l(a,b,c,d,e,f,h,k,l){void 0===c&&(c="0");void 0===d&&(d="0");void 0===e&&(e="0");void 0===f&&(f="0");void 0===h&&(h="");void 0===k&&(k="0");void 0===l&&(l="0");return"+"===h||"-"===h?(a=g(parseInt(a,10),4)+"-"+g(parseInt(b,10),2)+"-"+g(parseInt(c,10),2),b="",10>parseFloat(f)&&(b="0"),d=g(parseInt(d,10),2)+":"+g(parseInt(e,10),2)+":"+(b+parseFloat(f).toString()),h=""+h+g(parseInt(k,10),2)+":"+
g(parseInt(l,10),2),new Date(a+"T"+d+h)):new Date(parseInt(a,10),parseInt(b,10)-1,parseInt(c,10),parseInt(d,10),parseInt(e,10),parseFloat(f))}function d(a){var b=C.exec(a);if(null!==b){a=b[1];var c=b[2],d=b[3],e=b[4],f=b[5],g=b[6];return l(a,c,d,e,f,g)}b=F.exec(a);if(null!==b){a=b[1];var c=b[2],d=b[3],e=b[4],f=b[5],g=b[6],h=b[7],k=b[8],b=b[9];return l(a,c,d,e,f,g,h,k,b)}b=H.exec(a);if(null!==b)return a=b[1],c=b[2],d=b[3],e=b[4],f=b[5],h=b[6],k=b[7],b=b[8],l(a,c,d,e,f,"0",h,k,b);b=I.exec(a);if(null!==
b)return a=b[1],c=b[2],d=b[3],e=b[4],f=b[5],l(a,c,d,e,f);b=B.exec(a);if(null!==b)return a=b[1],c=b[2],d=b[3],l(a,c,d);throw Error("SQL Invalid Timestamp");}function c(a){a=B.exec(a);if(null===a)throw Error("SQL Invalid Date");var b=a[2],c=a[3];return new Date(parseInt(a[1],10),parseInt(b,10)-1,parseInt(c,10))}function k(a){return Array.isArray(a)?a:[a]}function p(a){return null!==a?!0!==a:null}function r(a,b){return null!=a&&null!=b?!0===a&&!0===b:!1===a||!1===b?!1:null}function t(a,b){return null!=
a&&null!=b?!0===a||!0===b:!0===a||!0===b?!0:null}function u(a,b){if(null==a)return null;for(var c=!1,d=0;d<b.length;d++){var e=b[d];if(null==e)c=null;else if(a===e){c=!0;break}}return c}function v(a,b,c){if(null==a)return null;for(var d="",e=0,f=0;f<b.length;f++){var g=b.charAt(f);switch(e){case 0:g===c?e=1:d=0<="-[]/{}()*+?.\\^$|".indexOf(g)?d+("\\"+g):"%"===g?d+".*":"_"===g?d+".":d+g;break;case 1:d=0<="-[]/{}()*+?.\\^$|".indexOf(g)?d+("\\"+g):d+g,e=0}}return(new RegExp("^"+d+"$")).test(a)}function z(a){return a instanceof
Date?a.valueOf():a}function w(a,b,c){if(null==b||null==c)return null;b=z(b);c=z(c);switch(a){case "\x3c\x3e":return b!==c;case "\x3d":return b===c;case "\x3e":return b>c;case "\x3c":return b<c;case "\x3e\x3d":return b>=c;case "\x3c\x3d":return b<=c}}function q(a){for(var b=[],c={},d=0;d<a.length;d++){var e=a[d],f=e.toLowerCase();void 0===c[f]&&(b.push(e),c[f]=1)}return b}function y(a,b,c){if(b instanceof e.SqlInterval)if(c instanceof Date)switch(a){case "+":return new Date(b.valueInMilliseconds()+
c.getTime());case "-":return b.valueInMilliseconds()-c.getTime();case "*":return b.valueInMilliseconds()*c.getTime();case "/":return b.valueInMilliseconds()/c.getTime()}else if(c instanceof e.SqlInterval)switch(a){case "+":return e.SqlInterval.createFromMilliseconds(b.valueInMilliseconds()+c.valueInMilliseconds());case "-":return e.SqlInterval.createFromMilliseconds(b.valueInMilliseconds()-c.valueInMilliseconds());case "*":return b.valueInMilliseconds()*c.valueInMilliseconds();case "/":return b.valueInMilliseconds()/
c.valueInMilliseconds()}else b=b.valueInMilliseconds();else if(c instanceof e.SqlInterval)if(b instanceof Date)switch(a){case "+":return new Date(c.valueInMilliseconds()+b.getTime());case "-":return new Date(b.getTime()-c.valueInMilliseconds());case "*":return b.getTime()*c.valueInMilliseconds();case "/":return b.getTime()/c.valueInMilliseconds()}else c=c.valueInMilliseconds();else if(b instanceof Date&&"number"===typeof c)switch(c*=864E5,b=b.getTime(),a){case "+":return new Date(b+c);case "-":return new Date(b-
c);case "*":return new Date(b*c);case "/":return new Date(b/c)}else if(c instanceof Date&&"number"===typeof b)switch(b*=864E5,c=c.getTime(),a){case "+":return new Date(b+c);case "-":return new Date(b-c);case "*":return new Date(b*c);case "/":return new Date(b/c)}switch(a){case "+":return b+c;case "-":return b-c;case "*":return b*c;case "/":return b/c}}function A(a,b,c,d){a=d.getAttribute(a,b);return null!=a&&1===c[b]?new Date(a):a}Object.defineProperty(b,"__esModule",{value:!0});var B=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,
C=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,F=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,H=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,I=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,G=function(){function a(){}a.makeBool=function(a){return!0===a};a.featureValue=function(a,b,c,d){return A(a,b,c,d)};a.equalsNull=function(a){return null===a};a.applyLike=function(a,b,c){return v(a,
b,c)};a.ensureArray=function(a){return k(a)};a.applyIn=function(a,b){return u(a,b)};a.currentDate=function(){var a=new Date;a.setHours(0,0,0,0);return a};a.makeSqlInterval=function(a,b,c){return e.SqlInterval.createFromValueAndQualifer(a,b,c)};a.convertInterval=function(a){return a instanceof e.SqlInterval?a.valueInMilliseconds():a};a.currentTimestamp=function(){return new Date};a.compare=function(a,b,c){return w(a,b,c)};a.calculate=function(a,b,c){return y(a,b,c)};a.makeComparable=function(a){return z(a)};
a.evaluateFunction=function(a,b){return e.evaluateFunction(a,b)};a.lookup=function(a,b){a=b[a];return void 0===a?null:a};a.between=function(a,b){return null==a||null==b[0]||null==b[1]?null:a>=b[0]&&a<=b[1]};a.notbetween=function(a,b){return null==a||null==b[0]||null==b[1]?null:a<b[0]||a>b[1]};a.ternaryNot=function(a){return p(a)};a.ternaryAnd=function(a,b){return r(a,b)};a.ternaryOr=function(a,b){return t(a,b)};return a}();n=function(){function g(a,b){this.fieldsIndex=b;this.datefields={};this.parameters=
{};this.parseTree=f.WhereGrammar.parse(a);a=this.extractExpressionInfo(b);b=a.isStandardized;var c=a.isAggregate;this.referencedFieldNames=a.referencedFieldNames;this.isStandardized=b;this.isAggregate=c}g.create=function(a,b){return new g(a,b)};Object.defineProperty(g.prototype,"fieldNames",{get:function(){return this.referencedFieldNames},enumerable:!0,configurable:!0});g.prototype.testSet=function(a,c){void 0===c&&(c=b.defaultAttributeAdapter);for(var d={},e=function(b){d[b]=a.map(function(a){return c.getAttribute(a,
b)})},f=0,g=this.fieldNames;f<g.length;f++)e(g[f]);return!!this.evaluateNode(this.parseTree,{attributes:d},b.defaultAttributeAdapter)};g.prototype.calculateValue=function(a,c){void 0===c&&(c=b.defaultAttributeAdapter);a=this.evaluateNode(this.parseTree,a,c);return a instanceof e.SqlInterval?a.valueInMilliseconds()/864E5:a};g.prototype.calculateValueCompiled=function(c,d){void 0===d&&(d=b.defaultAttributeAdapter);if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(c,this.parameters,
d,this.datefields);if(a("csp-restrictions"))return this.calculateValue(c,d);this.compileMe();return this.parseTree._compiledVersion(c,this.parameters,d,this.datefields)};g.prototype.testFeature=function(a,c){void 0===c&&(c=b.defaultAttributeAdapter);return!!this.evaluateNode(this.parseTree,a,c)};g.prototype.testFeatureCompiled=function(c,d){void 0===d&&(d=b.defaultAttributeAdapter);if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(c,this.parameters,d,this.datefields);
if(a("csp-restrictions"))return this.testFeature(c,d);this.compileMe();return!!this.parseTree._compiledVersion(c,this.parameters,d,this.datefields)};g.prototype.getFunctions=function(){var a=[];this.visitAll(this.parseTree,function(b){"function"===b.type&&a.push(b.name.toLowerCase())});return q(a)};g.prototype.getExpressions=function(){var a=new Map;this.visitAll(this.parseTree,function(b){if("function"===b.type){var c=b.name.toLowerCase();b=b.args.value[0];if("column_ref"===b.type){b=b.column;var d=
c+"-"+b;a.has(d)||a.set(d,{aggregateType:c,field:b})}}});return m.valuesOfMap(a)};g.prototype.getVariables=function(){var a=[];this.visitAll(this.parseTree,function(b){"param"===b.type&&a.push(b.value.toLowerCase())});return q(a)};g.prototype.compileMe=function(){var a="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","datefields",a)).bind(G)};g.prototype.extractExpressionInfo=function(a){var b=
this,c=[],d=!0,f=!0;this.visitAll(this.parseTree,function(g){switch(g.type){case "column_ref":var k=a.get(g.column),l=k&&k.name;!k||"date"!==k.type&&"esriFieldTypeDate"!==k.type||(b.datefields[k.name]=1);void 0!==l?(c.push(l),g.column=l):c.push(g.column);break;case "function":k=g.name,g=g.args.value.length,d&&(d=e.isStandardized(k,g)),f&&(f=h.isAggregate(k,g))}});return{referencedFieldNames:q(c),isStandardized:d,isAggregate:f}};g.prototype.visitAll=function(a,b){if(null!=a)switch(b(a),a.type){case "when_clause":this.visitAll(a.operand,
b);this.visitAll(a.value,b);break;case "case_expression":for(var c=0,d=a.clauses;c<d.length;c++){var e=d[c];this.visitAll(e,b)}"simple"===a.format&&this.visitAll(a.operand,b);null!==a.else&&this.visitAll(a.else,b);break;case "expr_list":c=0;for(a=a.value;c<a.length;c++)e=a[c],this.visitAll(e,b);break;case "unary_expr":this.visitAll(a.expr,b);break;case "binary_expr":this.visitAll(a.left,b);this.visitAll(a.right,b);break;case "function":this.visitAll(a.args,b)}};g.prototype.evaluateNodeToJavaScript=
function(a){switch(a.type){case "interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(a.value)+", "+JSON.stringify(a.qualifier)+","+JSON.stringify(a.op)+")";case "case_expression":var b="";if("simple"===a.format)for(var e="this.makeComparable("+this.evaluateNodeToJavaScript(a.operand)+")",b="( ",f=0;f<a.clauses.length;f++)b+=" ("+e+" \x3d\x3d\x3d this.makeComparable("+this.evaluateNodeToJavaScript(a.clauses[f].operand)+")) ? ("+this.evaluateNodeToJavaScript(a.clauses[f].value)+") : ";
else for(b="( ",f=0;f<a.clauses.length;f++)b+=" this.makeBool("+this.evaluateNodeToJavaScript(a.clauses[f].operand)+")\x3d\x3d\x3dtrue ? ("+this.evaluateNodeToJavaScript(a.clauses[f].value)+") : ";b=null!==a.else?b+this.evaluateNodeToJavaScript(a.else):b+"null";return b+" )";case "param":return"this.lookup("+JSON.stringify(a.value.toLowerCase())+",lookups)";case "expr_list":b="[";e=0;for(a=a.value;e<a.length;e++)f=a[e],"["!==b&&(b+=","),b+=this.evaluateNodeToJavaScript(f);return b+"]";case "unary_expr":return"this.ternaryNot("+
this.evaluateNodeToJavaScript(a.expr)+")";case "binary_expr":switch(a.operator){case "AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+" )";case "IS":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(a.left)+")";case "ISNOT":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");
return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(a.left)+")))";case "IN":return"this.applyIn("+this.evaluateNodeToJavaScript(a.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(a.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(a.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(a.right)+")))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")";case "NOTBETWEEN":return"this.notbetween("+
this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+","+JSON.stringify(a.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+","+JSON.stringify(a.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+
JSON.stringify(a.operator)+","+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")";case "*":case "-":case "+":case "/":return"this.calculate("+JSON.stringify(a.operator)+","+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")"}throw Error("Not Supported Operator "+a.operator);case "null":case "bool":case "string":case "number":return JSON.stringify(a.value);case "date":return"(new Date("+c(a.value).getTime().toString()+"))";case "timestamp":return"(new Date("+
d(a.value).getTime().toString()+"))";case "current_time":return"date"===a.mode?"this.currentDate()":"this.currentTimestamp()";case "column_ref":return"this.featureValue(feature,"+JSON.stringify(a.column)+",datefields,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(a.name)+","+this.evaluateNodeToJavaScript(a.args)+")"}throw Error("Unsupported sql syntax "+a.type);};g.prototype.evaluateNode=function(a,b,f){switch(a.type){case "interval":return b=this.evaluateNode(a.value,
b,f),e.SqlInterval.createFromValueAndQualifer(b,a.qualifier,a.op);case "case_expression":if("simple"===a.format)for(var g=z(this.evaluateNode(a.operand,b,f)),l=0;l<a.clauses.length;l++){if(g===z(this.evaluateNode(a.clauses[l].operand,b,f)))return this.evaluateNode(a.clauses[l].value,b,f)}else for(l=0;l<a.clauses.length;l++)if(!0===this.evaluateNode(a.clauses[l].operand,b,f))return this.evaluateNode(a.clauses[l].value,b,f);return null!==a.else?this.evaluateNode(a.else,b,f):null;case "param":return this.parameters[a.value.toLowerCase()];
case "expr_list":g=[];l=0;for(a=a.value;l<a.length;l++)g.push(this.evaluateNode(a[l],b,f));return g;case "unary_expr":return p(this.evaluateNode(a.expr,b,f));case "binary_expr":switch(a.operator){case "AND":return r(this.evaluateNode(a.left,b,f),this.evaluateNode(a.right,b,f));case "OR":return t(this.evaluateNode(a.left,b,f),this.evaluateNode(a.right,b,f));case "IS":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return null===this.evaluateNode(a.left,b,f);case "ISNOT":if("null"!==
a.right.type)throw Error("Unsupported RHS for IS");return null!==this.evaluateNode(a.left,b,f);case "IN":return g=k(this.evaluateNode(a.right,b,f)),u(this.evaluateNode(a.left,b,f),g);case "NOT IN":return g=k(this.evaluateNode(a.right,b,f)),p(u(this.evaluateNode(a.left,b,f),g));case "BETWEEN":return g=this.evaluateNode(a.left,b,f),a=this.evaluateNode(a.right,b,f),null==g||null==a[0]||null==a[1]?null:g>=z(a[0])&&g<=z(a[1]);case "NOTBETWEEN":return g=this.evaluateNode(a.left,b,f),a=this.evaluateNode(a.right,
b,f),null==g||null==a[0]||null==a[1]?null:g<z(a[0])||g>z(a[1]);case "LIKE":return v(this.evaluateNode(a.left,b,f),this.evaluateNode(a.right,b,f),a.escape);case "NOT LIKE":return p(v(this.evaluateNode(a.left,b,f),this.evaluateNode(a.right,b,f),a.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return w(a.operator,this.evaluateNode(a.left,b,f),this.evaluateNode(a.right,b,f));case "-":case "+":case "*":case "/":return y(a.operator,this.evaluateNode(a.left,
b,f),this.evaluateNode(a.right,b,f))}case "null":case "bool":case "string":case "number":return a.value;case "date":return c(a.value);case "timestamp":return d(a.value);case "current_time":return b=new Date,"date"===a.mode&&b.setHours(0,0,0,0),b;case "column_ref":return A(b,a.column,this.datefields,f);case "function":return b=this.evaluateNode(a.args,b,f),this.isAggregate?h.aggregateFunction(a.name,b):e.evaluateFunction(a.name,b)}throw Error("Unsupported sql syntax "+a.type);};return g}();b.WhereClause=
n;b.defaultAttributeAdapter={getAttribute:function(a,b){return(a&&"object"===typeof a.attributes?a.attributes:a)[b]}}})},"esri/core/sql/AggregateFunctions":function(){define(["require","exports"],function(n,b){function a(a){for(var b=0,e=0;e<a.length;e++)b+=a[e];return b/a.length}function m(b){for(var e=a(b),g=b.length,h=0,d=0;d<b.length;d++)h+=Math.pow(b[d]-e,2);return 1<g?h/(g-1):0}Object.defineProperty(b,"__esModule",{value:!0});b.aggregateFunction=function(a,b){var e=h[a.toLowerCase()];if(null==
e)throw Error("Function Not Recognised");if(b.length<e.minParams||b.length>e.maxParams)throw Error("Invalid Parameter count for call to "+a.toUpperCase());return e.evaluate(b)};b.isAggregate=function(a,b){a=h[a.toLowerCase()];return null!=a&&b>=a.minParams&&b<=a.maxParams};var h={min:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.min.apply(Math,a[0])}},max:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.max.apply(Math,a[0])}},avg:{minParams:1,maxParams:1,
evaluate:function(b){return null==b[0]?null:a(b[0])}},sum:{minParams:1,maxParams:1,evaluate:function(a){if(null==a[0])a=null;else{a=a[0];for(var b=0,e=0;e<a.length;e++)b+=a[e];a=b}return a}},stddev:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.sqrt(m(a[0]))}},count:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].length}},var:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:m(a[0])}}}})},"esri/core/sql/StandardizedFunctions":function(){define(["require",
"exports","../string"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(){this.op="+";this.minute=this.year=this.month=this.hour=this.second=this.day=0}a.fixDefaults=function(a){if(null!==a.precision||null!==a.secondary)throw Error("Primary and Secondary SqlInterval qualifiers not supported");};a.createFromMilliseconds=function(b){var e=new a;e.second=b/1E3;return e};a.createFromValueAndQualifer=function(b,f,g){var e=null,d=new a;d.op="-"===g?"-":"+";if("interval-period"===
f.type){a.fixDefaults(f);if("year"===f.period||"month"===f.period)throw Error("Year-Month Intervals not supported");if(/^[0-9]{1,}$/.test(b))d[f.period]=parseFloat(b);else throw Error("Illegal Interval");}else{a.fixDefaults(f.start);a.fixDefaults(f.end);if("year"===f.start.period||"month"===f.start.period)throw Error("Year-Month Intervals not supported");if("year"===f.end.period||"month"===f.end.period)throw Error("Year-Month Intervals not supported");switch(f.start.period){case "day":switch(f.end.period){case "hour":e=
/^[0-9]{1,} [0-9]{1,}$/;if(e.test(b))d[f.start.period]=parseFloat(b.split(" ")[0]),d[f.end.period]=parseFloat(b.split(" ")[1]);else throw Error("Illegal Interval");break;case "minute":e=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$/;if(e.test(b))d[f.start.period]=parseFloat(b.split(" ")[0]),b=b.split(" ")[1].split(":"),d.hour=parseFloat(b[0]),d.minute=parseFloat(b[1]);else throw Error("Illegal Interval");break;case "second":e=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(e.test(b))d[f.start.period]=
parseFloat(b.split(" ")[0]),b=b.split(" ")[1].split(":"),d.hour=parseFloat(b[0]),d.minute=parseFloat(b[1]),d.second=parseFloat(b[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "hour":switch(f.end.period){case "minute":e=/^[0-9]{1,}:[0-9]{1,}$/;if(e.test(b))d.hour=parseFloat(b.split(":")[0]),d.minute=parseFloat(b.split(":")[1]);else throw Error("Illegal Interval");break;case "second":e=/^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(e.test(b))b=
b.split(":"),d.hour=parseFloat(b[0]),d.minute=parseFloat(b[1]),d.second=parseFloat(b[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "minute":switch(f.end.period){case "second":e=/^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(e.test(b))b=b.split(":"),d.minute=parseFloat(b[0]),d.second=parseFloat(b[1]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;default:throw"Invalid Interval.";}}return d};a.prototype.valueInMilliseconds=
function(){return("-"===this.op?-1:1)*(1E3*this.second+6E4*this.minute+36E5*this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)};return a}();b.SqlInterval=n;b.evaluateFunction=function(a,b){var e=m[a.toLowerCase()];if(null==e)throw Error("Function Not Recognised");if(b.length<e.minParams||b.length>e.maxParams)throw Error("Invalid Parameter count for call to "+a.toUpperCase());return e.evaluate(b)};b.isStandardized=function(a,b){a=m[a.toLowerCase()];return null!=a&&b>=a.minParams&&
b<=a.maxParams};var m={extract:{minParams:2,maxParams:2,evaluate:function(a){var b=a[0];a=a[1];if(null==a)return null;if(a instanceof Date)switch(b.toUpperCase()){case "SECOND":return a.getSeconds();case "MINUTE":return a.getMinutes();case "HOUR":return a.getHours();case "DAY":return a.getDate();case "MONTH":return a.getMonth()+1;case "YEAR":return a.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,maxParams:3,evaluate:function(a){if(2===a.length){var b=
a[0],f=a[1];return null==b||null==f?null:b.toString().substring(f-1)}if(3===a.length)return b=a[0],f=a[1],a=a[2],null==b||null==f||null==a?null:0>=a?"":b.toString().substring(f-1,f+a-1)}},position:{minParams:2,maxParams:2,evaluate:function(a){var b=a[0];a=a[1];return null==b||null==a?null:a.indexOf(b)+1}},trim:{minParams:2,maxParams:3,evaluate:function(b){var e=3===b.length,f=e?b[1]:" ",e=e?b[2]:b[1];if(null==f||null==e)return null;f="("+a.escapeRegExpString(f)+")";switch(b[0]){case "BOTH":return e.replace(new RegExp("^"+
f+"*|"+f+"*$","g"),"");case "LEADING":return e.replace(new RegExp("^"+f+"*","g"),"");case "TRAILING":return e.replace(new RegExp(f+"*$","g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.abs(a[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.ceil(a[0])}},floor:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.floor(a[0])}},log:{minParams:1,maxParams:1,
evaluate:function(a){return null==a[0]?null:Math.log(a[0])}},log10:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.sin(a[0])}},cos:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.cos(a[0])}},tan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.tan(a[0])}},asin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?
null:Math.asin(a[0])}},acos:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.acos(a[0])}},atan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.atan(a[0])}},sign:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:0<a[0]?1:0>a[1]?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:Math.pow(a[0],a[1])}},mod:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:a[0]%
a[1]}},round:{minParams:1,maxParams:2,evaluate:function(a){var b=a[0];a=2===a.length?Math.pow(10,a[1]):1;return null==b?null:Math.round(b*a)/a}},truncate:{minParams:1,maxParams:2,evaluate:function(a){return null==a[0]?null:1===a.length?parseInt(a[0].toFixed(0),10):parseFloat(a[0].toFixed(a[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(a){return"string"===typeof a[0]||a[0]instanceof String?a[0].length:0}},concat:{minParams:1,maxParams:Infinity,evaluate:function(a){for(var b="",f=0;f<
a.length;f++){if(null==a[f])return null;b+=a[f].toString()}return b}},lower:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toUpperCase()}}}})},"esri/core/sql/WhereGrammar":function(){define(["require","exports","./sql92grammar"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){}b.parse=function(b){return a.parse(b)};
return b}();b.WhereGrammar=n})},"esri/core/sql/sql92grammar":function(){(function(n,b){"function"===typeof define&&define.amd?define([],b):"object"===typeof module&&module.exports&&(module.exports=b())})(this,function(){function n(b,a,m,h){this.message=b;this.expected=a;this.found=m;this.location=h;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,n)}(function(b,a){function m(){this.constructor=b}m.prototype=a.prototype;b.prototype=new m})(n,Error);
n.buildMessage=function(b,a){function m(a){return a.charCodeAt(0).toString(16).toUpperCase()}function h(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+m(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+m(a)})}function e(a){return a.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,
"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+m(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+m(a)})}var f={literal:function(a){return'"'+h(a.text)+'"'},"class":function(a){var b="",d;for(d=0;d<a.parts.length;d++)b+=a.parts[d]instanceof Array?e(a.parts[d][0])+"-"+e(a.parts[d][1]):e(a.parts[d]);return"["+(a.inverted?"^":"")+b+"]"},any:function(a){return"any character"},end:function(a){return"end of input"},other:function(a){return a.description}};
return"Expected "+function(a){var b=Array(a.length),d;for(d=0;d<a.length;d++){var c=d,e;e=a[d];e=f[e.type](e);b[c]=e}b.sort();if(0<b.length){for(a=d=1;d<b.length;d++)b[d-1]!==b[d]&&(b[a]=b[d],a++);b.length=a}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}(b)+" but "+(a?'"'+h(a)+'"':"end of input")+" found."};return{SyntaxError:n,parse:function(b,a){function m(a,b){return{type:"literal",text:a,ignoreCase:b}}function h(a,
b,c){return{type:"class",parts:a,inverted:b,ignoreCase:c}}function e(a){var c=Na[a],d;if(!c){for(d=a-1;!Na[d];)d--;c=Na[d];for(c={line:c.line,column:c.column};d<a;)10===b.charCodeAt(d)?(c.line++,c.column=1):c.column++,d++;Na[a]=c}return c}function f(a,b){var c=e(a),d=e(b);return{start:{offset:a,line:c.line,column:c.column},end:{offset:b,line:d.line,column:d.column}}}function g(a){D<Ta||(D>Ta&&(Ta=D,sb=[]),sb.push(a))}function l(){var a,b,d;a=D;b=ha();b!==x?(b=c(),b!==x?(d=ha(),d!==x?a=b:(D=a,a=x)):
(D=a,a=x)):(D=a,a=x);return a}function d(){var a,b,d,e,f,g,h,k;a=D;b=c();if(b!==x){d=[];e=D;f=ha();f!==x?(g=sa(),g!==x?(h=ha(),h!==x?(k=c(),k!==x?e=f=[f,g,h,k]:(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x);for(;e!==x;)d.push(e),e=D,f=ha(),f!==x?(g=sa(),g!==x?(h=ha(),h!==x?(k=c(),k!==x?e=f=[f,g,h,k]:(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x);if(d!==x){a={type:"expr_list"};b=[b];for(e=0;e<d.length;e++)b.push(d[e][3]);a.value=b}else D=a,a=x}else D=a,a=x;return a}function c(){var a,b,c,d,e,f,g,h;a=D;b=k();
if(b!==x){c=[];d=D;e=ha();e!==x?(f=ga(),f!==x?(g=ha(),g!==x?(h=k(),h!==x?d=e=[e,f,g,h]:(D=d,d=x)):(D=d,d=x)):(D=d,d=x)):(D=d,d=x);for(;d!==x;)c.push(d),d=D,e=ha(),e!==x?(f=ga(),f!==x?(g=ha(),g!==x?(h=k(),h!==x?d=e=[e,f,g,h]:(D=d,d=x)):(D=d,d=x)):(D=d,d=x)):(D=d,d=x);c!==x?a=b=gb(b,c):(D=a,a=x)}else D=a,a=x;return a}function k(){var a,b,c,d,e,f,g,h;a=D;b=p();if(b!==x){c=[];d=D;e=ha();e!==x?(f=fa(),f!==x?(g=ha(),g!==x?(h=p(),h!==x?d=e=[e,f,g,h]:(D=d,d=x)):(D=d,d=x)):(D=d,d=x)):(D=d,d=x);for(;d!==x;)c.push(d),
d=D,e=ha(),e!==x?(f=fa(),f!==x?(g=ha(),g!==x?(h=p(),h!==x?d=e=[e,f,g,h]:(D=d,d=x)):(D=d,d=x)):(D=d,d=x)):(D=d,d=x);c!==x?a=b=gb(b,c):(D=a,a=x)}else D=a,a=x;return a}function p(){var a,c,e,f,h;a=D;c=da();c===x&&(c=D,33===b.charCodeAt(D)?(e=tb,D++):(e=x,0===ca&&g(Ia)),e!==x?(f=D,ca++,61===b.charCodeAt(D)?(h=Wa,D++):(h=x,0===ca&&g(ub)),ca--,h===x?f=void 0:(D=f,f=x),f!==x?c=e=[e,f]:(D=c,c=x)):(D=c,c=x));c!==x?(e=ha(),e!==x?(f=p(),f!==x?a=c={type:"unary_expr",operator:"NOT",expr:f}:(D=a,a=x)):(D=a,a=x)):
(D=a,a=x);if(a===x)if(a=D,c=v(),c!==x)if(e=ha(),e!==x){var k,l,m;e=[];f=D;h=ha();h!==x?(k=r(),k!==x?(l=ha(),l!==x?(m=v(),m!==x?f=h=[h,k,l,m]:(D=f,f=x)):(D=f,f=x)):(D=f,f=x)):(D=f,f=x);if(f!==x)for(;f!==x;)e.push(f),f=D,h=ha(),h!==x?(k=r(),k!==x?(l=ha(),l!==x?(m=v(),m!==x?f=h=[h,k,l,m]:(D=f,f=x)):(D=f,f=x)):(D=f,f=x)):(D=f,f=x);else e=x;e!==x&&(e={type:"arithmetic",tail:e});e===x&&(e=D,f=u(),f!==x?(h=ha(),h!==x?(h=qa(),h!==x?(h=ha(),h!==x?(h=d(),h!==x?(k=ha(),k!==x?(k=Ca(),k!==x?e=f={op:f,right:h}:
(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x),e===x&&(e=D,f=u(),f!==x?(h=ha(),h!==x?(h=qa(),h!==x?(h=ha(),h!==x?(h=Ca(),h!==x?e=f={op:f,right:{type:"expr_list",value:[]}}:(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x),e===x&&(e=D,f=u(),f!==x?(h=ha(),h!==x?(h=H(),h!==x?e=f={op:f,right:h}:(D=e,e=x)):(D=e,e=x)):(D=e,e=x))),e===x&&(e=D,h=da(),h!==x?(f=ha(),f!==x?(f=ka(),f!==x?(k=ha(),k!==x?(k=v(),k!==x?(l=ha(),l!==x?(l=fa(),l!==x?(h=ha(),h!==x?(h=v(),h!==x?e=h={op:"NOT"+
f,right:{type:"expr_list",value:[k,h]}}:(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x),e===x&&(e=D,h=ka(),h!==x?(f=ha(),f!==x?(f=v(),f!==x?(k=ha(),k!==x?(k=fa(),k!==x?(l=ha(),l!==x?(l=v(),l!==x?e=h={op:h,right:{type:"expr_list",value:[f,l]}}:(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x)),e===x&&(e=D,f=X(),f!==x?(h=ha(),h!==x?(h=da(),h!==x?(h=ha(),h!==x?(h=v(),h!==x?e=f={op:f+"NOT",right:h}:(D=e,e=x)):(D=e,e=x)):(D=e,
e=x)):(D=e,e=x)):(D=e,e=x),e===x&&(e=D,f=X(),f!==x?(h=ha(),h!==x?(h=v(),h!==x?e=f={op:f,right:h}:(D=e,e=x)):(D=e,e=x)):(D=e,e=x)),e===x&&(e=D,f=t(),f!==x?(h=ha(),h!==x?(h=M(),h!==x?(k=ha(),k!==x?(k=D,b.substr(D,6).toLowerCase()===Rc?(l=b.substr(D,6),D+=6):(l=x,0===ca&&g(rc)),l!==x?(l=D,ca++,m=C(),ca--,m===x?l=void 0:(D=l,l=x),l!==x?k="ESCAPE":(D=k,k=x)):(D=k,k=x),k!==x?(k=ha(),k!==x?(k=N(),k!==x?e=f={op:f,right:h,escape:k.value}:(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=e,e=x)):(D=
e,e=x),e===x&&(e=D,f=t(),f!==x?(h=ha(),h!==x?(h=M(),h!==x?e=f={op:f,right:h,escape:""}:(D=e,e=x)):(D=e,e=x)):(D=e,e=x))))));e===x&&(e=null);e!==x?(a=c,c=e,""==c||void 0==c||null==c?c=a:(e=null,c=e="arithmetic"==c.type?gb(a,c.tail):nb(c.op,a,c.right,c.escape)),a=c):(D=a,a=x)}else D=a,a=x;else D=a,a=x;return a}function r(){var a;b.substr(D,2)===Ka?(a=Ka,D+=2):(a=x,0===ca&&g(eb));a===x&&(62===b.charCodeAt(D)?(a=ya,D++):(a=x,0===ca&&g(Fb)),a===x&&(b.substr(D,2)===vb?(a=vb,D+=2):(a=x,0===ca&&g(rb)),a===
x&&(b.substr(D,2)===Pb?(a=Pb,D+=2):(a=x,0===ca&&g(Ob)),a===x&&(60===b.charCodeAt(D)?(a=ob,D++):(a=x,0===ca&&g(ib)),a===x&&(61===b.charCodeAt(D)?(a=Wa,D++):(a=x,0===ca&&g(ub)),a===x&&(b.substr(D,2)===wb?(a=wb,D+=2):(a=x,0===ca&&g(Qb))))))));return a}function t(){var a,b,c,d;a=a=D;b=da();b!==x?(c=ha(),c!==x?(d=Y(),d!==x?a=b=[b,c,d]:(D=a,a=x)):(D=a,a=x)):(D=a,a=x);a!==x&&(a=a[0]+" "+a[2]);a===x&&(a=Y());return a}function u(){var a,b,c,d;a=a=D;b=da();b!==x?(c=ha(),c!==x?(d=T(),d!==x?a=b=[b,c,d]:(D=a,
a=x)):(D=a,a=x)):(D=a,a=x);a!==x&&(a=a[0]+" "+a[2]);a===x&&(a=T());return a}function v(){var a,b,c,d,e,f,g,h;a=D;b=w();if(b!==x){c=[];d=D;e=ha();e!==x?(f=z(),f!==x?(g=ha(),g!==x?(h=w(),h!==x?d=e=[e,f,g,h]:(D=d,d=x)):(D=d,d=x)):(D=d,d=x)):(D=d,d=x);for(;d!==x;)c.push(d),d=D,e=ha(),e!==x?(f=z(),f!==x?(g=ha(),g!==x?(h=w(),h!==x?d=e=[e,f,g,h]:(D=d,d=x)):(D=d,d=x)):(D=d,d=x)):(D=d,d=x);c!==x?a=b=gb(b,c):(D=a,a=x)}else D=a,a=x;return a}function z(){var a;43===b.charCodeAt(D)?(a=Rb,D++):(a=x,0===ca&&g(bc));
a===x&&(45===b.charCodeAt(D)?(a=hc,D++):(a=x,0===ca&&g(cc)));return a}function w(){var a,b,c,d,e,f,g,h;a=D;b=y();if(b!==x){c=[];d=D;e=ha();e!==x?(f=q(),f!==x?(g=ha(),g!==x?(h=y(),h!==x?d=e=[e,f,g,h]:(D=d,d=x)):(D=d,d=x)):(D=d,d=x)):(D=d,d=x);for(;d!==x;)c.push(d),d=D,e=ha(),e!==x?(f=q(),f!==x?(g=ha(),g!==x?(h=y(),h!==x?d=e=[e,f,g,h]:(D=d,d=x)):(D=d,d=x)):(D=d,d=x)):(D=d,d=x);c!==x?a=b=gb(b,c):(D=a,a=x)}else D=a,a=x;return a}function q(){var a;42===b.charCodeAt(D)?(a=Xa,D++):(a=x,0===ca&&g(Gb));a===
x&&(47===b.charCodeAt(D)?(a=dc,D++):(a=x,0===ca&&g(Xb)));return a}function y(){var a,e,f,h,k,l,m;m=N();if(m===x){var n,p,q,r;n=D;var t,u,v,w;t=D;u=O();u!==x?(v=U(),v!==x?(w=P(),w!==x?t=u=parseFloat(u+v+w):(D=t,t=x)):(D=t,t=x)):(D=t,t=x);t===x&&(t=D,u=O(),u!==x?(v=U(),v!==x?t=u=parseFloat(u+v):(D=t,t=x)):(D=t,t=x),t===x&&(t=D,u=O(),u!==x?(v=P(),v!==x?t=u=parseFloat(u+v):(D=t,t=x)):(D=t,t=x),t===x&&(t=D,u=O(),u!==x&&(u=parseFloat(u)),t=u)));p=t;p!==x?(q=D,ca++,r=B(),ca--,r===x?q=void 0:(D=q,q=x),q!==
x?n=p={type:"number",value:p}:(D=n,n=x)):(D=n,n=x);m=n;if(m===x){var y,z;y=D;var E,J,Va,L;E=D;b.substr(D,4).toLowerCase()===Id?(J=b.substr(D,4),D+=4):(J=x,0===ca&&g(Jd));J!==x?(Va=D,ca++,L=C(),ca--,L===x?Va=void 0:(D=Va,Va=x),Va!==x?E=J=[J,Va]:(D=E,E=x)):(D=E,E=x);z=E;z!==x&&(z={type:"bool",value:!0});y=z;if(y===x){y=D;var K,da,ba,Y;K=D;b.substr(D,5).toLowerCase()===Kd?(da=b.substr(D,5),D+=5):(da=x,0===ca&&g(Ld));da!==x?(ba=D,ca++,Y=C(),ca--,Y===x?ba=void 0:(D=ba,ba=x),ba!==x?K=da=[da,ba]:(D=K,K=
x)):(D=K,K=x);z=K;z!==x&&(z={type:"bool",value:!1});y=z}m=y;if(m===x){var vb,V,tb,rb,fa;V=D;b.substr(D,4).toLowerCase()===Md?(tb=b.substr(D,4),D+=4):(tb=x,0===ca&&g(Nd));tb!==x?(rb=D,ca++,fa=C(),ca--,fa===x?rb=void 0:(D=rb,rb=x),rb!==x?V=tb=[tb,rb]:(D=V,V=x)):(D=V,V=x);vb=V;vb!==x&&(vb={type:"null",value:null});m=vb;if(m===x){var X,ka,Ia,ga;X=D;var S,Fb,Wa,Pb;S=D;b.substr(D,4).toLowerCase()===Od?(Fb=b.substr(D,4),D+=4):(Fb=x,0===ca&&g(Pd));Fb!==x?(Wa=D,ca++,Pb=C(),ca--,Pb===x?Wa=void 0:(D=Wa,Wa=x),
Wa!==x?S=Fb="DATE":(D=S,S=x)):(D=S,S=x);ka=S;ka!==x?(Ia=ha(),Ia!==x?(ga=M(),ga!==x?X=ka={type:"date",value:ga.value}:(D=X,X=x)):(D=X,X=x)):(D=X,X=x);m=X;if(m===x){var hb,va,ub,ma;hb=D;var ea,sa,Ka,Ob;ea=D;b.substr(D,9).toLowerCase()===Qd?(sa=b.substr(D,9),D+=9):(sa=x,0===ca&&g(Rd));sa!==x?(Ka=D,ca++,Ob=C(),ca--,Ob===x?Ka=void 0:(D=Ka,Ka=x),Ka!==x?ea=sa="TIMESTAMP":(D=ea,ea=x)):(D=ea,ea=x);va=ea;va!==x?(ub=ha(),ub!==x?(ma=M(),ma!==x?hb=va={type:"timestamp",value:ma.value}:(D=hb,hb=x)):(D=hb,hb=x)):
(D=hb,hb=x);m=hb;if(m===x){var ya,ob,eb,Sa,gb,ib,wb,nb;ya=D;ob=Z();ob!==x?(eb=ha(),eb!==x?(45===b.charCodeAt(D)?(Sa=hc,D++):(Sa=x,0===ca&&g(cc)),Sa===x&&(43===b.charCodeAt(D)?(Sa=Rb,D++):(Sa=x,0===ca&&g(bc))),Sa!==x?(gb=ha(),gb!==x?(ib=M(),ib!==x?(wb=ha(),wb!==x?(nb=G(),nb!==x?ya=ob={type:"interval",value:ib,qualifier:nb,op:Sa}:(D=ya,ya=x)):(D=ya,ya=x)):(D=ya,ya=x)):(D=ya,ya=x)):(D=ya,ya=x)):(D=ya,ya=x)):(D=ya,ya=x);ya===x&&(ya=D,ob=Z(),ob!==x?(eb=ha(),eb!==x?(Sa=M(),Sa!==x?(gb=ha(),gb!==x?(ib=G(),
ib!==x?ya=ob={type:"interval",value:Sa,qualifier:ib,op:""}:(D=ya,ya=x)):(D=ya,ya=x)):(D=ya,ya=x)):(D=ya,ya=x)):(D=ya,ya=x));m=ya}}}}}}a=m;if(a===x){var pa,Qb,Aa,Ba,Da,Ea,Ha,Na,Zc,Mc,Qa,Ra;pa=D;var Ja,Pa,Ma,Ta;Ja=D;b.substr(D,7).toLowerCase()===Sd?(Pa=b.substr(D,7),D+=7):(Pa=x,0===ca&&g(Td));Pa!==x?(Ma=D,ca++,Ta=C(),ca--,Ta===x?Ma=void 0:(D=Ma,Ma=x),Ma!==x?Ja=Pa="EXTRACT":(D=Ja,Ja=x)):(D=Ja,Ja=x);Qb=Ja;if(Qb!==x)if(Aa=ha(),Aa!==x)if(Ba=qa(),Ba!==x)if(Da=ha(),Da!==x){var Ga;Ga=oa();Ga===x&&(Ga=aa(),
Ga===x&&(Ga=na(),Ga===x&&(Ga=ja(),Ga===x&&(Ga=ta(),Ga===x&&(Ga=ra())))));Ea=Ga;Ea!==x?(Ha=ha(),Ha!==x?(Na=la(),Na!==x?(Zc=ha(),Zc!==x?(Mc=c(),Mc!==x?(Qa=ha(),Qa!==x?(Ra=Ca(),Ra!==x?pa=Qb={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:Ea},Mc]}}:(D=pa,pa=x)):(D=pa,pa=x)):(D=pa,pa=x)):(D=pa,pa=x)):(D=pa,pa=x)):(D=pa,pa=x)):(D=pa,pa=x)}else D=pa,pa=x;else D=pa,pa=x;else D=pa,pa=x;else D=pa,pa=x;a=pa;if(a===x){var La,Xa,bb,cb,db,Ua,fd,lb,fb,mb,sb,qb,kb,Gb,Cb,Db;La=D;
var pb,Ec,Bb,Xb;pb=D;b.substr(D,9).toLowerCase()===Ud?(Ec=b.substr(D,9),D+=9):(Ec=x,0===ca&&g(Vd));Ec!==x?(Bb=D,ca++,Xb=C(),ca--,Xb===x?Bb=void 0:(D=Bb,Bb=x),Bb!==x?pb=Ec="SUBSTRING":(D=pb,pb=x)):(D=pb,pb=x);Xa=pb;if(Xa!==x)if(bb=ha(),bb!==x)if(cb=qa(),cb!==x)if(db=ha(),db!==x)if(Ua=c(),Ua!==x)if(fd=ha(),fd!==x)if(lb=la(),lb!==x)if(fb=ha(),fb!==x)if(mb=c(),mb!==x)if(sb=ha(),sb!==x){qb=D;var lc,Sb,Lb,fc;lc=D;b.substr(D,3).toLowerCase()===Wd?(Sb=b.substr(D,3),D+=3):(Sb=x,0===ca&&g(Xd));Sb!==x?(Lb=D,
ca++,fc=C(),ca--,fc===x?Lb=void 0:(D=Lb,Lb=x),Lb!==x?lc=Sb="FOR":(D=lc,lc=x)):(D=lc,lc=x);kb=lc;kb!==x?(Gb=ha(),Gb!==x?(Cb=c(),Cb!==x?(Db=ha(),Db!==x?qb=kb=[kb,Gb,Cb,Db]:(D=qb,qb=x)):(D=qb,qb=x)):(D=qb,qb=x)):(D=qb,qb=x);qb===x&&(qb=null);qb!==x?(kb=Ca(),kb!==x?La=Xa={type:"function",name:"substring",args:{type:"expr_list",value:qb?[Ua,mb,qb[2]]:[Ua,mb]}}:(D=La,La=x)):(D=La,La=x)}else D=La,La=x;else D=La,La=x;else D=La,La=x;else D=La,La=x;else D=La,La=x;else D=La,La=x;else D=La,La=x;else D=La,La=
x;else D=La,La=x;else D=La,La=x;a=La;if(a===x){var wa,yb,zb,Ab,Ac,Hb,Bc,Eb,Wb,rc,dc,ec,Nb,kc;wa=D;yb=ia();yb!==x?(zb=ha(),zb!==x?(Ab=qa(),Ab!==x?(Ac=ha(),Ac!==x?(Hb=I(),Hb===x&&(Hb=null),Hb!==x?(Bc=ha(),Bc!==x?(Eb=c(),Eb!==x?(Wb=ha(),Wb!==x?(rc=la(),rc!==x?(dc=ha(),dc!==x?(ec=c(),ec!==x?(Nb=ha(),Nb!==x?(kc=Ca(),kc!==x?wa=yb={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==Hb?"BOTH":Hb},Eb,ec]}}:(D=wa,wa=x)):(D=wa,wa=x)):(D=wa,wa=x)):(D=wa,wa=x)):(D=wa,wa=x)):(D=
wa,wa=x)):(D=wa,wa=x)):(D=wa,wa=x)):(D=wa,wa=x)):(D=wa,wa=x)):(D=wa,wa=x)):(D=wa,wa=x)):(D=wa,wa=x);wa===x&&(wa=D,yb=ia(),yb!==x?(zb=ha(),zb!==x?(Ab=qa(),Ab!==x?(Ac=ha(),Ac!==x?(Hb=I(),Hb===x&&(Hb=null),Hb!==x?(Bc=ha(),Bc!==x?(Eb=c(),Eb!==x?(Wb=ha(),Wb!==x?(rc=Ca(),rc!==x?wa=yb={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==Hb?"BOTH":Hb},Eb]}}:(D=wa,wa=x)):(D=wa,wa=x)):(D=wa,wa=x)):(D=wa,wa=x)):(D=wa,wa=x)):(D=wa,wa=x)):(D=wa,wa=x)):(D=wa,wa=x)):(D=wa,wa=x));
a=wa;if(a===x){var Oa,gc,Wc,Ub,Yc,Lc,ad,cd,dd,Oc,ed,gd;Oa=D;var mc,$b,Vb,hd;mc=D;b.substr(D,8).toLowerCase()===Yd?($b=b.substr(D,8),D+=8):($b=x,0===ca&&g(Zd));$b!==x?(Vb=D,ca++,hd=C(),ca--,hd===x?Vb=void 0:(D=Vb,Vb=x),Vb!==x?mc=$b="POSITION":(D=mc,mc=x)):(D=mc,mc=x);gc=mc;gc!==x?(Wc=ha(),Wc!==x?(Ub=qa(),Ub!==x?(Yc=ha(),Yc!==x?(Lc=c(),Lc!==x?(ad=ha(),ad!==x?(cd=T(),cd!==x?(dd=ha(),dd!==x?(Oc=c(),Oc!==x?(ed=ha(),ed!==x?(gd=Ca(),gd!==x?Oa=gc={type:"function",name:"position",args:{type:"expr_list",value:[Lc,
Oc]}}:(D=Oa,Oa=x)):(D=Oa,Oa=x)):(D=Oa,Oa=x)):(D=Oa,Oa=x)):(D=Oa,Oa=x)):(D=Oa,Oa=x)):(D=Oa,Oa=x)):(D=Oa,Oa=x)):(D=Oa,Oa=x)):(D=Oa,Oa=x)):(D=Oa,Oa=x);a=Oa;if(a===x){var jb,ac,Rc,oc,pc,sc,Vc,Zb;jb=D;var Ib,Fc,Gc,Yb;Ib=D;Ib=Fc=A();if(Ib===x)if(Ib=D,96===b.charCodeAt(D)?(Fc=Hd,D++):(Fc=x,0===ca&&g(tc)),Fc!==x){Gc=[];Hc.test(b.charAt(D))?(Yb=b.charAt(D),D++):(Yb=x,0===ca&&g(uc));if(Yb!==x)for(;Yb!==x;)Gc.push(Yb),Hc.test(b.charAt(D))?(Yb=b.charAt(D),D++):(Yb=x,0===ca&&g(uc));else Gc=x;Gc!==x?(96===b.charCodeAt(D)?
(Yb=Hd,D++):(Yb=x,0===ca&&g(tc)),Yb!==x?Ib=Fc=Gc.join(""):(D=Ib,Ib=x)):(D=Ib,Ib=x)}else D=Ib,Ib=x;ac=Ib;ac!==x?(Rc=ha(),Rc!==x?(oc=qa(),oc!==x?(pc=ha(),pc!==x?(sc=d(),sc===x&&(sc=null),sc!==x?(Vc=ha(),Vc!==x?(Zb=Ca(),Zb!==x?jb=ac={type:"function",name:ac,args:sc?sc:{type:"expr_list",value:[]}}:(D=jb,jb=x)):(D=jb,jb=x)):(D=jb,jb=x)):(D=jb,jb=x)):(D=jb,jb=x)):(D=jb,jb=x)):(D=jb,jb=x);a=jb;if(a===x){var Mb,za,vc,Tb,wc,xb,ic,Jb,Ic,qc,Xc;za=D;vc=xa();if(vc!==x)if(Tb=ha(),Tb!==x)if(wc=c(),wc!==x)if(xb=
ha(),xb!==x){ic=[];for(Jb=R();Jb!==x;)ic.push(Jb),Jb=R();ic!==x?(Jb=ha(),Jb!==x?(Ic=ua(),Ic!==x?za=vc={type:"case_expression",format:"simple",operand:wc,clauses:ic,else:null}:(D=za,za=x)):(D=za,za=x)):(D=za,za=x)}else D=za,za=x;else D=za,za=x;else D=za,za=x;else D=za,za=x;if(za===x)if(za=D,vc=xa(),vc!==x)if(Tb=ha(),Tb!==x)if(wc=c(),wc!==x)if(xb=ha(),xb!==x){ic=[];for(Jb=R();Jb!==x;)ic.push(Jb),Jb=R();ic!==x?(Jb=ha(),Jb!==x?(Ic=W(),Ic!==x?(qc=ha(),qc!==x?(Xc=ua(),Xc!==x?za=vc={type:"case_expression",
format:"simple",operand:wc,clauses:ic,else:Ic.value}:(D=za,za=x)):(D=za,za=x)):(D=za,za=x)):(D=za,za=x)):(D=za,za=x)}else D=za,za=x;else D=za,za=x;else D=za,za=x;else D=za,za=x;Mb=za;if(Mb===x){var Fa,xc,zc,jc,Kb,Jc,$c,bd;Fa=D;xc=xa();if(xc!==x)if(zc=ha(),zc!==x){jc=[];for(Kb=Q();Kb!==x;)jc.push(Kb),Kb=Q();jc!==x?(Kb=ha(),Kb!==x?(Jc=ua(),Jc!==x?Fa=xc={type:"case_expression",format:"searched",clauses:jc,else:null}:(D=Fa,Fa=x)):(D=Fa,Fa=x)):(D=Fa,Fa=x)}else D=Fa,Fa=x;else D=Fa,Fa=x;if(Fa===x)if(Fa=
D,xc=xa(),xc!==x)if(zc=ha(),zc!==x){jc=[];for(Kb=Q();Kb!==x;)jc.push(Kb),Kb=Q();jc!==x?(Kb=ha(),Kb!==x?(Jc=W(),Jc!==x?($c=ha(),$c!==x?(bd=ua(),bd!==x?Fa=xc={type:"case_expression",format:"searched",clauses:jc,else:Jc.value}:(D=Fa,Fa=x)):(D=Fa,Fa=x)):(D=Fa,Fa=x)):(D=Fa,Fa=x)):(D=Fa,Fa=x)}else D=Fa,Fa=x;else D=Fa,Fa=x;Mb=Fa}a=Mb;if(a===x){var Kc,nc,Nc,Cc,Dc;nc=D;Nc=B();if(Nc!==x){Cc=[];for(Dc=F();Dc!==x;)Cc.push(Dc),Dc=F();Cc!==x?nc=Nc+=Cc.join(""):(D=nc,nc=x)}else D=nc,nc=x;Kc=nc;if(Kc!==x){var Pc=
Kc;Kc=/^CURRENT_DATE$/i.test(Pc)?{type:"current_time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(Pc)?{type:"current_time",mode:"timestamp"}:{type:"column_ref",table:"",column:Pc}}a=Kc;a===x&&(a=H(),a===x&&(a=D,e=qa(),e!==x?(f=ha(),f!==x?(h=c(),h!==x?(k=ha(),k!==x?(l=Ca(),l!==x?(h.paren=!0,a=e=h):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)))}}}}}}}return a}function A(){var a,b,c,d;a=D;b=B();if(b!==x){c=[];for(d=C();d!==x;)c.push(d),d=C();c!==x?a=b+=c.join(""):(D=a,a=x)}else D=a,a=x;return a}
function B(){var a;yc.test(b.charAt(D))?(a=b.charAt(D),D++):(a=x,0===ca&&g(oc));return a}function C(){var a;pc.test(b.charAt(D))?(a=b.charAt(D),D++):(a=x,0===ca&&g(kb));return a}function F(){var a;Sb.test(b.charAt(D))?(a=b.charAt(D),D++):(a=x,0===ca&&g(bb));return a}function H(){var a,c,d;a=D;64===b.charCodeAt(D)?(c=cb,D++):(c=x,0===ca&&g(Lb));c!==x?(d=A(),d!==x?a=c=[c,d]:(D=a,a=x)):(D=a,a=x);a!==x&&(a={type:"param",value:a[1]});return a}function I(){var a,c,d;a=D;b.substr(D,7).toLowerCase()===Vc?
(c=b.substr(D,7),D+=7):(c=x,0===ca&&g(S));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==x?a="LEADING":(D=a,a=x)):(D=a,a=x);a===x&&(a=D,b.substr(D,8).toLowerCase()===Ba?(c=b.substr(D,8),D+=8):(c=x,0===ca&&g(Ha)),c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==x?a="TRAILING":(D=a,a=x)):(D=a,a=x),a===x&&(a=D,b.substr(D,4).toLowerCase()===Aa?(c=b.substr(D,4),D+=4):(c=x,0===ca&&g(Da)),c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==x?a="BOTH":(D=a,a=x)):(D=a,a=x)));return a}function G(){var a,
c,d;a=D;var e,f;c=D;d=J();d!==x?(e=ha(),e!==x?(e=qa(),e!==x?(e=ha(),e!==x?(e=L(),e!==x?(f=ha(),f!==x?(f=Ca(),f!==x?c=d={type:"interval-period",period:d.value,precision:e,secondary:null}:(D=c,c=x)):(D=c,c=x)):(D=c,c=x)):(D=c,c=x)):(D=c,c=x)):(D=c,c=x)):(D=c,c=x);c===x&&(c=D,d=J(),d!==x&&(d=ec(d)),c=d);if(c!==x)if(d=ha(),d!==x)if(d=D,b.substr(D,2).toLowerCase()===Ea?(e=b.substr(D,2),D+=2):(e=x,0===ca&&g(Ga)),e!==x?(e=D,ca++,f=C(),ca--,f===x?e=void 0:(D=e,e=x),e!==x?d="TO":(D=d,d=x)):(D=d,d=x),d!==x)if(d=
ha(),d!==x){var h;d=D;e=J();e!==x&&(e={type:"interval-period",period:e.value,precision:null,secondary:null});d=e;d===x&&(d=D,e=ra(),e!==x?(e=ha(),e!==x?(e=qa(),e!==x?(e=ha(),e!==x?(e=L(),e!==x?(f=ha(),f!==x?(f=sa(),f!==x?(f=ha(),f!==x?(f=E(),f!==x?(h=ha(),h!==x?(h=Ca(),h!==x?d=e=Zb(e,f):(D=d,d=x)):(D=d,d=x)):(D=d,d=x)):(D=d,d=x)):(D=d,d=x)):(D=d,d=x)):(D=d,d=x)):(D=d,d=x)):(D=d,d=x)):(D=d,d=x)):(D=d,d=x),d===x&&(d=D,e=ra(),e!==x?(e=ha(),e!==x?(e=qa(),e!==x?(e=ha(),e!==x?(e=L(),e!==x?(f=ha(),f!==x?
(f=Ca(),f!==x?d=e={type:"interval-period",period:"second",precision:e,secondary:null}:(D=d,d=x)):(D=d,d=x)):(D=d,d=x)):(D=d,d=x)):(D=d,d=x)):(D=d,d=x)):(D=d,d=x),d===x&&(d=D,e=ra(),e!==x&&(e={type:"interval-period",period:"second",precision:null,secondary:null}),d=e)));d!==x?a=c={type:"interval-qualifier",start:c,end:d}:(D=a,a=x)}else D=a,a=x;else D=a,a=x;else D=a,a=x;else D=a,a=x;a===x&&(a=D,d=J(),d!==x?(c=ha(),c!==x?(c=qa(),c!==x?(c=ha(),c!==x?(c=E(),c!==x?(e=ha(),e!==x?(e=Ca(),e!==x?a=d={type:"interval-period",
period:d.value,precision:c,secondary:null}:(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x),a===x&&(a=D,d=J(),d!==x&&(d=ec(d)),a=d,a===x&&(a=D,d=ra(),d!==x?(c=ha(),c!==x?(c=qa(),c!==x?(c=ha(),c!==x?(c=L(),c!==x?(e=ha(),e!==x?(e=sa(),e!==x?(d=ha(),d!==x?(d=E(),d!==x?(e=ha(),e!==x?(e=Ca(),e!==x?a=d=Zb(c,d):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x),a===x&&(a=D,d=ra(),d!==x?(c=ha(),c!==x?(c=qa(),c!==
x?(c=ha(),c!==x?(c=E(),c!==x?(e=ha(),e!==x?(e=Ca(),e!==x?a=d={type:"interval-period",period:"second",precision:c,secondary:null}:(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x),a===x&&(a=D,d=ra(),d!==x&&(d={type:"interval-period",period:"second",precision:null,secondary:null}),a=d)))));return a}function J(){var a;a=D;a=na();a!==x&&(a={type:"string",value:"day"});a===x&&(a=D,a=ja(),a!==x&&(a={type:"string",value:"hour"}),a===x&&(a=D,a=ta(),a!==x&&(a={type:"string",value:"minute"}),
a===x&&(a=D,a=aa(),a!==x&&(a={type:"string",value:"month"}),a===x&&(a=D,a=oa(),a!==x&&(a={type:"string",value:"year"})))));return a}function E(){var a;a=ba();a!==x&&(a=parseFloat(a));return a}function L(){var a;a=ba();a!==x&&(a=parseFloat(a));return a}function M(){var a;a=N();a===x&&(a=H());return a}function N(){var a,c,d;a=D;39===b.charCodeAt(D)?(c=Mb,D++):(c=x,0===ca&&g(Tb));c===x&&(b.substr(D,2)===Nb?(c=Nb,D+=2):(c=x,0===ca&&g(xb)));if(c!==x){c=[];d=D;b.substr(D,2)===fc?(d=fc,D+=2):(d=x,0===ca&&
g(kc));d!==x&&(d="'");d===x&&(gc.test(b.charAt(D))?(d=b.charAt(D),D++):(d=x,0===ca&&g(K)));for(;d!==x;)c.push(d),d=D,b.substr(D,2)===fc?(d=fc,D+=2):(d=x,0===ca&&g(kc)),d!==x&&(d="'"),d===x&&(gc.test(b.charAt(D))?(d=b.charAt(D),D++):(d=x,0===ca&&g(K)));c!==x?(39===b.charCodeAt(D)?(d=Mb,D++):(d=x,0===ca&&g(Tb)),d!==x?a=c={type:"string",value:c.join("")}:(D=a,a=x)):(D=a,a=x)}else D=a,a=x;return a}function Q(){var a,b,d;a=D;b=va();b!==x?(b=ha(),b!==x?(b=c(),b!==x?(d=ha(),d!==x?(d=ma(),d!==x?(d=ha(),d!==
x?(d=c(),d!==x?a=b={type:"when_clause",operand:b,value:d}:(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x);return a}function R(){var a,b,d;a=D;b=va();b!==x?(b=ha(),b!==x?(b=c(),b!==x?(d=ha(),d!==x?(d=ma(),d!==x?(d=ha(),d!==x?(d=c(),d!==x?a=b={type:"when_clause",operand:b,value:d}:(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x)):(D=a,a=x);return a}function W(){var a,d;a=D;var e,f;d=D;b.substr(D,4).toLowerCase()===yb?(e=b.substr(D,4),D+=4):(e=x,0===ca&&g(Wc));
e!==x?(e=D,ca++,f=C(),ca--,f===x?e=void 0:(D=e,e=x),e!==x?d="ELSE":(D=d,d=x)):(D=d,d=x);d!==x?(d=ha(),d!==x?(d=c(),d!==x?a={type:"else_clause",value:d}:(D=a,a=x)):(D=a,a=x)):(D=a,a=x);return a}function O(){var a,c,d;a=ba();a===x&&(a=D,45===b.charCodeAt(D)?(c=hc,D++):(c=x,0===ca&&g(cc)),c===x&&(43===b.charCodeAt(D)?(c=Rb,D++):(c=x,0===ca&&g(bc))),c!==x?(d=ba(),d!==x?a=c=c[0]+d:(D=a,a=x)):(D=a,a=x));return a}function U(){var a,c;a=D;46===b.charCodeAt(D)?(c=pa,D++):(c=x,0===ca&&g(zb));c!==x?(c=ba(),
c===x&&(c=null),c!==x?a="."+(null!=c?c:""):(D=a,a=x)):(D=a,a=x);return a}function P(){var a,c,d;c=a=D;ea.test(b.charAt(D))?(d=b.charAt(D),D++):(d=x,0===ca&&g(Ab));d!==x?(qc.test(b.charAt(D))?(d=b.charAt(D),D++):(d=x,0===ca&&g(ud)),d===x&&(d=null),d!==x?c="e"+(null===d?"":d):(D=c,c=x)):(D=c,c=x);c!==x?(d=ba(),d!==x?a=c+d:(D=a,a=x)):(D=a,a=x);return a}function ba(){var a,b;a=[];b=V();if(b!==x)for(;b!==x;)a.push(b),b=V();else a=x;a!==x&&(a=a.join(""));return a}function V(){var a;fb.test(b.charAt(D))?
(a=b.charAt(D),D++):(a=x,0===ca&&g(Ub));return a}function T(){var a,c,d;a=D;b.substr(D,2).toLowerCase()===Xc?(c=b.substr(D,2),D+=2):(c=x,0===ca&&g(Yc));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==x?a="IN":(D=a,a=x)):(D=a,a=x);return a}function X(){var a,c,d;a=D;b.substr(D,2).toLowerCase()===zc?(c=b.substr(D,2),D+=2):(c=x,0===ca&&g(Zc));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==x?a="IS":(D=a,a=x)):(D=a,a=x);return a}function Y(){var a,c,d;a=D;b.substr(D,4).toLowerCase()===
Ac?(c=b.substr(D,4),D+=4):(c=x,0===ca&&g(Lc));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==x?a="LIKE":(D=a,a=x)):(D=a,a=x);return a}function da(){var a,c,d;a=D;b.substr(D,3).toLowerCase()===$c?(c=b.substr(D,3),D+=3):(c=x,0===ca&&g(ad));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==x?a="NOT":(D=a,a=x)):(D=a,a=x);return a}function fa(){var a,c,d;a=D;b.substr(D,3).toLowerCase()===bd?(c=b.substr(D,3),D+=3):(c=x,0===ca&&g(Mc));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==
x?a="AND":(D=a,a=x)):(D=a,a=x);return a}function ga(){var a,c,d;a=D;b.substr(D,2).toLowerCase()===Bc?(c=b.substr(D,2),D+=2):(c=x,0===ca&&g(cd));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==x?a="OR":(D=a,a=x)):(D=a,a=x);return a}function ka(){var a,c,d;a=D;b.substr(D,7).toLowerCase()===Nc?(c=b.substr(D,7),D+=7):(c=x,0===ca&&g(dd));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==x?a="BETWEEN":(D=a,a=x)):(D=a,a=x);return a}function la(){var a,c,d;a=D;b.substr(D,4).toLowerCase()===
Cc?(c=b.substr(D,4),D+=4):(c=x,0===ca&&g(Oc));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==x?a="FROM":(D=a,a=x)):(D=a,a=x);return a}function ia(){var a,c,d;a=D;b.substr(D,4).toLowerCase()===Dc?(c=b.substr(D,4),D+=4):(c=x,0===ca&&g(ed));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==x?a="TRIM":(D=a,a=x)):(D=a,a=x);return a}function Z(){var a,c,d;a=D;b.substr(D,8).toLowerCase()===Ja?(c=b.substr(D,8),D+=8):(c=x,0===ca&&g(fd));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==
x?a="INTERVAL":(D=a,a=x)):(D=a,a=x);return a}function oa(){var a,c,d;a=D;b.substr(D,4).toLowerCase()===Pa?(c=b.substr(D,4),D+=4):(c=x,0===ca&&g(lb));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==x?a="YEAR":(D=a,a=x)):(D=a,a=x);return a}function aa(){var a,c,d;a=D;b.substr(D,5).toLowerCase()===Ma?(c=b.substr(D,5),D+=5):(c=x,0===ca&&g(db));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==x?a="MONTH":(D=a,a=x)):(D=a,a=x);return a}function na(){var a,c,d;a=D;b.substr(D,3).toLowerCase()===
Ua?(c=b.substr(D,3),D+=3):(c=x,0===ca&&g(Ec));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==x?a="DAY":(D=a,a=x)):(D=a,a=x);return a}function ja(){var a,c,d;a=D;b.substr(D,4).toLowerCase()===pb?(c=b.substr(D,4),D+=4):(c=x,0===ca&&g(Pc));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==x?a="HOUR":(D=a,a=x)):(D=a,a=x);return a}function ta(){var a,c,d;a=D;b.substr(D,6).toLowerCase()===gd?(c=b.substr(D,6),D+=6):(c=x,0===ca&&g($d));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==
x?a="MINUTE":(D=a,a=x)):(D=a,a=x);return a}function ra(){var a,c,d;a=D;b.substr(D,6).toLowerCase()===ae?(c=b.substr(D,6),D+=6):(c=x,0===ca&&g(be));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==x?a="SECOND":(D=a,a=x)):(D=a,a=x);return a}function xa(){var a,c,d;a=D;b.substr(D,4).toLowerCase()===ce?(c=b.substr(D,4),D+=4):(c=x,0===ca&&g(Bb));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==x?a="CASE":(D=a,a=x)):(D=a,a=x);return a}function ua(){var a,c,d;a=D;b.substr(D,3).toLowerCase()===
Cb?(c=b.substr(D,3),D+=3):(c=x,0===ca&&g(Db));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==x?a="END":(D=a,a=x)):(D=a,a=x);return a}function va(){var a,c,d;a=D;b.substr(D,4).toLowerCase()===$b?(c=b.substr(D,4),D+=4):(c=x,0===ca&&g(de));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==x?a="WHEN":(D=a,a=x)):(D=a,a=x);return a}function ma(){var a,c,d;a=D;b.substr(D,4).toLowerCase()===Eb?(c=b.substr(D,4),D+=4):(c=x,0===ca&&g(Qa));c!==x?(c=D,ca++,d=C(),ca--,d===x?c=void 0:(D=c,c=x),c!==
x?a="THEN":(D=a,a=x)):(D=a,a=x);return a}function sa(){var a;44===b.charCodeAt(D)?(a=ee,D++):(a=x,0===ca&&g(Vb));return a}function qa(){var a;40===b.charCodeAt(D)?(a=fe,D++):(a=x,0===ca&&g(hd));return a}function Ca(){var a;41===b.charCodeAt(D)?(a=ge,D++):(a=x,0===ca&&g(Ra));return a}function ha(){var a,b;a=[];for(b=Sa();b!==x;)a.push(b),b=Sa();return a}function Sa(){var a;Wb.test(b.charAt(D))?(a=b.charAt(D),D++):(a=x,0===ca&&g(ac));return a}function nb(a,b,c,d){a={type:"binary_expr",operator:a,left:b,
right:c};void 0!==d&&(a.escape=d);return a}function gb(a,b){for(var c=0;c<b.length;c++)a=nb(b[c][1],a,b[c][3]);return a}a=void 0!==a?a:{};var x={},hb={start:l},Va=l,tb="!",Ia=m("!",!1),Wa="\x3d",ub=m("\x3d",!1),Ka="\x3e\x3d",eb=m("\x3e\x3d",!1),ya="\x3e",Fb=m("\x3e",!1),vb="\x3c\x3d",rb=m("\x3c\x3d",!1),Pb="\x3c\x3e",Ob=m("\x3c\x3e",!1),ob="\x3c",ib=m("\x3c",!1),wb="!\x3d",Qb=m("!\x3d",!1),Rb="+",bc=m("+",!1),hc="-",cc=m("-",!1),Xa="*",Gb=m("*",!1),dc="/",Xb=m("/",!1),yc=/^[A-Za-z_\x80-\uFFFF]/,oc=
h([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),pc=/^[A-Za-z0-9_]/,kb=h([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Sb=/^[A-Za-z0-9_.\x80-\uFFFF]/,bb=h([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),cb="@",Lb=m("@",!1),ec=function(a){return{type:"interval-period",period:a.value,precision:null,secondary:null}},Zb=function(a,b){return{type:"interval-period",period:"second",precision:a,secondary:b}},Mb="'",Tb=m("'",!1),Nb="N'",xb=m("N'",!1),fc="''",kc=m("''",!1),gc=/^[^']/,
K=h(["'"],!0,!1),pa=".",zb=m(".",!1),fb=/^[0-9]/,Ub=h([["0","9"]],!1,!1),ea=/^[eE]/,Ab=h(["e","E"],!1,!1),qc=/^[+\-]/,ud=h(["+","-"],!1,!1),Md="null",Nd=m("NULL",!0),Id="true",Jd=m("TRUE",!0),Kd="false",Ld=m("FALSE",!0),Xc="in",Yc=m("IN",!0),zc="is",Zc=m("IS",!0),Ac="like",Lc=m("LIKE",!0),Rc="escape",rc=m("ESCAPE",!0),$c="not",ad=m("NOT",!0),bd="and",Mc=m("AND",!0),Bc="or",cd=m("OR",!0),Nc="between",dd=m("BETWEEN",!0),Cc="from",Oc=m("FROM",!0),Wd="for",Xd=m("FOR",!0),Ud="substring",Vd=m("SUBSTRING",
!0),Sd="extract",Td=m("EXTRACT",!0),Dc="trim",ed=m("TRIM",!0),Yd="position",Zd=m("POSITION",!0),Qd="timestamp",Rd=m("TIMESTAMP",!0),Od="date",Pd=m("DATE",!0),Vc="leading",S=m("LEADING",!0),Ba="trailing",Ha=m("TRAILING",!0),Aa="both",Da=m("BOTH",!0),Ea="to",Ga=m("TO",!0),Ja="interval",fd=m("INTERVAL",!0),Pa="year",lb=m("YEAR",!0),Ma="month",db=m("MONTH",!0),Ua="day",Ec=m("DAY",!0),pb="hour",Pc=m("HOUR",!0),gd="minute",$d=m("MINUTE",!0),ae="second",be=m("SECOND",!0),ce="case",Bb=m("CASE",!0),Cb="end",
Db=m("END",!0),$b="when",de=m("WHEN",!0),Eb="then",Qa=m("THEN",!0),yb="else",Wc=m("ELSE",!0),ee=",",Vb=m(",",!1),fe="(",hd=m("(",!1),ge=")",Ra=m(")",!1),Wb=/^[ \t\n\r]/,ac=h([" ","\t","\n","\r"],!1,!1),Hd="`",tc=m("`",!1),Hc=/^[^`]/,uc=h(["`"],!0,!1),D=0,Na=[{line:1,column:1}],Ta=0,sb=[],ca=0,mb;if("startRule"in a){if(!(a.startRule in hb))throw Error("Can't start parsing from rule \""+a.startRule+'".');Va=hb[a.startRule]}mb=Va();if(mb!==x&&D===b.length)return mb;mb!==x&&D<b.length&&g({type:"end"});
throw function(a,b,c){return new n(n.buildMessage(a,b),a,b,c)}(sb,Ta<b.length?b.charAt(Ta):null,Ta<b.length?f(Ta,Ta+1):f(Ta,Ta));}}})},"esri/layers/graphics/data/projectionSupport":function(){define("require exports tslib ../../../core/Error ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(n,b,a,m,h,e,f,g,l){function d(a,b){var d;if(!b)return null;
if("x"in b){var e={x:0,y:0};a=a(b.x,b.y,r);e.x=a[0];e.y=a[1];null!=b.z&&(e.z=b.z);null!=b.m&&(e.m=b.m);return e}if("xmin"in b)return e={xmin:0,ymin:0,xmax:0,ymax:0},d=a(b.xmin,b.ymin,r),e.xmin=d[0],e.ymin=d[1],a=a(b.xmax,b.ymax,r),e.xmax=a[0],e.ymax=a[1],b.hasZ&&(e.zmin=b.zmin,e.zmax=b.zmax,e.hasZ=!0),b.hasM&&(e.mmin=b.mmin,e.mmax=b.mmax,e.hasM=!0),e;if("rings"in b)return{rings:c(b.rings,a),hasM:b.hasM,hasZ:b.hasZ};if("paths"in b)return{paths:c(b.paths,a),hasM:b.hasM,hasZ:b.hasZ};if("points"in b)return{points:k(b.points,
a),hasM:b.hasM,hasZ:b.hasZ}}function c(a,b){for(var c=[],d=0;d<a.length;d++)c.push(k(a[d],b));return c}function k(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],f=b(e[0],e[1],[0,0]);c.push(f);2<e.length&&f.push(e[2]);3<e.length&&f.push(e[3])}return c}function p(a,b){return!g.isValid(a)||!g.isValid(b)||g.equals(a,b)||l.canProject(a,b)?!1:!0}Object.defineProperty(b,"__esModule",{value:!0});var r=[0,0];b.doesBrowserSupportProjection=function(a,b){return p(a,b)?e.isSupported():!0};b.checkProjectionSupport=
function(b,c){return a.__awaiter(this,void 0,void 0,function(){var d,f,g;return a.__generator(this,function(a){if(!c)return[2];if(Array.isArray(b)){d=0;for(f=b;d<f.length;d++)if(g=f[d],p(g.geometry&&g.geometry.spatialReference,c)){if(e.isSupported())return[2,e.load()];throw new m("feature-store:unsupported-query","projection not supported",{inSpatialReference:b,outSpatialReference:c});}return[2]}if(!p(b,c))return[2];if(e.isSupported())return[2,e.load()];throw new m("feature-store:unsupported-query",
"projection not supported",{inSpatialReference:b,outSpatialReference:c});})})};var t=d.bind(null,l.lngLatToXY),u=d.bind(null,l.xyToLngLat);b.project=function(a,b,c){if(!a)return a;c||(c=b,b=a.spatialReference);return g.isValid(b)&&g.isValid(c)&&!g.equals(b,c)?l.canProject(b,c)?g.isWebMercator(c)?t(a):u(a):e.projectMany(f.jsonAdapter,[a],b,c,null)[0]:a};var v=new (function(){function b(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}b.prototype.push=function(b,c,d){return a.__awaiter(this,
void 0,void 0,function(){var e,f=this;return a.__generator(this,function(a){b&&b.length&&c&&d&&!g.equals(c,d)||h.resolve(b);e={geometries:b,inSpatialReference:c,outSpatialReference:d,resolve:null};this._jobs.push(e);return[2,h.create(function(a){e.resolve=a;null===f._timer&&(f._timer=setTimeout(f._process,10))})]})})};b.prototype._process=function(){this._timer=null;var a=this._jobs.shift();if(a){var b=a.geometries,c=a.inSpatialReference,d=a.outSpatialReference,a=a.resolve;l.canProject(c,d)?g.isWebMercator(d)?
a(b.map(t)):a(b.map(u)):a(e.projectMany(f.jsonAdapter,b,c,d,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return b}());b.projectMany=function(b,c,d){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return[2,v.push(b,c,d)]})})}})},"esri/geometry/projection":function(){define("require exports ../core/promiseUtils ./pe ./support/GeographicTransformation @dojo/framework/shim/Promise".split(" "),function(n,b,a,m,h){function e(a,b,d,e,l){void 0===
l&&(l=null);if(null===l){var k=h.cacheKey(d,e);void 0!==c[k]?l=c[k]:(l=f(d,e,null),null===l&&(l=new h),c[k]=l)}return g._project(a,b,d,e,l)}function f(a,b,c){void 0===c&&(c=null);a=g._getTransformation(l,a,b,c,null===c||void 0===c?void 0:c.spatialReference);return null!==a?h.fromGE(a):null}Object.defineProperty(b,"__esModule",{value:!0});var g=null,l=null;b.isLoaded=function(){return!!g&&m.isLoaded()};b.isSupported=function(){return m.isSupported()};var d=null;b.load=function(){return d?d:d=a.all([m.load(),
new Promise(function(a,b){n(["./geometryEngineBase"],a,b)}),new Promise(function(a,b){n(["./geometryAdapters/hydrated"],a,b)})]).then(function(a){var b=a[1];l=a[2].hydratedAdapter;g=b;g._enableProjection(m)})};b.project=function(a,b,c){void 0===c&&(c=null);return a instanceof Array?0===a.length?[]:e(l,a,a[0].spatialReference,b,c):e(l,[a],a.spatialReference,b,c)[0]};var c={};b.projectMany=e;b.getTransformation=f;b.getTransformations=function(a,b,c){void 0===c&&(c=null);a=g._getTransformationBySuitability(l,
a,b,c,null===c||void 0===c?void 0:c.spatialReference);if(null!==a){b=[];for(c=0;c<a.length;c++)b.push(h.fromGE(a[c]));return b}return[]}})},"esri/geometry/pe":function(){define("require exports tslib ../assets ../core/has ../core/promiseUtils @dojo/framework/shim/Promise".split(" "),function(n,b,a,m,h,e){function f(d){function e(a,b,c){a[b]=c(a[b])}b._pe=d;p.init();r.init();t.init();u.init();v.init();b.PeGCSExtent=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}a.__extends(d,
c);d.prototype.destroy=function(){b._pe.destroy(this)};return d}(b._pe.PeGCSExtent);for(var f=0,g=[b._pe.PeDatum,b._pe.PeGeogcs,b._pe.PeGeogtran,b._pe.PeObject,b._pe.PeParameter,b._pe.PePrimem,b._pe.PeProjcs,b._pe.PeSpheroid,b._pe.PeUnit];f<g.length;f++)d=g[f],e(d.prototype,"getName",function(a){return function(){return a.call(this,Array(p.PE_NAME_MAX))}});f=0;for(g=[b._pe.PeGeogtran,b._pe.PeProjcs];f<g.length;f++)d=g[f],e(d.prototype,"getParameters",function(a){return function(){for(var c=Array(p.PE_PARM_MAX),
d=a.call(this),e=0;e<c.length;e++){var f=b._pe.getValue(d,"*");c[e]=f?b._pe.wrapPointer(f,b._pe.PeParameter):null;d+=Int32Array.BYTES_PER_ELEMENT}return c}});e(b._pe.PeHorizon.prototype,"getCoord",function(a){return function(){var b=this.getSize();if(!b)return null;var d=[],e=a.call(this);c(d,b,e);return d}});e(b._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(a){var c=b._pe._pe_getPeGTlistExtendedGTsSize();return function(){var d=null,e=a.call(this);if(!b._pe.compare(e,b._pe.NULL)){var d=
[e],f=this.getSteps();if(1<f)for(var e=b._pe.getPointer(e),g=1;g<f;g++)d.push(b._pe.wrapPointer(e+c*g,b._pe.PeGTlistExtendedGTs))}return d}});var h=b._pe._pe_getPeHorizonSize();d=function(a){return function(){var c=this._cache;c||(this._cache=c=new Map);if(c.has(a))return c.get(a);var d=null,e=a.call(this);if(!b._pe.compare(e,b._pe.NULL)){var d=[e],f=e.getNump();if(1<f)for(var e=b._pe.getPointer(e),g=1;g<f;g++)d.push(b._pe.wrapPointer(e+h*g,b._pe.PeHorizon))}c.set(a,d);return d}};e(b._pe.PeProjcs.prototype,
"horizonGcsGenerate",d);e(b._pe.PeProjcs.prototype,"horizonPcsGenerate",d);b._pe.PeObject.prototype.toString=function(a){void 0===a&&(a=p.PE_STR_OPTS_NONE);b._pe.ensureCache.prepare();var c=b._pe.getPointer(this),d=b._pe.ensureInt8(Array(p.PE_BUFFER_MAX));return b._pe.UTF8ToString(b._pe._pe_object_to_string_ext(c,a,d))}}function g(a){if(a){var c=b._pe.getClass(a);c&&(c=b._pe.getCache(c))&&(a=b._pe.getPointer(a))&&delete c[a]}}function l(a,c){var d=[];c=Array(c);for(var e=0;e<a;e++)d.push(b._pe.ensureInt8(c));
return d}function d(a){var b;Array.isArray(a[0])?(b=[],a.forEach(function(a){b.push(a[0],a[1])})):b=a;return b}function c(a,c,d,e){void 0===e&&(e=!1);if(e)for(e=0;e<2*c;e++)a[e]=b._pe.getValue(d+e*Float64Array.BYTES_PER_ELEMENT,"double");else{var f=0===a.length;for(e=0;e<c;e++)f&&(a[e]=Array(2)),a[e][0]=b._pe.getValue(d,"double"),a[e][1]=b._pe.getValue(d+Float64Array.BYTES_PER_ELEMENT,"double"),d+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(b,"__esModule",{value:!0});var k;b._pe=null;
b.isLoaded=function(){return!!b._pe};b.isSupported=function(){return!!h("esri-wasm")};b.load=function(){return k?k:k=e.create(function(a,b){(new Promise(function(a,b){n(["./support/pe-wasm"],a,b)})).then(function(c){c({locateFile:function(a){return m.getAssetUrl("esri/geometry/support/"+a)},onAbort:function(a){b(Error(a))}}).then(function(b){f(b);a()})})})};(function(a){function e(a,e,f){b._pe.ensureCache.prepare();var g=d(f),h=f===g,g=b._pe.ensureFloat64(g);(a=b._pe._pe_geog_to_proj(b._pe.getPointer(a),
e,g))&&c(f,e,g,h);return a}function f(a,b,c){return g(a,b,c,0)}function g(a,e,f,g){b._pe.ensureCache.prepare();var h=d(f),k=f===h,h=b._pe.ensureFloat64(h);(a=b._pe._pe_proj_to_geog_center(b._pe.getPointer(a),e,h,g))&&c(f,e,h,k);return a}a.geogToProj=e;a.projGeog=function(a,b,c,d){switch(d){case p.PE_TRANSFORM_P_TO_G:return f(a,b,c);case p.PE_TRANSFORM_G_TO_P:return e(a,b,c)}return 0};a.projToGeog=f;a.projToGeogCenter=g})(b.PeCSTransformations||(b.PeCSTransformations={}));var p;(function(a){a.init=
function(){a.PE_BUFFER_MAX=b._pe.PeDefs.prototype.PE_BUFFER_MAX;a.PE_NAME_MAX=b._pe.PeDefs.prototype.PE_NAME_MAX;a.PE_MGRS_MAX=b._pe.PeDefs.prototype.PE_MGRS_MAX;a.PE_USNG_MAX=b._pe.PeDefs.prototype.PE_USNG_MAX;a.PE_DD_MAX=b._pe.PeDefs.prototype.PE_DD_MAX;a.PE_DDM_MAX=b._pe.PeDefs.prototype.PE_DDM_MAX;a.PE_DMS_MAX=b._pe.PeDefs.prototype.PE_DMS_MAX;a.PE_UTM_MAX=b._pe.PeDefs.prototype.PE_UTM_MAX;a.PE_PARM_MAX=b._pe.PeDefs.prototype.PE_PARM_MAX;a.PE_TYPE_NONE=b._pe.PeDefs.prototype.PE_TYPE_NONE;a.PE_TYPE_GEOGCS=
b._pe.PeDefs.prototype.PE_TYPE_GEOGCS;a.PE_TYPE_PROJCS=b._pe.PeDefs.prototype.PE_TYPE_PROJCS;a.PE_TYPE_GEOGTRAN=b._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;a.PE_TYPE_COORDSYS=b._pe.PeDefs.prototype.PE_TYPE_COORDSYS;a.PE_TYPE_UNIT=b._pe.PeDefs.prototype.PE_TYPE_UNIT;a.PE_STR_OPTS_NONE=b._pe.PeDefs.prototype.PE_STR_OPTS_NONE;a.PE_STR_AUTH_NONE=b._pe.PeDefs.prototype.PE_STR_AUTH_NONE;a.PE_STR_AUTH_TOP=b._pe.PeDefs.prototype.PE_STR_AUTH_TOP;a.PE_STR_NAME_CANON=b._pe.PeDefs.prototype.PE_STR_NAME_CANON;a.PE_PARM_X0=
b._pe.PeDefs.prototype.PE_PARM_X0;a.PE_PARM_ND=b._pe.PeDefs.prototype.PE_PARM_ND;a.PE_TRANSFORM_1_TO_2=b._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;a.PE_TRANSFORM_2_TO_1=b._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;a.PE_TRANSFORM_P_TO_G=b._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;a.PE_TRANSFORM_G_TO_P=b._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;a.PE_HORIZON_RECT=b._pe.PeDefs.prototype.PE_HORIZON_RECT;a.PE_HORIZON_POLY=b._pe.PeDefs.prototype.PE_HORIZON_POLY;a.PE_HORIZON_LINE=b._pe.PeDefs.prototype.PE_HORIZON_LINE;
a.PE_HORIZON_DELTA=b._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(p=b.PeDefs||(b.PeDefs={}));(function(a){function c(a,c){var f=null,g=e[a];g||(g={},e[a]=g);g.hasOwnProperty(String(c))?f=g[c]:(a=b._pe.PeFactory.prototype.factoryByType(a,c),b._pe.compare(a,b._pe.NULL)||(f=a,g[c]=f));return f=d(f)}function d(a){if(a){var c=a.getType();switch(c){case p.PE_TYPE_GEOGCS:a=b._pe.castObject(a,b._pe.PeGeogcs);break;case p.PE_TYPE_PROJCS:a=b._pe.castObject(a,b._pe.PeProjcs);break;case p.PE_TYPE_GEOGTRAN:a=b._pe.castObject(a,
b._pe.PeGeogtran);break;default:c&p.PE_TYPE_UNIT&&(a=b._pe.castObject(a,b._pe.PeUnit))}}return a}var e={},f={};a.initialize=function(){b._pe.PeFactory.prototype.initialize(null)};a.coordsys=function(a){return c(p.PE_TYPE_COORDSYS,a)};a.factoryByType=c;a.fromString=function(a,c){var e=null,g=f[a];g||(g={},f[a]=g);g.hasOwnProperty(c)?e=g[c]:(a=b._pe.PeFactory.prototype.fromString(a,c),b._pe.compare(a,b._pe.NULL)||(e=a,g[c]=e));return e=d(e)};a.geogcs=function(a){return c(p.PE_TYPE_GEOGCS,a)};a.geogtran=
function(a){return c(p.PE_TYPE_GEOGTRAN,a)};a.getCode=function(a){return b._pe.PeFactory.prototype.getCode(a)};a.projcs=function(a){return c(p.PE_TYPE_PROJCS,a)};a.unit=function(a){return c(p.PE_TYPE_UNIT,a)}})(b.PeFactory||(b.PeFactory={}));b.PeGCSExtent=null;var r;(function(a){var c;a.init=function(){a.PE_GTLIST_OPTS_COMMON=b._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;c=b._pe._pe_getPeGTlistExtendedEntrySize()};a.getGTlist=function(a,d,e,f,g,h){var k=null,l=new b._pe.PeInteger(h);try{var m=
b._pe.PeGTlistExtended.prototype.getGTlist(a,d,e,f,g,l);if(h=l.val)if(k=[m],1<h){var n=b._pe.getPointer(m);for(a=1;a<h;a++)k.push(b._pe.wrapPointer(n+c*a,b._pe.PeGTlistExtendedEntry))}}finally{b._pe.destroy(l)}return k}})(r=b.PeGTlistExtended||(b.PeGTlistExtended={}));(function(a){a.destroy=function(a){if(a&&a.length){for(var c=0;c<a.length;c++){var d=a[c];g(d);d.getEntries().forEach(function(a){g(a);a=a.getGeogtran();g(a);a.getParameters().forEach(g);[a.getGeogcs1(),a.getGeogcs2()].forEach(function(a){g(a);
var b=a.getDatum();g(b);g(b.getSpheroid());g(a.getPrimem());g(a.getUnit())})})}b._pe.PeGTlistExtendedEntry.prototype.Delete(a[0])}}})(b.PeGTlistExtendedEntry||(b.PeGTlistExtendedEntry={}));(function(a){a.geogToGeog=function(a,e,f,g,h){b._pe.ensureCache.prepare();var k=d(f),l=f===k,k=b._pe.ensureFloat64(k),m=0;g&&(m=b._pe.ensureFloat64(g));(a=b._pe._pe_geog_to_geog(b._pe.getPointer(a),e,k,m,h))&&c(f,e,k,l);return a}})(b.PeGTTransformations||(b.PeGTTransformations={}));(function(a){function e(a,c,e,
f,g,h){b._pe.ensureCache.prepare();var k,m;switch(a){case "dd":k=b._pe._pe_geog_to_dd;m=p.PE_DD_MAX;break;case "ddm":k=b._pe._pe_geog_to_ddm;m=p.PE_DDM_MAX;break;case "dms":k=b._pe._pe_geog_to_dms,m=p.PE_DMS_MAX}a=0;c&&(a=b._pe.getPointer(c));c=d(f);c=b._pe.ensureFloat64(c);m=l(e,m);f=b._pe.ensureInt32(m);if(g=k(a,e,c,g,f))for(k=0;k<e;k++)h[k]=b._pe.UTF8ToString(m[k]);return g}function f(a,d,e,f,g){b._pe.ensureCache.prepare();var h;switch(a){case "dd":h=b._pe._pe_dd_to_geog;break;case "ddm":h=b._pe._pe_ddm_to_geog;
break;case "dms":h=b._pe._pe_dms_to_geog}a=0;d&&(a=b._pe.getPointer(d));d=f.map(function(a){return b._pe.ensureString(a)});f=b._pe.ensureInt32(d);d=b._pe.ensureFloat64(Array(2*e));(h=h(a,e,f,d))&&c(g,e,d);return h}a.geog_to_dms=function(a,b,c,d,f){return e("dms",a,b,c,d,f)};a.dms_to_geog=function(a,b,c,d){return f("dms",a,b,c,d)};a.geog_to_ddm=function(a,b,c,d,f){return e("ddm",a,b,c,d,f)};a.ddm_to_geog=function(a,b,c,d){return f("ddm",a,b,c,d)};a.geog_to_dd=function(a,b,c,d,f){return e("dd",a,b,
c,d,f)};a.dd_to_geog=function(a,b,c,d){return f("dd",a,b,c,d)}})(b.PeNotationDms||(b.PeNotationDms={}));var t;(function(a){a.init=function(){a.PE_MGRS_STYLE_NEW=b._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;a.PE_MGRS_STYLE_OLD=b._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;a.PE_MGRS_STYLE_AUTO=b._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;a.PE_MGRS_180_ZONE_1_PLUS=b._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;a.PE_MGRS_ADD_SPACES=b._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};
a.geog_to_mgrs_extended=function(a,c,e,f,g,h,k){b._pe.ensureCache.prepare();var m=0;a&&(m=b._pe.getPointer(a));a=d(e);e=b._pe.ensureFloat64(a);a=l(c,p.PE_MGRS_MAX);var n=b._pe.ensureInt32(a);if(f=b._pe._pe_geog_to_mgrs_extended(m,c,e,f,g,h,n))for(g=0;g<c;g++)k[g]=b._pe.UTF8ToString(a[g]);return f};a.mgrs_to_geog_extended=function(a,d,e,f,g){b._pe.ensureCache.prepare();var h=0;a&&(h=b._pe.getPointer(a));a=e.map(function(a){return b._pe.ensureString(a)});e=b._pe.ensureInt32(a);a=b._pe.ensureFloat64(Array(2*
d));(f=b._pe._pe_mgrs_to_geog_extended(h,d,e,f,a))&&c(g,d,a);return f}})(t=b.PeNotationMgrs||(b.PeNotationMgrs={}));(function(a){a.geog_to_usng=function(a,c,e,f,g,h,k){b._pe.ensureCache.prepare();var m=0;a&&(m=b._pe.getPointer(a));a=d(e);e=b._pe.ensureFloat64(a);a=l(c,p.PE_MGRS_MAX);var n=b._pe.ensureInt32(a);if(f=b._pe._pe_geog_to_usng(m,c,e,f,g,h,n))for(g=0;g<c;g++)k[g]=b._pe.UTF8ToString(a[g]);return f};a.usng_to_geog=function(a,d,e,f){b._pe.ensureCache.prepare();var g=0;a&&(g=b._pe.getPointer(a));
a=e.map(function(a){return b._pe.ensureString(a)});e=b._pe.ensureInt32(a);a=b._pe.ensureFloat64(Array(2*d));(g=b._pe._pe_usng_to_geog(g,d,e,a))&&c(f,d,a);return g}})(b.PeNotationUsng||(b.PeNotationUsng={}));var u;(function(a){a.init=function(){a.PE_UTM_OPTS_NONE=b._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;a.PE_UTM_OPTS_ADD_SPACES=b._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;a.PE_UTM_OPTS_NS=b._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};a.geog_to_utm=function(a,c,e,f,g){b._pe.ensureCache.prepare();
var h=0;a&&(h=b._pe.getPointer(a));a=d(e);e=b._pe.ensureFloat64(a);a=l(c,p.PE_UTM_MAX);var k=b._pe.ensureInt32(a);if(f=b._pe._pe_geog_to_utm(h,c,e,f,k))for(h=0;h<c;h++)g[h]=b._pe.UTF8ToString(a[h]);return f};a.utm_to_geog=function(a,d,e,f,g){b._pe.ensureCache.prepare();var h=0;a&&(h=b._pe.getPointer(a));a=e.map(function(a){return b._pe.ensureString(a)});e=b._pe.ensureInt32(a);a=b._pe.ensureFloat64(Array(2*d));(f=b._pe._pe_utm_to_geog(h,d,e,f,a))&&c(g,d,a);return f}})(u=b.PeNotationUtm||(b.PeNotationUtm=
{}));var v;(function(a){var c=new Map;a.init=function(){a.PE_PCSINFO_OPTION_NONE=b._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;a.PE_PCSINFO_OPTION_DOMAIN=b._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;a.PE_POLE_OUTSIDE_BOUNDARY=b._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;a.PE_POLE_POINT=b._pe.PePCSInfo.prototype.PE_POLE_POINT};a.generate=function(d,e){void 0===e&&(e=a.PE_PCSINFO_OPTION_DOMAIN);var f,g;c.has(d)&&(g=c.get(d),g[e]&&(f=g[e]));f||(f=b._pe.PePCSInfo.prototype.generate(d,e),
g||(g=[],c.set(d,g)),g[e]=f);return f}})(v=b.PePCSInfo||(b.PePCSInfo={}));(function(a){a.version_string=function(){return b._pe.PeVersion.prototype.version_string()}})(b.PeVersion||(b.PeVersion={}));b._init=f})},"esri/geometry/support/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],function(n,b,a){return function(){function b(b){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(b&&b.steps){var e=0;for(b=b.steps;e<b.length;e++){var f=
b[e];f instanceof a?this.steps.push(f):this.steps.push(new a({wkid:f.wkid,wkt:f.wkt,isInverse:f.isInverse}))}}}b.cacheKey=function(a,b){return[void 0!==a.wkid&&null!==a.wkid?a.wkid.toString():"-1",void 0!==a.wkt&&null!==a.wkt?a.wkt.toString():"",void 0!==b.wkid&&null!==b.wkid?b.wkid.toString():"-1",void 0!==b.wkt&&null!==b.wkt?b.wkt.toString():""].join()};b.fromGE=function(h){var e=new b,f="",g=0;for(h=h.steps;g<h.length;g++){var l=a.fromGE(h[g]);e.steps.push(l);f+=l.uid.toString()+","}e._cached_projection=
{};e._gtlistentry=null;e._chain=f;return e};b.prototype.getInverse=function(){var a=new b;a.steps=[];for(var e=this.steps.length-1;0<=e;e--)a.steps.push(this.steps[e].getInverse());return a};b.prototype.getGTListEntry=function(){for(var a="",b=0,f=this.steps;b<f.length;b++)a+=f[b].uid.toString()+",";a!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=a);return this._gtlistentry};b.prototype.assignCachedGe=function(a,e,f){this._cached_projection[b.cacheKey(a,e)]=f};b.prototype.getCachedGeTransformation=
function(a,e){for(var f="",g=0,h=this.steps;g<h.length;g++)f+=h[g].uid.toString()+",";f!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=f);a=this._cached_projection[b.cacheKey(a,e)];return void 0===a?null:a};return b}()})},"esri/geometry/support/GeographicTransformationStep":function(){define(["require","exports"],function(n,b){var a=0;return function(){function b(b){void 0===b&&(b=null);this.uid=a++;b?(this._wkt=void 0!==b.wkt?b.wkt:null,this._wkid=void 0!==b.wkid?b.wkid:
-1,this._isInverse=void 0!==b.isInverse?!0===b.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}b.fromGE=function(a){var e=new b;e._wkt=a.wkt;e._wkid=a.wkid;e._isInverse=a.isInverse;return e};Object.defineProperty(b.prototype,"wkt",{get:function(){return this._wkt},set:function(b){this._wkt=b;this.uid=a++},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"wkid",{get:function(){return this._wkid},set:function(b){this._wkid=b;this.uid=a++},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"isInverse",{get:function(){return this._isInverse},set:function(b){this._isInverse=b;this.uid=a++},enumerable:!0,configurable:!0});b.prototype.getInverse=function(){var a=new b;a._wkt=this.wkt;a._wkid=this._wkid;a._isInverse=!this.isInverse;return a};return b}()})},"esri/geometry/geometryAdapters/json":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.jsonAdapter={convertToGEGeometry:function(a,b){return null==
b?null:a.convertJSONToGeometry(b)},exportPoint:function(b,e,d){d=new a(b.getPointX(e),b.getPointY(e),d);var c=b.hasZ(e),f=b.hasM(e);c&&(d.z=b.getPointZ(e));f&&(d.m=b.getPointM(e));return d},exportPolygon:function(a,b,d){return new m(a.exportPaths(b),d,a.hasZ(b),a.hasM(b))},exportPolyline:function(a,b,d){return new h(a.exportPaths(b),d,a.hasZ(b),a.hasM(b))},exportMultipoint:function(a,b,d){return new e(a.exportPoints(b),d,a.hasZ(b),a.hasM(b))},exportExtent:function(a,b,d){var c=a.hasZ(b),e=a.hasM(b);
d=new f(a.getXMin(b),a.getYMin(b),a.getXMax(b),a.getYMax(b),d);c&&(c=a.getZExtent(b),d.zmin=c.vmin,d.zmax=c.vmax);e&&(a=a.getMExtent(b),d.mmin=a.vmin,d.mmax=a.vmax);return d}};var a=function(){return function(a,b,d){this.x=a;this.y=b;this.spatialReference=d;this.m=this.z=void 0}}(),m=function(){return function(a,b,d,c){this.rings=a;this.spatialReference=b;this.hasM=this.hasZ=void 0;d&&(this.hasZ=d);c&&(this.hasM=c)}}(),h=function(){return function(a,b,d,c){this.paths=a;this.spatialReference=b;this.hasM=
this.hasZ=void 0;d&&(this.hasZ=d);c&&(this.hasM=c)}}(),e=function(){return function(a,b,d,c){this.points=a;this.spatialReference=b;this.hasM=this.hasZ=void 0;d&&(this.hasZ=d);c&&(this.hasM=c)}}(),f=function(){return function(a,b,d,c,e){this.xmin=a;this.ymin=b;this.xmax=d;this.ymax=c;this.spatialReference=e;this.mmax=this.mmin=this.zmax=this.zmin=void 0}}()})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",
{value:!0});b.queryCapabilities={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,
supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports tslib ../../../core/MapUtils ../../../core/maybe ../../../core/promiseUtils ../../../core/SetUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./AttributesBuilder ./attributeSupport ./projectionSupport ./timeSupport ./utils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t){function u(a){return a.substr(24,12)+a.substr(19,4)+a.substr(16,2)+a.substr(14,2)+a.substr(11,2)+a.substr(9,2)+a.substr(6,2)+a.substr(4,2)+a.substr(2,2)+a.substr(0,2)}function v(a,b,c,d){if(c&&"esriFieldTypeDate"===c.type){var e=(new Date(a)).getTime(),f=(new Date(b)).getTime();if(!isNaN(e)&&!isNaN(f))return d?f-e:e-f}return"number"===typeof a&&"number"===typeof b?d?b-a:a-b:"string"===typeof a&&"string"===typeof b?(e=a.toUpperCase(),f=b.toUpperCase(),!c||"esriFieldTypeGUID"!==
c.type&&"esriFieldTypeGlobalID"!==c.type?d=(d?e>f:e<f)?-1:(d?e<f:e>f)?1:0:(a=u(e),f=u(f),d=(d?a>f:a<f)?-1:(d?a<f:a>f)?1:0),d):d?1:-1}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,c){this.items=a;this.queryGeometry=b;this.definitionExpression=c.definitionExpression;this.geometryType=c.geometryType;this.hasM=c.hasM;this.hasZ=c.hasZ;this.objectIdField=c.objectIdField;this.spatialReference=c.spatialReference;this.fieldsIndex=c.fieldsIndex;this.timeInfo=c.timeInfo;this.featureAdapter=
c.featureAdapter}Object.defineProperty(b.prototype,"size",{get:function(){return this.items.length},enumerable:!0,configurable:!0});b.prototype.createQueryResponse=function(b){var c;c=b.outStatistics?b.outStatistics.some(function(a){return"exceedslimit"===a.statisticType})?this._createExceedsLimitQueryResponse(b):this._createStatisticsQueryResponse(b):this._createFeatureQueryResponse(b);b.returnQueryGeometry&&(l.isValid(b.outSR)&&!l.equals(this.queryGeometry.spatialReference,b.outSR)?c.queryGeometry=
t.cleanFromGeometryEngine(a.__assign({spatialReference:b.outSR},p.project(this.queryGeometry,this.queryGeometry.spatialReference,b.outSR))):c.queryGeometry=t.cleanFromGeometryEngine(a.__assign({spatialReference:b.outSR},this.queryGeometry)));return c};b.prototype.executeAttributesQuery=function(a){var c=k.getWhereClause(a.where,this.fieldsIndex);if(!c)return e.resolve(this);if(c.isStandardized){for(var d=0,f=[],g=0,h=this.items;g<h.length;g++){var l=h[g];c.testFeature(l,this.featureAdapter)&&(f[d++]=
l)}c=new b(f,this.queryGeometry,this);c.definitionExpression=a.where;return e.resolve(c)}return e.reject(new TypeError("Where clause is not standardized"))};b.prototype.executeObjectIdsQuery=function(a){if(!a.objectIds||!a.objectIds.length)return e.resolve(this);var c=f.SetFromValues(a.objectIds),d=this.featureAdapter.getObjectId;return e.resolve(new b(this.items.filter(function(a){return c.has(d(a))}),this.queryGeometry,this))};b.prototype.executeTimeQuery=function(a){a=r.getTimeOperator(this.timeInfo,
a.timeExtent,this.featureAdapter);if(!h.isSome(a))return e.resolve(this);a=this.items.filter(a);return e.resolve(new b(a,this.queryGeometry,this))};b.prototype.filterLatest=function(){for(var a=this.timeInfo,c=a.trackIdField,d=a.startTimeField,a=a.endTimeField||d,d=new Map,f=this.featureAdapter.getAttribute,g=0,h=this.items;g<h.length;g++){var k=h[g],l=f(k,c),n=f(k,a),p=d.get(l);(!p||n>f(p,a))&&d.set(l,k)}c=m.valuesOfMap(d);return e.resolve(new b(c,this.queryGeometry,this))};b.prototype.project=function(c){return a.__awaiter(this,
void 0,void 0,function(){var e,f,g,h=this;return a.__generator(this,function(a){switch(a.label){case 0:if(!c||l.equals(this.spatialReference,c))return[2,this];e=this.featureAdapter;return[4,p.projectMany(this.items.map(function(a){return t.getGeometry(h.geometryType,h.hasZ,h.hasM,e.getGeometry(a))}),this.spatialReference,c)];case 1:return f=a.sent(),g=f.map(function(a,b){return e.cloneWithGeometry(h.items[b],d.convertFromGeometry(a,h.hasZ,h.hasM))}),[2,new b(g,this.queryGeometry,{definitionExpression:this.definitionExpression,
geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:c,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})]}})})};b.prototype._sortFeatures=function(a,b,c){if(1<a.length&&b&&b.length){var d=function(b){b=b.split(" ");var d=b[0],f=e.fieldsIndex.get(d),g=b[1]&&"desc"===b[1].toLowerCase();a.sort(function(a,b){a=c(a,d,f);b=c(b,d,f);return v(a,b,f,g)})},e=this,f=0;for(b=b.reverse();f<b.length;f++)d(b[f])}};b.prototype._createFeatureQueryResponse=
function(b){var c=this,d=this.items,e=this.geometryType,f=this.hasM,h=this.hasZ,k=this.objectIdField,l=this.spatialReference,m=b.outFields,n=b.outSR,p=b.quantizationParameters,r=b.resultRecordCount,u=b.resultOffset,v=b.returnZ,w=b.returnM,z=!1;null!=r&&null!=u&&(r=u+r,z=d.length>r,d=d.slice(u,Math.min(d.length,r)));m=m&&(-1<m.indexOf("*")?a.__spreadArrays(this.fieldsIndex.fields):m.map(function(a){return c.fieldsIndex.get(a)}));return{exceededTransferLimit:z,features:this._createFeatures(b,d),fields:m,
geometryType:e,hasM:f&&w,hasZ:h&&v,objectIdFieldName:k,spatialReference:t.cleanFromGeometryEngine(n?n:l),transform:p&&g.toQuantizationTransform(p)||null}};b.prototype._createFeatures=function(a,b){var d=new c.default(a,this.featureAdapter,this.fieldsIndex),e=a.orderByFields,f=a.quantizationParameters,h=a.returnGeometry,k=a.returnCentroid,l=a.maxAllowableOffset,m=a.returnZ;a=a.returnM;var n=this.hasZ&&(void 0===m?!1:m),p=this.hasM&&(void 0===a?!1:a),m=[];a=0;if(h||k)if(f=g.toQuantizationTransform(f),
h&&!k)for(k=0;k<b.length;k++)h=b[k],m[a++]={attributes:d.getAttributes(h),geometry:t.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(h),l,f,n,p)};else if(!h&&k)for(l=0;l<b.length;l++)h=b[l],m[a++]={attributes:d.getAttributes(h),centroid:t.transformCentroid(this,this.featureAdapter.getCentroid(h,this),f)};else for(k=0;k<b.length;k++)h=b[k],m[a++]={attributes:d.getAttributes(h),centroid:t.transformCentroid(this,this.featureAdapter.getCentroid(h,this),f),geometry:t.getGeometry(this.geometryType,
this.hasZ,this.hasM,this.featureAdapter.getGeometry(h),l,f,n,p)};else for(l=0;l<b.length;l++)h=b[l],(n=d.getAttributes(h))&&(m[a++]={attributes:n});this._sortFeatures(m,e,function(a,b,c){return d.getFieldValue(a,b,c)});return m};b.prototype._createExceedsLimitQueryResponse=function(a){var b=!1,c=Number.POSITIVE_INFINITY,d=Number.POSITIVE_INFINITY,b=Number.POSITIVE_INFINITY,e=0;for(a=a.outStatistics;e<a.length;e++){var f=a[e];if("exceedslimit"===f.statisticType){c=null!=f.maxPointCount?f.maxPointCount:
Number.POSITIVE_INFINITY;d=null!=f.maxRecordCount?f.maxRecordCount:Number.POSITIVE_INFINITY;b=null!=f.maxVertexCount?f.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)b=this.items.length>c;else if(this.items.length>d)b=!0;else var c=this.hasZ?this.hasM?4:3:this.hasM?3:2,g=this.featureAdapter,b=this.items.reduce(function(a,b){b=g.getGeometry(b);return a+(b&&b.coords.length||0)},0)/c>b;return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",
sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(b)}}]}};b.prototype._createStatisticsQueryResponse=function(a){var b=this,d={attributes:{}},e=[],f=new Map,g=new Map,h=new Map,k=new Map,l=new c.default(a,this.featureAdapter,this.fieldsIndex),n=a.outStatistics,p=a.groupByFieldsForStatistics,r=a.having;a=a.orderByFields;for(var t=p&&p.length,u=!!t,v=u&&p[0],w=u&&!this.fieldsIndex.get(v),z=0;z<n.length;z++){var W=n[z],O=W.outStatisticFieldName,U=W.statisticType,
P=W,ba="exceedslimit"!==U?W.onStatisticField:void 0,V="percentile_disc"===U||"percentile_cont"===U,T=u&&1===t&&(ba===v||w)&&"count"===U;if(u){if(!h.has(ba)){for(var W=[],U=0,X=p;U<X.length;U++){var Y=this._getAttributeValues(l,X[U],f);W.push(Y)}h.set(ba,this._calculateUniqueValues(W))}var da=h.get(ba),W=function(a){var c=da[a];a=c.count;var d=c.data,e=c.items,g=c.itemPositions,c=d.join(",");if(!r||l.validateItems(e,r)){var h=k.get(c)||{attributes:{}},e=null;if(T)e=a;else{var m=fa._getAttributeValues(l,
ba,f);a=g.map(function(a){return m[a]});e=V&&"statisticParameters"in P?fa._getPercentileValue(P,a):fa._getStatisticValue(P,a)}h.attributes[O]=e;p.forEach(function(a,c){return h.attributes[b.fieldsIndex.get(a)?a:"EXPR_"+(c+1)]=d[c]});k.set(c,h)}},fa=this,ga;for(ga in da)W(ga)}else Y=this._getAttributeValues(l,ba,f),d.attributes[O]=V&&"statisticParameters"in P?this._getPercentileValue(P,Y):this._getStatisticValue(P,Y,g);e.push({name:O,alias:O,type:"esriFieldTypeDouble"})}d=u?m.valuesOfMap(k):[d];this._sortFeatures(d,
a,function(a,b){return a.attributes[b]});return{fields:e,features:d}};b.prototype._getStatisticValue=function(a,b,c){var d=a.onStatisticField;a=a.statisticType;b=c&&c.has(d)?c.get(d):this._calculateStatistics(b);c&&c.set(d,b);return b["var"===a?"variance":a]};b.prototype._getPercentileValue=function(b,c){var d=b.statisticParameters,e=b.statisticType,f=d.value,g="desc"===d.orderBy,h=this.fieldsIndex.get(b.onStatisticField);b=a.__spreadArrays(c).sort(function(a,b){return v(a,b,h,g)});return this._calculatePercentile(b,
f,"percentile_disc"===e)};b.prototype._getAttributeValues=function(a,b,c){if(c.has(b))return c.get(b);var d=this.fieldsIndex.get(b),e=this.items.map(function(c){return a.getFieldValue(c,b,d)});c.set(b,e);return e};b.prototype._calculateStatistics=function(a){for(var b=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,d=null,e=null,f=null,g=null,h=[],k=0,l=0;l<a.length;l++){var m=a[l];"string"===typeof m?k++:null==m||isNaN(m)||(d+=m,b=Math.min(b,m),c=Math.max(c,m),h.push(m),k++)}if(k){e=d/k;for(f=
a=0;f<h.length;f++)m=h[f],a+=Math.pow(m-e,2);g=1<k?a/(k-1):0;f=Math.sqrt(g)}else c=b=null;return{avg:e,count:k,max:c,min:b,stddev:f,sum:d,variance:g}};b.prototype._calculateUniqueValues=function(a){for(var b={},c=this.items,d=c.length,e=0;e<d;e++){for(var f=c[e],g=[],h=0,k=a;h<k.length;h++)g.push(k[h][e]);h=g.join(",");null==b[h]?b[h]={count:1,data:g,items:[f],itemPositions:[e]}:(b[h].count++,b[h].items.push(f),b[h].itemPositions.push(e))}return b};b.prototype._calculatePercentile=function(a,b,c){if(0===
a.length)return null;if(0>=b)return a[0];if(1<=b)return a[a.length-1];var d=(a.length-1)*b,e=Math.floor(d);b=e+1;var d=d%1,e=a[e],f=a[b];return b>=a.length||c||"string"===typeof e||"string"===typeof f?e:e*(1-d)+f*d};return b}();b.default=n})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["require","exports","../../../core/maybe","./attributeSupport"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,g){this._fieldDataCache=new Map;this._returnDistinctMap=
new Map;this.returnDistinctValues=a.returnDistinctValues;this.fieldsIndex=g;this.featureAdapter=b;if((a=a.outFields)&&-1===a.indexOf("*")){this.outFields=a;for(var e=b=0;e<a.length;e++){var d=a[e],c=m.getExpressionFromFieldName(d),f=this.fieldsIndex.get(c),c=f?null:m.getWhereClause(c,g),f=f?f.name:m.getAliasFromFieldName(d)||"FIELD_EXP_"+b++;this._fieldDataCache.set(d,{alias:f,clause:c})}}}b.prototype.getAttributes=function(a){a=this._processAttributesForOutFields(a);return this._processAttributesForDistinctValues(a)};
b.prototype.getFieldValue=function(a,b,g){var e=g?g.name:b,d=null;this._fieldDataCache.has(e)?d=this._fieldDataCache.get(e).clause:g||(d=m.getWhereClause(b,this.fieldsIndex),this._fieldDataCache.set(e,{alias:e,clause:d}));return g?this.featureAdapter.getAttribute(a,e):d.calculateValue(a,this.featureAdapter)};b.prototype.validateItem=function(a,b){this._fieldDataCache.has(b)||this._fieldDataCache.set(b,{alias:b,clause:m.getWhereClause(b,this.fieldsIndex)});return this._fieldDataCache.get(b).clause.testFeature(a,
this.featureAdapter)};b.prototype.validateItems=function(a,b){this._fieldDataCache.has(b)||this._fieldDataCache.set(b,{alias:b,clause:m.getWhereClause(b,this.fieldsIndex)});return this._fieldDataCache.get(b).clause.testSet(a,this.featureAdapter)};b.prototype._processAttributesForOutFields=function(a){var b=this.outFields;if(!b||!b.length)return this.featureAdapter.getAttributes(a);for(var e={},h=0;h<b.length;h++){var d=this._fieldDataCache.get(b[h]),c=d.alias,d=d.clause;e[c]=d?d.calculateValue(a,
this.featureAdapter):this.featureAdapter.getAttribute(a,c)}return e};b.prototype._processAttributesForDistinctValues=function(b){if(a.isNone(b)||!this.returnDistinctValues)return b;var e=this.outFields,g=[];if(e)for(var h=0;h<e.length;h++){var d=this._fieldDataCache.get(e[h]).alias;g.push(b[d])}else for(d in b)g.push(b[d]);e=(e||["*"]).join(",")+"\x3d"+g.join(",");g=this._returnDistinctMap.get(e)||0;this._returnDistinctMap.set(e,++g);return 1<g?null:b};return b}();b.default=n})},"esri/layers/graphics/data/timeSupport":function(){define(["require",
"exports"],function(n,b){function a(a,b,g,h,d){if(null!=h&&null!=d&&h===d)return function(c){return h>=a.getAttribute(c,b)&&h<=a.getAttribute(c,g)};if(null!=h&&null!=d)return function(c){var e=a.getAttribute(c,b);c=a.getAttribute(c,g);return!(e>d||c<h)};if(null!=h)return function(b){return!(a.getAttribute(b,g)<h)};if(null!=d)return function(c){return!(a.getAttribute(c,b)>d)}}function m(a,b,g,h){if(null!=g&&null!=h&&g===h)return function(d){return a.getAttribute(d,b)===g};if(null!=g&&null!=h)return function(d){return a.getAttribute(d,
b)>=g&&a.getAttribute(d,b)<=h};if(null!=g)return function(d){return a.getAttribute(d,b)>=g};if(null!=h)return function(d){return a.getAttribute(d,b)<=h}}function h(){return function(){return!1}}Object.defineProperty(b,"__esModule",{value:!0});b.getTimeExtent=function(a,b){if(!a)return null;var e=b.featureAdapter,f=a.startTimeField,d=a.endTimeField,c=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY;if(f&&d)b.forEach(function(a){var b=e.getAttribute(a,f);a=e.getAttribute(a,d);null==b||isNaN(b)||
(c=Math.min(c,b));null==a||isNaN(a)||(h=Math.max(h,a))});else{var m=f||d;b.forEach(function(a){a=e.getAttribute(a,m);null==a||isNaN(a)||(c=Math.min(c,a),h=Math.max(h,a))})}return{start:c,end:h}};b.getTimeOperator=function(b,f,g){if(!f||!b)return null;var e=b.startTimeField;b=b.endTimeField;if(!e&&!b)return null;var d=f.start;f=f.end;return null===d&&null===f?null:void 0===d&&void 0===f?h():e&&b?a(g,e,b,d,f):m(g,e||b,d,f)}})},"esri/layers/graphics/data/utils":function(){define("require exports tslib ../../../core/jsonMap ../../../core/maybe ../../../core/unitUtils ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../centroid ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./spatialQuerySupport".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t){function u(a,b,c,d,e){void 0===d&&(d=a.hasZ);void 0===e&&(e=a.hasM);var f=a.hasZ&&d,g=a.hasM&&e;return c?(a=k.quantizeOptimizedGeometry(A,b,a.hasZ,a.hasM,"esriGeometryPoint",c,d,e),k.convertToPoint(a,f,g)):k.convertToPoint(b,f,g)}function v(c,d,e){return a.__awaiter(this,void 0,void 0,function(){var k,m,n,p,q,t;return a.__generator(this,function(a){switch(a.label){case 0:if(!c)return[2,null];k=c.where;c.where=k=k&&k.trim();if(!k||/^1 *= *1$/.test(k)||d&&d===
k)c.where=null;return c.geometry?[4,z(c)]:[2,c];case 1:return m=a.sent(),c.distance=0,c.units=null,"esriSpatialRelEnvelopeIntersects"===c.spatialRel&&(n=c.geometry.spatialReference,m=f.getGeometryExtent(m),m.spatialReference=n),c.geometry=m,[4,r.checkProjectionSupport(m.spatialReference,e)];case 2:return a.sent(),[4,l.normalizeCentralMeridian(g.fromJSON(m))];case 3:p=a.sent()[0];if(h.isNone(p))throw b.QUERY_ENGINE_EMPTY_RESULT;q=p.toJSON();return[4,r.project(q,q.spatialReference,e)];case 4:t=a.sent();
if(!t)throw b.QUERY_ENGINE_EMPTY_RESULT;t.spatialReference=e;c.geometry=t;return[2,c]}})})}function z(b){return a.__awaiter(this,void 0,void 0,function(){var c,f,g,h,k,l,m,n,p;return a.__generator(this,function(a){switch(a.label){case 0:c=b.geometry;f=b.distance;g=b.units;if(null==f||"vertexAttributes"in c)return[2,c];h=c.spatialReference;k=g?w.fromJSON(g):e.getUnitString(h);l=h&&(d.isGeographic(h)||d.isWebMercator(h));if(!l)return[3,1];n=c;return[3,3];case 1:return[4,r.checkProjectionSupport(h,d.WGS84).then(function(){return r.project(c,
d.WGS84)})];case 2:n=a.sent(),a.label=3;case 3:return m=n,[4,t.getGeodesicBufferOperator()];case 4:return p=a.sent(),[2,p(m.spatialReference,m,f,k)]}})})}Object.defineProperty(b,"__esModule",{value:!0});var w=new m.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});b.QUERY_ENGINE_EMPTY_RESULT=Object.freeze({});var q=new p.default,y=new p.default,
A=new p.default,B={esriGeometryPoint:k.convertToPoint,esriGeometryPolyline:k.convertToPolyline,esriGeometryPolygon:k.convertToPolygon,esriGeometryMultipoint:k.convertToMultipoint};b.transformCentroid=u;b.getCentroid=function(a,b,d){if("esriGeometryPolygon"!==a.geometryType||!b||!b.centroid&&!b.geometry)return null;b.centroid||(b.centroid=c.getCentroidOptimizedGeometry(new p.default,b.geometry,a.hasZ,a.hasM));return u(a,b.centroid,d)};b.getGeometry=function(a,b,c,d,e,f,g,h){void 0===g&&(g=b);void 0===
h&&(h=c);var l=b&&g,m=c&&h;d=d?"coords"in d?d:d.geometry:null;if(!d)return null;if(e)return b=k.generalizeOptimizedGeometry(y,d,b,c,a,e,g,h),f&&(b=k.quantizeOptimizedGeometry(A,b,l,m,a,f)),B[a](b,l,m);if(f)return b=k.quantizeOptimizedGeometry(A,d,b,c,a,f,g,h),B[a](b,l,m);k.removeZMValues(q,d,b,c,g,h);return B[a](q,l,m)};b.normalizeQuery=function(b,c,d){return a.__awaiter(this,void 0,void 0,function(){var e,f,g,h,k;return a.__generator(this,function(a){e=b.outFields;f=b.orderByFields;g=b.groupByFieldsForStatistics;
h=b.outStatistics;if(e)for(k=0;k<e.length;k++)e[k]=e[k].trim();if(f)for(k=0;k<f.length;k++)f[k]=f[k].trim();if(g)for(k=0;k<g.length;k++)g[k]=g[k].trim();if(h)for(k=0;k<h.length;k++)h[k].onStatisticField&&(h[k].onStatisticField=h[k].onStatisticField.trim());b.geometry&&!b.outSR&&(b.outSR=b.geometry.spatialReference);return[2,v(b,c,d)]})})};b.normalizeFilter=function(b,c,d){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return[2,v(b,c,d)]})})};b.normalizeQueryLike=
v;b.cleanFromGeometryEngine=function(a){return a&&C in a?JSON.parse(JSON.stringify(a,F)):a};var C="_geVersion",F=function(a,b){return a!==C?b:void 0}})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports tslib ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./utils @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r){function t(){return new Promise(function(a,b){n(["../../../geometry/geometryEngineJSON"],a,b)})}Object.defineProperty(b,"__esModule",{value:!0});var u={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",
esriSpatialRelRelation:null},v={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},z={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},w={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,
esriGeometryPolygon:!0,esriGeometryEnvelope:!1};b.importGeometryEngine=t;b.getGeodesicBufferOperator=function(){return t().then(function(a){return a.geodesicBuffer})};b.getSpatialQueryOperator=function(a,b,l,m,n){if(g.isPolygon(b)&&"esriGeometryPoint"===l&&("esriSpatialRelIntersects"===a||"esriSpatialRelContains"===a)){var p=c.convertFromPolygon(new k.default,b,!1,!1);return h.resolve(function(a){return d.polygonContainsPoint(p,!1,!1,a)})}if(g.isPolygon(b)&&"esriGeometryMultipoint"===l){var q=c.convertFromPolygon(new k.default,
b,!1,!1);if("esriSpatialRelContains"===a)return h.resolve(function(a){return d.polygonContainsMultipoint(q,!1,!1,a,m,n)})}if(g.isExtent(b)&&"esriGeometryPoint"===l&&("esriSpatialRelIntersects"===a||"esriSpatialRelContains"===a))return h.resolve(function(a){return e.extentContainsPoint(b,r.getGeometry(l,m,n,a))});if(g.isExtent(b)&&"esriGeometryMultipoint"===l&&"esriSpatialRelContains"===a)return h.resolve(function(a){return e.extentContainsMultipoint(b,r.getGeometry(l,m,n,a))});if(g.isExtent(b)&&"esriSpatialRelIntersects"===
a){var v=f.getExtentIntersector(l);return h.resolve(function(a){return v(b,r.getGeometry(l,m,n,a))})}return t().then(function(c){var d=c[u[a]].bind(null,b.spatialReference,b);return function(a){return d(r.getGeometry(l,m,n,a))}})};b.checkSpatialQuerySupport=function(b,c,d){return a.__awaiter(this,void 0,void 0,function(){var e,f;return a.__generator(this,function(a){e=b.spatialRel;f=b.geometry;if(!f)return[2];if(!0!==v[e])throw new m("feature-store:unsupported-query","Unsupported query spatial relationship",
{query:b});if(!l.isValid(f.spatialReference)||!l.isValid(d))return[2];if(!0!==z[g.getJsonType(f)])throw new m("feature-store:unsupported-query","Unsupported query geometry type",{query:b});if(!0!==w[c])throw new m("feature-store:unsupported-query","Unsupported layer geometry type",{query:b});return b.outSR?[2,p.checkProjectionSupport(b.geometry&&b.geometry.spatialReference,b.outSR)]:[2]})})};b.canQueryWithRBush=function(a){if(g.isExtent(a))return!0;if(g.isPolygon(a)){var b=0;for(a=a.rings;b<a.length;b++){var c=
a[b];if(5!==c.length||c[0][0]!==c[1][0]||c[0][0]!==c[4][0]||c[2][0]!==c[3][0]||c[0][1]!==c[3][1]||c[0][1]!==c[4][1]||c[1][1]!==c[2][1])return!1}return!0}return!1}})},"esri/layers/graphics/contains":function(){define(["require","exports"],function(n,b){function a(a,b,e,f,g){if(!a)return!1;b=b?e?4:3:e?3:2;e=a.coords;var h=!1,d=0,c=0;for(a=a.lengths;c<a.length;c++){for(var k=a[c],m=d,n=d,t=d+k*b;n<t;n+=b){m=n+b;m===t&&(m=d);var u=e[n],v=e[n+1],z=e[m],m=e[m+1];(v<g&&m>=g||m<g&&v>=g)&&u+(g-v)/(m-v)*(z-
u)<f&&(h=!h)}d+=k*b}return h}Object.defineProperty(b,"__esModule",{value:!0});b.polygonContainsPoint=function(b,h,e,f){return a(b,h,e,f.coords[0],f.coords[1])};b.polygonContainsMultipoint=function(b,h,e,f,g,l){g=g?l?4:3:l?3:2;l=f.coords;f=f.lengths;if(!f)return!1;for(var d=0,c=0;d<f.length;d++,c+=g)if(!a(b,h,e,l[c],l[c+1]))return!1;return!0};b.polygonContainsCoords=a})},"esri/layers/support/PromiseQueue":function(){define(["require","exports","../../core/promiseUtils"],function(n,b,a){Object.defineProperty(b,
"__esModule",{value:!0});n=function(){function b(){this._tasks=[]}Object.defineProperty(b.prototype,"length",{get:function(){return this._tasks.length},enumerable:!0,configurable:!0});b.prototype.push=function(b){var e=this;return a.create(function(a,f){return e._tasks.push(new m(a,f,b))})};b.prototype.unshift=function(b){var e=this;return a.create(function(a,f){return e._tasks.unshift(new m(a,f,b))})};b.prototype.process=function(){if(0===this._tasks.length)return!1;var a=this._tasks.shift();try{var b=
a.callback();b&&"then"in b&&"function"===typeof b.then?b.then(a.resolve,a.reject):a.resolve(b)}catch(g){a.reject(g)}return!0};b.prototype.cancelAll=function(){for(var b=a.createAbortError(),f=0,g=this._tasks;f<g.length;f++)g[f].reject(b);this._tasks.length=0};return b}();b.default=n;var m=function(){return function(a,b,f){this.resolve=a;this.reject=b;this.callback=f}}()})},"esri/views/layers/support/FeatureFilter":function(){define("require exports tslib ../../../geometry ../../../TimeExtent ../../../core/jsonMap ../../../core/JSONSupport ../../../core/lang ../../../core/SetUtils ../../../core/accessorSupport/decorators ../../../geometry/support/jsonUtils ../../../tasks/support/Query".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k){var p=new e.default({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),r=new e.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",
esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});return function(b){function e(a){a=b.call(this,a)||this;a.where=null;a.geometry=null;a.spatialRelationship="intersects";a.hiddenIds=new Set;a.distance=void 0;a.objectIds=null;a.units=null;a.timeExtent=null;a.enabled=!1;return a}a.__extends(e,b);f=e;e.prototype.writeWhere=function(a,b){b.where=a||"1\x3d1"};e.prototype.enable=function(){this._set("enabled",!0)};
e.prototype.createQuery=function(b){void 0===b&&(b={});var c=this.where,d=this.spatialRelationship,e=this.timeExtent,f=this.objectIds,h=this.units,l=this.distance;return new k(a.__assign({geometry:g.clone(this.geometry),objectIds:g.clone(f),spatialRelationship:d,timeExtent:g.clone(e),where:c,units:h,distance:l},b))};e.prototype.clone=function(){var a=this.where,b=this.geometry,c=this.spatialRelationship,d=this.hiddenIds,e=this.timeExtent,h=this.objectIds,k=this.units,l=this.distance,m=new Set;d.forEach(function(a){return m.add(a)});
return new f({geometry:g.clone(b),hiddenIds:m,objectIds:g.clone(h),spatialRelationship:c,timeExtent:g.clone(e),where:a,units:k,distance:l})};var f;a.__decorate([d.property({type:String})],e.prototype,"where",void 0);a.__decorate([d.writer("where")],e.prototype,"writeWhere",null);a.__decorate([d.property({types:m.geometryTypes,json:{read:c.fromJSON,write:!0}})],e.prototype,"geometry",void 0);a.__decorate([d.property({type:String,json:{read:{source:"spatialRel",reader:p.read},write:{target:"spatialRel",
writer:p.write}}})],e.prototype,"spatialRelationship",void 0);a.__decorate([d.property({json:{write:function(a,b,c){return b[c]=l.valuesOfSet(a)},read:function(a){return l.SetFromValues(a)}}})],e.prototype,"hiddenIds",void 0);a.__decorate([d.property({type:Number,json:{write:{overridePolicy:function(a){return{enabled:0<a}}}}})],e.prototype,"distance",void 0);a.__decorate([d.property({type:[Number],json:{write:!0}})],e.prototype,"objectIds",void 0);a.__decorate([d.property({type:String,json:{read:r.read,
write:{writer:r.write,overridePolicy:function(a){return{enabled:a&&0<this.distance}}}}})],e.prototype,"units",void 0);a.__decorate([d.property({type:h,json:{write:!0}})],e.prototype,"timeExtent",void 0);a.__decorate([d.property({readOnly:!0})],e.prototype,"enabled",void 0);return e=f=a.__decorate([d.subclass("esri.views.layers.support.FeatureFilter")],e)}(f.JSONSupport)})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../support/earthUtils ../../support/FrustumExtentIntersection ../../../support/Scheduler".split(" "),
function(n,b,a,m,h,e,f,g,l,d){var c=-.3*g.earthRadius;return function(b){function g(){var a=null!==b&&b.apply(this,arguments)||this;a.suspended=!1;a.extent=null;a.extentIntersectionDirty=!0;a._isVisibleBelowSurface=!1;a.handles=new h;a.layerView=null;a.updating=!0;return a}a.__extends(g,b);g.prototype.setup=function(a){var b=this;this.layerView=a;this.extentIntersection=new l.FrustumExtentIntersection({renderCoordsHelper:a.view.renderCoordsHelper});a=a.view;var c=a.basemapTerrain,f=a.resourceController.scheduler;
this.handles.add([a.on("resize",function(){return b.viewChange()}),a.state.watch("camera",function(){return b.viewChange()},!0),f.registerTask(d.Task.FRUSTUM_VISIBILITY,function(){return b.update()},function(){return b.updating}),c.on("elevation-bounds-change",function(){return b.elevationBoundsChange()})]);"local"===a.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([e.init(c,["opacity","wireframe"],function(){return b.updateIsVisibleBelowSurface()}),e.init(a,"map.ground.navigationConstraint.type",
function(){return b.updateIsVisibleBelowSurface()})])};g.prototype.destroy=function(){this.extentIntersection=this.extent=this.layerView=null;this.handles&&(this.handles.destroy(),this.handles=null)};g.prototype._setDirty=function(){this.updating||this._set("updating",!0)};g.prototype.setExtent=function(a){this.extent=a;this.extentIntersectionDirty=!0;this._setDirty()};g.prototype.viewChange=function(){this._setDirty()};g.prototype.elevationBoundsChange=function(){this._setDirty();this.extentIntersectionDirty=
!0};Object.defineProperty(g.prototype,"isVisibleBelowSurface",{set:function(a){this._isVisibleBelowSurface=a;this._setDirty();this.extentIntersectionDirty=!0},enumerable:!0,configurable:!0});g.prototype.updateIsVisibleBelowSurface=function(){var a=this.layerView.view,b=a.basemapTerrain,c=a.map.ground&&a.map.ground.navigationConstraint&&"none"===a.map.ground.navigationConstraint.type;this.isVisibleBelowSurface="local"===a.viewingMode||!b.isOpaque()||c};g.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=
!1;var a=this.layerView.view,b;if(this._isVisibleBelowSurface)b=c;else{b=a.basemapTerrain.elevationBounds;var d=b.min;b=d-Math.max(1,(b.max-d)*(1.2-1))}this.extentIntersection.update(this.extent,a.spatialReference,b)}};g.prototype.update=function(){this._set("updating",!1);this.extent?(this.updateExtentIntersection(),this._set("suspended",!this.extentIntersection.isVisibleInFrustum(this.layerView.view.frustum))):this._set("suspended",!1)};a.__decorate([f.property({readOnly:!0})],g.prototype,"suspended",
void 0);a.__decorate([f.property({readOnly:!0})],g.prototype,"updating",void 0);return g=a.__decorate([f.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],g)}(m)})},"esri/views/3d/layers/graphics/Graphics3DObjectStates":function(){define(["require","exports","./Graphics3DObjectStateSet"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this._graphicsCore=a;this._stateSets=[]}b.prototype.destroy=function(){this._stateSets&&this._stateSets.forEach(function(a){return a.objectStateSet.removeAll()});
this._stateSets=null};b.prototype.acquireSet=function(b,e){var f=this,g=new a.Graphics3DObjectStateSet(b,e);this._stateSets.push(g);return{set:g,handle:{remove:function(){return f.releaseSet(g)},pause:function(){g.objectStateSet.removeAll();g.paused=!0},resume:function(){g.paused=!1;f.initializeSet(g)}}}};b.prototype.releaseSet=function(a){a.objectStateSet.removeAll();a=this._stateSets?this._stateSets.indexOf(a):-1;-1!==a&&this._stateSets.splice(a,1)};b.prototype._addObjectStateSet=function(a,b){a.addObjectStateSet(b.stateType,
b.objectStateSet)};b.prototype._removeObjectStateSet=function(a,b){a.removeObjectState(b.objectStateSet)};b.prototype.setUid=function(a,b){a.ids.add(b);(b=this._graphicsCore.graphics3DGraphics.get(b))&&this._addObjectStateSet(b,a)};b.prototype.setUids=function(a,b){var e=this;b.forEach(function(b){return e.setUid(a,b)})};b.prototype.setObjectIds=function(a,b){b.forEach(function(b){return a.ids.add(b)});this.initializeSet(a)};b.prototype.addGraphic=function(a){var b=this;this._stateSets.forEach(function(e){!e.paused&&
e.hasGraphic(a)&&b._addObjectStateSet(a,e)})};b.prototype.removeGraphic=function(a){var b=this;this._stateSets.forEach(function(e){e.hasGraphic(a)&&b._removeObjectStateSet(a,e)})};b.prototype.allGraphicsDeleted=function(){this._stateSets&&this._stateSets.forEach(function(a){return a.objectStateSet.removeAll()})};b.prototype.initializeSet=function(a){var b=this,f=this._graphicsCore.graphics3DGraphics;a.objectIdField?f.forEach(function(e){e&&a.hasGraphic(e)&&b._addObjectStateSet(e,a)}):a.ids.forEach(function(e){(e=
f.get(e))&&b._addObjectStateSet(e,a)})};Object.defineProperty(b.prototype,"test",{get:function(){return{states:this._stateSets}},enumerable:!0,configurable:!0});return b}();b.Graphics3DObjectStates=n})},"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":function(){define(["require","exports","../../webgl-engine/lib/Object3DStateSet"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,e){this.stateType=b;this.objectIdField=e;this.objectStateSet=new a.Object3DStateSet;
this.ids=new Set;this.paused=!1}b.prototype.hasGraphic=function(a){return this.objectIdField?this.ids.has(a.graphic.attributes[this.objectIdField]):this.ids.has(a.graphic.uid)};return b}();b.Graphics3DObjectStateSet=n})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators ../../../support/layerViewUtils ../../../support/Scheduler".split(" "),
function(n,b,a,m,h,e,f,g,l){return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a._scaleRangeActive=!1;a.layerScaleRangeVisibilityQuery=!1;a.handles=new h;a.layerView=null;a.layer=null;a.queryGraphicUIDsInExtent=null;a.extent=null;a.graphicsCore=null;a.basemapTerrain=null;a.layerScaleEnabled=!0;a.suspended=!1;a.updating=!0;return a}a.__extends(c,b);c.prototype.setup=function(a,b,c,d,e){var f=this;this.layerView=a;this.layer=b;this.queryGraphicUIDsInExtent=c;this.graphicsCore=
d;this.basemapTerrain=e;this.updateScaleRangeActive();this.handles.add(this.layerView.view.resourceController.scheduler.registerTask(l.Task.SCALE_VISIBILITY,function(){return f.update()},function(){return f.needsUpdate()}))};c.prototype.destroy=function(){this.handles.destroy();this.graphicsCore=this.queryGraphicUIDsInExtent=this.extent=this.layerView=this.handles=null};c.prototype.needsUpdate=function(){return!(!this.layerView.view.basemapTerrain||!this.updating)};c.prototype._setDirty=function(){this.updating||
this._set("updating",!0)};c.prototype.setExtent=function(a){this.extent=a;this._setDirty()};c.prototype.scaleRangeActive=function(){return this._scaleRangeActive};c.prototype.updateScaleRangeActive=function(){var a=this,b=this.layer,c=this.layerScaleEnabled&&(0<b.minScale||0<b.maxScale);b.labelingInfo&&!c&&(c=b.labelingInfo.some(function(a){return a&&(0<a.minScale||0<a.maxScale)}));b=this._scaleRangeActive!==c;(this._scaleRangeActive=c)&&!this.handles.has("terrain-events")&&this.basemapTerrain?(this.handles.add(this.basemapTerrain.on("scale-change",
function(b){return a.scaleUpdateHandler(b)}),"terrain-events"),this.layerScaleEnabled&&this.handles.add(this.basemapTerrain.on("tiles-visibility-changed",function(){return a._setDirty()}),"terrain-events")):!c&&this.handles.has("terrain-events")&&this.handles.remove("terrain-events");return b};c.prototype.update=function(){var a=this,b=this.layerView.view.basemapTerrain;this.extent&&b&&b.ready&&this._scaleRangeActive&&this.layerScaleEnabled?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=
!0,b.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,function(b){return a.finishUpdate(b)})):this.finishUpdate(!0)};c.prototype.finishUpdate=function(a){this.layerScaleRangeVisibilityQuery=!1;this._set("suspended",!a);this._set("updating",!1)};c.prototype.visibleAtLayerScale=function(a){return!this.layerScaleEnabled||g.scaleBoundsPredicate(a,this.layer.minScale||0,this.layer.maxScale||0)};c.prototype.visibleAtLabelScale=function(a,b){return g.scaleBoundsPredicate(a,b.minScale||
0,b.maxScale||0)};c.prototype.graphicScale=function(a){var b;e.isSome(a.centroid)?b=a.centroid:e.isSome(a.graphic.geometry)&&"point"===a.graphic.geometry.type&&(b=a.graphic.geometry);return b?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(b):1:null};c.prototype.graphicVisible=function(a){if(!this.layerScaleEnabled)return!0;a=this.graphicScale(a);return this.visibleAtLayerScale(a)};c.prototype.updateVisibility=function(a){if(this._scaleRangeActive){var b=this.graphicVisible(a);
return a.setVisibilityFlag(1,b,0)}return!1};c.prototype.updateGraphicLabelScaleVisibility=function(a){if(!this._scaleRangeActive||!a.labelGraphics||0===a.labelGraphics.length)return!1;var b=this.graphicScale(a);if(a=this.updateLabelScaleVisibility(a,b))this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty();return a};c.prototype.updateLabelScaleVisibility=function(a,b){if(!a.labelGraphics||0===a.labelGraphics.length)return!1;var c=a.labelGraphics[0]._labelClass;return c&&
null!=c.minScale&&null!=c.maxScale&&(b=this.visibleAtLabelScale(b,c),a.setVisibilityFlag(1,b,1))?!0:!1};c.prototype.scaleUpdateHandler=function(a){var b=this;this._setDirty();if(!this.layerView.suspended){var c=a.extent,d=a.scale,f=this.visibleAtLayerScale(d),g=!1;this.queryGraphicUIDsInExtent(c,a.spatialReference,function(a){if(a=b.graphicsCore.getGraphics3DGraphicById(a)){var h=a.centroid;e.isSome(h)&&(c[0]>h.x||c[1]>h.y||c[2]<h.x||c[3]<h.y)||(a.setVisibilityFlag(1,f,0)&&(g=!0),b.updateLabelScaleVisibility(a,
d)&&(g=!0))}});g&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}};c.prototype.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities(function(a){return a.clearVisibilityFlag(1)}):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility();this._setDirty()};a.__decorate([f.property({constructOnly:!0})],c.prototype,"layerScaleEnabled",void 0);a.__decorate([f.property({readOnly:!0})],
c.prototype,"suspended",void 0);a.__decorate([f.property({readOnly:!0})],c.prototype,"updating",void 0);return c=a.__decorate([f.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],c)}(m)})},"esri/views/3d/layers/support/attributeUtils":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.attributeLookup=function(a,b){b=b.toLowerCase();for(var h=0,e=Object.keys(a);h<e.length;h++){var f=e[h];if(f.toLowerCase()===b)return a[f]}return null}})},
"esri/views/3d/layers/support/projectExtentUtils":function(){define(["require","exports","../../../../core/promiseUtils","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.toViewIfLocal=function(b){var e=b.view.spatialReference,g=b.layer.fullExtent,l=g&&g.spatialReference;return l?l.equals(e)?a.resolve(g.clone()):m.canProject(l,e)?a.resolve(m.project(g,e)):b.view.state.isLocal?h.projectGeometry(g,
e,b.layer.portalItem).then(function(a){return!b.destroyed&&a?a:void 0}).catch(function(){return null}):a.resolve(null):a.resolve(null)}})},"esri/views/3d/layers/support/FeatureTileFetcher3DLayerViewContext":function(){define(["require","exports","../../../../core/maybe","./FeatureTileFetcher3D","./featureTileQuery3D"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this._capabilities=this.memoryCache=null;var b=a.layerView.layer;this.layerView=a.layerView;
this.objectIdField=b.objectIdField;this.returnZ=a.returnZ;this.returnM=a.returnM;a=this.layerView.view.resourceController;this.query=h.createFeatureTileQuery3D(b,a.scheduler);"hasService"in b&&b.hasService&&a&&(this.memoryCache=a.memoryController.getMemCache(b.uid))}b.prototype.destroy=function(){a.isSome(this.memoryCache)&&this.memoryCache.destroy();this.query.destroy()};b.prototype.createQuery=function(){var a=this.layerView.layer.createQuery();a.outFields=this.layerView.availableFields;a.returnZ=
this.returnZ;a.returnM=this.returnM;a.outSpatialReference=this.tilingScheme.spatialReference;return a};Object.defineProperty(b.prototype,"viewingMode",{get:function(){return this.layerView.view.viewingMode},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tilingScheme",{get:function(){return this.layerView.view.featureTiles.tilingScheme},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"scheduler",{get:function(){var a=this.layerView.view.resourceController;return a?
a.scheduler:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"geometryType",{get:function(){return this.layerView.layer.geometryType},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fullExtent",{get:function(){return this.layerView.layer.fullExtent},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tileMaxRecordCount",{get:function(){return this.layerView.layer.capabilities.query.tileMaxRecordCount},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"maxRecordCount",{get:function(){return this.layerView.layer.capabilities.query.maxRecordCount},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"capabilities",{get:function(){return a.isSome(this._capabilities)?this._capabilities:this._capabilities=m.contextCapabilitiesFromLayer(this.layerView.layer)},enumerable:!0,configurable:!0});b.prototype.logFetchError=function(a,b){a.error("#fetchTile()",this.layerView.layer,b&&b.message?b.message:b)};return b}();b.FeatureTileFetcher3DLayerViewContext=
n})},"esri/views/3d/layers/support/featureTileQuery3D":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../layers/graphics/dehydratedFeatures ../../../../tasks/operations/query ../../support/PBFDecoder".split(" "),function(n,b,a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",{value:!0});var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}a.__extends(c,
b);Object.defineProperty(c.prototype,"queryFeaturesDehydrated",{get:function(){var a=this,b=this.layer.capabilities;if((b=b&&b.query)&&b.supportsFormatPBF){h.isNone(this._decoder)&&(this._decoder=new d.PBFDecoder(this.scheduler));var c={type:"dehydrated",sourceSpatialReference:this.layer.spatialReference?this.layer.spatialReference.toJSON():null,applyTransform:!0,maxStringAttributeLength:1024};return function(b,d){return l.runQuery(a.layer.parsedUrl,b,"pbf",d).then(function(b){e.throwIfAborted(d);
return h.isSome(a._decoder)?a._decoder.invoke({buffer:b.data,options:c}):e.reject(e.createAbortError())})}}return function(b,c){return l.executeQuery(a.layer.parsedUrl,b,a.layer.spatialReference,c).then(function(a){return g.fromFeatureSetJSON(a.data)})}},enumerable:!0,configurable:!0});c.prototype.queryFeatureCount=function(a,b){return this.layer.queryFeatureCount(a,b)};c.prototype.destroy=function(){this._decoder=h.destroyMaybe(this._decoder)};a.__decorate([f.property({constructOnly:!0})],c.prototype,
"layer",void 0);a.__decorate([f.property({constructOnly:!0})],c.prototype,"scheduler",void 0);a.__decorate([f.property({readOnly:!0,dependsOn:["layer.capabilities.query.supportsFormatPBF"]})],c.prototype,"queryFeaturesDehydrated",null);return c=a.__decorate([f.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],c)}(m),k=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}a.__extends(c,b);c.prototype.queryFeaturesDehydrated=function(a,b){return this.layer.queryFeatures(a,
b)};a.__decorate([f.property({constructOnly:!0})],c.prototype,"layer",void 0);return c=a.__decorate([f.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],c)}(m),p=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}a.__extends(c,b);c.prototype.destroy=function(){};c.prototype.queryFeaturesDehydrated=function(a,b){var c=this;return this.source.queryFeaturesJSON(a,b).then(g.fromFeatureSetJSON,function(d){if(d&&"query-features-json:unsupported"===
d.name)return c.layer.queryFeatures(a,b);throw d;})};c.prototype.queryFeatureCount=function(a,b){return this.layer.queryFeatureCount(a,b)};a.__decorate([f.property({constructOnly:!0})],c.prototype,"layer",void 0);a.__decorate([f.aliasOf("layer.source")],c.prototype,"source",void 0);return c=a.__decorate([f.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],c)}(m);b.createFeatureTileQuery3D=function(a,b){switch(a.source.type){case "feature-layer":return new c({layer:a,
scheduler:b});case "memory":case "csv":case "geojson":return new p({layer:a});case "ogc-feature":return new k({layer:a});case "stream-layer":throw Error("Tile based queries unsupported for stream sources");}}})},"esri/views/3d/support/PBFDecoder":function(){define("require exports tslib ../../../Graphic ../../../core/promiseUtils ../../../geometry/SpatialReference ../../../layers/support/Field ./WorkerHandle".split(" "),function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});n=
function(){function b(a){this._handle=new l(a)}b.prototype.destroy=function(){this._handle.destroy()};b.prototype.invoke=function(b,d){void 0===d&&(d=null);if(!b.buffer||0===b.buffer.byteLength)return h.resolve(null);b.options.sourceSpatialReference&&b.options.sourceSpatialReference instanceof e&&(b.options=a.__assign(a.__assign({},b.options),{sourceSpatialReference:b.options.sourceSpatialReference.toJSON()}));return this._handle.invoke(b,d).then(function(a){a.spatialReference=e.fromJSON(a.spatialReference);
if(a.fields)for(var b=0;b<a.fields.length;b++)a.fields[b]=f.fromJSON(a.fields[b]);for(var b=a.spatialReference,c=0,d=a.features;c<d.length;c++){var g=d[c];g.uid=m.generateUID();g.geometry&&(g.geometry.spatialReference=b)}return a})};return b}();b.PBFDecoder=n;var l=function(b){function c(a){return b.call(this,"PBFDecoderWorker","_parseFeatureQuery",a,{strategy:"dedicated"})||this}a.__extends(c,b);c.prototype.getTransferList=function(a){return[a.buffer]};return c}(g.WorkerHandle)})},"esri/views/3d/support/EventedSet":function(){define(["require",
"exports","tslib","../../../core/Evented","../../../core/SetUtils"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a._set=new Set;return a}a.__extends(e,b);e.prototype.clear=function(){if(0<this._set.size){var a=this.toArray();this._set.clear();this.emit("after-changes",{type:2});this.emit("change",{added:[],removed:a})}};Object.defineProperty(e.prototype,"length",{get:function(){return this._set.size},
enumerable:!0,configurable:!0});e.prototype.addMany=function(a){if(0!==a.length){for(var b=0;b<a.length;b++)this._set.add(a[b]);this.emit("after-changes",{type:1});this.emit("change",{added:a,removed:[]})}};e.prototype.remove=function(a){this._set.delete(a)&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:[a]}))};e.prototype.removeMany=function(a){for(var b=[],d=0;d<a.length;d++){var c=a[d];this._set.delete(c)&&b.push(c)}0<b.length&&(this.emit("after-changes",{type:2}),this.emit("change",
{added:[],removed:b}))};e.prototype.toArray=function(){return h.valuesOfSet(this._set)};e.prototype.find=function(a){var b;h.someSet(this._set,function(d){return a(d)?(b=d,!0):!1});return b};e.prototype.forEach=function(a){this._set.forEach(function(b){return a(b)})};return e}(m);b.EventedSet=n})},"esri/views/layers/FeatureLayerView":function(){define("require exports tslib ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/SetUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../layers/support/fieldUtils ../../layers/support/timeUtils ../../support/arcadeOnDemand ../../tasks/support/Query ./support/FeatureEffect ./support/FeatureFilter ./support/popupUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v){Object.defineProperty(b,"__esModule",{value:!0});var z=h.getLogger("esri.views.layers.FeatureLayerView");b.FeatureLayerView=function(b){return function(b){function h(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];a=b.apply(this,a)||this;a._updatingRequiredFieldsPromise=null;a.effect=null;a.filter=null;a.layer=null;a.requiredFields=[];a.view=null;return a}a.__extends(h,b);h.prototype.initialize=function(){var a=this;l.init(this,"layer.renderer layer.labelingInfo layer.elevationInfo.featureExpressionInfo layer.displayField filter effect layer.timeInfo timeExtent".split(" "),
function(){return a._handleRequiredFieldsChange()},!0)};Object.defineProperty(h.prototype,"availableFields",{get:function(){var b=this.layer,d=this.layer.fields,e=this.requiredFields;return"outFields"in b&&b.outFields?c.fixFields(d,a.__spreadArrays(c.unpackFieldNames(d,b.outFields),e)):c.fixFields(d,e)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"maximumNumberOfFeatures",{get:function(){return 0},set:function(a){z.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")},
enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!1},enumerable:!0,configurable:!0});h.prototype.highlight=function(a,b){void 0===b&&(b={});throw Error("missing implementation");};h.prototype.createQuery=function(){var a={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},a=e.isSome(this.filter)?this.filter.createQuery(a):new r(a);this.timeExtent&&(a.timeExtent=a.timeExtent?a.timeExtent.intersection(this.timeExtent):
this.timeExtent.clone());return a};h.prototype.queryFeatures=function(a,b){throw Error("missing implementation");};h.prototype.queryObjectIds=function(a,b){throw Error("missing implementation");};h.prototype.queryFeatureCount=function(a,b){throw Error("missing implementation");};h.prototype.queryExtent=function(a,b){throw Error("missing implementation");};h.prototype._loadArcadeModules=function(a){if(a.get("expressionInfos.length"))return p.loadArcade()};h.prototype._handleRequiredFieldsChange=function(){var a=
this,b=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",b);b.then(function(){a._updatingRequiredFieldsPromise===b&&a._set("_updatingRequiredFieldsPromise",null)})};h.prototype._updateRequiredFields=function(){return a.__awaiter(this,void 0,void 0,function(){var b,d,h,k,l,m,n,p,q,r,t,u,v,w,y;return a.__generator(this,function(a){switch(a.label){case 0:if(!this.layer||!this.view)return[2];b="3d"===this.view.type;d=this;k=h=d.layer;l=k.fields;m=k.objectIdField;n=k.renderer;p=k.displayField;
q=h.featureReduction;r=new Set;return[4,f.eachAlways([n?n.collectRequiredFields(r,l):null,c.collectLabelingFields(r,h),b?c.collectElevationFields(r,h):null,e.isSome(this.filter)?c.collectFilterFields(r,h,this.filter):null,this.effect?c.collectFilterFields(r,h,this.effect.filter):null,q?c.collectFeatureReductionFields(r,h,q):null])];case 1:t=a.sent();h.timeInfo&&this.timeExtent&&c.collectFields(r,h.fields,[h.timeInfo.startField,h.timeInfo.endField]);u=0;for(v=t;u<v.length;u++)w=v[u],w.error&&z.error(w.error);
c.collectField(r,l,m);b&&p&&c.collectField(r,l,p);y=g.valuesOfSet(r).sort();this._set("requiredFields",y);return[2]}})})};h.prototype.validateFetchPopupFeatures=function(a){var b=this.layer;if(!this.layer.popupEnabled)return new m("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:b});if(!v.getFetchPopupTemplate(this.layer,a))return new m("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:b})};h.prototype.fetchClientPopupFeatures=function(b){return a.__awaiter(this,
void 0,void 0,function(){var d,g,h,k,l,m,n,p,q,r,t,u;return a.__generator(this,function(a){switch(a.label){case 0:d=e.isSome(b)?b.clientGraphics:null;if(!d||0===d.length)return[2,f.resolve([])];g=[];h=[];k=this.layer;l=v.getFetchPopupTemplate(k,b);return e.isSome(l)?[4,this._loadArcadeModules(l)]:[2,f.resolve([])];case 1:return n=(m=a.sent())&&m.arcadeUtils.hasGeometryOperations(l),[4,this.createPopupQuery(b)];case 2:p=a.sent();q=c.unpackFieldNames(k.fields,p.outFields);r=0;for(t=d;r<t.length;r++)u=
t[r],n||!c.featureHasFields(q,u)?h.push(u):g.push(u);if("stream"===k.type||0===h.length)return[2,f.resolve(g)];p.objectIds=h.map(function(a){return a.attributes[k.objectIdField]});return[2,k.queryFeatures(p).then(function(a){return g.concat(a.features)}).catch(function(){return h})]}})})};h.prototype.createPopupQuery=function(b){return a.__awaiter(this,void 0,void 0,function(){var c,d,e;return a.__generator(this,function(a){switch(a.label){case 0:return c=this.layer,d=c.createQuery(),d.returnGeometry=
!0,d.returnZ=!0,d.returnM=!0,e=d,[4,v.getRequiredFields(this.layer,v.getFetchPopupTemplate(this.layer,b))];case 1:return e.outFields=a.sent(),d.outSpatialReference=this.view.spatialReference,[2,d]}})})};h.prototype.canResume=function(){var a;return!b.prototype.canResume.call(this)||(null===(a=this.timeExtent)||void 0===a?0:a.isEmpty)?!1:!0};a.__decorate([d.property()],h.prototype,"_updatingRequiredFieldsPromise",void 0);a.__decorate([d.property({readOnly:!0,dependsOn:["layer.outFields?","requiredFields"]})],
h.prototype,"availableFields",null);a.__decorate([d.property({type:t})],h.prototype,"effect",void 0);a.__decorate([d.property({type:u})],h.prototype,"filter",void 0);a.__decorate([d.property(k.combinedViewLayerTimeExtentProperty)],h.prototype,"timeExtent",void 0);a.__decorate([d.property()],h.prototype,"layer",void 0);a.__decorate([d.property({type:Number})],h.prototype,"maximumNumberOfFeatures",null);a.__decorate([d.property({readOnly:!0,type:Boolean})],h.prototype,"maximumNumberOfFeaturesExceeded",
null);a.__decorate([d.property({readOnly:!0})],h.prototype,"requiredFields",void 0);a.__decorate([d.property({dependsOn:["timeExtent"]})],h.prototype,"suspended",void 0);a.__decorate([d.property()],h.prototype,"view",void 0);return h=a.__decorate([d.subclass("esri.views.layers.FeatureLayerView")],h)}(b)}})},"esri/views/layers/support/FeatureEffect":function(){define("require exports tslib ../../../core/JSONSupport ../../../core/Logger ../../../core/maybe ../../../core/accessorSupport/decorators ./FeatureFilter ./ParsedFeatureEffect ./Transition".split(" "),
function(n,b,a,m,h,e,f,g,l,d){var c=h.getLogger("esri.views.layers.support.FeatureEffect");return function(b){function h(){var a=null!==b&&b.apply(this,arguments)||this;a.filter=null;a.includedEffect=null;a.excludedEffect=null;a.excludedLabelsVisible=!1;return a}a.__extends(h,b);k=h;Object.defineProperty(h.prototype,"insideEffect",{get:function(){c.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead");return this.includedEffect},set:function(a){c.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead");
this.includedEffect=a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"outsideEffect",{get:function(){c.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead");return this.excludedEffect},set:function(a){c.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead");this.excludedEffect=a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"parsedIncludedEffect",{get:function(){return e.isSome(this.includedEffect)?
"string"===typeof this.includedEffect?l.fromString(this.includedEffect):new d({from:l.fromString(this.includedEffect.from),to:l.fromString(this.includedEffect.to),duration:this.includedEffect.duration}):null},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"parsedExcludedEffect",{get:function(){return e.isSome(this.excludedEffect)?"string"===typeof this.excludedEffect?l.fromString(this.excludedEffect):new d({from:l.fromString(this.excludedEffect.from),to:l.fromString(this.excludedEffect.to),
duration:this.excludedEffect.duration}):null},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"renderingHash",{get:function(){return this.excludedLabelsVisible+"-"+this.includedEffect+"-"+this.excludedEffect},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"done",{get:function(){return(!e.isSome(this.parsedIncludedEffect)||this.parsedIncludedEffect.done)&&(!e.isSome(this.parsedExcludedEffect)||this.parsedExcludedEffect.done)},enumerable:!0,configurable:!0});h.prototype.clone=
function(){return new k({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})};var k;a.__decorate([f.property({type:g,json:{write:!0}})],h.prototype,"filter",void 0);a.__decorate([f.property({type:String,json:{write:!0}})],h.prototype,"includedEffect",void 0);a.__decorate([f.property({type:String,json:{write:!0}})],h.prototype,"excludedEffect",void 0);a.__decorate([f.property({type:Boolean,
json:{write:!0}})],h.prototype,"excludedLabelsVisible",void 0);a.__decorate([f.property({dependsOn:["includedEffect"]})],h.prototype,"parsedIncludedEffect",null);a.__decorate([f.property({dependsOn:["excludedEffect"]})],h.prototype,"parsedExcludedEffect",null);a.__decorate([f.property({dependsOn:["includedEffect","excludedEffect"]})],h.prototype,"renderingHash",null);return h=k=a.__decorate([f.subclass("esri.views.layers.support.FeatureEffect")],h)}(m.JSONSupport)})},"esri/views/layers/support/ParsedFeatureEffect":function(){define("require exports tslib ../../../core/Error ../../../core/JSONSupport ../../../core/Logger ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f32 ./cssFilterParser".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c){var k=e.getLogger("esri.views.layers.support.ParsedFeatureEffect"),p={grayscale:function(a){a=1-a.amount;a=d.mat4f32.fromValues(.2126+.7874*a,.7152-.7152*a,.0722-.0722*a,0,.2126-.2126*a,.7152+.2848*a,.0722-.0722*a,0,.2126-.2126*a,.7152-.7152*a,.0722+.9278*a,0,0,0,0,1);return l.mat4.transpose(a,a)},sepia:function(a){a=1-a.amount;a=d.mat4f32.fromValues(.393+.607*a,.769-.769*a,.189-.189*a,0,.349-.349*a,.686+.314*a,.168-.168*a,0,.272-.272*a,.534-.534*a,.131+.869*a,0,0,
0,0,1);return l.mat4.transpose(a,a)},saturate:function(a){a=a.amount;a=d.mat4f32.fromValues(.213+.787*a,.715-.715*a,.072-.072*a,0,.213-.213*a,.715+.285*a,.072-.072*a,0,.213-.213*a,.715-.715*a,.072+.928*a,0,0,0,0,1);return l.mat4.transpose(a,a)},"hue-rotate":function(a){var b=Math.sin(a.angle*Math.PI/180);a=Math.cos(a.angle*Math.PI/180);b=d.mat4f32.fromValues(.213+.787*a-.213*b,.715-.715*a-.715*b,.072-.072*a+.928*b,0,.213-.213*a+.143*b,.715+.285*a+.14*b,.072-.072*a-.283*b,0,.213-.213*a-.787*b,.715-
.715*a+.715*b,.072+.928*a+.072*b,0,0,0,0,1);return l.mat4.transpose(b,b)},invert:function(a){var b=1-2*a.amount;a=a.amount;b=d.mat4f32.fromValues(b,0,0,a,0,b,0,a,0,0,b,a,0,0,0,1);return l.mat4.transpose(b,b)},brightness:function(a){a=a.amount;a=d.mat4f32.fromValues(a,0,0,0,0,a,0,0,0,0,a,0,0,0,0,1);return l.mat4.transpose(a,a)},contrast:function(a){a=a.amount;a=d.mat4f32.fromValues(a,0,0,.5-.5*a,0,a,0,.5-.5*a,0,0,a,.5-.5*a,0,0,0,1);return l.mat4.transpose(a,a)}};return function(b){function e(){var a=
null!==b&&b.apply(this,arguments)||this;a.customTransforms=null;a.done=!0;return a}a.__extends(e,b);h=e;e.fromString=function(a){var b=[],d=null;try{for(var e=0,f=c.parse(a);e<f.length;e++){var g=f[e];"opacity"===g.type?d=g:b.push(g)}}catch(B){k.error(new m("invalid-type","Encountered an error when parsing css",B))}return new h({transforms:b,opacity:d})};e.prototype.getOpacity=function(){return f.isSome(this.opacity)?this.opacity.amount:1};e.prototype.getColorMatrix=function(){var b=this;return(this.transforms||
[]).map(function(b){return a.__assign({},b)}).reverse().reduce(function(a,c){return l.mat4.multiply(a,a,b._getFactory(c)(c))},d.mat4f32.create())};e.prototype.clone=function(){return new h({transforms:this.transforms&&this.transforms.map(function(b){return a.__assign({},b)}),customTransforms:this.customTransforms&&this.customTransforms.map(function(b){return a.__assign({},b)})})};e.prototype._getFactory=function(a){var b=p[a.type];if(b)return b;if(this.customTransforms)for(var b=function(b){if(b.type===
a.type){b=d.mat4f32.fromValues.apply(d.mat4f32,b.matrix);var c=l.mat4.transpose(b,b);return{value:function(){return c}}}},c=0,e=this.customTransforms;c<e.length;c++){var f=b(e[c]);if("object"===typeof f)return f.value}k.error("invalid-type","No effect "+a.type+" exists");return function(){return d.mat4f32.create()}};var h;a.__decorate([g.property()],e.prototype,"opacity",void 0);a.__decorate([g.property()],e.prototype,"transforms",void 0);a.__decorate([g.property()],e.prototype,"customTransforms",
void 0);return e=h=a.__decorate([g.subclass("esri.views.layers.support.ParsedFeatureEffect")],e)}(h.JSONSupport)})},"esri/views/layers/support/cssFilterParser":function(){(function(n,b){"function"===typeof define&&define.amd?define([],b):"object"===typeof module&&module.exports&&(module.exports=b())})(this,function(){function n(b,a,m,h){this.message=b;this.expected=a;this.found=m;this.location=h;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,n)}(function(b,
a){function m(){this.constructor=b}m.prototype=a.prototype;b.prototype=new m})(n,Error);n.buildMessage=function(b,a){function m(a){return a.charCodeAt(0).toString(16).toUpperCase()}function h(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+m(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+m(a)})}function e(a){return a.replace(/\\/g,"\\\\").replace(/\]/g,
"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+m(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+m(a)})}var f={literal:function(a){return'"'+h(a.text)+'"'},"class":function(a){var b="",d;for(d=0;d<a.parts.length;d++)b+=a.parts[d]instanceof Array?e(a.parts[d][0])+"-"+e(a.parts[d][1]):e(a.parts[d]);return"["+(a.inverted?"^":"")+b+"]"},any:function(a){return"any character"},
end:function(a){return"end of input"},other:function(a){return a.description}};return"Expected "+function(a){var b=Array(a.length),d;for(d=0;d<a.length;d++){var c=d,e;e=a[d];e=f[e.type](e);b[c]=e}b.sort();if(0<b.length){for(a=d=1;d<b.length;d++)b[d-1]!==b[d]&&(b[a]=b[d],a++);b.length=a}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}(b)+" but "+(a?'"'+h(a)+'"':"end of input")+" found."};return{SyntaxError:n,parse:function(b,
a){function m(a,b){return{type:"literal",text:a,ignoreCase:b}}function h(a,b,c){return{type:"class",parts:a,inverted:b,ignoreCase:c}}function e(a){return{type:"other",description:a}}function f(a){var c=zb[a],d;if(!c){for(d=a-1;!zb[d];)d--;c=zb[d];for(c={line:c.line,column:c.column};d<a;)10===b.charCodeAt(d)?(c.line++,c.column=1):c.column++,d++;zb[a]=c}return c}function g(a,b){var c=f(a),d=f(b);return{start:{offset:a,line:c.line,column:c.column},end:{offset:b,line:d.line,column:d.column}}}function l(a){K<
fb||(K>fb&&(fb=K,Ub=[]),Ub.push(a))}function d(){var a,d;ea++;a=K;d=w();d!==q?(b.substr(K,4)===C?(d=C,K+=4):(d=q,0===ea&&l(F)),d!==q?(d=w(),d!==q?(pa=a,a=null):(K=a,a=q)):(K=a,a=q)):(K=a,a=q);ea--;a===q&&(d=q,0===ea&&l(B));if(a===q)if(a=[],d=c(),d!==q)for(;d!==q;)a.push(d),d=c();else a=q;return a}function c(){var a,c,d,e,f,h,m,v,A;ea++;c=K;d=w();d!==q?(b.substr(K,5)===I?(e=I,K+=5):(e=q,0===ea&&l(G)),e!==q?(f=w(),f!==q?(h=u(),h!==q?(m=w(),m!==q?(41===b.charCodeAt(K)?(v=J,K++):(v=q,0===ea&&l(E)),v!==
q?(A=w(),A!==q?(pa=c,c=d={type:"blur",radius:h}):(K=c,c=q)):(K=c,c=q)):(K=c,c=q)):(K=c,c=q)):(K=c,c=q)):(K=c,c=q)):(K=c,c=q);ea--;c===q&&(d=q,0===ea&&l(H));a=c;if(a===q){var y,B,x,C,F,vb,rb,xa;ea++;y=K;B=w();B!==q?(b.substr(K,11)===M?(x=M,K+=11):(x=q,0===ea&&l(N)),x!==q?(C=w(),C!==q?(F=k(),F!==q?(vb=w(),vb!==q?(41===b.charCodeAt(K)?(rb=J,K++):(rb=q,0===ea&&l(E)),rb!==q?(xa=w(),xa!==q?(pa=y,y=B={type:"brightness",amount:F}):(K=y,y=q)):(K=y,y=q)):(K=y,y=q)):(K=y,y=q)):(K=y,y=q)):(K=y,y=q)):(K=y,y=q);
ea--;y===q&&(B=q,0===ea&&l(L));a=y;if(a===q){var Ia,ua,Fb,Wa,Pb,va,ub,qa;ea++;Ia=K;ua=w();ua!==q?(b.substr(K,9)===R?(Fb=R,K+=9):(Fb=q,0===ea&&l(W)),Fb!==q?(Wa=w(),Wa!==q?(Pb=k(),Pb!==q?(va=w(),va!==q?(41===b.charCodeAt(K)?(ub=J,K++):(ub=q,0===ea&&l(E)),ub!==q?(qa=w(),qa!==q?(pa=Ia,Ia=ua={type:"contrast",amount:Pb}):(K=Ia,Ia=q)):(K=Ia,Ia=q)):(K=Ia,Ia=q)):(K=Ia,Ia=q)):(K=Ia,Ia=q)):(K=Ia,Ia=q)):(K=Ia,Ia=q);ea--;Ia===q&&(ua=q,0===ea&&l(Q));a=Ia;if(a===q){var ma,sa,Ka,ya,Ob,Ca,ob,eb,ib,gb,wb,Qb,bc,hc;
ea++;ma=K;sa=w();if(sa!==q)if(b.substr(K,12)===U?(Ka=U,K+=12):(Ka=q,0===ea&&l(P)),Ka!==q)if(ya=w(),ya!==q)if(Ob=u(),Ob!==q)if(Ca=w(),Ca!==q)if(ob=u(),ob!==q)if(eb=w(),eb!==q)if(ib=u(),ib===q&&(ib=null),ib!==q)if(gb=w(),gb!==q){var S,Ba,Ha,Aa,Da,Ea,Ga,Ja,Xa,Pa,lb,Ma,db,Ua,Rb,pb,fb,Gb;S=K;35===b.charCodeAt(K)?(Ba=oc,K++):(Ba=q,0===ea&&l(pc));if(Ba!==q)if(Ha=K,Aa=z(),Aa!==q?(Da=z(),Da!==q?Ha=Aa=[Aa,Da]:(K=Ha,Ha=q)):(K=Ha,Ha=q),Ha!==q)if(Aa=K,Da=z(),Da!==q?(Ea=z(),Ea!==q?Aa=Da=[Da,Ea]:(K=Aa,Aa=q)):(K=
Aa,Aa=q),Aa!==q)if(Da=K,Ea=z(),Ea!==q?(Ga=z(),Ga!==q?Da=Ea=[Ea,Ga]:(K=Da,Da=q)):(K=Da,Da=q),Da!==q){pa=S;var zb=Aa,Ab=Da;S=Ba=[parseInt(Ha.join(""),16),parseInt(zb.join(""),16),parseInt(Ab.join(""),16)]}else K=S,S=q;else K=S,S=q;else K=S,S=q;else K=S,S=q;if(S===q){S=K;35===b.charCodeAt(K)?(Ba=oc,K++):(Ba=q,0===ea&&l(pc));if(Ba!==q)if(Ha=z(),Ha!==q)if(Aa=z(),Aa!==q)if(Da=z(),Da!==q){pa=S;var Xb=Aa,Mb=Da;S=Ba=[parseInt([Ha,Ha].join(""),16),parseInt([Xb,Xb].join(""),16),parseInt([Mb,Mb].join(""),16)]}else K=
S,S=q;else K=S,S=q;else K=S,S=q;else K=S,S=q;if(S===q&&(S=K,b.substr(K,5)===kb?(Ba=kb,K+=5):(Ba=q,0===ea&&l(Sb)),Ba!==q?(Ha=w(),Ha!==q?(Aa=r(),Aa!==q?(Da=w(),Da!==q?(44===b.charCodeAt(K)?(Ea=bb,K++):(Ea=q,0===ea&&l(cb)),Ea!==q?(Ga=w(),Ga!==q?(Ja=r(),Ja!==q?(Xa=w(),Xa!==q?(44===b.charCodeAt(K)?(Pa=bb,K++):(Pa=q,0===ea&&l(cb)),Pa!==q?(lb=w(),lb!==q?(Ma=r(),Ma!==q?(db=w(),db!==q?(44===b.charCodeAt(K)?(Ua=bb,K++):(Ua=q,0===ea&&l(cb)),Ua!==q?(Rb=w(),Rb!==q?(pb=k(),pb!==q?(fb=w(),fb!==q?(41===b.charCodeAt(K)?
(Gb=J,K++):(Gb=q,0===ea&&l(E)),Gb!==q?(pa=S,S=Ba=[255*Aa,255*Ja,255*Ma,pb]):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q),S===q&&(S=K,b.substr(K,5)===kb?(Ba=kb,K+=5):(Ba=q,0===ea&&l(Sb)),Ba!==q?(Ha=w(),Ha!==q?(Aa=p(),Aa!==q?(Da=w(),Da!==q?(44===b.charCodeAt(K)?(Ea=bb,K++):(Ea=q,0===ea&&l(cb)),Ea!==q?(Ga=w(),Ga!==q?(Ja=p(),Ja!==q?(Xa=w(),Xa!==q?(44===b.charCodeAt(K)?
(Pa=bb,K++):(Pa=q,0===ea&&l(cb)),Pa!==q?(lb=w(),lb!==q?(Ma=p(),Ma!==q?(44===b.charCodeAt(K)?(db=bb,K++):(db=q,0===ea&&l(cb)),db!==q?(Ua=w(),Ua!==q?(Rb=k(),Rb!==q?(41===b.charCodeAt(K)?(pb=J,K++):(pb=q,0===ea&&l(E)),pb!==q?(pa=S,S=Ba=[Aa,Ja,Ma,Rb]):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q),S===q&&(S=K,b.substr(K,5)===kb?(Ba=kb,K+=5):(Ba=q,0===ea&&l(Sb)),Ba!==q?(Ha=w(),Ha!==q?(Aa=
r(),Aa!==q?(Da=w(),Da!==q?(44===b.charCodeAt(K)?(Ea=bb,K++):(Ea=q,0===ea&&l(cb)),Ea!==q?(Ga=w(),Ga!==q?(Ja=r(),Ja!==q?(Xa=w(),Xa!==q?(44===b.charCodeAt(K)?(Pa=bb,K++):(Pa=q,0===ea&&l(cb)),Pa!==q?(lb=w(),lb!==q?(Ma=r(),Ma!==q?(db=w(),db!==q?(41===b.charCodeAt(K)?(Ua=J,K++):(Ua=q,0===ea&&l(E)),Ua!==q?(pa=S,S=Ba=[255*Aa,255*Ja,255*Ma,1]):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q),S===q&&(S=K,b.substr(K,
5)===kb?(Ba=kb,K+=5):(Ba=q,0===ea&&l(Sb)),Ba!==q?(Ha=w(),Ha!==q?(Aa=p(),Aa!==q?(Da=w(),Da!==q?(44===b.charCodeAt(K)?(Ea=bb,K++):(Ea=q,0===ea&&l(cb)),Ea!==q?(Ga=w(),Ga!==q?(Ja=p(),Ja!==q?(Xa=w(),Xa!==q?(44===b.charCodeAt(K)?(Pa=bb,K++):(Pa=q,0===ea&&l(cb)),Pa!==q?(lb=w(),lb!==q?(Ma=p(),Ma!==q?(41===b.charCodeAt(K)?(db=J,K++):(db=q,0===ea&&l(E)),db!==q?(pa=S,S=Ba=[Aa,Ja,Ma,1]):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=
S,S=q),S===q&&(S=K,b.substr(K,4)===Lb?(Ba=Lb,K+=4):(Ba=q,0===ea&&l(ec)),Ba!==q?(Ha=w(),Ha!==q?(Aa=r(),Aa!==q?(Da=w(),Da!==q?(44===b.charCodeAt(K)?(Ea=bb,K++):(Ea=q,0===ea&&l(cb)),Ea!==q?(Ga=w(),Ga!==q?(Ja=r(),Ja!==q?(Xa=w(),Xa!==q?(44===b.charCodeAt(K)?(Pa=bb,K++):(Pa=q,0===ea&&l(cb)),Pa!==q?(lb=w(),lb!==q?(Ma=r(),Ma!==q?(db=w(),db!==q?(41===b.charCodeAt(K)?(Ua=J,K++):(Ua=q,0===ea&&l(E)),Ua!==q?(pa=S,S=Ba=[255*Aa,255*Ja,255*Ma,1]):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):
(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q),S===q&&(S=K,b.substr(K,4)===Lb?(Ba=Lb,K+=4):(Ba=q,0===ea&&l(ec)),Ba!==q?(Ha=w(),Ha!==q?(Aa=p(),Aa!==q?(Da=w(),Da!==q?(44===b.charCodeAt(K)?(Ea=bb,K++):(Ea=q,0===ea&&l(cb)),Ea!==q?(Ga=w(),Ga!==q?(Ja=p(),Ja!==q?(Xa=w(),Xa!==q?(44===b.charCodeAt(K)?(Pa=bb,K++):(Pa=q,0===ea&&l(cb)),Pa!==q?(lb=w(),lb!==q?(Ma=p(),Ma!==q?(db=w(),db!==q?(41===b.charCodeAt(K)?(Ua=J,K++):(Ua=q,0===ea&&l(E)),Ua!==q?(pa=S,S=Ba=[Aa,Ja,Ma,1]):(K=S,S=q)):
(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q)):(K=S,S=q),S===q))))))){var Bb,Cb,Db;ea++;Bb=K;Cb=[];kc.test(b.charAt(K))?(Db=b.charAt(K),K++):(Db=q,0===ea&&l(gc));if(Db!==q)for(;Db!==q;)Cb.push(Db),kc.test(b.charAt(K))?(Db=b.charAt(K),K++):(Db=q,0===ea&&l(gc));else Cb=q;if(Cb!==q){pa=Bb;var $b=b.substring(pa,K);if(!ud.has($b)){var Tb='unknown color "'+$b+'"',Eb=void 0,Eb=void 0!==Eb?Eb:g(pa,K);throw new n(Tb,null,null,Eb);}Cb=
qc[$b].concat(1)}Bb=Cb;ea--;Bb===q&&(Cb=q,0===ea&&l(fc));S=Bb}}wb=S;wb===q&&(wb=null);wb!==q?(Qb=w(),Qb!==q?(41===b.charCodeAt(K)?(bc=J,K++):(bc=q,0===ea&&l(E)),bc!==q?(hc=w(),hc!==q?(pa=ma,ma=sa={type:"drop-shadow",offsetX:Ob,offsetY:ob,blurRadius:ib,color:wb}):(K=ma,ma=q)):(K=ma,ma=q)):(K=ma,ma=q)):(K=ma,ma=q)}else K=ma,ma=q;else K=ma,ma=q;else K=ma,ma=q;else K=ma,ma=q;else K=ma,ma=q;else K=ma,ma=q;else K=ma,ma=q;else K=ma,ma=q;else K=ma,ma=q;ea--;ma===q&&(sa=q,0===ea&&l(O));a=ma;if(a===q){var Qa,
yb,xb,cc,Vb,dc,Nb,Ub;ea++;Qa=K;yb=w();yb!==q?(b.substr(K,10)===V?(xb=V,K+=10):(xb=q,0===ea&&l(T)),xb!==q?(cc=w(),cc!==q?(Vb=k(),Vb!==q?(dc=w(),dc!==q?(41===b.charCodeAt(K)?(Nb=J,K++):(Nb=q,0===ea&&l(E)),Nb!==q?(Ub=w(),Ub!==q?(pa=Qa,Qa=yb={type:"grayscale",amount:Vb}):(K=Qa,Qa=q)):(K=Qa,Qa=q)):(K=Qa,Qa=q)):(K=Qa,Qa=q)):(K=Qa,Qa=q)):(K=Qa,Qa=q)):(K=Qa,Qa=q);ea--;Qa===q&&(yb=q,0===ea&&l(ba));a=Qa;if(a===q){var Ra,Wb,ac,Zb,tc,Hc,uc,D;ea++;Ra=K;Wb=w();if(Wb!==q)if(b.substr(K,11)===Y?(ac=Y,K+=11):(ac=q,
0===ea&&l(da)),ac!==q)if(Zb=w(),Zb!==q){var Na,Ta,sb;ea++;Na=K;var ca,mb,yc;ea++;ca=K;Sa.test(b.charAt(K))?(mb=b.charAt(K),K++):(mb=q,0===ea&&l(nb));mb===q&&(mb=null);mb!==q?(yc=p(),yc!==q?(pa=ca,ca=mb=parseFloat(b.substring(pa,K))):(K=ca,ca=q)):(K=ca,ca=q);ea--;ca===q&&(mb=q,0===ea&&l(ha));Ta=ca;Ta!==q?(sb=t(),sb!==q?(pa=Na,Na=Ta*=sb):(K=Na,Na=q)):(K=Na,Na=q);Na===q&&(Na=K,48===b.charCodeAt(K)?(Ta=Va,K++):(Ta=q,0===ea&&l(tb)),Ta!==q?(sb=t(),sb===q&&(sb=null),sb!==q?(pa=Na,Na=Ta=0):(K=Na,Na=q)):(K=
Na,Na=q));ea--;Na===q&&(Ta=q,0===ea&&l(hb));tc=Na;tc!==q?(Hc=w(),Hc!==q?(41===b.charCodeAt(K)?(uc=J,K++):(uc=q,0===ea&&l(E)),uc!==q?(D=w(),D!==q?(pa=Ra,Ra=Wb={type:"hue-rotate",angle:tc}):(K=Ra,Ra=q)):(K=Ra,Ra=q)):(K=Ra,Ra=q)):(K=Ra,Ra=q)}else K=Ra,Ra=q;else K=Ra,Ra=q;else K=Ra,Ra=q;ea--;Ra===q&&(Wb=q,0===ea&&l(X));a=Ra;if(a===q){var Ya,Qc,id,vd,jd,wd,kd,xd;ea++;Ya=K;Qc=w();Qc!==q?(b.substr(K,7)===ga?(id=ga,K+=7):(id=q,0===ea&&l(ka)),id!==q?(vd=w(),vd!==q?(jd=k(),jd!==q?(wd=w(),wd!==q?(41===b.charCodeAt(K)?
(kd=J,K++):(kd=q,0===ea&&l(E)),kd!==q?(xd=w(),xd!==q?(pa=Ya,Ya=Qc={type:"invert",amount:jd}):(K=Ya,Ya=q)):(K=Ya,Ya=q)):(K=Ya,Ya=q)):(K=Ya,Ya=q)):(K=Ya,Ya=q)):(K=Ya,Ya=q)):(K=Ya,Ya=q);ea--;Ya===q&&(Qc=q,0===ea&&l(fa));a=Ya;if(a===q){var Za,Sc,ld,yd,md,zd,nd,Ad;ea++;Za=K;Sc=w();Sc!==q?(b.substr(K,8)===ia?(ld=ia,K+=8):(ld=q,0===ea&&l(Z)),ld!==q?(yd=w(),yd!==q?(md=k(),md!==q?(zd=w(),zd!==q?(41===b.charCodeAt(K)?(nd=J,K++):(nd=q,0===ea&&l(E)),nd!==q?(Ad=w(),Ad!==q?(pa=Za,Za=Sc={type:"opacity",amount:md}):
(K=Za,Za=q)):(K=Za,Za=q)):(K=Za,Za=q)):(K=Za,Za=q)):(K=Za,Za=q)):(K=Za,Za=q)):(K=Za,Za=q);ea--;Za===q&&(Sc=q,0===ea&&l(la));a=Za;if(a===q){var $a,Tc,od,Bd,pd,Cd,qd,Dd;ea++;$a=K;Tc=w();Tc!==q?(b.substr(K,9)===aa?(od=aa,K+=9):(od=q,0===ea&&l(na)),od!==q?(Bd=w(),Bd!==q?(pd=k(),pd!==q?(Cd=w(),Cd!==q?(41===b.charCodeAt(K)?(qd=J,K++):(qd=q,0===ea&&l(E)),qd!==q?(Dd=w(),Dd!==q?(pa=$a,$a=Tc={type:"saturate",amount:pd}):(K=$a,$a=q)):(K=$a,$a=q)):(K=$a,$a=q)):(K=$a,$a=q)):(K=$a,$a=q)):(K=$a,$a=q)):(K=$a,$a=
q);ea--;$a===q&&(Tc=q,0===ea&&l(oa));a=$a;if(a===q){var ab,Uc,rd,Ed,sd,Fd,td,Gd;ea++;ab=K;Uc=w();Uc!==q?(b.substr(K,6)===ta?(rd=ta,K+=6):(rd=q,0===ea&&l(ra)),rd!==q?(Ed=w(),Ed!==q?(sd=k(),sd!==q?(Fd=w(),Fd!==q?(41===b.charCodeAt(K)?(td=J,K++):(td=q,0===ea&&l(E)),td!==q?(Gd=w(),Gd!==q?(pa=ab,ab=Uc={type:"sepia",amount:sd}):(K=ab,ab=q)):(K=ab,ab=q)):(K=ab,ab=q)):(K=ab,ab=q)):(K=ab,ab=q)):(K=ab,ab=q)):(K=ab,ab=q);ea--;ab===q&&(Uc=q,0===ea&&l(ja));a=ab}}}}}}}}}return a}function k(){var a;ea++;a=r();a===
q&&(a=p());ea--;a===q&&0===ea&&l(xa);return a}function p(){var a,c,d;ea++;a=K;c=[];va.test(b.charAt(K))?(d=b.charAt(K),K++):(d=q,0===ea&&l(ma));if(d!==q)for(;d!==q;)c.push(d),va.test(b.charAt(K))?(d=b.charAt(K),K++):(d=q,0===ea&&l(ma));else c=q;if(c!==q)if(46===b.charCodeAt(K)?(d=qa,K++):(d=q,0===ea&&l(Ca)),d!==q){c=[];va.test(b.charAt(K))?(d=b.charAt(K),K++):(d=q,0===ea&&l(ma));if(d!==q)for(;d!==q;)c.push(d),va.test(b.charAt(K))?(d=b.charAt(K),K++):(d=q,0===ea&&l(ma));else c=q;c!==q?(pa=a,a=c=parseFloat(b.substring(pa,
K))):(K=a,a=q)}else K=a,a=q;else K=a,a=q;if(a===q){ea++;a=K;c=[];va.test(b.charAt(K))?(d=b.charAt(K),K++):(d=q,0===ea&&l(ma));if(d!==q)for(;d!==q;)c.push(d),va.test(b.charAt(K))?(d=b.charAt(K),K++):(d=q,0===ea&&l(ma));else c=q;c!==q&&(pa=a,c=parseInt(b.substring(pa,K),10));a=c;ea--;a===q&&(c=q,0===ea&&l(ua))}ea--;a===q&&(c=q,0===ea&&l(sa));return a}function r(){var a,c,d;a=K;c=p();c!==q?(37===b.charCodeAt(K)?(d=gb,K++):(d=q,0===ea&&l(x)),d!==q?(pa=a,a=c/100):(K=a,a=q)):(K=a,a=q);return a}function t(){var a,
c;ea++;a=K;b.substr(K,3)===Wa?(c=Wa,K+=3):(c=q,0===ea&&l(ub));c!==q&&(pa=a,c=1);a=c;a===q&&(a=K,b.substr(K,4)===Ka?(c=Ka,K+=4):(c=q,0===ea&&l(eb)),c!==q&&(pa=a,c=.9),a=c,a===q&&(a=K,b.substr(K,3)===ya?(c=ya,K+=3):(c=q,0===ea&&l(Fb)),c!==q&&(pa=a,c=180/Math.PI),a=c,a===q&&(a=K,b.substr(K,4)===vb?(c=vb,K+=4):(c=q,0===ea&&l(rb)),c!==q&&(pa=a,c=1/360),a=c)));ea--;a===q&&(c=q,0===ea&&l(Ia));return a}function u(){var a,c,d;ea++;a=K;c=p();c!==q?(d=v(),d!==q?(pa=a,a=c*d):(K=a,a=q)):(K=a,a=q);a===q&&(a=K,
48===b.charCodeAt(K)?(c=Va,K++):(c=q,0===ea&&l(tb)),c!==q?(d=v(),d===q&&(d=null),d!==q?(pa=a,a=0):(K=a,a=q)):(K=a,a=q));ea--;a===q&&(c=q,0===ea&&l(Pb));return a}function v(){var a,c;a=K;b.substr(K,2)===Ob?(c=Ob,K+=2):(c=q,0===ea&&l(ob));c!==q&&(pa=a,c=1);a=c;a===q&&(a=K,b.substr(K,2)===ib?(c=ib,K+=2):(c=q,0===ea&&l(wb)),c!==q&&(pa=a,c=96/2.54),a=c,a===q&&(a=K,b.substr(K,2)===Qb?(c=Qb,K+=2):(c=q,0===ea&&l(Rb)),c!==q&&(pa=a,c=96/2.54/10),a=c,a===q&&(a=K,81===b.charCodeAt(K)?(c=bc,K++):(c=q,0===ea&&
l(hc)),c!==q&&(pa=a,c=96/2.54/40),a=c,a===q&&(a=K,b.substr(K,2)===cc?(c=cc,K+=2):(c=q,0===ea&&l(Xa)),c!==q&&(pa=a,c=96),a=c,a===q&&(a=K,b.substr(K,2)===Gb?(c=Gb,K+=2):(c=q,0===ea&&l(dc)),c!==q&&(pa=a,c=16),a=c,a===q&&(a=K,b.substr(K,2)===Xb?(c=Xb,K+=2):(c=q,0===ea&&l(yc)),c!==q&&(pa=a,c=96/73),a=c))))));return a}function z(){var a;Zb.test(b.charAt(K))?(a=b.charAt(K),K++):(a=q,0===ea&&l(Mb));return a}function w(){var a,c;ea++;a=[];Nb.test(b.charAt(K))?(c=b.charAt(K),K++):(c=q,0===ea&&l(xb));for(;c!==
q;)a.push(c),Nb.test(b.charAt(K))?(c=b.charAt(K),K++):(c=q,0===ea&&l(xb));ea--;a===q&&(c=q,0===ea&&l(Tb));return a}a=void 0!==a?a:{};var q={},y={start:d},A=d,B=e("none"),C="none",F=m("none",!1),H=e("blur()"),I="blur(",G=m("blur(",!1),J=")",E=m(")",!1),L=e("brightness()"),M="brightness(",N=m("brightness(",!1),Q=e("contrast()"),R="contrast(",W=m("contrast(",!1),O=e("drop-shadow()"),U="drop-shadow(",P=m("drop-shadow(",!1),ba=e("grayscale()"),V="grayscale(",T=m("grayscale(",!1),X=e("hue-rotate()"),Y=
"hue-rotate(",da=m("hue-rotate(",!1),fa=e("invert()"),ga="invert(",ka=m("invert(",!1),la=e("opacity()"),ia="opacity(",Z=m("opacity(",!1),oa=e("saturate()"),aa="saturate(",na=m("saturate(",!1),ja=e("sepia()"),ta="sepia(",ra=m("sepia(",!1),xa=e("\x3cnumber-percentage\x3e"),ua=e("\x3cinteger\x3e"),va=/^[0-9]/,ma=h([["0","9"]],!1,!1),sa=e("\x3cnumber\x3e"),qa=".",Ca=m(".",!1),ha=e("\x3csignedNumber\x3e"),Sa=/^[+\-]/,nb=h(["+","-"],!1,!1),gb="%",x=m("%",!1),hb=e("\x3cangle\x3e"),Va="0",tb=m("0",!1),Ia=
e("\x3cunit\x3e"),Wa="deg",ub=m("deg",!1),Ka="grad",eb=m("grad",!1),ya="rad",Fb=m("rad",!1),vb="turn",rb=m("turn",!1),Pb=e("\x3clength\x3e"),Ob="px",ob=m("px",!1),ib="cm",wb=m("cm",!1),Qb="mm",Rb=m("mm",!1),bc="Q",hc=m("Q",!1),cc="in",Xa=m("in",!1),Gb="pc",dc=m("pc",!1),Xb="pt",yc=m("pt",!1),oc="#",pc=m("#",!1),kb="rgba(",Sb=m("rgba(",!1),bb=",",cb=m(",",!1),Lb="rgb(",ec=m("rgb(",!1),Zb=/^[0-9a-fA-F]/,Mb=h([["0","9"],["a","f"],["A","F"]],!1,!1),Tb=e("whitespace"),Nb=/^[ \t\n\r]/,xb=h([" ","\t","\n",
"\r"],!1,!1),fc=e("\x3cnamed-color\x3e"),kc=/^[a-z]/,gc=h([["a","z"]],!1,!1),K=0,pa=0,zb=[{line:1,column:1}],fb=0,Ub=[],ea=0,Ab;if("startRule"in a){if(!(a.startRule in y))throw Error("Can't start parsing from rule \""+a.startRule+'".');A=y[a.startRule]}var qc={transparent:[0,0,0,0],black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,
0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255],aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],
darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,
144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,
255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],
mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,
213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rebeccapurple:[102,51,153],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,
191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]},ud=new Set(Object.keys(qc));Ab=A();if(Ab!==q&&K===b.length)return Ab;Ab!==q&&K<b.length&&l({type:"end"});throw function(a,b,c){return new n(n.buildMessage(a,b),a,b,c)}(Ub,fb<b.length?b.charAt(fb):null,fb<b.length?g(fb,fb+1):g(fb,fb));}}})},"esri/views/layers/support/Transition":function(){define("require exports tslib ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4".split(" "),
function(n,b,a,m,h,e){return function(b){function f(){var a=null!==b&&b.apply(this,arguments)||this;a.from=null;a.to=null;a.duration=4E3;a.repeat=!0;a.done=!1;return a}a.__extends(f,b);l=f;f.prototype.getColorMatrix=function(){this.done=!1;if(null==this._lastTime)this._currentStep=0,this._lastTime=Date.now();else{var a=this._lastTime,b=Date.now();this._currentStep+=b-a;2147483647<=this._currentStep&&(this._currentStep=0);this._lastTime=b}var a=this._currentStep%this.duration/(this.duration/2),a=1>=
a?a:2-a,b=this.from.getColorMatrix(),f=this.to.getColorMatrix();e.mat4.multiplyScalar(b,b,1-a);e.mat4.multiplyScalar(f,f,a);!this.repeat&&this._currentStep>=this.duration&&(this.done=!0);return e.mat4.add(b,b,f)};f.prototype.getOpacity=function(){throw Error("No getOpacity definition for Transition");};f.prototype.clone=function(){var a=new l({from:this.from.clone(),to:this.to.clone(),duration:this.duration});a._lastTime=this._lastTime;a._currentStep=this._currentStep;return a};var l;a.__decorate([h.property()],
f.prototype,"from",void 0);a.__decorate([h.property()],f.prototype,"to",void 0);a.__decorate([h.property({type:Number})],f.prototype,"duration",void 0);a.__decorate([h.property({type:Boolean})],f.prototype,"repeat",void 0);return f=l=a.__decorate([h.subclass("esri.views.layers.support.Transition")],f)}(m)})},"esri/views/layers/support/popupUtils":function(){define("require exports tslib @dojo/framework/shim/array ../../../core/maybe ../../../layers/support/fieldUtils".split(" "),function(n,b,a,m,
h,e){Object.defineProperty(b,"__esModule",{value:!0});b.getRequiredFields=function(b,g){void 0===g&&(g=b.popupTemplate);return a.__awaiter(this,void 0,void 0,function(){var f,d,c,k,n,r,t,u,v;return a.__generator(this,function(l){switch(l.label){case 0:return h.isSome(g)?[4,g.getRequiredFields(b.fields)]:[2,[]];case 1:return f=l.sent(),d=g.lastEditInfoEnabled,c=b.objectIdField,k=b.typeIdField,n=b.globalIdField,r=b.relationships,m.includes(f,"*")?[2,["*"]]:d?[4,e.getFeatureEditFields(b)]:[3,3];case 2:return u=
l.sent(),[3,4];case 3:u=[],l.label=4;case 4:return t=u,v=e.fixFields(b.fields,a.__spreadArrays(f,t)),k&&v.push(k),v&&c&&e.hasField(b.fields,c)&&-1===v.indexOf(c)&&v.push(c),v&&n&&e.hasField(b.fields,n)&&-1===v.indexOf(n)&&v.push(n),r&&r.forEach(function(a){a=a.keyField;v&&a&&e.hasField(b.fields,a)&&-1===v.indexOf(a)&&v.push(a)}),[2,v]}})})};b.getFetchPopupTemplate=function(a,b){return a.popupTemplate?a.popupTemplate:h.isSome(b)&&b.defaultPopupTemplateEnabled&&h.isSome(a.defaultPopupTemplate)?a.defaultPopupTemplate:
null}})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("require exports tslib ../../../core/arrayUtils ../../../core/arrayUtils ../../../core/asyncUtils ../../../core/Collection ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/screenUtils ../../../core/SetUtils ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f32 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ../../../layers/support/CodedValue ../../../layers/support/domains ../../../layers/support/fieldUtils ../../../layers/support/PromiseQueue ../../../symbols/support/unitConversionUtils ./LayerView3D ./PointCloudWorkerHandle ./i3s/I3SUtil ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointCloudWorkerUtil ./i3s/PointGraphic ./i3s/PointRenderer ./support/layerViewUpdatingProperties ./support/PopupSceneLayerView ../support/geometryUtils ../support/orientedBoundingBox ../support/projectionUtils ../../layers/LayerView ../../support/layerViewUtils ../../support/Scheduler".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L,M,N,Q,R,W,O,U,P,ba,V,T){var X=g.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),Y=O.plane.create();n=function(b){function g(){var a=null!==b&&b.apply(this,arguments)||this;a.maximumPointCount=4E6;a.slicePlaneEnabled=!1;a._renderer=null;a._rendererAdded=!1;a._renderedNodes=new Set;a._nodeScales=new Map;a._updateViewNeeded=!0;a._lodFactor=1;a._maxLoggedBoxWarnings=5;a._pageMultiplier=1;a._nodeLoadEpoch=0;a._indexQueue=[];
a._workQueue=[];a._idleQueue=new C.default;a._indexPagesLoading=new Map;a._loadingNodes=new Map;a._recalcWork=!0;a._layerIsVisible=!1;a._codedDomainPopulationPromise=null;a._codedDomainPopulationAbortController=null;a._totalWork=0;a._index=null;a._loadingInitNodePage=!1;a._nodeIdArray=[];return a}a.__extends(g,b);Object.defineProperty(g.prototype,"pointScale",{get:function(){var a=L.getSplatSizeAlgorithm(this.layer&&this.layer.renderer);return a&&null!=a.scaleFactor?a.scaleFactor:1},enumerable:!0,
configurable:!0});Object.defineProperty(g.prototype,"useRealWorldSymbolSizes",{get:function(){var a=L.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return a&&null!=a.useRealWorldSymbolSizes?a.useRealWorldSymbolSizes:!1},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"pointSize",{get:function(){var a=L.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return a&&null!=a.size?a.size:0},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"inverseDensity",
{get:function(){return this.layer&&this.layer.renderer?96/this.layer.renderer.pointsPerInch:5},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"availableFields",{get:function(){var a=L.getRendererInfo(this.layer),b=new Set;a.primaryAttribute&&b.add(a.primaryAttribute.name);a.modulationAttribute&&b.add(a.primaryAttribute.name);if(a=L.getFilterInfo(this.layer))for(var c=0;c<a.length;c++)b.add(a[c].attributeInfo.name);if(this.layer.outFields)for(a=0,c=B.unpackFieldNames(this.layer.fields,
this.layer.outFields);a<c.length;a++)b.add(c[a]);return k.valuesOfSet(b)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_clippingBox",{get:function(){if(!this.view||!this.view.clippingArea)return null;var a=z.create();return P.extentToBoundingBox(this.view.clippingArea,a,this.view.renderSpatialReference)?a:null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_elevationOffset",{get:function(){var a=this.layer&&this.layer.elevationInfo;if(a&&"absolute-height"===
a.mode){var b=r.getMetersPerVerticalUnitForSR(this.layer.spatialReference),c=F.getMetersPerUnit(a.unit);return l.unwrapOr(a.offset,0)*c/b}return 0},enumerable:!0,configurable:!0});g.prototype.initialize=function(){var a=this,b=this.view.resourceController,c=b.scheduler;this._worker=new I.PointCloudWorkerHandle(c);this.addResolvingPromise(this._worker.promise);this._tmpPoint=q.makeDehydratedPoint(0,0,0,this.layer.spatialReference);G.checkPointCloudLayerValid(this.layer);G.checkPointCloudLayerCompatibleWithView(this.layer,
this.view);this._streamDataRequester=b.createStreamDataRequester(2);this._initRenderer();var b=this._initNodePages(),d=this.view.resourceController.memoryController;this._memCache=d.getMemCache(this.layer.uid);this.updatingHandles.add(this,"_clippingBox",function(){return a._setUpdateViewNeeded()},2);this.updatingHandles.add(this,"_elevationOffset",function(){return a._elevationOffsetChanged()},2);this.updatingHandles.add(this.layer,"renderer",function(){return a._rendererChanged()},2);this.updatingHandles.add(this.layer,
"filters",function(){return a._reload()},2);this.updatingHandles.add(this.layer,"outFields",function(){return a._reload()},2);this.updatingHandles.add(this.layer,"scaleRangeId",function(){return a._setUpdateViewNeeded()});this.updatingHandles.add(this,"clippingArea",function(){return a._setUpdateViewNeeded()},2);this.updatingHandles.add(this.view.state,"camera",function(){return a._setUpdateViewNeeded()});this.handles.add([this.view.basemapTerrain.on("scale-change",function(b){return a._scaleUpdateHandler(b)}),
d.events.on("quality-changed",function(){return a._setUpdateViewNeeded()})]);this.addResolvingPromise(b);this.when(function(){a.handles.add([c.registerTask(T.Task.POINT_CLOUD_LAYER,function(b){return a._process(b)},function(){return a._needsUpdate()}),c.registerIdleStateCallbacks(function(){return a._idleBegin()},function(){return a._idleEnd()}),a.updatingHandles.add(a,"suspended",function(b){b?a._clearNodeState():a._setUpdateViewNeeded()},2)])},function(){a.updatingHandles.removeAll();a.handles.removeAll()})};
g.prototype._setUpdateViewNeeded=function(){this._updateViewNeeded=!0;this._updateLoading()};g.prototype.destroy=function(){this.cancelLoading();this._worker&&(this._worker.destroy(),this._worker=null);this._destroyRenderer();this._memCache.destroy();this._memCache=null;this._codedDomainPopulationAbortController&&(this._codedDomainPopulationAbortController.abort(),this._codedDomainPopulationAbortController=null);this._codedDomainPopulationPromise=null};g.prototype._initRenderer=function(){var a=this;
this._renderer=new Q.PointRenderer({createGraphic:function(b,c,d){return a._createGraphic(b,c,d)}});this._renderer.layerUid=this.layer.uid;this.updatingHandles.add(this,"_clippingBox",function(b){return a._renderer.clippingBox=b},2);this.updatingHandles.add(this,"suspended",function(b){return a._setPointsVisible(!b)},2);this.updatingHandles.add(this,"pointScale",function(b){return a._renderer.scaleFactor=b},2);this._renderer.minSizePx=Math.sqrt(2);this.updatingHandles.add(this,"useRealWorldSymbolSizes",
function(b){return a._renderer.useRealWorldSymbolSizes=b},2);this.updatingHandles.add(this,"pointSize",function(b){var d=c.pt2px(b);a._renderer.size=b;a._renderer.sizePx=d},2);this.updatingHandles.add(this,"slicePlaneEnabled",function(b){return a._renderer.slicePlane=b},2);this.updatingHandles.add(this,"inverseDensity",function(){return a._setUpdateViewNeeded()},2);this.updatingHandles.add(this,"maximumPointCount",function(){return a._setUpdateViewNeeded()},2);this.updatingHandles.add(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",
function(b){a._lodFactor=b;a._setUpdateViewNeeded()},2)};g.prototype._destroyRenderer=function(){this._renderer.removeAll();this._setPointsVisible(!1)};g.prototype._createGraphic=function(a,b,c){var d=l.isSome(a.pointIdFilterMap)?a.pointIdFilterMap[b]:b;c=this.view.computeMapPointFromVec3d(c);var e=this._createGraphicAttributes(a,d);return new N.PointGraphic({pointCloudMetadata:{nodeId:a.id,pointIndexInNode:b,attributePointIndexInNode:d,epoch:this._nodeLoadEpoch},geometry:c,attributes:e,layer:this.layer,
sourceLayer:this.layer})};g.prototype._createGraphicAttributes=function(a,b){var c={},d=0;for(a=a.attributes;d<a.length;d++){var e=a[d];this._encodeGraphicAttribute(e.attributeInfo,e.values,b,c)}return c};g.prototype._encodeGraphicAttribute=function(a,b,c,d){var e=a.storageInfo&&a.storageInfo.attributeValues,f=e?e.valuesPerElement:1;if(1===f)d[a.name]=b[c];else if("UInt8"===e.valueType&&4>=f){for(var e=0,g=c*=f;g<c+f;g++)e=(e<<8)+b[g];d[a.name]=e}else d[a.name]=void 0};g.prototype._setPointsVisible=
function(a){a&&!this._rendererAdded?(this.view._stage.addRenderPlugin([4],this._renderer),this._rendererAdded=!0):!a&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)};g.prototype._rendererChanged=function(){this._renderer.useFixedSizes=L.rendererUsesFixedSizes(this.layer.renderer);this._reload()};g.prototype._reload=function(){this._clearNodeState();this._memCache.clear();this._setUpdateViewNeeded()};g.prototype._elevationOffsetChanged=function(){this._clearNodeState();
this._memCache.clear();this._initNodePages()};g.prototype._scaleUpdateHandler=function(a){var b=this;this.layer.minScale||this.layer.maxScale?P.boundingRectToBoundingRect(a.extent,a.spatialReference,da,this.layer.spatialReference)&&(this._nodeScales.forEach(function(c,d){b._renderedNodes.has(d)?(c=b._index.getNode(d),w.containsPoint(da,c.obb.center)&&b._nodeScales.set(d,a.scale)):b._nodeScales.delete(d)}),this._setUpdateViewNeeded()):this._nodeScales.clear()};g.prototype.displayNodes=function(a){this._workQueue=
J.nodeDiff(m.keysOfSet(this._renderedNodes),a,this._index);J.sortFrontToBack(this._workQueue,this.view.state.camera.viewForward,this._index);J.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=0<a.length||this._loadingInitNodePage;this.notifyChange("suspended")};g.prototype.cancelLoading=function(){this._cancelNodeLoading();this._cancelIndexLoading()};g.prototype._cancelNodeLoading=function(){var a=[];
this._loadingNodes.forEach(function(b){return a.push(b.abortController)});this._loadingNodes.clear();for(var b=0;b<a.length;b++)a[b].abort();this._workQueue=[];this._idleQueue.cancelAll();this._totalWork=this._computeWork();this._updateLoading()};g.prototype._updateQueues=function(){var a=this,b=new Set;this._workQueue.forEach(function(a){return a.load.forEach(function(a){return b.add(a)})});var c=[],d=new Map;this._loadingNodes.forEach(function(a,e){b.has(e)?d.set(e,a):c.push(a)});this._loadingNodes=
d;for(var e=0;e<c.length;e++)c[e].abortController.abort();this._workQueue=this._workQueue.filter(function(b){var c=0;for(b=b.load;c<b.length;c++)if(a._loadingNodes.has(b[c]))return a._recalcWork=!0,!1;return!0});this._totalWork=this._computeWork();this._updateLoading()};g.prototype._cancelIndexLoading=function(){this._indexQueue=[];this._indexPagesLoading.forEach(function(a){return a.abortController.abort()});this._indexPagesLoading.clear();this._totalWork=this._computeWork();this._updateLoading()};
g.prototype._clearNodeState=function(){var a=this;this._nodeLoadEpoch++;this._renderedNodes.forEach(function(b){return a._removeFromRenderer(b)});this._cancelNodeLoading()};g.prototype._idleBegin=function(){this._setUpdateViewNeeded()};g.prototype._idleEnd=function(){this._setUpdateViewNeeded()};g.prototype._needsUpdate=function(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||0<this._indexQueue.length||0<this._workQueue.length||0<this._idleQueue.length};g.prototype._process=
function(a){var b=this;if(this.suspended)this._updateViewNeeded&&(this._updateViewNeeded=!1,a=this._isRootNodeVisible(),a!==this._layerIsVisible&&(this._layerIsVisible=a,this.notifyChange("suspended")),this._updateLoading());else{for(a.run(function(){return b._updateWorkQueues()});0<this._indexQueue.length&&a.run(function(){return b._processIndexQueue()}););for(this._processWorkQueue(a);0<this._idleQueue.length&&a.run(function(){return b._idleQueue.process()}););}};g.prototype._processIndexQueue=
function(){var a=this,b=this._indexQueue.shift(),c=this._loadNodePage(b);this._indexPagesLoading.set(b,c);c.promise.then(function(c){a._index.addPage(b,c,a._elevationOffset);a._setUpdateViewNeeded()}).then(function(){a._indexPagesLoading.delete(b)},function(){a._indexPagesLoading.delete(b)});return!0};g.prototype._processWorkQueue=function(a){for(;!a.done;){var b=this._scheduleWorkEntry();if(l.isNone(b))break;this._processWorkEntry(b);a.madeProgress()}};g.prototype._scheduleWorkEntry=function(){for(var a=
this,b=this._workQueue.length;b--;){var c=this._workQueue.shift();if(h.find(c.remove,function(b){return!a._renderedNodes.has(b)}))this._workQueue.push(c);else return c}return null};g.prototype._processWorkEntry=function(a){var b=this;if(0===a.load.length)for(var c=0,e=a.remove;c<e.length;c++)this._removeFromRenderer(e[c]);else d.all(a.load.map(function(a){var c=d.createAbortController(),e=b._memCache.pop(a.toString());l.isSome(e)?b._loadingNodes.set(a,{abortController:c,promise:d.resolve(e)}):b._loadingNodes.has(a)||
b._loadingNodes.set(a,{abortController:c,promise:b.loadNode(a,c.signal)});return b._loadingNodes.get(a).promise})).then(function(c){for(var d=0;d<a.load.length;d++)if(c[d]){var e=b._setupRendererData(a.load[d],c[d]);b._addToRenderer(e)}c=0;for(d=a.remove;c<d.length;c++)b._removeFromRenderer(d[c])}).catch(function(){}).then(function(){for(var c=0,d=a.load;c<d.length;c++)b._loadingNodes.delete(d[c]);b._updateLoading();b._recalcWork&&0===b._idleQueue.length&&0===b._indexQueue.length&&0===b._loadingNodes.size&&
(b._recalcWork=!1,b._setUpdateViewNeeded())}),this._updateLoading()};g.prototype.populateClassCodeCodedDomain=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var d,f,g,h;return a.__generator(this,function(a){switch(a.label){case 0:return d=this.layer.fieldsIndex.get("CLASS_CODE"),!d||d.domain||-1===b.indexOf(d.name)?[2]:[4,e.result(this.layer.queryCachedStatistics("CLASS_CODE",{signal:c}))];case 1:f=a.sent();if(!1===f.ok)return[2];h=(g=f.value)&&g.labels&&g.labels.labels;if(!h||!Array.isArray(h))return[2];
d.domain=new A.CodedValueDomain({name:"CLASS_CODE",codedValues:h.map(function(a){return new y.default({code:a.value,name:a.label})})});return[2]}})})};g.prototype.prepareFetchPopupFeatures=function(b){return a.__awaiter(this,void 0,void 0,function(){var c=this;return a.__generator(this,function(a){this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=d.createAbortController(),this._codedDomainPopulationPromise=this.populateClassCodeCodedDomain(b,this._codedDomainPopulationAbortController.signal).then(function(){c._codedDomainPopulationAbortController=
null}));return[2,this._codedDomainPopulationPromise]})})};g.prototype.whenGraphicAttributes=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var f,g,h,k,l,m=this;return a.__generator(this,function(n){switch(n.label){case 0:return f=this._splitGraphicsPerNode(b),g=this.layer.attributeStorageInfo,h=c.map(function(a){return L.getAttributeInfo(g,a)}),k=function(b,c){return a.__awaiter(m,void 0,void 0,function(){var d,f=this;return a.__generator(this,function(g){switch(g.label){case 0:return d=
this._index.getNode(c),[4,e.forEach(h,function(c){return a.__awaiter(f,void 0,void 0,function(){var e,f,g,h,k,l;return a.__generator(this,function(a){switch(a.label){case 0:return c.useElevation?[4,this._loadElevationAttributeFromGeometry(d.resourceId)]:[3,2];case 1:return f=a.sent(),[3,4];case 2:return[4,this._loadAndParseAttribute(d,c)];case 3:f=a.sent(),a.label=4;case 4:e=f;if(!e)return[2];g=0;for(h=b;g<h.length;g++)k=h[g],this._isValidPointGraphic(k)&&(l=k.pointCloudMetadata.attributePointIndexInNode,
this._encodeGraphicAttribute(c,e,l,k.attributes));return[2]}})})})];case 1:return g.sent(),[2]}})})},l=[],f.forEach(function(a,b){l.push(k(a,b))}),[4,d.eachAlways(l)];case 1:return n.sent(),[2,b]}})})};g.prototype._isValidPointGraphic=function(a){return a instanceof N.PointGraphic&&a.pointCloudMetadata&&a.pointCloudMetadata.epoch===this._nodeLoadEpoch};g.prototype._splitGraphicsPerNode=function(a){for(var b=new Map,c=0;c<a.length;c++){var d=a[c];if(this._isValidPointGraphic(d)){var e=d.pointCloudMetadata,
f=b.get(e.nodeId);f?f.push(d):b.set(e.nodeId,[d])}}return b};g.prototype._loadAndParseAttribute=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var d;return a.__generator(this,function(a){switch(a.label){case 0:return[4,this._loadAttribute(b.resourceId,c,null)];case 1:return d=a.sent(),[2,l.isSome(d)?M.getAttributeValues({attributeInfo:c,buffer:d},null,b.vertexCount):null]}})})};g.prototype._loadElevationAttributeFromGeometry=function(b){return a.__awaiter(this,void 0,void 0,function(){var c,
d,e,f;return a.__generator(this,function(a){switch(a.label){case 0:return c=this.layer.store.defaultGeometrySchema,e=M.readGeometry,f=[c],[4,this._loadGeometry(b,null)];case 1:return d=e.apply(void 0,f.concat([a.sent()])),[2,M.elevationFromPositions(d,d.length/3)]}})})};g.prototype.highlight=function(a){var b=this;if(!a)return{remove:function(){},pause:function(){},resume:function(){}};a=f.isCollection(a)?a.toArray():Array.isArray(a)?a:[a];return this._renderer.highlight(a.map(function(a){return b._graphicToPointDefinition(a)}))};
g.prototype._graphicToPointDefinition=function(a){if(!this._isValidPointGraphic(a))return null;var b=a.pointCloudMetadata;a=b.nodeId;b=b.pointIndexInNode;return null!=a&&null!=b?{nodeId:a,pointId:b}:null};g.prototype._computeWork=function(){for(var a=0,b=0,c=this._workQueue;b<c.length;b++)var d=c[b],a=a+(d.load.length+d.remove.length);a+=this._loadingNodes.size;a+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;a+=this._loadingInitNodePage?100:0;return a+=this._updateViewNeeded?
100:0};Object.defineProperty(g.prototype,"updatingProgressValue",{get:function(){if(this.suspended)return this._updateViewNeeded?0:1;var a=this._computeWork();return 1-Math.min(this._totalWork,a)/this._totalWork},enumerable:!0,configurable:!0});g.prototype._updateLoading=function(){this.notifyChange("updating");this.notifyChange("updatingProgressValue")};g.prototype.canResume=function(){return b.prototype.canResume.call(this)&&this._layerIsVisible};g.prototype.isUpdating=function(){return this.suspended?
this._updateViewNeeded:0<this._computeWork()};g.prototype._initNodePages=function(){var a=this,b=this.layer.store.index;this._index=new E(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,b.nodesPerPage||b.nodePerIndexBlock);this._cancelIndexLoading();this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");this._updateLoading();this._pageMultiplier=null!=b.nodesPerPage?1:b.nodePerIndexBlock;
return this._loadNodePage(0).promise.then(function(b){a._index.addPage(0,b,a._elevationOffset);a._loadingInitNodePage=!1;a._setUpdateViewNeeded()})};g.prototype._loadNodePage=function(a){var b=this,c=d.createAbortController();return{promise:this._requestJSON(this.baseUrl+"/nodepages/"+a*this._pageMultiplier,c.signal).then(function(c){return c.nodes.map(function(c,d){return{resourceId:null!=c.resourceId?c.resourceId:a*b._index.pageSize+d,obb:c.obb,firstChild:c.firstChild,childCount:c.childCount,vertexCount:null!=
c.vertexCount?c.vertexCount:c.pointCount,lodThreshold:null!=c.lodThreshold?c.lodThreshold:c.effectiveArea}})}),abortController:c}};g.prototype._updateWorkQueues=function(){if(!this._updateViewNeeded)return!1;for(var a=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor(),b=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor(),c=this._computeNodesForMinimumDensity(a),d=this._computePointCount(c),e=Math.sqrt(d/(.75*b));d>b;)a*=e,c=this._computeNodesForMinimumDensity(a),d=this._computePointCount(c),
e=Math.sqrt(2);this.displayNodes(c);this._updateViewNeeded=!1;this._updateLoading();return!0};g.prototype._computePointCount=function(a){for(var b=0,c=0;c<a.length;c++){var d=this._index.getNode(a[c]);d&&(b+=d.vertexCount)}return b};g.prototype._getLodMemoryFactor=function(){return this.view.resourceController.memoryController.memoryFactor};g.prototype._isRootNodeVisible=function(){var a=!1;this._traverseVisible({frustumPlanes:this.view.state.camera.frustum.planes,clippingBox:this._clippingBox},{predicate:function(b,
c,d){a=d;return!1},pageMiss:function(){}});return a};g.prototype._computeNodesForMinimumDensity=function(a){var b=this,c=this.view.state.camera,d=c.frustum,e=this._clippingBox,f=c.viewForward,g=u.vec3.dot(f,c.eye),h=O.plane.fromNormalAndOffset(f,-g,Y),k=c.perScreenPixelRatio/2,l=a*a,m=this._nodeIdArray;m.length=0;a=V.extractSafeScaleBounds(this.layer);var n=a.minScale,p=a.maxScale,q=0===n&&0===p?function(a){return m.push(a)}:function(a){var c=b._getScale(a);V.scaleBoundsPredicate(c,n,p)&&m.push(a)};
this._traverseVisible({frustumPlanes:d.planes,clippingBox:e},{predicate:function(a,c,d){if(!d)return!1;if(0===c.childCount)return q(a),!1;d=b._index.getRenderObb(a);return b._computeAveragePixelArea(d,c.lodThreshold,c.vertexCount,h,k)<=l?(q(a),!1):!0},pageMiss:function(a,c){q(a);0>b._indexQueue.indexOf(c)&&b._indexQueue.push(c)}});return m};g.prototype._getScale=function(a){var b=this._nodeScales.get(a);null==b&&(b=this._index.getNode(a).obb.center,this._tmpPoint.x=b[0],this._tmpPoint.y=b[1],this._tmpPoint.z=
b[2],b=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(a,b));return b};g.prototype._computeAveragePixelArea=function(a,b,c,d,e){a=Math.max(1E-7,U.minimumDistancePlane(a,d));return b/(a*a)/(4*e*e)/c};g.prototype.loadNode=function(a,b){try{return this.loadNodeAsync(a,b)}catch(Z){throw d.isAbortError(Z)||X.error(Z),Z;}};g.prototype.loadAdditionalUserAttributes=function(b,c,e){return a.__awaiter(this,void 0,void 0,function(){var f,g,h,m,n,p,q,r,t,u;return a.__generator(this,function(a){switch(a.label){case 0:f=
this.layer.outFields;if(!f)return[2,[]];g=B.unpackFieldNames(this.layer.fields,f);h=k.SetFromValues(b.map(function(a){return l.isSome(a)?a.name:null}));m=this.layer.attributeStorageInfo;n=[];p=0;for(q=g;p<q.length;p++)r=q[p],h.has(r)||(t=L.getAttributeInfo(m,r))&&n.push(c(t));return[4,d.eachAlwaysValues(n)];case 1:return u=a.sent(),d.throwIfAborted(e),[2,l.mapSome(u,function(a){return a})]}})})};g.prototype.loadNodeAsync=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var e,f,g,h,k,
m=this;return a.__generator(this,function(n){e=this._index.getNode(b);f=L.getRendererInfo(this.layer);g=L.getFilterInfo(this.layer);h=e.resourceId;k=function(b){return a.__awaiter(m,void 0,void 0,function(){var d;return a.__generator(this,function(a){switch(a.label){case 0:return l.isNone(b)?[2,null]:b.useElevation?[2,{attributeInfo:b,buffer:null}]:[4,this._loadAttribute(h,b,c)];case 1:return d=a.sent(),[2,l.isSome(d)?{attributeInfo:b,buffer:d}:null]}})})};return[2,this._idleQueue.push(function(){return a.__awaiter(m,
void 0,void 0,function(){var e,l,m,n,p,q,r,t,u,v,w,A,y,z,B;return a.__generator(this,function(x){switch(x.label){case 0:return e=this._loadGeometry(h,c),l=f.primaryAttribute,m=f.modulationAttribute,n=k(l),p=k(m),q=g.map(function(a){return a.attributeInfo}),r=q.map(function(a){return k(a)}),t=this.loadAdditionalUserAttributes(a.__spreadArrays([l,m],q),k,c),[4,d.all([e,n,p,d.all(r),t])];case 1:return u=x.sent(),v=u[0],w=u[1],A=u[2],y=u[3],z=u[4],d.throwIfAborted(c),B={geometryBuffer:v,primaryAttributeData:w,
modulationAttributeData:A,filterAttributesData:y,userAttributesData:z,schema:this.layer.store.defaultGeometrySchema,rendererInfo:f,filterInfo:g,obb:this._index.getRenderObb(b),elevationOffset:this._elevationOffset,inSR:this.layer.spatialReference.toJSON(),outSR:this.view.renderCoordsHelper.spatialReference.toJSON()},[2,this._worker.invoke(B,c)]}})})})]})})};g.prototype._loadGeometry=function(b,c){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){return[2,this._requestBinary(this.baseUrl+
"/nodes/"+b+"/geometries/0",c)]})})};g.prototype._loadAttribute=function(b,c,d){return a.__awaiter(this,void 0,void 0,function(){var e;return a.__generator(this,function(a){if(l.isNone(c)||!c.storageInfo)return[2,null];e=c.storageInfo.key;return[2,this._requestBinary(this.baseUrl+"/nodes/"+b+"/attributes/"+e,d)]})})};g.prototype._requestJSON=function(a,b){return this._streamDataRequester.request(a,"json",{query:{f:"json"},signal:b})};g.prototype._requestBinary=function(a,b){return this._streamDataRequester.request(a,
"binary",{signal:b})};g.prototype._removeFromRenderer=function(a){if(this._renderedNodes.has(a)){var b=this._renderer.removeNode(a);this._renderedNodes.delete(a);this._nodeScales.delete(a);this._memCache.put(b.id.toString(),b,5*b.coordinates.length+128)}};g.prototype._addToRenderer=function(a){this._renderedNodes.has(a.id)||(this._renderedNodes.add(a.id),this._renderer.addNode(a))};g.prototype._setupRendererData=function(a,b){var c=this._index.getNode(a),d=Math.sqrt(c.lodThreshold/c.vertexCount),
e=this._index.getRenderObb(a);if(Q.PointRenderer.isInstanceOfNode(b))return b.splatSize=d,b.obb=e,b.origin=v.vec3f32.clone(b.obb.center),b;if(b.obb.halfSize[0]>1.001*e.halfSize[0]||b.obb.halfSize[1]>1.001*e.halfSize[1]||b.obb.halfSize[2]>1.001*e.halfSize[2]){if(0<this._maxLoggedBoxWarnings){var f=function(a){return"["+a.halfSize[0]+", "+a.halfSize[1]+", "+a.halfSize[2]+"]"};X.warn("Node "+a+" reported bounding box too small. got "+f(e)+" but points cover "+f(b.obb));0===--this._maxLoggedBoxWarnings&&
X.warn("  Too many bounding box errors, stopping reporting for this layer.")}this._index.setRenderObb(a,b.obb)}return{id:a,coordinates:b.points,origin:v.vec3f32.clone(e.center),rgb:b.rgb,attributes:b.attributes,pointIdFilterMap:b.pointIdFilterMap,highlights:null,splatSize:d,obb:e,isLeaf:0===c.childCount}};g.prototype.getUsedMemory=function(){var a=0;this._renderer.forEachNode(function(b){a+=fa;a+=p.estimateSize(b.coordinates);var c=0;for(b=b.attributes;c<b.length;c++){var d=b[c].values;p.isArrayBuffer(d.buffer)&&
(a+=p.estimateSize(d))}});return a};g.prototype.getUnloadedMemory=function(){var a=this,b=this._renderedNodes.size;if(4>b)return 0;for(var c=m.keysOfSet(this._renderedNodes).reduce(function(b,c){return b+a._index.getNode(c).vertexCount}),d=this._loadingNodes.size,e=0;e<this._workQueue.length;e++)d+=this._workQueue[e].load.length,d-=this._workQueue[e].remove.length;if(0>d)return 0;e=d*c/b;b=(this.getUsedMemory()-b*fa)/c;return e*b+d*fa};g.prototype.ignoresMemoryFactor=function(){return!1};Object.defineProperty(g.prototype,
"performanceInfo",{get:function(){var a=this;return{nodes:this._renderedNodes.size,displayedNumberOfFeatures:m.keysOfSet(this._renderedNodes).reduce(function(b,c){return b+a._index.getNode(c).vertexCount},0),maximumNumberOfFeatures:this.maximumPointCount,totalNumberOfFeatures:-1,core:null,"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"test",{get:function(){return{index:this._index,visibleNodes:this._renderedNodes}},enumerable:!0,configurable:!0});a.__decorate([t.property()],g.prototype,"layer",void 0);a.__decorate([t.property({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],g.prototype,"baseUrl",void 0);a.__decorate([t.property({readOnly:!0,dependsOn:["layer.renderer"]})],g.prototype,"pointScale",null);a.__decorate([t.property({readOnly:!0,dependsOn:["layer.renderer"]})],g.prototype,"useRealWorldSymbolSizes",null);a.__decorate([t.property({readOnly:!0,
dependsOn:["layer.renderer"]})],g.prototype,"pointSize",null);a.__decorate([t.property({readOnly:!0,dependsOn:["layer.renderer"]})],g.prototype,"inverseDensity",null);a.__decorate([t.property()],g.prototype,"maximumPointCount",void 0);a.__decorate([t.property({readOnly:!0,dependsOn:["layer.renderer","layer.filters","layer.outFields"]})],g.prototype,"availableFields",null);a.__decorate([t.property({readOnly:!0,dependsOn:["view.clippingArea"]})],g.prototype,"_clippingBox",null);a.__decorate([t.property({readOnly:!0,
dependsOn:["layer.elevationInfo"]})],g.prototype,"_elevationOffset",null);a.__decorate([t.property({type:Boolean})],g.prototype,"slicePlaneEnabled",void 0);a.__decorate([t.property()],g.prototype,"updating",void 0);a.__decorate([t.property(R.updatingProgress)],g.prototype,"updatingProgress",void 0);a.__decorate([t.property({readOnly:!0,dependsOn:["suspended"]})],g.prototype,"updatingProgressValue",null);return g=a.__decorate([t.subclass("esri.views.3d.layers.PointCloudLayerView3D")],g)}(W.PopupSceneLayerView(H.LayerView3D(ba)));
var da=w.create(),fa=160;return n})},"esri/views/3d/layers/PointCloudWorkerHandle":function(){define(["require","exports","tslib","../../../core/maybe","../support/WorkerHandle"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(a){return b.call(this,"PointCloudWorker","transform",a)||this}a.__extends(e,b);e.prototype.getTransferList=function(a){var b=[a.geometryBuffer];m.isSome(a.primaryAttributeData)&&a.primaryAttributeData.buffer&&b.push(a.primaryAttributeData.buffer);
m.isSome(a.modulationAttributeData)&&a.modulationAttributeData.buffer&&b.push(a.modulationAttributeData.buffer);if(m.isSome(a.filterAttributesData))for(var d=0,c=a.filterAttributesData;d<c.length;d++){var e=c[d];m.isSome(e)&&e.buffer&&b.push(e.buffer)}d=0;for(a=a.userAttributesData;d<a.length;d++)e=a[d],e.buffer&&b.push(e.buffer);return b};return e}(h.WorkerHandle);b.PointCloudWorkerHandle=n})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("require exports ../../../../request ../../../../core/arrayUtils ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/wgs84Constants ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/quat ../../../../core/libs/gl-matrix-2/quatf32 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/webMercatorUtils ../../../../tasks/support/Query ./I3SBinaryReader ./I3SProjectionUtil ../support/edgeUtils ../support/symbolColorUtils ../../support/orientedBoundingBox ../../support/projectionUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H){function I(a){return a&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10)}function G(a,b){var c=b[0],d=b[1];b=b[3];var e=a[0]-c,c=c-a[2],f=a[1]-d;a=d-a[3];var d=Math.max(e,c,0),g=Math.max(f,a,0),d=d*d+g*g;return d>b*b?0:0<d?1:-Math.max(e,c,f,a)>b?3:2}function J(a,b,c){var d=[],e=c&&c.missingFields;c=c&&c.originalFields;for(var f=0;f<a.length;f++){for(var g=a[f],h=g.toLowerCase(),k=!1,l=0,m=b;l<m.length;l++){var n=m[l];if(h===n.name.toLowerCase()){d.push(n.name);
k=!0;c&&c.push(g);break}}!k&&e&&e.push(g)}return d}function E(a,b){return a.filter(function(a){return a!==b}).concat([b])}function L(a,b,c,d){b.sort(function(a,b){return a.attributes[c]-b.attributes[c]});var e=b.map(function(a){return a.attributes[c]}),f=[],g=J(d,a.fields,{originalFields:f});return M(a,e,g).then(function(a){for(var c=0;c<b.length;c++){var d=b[c],e=a[c],h={};if(d.attributes)for(var k in d.attributes)h[k]=d.attributes[k];for(var l=0;l<f.length;l++)h[f[l]]=e[g[l]];d.attributes=h}return b})}
function M(a,b,c){var d=a.capabilities.query.maxRecordCount;if(null!=d&&b.length>d)return d=R(b,d),f.all(d.map(function(b){return M(a,b,c)})).then(W);d=new q({objectIds:b,outFields:c,orderByFields:[a.objectIdField]});return a.queryFeatures(d).then(function(a){if(a&&a.features&&a.features.length===b.length)return a.features.map(function(a){return a.attributes});throw new h("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer");})}function N(b,c,d,e,g){for(var h=
[],k=0;k<c.length;k++){var l=c[k];l&&-1!==g.indexOf(l.name)&&h.push({url:b+"/nodes/"+d.resources.attributes+"/attributes/"+l.key+"/0",storageInfo:l})}return f.eachAlways(h.map(function(b){return a(b.url,{responseType:"array-buffer"}).then(function(a){return y.readBinaryAttribute(b.storageInfo,a.data)})})).then(function(a){for(var b=[],c=0;c<e.length;c++){for(var d=e[c],f={},g=0;g<a.length;g++)null!=a[g].value&&(f[h[g].storageInfo.name]=Q(a[g].value,d));b.push(f)}return b})}function Q(a,b){if(!a)return null;
b=a[b];return g.isInt16Array(a)?b===Y?null:b:g.isInt32Array(a)?b===da?null:b:b!==b?null:b}function R(a,b){var c=a.length;b=Math.ceil(c/b);for(var d=[],e=0;e<b;e++)d.push(a.slice(Math.floor(c*e/b),Math.floor(c*(e+1)/b)));return d}function W(a){for(var b=[],c=0;c<a.length;c++)b=b.concat(a[c]);return b}function O(a){var b=new u(I(a.store.indexCRS||a.store.geographicCRS));return b.equals(a.spatialReference)?a.spatialReference:b}function U(a){var b=new u(I(a.store.vertexCRS||a.store.projectedCRS));return b.equals(a.spatialReference)?
a.spatialReference:b}function P(a,b,c){if(!w.canProject(a,b))throw new h("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===c&&a.isGeographic)throw new h("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",{});}function ba(a,b,c){var d=O(a);a=U(a);P(d,b,c);P(a,b,c)}function V(a,b,c,d,e,f){void 0===e&&(e=0);void 0===f&&(f=!1);if(d!==ga||f)a===
c?(c.center[2]+=e,H.bufferToBuffer(c.center,b,0,c.center,d,0,1)):(r.vec3.set(c.center,a.center[0],a.center[1],a.center[2]+e),H.bufferToBuffer(c.center,b,0,c.center,d,0,1),k.quat.copy(c.quaternion,a.quaternion),r.vec3.copy(c.halfSize,a.halfSize));else if(b.isGeographic)d=1+Math.max(0,e)/(l.wgs84Radius+a.center[2]),r.vec3.set(c.center,a.center[0],a.center[1],a.center[2]+e),H.bufferToBuffer(c.center,b,0,c.center,ga,0,1),k.quat.copy(c.quaternion,a.quaternion),k.quat.conjugate(ia,a.quaternion),r.vec3.set(ja,
0,0,1),r.vec3.transformQuat(ja,ja,ia),r.vec3.set(ja,a.halfSize[0]*Math.abs(ja[0]),a.halfSize[1]*Math.abs(ja[1]),a.halfSize[2]*Math.abs(ja[2])),r.vec3.scale(ja,ja,ka),r.vec3.add(c.halfSize,a.halfSize,ja),r.vec3.scale(c.halfSize,c.halfSize,d);else{F.corners(a,Z);r.vec3.set(c.center,a.center[0],a.center[1],a.center[2]+e);H.computeLinearTransformation(b,c.center,la,ga);r.vec3.set(c.center,la[12],la[13],la[14]);d=2*Math.sqrt(1+la[0]+la[5]+la[10]);ia[0]=(la[6]-la[9])/d;ia[1]=(la[8]-la[2])/d;ia[2]=(la[1]-
la[4])/d;ia[3]=.25*d;k.quat.multiply(c.quaternion,ia,a.quaternion);k.quat.conjugate(ia,c.quaternion);for(var g=f=d=a=0,h=Z;g<h.length;g++){var m=h[g];m[2]+=e;H.bufferToBuffer(m,b,0,m,ga,0,1);r.vec3.sub(ja,m,c.center);r.vec3.transformQuat(ja,ja,ia);a=Math.max(a,Math.abs(ja[0]));d=Math.max(d,Math.abs(ja[1]));f=Math.max(f,Math.abs(ja[2]))}r.vec3.set(c.halfSize,a,d,f)}}Object.defineProperty(b,"__esModule",{value:!0});b.DDS_ENCODING_STRING="image/vnd-ms.dds";b.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS=
["image/jpeg","image/png"];b.extractWkid=I;b.selectEncoding=function(a,c){if(c)for(c=0;c<a.length;c++)if(a[c].encoding===b.DDS_ENCODING_STRING)return a[c];for(c=0;c<a.length;c++)if(-1<b.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS.indexOf(a[c].encoding))return a[c];return null};b.findIntersectingNodes=function(a,b,c,d,e,f){e.traverse(c,function(c){var e=c.mbs;b!==d&&(e=X,H.mbsToMbs(c.mbs,d,e,b));e=G(a,e);if(0===e)return!1;f(c,e);return!0})};b.filterInPlace=function(a,b,c){for(var d=0,e=0,f=0;f<b.length&&
d<a.length;f++)a[d]===b[f]&&(c(f)&&(a[e]=a[d],e++),d++);a.length=e};var T=v.create();b.getClipAABB=function(a,b){if(0===b.rotationScale[1]&&0===b.rotationScale[2]&&0===b.rotationScale[3]&&0===b.rotationScale[5]&&0===b.rotationScale[6]&&0===b.rotationScale[7])return T[0]=(a[0]-b.position[0])/b.rotationScale[0],T[1]=(a[1]-b.position[1])/b.rotationScale[4],T[2]=(a[2]-b.position[2])/b.rotationScale[8],T[3]=(a[3]-b.position[0])/b.rotationScale[0],T[4]=(a[4]-b.position[1])/b.rotationScale[4],T[5]=(a[5]-
b.position[2])/b.rotationScale[8],T};var X=t.vec4f64.create();b.intersectBoundingRectWithMbs=G;b.intersectBoundingBoxWithMbs=function(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var f=a[0]-c,c=c-a[3],g=a[1]-d,d=d-a[4],h=a[2]-e;a=e-a[5];var e=Math.max(f,c,0),k=Math.max(g,d,0),l=Math.max(h,a,0),e=e*e+k*k+l*l;return e>b*b?0:0<e?1:-Math.max(f,c,g,d,h,a)>b?3:2};b.findFieldsCaseInsensitive=J;b.whenGraphicAttributes=function(a,b,c,d,e,g){!0===(g&&g.populateObjectId)&&(d=E(d,c));if(0===b.length)return f.resolve(b);
g=a.associatedLayer;var k=a.attributeStorageInfo;if(g)return L(g,b,c,d);if(k){b=e(b);if(!b)return f.reject(new h("scenelayer:features-not-loaded","Tried to query attributes for unloaded features"));var l=a.parsedUrl.path;return f.all(b.map(function(a){return N(l,k,a.node,a.indices,d).then(function(b){for(var c=0;c<a.graphics.length;c++){var d=a.graphics[c],e=b[c];if(d.attributes)for(var f in d.attributes)f in e||(e[f]=d.attributes[f]);d.attributes=e}return a.graphics})})).then(m.flatten)}return f.reject(new h("scenelayer:no-attribute-source",
"This scene layer does not have a source for attributes available"))};var Y=-Math.pow(2,15),da=-Math.pow(2,31);b.getCachedAttributeValue=Q;b.getIndexCrs=O;b.getVertexCrs=U;b.getCacheKeySuffix=function(a,b){return b===H.SphericalECEFSpatialReference?"@ECEF":a.equals(b)?"":null!=b.wkid?"@"+b.wkid:null};b.checkSpatialReference=P;b.checkSpatialReferences=ba;b.checkSceneLayerValid=function(a){var b;(b=null==a.store||null==a.store.defaultGeometrySchema)||(b=a.store.defaultGeometrySchema,b=!!(null!=b.geometryType&&
"triangles"!==b.geometryType||null!=b.topology&&"PerAttributeArray"!==b.topology||null==b.vertexAttributes||null==b.vertexAttributes.position));if(b)throw new h("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:a.parsedUrl.path});};b.checkSceneLayerCompatibleWithView=function(a,b){ba(a,b.spatialReference,b.viewingMode)};b.checkPointCloudLayerValid=function(a){var b;(b=null==a.store||null==a.store.defaultGeometrySchema)||(a=a.store.defaultGeometrySchema,
b=!!(null==a.geometryType||"points"!==a.geometryType||null!=a.topology&&"PerAttributeArray"!==a.topology||null!=a.encoding&&""!==a.encoding&&"lepcc-xyz"!==a.encoding||null==a.vertexAttributes||null==a.vertexAttributes.position));if(b)throw new h("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};b.checkPointCloudLayerCompatibleWithView=function(a,b){P(a.spatialReference,b.spatialReference,b.viewingMode)};b.rendererNeedsTextures=function(a){if(null==
a||"simple"!==a.type&&"class-breaks"!==a.type&&"unique-value"!==a.type||("unique-value"===a.type||"class-breaks"===a.type)&&null==a.defaultSymbol)return!0;a=a.getSymbols();if(0===a.length)return!0;for(var b=0;b<a.length;b++){var c=a[b];if("mesh-3d"!==c.type||0===c.symbolLayers.length)return!0;for(var d=0,c=c.symbolLayers.items;d<c.length;d++){var f=c[d];if("fill"!==f.type||e.isNone(f.material)||e.isNone(f.material.color)||"replace"!==f.material.colorMixMode)return!0}}return!1};b.transparentEdgeMaterial=
B.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0});var fa=function(){return function(){this.material=this.edgeMaterial=null;this.castShadows=!0}}();b.SymbolInfo=fa;b.getSymbolInfo=function(a){var b=new fa,c=!1,d=!1,f=0;for(a=a.symbolLayers.items;f<a.length;f++){var g=a[f];if("fill"===g.type&&g.enabled){var h=g.material,k=g.edges;e.isSome(h)&&!c&&(c=h.color,h=C.parseColorMixMode(h.colorMixMode),e.isSome(c)?b.material={color:[c.r/255,c.g/255,c.b/255],alpha:c.a,colorMixMode:h}:b.material={color:[1,
1,1],alpha:1,colorMixMode:1},b.castShadows=g.castShadows,c=!0);e.isSome(k)&&!d&&(b.edgeMaterial=B.createMaterialFromEdges(k,{}),d=!0)}}b.material||(b.material={color:[1,1,1],alpha:1,colorMixMode:1});return b};b.addWraparound=function(a,b){return(a|0)+(b|0)|0};b.transformObb=V;b.computeAuthorativeOBB=function(a,b,c,f,g,h){var k=A.computeGlobalTransformation(a.mbs,g,c,b);d.mat4.invert(ra,k);var l,m=function(){if(!l)if(l=Z,z.empty(aa),e.isSome(a.obb)&&!a.isComputedObb){V(a.obb,c,na,b,g,a.isComputedObb);
F.corners(na,l);for(var d=0,f=l;d<f.length;d++){var h=f[d];r.vec3.transformMat4(h,h,ra);z.expandPointInPlace(aa,h)}}else for(h=a.mbs,d=h[3],H.vectorToVector(h,c,ja,b),r.vec3.transformMat4(ja,ja,ra),ja[2]+=g,f=0;8>f;++f){var k=f&1?d:-d,m=f&2?d:-d,n=f&4?d:-d,h=l[f];r.vec3.copy(h,[ja[0]+k,ja[1]+m,ja[2]+n]);z.expandPointInPlace(aa,h)}},n=Infinity,p=-Infinity,q=function(a){if("replace"===a.type&&(a=a.geometry,a.hasZ)){z.empty(oa);var c=a.spatialReference||f;a=a.rings.reduce(function(a,d){return d.reduce(function(a,
d){H.vectorToVector(d,c,ja,b);r.vec3.transformMat4(ja,ja,ra);z.expandPointInPlace(oa,ja);return Math.min(ja[2],a)},a)},Infinity);m();z.intersects(aa,oa)&&(n=Math.min(n,a),p=Math.max(p,a))}};h.forEach(function(a){return q(a)});if(Infinity===n)return null;h=function(a,b,c){r.vec3.transformMat4(ja,c,k);a[b+0]=ja[0];a[b+1]=ja[1];a[b+2]=ja[2];b+=24;c[2]=n;r.vec3.transformMat4(ja,c,k);a[b+0]=ja[0];a[b+1]=ja[1];a[b+2]=ja[2];b+=24;c[2]=p;r.vec3.transformMat4(ja,c,k);a[b+0]=ja[0];a[b+1]=ja[1];a[b+2]=ja[2]};
for(var t=0;8>t;++t)h(ta.data,3*t,l[t]);return F.compute(ta)};var ga=H.SphericalECEFSpatialReference,ka=1/(1-l.wgs84Flattening)-1,la=c.mat4f64.create(),ia=p.quatf32.create(),Z=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],oa=z.create(),aa=z.create(),na=F.create(),ja=[0,0,0],ta={data:Array(72),size:3,offsetIdx:0,strideIdx:3},ra=c.mat4f64.create()})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("require exports tslib ../../../../core/Error ../../../../core/lang ../../../../core/Logger ./LEPCC".split(" "),
function(n,b,a,m,h,e,f){function g(a,b,c){for(var d="",e=0;e<c;){var f=a[b+e];if(128>f)d+=String.fromCharCode(f),e++;else if(192<=f&&224>f){if(e+1>=c)throw new m("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");var g=a[b+e+1],f=(f&31)<<6|g&63,d=d+String.fromCharCode(f),e=e+2}else if(224<=f&&240>f){if(e+2>=c)throw new m("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");var g=a[b+e+1],h=a[b+e+2],f=(f&15)<<12|(g&63)<<6|h&63,d=d+String.fromCharCode(f),
e=e+3}else if(240<=f&&248>f){if(e+3>=c)throw new m("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");g=a[b+e+1];h=a[b+e+2];f=(f&7)<<18|(g&63)<<12|(h&63)<<6|a[b+e+3]&63;d=65536<=f?d+String.fromCharCode((f-65536>>10)+55296,(f&1023)+56320):d+String.fromCharCode(f);e+=4}else throw new m("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");}return d}function l(a,c){for(var d={byteOffset:0,byteCount:0,fields:Object.create(null)},e=0,f=0;f<c.length;f++){var g=
c[f],h=g.valueType||g.type;d.fields[g.property]=(0,b.valueType2ArrayBufferReader[h])(a,e);e+=b.valueType2TypedArrayClassMap[h].BYTES_PER_ELEMENT}d.byteCount=e;return d}function d(a,b,c){var d=[],e,f=0,h;for(h=0;h<a;h+=1){e=b[h];if(0<e){if(d.push(g(c,f,e-1)),0!==c[f+e-1])throw new m("string-array-error","Invalid string array: missing null termination.");}else d.push(null);f+=e}return d}function c(a,c){return new b.valueType2TypedArrayClassMap[c.valueType](a,c.byteOffset,c.count*c.valuesPerElement)}
function k(a,b){return new Uint8Array(a,b.byteOffset,b.byteCount)}function p(a,b,c){a=null!=b.header?l(a,b.header):{byteOffset:0,byteCount:0,fields:{count:c}};c={header:a,byteOffset:a.byteCount,byteCount:0,entries:Object.create(null)};for(var d=a.byteCount,e=0;e<b.ordering.length;e++){var f=b.ordering[e],g=h.clone(b[f]);g.count=a.fields.count;if("String"===g.valueType){if(g.byteOffset=d,g.byteCount=a.fields[f+"ByteCount"],"UTF-8"!==g.encoding)throw new m("unsupported-encoding","Unsupported String encoding.",
{encoding:g.encoding});}else if(z(g.valueType)){var k=w(g.valueType),d=d+(0!==d%k?k-d%k:0);g.byteOffset=d;g.byteCount=k*g.valuesPerElement*g.count}else throw new m("unsupported-value-type","Unsupported binary valueType",{valueType:g.valueType});d+=g.byteCount;c.entries[f]=g}c.byteCount=d-c.byteOffset;return c}function r(a,b,c){b!==a&&q.error("Invalid "+c+" buffer size\n expected: "+a+", actual: "+b+")");if(b<a)throw new m("buffer-too-small","Binary buffer is too small",{expectedSize:a,actualSize:b});
}function t(a){return{isDraco:!1,isLegacy:!1,color:null!=a.color,normal:null!=a.normal,uv0:null!=a.uv0,uvRegion:null!=a.uvRegion,featureIndex:null!=a.faceRange&&null!=a.featureId}}function u(a){for(var b={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1},c=0,d=a.ordering;c<d.length;c++){var e=d[c];if(a.vertexAttributes[e])switch(e){case "normal":b.normal=!0;break;case "color":b.color=!0;break;case "uv0":b.uv0=!0;break;case "region":b.uvRegion=!0}}a.featureAttributes&&a.featureAttributeOrder&&
(b.featureIndex=!0);return b}function v(a){for(var b={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1},c=0;c<a.length;c++)switch(a[c]){case "normal":b.normal=!0;break;case "uv0":b.uv0=!0;break;case "color":b.color=!0;break;case "uv-region":b.uvRegion=!0;break;case "feature-index":b.featureIndex=!0}return b}function z(a){return b.valueType2TypedArrayClassMap.hasOwnProperty(a)}function w(a){return z(a)?b.valueType2TypedArrayClassMap[a].BYTES_PER_ELEMENT:0}Object.defineProperty(b,
"__esModule",{value:!0});var q=e.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");b.readHeader=l;b.readStringArray=d;b.createTypedView=c;b.createRawView=k;b.createAttributeDataIndex=p;b.createGeometryDescriptorFromDefinition=t;b.createGeometryIndexFromSchema=function(b,c){for(var d=l(b,c&&c.header),e=d.byteCount,f={isDraco:!1,header:d,byteOffset:d.byteCount,byteCount:0,vertexAttributes:{}},g=d.fields,h=null!=g.vertexCount?g.vertexCount:g.count,k=0,m=c.ordering;k<m.length;k++){var n=m[k];c.vertexAttributes[n]&&
(d=a.__assign(a.__assign({},c.vertexAttributes[n]),{byteOffset:e,count:h}),f.vertexAttributes[y[n]?y[n]:"_"+n]=d,e+=w(d.valueType)*d.valuesPerElement*h)}h=g.faceCount;if(c.faces&&h)for(f.faces={},k=0,m=c.ordering;k<m.length;k++)n=m[k],c.faces[n]&&(d=a.__assign(a.__assign({},c.faces[n]),{byteOffset:e,count:h}),f.faces[n]=d,e+=w(d.valueType)*d.valuesPerElement*h);g=g.featureCount;if(c.featureAttributes&&c.featureAttributeOrder&&g)for(f.featureAttributes={},h=0,k=c.featureAttributeOrder;h<k.length;h++)m=
k[h],c.featureAttributes[m]&&(d=a.__assign(a.__assign({},c.featureAttributes[m]),{byteOffset:e,count:g}),f.featureAttributes[m]=d,m="UInt64"===d.valueType?8:w(d.valueType),e+=m*d.valuesPerElement*g);r(e,b.byteLength,"geometry");f.byteCount=e-f.byteOffset;return f};b.createGeometryDescriptor=function(a,b){return a&&a.compressedAttributes&&"draco"===a.compressedAttributes.encoding?v(a.compressedAttributes.attributes):a?t(a):u(b)};b.createGeometryDescriptorFromSchema=u;b.createGeometryDescriptorForDraco=
v;var y={position:"position",normal:"normal",color:"color",uv0:"uv0",region:"uvRegion"};b.readBinaryAttribute=function(a,b,e){if("lepcc-rgb"===a.encoding)return f.decodeRGB(b);if("lepcc-intensity"===a.encoding)return f.decodeIntensity(b);if(null!=a.encoding&&""!==a.encoding)throw new m("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");a["attributeByteCounts "]&&!a.attributeByteCounts&&(q.warn("Warning: Trailing space in 'attributeByteCounts '."),a.attributeByteCounts=
a["attributeByteCounts "]);"ObjectIds"===a.ordering[0]&&a.hasOwnProperty("objectIds")&&(q.warn("Warning: Case error in objectIds"),a.ordering[0]="objectIds");e=p(b,a,e);r(e.byteOffset+e.byteCount,b.byteLength,"attribute");if(a=e.entries.attributeValues||e.entries.objectIds){if("String"===a.valueType){e=e.entries.attributeByteCounts;var g=c(b,e);b=k(b,a);return d(e.count,g,b)}return c(b,a)}throw new m("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};b.valueType2TypedArrayClassMap=
{Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array};b.valueType2ArrayBufferReader={Float32:function(a,b){return(new DataView(a,0)).getFloat32(b,!0)},Float64:function(a,b){return(new DataView(a,0)).getFloat64(b,!0)},UInt8:function(a,b){return(new DataView(a,0)).getUint8(b)},Int8:function(a,b){return(new DataView(a,0)).getInt8(b)},UInt16:function(a,b){return(new DataView(a,0)).getUint16(b,!0)},Int16:function(a,
b){return(new DataView(a,0)).getInt16(b,!0)},UInt32:function(a,b){return(new DataView(a,0)).getUint32(b,!0)},Int32:function(a,b){return(new DataView(a,0)).getInt32(b,!0)}};b.isValueType=z;b.getBytesPerValue=w})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["require","exports","../../../../core/Error"],function(n,b,a){function m(a,b,d){return{identifier:String.fromCharCode.apply(null,new Uint8Array(a,d+f.identifierOffset,f.identifierLength)),version:b.getUint16(d+f.versionOffset,!0),checksum:b.getUint32(d+
f.checksumOffset,!0)}}function h(a,b,d){var c=[];b=e(a,b,c);for(var f=[],g=0;g<c.length;g++){f.length=0;b=e(a,b,f);for(var h=0;h<f.length;h++)d.push(f[h]+c[g])}return b}function e(b,e,d){var c=new DataView(b,e),f=c.getUint8(0),g=f&31,h=!!(f&32),l=(f&192)>>6,f=0;if(0===l)f=c.getUint32(1,!0),e+=5;else if(1===l)f=c.getUint16(1,!0),e+=3;else if(2===l)f=c.getUint8(1),e+=2;else throw new a("lepcc-decode-error","Bad count type");if(h)throw new a("lepcc-decode-error","LUT not implemented");b=new Uint8Array(b,
e,Math.ceil(f*g/8));for(var l=h=c=0,m=-1>>>32-g,n=0;n<f;n++){for(;h<g;)c|=b[l]<<h,h+=8,l+=1;d[n]=c&m;c>>>=g;h-=g;32<h+g&&(c|=b[l-1]>>8-h)}return e+l}Object.defineProperty(b,"__esModule",{value:!0});var f={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};b.decodeXYZ=function(b){var e,d,c,g,n,r,t,u,v,z,w,q,y=new DataView(b,0),A=0;g=m(b,y,A);c=g.identifier;g=g.version;A+=f.byteCount;if("LEPCC     "!==c)throw new a("lepcc-decode-error","Bad identifier");if(1<g)throw new a("lepcc-decode-error",
"Unknown version");var B=A;e=y.getUint32(B+0,!0);d=y.getUint32(B+4,!0);c=y.getFloat64(B+8,!0);g=y.getFloat64(B+16,!0);n=y.getFloat64(B+24,!0);r=y.getFloat64(B+32,!0);t=y.getFloat64(B+40,!0);u=y.getFloat64(B+48,!0);v=y.getFloat64(B+56,!0);z=y.getFloat64(B+64,!0);w=y.getFloat64(B+72,!0);q=y.getUint32(B+80,!0);y.getUint32(B+84,!0);A+=88;if(d*Math.pow(2,32)+e!==b.byteLength)throw new a("lepcc-decode-error","Bad size");y=new Float64Array(3*q);e=[];d=[];q=[];B=[];A=h(b,A,e);A=h(b,A,d);A=h(b,A,q);A=h(b,
A,B);if(A!==b.byteLength)throw new a("lepcc-decode-error","Bad length");for(var C=A=b=0;C<e.length;C++)for(var A=A+e[C],F=0,H=0;H<d[C];H++){var F=F+q[b],I=B[b];y[3*b]=Math.min(r,c+2*v*F);y[3*b+1]=Math.min(t,g+2*z*A);y[3*b+2]=Math.min(u,n+2*w*I);b++}return{errorX:v,errorY:z,errorZ:w,result:y}};b.decodeRGB=function(b){var e,d,c,g,h,n,t=new DataView(b,0),u=0;g=m(b,t,u);c=g.identifier;g=g.version;u+=f.byteCount;if("ClusterRGB"!==c)throw new a("lepcc-decode-error","Bad identifier");if(1<g)throw new a("lepcc-decode-error",
"Unknown version");n=u;e=t.getUint32(n+0,!0);d=t.getUint32(n+4,!0);c=t.getUint32(n+8,!0);g=t.getUint16(n+12,!0);h=t.getUint8(n+14);n=t.getUint8(n+15);u+=16;if(d*Math.pow(2,32)+e!==b.byteLength)throw new a("lepcc-decode-error","Bad size");if((2===h||1===h)&&0===n){if(3*g+c+u!==b.byteLength||256<g)throw new a("lepcc-decode-error","Bad count");t=new Uint8Array(b,u,3*g);g=new Uint8Array(b,u+3*g,c);u=new Uint8Array(3*c);for(b=0;b<c;b++)e=g[b],u[3*b]=t[3*e],u[3*b+1]=t[3*e+1],u[3*b+2]=t[3*e+2];return u}if(0===
h&&0===n){if(3*c+u!==b.byteLength||0!==g)throw new a("lepcc-decode-error","Bad count");return(new Uint8Array(b,u)).slice()}if(2>=h&&1===n){if(u+3!==b.byteLength||1!==g)throw new a("lepcc-decode-error","Bad count");g=t.getUint8(u);e=t.getUint8(u+1);t=t.getUint8(u+2);u=new Uint8Array(3*c);for(b=0;b<c;b++)u[3*b]=g,u[3*b+1]=e,u[3*b+2]=t;return u}throw new a("lepcc-decode-error","Bad method "+h+","+n);};b.decodeIntensity=function(b){var g,d,c,h,n,r=new DataView(b,0),t=0;h=m(b,r,t);c=h.identifier;h=h.version;
t+=f.byteCount;if("Intensity "!==c)throw new a("lepcc-decode-error","Bad identifier");if(1<h)throw new a("lepcc-decode-error","Unknown version");var u=t;g=r.getUint32(u+0,!0);d=r.getUint32(u+4,!0);c=r.getUint32(u+8,!0);h=r.getUint16(u+12,!0);n=r.getUint8(u+14);r.getUint8(u+15);t+=16;if(d*Math.pow(2,32)+g!==b.byteLength)throw new a("lepcc-decode-error","Bad size");r=new Uint16Array(c);if(8===n){if(c+t!==b.byteLength)throw new a("lepcc-decode-error","Bad size");n=new Uint8Array(b,t,c)}else if(16===
n){if(2*c+t!==b.byteLength)throw new a("lepcc-decode-error","Bad size");n=new Uint16Array(b,t,c)}else if(n=[],e(b,t,n)!==b.byteLength)throw new a("lepcc-decode-error","Bad size");for(b=0;b<c;b++)r[b]=n[b]*h;return r}})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/earthUtils ../../support/projectionUtils".split(" "),function(n,b,a,m,h,e){function f(a,b,e){var c=m.vec3f64.create(),
d=Math.pow(2,Math.ceil(Math.log(a[3])*Math.LOG2E/l)*l+g);if(e.isGeographic){var f=d/h.earthRadius*180/Math.PI;e=Math.round(a[1]/f);e=Math.max(-90,Math.min(90,e*f));var k=f/Math.cos((Math.abs(e)-f/2)/180*Math.PI),f=Math.round(a[0]/k);c[0]=f*k;c[1]=e}else f=Math.round(a[0]/d),e=Math.round(a[1]/d),c[0]=f*d,c[1]=e*d;c[2]=Math.round((a[2]+b)/d)*d;return c}Object.defineProperty(b,"__esModule",{value:!0});b.computeGlobalTransformation=function(b,c,g,h){b=f(b,c,g);c=a.mat4f64.create();e.computeLinearTransformation(g,
b,c,h);return c};var g=1,l=5-g;b.getLocalOrigin=f})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3"],function(n,b,a){function m(a,b,e){for(;0<a;){var c=b.indexOf(a);if(0<=c)return c;a=e.getParentId(a)}return b.indexOf(a)}function h(a,b,e){for(var c=[b.remove[0]],d=[];1===c.length;)for(var f=c.pop(),g=d.length=0;g<b.load.length;g++){for(var h=b.load[g],k=e.getParentId(h);k!==f;)h=k,k=e.getParentId(h);k=c.indexOf(h);0>k&&(k=c.length,
c.push(h),d.push([]));d[k].push(b.load[g])}b.load=c;for(g=0;g<c.length;g++)1<d[g].length?a.push({remove:[c[g]],load:d[g]}):c[g]=d[g][0]}Object.defineProperty(b,"__esModule",{value:!0});b.nodeDiff=function(a,b,h){for(var c=0;c<b.length;c++)g[c]=!1,l[c]=null;for(c=0;c<a.length;c++)e[c]=!1,f[c]=null;for(c=0;c<b.length;c++){var d=m(b[c],a,h);0<=d&&(g[c]=!0,null!=f[d]?f[d].push(b[c]):f[d]=[b[c]])}for(c=0;c<a.length;c++)d=m(a[c],b,h),0<=d&&(e[c]=!0,null!=l[d]?l[d].push(a[c]):l[d]=[a[c]]);h=[];for(c=0;c<
a.length;c++)null!=f[c]||e[c]||h.push({load:[],remove:[a[c]]});for(c=0;c<b.length;c++)null!=l[c]||g[c]||h.push({load:[b[c]],remove:[]});for(c=0;c<b.length;c++)null!=l[c]&&(1<l[c].length||l[c][0]!==b[c])&&h.push({load:[b[c]],remove:l[c]});for(c=0;c<a.length;c++)null!=f[c]&&(1<f[c].length||f[c][0]!==a[c])&&h.push({load:f[c],remove:[a[c]]});return h};var e=[!1],f=[null],g=[!1],l=[null];b.sortFrontToBack=function(b,c,e){return b.sort(function(b,d){if(0===b.load.length&&0===d.load.length)return 0;if(0===
b.load.length)return-1;if(0===d.load.length)return 1;if(0===b.remove.length&&0===d.remove.length)return b=e.getRenderCenter(b.load[0]),d=e.getRenderCenter(d.load[0]),a.vec3.dot(b,c)-a.vec3.dot(d,c);if(0===b.remove.length)return-1;if(0===d.remove.length)return 1;if(1===b.load.length&&1===d.load.length)return b=e.getRenderCenter(b.load[0]),d=e.getRenderCenter(d.load[0]),a.vec3.dot(b,c)-a.vec3.dot(d,c);if(1===b.load.length)return-1;if(1===d.load.length)return 1;b=e.getRenderCenter(b.remove[0]);d=e.getRenderCenter(d.remove[0]);
return a.vec3.dot(b,c)-a.vec3.dot(d,c)})};b.splitWorkEntries=function(a,b,e){for(var c=0;c<a.length;++c){var d=a[c];d.load.length>b&&1===d.remove.length&&h(a,d,e)}};b.splitWorkEntry=h})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define(["require","exports","../../../../geometry/support/aaBoundingBox","./I3SUtil","../../support/orientedBoundingBox"],function(n,b,a,m,h){return function(){function b(a,b,e){this._pages=[];this.pageSize=0;this._renderSR=this._nodeSR=null;this._nodeSR=a;this._renderSR=
b;this.pageSize=e}b.prototype.addPage=function(a,b,e){for(void 0===e&&(e=0);this._pages.length<a;)this._pages.push(null);for(var d=this._nodeSR,c=this._renderSR,f=new h.ObbArray(b.length),g=0;g<b.length;g++)m.transformObb(b[g].obb,d,f.obbs[g],c,e);this._pages[a]={nodes:b,renderObbs:f.obbs,parents:new Uint32Array(this.pageSize)};a=this._pages;b=this.pageSize;for(d=[0];d.length;)for(c=d.pop(),e=a[c/b|0].nodes[c%b],f=0;f<e.childCount;f++)g=e.firstChild+f,null!=a[g/b|0]&&(a[g/b|0].parents[g%b]=c,d.push(g))};
b.prototype.hasPage=function(a){return!!this._pages[a]};b.prototype.getNode=function(a){var b=this.pageSize;return this._pages[a/b|0].nodes[a%b]};b.prototype.getRenderObb=function(a){var b=this.pageSize;return this._pages[a/b|0].renderObbs[a%b]};b.prototype.getRenderCenter=function(a){return this.getRenderObb(a).center};b.prototype.setRenderObb=function(a,b){var e=this.pageSize;h.set(b,this._pages[a/e|0].renderObbs[a%e])};b.prototype.getParentId=function(a){var b=this.pageSize;return this._pages[a/
b|0].parents[a%b]};b.prototype.hasNodes=function(a,b){b=(a+b-1)/this.pageSize|0;for(a=a/this.pageSize|0;a<=b;a++)if(null==this._pages[a])return!1;return!0};b.prototype.forEachNodeId=function(a){for(var b=0;b<this._pages.length;b++){var e=this._pages[b];if(e)for(var d=0;d<e.nodes.length;d++)a(b*this.pageSize+d)}};b.prototype.createVisibilityTraverse=function(){var b=this,e=[],l=[],d=a.create();return function(c,f){if(b.hasNodes(0,1))for(e.length=0,e.push(0),l.length=0,l.push(0);0<e.length;){var g=
e.pop(),k=l.pop(),m=b.getNode(g),n=b.getRenderObb(g),v=!0;if(null!=c.clippingBox){var z=1<<c.frustumPlanes.length;if(0===(k&z)){var w=h.toAaBoundingBox(n,d);a.contains(c.clippingBox,w)?k|=z:a.intersects(c.clippingBox,w)||(v=!1)}}for(w=0;w<c.frustumPlanes.length&&v;w++)if(z=1<<w,0===(k&z)){var q=h.intersectPlane(n,c.frustumPlanes[w]);0<q?v=!1:0>q&&(k|=z)}if(f.predicate(g,m,v)){n=m.firstChild;m=m.childCount;w=!1;v=(n+m-1)/b.pageSize|0;for(z=n/b.pageSize|0;z<=v;z++)if(!b.hasPage(z)){f.pageMiss(g,z);
w=!0;break}if(!w)for(w=0;w<m;w++)e.push(n+w),l.push(k)}}}};return b}()})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define(["require","exports"],function(n,b){function a(a,b){for(var e=0;e<a.length;e++){var g=a[e];if(g.name===b&&null!=g.attributeValues&&"UInt8"===g.attributeValues.valueType&&3===g.attributeValues.valuesPerElement)return{name:b,storageInfo:g,useElevation:!1}}return null}function m(a,b){for(var e=0;e<a.length;e++){var g=a[e];if(g.name===b)return a="embedded-elevation"===
g.encoding,{name:b,storageInfo:a?null:g,useElevation:a}}return"elevation"===b.toLowerCase()?{name:b,storageInfo:null,useElevation:!0}:null}Object.defineProperty(b,"__esModule",{value:!0});b.getRendererInfo=function(b){var e=b.renderer,f=e&&e.type,g=e&&b.renderer.toJSON()||null,h=null,d=!1;"point-cloud-unique-value"===f?h=m(b.attributeStorageInfo,e.field):"point-cloud-stretch"===f?h=m(b.attributeStorageInfo,e.field):"point-cloud-class-breaks"===f?h=m(b.attributeStorageInfo,e.field):(h="point-cloud-rgb"===
f?a(b.attributeStorageInfo,e.field):a(b.attributeStorageInfo,"RGB"),d=null!=h);f=null;e&&e.colorModulation&&(f=m(b.attributeStorageInfo,e.colorModulation.field));return{rendererJSON:g,isRGBRenderer:d,primaryAttribute:h,modulationAttribute:f}};b.getFilterInfo=function(a){var b=a.filters;return b?b.map(function(b){return{filterJSON:b.toJSON(),attributeInfo:m(a.attributeStorageInfo,b.field)}}):[]};b.getSplatSizeAlgorithm=function(a){return(a=a&&a.pointSizeAlgorithm)&&"splat"===a.type?a:null};b.getFixedSizeAlgorithm=
function(a){return(a=a&&a.pointSizeAlgorithm)&&"fixed-size"===a.type?a:null};b.rendererUsesFixedSizes=function(a){return(a=a&&a.pointSizeAlgorithm)&&a.type?"fixed-size"===a.type:!1};b.getAttributeInfo=m})},"esri/views/3d/layers/i3s/PointCloudWorkerUtil":function(){define("require exports ../../../../core/maybe ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader ./LEPCC".split(" "),
function(n,b,a,m,h,e,f,g){function l(a,b){for(var c=new Float64Array(b),d=0;d<b;d++)c[d]=a[3*d+2];return c}function d(a){return null==a||"none"===a?null:"low-four-bit"===a?function(a){return a&15}:"high-four-bit"===a?function(a){return(a&240)>>4}:"absolute-value"===a?function(a){return Math.abs(a)}:"modulo-ten"===a?function(a){return a%10}:null}function c(a){var b=0,c=0;for(a=a?a:[];c<a.length;c++)b|=1<<a[c];return b}Object.defineProperty(b,"__esModule",{value:!0});b.evaluateRenderer=function(a,b,
c,f){var g=a.rendererJSON,k=a.isRGBRenderer,l=a=null;if(b&&k)a=b;else if(b&&"pointCloudUniqueValueRenderer"===g.type){var l=e.fromJSON(g),n=l.colorUniqueValueInfos;a=new Uint8Array(3*f);k=d(l.fieldTransformType);for(g=0;g<f;g++)for(var p=k?k(b[g]):b[g],p=p+"",r=0;r<n.length;r++)if(0<=n[r].values.indexOf(p)){a[3*g]=n[r].color.r;a[3*g+1]=n[r].color.g;a[3*g+2]=n[r].color.b;break}}else if(b&&"pointCloudStretchRenderer"===g.type)for(l=h.fromJSON(g),n=l.stops,a=new Uint8Array(3*f),k=d(l.fieldTransformType),
g=0;g<f;g++)if(p=k?k(b[g]):b[g],r=n.length-1,p<n[0].value)a[3*g]=n[0].color.r,a[3*g+1]=n[0].color.g,a[3*g+2]=n[0].color.b;else if(p>=n[r].value)a[3*g]=n[r].color.r,a[3*g+1]=n[r].color.g,a[3*g+2]=n[r].color.b;else for(r=1;r<n.length;r++){if(p<n[r].value){p=(p-n[r-1].value)/(n[r].value-n[r-1].value);a[3*g]=n[r].color.r*p+n[r-1].color.r*(1-p);a[3*g+1]=n[r].color.g*p+n[r-1].color.g*(1-p);a[3*g+2]=n[r].color.b*p+n[r-1].color.b*(1-p);break}}else if(b&&"pointCloudClassBreaksRenderer"===g.type)for(l=m.fromJSON(g),
n=l.colorClassBreakInfos,a=new Uint8Array(3*f),k=d(l.fieldTransformType),g=0;g<f;g++)for(p=k?k(b[g]):b[g],r=0;r<n.length;r++){if(p>=n[r].minValue&&p<=n[r].maxValue){a[3*g]=n[r].color.r;a[3*g+1]=n[r].color.g;a[3*g+2]=n[r].color.b;break}}else for(a=new Uint8Array(3*f),g=0;g<a.length;g++)a[g]=255;if(c&&l&&l.colorModulation)for(b=l.colorModulation.minValue,l=l.colorModulation.maxValue,g=0;g<f;g++)p=c[g],k=p>=l?1:p<=b?.3:.3+.7*(p-b)/(l-b),a[3*g]*=k,a[3*g+1]*=k,a[3*g+2]*=k;return a};b.readGeometry=function(b,
c){if(null==b.encoding||""===b.encoding){b=f.createGeometryIndexFromSchema(c,b);if(a.isNone(b.vertexAttributes.position))return;c=f.createTypedView(c,b.vertexAttributes.position);var d=b.header.fields;b=[d.offsetX,d.offsetY,d.offsetZ];for(var d=[d.scaleX,d.scaleY,d.scaleZ],e=c.length/3,h=new Float64Array(3*e),k=0;k<e;k++)h[3*k]=c[3*k]*d[0]+b[0],h[3*k+1]=c[3*k+1]*d[1]+b[1],h[3*k+2]=c[3*k+2]*d[2]+b[2];return h}if("lepcc-xyz"===b.encoding)return g.decodeXYZ(c).result};b.getAttributeValues=function(b,
c,d){return a.isSome(b)&&b.attributeInfo.useElevation?l(c,d):a.isSome(b)?f.readBinaryAttribute(b.attributeInfo.storageInfo,b.buffer,d):null};b.elevationFromPositions=l;b.filterInPlace=function(a,b,d,e,f){for(var g=a.length/3,h=0,k=0;k<g;k++){for(var l=!0,m=0;m<e.length&&l;m++){var n=e[m].filterJSON,p=f[m].values[k];switch(n.type){case "pointCloudValueFilter":var r="exclude"===n.mode;-1!==n.values.indexOf(p)===r&&(l=!1);break;case "pointCloudBitfieldFilter":r=c(n.requiredSetBits);n=c(n.requiredClearBits);
if((p&r)!==r||0!==(p&n))l=!1;break;case "pointCloudReturnFilter":for(var t=p&15,u=p>>>4&15,p=1<u,r=1===t,t=t===u,u=!1,I=0,n=n.includedReturns;I<n.length;I++){var G=n[I];if("last"===G&&t||"firstOfMany"===G&&r&&p||"lastOfMany"===G&&t&&p||"single"===G&&!p){u=!0;break}}u||(l=!1)}}l&&(d[h]=k,a[3*h]=a[3*k],a[3*h+1]=a[3*k+1],a[3*h+2]=a[3*k+2],b[3*h]=b[3*k],b[3*h+1]=b[3*k+1],b[3*h+2]=b[3*k+2],h++)}return h}})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("require exports tslib ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(n,b,a,m,h,e,f,g){return function(b){function d(a){a=b.call(this,a)||this;a.type="point-cloud-class-breaks";a.field=null;a.legendOptions=null;a.fieldTransformType=null;a.colorClassBreakInfos=null;return a}a.__extends(d,b);c=d;d.prototype.clone=function(){return new c(a.__assign(a.__assign({},this.cloneProperties()),{field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:m.clone(this.colorClassBreakInfos),legendOptions:m.clone(this.legendOptions)}))};var c;a.__decorate([h.enumeration({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],
d.prototype,"type",void 0);a.__decorate([h.property({json:{write:!0},type:String})],d.prototype,"field",void 0);a.__decorate([h.property({type:f.default,json:{write:!0}})],d.prototype,"legendOptions",void 0);a.__decorate([h.property({type:e.fieldTransformTypeKebabDict.apiValues,json:{type:e.fieldTransformTypeKebabDict.jsonValues,read:e.fieldTransformTypeKebabDict.read,write:e.fieldTransformTypeKebabDict.write}})],d.prototype,"fieldTransformType",void 0);a.__decorate([h.property({type:[g.default],
json:{write:!0}})],d.prototype,"colorClassBreakInfos",void 0);return d=c=a.__decorate([h.subclass("esri.renderers.PointCloudClassBreaksRenderer")],d)}(e)})},"esri/renderers/PointCloudRenderer":function(){define("require exports tslib ../core/jsonMap ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmJSONUtils ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),function(n,b,a,m,h,e,f,g,l,d){var c=
m.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});n=function(b){function h(a){a=b.call(this,a)||this;a.type=void 0;a.pointSizeAlgorithm=null;a.colorModulation=null;a.pointsPerInch=10;return a}a.__extends(h,b);h.prototype.clone=function(){console.warn(".clone() is not implemented for "+this.declaredClass);return null};h.prototype.cloneProperties=
function(){return{pointSizeAlgorithm:e.clone(this.pointSizeAlgorithm),colorModulation:e.clone(this.colorModulation),pointsPerInch:e.clone(this.pointsPerInch)}};a.__decorate([f.property({type:c.apiValues,readOnly:!0,nonNullable:!0,json:{type:c.jsonValues,read:!1,write:c.write}})],h.prototype,"type",void 0);a.__decorate([f.property({types:d.pointSizeAlgorithmTypes,json:{read:l.read,write:!0}})],h.prototype,"pointSizeAlgorithm",void 0);a.__decorate([f.property({type:g.default,json:{write:!0}})],h.prototype,
"colorModulation",void 0);a.__decorate([f.property({json:{write:!0},nonNullable:!0,type:Number})],h.prototype,"pointsPerInch",void 0);return h=a.__decorate([f.subclass("esri.renderers.PointCloudRenderer")],h)}(h.JSONSupport);(n||(n={})).fieldTransformTypeKebabDict=new m.JSONMap({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return n})},"esri/renderers/support/pointCloud/ColorModulation":function(){define(["require","exports",
"tslib","../../../core/JSONSupport","../../../core/accessorSupport/decorators"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a.field=null;a.minValue=0;a.maxValue=255;return a}a.__extends(e,b);g=e;e.prototype.clone=function(){return new g({field:this.field,minValue:this.minValue,maxValue:this.maxValue})};var g;a.__decorate([h.property({type:String,json:{write:!0}})],e.prototype,"field",void 0);a.__decorate([h.property({type:Number,
nonNullable:!0,json:{write:!0}})],e.prototype,"minValue",void 0);a.__decorate([h.property({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxValue",void 0);return e=g=a.__decorate([h.subclass("esri.renderers.support.pointCloud.ColorModulation")],e)}(m.JSONSupport);b.ColorModulation=n;b.default=n})},"esri/renderers/support/pointCloud/pointSizeAlgorithmJSONUtils":function(){define(["require","exports","../../../core/Warning","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(n,
b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});var e={pointCloudFixedSizeAlgorithm:m.default,pointCloudSplatAlgorithm:h.default};b.read=function(b,g,h){if(g=b?e[b.type]||null:null)return g=new g,g.read(b,h),g;h&&h.messages&&b&&h.messages.push(new a("pointsizealgorithm:unsupported","Point size algorithms of type '"+(b.type||"unknown")+"' are not supported",{definition:b,context:h}));return null};b.fromJSON=function(a){var b=a?e[a.type]||null:null;return b?b.fromJSON(a):null}})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define(["require",
"exports","tslib","../../../core/accessorSupport/decorators","./PointSizeAlgorithm"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a.type="fixed-size";a.size=0;a.useRealWorldSymbolSizes=null;return a}a.__extends(e,b);g=e;e.prototype.clone=function(){return new g({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})};var g;a.__decorate([m.enumeration({pointCloudFixedSizeAlgorithm:"fixed-size"})],
e.prototype,"type",void 0);a.__decorate([m.property({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"size",void 0);a.__decorate([m.property({type:Boolean,json:{write:!0}})],e.prototype,"useRealWorldSymbolSizes",void 0);return e=g=a.__decorate([m.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],e)}(h.default);b.PointSizeFixedSizeAlgorithm=n;b.default=n})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("require exports tslib ../../../core/jsonMap ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),
function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});b.typeKebabDictionary=new m.default({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});n=function(f){function g(){return null!==f&&f.apply(this,arguments)||this}a.__extends(g,f);a.__decorate([e.property({type:b.typeKebabDictionary.apiValues,readOnly:!0,nonNullable:!0,json:{type:b.typeKebabDictionary.jsonValues,read:!1,write:b.typeKebabDictionary.write}})],g.prototype,"type",void 0);return g=a.__decorate([e.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],
g)}(h.JSONSupport);b.PointSizeAlgorithm=n;b.default=n})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define(["require","exports","tslib","../../../core/accessorSupport/decorators","./PointSizeAlgorithm"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a.type="splat";a.scaleFactor=1;return a}a.__extends(e,b);g=e;e.prototype.clone=function(){return new g({scaleFactor:this.scaleFactor})};
var g;a.__decorate([m.enumeration({pointCloudSplatAlgorithm:"splat"})],e.prototype,"type",void 0);a.__decorate([m.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],e.prototype,"scaleFactor",void 0);return e=g=a.__decorate([m.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],e)}(h.default);b.PointSizeSplatAlgorithm=n;b.default=n})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["require","exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm",
"./PointSizeSplatAlgorithm"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});b.pointSizeAlgorithmTypes={key:"type",base:a.default,typeMap:{"fixed-size":m.default,splat:h.default}}})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("require exports tslib ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),function(n,b,a,m,h,e,f,g){Object.defineProperty(b,
"__esModule",{value:!0});n=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.description=null;a.label=null;a.minValue=0;a.maxValue=0;a.color=null;return a}a.__extends(d,b);c=d;d.prototype.clone=function(){return new c({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:e.clone(this.color)})};var c;a.__decorate([f.property({type:String,json:{write:!0}})],d.prototype,"description",void 0);a.__decorate([f.property({type:String,json:{write:!0}})],
d.prototype,"label",void 0);a.__decorate([f.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],d.prototype,"minValue",void 0);a.__decorate([f.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],d.prototype,"maxValue",void 0);a.__decorate([f.property({type:m,json:{type:[g.Integer],write:!0}})],d.prototype,"color",void 0);return d=c=a.__decorate([f.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],d)}(h.JSONSupport);
b.ColorClassBreakInfo=n;b.default=n})},"esri/renderers/PointCloudStretchRenderer":function(){define("require exports tslib ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/StopInfo".split(" "),function(n,b,a,m,h,e,f,g){return function(b){function d(a){a=b.call(this,a)||this;a.type="point-cloud-stretch";a.field=null;a.legendOptions=null;a.fieldTransformType=null;a.stops=null;return a}a.__extends(d,b);c=d;d.prototype.clone=function(){return new c(a.__assign(a.__assign({},
this.cloneProperties()),{field:m.clone(this.field),fieldTransformType:m.clone(this.fieldTransformType),stops:m.clone(this.stops),legendOptions:m.clone(this.legendOptions)}))};var c;a.__decorate([h.enumeration({pointCloudStretchRenderer:"point-cloud-stretch"})],d.prototype,"type",void 0);a.__decorate([h.property({json:{write:!0},type:String})],d.prototype,"field",void 0);a.__decorate([h.property({type:f.default,json:{write:!0}})],d.prototype,"legendOptions",void 0);a.__decorate([h.property({type:e.fieldTransformTypeKebabDict.apiValues,
json:{type:e.fieldTransformTypeKebabDict.jsonValues,read:e.fieldTransformTypeKebabDict.read,write:e.fieldTransformTypeKebabDict.write}})],d.prototype,"fieldTransformType",void 0);a.__decorate([h.property({type:[g.default],json:{write:!0}})],d.prototype,"stops",void 0);return d=c=a.__decorate([h.subclass("esri.renderers.PointCloudStretchRenderer")],d)}(e)})},"esri/renderers/support/pointCloud/StopInfo":function(){define("require exports tslib ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),
function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.label=null;a.value=0;a.color=null;return a}a.__extends(d,b);c=d;d.prototype.clone=function(){return new c({label:this.label,value:this.value,color:e.clone(this.color)})};var c;a.__decorate([f.property({type:String,json:{write:!0}})],d.prototype,"label",void 0);a.__decorate([f.property({type:Number,nonNullable:!0,json:{write:!0}})],d.prototype,"value",
void 0);a.__decorate([f.property({type:m,json:{type:[g.Integer],write:!0}})],d.prototype,"color",void 0);return d=c=a.__decorate([f.subclass("esri.renderers.support.pointCloud.StopInfo")],d)}(h.JSONSupport);b.StopInfo=n;b.default=n})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("require exports tslib ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),function(n,b,a,m,h,e,f,g){return function(b){function d(a){a=
b.call(this,a)||this;a.type="point-cloud-unique-value";a.field=null;a.fieldTransformType=null;a.colorUniqueValueInfos=null;a.legendOptions=null;return a}a.__extends(d,b);c=d;d.prototype.clone=function(){return new c(a.__assign(a.__assign({},this.cloneProperties()),{field:m.clone(this.field),fieldTransformType:m.clone(this.fieldTransformType),colorUniqueValueInfos:m.clone(this.colorUniqueValueInfos),legendOptions:m.clone(this.legendOptions)}))};var c;a.__decorate([h.enumeration({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],
d.prototype,"type",void 0);a.__decorate([h.property({json:{write:!0},type:String})],d.prototype,"field",void 0);a.__decorate([h.property({type:e.fieldTransformTypeKebabDict.apiValues,json:{type:e.fieldTransformTypeKebabDict.jsonValues,read:e.fieldTransformTypeKebabDict.read,write:e.fieldTransformTypeKebabDict.write}})],d.prototype,"fieldTransformType",void 0);a.__decorate([h.property({type:[g.default],json:{write:!0}})],d.prototype,"colorUniqueValueInfos",void 0);a.__decorate([h.property({type:f.default,
json:{write:!0}})],d.prototype,"legendOptions",void 0);return d=c=a.__decorate([h.subclass("esri.renderers.PointCloudUniqueValueRenderer")],d)}(e)})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("require exports tslib ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(){var a=
null!==b&&b.apply(this,arguments)||this;a.description=null;a.label=null;a.values=null;a.color=null;return a}a.__extends(d,b);c=d;d.prototype.clone=function(){return new c({description:this.description,label:this.label,values:e.clone(this.values),color:e.clone(this.color)})};var c;a.__decorate([f.property({type:String,json:{write:!0}})],d.prototype,"description",void 0);a.__decorate([f.property({type:String,json:{write:!0}})],d.prototype,"label",void 0);a.__decorate([f.property({type:[String],json:{write:!0}})],
d.prototype,"values",void 0);a.__decorate([f.property({type:m,json:{type:[g.Integer],write:!0}})],d.prototype,"color",void 0);return d=c=a.__decorate([f.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],d)}(h.JSONSupport);b.ColorUniqueValueInfo=n;b.default=n})},"esri/views/3d/layers/i3s/PointGraphic":function(){define(["require","exports","tslib","../../../../Graphic","../../../../core/accessorSupport/decorators"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});
n=function(b){function e(a){return b.call(this,a)||this}a.__extends(e,b);g=e;e.prototype.clone=function(){return new g(this.cloneProperties())};e.prototype.cloneProperties=function(){var e=this.pointCloudMetadata;return a.__assign(a.__assign({},b.prototype.cloneProperties.call(this)),{pointCloudMetadata:e})};var g;a.__decorate([h.property({constructOnly:!0})],e.prototype,"pointCloudMetadata",void 0);return e=g=a.__decorate([h.subclass("esri.views.3d.layers.i3s.PointGraphic")],e)}(m);b.PointGraphic=
n})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../geometry/support/aaBoundingBox ./PointHighlights ../../support/geometryUtils ../../support/geometryUtils ../../support/orientedBoundingBox ../../webgl-engine/core/shaderLibrary/Slice.glsl ../../webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl-engine/lib/intersectorUtils ../../webgl-engine/shaders/PointRendererTechnique ../../../webgl/BufferObject ../../../webgl/VertexArrayObject".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A){function B(a,b,c,d,e){if(c.drawScreenSpace)return c.fixedSize*b*d;e=(e?256:64)*b*d;return c.drawFixedSize?Math.min(c.fixedSize/2,e):0<c.screenMinSize?Math.min(Math.max(c.screenMinSize*b*d,a/2),e):Math.min(a/2,e)}function C(b){return a.isSome(b.component)?b.component:-1}function F(b,c){if(a.isNone(b))return b;b=b.filter(function(a){return a.id!==c});return 0===b.length?null:b}Object.defineProperty(b,"__esModule",{value:!0});var H={positions:[{name:"position",
count:3,type:5126,offset:0,stride:12,normalized:!1}],colors:[{name:"color",count:3,type:5121,offset:0,stride:3,normalized:!0}]};n=function(){function b(a){var b=this;this._params=a;this.type="Point";this.isGround=!1;this._highlights=new k.PointHighlights({forEachNode:function(a){return b.forEachNode(a)},addHighlight:function(a,c,d){return b.addHighlight(a,c,d)},removeHighlight:function(a,c){return b.removeHighlight(a,c)}});this.canRender=!0;this.layerUid="";this._useFixedSizes=!1;this._scaleFactor=
1;this._minSizePx=0;this._useRealWorldSymbolSizes=!1;this._sizePx=this._size=0;this._slicePlaneEnabled=!1;this._clipBox=c.create(c.POSITIVE_INFINITY);this._techniqueConfig=new q.PointRendererTechniqueConfiguration;this.tempMatrix4=h.mat4f32.create();this.tempVec3=g.vec3f32.create();this.nodes=[]}Object.defineProperty(b.prototype,"needsHighlight",{get:function(){return this._highlights.hasHighlights},enumerable:!0,configurable:!0});b.prototype.initializeRenderContext=function(a){this._initContext=
a;this._techniqueRep=this._initContext.shaderTechniqueRep;a.requestRender()};b.prototype.uninitializeRenderContext=function(){};b.prototype.intersect=function(a,b,g,h){var k=this,m=l.vec3f64.create(),n=l.vec3f64.create(),q=l.vec3f64.create(),u=l.vec3f64.create(),v=r.plane.create(),y=a.camera.perScreenPixelRatio/2,A=a.camera.near,z=this._getSizeParams();f.vec3.subtract(n,h,g);var C=1/f.vec3.length(n);f.vec3.scale(n,n,C);f.vec3.negate(q,n);d.vec4.set(v,n[0],n[1],n[2],-f.vec3.dot(n,g));var G=function(){return function(){this.normal=
this.dist=this.point=this.pointId=this.node=null;this.layerUid=""}}(),F=new G,E=new G,H=[],I=c.create(),J=c.create(this._clipBox);c.offset(J,-g[0],-g[1],-g[2],J);for(var L=function(d){var e=d.splatSize*la._scaleFactor,p=t.minimumDistancePlane(d.obb,v),r=t.maximumDistancePlane(d.obb,v),p=p-(z.drawScreenSpace?0:B(e,p+A,z,y,d.isLeaf)),r=r-(z.drawScreenSpace?0:B(e,r+A,z,y,d.isLeaf)),p=null!=F.dist&&null!=E.dist&&F.dist<p*C&&E.dist>r*C;if(0>r||p)return"continue";r=B(e,r+A,z,y,d.isLeaf);if(!t.intersectLine(d.obb,
g,n,r))return"continue";var w=r*r;t.toAaBoundingBox(d.obb,I);c.offset(I,-g[0],-g[1],-g[2],I);var P=!c.contains(J,I);f.vec3.subtract(u,d.origin,g);for(var r=d.coordinates.length/3,p=function(p){m[0]=u[0]+d.coordinates[3*p];m[1]=u[1]+d.coordinates[3*p+1];m[2]=u[2]+d.coordinates[3*p+2];if(P&&!c.containsPoint(J,m))return"continue";var r=f.vec3.dot(m,n),t=f.vec3.squaredLength(m)-r*r;if(t>w)return"continue";var v=r+A,I=z.drawScreenSpace?0:B(e,v,z,y,d.isLeaf);if(0>r-I)return"continue";v=B(e,v-I,z,y,d.isLeaf);
if(t>v*v)return"continue";var L=(r-I)*C,r=function(a){var b=a.point;null==b&&(b=l.vec3f64.create());b[0]=d.origin[0]+d.coordinates[3*p];b[1]=d.origin[1]+d.coordinates[3*p+1];b[2]=d.origin[2]+d.coordinates[3*p+2];a.point=b;a.dist=L;a.normal=q;a.node=d;a.pointId=p;a.layerUid=k.layerUid};(null==F.dist||L<F.dist)&&(null==b||b(g,h,L))&&r(F);0!==a.options.store&&(null==E.dist||L>E.dist)&&(null==b||b(g,h,L))&&r(E);2!==a.options.store||null!=b&&!b(g,h,L)||(t=new G,r(t),H.push(t))},L=0;L<r;L++)p(L)},la=this,
ia=0,Z=this.nodes;ia<Z.length;ia++)L(Z[ia]);var oa=function(a){var b=a.node,c=a.pointId;return{type:"external",point:a.point,metadata:{layerUid:a.layerUid,createGraphic:function(){return k._params.createGraphic(b,c,a.point)}}}},L=function(a,b){var c=oa(b);a.set(c,b.layerUid+"/"+b.node.id+"/"+b.pointId,b.dist,b.normal,e.mat4f64.IDENTITY,void 0);a.intersector="PointRenderer"};null!=F.dist&&(ia=a.results.min,(null==ia.dist||F.dist<ia.dist)&&L(ia,F));null!=E.dist&&0!==a.options.store&&(ia=a.results.max,
(null==ia.dist||E.dist>ia.dist)&&L(ia,E));if(2===a.options.store)for(ia=p.ray.fromPoints(g,h),Z=0;Z<H.length;Z++){var aa=H[Z],na=new w.IntersectorResult(ia);L(na,aa);a.results.all.push(na)}};b.prototype.render=function(a){if(0!==a.pass&&1!==a.pass&&4!==a.pass)return!1;for(var b=1===a.pass,d=a.rctx,e=0,g=this.nodes;e<g.length;e++){var h=g[e];null==h.vao&&this._initNode(a,h)}var e=this._getSizeParams(),g=this.selectTechnique(a,e),k=g.program;if(null==k||0===this.nodes.length)return!0;var l=this._clipBox,
n=!c.equals(l,c.POSITIVE_INFINITY,function(a,b){return a===b});n||(f.vec3.set(this.tempVec3,-Infinity,-Infinity,-Infinity),k.setUniform3fv("uClipMin",this.tempVec3),f.vec3.set(this.tempVec3,Infinity,Infinity,Infinity),k.setUniform3fv("uClipMax",this.tempVec3));d.bindProgram(k);g.bindPipelineState(d);k.setUniformMatrix4fv("uProjectionMatrix",a.camera.projectionMatrix);b&&k.setUniform2f("nearFar",a.camera.near,a.camera.far);a.isHighlightPass&&v.OutputHighlight.bindOutputHighlight(d,k,{viewport:a.camera.fullViewport,
highlightDepthTexture:a.highlightDepthTexture});b=a.camera.pixelRatio;e.drawFixedSize&&k.setUniform2f("uPointScale",e.fixedSize*b,a.camera.fullHeight);for(var p=this._slicePlaneEnabled?a.sliceHelper&&a.sliceHelper.plane:null,q=0,r=this.nodes;q<r.length;q++)if(h=r[q],0!==h.coordinates.length&&(!a.isHighlightPass||h.highlights)){k.setUniform2f("uScreenMinMaxSize",e.screenMinSize*b,(h.isLeaf?256:64)*b);e.drawFixedSize||k.setUniform2f("uPointScale",h.splatSize*this._scaleFactor*b,a.camera.fullHeight/
b);var t=h.origin;n&&(f.vec3.set(this.tempVec3,l[0]-t[0],l[1]-t[1],l[2]-t[2]),k.setUniform3fv("uClipMin",this.tempVec3),f.vec3.set(this.tempVec3,l[3]-t[0],l[4]-t[1],l[5]-t[2]),k.setUniform3fv("uClipMax",this.tempVec3));m.mat4.identity(this.tempMatrix4);m.mat4.translate(this.tempMatrix4,this.tempMatrix4,t);m.mat4.multiply(this.tempMatrix4,a.camera.viewMatrix,this.tempMatrix4);k.setUniformMatrix4fv("uModelViewMatrix",this.tempMatrix4);u.Slice.bindUniforms(k,g.configuration,p,t);d.bindVAO(h.vao);a.isHighlightPass?
this._renderHighlightFragments(d,h):d.drawArrays(0,0,h.coordinates.length/3)}return!0};b.prototype._renderHighlightFragments=function(b,c){var d=c.highlights;if(!a.isNone(d)){c=a.unwrap(d[0].component);for(var e=c+1,f=1;f<d.length;f++){var g=a.unwrap(d[f].component);g!==e&&(e-=c,0<e&&b.drawArrays(0,c,e),c=g);e=g+1}d=e-c;0<d&&b.drawArrays(0,c,d)}};Object.defineProperty(b.prototype,"useFixedSizes",{get:function(){return this._useFixedSizes},set:function(a){this._useFixedSizes!==a&&(this._useFixedSizes=
a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"scaleFactor",{get:function(){return this._scaleFactor},set:function(a){this._scaleFactor!==a&&(this._scaleFactor=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"minSizePx",{get:function(){return this._minSizePx},set:function(a){this._minSizePx!==a&&(this._minSizePx=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"useRealWorldSymbolSizes",
{get:function(){return this._useRealWorldSymbolSizes},set:function(a){this._useRealWorldSymbolSizes!==a&&(this._useRealWorldSymbolSizes=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return this._size},set:function(a){this._size!==a&&(this._size=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"sizePx",{get:function(){return this._sizePx},set:function(a){this._sizePx!==a&&(this._sizePx=a,
this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"clippingBox",{set:function(a){c.set(this._clipBox,a||c.POSITIVE_INFINITY)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"slicePlane",{get:function(){return this._slicePlaneEnabled},set:function(a){this._slicePlaneEnabled!==a&&(this._slicePlaneEnabled=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"intersectionHandlerId",{get:function(){return this.layerUid},
enumerable:!0,configurable:!0});b.prototype.addNode=function(a){this.nodes.push(a);this._highlights.nodeAdded(a);this._requestRender()};b.prototype.removeNode=function(a){var b=this,c=null;this.nodes=this.nodes.filter(function(d){return d.id===a?(c=d,d.vao&&(d.vao.dispose(!0),d.vao=null),b._highlights.nodeRemoved(d),!1):!0});this._requestRender();return c};b.prototype.forEachNode=function(a){this.nodes.forEach(a)};b.prototype.removeAll=function(){this.nodes.forEach(function(a){a.vao&&(a.vao.dispose(!0),
a.vao=null)});this._highlights.removeAll();this.nodes=[];this._requestRender()};b.prototype.highlight=function(a){return this._highlights.add(a)};b.prototype.addHighlight=function(b,c,d){var e=b.highlights;a.isNone(e)&&(e=[]);c={component:c,id:d};e.push(c);d=C(c);for(var f=e.length-1;0<f&&d<C(e[f-1]);)c=[e[f],e[f-1]],e[f-1]=c[0],e[f]=c[1],--f;b.highlights=e;this._requestRender()};b.prototype.removeHighlight=function(a,b){a.highlights=F(a.highlights,b);this._requestRender()};b.prototype._initNode=
function(a,b){a=a.rctx;b.vao=new A(a,z.Default3D,H,{positions:y.createVertex(a,35044,b.coordinates),colors:y.createVertex(a,35044,b.rgb)})};b.prototype._requestRender=function(){this._initContext&&this._initContext.requestRender()};b.prototype._getSizeParams=function(){var a=this._useFixedSizes,b=a&&!this._useRealWorldSymbolSizes,c=b?this._sizePx:this._size,d=this._minSizePx;a&&(d=0);return{drawScreenSpace:b,drawFixedSize:a,fixedSize:c,screenMinSize:d}};b.prototype.selectTechnique=function(a,b){this._techniqueConfig.drawScreenSize=
b.drawScreenSpace;this._techniqueConfig.slicePlaneEnabled=this._slicePlaneEnabled;this._techniqueConfig.sceneHasOcludees=a.hasOccludees;this._techniqueConfig.output=1===a.pass?1:4===a.pass?4:0;return this._techniqueRep.acquireAndReleaseExisting(q.PointRendererTechnique,this._techniqueConfig,this._technique)};return b}();b.PointRenderer=n;(function(a){a.isInstanceOfNode=function(a){return a.hasOwnProperty("splatSize")}})(n=b.PointRenderer||(b.PointRenderer={}));b.PointRenderer=n})},"esri/views/3d/layers/i3s/PointHighlights":function(){define(["require",
"exports","../../../../core/maybe","../../../../core/SetUtils","../../webgl-engine/lib/Object3DStateSet"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a){this.context=a;this.highlights=new Set}Object.defineProperty(a.prototype,"hasHighlights",{get:function(){return 0<this.highlights.size},enumerable:!0,configurable:!0});a.prototype.destroy=function(){this.highlights=null};a.prototype.add=function(a){var b=this,d=new e(a);this.highlights.add(d);this.enableSet(d);
return{remove:function(){return b.removeSet(d)},pause:function(){b.disableSet(d)},resume:function(){b.enableSet(d)}}};a.prototype.removeSet=function(a){this.disableSet(a);this.highlights.delete(a)};a.prototype.enableSet=function(a){var b=this;a.enabled||(a.enabled=!0,this.context.forEachNode(function(d){return b.enableSetForNode(a,d)}))};a.prototype.enableSetForNode=function(a,b){var d=this;if(a.enabled){var c=a.ids.get(b.id);c&&c.forEach(function(c){return d.context.addHighlight(b,c,a.id)})}};a.prototype.disableSet=
function(a){var b=this;a.enabled&&(a.enabled=!1,this.context.forEachNode(function(d){return b.disableSetForNode(a,d)}))};a.prototype.disableSetForNode=function(a,b){a.enabled||this.context.removeHighlight(b,a.id)};a.prototype.nodeAdded=function(a){var b=this;this.highlights.forEach(function(d){return b.enableSetForNode(d,a)})};a.prototype.nodeRemoved=function(a){var b=this;this.highlights.forEach(function(d){return b.disableSetForNode(d,a)})};a.prototype.removeAll=function(){var a=this;this.highlights.forEach(function(b){return a.disableSet(b)})};
return a}();b.PointHighlights=n;var e=function(){function b(b){this.id=h.generateObject3DStateId(0);this.ids=new Map;this.enabled=!1;for(var e=0;e<b.length;e++){var d=b[e];a.isSome(d)&&this.add(d.nodeId,d.pointId)}}b.prototype.add=function(a,b){var d=this.ids.get(a);d?d.add(b):this.ids.set(a,m.SetFromValues([b]))};return b}()})},"esri/views/3d/webgl-engine/shaders/PointRendererTechnique":function(){define("require exports tslib ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/StencilUtils ./PointRenderer.glsl ../../../webgl/Program ../../../webgl/renderState @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c){Object.defineProperty(b,"__esModule",{value:!0});h=function(b){function e(a,c){return b.call(this,a,c)||this}a.__extends(e,b);e.prototype.initializeProgram=function(a){var b=e.shader.get(),c=this.configuration,b=b.build({output:c.output,slicePlaneEnabled:c.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,drawScreenSize:c.drawScreenSize});return new d(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),f.Default3D)};e.prototype.initializePipeline=
function(){return c.makePipelineState({depthTest:{func:513},depthWrite:c.defaultDepthWriteParams,colorWrite:c.defaultColorWriteParams,stencilWrite:this.configuration.sceneHasOcludees?g.stencilWriteMaskOn:null,stencilTest:this.configuration.sceneHasOcludees?g.stencilBaseAllZerosParams:null})};e.shader=new m.ReloadableShaderModule(l,function(){return new Promise(function(a,b){n(["./PointRenderer.glsl"],a,b)})});return e}(h.ShaderTechnique);b.PointRendererTechnique=h;h=function(b){function c(){var a=
null!==b&&b.apply(this,arguments)||this;a.output=0;a.slicePlaneEnabled=!1;a.drawScreenSize=!1;a.sceneHasOcludees=!1;return a}a.__extends(c,b);a.__decorate([e.parameter({count:7})],c.prototype,"output",void 0);a.__decorate([e.parameter()],c.prototype,"slicePlaneEnabled",void 0);a.__decorate([e.parameter()],c.prototype,"drawScreenSize",void 0);a.__decorate([e.parameter()],c.prototype,"sceneHasOcludees",void 0);return c}(e.ShaderTechniqueConfiguration);b.PointRendererTechniqueConfiguration=h})},"esri/views/3d/webgl-engine/shaders/PointRenderer.glsl":function(){define("require exports tslib ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,b,a,m,h,e,f,g){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var n=new g.ShaderBuilder,q=0===b.output,y=1===b.output,A=4===b.output;n.extensions.add("GL_OES_standard_derivatives");n.include(m.Slice,b);n.attributes.add("position","vec3");n.attributes.add("color","vec3");n.vertex.uniforms.add("uModelViewMatrix","mat4").add("uProjectionMatrix","mat4").add("uScreenMinMaxSize","vec2").add("uPointScale","vec2").add("uClipMin","vec3").add("uClipMax","vec3");y?(n.vertex.uniforms.add("nearFar",
"vec2"),n.varyings.add("depth","float")):4!==b.output&&n.varyings.add("vColor","vec3");n.vertex.code.add(f.glsl(p||(p=a.__makeTemplateObject(["\n    void main(void) {\n      // Move clipped points outside of clipspace\n      if (position.x \x3c uClipMin.x || position.y \x3c uClipMin.y || position.z \x3c uClipMin.z ||\n        position.x \x3e uClipMax.x || position.y \x3e uClipMax.y || position.z \x3e uClipMax.z) {\n        gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\n        gl_PointSize \x3d 0.0;\n        return;\n      }\n\n      if (rejectBySlice(position)) {\n        gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\n        gl_PointSize \x3d 0.0;\n        return;\n      }\n\n      // Position in camera space\n      vec4 camera \x3d uModelViewMatrix * vec4(position, 1.0);\n\n      float pointSize \x3d uPointScale.x;\n      vec4 position \x3d uProjectionMatrix * camera;\n     ",
"\n\n     gl_PointSize \x3d clampedScreenSize;\n     gl_Position \x3d position;\n\n     ","\n     ","\n    }\n  "],["\n    void main(void) {\n      // Move clipped points outside of clipspace\n      if (position.x \x3c uClipMin.x || position.y \x3c uClipMin.y || position.z \x3c uClipMin.z ||\n        position.x \x3e uClipMax.x || position.y \x3e uClipMax.y || position.z \x3e uClipMax.z) {\n        gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\n        gl_PointSize \x3d 0.0;\n        return;\n      }\n\n      if (rejectBySlice(position)) {\n        gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\n        gl_PointSize \x3d 0.0;\n        return;\n      }\n\n      // Position in camera space\n      vec4 camera \x3d uModelViewMatrix * vec4(position, 1.0);\n\n      float pointSize \x3d uPointScale.x;\n      vec4 position \x3d uProjectionMatrix * camera;\n     ",
"\n\n     gl_PointSize \x3d clampedScreenSize;\n     gl_Position \x3d position;\n\n     ","\n     ","\n    }\n  "])),b.drawScreenSize?f.glsl(l||(l=a.__makeTemplateObject(["\n      float clampedScreenSize \x3d pointSize;"],["\n      float clampedScreenSize \x3d pointSize;"]))):f.glsl(d||(d=a.__makeTemplateObject(["\n      float pointRadius \x3d 0.5 * pointSize;\n      vec4 cameraOffset \x3d camera + vec4(0.0, pointRadius, 0.0, 0.0);\n      vec4 positionOffset \x3d uProjectionMatrix * cameraOffset;\n      float radius \x3d abs(positionOffset.y - position.y);\n      float viewHeight \x3d uPointScale.y;\n      // screen diameter \x3d (2 * r / w) * (h / 2)\n      float screenPointSize \x3d (radius / position.w) * viewHeight;\n      float clampedScreenSize \x3d clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);\n      // Shift towards camera, to move rendered point out of terrain i.e. to\n      // the camera-facing end of the virtual point when considering it as a\n      // 3D sphere.\n      camera.xyz -\x3d normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\n      position \x3d uProjectionMatrix * camera;"],
["\n      float pointRadius \x3d 0.5 * pointSize;\n      vec4 cameraOffset \x3d camera + vec4(0.0, pointRadius, 0.0, 0.0);\n      vec4 positionOffset \x3d uProjectionMatrix * cameraOffset;\n      float radius \x3d abs(positionOffset.y - position.y);\n      float viewHeight \x3d uPointScale.y;\n      // screen diameter \x3d (2 * r / w) * (h / 2)\n      float screenPointSize \x3d (radius / position.w) * viewHeight;\n      float clampedScreenSize \x3d clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);\n      // Shift towards camera, to move rendered point out of terrain i.e. to\n      // the camera-facing end of the virtual point when considering it as a\n      // 3D sphere.\n      camera.xyz -\x3d normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\n      position \x3d uProjectionMatrix * camera;"]))),
y?f.glsl(c||(c=a.__makeTemplateObject(["depth \x3d (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);"],["depth \x3d (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);"]))):"",q?f.glsl(k||(k=a.__makeTemplateObject(["vColor \x3d color;"],["vColor \x3d color;"]))):""));n.include(e.RgbaFloatEncoding,b);A&&n.include(h.OutputHighlight);n.fragment.code.add(f.glsl(v||(v=a.__makeTemplateObject(["\n    void main(void) {\n      vec2 vOffset \x3d gl_PointCoord - vec2(0.5, 0.5);\n      float r2 \x3d dot(vOffset, vOffset);\n\n      if (r2 \x3e 0.25) {\n        discard;\n      }\n      ",
"\n      ","\n      ","\n    }\n  "],["\n    void main(void) {\n      vec2 vOffset \x3d gl_PointCoord - vec2(0.5, 0.5);\n      float r2 \x3d dot(vOffset, vOffset);\n\n      if (r2 \x3e 0.25) {\n        discard;\n      }\n      ","\n      ","\n      ","\n    }\n  "])),y?f.glsl(r||(r=a.__makeTemplateObject(["gl_FragColor \x3d float2rgba(depth);"],["gl_FragColor \x3d float2rgba(depth);"]))):"",A?f.glsl(t||(t=a.__makeTemplateObject(["outputHighlight();"],["outputHighlight();"]))):"",q?f.glsl(u||(u=a.__makeTemplateObject(["gl_FragColor \x3d vec4(vColor, 1.0);"],
["gl_FragColor \x3d vec4(vColor, 1.0);"]))):""));return n};var l,d,c,k,p,r,t,u,v})},"esri/views/3d/layers/support/PopupSceneLayerView":function(){define("require exports tslib ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/SetUtils ../../../../core/accessorSupport/decorators ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),function(n,b,a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",{value:!0});b.PopupSceneLayerView=
function(b){return function(b){function c(){return null!==b&&b.apply(this,arguments)||this}a.__extends(c,b);c.prototype._validateFetchPopupFeatures=function(a){var b=this.layer;if(!b.popupEnabled)return new m("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:b});if(!d.getFetchPopupTemplate(b,a))return new m("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:b})};c.prototype.prepareFetchPopupFeatures=function(b){return a.__awaiter(this,void 0,void 0,
function(){return a.__generator(this,function(a){return[2]})})};c.prototype.fetchPopupFeatures=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var b,g,k,m,n,p,r,t,C,F,H;return a.__generator(this,function(a){switch(a.label){case 0:if(b=this._validateFetchPopupFeatures(c))return[2,e.reject(b)];g=h.isSome(c)?c.clientGraphics:null;if(!g||0===g.length)return[2,e.resolve([])];k=[];m=[];p=l.unpackFieldNames;r=[this.layer.fields];return[4,d.getRequiredFields(this.layer,d.getFetchPopupTemplate(this.layer,
c))];case 1:return n=p.apply(void 0,r.concat([a.sent()])),[4,this.prepareFetchPopupFeatures(n)];case 2:a.sent();t=new Set;C=0;for(F=g;C<F.length;C++)H=F[C],l.populateMissingFields(n,H,t)?m.push(H):k.push(H);return 0===m.length?[2,e.resolve(k)]:[2,this.whenGraphicAttributes(m,f.valuesOfSet(t)).catch(function(){return m}).then(function(a){return k.concat(a)})]}})})};return c=a.__decorate([g.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],c)}(b)}})},"esri/views/3d/layers/SceneLayerView3D":function(){define("require exports tslib ../../../geometry ../../../Graphic ../../../core/arrayUtils ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/SetUtils ../../../core/unitUtils ../../../core/accessorSupport/decorators ../../../core/sql/WhereClause ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/webMercatorUtils ../../../layers/support/fieldUtils ../../../tasks/support/Query ./I3SMeshView3D ./LayerView3D ./i3s/I3SGeometryUtil ./i3s/I3SQueryEngine ./i3s/I3SQueryFeatureAdapter ./i3s/I3SQueryFeatureStore ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/layerViewUpdatingProperties ./support/PopupSceneLayerView ../support/projectionUtils ../../layers/LayerView ../../layers/support/FeatureFilter ../../support/Scheduler".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L,M,N){var Q=f.getLogger("esri.views.3d.layers.SceneLayerView3D"),R=I.defineFieldProperties(),W=[0,0,0,0];return function(b){function f(){var a=null!==b&&b.apply(this,arguments)||this;a._queryEngine=null;a.requiredFields=[];a.lodFactor=1;a.progressiveLoadFactor=1;a._elevationContext="scene";a._isIntegratedMesh=!1;a._supportsLabeling=!0;a._asyncModuleLoading=0;a._projectionEngineLoaded=!1;return a}a.__extends(f,b);Object.defineProperty(f.prototype,
"filter",{set:function(a){if(g.isNone(a))this._set("filter",null);else{var b=["contains","intersects","disjoint"];a.timeExtent?(Q.warn("Filters with a timeExtent are not supported for mesh scene layers"),a=null):a.spatialRelationship&&-1===b.indexOf(a.spatialRelationship)&&(Q.warn("Filters with spatialRelationship other than "+b.join(", ")+" are not supported for mesh scene layers"),a=null);this._set("filter",a)}},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"parsedFilterWhereClause",
{get:function(){var a=g.isSome(this.filter)?this.filter.where:null;if(!a)return null;try{return p.WhereClause.create(a,this.layer.fieldsIndex)}catch(ba){Q.error("Failed to parse filter where clause: "+ba)}return null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"filterSpatialRelationship",{get:function(){return g.isSome(this.filter)?this.filter.spatialRelationship:"intersects"},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"parsedFilterGeometry",{get:function(){var a=
this;if(g.isNone(this.filter)||!this._geometryEngine)return null;var b=this.filter.geometry,d=this.filter,e=d.distance,f=d.units,d=this.filterSpatialRelationship,b="mesh"===b.type?b.extent:b;if(!e)return y.processFilterGeometry(b,d);f=f||c.getUnitString(b.spatialReference);if(b.spatialReference.isWGS84)return e=this._geometryEngine.geodesicBuffer(b,e,f),y.processFilterGeometry(e,d);if(u.canProject(b,m.SpatialReference.WGS84))return e=u.project(this._geometryEngine.geodesicBuffer(u.project(b,m.SpatialReference.WGS84),
e,f),b.spatialReference),y.processFilterGeometry(e,d);if(!r.isSupported())return Q.error("Filter by geodesic buffer (distance) unsupported due to lack of projection support."),null;if(!this._projectionEngineLoaded&&(this._loadAsyncModule(r.load()).then(function(){a._set("_projectionEngineLoaded",!0)}),!this._projectionEngineLoaded))return null;var h=null;try{h=r.project(b,m.SpatialReference.WGS84)}catch(da){}if(h)try{h=r.project(this._geometryEngine.geodesicBuffer(h,e,f),b.spatialReference)}catch(da){h=
null}h||Q.error("Filter by geodesic buffer (distance) unsupported, failed to project input geometry ("+b.spatialReference.wkid+") to WGS84.");return y.processFilterGeometry(h,d)},enumerable:!0,configurable:!0});f.prototype.initialize=function(){for(var a=this,b=0,c=["layer.renderer","layer.labelingInfo","layer.labelsVisible","definitionExpressionFields","filter"];b<c.length;b++){var d=c[b];this.updatingHandles.add(this,d,function(){return a.updatingHandles.addPromise(a._updateRequiredFields())})}this._updateRequiredFields();
this.updatingHandles.add(this.layer,"rangeInfos",function(b){return a._rangeInfosChanged(b)},2);this.updatingHandles.add(this.layer,"renderer",function(b){return a.updatingHandles.addPromise(a._rendererChange(b))},2);b=0;for(c=["parsedDefinitionExpression","layer.objectIdFilter","filter","parsedFilterWhereClause","parsedFilterGeometry"];b<c.length;b++)d=c[b],this.updatingHandles.add(this,d,function(){return a._filterChange()})};f.prototype.destroy=function(){};f.prototype._updateRequiredFields=function(){return a.__awaiter(this,
void 0,void 0,function(){var b,c,e,f,h,k,m,n,p,q,r;return a.__generator(this,function(a){switch(a.label){case 0:return b=this,e=c=b.layer,f=e.fields,h=e.renderer,k=b.definitionExpressionFields,m=new Set,[4,l.eachAlways([h?h.collectRequiredFields(m,f):null,v.collectLabelingFields(m,c),g.isSome(this.filter)?v.collectFilterFields(m,c,this.filter):null])];case 1:n=a.sent();p=0;for(q=n;p<q.length;p++)r=q[p],r.error&&Q.error(r.error);v.collectFields(m,f,k);this._set("requiredFields",d.valuesOfSet(m).sort());
return[2]}})})};f.prototype._rangeInfosChanged=function(a){null!=a&&0<a.length&&Q.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};f.prototype.createQuery=function(){var a={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return g.isSome(this.filter)?this.filter.createQuery(a):new z(a)};f.prototype.queryExtent=function(a){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(a))};
f.prototype.queryFeatureCount=function(a){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(a))};f.prototype.queryFeatures=function(a){return this._ensureQueryEngine().executeQuery(this._ensureQuery(a))};f.prototype.queryObjectIds=function(a){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(a))};f.prototype._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};f.prototype._createQueryEngine=
function(){var a=this,b=this._createGetFeatureExtent();return new A.default({layerView:this,task:N.Task.FEATURE_QUERY_ENGINE,spatialIndex:new C.default({featureAdapter:new B.I3SQueryFeatureAdapter({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo,getFeatureExtent:b}),forAllFeatures:function(b,c){return a._forAllFeatures(function(a,c,d){return b({id:a,index:c,meta:d})},c,2)},getFeatureExtent:b,sourceSpatialReference:F.getIndexCrs(this.layer),viewSpatialReference:this.view.spatialReference})})};
f.prototype._createGetFeatureExtent=function(){var a=this,b=new Float64Array(24),c=this.view.renderSpatialReference,d=this.view.spatialReference;return function(e){if(!e.meta.featureExtents){var f=new Float64Array(6*e.meta.featureIds.length);e.meta.featureExtents=f;for(var g=0;g<f.length;g+=6)f[g]=Number.POSITIVE_INFINITY}f=new Float64Array(e.meta.featureExtents.buffer,6*e.index*Float64Array.BYTES_PER_ELEMENT,6);return f[0]===Number.POSITIVE_INFINITY?(y.boundingBoxCornerPoints(e.index,a._collection,
e.meta.objectHandle,b),E.bufferToBuffer(b,c,0,b,d,0,8)?t.expandWithBuffer(t.NEGATIVE_INFINITY,b,0,8,f):t.set(f,t.ZERO)):f}};f.prototype.highlight=function(a){var c=this._highlights;if(a instanceof z){var d=c.acquireSet(),e=d.set,d=d.handle;this.queryObjectIds(a).then(function(a){return c.setFeatureIds(e,a)});return d}return b.prototype.highlight.call(this,a)};f.prototype._createLayerGraphic=function(a){a=new h(null,null,a);a.layer=this.layer;a.sourceLayer=this.layer;return a};f.prototype.canResume=
function(){return b.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};f.prototype.isUpdating=function(){return this.updatingMeshView3D||0<this._asyncModuleLoading};f.prototype.getFilters=function(){var a=this,c=b.prototype.getFilters.call(this);if(this.layer.objectIdFilter){var d=new Float64Array(this.layer.objectIdFilter.ids),e="include"===this.layer.objectIdFilter.method;d.sort();c.push(function(b){return a._objectIdFilter(d,e,b)})}this.addSqlFilter(c,this.parsedDefinitionExpression,
this.definitionExpressionFields,this.logError);if(g.isSome(this.filter)){var f=this.parsedFilterGeometry;g.isSome(f)&&c.push(function(b,c){return a._geometryFilter(b,c,f,a.filterSpatialRelationship)});if(this.filter.objectIds){var h=new Float64Array(this.filter.objectIds);h.sort();c.push(function(b){return a._objectIdFilter(h,!0,b)})}}g.isSome(this.parsedFilterWhereClause)&&this.addSqlFilter(c,this.parsedFilterWhereClause,this.parsedFilterWhereClause.fieldNames,this.logError);return c};f.prototype._geometryFilter=
function(a,b,c,d){var e=c[0].spatialReference||this.view.spatialReference;if(E.mbsToMbs(b.node.mbs,this._controller.crsIndex,W,e))for(var f=y.acquireMaskFilterContext(d,this.view,e,this._collection,b.objectHandle),g=y.computeMaskNodeMBS(W,f),e=function(c){if(0===a.length)return{value:void 0};switch(y.testMaskWithGeometry(c,g,d)){case 1:return a.length=0,{value:void 0};case 0:return"continue"}F.filterInPlace(a,b.featureIds,function(a){return y.filterWithMask(c,a,f)})},h=0;h<c.length;h++){var k=e(c[h]);
if("object"===typeof k)return k.value}else Q.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter")};f.prototype._filterChange=function(){var a=this;g.isSome(this.filter)&&this.filter.geometry&&!this._geometryEngine?this._loadAsyncModule(y.loadGeometryEngine()).then(function(b){a.destroyed||(a._set("_geometryEngine",b),a._applyFilters(!0))}):b.prototype._filterChange.call(this)};f.prototype._loadAsyncModule=function(a){var b=this;this._set("_asyncModuleLoading",
this._asyncModuleLoading+1);var c=function(){return b._set("_asyncModuleLoading",b._asyncModuleLoading-1)};return a.then(function(a){c();return a},function(a){c();throw a;})};f.prototype._objectIdFilter=function(a,b,c){for(var d=0,f=0;d<c.length;)0<=e.binaryIndexOf(a,c[d])===b&&(c[f]=c[d],f++),d++;c.length=f};f.prototype._ensureQuery=function(a){return this._addDefinitionExpressionToQuery(g.isNone(a)?this.createQuery():z.from(a))};a.__decorate([k.property()],f.prototype,"layer",void 0);a.__decorate([k.property({dependsOn:["updatingMeshView3D",
"_asyncModuleLoading"]})],f.prototype,"updating",void 0);a.__decorate([k.property({dependsOn:["_controller.rootNodeVisible"]})],f.prototype,"suspended",void 0);a.__decorate([k.property(G.updatingProgress)],f.prototype,"updatingProgress",void 0);a.__decorate([k.property({type:M})],f.prototype,"filter",null);a.__decorate([k.property({readOnly:!0,dependsOn:["filter.where"]})],f.prototype,"parsedFilterWhereClause",null);a.__decorate([k.property({readOnly:!0,dependsOn:["filter.spatialRelationship"]})],
f.prototype,"filterSpatialRelationship",null);a.__decorate([k.property({readOnly:!0,dependsOn:"filter.geometry filter.distance filter.units filterSpatialRelationship _geometryEngine _projectionEngineLoaded".split(" ")})],f.prototype,"parsedFilterGeometry",null);a.__decorate([k.property(R.requiredFields)],f.prototype,"requiredFields",void 0);a.__decorate([k.property(R.availableFields)],f.prototype,"availableFields",void 0);a.__decorate([k.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.3dObject.lodFactor"})],
f.prototype,"lodFactor",void 0);a.__decorate([k.property({readOnly:!0,aliasOf:"_controller.updatingProgress"})],f.prototype,"updatingProgressValue",void 0);a.__decorate([k.property({readOnly:!0})],f.prototype,"_asyncModuleLoading",void 0);a.__decorate([k.property({readOnly:!0})],f.prototype,"_geometryEngine",void 0);a.__decorate([k.property({readOnly:!0})],f.prototype,"_projectionEngineLoaded",void 0);return f=a.__decorate([k.subclass("esri.views.3d.layers.SceneLayerView3D")],f)}(w.I3SMeshView3D(H.DefinitionExpressionSceneLayerView(J.PopupSceneLayerView(q.LayerView3D(L)))))})},
"esri/views/3d/layers/I3SMeshView3D":function(){define("require exports tslib ../../../Color ../../../Graphic ../../../core/Collection ../../../core/has ../../../core/Logger ../../../core/MapUtils ../../../core/mathUtils ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f32 ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../geometry/support/aaBoundingBox ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../layers/support/layerUtils ../../../layers/support/SceneModification ../../../renderers/visualVariables/support/visualVariableUtils ../../../support/arcadeOnDemand ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ./I3SMeshViewLabeler ./I3SMeshWorkerHandle ./graphics/graphicUtils ./i3s/Highlights ./i3s/I3SElevationProvider ./i3s/I3SGeometryUtil ./i3s/I3SIntersectionHandler ./i3s/I3SProjectionUtil ./i3s/I3SUtil ./i3s/IDBCache ./support/attributeUtils ./support/layerViewUpdatingProperties ../support/debugFlags ../support/orientedBoundingBox ../support/projectionUtils ../support/buffer/glUtil ../webgl-engine/collections/Component/SourceGeometry ../webgl-engine/core/material/RenderTexture ../webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../webgl-engine/lib/Texture ../webgl-engine/lib/TextureBackedBuffer/BufferManager @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L,M,N,Q,R,W,O,U,P,ba,V,T,X,Y,da,fa,ga,ka,la,ia,Z,oa,aa,na){function ja(a){var b=a.metallicRoughness;return b&&0<=b.baseColorTextureId||b&&0<=b.metallicRoughnessTextureId||0<=a.normalTextureId||0<=a.emissiveTextureId||0<=a.occlusionTextureId}function ta(a){return c.isSome(a)&&r.isArrayBuffer(a.data)}function ra(a,b){a=1024+a.interleavedVertexData.byteLength+(a.indices?a.indices.byteLength:0)+a.positionData.data.byteLength+a.positionData.indices.byteLength;
if(c.isSome(b))for(var d=0;d<b.length;d++){var e=b[d];c.isSome(e)&&r.isArrayBuffer(e.data)&&(a+=e.data.byteLength)}return a}function xa(a,b){return 104857600<b.byteSize?(ua.warn("Node is too big to store in IndexedDB cache: "+a.id+" ("+b.byteSize+" bytes)"),!1):0<b.byteSize}Object.defineProperty(b,"__esModule",{value:!0});var ua=g.getLogger("esri.views.3d.layers.SceneLayerView3D"),va=[1,1,1,1],ma=function(){return function(a,b,c,d,e,f,g){this.node=a;this.featureIds=b;this.objectHandle=c;this.cachedRendererVersion=
d;this.attributeInfo=e;this.material=f;this.textures=g;this.cachedEdgeMaterials=[];this.cachedSymbology=null}}();b.I3SMeshView3D=function(b){return function(b){function g(){var a=null!==b&&b.apply(this,arguments)||this;a._elevationProvider=null;a._intersectionHandler=null;a._nodeId2Meta=new Map;a._addTasks=new Map;a._rendererVersion=0;a._colorVariable=null;a._opacityVariable=null;a._rendererFields=null;a._symbologyFields=null;a._symbologyOverride=null;a._symbologyOverrideFields=null;a._symbolInfos=
new Map;a._idbCache=new X.IDBCache("esri-scenelayer-cache","geometries");a._labeler=null;a.holeFilling="auto";a._hasColors=!1;a._hasTextures=!1;a._hasData=!1;a.slicePlaneEnabled=!1;a._modifications=[];a._layerUrl="";a._cacheKeySuffix=null;a._arcade=null;a._tmpAttributeOnlyGraphic=new h(null,null,{});return a}a.__extends(g,b);Object.defineProperty(g.prototype,"layerUid",{get:function(){return this.layer&&this.layer.uid},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"sublayerUid",
{get:function(){return null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"updatingMeshView3D",{get:function(){return!(!this._controller||!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle||c.isSome(this._labeler)&&this._labeler.updating},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"hasTexturesOrVertexColors",{get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"},enumerable:!0,configurable:!0});
Object.defineProperty(g.prototype,"rendererTextureUsage",{get:function(){return T.rendererNeedsTextures(this._currentRenderer)?63:44},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"elevationOffset",{get:function(){var a=null!=this.layer?this.layer.elevationInfo:null;if(null!=a&&"absolute-height"===a.mode){var b=t.getMetersPerVerticalUnitForSR(this.layer.spatialReference),d=N.getMetersPerUnit(a.unit);return c.unwrapOr(a.offset,0)*d/b}return 0},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"uncompressedTextureDownsamplingEnabled",{get:function(){return this.view&&this.view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&!this.useCompressedTextures},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"useCompressedTextures",{get:function(){var a=this.layer.version,a=!f("trident")||1<a.major||1===a.major&&3<a.minor;return this.view._stage.renderView.has("s3tc")&&a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_enableMipMaps",{get:function(){return!this.uncompressedTextureDownsamplingEnabled},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_enableAtlasMipMaps",{get:function(){return this._enableMipMaps},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_atlasBiasCompensationEnabled",{get:function(){return this.view&&this.view._stage&&!this.view._stage.renderView.has("shaderTextureLOD")&&this._enableAtlasMipMaps},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_disableAtlasAnisotropy",{get:function(){return this._atlasBiasCompensationEnabled},
enumerable:!0,configurable:!0});g.prototype.initialize=function(){var a=this;this._worker=new R.I3SMeshWorkerHandle(this.view.resourceController.scheduler);this.addResolvingPromise(this._worker.promise);this._worker.setLegacySchema(this.layerUid,this.layer.store.defaultGeometrySchema);T.checkSceneLayerValid(this.layer);T.checkSceneLayerCompatibleWithView(this.layer,this.view);this._layerUrl=this.layer.parsedUrl.path;this._controller=new H({layerView:this});this.geoMemoryEstimate=this.texMemoryEstimate=
this.gpuMemoryEstimate=0;this._stage=this.view._stage;this._collection=this._stage.renderView.componentObjectCollection;this._highlights=new O({collection:this._collection,forAllFeatures:function(b){return a._forAllFeatures(b,null,1)},forAllFeaturesOfNode:function(b,c){return a._forAllFeaturesOfNode(b,c)}});if(this._isIntegratedMesh||!this.layer.store.defaultGeometrySchema)this._hasSymbolColors=!1;else{var b=this.layer.store.defaultGeometrySchema.featureAttributes;this._hasSymbolColors=!!(b&&b.faceRange&&
b.id)}this._hasVertexColors=null!=this.layer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.layer.cachedDrawingInfo||!this.layer.cachedDrawingInfo.color);this._isIntegratedMesh||(this._edgeView=this._stage.renderView.ensureEdgeView());this._memCache=this.view.resourceController.memoryController.getMemCache(this.layer.uid,function(b){return a._deleteComponentObject(b)});this._intersectionHandler=new ba.I3SIntersectionHandler({layerUid:this.layerUid,sublayerUid:this.sublayerUid,collection:this._collection,
slicePlaneEnabled:this.slicePlaneEnabled,isGround:this._isIntegratedMesh,forEach:function(b){return a._nodeId2Meta.forEach(function(a){return c.isSome(a)&&b(a.node,a.objectHandle)})}});this._elevationProvider=new U({layerView:this,intersectionHandler:this._intersectionHandler});this.updatingHandles.add(this,"view.clippingArea",function(){return a._clippingAreaChanged()},2);this.updatingHandles.add(this,"fullOpacity",function(b){return a._opacityChange(b)});this.updatingHandles.add(this,"slicePlaneEnabled",
function(b){return a._slicePlaneEnabledChange(b)});this.updatingHandles.add(this,"elevationOffset",function(b,c){a._reloadAll(c);a._controller.recomputeAuthorativeOBBs()});this.updatingHandles.add(this,"filter",function(){return a._filterChange()},2);this.updatingHandles.add(this,"view.qualitySettings.physicallyBasedRenderingEnabled",function(){return a._updatePBR()});b=function(){a._reloadAll();a._memCache.clear()};this.updatingHandles.add(this,"rendererTextureUsage",b);this.updatingHandles.add(this,
"uncompressedTextureDownsamplingEnabled",b);this.updatingHandles.add(this,"suspended",function(b){return a._suspendedChange(b)},2);this.updatingHandles.add(this.layer,"labelsVisible",function(){return a._labelingChanged()},2);this.updatingHandles.add(this.layer,"labelingInfo",function(){return a._labelingChanged()},2);this.updatingHandles.add(this,"_modifications",function(){return a._modificationsChanged()},2);this.handles.add([u.init(fa,"I3S_TREE_SHOW_TILES",function(b){if(b&&!a._treeDebugger){var c=
a._controller.crsIndex;(new Promise(function(a,b){n(["./support/I3STreeDebugger"],a,b)})).then(function(b){b=b.I3STreeDebugger;!a._treeDebugger&&fa.I3S_TREE_SHOW_TILES&&(a._treeDebugger=new b({lv:a,view:a.view,nodeSR:c}))})}else b||!a._treeDebugger||fa.I3S_TREE_SHOW_TILES||(a._treeDebugger.destroy(),a._treeDebugger=null)}),u.init(fa,"I3S_SHOW_MODIFICATIONS",function(){return a._showModifications()})]);this._cacheKeySuffix=T.getCacheKeySuffix(this.layer.spatialReference,this.view.renderSpatialReference);
this._idbCache.init().catch(function(a){return ua.warn("Failed to initialize IndexedDB cache: "+a)});this._componentColorManager=this._hasSymbolColors?new na.BufferManager(this._stage.renderView.renderingContext):null};g.prototype.destroy=function(){this._clearAddTasks();this._elevationProvider&&(this._elevationProvider.layerChanged(),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null);this._intersectionHandler&&(this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),
this._intersectionHandler=null);var a=this._worker;a&&(a.destroyContext(this.layer.uid).then(function(){return a.destroy()}),this._worker=null);this._removeAllNodeDataFromStage();this._memCache.destroy();this._stage=this._collection=this._memCache=null;c.isSome(this._labeler)&&(this._labeler.destroy(),this._labeler=null);this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null);this._controller&&(this._controller.destroy(),this._controller=null);this._highlights.destroy();this._nodeId2Meta=
null;this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)};g.prototype.memEstimateTextureAdded=function(a){a=a.estimatedTexMemRequired;this.gpuMemoryEstimate+=a;this.texMemoryEstimate+=a;return a};g.prototype.memEstimateTextureRemoved=function(a){a=a.estimatedTexMemRequired;this.gpuMemoryEstimate-=a;this.texMemoryEstimate-=a};g.prototype.memEstimateGeometryAdded=function(a){a=
this._collection.getObjectMemoryUsageGPU(a);this.gpuMemoryEstimate+=a;this.geoMemoryEstimate+=a;return a};g.prototype.memEstimateGeometryRemoved=function(a){a=this._collection.getObjectMemoryUsageGPU(a);this.gpuMemoryEstimate-=a;this.geoMemoryEstimate-=a};g.prototype.isNodeLoaded=function(a){return this._nodeId2Meta.has(a)};g.prototype.getUsedMemory=function(){var a=c.isSome(this._labeler)?this._labeler.usedMemory:0;this._nodeId2Meta.forEach(function(b){return a+=c.isSome(b)?b.node.memory:0});return a};
g.prototype.getUnloadedMemory=function(){return(this._controller?this._controller.unloadedMemoryEstimate:0)+(c.isSome(this._labeler)?this._labeler.unloadedMemoryEstimate:0)};g.prototype.ignoresMemoryFactor=function(){return!1};g.prototype._labelingChanged=function(){var a=this;if(!G.areLabelsVisible(this.layer)||!this._supportsLabeling)c.isSome(this._labeler)&&(this._labeler.destroy(),this._labeler=null);else if(!c.isSome(this._labeler)){var b=new Q.default({view:this.view,layer:this.layer,collection:this._collection});
this._nodeId2Meta.forEach(function(d){return c.isSome(d)&&a._addMetaToLabeler(b,d)});this._labeler=b}};g.prototype._modificationsChanged=function(){this._worker.setModifications(this.layer.uid,this._modifications,this.layer.spatialReference);this._reloadAll();this._memCache.clear();this._controller.recomputeAuthorativeOBBs();this._showModifications()};g.prototype._showModifications=function(){c.isSome(this._modificationGraphics)&&(this.view.graphics.removeMany(this._modificationGraphics),this._modificationGraphics=
null);if(fa.I3S_SHOW_MODIFICATIONS&&0!==this._modifications.length){var b={clip:[227,227,79,.8],mask:[227,139,79,.8],replace:[139,227,79,.8]},d={type:"simple-fill",outline:{color:[255,255,255],width:1}};this._modificationGraphics=[];for(var e=0,f=this._modifications;e<f.length;e++){var g=f[e];g.geometry.spatialReference=this.layer.spatialReference;var k=a.__assign(a.__assign({},d),{color:b[g.type]});this._modificationGraphics.push(new h({geometry:g.geometry,symbol:k}))}this.view.graphics.addMany(this._modificationGraphics)}};
g.prototype._addMetaToLabeler=function(a,b){var c=this;a.addNodeMeta(b,function(a,b){return c._createAttributes(a,b)})};g.prototype._suspendedChange=function(a){a?(this._removeAllNodeDataFromStage(),this.view.elevationProvider&&this.view.elevationProvider.unregister(this._elevationProvider),this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler)):(this.view.elevationProvider.register(this._elevationContext,this._elevationProvider),this._stage.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler))};
g.prototype.getLoadedAttributes=function(a){a=this._nodeId2Meta.get(a);if(c.isSome(a)&&c.isSome(a.attributeInfo))return a.attributeInfo.loadedAttributes};g.prototype.getAttributeData=function(a){a=this._nodeId2Meta.get(a);if(c.isSome(a)&&c.isSome(a.attributeInfo))return a.attributeInfo.attributeData};g.prototype.setAttributeData=function(a,b){var d=this;a=this._nodeId2Meta.get(a);c.isSome(a)&&(a.attributeInfo=b,a.cachedRendererVersion=this._getInvalidRendererVersion(),a.filteredIds=null,c.isSome(this._labeler)&&
this._labeler.setNodeMetaAttributes(a,function(a,b){return d._createAttributes(a,b)}),this._updateEngineObject(a))};g.prototype.getVisibleNodes=function(){var a=[];this._nodeId2Meta.forEach(function(b){return c.isSome(b)&&a.push(b.node)});return a};g.prototype.getLoadedNodeIndices=function(a){this._nodeId2Meta.forEach(function(b,c){return a.push(c)})};g.prototype._createTexture=function(a,b,e,f){if(c.isNone(e)||null==e.data)return null;var g=e.data,h=b.wrapTextures;b=e.usage&1?"opaque"===b.alphaMode?
3:4:3;var k=!0,l;e.encoding===T.DDS_ENCODING_STRING?l=aa.DDS_ENCODING:k=d.isPowerOfTwo(g.width)&&d.isPowerOfTwo(g.height);k=(f?this._enableAtlasMipMaps:this._enableMipMaps)&&k;e=new aa(g,a.id+"/"+e.id,{mipmap:k,wrap:f||!h?{s:33071,t:33071}:{s:10497,t:10497},disableAnisotropy:f&&k&&this._disableAtlasAnisotropy,encoding:l,noUnpackFlip:!0,components:b});this._stage.add(4,e);a.memory+=this.memEstimateTextureAdded(e);return e};g.prototype._getVertexBufferLayout=function(a,b){a={hasTexture:ja(a.params.material),
hasNormals:b.normal,hasRegions:b.uvRegion};return la.glLayout(ia.createVertexBufferLayout(this._getGeometryParameters(a)))};g.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};g.prototype._findGraphicNodeAndIndex=function(a){var b=Y.attributeLookup(a.attributes,this._getObjectIdField()),d=null;l.someMap(this._nodeId2Meta,function(a){if(c.isNone(a))return!1;var e=a.featureIds.indexOf(b);if(-1===e)return!1;d={node:a.node,index:e};return!0});return d};g.prototype._getGraphicIndices=
function(a,b){a=this._nodeId2Meta.get(a.index);if(c.isNone(a))return[];for(var d=[],e=this._getObjectIdField(),f=0;f<b.length;f++){var g=Y.attributeLookup(b[f].attributes,e),g=a.featureIds.indexOf(g);-1!==g&&d.push(g)}return d};g.prototype.whenGraphicBounds=function(a){a=this._findGraphicNodeAndIndex(a);if(!a)return k.reject();var b=this._nodeId2Meta.get(a.node.index);if(c.isNone(b))return k.reject();a=P.boundingBoxCornerPoints(a.index,this._collection,b.objectHandle,new Float64Array(24));if(ka.bufferToBuffer(a,
this.view.renderSpatialReference,0,a,this.view.spatialReference,0,8))return b=F.empty(),F.expandWithBuffer(b,a,0,8),k.resolve({boundingBox:b,screenSpaceObjects:[]})};g.prototype.whenGraphicAttributes=function(a,b){var c=this;return T.whenGraphicAttributes(this.layer,a,this._getObjectIdField(),b,function(a){for(var b=new Map,d=[],e=0;e<a.length;e++){var f=a[e],g=c._findGraphicNodeAndIndex(f),h=b.get(g.node);h||(h={node:g.node,indices:[],graphics:[]},d.push(h));h.indices.push(g.index);h.graphics.push(f)}return d},
{populateObjectId:!0})};g.prototype.getGraphicFromIntersectorMetadata=function(a){if(null==a.nodeIndex||null==a.componentIndex)return null;var b=this._nodeId2Meta.get(a.nodeIndex);return c.isNone(b)||null==b.featureIds||a.componentIndex>=b.featureIds.length?null:this._createGraphic(a.componentIndex,b)};g.prototype._getCacheKey=function(a){return this._layerUrl+"/v15/"+a.id+this._cacheKeySuffix};g.prototype._getMemCacheKey=function(a,b){void 0===b&&(b=this.elevationOffset);return a+"#"+b};Object.defineProperty(g.prototype,
"_idbCacheEnabled",{get:function(){return!this._controller.disableIDBCache&&0===this._modifications.length&&0===this.elevationOffset&&null!=this._cacheKeySuffix},enumerable:!0,configurable:!0});g.prototype.loadCachedGPUData=function(a){return this._memCache.pop(this._getMemCacheKey(a.index))};g.prototype._cacheGPUData=function(a,b){void 0===b&&(b=this.elevationOffset);var c=this._controller.indexDepth-a.node.level+1;this._memCache.put(this._getMemCacheKey(a.node.index,b),a,a.node.memory,c)};g.prototype.loadMissingTextures=
function(a,b,d,e){var f=this,g=a.filter(function(a,d){if(0===(a.usage&f.rendererTextureUsage))return!1;if(c.isNone(b))return!0;a=T.selectEncoding(a.encodings,f.useCompressedTextures);d=b[d];return c.isNone(d)||null==d.data||a&&d.encoding!==a.encoding?!0:!1});return 0===g.length?k.resolve(!1):d(g,e).then(function(c){for(var d=0,e=0;e<a.length;e++)d<c.length&&c[d].id===a[e].id&&(b[e]=c[d],d++);return!0})};g.prototype.loadCachedNodeData=function(a,b,d){var e=this;return this._idbCacheEnabled?this._idbCache.get(this._getCacheKey(a),
b).then(function(f){if(null==f)return null;if(f.nodeVersion!==a.version)return e._idbCache.remove(e._getCacheKey(a)),null;a.obb||e._setComputedObb(a,f.nodeObb);return e.loadMissingTextures(f.requiredTextures,f.textureData,d,b).then(function(d){d&&e._idbCache.initialized&&c.isSome(f.textureData)&&(f.byteSize=ra(f.transformedGeometry,f.textureData),f.textureData.every(ta)&&xa(a,f)&&e._idbCache.put(e._getCacheKey(a),f).catch(function(b){return ua.warn("Failed to update node with textures in IndexedDB cache: "+
a.id+": "+b)}));k.throwIfAborted(b);return f})}):k.resolve(null)};g.prototype.addNodeData=function(b,d,e){var f=this;return"geometryData"in d?this._addData(b,d.attributeDataInfo,function(){return f._transformNode(b,d,e).then(function(g){return f._controller.reschedule(e,function(){if(c.isNone(g))return f._addCachedNodeData(b,null,e);var h=g.obb,k=g.componentOffsets,l=g.featureIds,m=g.transformedGeometry,h=ga.create([h.center.x,h.center.y,h.center.z],[h.extents.x,h.extents.y,h.extents.z],[h.orientation.x,
h.orientation.y,h.orientation.z,h.orientation.w]),n=f._controller.crsIndex,p=f.view.renderSpatialReference,q=V.computeGlobalTransformation(b.mbs,f.elevationOffset,n,p);A.vec3.transformMat4(h.center,h.center,q);ka.bufferToBuffer(h.center,p,0,h.center,n,0,1);h.center[2]-=f.elevationOffset;n=b.obb;c.isNone(n)&&(n=f._setComputedObb(b,h));d.geometryData.componentOffsets=k;l&&(d.geometryData.featureIds=Array.prototype.slice.call(l));k={nodeVersion:b.version,geometryData:d.geometryData,requiredTextures:d.requiredTextures,
textureData:d.textureData,transformedGeometry:m,globalTrafo:q,nodeObb:n,byteSize:ra(m,d.textureData)};f._idbCacheEnabled&&f._idbCache.initialized&&xa(b,k)&&(l=c.isSome(k.textureData)?k.textureData.map(function(a){return ta(a)?a:null}):null,f._idbCache.put(f._getCacheKey(b),a.__assign(a.__assign({},k),{textureData:l})).catch(function(a){return ua.warn("Failed to store node in IndexedDB cache: "+b.id+": "+a)}));return f._addCachedNodeData(b,k,e)})})}):k.reject()};g.prototype.computeAuthorativeOBB=function(a){return T.computeAuthorativeOBB(a,
this.view.renderSpatialReference,this._controller.crsIndex,this.layer.spatialReference,this.elevationOffset,this._modifications)};g.prototype._setComputedObb=function(a,b){a.obb=ga.clone(b);a.isComputedObb=!0;this._controller.updateBoundingVolume(a.index);return a.obb};g.prototype._transformNode=function(a,b,d){for(var e=b.geometryData.geometries,f=Array(e.length),g=0;g<e.length;++g)f[g]=this._getVertexBufferLayout(e[g],b.geometryDescriptor);var e=a.mbs,h=this.elevationOffset,k=this._controller.crsIndex,
l=this._controller.crsVertex,m=this.view.renderSpatialReference,g=V.getLocalOrigin(e,h,k),h=V.computeGlobalTransformation(e,h,k,m),k=ka.getProjectorName(k,l),l=ka.getProjectorName(l,m);return c.isNone(k)||c.isNone(l)?null:this._worker.invoke({context:this.layer.uid,geometryBuffer:b.geometryBuffer,geometryData:b.geometryData,geometryDescriptor:b.geometryDescriptor,layouts:f,localOrigin:g,globalTrafo:h,mbs:e,obb:a.obb,elevationOffset:this.elevationOffset,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,
normalReferenceFrame:this.layer.normalReferenceFrame||"none",indexToVertexProjector:k,vertexToRenderProjector:l},d)};g.prototype.addCachedGPUData=function(a,b,d){this._controller.isGeometryVisible(a)?(c.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,b),this._addNodeMeta(a.index,b),this.updateNodeState(a.index,d),this._collection.setObjectVisibility(b.objectHandle,!0),this._updateMaterial(b),this._updateEngineObject(b),this._highlights.objectCreated(b),this._treeDebugger&&this._treeDebugger.update()):
this._cacheGPUData(b)};g.prototype.addCachedNodeData=function(a,b,c,d){var e=this;return this._addData(a,c,function(){return e._addCachedNodeData(a,b,d)})};g.prototype._addCachedNodeData=function(a,b,d){var e=this;if(this.suspended||!this._controller.isGeometryVisible(a))return k.resolve();if(c.isNone(b))return this._addNodeMeta(a.index,null),k.resolve();var f=b.geometryData,g=b.transformedGeometry,h=b.globalTrafo,l=c.isSome(b.textureData)?b.textureData.filter(function(a){return c.isSome(a)&&0!==
(a.usage&e.rendererTextureUsage)}):null;a.memory=0;var m=f.componentOffsets,n=f.geometries,f=f.featureIds,p=null,r=null;if(this._hasSymbolColors)for(var p=this._componentColorManager.getBuffer(f.length),r=new Uint16Array(f.length),t=0;t<f.length;t++)r[t]=p.acquireIndex();var u=this._collection,n=n[0],p=g.layout,r=g.indices,t=g.interleavedVertexData,v=g.positionData,g=g.hasColors,A=this._materialParameters(n,p),m=m||new Uint32Array([0,r?r.length:t.byteLength/p[0].stride]),m={vertices:{data:t,count:t.byteLength/
p[0].stride,layoutParameters:A.geometryParams},positionData:{positions:v.data,indices:v.indices},indices:r,primitiveType:4,componentOffsets:m},p=n.transformation?y.mat4f64.clone(n.transformation):y.mat4f64.create();q.mat4.multiply(p,h,p);var h=q.mat4.getTranslation(B.vec3f64.create(),p),p=z.mat3.fromMat4(w.mat3f32.create(),p),r=this.view.renderSpatialReference,t=this.view.basemapTerrain.spatialReference,v=B.vec3f64.create(),x=[1,1,1];ka.localLinearScaleFactors(h,r,x,t);ka.vectorToVector(h,r,v,t);
var C=u.createObject({toMapSpace:[v[0],v[1],x[0],x[1]],geometry:m,obb:c.unwrap(a.renderObb),transform:{position:h,rotationScale:p},visible:!1}),h={isSchematic:n.params.material.isSchematic,isOpaque:"blend"!==n.params.material.alphaMode&&1<=n.params.material.metallicRoughness.baseColorFactor[3]},m=c.isSome(l)?l.map(function(b){return e._createTexture(a,A.material,b,2===A.geometryParams.textureCoordinates)}):[];this._configureMaterial(C,n.params.material,m,l);a.memory+=this.memEstimateGeometryAdded(C);
var F=this._addTasks.get(a.index),G=new ma(a,f,C,this._getInvalidRendererVersion(),F.attributeInfo,h,m);F.meta=G;!this._hasTextures&&b.requiredTextures.some(function(a){return 0!==(a.usage&19)})&&(this._hasTextures=!0);this._hasData=!0;this._hasColors=this._hasColors||g;this._hasTextures=this._hasTextures||!!a.resources.texture;this.notifyChange("hasTexturesOrVertexColors");var H=this.slicePlaneEnabled;return this._addOrUpdateEdgeRendering(G).then(function(b){b&&e._edgeView.updateObjectVisibility(G.objectHandle,
!1);return e._controller.reschedule(d,function(){var d=e._addTasks.get(a.index);if(d)if(c.isSome(e._labeler)&&e._addMetaToLabeler(e._labeler,G),e._addNodeMeta(a.index,G),e.suspended)e._removeNodeStageData(a.index,e.elevationOffset);else{u.setObjectVisibility(C,!0);b&&e._edgeView.updateObjectVisibility(G.objectHandle,!0);G.attributeInfo=d.attributeInfo;var d=G.cachedRendererVersion!==e._rendererVersion,f=H!==e.slicePlaneEnabled;e._setObjectSymbolColors(G);var g=e._applyFiltersToNode(G);(d||b&&(f||
g))&&e._addOrUpdateEdgeRendering(G);e.visibleGeometryChanged(G);e._highlights.objectCreated(G);e._updateMaterial(G);e._treeDebugger&&e._treeDebugger.update()}})}).catch(function(a){c.isSome(F.meta)&&e._deleteComponentObject(F.meta);throw a;})};g.prototype._addNodeMeta=function(a,b){if(this._nodeId2Meta.has(a)){ua.error("Removing duplicated node");var d=this._nodeId2Meta.get(a);c.isSome(d)&&this._deleteComponentObject(d)}this._nodeId2Meta.set(a,b)};g.prototype._materialParameters=function(a,b){a=a.params.material;
var c=b.some(function(a){return"uvRegion"===a.name});b=b.some(function(a){return"normalCompressed"===a.name});var d=ja(a);return{geometryParams:this._getGeometryParameters({hasTexture:d,hasNormals:b,hasRegions:c}),material:a}};g.prototype._configureMaterial=function(a,b,e,f){var g=this,h=this.rendererTextureUsage,k=function(a){a:{a&=h;if(!c.isNone(f)&&0!==a)for(var b=0;b<f.length;b++){var d=f[b];if(c.isSome(d)&&0!==(d.usage&a)){a=e[b].id;break a}}a=null}return a};this._collection.updateMaterial(a,
function(a){var c=b.metallicRoughness.baseColorFactor,e=d.clamp(b.metallicRoughness.baseColorFactor[3],0,1);a.baseColor=[c[0],c[1],c[2],e];a.objectOpacity=g.fullOpacity;a.mrrFactors=[b.metallicRoughness.metallicFactor,b.metallicRoughness.roughnessFactor,b.isSchematic?.2:.5];a.emissiveFactor=b.emissiveFactor;a.usePBR=g._usePBR(b.isSchematic);a.isIntegratedMesh=g._isIntegratedMesh;a.alphaCutoff="mask"===b.alphaMode?b.alphaCutoff:oa.defaultMaskAlphaCutoff;a.alphaDiscardMode="opaque"===b.alphaMode?1:
"mask"===b.alphaMode?2:3;c=g._stage.renderView.textureRepository;if(e=k(33))a.baseColorTexture=new Z.RenderTexture(c,e);if(e=k(2))a.metallicRoughnessTexture=new Z.RenderTexture(c,e);if(e=k(16))a.emissionTexture=new Z.RenderTexture(c,e);if(e=k(8))a.occlusionTexture=new Z.RenderTexture(c,e);if(e=k(4))a.normalTexture=new Z.RenderTexture(c,e);a.commonMaterialParameters.slicePlaneEnabled=g.slicePlaneEnabled;a.commonMaterialParameters.doubleSided=b.doubleSided;a.commonMaterialParameters.cullFace=b.cullFace;
g._updateMaterialOverlay(a)})};g.prototype._getGeometryParameters=function(a){return{textureCoordinates:a.hasTexture?a.hasRegions?2:1:0,colors:this._hasVertexColors,normals:a.hasNormals&&!this._isIntegratedMesh}};g.prototype._addData=function(b,c,d){var e=this,f=this._addTasks.get(b.index);f?f.attributeInfo=c:(f=a.__assign(a.__assign({},k.createResolver()),{attributeInfo:c,meta:null}),this._addTasks.set(b.index,f),d().then(f.resolve,f.reject).then(function(){return e._addTasks.delete(b.index)}).catch(function(a){e._addTasks.delete(b.index);
throw a;}));return f.promise};g.prototype._clearAddTasks=function(){var a=this;this._addTasks.forEach(function(b){c.isSome(b.meta)&&a._deleteComponentObject(b.meta)});this._addTasks.clear()};g.prototype._clippingAreaChanged=function(){var a=F.create();ka.extentToBoundingBox(this.view.clippingArea,a,this.view.renderSpatialReference)?this._clippingArea=a:this._clippingArea=null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea)};g.prototype._filterChange=
function(){this._applyFilters(!1)};g.prototype._applyFilters=function(a){var b=this;this._filters=this.getFilters();a?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(function(a){c.isSome(a)&&b._applyFiltersToNode(a)&&(b._addOrUpdateEdgeRendering(a),b.visibleGeometryChanged(a))})};g.prototype.getFilters=function(){var a=this,b=[];this._clippingArea&&b.push(function(b,c){return a._boundingboxFilter(b,c,a._clippingArea)});return b};g.prototype.addSqlFilter=function(a,b,c,
d){var e=this;b&&c&&a.push(function(a,f){return e._sqlFilter(a,f,b,c,d)})};g.prototype._sqlFilter=function(a,b,d,e,f){var g={},h=this._createLayerGraphic(g),k=this.layer.objectIdField,l=b.featureIds,m=c.isSome(b.attributeInfo)&&b.attributeInfo.attributeData;e.every(function(a){return null!=m[a]||a===k})&&T.filterInPlace(a,l,function(a){g[k]=l[a];for(var b=0;b<e.length;b++){var c=e[b];c!==k&&(g[c]=T.getCachedAttributeValue(m[c],a))}try{if(Array.isArray(d)){for(a=0;a<d.length;a++)if(d[a].testFeature(h))return!0;
return!1}return d.testFeature(h)}catch(ob){return f(ob),!1}})};g.prototype._boundingboxNodeTest=function(a,b){ka.mbsToMbs(a.node.mbs,this._controller.crsIndex,Sa,this.view.renderSpatialReference);return T.intersectBoundingBoxWithMbs(b,Sa)};g.prototype._boundingboxFeatureTest=function(a,b,c){return F.intersects(c,this._collection.getComponentAABB(a.objectHandle,b,sa))};g.prototype._boundingboxFilter=function(a,b,c){var d=this,e=this._collection,f=this._boundingboxNodeTest(b,c);if(3!==f)if(0===f)a.length=
0;else if(e=e.getComponentCount(b.objectHandle),e.invisible+e.visible===b.featureIds.length){var g=this._transformAABB(qa,c,b.objectHandle);T.filterInPlace(a,b.featureIds,function(a){return d._boundingboxFeatureTest(b,a,g)})}};g.prototype._transformAABB=function(a,b,c){var d=this._collection.getObjectTransform(c);c=d.position;d=d.rotationScale;a[0]=(b[0]-c[0])/d[0];a[1]=(b[1]-c[1])/d[4];a[2]=(b[2]-c[2])/d[8];a[3]=(b[3]-c[0])/d[0];a[4]=(b[4]-c[1])/d[4];a[5]=(b[5]-c[2])/d[8];return a};g.prototype._addOrUpdateEdgeRendering=
function(a,b){void 0===b&&(b=!0);if(!this._edgeView)return k.resolve(!1);var c=a.objectHandle,d=this._edgeView.hasObject(c);a=this._getFilteredEdgeMaterials(a);var e=a.perFeatureEdgeMaterials,f={slicePlaneEnabled:this.slicePlaneEnabled};if(a.hasEdges)return d?(this._edgeView.updateAllComponentMaterials(c,e,f,b),this._edgeView.updateObjectVisibility(c,!0),k.resolve(!0)):this._collection.addEdges(c,this._edgeView,e,f).then(function(){return!0});d&&this._edgeView.removeObject(c);return k.resolve(!1)};
g.prototype._removeEdgeRendering=function(a){this._edgeView&&this._edgeView.hasObject(a.objectHandle)&&this._edgeView.removeObject(a.objectHandle)};g.prototype._applyFiltersToNode=function(a){return this._applyFiltersToNodeComponents(a)?(c.isSome(this._labeler)&&this._labeler.applyFilterChange(a),!0):!1};g.prototype._applyFiltersToNodeComponents=function(a){var b=this._collection,c=0===b.getComponentCount(a.objectHandle).invisible;b.setAllComponentVisibilities(a.objectHandle,"all");if(0===this._filters.length)return a.filteredIds=
null,!c;this._updateCachedFilteredIds(a);if(a.filteredIds===a.featureIds)return!c;c=this._computeFilteredComponentIndices(a);b.setAllComponentVisibilities(a.objectHandle,c);return!0};g.prototype._updateCachedFilteredIds=function(a){if(null==a.filteredIds||a.appliedFilters!==this._filters)a.filteredIds=this._computeFilteredIds(a),a.appliedFilters=this._filters};g.prototype._computeFilteredIds=function(a){for(var b=a.featureIds.slice(),c=0,d=this._filters;c<d.length&&((0,d[c])(b,a),0!==b.length);c++);
return b.length===a.featureIds.length?a.featureIds:b};g.prototype._computeFilteredComponentIndices=function(a){var b=[];a.featureIds.forEach(function(c,d){a.filteredIds[b.length]===c&&b.push(d)});return b};g.prototype._removeAllNodeDataFromStage=function(a){var b=this;void 0===a&&(a=this.elevationOffset);this._nodeId2Meta.forEach(function(c,d){return b._removeNodeStageData(d,a)})};g.prototype.removeNodeData=function(a,b){for(var c=this.elevationOffset;0<a.length&&!b.done;){var d=a.pop();this._removeNodeStageData(d,
c);b.madeProgress()}};g.prototype._removeNodeStageData=function(a,b){var d=this._nodeId2Meta.get(a);c.isNone(d)?this._nodeId2Meta.delete(a):(this._collection.setObjectVisibility(d.objectHandle,!1),this.visibleGeometryChanged(d),this._removeEdgeRendering(d),c.isSome(this._labeler)&&this._labeler.removeNodeMeta(d),this._nodeId2Meta.delete(a),this._highlights.objectDeleted(d),this._cacheGPUData(d,b),this._treeDebugger&&this._treeDebugger.update())};g.prototype._deleteComponentObject=function(a){this._edgeView&&
this._edgeView.removeObject(a.objectHandle);this.memEstimateGeometryRemoved(a.objectHandle);this._collection.destroyObject(a.objectHandle);if(a.textures){var b=0;for(a=a.textures;b<a.length;b++){var c=a[b];this.memEstimateTextureRemoved(c);this._stage.remove(4,c.id)}}};g.prototype.updateNodeState=function(a,b){a=this._nodeId2Meta.get(a);c.isSome(a)&&this._collection.updateMaterial(a.objectHandle,function(a){return a.polygonOffsetEnabled=0===b})};g.prototype._invalidateAllSymbols=function(){this._rendererVersion=
T.addWraparound(this._rendererVersion,1);this._controller&&this._controller.requestUpdate()};g.prototype._getInvalidRendererVersion=function(){return T.addWraparound(this._rendererVersion,-1)};g.prototype._rendererChange=function(b){return a.__awaiter(this,void 0,void 0,function(){var c,d,e,f,g,h,k,l,m,n;return a.__generator(this,function(a){switch(a.label){case 0:this._currentRenderer=b;this.notifyChange("rendererTextureUsage");this._rendererVersion=T.addWraparound(this._rendererVersion,1);this._opacityVariable=
this._colorVariable=this._rendererFields=null;this._invalidateAllSymbols();if(!b)return[3,2];c=this;d=I.fixFields;e=[this.layer.fields];return[4,b.getRequiredFields(this.layer.fields)];case 1:c._rendererFields=d.apply(void 0,e.concat([a.sent()])),a.label=2;case 2:this._updateSymbologyFields();if(!(!this._arcade&&b&&"arcadeRequired"in b&&b.arcadeRequired))return[3,4];f=this;return[4,L.loadArcade()];case 3:f._arcade=a.sent(),a.label=4;case 4:if(b&&"visualVariables"in b&&b.visualVariables)for(g=0,h=
b.visualVariables;g<h.length;g++)k=h[g],"color"===k.type?this._colorVariable=k:"opacity"===k.type?this._opacityVariable=k:ua.warn("Unsupported visual variable type for 3D Object Scene Services: "+k.type);if(b)for(l=0,m=b.getSymbols();l<m.length;l++)n=m[l],"mesh-3d"!==n.type&&ua.error("Symbols of type '"+n.type+"' are not supported for 3D Object Scene Services.");this._controller&&this._controller.requestUpdate();return[2]}})})};g.prototype._getCachedEdgeMaterials=function(a){this._hasSymbolColors&&
a.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(a);return a.cachedEdgeMaterials};g.prototype._getSymbolColors=function(a){this._hasSymbolColors&&a.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(a);var b=a.cachedSymbology;return function(a,c){a*=5;C.vec4.set(c.externalColor,b[a+0]/255,b[a+1]/255,b[a+2]/255,b[a+3]/255);c.externalColorMixMode=b[a+4]&15;c.castShadows=0!==(b[a+4]&16);c.pickable=0!==(b[a+4]&32)}};g.prototype._getSymbolInfo=
function(a,b){b=a&&a.getSymbol(b,{arcade:this._arcade});if(!(b instanceof M))return null;a=b.id;if(this._symbolInfos.has(a))return this._symbolInfos.get(a);b=T.getSymbolInfo(b);this._symbolInfos.set(a,b);return b};g.prototype._setSymbologyOverride=function(a,b){this._symbologyOverride!==a&&(this._symbologyOverride=a,this._symbologyOverrideFields=b,this._invalidateAllSymbols(),this._updateSymbologyFields())};g.prototype._updateSymbologyFields=function(){this._symbologyFields=c.isSome(this._symbologyOverrideFields)&&
0<this._symbologyOverrideFields.length?c.isSome(this._rendererFields)&&0<this._rendererFields.length?I.fixFields(this.layer.fields,a.__spreadArrays(this._rendererFields,this._symbologyOverrideFields)):this._symbologyOverrideFields:this._rendererFields};g.prototype._updateCachedRendererData=function(b){b.cachedRendererVersion=this._rendererVersion;if(this._hasSymbolColors){var d=this._tmpAttributeOnlyGraphic,e={};d.attributes=e;var f=this._currentRenderer,g=c.isSome(b.attributeInfo)&&b.attributeInfo.attributeData,
h=null!=b.featureIds?this.layer.objectIdField:null,k=null!=g&&c.isSome(this._symbologyFields)&&0<this._symbologyFields.length,l=k?[]:null,m=k?[]:null;if(k&&c.isSome(this._symbologyFields))for(var n=0,p=this._symbologyFields;n<p.length;n++){var q=p[n],r=g[q];r&&(l.push(q),m.push(r))}b.cachedSymbology||(b.cachedSymbology=new Uint8Array(5*b.featureIds.length));for(var g={color:Ca,castShadows:!0,pickable:!0,colorMixMode:1,edgeMaterial:null},n=this.fullOpacity,p=null,q=2,r=T.transparentEdgeMaterial,t=
0,u=0;u<b.featureIds.length;u++){null!=h&&(e[h]=b.featureIds[u]);if(k)for(var v=0;v<l.length;v++)e[l[v]]=T.getCachedAttributeValue(m[v],u);var w=this._getSymbolInfo(f,d),y=v=null;if(f&&"visualVariables"in f){if(this._colorVariable){var A=E.getColor(this._colorVariable,d,{color:ha,arcade:this._arcade});A&&(v=Ca,v[0]=A.r/255,v[1]=A.g/255,v[2]=A.b/255,this._opacityVariable||null===A.a||(y=A.a))}this._opacityVariable&&(y=E.getOpacity(this._opacityVariable,d,{arcade:this._arcade}))}w&&w.material&&(A=w.material,
v=c.isNone(v)||c.isNone(y)?W.overrideColor(v,y,A.color,A.alpha,va,Ca):W.overrideColor(v,y,null,null,va,Ca));c.isNone(v)&&(v=Ca,v[0]=1,v[1]=1,v[2]=1,v[3]=1);g.pickable=!0;g.castShadows=w?w.castShadows:!0;g.colorMixMode=w&&w.material?w.material.colorMixMode:1;g.edgeMaterial=w?w.edgeMaterial:null;c.isSome(this._symbologyOverride)&&(g.color=v,this._symbologyOverride(d,g),v=g.color);if(c.isSome(g.edgeMaterial)){w=0>=v[3]?0:1<=v[3]&&(b.material.isOpaque||3===g.colorMixMode)?2:1;if(g.edgeMaterial!==p||w!==
q)r=a.__assign(a.__assign({},g.edgeMaterial),{opacity:n,objectTransparency:w}),p=g.edgeMaterial,q=w;b.cachedEdgeMaterials[u]=r}else b.cachedEdgeMaterials[u]=T.transparentEdgeMaterial;b.cachedSymbology[t+0]=Math.round(255*v[0]);b.cachedSymbology[t+1]=Math.round(255*v[1]);b.cachedSymbology[t+2]=Math.round(255*v[2]);b.cachedSymbology[t+3]=Math.round(255*v[3]);b.cachedSymbology[t+4]=g.colorMixMode|+g.castShadows<<4|+g.pickable<<5;t+=5}}};g.prototype._getFilteredEdgeMaterials=function(a){var b=this,d=
this._getCachedEdgeMaterials(a);d.forEach(function(a){return a.opacity=b.fullOpacity});if(c.isNone(a.filteredIds))return{hasEdges:d.some(function(a){return a!==T.transparentEdgeMaterial}),perFeatureEdgeMaterials:d};var e=0,f=!1,d=d.map(function(b,c){if(a.featureIds[c]!==a.filteredIds[e])return T.transparentEdgeMaterial;f=f||b!==T.transparentEdgeMaterial;e++;return b});return{hasEdges:f,perFeatureEdgeMaterials:d}};g.prototype._setObjectSymbolColors=function(a){if(this._hasSymbolColors){var b=a.objectHandle;
a=this._getSymbolColors(a);this._collection.setComponentData(b,a);this._stage.renderView.setNeedsRender()}};g.prototype._reloadAll=function(a){void 0===a&&(a=this.elevationOffset);this._removeAllNodeDataFromStage(a);null!=this._controller&&this._controller.restartNodeLoading()};g.prototype._opacityChange=function(a){var b=this;this._nodeId2Meta.forEach(function(d){c.isNone(d)||(b._collection.updateMaterial(d.objectHandle,function(b){return b.objectOpacity=a}),b._updateEdgeRendering(d))})};g.prototype._updateMaterial=
function(a){var b=this;this._collection.updateMaterial(a.objectHandle,function(c){c.commonMaterialParameters.slicePlaneEnabled=b.slicePlaneEnabled;c.usePBR=b._usePBR(a.material.isSchematic);c.objectOpacity=b.fullOpacity;b._updateMaterialOverlay(c)})};g.prototype._updateMaterialOverlay=function(a){};g.prototype._updateEngineObject=function(a){this._setObjectSymbolColors(a);this._applyFiltersToNode(a);this._addOrUpdateEdgeRendering(a);this.visibleGeometryChanged(a)};g.prototype._slicePlaneEnabledChange=
function(a){var b=this;this._intersectionHandler&&(this._intersectionHandler.slicePlane=a);c.isSome(this._labeler)&&(this._labeler.slicePlaneEnabled=a);this._nodeId2Meta.forEach(function(d){c.isNone(d)||(b._collection.updateMaterial(d.objectHandle,function(b){b.commonMaterialParameters.slicePlaneEnabled=a}),b._updateEdgeRendering(d,!1))})};g.prototype._updatePBR=function(){var a=this;this._nodeId2Meta.forEach(function(b){c.isNone(b)||a._collection.updateMaterial(b.objectHandle,function(c){c.usePBR=
a._usePBR(b.material.isSchematic)})})};g.prototype._usePBR=function(a){return!this._isIntegratedMesh&&(a?this.view.qualitySettings.physicallyBasedRenderingEnabled:!0)};g.prototype._updateEdgeRendering=function(a,b){void 0===b&&(b=!0);this._edgeView&&this._edgeView.hasObject(a.objectHandle)&&this._addOrUpdateEdgeRendering(a,b)};g.prototype._forAllNodes=function(a){this._nodeId2Meta.forEach(a)};g.prototype._forAllFeatures=function(a,b,d){var e=this;void 0===d&&(d=0);l.someMap(this._nodeId2Meta,function(f){if(c.isNone(f))return!1;
if(c.isSome(b))switch(b(f)){case 0:return!0;case 2:return!1}var g=1;switch(d){case 1:g=e._forAllFeaturesOfNode(f,a);break;case 0:g=e._forVisibleFeaturesOfNode(f,a);break;case 2:g=e._forAllFeaturesOfNodeInClippingArea(f,a)}return 0===g})};g.prototype._forAllFeaturesOfNode=function(a,b){for(var c=1,d=a.featureIds,e=0;e<d.length&&(c=b(d[e],e,a),0!==c);e++);return c};g.prototype._forVisibleFeaturesOfNode=function(a,b){var c=1,d=a.featureIds;this._collection.forEachVisibleComponent(a.objectHandle,function(e){c=
b(d[e],e,a);return 1===c});return c};g.prototype._forAllFeaturesOfNodeInClippingArea=function(a,b){if(null==this._clippingArea)return this._forAllFeaturesOfNode(a,b);var c=this._boundingboxNodeTest(a,this._clippingArea);if(0===c)return 1;if(3===c)return this._forAllFeaturesOfNode(a,b);for(var c=a.featureIds,d=T.getClipAABB(this._clippingArea,this._collection.getObjectTransform(a.objectHandle)),e=0;e<c.length;e++)if(this._boundingboxFeatureTest(a,e,d)){var f=b(c[e],e,a);if(0===f)return f}return 1};
g.prototype._createAttributes=function(a,b){var d={};null!=b.featureIds&&(d[this._getObjectIdField()]=b.featureIds[a]);b=c.isSome(b.attributeInfo)&&b.attributeInfo.attributeData;if(c.isSome(b))for(var e=0,f=Object.keys(b);e<f.length;e++){var g=f[e];d[g]=T.getCachedAttributeValue(b[g],a)}return d};g.prototype._createGraphic=function(a,b){return this._createLayerGraphic(this._createAttributes(a,b))};g.prototype.highlight=function(a){var b=this,c=this._highlights;"number"===typeof a?a=[a]:a instanceof
h?a=[a]:a instanceof e&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof h){a=a.map(function(a){return Y.attributeLookup(a.attributes,b._getObjectIdField())});var d=c.acquireSet(),f=d.set,d=d.handle;c.setFeatureIds(f,a);return d}if("number"===typeof a[0])return d=c.acquireSet(),f=d.set,d=d.handle,c.setFeatureIds(f,a),d}return nb};g.prototype.visibleGeometryChanged=function(a){var b=this;this._elevationProvider&&(this._elevationProvider.objectChanged(a.node),null==this._visibleGeometryChangedSchedulerHandle&&
(this._visibleGeometryChangedSchedulerHandle=p.schedule(function(){b.emit("visible-geometry-changed");b._visibleGeometryChangedSchedulerHandle=null})))};Object.defineProperty(g.prototype,"performanceInfo",{get:function(){var a={displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,core:null,index:0,nodes:this._nodeId2Meta.size,"Total GPU Memory Estimate":(this.gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this.geoMemoryEstimate/1048576).toFixed(1)+
"MB","Texture Memory Estimate":(this.texMemoryEstimate/1048576).toFixed(1)+"MB"};this._controller&&(this._idbCacheEnabled&&(a.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(a));return a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"test",{get:function(){var a=this;return{controller:this._controller,labeler:this._labeler,get visibleObjectIds(){var b=[];a._forAllFeatures(function(a){b.push(a);return 1},null,0);b.sort(function(a,b){return a-
b});return b},get numNodes(){return a._nodeId2Meta.size}}},enumerable:!0,configurable:!0});a.__decorate([v.property()],g.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);a.__decorate([v.property()],g.prototype,"view",void 0);a.__decorate([v.property()],g.prototype,"layer",void 0);a.__decorate([v.property()],g.prototype,"_controller",void 0);a.__decorate([v.property()],g.prototype,"_labeler",void 0);a.__decorate([v.property({dependsOn:["updatingMeshView3D"]})],g.prototype,"updating",void 0);
a.__decorate([v.property({dependsOn:["_controller.updating","_visibleGeometryChangedSchedulerHandle","_labeler.updating"]})],g.prototype,"updatingMeshView3D",null);a.__decorate([v.property({dependsOn:["_controller.rootNodeVisible"]})],g.prototype,"suspended",void 0);a.__decorate([v.property()],g.prototype,"holeFilling",void 0);a.__decorate([v.property(da.updatingProgress)],g.prototype,"updatingProgress",void 0);a.__decorate([v.property({readOnly:!0,aliasOf:"_controller.updatingProgress"})],g.prototype,
"updatingProgressValue",void 0);a.__decorate([v.property({readOnly:!0})],g.prototype,"hasTexturesOrVertexColors",null);a.__decorate([v.property({readOnly:!0})],g.prototype,"rendererTextureUsage",null);a.__decorate([v.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],g.prototype,"elevationOffset",null);a.__decorate([v.property({type:Boolean})],g.prototype,"slicePlaneEnabled",void 0);a.__decorate([v.property({dependsOn:["view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled",
"useCompressedTextures"]})],g.prototype,"uncompressedTextureDownsamplingEnabled",null);a.__decorate([v.property({dependsOn:["layer.version"]})],g.prototype,"useCompressedTextures",null);a.__decorate([v.property({type:[J]})],g.prototype,"_modifications",void 0);return g=a.__decorate([v.subclass("esri.views.3d.layers.I3SMeshView3D")],g)}(b)};var sa=F.create(),qa=F.create(),Ca=[0,0,0,0],ha=new m([0,0,0,0]),Sa=[0,0,0,0],nb={remove:function(){},pause:function(){},resume:function(){}}})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("require exports tslib ../../../core/Accessor ../../../core/arrayUtils ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../dehydratedFeatures ../../support/PromiseQueue ../../../views/3d/layers/i3s/I3SFrameTask ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SStreamDataController ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/support/projectionUtils ../../../views/support/layerViewUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J){function E(a,b){return l.isSome(a)&&a.length===b.length&&a.every(function(a){return 0<=L(b,a.name)})}function L(a,b){b=b.toLowerCase();for(var c=0;c<a.length;c++)if(a[c].name.toLowerCase()===b)return c;return-1}function M(a){return l.isSome(a)&&l.isSome(a.loadedAttributes)&&l.isSome(a.attributeData)}var N=g.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");n=function(b){function c(a){a=b.call(this,a)||this;a.screenSizeFactor=
0;a.featureTarget=5E4;a.fixedFeatureTarget=!1;a.updating=!0;a.updatingProgress=1;a.leafsReached=!1;a.scaleVisibilityEnabled=!0;a.uncompressedTextureDownsamplingEnabled=!1;a._featureLOD=1;a._stableFeatureLOD=!1;a._isIdle=!1;a._cameraDirty=!0;a._invisibleDirty=!1;a._newLoadingNodes=new d({deallocator:null});a._loadedNodeScales=new Map;a._downloadingCount=0;a._loadingNodes=new Map;a._updatingNodes=new Map;a._progressMaxNumNodes=1;a._poi=u.vec3f64.create();a._requiredAttributes=[];a._requiredAttributesDirty=
!0;a._updatesDisabled=!1;a.disableIDBCache=!1;a._disableMemCache=!1;a._restartNodeLoading=!1;a._fields=null;a._attributeStorageInfo=null;a._handles=new e;a._idleQueue=new q.default;a._elevationUpdateNodes=new d({deallocator:null});a._errorCount=0;return a}a.__extends(c,b);Object.defineProperty(c.prototype,"isMeshPyramid",{get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"isGraphics3D",
{get:function(){return"points"===this.layer.profile},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"streamDataController",{get:function(){var a=this.layerView.view.resourceController.createStreamDataRequester(2);return new F.default(a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"crsVertex",{get:function(){return H.getVertexCrs(this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"crsIndex",{get:function(){return H.getIndexCrs(this.layer)},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"rootNodeVisible",{get:function(){if(l.isSome(this._index)){var a=this._index.rootNode;if(l.isSome(a))return this._updateViewData(),this._index.isNodeVisible(a.index)}return!0},enumerable:!0,configurable:!0});c.prototype.initialize=function(){var a=this;this._disableMemCache=!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData;this._lodHandling=new B(this.layerView);var b=this.layerView.layer;this.layer=b;this._defaultGeometrySchema=
b.store.defaultGeometrySchema;this.disableIDBCache=f("disable-feature:idb-cache");"fields"in b&&(this._fields=b.fields,this._attributeStorageInfo=b.attributeStorageInfo);var c=k.all([this.layer.when(),this.layerView.when()]).then(function(){if(!a.destroyed&&a.layerView&&!a.layerView.destroyed){var c=a.layerView.view;a._setClippingArea(c.clippingArea);a._centerOnSurface=c.pointsOfInterest.centerOnSurfaceFrequent;var d=a.layerView.view.resourceController;a._handles.add([a._centerOnSurface.watch("renderLocation",
function(){return a._pointOfInterestChanged()}),d.memoryController.events.on("quality-changed",function(){return a._setCameraDirty()}),p.init(a.layerView,"suspended",function(b){var c=b?function(){return a._updateViewData()}:function(){return a._updateIdleState(!0)},e=b?function(){}:function(){return a._updateIdleState(!1)};a._idleStateCallbacks?(b&&a.cancelNodeLoading(),a.restartNodeLoading(),a._idleStateCallbacks.idleBegin=c,a._idleStateCallbacks.idleEnd=e):a._idleStateCallbacks=d.scheduler.registerIdleStateCallbacks(c,
e)}),y.addTask(a.layerView.view.resourceController.scheduler,{update:function(b,c){return a._frame(b,c)},needsUpdate:function(){return a.updating}}),a.watch("uncompressedTextureDownsamplingEnabled",function(){return a.restartNodeLoading()}),a.watch(["featureTarget","fixedFeatureTarget"],function(){a._setCameraDirty();a._stableFeatureLOD=!1}),c.state.watch("camera",function(){return a._setCameraDirty()}),a.layer.watch("elevationInfo",function(){return a._elevationInfoChanged()}),a.layer.watch(["minScale",
"maxScale"],function(){return a._scaleBoundsChanged()}),a.layerView.watch("lodFactor",function(){return a._setCameraDirty()}),a.layerView.watch("availableFields?",function(){return a._requiredFieldsChange()}),a.layerView.watch("holeFilling",function(b){return l.isSome(a._index)&&(a._index.holeFilling=b)})]);a._updateScaleHandles();a._viewportQueries=new I(a.crsIndex,c.renderCoordsHelper,c.state.camera,a._clippingArea,c.elevationProvider,a.layer.elevationInfo,{progressiveLoadFactor:a._getProgressiveLoadFactor(),
screenspaceErrorBias:a.lod,angleDependentLoD:.5>a.lod});a._index=new A.I3SIndex(b,a.streamDataController,a._viewportQueries,N,a.layerView.holeFilling,function(b){return a.layerView.isNodeLoaded(b)},function(b){return a._shouldLoadNode(b)},function(b){return a._enableFromGPUCache(b,1)},function(b){return a._needsUpdate(b)},function(){return!a.streamDataController.busy},function(b){return a.layerView.computeAuthorativeOBB?a.layerView.computeAuthorativeOBB(b):null})}});this._tmpPoint=w.makeDehydratedPoint(0,
0,0,this.crsIndex);this.addResolvingPromise(c);this.when(function(){return a._startNodeLoading()})};c.prototype.destroy=function(){this._cancelAllNodes();this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null);this._handles.destroy();this._nodeLoader=null;Q.prune()};c.prototype._getRequiredAttributes=function(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];var a=this._attributeStorageInfo,b=this._fields,
c=this.layer.objectIdField;return this.layerView.availableFields.map(function(c){var d=L(a,c);c=L(b,c);return 0<=d&&0<=c?{index:d,name:b[c].name,field:b[c],attributeStorageInfo:a[d]}:null}).filter(function(a){return null!=a&&a.name!==c})};c.prototype._requiredFieldsChange=function(){var a=this._getRequiredAttributes();E(this._requiredAttributes,a)||(this._requiredAttributes=a,this._requiredAttributesDirty=!1,this.restartNodeLoading())};c.prototype.requestUpdate=function(){this._requiredAttributesDirty=
!0;this.restartNodeLoading()};c.prototype._setClippingArea=function(a){var b=v.create();G.extentToBoundingBox(a,b,this.layerView.view.renderSpatialReference)?this._clippingArea=b:this._clippingArea=null};c.prototype._pointOfInterestChanged=function(){this._poi&&this.camPos&&(this._calculatePointOfInterest(this._poi),this._viewportQueries&&(this._viewportQueries.setPointOfInterest(this._poi),l.isSome(this._index)&&(this._index.progressiveLoadPenalty=R.distancePenalty*this._viewportQueries.distCameraToPOI(),
this._index.requestUpdate())))};c.prototype._calculatePointOfInterest=function(a){var b=this._centerOnSurface.renderLocation,c=u.vec3f64.create();t.vec3.subtract(c,b,this.camPos);var d=this.layerView.view.renderCoordsHelper,e=u.vec3f64.create();d.worldUpAtPosition(b,e);c=t.vec3.angle(e,c)-.5*Math.PI;t.vec3.lerp(a,this.camPos,b,Math.max(0,Math.min(1,c/(.5*Math.PI))));return a};c.prototype.updateClippingArea=function(a){this._setClippingArea(a);this._viewportQueries&&l.isSome(this._index)&&(this._viewportQueries.updateExtent(this._clippingArea),
this._index.invalidateVisibilityCache());this._setCameraDirty()};c.prototype._setCameraDirty=function(){this._cameraDirty=!0;this.notifyChange("rootNodeVisible");this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};c.prototype.updateElevationChanged=function(a,b){var c=this,d=this._index;if(!l.isNone(d)){var e=d.rootNode;if(!l.isNone(e)){var f=this._elevationUpdateNodes;f.clear();H.findIntersectingNodes(a,b,e,this.crsIndex,d,function(a){return f.push(a.index)});f.forEach(function(a){d.invalidateBoundingVolumeCache(a);
a===e.index&&c.notifyChange("rootNodeVisible")});f.length&&this.restartNodeLoading()}}};c.prototype.getParentIndex=function(a){return l.isSome(this._index)&&this._index.getParentIndex(a)};c.prototype._elevationInfoChanged=function(){l.isSome(this._index)&&this._index.updateElevationInfo(this.layer.elevationInfo);this._setCameraDirty()};c.prototype._updateScaleHandles=function(){var a=this;this._handles.remove("scale-bounds");this.areScaleBoundsActive&&this._handles.add(this.layerView.view.basemapTerrain.on("scale-change",
function(b){return a._scaleUpdateHandler(b)}),"scale-bounds")};c.prototype._scaleBoundsChanged=function(){this.areScaleBoundsActive||this._loadedNodeScales.clear();this._updateScaleHandles();this._setCameraDirty()};c.prototype._scaleUpdateHandler=function(a){this._updateScaleInBoundingRect(a.scale,a.extent,a.spatialReference);this._setCameraDirty()};c.prototype._updateScaleInBoundingRect=function(a,b,c){var d=this,e=this._index;l.isNone(e)||!l.isNone(e.rootNode)&&G.boundingRectToBoundingRect(b,c,
W,this.crsIndex)&&this._loadedNodeScales.forEach(function(b,c){b=e.getNode(c);l.isSome(b)&&z.containsPoint(W,b.mbs)&&d._loadedNodeScales.set(c,a)})};c.prototype.restartNodeLoading=function(){this._restartNodeLoading=!0;this.cancelNodeLoading();this._evaluateUpdating()};c.prototype.schedule=function(a,b){return this._idleQueue.push(function(){k.throwIfAborted(a);return b()})};c.prototype.reschedule=function(a,b){return this._idleQueue.unshift(function(){k.throwIfAborted(a);return b()})};Object.defineProperty(c.prototype,
"isIntegratedMesh",{get:function(){return"integrated-mesh"===this.layer.type},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"areScaleBoundsActive",{get:function(){var a=J.extractSafeScaleBounds(this.layer),b=a.minScale,a=a.maxScale;return this.scaleVisibilityEnabled&&(0<b||0<a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"unloadedMemoryEstimate",{get:function(){return l.isNone(this._index)||this.layerView.suspended?0:this._index.getUnloadedMemoryEstimate()*
this.lodDropFactor},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"indexDepth",{get:function(){return l.isSome(this._index)?this._index.maxLevel:0},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"disableMemCache",{set:function(a){this.layerView.loadCachedGPUData&&this.layerView.addCachedGPUData||(this._disableMemCache=!0);this._disableMemCache=a},enumerable:!0,configurable:!0});c.prototype._frame=function(a,b){if(this.layerView.suspended)return this._updateViewData(),
this._evaluateUpdating(),-Infinity;if(!this.layerView.visible||l.isNone(this._index))return-Infinity;this._processLogError(a,b);return this._index.getPriority()};c.prototype._processLogError=function(a,b){try{this._process(a,b)}catch(V){50>this._errorCount?N.error("Error during processing: "+V):50===this._errorCount&&N.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}};c.prototype._process=function(a,b){var c=this;this._restartNodeLoading&&this._startNodeLoading();
if(null!=this._nodeLoader&&!l.isNone(this._index)){this._updateViewData();this._invisibleDirty&&this._removeInvisibleNodes(a)&&(this._invisibleDirty=!1);this.isIntegratedMesh&&(a.enabled=!1);a.run(function(){return c._processIndex(a)});this._updateFeatureLOD();a.run(function(){return c._processCache(a)});this.isIntegratedMesh&&(a.enabled=!0);for(a.run(function(){return c._processNodes(a,b)});!a.done&&this._idleQueue.process();)a.madeProgress();a.run(function(){return c._prefetchIndex()});b.numIndexLoading+=
this._index.getIndexLoading();b.numNodesLoading+=this._downloadingCount;a.run(function(){return c._lodHandling.lodGlobalHandling(a)});this._evaluateUpdating()}};c.prototype._processIndex=function(a){if(l.isNone(this._index))return!1;this._index.dirty&&(this._newLoadingNodes.clear(),this._index.update(h.keysOfMap(this._loadingNodes),a),this._disableMemCache||(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,
this._index.updates.missing.length)),a=this._index.getFeatureEstimate().leafsReached,this._index.isLoading()||a===this._get("leafsReached")||this._set("leafsReached",a));return this._index.load()};c.prototype._prefetchIndex=function(){return l.isNone(this._index)||0<this._loadingNodes.size||0<this._index.updates.add.length?!1:this._index.prefetch()};c.prototype._updateFeatureLOD=function(){if(this.isGraphics3D&&!l.isNone(this._index)){var a=!this._index.isLoading(),b=this.featureTarget*this.baseLOD,
c=this._index.getFeatureEstimate();c.estimate=c.estimate||b/2;if(500<this._index.getIndexMissing()){if(1E-4>=this._featureLOD)return;this._featureLOD/=1.5;this._stableFeatureLOD=!1}else if(a&&c.estimate<b){if(c.leafsReached||1E4<=this._featureLOD||this._stableFeatureLOD)return;this._featureLOD*=Math.min(10,Math.max(b/c.estimate,1.001));a=this.lod;b=this._index.checkFeatureTarget(b,a);b!==a&&(this._featureLOD=b/this.baseLOD,this._stableFeatureLOD=!0)}else if(c.estimate>1.2*b||a&&c.estimate>b){if(1E-4>=
this._featureLOD)return;this._featureLOD/=1+.25*(c.estimate/b-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this.lod);this._index.requestUpdate()}};c.prototype._processCache=function(a){var b=this._index;if(l.isNone(b))return!1;for(;0<this._newLoadingNodes.length&&!a.done;)for(var c=this._newLoadingNodes.pop(),c=b.getParent(c);l.isSome(c)&&!this.layerView.isNodeLoaded(c.index)&&this._isNodeInScaleBounds(c);c=
b.getParent(c.index))if(this._enableFromGPUCache(c,0)){a.madeProgress();break}return a.hasProgressed};c.prototype._processNodes=function(a,b){if(l.isNone(this._index))return!1;var c=(this._isIdle?100:2)-this._loadingNodes.size,d=this._index.updates;d.cancel.forEach(this._cancelNode,this);for(d.cancel=[];0<d.update.length&&!a.done;){var e=this._index.getNode(d.update.pop());l.isSome(e)&&(this._updateLoadedNode(e),a.madeProgress())}for(;0<d.add.length&&!a.done&&0<c;){--c;e=this._index.getNode(d.add.back());
if(l.isNone(e)||2!==e.cacheState&&!this._hasNodeLoadToken(b))break;d.add.pop();this._loadNode(e);a.madeProgress()}return a.hasProgressed};c.prototype._cancelAllNodes=function(){this._loadingNodes.forEach(function(a){return a.abort()});this._loadingNodes.clear();this._updatingNodes.forEach(function(a){return a.abort()});this._updatingNodes.clear()};c.prototype._cancelNode=function(a){var b=this._loadingNodes.get(a);b&&(b.abort(),this._loadingNodes.delete(a))};c.prototype._hasNodeLoadToken=function(a){return!this._isIdle&&
2<=a.numNodesLoading+this._loadingNodes.size?!1:!this.streamDataController.busy};c.prototype._evaluateUpdating=function(){var a=!1,b=0;this.layerView.suspended?b=(a=this._cameraDirty)?.5:1:(a=l.isSome(this._index)?this._index.getIndexMissing():0,b=l.isSome(this._index)?this._index.updates.add.length:0,b=a+3*b+2*this._loadingNodes.size,a=!!(0<b||0<this._updatingNodes.size||this._restartNodeLoading||this._cameraDirty||0<this._idleQueue.length||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling),
0===b&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(b,this._progressMaxNumNodes),b=1-b/this._progressMaxNumNodes);a!==this.updating&&this._set("updating",a);b!==this.updatingProgress&&this._set("updatingProgress",b)};c.prototype._updateViewData=function(){if(this._cameraDirty&&!l.isNone(this._index)){var a=this.layerView.view,b=a.state.camera;this.camPos=u.vec3f64.clone(a.pointsOfInterest.renderPointOfView);this.screenSizeFactor=1/(b.perScreenPixelRatio/2);this._poi=this._calculatePointOfInterest(this._poi);
this._viewportQueries.updateCamera(b);this._viewportQueries.setPointOfInterest(this._poi);this._viewportQueries.updateScreenSpaceErrorBias(this.lod);this._index.invalidateVisibilityCache();this._index.progressiveLoadPenalty=R.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestUpdate();this._stableFeatureLOD=!1;this._invisibleDirty=!0;this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}};c.prototype._getProgressiveLoadFactor=function(){return 1>this.layerView.view.resourceController.memoryController.memoryFactor?
1:this.layerView.progressiveLoadFactor};Object.defineProperty(c.prototype,"lod",{get:function(){return this._featureLOD*this.baseLOD},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"baseLOD",{get:function(){var a=this.layerView.lodFactor,b=this.layerView.view.resourceController.memoryController.memoryFactor;return this.fixedFeatureTarget?1:(0<a?a:1)*b},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"lodDropFactor",{get:function(){if(this.fixedFeatureTarget)return 1;
var a=this.layerView.view.resourceController.memoryController;return(Math.min(a.memoryFactor,.5)-a.minQuality)/(.5-a.minQuality)},enumerable:!0,configurable:!0});c.prototype.isGeometryVisible=function(a){return l.isSome(this._index)&&this._index.isGeometryVisible(a.index)};c.prototype.updateVisibility=function(a){l.isSome(this._index)&&this._index.invalidateVisibilityCache(a)};c.prototype.updateBoundingVolume=function(a){l.isSome(this._index)&&this._index.invalidateBoundingVolumeCache(a)};c.prototype.invalidateComputedOBBs=
function(){l.isSome(this._index)&&this._index.invalidateComputedOBBs()};c.prototype.recomputeAuthorativeOBBs=function(){l.isSome(this._index)&&this._index.recomputeAuthorativeOBBs()};c.prototype._shouldLoadNode=function(a){return this._lodHandling.shouldLoadNode(a)&&!this._shouldDropNode(a)&&this._isNodeInScaleBounds(a)?l.isSome(this._index)&&l.isSome(a.obb)?this._index.isGeometryVisible(a.index):!0:!1};c.prototype._shouldDropNode=function(a){var b=this.lodDropFactor;return 1<=b||!this._lodHandling.childrenEmpty(a)?
!1:Math.abs(this._viewportQueries.calcCameraDistanceToCenter(a))-this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*b};c.prototype._startNodeLoading=function(){var a=this;this._restartNodeLoading=!1;var b=this._index;if(!this._updatesDisabled&&null!=this.streamDataController&&!l.isNone(b)){this._updateViewData();this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1);var c=C.TextureFormat.Normal;
this.layerView.useCompressedTextures?c=C.TextureFormat.Compressed:this.uncompressedTextureDownsamplingEnabled&&(c=C.TextureFormat.Downsampled);this._nodeLoader=new C(this.layer,this.streamDataController,N,this._defaultGeometrySchema,this._requiredAttributes,{textureFormat:c,textureUsageMask:this.layerView.rendererTextureUsage,loadFeatureData:!this.isMeshPyramid});b.requestUpdate();this._lodHandling.startNodeLoading(function(a){return b.isNodeVisible(a)},function(a){return b.isGeometryVisible(a)},
function(b){return a._isNodeInScaleBounds(b)},function(a){return b.nodeTraversalState(a)},function(b,c){return a._removeNodes(b,c)},b,{maxLodLevel:this._viewportQueries.maxLodLevel});this._evaluateUpdating()}};c.prototype.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index};c.prototype.cancelNodeLoading=function(){this.isNodeLoading()&&(this.streamDataController.cancelAll(),this._idleQueue.cancelAll(),this._cancelAllNodes(),this._nodeLoader=null,this._evaluateUpdating())};c.prototype._removeInvisibleNodes=
function(a){var b=this,c=this._index;if(l.isNone(c))return!1;Q.clear();this.layerView.getLoadedNodeIndices(Q);var d=0===this._viewportQueries.maxDistance,e=d?function(){return!1}:function(a){return b._shouldDropNode(a)};Q.filterInPlace(function(a){var d=c.getNode(a);return l.isNone(d)||!c.isGeometryVisible(a)||e(d)||!b._isNodeInScaleBounds(d)});0<Q.length&&this._lodHandling.setLodGlobalDirty();this._removeNodes(Q,a);if(d&&1>this.lodDropFactor)return!1;if(0===Q.length)return!0;Q.clear();return!1};
c.prototype._removeNodes=function(a,b){0<a.length&&l.isSome(this._index)&&this._index.requestUpdate();var c=a.length;this.layerView.removeNodeData(a,b);if(0<this._loadedNodeScales.size)for(b=a.length;b<c;b++)this._loadedNodeScales.delete(a.data[b])};c.prototype._needsUpdate=function(a){if(!a.resources.hasFeatureData||this._updatingNodes.has(a.index))return!1;a=this.layerView.getLoadedAttributes(a.index);return null!=a&&a!==this._requiredAttributes};c.prototype._updateLoadedNode=function(a){var b=
this,c=k.createAbortController();this._updatingNodes.set(a.index,c);var d=this.layerView.getLoadedAttributes(a.index);(E(d,this._requiredAttributes)?k.resolve(this.layerView.getAttributeData(a.index)):this._nodeLoader.loadAttributes(a,this._requiredAttributes,c.signal)).then(function(d){return b.schedule(c.signal,function(){return b.layerView.setAttributeData(a.index,{loadedAttributes:b._requiredAttributes,attributeData:d})})}).catch(function(c){k.isAbortError(c)||b.layerView.setAttributeData(a.index,
{loadedAttributes:b._requiredAttributes,attributeData:{}})}).catch(function(){}).then(function(){b._updatingNodes.delete(a.index);b._evaluateUpdating()});this._evaluateUpdating()};c.prototype._loadNode=function(a){var b=this;if(this._loadingNodes.has(a.index))N.error("already loading node "+a.index);else{var c=k.createAbortController();this._loadingNodes.set(a.index,c);this._evaluateUpdating();this._loadAndAddNode(a,c.signal).catch(function(a){return a}).then(function(){b._loadingNodes.get(a.index)===
c&&b._loadingNodes.delete(a.index);b._evaluateUpdating()})}};c.prototype._loadAndAddNode=function(a,b){var c=this;return 1===a.cacheState?this._loadUncached(a,b):this._loadCached(a,b).then(function(b){b||(a.cacheState=1,l.isSome(c._index)&&c._index.updates.add.push(a.index))}).catch(function(b){k.isAbortError(b)||(a.cacheState=1)})};c.prototype._enableFromGPUCache=function(a,b){if(this._disableMemCache||l.isNone(this._index))return!1;if(0===b&&!this._index.useNodeAsHole(a.index))return!0;var c=this._loadCachedGPUData(a);
if(!c)return!1;this.layerView.addCachedGPUData(a,c,b);this._nodeAdded();return!0};c.prototype._loadCachedGPUData=function(a){a=this.layerView.loadCachedGPUData(a);return l.isSome(a)&&M(a.attributeInfo)&&E(a.attributeInfo.loadedAttributes,this._requiredAttributes)?a:null};c.prototype._nodeAdded=function(){l.isSome(this._index)&&this._index.requestUpdate();this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};c.prototype._loadCached=function(a,b){var c=this;if(this._enableFromGPUCache(a,1))return k.resolve(!0);
var d=this.layerView;return!this.disableIDBCache&&d.loadCachedNodeData&&d.addCachedNodeData?this.schedule(b,function(){return d.loadCachedNodeData(a,b,function(b,d){return c._nodeLoader.loadTextures(a,b,d)})}).then(function(e){if(l.isNone(e))return!1;var f=c._requiredAttributes;return M(e)&&E(e.loadedAttributes,f)?c.reschedule(b,function(){return d.addCachedNodeData(a,e,e,b)}).then(function(){c._nodeAdded();return!0}):c.reschedule(b,function(){return c._nodeLoader.loadAttributes(a,f,b)}).then(function(g){return c.reschedule(b,
function(){return d.addCachedNodeData(a,e,{loadedAttributes:f,attributeData:g},b)})}).then(function(){c._nodeAdded();return!0})}):k.resolve(!1)};c.prototype._loadUncached=function(a,b){var c=this;this._downloadingCount++;return this._nodeLoader.loadNodeData(a,b).catch(function(a){c._downloadingCount--;throw a;}).then(function(d){c._downloadingCount--;return c.schedule(b,function(){return c.layerView.addNodeData(a,d,b)})}).then(function(){c._nodeAdded();a.cacheState=2}).catch(function(b){k.isAbortError(b)||
(N.error("Failed to load node '"+a.id+"': "+b),a.failed=!0,l.isSome(c._index)&&c._index.requestUpdate())})};c.prototype._updateIdleState=function(a){a!==this._isIdle&&(this._isIdle=a,this._evaluateUpdating(),a&&this._index&&l.isSome(this._index)&&this._index.resetFailedNodes())};c.prototype._getScale=function(a){if(this._loadedNodeScales.has(a.index))return this._loadedNodeScales.get(a.index);this._tmpPoint.x=a.mbs[0];this._tmpPoint.y=a.mbs[1];this._tmpPoint.z=a.mbs[2];var b=this.layerView.view.basemapTerrain.getScale(this._tmpPoint);
this.layerView.isNodeLoaded(a.index)&&this._loadedNodeScales.set(a.index,b);return b};c.prototype._isNodeInScaleBounds=function(a){if(!this.areScaleBoundsActive)return!0;a=this._getScale(a);var b=J.extractSafeScaleBounds(this.layer);return J.scaleBoundsPredicate(a,b.minScale,b.maxScale)};c.prototype.updateStats=function(a){a.index=l.isSome(this._index)?this._index.size:0;this.isGraphics3D&&(a.detail=this._featureLOD,a.target=this.featureTarget*this.baseLOD);l.isSome(this._index)&&this._index.updateStats(a)};
Object.defineProperty(c.prototype,"test",{get:function(){var a=this;return{index:this._index,set disableUpdates(b){(a._updatesDisabled=b)?a.cancelNodeLoading():a.requestUpdate()},set disableIDBCache(b){a.disableIDBCache=b},set ignoreServiceOBB(b){l.isSome(a._index)&&(a._index.ignoreServiceOBB=b)},shouldLoadNode:function(b){return a._shouldLoadNode(b)}}},enumerable:!0,configurable:!0});a.__decorate([r.property({readOnly:!0})],c.prototype,"isMeshPyramid",null);a.__decorate([r.property({readOnly:!0})],
c.prototype,"isGraphics3D",null);a.__decorate([r.property({readOnly:!0})],c.prototype,"streamDataController",null);a.__decorate([r.property({readOnly:!0})],c.prototype,"crsVertex",null);a.__decorate([r.property({readOnly:!0})],c.prototype,"crsIndex",null);a.__decorate([r.property()],c.prototype,"camPos",void 0);a.__decorate([r.property()],c.prototype,"screenSizeFactor",void 0);a.__decorate([r.property()],c.prototype,"featureTarget",void 0);a.__decorate([r.property()],c.prototype,"fixedFeatureTarget",
void 0);a.__decorate([r.property()],c.prototype,"layerView",void 0);a.__decorate([r.property()],c.prototype,"layer",void 0);a.__decorate([r.property({readOnly:!0})],c.prototype,"updating",void 0);a.__decorate([r.property({readOnly:!0})],c.prototype,"updatingProgress",void 0);a.__decorate([r.property({readOnly:!0})],c.prototype,"leafsReached",void 0);a.__decorate([r.property({constructOnly:!0})],c.prototype,"scaleVisibilityEnabled",void 0);a.__decorate([r.property({readOnly:!0})],c.prototype,"rootNodeVisible",
null);a.__decorate([r.property({aliasOf:"layerView.uncompressedTextureDownsamplingEnabled?"})],c.prototype,"uncompressedTextureDownsamplingEnabled",void 0);return c=a.__decorate([r.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],c)}(c.EsriPromiseMixin(m));var Q=new d({deallocator:null}),R={factorIM:.2,factor3dObject:.05,distancePenalty:10},W=z.create();return n})},"esri/views/3d/layers/i3s/I3SFrameTask":function(){define(["require","exports","../../../../core/arrayUtils","../../../support/Scheduler"],
function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function b(a){var b=this;this.referenceCount=0;this.callbacks=[];this.runIndex=0;this.handle=a.registerTask(m.Task.I3S_CONTROLLER,function(a){return b.update(a)},function(){return b.needsUpdate()})}b.prototype.destroy=function(){this.handle&&(this.handle.remove(),this.handle=null)};b.prototype.needsUpdate=function(){for(var a=0,b=this.callbacks;a<b.length;a++)if(b[a].needsUpdate())return!0;return!1};b.prototype.update=
function(a){this.sort();for(var b=this.callbacks,d={numIndexLoading:0,numNodesLoading:0},c=0;c<b.length&&!a.done;++c)b[c].priority=b[c].update(a,d),this.runIndex=c};b.prototype.sort=function(){for(var a=this.callbacks,b=a.length,d=this.runIndex;0<d;d--){for(var c=a[d-1],e=d;e<a.length&&c.priority<=a[e].priority&&(e!==b||c.priority<a[e].priority);)a[e-1]=a[e],e++;a[e-1]=c;b=e-1}this.runIndex=0};b.prototype.add=function(a){this.sort();a.priority=Infinity;this.callbacks.unshift(a)};b.prototype.remove=
function(b){a.removeUnordered(this.callbacks,b);this.runIndex=this.callbacks.length;this.sort()};return b}(),e=new Map;b.addTask=function(a,b){var f=e.get(a);null==f&&(f=new h(a),e.set(a,f));f.add(b);return{remove:function(){null!=f&&(f.remove(b),0<f.callbacks.length||(e.delete(a),f.destroy()),f=null)}}}})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("require exports ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec4f64 ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(n,b,a,m,h,e,f,g,l,d){function c(b){a.isSome(b.node)&&(b.node.renderMbs[3]=-1,a.isSome(b.node.renderObb)&&(b.node.renderObb.halfSize[0]=-1));a.isSome(b.ref)&&(b.ref.renderMbs[3]=-1,a.isSome(b.ref.renderObb)&&(b.ref.renderObb.halfSize[0]=-1))}function k(a,b){return 0===b?0:a/b|0}function p(a,b){return 0===b?a:a%b}function r(a){if(a)for(var b=0;b<a.length;b++)for(var c=0,d=w;c<d.length;c++){var e=d[c];if(e[0]===a[b].metricType)return{lodMetric:e[1],maxError:a[b].maxError}}return{lodMetric:0,
maxError:0}}function t(a){return Math.sqrt(4/Math.PI*a)}Object.defineProperty(b,"__esModule",{value:!0});var u=function(){return function(a,b,c,d,e){this.childOffset=a;this.childCount=b;this.visibilityCache=c;this.ref=d;this.node=e;this.useAsHole=0}}();n=function(){function b(a,b,c,d,e,f,g,h,k,n,p){this.streamDataController=b;this.viewportQueries=c;this.logger=d;this.holeFilling=e;this._isLoaded=f;this._isSelected=g;this._enable=h;this._needsUpdate=k;this._canRequest=n;this._computeAuthorativeOBB=
p;this._dirty=!0;this.nodePages=[];this.lodMetric=this.rootIndex=this.nodesPerPage=this.nodeCount=0;this.lodConversion=function(a){return a};this._loading=new Set;this._failedNodes=new Set;this._failedPages=new Set;this._indexMissing=1;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._maxProcessingPrio=Number.POSITIVE_INFINITY;this._nodeTraversalState={};this._version=l.addWraparound(0,2);this._visibilityCacheVersion=l.addWraparound(0,2);this._maxLevel=1;this._featureEstimate={estimate:0,leafsReached:!1};
this._unloadedMemoryEstimate=0;this._missing=new m({deallocator:null});this._prefetch=new m({deallocator:null});this._updates=new z;this.ignoreServiceOBB=!1;this.progressiveLoadPenalty=0;this.layerUrl=a.parsedUrl.path;this.rootId=a.rootNode&&a.rootNode.split("/").pop();a.serviceUpdateTimeStamp&&a.serviceUpdateTimeStamp.lastUpdate&&(this.lastUpdate=""+a.serviceUpdateTimeStamp.lastUpdate);this._maxLodLevel=this.viewportQueries?this.viewportQueries.maxLodLevel:1;a.nodePages?this.initNodePages(a.nodePages):
this.initNodeDocuments(this.rootId)}b.prototype.initNodePages=function(a){this.nodesPerPage=a.nodesPerPage;this.rootIndex=a.rootIndex;switch(a.lodSelectionMetricType){case "maxScreenThreshold":this.lodMetric=1;break;case "maxScreenThresholdSQ":this.lodMetric=1,this.lodConversion=t}};b.prototype.initNodeDocuments=function(a){this.rootIndex=this.nodesPerPage=0;this.nodePages.push({nodes:[],children:[],parents:[]});this.makeRefNode(new g.NodeBase(a,null),-1)};b.prototype.loadPage=function(a){var b=this;
this._loading.add(a);this.streamDataController.request(this.layerUrl+"/nodepages/"+a,"json").then(function(c){b._loading.delete(a);b.addPage(a,c)}).catch(function(c){b._loading.delete(a);if(!h.isAbortError(c)){if(0===b.nodePages.length)return b.initNodeDocuments(b.rootId);b._failedPages.add(a);b.logger.error("Error when loading page "+a,c)}})};b.prototype.addPage=function(a,b){for(var c=this,h=this.nodePages.length;h<a;h++)this.nodePages[h]=null;var k=[],m=[];b=b.nodes.map(function(b,h){var n=k.length,
p=b.children?b.children.length:0;m.push(-1);for(var q=0;q<p;q++)k.push(b.children[q]);var r=""+b.index,q=d.clone(b.obb),t=f.vec4f64.fromArray([q.center[0],q.center[1],q.center[2],e.vec3.length(q.halfSize)]),v=b.mesh&&b.mesh.attribute,w=b.mesh&&b.mesh.geometry,A=b.mesh&&b.mesh.material;b=new g.Node(r,a*c.nodesPerPage+h,t,p,0,{hasSharedResource:!1,hasFeatureData:!!w,attributes:v&&null!=v.resource?""+v.resource:null,geometry:w&&null!=w.resource?""+w.resource:null,texture:A&&null!=A.resource?""+A.resource:
null,geometryDefinition:w?w.definition:-1,materialDefinition:A?A.definition:-1},c.lastUpdate,c.lodMetric,c.lodConversion(b.lodThreshold),w?w.featureCount:null);b.obb=q;b.authorativeObb=c._computeAuthorativeOBB(b);b.vertexCount=w?w.vertexCount:0;return new u(n,p,l.addWraparound(c._visibilityCacheVersion,-2),null,b)});this.nodePages[a]={nodes:b,children:k,parents:m};this.nodeCount+=b.length;this.updateParentsAndLevel()};b.prototype.updateParentsAndLevel=function(){var b=this,c=[],d=function(d,e,f){var g=
b.getPage(d);if(a.isSome(g)){var h=p(d,b.nodesPerPage);g.parents[h]=e;e=g.nodes[h].node;a.isSome(e)&&(e.level=f,c.push(d))}};for(d(this.rootIndex,-1,0);c.length;){var e=c.pop(),f=this.getNode(e);if(a.isSome(f))for(var g=0;g<f.childCount;g++){var h=this.getChildIndex(f,g);d(h,e,f.level+1)}}};b.prototype.getPage=function(a){return this.nodePages[k(a,this.nodesPerPage)]};b.prototype.getNodeInternal=function(b){var c=this.getPage(b);return a.isNone(c)?null:c.nodes[p(b,this.nodesPerPage)]};b.prototype.addNode=
function(b,c){null!=b.children&&this.populateChildren(c,b.children);var e=this.getParent(c),e=a.isSome(e)?e.level+1:1;this._maxLevel=Math.max(this._maxLevel,e);var h=r(b.lodSelection),k=h.lodMetric,h=h.maxError,l=a.unwrap(this.getNodeInternal(c));l.node=new g.Node(b.id,c,f.vec4f64.fromArray(b.mbs),l.childCount,e,b.resources,b.version,k,h,b.numFeatures);b.obb&&(l.node.obb=d.clone(b.obb));l.node.authorativeObb=this._computeAuthorativeOBB(l.node);a.isSome(l.ref)&&(null==l.ref.mbs&&(l.ref.mbs=b.mbs),
l.node.renderMbs=l.ref.renderMbs,l.node.renderObb=l.ref.renderObb,l.ref.authorativeObb=l.node.authorativeObb);return l.node};b.prototype.makeRefNode=function(b,c){var d=this.nodePages[0],e=d.nodes.length;d.nodes.push(new u(0,0,l.addWraparound(this._visibilityCacheVersion,-2),b,null));this.nodeCount++;d.parents.push(c);b.renderMbs[3]=-1;a.isSome(b.renderObb)&&(b.renderObb.halfSize[0]=-1);return e};b.prototype.populateChildren=function(b,c){var d=a.unwrap(this.getNodeInternal(b)),e=a.unwrap(this.getPage(b));
d.childOffset=e.children.length;d.childCount=c.length;for(d=0;d<c.length;d++){var f=this.makeRefNode(c[d],b);e.children.push(f)}};b.prototype.getNode=function(b){b=this.getNodeInternal(b);return a.isSome(b)?b.node:null};b.prototype.getIndexById=function(b){var c;this.forAllNodes(function(d,e){a.isSome(d.node)&&d.node.id===b?c=e:a.isSome(d.ref)&&d.ref.id===b&&(c=e)});return c};b.prototype.getNodeById=function(a){a=this.getIndexById(a);return 0<=a?this.getNode(a):null};b.prototype.getChildIndex=function(b,
c){var d=this.getPage(b.index);if(a.isNone(d))return-1;b=d.nodes[p(b.index,this.nodesPerPage)];return d.children[b.childOffset+c]};b.prototype.getParentIndex=function(b){var c=this.getPage(b);return a.isSome(c)?c.parents[p(b,this.nodesPerPage)]:-1};b.prototype.getParent=function(a){a=this.getParentIndex(a);return 0<=a?this.getNode(a):null};b.prototype.isLeaf=function(b){b=this.getNodeInternal(b);return a.isSome(b)&&0===b.childCount};Object.defineProperty(b.prototype,"rootNode",{get:function(){return this.getNode(this.rootIndex)},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return this.nodeCount},enumerable:!0,configurable:!0});b.prototype.invalidateVisibilityCache=function(b){null==b?this._visibilityCacheVersion=l.addWraparound(this._visibilityCacheVersion,2):(b=this.getNodeInternal(b),a.isSome(b)&&(b.visibilityCache=l.addWraparound(this._visibilityCacheVersion,-2)))};b.prototype.invalidateBoundingVolumeCache=function(b){b=this.getNodeInternal(b);a.isSome(b)&&(c(b),b.visibilityCache=
l.addWraparound(this._visibilityCacheVersion,-2))};b.prototype.invalidateComputedOBBs=function(){a.isNone(this.rootNode)||this.traverse(this.rootNode,function(b){b.isComputedObb&&(b.obb=null);b.renderMbs[3]=-1;a.isSome(b.renderObb)&&(b.renderObb.halfSize[0]=-1);return!0})};b.prototype.recomputeAuthorativeOBBs=function(){var b=this;a.isNone(this.rootNode)||this.traverse(this.rootNode,function(a){a.authorativeObb=b._computeAuthorativeOBB(a);return!0})};b.prototype.isNodeVisible=function(b){b=this.getNodeInternal(b);
if(a.isNone(b)||a.isSome(b.ref)&&!b.ref.mbs)return!0;if((b.visibilityCache&-2)!==this._visibilityCacheVersion){var c=!0;a.isSome(b.node)&&(a.isNone(b.ref)||a.isSome(b.node.authorativeObb))?c=this.viewportQueries.isNodeVisible(b.node):a.isSome(b.ref)&&(c=this.viewportQueries.isNodeVisible(b.ref));b.visibilityCache=this._visibilityCacheVersion+(c?1:0);return c}return 1===(b.visibilityCache&1)};b.prototype.isGeometryVisible=function(b){if(!this.isNodeVisible(b))return!1;b=this.getNodeInternal(b);return a.isNone(b)?
!0:a.isSome(b.node)&&a.isSome(b.ref)&&!b.ref.obb?this.viewportQueries.isGeometryVisible(b.node):!0};b.prototype._traverseCoverage=function(b,c,d,e,f){var g=this.getPage(b);if(!a.isNone(g)&&0!==c.childCount){var h=c.childOffset+c.childCount;b=[];for(var k=c.childOffset;k<h;++k){c=g.children[k];var l=this.getNodeInternal(c);a.isSome(l)&&a.isSome(l.node)&&this.isGeometryVisible(c)&&b.push(l)}e/=b.length;for(g=0;g<b.length;g++)l=b[g],c=a.unwrap(l.node).index,this._isLoaded(c)?(f.delta=Math.max(f.delta,
d),f.coverage+=e):this._traverseCoverage(c,l,d+1,e,f)}};b.prototype.useNodeAsHole=function(b){if("off"===this.holeFilling)return!1;var c=this.getNodeInternal(b);if(a.isNone(c))return!1;if("always"===this.holeFilling)return!0;if((c.useAsHole&-2)===this._version)return 1===(c.useAsHole&1);var d={delta:0,coverage:0};this._traverseCoverage(b,c,0,1,d);b=.5>=d.delta*d.coverage;c.useAsHole=this._version+(b?1:0);return b};Object.defineProperty(b.prototype,"maxLevel",{get:function(){return this._maxLevel},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"dirty",{get:function(){return this._dirty},enumerable:!0,configurable:!0});b.prototype.destroy=function(){this._updates.add.prune();this._updates.update.prune()};b.prototype.requestUpdate=function(){this._dirty=!0;this._indexMissing=1;this._version=l.addWraparound(this._version,2)};b.prototype.update=function(b,c){var d=this;if(this._dirty){this._maxProcessingPrio=this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missing.clear();
this._prefetch.clear();this._updates.reset(b,this._missing);v.clear();var e=!0,f=new q,g=new q;this.traverseVisible(function(h,l){if(l){var m=l.node;d._updateNodeFeatureEstimate(m,g);if(a.isNone(m))l=d.entryPriority(h),d._loading.has(h)||d._failedNodes.has(h)||(d._missing.push(h),v.set(h,l)),d._maxProcessingPrio=Math.max(d._maxProcessingPrio,l);else{var n=a.unwrap(d.getPage(h));if(0===d._missing.length&&0===d.nodesPerPage)for(var p=0;p<l.childCount;p++){var q=n.children[l.childOffset+p],r=d.getNodeInternal(q);
!a.isSome(r)||r.node||d._loading.has(q)||d._failedNodes.has(q)||(v.set(q,d.entryPriority(q)),d._prefetch.push(q))}!m.failed&&m.resources.hasFeatureData&&(d._isLoaded(h)?(f.known+=m.memory,++f.knownNodes,d._isSelected(m)?0<l.childCount&&(e=!1):(f.unremoved+=m.memory,e=!1),d._needsUpdate(m)&&(l=d.entryPriority(h),v.set(h,l),d._maxProcessingPrio=Math.max(d._maxProcessingPrio,l),d._updates.update.push(h))):(m.memory&&(f.known+=m.memory,++f.knownNodes),d._isSelected(m)&&(0<l.childCount&&(e=!1),m.memory?
(f.missing+=m.memory,f.known+=m.memory,++f.knownNodes):++f.missingNodes,0<=b.indexOf(m.index)?(d._maxProcessingPrio=Math.max(d._maxProcessingPrio,d.entryPriority(h)),d._updates.cancel=d._updates.cancel.filter(function(a){return a!==m.index})):!c.done&&d._enable(m)?c.madeProgress():(l=d.entryPriority(h),v.set(h,l),d._maxProcessingPrio=Math.max(d._maxProcessingPrio,l),d._updates.add.push(h)))))}}else l=d.entryPriority(h),h=k(h,d.nodesPerPage),v.set(h,Math.max(l,v.get(h)||0)),d._loading.has(h)||d._failedPages.has(h)||
d._missing.push(h),d._maxProcessingPrio=Math.max(d._maxProcessingPrio,l)});this._unloadedMemoryEstimate=f.missing-f.unremoved;3<f.knownNodes&&0<f.missingNodes&&(this._unloadedMemoryEstimate+=f.known/f.knownNodes*f.missingNodes);this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=this._computeFeatureEstimate(g);this._featureEstimate.leafsReached=e;this._missing.sort(function(a,b){return a-b});this._missing.filterInPlace(function(a,b){return 1>b||
d._missing.data[b-1]!==a});this._missing.sort(function(a,b){return v.get(a)-v.get(b)});0<this._missing.length?(this._maxUnloadedPrio=v.get(this._missing.back()),this._prefetch.clear()):this._prefetch.sort(function(a,b){return v.get(a)-v.get(b)});this._updates.add.filterInPlace(function(a){return v.get(a)>=d._maxUnloadedPrio}).sort(function(a,b){return v.get(a)-v.get(b)});this._updates.update.sort(function(a,b){return v.get(a)-v.get(b)});this._indexMissing=this._loading.size+this._missing.length;this._dirty=
0<this._indexMissing;v.clear()}};b.prototype.checkFeatureTarget=function(a,b){for(var c=this.viewportQueries.updateScreenSpaceErrorBias(b),d=b,e=b,f=c,g=10;g--;){var h=new q;this._updateFeatureEstimate(d,h);if(this._computeFeatureEstimate(h)<=a){if(d>=b||0<h.missingNodes||0===g)break;f=d;d=.5*(d+e)}else e=d,d=.5*(d+f)}this._version=l.addWraparound(this._version,2);this.viewportQueries.updateScreenSpaceErrorBias(c);return Math.min(b,d)};b.prototype._updateFeatureEstimate=function(a,b){var c=this;this._version=
l.addWraparound(this._version,2);this.viewportQueries.updateScreenSpaceErrorBias(a);this.traverseVisible(function(a,d){return c._updateNodeFeatureEstimate(d&&d.node,b)})};b.prototype._updateNodeFeatureEstimate=function(b,c){a.isNone(b)||b.failed||a.isNone(b.numFeatures)||(this._isLoaded(b.index)?(c.known+=b.numFeatures,++c.knownNodes,this._isSelected(b)||(c.unremoved+=b.numFeatures)):this._isSelected(b)&&(a.isSome(b.numFeatures)?(c.missing+=b.numFeatures,c.known+=b.numFeatures,++c.knownNodes):++c.missingNodes))};
b.prototype._computeFeatureEstimate=function(a){var b=a.known-a.unremoved;3<a.knownNodes&&0<a.missingNodes&&(b+=a.known/a.knownNodes*a.missingNodes);return Math.max(0,b)};b.prototype.load=function(){return this._load(this._missing)};b.prototype.prefetch=function(){return this._load(this._prefetch)};b.prototype._load=function(a){if(0===a.length||!this._canRequest())return!1;for(;0<a.length&&this._canRequest();)0===this.nodesPerPage?this._loadNode(a.pop()):this.loadPage(a.pop());return!0};b.prototype.isLoading=
function(){return 0<this._indexMissing};b.prototype.getIndexLoading=function(){return this._loading.size};b.prototype.getIndexMissing=function(){return this._indexMissing};b.prototype.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate};Object.defineProperty(b.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0});b.prototype.getFeatureEstimate=function(){return this._featureEstimate};b.prototype.nodeTraversalState=function(b){if(a.isNone(b))return null;
var c=this._nodeTraversalState[b.index];if(c&&(c.version&-2)===this._version)return c;var d=this.viewportQueries.getLodLevel(b),e=this.viewportQueries.hasLOD(b),f=!0;e?(f=this.getParentIndex(b.index),f=0<=f?(f=this._nodeTraversalState[f])&&d>f.lodLevel:0<d):f=0===b.childCount;if(c)return c.lodLevel=d,c.isChosen=f,c.version=this._version+1,c;this._nodeTraversalState[b.index]={nodeHasLOD:e,lodLevel:d,isChosen:f,version:this._version+1};return this._nodeTraversalState[b.index]};b.prototype._loadNode=
function(b){var c=this;this._loading.add(b);var d=a.unwrap(this.getNodeInternal(b)).ref;if(a.isNone(d))this._failedNodes.add(b);else{var e=d.id,f=this.layerUrl+"/nodes/"+e,g=function(){c._loading.delete(b);0===c._missing.length&&0===c._loading.size&&c.requestUpdate()};this.streamDataController.request(f,"json").then(function(a){a=c._validateNode(e,a);null!=a&&(a.obb&&c.invalidateVisibilityCache(b),a=c.addNode(a,b),c.nodeTraversalState(a));g()},function(a){h.isAbortError(a)||(c.logger.error("Error loading node: "+
f),c._failedNodes.add(b));g()})}};b.prototype._validateNode=function(a,b){var c=this;if(null==b||"object"!==typeof b||b.id!==a)return this.logger.error('Invalid node. Wrong type or wrong id "'+a+'"'),null;b.sharedResource&&"./shared"!==b.sharedResource.href&&"./shared/"!==b.sharedResource.href&&this.logger.warn('Invalid shared resource href on node "'+a+'"');null==b.geometryData||Array.isArray(b.geometryData)&&1===b.geometryData.length&&"./geometries/0"===b.geometryData[0].href||this.logger.warn('Invalid geometry data on node "'+
a+'"');null==b.attributeData||Array.isArray(b.attributeData)&&!b.attributeData.some(function(a,b){return a.href!=="./attributes/f_"+b+"/0"})||this.logger.warn('Invalid attribute data on node "'+a+'"');b.featureData&&1<b.featureData.length&&this.logger.warn("Node "+a+" has "+b.featureData.length+" bundles. Only the first bundle will be loaded.");var d=b.hasOwnProperty("obb")&&!this.ignoreServiceOBB?b.obb:null,e=b.featureData&&1===b.featureData.length&&b.featureData[0].featureRange?b.featureData[0].featureRange[1]-
b.featureData[0].featureRange[0]+1:null,f=function(b){if(null==b)return null;var d=function(b){return c.logger.error("Invalid node reference on node "+a+": "+b)};if("number"===typeof b.id)d("id "+b.id+" is a number instead of a string.");else if("string"!==typeof b.id||!Array.isArray(b.mbs))return d("Missing or invalid id."),null;if(!Array.isArray(b.mbs))return d("Invalid bounding volume on reference "+b.id+"."),null;b.href&&b.href!=="../"+b.id&&c.logger.error('Invalid node href on node "'+a+'"');
d=b.hasOwnProperty("obb")&&!c.ignoreServiceOBB?b.obb:null;b=new g.NodeBase(""+b.id,b.mbs);b.obb=d;return b},f=Array.isArray(b.children)?b.children.map(f).filter(function(a){return null!=a}):null;return{id:a,mbs:b.mbs,obb:d,children:f,resources:{hasFeatureData:b.featureData&&0<b.featureData.length,hasSharedResource:null!=b.sharedResource,attributes:b.attributeData?a:null,texture:b.textureData&&0<b.textureData.length?a:null,geometry:null!=b.geometryData?a:null},version:"string"===typeof b.version?b.version:
null,lodSelection:Array.isArray(b.lodSelection)?b.lodSelection:null,numFeatures:e}};b.prototype.resetFailedNodes=function(){this._failedNodes.clear();this._failedPages.clear();this.forAllNodes(function(b){a.isSome(b.node)&&(b.node.failed=!1)})};b.prototype.entryPriority=function(b){var c=this.getNodeInternal(b),d=this.getParentIndex(b);if(a.isNone(c)||0>d&&null==c.node)return 0>d?Infinity:this.entryPriority(d);var e=0;c.node&&0<=d&&(d=this._nodeTraversalState[d],null!=d&&(e=d.lodLevel));for(d=this.progressiveLoadPenalty;0<=
b;b=this.getParentIndex(b))if(this._isLoaded(b)){d=0;break}c=a.isSome(c.ref)?this.viewportQueries.distToPOI(c.ref):a.isSome(c.node)?this.viewportQueries.distToPOI(c.node):0;return-c-e*(c+this.progressiveLoadPenalty)+d};b.prototype.traverseVisible=function(b){var c=this.getNodeInternal(this.rootIndex);a.isNone(c)?b(this.rootIndex,null):this._traverseVisible(this.rootIndex,c,b)};b.prototype._traverseVisible=function(b,c,d){if(c.node&&0===c.childCount)this.isGeometryVisible(b)&&d(b,c);else if(this.isNodeVisible(b)&&
(d(b,c),null!=c.node)){var e=this.nodeTraversalState(c.node);if(!e.nodeHasLOD||e.lodLevel!==this._maxLodLevel)for(b=a.unwrap(this.getPage(b)),e=0;e<c.childCount;e++){var f=b.children[c.childOffset+e],g=this.getNodeInternal(f);a.isSome(g)?this._traverseVisible(f,g,d):d(f,null)}}};b.prototype.traverse=function(a,b){b(a)&&this.traverseChildren(a,b)};b.prototype.traverseChildren=function(b,c){b=b.index;var d=this.getNodeInternal(b);a.isSome(d)&&this._traverseChildren(b,d,c)};b.prototype._traverseChildren=
function(b,c,d){b=this.getPage(b);if(!a.isNone(b)){var e=c.childOffset+c.childCount;for(c=c.childOffset;c<e;++c){var f=b.children[c],g=this.getNodeInternal(f);a.isSome(g)&&a.isSome(g.node)&&d(g.node)&&this._traverseChildren(f,g,d)}}};b.prototype.updateStats=function(a){0<this._updates.add.length&&(a.nodes+=" + "+this._updates.add.length);if(this._indexMissing||0<this._prefetch.length)a.index+=" + "+this._indexMissing||this._prefetch.length;a.prio=this._maxProcessingPrio;if(this._featureEstimate.estimate){var b=
this._featureEstimate.estimate-a.features;0<b?a.features+=" + "+b:0>b&&(a.features+=" - "+-b)}};b.prototype.getPriority=function(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)};b.prototype.updateElevationInfo=function(a){this.forAllNodes(c);this.viewportQueries.updateElevationInfo(a)};b.prototype.forAllNodes=function(a){for(var b=0;b<this.nodePages.length;b++){var c=this.nodePages[b];if(c)for(var d=b*this.nodesPerPage,e=0;e<c.nodes.length;e++)a(c.nodes[e],d+e)}};Object.defineProperty(b.prototype,
"test",{get:function(){var a=this;return{addNode:function(b,c){return a.addNode(b,c)}}},enumerable:!0,configurable:!0});return b}();b.I3SIndex=n;var v=new Map,z=function(){function a(){this.update=new m({deallocator:null});this.add=new m({deallocator:null});this.cancel=[]}a.prototype.reset=function(a,b){this.add.clear();this.update.clear();this.cancel=a;this.missing=b};return a}(),w=[["maxScreenThreshold",1],["screenSpaceRelative",2],["removedFeatureDiameter",3],["distanceRangeFromDefaultCamera",
4]];b.selectErrorMetric=r;var q=function(){return function(){this.unremoved=this.missingNodes=this.missing=this.knownNodes=this.known=0}}()})},"esri/views/3d/layers/i3s/I3SNode":function(){define(["require","exports","tslib","../../../../core/libs/gl-matrix-2/vec4f64"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(a,b){this.id=a;this.mbs=b;this.isComputedObb=!1;this.renderMbs=m.vec4f64.fromArray([0,0,0,-1])}}();b.NodeBase=n;n=function(b){function e(a,
e,h,d,c,k,m,n,t,u){a=b.call(this,a,h)||this;a.index=e;a.childCount=d;a.level=c;a.resources=k;a.version=m;a.lodMetric=n;a.maxError=t;a.numFeatures=u;a.failed=!1;a.cacheState=0;a.vertexCount=0;a.memory=0;return a}a.__extends(e,b);return e}(n);b.Node=n})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["require","exports","../../../../core/maybe","../../../../core/PooledArray"],function(n,b,a,m){n=function(){function b(a){this.layerView=a;this._lodGlobalDirty=!1}b.prototype.startNodeLoading=
function(a,b,e,d,c,h,m){this._maxLodLevel=m.maxLodLevel;this._index=h;this._nodeTraversalState=d;this._isNodeVisible=a;this._isGeometryVisible=b;this._isNodeInScaleBounds=e;this._removeNodes=c};b.prototype.shouldLoadNode=function(b){if(a.isNone(b))return!1;var e=this._nodeTraversalState(b);return this.isChosenMaxLOD(e)?!0:e.isChosen?this._childrenRequireLoading(b):!1};b.prototype.setLodGlobalDirty=function(){this._lodGlobalDirty=!0};Object.defineProperty(b.prototype,"requiresLODGlobalHandling",{get:function(){return null!=
this._index&&!0===this._lodGlobalDirty},enumerable:!0,configurable:!0});b.prototype.lodGlobalHandling=function(a){if(!this.requiresLODGlobalHandling)return!1;var b=Math.max(0,Math.floor(10*(this.layerView.view.resourceController.memoryController.usedMemory-1)));h.clear();this._lodGlobalHandlingRecursion(this._index.rootNode,b);b=h.length;this._removeNodes(h,a);a=h.length<b;0===h.length&&(this._lodGlobalDirty=!1);h.clear();return a};b.prototype._lodGlobalHandlingRecursion=function(b,e){if(a.isNone(b))return!1;
var f=this._nodeTraversalState(b),d=this.isChosenMaxLOD(f);if(f=this.layerView.isNodeLoaded(b.index)){if(d)return this._removeChildrenRecursive(b),this.layerView.updateNodeState(b.index,1),!0;this.layerView.updateNodeState(b.index,0)}var c=!1;if(0<b.childCount)for(var c=!0,g=0;g<b.childCount;g++){var m=this._index.getChildIndex(b,g),n=this._index.getNode(m);a.isSome(n)?this._isGeometryVisible(m)&&!this._lodGlobalHandlingRecursion(n,e)&&this._isNodeInScaleBounds(n)&&(c=!1):this._isNodeVisible(m)&&
(c=!1)}f&&!d&&(c||h.length<e)&&(h.push(b.index),f=!1);b=!b.resources.hasFeatureData;return c||f||b};b.prototype._removeChildrenRecursive=function(a){this._index.traverseChildren(a,function(a){h.push(a.index);return!0})};b.prototype.childrenEmpty=function(a){var b=this,e=!0;this._index.traverseChildren(a,function(a){return e&&b._isNodeVisible(a.index)?b.layerView.isNodeLoaded(a.index)?e=!1:!0:!1});return e};b.prototype._childrenRequireLoading=function(a){var b=this,e=!1,d=!0;this._index.traverseChildren(a,
function(a){if(!d||!b._isNodeVisible(a.index))return!1;var c=b._nodeTraversalState(a);b.isChosenMaxLOD(c)&&b._isGeometryVisible(a.index)&&(e=!0);return b.layerView.isNodeLoaded(a.index)?d=!1:!0});return d&&e};b.prototype.isChosenMaxLOD=function(a){return a.isChosen&&(!a.nodeHasLOD||a.lodLevel===this._maxLodLevel)};return b}();var h=new m({deallocator:null});return n})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("require exports tslib ../../../../core/asyncUtils ../../../../core/has ../../../../core/lang ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/urlUtils ./I3SBinaryReader ./I3SMaterialUtil ./I3SUtil".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k){n=function(){function b(a,b,d,e,f,g){this.streamDataController=b;this.logger=d;this.defaultGeometrySchema=e;this.requiredAttributes=f;this.options=g;this.layerUrl=a.parsedUrl.path;this.geometryDefinitions=a.geometryDefinitions;if(a.materialDefinitions){var h=a.textureSetDefinitions;this.materialAndTextures=a.materialDefinitions.map(function(a){return c.getMaterialAndTextures(h,a)})}}b.prototype.load=function(a,b,c){return this.streamDataController.request(a,b,{signal:c})};
b.prototype.loadAttribute=function(a,b,c){return this.load(this.layerUrl+"/nodes/"+a.resources.attributes+"/attributes/"+b.key+"/0","binary",c).then(function(a){return d.readBinaryAttribute(b,a)})};b.prototype.loadAttributes=function(a,b,c){var d=this;return g.eachAlways(b.map(function(b){return d.loadAttribute(a,b.attributeStorageInfo,c)})).then(function(c){for(var e={},f=0;f<b.length;++f)if(c[f].value)e[b[f].name]=c[f].value;else{if(g.isAbortError(c[f].error))throw c[f].error;d.logger.error("Failed to load attributeData for '"+
b[f].name+"' on node '"+a.id+"'",c[f].error)}return e})};b.prototype.loadNodeData=function(b,k){return a.__awaiter(this,void 0,void 0,function(){var l,n,p,r,q,t,A,B,C,F,H,I,G,J,E,L,M,N,Q,R,W,O,U,P,ba,V,T,X,Y;return a.__generator(this,function(a){switch(a.label){case 0:l=null!=this.requiredAttributes&&b.resources.attributes?m.result(this.loadAttributes(b,this.requiredAttributes,k)):null;var u=this.geometryDefinitions;a={bufferDefinition:null,bufferIndex:0};if(!(null==u||0>b.resources.geometryDefinition)&&
(u=0<=b.resources.geometryDefinition?u[b.resources.geometryDefinition].geometryBuffers:null,null!=u))for(var v=0;v<u.length;v++)if(null!=u[v].compressedAttributes){if("draco"===u[v].compressedAttributes.encoding&&!h("disable-feature:i3s-draco")){a.bufferIndex=v;a.bufferDefinition=u[v];break}}else a.bufferIndex=v,a.bufferDefinition=u[v];n=a;p=n.bufferDefinition;r=n.bufferIndex;q=b.resources.geometry?m.result(this.loadGeometry(b,r,k)):null;return b.resources.hasSharedResource?[4,this.loadShared(b,k)]:
[3,2];case 1:return A=a.sent(),[3,3];case 2:A=null,a.label=3;case 3:return t=A,C=(B=this.materialAndTextures&&0<=b.resources.materialDefinition?this.materialAndTextures[b.resources.materialDefinition]:null!=t?c.getMaterialAndTexturesFromShared(t):null)&&B.material,F=B&&B.textures,this.options.loadFeatureData?[4,this.loadFeatureData(b,k)]:[3,5];case 4:return I=a.sent(),[3,6];case 5:I=null,a.label=6;case 6:H=I;if(this.options.loadFeatureData)a:{a=0;for(u=H.featureData;a<u.length;a++){var v=u[a],w=v.geometries;
if(null!=w)for(;0<w.length;){a={featureIds:[v.id],featureDataPosition:v.position,geometries:[w[0]]};break a}}a=null}else a={featureIds:[],geometries:[{type:"ArrayBufferView",params:{material:C}}],featureDataPosition:[0,0,0]};G=a;if(a=f.isNone(G))for(a=[],u=0,v=H.featureData;u<v.length;u++)w=v[u],null!=w.position&&a.push({featureIds:[w.id],featureDataPosition:w.position,geometries:null});J=a;E=null!=F&&0<F.length?m.result(this.loadTextures(b,F,k)):null;M=L=null;if(!q)return[3,8];Q=(N=m).assertResult;
return[4,q];case 7:L=Q.apply(N,[a.sent()]),u=this.defaultGeometrySchema,v=t,u&&v&&v.materialDefinitions&&(w=Object.keys(v.materialDefinitions)[0],!v.materialDefinitions[w].params.vertexRegions&&u.vertexAttributes.region&&(u=e.clone(u),delete u.vertexAttributes.region)),R=u,M=d.createGeometryDescriptor(p,R),a.label=8;case 8:if(!E)return[3,10];P=(U=m).assertResult;return[4,E];case 9:return O=P.apply(U,[a.sent()]),[3,11];case 10:O=null,a.label=11;case 11:W=O;if(!l)return[3,13];X=(T=m).assertResult;return[4,
l];case 12:return V=X.apply(T,[a.sent()]),[3,14];case 13:V={},a.label=14;case 14:return Y=(ba=V)?{attributeData:ba,loadedAttributes:this.requiredAttributes}:null,f.isSome(G)?[2,{geometryData:G,attributeDataInfo:Y,geometryBuffer:L,geometryDescriptor:M,requiredTextures:F,textureData:W}]:f.isSome(J)?[2,{pointData:J,attributeDataInfo:Y,geometryBuffer:L,geometryDescriptor:M,requiredTextures:F,textureData:W}]:[2,g.reject()]}})})};b.addAbsoluteHrefTexture=function(a,b){a=a.textureDefinitions;if(null!=a)for(var c=
0,d=Object.keys(a);c<d.length;c++)for(var e=0,f=a[d[c]].images;e<f.length;e++){var g=f[e];Array.isArray(g.href)?g.hrefConcat=g.href.map(function(a){return l.makeAbsolute(a,b)}):g.hrefConcat=l.makeAbsolute(g.href,b)}};b.fixTextureEncodings=function(a){a=a.textureDefinitions;if(null!=a)for(var b in a){var c=a[b];if(Array.isArray(c.encoding))for(var d=0;d<c.encoding.length;d++){var e=c.encoding[d];"data:"===e.substring(0,5)&&(c.encoding[d]=e.substring(5))}else e=c.encoding,"data:"===e.substring(0,5)&&
(c.encoding=e.substring(5))}};b.prototype.loadShared=function(a,c){var d=this.layerUrl+"/nodes/"+a.resources.geometry+"/shared";return this.load(d,"json",c).then(function(a){b.fixTextureEncodings(a);b.addAbsoluteHrefTexture(a,d);return a})};b.prototype.loadTexture=function(a,b,c,d,e,f){return e===k.DDS_ENCODING_STRING?this.load(a,"binary",f).then(function(a){return{id:b,usage:c,data:a,encoding:e}}):this.load(a,"image",f).then(function(a){var f=a;if(d&&4096<=a.width*a.height){var f=Math.ceil(a.width/
2),g=Math.ceil(a.height/2),h=document.createElement("canvas");h.width=f;h.height=g;h.getContext("2d").drawImage(a,0,0,f,g);f=h}return{id:b,usage:c,data:f,encoding:e}})};b.prototype.loadTextures=function(a,c,d){var e=this,f=this.options.textureFormat===b.TextureFormat.Compressed,h=this.options.textureFormat===b.TextureFormat.Downsampled,l=this.options.textureUsageMask;return g.all(c.map(function(b){if(0===(b.usage&l))return null;var c=k.selectEncoding(b.encodings,f);return null==c?(e.logger.error("No known encoding for texture found on node "+
a.id),g.reject()):e.loadTexture(e.layerUrl+"/nodes/"+(a.resources.texture||a.id)+"/textures/"+c.name,b.id,b.usage,h,c.encoding,d)}))};b.prototype.loadFeatureData=function(a,b){return this.load(this.layerUrl+"/nodes/"+a.id+"/features/0","json",b)};b.prototype.loadGeometry=function(a,b,c){return this.load(this.layerUrl+"/nodes/"+a.resources.geometry+"/geometries/"+b,"binary",c)};return b}();(function(a){a=a.TextureFormat||(a.TextureFormat={});a[a.Compressed=0]="Compressed";a[a.Normal=1]="Normal";a[a.Downsampled=
2]="Downsampled"})(n||(n={}));return n})},"esri/views/3d/layers/i3s/I3SMaterialUtil":function(){define("require exports ../../../../core/mathUtils ../../../../core/maybe ../../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});b.getMaterialAndTextures=function(a,b){var d=new Map,c=function(a,b){if(m.isNone(a))return-1;if(d.has(a.id))return a=
d.get(a.id),a.usage|=b,a.id;var c=d.size;d.set(a.id,{id:c,usage:b});return c},e=b.pbrMetallicRoughness,g=e&&e.baseColorFactor,l=b.emissiveFactor,n=null==b.normalTexture&&null==b.emissiveTexture&&null==b.occlusionTexture&&(e?null==e.metallicRoughnessTexture&&1===e.roughnessFactor&&(1===e.metallicFactor||0===e.metallicFactor):!0),u=n?h.PBRSchematicMRRValues[0]:e?e.metallicFactor:1,v=n?h.PBRSchematicMRRValues[1]:e?e.roughnessFactor:1,e={baseColorFactor:g?[g[0],g[1],g[2],g[3]]:[1,1,1,1],baseColorTextureId:c(e&&
e.baseColorTexture,"mask"===b.alphaMode?33:1),metallicRoughnessTextureId:c(e&&e.metallicRoughnessTexture,2),metallicFactor:u,roughnessFactor:v};b={alphaMode:b.alphaMode,alphaCutoff:b.alphaCutoff,doubleSided:b.doubleSided,cullFace:"none"===b.cullFace?0:"back"===b.cullFace?2:"front"===b.cullFace?1:void 0,normalTextureId:c(b.normalTexture,4),emissiveTextureId:c(b.emissiveTexture,16),occlusionTextureId:c(b.occlusionTexture,8),emissiveFactor:l?[l[0],l[1],l[2]]:[0,0,0],metallicRoughness:e,wrapTextures:!1,
isSchematic:n};var z=[];d.forEach(function(b,c){b=b.usage;var d=m.isSome(a)&&a[c]&&a[c].formats,d=d?d.map(function(a){return{name:a.name,encoding:f[a.format]}}):[];z.push({id:c,usage:b,encodings:d})});return{material:b,textures:z}};var f={jpg:"image/jpeg",png:"image/png",dds:"image/vnd-ms.dds","ktx-etc2":"image/ktx"};b.getMaterialAndTexturesFromShared=function(b){var f=b&&b.materialDefinitions?Object.keys(b.materialDefinitions)[0]:null,d=b&&b.textureDefinitions?Object.keys(b.textureDefinitions)[0]:
null,f=f&&b.materialDefinitions[f],d=d&&b.textureDefinitions[d];b={alphaMode:"opaque",alphaCutoff:e.defaultMaskAlphaCutoff,doubleSided:!0,cullFace:0,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,isSchematic:!0};if(null!=f){f=f.params;f.diffuse&&(b.metallicRoughness.baseColorFactor=[f.diffuse[0],f.diffuse[1],
f.diffuse[2],1]);null!=f.doubleSided&&(b.doubleSided=f.doubleSided,b.cullFace=f.doubleSided?0:2);if("none"===f.cullFace||"front"===f.cullFace||"back"===f.cullFace)b.cullFace="none"===f.cullFace?0:"back"===f.cullFace?2:1;f.transparency&&(b.metallicRoughness.baseColorFactor[3]=a.clamp(1-f.transparency,0,1));if(f.useVertexColorAlpha||1>b.metallicRoughness.baseColorFactor[3])b.alphaMode="blend"}f=[];if(null!=d){!d.wrap||"repeat"!==d.wrap[0]&&"repeat"!==d.wrap[1]||(b.wrapTextures=!0);var c=1;"rgba"===
d.channels&&(b.alphaMode="blend",c|=32);var g=d.images[d.images.length-1],h=function(a){return a&&a.split("/").pop()},d=Array.isArray(d.encoding)?d.encoding.map(function(a,b){return{name:h(g.href[b]),encoding:a}}):[{name:h(g.href),encoding:d.encoding}];f.push({id:0,usage:c,encodings:d});b.metallicRoughness.baseColorTextureId=0}return{material:b,textures:f}}})},"esri/views/3d/layers/i3s/I3SStreamDataController":function(){define(["require","exports","tslib","../../../../core/promiseUtils"],function(n,
b,a,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this.requester=a;this.activeRequests=new Set}Object.defineProperty(b.prototype,"busy",{get:function(){return this.requester.busy},enumerable:!0,configurable:!0});b.prototype.request=function(b,f,g){var e=this,d=m.createAbortController();m.onAbortOrThrow(g,function(){return d.abort()});g=a.__assign(a.__assign({},g),{signal:d.signal});b=this.requester.request(b,f,g);var c={response:b,abortController:d};this.activeRequests.add(c);
m.always(b,function(){return e.activeRequests.delete(c)});return b};b.prototype.cancelAll=function(){this.activeRequests.forEach(function(a){return a.abortController.abort()});this.activeRequests.clear()};return b}();b.I3SStreamDataController=n;b.default=n})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../layers/graphics/dehydratedFeatures ../graphics/elevationAlignmentUtils ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ./I3SUtil ../../support/geometryUtils ../../support/orientedBoundingBox ../../support/projectionUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r){return function(){function b(a,b,c,d,e,g,l){void 0===l&&(l={});this.indexSR=a;this._renderCoordsHelper=b;this.extent=d;this.elevationProvider=e;this.options=l;this.fp=k.frustum.create();this._poi=h.vec3f64.create();this.minDistance=Infinity;this.maxDistance=0;this.maxLodLevel=2;this._tmp1=h.vec3f64.create();this._tmp2=h.vec3f64.create();this._tmp3=h.vec3f64.create();this._tmp0=h.vec3f64.create();this.screenspaceErrorBias=l.screenspaceErrorBias||1;this.progressiveLoadFactor=
l.progressiveLoadFactor||1;this.updateCamera(c);this.engineSR=this._renderCoordsHelper.spatialReference;this.updateElevationInfo(g);this.tmpPoint=f.makeDehydratedPoint(0,0,0,a)}b.prototype.updateElevationInfo=function(a){null==a?this._elevationContext=null:(this._elevationContext=l.ElevationContext.fromElevationInfo(a),this._elevationContext.updateFeatureExpressionInfoContext(d.createContextWithoutExpressionSupport(d.extractExpressionInfo(a,!1))))};b.prototype.updateCamera=function(a){k.frustum.fromMatrix(a.viewMatrix,
a.projectionMatrix,this.fp);this._screenSizeFactor=1/(a.perScreenPixelRatio/2);this._camPos=a.eye;this.minDistance=Infinity;this.maxDistance=0};b.prototype.setPointOfInterest=function(a){m.vec3.copy(this._poi,a)};b.prototype.updateScreenSpaceErrorBias=function(a){var b=this.screenspaceErrorBias;this.screenspaceErrorBias=a;return b};b.prototype.updateExtent=function(a){this.extent=a};b.prototype.getRenderMbs=function(a){var b=a.renderMbs;0>b[3]&&(e.vec4.copy(b,a.mbs),this._elevationContext&&1E5>b[3]&&
(this.tmpPoint.x=b[0],this.tmpPoint.y=b[1],this.tmpPoint.z=b[2],b[2]=g.evaluateElevationAlignmentAtPoint(this.tmpPoint,this.elevationProvider,this._elevationContext,this._renderCoordsHelper)),r.mbsToMbs(b,this.indexSR,b,this.engineSR));return b};b.prototype.getRenderObb=function(b){var d=b.authorativeObb||b.obb;if(!(a.isNone(d)||0>d.halfSize[0])){a.isNone(b.renderObb)&&(b.renderObb=p.create());var e=b.renderObb;if(0>e.halfSize[0]){if(a.isSome(b.authorativeObb))return p.set(b.authorativeObb,e),b.authorativeObb;
var f=0;this._elevationContext&&1E5>b.mbs[3]&&(this.tmpPoint.x=d.center[0],this.tmpPoint.y=d.center[1],this.tmpPoint.z=d.center[2],f=g.evaluateElevationAlignmentAtPoint(this.tmpPoint,this.elevationProvider,this._elevationContext,this._renderCoordsHelper)-d.center[2]);c.transformObb(d,this.indexSR,e,this.engineSR,f,b.isComputedObb)}return e}};b.prototype.isNodeVisible=function(b){var c=this.getRenderMbs(b);if(!this.isMBSinExtent(c))return!1;b=this.getRenderObb(b);return a.isSome(b)?p.isVisible(b,this.fp):
this.isMBSVisible(c)};b.prototype.isGeometryVisible=function(b){b=this.getRenderObb(b);return a.isSome(b)?p.isVisible(b,this.fp):!0};b.prototype.isMBSinExtent=function(a){return this.extent?0!==c.intersectBoundingBoxWithMbs(this.extent,a):!0};b.prototype.isMBSVisible=function(a){return k.frustum.intersectsSphere(this.fp.planes,k.sphere.wrap(a[3],a))};b.prototype.screenSpaceDiameterMbs=function(a,b){var c=this.getRenderMbs(a);a=Math.sqrt(m.vec3.squaredDistance(c,this._camPos));c=a-c[3];this._updateMinMaxDistance(a);
return 0>c?.5*Number.MAX_VALUE:b/c*this._screenSizeFactor};b.prototype.calcCameraDistance=function(a){return this.calcCameraDistanceToCenter(a)-this.getRenderMbs(a)[3]};b.prototype.calcCameraDistanceToCenter=function(a){a=this.getRenderMbs(a);a=m.vec3.distance(a,this._camPos);this._updateMinMaxDistance(a);return a};b.prototype.calcAngleDependentLoD=function(a){a=this.getRenderMbs(a);var b=a[3];a=(Math.abs(a[0]*(a[0]-this._camPos[0])+a[1]*(a[1]-this._camPos[1])+a[2]*(a[2]-this._camPos[2]))/m.vec3.length(a)+
b)/m.vec3.distance(a,this._camPos);return Math.min(1,a)};b.prototype.hasLOD=function(a){return 0!==a.lodMetric};b.prototype.getDistancePlanarMode=function(a,b){var c=a[0]-b[0],d=a[1]-b[1];a=a[2]-b[2];c=c*c+d*d;b=b[3];if(c<=b*b)return Math.abs(a);b=Math.sqrt(c)-b;return Math.sqrt(a*a+b*b)};b.prototype.getDistanceGlobeMode=function(a,b){var c=m.vec3.length(b),d=m.vec3.length(a)-c;m.vec3.scale(this._tmp0,a,m.vec3.dot(a,b)/m.vec3.squaredLength(a));var e=m.vec3.squaredDistance(b,this._tmp0),f=b[3];if(e<=
f*f)return Math.abs(d);b=m.vec3.scale(this._tmp0,b,1/c);c=m.vec3.scale(this._tmp1,b,c-f*f/2/c);e=m.vec3.subtract(this._tmp2,a,c);e=m.vec3.subtract(this._tmp2,e,m.vec3.scale(this._tmp3,b,m.vec3.dot(b,e)));c=m.vec3.add(this._tmp2,c,m.vec3.scale(this._tmp2,e,f/m.vec3.length(e)));f=m.vec3.distance(a,c);2E5<=d&&(a=m.vec3.subtract(this._tmp1,a,c),a=m.vec3.dot(a,b)/m.vec3.length(a),.08>a&&(a=1E-4),f/=a);return f};b.prototype.getDistance=function(a,b){return this.engineSR===r.SphericalECEFSpatialReference?
this.getDistanceGlobeMode(a,b):this.getDistancePlanarMode(a,b)};b.prototype._updateMinMaxDistance=function(a){0<a?(this.minDistance=Math.min(this.minDistance,a),this.maxDistance=Math.max(this.maxDistance,a)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-a))};b.prototype.getLodLevel=function(a){if(0===a.lodMetric||!a.resources.hasFeatureData)return 0;if(0===a.childCount)return this.maxLodLevel;if(1>this.progressiveLoadFactor){var b=this.screenspaceErrorBias;return this.evaluateLODmetric(a,
this.progressiveLoadFactor*this.screenspaceErrorBias)?this.evaluateLODmetric(a,b)?2:1:0}return this.evaluateLODmetric(a,this.screenspaceErrorBias)?this.maxLodLevel:0};b.prototype.evaluateLODmetric=function(a,b){switch(a.lodMetric){case 2:var c=this.getRenderMbs(a),d=this.getDistance(this._camPos,c),e=2*d/this._screenSizeFactor;this._updateMinMaxDistance(d+c[3]);return a.maxError*b<=e;case 1:return b=this.screenSpaceDiameterMbs(a,a.mbs[3]*b),this.options.angleDependentLoD&&(b*=this.calcAngleDependentLoD(a)),
b<a.maxError;case 3:return 10>this.screenSpaceDiameterMbs(a,a.maxError)*b;case 4:return this.calcCameraDistance(a)>a.maxError*b}return!1};b.prototype.distToPOI=function(a){a=this.getRenderMbs(a);return m.vec3.distance(a,this._poi)-a[3]};b.prototype.distCameraToPOI=function(){return m.vec3.distance(this._camPos,this._poi)};return b}()})},"esri/layers/support/SceneModification":function(){define("require exports tslib ../../geometry ../../core/JSONSupport ../../core/lang ../../core/Warning ../../core/accessorSupport/decorators ../../core/accessorSupport/decorators/persistable ../../views/3d/support/projectionUtils".split(" "),
function(n,b,a,m,h,e,f,g,l,d){return function(b){function c(a){a=b.call(this,a)||this;a.geometry=null;a.type="clip";return a}a.__extends(c,b);h=c;c.prototype.writeGeometry=function(a,b,c,e){if(e.layer&&e.layer.spatialReference&&!e.layer.spatialReference.equals(this.geometry.spatialReference)){if(!d.canProject(a.spatialReference,e.layer.spatialReference)){e&&e.messages&&e.messages.push(new f("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",
{modification:this,spatialReference:e.layer.spatialReference,context:e}));return}var g=new m.Polygon({spatialReference:e.layer.spatialReference});d.polygonToPolygon(a,g);b[c]=g.toJSON(e)}else b[c]=a.toJSON(e);delete b[c].spatialReference};c.prototype.clone=function(){return new h({geometry:e.clone(this.geometry),type:this.type})};var h;a.__decorate([g.property({type:m.Polygon}),l.persistable()],c.prototype,"geometry",void 0);a.__decorate([g.writer(["web-scene","portal-item"],"geometry")],c.prototype,
"writeGeometry",null);a.__decorate([g.property({type:["clip","mask","replace"],nonNullable:!0}),l.persistable()],c.prototype,"type",void 0);return c=h=a.__decorate([g.subclass("esri.layers.support.SceneModification")],c)}(h.JSONSupport)})},"esri/views/3d/layers/I3SMeshViewLabeler":function(){define("require exports tslib ../../../Graphic ../../../symbols ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/accessorSupport/diffUtils ../../../core/libs/gl-matrix-2/vec3f64 ../../../layers/graphics/dehydratedFeatures ./graphics/Graphics3DCore ./graphics/Graphics3DScaleVisibility ./i3s/I3SGeometryUtil ../support/LimitGraphicsMap".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function c(a){a=b.call(this,a)||this;a.loadedGraphics=new u.LimitGraphicsMap(5E4);a.slicePlaneEnabled=!1;a._renderingInfo={symbol:new h.PointSymbol3D};a._handles=new f;a._graphicsByNode=new Map;a._scaleVisibility=null;return a}a.__extends(c,b);c.prototype.initialize=function(){var a=this;this._graphicsCore=new p.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:1,elevationFeatureExpressionEnabled:!1,
graphicSymbolSupported:!1,getRenderingInfoWithoutRenderer:!0,hasZ:!0,hasM:!1});var b=this.view.basemapTerrain;this._scaleVisibility=new r({layerScaleEnabled:!1});this._scaleVisibility.setup(this,this.layer,function(b,c,d){return a._graphicsCore.spatialIndex.queryGraphicUIDsInExtent(b,c,d)},this._graphicsCore,b);var b=this.view.labeler.addGraphicsOwner(this._graphicsCore,this._scaleVisibility,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}}),
c=this.view.deconflictor.addGraphicsOwner(this._graphicsCore);this._graphicsCore.setup({labeler:b,deconflictor:c,scaleVisibility:this._scaleVisibility}).then(function(){a._graphicsCore.startCreateGraphics()}).catch(function(){});this._handles.add([this.layer.watch("labelingInfo",function(b,c){d.diff(b,c)&&a._graphicsCore.updateLabelingInfo()})])};c.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);null!=this._scaleVisibility&&(this._scaleVisibility.destroy(),
this._scaleVisibility=null);null!=this._graphicsCore&&(this._graphicsCore.destroy(),this._graphicsCore=null);this.loadedGraphics.destroy();this.view=null};c.prototype.addNodeMeta=function(a,b){var c=this,d=0,e=a.filteredIds,f=a.featureIds.map(function(f,h){t.boundingBoxTop(h,c.collection,a.objectHandle,z);var l=k.makeDehydratedPoint(0,0,0,c.view.spatialReference);c.view.renderCoordsHelper.fromRenderCoords(z,l);h=b(h,a);var n=!1;g.isNone(e)?n=!0:d<e.length&&f===e[d]&&(n=!0,d++);return{objectId:f,uid:m.generateUID(),
attributes:h,visible:n,geometry:l}});this.loadedGraphics.addMany(f);this._graphicsByNode.set(a.node.index,f)};c.prototype.setNodeMetaAttributes=function(a,b){for(var c=this._graphicsByNode.get(a.node.index),d=Array(c.length),e=0;e<c.length;e++){var f=c[e];f.attributes=b(e,a);d[e]=f.uid}this._graphicsCore.updateLabelingInfo(d)};c.prototype.applyFilterChange=function(a){var b=this._graphicsByNode.get(a.node.index);if(b)if(g.isNone(a.filteredIds))for(a=0;a<b.length;a++){var c=b[a];c.visible||(c.visible=
!0,v.graphic=c,v.property="visible",v.oldValue=!1,v.newValue=!0,this._graphicsCore.graphicUpdateHandler(v))}else for(var d=0,e=0;e<b.length;e++){var c=b[e],f=c.visible;d<a.filteredIds.length&&c.objectId===a.filteredIds[d]?(c.visible=!0,d++):c.visible=!1;f!==c.visible&&(v.graphic=c,v.property="visible",v.oldValue=f,v.newValue=c.visible,this._graphicsCore.graphicUpdateHandler(v))}};c.prototype.removeNodeMeta=function(a){this.loadedGraphics.removeManyByObjectId(a.featureIds)};c.prototype.getRenderingInfo=
function(){return this._renderingInfo};c.prototype.notifyGraphicUpdate=function(){};Object.defineProperty(c.prototype,"usedMemory",{get:function(){return this._graphicsCore.usedMemory},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"unloadedMemoryEstimate",{get:function(){return this._graphicsCore.unprocessedMemoryEstimate},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"test",{get:function(){return{graphicsCore:this._graphicsCore}},enumerable:!0,configurable:!0});
a.__decorate([l.property()],c.prototype,"view",void 0);a.__decorate([l.property()],c.prototype,"layer",void 0);a.__decorate([l.property()],c.prototype,"collection",void 0);a.__decorate([l.property()],c.prototype,"loadedGraphics",void 0);a.__decorate([l.property({aliasOf:"_graphicsCore.updating"})],c.prototype,"updating",void 0);a.__decorate([l.property()],c.prototype,"slicePlaneEnabled",void 0);a.__decorate([l.property()],c.prototype,"_graphicsCore",void 0);return c=a.__decorate([l.subclass("esri.views.3d.layers.I3SMeshViewLabeler")],
c)}(e);var v={graphic:null,property:null,oldValue:null,newValue:null},z=c.vec3f64.create();b.default=n})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("require exports tslib ../../../../core/arrayUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../support/projectionUtils @dojo/framework/shim/Promise".split(" "),function(n,b,a,m,h,e,f,g,l){function d(a,b){return k.intersects(a,
b)?k.contains(a,b)?0:2:1}function c(a,b){return k.intersects(a,b)?k.contains(a,b)?1:2:0}Object.defineProperty(b,"__esModule",{value:!0});var k;b.isGeometryEngineLoaded=function(){return!!k};b.loadGeometryEngine=function(){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(a){switch(a.label){case 0:return k?[2,k]:[4,new Promise(function(a,b){n(["../../../../geometry/geometryEngine"],a,b)})];case 1:return k=a.sent(),[2,k]}})})};b.processFilterGeometry=function(a,b){if(!a)return null;
if("disjoint"===b&&"polygon"===a.type){var c=Array(a.rings.length);for(b=0;b<a.rings.length;++b){var d=g.fromValues(Infinity,Infinity,-Infinity,-Infinity);g.expandWithNestedArray(d,a.rings[b]);c[b]={type:"polygon",rings:[a.rings[b]],spatialReference:a.spatialReference,aabr:d}}c.sort(function(a,b){return a.aabr[0]-b.aabr[0]});var e=new Set,f=new m.PositionHint;a=function(a){var b=c[a];for(a+=1;a<c.length;++a){var d=c[a];if(d.aabr[0]>=b.aabr[2])break;e.add(d)}e.forEach(function(a){b!==a&&(a.aabr[2]<=
b.aabr[0]?e.delete(a):k.intersects(b,a)&&(b.rings=b.rings.concat(a.rings),g.expand(b.aabr,a.aabr),delete b._geVersion,e.delete(a),a=m.indexOf(c,a,c.length,f),c.splice(a,1)))});e.add(b)};for(b=0;b<c.length;++b)a(b);for(a=0;a<c.length;a++)delete c[a].aabr;return c}return[a]};b.acquireMaskFilterContext=function(a,b,e,f,g){b=b.renderSpatialReference;var h=new Map,l={rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],hasZ:!1,hasM:!1,type:"polygon",spatialReference:e};l.rings[0][3]=l.rings[0][0];var m,n;switch(a){case "intersects":m=
function(a,b){return k.intersects(a,b)?0:2};n=d;break;case "contains":m=function(a,b){return k.contains(a,b)?2:1};n=d;break;default:m=function(a,b){return k.disjoint(a,b)?2:1},n=c}return{collection:f,object:g,type:a,maskSR:e,renderSR:b,aabbCache:h,triangle:l,positions:{indices:null,data:null,stride:0,startIndex:0,endIndex:0},triangleTest:m,geometryTest:n}};b.computeMaskNodeMBS=function(a,b){var c={x:a[0],y:a[1],hasZ:!1,hasM:!1,type:"point",spatialReference:b.maskSR};a=b.maskSR.isWGS84||b.maskSR.isWebMercator?
k.geodesicBuffer(c,a[3],1):k.buffer(c,a[3],1);a.type="polygon";return a};b.testMaskWithGeometry=function(a,b,e){switch(e){case "intersects":case "contains":return d(a,b);case "disjoint":return c(a,b)}};var p=Math.pow(2,-32);b.filterWithMask=function(a,b,c){var d=c.collection,e=c.object,f=c.renderSR,g=c.maskSR,k=c.geometryTest,m=c.aabbCache,n=m.get(b);if(!n){var t=d.getObjectTransform(e);d.getComponentAABB(e,b,r);for(var u=[[r[0],r[1],0],[r[0],r[4],0],[r[3],r[4],0],[r[3],r[1],0]],n=0;4>n;++n)h.vec3.transformMat3(u[n],
u[n],t.rotationScale),h.vec3.add(u[n],u[n],t.position),l.vectorToVector(u[n],f,u[n],g);n={rings:[u],hasZ:!1,hasM:!1,type:"polygon",spatialReference:g};n.rings[0][4]=n.rings[0][0];m.set(b,n)}switch(k(a,n)){case 1:return!1;case 0:return!0}var k=c.triangle,m=c.triangleTest,n=c.positions,t=k.rings[0][0],u=k.rings[0][1],v=k.rings[0][2],z=d.getObjectTransform(e);d.getComponentPositions(e,b,n);b=n.indices;for(var d=n.data,e=n.stride,E=n.endIndex,n=n.startIndex;n<E;n+=3){var L=e*b[n+0],M=e*b[n+1],N=e*b[n+
2];h.vec3.set(t,d[L+0],d[L+1],d[L+2]);h.vec3.set(u,d[M+0],d[M+1],d[M+2]);h.vec3.set(v,d[N+0],d[N+1],d[N+2]);h.vec3.transformMat3(t,t,z.rotationScale);h.vec3.transformMat3(u,u,z.rotationScale);h.vec3.transformMat3(v,v,z.rotationScale);h.vec3.add(t,t,z.position);h.vec3.add(u,u,z.position);h.vec3.add(v,v,z.position);l.vectorToVector(t,f,t,g);l.vectorToVector(u,f,u,g);l.vectorToVector(v,f,v,g);if(!(Math.abs((u[0]-t[0])*(v[1]-t[1])-(u[1]-t[1])*(v[0]-t[0]))<p))switch(delete k._geVersion,m(a,k)){case 1:return!1;
case 0:return!0}}switch(c.type){case "intersects":return!1;default:return!0}};b.boundingBoxCornerPoints=function(a,b,c,d){a=b.getComponentAABB(c,a,r);b=b.getObjectTransform(c);for(c=0;8>c;++c)t[0]=c&1?a[0]:a[3],t[1]=c&2?a[1]:a[4],t[2]=c&4?a[2]:a[5],h.vec3.transformMat3(t,t,b.rotationScale),h.vec3.add(t,t,b.position),d[3*c]=t[0],d[3*c+1]=t[1],d[3*c+2]=t[2];return d};b.boundingBoxTop=function(a,b,c,d){a=b.getComponentAABB(c,a,r);b=b.getObjectTransform(c);d[0]=0;d[1]=0;for(c=d[2]=0;8>c;++c)t[0]=c&1?
a[0]:a[3],t[1]=c&2?a[1]:a[4],t[2]=a[5],h.vec3.transformMat3(t,t,b.rotationScale),h.vec3.add(t,t,b.position),d[0]+=t[0],d[1]+=t[1],d[2]+=t[2];d[0]/=8;d[1]/=8;d[2]/=8;return d};var r=f.create(),t=e.vec3f64.create()})},"esri/views/3d/support/LimitGraphicsMap":function(){define("require exports tslib ../../../core/Evented ../../../core/MapUtils ./GraphicsMap".split(" "),function(n,b,a,m,h,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a){var c=b.call(this)||this;c._limit=
a;c._all=new e.GraphicsMap;c._active=new g(c);c._pending=new Map;c._handle=c._all.on("change",function(a){return c._handleChanges(a)});return c}a.__extends(d,b);d.prototype.destroy=function(){this._handle.remove()};Object.defineProperty(d.prototype,"length",{get:function(){return this._active.length},enumerable:!0,configurable:!0});d.prototype.toArray=function(){return this._active.toArray()};d.prototype.find=function(a){return this._active.find(a)};d.prototype.forEach=function(a){this._active.forEach(a)};
d.prototype.addMany=function(a){this._all.addMany(a)};d.prototype.removeManyByObjectId=function(a){this._all.removeManyByObjectId(a)};d.prototype._handleChanges=function(a){var b=this,c=a.removed;if(0<this._pending.size)for(var c=[],d=0,e=a.removed;d<e.length;d++){var g=e[d];this._pending.delete(g.objectId)||c.push(g)}d=this._limit-this._active.length+c.length;d<a.added.length&&(this._active.removeMany(c),c=[],f.reset(1-this._limit/(this._active.length+a.added.length)),this._active.forEach(function(a){f.sample()&&
(c.push(a),b._pending.set(a.objectId,a))}),d=this._limit-this._active.length+c.length);var h=a.added;if(d<a.added.length)for(h=[],f.reset(d/a.added.length),e=0,a=a.added;e<a.length;e++)g=a[e],f.sample()?h.push(g):this._pending.set(g.objectId,g);g=d-h.length;0<g&&0<this._pending.size&&(f.reset(g/this._pending.size),this._pending.forEach(function(a){f.sample()&&(h.push(a),b._pending.delete(a.objectId))}));this._active.addAndRemove(h,c)};return d}(m);b.LimitGraphicsMap=n;var f=new (function(){function a(){this.percentage=
1;this.last=-1;this.index=0}a.prototype.reset=function(a){this.percentage=a;this.last=-1};a.prototype.sample=function(){var a=Math.floor(this.index*this.percentage);++this.index;if(a===this.last)return!1;this.last=a;return!0};return a}()),g=function(){function a(a){this._parent=a;this._map=new Map}Object.defineProperty(a.prototype,"length",{get:function(){return this._map.size},enumerable:!0,configurable:!0});a.prototype.forEach=function(a){this._map.forEach(function(b){return a(b)})};a.prototype.find=
function(a){var b;h.someMap(this._map,function(c){return a(c)?(b=c,!0):!1});return b};a.prototype.toArray=function(){return h.valuesOfMap(this._map)};a.prototype.addAndRemove=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];this._map.set(d.objectId,d)}for(c=0;c<b.length;c++)d=b[c],this._map.delete(d.objectId);(0<a.length||0<b.length)&&this._parent.emit("change",{added:a,removed:b})};a.prototype.removeMany=function(a){for(var b=0;b<a.length;b++)this._map.delete(a[b].objectId);0<a.length&&this._parent.emit("change",
{added:[],removed:a})};return a}()})},"esri/views/3d/support/GraphicsMap":function(){define(["require","exports","tslib","../../../core/Evented","../../../core/MapUtils"],function(n,b,a,m,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a._map=new Map;return a}a.__extends(e,b);e.prototype.clear=function(){if(0<this._map.size){var a=this.toArray();this._map.clear();this.emit("change",{added:[],removed:a})}};Object.defineProperty(e.prototype,
"length",{get:function(){return this._map.size},enumerable:!0,configurable:!0});e.prototype.get=function(a){return this._map.get(a)};e.prototype.addMany=function(a){if(0!==a.length){for(var b=new Set,d=0;d<a.length;d++){var c=a[d],e=c.objectId,f=this._map.get(e);f?(b.add(e),c!==f&&(a[d]=f),++f.refCount):(c.refCount=1,this._map.set(e,c))}a=0<b.size?a.filter(function(a){return!b.has(a.objectId)}):a;0<a.length&&this.emit("change",{added:a,removed:[]})}};e.prototype.removeMany=function(a){for(var b=[],
d=0;d<a.length;d++){var c=a[d],e=c.objectId,f=this._map.get(e);null!=f&&0>=--f.refCount&&(this._map.delete(e),b.push(c))}0<b.length&&this.emit("change",{added:[],removed:b})};e.prototype.removeManyByObjectId=function(a){for(var b=[],d=0;d<a.length;d++){var c=a[d],e=this._map.get(c);null!=e&&0>=--e.refCount&&(this._map.delete(c),b.push(e))}0<b.length&&this.emit("change",{added:[],removed:b})};e.prototype.toArray=function(){return h.valuesOfMap(this._map)};e.prototype.find=function(a){var b;h.someMap(this._map,
function(d){return a(d)?(b=d,!0):!1});return b};e.prototype.forEach=function(a){this._map.forEach(function(b){return a(b)})};return e}(m);b.GraphicsMap=n})},"esri/views/3d/layers/I3SMeshWorkerHandle":function(){define("require exports tslib ../../../core/Logger ../../../core/PooledArray ../support/projectionUtils ../support/WorkerHandle".split(" "),function(n,b,a,m,h,e,f){function g(a,b){d.clear();for(var f=function(a){var f="clip"===a.type?2:"mask"===a.type?1:0,g=a.geometry;a=function(a){return a};
if(g.spatialReference){if(!e.canProject(g.spatialReference,b))return l.warn("Can't project modification polygon into layer spatial reference, ignoring modification"),"continue";a=function(a){e.vectorToVector(a,g.spatialReference,c,b);return c}}else g.hasZ||(c[2]=0,a=function(a){c[0]=a[0];c[1]=a[1];return c});d.push(f);d.push(g.rings.length);for(var f=0,h=g.rings;f<h.length;f++){var k=h[f];d.push(k.length);for(var m=0;m<k.length;m++){var n=a(k[m]);d.push(n[0]);d.push(n[1]);d.push(n[2])}}},g=0;g<a.length;g++)f(a[g]);
d.push(3);a=new Float64Array(d.length);for(f=0;f<d.length;++f)a[f]=d.getItemAt(f);return a}Object.defineProperty(b,"__esModule",{value:!0});var l=m.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle");n=function(b){function c(a){return b.call(this,"SceneLayerWorker","process",a)||this}a.__extends(c,b);c.prototype.getTransferList=function(a){return[a.geometryBuffer]};c.prototype.setModifications=function(a,b,c){a={context:a,modifications:g(b,c)};this.broadcast(a,"setModifications")};c.prototype.setLegacySchema=
function(a,b){b=JSON.stringify(b);this.broadcast({context:a,jsonSchema:b},"setLegacySchema")};c.prototype.destroyContext=function(a){return this.broadcast(a,"destroyContext")};return c}(f.WorkerHandle);b.I3SMeshWorkerHandle=n;var d=new h({deallocator:null}),c=[0,0,0];b.toWasmModification=g})},"esri/views/3d/layers/i3s/Highlights":function(){define(["require","exports","../../../../core/arrayUtils"],function(n,b,a){var m=function(){return function(){this.ids=new Set;this.paused=!1}}();return function(){function b(a){this.highlights=
[];this.collection=a.collection;this.forAllFeatures=a.forAllFeatures;this.forAllFeaturesOfNode=a.forAllFeaturesOfNode}b.prototype.destroy=function(){var a=this;this.highlights.forEach(function(b){return a.releaseSet(b)});this.highlights=null};b.prototype.acquireSet=function(){var b=this,f=new m;this.highlights.push(f);return{set:f,handle:{remove:function(){b.releaseSet(f);a.removeUnordered(b.highlights,f)},pause:function(){b.releaseSet(f);f.paused=!0},resume:function(){f.paused=!1;b.initializeSet(f)}}}};
b.prototype.setFeatureIds=function(a,b){b.forEach(function(b){return a.ids.add(b)});this.initializeSet(a)};b.prototype.initializeSet=function(a){var b=this;this.forAllFeatures(function(e,f,d){a.ids.has(e)&&b.collection.addComponentHighlight(d.objectHandle,f);return 1})};b.prototype.releaseSet=function(a){var b=this;this.forAllFeatures(function(e,f,d){a.ids.has(e)&&b.collection.removeComponentHighlight(d.objectHandle,f);return 1})};b.prototype.objectCreated=function(a){var b=this;this.highlights.forEach(function(e){e.paused||
b.forAllFeaturesOfNode(a,function(f,d){e.ids.has(f)&&b.collection.addComponentHighlight(a.objectHandle,d);return 1})})};b.prototype.objectDeleted=function(a){this.collection.clearHighlights(a.objectHandle)};return b}()})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ../../webgl-engine/lib/Intersector".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r){var t=p.empty(),u=d.mat4f64.create(),v=k.vec3f64.create(),z=k.vec3f64.create(),w=k.vec3f64.create(),q=e.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");return function(b){function d(a){a=b.call(this,a)||this;a.tmpEvent={spatialReference:null,extent:t,context:"scene"};return a}a.__extends(d,b);d.prototype.initialize=function(){this.view=this.layerView.view;this.renderCoordsHelper=this.view.renderCoordsHelper;this.intersector=new r.Intersector(this.view.viewingMode);
this.intersector.options.store=0;var a=this.layerView.layer.fullExtent;this.zmin=a.zmin;this.zmax=a.zmax;this.tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"};d.prototype.getElevation=function(a,b,d,e){v[0]=a;v[1]=b;v[2]=d;if(!this.renderCoordsHelper.toRenderCoords(v,e,v))return q.error("could not project point for elevation alignment"),null;b=this.layerView.elevationOffset;a=this.zmin+b;b=this.zmax+b;c.vec3.copy(z,v);c.vec3.copy(w,v);this.renderCoordsHelper.setAltitude(b,z);this.renderCoordsHelper.setAltitude(a,
w);this.intersector.reset(z,w);this.intersectionHandler.intersect(this.intersector,null,z,w);return this.intersector.results.min.getIntersectionPoint(v)?this.renderCoordsHelper.getAltitude(v):null};d.prototype.layerChanged=function(){this.spatialReference&&(this.tmpEvent.extent=this.computeLayerExtent(),this.tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this.tmpEvent))};d.prototype.objectChanged=function(a){this.spatialReference&&(this.tmpEvent.extent=this.computeObjectExtent(a),
this.tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this.tmpEvent))};d.prototype.computeObjectExtent=function(a){p.empty(t);this.expandExtent(a,t);return t};d.prototype.computeLayerExtent=function(){p.empty(t);for(var a=0,b=this.layerView.getVisibleNodes();a<b.length;a++)this.expandExtent(b[a],t);return t};d.prototype.expandExtent=function(a,b){var d=a.renderObb;if(f.isSome(d))for(l.mat4.fromQuat(u,d.quaternion),u[12]=d.center[0],u[13]=d.center[1],u[14]=d.center[2],a=
0;8>a;++a)v[0]=a&1?d.halfSize[0]:-d.halfSize[0],v[1]=a&2?d.halfSize[1]:-d.halfSize[1],v[2]=a&4?d.halfSize[2]:-d.halfSize[2],c.vec3.transformMat4(v,v,u),this.renderCoordsHelper.fromRenderCoords(v,v,this.spatialReference),p.expand(b,v);else{var e=a.renderMbs[3],d=c.vec3.copy(z,a.renderMbs);d[0]-=e;d[1]-=e;d[2]-=e;var g=c.vec3.copy(w,a.renderMbs);g[0]+=e;g[1]+=e;g[2]+=e;for(a=0;8>a;++a)v[0]=a&1?d[0]:g[0],v[1]=a&2?d[1]:g[1],v[2]=a&4?d[2]:g[2],this.renderCoordsHelper.fromRenderCoords(v,v,this.spatialReference),
p.expand(b,v)}return b};a.__decorate([g.property({constructOnly:!0})],d.prototype,"layerView",void 0);a.__decorate([g.property({constructOnly:!0})],d.prototype,"intersectionHandler",void 0);a.__decorate([g.property()],d.prototype,"view",void 0);a.__decorate([g.property({readOnly:!0,aliasOf:"view.elevationProvider.spatialReference"})],d.prototype,"spatialReference",void 0);return d=a.__decorate([g.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],d)}(h.EventedMixin(m))})},"esri/views/3d/layers/i3s/I3SIntersectionHandler":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3 ../../support/orientedBoundingBox ../../webgl-engine/lib/intersectorUtils".split(" "),
function(n,b,a,m,h,e){function f(a,b,d,c){void 0===c&&(c=0);c=a[3]+c;var e=b[0]-a[0],f=b[1]-a[1];a=b[2]-a[2];b=d[0];var g=d[1];d=d[2];var h=b*e+g*f+d*a;return 0<=h*h-(b*b+g*g+d*d)*(e*e+f*f+a*a-c*c)}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this.type="I3S";this.layerUid=a.layerUid;this.sublayerUid=a.sublayerUid;this.collection=a.collection;this.forEach=a.forEach;this.slicePlane=a.slicePlaneEnabled;this.isGround=a.isGround}b.prototype.intersect=function(b,d,c,g){var k=
this,l=b.results,n=2===b.options.store,u=b.ray.direction,v=b.tolerance,z=function(a){return a},w=function(a){return a},q=e.getVerticalOffsetI3S(b.verticalOffset);a.isSome(q)&&(z=function(a){return q.applyToMbs(a)},w=function(a){return q.applyToObb(a)});this.forEach(function(p,r){a.isNone(p.authorativeObb)&&!f(z(p.renderMbs),c,u,v)||a.isSome(p.renderObb)&&!h.intersectLine(w(p.renderObb),c,u,v)||k.collection.intersect(r,c,g,v,q,function(a,f,h,q){if(0<=f&&(null==d||d(c,g,f))){var r=function(b){b.intersector=
k.type;b.target={type:"external",metadata:{layerUid:k.layerUid,sublayerUid:k.sublayerUid,nodeIndex:p.index,componentIndex:a}};b.dist=f;m.vec3.copy(b.normal,h);b.triangleNr=q};(null==l.min.dist||f<l.min.dist)&&r(l.min);(null==l.max.dist||f>l.max.dist)&&r(l.max);if(n){var t=new e.IntersectorResult(b.ray);r(t);b.results.all.push(t)}k.isGround&&(null==l.ground.dist||f<l.ground.dist)&&r(l.ground)}})})};Object.defineProperty(b.prototype,"intersectionHandlerId",{get:function(){return this.layerUid},enumerable:!0,
configurable:!0});return b}();b.I3SIntersectionHandler=n})},"esri/views/3d/layers/i3s/IDBCache":function(){define(["require","exports","../../../../core/Error","../../../../core/maybe","../../../../core/promiseUtils"],function(n,b,a,m,h){function e(a){return h.create(function(b,d){a.oncomplete=function(){return b()};a.onerror=function(){return d(a.error)};a.onabort=function(){return d(a.error)}})}function f(a){return h.create(function(b,d){"done"===a.readyState?null!=a.error?d(a.error):b(a.result):
(a.onsuccess=function(){return b(a.result)},a.onerror=function(){return d(a.error)})})}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,c){void 0===c&&(c=14);this._version=c;this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=1073741824;this.quotaReductionFactor=.2;this._dbName=a;this._storeName=b}b.prototype.init=function(){var a=this;return h.resolve().then(function(){var b=indexedDB.open(a._dbName,
a._version);b.onupgradeneeded=function(c){var d=b.result,e=b.transaction,f=d.objectStoreNames.contains(a._storeName)?e.objectStore(a._storeName):d.createObjectStore(a._storeName),d=d.objectStoreNames.contains("last_access")?e.objectStore("last_access"):d.createObjectStore("last_access");d.indexNames.contains("date")||d.createIndex("date","date",{unique:!1});d.indexNames.contains("byteSize")||d.createIndex("byteSize","byteSize",{unique:!1});c.oldVersion<a._version&&(f.clear(),d.clear())};return f(b)}).then(function(b){a._destroyed?
b.close():a._db=b})};b.prototype.destroy=function(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0};Object.defineProperty(b.prototype,"initialized",{get:function(){return null!=this._db},enumerable:!0,configurable:!0});b.prototype.getHitRate=function(){return this._hit/(this._hit+this._miss)};b.prototype.put=function(b,d){var c=this;return null==this._db?h.reject(new a("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:
h.resolve()).then(function(){return c._put(b,d)}).catch(function(a){if(a&&"QuotaExceededError"===a.name)return null==c._quotaReductionPromise&&(c._quotaReductionPromise=c._getCacheSize().then(function(a){return c._removeLeastRecentlyAccessed(d.byteSize+Math.ceil(a*c.quotaReductionFactor))}),c._quotaReductionPromise.then(function(){return c._quotaReductionPromise=null},function(){return c._quotaReductionPromise=null})),c._quotaReductionPromise.then(function(){return c._put(b,d)});throw a;}).then(function(){c._gcCounter--;
0>c._gcCounter&&null!=c._db&&(c._gcCounter=c.gcFrequency,c._getCacheSize().then(function(a){return c._removeLeastRecentlyAccessed(a-c.maxByteSize)}))})};b.prototype.get=function(a,b){var c=this;if(null==this._db)return h.resolve(null);var d=null;return h.resolve().then(function(){var e=c._db.transaction(c._storeName,"readonly");d=h.onAbort(b,function(){e.abort()});var g=e.objectStore(c._storeName).get(a);return f(g)}).then(function(b){null==b?++c._miss:c._db&&(++c._hit,c._db.transaction("last_access",
"readwrite").objectStore("last_access").put({date:Date.now(),byteSize:b.byteSize},a));m.isSome(d)&&d.remove();return b}).catch(function(){++c._miss;h.throwIfAborted(b);m.isSome(d)&&d.remove();return null})};b.prototype.remove=function(a){var b=this;return null==this._db?h.resolve():h.resolve().then(function(){var c=b._db.transaction([b._storeName,"last_access"],"readwrite"),d=c.objectStore(b._storeName),g=c.objectStore("last_access"),d=d.delete(a),g=g.delete(a);return h.all([f(d),f(g),e(c)])})};b.prototype._put=
function(a,b){var c=this._db.transaction([this._storeName,"last_access"],"readwrite"),d=c.objectStore(this._storeName),g=c.objectStore("last_access"),d=d.put(b,a);a=g.put({date:Date.now(),byteSize:b.byteSize},a);return h.all([f(d),f(a),e(c)])};b.prototype._removeLeastRecentlyAccessed=function(a){if(!(0>=a)){var b=this._db.transaction([this._storeName,"last_access"],"readwrite"),c=b.objectStore(this._storeName),f=b.objectStore("last_access"),g=0,h=f.index("date").openCursor(null,"next");h.onsuccess=
function(){var b=h.result;null!=b&&(null!=b.value.byteSize&&(g+=b.value.byteSize),c.delete(b.primaryKey),f.delete(b.primaryKey),g<a&&b.continue())};return e(b)}};b.prototype._getCacheSize=function(){var a=this._db.transaction("last_access"),b=0,c=a.objectStore("last_access").index("byteSize").openKeyCursor();c.onsuccess=function(){var a=c.result;if(a){var d=a.key;null!=d&&(b+=d);a.continue()}};return e(a).then(function(){return b})};return b}();b.IDBCache=n;b.whenTransaction=e;b.whenRequest=f})},
"esri/views/3d/webgl-engine/core/material/RenderTexture":function(){define(["require","exports","../../../../../core/maybe"],function(n,b,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,e){var f=this;this._textureRep=b;this._textureId=e;this._textureRef=a.applySome(this._textureId,function(a){return f._textureRep.acquire(a)})}b.prototype.dispose=function(){var b=this;this._textureRef=a.applySome(this._textureId,function(a){b._textureRep.release(a)})};b.prototype.bind=
function(b,e,f,g,l){a.isSome(this._textureRef)&&(e.setUniform1i(f,g),b.bindTexture(this._textureRef.glTexture,g),l&&(b=this._textureRef.glTexture,e.setUniform2f(l,b.descriptor.width,b.descriptor.height)))};return b}();b.RenderTexture=n})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Error ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../tasks/support/FeatureSet ../../../../tasks/support/Query".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k){Object.defineProperty(b,"__esModule",{value:!0});var p=d.default;n=function(b){function d(a){a=b.call(this,a)||this;a._dataQueryEngineInstance=null;a._handles=new e;return a}a.__extends(d,b);Object.defineProperty(d.prototype,"defaultQueryJSON",{get:function(){return(new k({outSpatialReference:this.spatialReference})).toJSON()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"dataQueryEngine",{get:function(){return this.ensureDataQueryEngine()},enumerable:!0,
configurable:!0});d.prototype.initialize=function(){var a=this;this._handles.add(this.layerView.on("visible-geometry-changed",function(){return a.spatialIndex.events.emit("changed")}))};d.prototype.destroy=function(){this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null);this._handles&&(this._handles.destroy(),this._handles=null);this._set("layerView",null)};d.prototype.executeQueryForCount=function(b,c){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,
function(a){return[2,this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(b),c)]})})};d.prototype.executeQueryForExtent=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var d,e,f,g;return a.__generator(this,function(a){switch(a.label){case 0:return[4,this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(b),c)];case 1:return d=a.sent(),e=d.count,f=d.extent,g=l.fromJSON(f),[2,{count:e,extent:g}]}})})};d.prototype.executeQueryForIds=function(b,c){return a.__awaiter(this,
void 0,void 0,function(){return a.__generator(this,function(a){return[2,this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(b),c)]})})};d.prototype.executeQuery=function(b,d){return a.__awaiter(this,void 0,void 0,function(){var e,f,g,k=this;return a.__generator(this,function(a){switch(a.label){case 0:e=this._ensureQueryJSON(b);if(e.returnGeometry)throw new h("feature-store:unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(e.returnCentroid)throw new h("feature-store:unsupported-query",
"returnCentroid is not yet supported for mesh scene layer queries");return[4,this.dataQueryEngine.executeQuery(e,d)];case 1:return f=a.sent(),g=c.fromJSON(f),g.features.forEach(function(a){a.geometry=null;a.layer=k.layer;a.sourceLayer=k.layer}),[2,g]}})})};d.prototype._ensureQueryJSON=function(a){if(f.isNone(a))return this.defaultQueryJSON;var b=a.toJSON();b.outSpatialReference||(a.outSpatialReference=this.spatialReference);return b};d.prototype.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;
var a=this.layer.objectIdField||"OBJECTID",b=this.layer.fields.map(function(a){return a.toJSON()}),c=this.layerView.view.resourceController.scheduler,d=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new p({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fields:b,timeInfo:null,spatialReference:d,objectIdField:a,featureStore:this.spatialIndex,scheduler:c,task:this.task})};a.__decorate([g.property({constructOnly:!0})],d.prototype,"layerView",void 0);a.__decorate([g.property({constructOnly:!0})],
d.prototype,"task",void 0);a.__decorate([g.property({constructOnly:!0})],d.prototype,"spatialIndex",void 0);a.__decorate([g.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],d.prototype,"spatialReference",void 0);a.__decorate([g.property({readOnly:!0,aliasOf:"layerView.layer"})],d.prototype,"layer",void 0);a.__decorate([g.property({readOnly:!0,dependsOn:["spatialReference"]})],d.prototype,"defaultQueryJSON",null);return d=a.__decorate([g.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],
d)}(m);b.I3SQueryEngine=n;b.default=n})},"esri/views/3d/layers/i3s/I3SQueryFeatureAdapter":function(){define("require exports ../../../../core/maybe ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/centroid ../../../../layers/graphics/OptimizedGeometry ./I3SUtil".split(" "),function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this.objectIdField=a.objectIdField;this.getFeatureExtent=a.getFeatureExtent}b.prototype.getObjectId=function(a){return a.id};
b.prototype.getAttributes=function(b){var c=b.meta,d=b.index,e={};this.objectIdField&&(e[this.objectIdField]=b.id);b=a.isSome(c.attributeInfo)&&c.attributeInfo.attributeData;if(a.isSome(b))for(var c=0,g=Object.keys(b);c<g.length;c++){var h=g[c];e[h]=f.getCachedAttributeValue(b[h],d)}return e};b.prototype.getAttribute=function(b,c){if(c===this.objectIdField)return b.id;var d=b.meta;b=b.index;d=a.isSome(d.attributeInfo)&&d.attributeInfo.attributeData;return a.isSome(d)?f.getCachedAttributeValue(d[c],
b):null};b.prototype.getGeometry=function(a){if(a.geometry)return a.geometry;var b=this.getFeatureExtent(a,g);a=b[0];var d=b[1],f=b[2],h=b[3],b=b[4];return new e.default([5],[a,d,f,h,d,f,h,b,f,a,b,f,a,d,f])};b.prototype.getCentroid=function(a,b){if(a.geometry)return h.getCentroidOptimizedGeometry(new e.default,a.geometry,b.hasZ,b.hasM);a=this.getFeatureExtent(a,g);return new e.default([0],[(a[0]+a[3])/2,(a[1]+a[4])/2,(a[2]+a[5])/2])};b.prototype.cloneWithGeometry=function(a,b){return{id:a.id,index:a.index,
meta:a.meta,geometry:b}};return b}();b.I3SQueryFeatureAdapter=n;var g=m.create()})},"esri/views/3d/layers/i3s/I3SQueryFeatureStore":function(){define("require exports tslib ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../support/projectionUtils".split(" "),function(n,b,a,m,h,e,f,g,l,d){Object.defineProperty(b,"__esModule",
{value:!0});n=function(b){function f(a){a=b.call(this,a)||this;a.events=new h;return a}a.__extends(f,b);f.prototype.destroy=function(){};f.prototype.forEach=function(a){this.forAllFeatures(function(b){a(b);return 1})};f.prototype.forEachBounds=function(a,b,c){for(var d=this.getFeatureExtent,e=0;e<a.length;e++)b(d(a[e],c))};f.prototype.forEachInBounds=function(a,b){var e=this;this.forAllFeatures(function(c){var d=e.getFeatureExtent(c,k);l.intersects(a,g.toRect(d,p))&&b(c);return 1},function(b){d.mbsToMbs(b.node.mbs,
e.sourceSpatialReference,c,e.viewSpatialReference);if(c[0]>=a[0]&&c[2]<=a[2]&&c[1]>=a[1]&&c[3]<=a[3])return 1;b=c[0]-Math.max(a[0],Math.min(c[0],a[2]));var f=c[1]-Math.max(a[1],Math.min(c[1],a[3]));return b*b+f*f<=c[3]*c[3]?1:2})};a.__decorate([e.property({constructOnly:!0})],f.prototype,"featureAdapter",void 0);a.__decorate([e.property({constructOnly:!0})],f.prototype,"forAllFeatures",void 0);a.__decorate([e.property({constructOnly:!0})],f.prototype,"getFeatureExtent",void 0);a.__decorate([e.property({constructOnly:!0})],
f.prototype,"sourceSpatialReference",void 0);a.__decorate([e.property({constructOnly:!0})],f.prototype,"viewSpatialReference",void 0);return f=a.__decorate([e.subclass("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],f)}(m);b.I3SQueryFeatureStore=n;var c=f.vec4f64.create(),k=g.create(),p=l.create();b.default=n})},"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":function(){define("require exports tslib ../../../../core/Logger ../../../../core/accessorSupport/decorators ../../../../core/sql/WhereClause ../i3s/I3SUtil".split(" "),
function(n,b,a,m,h,e,f){Object.defineProperty(b,"__esModule",{value:!0});var g=m.getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView");b.DefinitionExpressionSceneLayerView=function(b){return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a._definitionExpressionErrors=0;a._maxDefinitionExpressionErrors=20;a.logError=function(b){a._definitionExpressionErrors<a._maxDefinitionExpressionErrors&&g.error("Error while evaluating definitionExpression: "+b);a._definitionExpressionErrors++;
a._definitionExpressionErrors===a._maxDefinitionExpressionErrors&&g.error("Further errors are ignored")};return a}a.__extends(c,b);Object.defineProperty(c.prototype,"parsedDefinitionExpression",{get:function(){if(!this.layer||!this.layer.definitionExpression)return null;try{var a=e.WhereClause.create(this.layer.definitionExpression,this.layer.fieldsIndex);if(!a.isStandardized)return g.error("definitionExpression is using non standard function"),null;var b=[];f.findFieldsCaseInsensitive(a.fieldNames,
this.layer.fields,{missingFields:b});if(0<b.length)return g.error("definitionExpression references unknown fields: "+b.join(", ")),null;this._definitionExpressionErrors=0;return a}catch(r){return g.error("Failed to parse definitionExpression: "+r),null}},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"definitionExpressionFields",{get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null},enumerable:!0,configurable:!0});c.prototype._evaluateClause=
function(a,b){try{return a.testFeature(b)}catch(r){return this.logError(r),!1}};c.prototype._addDefinitionExpressionToQuery=function(a){if(!this.parsedDefinitionExpression)return a;var b=this.layer.definitionExpression;a=a.clone();a.where=a.where?"("+b+") AND ("+a.where+")":b;return a};a.__decorate([h.property()],c.prototype,"layer",void 0);a.__decorate([h.property({readOnly:!0,dependsOn:["layer.definitionExpression","layer.fieldsIndex"]})],c.prototype,"parsedDefinitionExpression",null);a.__decorate([h.property({readOnly:!0,
dependsOn:["parsedDefinitionExpression"]})],c.prototype,"definitionExpressionFields",null);return c=a.__decorate([h.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],c)}(b)}})},"esri/views/3d/layers/support/fieldProperties":function(){define(["require","exports","tslib","../../../../layers/support/fieldUtils"],function(n,b,a,m){Object.defineProperty(b,"__esModule",{value:!0});b.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],
readOnly:!0,dependsOn:["layer.fields","layer.outFields","requiredFields"],get:function(){var b=this.layer,e=this.layer.fields,f=this.requiredFields;return b.outFields?m.fixFields(e,a.__spreadArrays(m.unpackFieldNames(e,b.outFields),f)):m.fixFields(e,f)}}}}})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require exports tslib ../../../Graphic ../../../core/arrayUtils ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/SetUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingRect ../../../geometry/support/contains ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../renderers/support/renderingInfoUtils ../../../tasks/operations/zscale ../../../tasks/support/Query ./LayerView3D ./graphics/Graphics3DFeatureLikeLayerView ./graphics/QueryEngine ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/layerViewUpdatingProperties ./support/PopupSceneLayerView ../../3d/support/debugFlags ../support/GraphicsMap ../support/orientedBoundingBox ../support/projectionUtils ../../layers/LayerView ../../layers/support/FeatureFilter ../../support/Scheduler @dojo/framework/shim/Promise".split(" "),
function(n,b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L,M,N,Q,R){function W(a,b){for(var c=0;c<a.length;c++)for(var d=0,e=a[c].graphics;d<e.length;d++){var g=e[d];g.attributes||(g.attributes={});if(f.isSome(b)&&f.isSome(b.loadedAttributes))for(var h=0,k=b.loadedAttributes;h<k.length;h++){var l=k[h].name;b.attributeData[l]&&(g.attributes[l]=C.getCachedAttributeValue(b.attributeData[l],c))}}}var O=e.getLogger("esri.views.3d.layers.SceneLayerGraphicsView3D"),U=H.defineFieldProperties();
b=function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a._nodesAddedToStage=new Map;a.drapeSourceType=1;a._queryEngine=null;a._memCache=null;a.loadedGraphics=new E.GraphicsMap;a.holeFilling="always";a.progressiveLoadFactor=1;a.supportsHeightUnitConversion=!0;a._coordinatesOutsideExtentErrors=0;a._maxCoordinatesOutsideExtentErrors=20;return a}a.__extends(e,b);e.prototype.initialize=function(){var a=this,b=this.layer;C.checkSpatialReferences(b,this.view.spatialReference,this.view.viewingMode);
for(var c=0,e=["layer.renderer","layer.labelingInfo","layer.labelsVisible","definitionExpressionFields","filter"];c<e.length;c++)this.updatingHandles.add(this,e[c],function(){return a._updateRequiredFields()});this.updatingHandles.add(b,"rangeInfos",function(b){return a._rangeInfosChanged(b)},2);this.updatingHandles.add(b,"renderer",function(b,c){return a._rendererChange(b,c)});this.updatingHandles.add(this,"layer.objectIdFilter",function(){return a._filterChange()});this.updatingHandles.add(this,
"parsedDefinitionExpression",function(){return a._filterChange()});this.handles.add(d.init(J,"I3S_TREE_SHOW_TILES",function(b){if(b&&!a._treeDebugger){var c=a._controller.crsIndex;(new Promise(function(a,b){n(["./support/I3STreeDebugger"],a,b)})).then(function(b){b=b.I3STreeDebugger;!a._treeDebugger&&J.I3S_TREE_SHOW_TILES&&(a._treeDebugger=new b({lv:a,view:a.view,nodeSR:c}))})}else b||!a._treeDebugger||J.I3S_TREE_SHOW_TILES||(a._treeDebugger.destroy(),a._treeDebugger=null)}));this._updateRequiredFields();
this._set("graphics3d",new A.default({owner:this,layer:b,preferredUpdatePolicy:1,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,suspendResumeExtentMode:"data",dataExtent:b.fullExtent,updateClippingExtent:function(b){return a._updateClippingExtent(b)}}));if(this.graphics3d.elevationAlignment)this.graphics3d.elevationAlignment.events.on("invalidate-elevation",function(b){return a._invalidateElevation(b)});
this.supportsHeightUnitConversion&&(this._verticalScale=w.getGeometryZScaler("point",b.spatialReference,this.view.spatialReference));this.addResolvingPromise(this.graphics3d.setup());this._memCache=this.view.resourceController.memoryController.getMemCache(b.uid);this._controller=new u({layerView:this,scaleVisibilityEnabled:!1});this.when(function(){a._queryEngine=new B.default({layerView:a,task:R.Task.FEATURE_QUERY_ENGINE});a.updatingHandles.add(a,"maximumNumberOfFeatures",function(b){return a._controller.featureTarget=
b},2);a.updatingHandles.add(a,"suspended",function(b){b&&a._removeAllNodeData()})})};e.prototype.destroy=function(){this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null);this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null));this._controller&&(this._controller.destroy(),this._controller=null);this._queryEngine&&(this._queryEngine.destroy(),this._queryEngine=null);this._memCache.destroy();this._nodesAddedToStage=this._memCache=null};Object.defineProperty(e.prototype,
"maximumNumberOfFeatures",{get:function(){var a=this.graphics3d&&this.graphics3d.graphicsCore&&this.graphics3d.graphicsCore.displayFeatureLimit;return a?a.maximumNumberOfFeatures:0},set:function(a){null!=a?(this._override("maximumNumberOfFeatures",a),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return this.suspended?
!1:!!this._controller&&!this._controller.leafsReached},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"hasM",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"hasZ",{get:function(){return!0},enumerable:!0,configurable:!0});e.prototype.notifyGraphicUpdate=function(a,b){this.graphics3d.graphicsCore.notifyGraphicUpdate(a,b)};e.prototype.whenGraphicAttributes=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var d,e=this;return a.__generator(this,
function(a){d=function(a){for(var b=new Map,c=[],d=0;d<a.length;d++){var f=a[d],g=e._findGraphicNodeAndIndex(f),h=b.get(g.node);h||(h={node:g.node,indices:[],graphics:[]},c.push(h));h.indices.push(g.index);h.graphics.push(f)}return c};return[2,C.whenGraphicAttributes(this.layer,b,this._getObjectIdField(),c,d,{populateObjectId:!0})]})})};e.prototype.getGraphicFromGraphicUid=function(a){if(!this.loadedGraphics)return null;var b=t.hydrateGraphic(this.loadedGraphics.find(function(b){return b.uid===a}),
this.layer),c=this._getObjectIdField();if(!b||!b.attributes||!b.attributes[c])return null;b.layer=this.layer;b.sourceLayer=this.layer;return b};e.prototype.whenGraphicBounds=function(a,b){return this.graphics3d.graphicsCore.whenGraphicBounds(a,b)};e.prototype.computeAttachmentOrigin=function(a,b){return this.graphics3d.graphicsCore.computeAttachmentOrigin(a,b)};e.prototype.canResume=function(){return b.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};e.prototype.isUpdating=
function(){return!!(this._controller&&this._controller.updating||this.graphics3d&&this.graphics3d.updating)};e.prototype.getRenderingInfo=function(a,b,c){(a=z.getRenderingInfo(a,{renderer:b,arcade:c}))&&a.color&&(b=a.color,b[0]/=255,b[1]/=255,b[2]/=255);return a};e.prototype.getRenderingInfoAsync=function(b,c,d,e){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(f){return[2,z.getRenderingInfoAsync(b,a.__assign({renderer:c,arcade:d},e))]})})};Object.defineProperty(e.prototype,
"symbolUpdateType",{get:function(){return this.graphics3d.graphicsCore.symbolUpdateType},enumerable:!0,configurable:!0});e.prototype._findGraphicNodeAndIndex=function(a){a=a.attributes[this.layer.objectIdField];for(var b=0,c=h.keysOfMap(this._nodesAddedToStage);b<c.length;b++){var d=this._nodesAddedToStage.get(c[b]),e=this._findGraphicIndex(d.bundle,a);if(0<=e)return{node:d.node,index:e}}return null};e.prototype._findGraphicIndex=function(a,b){for(var c=0;c<a.length;c++)for(var d=0,e=a[c].featureIds;d<
e.length;d++)if(e[d]===b)return c;return-1};e.prototype.highlight=function(a){return this.graphics3d.highlight(a,this.layer.objectIdField)};e.prototype.addNodeData=function(a,b){if(!("pointData"in b))return g.reject();if(this._nodesAddedToStage.has(a.index))O.error("I3S node "+a.id+" already added");else{var c=b.pointData,d=b.attributeDataInfo;b=this._controller.crsIndex;var e=this._controller.crsVertex,h=this.view.spatialReference,k=[0,0,0],l=this._getObjectIdField(),n=[],p;if(p=this.layer.fullExtent)p=
this.layer.fullExtent.clone(),p.xmin-=.5,p.ymin-=.5,p.xmax+=.5,p.ymax+=.5,p.hasZ&&(p.zmin-=.5,p.zmax+=.5),p.hasM&&(p.mmin-=.5,p.mmax+=.5);var q=p;p=[];for(var u=[],v=0;v<c.length;v++){var w=c[v],y=w.featureDataPosition,z=y.length,A=w.geometries||[P[z]],B=w.featureIds;q&&!r.extentContainsCoords3D(q,y)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&O.error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&
O.error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++);for(var C=0;C<A.length;C++){var E=A[C];if("points"===E.params.type){var F=[],G=B[C<B.length?C:0],H={};null!=G&&(H[l]=G);var G=null==G?m.generateUID():G,I=void 0;"Embedded"===E.type&&(I=E.params.vertexAttributes.position);for(E=0;E<I.length;E+=z){for(var x=0;x<z;x++)k[x]=y[x]+I[E+x];x=3===z;a.obb||u.push(k[0],k[1],x?k[2]:0);M.bufferToBuffer(k,e,0,ba,h,0,1);var x=t.makeDehydratedPoint(ba[0],
ba[1],x?ba[2]:void 0,h),J=this.loadedGraphics.get(G);f.isSome(J)?F.push(J):F.push({objectId:G,uid:m.generateUID(),geometry:x,attributes:H,visible:!0})}p.push.apply(p,F);n.push({featureIds:w.featureIds,graphics:F})}}}a.numFeatures=p.length;this._updateNodeMemory(a);c={bundle:n,attributeInfo:d,node:a};W(c.bundle,c.attributeInfo);0<u.length&&(d=b.isGeographic?this.view.renderSpatialReference:b,M.bufferToBuffer(u,e,0,u,d,0,u.length/3),a.obb=L.compute({data:u,size:3,offsetIdx:0,strideIdx:3}),b.isGeographic&&
M.vectorToVector(a.obb.center,d,a.obb.center,b),this._controller.updateVisibility(a.index));if(!this._controller.isGeometryVisible(a))return this._cacheNodeData(c),g.resolve();if(this._verticalScale)for(b=0;b<p.length;b++)this._verticalScale(p[b].geometry);this._nodesAddedToStage.set(a.index,c);this.loadedGraphics.addMany(p);this._filterNode(c);this._treeDebugger&&this._treeDebugger.update();return g.resolve()}};e.prototype.isNodeLoaded=function(a){return this._nodesAddedToStage.has(a)};e.prototype.updateNodeState=
function(){};e.prototype._updateNodeMemory=function(a){a.memory=4096+(f.isSome(a.numFeatures)?a.numFeatures*this.graphics3d.graphicsCore.usedMemoryPerGraphic:0)};e.prototype._cacheNodeData=function(a){var b=a.bundle.reduce(function(a,b){return b.graphics.reduce(function(a,b){return t.estimateSize(b)+a},512+8*b.featureIds.length+a)},1024);this._memCache.put(this._getMemCacheKey(a.node),a,b)};e.prototype._getMemCacheKey=function(a){return""+a.index};e.prototype._removeAllNodeData=function(){var a=this;
this._nodesAddedToStage.forEach(function(b){b&&(a._updateNodeMemory(b.node),a._cacheNodeData(b))});this._nodesAddedToStage.clear();this._treeDebugger&&this._treeDebugger.update();this.loadedGraphics.clear()};e.prototype.removeNodeData=function(a,b){for(;0<a.length&&!b.done;){var c=a.pop();if(c=this._removeNodeStageData(c))this._updateNodeMemory(c.node),this._cacheNodeData(c);b.madeProgress()}};e.prototype._removeNodeStageData=function(a){var b=this._nodesAddedToStage.get(a);if(!b)return null;for(var c=
0,d=b.bundle;c<d.length;c++)this.loadedGraphics.removeMany(d[c].graphics);this._nodesAddedToStage.delete(a);this._treeDebugger&&this._treeDebugger.update();return b};e.prototype.loadCachedNodeData=function(a){return g.resolve(this._memCache.pop(this._getMemCacheKey(a)))};e.prototype.addCachedNodeData=function(a,b,c){if(this._nodesAddedToStage.has(a.index))O.error("I3S node "+a.id+" already added");else{for(var d=0,e=b.bundle;d<e.length;d++)this.loadedGraphics.addMany(e[d].graphics);this._nodesAddedToStage.set(a.index,
b);this._updateNodeMemory(a);this.setAttributeData(a.index,c);this._filterNode(b);this._treeDebugger&&this._treeDebugger.update();return g.resolve()}};e.prototype.getLoadedNodeIds=function(){var a=[];this._nodesAddedToStage.forEach(function(b){return a.push(b.node.id)});return a.sort()};e.prototype.getVisibleNodes=function(){var a=[];this._nodesAddedToStage.forEach(function(b){return a.push(b.node)});return a};e.prototype.getLoadedNodeIndices=function(a){this._nodesAddedToStage.forEach(function(b,
c){return a.push(c)})};e.prototype.getLoadedAttributes=function(a){if((a=this._nodesAddedToStage.get(a))&&f.isSome(a.attributeInfo))return a.attributeInfo.loadedAttributes};e.prototype.getAttributeData=function(a){if((a=this._nodesAddedToStage.get(a))&&f.isSome(a.attributeInfo))return a.attributeInfo.attributeData};e.prototype.setAttributeData=function(a,b){if(a=this._nodesAddedToStage.get(a))a.attributeInfo=b,W(a.bundle,b),this._filterNode(a),this.graphics3d.graphicsCore.labelsEnabled&&(b=a.bundle.map(function(a){return a.graphics.length&&
a.graphics[0].uid}),this.graphics3d.graphicsCore.updateLabelingInfo(b))};e.prototype._updateClippingExtent=function(a){this._controller&&this._controller.updateClippingArea(a);return!1};e.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};e.prototype._rendererChange=function(b,c){return a.__awaiter(this,void 0,void 0,function(){var d,e,f,g;return a.__generator(this,function(a){switch(a.label){case 0:return d=this.layer.fields,e=new Set,b?[4,b.collectRequiredFields(e,
d)]:[3,2];case 1:return a.sent(),f=l.valuesOfSet(e).sort(),[3,3];case 2:f=[],a.label=3;case 3:return e.clear(),c?[4,c.collectRequiredFields(e,d)]:[3,5];case 4:return a.sent(),g=l.valuesOfSet(e).sort(),[3,6];case 5:g=[],a.label=6;case 6:if(f.length===g.length&&f.every(function(a,b){return f[b]===g[b]}))return[2];this._reloadAllNodes();return[2]}})})};e.prototype._rangeInfosChanged=function(a){null!=a&&0<a.length&&O.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};
e.prototype._filterChange=function(){var a=this;this._nodesAddedToStage.forEach(function(b){return a._filterNode(b)})};e.prototype._reloadAllNodes=function(){this._removeAllNodeData();this._controller&&this._controller.restartNodeLoading()};e.prototype._filterNode=function(a){var b=this._getObjectIdField(),c=null;if(this.layer.objectIdFilter)var d=this.layer.objectIdFilter.ids,e="include"===this.layer.objectIdFilter.method,c=function(a){return 0<=d.indexOf(a)===e};var f=this.parsedDefinitionExpression,
g=0;for(a=a.bundle;g<a.length;g++)for(var h=0,k=a[g].graphics;h<k.length;h++){var l=k[h],m=l.visible;c&&!c(l.attributes[b])?l.visible=!1:l.visible=f?this._evaluateClause(f,l):!0;m!==l.visible&&(V.graphic=l,V.property="visible",V.oldValue=m,V.newValue=l.visible,this.graphics3d.graphicsCore.graphicUpdateHandler(V))}};e.prototype._updateRequiredFields=function(){return a.__awaiter(this,void 0,void 0,function(){var b,c,d,e,g,h,k,m,n;return a.__generator(this,function(a){switch(a.label){case 0:return b=
this,d=c=b.layer,e=d.fields,g=d.renderer,h=d.labelsVisible,k=b.filter,m=b.definitionExpressionFields,n=new Set,g?[4,g.collectRequiredFields(n,e)]:[3,2];case 1:a.sent(),a.label=2;case 2:return h?[4,v.collectLabelingFields(n,c)]:[3,4];case 3:a.sent(),a.label=4;case 4:return f.isSome(k)?[4,v.collectFilterFields(n,c,k)]:[3,6];case 5:a.sent(),a.label=6;case 6:return v.collectFields(n,e,m),this._set("requiredFields",l.valuesOfSet(n).sort()),[2]}})})};e.prototype._invalidateElevation=function(a){var b=this._controller.crsIndex;
M.boundingRectToBoundingRect(a.extent,a.spatialReference,T,b);this._controller.updateElevationChanged(T,b)};e.prototype.createQuery=function(){var a={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return f.isSome(this.filter)?this.filter.createQuery(a):new q(a)};e.prototype.queryFeatures=function(a,b){return this._queryEngine.executeQuery(this._ensureQuery(a),b&&b.signal)};e.prototype.queryObjectIds=function(a,b){return this._queryEngine.executeQueryForIds(this._ensureQuery(a),
b&&b.signal)};e.prototype.queryFeatureCount=function(a,b){return this._queryEngine.executeQueryForCount(this._ensureQuery(a),b&&b.signal)};e.prototype.queryExtent=function(a,b){return this._queryEngine.executeQueryForExtent(this._ensureQuery(a),b&&b.signal)};e.prototype._ensureQuery=function(a){return this._addDefinitionExpressionToQuery(f.isNone(a)?this.createQuery():q.from(a))};e.prototype.getUsedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return a?a.usedMemory:0};e.prototype.getUnloadedMemory=
function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return.8*((this._controller?this._controller.unloadedMemoryEstimate:0)+(a?a.unprocessedMemoryEstimate:0))};e.prototype.ignoresMemoryFactor=function(){return this._controller&&this._controller.fixedFeatureTarget};e.prototype.getNumberOfNodes=function(){return this._nodesAddedToStage.size};e.prototype.getNumberOfFeatures=function(){return this.loadedGraphics.length};Object.defineProperty(e.prototype,"performanceInfo",{get:function(){var a=
{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:this.maximumNumberOfFeatures,totalNumberOfFeatures:-1,nodes:this.getNumberOfNodes(),core:this.graphics3d.graphicsCore.performanceInfo};this._controller&&this._controller.updateStats(a);return a},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"test",{get:function(){return{controller:this._controller}},enumerable:!0,configurable:!0});a.__decorate([c.property()],e.prototype,"graphics3d",void 0);a.__decorate([c.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],
e.prototype,"hasDraped",void 0);a.__decorate([c.property({type:Q})],e.prototype,"filter",void 0);a.__decorate([c.property()],e.prototype,"loadedGraphics",void 0);a.__decorate([c.property()],e.prototype,"layer",void 0);a.__decorate([c.property()],e.prototype,"_controller",void 0);a.__decorate([c.property({dependsOn:["_controller.updating","graphics3d.updating"]})],e.prototype,"updating",void 0);a.__decorate([c.property({dependsOn:["_controller.rootNodeVisible"]})],e.prototype,"suspended",void 0);a.__decorate([c.property()],
e.prototype,"holeFilling",void 0);a.__decorate([c.property(I.updatingProgress)],e.prototype,"updatingProgress",void 0);a.__decorate([c.property({aliasOf:"_controller.updatingProgress"})],e.prototype,"updatingProgressValue",void 0);a.__decorate([c.property(U.requiredFields)],e.prototype,"requiredFields",void 0);a.__decorate([c.property(U.availableFields)],e.prototype,"availableFields",void 0);a.__decorate([c.property({type:Number,dependsOn:["graphics3d.graphicsCore.displayFeatureLimit"]})],e.prototype,
"maximumNumberOfFeatures",null);a.__decorate([c.property({readOnly:!0,dependsOn:["suspended","_controller.leafsReached"]})],e.prototype,"maximumNumberOfFeaturesExceeded",null);a.__decorate([c.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.point.lodFactor"})],e.prototype,"lodFactor",void 0);a.__decorate([c.property({readOnly:!0})],e.prototype,"hasM",null);a.__decorate([c.property({readOnly:!0})],e.prototype,"hasZ",null);return e=a.__decorate([c.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],
e)}(F.DefinitionExpressionSceneLayerView(G.PopupSceneLayerView(y.LayerView3D(N))));var P={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},ba=k.vec3f64.create(),V={graphic:null,property:null,oldValue:null,newValue:null},T=p.create();return b})},"*noref":1}});
define("require exports tslib ../Camera ../geometry ../Graphic ../Ground ../Viewpoint ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/has ../core/Logger ../core/maybe ../core/promiseUtils ../core/scheduling ../core/watchUtils ../core/workers ./../core/screenUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/libs/gl-matrix-2/vec3f64 ../geometry/HeightModelInfo ../geometry/support/aaBoundingRect ../geometry/support/scaleUtils ../geometry/support/webMercatorUtils ../layers/support/layerUtils ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./3d/layerViewModuleImportUtils ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/GraphicsDeconflictor ./3d/layers/graphics/Labeler ./3d/layers/graphics/ObjectResourceCache ./3d/layers/support/FeatureTileTree3D ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/ElevationProvider ./3d/support/geometryUtils ./3d/support/HighlightOptions ./3d/support/index ./3d/support/MapCoordsHelper ./3d/support/projectionUtils ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/SceneViewPerformanceInfo ./3d/support/SharedSymbolResources ./3d/support/geometryUtils/boundedPlane ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/intersectorUtils ./support/layerViewUtils ./support/screenshotUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment @dojo/framework/shim/Promise".split(" "),function(n,
b,a,m,h,e,f,g,l,d,c,k,p,r,t,u,v,z,w,q,y,A,B,C,F,H,I,G,J,E,L,M,N,Q,R,W,O,U,P,ba,V,T,X,Y,da,fa,ga,ka,la,ia,Z,oa,aa,na,ja,ta,ra,xa,ua,va,ma,sa,qa,Ca,ha,Sa,nb,gb,x,hb,Va,tb,Ia){function Wa(a,b){a.layerUids||(a.layerUids=new Set);a.layerUids.add(b)}function ub(a,b){a.graphicUids||(a.graphicUids=new Set);a.graphicUids.add(b)}var Ka=r.getLogger("esri.views.SceneView");b=function(b){function r(c){var d=b.call(this,c)||this;d._clippingArea=null;d._userClippingArea=null;d._initialDefaultSpatialReference=null;
d._defaults={};d._externallySet={environment:!1};d._createGraphicsViewController=null;d._resolveWhenReady=[];d.propertiesPool=new ta.default({slicePlane:ma.BoundedPlaneClass},d);d._resourceController=aa.newResourceController(d);d._defaultToMapOptions={include:new Set};d._defaultHitTestOptions={exclude:new Set};d.deconflictor=new ba.GraphicsDeconflictor({view:d});d.labeler=new V.Labeler({view:d,deconflictor:d.deconflictor.labels});d.sharedSymbolResources=null;d.basemapTerrain=null;d.elevationProvider=
null;d.camera=null;d.canvas=null;d.center=null;d.constraints=new W.default;d.environmentManager=new U.default;d.extent=null;d.windowDevicePixelRatio=1;d.fullOpacity=1;d.graphicsView=null;d.groundView=null;d.navigating=!1;d.map=null;d.screenSizePerspectiveEnabled=!0;d.state=null;d.scale=null;d.spatialReference=null;d.isHeightModelInfoRequired=!0;d.alphaCompositingEnabled=!1;d.supersampleScreenhotsEnabled=!0;d.type="3d";d.ui=new tb;d._numUpdating=0;d._lastUpdateTime=0;d.updatingProgress=.5;d.viewpoint=
null;d.zoom=null;d.highlightOptions=new oa;w.initialize();c&&c.environment||(d._defaults.environment=new O,d.environment=d._defaults.environment);c=function(){d.notifyChange("dataExtent");d.updatingChanged();d.map&&d.map.allLayers.forEach(function(b){return a.__awaiter(d,void 0,void 0,function(){return a.__generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,b.when()];case 1:return a.sent(),[3,3];case 2:return a.sent(),[3,3];case 3:return this.updatingChanged(),[2]}})})})};
d.handles.add([z.on(d,"map.allLayers","after-changes",c,c,c,!0),d.allLayerViews.on("after-changes",function(){return d._updateUpdatingMonitors()}),d.watch("map",function(a){a&&a.load&&a.load().catch(function(){})})]);d.inputManager=new P({view:d});d.stateManager=new da.ViewStateManager({view:d,updateDevicePixelRatio:function(){var a=window.devicePixelRatio;a!==d.windowDevicePixelRatio&&(d.windowDevicePixelRatio=a,d.notifyChange("pixelRatio"))}});return d}a.__extends(r,b);r.prototype.initialize=function(){var a=
this;this.groundView=new L({view:this});this._updateUpdatingMonitors();var b=function(){return a._updateDefaultToMapOptions()};this.handles.add(z.on(this,"map.allLayers","after-changes",b,b,b));this.updatingHandles.add(this.qualitySettings,"memoryLimit",function(b){a.resourceController&&(a.resourceController.memoryController.maxMemory=b)},2);this.updatingHandles.add(this.qualitySettings,"additionalCacheMemory",function(b){a.resourceController&&(a.resourceController.memoryController.additionalCacheMemory=
b)},2);this.updatingHandles.add(this.qualitySettings,"frameRate",function(a){return v.setFrameDuration(0<a?1E3/Math.ceil(a):0)},2);this.updatingHandles.add(ka,"SCENEVIEW_LOCKING_LOG",function(b){return a.defaultsFromMap.logDebugInformation=b},2);this.updatingHandles.add(this,"map.ground",b,3);this.updatingHandles.add(this,"map.ground.opacity",function(){return a._updateDefaultHitTestOptions()},3);this.handles.add(this.watch("spatialReference",function(){return a.notifyChange("clippingArea")},!0))};
r.prototype.destroy=function(){this.invalidate();this.activeTool=null;this.layerViewManager.clear();this._exitSurface();this._disposeGraphicsView();this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null);this.labeler.destroy();this._set("labeler",null);this.deconflictor.destroy();this._set("deconflictor",null);this._resourceController.destroy();this._resourceController=null;this.stateManager.destroy();this._set("stateManager",null);this.inputManager.destroy();
this._set("inputManager",null);this.propertiesPool.destroy();this.handles.remove("updatingMonitors");this.environmentManager.destroy();this._set("environmentManager",null);this.groundView.destroy();this.groundView=null};Object.defineProperty(r.prototype,"renderSpatialReference",{get:function(){return this.renderCoordsHelper?this.renderCoordsHelper.spatialReference:null},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"clippingArea",{get:function(){if("global"===this.viewingMode)return null;
var a=this._userClippingArea||this.get("map.clippingArea");if(!this._userClippingArea&&!this.get("map.clippingEnabled")||!a)return this._clippingArea=null;if(!(a instanceof h.Extent))return Ka.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference){if(!I.canProject(a.spatialReference,this.spatialReference))return Ka.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;a=I.project(a,
this.spatialReference)}return this._clippingArea&&a&&this._clippingArea.equals(a)?this._clippingArea:this._clippingArea=a},set:function(a){this.ready&&"global"===this.viewingMode&&a?Ka.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):(this._userClippingArea=a,this.notifyChange("clippingArea"))},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"dataExtent",{get:function(){var a=[],b=this.spatialReference||h.SpatialReference.WGS84,c=this.clippingArea;
c&&(c=I.project(c,b));var d=function(d){if(d&&(d=I.project(d,b))){if(c&&(d=d.intersection(c),!d))return;a.push(d)}},e=this.basemapTerrain;e&&e.spatialReference&&d(new h.Extent({xmin:e.extent[0],ymin:e.extent[1],zmin:0,xmax:e.extent[2],ymax:e.extent[3],zmax:0,spatialReference:e.spatialReference}));this.map&&this.map.allLayers.forEach(function(a){return d(a.fullExtent)});if(0===a.length)return new h.Extent({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:b});e=a.reduce(function(a,b){return a.union(b)});
e.hasZ?(e.zmin=Math.min(0,e.zmin),e.zmax=Math.max(0,e.zmax)):(e.zmin=0,e.zmax=0);return e},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"environment",{set:function(a){a!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",a)},enumerable:!0,configurable:!0});r.prototype.castEnvironment=function(a){return a?a instanceof O?a:a instanceof Ia?O.fromWebsceneEnvironment(a):A.ensureType(O,a):new O};Object.defineProperty(r.prototype,"pixelRatio",{get:function(){return Math.min(this.windowDevicePixelRatio,
this.maximumPixelRatio)},set:function(a){t.isSome(a)?this._override("pixelRatio",a):this._clearOverride("pixelRatio")},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"maximumPixelRatio",{get:function(){var a=Infinity,b=this.qualitySettings,c=b.maximumPixelRatio,b=b.maximumRenderResolution;null!=c&&(a=Math.min(a,c));null!=b&&(a=Math.min(a,b/Math.max(this.width,this.height)));return a},set:function(a){t.isSome(a)?this._override("maximumPixelRatio",a):this._clearOverride("maximumPixelRatio")},
enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"groundExtent",{get:function(){var a=this._get("basemapTerrain");if(a&&a.spatialReference){var b=a.extent;return new h.Extent({xmin:b[0],ymin:b[1],xmax:b[2],ymax:b[3],spatialReference:a.spatialReference})}return new h.Extent({spatialReference:this.spatialReference||h.SpatialReference.WGS84})},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"initialExtentRequired",{get:function(){return this.stateManager&&!this.stateManager.hasInitialView},
enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"interacting",{get:function(){return this.navigating||t.isSome(this.activeTool)},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"stationary",{get:function(){return!this.animation&&!this.resizing&&(t.isNone(this.state)||this.state.stationary)},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"qualityProfile",{get:function(){return this._get("qualityProfile")||la.getDefaultProfile()},set:function(a){la.isValidProfile(a)&&
(la.apply(a,this.qualitySettings),this._set("qualityProfile",a))},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"slicePlane",{set:function(a){this._stage.renderView.setRenderParameters({slicePlane:a});if(t.isNone(a))this._set("slicePlane",null);else{var b=this.propertiesPool.get("slicePlane");Z.boundedPlane.copy(a,b);this._set("slicePlane",b)}},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"resolution",{get:function(){return null!=this.spatialReference?H.getResolutionForScale(this.scale,
this.spatialReference):0},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"heightModelInfo",{get:function(){var a=this.getDefaultHeightModelInfo();return null!=a?C.deriveUnitFromSR(a,this.spatialReference):null},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"updating",{get:function(){var a=0,b=0,c=!1;this.allLayerViews.forEach(function(d){d.isFulfilled()?d.updating&&(c=!0,d.suspended||(++b,a="updatingProgress"in d?a+d.updatingProgress:a+.5)):++b});for(var d=0,
e=[this.graphicsView,this.basemapView,this.basemapTerrain,this.layerViewManager,this._resourceController,this._stage&&this._stage.renderView,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.updatingHandles,this.featureTreeDebugger];d<e.length;d++){var f=e[d];t.isSome(f)&&f.updating&&(b+=.1,a+=.05)}d=0;for(e=[this.deconflictor,this.labeler];d<e.length;d++)f=e[d],t.isSome(f)&&f.updating&&(++b,a+=f.updatingProgress);(c=!!(c||0<b||!this.ready||!this.stationary||this._createGraphicsViewController||
this.inputManager&&this.inputManager.hasPendingInputs||this.map&&this.map.allLayers&&this.map.allLayers.some(function(a){return!a.isFulfilled()})))?(this._numUpdating=Math.max(b,this._numUpdating),a+=this._numUpdating-b):this._numUpdating=0;a=0<this._numUpdating?a/this._numUpdating:c?.5:1;this._get("updatingProgress")!==a&&(f=this._resourceController.scheduler.now,1>a&&(d=Math.min((f-this._lastUpdateTime)/2E3,1),a=this.updatingProgress*(1-d)+a*d),this._set("updatingProgress",a),this._lastUpdateTime=
c&&1>a?f:0);return c},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"viewingMode",{get:function(){var a=this.get("map.initialViewProperties.viewingMode"),b=this.spatialReference;a||(a=!b||hb.isSpatialReferenceSupported(b,"global")?"global":"local");return a},set:function(a){this.ready?Ka.error("#viewingMode","viewingMode cannot be set once view is ready"):0<=["local","global"].indexOf(a)?this._override("viewingMode",a):void 0===a&&this._clearOverride("viewingMode")},enumerable:!0,
configurable:!0});Object.defineProperty(r.prototype,"resourceController",{get:function(){return this._resourceController},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"performanceInfo",{get:function(){return new ua(this)},enumerable:!0,configurable:!0});r.prototype.on=function(a,c,d,e){return(d=this.viewEvents.on(a,c,d,e))?d:b.prototype.on.call(this,a,c)};r.prototype.hasEventListener=function(a){return b.prototype.hasEventListener.call(this,a)||this.viewEvents.hasHandler(a)};
r.prototype.toMap=function(a,b){if(!this.ready)return Ka.error("#toMap()","Scene view cannot be used before it is ready"),null;b=b?this._externalToInternalIntersectOptions(b):this._defaultToMapOptions;var c=t.isSome(b.graphics)&&(t.isSome(b.graphics.include)||t.isSome(b.graphics.exclude));a=q.isSupportedScreenPointEvent(a)?q.createScreenPointFromSupportedEvent(this,a):a;var d=q.screenPointObjectToArray(a);b.enableDraped=b.include&&!b.include.has(nb.TERRAIN_ID)||b.exclude&&b.exclude.has(nb.TERRAIN_ID);
var e=this.sceneIntersectionHelper;a=new Sa.Intersector(this.viewingMode);a.options.selectionMode=!0;a.options.store=c?2:0;e.intersectIntersectorScreen(d,a,b);if(c){c=0;for(a=a.results.all;c<a.length;c++)if(d=a[c],e=d.toGraphic(this),t.isNone(e)||this._testGraphicUidFilter(b.graphics,e))return this._intersectResultToMapPoint(d);return null}return this._intersectResultToMapPoint(a.results.min)};r.prototype.toScreen=function(a){if(!this.ready)return Ka.error("#toScreen()","Scene view cannot be used before it is ready"),
null;var b=null==a.z&&ia.getElevationAtPoint(this.elevationProvider,a)||0;ja.pointToVector(a,eb,this.renderSpatialReference,b);return this.engineToScreen(eb)};r.prototype.pixelSizeAt=function(a){if(!this.ready)return Ka.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!a)return 0;ja.pointToVector(a,eb,this.renderSpatialReference);return this.state.camera.computeScreenPixelSizeAt(eb)};r.prototype.hitTest=function(a,b){if(!this.ready)return Ka.error("#hitTest()","Scene view cannot be used before it is ready"),
null;a=q.isSupportedScreenPointEvent(a)?q.createScreenPointFromSupportedEvent(this,a):a;var c=q.createScreenPointArray(a.x,a.y),d=b?this._externalToInternalIntersectOptions(b):this._defaultHitTestOptions;d.terrainLocationFeedbackEnabled=!0;d.enableDraped=!0;b=new Sa.Intersector(this.viewingMode);b.options.selectionMode=!0;b.options.store=2;this.sceneIntersectionHelper.intersectIntersectorScreen(c,b,d);var c=this._intersectResultsToHits(b.results.all,d.graphics),d=b.results.ground,e=d.toOwner(this),
e=t.isSome(e)&&"type"in e&&"integrated-mesh"===e.type?e:null;a={screenPoint:a,results:c,ground:{mapPoint:this._intersectResultToMapPoint(d),distance:d.hasIntersectionPoint?d.distanceInRenderSpace:0,layer:e}};ka.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(a.intersector=b);return u.resolve(a)};r.prototype.popupHitTest=function(a){return this.hitTest(a).then(function(b){for(var c=[],d=b.results.length?b.results[0].distance:0,e=0,f=b.results;e<f.length;e++){var g=f[e];if(g.distance!==d)break;c.push(g)}e=null;
!(0===c.length||1E-5>Math.abs(d-b.ground.distance))||b.ground.layer&&"integrated-mesh"===b.ground.layer.type||(e=b.ground.mapPoint);return{results:c,screenPoint:a,mapPoint:e}})};r.prototype.goTo=function(a,b){return this.stateManager.goTo(a,b)};r.prototype.whenLayerView=function(a){return b.prototype.whenLayerView.call(this,a)};r.prototype.takeScreenshot=function(a){var b=this;return this.whenReady().then(function(){var c=x.toRenderSettings(a,b);c.pixelRatio/=b.pixelRatio;return b._stage.renderView.takeScreenshot(x.screenshotSuperSampleSettings(c,
b.supersampleScreenhotsEnabled,b.padding))})};r.prototype.importLayerView=function(a){return R.layerView3DImporter.importLayerView(a)};r.prototype.hasLayerViewModule=function(a){return R.layerView3DImporter.hasLayerViewModule(a)};r.prototype.forceDOMReadyCycle=function(){this.forceReadyCycle()};r.prototype.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||this.get("defaultsFromMap.isSpatialReferenceDone")&&
this._initialDefaultSpatialReference||null};r.prototype.validate=function(){return a.__awaiter(this,void 0,void 0,function(){var b;return a.__generator(this,function(a){b=Va.check();p("safari")&&9>p("safari")&&(b=new c("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:p("safari")}));if(t.isSome(b))throw Ka.warn("#validate()",b.message),b;return[2]})})};r.prototype.isSpatialReferenceSupported=function(a,b,
c){var d=a.isGeographic,e=a.isWebMercator,f=hb.isSpatialReferenceSupported(a,"global"),g="local"===this.viewingMode,h=!(!this._isOverridden("viewingMode")&&!this.get("map.initialViewProperties.viewingMode"));if(h){if(g&&d)return c&&c("Layer "+b.id+" is ignored because it is GCS and viewing mode is local"),!1;if(!g&&!f)return c&&c("Layer "+b.id+" is ignored because its spatial reference is not supported in global viewing mode"),!1}else if(d&&!f)return c&&c("Layer "+b.id+" is ignored because its spatial reference is geographic but unsupported"),
!1;if(b)if(G.isTiledLayer(b)){if(d=void 0,h?h=Ca.getTiledLayerInfo(b,a,this.viewingMode):(h=Ca.getTiledLayerInfo(b,a,"global"),null==h.tileInfo&&(h=Ca.getTiledLayerInfo(b,a,"local"),null!=h.tileInfo&&e&&!this.ready&&(this.viewingMode="local"))),d=null!=h.tileInfo,!d)return c&&c("Layer "+b.id+" is ignored because it is tiled but\n            its tiling scheme is not supported or compatible with the viewing mode"),!1}else if((a.isWGS84||e)&&!g)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=
a),h||this.ready||(this.viewingMode="global",c&&c("Viewing mode locked to global due to reprojectable layer "+b.id)),c&&c("Layer "+b.id+" is ignored because it supports server-side reprojection"),!1;return!0};r.prototype.whenReady=function(){var a=this;return u.create(function(b){a.ready?b(a):a._resolveWhenReady.push(b)})};r.prototype.computeMapPointFromVec3d=function(a,b){var c=this.spatialReference||h.SpatialReference.WGS84;ja.vectorToVector(a,this.renderSpatialReference,a,c)||(c=h.SpatialReference.WGS84,
ja.vectorToVector(a,this.renderSpatialReference,a,c));b?(b.x=a[0],b.y=a[1],b.z=a[2],b.spatialReference=c):b=new h.Point(a,c);return b};r.prototype.engineToScreen=function(a,b){var c=q.createRenderScreenPointArray3();this.state.camera.projectPoint(a,c);a=q.screenPointArrayToObject(c);return q.renderToScreen(this,a,b)};r.prototype.flushDisplayModifications=function(){this._stage.processDirty()};r.prototype.trackGraphicState=function(a){if(!a.graphic)return Ka.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),
null;var b=this.getViewForGraphic(a.graphic),c=null,d=!1,e=function(b){!d&&t.isSome(b)&&"graphics3d"in b&&b.graphics3d&&b.graphics3d.graphicsCore&&(c=b.graphics3d.graphicsCore.trackGraphicState(a))};t.isSome(b)?e(b):this.whenViewForGraphic(a.graphic,{waitForLayer:!0}).then(function(a){return e(a)},function(){}).catch(function(){});return{remove:function(){d=!0;t.isSome(c)&&(c.remove(),c=null)}}};r.prototype.maskOccludee=function(a){if(!a)return Ka.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),
null;var b=this.getViewForGraphic(a),c=null,d=!1,e=function(b){!d&&t.isSome(b)&&"graphics3d"in b&&gb.occludeesSupported(b)&&(c=b.occlude(a))};t.isSome(b)?e(b):this.whenViewForGraphic(a,{waitForLayer:!0}).then(function(a){return e(a)},function(){}).catch(function(){});return{remove:function(){d=!0;t.isSome(c)&&(c.remove(),c=null)}}};r.prototype.getViewForGraphic=function(a){return a.layer===this.graphics?this.graphicsView:a.layer?this.allLayerViews.find(function(b){return b.layer===a.layer}):null};
r.prototype.graphicChanged=function(a){t.isSome(this.graphicsView)&&this.graphicsView.graphicChanged(a)};r.prototype.whenViewForGraphic=function(b,d){return a.__awaiter(this,void 0,void 0,function(){var e=this;return a.__generator(this,function(a){switch(a.label){case 0:return b.layer!==this?[3,2]:[4,z.whenOnce(this,"graphicsView")];case 1:return a.sent(),[2,this.graphicsView];case 2:if(!b.layer||!this.map)throw new c("no-view-for-graphic");return d&&d.waitForLayer&&!this.map.allLayers.includes(b.layer)?
[2,u.create(function(a,c){var d=e.map.allLayers.on("change",function(f){-1!==f.added.indexOf(b.layer)&&(d.remove(),e.whenLayerView(b.layer).then(a,c))})})]:[2,this.whenLayerView(b.layer)]}})})};r.prototype._intersectResultToMapPoint=function(a,b){if(a.getIntersectionPoint(eb)){b=this.computeMapPointFromVec3d(eb,b);var c=this.basemapTerrain;"TerrainRenderer"===a.intersector&&c&&(b.z=ia.getElevationAtPoint(c,b)||0);return b}return null};r.prototype._intersectResultsToHits=function(a,b){for(var c=[],
d=null,e=0;e<a.length;e++){var f=a[e],g=f.toOwner(this);if(t.isSome(g)&&(g===this.map.ground||"type"in g&&"integrated-mesh"===g.type))break;g=f.toGraphic(this);if(t.isSome(g)){t.isNone(d)&&e!==a.length-1&&(d=new Set);if(t.isSome(d)){var h=this._getGraphicFilterUid(g);if(d.has(h))continue;d.add(h)}this._testGraphicUidFilter(b,g)&&(h=this._intersectResultToMapPoint(f),c.push({graphic:g,mapPoint:h,distance:f.distanceInRenderSpace}))}}return c};r.prototype._getGraphicFilterUid=function(a){if(a.layer&&
"objectIdField"in a.layer){var b=a.attributes[a.layer.objectIdField];if(b)return"o-"+a.layer.id+"-"+b}return"u-"+a.uid};r.prototype._testGraphicUidFilter=function(a,b){b=this._getGraphicFilterUid(b);return t.isNone(a)||(t.isNone(a.include)||a.include.has(b))&&(t.isNone(a.exclude)||!a.exclude.has(b))};r.prototype._externalToInternalRenderItems=function(a,b,c){var d=this;void 0===c&&(c={layerUids:null,graphicUids:null});if(!a)return c;a instanceof e?(ub(c,this._getGraphicFilterUid(a)),0===b&&(t.isSome(this.graphicsView)&&
a.layer===this?Wa(c,this.graphicsView.mockLayerId):a.layer&&Wa(c,a.layer.uid))):"forEach"in a?a.forEach(function(a){Array.isArray(a)?d._externalToInternalRenderItems(a,b,c):l.isCollection(a)?a===d.graphics&&t.isSome(d.graphicsView)?Wa(c,d.graphicsView.mockLayerId):d._externalToInternalRenderItems(a,b,c):a instanceof f?a===d.map.ground&&Wa(c,nb.TERRAIN_ID):d._externalToInternalRenderItems(a,b,c)}):Wa(c,a.uid);return c};r.prototype._externalToInternalIntersectOptions=function(a){var b=this._externalToInternalRenderItems(a.include,
0);a=this._externalToInternalRenderItems(a.exclude,1);return{include:b.layerUids,exclude:a.layerUids,graphics:{include:b.graphicUids,exclude:a.graphicUids}}};r.prototype._viewingModeToManifold=function(a){switch(a){case "global":return"spherical";case "local":return"planar"}};r.prototype._initBasemapTerrain=function(a){this._set("basemapTerrain",new qa({view:this,manifold:this._viewingModeToManifold(a)}));this._set("elevationProvider",new ga.CombinedElevationProvider({view:this}));this.elevationProvider.register("ground",
this.basemapTerrain)};r.prototype._exitBasemapTerrain=function(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))};r.prototype._initGlobe=function(a){var b=this;this._initCoordinateSystem();this._set("state",new Y.default({viewingMode:this.viewingMode,spatialReference:this.spatialReference}));this._initBasemapTerrain(a);this._set("pointsOfInterest",
new sa.default({view:this}));this._set("featureTiles",new X.default({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler}));a=function(){var a=b.basemapTerrain&&b.basemapTerrain.extent;b.clippingArea||a?a&&b.basemapTerrain.spatialReference?(a=F.toExtent(b.basemapTerrain.extent,b.basemapTerrain.spatialReference),b.featureTiles.filterExtent=
b.clippingArea?a.intersection(b.clippingArea):a):b.featureTiles.filterExtent=b.clippingArea:b.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(ka,"FEATURE_TILE_TREE_SHOW_TILES",function(a){a&&b.featureTiles&&!b.featureTreeDebugger?b.updatingHandles.addPromise(new Promise(function(a,b){n(["./3d/layers/support/FeatureTileTree3DDebugger"],a,b)})).then(function(a){a=a.FeatureTileTree3DDebugger;!b.featureTreeDebugger&&ka.FEATURE_TILE_TREE_SHOW_TILES&&(b.featureTreeDebugger=new a({view:b}))}):
a||!b.featureTreeDebugger||ka.FEATURE_TILE_TREE_SHOW_TILES||(b.featureTreeDebugger.destroy(),b.featureTreeDebugger=null)},3),this.updatingHandles.add(this,"clippingArea",a,3),this.updatingHandles.add(this,"basemapTerrain.extent",a,3)],"feature-tiles");this.stateManager.init()};r.prototype._exitGlobe=function(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),
this._set("pointsOfInterest",null),this._exitBasemapTerrain(),t.isSome(this.state)&&(this.state.destroy(),this._set("state",null)),this._exitCoordinateSystem())};r.prototype._initCoordinateSystem=function(){var a=this;if(this.spatialReference){var b=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(b)||this._set("mapCoordsHelper",new na.default(this.map,b));var c="global"===this.viewingMode,b=c?ja.SphericalECEFSpatialReference:b;b!==this.renderSpatialReference&&
(this._set("renderCoordsHelper",xa.RenderCoordsHelper.createMode(this.viewingMode,b)),c||this.handles.add(this.watch("basemapTerrain.extent",function(b){if(0!==b[0]||0!==b[1]||0!==b[2]||0!==b[3])a.renderCoordsHelper.extent=b},!0),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Sa.Intersector.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)};r.prototype._exitCoordinateSystem=
function(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))};r.prototype.updatingChanged=function(){this.notifyChange("updating")};r.prototype._updateUpdatingMonitors=function(){var a=this;this.handles.remove("updatingMonitors");this.allLayerViews.forEach(function(b){b.destroyed||(a.handles.add([b.watch(["updating","updatingProgress"],function(){return a.updatingChanged()},!0)],"updatingMonitors"),b.when(function(){return a.updatingChanged()},
function(){return a.updatingChanged()}))});this.updatingChanged()};r.prototype._renderScreenshotOverlay=function(a,b){if(this.overlay&&this.overlay.hasVisibleItems){var c=a.getContext("2d");c.putImageData(b,0,0);this.overlay.renderCanvas(a);a=c.getImageData(0,0,b.width,b.height);for(c=0;c<a.data.length;c++)b.data[c]=a.data[c]}};r.prototype._initStage=function(){var a=this,b={renderContext:this.renderContext,deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,
viewingMode:this.viewingMode,alpha:this.alphaCompositingEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:function(b,c){return a._renderScreenshotOverlay(b,c)}}},e=new fa.SceneIntersectionHelper(this.viewingMode,{forEachLayer:function(b){a._stage.getLayers().forEach(b)}},this);this._set("sceneIntersectionHelper",e);var f=d.byId(this.surface);this._stage=new ha.Stage({viewingMode:this.viewingMode,container:f,options:b,sceneIntersectionHelper:e});this._lostWebGLContextHandle=k.on(this._stage.renderView.getCanvas(),
"webglcontextlost",function(){return a.fatalError=new c("webgl-context-lost")});this.handles.add(this.updatingHandles.add(this.qualitySettings,"antialiasingEnabled",function(){a._stage.renderView.setRenderParameters({antialiasingEnabled:a.qualitySettings.antialiasingEnabled})},2),"stage");b=function(){a._stage.renderView.setRenderParameters({defaultHighlightOptions:oa.toEngineOptions(a.highlightOptions)})};e=0;for(f=["highlightOptions","highlightOptions.color","highlightOptions.haloColor","highlightOptions.haloOpacity",
"highlightOptions.fillOpacity"];e<f.length;e++)this.handles.add(this.updatingHandles.add(this,f[e],b),"stage");b();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Sa.Intersector.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.getCanvas())};r.prototype._exitStage=function(){this._set("sceneIntersectionHelper",null);this._stage.destroy();this._stage=null;this._lostWebGLContextHandle.remove();this._lostWebGLContextHandle=null;this.handles.remove("stage");
this._set("canvas",null)};r.prototype._initSurface=function(){this._exitSurface();this._initStage();this._initGlobe(this.viewingMode);this.sharedSymbolResources=new va.default({stage:this._stage,viewingMode:this.viewingMode,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new T.ObjectResourceCache})};r.prototype._exitSurface=function(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),
this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())};r.prototype._createGraphicsViewIfNeeded=function(){var a=this;if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.handles.remove("graphics-view");this._createGraphicsViewController=u.createAbortController();var b=function(){a._createGraphicsViewController=null;a.updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(b,b);this.updatingChanged()}};r.prototype._createGraphicsViewAsync=
function(b){return a.__awaiter(this,void 0,void 0,function(){var c;return a.__generator(this,function(a){switch(a.label){case 0:return[4,new Promise(function(a,b){n(["./3d/layers/GraphicsView3D"],a,b)})];case 1:return c=a.sent(),u.throwIfAborted(b),[4,z.whenTrueOnce(this.basemapTerrain,"ready",b)];case 2:return a.sent(),this._set("graphicsView",new c({view:this})),[2]}})})};r.prototype._disposeGraphicsView=function(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),
this._createGraphicsViewController=null);this.handles.remove("graphics-view");t.isSome(this.graphicsView)&&(this.handles.remove(this.graphicsView.mockLayerId),this.graphicsView.destroy(),this._set("graphicsView",null))};r.prototype._startup=function(){var a=this;"global"===this.viewingMode&&(this._clippingArea=null);this._set("ready",!0);this._initSurface();this.handles.add(z.on(this,"graphics","after-changes",function(){return a._createGraphicsViewIfNeeded()}),"graphics-view");this._createGraphicsViewIfNeeded();
if(!this._externallySet.environment){var b=this.get("map.initialViewProperties.environment");b&&(this.environment=b)}this.labeler.setup();this.environmentManager.connectView(this);this.inputManager.connect();b=this._resolveWhenReady;this._resolveWhenReady=[];b.forEach(function(b){return b(a)})};r.prototype._teardown=function(){this._initialDefaultSpatialReference=null;this.inputManager.disconnect();this.environmentManager.disconnectView();this.labeler.dispose();this._disposeGraphicsView();this.handles.remove("graphics-view");
this._exitSurface();this._set("ready",!1)};r.prototype._updateDefaultToMapOptions=function(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(nb.TERRAIN_ID);for(var a=0,b=this.map.allLayers.items;a<b.length;a++){var c=b[a];"integrated-mesh"===c.type&&this._defaultToMapOptions.include.add(c.uid)}}};r.prototype._updateDefaultHitTestOptions=function(){this._defaultHitTestOptions.exclude.clear();if(this.map){this.map.ground&&1>this.map.ground.opacity&&
this._defaultHitTestOptions.exclude.add(nb.TERRAIN_ID);for(var a=0,b=this.map.allLayers.items;a<b.length;a++){var c=b[a];"integrated-mesh"===c.type&&1>c.opacity&&this._defaultToMapOptions.exclude.add(c.uid)}}};a.__decorate([y.property()],r.prototype,"_resourceController",void 0);a.__decorate([y.property()],r.prototype,"_stage",void 0);a.__decorate([y.property({readOnly:!0})],r.prototype,"deconflictor",void 0);a.__decorate([y.property({readOnly:!0})],r.prototype,"labeler",void 0);a.__decorate([y.property({type:Q,
readOnly:!0,aliasOf:"state.animation"})],r.prototype,"animation",void 0);a.__decorate([y.property({readOnly:!0})],r.prototype,"basemapTerrain",void 0);a.__decorate([y.property({readOnly:!0})],r.prototype,"elevationProvider",void 0);a.__decorate([y.property({type:m,aliasOf:"stateManager.camera"})],r.prototype,"camera",void 0);a.__decorate([y.property({readOnly:!0})],r.prototype,"canvas",void 0);a.__decorate([y.property({type:h.Point,aliasOf:"stateManager.center"})],r.prototype,"center",void 0);a.__decorate([y.property({type:h.Extent,
dependsOn:["map.clippingArea?","map.clippingEnabled?","viewingMode"]})],r.prototype,"clippingArea",null);a.__decorate([y.property({type:W.default})],r.prototype,"constraints",void 0);a.__decorate([y.property({type:h.Extent,dependsOn:["basemapTerrain.extent","clippingArea","map"],readOnly:!0})],r.prototype,"dataExtent",null);a.__decorate([y.property({value:null,type:O})],r.prototype,"environment",null);a.__decorate([y.cast("environment")],r.prototype,"castEnvironment",null);a.__decorate([y.property({readOnly:!0})],
r.prototype,"environmentManager",void 0);a.__decorate([y.property({type:h.Extent,aliasOf:"stateManager.extent"})],r.prototype,"extent",void 0);a.__decorate([y.property({readOnly:!0,aliasOf:"stateManager.screenCenter"})],r.prototype,"screenCenter",void 0);a.__decorate([y.property({type:Number,dependsOn:["maximumPixelRatio"]})],r.prototype,"pixelRatio",null);a.__decorate([y.property({type:Number,dependsOn:["qualitySettings.maximumPixelRatio","qualitySettings.maximumRenderResolution","size"]})],r.prototype,
"maximumPixelRatio",null);a.__decorate([y.property({aliasOf:"stateManager.frustum"})],r.prototype,"frustum",void 0);a.__decorate([y.property({type:Number,readOnly:!0})],r.prototype,"fullOpacity",void 0);a.__decorate([y.property({readOnly:!0})],r.prototype,"graphicsView",void 0);a.__decorate([y.property({type:h.Extent,dependsOn:["basemapTerrain.extent"],readOnly:!0})],r.prototype,"groundExtent",null);a.__decorate([y.property()],r.prototype,"groundView",void 0);a.__decorate([y.property({type:Boolean,
dependsOn:["stateManager.hasInitialView"]})],r.prototype,"initialExtentRequired",null);a.__decorate([y.property({type:Boolean,dependsOn:["navigating","activeTool"],readOnly:!0})],r.prototype,"interacting",null);a.__decorate([y.property({dependsOn:["animation","resizing","state.stationary"]})],r.prototype,"stationary",null);a.__decorate([y.property({aliasOf:"state.navigating"})],r.prototype,"navigating",void 0);a.__decorate([y.property()],r.prototype,"map",void 0);a.__decorate([y.property({readOnly:!0})],
r.prototype,"mapCoordsHelper",void 0);a.__decorate([y.property({aliasOf:"stateManager.padding"})],r.prototype,"padding",void 0);a.__decorate([y.property({type:sa.default,readOnly:!0})],r.prototype,"pointsOfInterest",void 0);a.__decorate([y.property({type:X.default,readOnly:!0})],r.prototype,"featureTiles",void 0);a.__decorate([y.property()],r.prototype,"featureTreeDebugger",void 0);a.__decorate([y.property({type:Boolean})],r.prototype,"screenSizePerspectiveEnabled",void 0);a.__decorate([y.property({constructOnly:!0})],
r.prototype,"deactivatedWebGLExtensions",void 0);a.__decorate([y.property({constructOnly:!0})],r.prototype,"debugWebGLExtensions",void 0);a.__decorate([y.property({constructOnly:!0})],r.prototype,"renderCanvas",void 0);a.__decorate([y.property({readOnly:!0})],r.prototype,"state",void 0);a.__decorate([y.property({readOnly:!0})],r.prototype,"inputManager",void 0);a.__decorate([y.property({readOnly:!0})],r.prototype,"stateManager",void 0);a.__decorate([y.property({type:["low","medium","high"]})],r.prototype,
"qualityProfile",null);a.__decorate([y.property({type:ra,get:function(){var a=this._get("qualitySettings");a||(a=new ra,la.apply(this.qualityProfile,a));return a}})],r.prototype,"qualitySettings",void 0);a.__decorate([y.property()],r.prototype,"slicePlane",null);a.__decorate([y.property({dependsOn:["viewingMode"]})],r.prototype,"preconditionsReady",void 0);a.__decorate([y.property({readOnly:!0})],r.prototype,"renderCoordsHelper",void 0);a.__decorate([y.property({readOnly:!0})],r.prototype,"sceneIntersectionHelper",
void 0);a.__decorate([y.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],r.prototype,"resolution",null);a.__decorate([y.property({type:Number,aliasOf:"stateManager.scale"})],r.prototype,"scale",void 0);a.__decorate([y.property()],r.prototype,"heightModelInfo",null);a.__decorate([y.property({dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],r.prototype,"spatialReference",void 0);a.__decorate([y.property({type:Boolean,constructOnly:!0})],
r.prototype,"alphaCompositingEnabled",void 0);a.__decorate([y.property({type:Boolean})],r.prototype,"supersampleScreenhotsEnabled",void 0);a.__decorate([y.property({readOnly:!0})],r.prototype,"type",void 0);a.__decorate([y.property({type:tb})],r.prototype,"ui",void 0);a.__decorate([y.property({type:Boolean,readOnly:!0,dependsOn:"graphicsView.updating basemapView.updating basemapTerrain.updating layerViewManager.updating _resourceController.updating _stage.renderView.updating featureTiles.updating pointsOfInterest.updating environmentManager.updating overlay.updating updatingHandles.updating featureTreeDebugger.updating labeler.updating deconflictor.updating ready stationary inputManager.hasPendingInputs".split(" ")})],
r.prototype,"updating",null);a.__decorate([y.property({type:Number,readOnly:!0,dependsOn:["updating"]})],r.prototype,"updatingProgress",void 0);a.__decorate([y.property({type:["global","local"],dependsOn:["map.initialViewProperties?.viewingMode","spatialReference"]})],r.prototype,"viewingMode",null);a.__decorate([y.property({type:g,aliasOf:"stateManager.viewpoint"})],r.prototype,"viewpoint",void 0);a.__decorate([y.property({type:Number,aliasOf:"stateManager.zoom"})],r.prototype,"zoom",void 0);a.__decorate([y.property({type:oa})],
r.prototype,"highlightOptions",void 0);return r=a.__decorate([y.subclass("esri.views.SceneView")],r)}(J.BreakpointsOwner(E.DOMContainer(M.PopupView(N))));var eb=B.vec3f64.create();return b});