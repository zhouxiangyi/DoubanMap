// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/accessorSupport/originUtils":function(){define(["require","exports","../multiOriginJSONSupportUtils"],function(n,d,c){Object.defineProperty(d,"__esModule",{value:!0});d.updateOrigins=function(d){d&&d.writtenProperties&&d.writtenProperties.forEach(function(d){var m=d.target;d.newOrigin&&d.oldOrigin!==d.newOrigin&&c.isMultiOriginJSONMixin(m)&&m.updateOrigin(d.propName,d.newOrigin)})}})},"esri/support/webSceneUtils":function(){define(["require","exports","../core/Error"],function(n,
d,c){Object.defineProperty(d,"__esModule",{value:!0});d.createCopyError=function(){return new c("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")};d.isCopyError=function(c){return c&&"webscene:failed-to-copy-embedded-resources"===c.name};d.createSchemaValidationError=function(d){return new c("webscene:schema-validation","Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:d})};d.isSchemaValidationError=
function(c){return c&&"webscene:schema-validation"===c.name}})},"esri/views/3d/support/projectionUtils":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ./earthUtils ../webgl-engine/lib/BufferVectorMath".split(" "),
function(n,d,c,m,k,h,g,l,r,a,b,e,f,u){function I(a,b,e,f){if(2>a.length)return!1;2===a.length&&(v[0]=a[0],v[1]=a[1],v[2]=0,a=v);return q(a,b,0,e,f,0,1)}function R(a,b,e,f,c,u,t){void 0===t&&(t=0);for(var N=[],ba=0;ba<a.length;ba++)for(var d=a[ba],ca=0,I=d;ca<I.length;ca++)d=I[ca],N.push(d[0],d[1],b?d[2]:t);if(!q(N,f,0,N,u,0,N.length/3))return!1;f=0;for(u=c.length=0;u<a.length;u++){d=a[u];t=[];ba=0;for(ca=d;ba<ca.length;ba++)d=ca[ba],b&&e?t.push([N[f++],N[f++],N[f++],d[3]]):b?t.push([N[f++],N[f++],
N[f++]]):(e?t.push([N[f++],N[f++],d[2]]):t.push([N[f++],N[f++]]),f++);c.push(t)}return!0}function q(a,b,e,f,c,u,t){void 0===t&&(t=1);b=S(b,c,ia);if(m.isNone(b))return!1;if(b===p){if(a===f&&e===u)return!0;for(b=e+3*t;e<b;e++,u++)f[u]=a[e];return!0}for(t=e+3*t;e<t;e+=3,u+=3)b(a,e,f,u);return!0}function x(a,b){if(b.spatialReference===a)return b.spatialReferenceId;b.spatialReference=a;"metersPerUnit"in b&&(b.metersPerUnit=k.getMetersPerUnitForSR(a,1));return a.wkt===d.SphericalECEFSpatialReference.wkt?
b.spatialReferenceId=1:a.isWGS84?b.spatialReferenceId=2:a.isWebMercator?b.spatialReferenceId=3:a.wkt===d.WGS84ECEFSpatialReference.wkt?b.spatialReferenceId=4:4490===a.wkid?b.spatialReferenceId=5:b.spatialReferenceId=0}function p(a,b,e,f){a!==e&&(e[f++]=a[b++],e[f++]=a[b++],e[f]=a[b])}function W(a,b,e,c){e[c++]=da*(a[b++]/f.earthRadius);e[c++]=da*(Math.PI/2-2*Math.atan(Math.exp(-1*a[b++]/f.earthRadius)));e[c]=a[b]}function G(a,b,e,f){W(a,b,e,f);w(e,f,e,f)}function K(a,b,e,f){W(a,b,e,f);y(e,f,e,f)}
function D(a,b,e,u){var t=.4999999*Math.PI,t=c.clamp(X*a[b+1],-t,t),t=Math.sin(t);e[u++]=X*a[b]*f.earthRadius;e[u++]=f.halfEarthRadius*Math.log((1+t)/(1-t));e[u]=a[b+2]}function F(a,b,e){b=x(b,ea);b=L[b][6];if(m.isNone(b))return!1;b(a,0,v,0);e!==v&&(e[0]=v[0],e[1]=v[1],2<e.length&&(e[2]=v[2]));return!0}function C(a,b){v[0]=a.x;v[1]=a.y;v[2]=a.hasZ?a.z:0;return F(v,a.spatialReference,b)}function w(a,b,e,c){var u=f.earthRadius+a[b+2],t=X*a[b+1];a=X*a[b];b=Math.cos(t);e[c++]=Math.cos(a)*b*u;e[c++]=Math.sin(a)*
b*u;e[c]=Math.sin(t)*u}function H(a,b,e,t){var N=u.Vec3Compact.length(a,b),d=c.asinClamped(a[b+2]/(0===N?1:N));a=Math.atan2(a[b+1],a[b]);e[t++]=da*a;e[t++]=da*d;e[t]=N-f.earthRadius}function A(a,b,e,f){H(a,b,e,f);D(e,f,e,f)}function B(a,b,e,f){H(a,b,e,f);y(e,f,e,f)}function y(a,b,e,f){var c=ka,u=X*a[b],t=X*a[b+1];a=a[b+2];b=Math.sin(t);var t=Math.cos(t),d=c.a/Math.sqrt(1-c.e2*b*b);e[f++]=(d+a)*t*Math.cos(u);e[f++]=(d+a)*t*Math.sin(u);e[f++]=(d*(1-c.e2)+a)*b}function z(a,b,e,f){var c=ka,u=a[b],t=a[b+
1];a=a[b+2];var d,N,I,q,L,p;b=Math.abs(a);d=u*u+t*t;N=Math.sqrt(d);I=d+a*a;q=Math.sqrt(I);u=Math.atan2(t,u);L=a*a/I;I=d/I;t=c.a2/q;d=c.a3-c.a4/q;.3<I?(L=b/q*(1+I*(c.a1+t+L*d)/q),q=Math.asin(L),t=L*L,I=Math.sqrt(1-t)):(I=N/q*(1-L*(c.a5-t-I*d)/q),q=Math.acos(I),t=1-I*I,L=Math.sqrt(t));p=1-c.e2*t;t=c.a/Math.sqrt(p);c=c.a6*t;t=N-t*I;d=b-c*L;b=I*t+L*d;N=I*d-L*t;c=N/(c/p+b);q+=c;0>a&&(q=-q);e[f++]=da*u;e[f++]=da*q;e[f]=b+N*c/2}function O(a,b,e,f){z(a,b,e,f);w(e,f,e,f)}function Q(a,b,e,f){z(a,b,e,f);D(e,
f,e,f)}function S(a,b,e){void 0===e&&(e=P());return T(a,b,e).projector}function T(a,b,e){if(e.source.spatialReference===a&&e.dest.spatialReference===b)return e;var f=x(a,e.source),c=x(b,e.dest);0===f&&0===c?a.equals(b)?e.projector=p:e.projector=null:e.projector=L[f][c];return e}function P(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:p}}var J,M,E,U,V,Z,aa,t;Object.defineProperty(d,"__esModule",
{value:!0});d.SphericalECEFSpatialReference=new a({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",\' + earthUtils.earthRadius + \',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});d.WGS84ECEFSpatialReference=new a({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});
d.canProject=function(a,b){return!!S(a,b,ia)};d.getProjectorName=function(a,b){a=S(a,b,ia);return a===p?"copy3":a===w?"wgs84ToSphericalECEF":a===D?"wgs84ToWebMercator":a===y?"wgs84ToWGS84ECEF":a===W?"webMercatorToWGS84":a===G?"webMercatorToSphericalECEF":a===K?"webMercatorToWGS84ECEF":a===z?"wgs84ECEFToWGS84":a===O?"wgs84ECEFToSphericalECEF":a===Q?"wgs84ECEFToWebMercator":a===H?"sphericalECEFToWGS84":a===A?"sphericalECEFToWebMercator":a===B?"sphericalECEFToWGS84ECEF":null};d.vectorToVector=I;d.polygonToPolygon=
function(a,b,e,f){void 0===e&&(e=b.spatialReference);void 0===f&&(f=0);var c=[];if(!R(a.rings,a.hasZ,a.hasM,a.spatialReference,c,e,f))return!1;b.rings=c;b.spatialReference=e;b.hasZ=a.hasZ;b.hasM=a.hasM;return!0};d.polylineToPolyline=function(a,b,e,f){void 0===e&&(e=b.spatialReference);void 0===f&&(f=0);var c=[];if(!R(a.paths,a.hasZ,a.hasM,a.spatialReference,c,e,f))return!1;b.paths=c;b.spatialReference=e;b.hasZ=a.hasZ;b.hasM=a.hasM;return!0};d.multipointToMultipoint=function(a,b,e,f){void 0===e&&(e=
b.spatialReference);void 0===f&&(f=0);var c=[];if(!R([a.points],a.hasZ,a.hasM,a.spatialReference,c,e,f))return!1;b.points=c[0];b.spatialReference=e;b.hasZ=a.hasZ;b.hasM=a.hasM;return!0};d.pointToPoint=function(a,b,e,f){void 0===e&&(e=b.spatialReference);void 0===f&&(f=0);v[0]=a.x;v[1]=a.y;var c=a.z;v[2]=void 0!==c?c:f;if(!q(v,a.spatialReference,0,v,e,0,1))return!1;b.x=v[0];b.y=v[1];b.spatialReference=e;void 0!==c?(b.z=v[2],b.hasZ=!0):(b.z=void 0,b.hasZ=!1);return!0};d.pointToVector=function(a,b,e,
f){void 0===f&&(f=0);v[0]=a.x;v[1]=a.y;var c=a.z;v[2]=void 0!==c?c:f;return q(v,a.spatialReference,0,b,e,0,1)};d.vectorToPoint=function(a,b,f,c){f instanceof r?c=c||f.spatialReference:e.isPoint(f)?(f.hasZ=!0,c=c||f.spatialReference):(c=f,f=new r({spatialReference:c}));return q(a,b,0,v,c,0,1)?(f.x=v[0],f.y=v[1],f.z=v[2],f.spatialReference=c,f):null};d.xyzToVector=function(a,b,e,f,c,u){v[0]=a;v[1]=b;v[2]=e;return q(v,f,0,c,u,0,1)};d.bufferToBuffer=q;d.localLinearScaleFactors=function(a,b,e,c){var u=
x(b,ea),t=x(c,ja);if(u===t&&0!==u||b.equals(c))return e[0]=1,e[1]=1,e[2]=1,!0;if(1===u){b=g.vec3.length(a);a=b/Math.sqrt(a[0]*a[0]+a[1]*a[1]);b/=f.earthRadius;if(3===t)return e[0]=a*b,e[1]=a*b,e[2]=1,!0;if(2===t||5===t)return t=180/(f.earthRadius*Math.PI),e[0]=t*a*b,e[1]=t*b,e[2]=1,!0}return!1};d.computeLinearTransformation=function(a,b,e,f){var c=x(a,ea),u=x(f,ja);if(c===u&&1!==u&&(0!==c||a.equals(f)))return h.mat4.identity(e),h.mat4.translate(e,e,b),!0;if(1===u){a=L[c][6];u=L[6][u];if(m.isNone(a)||
m.isNone(u))return!1;a(b,0,Y,0);u(Y,0,fa,0);a=X*Y[0];u=X*Y[1];b=Math.sin(a);a=Math.cos(a);f=Math.sin(u);u=Math.cos(u);e[0]=-b;e[4]=-f*a;e[8]=u*a;e[12]=fa[0];e[1]=a;e[5]=-f*b;e[9]=u*b;e[13]=fa[1];e[2]=0;e[6]=u;e[10]=f;e[14]=fa[2];e[3]=0;e[7]=0;e[11]=0;e[15]=1;return!0}if(3===u&&(2===c||1===c)){a=L[c][6];if(m.isNone(a))return!1;a(b,0,Y,0);b=X*Y[1];D(Y,0,fa,0);h.mat4.identity(e);h.mat4.translate(e,e,fa);b=1/Math.cos(b);h.mat4.scale(e,e,[b,b,1]);return!0}return!1};d.transformDirection=function(a,b,e,
f,c){g.vec3.copy(ga,a);g.vec3.add(ha,a,b);I(ga,e,ga,c);I(ha,e,ha,c);g.vec3.subtract(f,ha,ga);g.vec3.normalize(f,f)};d.mbsToMbs=function(a,b,e,c){b=T(b,c,la);if(b.projector===p)return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],!0;if(m.isNone(b.projector))return!1;c=b.source;var u=b.dest;if(3===u.spatialReferenceId){b=L[c.spatialReferenceId][2];if(m.isNone(b))return!1;b(a,0,Y,0);b=Math.abs(X*Y[1])+Math.asin(a[3]/(f.earthRadius+a[2]));D(Y,0,e,0);e[3]=b>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(b)*a[3];
return!0}b.projector(a,0,e,0);e[3]=a[3]*c.metersPerUnit/u.metersPerUnit;return!0};d.extentToBoundingBox=function(a,b,e){if(null==a)return!1;var f;v[0]=null!=a.xmin?a.xmin:0;v[1]=null!=a.ymin?a.ymin:0;v[2]=null!=a.zmin?a.zmin:0;f=q(v,a.spatialReference,0,b,e,0,1);v[0]=null!=a.xmax?a.xmax:0;v[1]=null!=a.ymax?a.ymax:0;v[2]=null!=a.zmax?a.zmax:0;f=f&&q(v,a.spatialReference,0,b,e,3,1);null==a.xmin&&(b[0]=-Infinity);null==a.ymin&&(b[1]=-Infinity);null==a.zmin&&(b[2]=-Infinity);null==a.xmax&&(b[3]=Infinity);
null==a.ymax&&(b[4]=Infinity);null==a.zmax&&(b[5]=Infinity);return f};d.extentToBoundingRect=function(a,b,e){if(null==a)return!1;var f;v[0]=null!=a.xmin?a.xmin:0;v[1]=null!=a.ymin?a.ymin:0;v[2]=null!=a.zmin?a.zmin:0;f=q(v,a.spatialReference,0,v,e,0,1);b[0]=v[0];b[1]=v[1];v[0]=null!=a.xmax?a.xmax:0;v[1]=null!=a.ymax?a.ymax:0;v[2]=null!=a.zmax?a.zmax:0;f=f&&q(v,a.spatialReference,0,v,e,0,1);b[2]=v[0];b[3]=v[1];null==a.xmin&&(b[0]=-Infinity);null==a.ymin&&(b[1]=-Infinity);null==a.xmax&&(b[2]=Infinity);
null==a.ymax&&(b[3]=Infinity);return f};d.boundingRectToBoundingRect=function(a,e,f,c){if(null==a)return!1;if(e.equals(c))return b.set(f,a),!0;v[0]=a[0];v[1]=a[1];v[2]=0;if(!q(v,e,0,v,c,0,1))return!1;f[0]=v[0];f[1]=v[1];v[0]=a[2];v[1]=a[3];v[2]=0;if(!q(v,e,0,v,c,0,1))return!1;f[2]=v[0];f[3]=v[1];return!0};(function(a){a.x2lon=function(a){return a/f.earthRadius};a.y2lat=function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/f.earthRadius))};a.lon2x=function(a){return a*f.earthRadius};a.lat2y=function(a){a=
Math.sin(a);return f.earthRadius/2*Math.log((1+a)/(1-a))}})(d.webMercator||(d.webMercator={}));d.canProjectToWGS84ComparableLonLat=function(a){a=x(a,ea);return!!L[a][6]};d.vectorToWGS84ComparableLonLat=F;d.pointToWGS84ComparableLonLat=C;d.pointToWGS84ComparableLonLatPoint=function(a,b){var e=x(b.spatialReference,ja);return m.isNone(L[6][e])?!1:C(a,v)?(b.x=v[0],b.y=v[1],b.z=v[2],!0):!1};d.wgs84ComparableLonLatToECEF=function(a,b,e,c){void 0===c&&(c=0);c=f.earthRadius+c;var u=Math.cos(e);a[0]=Math.cos(b)*
u*c;a[1]=Math.sin(b)*u*c;a[2]=Math.sin(e)*c};var L=(J={},J[2]=(M={},M[5]=null,M[6]=p,M[1]=w,M[0]=null,M[3]=D,M[2]=p,M[4]=y,M),J[5]=(E={},E[5]=p,E[6]=p,E[1]=w,E[0]=null,E[3]=null,E[2]=null,E[4]=y,E),J[3]=(U={},U[5]=null,U[6]=W,U[1]=G,U[0]=null,U[3]=p,U[2]=W,U[4]=K,U),J[4]=(V={},V[5]=z,V[6]=z,V[1]=O,V[0]=null,V[3]=Q,V[2]=z,V[4]=p,V),J[1]=(Z={},Z[5]=H,Z[6]=H,Z[1]=p,Z[0]=null,Z[3]=A,Z[2]=H,Z[4]=B,Z),J[0]=(aa={},aa[5]=null,aa[6]=null,aa[1]=null,aa[0]=p,aa[3]=null,aa[2]=null,aa[4]=null,aa),J[6]=(t={},t[5]=
null,t[6]=p,t[1]=w,t[0]=null,t[3]=null,t[2]=p,t[4]=y,t),J);d.getProjector=S;var ea={spatialReference:null,spatialReferenceId:0},ja={spatialReference:null,spatialReferenceId:0},ia=P(),la=P(),X=c.deg2rad(1),da=c.rad2deg(1),ka={a:6378137,e2:.006694379990137799,a1:42697.67270715754,a2:1.8230912546075456E9,a3:142.91722289812412,a4:4.557728136518864E9,a5:42840.589930055656,a6:.9933056200098622},v=l.vec3f64.create(),Y=l.vec3f64.create(),fa=l.vec3f64.create(),ga=l.vec3f64.create(),ha=l.vec3f64.create()})},
"esri/core/libs/gl-matrix-2/mat4":function(){define(["require","exports","./math/mat4"],function(n,d,c){Object.defineProperty(d,"__esModule",{value:!0});d.mat4=c})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["require","exports","../factories/vec3f64","./common"],function(n,d,c,m){function k(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}function h(a,b,e){var f=b[0],c=b[1],d=b[2],R=b[3],q=b[4],x=b[5],
p=b[6],g=b[7],k=b[8],m=b[9],h=b[10],l=b[11],r=b[12],w=b[13],n=b[14];b=b[15];var A=e[0],B=e[1],y=e[2],z=e[3];a[0]=A*f+B*q+y*k+z*r;a[1]=A*c+B*x+y*m+z*w;a[2]=A*d+B*p+y*h+z*n;a[3]=A*R+B*g+y*l+z*b;A=e[4];B=e[5];y=e[6];z=e[7];a[4]=A*f+B*q+y*k+z*r;a[5]=A*c+B*x+y*m+z*w;a[6]=A*d+B*p+y*h+z*n;a[7]=A*R+B*g+y*l+z*b;A=e[8];B=e[9];y=e[10];z=e[11];a[8]=A*f+B*q+y*k+z*r;a[9]=A*c+B*x+y*m+z*w;a[10]=A*d+B*p+y*h+z*n;a[11]=A*R+B*g+y*l+z*b;A=e[12];B=e[13];y=e[14];z=e[15];a[12]=A*f+B*q+y*k+z*r;a[13]=A*c+B*x+y*m+z*w;a[14]=
A*d+B*p+y*h+z*n;a[15]=A*R+B*g+y*l+z*b;return a}function g(a,b,e){var f=b[0],c=b[1],d=b[2],R=b[3],q=f+f,x=c+c,p=d+d;b=f*q;var g=f*x,f=f*p,k=c*x,c=c*p,d=d*p,q=R*q,x=R*x,R=R*p;a[0]=1-(k+d);a[1]=g+R;a[2]=f-x;a[3]=0;a[4]=g-R;a[5]=1-(b+d);a[6]=c+q;a[7]=0;a[8]=f+x;a[9]=c-q;a[10]=1-(b+k);a[11]=0;a[12]=e[0];a[13]=e[1];a[14]=e[2];a[15]=1;return a}function l(a,b,e){a[0]=b[0]-e[0];a[1]=b[1]-e[1];a[2]=b[2]-e[2];a[3]=b[3]-e[3];a[4]=b[4]-e[4];a[5]=b[5]-e[5];a[6]=b[6]-e[6];a[7]=b[7]-e[7];a[8]=b[8]-e[8];a[9]=b[9]-
e[9];a[10]=b[10]-e[10];a[11]=b[11]-e[11];a[12]=b[12]-e[12];a[13]=b[13]-e[13];a[14]=b[14]-e[14];a[15]=b[15]-e[15];return a}Object.defineProperty(d,"__esModule",{value:!0});d.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};d.set=function(a,b,e,f,c,d,R,q,x,p,g,k,m,h,l,r,w){a[0]=b;a[1]=e;a[2]=f;a[3]=c;a[4]=d;a[5]=R;a[6]=q;a[7]=x;a[8]=p;a[9]=g;a[10]=k;
a[11]=m;a[12]=h;a[13]=l;a[14]=r;a[15]=w;return a};d.identity=k;d.transpose=function(a,b){if(a===b){var e=b[1],f=b[2],c=b[3],d=b[6],g=b[7],q=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=e;a[6]=b[9];a[7]=b[13];a[8]=f;a[9]=d;a[11]=b[14];a[12]=c;a[13]=g;a[14]=q}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a};d.invert=function(a,b){var e=b[0],f=b[1],c=b[2],d=b[3],g=b[4],
q=b[5],x=b[6],p=b[7],k=b[8],m=b[9],h=b[10],l=b[11],r=b[12],C=b[13],w=b[14];b=b[15];var n=e*q-f*g,A=e*x-c*g,B=e*p-d*g,y=f*x-c*q,z=f*p-d*q,O=c*p-d*x,Q=k*C-m*r,S=k*w-h*r,T=k*b-l*r,P=m*w-h*C,J=m*b-l*C,M=h*b-l*w,E=n*M-A*J+B*P+y*T-z*S+O*Q;if(!E)return null;E=1/E;a[0]=(q*M-x*J+p*P)*E;a[1]=(c*J-f*M-d*P)*E;a[2]=(C*O-w*z+b*y)*E;a[3]=(h*z-m*O-l*y)*E;a[4]=(x*T-g*M-p*S)*E;a[5]=(e*M-c*T+d*S)*E;a[6]=(w*B-r*O-b*A)*E;a[7]=(k*O-h*B+l*A)*E;a[8]=(g*J-q*T+p*Q)*E;a[9]=(f*T-e*J-d*Q)*E;a[10]=(r*z-C*B+b*n)*E;a[11]=(m*B-k*
z-l*n)*E;a[12]=(q*S-g*P-x*Q)*E;a[13]=(e*P-f*S+c*Q)*E;a[14]=(C*A-r*y-w*n)*E;a[15]=(k*y-m*A+h*n)*E;return a};d.adjoint=function(a,b){var e=b[0],f=b[1],c=b[2],d=b[3],g=b[4],q=b[5],x=b[6],p=b[7],k=b[8],m=b[9],h=b[10],l=b[11],r=b[12],n=b[13],w=b[14];b=b[15];a[0]=q*(h*b-l*w)-m*(x*b-p*w)+n*(x*l-p*h);a[1]=-(f*(h*b-l*w)-m*(c*b-d*w)+n*(c*l-d*h));a[2]=f*(x*b-p*w)-q*(c*b-d*w)+n*(c*p-d*x);a[3]=-(f*(x*l-p*h)-q*(c*l-d*h)+m*(c*p-d*x));a[4]=-(g*(h*b-l*w)-k*(x*b-p*w)+r*(x*l-p*h));a[5]=e*(h*b-l*w)-k*(c*b-d*w)+r*(c*
l-d*h);a[6]=-(e*(x*b-p*w)-g*(c*b-d*w)+r*(c*p-d*x));a[7]=e*(x*l-p*h)-g*(c*l-d*h)+k*(c*p-d*x);a[8]=g*(m*b-l*n)-k*(q*b-p*n)+r*(q*l-p*m);a[9]=-(e*(m*b-l*n)-k*(f*b-d*n)+r*(f*l-d*m));a[10]=e*(q*b-p*n)-g*(f*b-d*n)+r*(f*p-d*q);a[11]=-(e*(q*l-p*m)-g*(f*l-d*m)+k*(f*p-d*q));a[12]=-(g*(m*w-h*n)-k*(q*w-x*n)+r*(q*h-x*m));a[13]=e*(m*w-h*n)-k*(f*w-c*n)+r*(f*h-c*m);a[14]=-(e*(q*w-x*n)-g*(f*w-c*n)+r*(f*x-c*q));a[15]=e*(q*h-x*m)-g*(f*h-c*m)+k*(f*x-c*q);return a};d.determinant=function(a){var b=a[0],e=a[1],f=a[2],c=
a[3],d=a[4],g=a[5],q=a[6],x=a[7],p=a[8],h=a[9],m=a[10],k=a[11],l=a[12],r=a[13],n=a[14];a=a[15];return(b*g-e*d)*(m*a-k*n)-(b*q-f*d)*(h*a-k*r)+(b*x-c*d)*(h*n-m*r)+(e*q-f*g)*(p*a-k*l)-(e*x-c*g)*(p*n-m*l)+(f*x-c*q)*(p*r-h*l)};d.multiply=h;d.translate=function(a,b,e){var f=e[0],c=e[1];e=e[2];var d=void 0,g=void 0,q=void 0,h=void 0,p=void 0,m=void 0,k=void 0,l=void 0,r=void 0,n=void 0,C=void 0,w=void 0;b===a?(a[12]=b[0]*f+b[4]*c+b[8]*e+b[12],a[13]=b[1]*f+b[5]*c+b[9]*e+b[13],a[14]=b[2]*f+b[6]*c+b[10]*e+
b[14],a[15]=b[3]*f+b[7]*c+b[11]*e+b[15]):(d=b[0],g=b[1],q=b[2],h=b[3],p=b[4],m=b[5],k=b[6],l=b[7],r=b[8],n=b[9],C=b[10],w=b[11],a[0]=d,a[1]=g,a[2]=q,a[3]=h,a[4]=p,a[5]=m,a[6]=k,a[7]=l,a[8]=r,a[9]=n,a[10]=C,a[11]=w,a[12]=d*f+p*c+r*e+b[12],a[13]=g*f+m*c+n*e+b[13],a[14]=q*f+k*c+C*e+b[14],a[15]=h*f+l*c+w*e+b[15]);return a};d.scale=function(a,b,e){var f=e[0],c=e[1];e=e[2];a[0]=b[0]*f;a[1]=b[1]*f;a[2]=b[2]*f;a[3]=b[3]*f;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*e;a[9]=b[9]*e;a[10]=b[10]*
e;a[11]=b[11]*e;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};d.rotate=function(a,b,e,f){var c=f[0],d=f[1];f=f[2];var g=Math.sqrt(c*c+d*d+f*f),q=void 0,h=void 0,p=void 0,k=void 0,l=void 0,r=void 0,n=void 0,F=void 0,C=void 0,w=void 0,H=void 0,A=void 0,B=void 0,y=void 0,z=void 0,O=void 0,Q=void 0,S=void 0,T=void 0,P=void 0,J=void 0,M=void 0,h=q=void 0;if(g<m.EPSILON)return null;g=1/g;c*=g;d*=g;f*=g;q=Math.sin(e);h=Math.cos(e);p=1-h;k=b[0];l=b[1];r=b[2];n=b[3];F=b[4];C=b[5];w=b[6];H=b[7];
A=b[8];B=b[9];y=b[10];z=b[11];O=c*c*p+h;Q=d*c*p+f*q;S=f*c*p-d*q;T=c*d*p-f*q;P=d*d*p+h;J=f*d*p+c*q;M=c*f*p+d*q;q=d*f*p-c*q;h=f*f*p+h;a[0]=k*O+F*Q+A*S;a[1]=l*O+C*Q+B*S;a[2]=r*O+w*Q+y*S;a[3]=n*O+H*Q+z*S;a[4]=k*T+F*P+A*J;a[5]=l*T+C*P+B*J;a[6]=r*T+w*P+y*J;a[7]=n*T+H*P+z*J;a[8]=k*M+F*q+A*h;a[9]=l*M+C*q+B*h;a[10]=r*M+w*q+y*h;a[11]=n*M+H*q+z*h;b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);return a};d.rotateX=function(a,b,e){var f=Math.sin(e);e=Math.cos(e);var c=b[4],d=b[5],g=b[6],q=b[7],h=b[8],
p=b[9],k=b[10],m=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=c*e+h*f;a[5]=d*e+p*f;a[6]=g*e+k*f;a[7]=q*e+m*f;a[8]=h*e-c*f;a[9]=p*e-d*f;a[10]=k*e-g*f;a[11]=m*e-q*f;return a};d.rotateY=function(a,b,e){var f=Math.sin(e);e=Math.cos(e);var c=b[0],d=b[1],g=b[2],q=b[3],h=b[8],k=b[9],m=b[10],l=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=c*e-h*f;a[1]=d*e-k*f;a[2]=g*e-m*f;a[3]=q*e-
l*f;a[8]=c*f+h*e;a[9]=d*f+k*e;a[10]=g*f+m*e;a[11]=q*f+l*e;return a};d.rotateZ=function(a,b,e){var f=Math.sin(e);e=Math.cos(e);var c=b[0],d=b[1],g=b[2],q=b[3],h=b[4],k=b[5],m=b[6],l=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=c*e+h*f;a[1]=d*e+k*f;a[2]=g*e+m*f;a[3]=q*e+l*f;a[4]=h*e-c*f;a[5]=k*e-d*f;a[6]=m*e-g*f;a[7]=l*e-q*f;return a};d.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=
0;a[10]=1;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};d.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=b[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};d.fromRotation=function(a,b,e){var f=e[0],c=e[1];e=e[2];var d=Math.sqrt(f*f+c*c+e*e),g=void 0,h=void 0,k=void 0;if(d<m.EPSILON)return null;d=1/d;f*=d;c*=d;e*=d;g=Math.sin(b);h=Math.cos(b);k=1-h;a[0]=f*f*k+h;a[1]=c*f*k+e*g;a[2]=e*f*k-c*g;a[3]=0;a[4]=f*c*k-e*g;a[5]=c*c*
k+h;a[6]=e*c*k+f*g;a[7]=0;a[8]=f*e*k+c*g;a[9]=c*e*k-f*g;a[10]=e*e*k+h;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};d.fromXRotation=function(a,b){var e=Math.sin(b);b=Math.cos(b);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=e;a[7]=0;a[8]=0;a[9]=-e;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};d.fromYRotation=function(a,b){var e=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=0;a[2]=-e;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=e;a[9]=0;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};
d.fromZRotation=function(a,b){var e=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=e;a[2]=0;a[3]=0;a[4]=-e;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};d.fromRotationTranslation=g;d.fromQuat2=function(a,b){var e=r,f=-b[0],c=-b[1],d=-b[2],h=b[3],k=b[4],m=b[5],p=b[6],l=b[7],n=f*f+c*c+d*d+h*h;0<n?(e[0]=2*(k*h+l*f+m*d-p*c)/n,e[1]=2*(m*h+l*c+p*f-k*d)/n,e[2]=2*(p*h+l*d+k*c-m*f)/n):(e[0]=2*(k*h+l*f+m*d-p*c),e[1]=2*(m*h+l*c+p*f-k*d),e[2]=2*(p*h+l*d+k*c-m*f));g(a,b,e);
return a};var r=c.create();d.getTranslation=function(a,b){a[0]=b[12];a[1]=b[13];a[2]=b[14];return a};d.getScaling=function(a,b){var e=b[0],f=b[1],c=b[2],d=b[4],g=b[5],h=b[6],k=b[8],m=b[9];b=b[10];a[0]=Math.sqrt(e*e+f*f+c*c);a[1]=Math.sqrt(d*d+g*g+h*h);a[2]=Math.sqrt(k*k+m*m+b*b);return a};d.getRotation=function(a,b){var e=b[0]+b[5]+b[10],f=0;0<e?(f=2*Math.sqrt(e+1),a[3]=.25*f,a[0]=(b[6]-b[9])/f,a[1]=(b[8]-b[2])/f,a[2]=(b[1]-b[4])/f):b[0]>b[5]&&b[0]>b[10]?(f=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-
b[9])/f,a[0]=.25*f,a[1]=(b[1]+b[4])/f,a[2]=(b[8]+b[2])/f):b[5]>b[10]?(f=2*Math.sqrt(1+b[5]-b[0]-b[10]),a[3]=(b[8]-b[2])/f,a[0]=(b[1]+b[4])/f,a[1]=.25*f,a[2]=(b[6]+b[9])/f):(f=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/f,a[0]=(b[8]+b[2])/f,a[1]=(b[6]+b[9])/f,a[2]=.25*f);return a};d.fromRotationTranslationScale=function(a,b,e,f){var c=b[0],d=b[1],g=b[2],h=b[3],k=c+c,m=d+d,l=g+g;b=c*k;var r=c*m,c=c*l,n=d*m,d=d*l,g=g*l,k=h*k,m=h*m,h=h*l,l=f[0],D=f[1];f=f[2];a[0]=(1-(n+g))*l;a[1]=(r+h)*l;a[2]=(c-
m)*l;a[3]=0;a[4]=(r-h)*D;a[5]=(1-(b+g))*D;a[6]=(d+k)*D;a[7]=0;a[8]=(c+m)*f;a[9]=(d-k)*f;a[10]=(1-(b+n))*f;a[11]=0;a[12]=e[0];a[13]=e[1];a[14]=e[2];a[15]=1;return a};d.fromRotationTranslationScaleOrigin=function(a,b,e,f,c){var d=b[0],g=b[1],h=b[2],k=b[3],m=d+d,l=g+g,u=h+h;b=d*m;var r=d*l,n=d*u,d=g*l,g=g*u,F=h*u,h=k*m,l=k*l,C=k*u,w=f[0],H=f[1],u=f[2];f=c[0];k=c[1];c=c[2];var m=(1-(d+F))*w,A=(r+C)*w,w=(n-l)*w,r=(r-C)*H,F=(1-(b+F))*H,H=(g+h)*H,n=(n+l)*u,g=(g-h)*u;b=(1-(b+d))*u;a[0]=m;a[1]=A;a[2]=w;a[3]=
0;a[4]=r;a[5]=F;a[6]=H;a[7]=0;a[8]=n;a[9]=g;a[10]=b;a[11]=0;a[12]=e[0]+f-(m*f+r*k+n*c);a[13]=e[1]+k-(A*f+F*k+g*c);a[14]=e[2]+c-(w*f+H*k+b*c);a[15]=1;return a};d.fromQuat=function(a,b){var e=b[0],c=b[1],d=b[2];b=b[3];var g=e+e,h=c+c,k=d+d,e=e*g,m=c*g,c=c*h,l=d*g,r=d*h,d=d*k,g=b*g,h=b*h;b*=k;a[0]=1-c-d;a[1]=m+b;a[2]=l-h;a[3]=0;a[4]=m-b;a[5]=1-e-d;a[6]=r+g;a[7]=0;a[8]=l+h;a[9]=r-g;a[10]=1-e-c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};d.frustum=function(a,b,e,c,d,g,h){var f=1/(e-b),k=1/(d-c),
m=1/(g-h);a[0]=2*g*f;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*g*k;a[6]=0;a[7]=0;a[8]=(e+b)*f;a[9]=(d+c)*k;a[10]=(h+g)*m;a[11]=-1;a[12]=0;a[13]=0;a[14]=h*g*2*m;a[15]=0;return a};d.perspective=function(a,b,e,c,d){b=1/Math.tan(b/2);var f=void 0;a[0]=b/e;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[11]=-1;a[12]=0;a[13]=0;a[15]=0;null!=d&&Infinity!==d?(f=1/(c-d),a[10]=(d+c)*f,a[14]=2*d*c*f):(a[10]=-1,a[14]=-2*c);return a};d.perspectiveFromFieldOfView=function(a,b,e,c){var f=Math.tan(b.upDegrees*
Math.PI/180),d=Math.tan(b.downDegrees*Math.PI/180),g=Math.tan(b.leftDegrees*Math.PI/180);b=Math.tan(b.rightDegrees*Math.PI/180);var h=2/(g+b),k=2/(f+d);a[0]=h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=k;a[6]=0;a[7]=0;a[8]=-((g-b)*h*.5);a[9]=(f-d)*k*.5;a[10]=c/(e-c);a[11]=-1;a[12]=0;a[13]=0;a[14]=c*e/(e-c);a[15]=0;return a};d.ortho=function(a,b,e,c,d,g,h){var f=1/(b-e),k=1/(c-d),m=1/(g-h);a[0]=-2*f;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*k;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*m;a[11]=0;a[12]=(b+e)*f;a[13]=(d+c)*
k;a[14]=(h+g)*m;a[15]=1;return a};d.lookAt=function(a,b,e,c){var f=void 0,d=void 0,g=void 0,h=void 0,l=void 0,r=void 0,n=void 0,G=void 0,K=void 0,D=void 0,F=b[0],C=b[1];b=b[2];g=c[0];h=c[1];c=c[2];n=e[0];G=e[1];e=e[2];if(Math.abs(F-n)<m.EPSILON&&Math.abs(C-G)<m.EPSILON&&Math.abs(b-e)<m.EPSILON)return k(a);n=F-n;G=C-G;K=b-e;D=1/Math.sqrt(n*n+G*G+K*K);n*=D;G*=D;K*=D;f=h*K-c*G;d=c*n-g*K;g=g*G-h*n;(D=Math.sqrt(f*f+d*d+g*g))?(D=1/D,f*=D,d*=D,g*=D):g=d=f=0;h=G*g-K*d;l=K*f-n*g;r=n*d-G*f;(D=Math.sqrt(h*h+
l*l+r*r))?(D=1/D,h*=D,l*=D,r*=D):r=l=h=0;a[0]=f;a[1]=h;a[2]=n;a[3]=0;a[4]=d;a[5]=l;a[6]=G;a[7]=0;a[8]=g;a[9]=r;a[10]=K;a[11]=0;a[12]=-(f*F+d*C+g*b);a[13]=-(h*F+l*C+r*b);a[14]=-(n*F+G*C+K*b);a[15]=1;return a};d.targetTo=function(a,b,e,c){var f=b[0],d=b[1];b=b[2];var g=c[0],h=c[1],k=c[2];c=f-e[0];var m=d-e[1];e=b-e[2];var l=c*c+m*m+e*e;0<l&&(l=1/Math.sqrt(l),c*=l,m*=l,e*=l);var r=h*e-k*m,k=k*c-g*e,g=g*m-h*c,l=r*r+k*k+g*g;0<l&&(l=1/Math.sqrt(l),r*=l,k*=l,g*=l);a[0]=r;a[1]=k;a[2]=g;a[3]=0;a[4]=m*g-e*
k;a[5]=e*r-c*g;a[6]=c*k-m*r;a[7]=0;a[8]=c;a[9]=m;a[10]=e;a[11]=0;a[12]=f;a[13]=d;a[14]=b;a[15]=1;return a};d.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};d.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],
2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};d.add=function(a,b,e){a[0]=b[0]+e[0];a[1]=b[1]+e[1];a[2]=b[2]+e[2];a[3]=b[3]+e[3];a[4]=b[4]+e[4];a[5]=b[5]+e[5];a[6]=b[6]+e[6];a[7]=b[7]+e[7];a[8]=b[8]+e[8];a[9]=b[9]+e[9];a[10]=b[10]+e[10];a[11]=b[11]+e[11];a[12]=b[12]+e[12];a[13]=b[13]+e[13];a[14]=b[14]+e[14];a[15]=b[15]+e[15];return a};d.subtract=l;d.multiplyScalar=function(a,b,e){a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;a[4]=
b[4]*e;a[5]=b[5]*e;a[6]=b[6]*e;a[7]=b[7]*e;a[8]=b[8]*e;a[9]=b[9]*e;a[10]=b[10]*e;a[11]=b[11]*e;a[12]=b[12]*e;a[13]=b[13]*e;a[14]=b[14]*e;a[15]=b[15]*e;return a};d.multiplyScalarAndAdd=function(a,b,e,c){a[0]=b[0]+e[0]*c;a[1]=b[1]+e[1]*c;a[2]=b[2]+e[2]*c;a[3]=b[3]+e[3]*c;a[4]=b[4]+e[4]*c;a[5]=b[5]+e[5]*c;a[6]=b[6]+e[6]*c;a[7]=b[7]+e[7]*c;a[8]=b[8]+e[8]*c;a[9]=b[9]+e[9]*c;a[10]=b[10]+e[10]*c;a[11]=b[11]+e[11]*c;a[12]=b[12]+e[12]*c;a[13]=b[13]+e[13]*c;a[14]=b[14]+e[14]*c;a[15]=b[15]+e[15]*c;return a};
d.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};d.equals=function(a,b){var e=a[0],c=a[1],d=a[2],g=a[3],h=a[4],k=a[5],l=a[6],r=a[7],n=a[8],G=a[9],K=a[10],D=a[11],F=a[12],C=a[13],w=a[14];a=a[15];var H=b[0],A=b[1],B=b[2],y=b[3],z=b[4],O=b[5],Q=b[6],S=b[7],T=b[8],P=b[9],J=b[10],M=b[11],E=b[12],U=b[13],
V=b[14];b=b[15];return Math.abs(e-H)<=m.EPSILON*Math.max(1,Math.abs(e),Math.abs(H))&&Math.abs(c-A)<=m.EPSILON*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(d-B)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(B))&&Math.abs(g-y)<=m.EPSILON*Math.max(1,Math.abs(g),Math.abs(y))&&Math.abs(h-z)<=m.EPSILON*Math.max(1,Math.abs(h),Math.abs(z))&&Math.abs(k-O)<=m.EPSILON*Math.max(1,Math.abs(k),Math.abs(O))&&Math.abs(l-Q)<=m.EPSILON*Math.max(1,Math.abs(l),Math.abs(Q))&&Math.abs(r-S)<=m.EPSILON*Math.max(1,Math.abs(r),
Math.abs(S))&&Math.abs(n-T)<=m.EPSILON*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(G-P)<=m.EPSILON*Math.max(1,Math.abs(G),Math.abs(P))&&Math.abs(K-J)<=m.EPSILON*Math.max(1,Math.abs(K),Math.abs(J))&&Math.abs(D-M)<=m.EPSILON*Math.max(1,Math.abs(D),Math.abs(M))&&Math.abs(F-E)<=m.EPSILON*Math.max(1,Math.abs(F),Math.abs(E))&&Math.abs(C-U)<=m.EPSILON*Math.max(1,Math.abs(C),Math.abs(U))&&Math.abs(w-V)<=m.EPSILON*Math.max(1,Math.abs(w),Math.abs(V))&&Math.abs(a-b)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};
d.mul=h;d.sub=l})},"esri/views/3d/support/earthUtils":function(){define("require exports ../../../core/mathUtils ../../../core/wgs84Constants ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ./projectionUtils".split(" "),function(n,d,c,m,k,h,g,l){function r(a,b,e,h){var f,k;a instanceof g&&b instanceof g&&(e=b.longitude,h=b.latitude,k=a.latitude,f=a.longitude);a=c.deg2rad(k);h=c.deg2rad(h);f=c.deg2rad(f);b=c.deg2rad(e);e=Math.sin((a-h)/2);f=Math.sin((f-
b)/2);e=2*c.asinClamped(Math.sqrt(e*e+Math.cos(a)*Math.cos(h)*f*f))*d.earthRadius;return Math.round(1E4*e)/1E4}function a(a,b){a/=15;b||(a=Math.round(a));return a}Object.defineProperty(d,"__esModule",{value:!0});d.earthRadius=m.wgs84Radius;d.halfEarthRadius=d.earthRadius/2;d.halfEarthCircumference=Math.PI*d.earthRadius;d.earthCircumference=2*d.halfEarthCircumference;d.metersPerDegree=d.halfEarthCircumference/180;d.getGreatCircleDistance=r;d.getGreatCircleSpanAt=function(a,b,e){var c=b.spatialReference,
f=new g(b.x,a.y,c),d=new g(e.x,a.y,c);b=new g(a.x,b.y,c);a=new g(a.x,e.y,c);return{lon:r(f,d),lat:r(b,a)}};d.getLonDeltaForDistance=function(a,b){b/=d.earthRadius;a=c.deg2rad(a);b=Math.sin(b/2);a=Math.cos(a);a=2*c.asinClamped(Math.sqrt(b*b/(a*a)));return c.rad2deg(a)};d.getLatDeltaForDistance=function(a){return c.rad2deg(a/d.earthRadius)};d.getMaxCameraAltitude=function(a){a=c.deg2rad(a/2);return(1-Math.sin(a))*d.earthRadius/Math.sin(a)};d.getViewExtentDistance=function(a,b){b=c.deg2rad(b/2);return 2*
c.acosClamped((Math.pow(a+d.earthRadius,2)+Math.pow(d.earthRadius,2)-Math.pow((a+d.earthRadius)*Math.cos(b)-Math.sqrt(Math.pow(Math.cos(b)*(a+d.earthRadius),2)-a*a-2*a*d.earthRadius),2))/(2*(a+d.earthRadius)*d.earthRadius))*d.earthRadius};d.computeCartesianDistance=function(a,c){a=l.wgs84ComparableLonLatToECEF(b,a.longitude,a.latitude,a.z||0);c=l.wgs84ComparableLonLatToECEF(e,c.longitude,c.latitude,c.z||0);c=[c[0]-a[0],c[1]-a[1],c[2]-a[2]];return Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2])};d.longitudeToTimezone=
a;d.positionToTimezone=function(b,c){c||(c={hours:0,minutes:0,seconds:0});c.hours=a(b[0],!0);b=c.hours%1;c.hours-=b;c.minutes=60*b;b=c.minutes%1;c.minutes-=b;c.seconds=Math.round(60*b);return c};d.distanceToIdealHorizon=function(a,b){b=b||d.earthRadius;a=k.vec3.dot(a,a);return Math.sqrt(Math.abs(a-b*b))};var b=h.vec3f64.create(),e=h.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["require","exports"],function(n,d){Object.defineProperty(d,"__esModule",{value:!0});
(function(c){c.length=function(c,d){var h=c[d],g=c[d+1];c=c[d+2];return Math.sqrt(h*h+g*g+c*c)};c.normalize=function(c,d){var h=c[d],g=c[d+1],k=c[d+2],h=1/Math.sqrt(h*h+g*g+k*k);c[d]*=h;c[d+1]*=h;c[d+2]*=h};c.scale=function(c,d,h){c[d]*=h;c[d+1]*=h;c[d+2]*=h};c.add=function(c,d,h,g,l,r){void 0===r&&(r=d);l=l||c;l[r]=c[d]+h[g];l[r+1]=c[d+1]+h[g+1];l[r+2]=c[d+2]+h[g+2]};c.subtract=function(c,d,h,g,l,r){void 0===r&&(r=d);l=l||c;l[r]=c[d]-h[g];l[r+1]=c[d+1]-h[g+1];l[r+2]=c[d+2]-h[g+2]}})(d.Vec3Compact||
(d.Vec3Compact={}))})},"esri/views/support/spatialReferenceSupport":function(){define(["require","exports"],function(n,d){Object.defineProperty(d,"__esModule",{value:!0});d.isSpatialReferenceSupported=function(c,d){return null==c?!1:"2d"===d?!0:"local"===d?!c.isGeographic:c.isWebMercator||c.isWGS84||4490===c.wkid}})},"esri/webdoc/support/saveUtils":function(){define("require exports tslib ../../core/asyncUtils ../../core/Error ../../core/promiseUtils ../../core/SetUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),
function(n,d,c,m,k,h,g,l,r){function a(a,b){return c.__awaiter(this,void 0,void 0,function(){var e;return c.__generator(this,function(c){switch(c.label){case 0:return[4,m.result(a.resource.portalItem.addResource(a.resource,a.content,b))];case 1:e=c.sent();if(!0===e.ok)a.finish&&a.finish(a.resource);else throw a.error&&a.error(e.error),e.error;return[2]}})})}function b(a,b){return c.__awaiter(this,void 0,void 0,function(){var e;return c.__generator(this,function(c){switch(c.label){case 0:return[4,
m.result(a.resource.update(a.content,b))];case 1:e=c.sent();if(!0===e.ok)a.finish(a.resource);else throw a.error(e.error),e.error;return[2]}})})}Object.defineProperty(d,"__esModule",{value:!0});d.saveResources=function(e,d,m){return c.__awaiter(this,void 0,void 0,function(){var f,n,q,u,p,W,G,K,D,F,C,w,H,A,B,y,z;return c.__generator(this,function(c){switch(c.label){case 0:if(!d||!d.resources)return[2];f=d.portalItem===e.portalItem?g.SetFromValues(e.paths):new Set;e.paths.length=0;e.portalItem=d.portalItem;
n=g.SetFromValues(d.resources.toKeep.map(function(a){return a.resource.path}));q=new Set;u=[];n.forEach(function(a){f.delete(a);e.paths.push(a)});p=0;for(W=d.resources.toUpdate;p<W.length;p++)G=W[p],f.delete(G.resource.path),n.has(G.resource.path)||q.has(G.resource.path)?(K=G.resource,D=G.content,F=G.finish,C=G.error,w=r.getSiblingOfSameType(K,l.generateUUID()),e.paths.push(w.path),u.push(a({resource:w,content:D,finish:F,error:C},m))):(e.paths.push(G.resource.path),u.push(b(G,m)),q.add(G.resource.path));
H=0;for(A=d.resources.toAdd;H<A.length;H++)B=A[H],u.push(a(B,m)),e.paths.push(B.resource.path);f.forEach(function(a){a=d.portalItem.resourceFromPath(a);u.push(a.portalItem.removeResource(a).catch(function(){}))});return 0===u.length?[2]:[4,h.eachAlways(u)];case 1:y=c.sent();h.throwIfAborted(m);z=y.filter(function(a){return"error"in a}).map(function(a){return a.error});if(0<z.length)throw new k("save:resources","Failed to save one or more resources",{errors:z});return[2]}})})}})},"esri/webdoc/support/thumbnailUtils":function(){define(["require",
"exports"],function(n,d){Object.defineProperty(d,"__esModule",{value:!0});var c={width:600,height:400};d.getOptimalThumbnailSize=function(d,k){k=k||c;var h=k.width;k=k.height;var g=h/k;1.5>g?k=h/1.5:1.5<g&&(h=1.5*k);h>d.width&&(k*=d.width/h,h=d.width);k>d.height&&(h*=d.height/k,k=d.height);return{width:Math.round(h),height:Math.round(k)}}})},"esri/webscene/ApplicationProperties":function(){define("require exports tslib ../core/JSONSupport ../core/accessorSupport/decorators ../webdoc/applicationProperties/Viewing".split(" "),
function(n,d,c,m,k,h){return function(d){function g(a){a=d.call(this,a)||this;a.viewing=null;return a}c.__extends(g,d);r=g;g.prototype.clone=function(){return new r({viewing:this.viewing?this.viewing.clone():null})};var r;c.__decorate([k.property({type:h,json:{write:!0}})],g.prototype,"viewing",void 0);return g=r=c.__decorate([k.subclass("esri.webscene.ApplicationProperties")],g)}(m.JSONSupport)})},"esri/webdoc/applicationProperties/Viewing":function(){define("require exports tslib ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./Search".split(" "),
function(n,d,c,m,k,h,g){return function(d){function l(a){a=d.call(this,a)||this;a.search=null;return a}c.__extends(l,d);a=l;l.prototype.clone=function(){return new a(k.clone({search:this.search}))};var a;c.__decorate([h.property({type:g,json:{write:!0}})],l.prototype,"search",void 0);return l=a=c.__decorate([h.subclass("esri.webdoc.applicationProperties.Viewing")],l)}(m.JSONSupport)})},"esri/webdoc/applicationProperties/Search":function(){define("require exports tslib ../../core/Collection ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./SearchLayer".split(" "),
function(n,d,c,m,k,h,g,l){var r=m.ofType(l);return function(a){function b(b){b=a.call(this,b)||this;b.addressSearchEnabled=!0;b.enabled=!0;b.hintText=null;b.layers=new r;return b}c.__extends(b,a);e=b;b.prototype.readAddressSearchEnabled=function(a){return!a};b.prototype.writeAddressSearchEnabled=function(a,b,c){b[c]=!a};b.prototype.clone=function(){return new e(h.clone({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers}))};var e;c.__decorate([g.property({type:Boolean,
json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder"},default:!0,origins:{"web-scene":{read:!1,write:!1}}}})],b.prototype,"addressSearchEnabled",void 0);c.__decorate([g.reader("addressSearchEnabled")],b.prototype,"readAddressSearchEnabled",null);c.__decorate([g.writer("addressSearchEnabled")],b.prototype,"writeAddressSearchEnabled",null);c.__decorate([g.property({type:Boolean,json:{write:!0,default:!0}})],b.prototype,"enabled",void 0);c.__decorate([g.property({type:String,json:{write:!0}})],
b.prototype,"hintText",void 0);c.__decorate([g.property({type:r,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"layers",void 0);return b=e=c.__decorate([g.subclass("esri.webdoc.applicationProperties.Search")],b)}(k.JSONSupport)})},"esri/webdoc/applicationProperties/SearchLayer":function(){define("require exports tslib ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./SearchLayerField".split(" "),function(n,d,c,m,k,h,g,l){return function(d){function a(a){a=
d.call(this,a)||this;a.field=null;a.id=null;a.subLayer=null;return a}c.__extends(a,d);b=a;a.prototype.clone=function(){return new b(k.clone({field:this.field,id:this.id,subLayer:this.subLayer}))};var b;c.__decorate([h.property({type:l,json:{write:{enabled:!0,isRequired:!0}}})],a.prototype,"field",void 0);c.__decorate([h.property({type:String,json:{write:{enabled:!0,isRequired:!0}}})],a.prototype,"id",void 0);c.__decorate([h.property({type:g.Integer,json:{write:!0}})],a.prototype,"subLayer",void 0);
return a=b=c.__decorate([h.subclass("esri.webdoc.applicationProperties.SearchLayer")],a)}(m.JSONSupport)})},"esri/webdoc/applicationProperties/SearchLayerField":function(){define("require exports tslib ../../core/JSONSupport ../../core/accessorSupport/decorators ../../layers/support/fieldType".split(" "),function(n,d,c,m,k,h){return function(d){function g(a){a=d.call(this,a)||this;a.exactMatch=!1;a.name=null;a.type=null;return a}c.__extends(g,d);m=g;g.prototype.clone=function(){return new m({exactMatch:this.exactMatch,
type:this.type,name:this.name})};var m;c.__decorate([k.property({type:Boolean,json:{write:!0}})],g.prototype,"exactMatch",void 0);c.__decorate([k.property({type:String,json:{write:!0}})],g.prototype,"name",void 0);c.__decorate([k.enumeration(h.kebabDict)],g.prototype,"type",void 0);return g=m=c.__decorate([k.subclass("esri.webdoc.applicationProperties.SearchLayerField")],g)}(m.JSONSupport)})},"esri/webscene/Environment":function(){define("require exports tslib ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),
function(n,d,c,m,k,h,g,l){var r=function(a,b,c){return{enabled:!c||!c.isPresentation}};return function(a){function b(b){b=a.call(this,b)||this;b.lighting=new g;b.background=null;b.atmosphereEnabled=!0;b.starsEnabled=!0;return b}c.__extends(b,a);e=b;b.prototype.clone=function(){return new e(this.cloneConstructProperties())};b.prototype.cloneConstructProperties=function(){return{lighting:g.prototype.clone.call(this.lighting),background:k.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,
starsEnabled:this.starsEnabled}};var e;c.__decorate([h.property({type:g,json:{write:!0}})],b.prototype,"lighting",void 0);c.__decorate([h.property(l.backgroundProperty)],b.prototype,"background",void 0);c.__decorate([h.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:r}}})],b.prototype,"atmosphereEnabled",void 0);c.__decorate([h.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:r}}})],b.prototype,"starsEnabled",void 0);return b=e=c.__decorate([h.subclass("esri.webscene.Environment")],
b)}(m.JSONSupport)})},"esri/webscene/Lighting":function(){define(["require","exports","tslib","../core/JSONSupport","../core/accessorSupport/decorators"],function(n,d,c,m,k){return function(d){function g(c){c=d.call(this,c)||this;c.date=null;c.directShadowsEnabled=!1;c.displayUTCOffset=null;return c}c.__extends(g,d);h=g;g.prototype.readDate=function(c,a){return null!=a.datetime&&new Date(a.datetime)||null};g.prototype.writeDate=function(c,a,b){a[b]=c.getTime()};g.prototype.readDirectShadowsEnabled=
function(c,a){return!!a.directShadows};g.prototype.writedirectShadowsEnabled=function(c,a,b){c&&(a[b]=c)};g.prototype.writeDisplayUTCOffset=function(c,a){null!=c&&(a.displayUTCOffset=c)};g.prototype.clone=function(){return new h(this.cloneConstructProperties())};g.prototype.cloneConstructProperties=function(){var c={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(c.date=new Date(this.date.getTime()));return c};
var h;c.__decorate([k.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],g.prototype,"date",void 0);c.__decorate([k.reader("date",["datetime"])],g.prototype,"readDate",null);c.__decorate([k.writer("date")],g.prototype,"writeDate",null);c.__decorate([k.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],g.prototype,"directShadowsEnabled",void 0);c.__decorate([k.reader("directShadowsEnabled",["directShadows"])],g.prototype,"readDirectShadowsEnabled",null);c.__decorate([k.writer("directShadowsEnabled")],
g.prototype,"writedirectShadowsEnabled",null);c.__decorate([k.property({type:Number,json:{write:!0}})],g.prototype,"displayUTCOffset",void 0);c.__decorate([k.writer("displayUTCOffset")],g.prototype,"writeDisplayUTCOffset",null);return g=h=c.__decorate([k.subclass("esri.webscene.Lighting")],g)}(m.JSONSupport)})},"esri/webscene/background/utils":function(){define(["require","exports","./Background","./ColorBackground"],function(n,d,c,m){Object.defineProperty(d,"__esModule",{value:!0});n={base:c,key:"type",
typeMap:{color:m}};d.backgroundProperty={types:n,json:{read:function(c){return function(d,g,k){if(!d)return d;for(var h in c.typeMap)if(d.type===h)return g=new c.typeMap[h],g.read(d,k),g}}(n),write:{overridePolicy:function(c,d,g){return{enabled:!g||!g.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define("require exports tslib ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(n,d,c,m,k,h){var g=m.strict()({color:"color"});
return function(d){function k(a){return d.call(this,a)||this}c.__extends(k,d);k.prototype.normalizeCtorArgs=function(a){a&&a.type&&(a=c.__assign({},a),delete a.type);return a};k.prototype.clone=function(){};c.__decorate([h.property({type:g.apiValues,readOnly:!0,json:{type:g.jsonValues,read:!1,write:g.write}})],k.prototype,"type",void 0);return k=c.__decorate([h.subclass("esri.webscene.background.Background")],k)}(k.JSONSupport)})},"esri/webscene/background/ColorBackground":function(){define("require exports tslib ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),
function(n,d,c,m,k,h,g){var l=c.__assign(c.__assign({},h.colorAndTransparencyProperty),{nonNullable:!0});return function(d){function a(a){a=d.call(this,a)||this;a.type="color";a.color=new m([0,0,0,1]);return a}c.__extends(a,d);b=a;a.prototype.clone=function(){return new b(this.cloneProperties())};a.prototype.cloneProperties=function(){return{color:this.color.clone()}};var b;c.__decorate([k.enumeration({color:"color"})],a.prototype,"type",void 0);c.__decorate([k.property(l)],a.prototype,"color",void 0);
return a=b=c.__decorate([k.subclass("esri.webscene.background.ColorBackground")],a)}(g)})},"esri/webscene/InitialViewProperties":function(){define("require exports tslib ../Viewpoint ../core/Accessor ../core/accessorSupport/decorators ../geometry/SpatialReference ./Environment".split(" "),function(n,d,c,m,k,h,g,l){return function(d){function a(a){a=d.call(this,a)||this;a.environment=new l;a.spatialReference=null;a.viewpoint=null;return a}c.__extends(a,d);b=a;Object.defineProperty(a.prototype,"viewingMode",
{set:function(a){this._set("viewingMode",a)},enumerable:!0,configurable:!0});a.prototype.clone=function(){return new b({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})};var b;c.__decorate([h.property({type:l,json:{write:{isRequired:!0}}})],a.prototype,"environment",void 0);c.__decorate([h.property({type:g})],a.prototype,"spatialReference",void 0);c.__decorate([h.property({type:["local",
"global"]})],a.prototype,"viewingMode",null);c.__decorate([h.property({type:m,json:{write:{isRequired:!0}}})],a.prototype,"viewpoint",void 0);return a=b=c.__decorate([h.subclass("esri.webscene.InitialViewProperties")],a)}(k)})},"esri/webscene/Presentation":function(){define("require exports tslib ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/accessorSupport/decorators ./Slide".split(" "),function(n,d,c,m,k,h,g,l){var r=m.ofType(l);return function(a){function b(b){b=a.call(this,
b)||this;b.slides=new r;return b}c.__extends(b,a);b.prototype.destroy=function(){this.slides.forEach(function(a){return a.destroy()});this.slides.removeAll()};Object.defineProperty(b.prototype,"slides",{set:function(a){a&&(a=a.filter(function(a){return!!a.viewpoint}));this._set("slides",k.referenceSetter(a,this._get("slides"),r))},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new this.constructor({slides:this.slides.clone()})};c.__decorate([g.property({type:r,nonNullable:!0,
json:{write:!0}}),g.cast(k.castForReferenceSetter)],b.prototype,"slides",null);return b=c.__decorate([g.subclass("esri.webscene.Presentation")],b)}(h.JSONSupport)})},"esri/webscene/Slide":function(){define("require exports tslib ../Basemap ../Viewpoint ../core/asyncUtils ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/Logger ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/libs/gl-matrix-2/vec3 ../core/libs/gl-matrix-2/vec3f64 ../layers/Layer ../support/basemapUtils ../views/3d/support/mathUtils ../webdoc/support/Thumbnail ./Environment ./Lighting ./support/Description ./support/SlideGround ./support/SlideVisibleLayer ./support/Title".split(" "),
function(n,d,c,m,k,h,g,l,r,a,b,e,f,u,I,R,q,x,p,W,G,K,D,F,C){function w(a){if("building-scene"===a.type||"map-image"===a.type)return a.allSublayers.toArray()}function H(a){if(a=w(a))return a.filter(function(a){return a.visible}).map(function(a){return a.id})}function A(a,b){a=b-a;a>Q&&(a-=O);a<-Q&&(a+=O);return a}var B=0,y=g.ofType(F.default),z=a.getLogger("esri.webscene.Slide"),O=86400,Q=43200;return function(a){function d(b){b=a.call(this,b)||this;b._applyToController=null;b.id=Date.now().toString(16)+
"-slide-"+B++;b.title=new C.default;b.description=new K.default;b.thumbnail=new p.default;b.viewpoint=null;b.basemap=null;b.ground=null;b.environment=new W;b.visibleLayers=new y;return b}c.__extends(d,a);d.prototype.destroy=function(){this.visibleLayers.removeAll();this.basemap=null;this.thumbnail&&this.thumbnail.destroy();this.thumbnail=this.title=this.description=null};d.prototype.castTitle=function(a){return"string"===typeof a?new C.default({text:a}):f.ensureType(C.default,a)};d.prototype.castDescription=
function(a){return"string"===typeof a?new K.default({text:a}):f.ensureType(K.default,a)};d.prototype.castThumbnail=function(a){return"string"===typeof a?new p.default({url:a}):f.ensureType(p.default,a)};d.prototype.castBasemap=function(a){return q.ensureType(a)};Object.defineProperty(d.prototype,"visibleLayers",{set:function(a){this._set("visibleLayers",l.referenceSetter(a,this._get("visibleLayers"),y))},enumerable:!0,configurable:!0});d.prototype.castVisibleLayers=function(a){return a&&"function"===
typeof a.map?a.map(function(a){if("string"===typeof a)return{id:a};if(a instanceof R){var b=H(a);return{id:a.id,sublayerIds:b}}if(a.id)return{id:a.id,sublayerIds:a.sublayerIds};z.warn('Invalid visible layer, expected { id }, Layer or "id"');return a}):null};d.prototype.clone=function(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,
basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null})};d.prototype._updateVisibleLayersFrom=function(a){var c=this,e=[];return b.eachAlways(this._allLayers(a.map).map(function(b){return a.whenLayerView(b).then(function(a){if(a.visible){var c=H(b);e.push(new F.default({id:a.layer.id,sublayerIds:c}))}})}).toArray()).then(function(){c.visibleLayers.removeAll();
c.visibleLayers.addMany(e)})};d.prototype.updateFrom=function(a,b){var e=this;b={screenshot:c.__assign({format:"jpeg",quality:80,width:120,height:75,disableSlice:!0},b&&b.screenshot)};return a.when(function(){e.viewpoint=a.viewpoint.clone();e.environment.lighting=G.prototype.clone.apply(a.environment.lighting);e.basemap=a.map.basemap&&a.map.basemap.clone()||null;e.ground=a.map.ground?D.default.fromGround(a.map.ground):null;return e._updateVisibleLayersFrom(a)}).then(function(){return a.takeScreenshot(b.screenshot)}).then(function(a){e.thumbnail=
new p.default({url:a.dataUrl});return e})};d.prototype.applyTo=function(a,e){return c.__awaiter(this,void 0,void 0,function(){var d,f,g;return c.__generator(this,function(h){this._applyToController&&this._applyToController.abort();this._applyToController=d=b.createAbortController();b.onAbortOrThrow(e,function(){return d.abort()});f=c.__assign(c.__assign({animate:!0},e),{signal:this._applyToController.signal});g=b.createDeferred();this._applyTo(a,f,d).then(g.resolve,g.reject);return[2,g.promise]})})};
d.prototype._applyTo=function(a,b,e){return c.__awaiter(this,void 0,void 0,function(){var d,f=this;return c.__generator(this,function(g){switch(g.label){case 0:return[4,h.result(function(){return c.__awaiter(f,void 0,void 0,function(){return c.__generator(this,function(c){switch(c.label){case 0:return[4,this._applyBasemap(a,b)];case 1:return c.sent(),this._applyLayerVisibility(a),this._applyGround(a),[4,this._applyViewpoint(a,b)];case 2:return c.sent(),[2]}})})}())];case 1:d=g.sent();this._applyToController===
e&&(this._applyToController=null);if(!1===d.ok)throw d.error;return[2,this]}})})};d.prototype._applyBasemap=function(a,e){return c.__awaiter(this,void 0,void 0,function(){var d;return c.__generator(this,function(c){switch(c.label){case 0:if(!this.basemap)return[3,5];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.basemap.load(e)];case 2:return c.sent(),[3,4];case 3:d=c.sent();if(b.isAbortError(d))throw d;return[3,4];case 4:a.map.basemap=q.clonePreservingTiledLayers(this.basemap,a.map.basemap),
c.label=5;case 5:return[2]}})})};d.prototype._applyGround=function(a){this.ground&&(a.map.ground=this.ground.cloneAndApplyTo(a.map.ground))};d.prototype._allLayers=function(a){var b=new g;this._collectLayers(a,b);this._collectLayers(a.ground,b);return b};d.prototype._collectLayers=function(a,b){var c=this;a.layers.forEach(function(a){b.add(a);a.layers&&c._collectLayers(a,b)})};d.prototype._applyLayerVisibility=function(a){var b=this;this.visibleLayers&&this._allLayers(a.map).forEach(function(a){var c=
b.visibleLayers.find(function(b){return b.id===a.id});a.visible=null!=c;var e=c&&c.sublayerIds,c=w(a);e&&c&&c.forEach(function(a){return a.visible=0<=e.indexOf(a.id)})})};d.prototype._applyViewpoint=function(a,b){return c.__awaiter(this,void 0,void 0,function(){return c.__generator(this,function(c){switch(c.label){case 0:if(!this.viewpoint||b.ignoreViewpoint)return[3,5];this.viewpoint.camera.fov=a.camera.fov;return b.animate&&this.get("environment.lighting.date")?[4,this._animateToLighting(a,b)]:
[3,2];case 1:return c.sent(),[2];case 2:if(!b.animate)return[3,4];a.environment.updateLighting(this.environment.lighting.clone());return[4,a.goTo(this.viewpoint,b)];case 3:c.sent(),c.label=4;case 4:a.viewpoint=this.viewpoint,c.label=5;case 5:return a.environment.updateLighting(this.environment.lighting.clone()),[2]}})})};d.prototype._animateToLighting=function(a,b){return c.__awaiter(this,void 0,void 0,function(){var e,d,f,g=this;return c.__generator(this,function(c){e=null;"global"===a.viewingMode&&
(e=this._animateLightingWithCamera(a));a.environment.lighting.cameraTrackingEnabled=!1;a.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled;null!=this.environment.lighting.displayUTCOffset&&(a.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);d=a.goTo(this.viewpoint,b);f=function(){e&&e.remove();a.environment.lighting.cameraTrackingEnabled=!0};return[2,d.then(function(){a.environment.updateLighting(g.environment.lighting.clone());
f()},function(a){f();throw a;})]})})};d.prototype._getTime=function(a){var b=a.getTime();a=3600*a.getUTCHours()+60*a.getUTCMinutes()+a.getUTCSeconds();return[b,a]};d.prototype._setTime=function(a,b,c){a.setTime(b);a.setUTCHours(c/3600);a.setUTCMinutes(c%3600/60);a.setUTCSeconds(c%3600%60);return a};d.prototype._animateLightingWithCamera=function(a){var b=this,c=this._getTime(new Date(a.environment.lighting.date.toString())),e=c[0],d=c[1],c=this._getTime(this.environment.lighting.date),f=c[0],g=A(d,
c[1]),h=a.renderCoordsHelper,t=I.vec3f64.create();h.toRenderCoords(a.camera.position,t);var k=I.vec3f64.create();h.toRenderCoords(this.viewpoint.camera.position,k);var l=I.vec3f64.create(),m=new Date;return a.watch("camera",function(c){h.toRenderCoords(c.position,l);var L=u.vec3.squaredDistance(t,l),r=u.vec3.squaredDistance(k,l);c=0;0!==L+r&&(c=L/(L+r));L=e+(f-e)*c;c=x.moduloPositive(d+g*c,O);a.environment.lighting.date=b._setTime(m,L,c)})};d.createFrom=function(a,b){return(new this).updateFrom(a,
b)};c.__decorate([e.property({type:String,json:{write:{isRequired:!0}}})],d.prototype,"id",void 0);c.__decorate([e.property({type:C.default,json:{default:function(){return new C.default({text:""})},write:{isRequired:!0}}})],d.prototype,"title",void 0);c.__decorate([e.cast("title")],d.prototype,"castTitle",null);c.__decorate([e.property({type:K.default,json:{write:{overridePolicy:function(a){return{enabled:!(!a||!a.text)}}}}})],d.prototype,"description",void 0);c.__decorate([e.cast("description")],
d.prototype,"castDescription",null);c.__decorate([e.property({type:p.default,json:{default:function(){return new p.default({url:""})},write:{isRequired:!0}}})],d.prototype,"thumbnail",void 0);c.__decorate([e.cast("thumbnail")],d.prototype,"castThumbnail",null);c.__decorate([e.property({type:k,nonNullable:!0,json:{write:{isRequired:!0}}})],d.prototype,"viewpoint",void 0);c.__decorate([e.property({type:m,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],d.prototype,"basemap",void 0);c.__decorate([e.cast("basemap")],
d.prototype,"castBasemap",null);c.__decorate([e.property({type:D.default,json:{write:!0}})],d.prototype,"ground",void 0);c.__decorate([e.property({type:y,json:{write:{isRequired:!0}}})],d.prototype,"visibleLayers",null);c.__decorate([e.cast("visibleLayers")],d.prototype,"castVisibleLayers",null);c.__decorate([e.property({type:W,json:{write:!0}})],d.prototype,"environment",void 0);return d=c.__decorate([e.subclass("esri.webscene.Slide")],d)}(r.JSONSupport)})},"esri/webdoc/support/Thumbnail":function(){define(["require",
"exports","tslib","../../core/JSONSupport","../../core/accessorSupport/decorators"],function(n,d,c,m,k){Object.defineProperty(d,"__esModule",{value:!0});n=function(d){function g(){var c=null!==d&&d.apply(this,arguments)||this;c.url="";return c}c.__extends(g,d);h=g;g.prototype.destroy=function(){this.url=""};g.prototype.clone=function(){return new h({url:this.url})};var h;c.__decorate([k.property({type:String,json:{write:{isRequired:!0}}})],g.prototype,"url",void 0);return g=h=c.__decorate([k.subclass("esri.webdoc.support.Thumbnail")],
g)}(m.JSONSupport);d.default=n})},"esri/webscene/support/Description":function(){define(["require","exports","tslib","../../core/JSONSupport","../../core/accessorSupport/decorators"],function(n,d,c,m,k){Object.defineProperty(d,"__esModule",{value:!0});n=function(d){function g(){var c=null!==d&&d.apply(this,arguments)||this;c.text="";return c}c.__extends(g,d);h=g;g.prototype.clone=function(){return new h({text:this.text})};var h;c.__decorate([k.property({type:String,json:{write:!0}})],g.prototype,
"text",void 0);return g=h=c.__decorate([k.subclass("esri.webscene.support.Description")],g)}(m.JSONSupport);d.default=n})},"esri/webscene/support/SlideGround":function(){define("require exports tslib ../../Ground ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../webdoc/support/opacityUtils".split(" "),function(n,d,c,m,k,h,g,l){Object.defineProperty(d,"__esModule",{value:!0});n=function(d){function a(){var a=null!==d&&d.apply(this,arguments)||
this;a.opacity=null;return a}c.__extends(a,d);b=a;a.prototype.clone=function(){return new b({opacity:this.opacity})};a.prototype.cloneAndApplyTo=function(a){if(null==this.opacity)return a;a=null!=a?a.clone():new m;a.opacity=this.opacity;return a};a.fromGround=function(a){return new b({opacity:a.opacity})};var b;c.__decorate([h.property({type:Number,json:{type:g.Integer,read:{reader:l.transparencyToOpacity,source:"transparency"},write:{writer:function(a,b){b.transparency=l.opacityToTransparency(a)},
target:"transparency"}}})],a.prototype,"opacity",void 0);return a=b=c.__decorate([h.subclass("esri.webscene.support.SlideGround")],a)}(k.JSONSupport);d.default=n})},"esri/webscene/support/SlideVisibleLayer":function(){define("require exports tslib ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),function(n,d,c,m,k,h,g){Object.defineProperty(d,"__esModule",{value:!0});n=function(d){function l(a){a=d.call(this,a)||this;a.id=
"";a.sublayerIds=null;return a}c.__extends(l,d);a=l;l.prototype.clone=function(){return new a({id:this.id,sublayerIds:k.clone(this.sublayerIds)})};var a;c.__decorate([h.property({type:String,json:{write:!0}})],l.prototype,"id",void 0);c.__decorate([h.property({type:[g.Integer],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],l.prototype,"sublayerIds",void 0);return l=a=c.__decorate([h.subclass("esri.webscene.support.SlideVisibleLayer")],l)}(m.JSONSupport);d.SlideVisibleLayer=n;d.default=
n})},"esri/webscene/support/Title":function(){define(["require","exports","tslib","../../core/JSONSupport","../../core/accessorSupport/decorators"],function(n,d,c,m,k){Object.defineProperty(d,"__esModule",{value:!0});n=function(d){function g(){var c=null!==d&&d.apply(this,arguments)||this;c.text="";return c}c.__extends(g,d);h=g;g.prototype.clone=function(){return new h({text:this.text})};var h;c.__decorate([k.property({type:String,json:{write:{isRequired:!0}}})],g.prototype,"text",void 0);return g=
h=c.__decorate([k.subclass("esri.webscene.support.Title")],g)}(m.JSONSupport);d.default=n})},"esri/webscene/TransportationNetwork":function(){define(["require","exports","tslib","../core/JSONSupport","../core/accessorSupport/decorators"],function(n,d,c,m,k){return function(d){function g(c){return d.call(this,c)||this}c.__extends(g,d);h=g;g.prototype.clone=function(){return new h({name:this.name,path:this.path,title:this.title})};var h;c.__decorate([k.property({json:{write:!0}})],g.prototype,"name",
void 0);c.__decorate([k.property({json:{write:!0}})],g.prototype,"path",void 0);c.__decorate([k.property({json:{write:!0}})],g.prototype,"title",void 0);return g=h=c.__decorate([k.subclass("esri.webscene.TransportationNetwork")],g)}(m.JSONSupport)})},"esri/webscene/Version":function(){define(["require","exports","tslib","../core/Version"],function(n,d,c,m){Object.defineProperty(d,"__esModule",{value:!0});n=function(d){function h(c,h){return d.call(this,c,h,"webscene")||this}c.__extends(h,d);Object.defineProperty(h.prototype,
"supportsGround",{get:function(){return this.since(1,8)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"supportsVisibleElevationLayersInSlides",{get:function(){return this.lessThan(1,8)},enumerable:!0,configurable:!0});return h}(m.Version);d.Version=n;d.default=n})},"esri/core/Version":function(){define(["require","exports","./Error"],function(n,d,c){Object.defineProperty(d,"__esModule",{value:!0});n=function(){function d(c,d,g){void 0===g&&(g="");this.major=c;this.minor=d;this._context=
g}d.prototype.lessThan=function(c,d){return this.major<c||c===this.major&&this.minor<d};d.prototype.since=function(c,d){return!this.lessThan(c,d)};d.prototype.validate=function(d){if(this.major!==d.major)throw new c((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:d});};d.prototype.clone=function(){return new d(this.major,this.minor,this._context)};d.parse=
function(k,h){void 0===h&&(h="");var g=k.split("."),l=g[0],g=g[1],m=/^\s*\d+\s*$/;if(!l||!l.match||!l.match(m))throw new c((h&&h+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:k});if(!g||!g.match||!g.match(m))throw new c((h&&h+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:k});k=parseInt(l,10);l=parseInt(g,10);return new d(k,l,h)};return d}();d.Version=n})},"*noref":1}});
define("require exports tslib ./kernel ./Map ./Viewpoint ./core/Collection ./core/Error ./core/Handles ./core/has ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/MultiOriginJSONSupport ./core/Promise ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators ./core/accessorSupport/originUtils ./core/accessorSupport/read ./geometry/Extent ./geometry/HeightModelInfo ./geometry/SpatialReference ./geometry/support/heightModelInfoUtils ./geometry/support/jsonUtils ./portal/Portal ./portal/PortalItem ./support/webSceneUtils ./views/3d/support/projectionUtils ./views/support/spatialReferenceSupport ./webdoc/support/saveUtils ./webdoc/support/thumbnailUtils ./webscene/ApplicationProperties ./webscene/Environment ./webscene/InitialViewProperties ./webscene/Presentation ./webscene/TransportationNetwork ./webscene/Version @dojo/framework/shim/Promise".split(" "),function(n,
d,c,m,k,h,g,l,r,a,b,e,f,u,I,R,q,x,p,W,G,K,D,F,C,w,H,A,B,y,z,O,Q,S,T,P,J,M,E){var U=u.getLogger("esri.WebScene"),V=new E.default(1,20);return function(a){function d(b){var d=a.call(this,b)||this;d._handles=new r;d.applicationProperties=null;d.clippingArea=null;d.clippingEnabled=!1;d.heightModelInfo=null;d.sourceVersion=null;d.supportsHeightModelInfo=!0;d.transportationNetworks=null;d.presentation=new J;d.initialViewProperties=new P;d.portalItem=null;d.resourceInfo=null;d.debouncedSaveOperations=q.debounce(function(a,
b,e){return c.__awaiter(d,void 0,void 0,function(){return c.__generator(this,function(c){switch(a){case 0:return[2,this._saveImpl(b)];case 1:return[2,this._saveAsImpl(e,b)]}return[2]})})});d.resourceReferences={portalItem:null,paths:[]};d.authoringApp=null;d.authoringAppVersion=null;d._isAuthoringAppSetByUser=!1;d._isAuthoringAppVersionSetByUser=!1;return d}c.__extends(d,a);d.prototype.initialize=function(){var a=this;this.when().catch(function(a){U.error("#load()","Failed to load web scene",a)});
if(this.resourceInfo){var b=void 0;try{b=this._validateJSON(this.resourceInfo)}catch(ea){this.addResolvingPromise(q.reject(ea));return}this.read(b);this.addResolvingPromise(this._validateSpatialReference());this.addResolvingPromise(this._validateHeightModelInfo())}this._handles.add(this.allLayers.on("change",function(){return a._scheduleLayersIdGC()}))};d.prototype.destroy=function(){this._unscheduleLayersIdGC();this._handles.destroy();this.presentation&&this.presentation.destroy()};d.prototype.writeClippingArea=
function(a,b){b.clippingArea||(b.clippingArea={});b.clippingArea.geometry=a.toJSON()};d.prototype.readClippingEnabled=function(a,b){return b.clippingArea?!!b.clippingArea.clip:!1};d.prototype.writeClippingEnabled=function(a,b){this.clippingArea&&(b.clippingArea||(b.clippingArea={}),b.clippingArea.clip=a)};d.prototype.writeLayers=function(a,b,d,e){var f=this,g=c.__assign(c.__assign({},e),{layerContainerType:"operational-layers"});a=a.map(function(a){return f.verifyWriteLayer(a,e)?a.write(null,g):null}).filter(function(a){return!!a});
b[d]=a.toArray()};d.prototype.verifyWriteLayer=function(a,b){return"write"in a?!0:(b&&b.messages&&b.messages.push(new l("layer:unsupported","Layers ("+a.title+", "+a.id+") of type '"+a.declaredClass+"' cannot be persisted in web scenes",{layer:a})),!1)};d.prototype.readSourceVersion=function(a,b){a=b.version.split(".");b=a[1];return new E.default(parseInt(a[0],10),parseInt(b,10))};d.prototype.writeSourceVersion=function(a,b,c){b[c]=V.major+"."+V.minor};Object.defineProperty(d.prototype,"thumbnailUrl",
{get:function(){return this.portalItem&&this.portalItem.thumbnailUrl||null},set:function(a){a?this._override("thumbnailUrl",a):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"authoringApp",{set:function(a){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",a)},enumerable:!0,configurable:!0});d.prototype.writeAuthoringApp=function(a,b){b.authoringApp=a&&this._isAuthoringAppSetByUser?a:"ArcGIS API for JavaScript"};
Object.defineProperty(d.prototype,"authoringAppVersion",{set:function(a){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",a)},enumerable:!0,configurable:!0});d.prototype.writeAuthoringAppVersion=function(a,b){b.authoringAppVersion=a&&this._isAuthoringAppVersionSetByUser?a:m.version};d.prototype.writeGround=function(a,b,c,d){b[c]=a?a.write(null,d):{transparency:0,layers:[]}};d.prototype.readInitialViewProperties=function(a,b){a={};b.initialState&&b.initialState.environment&&
(a.environment=T.fromJSON(b.initialState.environment));a.spatialReference=b.spatialReference?F.fromJSON(b.spatialReference):F.WebMercator;a.viewingMode=b.viewingMode||"global";b.initialState&&b.initialState.viewpoint&&(a.viewpoint=h.fromJSON(b.initialState.viewpoint));return new P(a)};d.prototype.writeInitialViewProperties=function(a,b,c,d){a&&(c={},a.environment&&(c.environment=a.environment.write({},d)),a.viewpoint&&(c.viewpoint=a.viewpoint.write({},d)),0!==Object.keys(c).length&&(b.initialState=
c),b.spatialReference=a.spatialReference?a.spatialReference.write({},d):F.WebMercator.toJSON(),b.viewingMode=null!=a.viewingMode?a.viewingMode:"global")};d.prototype.load=function(a){this.addResolvingPromise(this._loadFromSource());return q.resolve(this)};d.prototype.loadAll=function(){var a=this;return f.default(this,function(b){var c=a.presentation&&a.presentation.slides;b(a.ground,a.basemap,a.layers,c&&c.map(function(a){return a.basemap}))})};d.prototype.read=function(b,d){var e=this;d=c.__assign(c.__assign({},
d),{origin:"web-scene"});var f=this._isAuthoringAppVersionSetByUser,g=this._isAuthoringAppSetByUser;G.readLoadable(this,b,function(c){return a.prototype.read.call(e,b,c)},d);g||(this._isAuthoringAppSetByUser=!1);f||(this._isAuthoringAppVersionSetByUser=!1);if(b.baseMap&&Array.isArray(b.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){d=b.baseMap.elevationLayers.map(function(a){return{id:a.id}});var h=this.presentation.slides,k=function(a,b){return a.visibleLayers.some(function(a){return a.id===
b})},t=d.filter(function(a){return!h.some(function(b){return k(b,a.id)})});h.forEach(function(a){a.visibleLayers.addMany(t)})}};d.prototype._writeBasemapElevationLayers=function(a){var c=a.ground&&a.ground.layers;!a.baseMap&&c&&c.length&&(a.baseMap={title:"Basemap",baseMapLayers:[]});a.baseMap&&(a.baseMap.elevationLayers=b.clone(c))};d.prototype.write=function(b,d){if("loaded"!==this.loadStatus)throw b=new l("webscene:not-loaded","Web scene must be loaded before it can be serialized"),U.error("#toJSON()",
"Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),b;this._runLayersIdGC();d=c.__assign(c.__assign({},d),{origin:"web-scene"});b=a.prototype.write.call(this,b,d);this._writeBasemapElevationLayers(b);return b};d.prototype.save=function(a){return c.__awaiter(this,void 0,void 0,function(){return c.__generator(this,function(b){return[2,this.debouncedSaveOperations(0,a)]})})};d.prototype._saveImpl=function(a){return c.__awaiter(this,void 0,void 0,function(){var b,d,
e;return c.__generator(this,function(c){switch(c.label){case 0:if(this.portalItem)return[3,2];U.error("save(): requires the .portalItem property to be set");return[4,q.reject(new l("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene"))];case 1:c.sent(),c.label=2;case 2:return"Web Scene"===this.portalItem.type?[3,4]:[4,q.reject(new l("webscene:portal-item-wrong-type",'Portal item needs to have type "Web Scene"'))];case 3:c.sent(),c.label=4;case 4:return b=this._updateFromPromise,
[4,this._ensureLoadBeforeSave()];case 5:return c.sent(),d=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl&&x.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||H.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),e=this.write(null,d),[4,q.all(d.resources.pendingOperations)];case 6:return c.sent(),[4,this._verifySave(e,d,a)];case 7:return c.sent(),
this._updateTypeKeywords(this.portalItem),[4,this.portalItem.update({data:e})];case 8:return c.sent(),[4,O.saveResources(this.resourceReferences,d,null)];case 9:return c.sent(),W.updateOrigins(d),b?[4,b]:[3,11];case 10:c.sent(),c.label=11;case 11:return[4,this._saveThumbnail()];case 12:return c.sent(),[2,this.portalItem]}})})};d.prototype.saveAs=function(a,b){return c.__awaiter(this,void 0,void 0,function(){return c.__generator(this,function(c){return[2,this.debouncedSaveOperations(1,b,a)]})})};d.prototype._saveAsImpl=
function(a,b){return c.__awaiter(this,void 0,void 0,function(){var d,e,f,g,h,k;return c.__generator(this,function(c){switch(c.label){case 0:if(d=A.from(a))return[3,2];U.error("saveAs(portalItem): requires a portal item parameter");return[4,q.reject(new l("webscene:portal-item-required","saveAs requires a portal item to save to"))];case 1:c.sent(),c.label=2;case 2:return d.id&&(d=d.clone(),d.id=null),e=d.portal||H.getDefault(),[4,this._ensureLoadBeforeSave()];case 3:return c.sent(),d.type="Web Scene",
d.portal=e,f=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:e,portalItem:d,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),g=this.write(null,f),[4,q.all(f.resources.pendingOperations)];case 4:return c.sent(),[4,this._verifySaveAs(g,f,b)];case 5:return c.sent(),h=this.thumbnailUrl,k=!this._isOverridden("thumbnailUrl"),this._updateTypeKeywords(d),[4,e._signIn()];case 6:return c.sent(),[4,e.user.addItem({item:d,
folder:b&&b.folder,data:g})];case 7:return c.sent(),[4,O.saveResources(this.resourceReferences,f,null)];case 8:return c.sent(),this.portalItem=d,I.MultiOriginJSONSupport.prototype.read.call(this,{version:g.version,authoringApp:g.authoringApp,authoringAppVersion:g.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:d.itemUrl&&x.urlToObject(d.itemUrl)}),W.updateOrigins(f),h&&(this.thumbnailUrl=k?x.addQueryParameter(h,"w","8192"):h),f.portalItem=d,[4,this._saveThumbnail()];case 9:return c.sent(),
[2,d]}})})};d.prototype._saveThumbnail=function(){return c.__awaiter(this,void 0,void 0,function(){return c.__generator(this,function(a){switch(a.label){case 0:return this._isOverridden("thumbnailUrl")?[4,this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl})]:[3,2];case 1:a.sent(),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"),a.label=2;case 2:return[2]}})})};d.prototype._verifySave=function(a,b,c,d){void 0===d&&(d=!1);var e=b.messages.filter(function(a){return"error"===
a.type}).map(function(a){return new l(a.name,a.message,a.details)});b.blockedRelativeUrls&&(e=e.concat(b.blockedRelativeUrls.map(function(a){return new l("url:unsupported","Relative url '"+a+"' is not supported in Web Scene")})));c&&c.ignoreUnsupported&&(e=e.filter(function(a){return"layer:unsupported"!==a.name&&"symbol:unsupported"!==a.name&&"symbol-layer:unsupported"!==a.name&&"property:unsupported"!==a.name&&"url:unsupported"!==a.name&&"scenemodification:unsupported"!==a.name}));c&&c.strictSchemaValidationEnabled||
(e=e.filter(function(a){return"web-document-write:property-required"!==a.name}));var f=c&&c.strictSchemaValidationEnabled;return(f?(new Promise(function(a,b){n(["./webscene/validator"],a,b)})).then(function(b){b=b.validate(a);if(0<b.length){var c="webscene did not validate:\n"+b.join("\n");U.error((d?"saveAs":"save")+"(): "+c)}return b.map(function(a){return new l("webscene:schema-validation",a)})}).then(function(a){if(f&&0<a.length)throw B.createSchemaValidationError(a.concat(e));return e}):q.resolve(e)).then(function(a){if(0<
a.length)return q.reject(new l("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a}))})};d.prototype._verifySaveAs=function(a,b,c){return this.canSaveAs(b)?q.reject(B.createCopyError()):this._verifySave(a,b,c,!0)};d.prototype.verifySaveAs=function(a){var b=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),c=this.write(null,b);return this._verifySaveAs(c,b,a)};d.prototype.canSaveAs=function(a){a||
(a=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write(null,a));return a.verifyItemRelativeUrls&&0<a.verifyItemRelativeUrls.writtenUrls.length};d.prototype.updateFrom=function(a,b){void 0===b&&(b={});return c.__awaiter(this,void 0,void 0,function(){var d,e;return c.__generator(this,function(c){switch(c.label){case 0:return this._updateFromPromise=d=this._updateFromInternal(a,b),[4,d];case 1:c.sent();if(e=this._updateFromPromise===d)this._updateFromPromise=null;return[2]}})})};
d.prototype._updateFromInternal=function(a,b){void 0===b&&(b={});return c.__awaiter(this,void 0,void 0,function(){return c.__generator(this,function(c){switch(c.label){case 0:return[4,a.whenReady()];case 1:return c.sent(),!b.environmentExcluded&&a.environment&&(this.initialViewProperties.environment=T.prototype.clone.apply(a.environment)),!b.viewpointExcluded&&a.viewpoint&&(this.initialViewProperties.viewpoint=a.viewpoint.clone()),this.initialViewProperties.spatialReference=a.spatialReference.clone(),
this.initialViewProperties.viewingMode=a.viewingMode,a.clippingArea?a.clippingArea!==this.clippingArea&&(this.clippingArea=a.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,a.heightModelInfo&&(this.heightModelInfo=a.heightModelInfo.clone()),a.map===this&&a.allLayerViews.forEach(function(a){a.layer.visible=a.visible}),!1===b.thumbnailExcluded||null==b.thumbnailExcluded&&!b.viewpointExcluded?[4,this._updateFromThumbnail(a,b.thumbnailSize||void 0)]:[3,3];case 2:c.sent(),c.label=
3;case 3:return[2]}})})};d.prototype._updateFromThumbnail=function(a,b){return c.__awaiter(this,void 0,void 0,function(){var d,e;return c.__generator(this,function(c){switch(c.label){case 0:return d=Q.getOptimalThumbnailSize(a,b),[4,a.takeScreenshot({format:"jpg",width:d.width,height:d.height,disableSlice:!0})];case 1:return e=c.sent(),this.thumbnailUrl=e.dataUrl,[2]}})})};d.prototype._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&
this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()};d.prototype._readAndLoadFromJSON=function(a,b){a=this._validateJSON(a);this.read(a,b);return this._loadFromJSON(a,b)};d.prototype._extractOperationalLayers=function(a){var b=this,c=[];if(!this.sourceVersion.supportsGround&&a.baseMap&&Array.isArray(a.baseMap.elevationLayers))for(var d=0,e=a.baseMap.elevationLayers;d<e.length;d++)c.push(e[d]);var f=[],g=function(a){a.layers&&(a.layers=a.layers.filter(g));return"ArcGISTiledElevationServiceLayer"===
a.layerType?(b.sourceVersion.supportsGround||f.push(a),!1):!0};return{operationalLayers:a.operationalLayers?a.operationalLayers.filter(g):[],operationalElevationLayers:f,basemapElevationLayers:c}};d.prototype._loadFromJSON=function(a,b){var d=this,e=new g;return this._validateSpatialReference().then(function(){return d._validateHeightModelInfo()}).then(function(){return new Promise(function(a,b){n(["./portal/support/layersCreator"],a,b)})}).then(function(f){var g=d._extractOperationalLayers(a),h=
g.operationalLayers,k=g.operationalElevationLayers,g=g.basemapElevationLayers,l=[],m={context:c.__assign(c.__assign({},b),{layerContainerType:"operational-layers"})};d.portalItem&&(m.context.portal=d.portalItem.portal||H.getDefault());if(0<g.length){var t=c.__assign(c.__assign({},m),{context:c.__assign(c.__assign({},m.context),{layerContainerType:"ground"})});t.defaultLayerType="ArcGISTiledElevationServiceLayer";l.push(f.populateOperationalLayers(d.ground.layers,g,t))}0<k.length&&(t=c.__assign(c.__assign({},
m),{context:c.__assign(c.__assign({},m.context),{layerContainerType:"ground"})}),t.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(f.populateOperationalLayers(e,k,t)));h&&0<h.length&&l.push(f.populateOperationalLayers(d.layers,h,m));return q.eachAlways(l).then(function(){})}).then(function(){return d._loadObjectsWithLayers()}).then(function(){d.ground.layers.addMany(e)})};d.prototype._ensureLoadBeforeSave=function(){return c.__awaiter(this,void 0,void 0,function(){var a,b,d,e,f;return c.__generator(this,
function(c){switch(c.label){case 0:return[4,this.load()];case 1:return c.sent(),[4,this._loadObjectsWithLayers()];case 2:c.sent();a=[];b=0;for(d=this.allLayers.items;b<d.length;b++)e=d[b],"beforeSave"in e&&"function"===typeof e.beforeSave&&(f=e.beforeSave())&&a.push(f);return[4,q.eachAlways(a)];case 3:return c.sent(),[2]}})})};d.prototype._loadObjectsWithLayers=function(){return c.__awaiter(this,void 0,void 0,function(){var a;return c.__generator(this,function(b){switch(b.label){case 0:return a=[],
this.ground&&a.push(this.ground.load()),this.basemap&&a.push(this.basemap.load()),this.presentation.slides.forEach(function(b){b.basemap&&a.push(b.basemap.load())}),[4,q.eachAlways(a)];case 1:return b.sent(),[2]}})})};d.prototype._loadFromItem=function(a){return c.__awaiter(this,void 0,void 0,function(){var b,d;return c.__generator(this,function(c){switch(c.label){case 0:return[4,a.load().catch(function(a){throw new l("webscene:load-portal-item","Failed to load portal item",{error:a});})];case 1:c.sent();
if("Web Scene"!==a.type)throw new l("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:a.type});return[4,a.fetchData()];case 2:return this.resourceInfo=b=c.sent(),d={origin:"web-scene",url:x.urlToObject(a.itemUrl),portal:a.portal||H.getDefault(),portalItem:a,readResourcePaths:[]},[4,this._readAndLoadFromJSON(b,d)];case 3:return c.sent(),this.resourceReferences={portalItem:a,paths:d.readResourcePaths},[2]}})})};d.prototype._validateSpatialReference=function(){var a=
this.initialViewProperties,b=this._sceneSpatialReference,c;if("local"!==a.viewingMode){if(!z.isSpatialReferenceSupported(b,"global"))return q.reject(new l("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:b,viewingMode:a.viewingMode}));c=function(a){return!a||y.canProject(a,b)}}else{if(!z.isSpatialReferenceSupported(b,"local"))return q.reject(new l("webscene:unsupported-spatial-reference",
"Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:b,viewingMode:a.viewingMode}));c=function(a){return!a||a.equals(b)}}var d=function(a){return a&&(a.camera&&a.camera.position&&a.camera.position.spatialReference||a.targetGeometry&&a.targetGeometry.spatialReference)},e=d(a.viewpoint);return e&&!c(e)?q.reject(new l("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",
{cameraSpatialReference:e,sceneSpatialReference:b,viewingMode:a.viewingMode})):(e=this.presentation.slides.find(function(a){return!c(d(a.viewpoint))}))?(e=d(e.viewpoint),q.reject(new l("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:e,sceneSpatialReference:b,viewingMode:a.viewingMode}))):q.resolve()};d.prototype._validateHeightModelInfo=
function(){var a=C.validateWebSceneError(this.heightModelInfo,this._sceneSpatialReference);return a?q.reject(a):q.resolve()};d.prototype._validateJSON=function(a){var b=E.default.parse(a.version||"","webscene");V.validate(b);a.version=b.major+"."+b.minor;1===b.major&&2>=b.minor&&(a.spatialReference=F.WebMercator.toJSON());return a};d.prototype._updateTypeKeywords=function(a){"local"===this.initialViewProperties.viewingMode?a.typeKeywords?-1===a.typeKeywords.indexOf("ViewingMode-Local")&&a.typeKeywords.push("ViewingMode-Local"):
a.typeKeywords=["ViewingMode-Local"]:"global"===this.initialViewProperties.viewingMode&&a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a){return"ViewingMode-Local"!==a}));a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a,b,c){return c.indexOf(a)===b}))};Object.defineProperty(d.prototype,"_sceneSpatialReference",{get:function(){return this.initialViewProperties.spatialReference||F.WebMercator},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"_verifyItemRelativeRootPath",
{get:function(){return this.portalItem&&this.portalItem.itemUrl?x.urlToObject(this.portalItem.itemUrl).path:null},enumerable:!0,configurable:!0});d.prototype._enableVerifyItemRelativeUrls=function(a){var b=this._verifyItemRelativeRootPath;b&&(a.verifyItemRelativeUrls={rootPath:b,writtenUrls:[]});return a};d.prototype._unscheduleLayersIdGC=function(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)};d.prototype._scheduleLayersIdGC=function(){var a=this;
this._unscheduleLayersIdGC();this._layersIdGCTimeoutId=setTimeout(function(){a._layersIdGCTimeoutId=0;a._runLayersIdGC()},3E3)};d.prototype._runLayersIdGC=function(){var a=this;this._unscheduleLayersIdGC();var b=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search,c=function(b){return!!a.allLayers.find(function(a){return a.id===b})};b&&b.layers&&(b.layers=b.layers.filter(function(a){return c(a.id)}));(b=this.presentation&&this.presentation.slides)&&
b.forEach(function(a){a.visibleLayers&&(a.visibleLayers=a.visibleLayers.filter(function(a){return c(a.id)}))})};d.fromJSON=function(a){if(!a)throw new l("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:a})};d.VERSION=V;c.__decorate([p.property({type:S,json:{write:!0}})],d.prototype,"applicationProperties",void 0);c.__decorate([p.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],d.prototype,"basemap",void 0);c.__decorate([p.property({type:K,
json:{read:{source:"clippingArea.geometry",reader:w.fromJSON},write:{target:"clippingArea.geometry"}}})],d.prototype,"clippingArea",void 0);c.__decorate([p.writer("clippingArea")],d.prototype,"writeClippingArea",null);c.__decorate([p.property({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],d.prototype,"clippingEnabled",void 0);c.__decorate([p.reader("clippingEnabled",["clippingArea"])],d.prototype,"readClippingEnabled",null);c.__decorate([p.writer("clippingEnabled")],d.prototype,"writeClippingEnabled",
null);c.__decorate([p.property({type:D,json:{write:!0}})],d.prototype,"heightModelInfo",void 0);c.__decorate([p.property({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],d.prototype,"layers",void 0);c.__decorate([p.writer("layers")],d.prototype,"writeLayers",null);c.__decorate([p.property({readOnly:!0,type:E.default,json:{type:String,write:{ignoreOrigin:!0,allowNull:!0,target:"version",isRequired:!0}}})],d.prototype,"sourceVersion",void 0);c.__decorate([p.reader("sourceVersion",["version"])],
d.prototype,"readSourceVersion",null);c.__decorate([p.writer("sourceVersion")],d.prototype,"writeSourceVersion",null);c.__decorate([p.property({dependsOn:["portalItem.thumbnailUrl"]})],d.prototype,"thumbnailUrl",null);c.__decorate([p.property({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],d.prototype,"authoringApp",null);c.__decorate([p.writer("authoringApp")],d.prototype,"writeAuthoringApp",null);c.__decorate([p.property({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],d.prototype,
"authoringAppVersion",null);c.__decorate([p.writer("authoringAppVersion")],d.prototype,"writeAuthoringAppVersion",null);c.__decorate([p.property({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],d.prototype,"ground",void 0);c.__decorate([p.writer("ground")],d.prototype,"writeGround",null);c.__decorate([p.property({type:g.ofType(M),json:{write:!0}})],d.prototype,"transportationNetworks",void 0);c.__decorate([p.property({type:J,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:function(a,
b,d,e){a.slides&&0<a.slides.length&&(d=c.__assign(c.__assign({},e),{isPresentation:!0}),b.presentation=a.write(null,d))}}}})],d.prototype,"presentation",void 0);c.__decorate([p.property({type:P,nonNullable:!0,json:{write:{ignoreOrigin:!0},default:function(){return new P({viewingMode:"global",spatialReference:F.WebMercator})}}})],d.prototype,"initialViewProperties",void 0);c.__decorate([p.reader("initialViewProperties",["initialState.environment","spatialReference","viewingMode","initialState.viewpoint"])],
d.prototype,"readInitialViewProperties",null);c.__decorate([p.writer("initialViewProperties",{"initialState.environment":{type:T},spatialReference:{type:F},viewingMode:{type:String},"initialState.viewpoint":{type:h}})],d.prototype,"writeInitialViewProperties",null);c.__decorate([p.property({type:A})],d.prototype,"portalItem",void 0);c.__decorate([p.property()],d.prototype,"resourceInfo",void 0);return d=c.__decorate([p.subclass("esri.WebScene")],d)}(e.LoadableMixin(R.EsriPromiseMixin(I.MultiOriginJSONMixin(k))))});