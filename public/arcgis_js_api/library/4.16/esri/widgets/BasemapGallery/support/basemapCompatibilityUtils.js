// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/compilerUtils ../../../core/Error ../../../core/promiseUtils ../../../layers/support/layerUtils ../../../views/3d/terrain/terrainUtils ../../../views/3d/terrain/TilingScheme ../../../views/support/spatialReferenceSupport".split(" "),function(E,e,b,y,f,l,z,u,A,B){function n(){throw new f("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view");}function C(v,c){return b.__awaiter(this,void 0,void 0,
function(){var a,w,g,h,r,p,e,l,t,n,x;return b.__generator(this,function(d){switch(d.label){case 0:return a=v.basemap,w=v.view,[4,a.load(c)];case 1:d.sent();if(0===a.baseLayers.length)return[2,void 0];g=a.baseLayers.concat(a.referenceLayers);h=D(g);if(h.length)throw h[0];r=y.typeCast(a.baseLayers.getItemAt(0))();d.label=2;case 2:return d.trys.push([2,4,,5]),[4,r.load(c)];case 3:return d.sent(),[3,5];case 4:throw p=d.sent(),e=p.name,l=void 0===e?"basemap-compatibility:unknown-error":e,t=p.message,n=
void 0===t?"Unknown basemap compatibility error":t,x=p.details,new f(l,n,x);case 5:d=r;var b=w,m=d.tileInfo;if(m){var k=b.get("viewingMode");if(k){if(!B.isSpatialReferenceSupported(m.spatialReference,k))throw new f("basemapgalleryitem:spatial-reference-unsupported-"+k,"Basemap spatial reference is unsupported in "+k+" mode");if("global"===k){var q=u.checkIfTileInfoSupportedForView(m,d.fullExtent,null,k);q&&d.compatibleTileInfo256&&!u.checkIfTileInfoSupportedForView(d.compatibleTileInfo256,d.fullExtent,
null,k)&&(q=null);if(q)throw new f("basemapgalleryitem:tiling-scheme-unsupported-"+(m.spatialReference.isWebMercator?"web-mercator":"wgs84")+"-global","Basemap tiling scheme is unsupported in global mode",{error:q});}else if(A.checkUnsupported(m))throw new f("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");b=b.get("basemapTerrain.tilingScheme");if(!(!b||b.compatibleWith(m)||d.compatibleTileInfo256&&b.compatibleWith(d.compatibleTileInfo256)))throw new f("basemapgalleryitem:tiling-scheme-incompatible",
"Basemap tiling scheme is incompatible with the view");}}return[2]}})})}function D(b){var c=["ArcGISTiledImageServiceLayer","ArcGISTiledMapServiceLayer","OpenStreetMap","VectorTileLayer","WebTiledLayer"];return b.toArray().filter(function(a){return-1===c.indexOf(a.operationalLayerType)}).map(function(a){return new f("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:a,operationalLayerType:a.operationalLayerType||"unknown"})})}Object.defineProperty(e,
"__esModule",{value:!0});e.default3DCompatibility=function(e,c){void 0===c&&(c={});return b.__awaiter(this,void 0,void 0,function(){return b.__generator(this,function(a){switch(a.label){case 0:return[4,C(e,c)];case 1:return a.sent(),l.throwIfAborted(c),[2]}})})};e.default2DCompatibility=function(e,c){void 0===c&&(c={});return b.__awaiter(this,void 0,void 0,function(){var a,f,g,h;return b.__generator(this,function(b){switch(b.label){case 0:return a=e.basemap,f=e.view,[4,a.load(c)];case 1:b.sent();
l.throwIfAborted(c);if(0===a.baseLayers.length)return[2,void 0];g=a.baseLayers.getItemAt(0);if(!z.isTiledLayer(g))return[2,void 0];if(a.spatialReference){if(f.spatialReference.equals(a.spatialReference))return[2,void 0];n()}return[4,g.load(c)];case 2:b.sent();l.throwIfAborted(c);h=(g.get("supportedSpatialReferences")||[g.get("tileInfo.spatialReference")]).filter(Boolean);if(0===h.length)return[2,void 0];h.every(function(a){return!f.spatialReference.equals(a)})&&n();return[2,void 0]}})})}});