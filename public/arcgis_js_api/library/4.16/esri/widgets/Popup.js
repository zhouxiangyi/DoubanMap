// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../intl ../core/Collection ../core/deprecate ../core/events ../core/Handles ../core/Logger ../core/throttle ../core/watchUtils ../core/accessorSupport/decorators ./Spinner ./Widget ./Feature/support/FeatureContentMixin ./Popup/PopupViewModel ./support/widget ./support/widgetUtils @dojo/framework/shim/Promise".split(" "),function(C,K,f,q,x,D,t,E,F,G,h,g,H,I,J,y,e,u){function l(e,b){return void 0===b?"esri-popup__"+e:"esri-popup__"+e+"-"+b}var A={buttonEnabled:!0,position:"auto",
breakpoint:{width:544}},v=F.getLogger("esri.widgets.Popup"),B={closeButton:!0,featureNavigation:!0};return function(z){function b(a,d){var c=z.call(this,a,d)||this;c._blurContainer=!1;c._containerNode=null;c._mainContainerNode=null;c._featureMenuNode=null;c._actionsMenuNode=null;c._focusContainer=!1;c._focusDockButton=!1;c._focusFeatureMenuButton=!1;c._focusActionsMenuButton=!1;c._focusFirstFeature=!1;c._focusFirstAction=!1;c._handles=new E;c._pointerOffsetInPx=16;c._spinner=null;c._displaySpinnerThrottled=
G.throttle(function(){return c._displaySpinner()},0);c.actions=null;c.alignment="auto";c.autoCloseEnabled=null;c.autoOpenEnabled=null;c.defaultPopupTemplateEnabled=null;c.content=null;c.collapsed=!1;c.collapseEnabled=!0;c.dockEnabled=!1;c.featureCount=null;c.featureMenuOpen=!1;c.features=null;c.goToOverride=null;c.highlightEnabled=null;c.location=null;c.featureWidgets=[];c.label=void 0;c.maxInlineActions=3;c.messages=null;c.messagesCommon=null;c.promises=null;c.selectedFeature=null;c.selectedFeatureIndex=
null;c.selectedFeatureWidget=null;c.spinnerEnabled=!0;c.title=null;c.updateLocationEnabled=null;c.view=null;c.viewModel=new y;c.visible=null;c.visibleElements=f.__assign({},B);c._addSelectedFeatureIndexHandle();c.own([h.watch(c,"viewModel.screenLocation",function(){return c._positionContainer()}),h.watch(c,["viewModel.visible","dockEnabled"],function(){return c._toggleScreenLocationEnabled()}),h.watch(c,"viewModel.screenLocation",function(a,d){!!a!==!!d&&c.reposition()}),h.watch(c,"viewModel.features",
function(){return c._updateFeatureWidgets()}),h.watch(c,"viewModel.view.padding viewModel.view.size viewModel.visible viewModel.waitingForResult viewModel.location alignment".split(" "),function(){return c.reposition()}),h.watch(c,"spinnerEnabled",function(a){return c._spinnerEnabledChange(a)}),h.watch(c,"viewModel.view.size",function(a,d){return c._updateDockEnabledForViewSize(a,d)}),h.watch(c,"viewModel.view",function(a,d){return c._viewChange(a,d)}),h.watch(c,"viewModel.view.ready",function(a,
d){return c._viewReadyChange(a,d)}),h.watch(c,["viewModel.waitingForResult","viewModel.location"],function(){c._hideSpinner();c._displaySpinnerThrottled()}),h.watch(c,["featureWidgets","viewModel.selectedFeatureIndex"],function(){return c._updateFeatureWidget()}),h.watch(c,"selectedFeatureWidget.viewModel.title",function(a){return c._setTitleFromFeatureWidget(a)}),h.watch(c,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.waitingForContent"],function(){return c._setContentFromFeatureWidget()}),
h.whenFalse(c,"collapsed",function(){var a,d;"xsmall"===(null===(d=null===(a=c.viewModel)||void 0===a?void 0:a.view)||void 0===d?void 0:d.widthBreakpoint)&&c.visible&&c.collapseEnabled&&c.viewModel.centerAtLocation()}),h.on(c,"viewModel.allActions","change",function(){return c._watchActions()}),h.init(c,"viewModel.allActions",function(){return c._watchActions()})]);return c}f.__extends(b,z);b.prototype.destroy=function(){this._destroyFeatureWidgets();this._destroySpinner();this._handles&&this._handles.destroy();
this._handles=null};Object.defineProperty(b.prototype,"actionsMenuId",{get:function(){return this.id+"-actions-menu"},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"actionsMenuButtonId",{get:function(){return this.id+"-actions-menu-button"},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"featureMenuId",{get:function(){return this.id+"-feature-menu"},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"titleId",{get:function(){return this.id+"-popup-title"},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"contentId",{get:function(){return this.id+"-popup-content"},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasContent",{get:function(){var a,d,c,b,e;return!!(this.selectedFeatureWidget?(null===(d=null===(a=this.selectedFeatureWidget)||void 0===a?void 0:a.viewModel)||void 0===d?0:d.waitingForContent)||(null===(b=null===(c=this.selectedFeatureWidget)||void 0===c?void 0:c.viewModel)||void 0===b?0:b.content):null===
(e=this.viewModel)||void 0===e?0:e.content)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"featureNavigationVisible",{get:function(){return this.visible&&1<this.viewModel.featureCount&&this.visibleElements.featureNavigation},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"collapsible",{get:function(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"featureMenuVisible",{get:function(){return this.featureNavigationVisible&&
this.featureMenuOpen&&this.visible},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"contentCollapsed",{get:function(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"dividedActions",{get:function(){return this._divideActions()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"actionsMenuOpen",{get:function(){return this.viewModel.visible?this._get("actionsMenuOpen"):!1},set:function(a){this._set("actionsMenuOpen",
!!a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"currentAlignment",{get:function(){return this._getCurrentAlignment()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"currentDockPosition",{get:function(){return this._getCurrentDockPosition()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"dockOptions",{get:function(){return this._get("dockOptions")||A},set:function(a){var d=f.__assign({},A),c=this.get("viewModel.view.breakpoints"),b={};
c&&(b.width=c.xsmall,b.height=c.xsmall);a=f.__assign(f.__assign({},d),a);d=f.__assign(f.__assign({},d.breakpoint),b);b=a.breakpoint;!0===b?a.breakpoint=d:"object"===typeof b&&(a.breakpoint=f.__assign(f.__assign({},d),b));this._set("dockOptions",a);this._setCurrentDockPosition();this.reposition()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"featureNavigationEnabled",{set:function(a){D.deprecatedProperty(v,"featureNavigationEnabled",{replacement:"visibleElements.featureNavigation",
version:"4.15"});this.visibleElements=f.__assign(f.__assign({},this.visibleElements),{featureNavigation:a})},enumerable:!0,configurable:!0});b.prototype.castVisibleElements=function(a){return f.__assign(f.__assign({},B),a)};b.prototype.blur=function(){this.visible||v.warn("Popup cannot be blurred while visible is false");this._blurContainer=!0;this.scheduleRender()};b.prototype.clear=function(){this.viewModel.clear()};b.prototype.close=function(){this.visible=!1};b.prototype.fetchFeatures=function(a,
d){return this.viewModel.fetchFeatures(a,d)};b.prototype.focus=function(){this.visible||v.warn("Popup cannot be focused while visible is false");this._focusContainer=!0;this.scheduleRender()};b.prototype.next=function(){return this.viewModel.next()};b.prototype.open=function(a){var d,c;this._handles.remove("selected-index");var b={collapsed:a?!!a.collapsed:!1,actionsMenuOpen:a?!!a.actionsMenuOpen:!1,featureMenuOpen:a?!!a.featureMenuOpen:!1};"xsmall"===(null===(c=null===(d=this.viewModel)||void 0===
d?void 0:d.view)||void 0===c?void 0:c.widthBreakpoint)&&(b.collapsed=!0);this.set(b);this.viewModel.open(a);this._addSelectedFeatureIndexHandle()};b.prototype.previous=function(){return this.viewModel.previous()};b.prototype.reposition=function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()};b.prototype.triggerAction=function(a){this.viewModel.triggerAction(a)};b.prototype.render=function(){var a,d,c,b,w,f=this.actionsMenuOpen,g=this.dockEnabled,n=this.visible,h=this.featureMenuVisible,
p=this.currentAlignment,m=this.currentDockPosition,r=this.dividedActions.menuActions,r=n&&1<r.length&&f,f=null===(c=null===(d=this.selectedFeature)||void 0===d?void 0:d.layer)||void 0===c?void 0:c.title;d=null===(w=null===(b=this.selectedFeature)||void 0===b?void 0:b.layer)||void 0===w?void 0:w.id;b=(a={},a["esri-popup--aligned-top-center"]="top-center"===p,a["esri-popup--aligned-bottom-center"]="bottom-center"===p,a["esri-popup--aligned-top-left"]="top-left"===p,a["esri-popup--aligned-bottom-left"]=
"bottom-left"===p,a["esri-popup--aligned-top-right"]="top-right"===p,a["esri-popup--aligned-bottom-right"]="bottom-right"===p,a["esri-popup--is-docked"]=n&&g,a["esri-popup--shadow"]=n&&!g,a["esri-popup--is-docked-top-left"]="top-left"===m,a["esri-popup--is-docked-top-center"]="top-center"===m,a["esri-popup--is-docked-top-right"]="top-right"===m,a["esri-popup--is-docked-bottom-left"]="bottom-left"===m,a["esri-popup--is-docked-bottom-center"]="bottom-center"===m,a["esri-popup--is-docked-bottom-right"]=
"bottom-right"===m,a["esri-popup--feature-menu-open"]=h,a["esri-popup--actions-menu-open"]=r,a);return e.tsx("div",{class:this.classes("esri-popup",b),role:"presentation","data-layer-title":f,"data-layer-id":d,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},n?[this.renderMainContainer(),this.renderPointer()]:null)};b.prototype.renderLoadingContainer=function(){var a=this.messagesCommon;return this.viewModel.pendingPromisesCount?e.tsx("div",{key:l("loading-container"),
role:"presentation",class:"esri-popup__loading-container","aria-label":a.loading,title:a.loading},e.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-loading-indicator","esri-rotating")})):null};b.prototype.renderPreviousIcon=function(){var a,d=u.isRTL(),d=(a={},a["esri-icon-right-triangle-arrow"]=d,a["esri-popup__pagination-previous-icon--rtl"]=d,a["esri-icon-left-triangle-arrow"]=!d,a["esri-popup__pagination-previous-icon"]=!d,a);return e.tsx("span",{"aria-hidden":"true",
class:this.classes("esri-popup__icon",d)})};b.prototype.renderPreviousButton=function(){var a=this.messages;return e.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes("esri-popup__button","esri-popup__pagination-previous"),"aria-label":a.previous,title:a.previous},this.renderPreviousIcon())};b.prototype.renderNextIcon=function(){var a,d=u.isRTL(),d=(a={},a["esri-icon-left-triangle-arrow"]=d,a["esri-popup__pagination-next-icon--rtl"]=d,
a["esri-icon-right-triangle-arrow"]=!d,a["esri-popup__pagination-next-icon"]=!d,a);return e.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",d)})};b.prototype.renderNextButton=function(){var a=this.messages;return e.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes("esri-popup__button","esri-popup__pagination-next"),"aria-label":a.next,title:a.next},this.renderNextIcon())};b.prototype.renderFeatureMenuButton=function(){var a=
this.featureMenuOpen,d=this.featureMenuId,c=this.messagesCommon,b=this.viewModel,f=b.featureCount,b=b.selectedFeatureIndex;return e.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes("esri-popup__button","esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":d,"aria-expanded":a,"aria-label":c.menu,title:c.menu},
this._getPageText(f,b))};b.prototype.renderNavigationButtons=function(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderLoadingContainer()||this.renderFeatureMenuButton(),this.renderNextButton()]:null};b.prototype.renderDockIcon=function(){var a,d=this.dockEnabled,c=this._wouldDockTo(),d=(a={},a["esri-icon-minimize"]=d,a["esri-popup__icon--dock-icon"]=!d,a["esri-icon-dock-right"]=!d&&("top-right"===c||"bottom-right"===c),a["esri-icon-dock-left"]=!d&&("top-left"===c||"bottom-left"===
c),a["esri-icon-maximize"]=!d&&"top-center"===c,a["esri-icon-dock-bottom"]=!d&&"bottom-center"===c,a);return e.tsx("span",{"aria-hidden":"true",class:this.classes(d,"esri-popup__icon")})};b.prototype.renderDockButton=function(){var a,d,c,b=this.dockEnabled,f=this.messages,k=null===(d=null===(a=this.viewModel)||void 0===a?void 0:a.view)||void 0===d?void 0:d.widthBreakpoint;a=b?f.undock:f.dock;return"xsmall"!==k&&(null===(c=this.dockOptions)||void 0===c?0:c.buttonEnabled)?e.tsx("div",{role:"button",
"aria-label":a,title:a,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes("esri-popup__button","esri-popup__button--dock")},this.renderDockIcon()):null};b.prototype.renderTitle=function(){var a,d=this.viewModel.title,c=this.titleId,b=this.collapsible,f=this.contentCollapsed,k=this.messagesCommon,f=b?f?k.expand:k.collapse:"",k=(a={},a["esri-popup__header-container--button"]=
b,a);return d?e.tsx("div",{class:this.classes("esri-popup__header-container",k),key:d,enterAnimation:this._createFeatureUpdatedAnimation(),id:c,role:b?"button":"heading","aria-label":f,title:f,tabIndex:b?0:-1,bind:this,onclick:this._toggleCollapsed,onkeydown:this._toggleCollapsed},e.tsx("h2",{class:"esri-popup__header-title",innerHTML:d})):null};b.prototype.renderCloseIcon=function(){return e.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-close")})};b.prototype.renderCloseButton=
function(){var a=this.messagesCommon;return this.visibleElements.closeButton?e.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:"esri-popup__button","aria-label":a.close,title:a.close},this.renderCloseIcon()):null};b.prototype.renderHeader=function(){return e.tsx("header",{class:"esri-popup__header"},this.renderTitle(),e.tsx("div",{class:"esri-popup__header-buttons"},this.renderDockButton(),this.renderCloseButton()))};b.prototype.renderContentContainer=
function(){var a=this.contentId,d=this.contentCollapsed,c=this.viewModel.content;return this.hasContent&&!d?e.tsx("article",{key:c,enterAnimation:this._createFeatureUpdatedAnimation(),id:a,class:"esri-popup__content"},this.renderContent()):null};b.prototype.renderActionsMenuButton=function(){var a=this.actionsMenuId,d=this.actionsMenuButtonId,c=this.actionsMenuOpen,b=this.messagesCommon,b=c?b.close:b.open;return this.dividedActions.menuActions.length?e.tsx("div",{key:l("actions-menu-button"),class:this.classes("esri-popup__button",
"esri-popup__actions-menu-button"),role:"button",id:d,"aria-haspopup":"true","aria-controls":c?a:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":b,title:b},e.tsx("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):null};b.prototype.renderMenuActions=function(){var a=this,d=this.actionsMenuId,c=this.actionsMenuButtonId,b=this.actionsMenuOpen,
f=this.dividedActions,k=f.menuActions,g=f.inlineActions;return k.length&&b?e.tsx("ul",{id:d,role:"menu","aria-labelledby":c,key:l("actions"),class:"esri-popup__actions",bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},k.toArray().map(function(c,d){return a.renderAction({action:c,index:d+g.length,type:"menu-item"})})):null};b.prototype.renderInlineActions=function(){var a=this,d=this.dividedActions.inlineActions;return!!d.length&&
d.toArray().map(function(c,d){return a.renderAction({action:c,index:d,type:"inline"})})};b.prototype.renderInlineActionsContainer=function(){var a=this.dividedActions,d=!!a.inlineActions.length,a=!!a.menuActions.length;return d||a?e.tsx("div",{key:"inline-actions-container","data-inline-actions":d.toString(),"data-menu-actions":a.toString(),class:"esri-popup__inline-actions-container"},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null};b.prototype.renderNavigation=
function(){return this.featureNavigationVisible?e.tsx("section",{key:l("navigation"),class:this.classes("esri-popup__navigation")},this.renderNavigationButtons()):null};b.prototype.renderFooter=function(){var a,d=this.featureNavigationVisible,c=this.dividedActions,b=!!c.inlineActions.length,c=!!c.menuActions.length,c=(a={},a["esri-popup__footer--has-pagination"]=d,a["esri-popup__footer--has-actions"]=b,a["esri-popup__footer--has-actions-menu"]=c,a);return d||b?e.tsx("div",{key:l("feature-buttons"),
class:this.classes("esri-popup__footer",c)},this.renderInlineActionsContainer(),this.renderNavigation()):null};b.prototype.renderFeatureMenuContainer=function(){var a=this.featureWidgets,d=this.viewModel.selectedFeatureIndex,c=q.substitute(this.messages.selectedFeatures,{total:a.length});return e.tsx("section",{key:l("menu"),class:"esri-popup__feature-menu"},e.tsx("h2",{class:"esri-popup__feature-menu-header"},c),e.tsx("nav",{class:"esri-popup__feature-menu-viewport",afterCreate:this._featureMenuViewportNodeUpdated,
afterUpdate:this._featureMenuViewportNodeUpdated},this.renderFeatureMenu(a,d)))};b.prototype.renderPointer=function(){return this.dockEnabled?null:e.tsx("div",{key:l("pointer"),class:"esri-popup__pointer",role:"presentation"},e.tsx("div",{class:this.classes("esri-popup__pointer-direction","esri-popup--shadow")}))};b.prototype.renderMainContainer=function(){var a,d=this.dockEnabled,c=this.currentAlignment,b=this.currentDockPosition,f=this.titleId,k=this.contentId,g=this.collapsible,n=this.hasContent,
h=this.contentCollapsed,p=this.viewModel.title,m="bottom-left"===c||"bottom-center"===c||"bottom-right"===c||"top-left"===b||"top-center"===b||"top-right"===b,c="top-left"===c||"top-center"===c||"top-right"===c||"bottom-left"===b||"bottom-center"===b||"bottom-right"===b,b=this.renderFeatureMenuContainer(),r=this.renderFooter(),d=(a={},a["esri-popup--shadow"]=d,a["esri-popup--is-collapsible"]=g,a["esri-popup--is-collapsed"]=h,a);return e.tsx("div",{class:this.classes("esri-popup__main-container","esri-widget",
d),tabIndex:-1,role:"dialog","aria-labelledby":p?f:"","aria-describedby":n&&!h?k:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},m?r:null,m?b:null,this.renderHeader(),this.renderContentContainer(),c?r:null,c?b:null)};b.prototype.renderContent=function(){var a,d=null===(a=this.viewModel)||void 0===a?void 0:a.content;return d?"string"===typeof d?e.tsx("div",{key:d,innerHTML:d}):this.renderNodeContent(d):null};b.prototype.renderActionText=
function(a){return e.tsx("span",{key:"text",class:"esri-popup__action-text"},a)};b.prototype.renderActionIcon=function(a){var d,c=this._getActionClass(a),b=this._getActionImage(a),f=(d={},d["esri-icon-loading-indicator"]=a.active,d["esri-rotating"]=a.active,d["esri-popup__icon"]=!!c,d["esri-popup__action-image"]=!a.active&&!!b,d);c&&(f[c]=!a.active);return e.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes("esri-popup__icon",f),styles:this._getIconStyles(b)})};b.prototype.renderAction=
function(a){var d,c=a.action,b=a.index;a=a.type;var f=this._getActionTitle(c),k=(d={},d["esri-popup__action"]="toggle"!==c.type,d["esri-popup__action-toggle"]="toggle"===c.type,d["esri-popup__action-toggle--on"]="toggle"===c.type&&c.value,d["esri-popup__button--disabled"]=c.disabled,d);d=[this.renderActionIcon(c),this.renderActionText(f)];b="menu-item"===a?e.tsx("li",{key:c,role:"menuitem",tabIndex:0,title:f,"aria-label":f,class:this.classes("esri-popup__button",k),onkeyup:this._handleActionMenuItemKeyup,
bind:this,"data-action-index":b,onclick:this._triggerAction,onkeydown:this._triggerAction},d):e.tsx("div",{key:c,role:"button",tabIndex:0,title:f,"aria-label":f,class:this.classes("esri-popup__button",k),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":b,onclick:this._triggerAction,onkeydown:this._triggerAction},d);return c.visible?b:null};b.prototype.renderFeatureMenuItem=function(a,b,c){var d,f=this.messages,k=this.messagesCommon,g=b===c,n=(d={},d["esri-popup__feature-menu-item--selected"]=
g,d);d=g?e.tsx("span",{key:l("feature-menu-selected-feature-"+c),title:f.selectedFeature,"aria-label":f.selectedFeature,class:"esri-icon-check-mark"}):null;a=e.tsx("span",{innerHTML:a.title||k.untitled});return e.tsx("li",{role:"menuitem",tabIndex:-1,key:l("feature-menu-feature-"+c),class:this.classes(n,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":b,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},e.tsx("span",{class:"esri-popup__feature-menu-title"},
a,d))};b.prototype.renderFeatureMenu=function(a,b){var c=this,d=this.featureMenuId;return 1<a.length?e.tsx("ol",{class:"esri-popup__feature-menu-list",id:d,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},a.map(function(a,d){return c.renderFeatureMenuItem(a,d,b)})):null};b.prototype._getActionTitle=function(a){var b=this.messages,c=this.selectedFeature,f=this.messagesCommon,e=a.id,c=null===c||void 0===c?void 0:
c.attributes;return(a="zoom-to-feature"===e?q.substitute(a.title,{messages:b}):"remove-selected-feature"===e?q.substitute(a.title,{messages:f}):a.title)&&c?q.substitute(a,c):a};b.prototype._getActionClass=function(a){var b=this.selectedFeature,b=null===b||void 0===b?void 0:b.attributes,c=a.className;return(a=a.image||c?c:"esri-icon-default-action")&&b?q.substitute(a,b):a};b.prototype._getActionImage=function(a){var b=this.selectedFeature,b=null===b||void 0===b?void 0:b.attributes;return(a=a.image)&&
b?q.substitute(a,b):a};b.prototype._createFeatureUpdatedAnimation=function(){return u.cssTransition("enter","esri-popup--feature-updated")};b.prototype._getInlineActionCount=function(){var a=this.maxInlineActions;if("number"!==typeof a)return null;a=Math.round(a);return Math.max(this.featureNavigationVisible?a-1:a,0)};b.prototype._watchActions=function(){var a=this,b=this.viewModel.allActions;this.notifyChange("dividedActions");this._handles.remove("actions");b&&b.forEach(function(b){a._handles.add(h.watch(b,
"active className disabled id title image visible".split(" "),function(){return a.scheduleRender()}),"actions")})};b.prototype._divideActions=function(){var a=this.viewModel.allActions,b=this._getInlineActionCount(),c=null===b,f=0===b;return{inlineActions:c?a.slice(0):f?new x:a.slice(0,b),menuActions:c?new x:f?a.slice(0):a.slice(b)}};b.prototype._featureMenuOpenChanged=function(a){a?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0};b.prototype._actionsMenuOpenChanged=function(a){a?this._focusFirstAction=
!0:this._focusActionsMenuButton=!0};b.prototype._setTitleFromFeatureWidget=function(a){this.selectedFeatureWidget&&(this.viewModel.title=a||"")};b.prototype._setContentFromFeatureWidget=function(){var a=this.selectedFeatureWidget;a&&(this.viewModel.content=a)};b.prototype._handleFeatureMenuKeyup=function(a){"Escape"===t.eventKey(a)&&(a.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())};b.prototype._handleActionMenuKeyup=function(a){"Escape"===t.eventKey(a)&&
(a.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())};b.prototype._handleFeatureMenuItemKeyup=function(a){var b=t.eventKey(a),c=this._featureMenuNode,f=a.currentTarget["data-feature-index"];if(c){var c=c.querySelectorAll("li"),e=c.length;"ArrowUp"===b?(a.stopPropagation(),c[(f-1+e)%e].focus()):"ArrowDown"===b?(a.stopPropagation(),c[(f+1+e)%e].focus()):"Home"===b?(a.stopPropagation(),c[0].focus()):"End"===b&&(a.stopPropagation(),c[c.length-1].focus())}};
b.prototype._handleActionMenuItemKeyup=function(a){var b=t.eventKey(a),c=this._actionsMenuNode,f=a.currentTarget["data-action-index"];if(c){var c=c.querySelectorAll("li"),e=c.length;"ArrowUp"===b?(a.stopPropagation(),c[(f-1+e)%e].focus()):"ArrowDown"===b?(a.stopPropagation(),c[(f+1+e)%e].focus()):"Home"===b?(a.stopPropagation(),c[0].focus()):"End"===b&&(a.stopPropagation(),c[c.length-1].focus())}};b.prototype._handleMainKeyup=function(a){var b=t.eventKey(a);"ArrowLeft"===b&&(a.stopPropagation(),this.previous());
"ArrowRight"===b&&(a.stopPropagation(),this.next())};b.prototype._spinnerEnabledChange=function(a){this._destroySpinner();a&&(a=this.get("viewModel.view"),this._createSpinner(a))};b.prototype._hideSpinner=function(){var a=this._spinner;a&&(a.location=null,a.hide())};b.prototype._displaySpinner=function(){var a=this._spinner;if(a){var b=this.viewModel,c=b.location;b.waitingForResult?a.show({location:c}):a.hide()}};b.prototype._getIconStyles=function(a){return{"background-image":a?"url("+a+")":""}};
b.prototype._addSelectedFeatureIndexHandle=function(){var a=this,b=h.watch(this,"viewModel.selectedFeatureIndex",function(b,d){return a._selectedFeatureIndexUpdated(b,d)});this._handles.add(b,"selected-index")};b.prototype._selectedFeatureIndexUpdated=function(a,b){this.featureCount&&a!==b&&-1!==a&&(this.featureMenuOpen=this.actionsMenuOpen=!1)};b.prototype._updateFeatureWidget=function(){this._set("selectedFeatureWidget",this.featureWidgets[this.viewModel.selectedFeatureIndex]||null)};b.prototype._destroyFeatureWidgets=
function(){this.featureWidgets.forEach(function(a){return a&&!a.destroyed&&a.destroy()});this._set("featureWidgets",[])};b.prototype._updateFeatureWidgets=function(){return f.__awaiter(this,void 0,void 0,function(){var a,b,c,e,g,k,h=this;return f.__generator(this,function(d){switch(d.label){case 0:return a=this,b=a.features,c=a.featureWidgets,b&&b.length?[4,new Promise(function(a,b){C(["./Feature"],a,b)})]:(this._destroyFeatureWidgets(),[2]);case 1:return e=d.sent(),g=c.slice(0),k=[],b.forEach(function(a,
b){if(a){var c=null;g.some(function(b,d){b&&b.graphic===a&&(c=b,g.splice(d,1));return!!c});if(c)k[b]=c;else{var d=new e({defaultPopupTemplateEnabled:h.defaultPopupTemplateEnabled,graphic:a,spatialReference:h.get("view.spatialReference"),map:h.get("view.map")});d.visibleElements=f.__assign(f.__assign({},d.visibleElements),{title:!1});k[b]=d}}}),g.forEach(function(a){return a&&!a.destroyed&&a.destroy()}),this._set("featureWidgets",k),[2]}})})};b.prototype._isScreenLocationWithinView=function(a,b){return-1<
a.x&&-1<a.y&&a.x<=b.width&&a.y<=b.height};b.prototype._isOutsideView=function(a){var b=a.popupHeight,c=a.popupWidth,f=a.screenLocation,e=a.side;a=a.view;if(isNaN(c)||isNaN(b)||!a||!f)return!1;var g=a.padding;return"right"===e&&f.x+c/2>a.width-g.right||"left"===e&&f.x-c/2<g.left||"top"===e&&f.y-b<g.top||"bottom"===e&&f.y+b>a.height-g.bottom?!0:!1};b.prototype._determineCurrentAlignment=function(){var a=this._pointerOffsetInPx,b=this._containerNode,c=this._mainContainerNode,f=this.viewModel,e=f.screenLocation,
f=f.view;if(!e||!f||!b)return"top-center";if(!this._isScreenLocationWithinView(e,f))return this._get("currentAlignment")||"top-center";var g=c?window.getComputedStyle(c,null):null,c=g?parseInt(g.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,g=g?parseInt(g.getPropertyValue("height").replace(/[^-\d\.]/g,""),10):0,h=b.getBoundingClientRect(),b=h.width+a,h=Math.max(h.height,c,g)+a,a=this._isOutsideView({popupHeight:h,popupWidth:b,screenLocation:e,side:"right",view:f}),c=this._isOutsideView({popupHeight:h,
popupWidth:b,screenLocation:e,side:"left",view:f}),g=this._isOutsideView({popupHeight:h,popupWidth:b,screenLocation:e,side:"top",view:f}),e=this._isOutsideView({popupHeight:h,popupWidth:b,screenLocation:e,side:"bottom",view:f});return c?g?"bottom-right":"top-right":a?g?"bottom-left":"top-left":g?e?"top-center":"bottom-center":"top-center"};b.prototype._getCurrentAlignment=function(){var a=this.alignment,b=this.visible;return this.dockEnabled||!b?null:"auto"===a?this._determineCurrentAlignment():"function"===
typeof a?a.call(this):a};b.prototype._setCurrentAlignment=function(){this._set("currentAlignment",this._getCurrentAlignment())};b.prototype._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())};b.prototype._getDockPosition=function(){var a=this.get("dockOptions.position");return"auto"===a?this._determineCurrentDockPosition():"function"===typeof a?a.call(this):a};b.prototype._getCurrentDockPosition=function(){return this.dockEnabled&&this.visible?this._getDockPosition():
null};b.prototype._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()};b.prototype._determineCurrentDockPosition=function(){var a=this.get("viewModel.view"),b=u.isRTL()?"top-left":"top-right";if(!a)return b;var c=a.padding||{left:0,right:0,top:0,bottom:0},c=a.width-c.left-c.right;return(a=a.get("breakpoints"))&&c<=a.xsmall?"bottom-center":b};b.prototype._positionContainer=function(a){void 0===a&&(a=this._containerNode);a&&(this._containerNode=a);if(a){var b=this.viewModel.screenLocation,
c=a.getBoundingClientRect().width;if(b=this._calculatePositionStyle(b,c))a.style.top=b.top,a.style.left=b.left,a.style.bottom=b.bottom,a.style.right=b.right}};b.prototype._calculateFullWidth=function(a){var b=this.currentAlignment,c=this._pointerOffsetInPx;return"top-left"===b||"bottom-left"===b||"top-right"===b||"bottom-right"===b?a+c:a};b.prototype._calculateAlignmentPosition=function(a,b,c,f){var d=this.currentAlignment,e=this._pointerOffsetInPx;f/=2;var g=c.height-b;c=c.width-a;var h=this.view.padding;
if("bottom-center"===d)return{top:b+e-h.top,left:a-f-h.left};if("top-left"===d)return{bottom:g+e-h.bottom,right:c+e-h.right};if("bottom-left"===d)return{top:b+e-h.top,right:c+e-h.right};if("top-right"===d)return{bottom:g+e-h.bottom,left:a+e-h.left};if("bottom-right"===d)return{top:b+e-h.top,left:a+e-h.left};if("top-center"===d)return{bottom:g+e-h.bottom,left:a-f-h.left}};b.prototype._calculatePositionStyle=function(a,b){var c=this.view;if(c){if(this.dockEnabled)return{left:"",top:"",right:"",bottom:""};
if(a&&b&&(b=this._calculateFullWidth(b),a=this._calculateAlignmentPosition(a.x,a.y,c,b)))return{top:void 0!==a.top?a.top+"px":"auto",left:void 0!==a.left?a.left+"px":"auto",bottom:void 0!==a.bottom?a.bottom+"px":"auto",right:void 0!==a.right?a.right+"px":"auto"}}};b.prototype._viewChange=function(a,b){a&&b&&(this.close(),this.clear())};b.prototype._viewReadyChange=function(a,b){a?(a=this.get("viewModel.view"),this._wireUpView(a)):b&&(this.close(),this.clear())};b.prototype._wireUpView=function(a){this._destroySpinner();
a&&(this.spinnerEnabled&&this._createSpinner(a),this._setDockEnabledForViewSize(this.dockOptions))};b.prototype._dockingThresholdCrossed=function(a,b,c){var d=a[0];a=a[1];var f=b[0];b=b[1];var e=c.width;c=c.height;return d<=e&&f>e||d>e&&f<=e||a<=c&&b>c||a>c&&b<=c};b.prototype._updateDockEnabledForViewSize=function(a,b){if(a&&b){var c=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},d=c.left+c.right,f=c.top+c.bottom,c=[],e=[];c[0]=a[0]-d;c[1]=a[1]-f;e[0]=b[0]-d;e[1]=b[1]-f;a=this.dockOptions;
this._dockingThresholdCrossed(c,e,a.breakpoint)&&this._setDockEnabledForViewSize(a);this._setCurrentDockPosition()}};b.prototype._focusDockButtonNode=function(a){this._focusDockButton&&(this._focusDockButton=!1,a.focus())};b.prototype._mainContainerNodeUpdated=function(a){this._mainContainerNode=a;this._focusContainer?(this._focusContainer=!1,a.focus()):this._blurContainer&&(this._blurContainer=!1,a.blur())};b.prototype._featureMenuNodeUpdated=function(a){(this._featureMenuNode=a)&&this._focusFirstFeature&&
(this._focusFirstFeature=!1,a=a.querySelectorAll("li"),a.length&&a[0].focus())};b.prototype._actionsMenuNodeUpdated=function(a){(this._actionsMenuNode=a)&&this._focusFirstAction&&(this._focusFirstAction=!1,a=a.querySelectorAll("li"),a.length&&a[0].focus())};b.prototype._focusFeatureMenuButtonNode=function(a){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,a.focus())};b.prototype._focusActionsMenuButtonNode=function(a){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,a.focus())};
b.prototype._featureMenuViewportNodeUpdated=function(a){a&&(a.scrollTop=0)};b.prototype._toggleScreenLocationEnabled=function(){var a=this.dockEnabled,b=this.viewModel;b&&(b.screenLocationEnabled=this.visible&&!a)};b.prototype._shouldDockAtCurrentViewSize=function(a){a=a.breakpoint;var b=this.get("viewModel.view.ui"),c=b.width,b=b.height;if(isNaN(c)||isNaN(b))return!1;c=a.hasOwnProperty("width")&&c<=a.width;a=a.hasOwnProperty("height")&&b<=a.height;return c||a};b.prototype._setDockEnabledForViewSize=
function(a){a.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(a))};b.prototype._getPageText=function(a,b){return this.featureNavigationVisible?q.substitute(this.messages.pageText,{index:b+1,total:a}):null};b.prototype._destroySpinner=function(){var a=this._spinner,b=this.view;a&&(b&&b.ui&&b.ui.remove(this._spinner,"popup-spinner"),a.destroy(),this._spinner=null)};b.prototype._createSpinner=function(a){a&&(this._spinner=new H({view:a}),a.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))};
b.prototype._toggleCollapsed=function(){this.collapsed=!this.collapsed};b.prototype._close=function(){this.close();this.view&&this.view.focus()};b.prototype._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled;this._focusDockButton=!0;this.scheduleRender()};b.prototype._toggleFeatureMenu=function(){var a=!this.featureMenuOpen;this._featureMenuOpenChanged(a);this.actionsMenuOpen=!1;this.featureMenuOpen=a};b.prototype._toggleActionsMenu=function(){var a=!this.actionsMenuOpen;this._actionsMenuOpenChanged(a);
this.featureMenuOpen=!1;this.actionsMenuOpen=a};b.prototype._triggerAction=function(a){a=a.currentTarget["data-action-index"];var b=this.viewModel.allActions.getItemAt(a);b&&"toggle"===b.type&&(b.value=!b.value);this.actionsMenuOpen=!1;this.viewModel.triggerAction(a)};b.prototype._selectFeature=function(a){a=a.currentTarget["data-feature-index"];isNaN(a)||(this.viewModel.selectedFeatureIndex=a);this.featureMenuOpen=!1;this._focusFeatureMenuButton=!0;this.scheduleRender()};b.prototype._next=function(){this.next()};
b.prototype._previous=function(){this.previous()};f.__decorate([g.property({readOnly:!0,dependsOn:["id"]}),e.renderable()],b.prototype,"actionsMenuId",null);f.__decorate([g.property({readOnly:!0,dependsOn:["id"]}),e.renderable()],b.prototype,"actionsMenuButtonId",null);f.__decorate([g.property({readOnly:!0,dependsOn:["id"]}),e.renderable()],b.prototype,"featureMenuId",null);f.__decorate([g.property({readOnly:!0,dependsOn:["id"]}),e.renderable()],b.prototype,"titleId",null);f.__decorate([g.property({readOnly:!0,
dependsOn:["id"]}),e.renderable()],b.prototype,"contentId",null);f.__decorate([g.property({readOnly:!0,dependsOn:["selectedFeatureWidget","selectedFeatureWidget.viewModel","selectedFeatureWidget.viewModel.waitingForContent","selectedFeatureWidget.viewModel.content","viewModel.content"]}),e.renderable()],b.prototype,"hasContent",null);f.__decorate([g.property({readOnly:!0,dependsOn:["visible","viewModel.featureCount","visibleElements.featureNavigation"]}),e.renderable()],b.prototype,"featureNavigationVisible",
null);f.__decorate([g.property({readOnly:!0,dependsOn:["collapseEnabled","viewModel.title","hasContent"]}),e.renderable()],b.prototype,"collapsible",null);f.__decorate([g.property({readOnly:!0,dependsOn:["featureNavigationVisible","featureMenuOpen","visible"]}),e.renderable()],b.prototype,"featureMenuVisible",null);f.__decorate([g.property({readOnly:!0,dependsOn:["collapsible","featureMenuVisible","collapsed"]}),e.renderable()],b.prototype,"contentCollapsed",null);f.__decorate([g.property({readOnly:!0,
dependsOn:["featureNavigationVisible","maxInlineActions","viewModel.allActions","viewModel.allActions.length"]}),e.renderable()],b.prototype,"dividedActions",null);f.__decorate([g.aliasOf("viewModel.actions"),e.renderable()],b.prototype,"actions",void 0);f.__decorate([g.property({dependsOn:["viewModel.visible"]}),e.renderable()],b.prototype,"actionsMenuOpen",null);f.__decorate([g.property()],b.prototype,"alignment",void 0);f.__decorate([g.aliasOf("viewModel.autoCloseEnabled")],b.prototype,"autoCloseEnabled",
void 0);f.__decorate([g.aliasOf("viewModel.autoOpenEnabled")],b.prototype,"autoOpenEnabled",void 0);f.__decorate([g.aliasOf("viewModel.defaultPopupTemplateEnabled")],b.prototype,"defaultPopupTemplateEnabled",void 0);f.__decorate([g.aliasOf("viewModel.content"),e.renderable()],b.prototype,"content",void 0);f.__decorate([g.property(),e.renderable()],b.prototype,"collapsed",void 0);f.__decorate([g.property(),e.renderable()],b.prototype,"collapseEnabled",void 0);f.__decorate([g.property({readOnly:!0,
dependsOn:["dockEnabled","alignment","visible"]}),e.renderable()],b.prototype,"currentAlignment",null);f.__decorate([g.property({readOnly:!0,dependsOn:["viewModel.view.ready","dockEnabled","dockOptions","visible"]}),e.renderable()],b.prototype,"currentDockPosition",null);f.__decorate([g.property(),e.renderable()],b.prototype,"dockOptions",null);f.__decorate([g.property(),e.renderable()],b.prototype,"dockEnabled",void 0);f.__decorate([g.aliasOf("viewModel.featureCount"),e.renderable()],b.prototype,
"featureCount",void 0);f.__decorate([g.property(),e.renderable()],b.prototype,"featureMenuOpen",void 0);f.__decorate([g.aliasOf("viewModel.features"),e.renderable()],b.prototype,"features",void 0);f.__decorate([g.property(),e.renderable()],b.prototype,"featureNavigationEnabled",null);f.__decorate([g.aliasOf("viewModel.goToOverride")],b.prototype,"goToOverride",void 0);f.__decorate([g.aliasOf("viewModel.highlightEnabled")],b.prototype,"highlightEnabled",void 0);f.__decorate([g.aliasOf("viewModel.location"),
e.renderable()],b.prototype,"location",void 0);f.__decorate([g.property({readOnly:!0}),e.renderable()],b.prototype,"featureWidgets",void 0);f.__decorate([g.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],b.prototype,"label",void 0);f.__decorate([g.property(),e.renderable()],b.prototype,"maxInlineActions",void 0);f.__decorate([g.property(),e.renderable(),e.messageBundle("esri/widgets/Popup/t9n/Popup")],b.prototype,"messages",void 0);f.__decorate([g.property(),e.renderable(),e.messageBundle("esri/t9n/common")],
b.prototype,"messagesCommon",void 0);f.__decorate([g.aliasOf("viewModel.promises")],b.prototype,"promises",void 0);f.__decorate([g.aliasOf("viewModel.selectedFeature"),e.renderable()],b.prototype,"selectedFeature",void 0);f.__decorate([g.aliasOf("viewModel.selectedFeatureIndex"),e.renderable()],b.prototype,"selectedFeatureIndex",void 0);f.__decorate([g.property({readOnly:!0}),e.renderable()],b.prototype,"selectedFeatureWidget",void 0);f.__decorate([g.property()],b.prototype,"spinnerEnabled",void 0);
f.__decorate([g.aliasOf("viewModel.title"),e.renderable()],b.prototype,"title",void 0);f.__decorate([g.aliasOf("viewModel.updateLocationEnabled")],b.prototype,"updateLocationEnabled",void 0);f.__decorate([g.aliasOf("viewModel.view")],b.prototype,"view",void 0);f.__decorate([g.property({type:y}),e.renderable("viewModel.view.widthBreakpoint viewModel.allActions viewModel.screenLocation viewModel.screenLocationEnabled viewModel.state viewModel.pendingPromisesCount viewModel.promiseCount viewModel.waitingForResult".split(" ")),
e.vmEvent(["triggerAction","trigger-action"])],b.prototype,"viewModel",void 0);f.__decorate([g.aliasOf("viewModel.visible"),e.renderable()],b.prototype,"visible",void 0);f.__decorate([g.property(),e.renderable()],b.prototype,"visibleElements",void 0);f.__decorate([g.cast("visibleElements")],b.prototype,"castVisibleElements",null);f.__decorate([e.accessibleHandler()],b.prototype,"_toggleCollapsed",null);f.__decorate([e.accessibleHandler()],b.prototype,"_close",null);f.__decorate([e.accessibleHandler()],
b.prototype,"_toggleDockEnabled",null);f.__decorate([e.accessibleHandler()],b.prototype,"_toggleFeatureMenu",null);f.__decorate([e.accessibleHandler()],b.prototype,"_toggleActionsMenu",null);f.__decorate([e.accessibleHandler()],b.prototype,"_triggerAction",null);f.__decorate([e.accessibleHandler()],b.prototype,"_selectFeature",null);f.__decorate([e.accessibleHandler()],b.prototype,"_next",null);f.__decorate([e.accessibleHandler()],b.prototype,"_previous",null);return b=f.__decorate([g.subclass("esri.widgets.Popup")],
b)}(J.FeatureContentMixin(I))});