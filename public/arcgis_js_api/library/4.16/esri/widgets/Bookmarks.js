// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../core/events ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ../libs/sortablejs/Sortable ./Widget ./Bookmarks/BookmarksViewModel ./support/widget".split(" "),function(t,u,e,n,p,h,f,q,r,k,c){var l={addBookmark:!0,thumbnail:!0};return function(m){function b(a,d){a=m.call(this,a,d)||this;a._handles=new p;a._addInputNode=null;a._editInputNode=null;a._addBookmarkButtonNode=null;a._focusAddBookmarkButton=!1;a._focusEditInputBox=!1;a._focusAddInputBox=
!1;a._addBookmark=!1;a._editBookmark=null;a._invalidEntry=!1;a._creatingBookmark=!1;a._sortable=null;a._sortableNode=null;a._focusSortUid=null;a._selectedSortUid=null;a._sortableSavedItems=null;a.bookmarkCreationOptions=null;a.bookmarks=null;a.disabled=!1;a.editingEnabled=!1;a.goToOverride=null;a.iconClass="esri-icon-bookmark";a.label=void 0;a.messages=null;a.messagesCommon=null;a.view=null;a.viewModel=new k;a.visibleElements=e.__assign({},l);return a}e.__extends(b,m);b.prototype.initialize=function(){var a=
this;this.own([h.init(this,"viewModel.bookmarks",function(){return a._bookmarksInitialized()}),h.init(this,"editingEnabled",function(){return a._toggleSorting()})])};b.prototype.destroy=function(){this._destroySortable();this._handles.destroy();this._handles=null};b.prototype.castVisibleElements=function(a){return e.__assign(e.__assign({},l),a)};b.prototype.endAddBookmark=function(){this._creatingBookmark=this._addBookmark=this._invalidEntry=!1;this.scheduleRender()};b.prototype.goTo=function(a){return this.viewModel.goTo(a)};
b.prototype.render=function(){var a,d="loading"===this.viewModel.state?this.renderLoading():this.renderBookmarks();return c.tsx("div",{class:this.classes("esri-bookmarks esri-widget--panel","esri-widget",(a={},a["esri-widget--disabled"]=this.disabled,a))},d)};b.prototype.startAddBookmark=function(){this._editBookmark=null;this._focusAddInputBox=this._addBookmark=!0;this.scheduleRender()};b.prototype.renderLoading=function(){return c.tsx("div",{class:"esri-bookmarks__loader-container",key:"loader"},
c.tsx("div",{class:"esri-bookmarks__loader"}))};b.prototype.renderNoBookmarksContainer=function(){var a=this.messages;return c.tsx("div",{class:"esri-widget__content--empty",key:"no-bookmarks"},c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-widget__no-bookmark-icon","esri-icon-bookmark")}),c.tsx("h1",{class:this.classes("esri-widget__heading","esri-bookmarks__no-bookmarks-heading")},a.noBookmarksHeading),c.tsx("p",{class:"esri-bookmarks__no-bookmarks-description"},a.noBookmarksDescription))};
b.prototype.renderAddBookmarkLoading=function(){return c.tsx("div",{key:"adding-bookmark",class:"esri-bookmarks__adding-bookmark"},c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-icon-loading-indicator","esri-rotating")}),this.messages.addingBookmark)};b.prototype.renderBookmarkItems=function(a){var d=this;return a?a.map(function(a){return d.editingEnabled&&d._editBookmark&&a&&d._editBookmark===a?d.renderEditingBookmark(a):d.renderBookmark(a)}).toArray():null};b.prototype.renderBookmarksContainer=
function(a){var d,b=this.editingEnabled&&!this._addBookmark?this.renderAddBookmarkButton():null,g=this.editingEnabled?this._creatingBookmark?this.renderAddBookmarkLoading():this._addBookmark?this.renderAddingBookmark():null:null;return[c.tsx("ul",{key:"bookmark-list","aria-label":this.messages.widgetLabel,class:this.classes("esri-bookmarks__list",(d={},d["esri-bookmarks__list--sortable"]=this.editingEnabled,d)),afterCreate:this._sortNodeCreated,afterRemoved:this._destroySortable,"data-node-ref":"_sortableNode",
bind:this},this.renderBookmarkItems(a)),b,g]};b.prototype.renderAddBookmarkButton=function(){return this.visibleElements.addBookmark?c.tsx("div",{key:"add-bookmark-item",class:"esri-bookmarks__add-bookmark"},c.tsx("button",{class:this.classes("esri-button","esri-button--tertiary","esri-bookmarks__add-bookmark-button"),onclick:this.startAddBookmark,afterCreate:this._storeAddBookmarkButton,afterUpdate:this._storeAddBookmarkButton,"data-node-ref":"_addBookmarkButtonNode",bind:this},c.tsx("span",{"aria-hidden":"true",
class:this.classes("esri-bookmarks__add-bookmark-icon","esri-icon-plus")}),this.messages.addBookmark)):null};b.prototype.renderBookmarks=function(){var a=this.viewModel.bookmarks,d=a&&a.filter(Boolean),d=(a=d&&d.length)||this.editingEnabled?this.renderBookmarksContainer(d):null;return[a?null:this.renderNoBookmarksContainer(),d]};b.prototype.renderEditContainer=function(a){var d=this.messagesCommon;return c.tsx("div",{key:"edit-container"},c.tsx("button",{title:d.edit,"aria-label":d.edit,"data-bookmark":a,
onclick:this._showEditBookmarkForm,bind:this,class:"esri-bookmarks__bookmark-edit-button"},c.tsx("span",{"aria-hidden":"true",class:"esri-icon-edit"})))};b.prototype.renderDragHandle=function(a){var d,b=this.messagesCommon,g=(d={},d["data-bookmark-uid"]=a.uid,d);return c.tsx("div",e.__assign({role:"button",tabIndex:0,key:"drag-handle",bind:this,class:"esri-bookmarks_bookmark-drag-handle",onkeydown:this._dragHandleKeydown,afterCreate:this._focusDragHandle,afterUpdate:this._focusDragHandle,onblur:this._dragHandleBlur,
"aria-pressed":this._selectedSortUid===a.uid?"true":"false","aria-label":b.dragHandleLabel,title:b.dragHandleTitle},g),c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-bookmarks_bookmark-drag-handle-icon","esri-icon-handle-vertical")}))};b.prototype.renderBookmarkImage=function(a){a=(a=a.thumbnail)&&a.url||"";return this.visibleElements.thumbnail&&a?c.tsx("img",{src:a,alt:"",class:"esri-bookmarks__image"}):c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-bookmarks__bookmark-icon",
"esri-icon-bookmark")})};b.prototype.renderBookmarkButton=function(a){var d=this.messagesCommon,d=a.name||d.untitled,b=c.tsx("div",{class:"esri-bookmarks__bookmark-image-container"},this.renderBookmarkImage(a));return c.tsx("button",{key:"bookmark-button",class:"esri-bookmarks__bookmark-button",bind:this,"data-bookmark":a,onclick:this._goToBookmark},b,c.tsx("span",{class:"esri-bookmarks__bookmark-name"},d))};b.prototype.renderBookmark=function(a){var d,b,g=this.viewModel.activeBookmark,g=(d={},d["esri-bookmarks__bookmark--active"]=
g===a,d);d=this.editingEnabled?this.renderEditContainer(a):null;var f=(b={},b["data-bookmark-uid"]=a.uid,b);b=this.editingEnabled?this.renderDragHandle(a):null;return c.tsx("li",e.__assign({key:a,class:this.classes("esri-bookmarks__bookmark",g)},f),b,this.renderBookmarkButton(a),d)};b.prototype.renderEditingBookmarkName=function(a){var d=this.messages;return c.tsx("label",{class:"esri-bookmarks__authoring-label"},d.title,c.tsx("input",{required:!0,bind:this,class:this.classes("esri-input",this._invalidEntry?
"esri-bookmarks__authoring-input--invalid":null),type:"text",value:a.name,afterCreate:this._storeEditInput,afterUpdate:this._focusEditInput,"data-bookmark":a,"data-node-ref":"_editInputNode",placeholder:d.addPlaceholder}))};b.prototype.renderEditingBookmarkActions=function(a){var d=this.messagesCommon;return c.tsx("div",{class:"esri-bookmarks__authoring-actions"},c.tsx("input",{type:"button",value:d.delete,class:this.classes("esri-button","esri-button--tertiary","esri-bookmarks__authoring-delete-button"),
"data-bookmark":a,onclick:this._deleteBookmark,bind:this}),c.tsx("input",{type:"button",value:d.cancel,class:this.classes("esri-button","esri-button--tertiary"),onclick:this._closeEditBookmarkForm,bind:this}),c.tsx("input",{class:"esri-button",type:"submit",value:d.save}))};b.prototype.renderEditingBookmark=function(a){var d,b=(d={},d["data-bookmark-uid"]=a.uid,d);return c.tsx("li",e.__assign({key:"edit-bookmark-form",class:"esri-bookmarks__authoring-card"},b),c.tsx("form",{class:"esri-bookmarks__authoring-form",
onsubmit:this._editBookmarkSubmit,bind:this},this.renderEditingBookmarkName(a),this.renderEditingBookmarkActions(a)))};b.prototype.renderAddingBookmarkName=function(){var a=this.messages;return c.tsx("label",{class:"esri-bookmarks__authoring-label"},a.title,c.tsx("input",{required:!0,bind:this,class:this.classes("esri-input",this._invalidEntry?"esri-bookmarks__authoring-input--invalid":null),type:"text",afterCreate:this._storeAddInput,afterUpdate:this._focusAddInput,"data-node-ref":"_addInputNode",
value:"",placeholder:a.addPlaceholder}))};b.prototype.renderAddingBookmarkActions=function(){var a=this.messagesCommon;return c.tsx("div",{class:this.classes("esri-bookmarks__authoring-actions")},c.tsx("input",{type:"button",value:a.cancel,class:this.classes("esri-button","esri-button--tertiary","esri-bookmarks__authoring-cancel-button"),onclick:this._endAddBookmark.bind(this),bind:this}),c.tsx("input",{class:"esri-button",type:"submit",value:a.add}))};b.prototype.renderAddingBookmark=function(){return c.tsx("div",
{key:"add-bookmark-form",class:"esri-bookmarks__authoring-card"},c.tsx("form",{class:"esri-bookmarks__authoring-form",onsubmit:this._addBookmarkSubmit,bind:this},this.renderAddingBookmarkName(),this.renderAddingBookmarkActions()))};b.prototype._dragHandleBlur=function(){this._selectedSortUid=null;this.scheduleRender()};b.prototype._dragHandleKeydown=function(a){a.stopPropagation();var b=this._sortableSavedItems,c=n.eventKey(a);if(-1!=="ArrowDown;ArrowUp;Escape;Tab; ;Enter".split(";").indexOf(c)){var g=
this._sortable,e=this._selectedSortUid,f=g.toArray();a=a.target.getAttribute("data-bookmark-uid");var h=f.indexOf(a);" "===c||"Enter"===c?(this._selectedSortUid=(g=e&&e===a)?null:a,this._sortableSavedItems=g?null:this._sortable.toArray(),this.scheduleRender()):"Tab"===c?(this._selectedSortUid=null,this.scheduleRender()):"Escape"===c&&b?(this._selectedSortUid=null,this._updateSortItems(b,g,a),this.scheduleRender()):-1!==h&&e&&(b="ArrowUp"===c?h-1:h+1,b>=f.length||-1>=b||(f.splice(b,0,f.splice(h,1)[0]),
this._updateSortItems(f,g,a)))}};b.prototype._updateSortItems=function(a,b,c){b.sort(a);this._sortBookmarks(b);this._selectedSortUid=this._focusSortUid=c};b.prototype._focusDragHandle=function(a){var b=this._focusSortUid;a&&b&&a.getAttribute("data-bookmark-uid")===b&&(a.focus(),this._focusSortUid=null)};b.prototype._toggleSorting=function(){var a=this,b=this._sortable,c=this._sortableNode,e=this.editingEnabled;if(c)if(b)b.option("disabled",!e);else{var f=q.create(c,{dataIdAttr:"data-bookmark-uid",
handle:".esri-bookmarks_bookmark-drag-handle",group:"bookmarks",disabled:!e,onSort:function(){return a._sortBookmarks(f)}});this._sortable=f}};b.prototype._sortNodeCreated=function(a){this._sortableNode=a;this._toggleSorting()};b.prototype._sortBookmarks=function(a){var b=this.viewModel.bookmarks;if(b){var c=a.toArray();b.sort(function(a,b){a=c.indexOf(a.uid);b=c.indexOf(b.uid);return a>b?1:a<b?-1:0})}};b.prototype._destroySortable=function(){var a=this._sortable;a&&a.destroy();this._sortable=null};
b.prototype._endAddBookmark=function(){this._focusAddBookmarkButton=!0;this.endAddBookmark()};b.prototype._bookmarksInitialized=function(){var a=this,b=this._handles;b.remove("bookmarks-init");b.add(h.on(this,"viewModel.bookmarks","change",function(){return a._bookmarksChanged()}),"bookmarks-init")};b.prototype._bookmarksChanged=function(){var a=this,b=this.viewModel.bookmarks,c=this._handles;c.remove("bookmarks-change");b=b.map(function(b){return h.watch(b,["active","name","thumbnail.url"],function(){return a.scheduleRender()})});
c.add(b,"bookmarks-change");this.scheduleRender()};b.prototype._showEditBookmarkForm=function(a){a=a.currentTarget["data-bookmark"];this._addBookmark=!1;this._focusEditInputBox=!0;this._editBookmark=a;this.scheduleRender()};b.prototype._closeEditBookmarkForm=function(){this._invalidEntry=!1;this._editBookmark=null;this.scheduleRender()};b.prototype._addBookmarkSubmit=function(a){var b=this;a.preventDefault();a=this._addInputNode;var c=this.bookmarkCreationOptions,e=a&&a.value.trim();e?(this._creatingBookmark=
!0,this.scheduleRender(),this.viewModel.createBookmark(c).then(function(a){a.name=e;b.viewModel.bookmarks.add(a);b._endAddBookmark()})):(this._invalidEntry=!0,this.scheduleRender())};b.prototype._editBookmarkSubmit=function(a){a.preventDefault();var b=this._editInputNode;a=this._editBookmark;(b=b&&b.value.trim())?(a.name=b,this._closeEditBookmarkForm()):(this._invalidEntry=!0,this.scheduleRender())};b.prototype._storeAddBookmarkButton=function(a){this._addBookmarkButtonNode=a;this._focusAddBookmark()};
b.prototype._storeEditInput=function(a){this._editInputNode=a;this._focusEditInput()};b.prototype._storeAddInput=function(a){this._addInputNode=a;this._focusAddInput()};b.prototype._focusAddInput=function(){this._addInputNode&&this._focusAddInputBox&&(this._focusAddInputBox=!1,this._addInputNode.focus())};b.prototype._focusAddBookmark=function(){this._addBookmarkButtonNode&&this._focusAddBookmarkButton&&(this._focusAddBookmarkButton=!1,this._addBookmarkButtonNode.focus())};b.prototype._focusEditInput=
function(){this._editInputNode&&this._focusEditInputBox&&(this._focusEditInputBox=!1,this._editInputNode.focus())};b.prototype._deleteBookmark=function(a){this.viewModel.bookmarks.remove(a.currentTarget["data-bookmark"])};b.prototype._goToBookmark=function(a){a=a.currentTarget["data-bookmark"];this.endAddBookmark();this._closeEditBookmarkForm();this.viewModel.goTo(a)};e.__decorate([f.property()],b.prototype,"bookmarkCreationOptions",void 0);e.__decorate([f.aliasOf("viewModel.bookmarks")],b.prototype,
"bookmarks",void 0);e.__decorate([c.renderable(),f.property()],b.prototype,"disabled",void 0);e.__decorate([c.renderable(),f.property()],b.prototype,"editingEnabled",void 0);e.__decorate([f.aliasOf("viewModel.goToOverride")],b.prototype,"goToOverride",void 0);e.__decorate([f.property()],b.prototype,"iconClass",void 0);e.__decorate([f.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],b.prototype,"label",void 0);e.__decorate([f.property(),c.renderable(),c.messageBundle("esri/widgets/Bookmarks/t9n/Bookmarks")],
b.prototype,"messages",void 0);e.__decorate([f.property(),c.renderable(),c.messageBundle("esri/t9n/common")],b.prototype,"messagesCommon",void 0);e.__decorate([f.aliasOf("viewModel.view")],b.prototype,"view",void 0);e.__decorate([f.property({type:k}),c.renderable(["activeBookmark","state","bookmarks"]),c.vmEvent(["select-bookmark"])],b.prototype,"viewModel",void 0);e.__decorate([f.property(),c.renderable()],b.prototype,"visibleElements",void 0);e.__decorate([f.cast("visibleElements")],b.prototype,
"castVisibleElements",null);e.__decorate([f.property()],b.prototype,"endAddBookmark",null);e.__decorate([f.property()],b.prototype,"startAddBookmark",null);return b=e.__decorate([f.subclass("esri.widgets.Bookmarks")],b)}(r)});