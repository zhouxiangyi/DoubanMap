// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../core/Collection ../core/events ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ../libs/sortablejs/Sortable ./Widget ./support/widget ./TableList/ListItem ./TableList/TableListViewModel ./TableList/support/tableListUtils".split(" "),function(C,D,g,v,w,x,l,h,y,z,d,A,t,r){var B=v.ofType(A);return function(u){function b(a,c){a=u.call(this,a,c)||this;a._handles=new x;a._sortable=null;a._sortableNode=null;a._focusSortUid=null;a.visibleItems=null;a.iconClass=
"esri-icon-table";a.label=void 0;a.listItemCreatedFunction=null;a.map=null;a.messages=null;a.messagesCommon=null;a.multipleSelectionEnabled=!1;a.selectionEnabled=!1;a.selectedItems=new B;a.tableItems=null;a.viewModel=new t;return a}g.__extends(b,u);b.prototype.initialize=function(){var a=this;this._setVisibleItems(this.tableItems);this.own(l.on(this.viewModel,"tableItems","change",function(){return a._itemsChanged()}),l.init(this,"selectionEnabled",function(){return a._toggleSorting()}))};b.prototype.destroy=
function(){this._destroySortable();this._handles.destroy();this._handles=null};b.prototype.triggerAction=function(a,c){this.viewModel.triggerAction(a,c)};b.prototype.render=function(){var a,c,e=this.visibleItems,f=null===(c=this.viewModel)||void 0===c?void 0:c.state;c=(a={},a["esri-hidden"]="loading"===f,a["esri-disabled"]="disabled"===f,a);return d.tsx("div",{class:this.classes("esri-table-list","esri-widget","esri-widget--panel",c)},(null===e||void 0===e?0:e.length)?this.renderList():this.renderNoItems())};
b.prototype.renderNoItems=function(){return d.tsx("div",{class:"esri-table-list__no-items"},this.messages.noItemsToDisplay)};b.prototype.renderList=function(){var a=this,c=this.visibleItems;return d.tsx("ul",{"aria-label":this.messages.widgetLabel,role:this.selectionEnabled?"listbox":void 0,afterCreate:this._sortNodeCreated,afterRemoved:this._destroySortable,"data-node-ref":"_sortableNode",bind:this,class:this.classes("esri-table-list__list","esri-table-list__list--root")},c.map(function(c){return a.renderItem(c)}).toArray())};
b.prototype.renderItem=function(a){var c,e,f,b=this.selectionEnabled,h=this.selectedItems,q=this.id+"_"+a.uid+"__title",k=!!a.error,k=(c={},c["esri-table-list__item--error"]=!!k,c["esri-table-list__item--selectable"]=b,c);return b?(c=(e={},e["data-layer-uid"]=null===(f=a.layer)||void 0===f?void 0:f.uid,e),d.tsx("li",g.__assign({key:"item-with-selection-"+a.uid,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes("esri-table-list__item",k),"aria-labelledby":q,
onclick:this._toggleSelection,onkeydown:this._selectionKeydown,"data-item":a,tabIndex:0,"aria-selected":r.findSelectedItem(a,h)?"true":"false",role:"option"},c),this.renderItemContent(a,q))):d.tsx("li",{key:"item-no-selection-"+a.uid,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes("esri-table-list__item",k),"aria-labelledby":q},this.renderItemContent(a,q))};b.prototype.renderActionsMenuIcon=function(a,c){var e,f=this.messagesCommon,b=(e={},e["esri-table-list__item-actions-menu-item--active"]=
a.actionsOpen,e);e=a.actionsOpen?f.close:f.open;return d.tsx("div",{key:"actions-menu-toggle","data-item":a,bind:this,onclick:this._toggleActionsOpen,onkeydown:this._toggleActionsOpen,class:this.classes("esri-table-list__item-actions-menu-item",b),tabindex:"0",role:"button","aria-controls":c,"aria-label":e,title:e},d.tsx("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"}))};b.prototype.renderActionsMenu=function(a,c,e,f){var b=(c=1===e&&this._getSingleActionButton(c))?this.renderAction({item:a,
action:c,singleAction:!0}):null;return(a=!c&&e?this.renderActionsMenuIcon(a,f):null)||c?d.tsx("div",{key:"actions-menu",class:"esri-table-list__item-actions-menu"},b,a):null};b.prototype.renderError=function(a){return a.error?d.tsx("div",{key:"error",class:"esri-table-list__item-error-message",role:"alert"},d.tsx("span",null,this.messages.tableError)):null};b.prototype.renderItemContent=function(a,c){var e=this.id+"_"+a.uid+"_actions",f=this._filterActions(a.actionsSections),b=this._countActions(f);
return[d.tsx("div",{key:"list-item-container",class:"esri-table-list__item-container"},this.renderLabel(a,c),this.renderActionsMenu(a,f,b,e)),this.renderError(a),b?this.renderActionsSections(a,f,e):null]};b.prototype.renderTitle=function(a,c){var e=this.messages;return d.tsx("span",{key:"layer-title-container",id:c,class:"esri-table-list__item-title"},a.title||e.untitledTable)};b.prototype.renderItemError=function(a){return a.error?d.tsx("span",{key:"notice-triangle","aria-hidden":"true",class:"esri-icon-notice-triangle"}):
null};b.prototype.renderLabel=function(a,c){return a.error?[this.renderItemError(a),this.renderTitle(a,c)]:this.renderTitle(a,c)};b.prototype.renderActionsSections=function(a,c,e){var f=this;c=c.toArray().map(function(c){return d.tsx("ul",{key:c,class:"esri-table-list__item-actions-list"},f.renderActionSection(a,c))});return d.tsx("div",{role:"group","aria-expanded":a.actionsOpen?"true":"false",key:"actions-section",id:e,class:"esri-table-list__item-actions",hidden:a.actionsOpen?null:!0},c)};b.prototype.renderActionSection=
function(a,c){var e=this;return(c&&c.toArray()).map(function(c){return e.renderAction({item:a,action:c})})};b.prototype.renderActionIcon=function(a){var c,e=a.active,b=a.className,m=this._getIconImageStyles(a);a="button"!==a.type||a.image||b?b:"esri-icon-default-action";b=(c={},c["esri-table-list__item-action-image"]=!e&&!!m["background-image"],c["esri-icon-loading-indicator"]=e,c["esri-rotating"]=e,c);a&&!e&&(b[a]=!0);return d.tsx("span",{key:"action-icon","aria-hidden":"true",class:this.classes("esri-table-list__item-action-icon",
b),styles:m})};b.prototype.renderActionTitle=function(a,c){return c?null:d.tsx("span",{key:"action-title",class:"esri-table-list__item-action-title"},a)};b.prototype.renderAction=function(a){var c,e=a.item,b=a.action;a=a.singleAction;var m=b.active,g=b.disabled,h=b.title,m=(c={},c["esri-table-list__item-actions-menu-item"]=a&&"button"===b.type,c["esri-table-list__item-action"]=m||!a&&"toggle"!==b.type,c["esri-table-list__action-toggle"]=!m&&"toggle"===b.type,c["esri-table-list__action-toggle--on"]=
!m&&"toggle"===b.type&&b.value,c["esri-disabled-element"]=g,c);c=[this.renderActionIcon(b),this.renderActionTitle(h,a)];return a?d.tsx("div",{bind:this,"data-item":e,"data-action":b,role:"button",key:b,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:m,tabindex:"0",title:h,"aria-label":h},c):d.tsx("li",{bind:this,"data-item":e,"data-action":b,key:b,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:m,tabindex:"0",role:"button",title:h,"aria-label":h},c)};b.prototype._filterActions=
function(a){return a.map(function(a){return a.filter(function(a){return a.visible})})};b.prototype._setVisibleItems=function(a){var c=this;this.visibleItems=null===a||void 0===a?void 0:a.filter(function(a){return c.errorsVisible||!a.error})};b.prototype._destroySortable=function(){var a=this._sortable;a&&a.destroy();this._sortable=null};b.prototype._toggleSorting=function(){var a=this,c=this._sortable,b=this._sortableNode,f=this.selectionEnabled;if(b)if(c)c.option("disabled",!f);else{var d=y.create(b,
{dataIdAttr:"data-layer-uid",group:"root-tables",fallbackTolerance:4,disabled:!f,onSort:function(){return a._sortTablesToItems(d.toArray())},chosenClass:"esri-table-list__item--chosen"});this._sortable=d}};b.prototype._sortNodeCreated=function(a){this._sortableNode=a;this._toggleSorting()};b.prototype._sortTablesToItems=function(a){var c=this.get("map.tables");c&&c.sort(function(c,b){c=a.indexOf(c.uid);b=a.indexOf(b.uid);return c>b?-1:c<b?1:0})};b.prototype._getSingleActionButton=function(a){return a.reduce(function(a){return a}).filter(function(a){return a&&
"button"===a.type}).getItemAt(0)};b.prototype._focusListItem=function(a){var c,b=this._focusSortUid;a&&b&&(null===(c=a["data-item"].layer)||void 0===c?void 0:c.uid)===b&&(a.focus(),this._focusSortUid=null)};b.prototype._watchActionSectionChanges=function(a,c){var b=this,f="action-section"+c;this._handles.add(a.on("change",function(){return b.scheduleRender()}),f);a.forEach(function(a){return b._renderOnActionChanges(a,c)})};b.prototype._renderOnActionChanges=function(a,c){var b=this;c="actions"+c;
var f=function(){return b.scheduleRender()};"toggle"===a.type?this._handles.add([l.init(a,"className image id title visible value".split(" "),f)],c):"slider"===a.type?this._handles.add([l.init(a,"className id title visible value displayValueEnabled max min step".split(" "),f)],c):this._handles.add([l.init(a,["className","image","id","title","visible"],f)],c)};b.prototype._renderOnItemChanges=function(a){var c=this,b=a.uid,f="items"+b,d=function(){return c.scheduleRender()};this._handles.add([l.init(a,
["actionsOpen","open","title","error"],d),a.actionsSections.on("change",d)],f);a.actionsSections.forEach(function(a){return c._watchActionSectionChanges(a,b)})};b.prototype._itemsChanged=function(){var a=this,c=this.viewModel.tableItems;this._setVisibleItems(c);this._handles.removeAll();c.forEach(function(c){return a._renderOnItemChanges(c)});this.scheduleRender()};b.prototype._countActions=function(a){return a.reduce(function(a,b){return a+b.length},0)};b.prototype._getIconImageStyles=function(a){a=
"esri.support.Action.ActionButton"===a.declaredClass||"esri.support.Action.ActionToggle"===a.declaredClass?a.image:null;return{"background-image":a?'url("'+a+'")':null}};b.prototype._selectionKeydown=function(a){var c,b,f,d,h=w.eventKey(a);if(-1===["ArrowDown","ArrowUp"].indexOf(h))this._toggleSelection(a);else{a.stopPropagation();var g=a.currentTarget["data-item"],k=this._sortable,l=r.findSelectedItem(g,this.selectedItems),n=k.toArray();a=n.indexOf(a.target.dataset.layerUid);if(-1!==a){if("ArrowDown"===
h){var p=a+1;if(p>=n.length)return;l?(n.splice(p,0,n.splice(a,1)[0]),k.sort(n),this._sortTablesToItems(k.toArray()),this._focusSortUid=null===(c=g.layer)||void 0===c?void 0:c.uid):(this._focusSortUid=null===(b=g.layer)||void 0===b?void 0:b.uid,this.scheduleRender())}"ArrowUp"===h&&(p=a-1,-1>=p||(l?(n.splice(p,0,n.splice(a,1)[0]),k.sort(n),this._sortTablesToItems(k.toArray()),this._focusSortUid=null===(f=g.layer)||void 0===f?void 0:f.uid):(this._focusSortUid=null===(d=g.layer)||void 0===d?void 0:d.uid,
this.scheduleRender())))}}};b.prototype._toggleActionsOpen=function(a){var c=a.currentTarget["data-item"],b=!c.actionsOpen;b&&this.tableItems.forEach(function(a){a.actionsOpen&&(a.actionsOpen=!1)});c.actionsOpen=b;a.stopPropagation()};b.prototype._triggerAction=function(a){var c=a.currentTarget,b=c["data-action"],c=c["data-item"];"toggle"===b.type&&(b.value=!b.value);this.triggerAction(b,c);a.stopPropagation()};b.prototype._toggleSelection=function(a){a.stopPropagation();var c=this.selectedItems,
b=this.multipleSelectionEnabled&&(a.metaKey||a.ctrlKey);a=a.currentTarget["data-item"];var d=r.findSelectedItem(a,c),g=c.length,h=d&&1===g;b?d?c.remove(d):c.add(a):g&&!h?(c.removeAll(),c.add(a)):d?c.remove(d):c.add(a)};g.__decorate([h.property()],b.prototype,"visibleItems",void 0);g.__decorate([h.property()],b.prototype,"iconClass",void 0);g.__decorate([h.property(),d.renderable()],b.prototype,"errorsVisible",void 0);g.__decorate([h.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],
b.prototype,"label",void 0);g.__decorate([h.aliasOf("viewModel.listItemCreatedFunction"),d.renderable()],b.prototype,"listItemCreatedFunction",void 0);g.__decorate([h.aliasOf("viewModel.map")],b.prototype,"map",void 0);g.__decorate([h.property(),d.renderable(),d.messageBundle("esri/widgets/TableList/t9n/TableList")],b.prototype,"messages",void 0);g.__decorate([h.property(),d.renderable(),d.messageBundle("esri/t9n/common")],b.prototype,"messagesCommon",void 0);g.__decorate([h.property()],b.prototype,
"multipleSelectionEnabled",void 0);g.__decorate([h.property(),d.renderable()],b.prototype,"selectionEnabled",void 0);g.__decorate([h.property(),d.renderable()],b.prototype,"selectedItems",void 0);g.__decorate([h.aliasOf("viewModel.tableItems"),d.renderable()],b.prototype,"tableItems",void 0);g.__decorate([d.vmEvent("trigger-action"),h.property({type:t}),d.renderable("viewModel.state")],b.prototype,"viewModel",void 0);g.__decorate([h.aliasOf("viewModel.triggerAction")],b.prototype,"triggerAction",
null);g.__decorate([d.accessibleHandler()],b.prototype,"_toggleActionsOpen",null);g.__decorate([d.accessibleHandler()],b.prototype,"_triggerAction",null);g.__decorate([d.accessibleHandler()],b.prototype,"_toggleSelection",null);return b=g.__decorate([h.subclass("esri.widgets.TableList")],b)}(z)});