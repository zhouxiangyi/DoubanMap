// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/accessorSupport/decorators ../../intl/date ../../layers/support/CodedValueDomain ../../layers/support/fieldUtils ../FeatureForm/InputField ./Grid/EditorColumn".split(" "),function(u,v,d,e,l,p,m,q,r){var t=l.convertDateFormatToIntlOptions("short-date-short-time");return function(n){function b(a){var c=n.call(this,a)||this;c._inputField=null;c.alias=null;c.cellValueFormatFunction=function(a){var b=a.value,f,d=c.config,e=c.type;return(a=c._getDomainForFeature(a.rowData.item.feature))?
c._getComputedDomain(b,a):"date"===e?(d=(null===(f=null===d||void 0===d?void 0:d.format)||void 0===f?0:f.format)?l.convertDateFormatToIntlOptions(d.format.format):t,b?l.formatDate(b,d):null):b};c.cellValueValidatorFunction=function(a){return a.oldValue!==a.value};c.config=null;c.defaultValue=null;c.description=null;c.direction=null;c.editingEnabled=!1;c.field=null;c.headerRenderFunction=function(a){var b=a.root,f=c.editable,d=c.editingEnabled,e=c.headerMenuEnabled,k=c.sortable;c.removeCellContent(b);
b.classList.add("esri-field-column__header-content");d&&!f&&b.appendChild(c.createLockedElement());k?c.headerSorterRenderFunction(a):(f=c.header,d=c.path,k=document.createElement("div"),k.innerHTML=f||d,b.appendChild(k));e&&c.headerMenuRenderFunction(a)};c.layer=null;c.menuConfig=null;c.name=null;c.nullable=!0;c.parseInputValueFunction=function(a){var b=c._inputField;a=a.input.value;var f=b.type;return b.required||""!==a?"number"===f||"date"===f?parseFloat(a):a:null};c.path=null;c.type=null;c.updateRowItemFunction=
function(a){a.rowData.item.feature.attributes[a.column.path]=a.value};return c}d.__extends(b,n);Object.defineProperty(b.prototype,"editable",{get:function(){var a,c,b,d;return"date"===(null===(a=this.field)||void 0===a?void 0:a.type)?!1:this.editingEnabled?this.config?!1===this.config.editable?!1:null===(c=this.field)||void 0===c?void 0:c.editable:null===(b=this.field)||void 0===b?void 0:b.editable:this.config?!0===this.config.editable&&(null===(d=this.field)||void 0===d?void 0:d.editable):!1},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"header",{get:function(){var a;return(null===(a=this.config)||void 0===a?void 0:a.label)||this.alias||this.path||null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hidden",{get:function(){var a=this.config;return!1===(null===a||void 0===a?void 0:a.visible)||this._get("hidden")||!1},set:function(a){this._set("hidden",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"loadingMessage",{get:function(){var a;
return(null===(a=this.messages)||void 0===a?void 0:a.loading)||"..."},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maxLength",{get:function(){var a,c,b=null===(a=this.field)||void 0===a?void 0:a.length;a=null===(c=this.config)||void 0===c?void 0:c.maxLength;return!isNaN(a)&&-1<=a&&(-1===b||a<=b)?a:b},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"required",{get:function(){var a=this.get("field.nullable"),c=this.get("config.required");return this.editable&&
(!a||!0===c)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"sortable",{get:function(){var a;return!1!==(null===(a=this.config)||void 0===a?void 0:a.sortable)},enumerable:!0,configurable:!0});b.prototype.createInputElement=function(a){var c=this,b=a.value;a=a.rowData.item;if(!a||!a.feature)return null;this._inputField=this._setUpInputField(a.feature,b);a=this.field;var d=this.maxLength,e=this.required,h=this._inputField.domain,g=null;"coded-value"===(null===h||void 0===h?void 0:
h.type)?(g=this._createSelectElement(b,h.codedValues.map(function(a){return{value:a.code,name:a.name}}),this._inputField),g.onchange=function(){g.onblur=null;l()}):(g=document.createElement("input"),g.type=m.isNumericField(a)?"number":"text",-1<d&&(g.maxLength=d));g.classList.add("esri-field-column__cell-input");g.value=b;g.required=e;var k=!1;g.onkeydown=function(a){k="Escape"===a.key};g.onblur=function(){g.onblur=null;l()};var l=function(){k?c.cancel():c.submit();c._inputField=null};return g};b.prototype.createInputContainer=
function(){var a=document.createElement("div");a.classList.add("esri-field-column__cell-input-container");return a};b.prototype.createLockedElement=function(){var a=document.createElement("div");a.classList.add("esri-icon-locked");return a};b.prototype.getCellValue=function(a,c){a=a.path;c=c.item;var b,d;return(null===(d=null===(b=null===c||void 0===c?void 0:c.feature)||void 0===b?void 0:b.attributes)||void 0===d?void 0:d[a])||null};b.prototype._createSelectElement=function(a,c,b){var d=!1;c=c.map(function(c){c.value===
a&&(d=!0);var b=document.createElement("option");b.text=c.name;b.value=c.value;return b});if(null!=a&&""!==a&&!d){var e=document.createElement("option");e.text=a;e.value=a;c.unshift(e)}b.required||null!=b.value||(e=document.createElement("option"),e.value="",c.unshift(e));var f=document.createElement("select");c.forEach(function(a){return f.add(a)});f.value=a;return f};b.prototype._setUpInputField=function(a,c){a=new q({config:this.config,feature:a,field:this.field,layer:this.layer,group:null,messages:null});
a.set("value",c);return a};b.prototype._isDomainCompatible=function(a){var c=this.field;if(a&&"coded-value"===a.type){var b=typeof a.codedValues[0].code;if("string"===b&&m.isStringField(c)||"number"===b&&m.isNumericField(c))return!0}return a&&"range"===a.type&&m.isNumericField(c)?!0:!1};b.prototype._getDomainForFeature=function(a){var c=this.layer,b=this.name,d=c.typeIdField,e=d===b,h=this.get("field.domain");if(e&&!h)return new p({name:"__internal-type-based-coded-value-domain__",codedValues:c.types.map(function(a){return{code:a.id,
name:a.name}})});a=d&&c.getFieldDomain(b,{feature:a})||h;c=this.get("config.domain");return this._isDomainCompatible(c)?c:a};b.prototype._getComputedDomain=function(a,b){return b?"range"===b.type?a:"coded-value"===b.type?(b=b.codedValues.filter(function(b){return b.hasOwnProperty("code")&&b.code===a}))&&b.length?b[0].name:a:null:null};d.__decorate([e.property({readOnly:!0,aliasOf:"field.alias"})],b.prototype,"alias",void 0);d.__decorate([e.property()],b.prototype,"cellValueFormatFunction",void 0);
d.__decorate([e.property()],b.prototype,"cellValueValidatorFunction",void 0);d.__decorate([e.property()],b.prototype,"config",void 0);d.__decorate([e.property({readOnly:!0,aliasOf:"field.defaultValue"})],b.prototype,"defaultValue",void 0);d.__decorate([e.property({readOnly:!0,aliasOf:"field.description"})],b.prototype,"description",void 0);d.__decorate([e.property()],b.prototype,"direction",void 0);d.__decorate([e.property({readOnly:!0,dependsOn:["config","editingEnabled","field.editable"]})],b.prototype,
"editable",null);d.__decorate([e.property()],b.prototype,"editingEnabled",void 0);d.__decorate([e.property()],b.prototype,"field",void 0);d.__decorate([e.property({readOnly:!0,dependsOn:["alias","config"]})],b.prototype,"header",null);d.__decorate([e.property({dependsOn:["config"]})],b.prototype,"hidden",null);d.__decorate([e.property()],b.prototype,"headerRenderFunction",void 0);d.__decorate([e.property()],b.prototype,"layer",void 0);d.__decorate([e.property({readOnly:!0,dependsOn:["messages"]})],
b.prototype,"loadingMessage",null);d.__decorate([e.property({dependsOn:["field.length","config"]})],b.prototype,"maxLength",null);d.__decorate([e.property({readOnly:!0,aliasOf:"config.menuConfig"})],b.prototype,"menuConfig",void 0);d.__decorate([e.property({readOnly:!0,aliasOf:"field.name"})],b.prototype,"name",void 0);d.__decorate([e.property({readOnly:!0,aliasOf:"field.nullable"})],b.prototype,"nullable",void 0);d.__decorate([e.property()],b.prototype,"parseInputValueFunction",void 0);d.__decorate([e.property({readOnly:!0,
aliasOf:"field.name"})],b.prototype,"path",void 0);d.__decorate([e.property({readOnly:!0,dependsOn:["field","config"]})],b.prototype,"required",null);d.__decorate([e.property({dependsOn:["config"]})],b.prototype,"sortable",null);d.__decorate([e.property({readOnly:!0,aliasOf:"field.type"})],b.prototype,"type",void 0);d.__decorate([e.property()],b.prototype,"updateRowItemFunction",void 0);return b=d.__decorate([e.subclass("esri.widgets.FeatureTable.FieldColumn")],b)}(r)});