// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../symbols ../../../core/promiseUtils ../../../renderers/support/numberUtils ../../../symbols/support/utils ./utils @dojo/framework/shim/Promise".split(" "),function(L,p,q,M,P,x,K,Q){function R(a,b){var c=a.length-1;return a.map(function(a,h){return Q.createStopLabel(a,h,c,b)})}function S(a,b){var c=null,g=null;"simple"===a.type?c=a.symbol:"class-breaks"===a.type?(c=(a=a.classBreakInfos)&&a[0]&&a[0].symbol,g=1<a.length):"unique-value"===a.type&&(c=(a=a.uniqueValueInfos)&&
a[0]&&a[0].symbol,g=1<a.length);if(!c||T(c))return null;c=c.clone();if(b||g)-1<c.type.indexOf("3d")?U(c):(b=c,-1!==b.type.indexOf("line")?b.color=A:(b.color=N,"simple-marker"===b.type&&(b.outline={color:A,width:1.5})));return c}function T(a){return a?M.isSymbol3D(a)?a.symbolLayers?a.symbolLayers.some(function(a){return a&&"fill"===a.type}):!1:-1!==a.type.indexOf("fill"):!1}function U(a){K.isVolumetricSymbol(a)||("line-3d"===a.type?a.symbolLayers.forEach(function(a){a.material={color:A}}):a.symbolLayers.forEach(function(a){"icon"!==
a.type||a.resource&&a.resource.href?a.material={color:V}:(a.material={color:N},a.outline={color:A,size:1.5})}))}function W(a,b,c,g){return q.__awaiter(this,void 0,void 0,function(){var h,k,d,f,l;return q.__generator(this,function(m){switch(m.label){case 0:return[4,new Promise(function(a,b){L(["../../../renderers/visualVariables/support/visualVariableUtils"],a,b)})];case 1:k=(h=m.sent().getSizeRangeAtScale(a,c,g))&&X(h);if(!h&&!k)return[2,void 0];d=k.map(function(b){var c=h.minSize,g=h.maxSize,d=a.minDataValue,
f=a.maxDataValue;return b<=c?d:b>=g?f:(b-c)/(g-c)*(f-d)+d});d=x.round(d);f=1;m.label=2;case 2:return f<d.length-1?[4,Y(a,b,d[f],d[f-1],c,g)]:[3,5];case 3:if(l=m.sent())d[f]=l[0],k[f]=l[1];m.label=4;case 4:return f++,[3,2];case 5:return[2,d]}})})}function X(a){var b=a.minSize;a=(a.maxSize-b)/4;for(var c=[],g=0;5>g;g++)c.push(b+a*g);return c}function Y(a,b,c,g,h,k){return q.__awaiter(this,void 0,void 0,function(){var d,f,l,m,B,p,n,u,v,r,e,t,w,C,D,E,F,H,y,I,J,O;return q.__generator(this,function(z){switch(z.label){case 0:return[4,
G(a,b,c,h,k)];case 1:return d=z.sent(),[4,G(a,b,g,h,k)];case 2:f=z.sent(),l=x.numDigits(c),m=l.fractional,B=20,p=l.integer,u=n=null,0<c&&1>c&&(n=Math.pow(10,m),c*=n,p=x.numDigits(c).integer),v=p-1,z.label=3;case 3:if(!(0<=v))return[3,8];r=Math.pow(10,v);e=Math.floor(c/r)*r;t=Math.ceil(c/r)*r;null!=n&&(e/=n,t/=n);w=(e+t)/2;O=x.round([e,w,t],{indexes:[1]});w=O[1];return[4,G(a,b,e,h,k)];case 4:return C=z.sent(),[4,G(a,b,t,h,k)];case 5:return D=z.sent(),[4,G(a,b,w,h,k)];case 6:E=z.sent();F=x.percentChange(d,
C,f,null);H=x.percentChange(d,D,f,null);y=x.percentChange(d,E,f,null);I=F.previous<=B;J=H.previous<=B;I&&J&&(F.previous<=H.previous?(I=!0,J=!1):(J=!0,I=!1));I?u=[e,C]:J?u=[t,D]:y.previous<=B&&(u=[w,E]);if(u)return[3,8];z.label=7;case 7:return v--,[3,3];case 8:return[2,u]}})})}function G(a,b,c,g,h){return q.__awaiter(this,void 0,void 0,function(){var k;return q.__generator(this,function(d){switch(d.label){case 0:return[4,new Promise(function(a,b){L(["../../../renderers/visualVariables/support/visualVariableUtils"],
a,b)})];case 1:return k=d.sent().getSize,[2,k(a,c,{scale:g,view:h,shape:"simple-marker"===b.type?b.style:null})]}})})}function Z(a,b){a=a.clone();if(M.isSymbol3D(a))K.isVolumetricSymbol(a)||a.symbolLayers.forEach(function(a){"fill"!==a.type&&(a.size=b)});else if("esri.symbols.SimpleMarkerSymbol"===a.declaredClass)a.size=b;else if("esri.symbols.PictureMarkerSymbol"===a.declaredClass){var c=a.width,g=a.height;a.height=b;a.width=c/g*b}else"esri.symbols.SimpleLineSymbol"===a.declaredClass?a.width=b:"esri.symbols.TextSymbol"===
a.declaredClass&&a.font&&(a.font.size=b);return a}Object.defineProperty(p,"__esModule",{value:!0});p.REAL_WORLD_MAX_SIZE=30;p.REAL_WORLD_MIN_SIZE=12;var N=[255,255,255],V=[200,200,200],A=[128,128,128];p.getRampStops=function(a,b,c,g,h,k){return q.__awaiter(this,void 0,void 0,function(){var d,f,l,m,B,A,n,u,v,r,e,t,w,C,D,E,F,H=this;return q.__generator(this,function(y){switch(y.label){case 0:f=(d=b.legendOptions)&&d.customValues;l=S(a,c);m=!!l;B=!!f;A=null!=b.minSize&&null!=b.maxSize;n=b.stops&&1<b.stops.length;
u=!!b.target;if(!m||!(B||A||n&&!u))return[2,void 0];v=K.isVolumetricSymbol(l);t=e=r=null;if(!v||n)return[3,1];e=x.round([b.minDataValue,b.maxDataValue]);return[3,4];case 1:return(w=f)?[3,3]:[4,W(b,l,g,h)];case 2:w=y.sent(),y.label=3;case 3:e=w,y.label=4;case 4:!e&&n&&(e=b.stops.map(function(a){return a.value}),(r=b.stops.some(function(a){return!!a.label}))&&(t=b.stops.map(function(a){return a.label})));v&&e&&2<e.length&&(e=[e[0],e[e.length-1]]);if(!e)return[2,null];C=[p.REAL_WORLD_MIN_SIZE,p.REAL_WORLD_MAX_SIZE];
D=K.getSymbolOutlineSize(l);E=r?null:R(e,k);return[4,P.all(e.map(function(a,c){return q.__awaiter(H,void 0,void 0,function(){var d,e,f,k;return q.__generator(this,function(m){switch(m.label){case 0:if(!v)return[3,1];f=C[c];return[3,3];case 1:return[4,G(b,l,a,g,h)];case 2:f=m.sent(),m.label=3;case 3:return d=f,e=Z(l,d),k=r?t[c]:E[c],[2,{value:a,symbol:e,label:k,size:d,outlineSize:D}]}})})}))];case 5:return F=y.sent(),[2,F.reverse()]}})})}});