// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define(["require","exports","./nextTick","./PooledArray","./promiseUtils"],function(z,b,m,n,e){function w(a){void 0===a&&(a=performance.now());b.debug.rafId=null;0<c.length&&(b.debug.rafId=d());b.debug.executeFrameTasks(a)}function d(){return b.debug.requestNextFrame?b.debug.requestNextFrame(p):p()}function q(){c.forEach(function(a){a.removed&&f.push(a)});c.removeUnorderedMany(f.data,f.length);f.clear()}function r(){for(;k.length;){var a=k.shift();a.isActive&&(a.isActive=!1,a.callback())}b.debug.willDispatch=
!1}function p(){return requestAnimationFrame(w)}Object.defineProperty(b,"__esModule",{value:!0});var x=function(){return function(a){this.phases=a;this.paused=!1;this.ticks=-1;this.removed=!1}}(),y=function(){function a(a){this.callback=a;this.isActive=!0}a.prototype.remove=function(){this.isActive=!1};return a}(),g=-1,l=0,h={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},t=["prepare","preRender","render","postRender","update"],k=[],c=new n,u=function(){function a(a){this._task=a}a.prototype.remove=
function(){this._task.removed=!0};a.prototype.pause=function(){this._task.paused=!0};a.prototype.resume=function(){this._task.paused=!1};return a}();b.FrameTaskHandle=u;b.debug={frameTasks:c,rafId:null,requestNextFrame:null,willDispatch:!1,clearFrameTasks:function(a){void 0===a&&(a=!1);c.forEach(function(a){a.removed=!0});a&&q()},dispatch:r,executeFrameTasks:function(a){void 0===a&&(a=performance.now());0>g&&(g=a);var b=a-g,v=0<l?l:1E3/60,f=Math.max(0,b-v);g=a;for(var e=function(d){var e=t[d];c.forEach(function(c){c.paused||
c.removed||(0===d&&c.ticks++,c.phases[e]&&(h.time=a,h.deltaTime=0===c.ticks?0:b,h.elapsedFrameTime=performance.now()-a,h.frameDuration=v-f,c.phases[e].call(c,h)))})},d=0;d<t.length;d++)e(d);q()}};b.schedule=function(a){a=new y(a);k.push(a);b.debug.willDispatch||(b.debug.willDispatch=!0,m(r));return a};b.addFrameTask=function(a){a=new x(a);c.push(a);b.debug.rafId||(g=-1,b.debug.rafId=d());return new u(a)};b.setFrameDuration=function(a){l=Math.max(0,a)};b.requestNextFrame=d;var f=new n;b.waitTicks=
function(a,b){void 0===a&&(a=1);var c=e.createResolver(),d=function(){e.isAborted(b)?c.reject(e.createAbortError()):0===a?c():(--a,m(function(){return d()}))};d();return c.promise}});