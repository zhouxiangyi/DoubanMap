// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/compilerUtils ../../core/maybe ../../support/arcadeOnDemand ./previewCIMSymbol ./previewSymbol2D ./previewSymbol3D ./previewWebStyleSymbol ./utils @dojo/framework/shim/Promise".split(" "),function(I,r,z,J,p,K,L,M,N,O,w){function u(b,a){switch(b.type){case "web-style":return O.previewWebStyleSymbol(b,u,a);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return N.previewSymbol3D(b,a);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":return M.previewSymbol2D(b,
a);case "cim":return L.previewCIMSymbol(b,a);default:J.neverReached(b)}}function E(b){return b&&"opacity"in b?b.opacity*E(b.parent):1}Object.defineProperty(r,"__esModule",{value:!0});var n=null;r.renderDotDensityPreviewHTML=function(b,a,c){var h=b.backgroundColor,k=b.outline;b=b.dotSize;var f=c&&c.swatchSize||22,d=Math.round(f*f/Math.pow(b,2)*.8),g=window.devicePixelRatio;c=document.createElement("canvas");var l=f*g;c.width=l;c.height=l;c.style.width=c.width/g+"px";c.style.height=c.height/g+"px";
var e=c.getContext("2d");h&&(e.fillStyle=h.toCss(!0),e.fillRect(0,0,l,l),e.fill());e.fillStyle=a.toCss(!0);if(n&&n.length/2===d)for(a=0;a<2*d;a+=2){var h=n[a],m=n[a+1];e.fillRect(h,m,b*g,b*g);e.fill()}else for(n=[],a=0;a<2*d;a+=2)h=Math.floor(Math.random()*(l-0+1)+0),m=Math.floor(Math.random()*(l-0+1)+0),n.push(h,m),e.fillRect(h,m,b*g,b*g),e.fill();k&&(k.color&&(e.strokeStyle=k.color.toCss(!0)),e.lineWidth=k.width,e.strokeRect(0,0,l,l));k=new Image(f,f);k.src=c.toDataURL();return k};r.renderColorRampPreviewHTML=
function(b,a){void 0===a&&(a={});var c="horizontal"===a.align,h=a.width,h=void 0===h?c?75:24:h,k=a.height,k=void 0===k?c?24:75:k;a=a.gradient;var f=void 0===a?!0:a;a=window.devicePixelRatio;var d=h*a,g=k*a;a=document.createElement("canvas");a.width=d;a.height=g;a.style.width=h+"px";a.style.height=k+"px";var l=a.getContext("2d"),e=c?d:0,m=c?0:g;if(f){var p=l.createLinearGradient(0,0,e,m),n=1/(b.length-1);b.forEach(function(a,b){return p.addColorStop(b*n,a.toString())});l.fillStyle=p;l.fillRect(0,0,
d,g)}else for(f=c?d/b.length:d,d=c?g:g/b.length,m=e=g=0;m<b.length;m++)l.fillStyle=b[m].toString(),l.fillRect(g,e,f,d),g=c?g+f:0,e=c?0:e+d;b=document.createElement("div");b.style.width=h+"px";b.style.height=k+"px";b.appendChild(a);return b};r.renderPreviewHTML=u;r.getDisplayedSymbol=function(b,a){return z.__awaiter(this,void 0,void 0,function(){var c,h,k,f,d,g,l,e,m,n,r,A,x,B,t,u,F,G,v,H,y,C,D;return z.__generator(this,function(q){switch(q.label){case 0:if(!b)return[2,void 0];c=E(b.layer||b.sourceLayer);
return!p.isSome(b.symbol)||p.isSome(a)&&!0===a.ignoreGraphicSymbol?[3,4]:"web-style"!==b.symbol.type?[3,2]:[4,b.symbol.fetchSymbol(p.isSome(a)?a.abortOptions:null)];case 1:return k=q.sent(),[3,3];case 2:k=b.symbol.clone(),q.label=3;case 3:return h=k,w.applyColorToSymbol(h,null,c),[2,h];case 4:return f=p.isSome(a)&&a.renderer||b.get("layer.renderer")||b.get("sourceLayer.renderer"),[4,f.getSymbolAsync(b)];case 5:return(d=q.sent())?"web-style"!==d.type?[3,7]:[4,d.fetchSymbol(p.isSome(a)?a.abortOptions:
null)]:[2,void 0];case 6:return d=q.sent(),[3,8];case 7:d=d.clone(),q.label=8;case 8:if(!("visualVariables"in f)||"visualVariables"in f&&!f.visualVariables||"visualVariables"in f&&f.visualVariables&&!f.visualVariables.length)return[2,d];if(!f.arcadeRequiredForVisualVariables||!p.isNone(a)&&!p.isNone(a.arcade))return[3,10];l=g=z.__assign({},p.unwrap(a));return[4,K.loadArcade()];case 9:l.arcade=q.sent(),a=g,q.label=10;case 10:return[4,new Promise(function(a,b){I(["../../renderers/visualVariables/support/visualVariableUtils"],
a,b)})];case 11:e=q.sent();m=[];n=[];r=[];A=[];x=0;for(B=f.visualVariables;x<B.length;x++)switch(t=B[x],t.type){case "color":m.push(t);break;case "opacity":n.push(t);break;case "rotation":A.push(t);break;case "size":t.target||r.push(t)}F=(u=!!m.length&&m[m.length-1])?e.getColor(u,b,a):null;v=(G=!!n.length&&n[n.length-1])?e.getOpacity(G,b,a):null;null!=c&&(v=null!=v?v*c:c);w.applyColorToSymbol(d,F,v);if(!r.length)return[3,13];H=e.getAllSizes(r,b,a);return[4,w.applySizesToSymbol(d,H)];case 12:q.sent(),
q.label=13;case 13:y=0;for(C=A;y<C.length;y++)D=C[y],w.applyRotationToSymbol(d,e.getRotationAngle(D,b,a),D.axis);return[2,d]}})})}});