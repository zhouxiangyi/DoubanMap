// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../request ../../core/Logger ../../core/promiseUtils ./cimAnalyzer".split(" "),function(x,e,b,p,q,r,t){function k(a,d){return b.__awaiter(this,void 0,void 0,function(){var c,g;return b.__generator(this,function(b){switch(b.label){case 0:if(a.data||!a.styleUrl||!a.styleName)return[2,a];c=a.styleName;g=a;return[4,u(c,a.styleUrl,d)];case 1:return g.data=b.sent(),[2,a]}})})}function u(a,d,c){return b.__awaiter(this,void 0,void 0,function(){var g,f;return b.__generator(this,
function(y){if(h.has(a))return[2,h.get(a).then(function(a){return e.makeSymbolRef(a.data)})];try{return g=d+"/resources/styles/cim/"+a+".json",f=p(g,b.__assign({responseType:"json",query:{f:"json"}},c)),h.set(a,f),[2,f.then(function(a){return e.makeSymbolRef(a.data)})]}catch(v){return w.error("error requesting "+a+", reason is "+v.message),h.has(a)&&h.delete(a),[2,null]}})})}var l=this;Object.defineProperty(e,"__esModule",{value:!0});var w=q.getLogger("esri/symbols/support/cimSymbolUtils"),m=function(){function a(a,
c){this.layers=a;this.data=c}Object.defineProperty(a.prototype,"type",{get:function(){return"expanded-cim"},enumerable:!0,configurable:!0});a.prototype.hash=function(){for(var a="",c=0,b=this.layers;c<b.length;c++)a+=b[c].templateHash;return a};return a}();e.expandSymbols=function(a,d,c){return b.__awaiter(l,void 0,void 0,function(){return b.__generator(this,function(b){return[2,r.all(a.map(function(a){return e.expandSymbol(a,d,c)}))]})})};var n=function(a,d){return b.__awaiter(l,void 0,void 0,function(){var c;
return b.__generator(this,function(b){switch(b.label){case 0:return c=m.bind,[4,t.analyzeCIMSymbol(a.data,d)];case 1:return[2,new (c.apply(m,[void 0,b.sent(),a.data]))]}})})};e.expandSymbol=function(a,d,c){return b.__awaiter(l,void 0,void 0,function(){var e,f;return b.__generator(this,function(b){switch(b.label){case 0:if(!a)return[2,null];if("cim"!==a.type)return[3,2];e=n;return[4,k(a,c)];case 1:return[2,e.apply(void 0,[b.sent(),d])];case 2:if("web-style"!==a.type)return[3,4];f=n;return[4,a.fetchCIMSymbol(c)];
case 3:return[2,f.apply(void 0,[b.sent(),d])];case 4:return[2,a]}})})};e.fetchSymbol=function(a,d){return b.__awaiter(this,void 0,void 0,function(){return b.__generator(this,function(b){return a?"cim"===a.type?[2,k(a,d)]:"web-style"===a.type?[2,a.fetchCIMSymbol(d)]:[2,a]:[2,null]})})};e.fetchCIMData=k;e.makeSymbolRef=function(a,b){return null===a?null:"CIMSymbolReference"===a.type?a:{type:"CIMSymbolReference",symbol:a,primitiveOverrides:b}};var h=new Map});