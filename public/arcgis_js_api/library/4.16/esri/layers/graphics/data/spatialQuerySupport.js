// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./utils @dojo/framework/shim/Promise".split(" "),function(v,d,l,h,g,p,w,e,q,r,t,u,x,m){function n(){return new Promise(function(a,c){v(["../../../geometry/geometryEngineJSON"],a,c)})}Object.defineProperty(d,
"__esModule",{value:!0});var y={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},z={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,
esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},A={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},B={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};d.importGeometryEngine=n;d.getGeodesicBufferOperator=function(){return n().then(function(a){return a.geodesicBuffer})};
d.getSpatialQueryOperator=function(a,c,b,k,f){if(e.isPolygon(c)&&"esriGeometryPoint"===b&&("esriSpatialRelIntersects"===a||"esriSpatialRelContains"===a)){var d=t.convertFromPolygon(new u.default,c,!1,!1);return g.resolve(function(a){return r.polygonContainsPoint(d,!1,!1,a)})}if(e.isPolygon(c)&&"esriGeometryMultipoint"===b){var h=t.convertFromPolygon(new u.default,c,!1,!1);if("esriSpatialRelContains"===a)return g.resolve(function(a){return r.polygonContainsMultipoint(h,!1,!1,a,k,f)})}if(e.isExtent(c)&&
"esriGeometryPoint"===b&&("esriSpatialRelIntersects"===a||"esriSpatialRelContains"===a))return g.resolve(function(a){return p.extentContainsPoint(c,m.getGeometry(b,k,f,a))});if(e.isExtent(c)&&"esriGeometryMultipoint"===b&&"esriSpatialRelContains"===a)return g.resolve(function(a){return p.extentContainsMultipoint(c,m.getGeometry(b,k,f,a))});if(e.isExtent(c)&&"esriSpatialRelIntersects"===a){var l=w.getExtentIntersector(b);return g.resolve(function(a){return l(c,m.getGeometry(b,k,f,a))})}return n().then(function(d){var e=
d[y[a]].bind(null,c.spatialReference,c);return function(a){return e(m.getGeometry(b,k,f,a))}})};d.checkSpatialQuerySupport=function(a,c,b){return l.__awaiter(this,void 0,void 0,function(){var d,f;return l.__generator(this,function(g){d=a.spatialRel;f=a.geometry;if(!f)return[2];if(!0!==z[d])throw new h("feature-store:unsupported-query","Unsupported query spatial relationship",{query:a});if(!q.isValid(f.spatialReference)||!q.isValid(b))return[2];if(!0!==A[e.getJsonType(f)])throw new h("feature-store:unsupported-query",
"Unsupported query geometry type",{query:a});if(!0!==B[c])throw new h("feature-store:unsupported-query","Unsupported layer geometry type",{query:a});return a.outSR?[2,x.checkProjectionSupport(a.geometry&&a.geometry.spatialReference,a.outSR)]:[2]})})};d.canQueryWithRBush=function(a){if(e.isExtent(a))return!0;if(e.isPolygon(a)){var c=0;for(a=a.rings;c<a.length;c++){var b=a[c];if(5!==b.length||b[0][0]!==b[1][0]||b[0][0]!==b[4][0]||b[2][0]!==b[3][0]||b[0][1]!==b[3][1]||b[0][1]!==b[4][1]||b[1][1]!==b[2][1])return!1}return!0}return!1}});