// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/number":function(){define(["require","exports","tslib","../core/string","../intl/locale"],function(y,b,p,n,c){function a(b){b||(b=c.getLocale());var a=b in x;if(!a){var l=b.split("-");1<l.length&&l[0]in x&&(b=l[0],a=!0);a||(b="en")}b=x[b];a=b[2];return{decimal:b[0],group:b[1],pattern:void 0===a?"#,##0.###":a}}function k(b,a,c){c=c||{};!0===c.places&&(c.places=0);Infinity===c.places&&(c.places=6);a=a.split(".");var l="string"===typeof c.places&&c.places.indexOf(","),h=c.places;
l?h=c.places.substring(l+1):0<=h||(h=(a[1]||[]).length);0>c.round||(b=Number(b.toFixed(Number(h))));b=String(Math.abs(b)).split(".");var e=b[1]||"";a[1]||c.places?(l&&(c.places=c.places.substring(0,l)),l=void 0!==c.places?c.places:a[1]&&a[1].lastIndexOf("0")+1,l>e.length&&(b[1]=n.padEnd(e,Number(l),"0")),h<e.length&&(b[1]=e.substr(0,Number(h)))):b[1]&&b.pop();h=a[0].replace(",","");l=h.indexOf("0");-1!==l&&(l=h.length-l,l>b[0].length&&(b[0]=n.padStart(b[0],l,"0")),-1===h.indexOf("#")&&(b[0]=b[0].substr(b[0].length-
l)));var h=a[0].lastIndexOf(","),t,z;-1!==h&&(t=a[0].length-h-1,a=a[0].substr(0,h),h=a.lastIndexOf(","),-1!==h&&(z=a.length-h-1));a=[];for(h=b[0];h;)l=h.length-t,a.push(0<l?h.substr(l):h),h=0<l?h.slice(0,l):"",z&&(t=z,z=void 0);b[0]=a.reverse().join(c.group||",");return b.join(c.decimal||".")}function f(b){b=b||{};var c=a(b.locale),l=b.pattern||c.pattern,f=c.group,h=c.decimal,e=1;if(-1!==l.indexOf("%"))e/=100;else if(-1!==l.indexOf("\u2030"))e/=1E3;else if(-1!==l.indexOf("\u00a4"))throw Error("currency notation not supported");
c=l.split(";");1===c.length&&c.push("-"+c[0]);return{regexp:v(c,function(a){a="(?:"+n.escapeRegExpString(a,".")+")";return a.replace(r,function(a){var c={signed:!1,separator:b.strict?f:[f,""],fractional:b.fractional,decimal:h,exponent:!1};a=a.split(".");var l=b.places;1===a.length&&1!==e&&(a[1]="###");1===a.length||0===l?c.fractional=!1:(void 0===l&&(l=b.pattern?a[1].lastIndexOf("0")+1:Infinity),l&&null==b.fractional&&(c.fractional=!0),!b.places&&l<a[1].length&&(l+=","+a[1].length),c.places=l);a=
a[0].split(",");1<a.length&&(c.groupSize=a.pop().length,1<a.length&&(c.groupSize2=a.pop().length));return"("+m(c)+")"})},!0).replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:f,decimal:h,factor:e}}function m(b){b=b||{};"places"in b||(b.places=Infinity);"string"!==typeof b.decimal&&(b.decimal=".");"fractional"in b&&!/^0/.test(String(b.places))||(b.fractional=[!0,!1]);"exponent"in b||(b.exponent=[!0,!1]);"eSigned"in b||(b.eSigned=[!0,!1]);var a=q(b),c=v(b.fractional,function(h){var e="";h&&0!==b.places&&(e="\\"+
b.decimal,e=Infinity===b.places?"(?:"+e+"\\d+)?":e+("\\d{"+b.places+"}"));return e},!0),l=v(b.exponent,function(h){return h?"([eE]"+q({signed:b.eSigned})+")":""}),a=a+c;c&&(a="(?:(?:"+a+")|(?:"+c+"))");return a+l}function q(b){b=b||{};"signed"in b||(b.signed=[!0,!1]);"separator"in b?"groupSize"in b||(b.groupSize=3):b.separator="";var a=v(b.signed,function(b){return b?"[-+]":""},!0),c=v(b.separator,function(a){if(!a)return"(?:\\d+)";a=n.escapeRegExpString(a);" "===a?a="\\s":"\u00a0"===a&&(a="\\s\\xa0");
var h=b.groupSize,e=b.groupSize2;return e?(a="(?:0|[1-9]\\d{0,"+(e-1)+"}(?:["+a+"]\\d{"+e+"})*["+a+"]\\d{"+h+"})",0<h-e?"(?:"+a+"|(?:0|[1-9]\\d{0,"+(h-1)+"}))":a):"(?:0|[1-9]\\d{0,"+(h-1)+"}(?:["+a+"]\\d{"+h+"})*)"},!0);return a+c}Object.defineProperty(b,"__esModule",{value:!0});var x={ar:[".",","],bs:[",","."],ca:[",","."],cs:[",","\u00a0"],da:[",","."],de:[",","."],"de-ch":[".","\u2019"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",","\u00a0"],fi:[",","\u00a0"],
fr:[",","\u202f"],"fr-ch":[",","\u202f"],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",","\u00a0"],id:[",","."],it:[",","."],"it-ch":[".","\u2019"],ja:[".",","],ko:[".",","],lt:[",","\u00a0"],lv:[",","\u00a0"],mk:[",","."],nb:[",","\u00a0"],nl:[",","."],pl:[",","\u00a0"],pt:[",","."],"pt-pt":[",","\u00a0"],ro:[",","."],ru:[",","\u00a0"],sk:[",","\u00a0"],sl:[",","."],sr:[",","."],sv:[",","\u00a0"],th:[".",","],tr:[",","."],uk:[",","\u00a0"],vi:[",","."],zh:[".",","]};b.getCustoms=a;
b.format=function(b,c){c=p.__assign({},c);var f=a(c.locale);c.customs=f;var l=c.pattern||f.pattern;if(isNaN(b)||Infinity===Math.abs(b))return null;c=c||{};var f=c.customs.group,h=c.customs.decimal,l=l.split(";"),e=l[0],l=l[0>b?1:0]||"-"+e;if(-1!==l.indexOf("%"))b*=100;else if(-1!==l.indexOf("\u2030"))b*=1E3;else{if(-1!==l.indexOf("\u00a4"))throw Error("currency notation not supported");if(-1!==l.indexOf("E"))throw Error("exponential notation not supported");}var t=r,e=e.match(t);if(!e)throw Error("unable to find a number expression in pattern: "+
l);!1===c.fractional&&(c.places=0);return l.replace(t,k(b,e[0],{decimal:h,group:f,places:c.places,round:c.round}))};var r=/[#0,]*[#0](?:\.0*#*)?/;b.regexp=function(b){return f(b).regexp};b._parseInfo=f;b.parse=function(b,a){a=f(a);b=(new RegExp("^"+a.regexp+"$")).exec(b);if(!b)return NaN;var c=b[1];if(!b[1]){if(!b[2])return NaN;c=b[2];a.factor*=-1}c=c.replace(new RegExp("["+a.group+"\\s\\xa0]","g"),"").replace(a.decimal,".");return Number(c)*a.factor};var v=function(b,a,c){if(!(b instanceof Array))return a(b);
for(var f=[],h=0;h<b.length;h++)f.push(a(b[h]));b=f.join("|");return"("+(c?"?:":"")+b+")"}})},"esri/geometry/projection":function(){define("require exports ../core/promiseUtils ./pe ./support/GeographicTransformation @dojo/framework/shim/Promise".split(" "),function(y,b,p,n,c){function a(b,a,l,m,q){void 0===q&&(q=null);if(null===q){var n=c.cacheKey(l,m);void 0!==x[n]?q=x[n]:(q=k(l,m,null),null===q&&(q=new c),x[n]=q)}return f._project(b,a,l,m,q)}function k(b,a,l){void 0===l&&(l=null);b=f._getTransformation(m,
b,a,l,null===l||void 0===l?void 0:l.spatialReference);return null!==b?c.fromGE(b):null}Object.defineProperty(b,"__esModule",{value:!0});var f=null,m=null;b.isLoaded=function(){return!!f&&n.isLoaded()};b.isSupported=function(){return n.isSupported()};var q=null;b.load=function(){return q?q:q=p.all([n.load(),new Promise(function(b,a){y(["./geometryEngineBase"],b,a)}),new Promise(function(b,a){y(["./geometryAdapters/hydrated"],b,a)})]).then(function(b){var a=b[1];m=b[2].hydratedAdapter;f=a;f._enableProjection(n)})};
b.project=function(b,c,f){void 0===f&&(f=null);return b instanceof Array?0===b.length?[]:a(m,b,b[0].spatialReference,c,f):a(m,[b],b.spatialReference,c,f)[0]};var x={};b.projectMany=a;b.getTransformation=k;b.getTransformations=function(b,a,l){void 0===l&&(l=null);b=f._getTransformationBySuitability(m,b,a,l,null===l||void 0===l?void 0:l.spatialReference);if(null!==b){a=[];for(l=0;l<b.length;l++)a.push(c.fromGE(b[l]));return a}return[]}})},"esri/geometry/pe":function(){define("require exports tslib ../assets ../core/has ../core/promiseUtils @dojo/framework/shim/Promise".split(" "),
function(y,b,p,n,c,a){function k(a){function e(b,a,e){b[a]=e(b[a])}b._pe=a;v.init();l.init();E.init();F.init();D.init();b.PeGCSExtent=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}p.__extends(e,a);e.prototype.destroy=function(){b._pe.destroy(this)};return e}(b._pe.PeGCSExtent);for(var h=0,c=[b._pe.PeDatum,b._pe.PeGeogcs,b._pe.PeGeogtran,b._pe.PeObject,b._pe.PeParameter,b._pe.PePrimem,b._pe.PeProjcs,b._pe.PeSpheroid,b._pe.PeUnit];h<c.length;h++)a=c[h],e(a.prototype,"getName",
function(b){return function(){return b.call(this,Array(v.PE_NAME_MAX))}});h=0;for(c=[b._pe.PeGeogtran,b._pe.PeProjcs];h<c.length;h++)a=c[h],e(a.prototype,"getParameters",function(a){return function(){for(var e=Array(v.PE_PARM_MAX),h=a.call(this),c=0;c<e.length;c++){var f=b._pe.getValue(h,"*");e[c]=f?b._pe.wrapPointer(f,b._pe.PeParameter):null;h+=Int32Array.BYTES_PER_ELEMENT}return e}});e(b._pe.PeHorizon.prototype,"getCoord",function(b){return function(){var a=this.getSize();if(!a)return null;var e=
[],h=b.call(this);x(e,a,h);return e}});e(b._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(a){var e=b._pe._pe_getPeGTlistExtendedGTsSize();return function(){var h=null,c=a.call(this);if(!b._pe.compare(c,b._pe.NULL)){var h=[c],f=this.getSteps();if(1<f)for(var c=b._pe.getPointer(c),t=1;t<f;t++)h.push(b._pe.wrapPointer(c+e*t,b._pe.PeGTlistExtendedGTs))}return h}});var f=b._pe._pe_getPeHorizonSize();a=function(a){return function(){var e=this._cache;e||(this._cache=e=new Map);if(e.has(a))return e.get(a);
var h=null,c=a.call(this);if(!b._pe.compare(c,b._pe.NULL)){var h=[c],t=c.getNump();if(1<t)for(var c=b._pe.getPointer(c),z=1;z<t;z++)h.push(b._pe.wrapPointer(c+f*z,b._pe.PeHorizon))}e.set(a,h);return h}};e(b._pe.PeProjcs.prototype,"horizonGcsGenerate",a);e(b._pe.PeProjcs.prototype,"horizonPcsGenerate",a);b._pe.PeObject.prototype.toString=function(a){void 0===a&&(a=v.PE_STR_OPTS_NONE);b._pe.ensureCache.prepare();var e=b._pe.getPointer(this),h=b._pe.ensureInt8(Array(v.PE_BUFFER_MAX));return b._pe.UTF8ToString(b._pe._pe_object_to_string_ext(e,
a,h))}}function f(a){if(a){var e=b._pe.getClass(a);e&&(e=b._pe.getCache(e))&&(a=b._pe.getPointer(a))&&delete e[a]}}function m(a,e){var c=[];e=Array(e);for(var h=0;h<a;h++)c.push(b._pe.ensureInt8(e));return c}function q(b){var a;Array.isArray(b[0])?(a=[],b.forEach(function(b){a.push(b[0],b[1])})):a=b;return a}function x(a,e,c,f){void 0===f&&(f=!1);if(f)for(f=0;f<2*e;f++)a[f]=b._pe.getValue(c+f*Float64Array.BYTES_PER_ELEMENT,"double");else{var h=0===a.length;for(f=0;f<e;f++)h&&(a[f]=Array(2)),a[f][0]=
b._pe.getValue(c,"double"),a[f][1]=b._pe.getValue(c+Float64Array.BYTES_PER_ELEMENT,"double"),c+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(b,"__esModule",{value:!0});var r;b._pe=null;b.isLoaded=function(){return!!b._pe};b.isSupported=function(){return!!c("esri-wasm")};b.load=function(){return r?r:r=a.create(function(b,a){(new Promise(function(b,a){y(["./support/pe-wasm"],b,a)})).then(function(e){e({locateFile:function(b){return n.getAssetUrl("esri/geometry/support/"+b)},onAbort:function(b){a(Error(b))}}).then(function(a){k(a);
b()})})})};(function(a){function e(a,e,c){b._pe.ensureCache.prepare();var h=q(c),f=c===h,h=b._pe.ensureFloat64(h);(a=b._pe._pe_geog_to_proj(b._pe.getPointer(a),e,h))&&x(c,e,h,f);return a}function c(b,a,e){return h(b,a,e,0)}function h(a,e,c,h){b._pe.ensureCache.prepare();var f=q(c),t=c===f,f=b._pe.ensureFloat64(f);(a=b._pe._pe_proj_to_geog_center(b._pe.getPointer(a),e,f,h))&&x(c,e,f,t);return a}a.geogToProj=e;a.projGeog=function(b,a,h,f){switch(f){case v.PE_TRANSFORM_P_TO_G:return c(b,a,h);case v.PE_TRANSFORM_G_TO_P:return e(b,
a,h)}return 0};a.projToGeog=c;a.projToGeogCenter=h})(b.PeCSTransformations||(b.PeCSTransformations={}));var v;(function(a){a.init=function(){a.PE_BUFFER_MAX=b._pe.PeDefs.prototype.PE_BUFFER_MAX;a.PE_NAME_MAX=b._pe.PeDefs.prototype.PE_NAME_MAX;a.PE_MGRS_MAX=b._pe.PeDefs.prototype.PE_MGRS_MAX;a.PE_USNG_MAX=b._pe.PeDefs.prototype.PE_USNG_MAX;a.PE_DD_MAX=b._pe.PeDefs.prototype.PE_DD_MAX;a.PE_DDM_MAX=b._pe.PeDefs.prototype.PE_DDM_MAX;a.PE_DMS_MAX=b._pe.PeDefs.prototype.PE_DMS_MAX;a.PE_UTM_MAX=b._pe.PeDefs.prototype.PE_UTM_MAX;
a.PE_PARM_MAX=b._pe.PeDefs.prototype.PE_PARM_MAX;a.PE_TYPE_NONE=b._pe.PeDefs.prototype.PE_TYPE_NONE;a.PE_TYPE_GEOGCS=b._pe.PeDefs.prototype.PE_TYPE_GEOGCS;a.PE_TYPE_PROJCS=b._pe.PeDefs.prototype.PE_TYPE_PROJCS;a.PE_TYPE_GEOGTRAN=b._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;a.PE_TYPE_COORDSYS=b._pe.PeDefs.prototype.PE_TYPE_COORDSYS;a.PE_TYPE_UNIT=b._pe.PeDefs.prototype.PE_TYPE_UNIT;a.PE_STR_OPTS_NONE=b._pe.PeDefs.prototype.PE_STR_OPTS_NONE;a.PE_STR_AUTH_NONE=b._pe.PeDefs.prototype.PE_STR_AUTH_NONE;a.PE_STR_AUTH_TOP=
b._pe.PeDefs.prototype.PE_STR_AUTH_TOP;a.PE_STR_NAME_CANON=b._pe.PeDefs.prototype.PE_STR_NAME_CANON;a.PE_PARM_X0=b._pe.PeDefs.prototype.PE_PARM_X0;a.PE_PARM_ND=b._pe.PeDefs.prototype.PE_PARM_ND;a.PE_TRANSFORM_1_TO_2=b._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;a.PE_TRANSFORM_2_TO_1=b._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;a.PE_TRANSFORM_P_TO_G=b._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;a.PE_TRANSFORM_G_TO_P=b._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;a.PE_HORIZON_RECT=b._pe.PeDefs.prototype.PE_HORIZON_RECT;
a.PE_HORIZON_POLY=b._pe.PeDefs.prototype.PE_HORIZON_POLY;a.PE_HORIZON_LINE=b._pe.PeDefs.prototype.PE_HORIZON_LINE;a.PE_HORIZON_DELTA=b._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(v=b.PeDefs||(b.PeDefs={}));(function(a){function e(a,e){var f=null,t=h[a];t||(t={},h[a]=t);t.hasOwnProperty(String(e))?f=t[e]:(a=b._pe.PeFactory.prototype.factoryByType(a,e),b._pe.compare(a,b._pe.NULL)||(f=a,t[e]=f));return f=c(f)}function c(a){if(a){var e=a.getType();switch(e){case v.PE_TYPE_GEOGCS:a=b._pe.castObject(a,b._pe.PeGeogcs);
break;case v.PE_TYPE_PROJCS:a=b._pe.castObject(a,b._pe.PeProjcs);break;case v.PE_TYPE_GEOGTRAN:a=b._pe.castObject(a,b._pe.PeGeogtran);break;default:e&v.PE_TYPE_UNIT&&(a=b._pe.castObject(a,b._pe.PeUnit))}}return a}var h={},f={};a.initialize=function(){b._pe.PeFactory.prototype.initialize(null)};a.coordsys=function(b){return e(v.PE_TYPE_COORDSYS,b)};a.factoryByType=e;a.fromString=function(a,e){var h=null,t=f[a];t||(t={},f[a]=t);t.hasOwnProperty(e)?h=t[e]:(a=b._pe.PeFactory.prototype.fromString(a,e),
b._pe.compare(a,b._pe.NULL)||(h=a,t[e]=h));return h=c(h)};a.geogcs=function(b){return e(v.PE_TYPE_GEOGCS,b)};a.geogtran=function(b){return e(v.PE_TYPE_GEOGTRAN,b)};a.getCode=function(a){return b._pe.PeFactory.prototype.getCode(a)};a.projcs=function(b){return e(v.PE_TYPE_PROJCS,b)};a.unit=function(b){return e(v.PE_TYPE_UNIT,b)}})(b.PeFactory||(b.PeFactory={}));b.PeGCSExtent=null;var l;(function(a){var e;a.init=function(){a.PE_GTLIST_OPTS_COMMON=b._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;
e=b._pe._pe_getPeGTlistExtendedEntrySize()};a.getGTlist=function(a,c,h,f,l,k){var t=null,z=new b._pe.PeInteger(k);try{var m=b._pe.PeGTlistExtended.prototype.getGTlist(a,c,h,f,l,z);if(k=z.val)if(t=[m],1<k){var G=b._pe.getPointer(m);for(a=1;a<k;a++)t.push(b._pe.wrapPointer(G+e*a,b._pe.PeGTlistExtendedEntry))}}finally{b._pe.destroy(z)}return t}})(l=b.PeGTlistExtended||(b.PeGTlistExtended={}));(function(a){a.destroy=function(a){if(a&&a.length){for(var e=0;e<a.length;e++){var c=a[e];f(c);c.getEntries().forEach(function(b){f(b);
b=b.getGeogtran();f(b);b.getParameters().forEach(f);[b.getGeogcs1(),b.getGeogcs2()].forEach(function(b){f(b);var a=b.getDatum();f(a);f(a.getSpheroid());f(b.getPrimem());f(b.getUnit())})})}b._pe.PeGTlistExtendedEntry.prototype.Delete(a[0])}}})(b.PeGTlistExtendedEntry||(b.PeGTlistExtendedEntry={}));(function(a){a.geogToGeog=function(a,c,f,h,l){b._pe.ensureCache.prepare();var e=q(f),t=f===e,e=b._pe.ensureFloat64(e),z=0;h&&(z=b._pe.ensureFloat64(h));(a=b._pe._pe_geog_to_geog(b._pe.getPointer(a),c,e,z,
l))&&x(f,c,e,t);return a}})(b.PeGTTransformations||(b.PeGTTransformations={}));(function(a){function e(a,e,c,f,h,t){b._pe.ensureCache.prepare();var l,z;switch(a){case "dd":l=b._pe._pe_geog_to_dd;z=v.PE_DD_MAX;break;case "ddm":l=b._pe._pe_geog_to_ddm;z=v.PE_DDM_MAX;break;case "dms":l=b._pe._pe_geog_to_dms,z=v.PE_DMS_MAX}a=0;e&&(a=b._pe.getPointer(e));e=q(f);e=b._pe.ensureFloat64(e);z=m(c,z);f=b._pe.ensureInt32(z);if(h=l(a,c,e,h,f))for(l=0;l<c;l++)t[l]=b._pe.UTF8ToString(z[l]);return h}function c(a,
e,c,f,h){b._pe.ensureCache.prepare();var t;switch(a){case "dd":t=b._pe._pe_dd_to_geog;break;case "ddm":t=b._pe._pe_ddm_to_geog;break;case "dms":t=b._pe._pe_dms_to_geog}a=0;e&&(a=b._pe.getPointer(e));e=f.map(function(a){return b._pe.ensureString(a)});f=b._pe.ensureInt32(e);e=b._pe.ensureFloat64(Array(2*c));(t=t(a,c,f,e))&&x(h,c,e);return t}a.geog_to_dms=function(b,a,c,f,h){return e("dms",b,a,c,f,h)};a.dms_to_geog=function(b,a,e,f){return c("dms",b,a,e,f)};a.geog_to_ddm=function(b,a,c,f,h){return e("ddm",
b,a,c,f,h)};a.ddm_to_geog=function(b,a,e,f){return c("ddm",b,a,e,f)};a.geog_to_dd=function(b,a,c,f,h){return e("dd",b,a,c,f,h)};a.dd_to_geog=function(b,a,e,f){return c("dd",b,a,e,f)}})(b.PeNotationDms||(b.PeNotationDms={}));var E;(function(a){a.init=function(){a.PE_MGRS_STYLE_NEW=b._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;a.PE_MGRS_STYLE_OLD=b._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;a.PE_MGRS_STYLE_AUTO=b._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;a.PE_MGRS_180_ZONE_1_PLUS=b._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;
a.PE_MGRS_ADD_SPACES=b._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};a.geog_to_mgrs_extended=function(a,c,f,h,l,k,n){b._pe.ensureCache.prepare();var e=0;a&&(e=b._pe.getPointer(a));a=q(f);f=b._pe.ensureFloat64(a);a=m(c,v.PE_MGRS_MAX);var t=b._pe.ensureInt32(a);if(h=b._pe._pe_geog_to_mgrs_extended(e,c,f,h,l,k,t))for(l=0;l<c;l++)n[l]=b._pe.UTF8ToString(a[l]);return h};a.mgrs_to_geog_extended=function(a,c,f,h,l){b._pe.ensureCache.prepare();var e=0;a&&(e=b._pe.getPointer(a));a=f.map(function(a){return b._pe.ensureString(a)});
f=b._pe.ensureInt32(a);a=b._pe.ensureFloat64(Array(2*c));(h=b._pe._pe_mgrs_to_geog_extended(e,c,f,h,a))&&x(l,c,a);return h}})(E=b.PeNotationMgrs||(b.PeNotationMgrs={}));(function(a){a.geog_to_usng=function(a,c,f,h,l,k,n){b._pe.ensureCache.prepare();var e=0;a&&(e=b._pe.getPointer(a));a=q(f);f=b._pe.ensureFloat64(a);a=m(c,v.PE_MGRS_MAX);var t=b._pe.ensureInt32(a);if(h=b._pe._pe_geog_to_usng(e,c,f,h,l,k,t))for(l=0;l<c;l++)n[l]=b._pe.UTF8ToString(a[l]);return h};a.usng_to_geog=function(a,c,f,h){b._pe.ensureCache.prepare();
var e=0;a&&(e=b._pe.getPointer(a));a=f.map(function(a){return b._pe.ensureString(a)});f=b._pe.ensureInt32(a);a=b._pe.ensureFloat64(Array(2*c));(e=b._pe._pe_usng_to_geog(e,c,f,a))&&x(h,c,a);return e}})(b.PeNotationUsng||(b.PeNotationUsng={}));var F;(function(a){a.init=function(){a.PE_UTM_OPTS_NONE=b._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;a.PE_UTM_OPTS_ADD_SPACES=b._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;a.PE_UTM_OPTS_NS=b._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};a.geog_to_utm=function(a,
c,f,h,l){b._pe.ensureCache.prepare();var e=0;a&&(e=b._pe.getPointer(a));a=q(f);f=b._pe.ensureFloat64(a);a=m(c,v.PE_UTM_MAX);var t=b._pe.ensureInt32(a);if(h=b._pe._pe_geog_to_utm(e,c,f,h,t))for(e=0;e<c;e++)l[e]=b._pe.UTF8ToString(a[e]);return h};a.utm_to_geog=function(a,c,f,h,l){b._pe.ensureCache.prepare();var e=0;a&&(e=b._pe.getPointer(a));a=f.map(function(a){return b._pe.ensureString(a)});f=b._pe.ensureInt32(a);a=b._pe.ensureFloat64(Array(2*c));(h=b._pe._pe_utm_to_geog(e,c,f,h,a))&&x(l,c,a);return h}})(F=
b.PeNotationUtm||(b.PeNotationUtm={}));var D;(function(a){var c=new Map;a.init=function(){a.PE_PCSINFO_OPTION_NONE=b._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;a.PE_PCSINFO_OPTION_DOMAIN=b._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;a.PE_POLE_OUTSIDE_BOUNDARY=b._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;a.PE_POLE_POINT=b._pe.PePCSInfo.prototype.PE_POLE_POINT};a.generate=function(e,f){void 0===f&&(f=a.PE_PCSINFO_OPTION_DOMAIN);var h,l;c.has(e)&&(l=c.get(e),l[f]&&(h=l[f]));h||(h=b._pe.PePCSInfo.prototype.generate(e,
f),l||(l=[],c.set(e,l)),l[f]=h);return h}})(D=b.PePCSInfo||(b.PePCSInfo={}));(function(a){a.version_string=function(){return b._pe.PeVersion.prototype.version_string()}})(b.PeVersion||(b.PeVersion={}));b._init=k})},"esri/geometry/support/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],function(y,b,p){return function(){function b(b){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(b&&b.steps){var a=0;for(b=b.steps;a<
b.length;a++){var c=b[a];c instanceof p?this.steps.push(c):this.steps.push(new p({wkid:c.wkid,wkt:c.wkt,isInverse:c.isInverse}))}}}b.cacheKey=function(b,a){return[void 0!==b.wkid&&null!==b.wkid?b.wkid.toString():"-1",void 0!==b.wkt&&null!==b.wkt?b.wkt.toString():"",void 0!==a.wkid&&null!==a.wkid?a.wkid.toString():"-1",void 0!==a.wkt&&null!==a.wkt?a.wkt.toString():""].join()};b.fromGE=function(c){var a=new b,k="",f=0;for(c=c.steps;f<c.length;f++){var m=p.fromGE(c[f]);a.steps.push(m);k+=m.uid.toString()+
","}a._cached_projection={};a._gtlistentry=null;a._chain=k;return a};b.prototype.getInverse=function(){var c=new b;c.steps=[];for(var a=this.steps.length-1;0<=a;a--)c.steps.push(this.steps[a].getInverse());return c};b.prototype.getGTListEntry=function(){for(var b="",a=0,k=this.steps;a<k.length;a++)b+=k[a].uid.toString()+",";b!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=b);return this._gtlistentry};b.prototype.assignCachedGe=function(c,a,k){this._cached_projection[b.cacheKey(c,
a)]=k};b.prototype.getCachedGeTransformation=function(c,a){for(var k="",f=0,m=this.steps;f<m.length;f++)k+=m[f].uid.toString()+",";k!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=k);c=this._cached_projection[b.cacheKey(c,a)];return void 0===c?null:c};return b}()})},"esri/geometry/support/GeographicTransformationStep":function(){define(["require","exports"],function(y,b){var p=0;return function(){function b(b){void 0===b&&(b=null);this.uid=p++;b?(this._wkt=void 0!==
b.wkt?b.wkt:null,this._wkid=void 0!==b.wkid?b.wkid:-1,this._isInverse=void 0!==b.isInverse?!0===b.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}b.fromGE=function(c){var a=new b;a._wkt=c.wkt;a._wkid=c.wkid;a._isInverse=c.isInverse;return a};Object.defineProperty(b.prototype,"wkt",{get:function(){return this._wkt},set:function(b){this._wkt=b;this.uid=p++},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"wkid",{get:function(){return this._wkid},set:function(b){this._wkid=
b;this.uid=p++},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isInverse",{get:function(){return this._isInverse},set:function(b){this._isInverse=b;this.uid=p++},enumerable:!0,configurable:!0});b.prototype.getInverse=function(){var c=new b;c._wkt=this.wkt;c._wkid=this._wkid;c._isInverse=!this.isInverse;return c};return b}()})},"esri/geometry/geometryAdapters/json":function(){define(["require","exports"],function(y,b){Object.defineProperty(b,"__esModule",{value:!0});b.jsonAdapter=
{convertToGEGeometry:function(a,b){return null==b?null:a.convertJSONToGeometry(b)},exportPoint:function(a,b,c){c=new p(a.getPointX(b),a.getPointY(b),c);var f=a.hasZ(b),k=a.hasM(b);f&&(c.z=a.getPointZ(b));k&&(c.m=a.getPointM(b));return c},exportPolygon:function(a,b,c){return new n(a.exportPaths(b),c,a.hasZ(b),a.hasM(b))},exportPolyline:function(a,b,k){return new c(a.exportPaths(b),k,a.hasZ(b),a.hasM(b))},exportMultipoint:function(b,c,k){return new a(b.exportPoints(c),k,b.hasZ(c),b.hasM(c))},exportExtent:function(a,
b,c){var f=a.hasZ(b),m=a.hasM(b);c=new k(a.getXMin(b),a.getYMin(b),a.getXMax(b),a.getYMax(b),c);f&&(f=a.getZExtent(b),c.zmin=f.vmin,c.zmax=f.vmax);m&&(a=a.getMExtent(b),c.mmin=a.vmin,c.mmax=a.vmax);return c}};var p=function(){return function(a,b,c){this.x=a;this.y=b;this.spatialReference=c;this.m=this.z=void 0}}(),n=function(){return function(a,b,c,k){this.rings=a;this.spatialReference=b;this.hasM=this.hasZ=void 0;c&&(this.hasZ=c);k&&(this.hasM=k)}}(),c=function(){return function(a,b,c,k){this.paths=
a;this.spatialReference=b;this.hasM=this.hasZ=void 0;c&&(this.hasZ=c);k&&(this.hasM=k)}}(),a=function(){return function(a,b,c,k){this.points=a;this.spatialReference=b;this.hasM=this.hasZ=void 0;c&&(this.hasZ=c);k&&(this.hasM=k)}}(),k=function(){return function(a,b,c,k,n){this.xmin=a;this.ymin=b;this.xmax=c;this.ymax=k;this.spatialReference=n;this.mmax=this.mmin=this.zmax=this.zmin=void 0}}()})},"esri/layers/graphics/data/FeatureStore":function(){define("require exports tslib ../../../core/Error ../../../core/Evented ../../../core/Logger ../../../core/maybe ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./BoundsStore ./executeTileQuery ./optimizedFeatureQueryEngineAdapter".split(" "),
function(y,b,p,n,c,a,k,f,m,q,x,r,v,l){Object.defineProperty(b,"__esModule",{value:!0});var E=a.getLogger("esri.layers.graphics.data.FeatureStore");y=function(){function a(a){this.geometryInfo=a;this._boundsStore=new r.BoundsStore;this._featuresById=new Map;this._markedIds=new Set;this.events=new c;this.featureAdapter=l.optimizedFeatureQueryEngineAdapter}Object.defineProperty(a.prototype,"geometryType",{get:function(){return this.geometryInfo.geometryType},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"hasM",{get:function(){return this.geometryInfo.hasM},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasZ",{get:function(){return this.geometryInfo.hasZ},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fullBounds",{get:function(){var a=this;if(!this.numFeatures)return null;var b=m.create(m.NEGATIVE_INFINITY);this._featuresById.forEach(function(c){if(c=
a._boundsStore.get(c.objectId))b[0]=Math.min(c[0],b[0]),b[1]=Math.min(c[1],b[1]),b[2]=Math.max(c[2],b[2]),b[3]=Math.max(c[3],b[3])});return b},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"storeStatistics",{get:function(){var a=0;this._featuresById.forEach(function(b){b.geometry&&b.geometry.coords&&(a+=b.geometry.coords.length)});return{featureCount:this._featuresById.size,vertexCount:a/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}},enumerable:!0,configurable:!0});a.prototype.add=
function(a){this._add(a);this._emitChanged()};a.prototype.addMany=function(a){for(var b=0;b<a.length;b++)this._add(a[b]);this._emitChanged()};a.prototype.clear=function(){this._featuresById.clear();this._boundsStore.clear();this._emitChanged()};a.prototype.removeById=function(a){a=this._featuresById.get(a);if(!a)return null;this._remove(a);this._emitChanged();return a};a.prototype.removeManyById=function(a){this._boundsStore.invalidateIndex();for(var b=0;b<a.length;b++){var c=this._featuresById.get(a[b]);
c&&this._remove(c)}this._emitChanged()};a.prototype.forEachBounds=function(a,b,c){for(var e=0;e<a.length;e++){var h=this._boundsStore.get(a[e].objectId);h&&b(f.fromRect(c,h))}};a.prototype.getFeature=function(a){return this._featuresById.get(a)};a.prototype.has=function(a){return this._featuresById.has(a)};a.prototype.forEach=function(a){this._featuresById.forEach(function(b){return a(b)})};a.prototype.forEachInBounds=function(a,b){var c=this;this._boundsStore.forEachInBounds(a,function(a){b(c._featuresById.get(a))})};
a.prototype.startMarkingUsedFeatures=function(){this._boundsStore.invalidateIndex();this._markedIds.clear()};a.prototype.sweep=function(){var a=this,b=!1;this._featuresById.forEach(function(c,f){a._markedIds.has(f)||(b=!0,a._remove(c))});this._markedIds.clear();b&&this._emitChanged()};a.prototype.executeTileQuery=function(a,b,c){return p.__awaiter(this,void 0,void 0,function(){var e,f,h,l,k,E,n,r,x,L,B,I,C,J;return p.__generator(this,function(t){e=c.returnGeometry;f=c.returnCentroid;h=c.returnOutline;
l=c.pixelBuffer;k=new Set;E=[];n=l*a.resolution;r=m.pad(a.bounds,n,m.create());v.createTileFeatures(E,k,this.geometryInfo,this,r,e,f,h,{originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[a.bounds[0],a.bounds[3]]});if("esriGeometryPoint"===this.geometryType||f)if(x=q.getInfo(b))L=x.valid,B=L[0],I=L[1],r[0]<B&&(C=m.fromValues(I-n,r[1],I,r[3]),v.createTileFeatures(E,k,this.geometryInfo,this,C,e,f,h,{originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[I,a.bounds[3]]})),
r[2]>I&&(J=m.fromValues(B,r[1],B+n,r[3]),v.createTileFeatures(E,k,this.geometryInfo,this,J,e,f,h,{originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[B-I+a.bounds[0],a.bounds[3]]}));E.sort(function(a,b){return a.localId-b.localId});return[2,{features:E,objectIds:k}]})})};a.prototype._emitChanged=function(){this.events.emit("changed",void 0)};a.prototype._add=function(a){if(a){var b=a.objectId;if(null==b)E.error(new n("featurestore:invalid-feature","feature id is missing",{feature:a}));
else{var c=this._featuresById.get(b),f;this._markedIds.add(b);if(c)a.localId=c.localId,f=this._boundsStore.get(b),this._boundsStore.delete(b);else if(k.isSome(this.onFeatureAdd))this.onFeatureAdd(a);a.geometry&&a.geometry.coords&&a.geometry.coords.length?(f=x.getBoundsOptimizedGeometry(f||m.create(),a.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),this._boundsStore.set(b,f)):this._boundsStore.set(b,null);this._featuresById.set(b,a)}}};a.prototype._remove=function(a){if(k.isSome(this.onFeatureRemove))this.onFeatureRemove(a);
this._markedIds.delete(a.objectId);this._boundsStore.delete(a.objectId);this._featuresById.delete(a.objectId);return a};return a}();b.default=y})},"esri/layers/graphics/data/BoundsStore":function(){define(["require","exports","../../../core/has","../../../core/libs/rbush/rbush","@dojo/framework/shim/Promise"],function(y,b,p,n){Object.defineProperty(b,"__esModule",{value:!0});var c={minX:0,minY:0,maxX:0,maxY:0};y=function(){function a(){var a=this;this._indexInvalid=!1;this._boundsToLoad=[];this._boundsById=
new Map;this._idByBounds=new Map;this._index=n(9,p("csp-restrictions")?function(a){return{minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]}}:["[0]","[1]","[2]","[3]"]);this._loadIndex=function(){if(a._indexInvalid){var b=Array(a._idByBounds.size),c=0;a._idByBounds.forEach(function(a,f){b[c++]=f});a._indexInvalid=!1;a._index.clear();a._index.load(b)}else a._boundsToLoad.length&&(a._index.load(a._boundsToLoad.filter(function(b){return a._idByBounds.has(b)})),a._boundsToLoad.length=0)}}a.prototype.clear=function(){this._indexInvalid=
!1;this._boundsToLoad.length=0;this._boundsById.clear();this._idByBounds.clear();this._index.clear()};a.prototype.delete=function(a){var b=this._boundsById.get(a);this._boundsById.delete(a);b&&(this._idByBounds.delete(b),this._indexInvalid||this._index.remove(b))};a.prototype.forEachInBounds=function(a,b){this._loadIndex();var f=0,k=this._index;c.minX=a[0];c.minY=a[1];c.maxX=a[2];c.maxY=a[3];for(a=k.search(c);f<a.length;f++)b(this._idByBounds.get(a[f]))};a.prototype.get=function(a){return this._boundsById.get(a)};
a.prototype.has=function(a){return this._boundsById.has(a)};a.prototype.invalidateIndex=function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)};a.prototype.set=function(a,b){if(!this._indexInvalid){var c=this._boundsById.get(a);c&&(this._index.remove(c),this._idByBounds.delete(c))}this._boundsById.set(a,b);b&&(this._idByBounds.set(b,a),this._indexInvalid||(this._boundsToLoad.push(b),5E4<this._boundsToLoad.length&&this._loadIndex()))};return a}();b.BoundsStore=y})},"esri/core/libs/rbush/rbush":function(){define(["../quickselect/quickselect"],
function(y){function b(a,c){if(!(this instanceof b))return new b(a,c);this._maxEntries=Math.max(4,a||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));c&&("function"===typeof c?this.toBBox=c:this._initFormat(c));this.clear()}function p(a,b){n(a,0,a.children.length,b,a)}function n(a,b,f,k,h){h||(h=r(null));h.minX=Infinity;h.minY=Infinity;h.maxX=-Infinity;h.maxY=-Infinity;for(var e;b<f;b++)e=a.children[b],c(h,a.leaf?k(e):e);return h}function c(a,b){a.minX=Math.min(a.minX,b.minX);a.minY=
Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=Math.max(a.maxY,b.maxY);return a}function a(a,b){return a.minX-b.minX}function k(a,b){return a.minY-b.minY}function f(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function m(a){return a.maxX-a.minX+(a.maxY-a.minY)}function q(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function x(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function r(a){return{children:a,height:1,leaf:!0,minX:Infinity,
minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function v(a,b,c,f,h){for(var e=[b,c],l;e.length;)c=e.pop(),b=e.pop(),c-b<=f||(l=b+Math.ceil((c-b)/f/2)*f,y(a,l,b,c,h),e.push(b,l,l,c))}b.prototype={all:function(){return this._all(this.data,[])},search:function(a){var b=this.data,c=[],f=this.toBBox;if(!x(a,b))return c;for(var h=[],e,l,k,m;b;){e=0;for(l=b.children.length;e<l;e++)k=b.children[e],m=b.leaf?f(k):k,x(a,m)&&(b.leaf?c.push(k):q(a,m)?this._all(k,c):h.push(k));b=h.pop()}return c},collides:function(a){var b=
this.data,c=this.toBBox;if(!x(a,b))return!1;for(var f=[],h,e,l,k;b;){h=0;for(e=b.children.length;h<e;h++)if(l=b.children[h],k=b.leaf?c(l):l,x(a,k)){if(b.leaf||q(a,k))return!0;f.push(l)}b=f.pop()}return!1},load:function(a){if(!a||!a.length)return this;if(a.length<this._minEntries){for(var b=0,c=a.length;b<c;b++)this.insert(a[b]);return this}a=this._build(a.slice(),0,a.length-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(b=this.data,
this.data=a,a=b),this._insert(a,this.data.height-a.height-1,!0)):this.data=a;return this},insert:function(a){a&&this._insert(a,this.data.height-1);return this},clear:function(){this.data=r([]);return this},remove:function(a,b){if(!a)return this;for(var c=this.data,f=this.toBBox(a),h=[],e=[],k,l,m,n;c||h.length;){c||(c=h.pop(),l=h[h.length-1],k=e.pop(),n=!0);if(c.leaf){a:{m=a;var r=c.children,x=b;if(x){for(var p=0;p<r.length;p++)if(x(m,r[p])){m=p;break a}m=-1}else m=r.indexOf(m)}if(-1!==m){c.children.splice(m,
1);h.push(c);this._condense(h);break}}n||c.leaf||!q(c,f)?l?(k++,c=l.children[k],n=!1):c=null:(h.push(c),e.push(k),k=0,l=c,c=c.children[0])}return this},toBBox:function(a){return a},compareMinX:a,compareMinY:k,toJSON:function(){return this.data},fromJSON:function(a){this.data=a;return this},_all:function(a,b){for(var c=[];a;)a.leaf?b.push.apply(b,a.children):c.push.apply(c,a.children),a=c.pop();return b},_build:function(a,b,c,f){var h=c-b+1,e=this._maxEntries,k;if(h<=e)return k=r(a.slice(b,c+1)),p(k,
this.toBBox),k;f||(f=Math.ceil(Math.log(h)/Math.log(e)),e=Math.ceil(h/Math.pow(e,f-1)));k=r([]);k.leaf=!1;k.height=f;var h=Math.ceil(h/e),e=h*Math.ceil(Math.sqrt(e)),l,m,n;for(v(a,b,c,e,this.compareMinX);b<=c;b+=e)for(m=Math.min(b+e-1,c),v(a,b,m,h,this.compareMinY),l=b;l<=m;l+=h)n=Math.min(l+h-1,m),k.children.push(this._build(a,l,n,f-1));p(k,this.toBBox);return k},_chooseSubtree:function(a,b,c,k){for(var h,e,l,m,n,q,r,p;;){k.push(b);if(b.leaf||k.length-1===c)break;r=p=Infinity;h=0;for(e=b.children.length;h<
e;h++)l=b.children[h],n=f(l),q=(Math.max(l.maxX,a.maxX)-Math.min(l.minX,a.minX))*(Math.max(l.maxY,a.maxY)-Math.min(l.minY,a.minY))-n,q<p?(p=q,r=n<r?n:r,m=l):q===p&&n<r&&(r=n,m=l);b=m||b.children[0]}return b},_insert:function(a,b,f){var k=this.toBBox;f=f?a:k(a);var k=[],h=this._chooseSubtree(f,this.data,b,k);h.children.push(a);for(c(h,f);0<=b;)if(k[b].children.length>this._maxEntries)this._split(k,b),b--;else break;this._adjustParentBBoxes(f,k,b)},_split:function(a,b){var c=a[b],f=c.children.length,
h=this._minEntries;this._chooseSplitAxis(c,h,f);f=this._chooseSplitIndex(c,h,f);f=r(c.children.splice(f,c.children.length-f));f.height=c.height;f.leaf=c.leaf;p(c,this.toBBox);p(f,this.toBBox);b?a[b-1].children.push(f):this._splitRoot(c,f)},_splitRoot:function(a,b){this.data=r([a,b]);this.data.height=a.height+1;this.data.leaf=!1;p(this.data,this.toBBox)},_chooseSplitIndex:function(a,b,c){var k,h,e,l,m,q,r;m=q=Infinity;for(k=b;k<=c-b;k++)h=n(a,0,k,this.toBBox),e=n(a,k,c,this.toBBox),l=Math.max(0,Math.min(h.maxX,
e.maxX)-Math.max(h.minX,e.minX))*Math.max(0,Math.min(h.maxY,e.maxY)-Math.max(h.minY,e.minY)),h=f(h)+f(e),l<m?(m=l,r=k,q=h<q?h:q):l===m&&h<q&&(q=h,r=k);return r},_chooseSplitAxis:function(b,c,f){var l=b.leaf?this.compareMinX:a,h=b.leaf?this.compareMinY:k,e=this._allDistMargin(b,c,f,l);c=this._allDistMargin(b,c,f,h);e<c&&b.children.sort(l)},_allDistMargin:function(a,b,f,k){a.children.sort(k);k=this.toBBox;var h=n(a,0,b,k),e=n(a,f-b,f,k),l=m(h)+m(e),z,q;for(z=b;z<f-b;z++)q=a.children[z],c(h,a.leaf?k(q):
q),l+=m(h);for(z=f-b-1;z>=b;z--)q=a.children[z],c(e,a.leaf?k(q):q),l+=m(e);return l},_adjustParentBBoxes:function(a,b,f){for(;0<=f;f--)c(b[f],a)},_condense:function(a){for(var b=a.length-1,c;0<=b;b--)0===a[b].children.length?0<b?(c=a[b-1].children,c.splice(c.indexOf(a[b]),1)):this.clear():p(a[b],this.toBBox)},_initFormat:function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0]));this.compareMinY=new Function("a","b",b.join(a[1]));this.toBBox=new Function("a","return {minX: a"+
a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")}};return b})},"esri/core/libs/quickselect/quickselect":function(){define([],function(){function y(n,c,a,k,f){for(;k>a;){if(600<k-a){var m=k-a+1,q=c-a+1,p=Math.log(m),r=.5*Math.exp(2*p/3),p=.5*Math.sqrt(p*r*(m-r)/m)*(0>q-m/2?-1:1);y(n,c,Math.max(a,Math.floor(c-q*r/m+p)),Math.min(k,Math.floor(c+(m-q)*r/m+p)),f)}m=n[c];q=a;r=k;b(n,a,c);for(0<f(n[k],m)&&b(n,a,k);q<r;){b(n,q,r);q++;for(r--;0>f(n[q],m);)q++;for(;0<f(n[r],m);)r--}0===f(n[a],m)?
b(n,a,r):(r++,b(n,r,k));r<=c&&(a=r+1);c<=r&&(k=r-1)}}function b(b,c,a){var k=b[c];b[c]=b[a];b[a]=k}function p(b,c){return b<c?-1:b>c?1:0}return function(b,c,a,k,f){y(b,c,a||0,k||b.length-1,f||p)}})},"esri/layers/graphics/data/executeTileQuery":function(){define("require exports ../../../geometry/support/aaBoundingRect ../featureConversionUtils ../OptimizedGeometry ./QueryEngine ./utils".split(" "),function(y,b,p,n,c,a,k){function f(a,b,c,f,k,m){a.lengths.length&&(a.lengths.length=0);a.coords.length&&
(a.coords.length=0);if(!b||!b.coords.length)return null;var h=b.coords;b=b.lengths;if(!b.length)return a.coords[0]=n.quantizeX(m,h[0]),a.coords[1]=n.quantizeY(m,h[1]),a.coords.length=c,a;for(var e,l,z,q,p=0,r,x=0,S=0;S<b.length;S++){var v=b[S];if(!(v<f))if(r=x,z=e=n.quantizeX(m,h[p]),q=l=n.quantizeY(m,h[p+1]),a.coords[r]=z,a.coords[r+1]=q,p+=c,1===v)a.lengths.push(1),x=r+2;else{z=n.quantizeX(m,h[p]);q=n.quantizeY(m,h[p+1]);var E=z-e,L=q-l,B=L/E;r+=2;a.coords[r]=E;a.coords[r+1]=L;e=z;l=q;for(var p=
p+c,I=2;I<v;I++){z=n.quantizeX(m,h[p]);q=n.quantizeY(m,h[p+1]);if(z!==e||q!==l){e=z-e;l=q-l;var C=l/e,B=B===C||!isFinite(B)&&!isFinite(C),J=(0<=L&&0<=l||0>=L&&0>=l)&&(0<=E&&0<=e||0>=E&&0>=e);B&&(k||J)?(E+=e,L+=l):(E=e,L=l,r+=2);a.coords[r]=E;a.coords[r+1]=L;B=C;e=z;l=q}p+=c}z=(r+2-x)/2;z>=f&&(a.lengths.push(z),x=r+2)}}a.coords.length>x&&(a.coords.length=x);return a.coords.length?a:null}Object.defineProperty(b,"__esModule",{value:!0});var m=new c.default,q={esriGeometryPoint:n.convertToPoint,esriGeometryPolyline:n.convertToPolyline,
esriGeometryPolygon:n.convertToPolygon,esriGeometryMultipoint:n.convertToMultipoint};b.executeTileQueryForIds=function(a,b,c){b=p.pad(b.bounds,c.pixelBuffer*b.resolution,p.create());var f=[];a.featureStore.forEachInBounds(b,function(b){return f.push(a.featureAdapter.getObjectId(b))});return f};b.createTileFeatures=function(b,c,l,n,p,y,h,e,t){var z=q[l.geometryType],r=x[l.geometryType],v="esriGeometryPolygon"===l.geometryType&&!e,A=l.hasZ?l.hasM?4:3:l.hasM?3:2;h&&!y?n.forEachInBounds(p,function(f){if(!c.has(f.objectId)){var e=
k.getCentroid(l,f,t),h=f.attributes;e&&(c.add(f.objectId),b.push(new a.Feature(h,f.localId,null,e)))}}):y&&!h?n.forEachInBounds(p,function(e){if(!c.has(e.objectId)){var h=e.attributes,k=z(f(m,e.geometry,A,r,v,t),!1,!1);k&&(c.add(e.objectId),b.push(new a.Feature(h,e.localId,k,null)))}}):n.forEachInBounds(p,function(e){if(!c.has(e.objectId)){var h=k.getCentroid(l,e,t),q=e.attributes,n=z(f(m,e.geometry,A,r,v,t),!1,!1);n&&h&&(c.add(e.objectId),b.push(new a.Feature(q,e.localId,n,h)))}})};var x={esriGeometryPoint:0,
esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0};b.quantizeOptimizedGeometryForDisplay=f})},"esri/layers/graphics/data/QueryEngine":function(){define("require exports tslib ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/MemCache ../../../core/promiseUtils ../../../core/SetUtils ../../../core/unitUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ./attributeSupport ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./spatialQuerySupport ./timeSupport ./utils ../../support/FieldsIndex ../../support/PromiseQueue".split(" "),
function(y,b,p,n,c,a,k,f,m,q,x,r,v,l,E,F,D,h,e,t,z,G,P,A){function U(a){return a.every(function(a){return"exceedslimit"!==a.statisticType})}Object.defineProperty(b,"__esModule",{value:!0});y=function(){return function(a,b,c,e,f){void 0===b&&(b=null);this.attributes=a;this.geometry=c;this.centroid=e;this.filterFlags=f;this.groupId=-1;this.localId=b}}();b.Feature=y;var S=new Set,da=new k.MemCacheStorage(2E6),ta=0;y=function(){function b(a){var b=this;this.capabilities={query:h.queryCapabilities};this.geometryType=
a.geometryType;this.hasM=a.hasM;this.hasZ=a.hasZ;this.objectIdField=a.objectIdField;this.spatialReference=a.spatialReference;this.definitionExpression=a.definitionExpression;this.featureStore=a.featureStore;this._changeHandle=this.featureStore.events.on("changed",function(){return b.clearCache()});this.timeInfo=a.timeInfo;a.cacheSpatialQueries&&(this._geometryQueryCache=new k.MemCache(ta++ +"$$",da));this.fieldsIndex=new P(a.fields);a.scheduler&&a.task&&(this._frameQueue=new A.default,this._frameTask=
a.scheduler.registerTask(a.task,function(a){return b._update(a)},function(){return 0<b._frameQueue.length}))}b.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null);this.clearCache();this._geometryQueryCache&&this._geometryQueryCache.destroy();this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null);this.fieldsIndex.destroy()};Object.defineProperty(b.prototype,"featureAdapter",{get:function(){return this.featureStore.featureAdapter},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fullExtent",{get:function(){var a=this.featureStore.fullBounds;return a?{xmin:a[0],ymin:a[1],xmax:a[2],ymax:a[3],spatialReference:G.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"timeExtent",{get:function(){return this.timeInfo?this._timeExtent?this._timeExtent:this._timeExtent=z.getTimeExtent(this.timeInfo,this.featureStore):null},enumerable:!0,configurable:!0});
b.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear();this._timeExtent=this._allItems=null};b.prototype.executeQuery=function(a,b){void 0===a&&(a={});return p.__awaiter(this,void 0,void 0,function(){var b,f,B,h=this;return p.__generator(this,function(k){switch(k.label){case 0:b=c.clone(a),k.label=1;case 1:return k.trys.push([1,8,,9]),[4,this._schedule(function(){return G.normalizeQuery(b,h.definitionExpression,h.spatialReference)})];case 2:return b=k.sent(),
[4,this._reschedule(function(){return h._checkQuerySupport(b)})];case 3:return b=k.sent(),[4,this._reschedule(function(){return h._executeGeometryQuery(b)})];case 4:return f=k.sent(),[4,this._reschedule(function(){return f.executeObjectIdsQuery(b)})];case 5:return f=k.sent(),[4,this._reschedule(function(){return f.executeTimeQuery(b)})];case 6:return f=k.sent(),[4,this._reschedule(function(){return f.executeAttributesQuery(b)})];case 7:return f=k.sent(),[3,9];case 8:B=k.sent();if(B!==G.QUERY_ENGINE_EMPTY_RESULT)throw B;
f=new e.default([],null,this);return[3,9];case 9:return[2,f.createQueryResponse(b)]}})})};b.prototype.executeQueryForCount=function(a,b){void 0===a&&(a={});return p.__awaiter(this,void 0,void 0,function(){var b,f,e,B=this;return p.__generator(this,function(h){switch(h.label){case 0:b=c.clone(a),b.returnGeometry=!1,b.returnCentroid=!1,b.outSR=null,h.label=1;case 1:return h.trys.push([1,8,,9]),[4,this._schedule(function(){return G.normalizeQuery(b,B.definitionExpression,B.spatialReference)})];case 2:return b=
h.sent(),[4,this._reschedule(function(){return B._checkQuerySupport(b)})];case 3:return b=h.sent(),[4,this._reschedule(function(){return B._executeGeometryQuery(b)})];case 4:return f=h.sent(),[4,this._reschedule(function(){return f.executeObjectIdsQuery(b)})];case 5:return f=h.sent(),[4,this._reschedule(function(){return f.executeTimeQuery(b)})];case 6:return f=h.sent(),[4,this._reschedule(function(){return f.executeAttributesQuery(b)})];case 7:return f=h.sent(),[2,f.size];case 8:e=h.sent();if(e!==
G.QUERY_ENGINE_EMPTY_RESULT)throw e;return[2,0];case 9:return[2]}})})};b.prototype.executeQueryForExtent=function(a,b){void 0===a&&(a={});return p.__awaiter(this,void 0,void 0,function(){var b,f,e,h,k,C,I,l,J=this;return p.__generator(this,function(m){switch(m.label){case 0:b=c.clone(a),e=b.outSR,m.label=1;case 1:return m.trys.push([1,8,,9]),[4,this._schedule(function(){return G.normalizeQuery(b,J.definitionExpression,J.spatialReference)})];case 2:return b=m.sent(),[4,this._reschedule(function(){return J._checkQuerySupport(b)})];
case 3:return b=m.sent(),b.returnGeometry=!0,b.returnCentroid=!1,b.outSR=null,[4,this._reschedule(function(){return J._executeGeometryQuery(b)})];case 4:return f=m.sent(),[4,this._reschedule(function(){return f.executeObjectIdsQuery(b)})];case 5:return f=m.sent(),[4,this._reschedule(function(){return f.executeTimeQuery(b)})];case 6:return f=m.sent(),[4,this._reschedule(function(){return f.executeAttributesQuery(b)})];case 7:f=m.sent();h=f.size;if(!h)return[2,{count:h,extent:null}];x.set(B,x.NEGATIVE_INFINITY);
this.featureStore.forEachBounds(f.items,function(a){return x.expand(B,a)},L);k={xmin:B[0],ymin:B[1],xmax:B[3],ymax:B[4],spatialReference:G.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(B[2])&&isFinite(B[5])&&(k.zmin=B[2],k.zmax=B[5]);C=D.project(k,f.spatialReference,e);C.spatialReference=G.cleanFromGeometryEngine(e||this.spatialReference);0===C.xmax-C.xmin&&(I=q.getMetersPerUnitForSR(C.spatialReference),C.xmin-=I,C.xmax+=I);0===C.ymax-C.ymin&&(I=q.getMetersPerUnitForSR(C.spatialReference),
C.ymin-=I,C.ymax+=I);this.hasZ&&null!=C.zmin&&null!=C.zmax&&0===C.zmax-C.zmin&&(I=q.getMetersPerUnitForSR(C.spatialReference),C.zmin-=I,C.zmax+=I);return[2,{count:h,extent:C}];case 8:l=m.sent();if(l===G.QUERY_ENGINE_EMPTY_RESULT)return[2,{count:0,extent:null}];throw l;case 9:return[2]}})})};b.prototype.executeQueryForIds=function(a,b){void 0===a&&(a={});return p.__awaiter(this,void 0,void 0,function(){return p.__generator(this,function(c){return[2,this.executeQueryForIdSet(a,b).then(function(a){return m.valuesOfSet(a)})]})})};
b.prototype.executeQueryForIdSet=function(a,b){void 0===a&&(a={});return p.__awaiter(this,void 0,void 0,function(){var b,f,e,B,h,k=this;return p.__generator(this,function(C){switch(C.label){case 0:b=c.clone(a),b.returnGeometry=!1,b.returnCentroid=!1,b.outSR=null,C.label=1;case 1:return C.trys.push([1,9,,10]),[4,this._schedule(function(){return G.normalizeQuery(b,k.definitionExpression,k.spatialReference)})];case 2:return b=C.sent(),[4,this._reschedule(function(){return k._checkQuerySupport(b)})];
case 3:return b=C.sent(),[4,this._reschedule(function(){return k._executeGeometryQuery(b)})];case 4:return f=C.sent(),[4,this._reschedule(function(){return f.executeObjectIdsQuery(b)})];case 5:return f=C.sent(),[4,this._reschedule(function(){return f.executeTimeQuery(b)})];case 6:return f=C.sent(),[4,this._reschedule(function(){return f.executeAttributesQuery(b)})];case 7:return f=C.sent(),e=f.items,B=new Set,[4,this._reschedule(function(){for(var a=0,b=e;a<b.length;a++)B.add(f.featureAdapter.getObjectId(b[a]))})];
case 8:return C.sent(),[2,B];case 9:h=C.sent();if(h===G.QUERY_ENGINE_EMPTY_RESULT)return[2,new Set];throw h;case 10:return[2]}})})};b.prototype.executeQueryForLatestObservations=function(a,b){void 0===a&&(a={});return p.__awaiter(this,void 0,void 0,function(){var b,f,B,h=this;return p.__generator(this,function(k){switch(k.label){case 0:if(!this.timeInfo||!this.timeInfo.trackIdField)throw new n("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:a,timeInfo:this.timeInfo});
b=c.clone(a);k.label=1;case 1:return k.trys.push([1,9,,10]),[4,this._schedule(function(){return G.normalizeQuery(b,h.definitionExpression,h.spatialReference)})];case 2:return b=k.sent(),[4,this._reschedule(function(){return h._checkQuerySupport(b)})];case 3:return b=k.sent(),[4,this._reschedule(function(){return h._executeGeometryQuery(b)})];case 4:return f=k.sent(),[4,this._reschedule(function(){return f.executeObjectIdsQuery(b)})];case 5:return f=k.sent(),[4,this._reschedule(function(){return f.executeTimeQuery(b)})];
case 6:return f=k.sent(),[4,this._reschedule(function(){return f.executeAttributesQuery(b)})];case 7:return f=k.sent(),[4,this._reschedule(function(){return f.filterLatest()})];case 8:return f=k.sent(),[3,10];case 9:B=k.sent();if(B!==G.QUERY_ENGINE_EMPTY_RESULT)throw B;f=new e.default([],null,this);return[3,10];case 10:return[2,f.createQueryResponse(b)]}})})};b.prototype._schedule=function(a){return p.__awaiter(this,void 0,void 0,function(){return p.__generator(this,function(b){return this._frameQueue?
[2,this._frameQueue.push(a)]:[2,a()]})})};b.prototype._reschedule=function(a){return p.__awaiter(this,void 0,void 0,function(){return p.__generator(this,function(b){return this._frameQueue?[2,this._frameQueue.unshift(a)]:[2,a()]})})};b.prototype._update=function(a){for(this._budget=a;!a.done&&this._frameQueue&&this._frameQueue.process();)a.madeProgress();this._budget=null};b.prototype._getAll=function(){if(!this._allItems){var a=[];this.featureStore.forEach(function(b){return a.push(b)});this._allItems=
new e.default(a,null,this)}return this._allItems};b.prototype._executeGeometryQuery=function(b){return p.__awaiter(this,void 0,void 0,function(){var c,f,B,h,k,C,I,l,m,q,n,z,L,r,x,A,G,S,v,P,da=this;return p.__generator(this,function(J){switch(J.label){case 0:c=b.geometry;f=b.outSR;B=b.spatialRel;h=E.isValid(f)&&!E.equals(this.spatialReference,f);if(k=this._geometryQueryCache?h?JSON.stringify({geometry:c,spatialRelationship:B,outSpatialReference:f}):JSON.stringify({geometry:c,spatialRelationship:B}):
null)if(C=this._geometryQueryCache.get(k),!a.isUndefined(C))return[2,C];I=function(a){return p.__awaiter(da,void 0,void 0,function(){var c;return p.__generator(this,function(e){switch(e.label){case 0:return h&&(b.returnGeometry||b.returnCentroid)?[4,a.project(f)]:[3,2];case 1:return c=e.sent(),k&&this._geometryQueryCache.put(k,c,c.size||1),[2,c];case 2:return k&&this._geometryQueryCache.put(k,a,a.size||1),[2,a]}})})};if(!c)return[2,I(this._getAll())];l=this.featureAdapter;if("esriSpatialRelDisjoint"!==
B)return[3,3];m=this._searchFeatures(this._getQueryBBoxes(c));if(!m.length)return[2,I(this._getAll())];z=new Set;L=0;for(r=m;L<r.length;L++)x=r[L],z.add(l.getObjectId(x));return[4,this._reschedule(function(){var a=0;q=Array(z.size);da.featureStore.forEach(function(b){return q[a++]=b});n=z})];case 1:return J.sent(),[4,this._reschedule(function(){return p.__awaiter(da,void 0,void 0,function(){var a,b,f;return p.__generator(this,function(h){switch(h.label){case 0:return[4,t.getSpatialQueryOperator(B,
c,this.geometryType,this.hasZ,this.hasM)];case 1:return a=h.sent(),b=function(b){return!n.has(l.getObjectId(b))||a(l.getGeometry(b))},f=e.default.bind,[4,this._runSpatialFilter(q,b)];case 2:return[2,new (f.apply(e.default,[void 0,h.sent(),c,this]))]}})})})];case 2:return A=J.sent(),[2,I(A)];case 3:return G=this._searchFeatures(this._getQueryBBoxes(c)),G.length?(S=this._canExecuteSoloPass(c,b))?[2,I(new e.default(G,c,this))]:[4,t.getSpatialQueryOperator(B,c,this.geometryType,this.hasZ,this.hasM)]:
(A=new e.default([],c,this),k&&this._geometryQueryCache.put(k,A,A.size||1),[2,A]);case 4:return v=J.sent(),[4,this._runSpatialFilter(G,function(a){return v(l.getGeometry(a))})];case 5:return P=J.sent(),[2,I(new e.default(P,c,this))]}})})};b.prototype._runSpatialFilter=function(a,b){return p.__awaiter(this,void 0,void 0,function(){var c,f,e,B=this;return p.__generator(this,function(h){if(!b)return[2,a];if(!this._budget)return[2,a.filter(function(a){return b(a)})];c=0;f=[];e=function(){return p.__awaiter(B,
void 0,void 0,function(){var B;return p.__generator(this,function(h){switch(h.label){case 0:if(!(c<a.length))return[3,3];B=a[c];b(B)&&f.push(B);return this._budget.done?[4,this._reschedule(function(){return e()})]:[3,2];case 1:h.sent(),h.label=2;case 2:return++c,[3,0];case 3:return[2]}})})};return[2,this._reschedule(function(){return e()}).then(function(){return f})]})})};b.prototype._canExecuteSoloPass=function(a,b){var c=this.geometryType;b=b.spatialRel;return t.canQueryWithRBush(a)&&("esriSpatialRelEnvelopeIntersects"===
b||"esriGeometryPoint"===c&&("esriSpatialRelIntersects"===b||"esriSpatialRelContains"===b||"esriSpatialRelWithin"===b))};b.prototype._getQueryBBoxes=function(a){if(t.canQueryWithRBush(a)){if(l.isExtent(a))return[r.fromValues(a.xmin,a.ymin,a.xmax,a.ymax)];if(l.isPolygon(a))return a.rings.map(function(a){return r.fromValues(Math.min(a[0][0],a[2][0]),Math.min(a[0][1],a[2][1]),Math.max(a[0][0],a[2][0]),Math.max(a[0][1],a[2][1]))})}return[v.getBoundsXY(r.create(),a)]};b.prototype._searchFeatures=function(a){for(var b=
0;b<a.length;b++)this.featureStore.forEachInBounds(a[b],function(a){S.add(a)});var c=Array(S.size),f=0;S.forEach(function(a){return c[f++]=a});S.clear();return c};b.prototype._checkQuerySupport=function(a){return p.__awaiter(this,void 0,void 0,function(){return p.__generator(this,function(b){if(0>a.distance||null!=a.geometryPrecision||a.multipatchOption||a.pixelSize||a.relationParam||a.text)throw new n("feature-store:unsupported-query","Unsupported query options",{query:a});return[2,f.all([this._checkAttributesQuerySupport(a),
this._checkStatisticsQuerySupport(a),t.checkSpatialQuerySupport(a,this.geometryType,this.spatialReference),D.checkProjectionSupport(this.spatialReference,a.outSR)]).then(function(){return a})]})})};b.prototype._checkAttributesQuerySupport=function(a){var b=a.outFields,c=a.orderByFields,f=a.returnDistinctValues,e=a.outStatistics,B=e?e.map(function(a){return a.outStatisticFieldName&&a.outStatisticFieldName.toLowerCase()}):[];c&&0<c.length&&(c=c.map(function(a){var b=a.toLowerCase();return-1<b.indexOf(" asc")?
b.split(" asc")[0]:-1<b.indexOf(" desc")?b.split(" desc")[0]:a}).filter(function(a){return-1===B.indexOf(a)}),F.validateFields(this.fieldsIndex,c,"orderByFields contains missing fields"));if(b&&0<b.length)F.validateFields(this.fieldsIndex,b,"outFields contains missing fields");else if(f)throw new n("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:a});F.validateWhere(this.fieldsIndex,a.where)};b.prototype._checkStatisticsQuerySupport=function(a){return p.__awaiter(this,
void 0,void 0,function(){var b,c,f,e,B,h,k,I,l,m,C,t,q;return p.__generator(this,function(J){b=a.outStatistics;c=a.groupByFieldsForStatistics;f=a.having;e=c&&c.length;B=b&&b.length;if(f){if(!e||!B)throw new n("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:a});F.validateHaving(this.fieldsIndex,f,b)}if(B){if(!U(b))return[2];h=b.map(function(a){return a.onStatisticField});F.validateFields(this.fieldsIndex,h,"onStatisticFields contains missing fields");
e&&F.validateFields(this.fieldsIndex,c,"groupByFieldsForStatistics contains missing fields");k=0;for(I=b;k<I.length;k++)if(l=I[k],m=l.onStatisticField,C=l.statisticType,(t="percentile_disc"===C||"percentile_cont"===C)&&"statisticParameters"in l){if(q=l.statisticParameters,!q)throw new n("feature-store:unsupported-query","statisticParamters should be set for percentile type",{definition:l,query:a});}else if("count"!==C&&m&&F.hasInvalidFieldType(m,this.fieldsIndex))throw new n("feature-store:unsupported-query",
"outStatistics contains non-numeric fields",{definition:l,query:a});}return[2]})})};return b}();b.default=y;var L=x.create(),B=x.create()})},"esri/layers/graphics/data/attributeSupport":function(){define(["require","exports","../../../core/Error","../../../core/SetUtils","../../../core/sql/WhereClauseCache"],function(y,b,p,n,c){function a(a,b){return a?m.get(a,b):null}function k(b,c,m,l){void 0===l&&(l=!0);for(var q=[],n=0;n<c.length;n++){var r=c[n];if("*"!==r&&!b.has(r))if(l){var h=f(r);try{var e=
a(h,b);if(!e)throw new p("feature-store:unsupported-query","invalid SQL expression",{where:h});if(!e.isStandardized)throw new p("feature-store:unsupported-query","expression is not standard",{clause:e});k(b,e.fieldNames,"expression contains missing fields")}catch(t){if((h=t&&t.details)&&(h.clause||h.where))throw t;h&&h.missingFields?q.push.apply(q,h.missingFields):q.push(r)}}else q.push(r)}if(q.length)throw new p("feature-store:unsupported-query",m,{missingFields:q});}function f(a){return a.split(" as ")[0]}
Object.defineProperty(b,"__esModule",{value:!0});var m=new c.WhereClauseCache(50,500),q=n.SetFromValues("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeDate".split(" "));b.validateWhere=function(a,b){if(!b)return!0;var c=m.get(b,a);if(!c)throw new p("feature-store:unsupported-query","invalid SQL expression",{where:b});if(!c.isStandardized)throw new p("feature-store:unsupported-query","where clause is not standard",
{where:b});k(a,c.fieldNames,"where clause contains missing fields");return!0};b.validateHaving=function(a,b,c){if(!b)return!0;var f=m.get(b,a);if(!f)throw new p("feature-store:unsupported-query","invalid SQL expression",{having:b});if(!f.isAggregate)throw new p("feature-store:unsupported-query","having does not contain a valid aggregate function",{having:b});k(a,f.fieldNames,"having contains missing fields");if(!f.getExpressions().every(function(b){var f=b.aggregateType;b=b.field;var k=a.has(b)&&
a.get(b).name;return c.some(function(b){var c=b.onStatisticField;b=b.statisticType;return(a.has(c)&&a.get(c).name)===k&&b.toLowerCase().trim()===f})}))throw new p("feature-store:unsupported-query","expressions in having should also exist in outStatistics",{having:b});return!0};b.getWhereClause=a;b.validateFields=k;b.getExpressionFromFieldName=f;b.getAliasFromFieldName=function(a){return a.split(" as ")[1]};b.hasInvalidFieldType=function(a,b){return(a=b.get(a))?!q.has(a.type):!1}})},"esri/core/sql/WhereClauseCache":function(){define(["require",
"exports","../ItemCache","./WhereClause"],function(y,b,p,n){Object.defineProperty(b,"__esModule",{value:!0});y=function(){function b(a,b){this._cache=new p(a);this._invalidCache=new p(b)}b.prototype.get=function(a,b){var c=b.uid+":"+a,k=this._cache.get(c);if(k)return k;if(void 0!==this._invalidCache.get(c))return null;try{var q=n.WhereClause.create(a,b);this._cache.put(c,q);return q}catch(x){return this._invalidCache.put(c,null),null}};return b}();b.WhereClauseCache=y})},"esri/core/ItemCache":function(){define(["require",
"exports","./MemCache"],function(y,b,p){return function(){function b(b,a){this._storage=new p.MemCacheStorage;this._storage.maxSize=b;a&&this._storage.registerRemoveFunc("",a)}b.prototype.put=function(b,a){this._storage.put(b,a,1,1)};b.prototype.pop=function(b){return this._storage.pop(b)};b.prototype.get=function(b){return this._storage.get(b)};b.prototype.clear=function(){this._storage.clearAll()};b.prototype.destroy=function(){this._storage.clearAll()};return b}()})},"esri/core/sql/WhereClause":function(){define("require exports ../has ../MapUtils ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),
function(y,b,p,n,c,a,k){function f(a,b){a+="";return a.length>=b?a:Array(b-a.length+1).join("0")+a}function m(a,b,c,e,h,k,l,m,t){void 0===c&&(c="0");void 0===e&&(e="0");void 0===h&&(h="0");void 0===k&&(k="0");void 0===l&&(l="");void 0===m&&(m="0");void 0===t&&(t="0");return"+"===l||"-"===l?(a=f(parseInt(a,10),4)+"-"+f(parseInt(b,10),2)+"-"+f(parseInt(c,10),2),b="",10>parseFloat(k)&&(b="0"),e=f(parseInt(e,10),2)+":"+f(parseInt(h,10),2)+":"+(b+parseFloat(k).toString()),l=""+l+f(parseInt(m,10),2)+":"+
f(parseInt(t,10),2),new Date(a+"T"+e+l)):new Date(parseInt(a,10),parseInt(b,10)-1,parseInt(c,10),parseInt(e,10),parseInt(h,10),parseFloat(k))}function q(a){var b=A.exec(a);if(null!==b){a=b[1];var c=b[2],f=b[3],e=b[4],h=b[5],k=b[6];return m(a,c,f,e,h,k)}b=U.exec(a);if(null!==b){a=b[1];var c=b[2],f=b[3],e=b[4],h=b[5],k=b[6],l=b[7],t=b[8],b=b[9];return m(a,c,f,e,h,k,l,t,b)}b=S.exec(a);if(null!==b)return a=b[1],c=b[2],f=b[3],e=b[4],h=b[5],l=b[6],t=b[7],b=b[8],m(a,c,f,e,h,"0",l,t,b);b=da.exec(a);if(null!==
b)return a=b[1],c=b[2],f=b[3],e=b[4],h=b[5],m(a,c,f,e,h);b=P.exec(a);if(null!==b)return a=b[1],c=b[2],f=b[3],m(a,c,f);throw Error("SQL Invalid Timestamp");}function x(a){a=P.exec(a);if(null===a)throw Error("SQL Invalid Date");var b=a[2],c=a[3];return new Date(parseInt(a[1],10),parseInt(b,10)-1,parseInt(c,10))}function r(a){return Array.isArray(a)?a:[a]}function v(a){return null!==a?!0!==a:null}function l(a,b){return null!=a&&null!=b?!0===a&&!0===b:!1===a||!1===b?!1:null}function E(a,b){return null!=
a&&null!=b?!0===a||!0===b:!0===a||!0===b?!0:null}function F(a,b){if(null==a)return null;for(var c=!1,f=0;f<b.length;f++){var e=b[f];if(null==e)c=null;else if(a===e){c=!0;break}}return c}function D(a,b,c){if(null==a)return null;for(var f="",e=0,h=0;h<b.length;h++){var k=b.charAt(h);switch(e){case 0:k===c?e=1:f=0<="-[]/{}()*+?.\\^$|".indexOf(k)?f+("\\"+k):"%"===k?f+".*":"_"===k?f+".":f+k;break;case 1:f=0<="-[]/{}()*+?.\\^$|".indexOf(k)?f+("\\"+k):f+k,e=0}}return(new RegExp("^"+f+"$")).test(a)}function h(a){return a instanceof
Date?a.valueOf():a}function e(a,b,c){if(null==b||null==c)return null;b=h(b);c=h(c);switch(a){case "\x3c\x3e":return b!==c;case "\x3d":return b===c;case "\x3e":return b>c;case "\x3c":return b<c;case "\x3e\x3d":return b>=c;case "\x3c\x3d":return b<=c}}function t(a){for(var b=[],c={},f=0;f<a.length;f++){var e=a[f],h=e.toLowerCase();void 0===c[h]&&(b.push(e),c[h]=1)}return b}function z(b,c,f){if(c instanceof a.SqlInterval)if(f instanceof Date)switch(b){case "+":return new Date(c.valueInMilliseconds()+
f.getTime());case "-":return c.valueInMilliseconds()-f.getTime();case "*":return c.valueInMilliseconds()*f.getTime();case "/":return c.valueInMilliseconds()/f.getTime()}else if(f instanceof a.SqlInterval)switch(b){case "+":return a.SqlInterval.createFromMilliseconds(c.valueInMilliseconds()+f.valueInMilliseconds());case "-":return a.SqlInterval.createFromMilliseconds(c.valueInMilliseconds()-f.valueInMilliseconds());case "*":return c.valueInMilliseconds()*f.valueInMilliseconds();case "/":return c.valueInMilliseconds()/
f.valueInMilliseconds()}else c=c.valueInMilliseconds();else if(f instanceof a.SqlInterval)if(c instanceof Date)switch(b){case "+":return new Date(f.valueInMilliseconds()+c.getTime());case "-":return new Date(c.getTime()-f.valueInMilliseconds());case "*":return c.getTime()*f.valueInMilliseconds();case "/":return c.getTime()/f.valueInMilliseconds()}else f=f.valueInMilliseconds();else if(c instanceof Date&&"number"===typeof f)switch(f*=864E5,c=c.getTime(),b){case "+":return new Date(c+f);case "-":return new Date(c-
f);case "*":return new Date(c*f);case "/":return new Date(c/f)}else if(f instanceof Date&&"number"===typeof c)switch(c*=864E5,f=f.getTime(),b){case "+":return new Date(c+f);case "-":return new Date(c-f);case "*":return new Date(c*f);case "/":return new Date(c/f)}switch(b){case "+":return c+f;case "-":return c-f;case "*":return c*f;case "/":return c/f}}function G(a,b,c,f){a=f.getAttribute(a,b);return null!=a&&1===c[b]?new Date(a):a}Object.defineProperty(b,"__esModule",{value:!0});var P=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,
A=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,U=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,S=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,da=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,ta=function(){function b(){}b.makeBool=function(a){return!0===a};b.featureValue=function(a,b,c,f){return G(a,b,c,f)};b.equalsNull=function(a){return null===a};b.applyLike=function(a,b,c){return D(a,
b,c)};b.ensureArray=function(a){return r(a)};b.applyIn=function(a,b){return F(a,b)};b.currentDate=function(){var a=new Date;a.setHours(0,0,0,0);return a};b.makeSqlInterval=function(b,c,f){return a.SqlInterval.createFromValueAndQualifer(b,c,f)};b.convertInterval=function(b){return b instanceof a.SqlInterval?b.valueInMilliseconds():b};b.currentTimestamp=function(){return new Date};b.compare=function(a,b,c){return e(a,b,c)};b.calculate=function(a,b,c){return z(a,b,c)};b.makeComparable=function(a){return h(a)};
b.evaluateFunction=function(b,c){return a.evaluateFunction(b,c)};b.lookup=function(a,b){a=b[a];return void 0===a?null:a};b.between=function(a,b){return null==a||null==b[0]||null==b[1]?null:a>=b[0]&&a<=b[1]};b.notbetween=function(a,b){return null==a||null==b[0]||null==b[1]?null:a<b[0]||a>b[1]};b.ternaryNot=function(a){return v(a)};b.ternaryAnd=function(a,b){return l(a,b)};b.ternaryOr=function(a,b){return E(a,b)};return b}();y=function(){function f(a,b){this.fieldsIndex=b;this.datefields={};this.parameters=
{};this.parseTree=k.WhereGrammar.parse(a);a=this.extractExpressionInfo(b);b=a.isStandardized;var c=a.isAggregate;this.referencedFieldNames=a.referencedFieldNames;this.isStandardized=b;this.isAggregate=c}f.create=function(a,b){return new f(a,b)};Object.defineProperty(f.prototype,"fieldNames",{get:function(){return this.referencedFieldNames},enumerable:!0,configurable:!0});f.prototype.testSet=function(a,c){void 0===c&&(c=b.defaultAttributeAdapter);for(var f={},e=function(b){f[b]=a.map(function(a){return c.getAttribute(a,
b)})},h=0,k=this.fieldNames;h<k.length;h++)e(k[h]);return!!this.evaluateNode(this.parseTree,{attributes:f},b.defaultAttributeAdapter)};f.prototype.calculateValue=function(c,f){void 0===f&&(f=b.defaultAttributeAdapter);c=this.evaluateNode(this.parseTree,c,f);return c instanceof a.SqlInterval?c.valueInMilliseconds()/864E5:c};f.prototype.calculateValueCompiled=function(a,c){void 0===c&&(c=b.defaultAttributeAdapter);if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(a,this.parameters,
c,this.datefields);if(p("csp-restrictions"))return this.calculateValue(a,c);this.compileMe();return this.parseTree._compiledVersion(a,this.parameters,c,this.datefields)};f.prototype.testFeature=function(a,c){void 0===c&&(c=b.defaultAttributeAdapter);return!!this.evaluateNode(this.parseTree,a,c)};f.prototype.testFeatureCompiled=function(a,c){void 0===c&&(c=b.defaultAttributeAdapter);if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(a,this.parameters,c,this.datefields);
if(p("csp-restrictions"))return this.testFeature(a,c);this.compileMe();return!!this.parseTree._compiledVersion(a,this.parameters,c,this.datefields)};f.prototype.getFunctions=function(){var a=[];this.visitAll(this.parseTree,function(b){"function"===b.type&&a.push(b.name.toLowerCase())});return t(a)};f.prototype.getExpressions=function(){var a=new Map;this.visitAll(this.parseTree,function(b){if("function"===b.type){var c=b.name.toLowerCase();b=b.args.value[0];if("column_ref"===b.type){b=b.column;var f=
c+"-"+b;a.has(f)||a.set(f,{aggregateType:c,field:b})}}});return n.valuesOfMap(a)};f.prototype.getVariables=function(){var a=[];this.visitAll(this.parseTree,function(b){"param"===b.type&&a.push(b.value.toLowerCase())});return t(a)};f.prototype.compileMe=function(){var a="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","datefields",a)).bind(ta)};f.prototype.extractExpressionInfo=function(b){var f=
this,e=[],h=!0,k=!0;this.visitAll(this.parseTree,function(l){switch(l.type){case "column_ref":var m=b.get(l.column),B=m&&m.name;!m||"date"!==m.type&&"esriFieldTypeDate"!==m.type||(f.datefields[m.name]=1);void 0!==B?(e.push(B),l.column=B):e.push(l.column);break;case "function":m=l.name,l=l.args.value.length,h&&(h=a.isStandardized(m,l)),k&&(k=c.isAggregate(m,l))}});return{referencedFieldNames:t(e),isStandardized:h,isAggregate:k}};f.prototype.visitAll=function(a,b){if(null!=a)switch(b(a),a.type){case "when_clause":this.visitAll(a.operand,
b);this.visitAll(a.value,b);break;case "case_expression":for(var c=0,f=a.clauses;c<f.length;c++){var e=f[c];this.visitAll(e,b)}"simple"===a.format&&this.visitAll(a.operand,b);null!==a.else&&this.visitAll(a.else,b);break;case "expr_list":c=0;for(a=a.value;c<a.length;c++)e=a[c],this.visitAll(e,b);break;case "unary_expr":this.visitAll(a.expr,b);break;case "binary_expr":this.visitAll(a.left,b);this.visitAll(a.right,b);break;case "function":this.visitAll(a.args,b)}};f.prototype.evaluateNodeToJavaScript=
function(a){switch(a.type){case "interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(a.value)+", "+JSON.stringify(a.qualifier)+","+JSON.stringify(a.op)+")";case "case_expression":var b="";if("simple"===a.format)for(var c="this.makeComparable("+this.evaluateNodeToJavaScript(a.operand)+")",b="( ",f=0;f<a.clauses.length;f++)b+=" ("+c+" \x3d\x3d\x3d this.makeComparable("+this.evaluateNodeToJavaScript(a.clauses[f].operand)+")) ? ("+this.evaluateNodeToJavaScript(a.clauses[f].value)+") : ";
else for(b="( ",f=0;f<a.clauses.length;f++)b+=" this.makeBool("+this.evaluateNodeToJavaScript(a.clauses[f].operand)+")\x3d\x3d\x3dtrue ? ("+this.evaluateNodeToJavaScript(a.clauses[f].value)+") : ";b=null!==a.else?b+this.evaluateNodeToJavaScript(a.else):b+"null";return b+" )";case "param":return"this.lookup("+JSON.stringify(a.value.toLowerCase())+",lookups)";case "expr_list":b="[";c=0;for(a=a.value;c<a.length;c++)f=a[c],"["!==b&&(b+=","),b+=this.evaluateNodeToJavaScript(f);return b+"]";case "unary_expr":return"this.ternaryNot("+
this.evaluateNodeToJavaScript(a.expr)+")";case "binary_expr":switch(a.operator){case "AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+" )";case "IS":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(a.left)+")";case "ISNOT":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");
return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(a.left)+")))";case "IN":return"this.applyIn("+this.evaluateNodeToJavaScript(a.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(a.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(a.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(a.right)+")))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")";case "NOTBETWEEN":return"this.notbetween("+
this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+","+JSON.stringify(a.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+","+JSON.stringify(a.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+
JSON.stringify(a.operator)+","+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")";case "*":case "-":case "+":case "/":return"this.calculate("+JSON.stringify(a.operator)+","+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")"}throw Error("Not Supported Operator "+a.operator);case "null":case "bool":case "string":case "number":return JSON.stringify(a.value);case "date":return"(new Date("+x(a.value).getTime().toString()+"))";case "timestamp":return"(new Date("+
q(a.value).getTime().toString()+"))";case "current_time":return"date"===a.mode?"this.currentDate()":"this.currentTimestamp()";case "column_ref":return"this.featureValue(feature,"+JSON.stringify(a.column)+",datefields,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(a.name)+","+this.evaluateNodeToJavaScript(a.args)+")"}throw Error("Unsupported sql syntax "+a.type);};f.prototype.evaluateNode=function(b,f,k){switch(b.type){case "interval":return f=this.evaluateNode(b.value,
f,k),a.SqlInterval.createFromValueAndQualifer(f,b.qualifier,b.op);case "case_expression":if("simple"===b.format)for(var m=h(this.evaluateNode(b.operand,f,k)),t=0;t<b.clauses.length;t++){if(m===h(this.evaluateNode(b.clauses[t].operand,f,k)))return this.evaluateNode(b.clauses[t].value,f,k)}else for(t=0;t<b.clauses.length;t++)if(!0===this.evaluateNode(b.clauses[t].operand,f,k))return this.evaluateNode(b.clauses[t].value,f,k);return null!==b.else?this.evaluateNode(b.else,f,k):null;case "param":return this.parameters[b.value.toLowerCase()];
case "expr_list":m=[];t=0;for(b=b.value;t<b.length;t++)m.push(this.evaluateNode(b[t],f,k));return m;case "unary_expr":return v(this.evaluateNode(b.expr,f,k));case "binary_expr":switch(b.operator){case "AND":return l(this.evaluateNode(b.left,f,k),this.evaluateNode(b.right,f,k));case "OR":return E(this.evaluateNode(b.left,f,k),this.evaluateNode(b.right,f,k));case "IS":if("null"!==b.right.type)throw Error("Unsupported RHS for IS");return null===this.evaluateNode(b.left,f,k);case "ISNOT":if("null"!==
b.right.type)throw Error("Unsupported RHS for IS");return null!==this.evaluateNode(b.left,f,k);case "IN":return m=r(this.evaluateNode(b.right,f,k)),F(this.evaluateNode(b.left,f,k),m);case "NOT IN":return m=r(this.evaluateNode(b.right,f,k)),v(F(this.evaluateNode(b.left,f,k),m));case "BETWEEN":return m=this.evaluateNode(b.left,f,k),b=this.evaluateNode(b.right,f,k),null==m||null==b[0]||null==b[1]?null:m>=h(b[0])&&m<=h(b[1]);case "NOTBETWEEN":return m=this.evaluateNode(b.left,f,k),b=this.evaluateNode(b.right,
f,k),null==m||null==b[0]||null==b[1]?null:m<h(b[0])||m>h(b[1]);case "LIKE":return D(this.evaluateNode(b.left,f,k),this.evaluateNode(b.right,f,k),b.escape);case "NOT LIKE":return v(D(this.evaluateNode(b.left,f,k),this.evaluateNode(b.right,f,k),b.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return e(b.operator,this.evaluateNode(b.left,f,k),this.evaluateNode(b.right,f,k));case "-":case "+":case "*":case "/":return z(b.operator,this.evaluateNode(b.left,
f,k),this.evaluateNode(b.right,f,k))}case "null":case "bool":case "string":case "number":return b.value;case "date":return x(b.value);case "timestamp":return q(b.value);case "current_time":return f=new Date,"date"===b.mode&&f.setHours(0,0,0,0),f;case "column_ref":return G(f,b.column,this.datefields,k);case "function":return f=this.evaluateNode(b.args,f,k),this.isAggregate?c.aggregateFunction(b.name,f):a.evaluateFunction(b.name,f)}throw Error("Unsupported sql syntax "+b.type);};return f}();b.WhereClause=
y;b.defaultAttributeAdapter={getAttribute:function(a,b){return(a&&"object"===typeof a.attributes?a.attributes:a)[b]}}})},"esri/core/sql/AggregateFunctions":function(){define(["require","exports"],function(y,b){function p(a){for(var b=0,c=0;c<a.length;c++)b+=a[c];return b/a.length}function n(a){for(var b=p(a),c=a.length,m=0,q=0;q<a.length;q++)m+=Math.pow(a[q]-b,2);return 1<c?m/(c-1):0}Object.defineProperty(b,"__esModule",{value:!0});b.aggregateFunction=function(a,b){var f=c[a.toLowerCase()];if(null==
f)throw Error("Function Not Recognised");if(b.length<f.minParams||b.length>f.maxParams)throw Error("Invalid Parameter count for call to "+a.toUpperCase());return f.evaluate(b)};b.isAggregate=function(a,b){a=c[a.toLowerCase()];return null!=a&&b>=a.minParams&&b<=a.maxParams};var c={min:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.min.apply(Math,a[0])}},max:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.max.apply(Math,a[0])}},avg:{minParams:1,maxParams:1,
evaluate:function(a){return null==a[0]?null:p(a[0])}},sum:{minParams:1,maxParams:1,evaluate:function(a){if(null==a[0])a=null;else{a=a[0];for(var b=0,c=0;c<a.length;c++)b+=a[c];a=b}return a}},stddev:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.sqrt(n(b[0]))}},count:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:b[0].length}},var:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:n(b[0])}}}})},"esri/core/sql/StandardizedFunctions":function(){define(["require",
"exports","../string"],function(y,b,p){Object.defineProperty(b,"__esModule",{value:!0});y=function(){function b(){this.op="+";this.minute=this.year=this.month=this.hour=this.second=this.day=0}b.fixDefaults=function(b){if(null!==b.precision||null!==b.secondary)throw Error("Primary and Secondary SqlInterval qualifiers not supported");};b.createFromMilliseconds=function(a){var c=new b;c.second=a/1E3;return c};b.createFromValueAndQualifer=function(a,c,f){var k=null,q=new b;q.op="-"===f?"-":"+";if("interval-period"===
c.type){b.fixDefaults(c);if("year"===c.period||"month"===c.period)throw Error("Year-Month Intervals not supported");if(/^[0-9]{1,}$/.test(a))q[c.period]=parseFloat(a);else throw Error("Illegal Interval");}else{b.fixDefaults(c.start);b.fixDefaults(c.end);if("year"===c.start.period||"month"===c.start.period)throw Error("Year-Month Intervals not supported");if("year"===c.end.period||"month"===c.end.period)throw Error("Year-Month Intervals not supported");switch(c.start.period){case "day":switch(c.end.period){case "hour":k=
/^[0-9]{1,} [0-9]{1,}$/;if(k.test(a))q[c.start.period]=parseFloat(a.split(" ")[0]),q[c.end.period]=parseFloat(a.split(" ")[1]);else throw Error("Illegal Interval");break;case "minute":k=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$/;if(k.test(a))q[c.start.period]=parseFloat(a.split(" ")[0]),a=a.split(" ")[1].split(":"),q.hour=parseFloat(a[0]),q.minute=parseFloat(a[1]);else throw Error("Illegal Interval");break;case "second":k=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(k.test(a))q[c.start.period]=
parseFloat(a.split(" ")[0]),a=a.split(" ")[1].split(":"),q.hour=parseFloat(a[0]),q.minute=parseFloat(a[1]),q.second=parseFloat(a[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "hour":switch(c.end.period){case "minute":k=/^[0-9]{1,}:[0-9]{1,}$/;if(k.test(a))q.hour=parseFloat(a.split(":")[0]),q.minute=parseFloat(a.split(":")[1]);else throw Error("Illegal Interval");break;case "second":k=/^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(k.test(a))a=
a.split(":"),q.hour=parseFloat(a[0]),q.minute=parseFloat(a[1]),q.second=parseFloat(a[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "minute":switch(c.end.period){case "second":k=/^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(k.test(a))a=a.split(":"),q.minute=parseFloat(a[0]),q.second=parseFloat(a[1]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;default:throw"Invalid Interval.";}}return q};b.prototype.valueInMilliseconds=
function(){return("-"===this.op?-1:1)*(1E3*this.second+6E4*this.minute+36E5*this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)};return b}();b.SqlInterval=y;b.evaluateFunction=function(b,a){var c=n[b.toLowerCase()];if(null==c)throw Error("Function Not Recognised");if(a.length<c.minParams||a.length>c.maxParams)throw Error("Invalid Parameter count for call to "+b.toUpperCase());return c.evaluate(a)};b.isStandardized=function(b,a){b=n[b.toLowerCase()];return null!=b&&a>=b.minParams&&
a<=b.maxParams};var n={extract:{minParams:2,maxParams:2,evaluate:function(b){var a=b[0];b=b[1];if(null==b)return null;if(b instanceof Date)switch(a.toUpperCase()){case "SECOND":return b.getSeconds();case "MINUTE":return b.getMinutes();case "HOUR":return b.getHours();case "DAY":return b.getDate();case "MONTH":return b.getMonth()+1;case "YEAR":return b.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,maxParams:3,evaluate:function(b){if(2===b.length){var a=
b[0],c=b[1];return null==a||null==c?null:a.toString().substring(c-1)}if(3===b.length)return a=b[0],c=b[1],b=b[2],null==a||null==c||null==b?null:0>=b?"":a.toString().substring(c-1,c+b-1)}},position:{minParams:2,maxParams:2,evaluate:function(b){var a=b[0];b=b[1];return null==a||null==b?null:b.indexOf(a)+1}},trim:{minParams:2,maxParams:3,evaluate:function(b){var a=3===b.length,c=a?b[1]:" ",a=a?b[2]:b[1];if(null==c||null==a)return null;c="("+p.escapeRegExpString(c)+")";switch(b[0]){case "BOTH":return a.replace(new RegExp("^"+
c+"*|"+c+"*$","g"),"");case "LEADING":return a.replace(new RegExp("^"+c+"*","g"),"");case "TRAILING":return a.replace(new RegExp(c+"*$","g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.abs(b[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.ceil(b[0])}},floor:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.floor(b[0])}},log:{minParams:1,maxParams:1,
evaluate:function(b){return null==b[0]?null:Math.log(b[0])}},log10:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.log(b[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.sin(b[0])}},cos:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.cos(b[0])}},tan:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.tan(b[0])}},asin:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?
null:Math.asin(b[0])}},acos:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.acos(b[0])}},atan:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.atan(b[0])}},sign:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:0<b[0]?1:0>b[1]?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(b){return null==b[0]||null==b[1]?null:Math.pow(b[0],b[1])}},mod:{minParams:2,maxParams:2,evaluate:function(b){return null==b[0]||null==b[1]?null:b[0]%
b[1]}},round:{minParams:1,maxParams:2,evaluate:function(b){var a=b[0];b=2===b.length?Math.pow(10,b[1]):1;return null==a?null:Math.round(a*b)/b}},truncate:{minParams:1,maxParams:2,evaluate:function(b){return null==b[0]?null:1===b.length?parseInt(b[0].toFixed(0),10):parseFloat(b[0].toFixed(b[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(b){return"string"===typeof b[0]||b[0]instanceof String?b[0].length:0}},concat:{minParams:1,maxParams:Infinity,evaluate:function(b){for(var a="",c=0;c<
b.length;c++){if(null==b[c])return null;a+=b[c].toString()}return a}},lower:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:b[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:b[0].toString().toUpperCase()}}}})},"esri/core/sql/WhereGrammar":function(){define(["require","exports","./sql92grammar"],function(y,b,p){Object.defineProperty(b,"__esModule",{value:!0});y=function(){function b(){}b.parse=function(b){return p.parse(b)};
return b}();b.WhereGrammar=y})},"esri/core/sql/sql92grammar":function(){(function(y,b){"function"===typeof define&&define.amd?define([],b):"object"===typeof module&&module.exports&&(module.exports=b())})(this,function(){function y(b,p,n,c){this.message=b;this.expected=p;this.found=n;this.location=c;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,y)}(function(b,p){function n(){this.constructor=b}n.prototype=p.prototype;b.prototype=new n})(y,Error);
y.buildMessage=function(b,p){function n(b){return b.charCodeAt(0).toString(16).toUpperCase()}function c(b){return b.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+n(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+n(b)})}function a(b){return b.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,
"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+n(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+n(b)})}var k={literal:function(b){return'"'+c(b.text)+'"'},"class":function(b){var c="",f;for(f=0;f<b.parts.length;f++)c+=b.parts[f]instanceof Array?a(b.parts[f][0])+"-"+a(b.parts[f][1]):a(b.parts[f]);return"["+(b.inverted?"^":"")+c+"]"},any:function(b){return"any character"},end:function(b){return"end of input"},other:function(b){return b.description}};
return"Expected "+function(b){var a=Array(b.length),c;for(c=0;c<b.length;c++){var f=c,n;n=b[c];n=k[n.type](n);a[f]=n}a.sort();if(0<a.length){for(b=c=1;c<a.length;c++)a[c-1]!==a[c]&&(a[b]=a[c],b++);a.length=b}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1]}}(b)+" but "+(p?'"'+c(p)+'"':"end of input")+" found."};return{SyntaxError:y,parse:function(b,p){function n(b,a){return{type:"literal",text:b,ignoreCase:a}}function c(b,
a,d){return{type:"class",parts:b,inverted:a,ignoreCase:d}}function a(a){var d=va[a],g;if(!d){for(g=a-1;!va[g];)g--;d=va[g];for(d={line:d.line,column:d.column};g<a;)10===b.charCodeAt(g)?(d.line++,d.column=1):d.column++,g++;va[a]=d}return d}function k(b,d){var g=a(b),c=a(d);return{start:{offset:b,line:g.line,column:g.column},end:{offset:d,line:c.line,column:c.column}}}function f(b){g<W||(g>W&&(W=g,Ja=[]),Ja.push(b))}function m(){var b,a,c;b=g;a=w();a!==d?(a=x(),a!==d?(c=w(),c!==d?b=a:(g=b,b=d)):(g=
b,b=d)):(g=b,b=d);return b}function q(){var b,a,c,f,e,h,k,l;b=g;a=x();if(a!==d){c=[];f=g;e=w();e!==d?(h=Ba(),h!==d?(k=w(),k!==d?(l=x(),l!==d?f=e=[e,h,k,l]:(g=f,f=d)):(g=f,f=d)):(g=f,f=d)):(g=f,f=d);for(;f!==d;)c.push(f),f=g,e=w(),e!==d?(h=Ba(),h!==d?(k=w(),k!==d?(l=x(),l!==d?f=e=[e,h,k,l]:(g=f,f=d)):(g=f,f=d)):(g=f,f=d)):(g=f,f=d);if(c!==d){b={type:"expr_list"};a=[a];for(f=0;f<c.length;f++)a.push(c[f][3]);b.value=a}else g=b,b=d}else g=b,b=d;return b}function x(){var b,a,c,f,e,h,k,l;b=g;a=r();if(a!==
d){c=[];f=g;e=w();e!==d?(h=ca(),h!==d?(k=w(),k!==d?(l=r(),l!==d?f=e=[e,h,k,l]:(g=f,f=d)):(g=f,f=d)):(g=f,f=d)):(g=f,f=d);for(;f!==d;)c.push(f),f=g,e=w(),e!==d?(h=ca(),h!==d?(k=w(),k!==d?(l=r(),l!==d?f=e=[e,h,k,l]:(g=f,f=d)):(g=f,f=d)):(g=f,f=d)):(g=f,f=d);c!==d?b=a=wa(a,c):(g=b,b=d)}else g=b,b=d;return b}function r(){var b,a,c,f,e,h,k,l;b=g;a=v();if(a!==d){c=[];f=g;e=w();e!==d?(h=ka(),h!==d?(k=w(),k!==d?(l=v(),l!==d?f=e=[e,h,k,l]:(g=f,f=d)):(g=f,f=d)):(g=f,f=d)):(g=f,f=d);for(;f!==d;)c.push(f),f=
g,e=w(),e!==d?(h=ka(),h!==d?(k=w(),k!==d?(l=v(),l!==d?f=e=[e,h,k,l]:(g=f,f=d)):(g=f,f=d)):(g=f,f=d)):(g=f,f=d);c!==d?b=a=wa(a,c):(g=b,b=d)}else g=b,b=d;return b}function v(){var a,c,e,h,k;a=g;c=X();c===d&&(c=g,33===b.charCodeAt(g)?(e=ad,g++):(e=d,0===u&&f(bd)),e!==d?(h=g,u++,61===b.charCodeAt(g)?(k=Ua,g++):(k=d,0===u&&f(Va)),u--,k===d?h=void 0:(g=h,h=d),h!==d?c=e=[e,h]:(g=c,c=d)):(g=c,c=d));c!==d?(e=w(),e!==d?(h=v(),h!==d?a=c={type:"unary_expr",operator:"NOT",expr:h}:(g=a,a=d)):(g=a,a=d)):(g=a,a=
d);if(a===d)if(a=g,c=D(),c!==d)if(e=w(),e!==d){var m,t,z;e=[];h=g;k=w();k!==d?(m=l(),m!==d?(t=w(),t!==d?(z=D(),z!==d?h=k=[k,m,t,z]:(g=h,h=d)):(g=h,h=d)):(g=h,h=d)):(g=h,h=d);if(h!==d)for(;h!==d;)e.push(h),h=g,k=w(),k!==d?(m=l(),m!==d?(t=w(),t!==d?(z=D(),z!==d?h=k=[k,m,t,z]:(g=h,h=d)):(g=h,h=d)):(g=h,h=d)):(g=h,h=d);else e=d;e!==d&&(e={type:"arithmetic",tail:e});e===d&&(e=g,h=F(),h!==d?(k=w(),k!==d?(k=Y(),k!==d?(k=w(),k!==d?(k=q(),k!==d?(m=w(),m!==d?(m=Z(),m!==d?e=h={op:h,right:k}:(g=e,e=d)):(g=e,
e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d),e===d&&(e=g,h=F(),h!==d?(k=w(),k!==d?(k=Y(),k!==d?(k=w(),k!==d?(k=Z(),k!==d?e=h={op:h,right:{type:"expr_list",value:[]}}:(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d),e===d&&(e=g,h=F(),h!==d?(k=w(),k!==d?(k=S(),k!==d?e=h={op:h,right:k}:(g=e,e=d)):(g=e,e=d)):(g=e,e=d))),e===d&&(e=g,k=X(),k!==d?(h=w(),h!==d?(h=ma(),h!==d?(m=w(),m!==d?(m=D(),m!==d?(t=w(),t!==d?(t=ka(),t!==d?(k=w(),k!==d?(k=D(),k!==d?e=k={op:"NOT"+h,right:{type:"expr_list",
value:[m,k]}}:(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d),e===d&&(e=g,k=ma(),k!==d?(h=w(),h!==d?(h=D(),h!==d?(m=w(),m!==d?(m=ka(),m!==d?(t=w(),t!==d?(t=D(),t!==d?e=k={op:k,right:{type:"expr_list",value:[h,t]}}:(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)),e===d&&(e=g,h=ea(),h!==d?(k=w(),k!==d?(k=X(),k!==d?(k=w(),k!==d?(k=D(),k!==d?e=h={op:h+"NOT",right:k}:(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d),e===
d&&(e=g,h=ea(),h!==d?(k=w(),k!==d?(k=D(),k!==d?e=h={op:h,right:k}:(g=e,e=d)):(g=e,e=d)):(g=e,e=d)),e===d&&(e=g,h=E(),h!==d?(k=w(),k!==d?(k=C(),k!==d?(m=w(),m!==d?(m=g,b.substr(g,6).toLowerCase()===cd?(t=b.substr(g,6),g+=6):(t=d,0===u&&f(dd)),t!==d?(t=g,u++,z=A(),u--,z===d?t=void 0:(g=t,t=d),t!==d?m="ESCAPE":(g=m,m=d)):(g=m,m=d),m!==d?(m=w(),m!==d?(m=J(),m!==d?e=h={op:h,right:k,escape:m.value}:(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d),e===d&&(e=g,h=E(),h!==d?(k=w(),
k!==d?(k=C(),k!==d?e=h={op:h,right:k,escape:""}:(g=e,e=d)):(g=e,e=d)):(g=e,e=d))))));e===d&&(e=null);e!==d?(a=c,c=e,""==c||void 0==c||null==c?c=a:(e=null,c=e="arithmetic"==c.type?wa(a,c.tail):Wa(c.op,a,c.right,c.escape)),a=c):(g=a,a=d)}else g=a,a=d;else g=a,a=d;return a}function l(){var a;b.substr(g,2)===Xa?(a=Xa,g+=2):(a=d,0===u&&f(ed));a===d&&(62===b.charCodeAt(g)?(a=fd,g++):(a=d,0===u&&f(gd)),a===d&&(b.substr(g,2)===Ya?(a=Ya,g+=2):(a=d,0===u&&f(hd)),a===d&&(b.substr(g,2)===Za?(a=Za,g+=2):(a=d,
0===u&&f(id)),a===d&&(60===b.charCodeAt(g)?(a=jd,g++):(a=d,0===u&&f(kd)),a===d&&(61===b.charCodeAt(g)?(a=Ua,g++):(a=d,0===u&&f(Va)),a===d&&(b.substr(g,2)===$a?(a=$a,g+=2):(a=d,0===u&&f(ld))))))));return a}function E(){var b,a,c,f;b=b=g;a=X();a!==d?(c=w(),c!==d?(f=ba(),f!==d?b=a=[a,c,f]:(g=b,b=d)):(g=b,b=d)):(g=b,b=d);b!==d&&(b=b[0]+" "+b[2]);b===d&&(b=ba());return b}function F(){var b,a,c,f;b=b=g;a=X();a!==d?(c=w(),c!==d?(f=Ta(),f!==d?b=a=[a,c,f]:(g=b,b=d)):(g=b,b=d)):(g=b,b=d);b!==d&&(b=b[0]+" "+
b[2]);b===d&&(b=Ta());return b}function D(){var b,a,c,f,k,l,m,t;b=g;a=e();if(a!==d){c=[];f=g;k=w();k!==d?(l=h(),l!==d?(m=w(),m!==d?(t=e(),t!==d?f=k=[k,l,m,t]:(g=f,f=d)):(g=f,f=d)):(g=f,f=d)):(g=f,f=d);for(;f!==d;)c.push(f),f=g,k=w(),k!==d?(l=h(),l!==d?(m=w(),m!==d?(t=e(),t!==d?f=k=[k,l,m,t]:(g=f,f=d)):(g=f,f=d)):(g=f,f=d)):(g=f,f=d);c!==d?b=a=wa(a,c):(g=b,b=d)}else g=b,b=d;return b}function h(){var a;43===b.charCodeAt(g)?(a=Zb,g++):(a=d,0===u&&f($b));a===d&&(45===b.charCodeAt(g)?(a=ac,g++):(a=d,0===
u&&f(bc)));return a}function e(){var b,a,c,f,e,h,k,l;b=g;a=z();if(a!==d){c=[];f=g;e=w();e!==d?(h=t(),h!==d?(k=w(),k!==d?(l=z(),l!==d?f=e=[e,h,k,l]:(g=f,f=d)):(g=f,f=d)):(g=f,f=d)):(g=f,f=d);for(;f!==d;)c.push(f),f=g,e=w(),e!==d?(h=t(),h!==d?(k=w(),k!==d?(l=z(),l!==d?f=e=[e,h,k,l]:(g=f,f=d)):(g=f,f=d)):(g=f,f=d)):(g=f,f=d);c!==d?b=a=wa(a,c):(g=b,b=d)}else g=b,b=d;return b}function t(){var a;42===b.charCodeAt(g)?(a=md,g++):(a=d,0===u&&f(nd));a===d&&(47===b.charCodeAt(g)?(a=od,g++):(a=d,0===u&&f(pd)));
return a}function z(){var a,c,e,h,k,l,m;m=J();if(m===d){var t,z,n,p;t=g;var r,v,B,I;r=g;v=zb();v!==d?(B=tc(),B!==d?(I=pa(),I!==d?r=v=parseFloat(v+B+I):(g=r,r=d)):(g=r,r=d)):(g=r,r=d);r===d&&(r=g,v=zb(),v!==d?(B=tc(),B!==d?r=v=parseFloat(v+B):(g=r,r=d)):(g=r,r=d),r===d&&(r=g,v=zb(),v!==d?(B=pa(),B!==d?r=v=parseFloat(v+B):(g=r,r=d)):(g=r,r=d),r===d&&(r=g,v=zb(),v!==d&&(v=parseFloat(v)),r=v)));z=r;z!==d?(n=g,u++,p=P(),u--,p===d?n=void 0:(g=n,n=d),n!==d?t=z={type:"number",value:z}:(g=t,t=d)):(g=t,t=d);
m=t;if(m===d){var L,E;L=g;var y,F,D,V;y=g;b.substr(g,4).toLowerCase()===qd?(F=b.substr(g,4),g+=4):(F=d,0===u&&f(rd));F!==d?(D=g,u++,V=A(),u--,V===d?D=void 0:(g=D,D=d),D!==d?y=F=[F,D]:(g=y,y=d)):(g=y,y=d);E=y;E!==d&&(E={type:"bool",value:!0});L=E;if(L===d){L=g;var ma,ba,X,ka;ma=g;b.substr(g,5).toLowerCase()===sd?(ba=b.substr(g,5),g+=5):(ba=d,0===u&&f(td));ba!==d?(X=g,u++,ka=A(),u--,ka===d?X=void 0:(g=X,X=d),X!==d?ma=ba=[ba,X]:(g=ma,ma=d)):(g=ma,ma=d);E=ma;E!==d&&(E={type:"bool",value:!1});L=E}m=L;
if(m===d){var la,ca,W,ea,wa;ca=g;b.substr(g,4).toLowerCase()===ud?(W=b.substr(g,4),g+=4):(W=d,0===u&&f(vd));W!==d?(ea=g,u++,wa=A(),u--,wa===d?ea=void 0:(g=ea,ea=d),ea!==d?ca=W=[W,ea]:(g=ca,ca=d)):(g=ca,ca=d);la=ca;la!==d&&(la={type:"null",value:null});m=la;if(m===d){var qa,va,Ba,za;qa=g;var Ca,sa,ab,Ja;Ca=g;b.substr(g,4).toLowerCase()===wd?(sa=b.substr(g,4),g+=4):(sa=d,0===u&&f(xd));sa!==d?(ab=g,u++,Ja=A(),u--,Ja===d?ab=void 0:(g=ab,ab=d),ab!==d?Ca=sa="DATE":(g=Ca,Ca=d)):(g=Ca,Ca=d);va=Ca;va!==d?
(Ba=w(),Ba!==d?(za=C(),za!==d?qa=va={type:"date",value:za.value}:(g=qa,qa=d)):(g=qa,qa=d)):(g=qa,qa=d);m=qa;if(m===d){var ra,cc,Ua,dc;ra=g;var Da,Cb,bb,Va;Da=g;b.substr(g,9).toLowerCase()===yd?(Cb=b.substr(g,9),g+=9):(Cb=d,0===u&&f(zd));Cb!==d?(bb=g,u++,Va=A(),u--,Va===d?bb=void 0:(g=bb,bb=d),bb!==d?Da=Cb="TIMESTAMP":(g=Da,Da=d)):(g=Da,Da=d);cc=Da;cc!==d?(Ua=w(),Ua!==d?(dc=C(),dc!==d?ra=cc={type:"timestamp",value:dc.value}:(g=ra,ra=d)):(g=ra,ra=d)):(g=ra,ra=d);m=ra;if(m===d){var M,Ka,Db,na,Eb,La,
Wa,ec;M=g;Ka=vc();Ka!==d?(Db=w(),Db!==d?(45===b.charCodeAt(g)?(na=ac,g++):(na=d,0===u&&f(bc)),na===d&&(43===b.charCodeAt(g)?(na=Zb,g++):(na=d,0===u&&f($b))),na!==d?(Eb=w(),Eb!==d?(La=C(),La!==d?(Wa=w(),Wa!==d?(ec=ta(),ec!==d?M=Ka={type:"interval",value:La,qualifier:ec,op:na}:(g=M,M=d)):(g=M,M=d)):(g=M,M=d)):(g=M,M=d)):(g=M,M=d)):(g=M,M=d)):(g=M,M=d);M===d&&(M=g,Ka=vc(),Ka!==d?(Db=w(),Db!==d?(na=C(),na!==d?(Eb=w(),Eb!==d?(La=ta(),La!==d?M=Ka={type:"interval",value:na,qualifier:La,op:""}:(g=M,M=d)):
(g=M,M=d)):(g=M,M=d)):(g=M,M=d)):(g=M,M=d));m=M}}}}}}a=m;if(a===d){var Q,fc,Xa,Ya,Za,gc,$a,lb,mb,hc,nb,ob;Q=g;var Ea,Fb,cb,pb;Ea=g;b.substr(g,7).toLowerCase()===Ad?(Fb=b.substr(g,7),g+=7):(Fb=d,0===u&&f(Bd));Fb!==d?(cb=g,u++,pb=A(),u--,pb===d?cb=void 0:(g=cb,cb=d),cb!==d?Ea=Fb="EXTRACT":(g=Ea,Ea=d)):(g=Ea,Ea=d);fc=Ea;if(fc!==d)if(Xa=w(),Xa!==d)if(Ya=Y(),Ya!==d)if(Za=w(),Za!==d){var fa;fa=wc();fa===d&&(fa=xc(),fa===d&&(fa=yc(),fa===d&&(fa=zc(),fa===d&&(fa=Ac(),fa===d&&(fa=Aa())))));gc=fa;gc!==d?($a=
w(),$a!==d?(lb=Yb(),lb!==d?(mb=w(),mb!==d?(hc=x(),hc!==d?(nb=w(),nb!==d?(ob=Z(),ob!==d?Q=fc={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:gc},hc]}}:(g=Q,Q=d)):(g=Q,Q=d)):(g=Q,Q=d)):(g=Q,Q=d)):(g=Q,Q=d)):(g=Q,Q=d)):(g=Q,Q=d)}else g=Q,Q=d;else g=Q,Q=d;else g=Q,Q=d;else g=Q,Q=d;a=Q;if(a===d){var O,ic,qb,rb,sb,Gb,tb,ub,vb,Hb,wb,aa,Ma,jc,kc,lc;O=g;var Fa,Ib,db,xb;Fa=g;b.substr(g,9).toLowerCase()===Cd?(Ib=b.substr(g,9),g+=9):(Ib=d,0===u&&f(Dd));Ib!==d?(db=g,u++,xb=A(),
u--,xb===d?db=void 0:(g=db,db=d),db!==d?Fa=Ib="SUBSTRING":(g=Fa,Fa=d)):(g=Fa,Fa=d);ic=Fa;if(ic!==d)if(qb=w(),qb!==d)if(rb=Y(),rb!==d)if(sb=w(),sb!==d)if(Gb=x(),Gb!==d)if(tb=w(),tb!==d)if(ub=Yb(),ub!==d)if(vb=w(),vb!==d)if(Hb=x(),Hb!==d)if(wb=w(),wb!==d){aa=g;var Ga,Jb,eb,Bc;Ga=g;b.substr(g,3).toLowerCase()===Ed?(Jb=b.substr(g,3),g+=3):(Jb=d,0===u&&f(Fd));Jb!==d?(eb=g,u++,Bc=A(),u--,Bc===d?eb=void 0:(g=eb,eb=d),eb!==d?Ga=Jb="FOR":(g=Ga,Ga=d)):(g=Ga,Ga=d);Ma=Ga;Ma!==d?(jc=w(),jc!==d?(kc=x(),kc!==d?
(lc=w(),lc!==d?aa=Ma=[Ma,jc,kc,lc]:(g=aa,aa=d)):(g=aa,aa=d)):(g=aa,aa=d)):(g=aa,aa=d);aa===d&&(aa=null);aa!==d?(Ma=Z(),Ma!==d?O=ic={type:"function",name:"substring",args:{type:"expr_list",value:aa?[Gb,Hb,aa[2]]:[Gb,Hb]}}:(g=O,O=d)):(g=O,O=d)}else g=O,O=d;else g=O,O=d;else g=O,O=d;else g=O,O=d;else g=O,O=d;else g=O,O=d;else g=O,O=d;else g=O,O=d;else g=O,O=d;else g=O,O=d;a=O;if(a===d){var H,Na,Kb,Lb,Mb,ga,Nb,Oa,Ob,Pb,Cc,mc,Dc,Ec;H=g;Na=uc();Na!==d?(Kb=w(),Kb!==d?(Lb=Y(),Lb!==d?(Mb=w(),Mb!==d?(ga=da(),
ga===d&&(ga=null),ga!==d?(Nb=w(),Nb!==d?(Oa=x(),Oa!==d?(Ob=w(),Ob!==d?(Pb=Yb(),Pb!==d?(Cc=w(),Cc!==d?(mc=x(),mc!==d?(Dc=w(),Dc!==d?(Ec=Z(),Ec!==d?H=Na={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==ga?"BOTH":ga},Oa,mc]}}:(g=H,H=d)):(g=H,H=d)):(g=H,H=d)):(g=H,H=d)):(g=H,H=d)):(g=H,H=d)):(g=H,H=d)):(g=H,H=d)):(g=H,H=d)):(g=H,H=d)):(g=H,H=d)):(g=H,H=d)):(g=H,H=d);H===d&&(H=g,Na=uc(),Na!==d?(Kb=w(),Kb!==d?(Lb=Y(),Lb!==d?(Mb=w(),Mb!==d?(ga=da(),ga===d&&(ga=null),
ga!==d?(Nb=w(),Nb!==d?(Oa=x(),Oa!==d?(Ob=w(),Ob!==d?(Pb=Z(),Pb!==d?H=Na={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==ga?"BOTH":ga},Oa]}}:(g=H,H=d)):(g=H,H=d)):(g=H,H=d)):(g=H,H=d)):(g=H,H=d)):(g=H,H=d)):(g=H,H=d)):(g=H,H=d)):(g=H,H=d));a=H;if(a===d){var R,nc,Fc,Gc,Hc,oc,Ic,Jc,Kc,pc,Lc,Mc;R=g;var Ha,Qb,fb,Nc;Ha=g;b.substr(g,8).toLowerCase()===Gd?(Qb=b.substr(g,8),g+=8):(Qb=d,0===u&&f(Hd));Qb!==d?(fb=g,u++,Nc=A(),u--,Nc===d?fb=void 0:(g=fb,fb=d),fb!==d?Ha=Qb=
"POSITION":(g=Ha,Ha=d)):(g=Ha,Ha=d);nc=Ha;nc!==d?(Fc=w(),Fc!==d?(Gc=Y(),Gc!==d?(Hc=w(),Hc!==d?(oc=x(),oc!==d?(Ic=w(),Ic!==d?(Jc=Ta(),Jc!==d?(Kc=w(),Kc!==d?(pc=x(),pc!==d?(Lc=w(),Lc!==d?(Mc=Z(),Mc!==d?R=nc={type:"function",name:"position",args:{type:"expr_list",value:[oc,pc]}}:(g=R,R=d)):(g=R,R=d)):(g=R,R=d)):(g=R,R=d)):(g=R,R=d)):(g=R,R=d)):(g=R,R=d)):(g=R,R=d)):(g=R,R=d)):(g=R,R=d)):(g=R,R=d);a=R;if(a===d){var T,Rb,Oc,Pc,Qc,Pa,Rc,Sc;T=g;var ha,gb,hb,oa;ha=g;ha=gb=G();if(ha===d)if(ha=g,96===b.charCodeAt(g)?
(gb=Tc,g++):(gb=d,0===u&&f(Uc)),gb!==d){hb=[];Vc.test(b.charAt(g))?(oa=b.charAt(g),g++):(oa=d,0===u&&f(Wc));if(oa!==d)for(;oa!==d;)hb.push(oa),Vc.test(b.charAt(g))?(oa=b.charAt(g),g++):(oa=d,0===u&&f(Wc));else hb=d;hb!==d?(96===b.charCodeAt(g)?(oa=Tc,g++):(oa=d,0===u&&f(Uc)),oa!==d?ha=gb=hb.join(""):(g=ha,ha=d)):(g=ha,ha=d)}else g=ha,ha=d;Rb=ha;Rb!==d?(Oc=w(),Oc!==d?(Pc=Y(),Pc!==d?(Qc=w(),Qc!==d?(Pa=q(),Pa===d&&(Pa=null),Pa!==d?(Rc=w(),Rc!==d?(Sc=Z(),Sc!==d?T=Rb={type:"function",name:Rb,args:Pa?Pa:
{type:"expr_list",value:[]}}:(g=T,T=d)):(g=T,T=d)):(g=T,T=d)):(g=T,T=d)):(g=T,T=d)):(g=T,T=d)):(g=T,T=d);a=T;if(a===d){var Sb,K,Qa,Tb,Ra,Ub,xa,ia,ib,Xc,Yc;K=g;Qa=Ab();if(Qa!==d)if(Tb=w(),Tb!==d)if(Ra=x(),Ra!==d)if(Ub=w(),Ub!==d){xa=[];for(ia=ua();ia!==d;)xa.push(ia),ia=ua();xa!==d?(ia=w(),ia!==d?(ib=Bb(),ib!==d?K=Qa={type:"case_expression",format:"simple",operand:Ra,clauses:xa,else:null}:(g=K,K=d)):(g=K,K=d)):(g=K,K=d)}else g=K,K=d;else g=K,K=d;else g=K,K=d;else g=K,K=d;if(K===d)if(K=g,Qa=Ab(),Qa!==
d)if(Tb=w(),Tb!==d)if(Ra=x(),Ra!==d)if(Ub=w(),Ub!==d){xa=[];for(ia=ua();ia!==d;)xa.push(ia),ia=ua();xa!==d?(ia=w(),ia!==d?(ib=sc(),ib!==d?(Xc=w(),Xc!==d?(Yc=Bb(),Yc!==d?K=Qa={type:"case_expression",format:"simple",operand:Ra,clauses:xa,else:ib.value}:(g=K,K=d)):(g=K,K=d)):(g=K,K=d)):(g=K,K=d)):(g=K,K=d)}else g=K,K=d;else g=K,K=d;else g=K,K=d;else g=K,K=d;Sb=K;if(Sb===d){var N,Sa,Vb,ya,ja,jb,Zc,$c;N=g;Sa=Ab();if(Sa!==d)if(Vb=w(),Vb!==d){ya=[];for(ja=yb();ja!==d;)ya.push(ja),ja=yb();ya!==d?(ja=w(),
ja!==d?(jb=Bb(),jb!==d?N=Sa={type:"case_expression",format:"searched",clauses:ya,else:null}:(g=N,N=d)):(g=N,N=d)):(g=N,N=d)}else g=N,N=d;else g=N,N=d;if(N===d)if(N=g,Sa=Ab(),Sa!==d)if(Vb=w(),Vb!==d){ya=[];for(ja=yb();ja!==d;)ya.push(ja),ja=yb();ya!==d?(ja=w(),ja!==d?(jb=sc(),jb!==d?(Zc=w(),Zc!==d?($c=Bb(),$c!==d?N=Sa={type:"case_expression",format:"searched",clauses:ya,else:jb.value}:(g=N,N=d)):(g=N,N=d)):(g=N,N=d)):(g=N,N=d)):(g=N,N=d)}else g=N,N=d;else g=N,N=d;Sb=N}a=Sb;if(a===d){var kb,Ia,qc,Wb,
Xb;Ia=g;qc=P();if(qc!==d){Wb=[];for(Xb=U();Xb!==d;)Wb.push(Xb),Xb=U();Wb!==d?Ia=qc+=Wb.join(""):(g=Ia,Ia=d)}else g=Ia,Ia=d;kb=Ia;if(kb!==d){var rc=kb;kb=/^CURRENT_DATE$/i.test(rc)?{type:"current_time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(rc)?{type:"current_time",mode:"timestamp"}:{type:"column_ref",table:"",column:rc}}a=kb;a===d&&(a=S(),a===d&&(a=g,c=Y(),c!==d?(e=w(),e!==d?(h=x(),h!==d?(k=w(),k!==d?(l=Z(),l!==d?(h.paren=!0,a=c=h):(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d)))}}}}}}}return a}
function G(){var b,a,c,f;b=g;a=P();if(a!==d){c=[];for(f=A();f!==d;)c.push(f),f=A();c!==d?b=a+=c.join(""):(g=b,b=d)}else g=b,b=d;return b}function P(){var a;Id.test(b.charAt(g))?(a=b.charAt(g),g++):(a=d,0===u&&f(Jd));return a}function A(){var a;Kd.test(b.charAt(g))?(a=b.charAt(g),g++):(a=d,0===u&&f(Ld));return a}function U(){var a;Md.test(b.charAt(g))?(a=b.charAt(g),g++):(a=d,0===u&&f(Nd));return a}function S(){var a,c,e;a=g;64===b.charCodeAt(g)?(c=Od,g++):(c=d,0===u&&f(Pd));c!==d?(e=G(),e!==d?a=c=
[c,e]:(g=a,a=d)):(g=a,a=d);a!==d&&(a={type:"param",value:a[1]});return a}function da(){var a,c,e;a=g;b.substr(g,7).toLowerCase()===Qd?(c=b.substr(g,7),g+=7):(c=d,0===u&&f(Rd));c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="LEADING":(g=a,a=d)):(g=a,a=d);a===d&&(a=g,b.substr(g,8).toLowerCase()===Sd?(c=b.substr(g,8),g+=8):(c=d,0===u&&f(Td)),c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="TRAILING":(g=a,a=d)):(g=a,a=d),a===d&&(a=g,b.substr(g,4).toLowerCase()===Ud?(c=b.substr(g,
4),g+=4):(c=d,0===u&&f(Vd)),c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="BOTH":(g=a,a=d)):(g=a,a=d)));return a}function ta(){var a,c,e;a=g;var h,k;c=g;e=L();e!==d?(h=w(),h!==d?(h=Y(),h!==d?(h=w(),h!==d?(h=I(),h!==d?(k=w(),k!==d?(k=Z(),k!==d?c=e={type:"interval-period",period:e.value,precision:h,secondary:null}:(g=c,c=d)):(g=c,c=d)):(g=c,c=d)):(g=c,c=d)):(g=c,c=d)):(g=c,c=d)):(g=c,c=d);c===d&&(c=g,e=L(),e!==d&&(e=lb(e)),c=e);if(c!==d)if(e=w(),e!==d)if(e=g,b.substr(g,2).toLowerCase()===
Wd?(h=b.substr(g,2),g+=2):(h=d,0===u&&f(Xd)),h!==d?(h=g,u++,k=A(),u--,k===d?h=void 0:(g=h,h=d),h!==d?e="TO":(g=e,e=d)):(g=e,e=d),e!==d)if(e=w(),e!==d){var l;e=g;h=L();h!==d&&(h={type:"interval-period",period:h.value,precision:null,secondary:null});e=h;e===d&&(e=g,h=Aa(),h!==d?(h=w(),h!==d?(h=Y(),h!==d?(h=w(),h!==d?(h=I(),h!==d?(k=w(),k!==d?(k=Ba(),k!==d?(k=w(),k!==d?(k=B(),k!==d?(l=w(),l!==d?(l=Z(),l!==d?e=h=mb(h,k):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,
e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d),e===d&&(e=g,h=Aa(),h!==d?(h=w(),h!==d?(h=Y(),h!==d?(h=w(),h!==d?(h=I(),h!==d?(k=w(),k!==d?(k=Z(),k!==d?e=h={type:"interval-period",period:"second",precision:h,secondary:null}:(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d),e===d&&(e=g,h=Aa(),h!==d&&(h={type:"interval-period",period:"second",precision:null,secondary:null}),e=h)));e!==d?a=c={type:"interval-qualifier",start:c,end:e}:(g=a,a=d)}else g=a,a=d;else g=a,a=d;else g=a,a=d;else g=
a,a=d;a===d&&(a=g,e=L(),e!==d?(c=w(),c!==d?(c=Y(),c!==d?(c=w(),c!==d?(c=B(),c!==d?(h=w(),h!==d?(h=Z(),h!==d?a=e={type:"interval-period",period:e.value,precision:c,secondary:null}:(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d),a===d&&(a=g,e=L(),e!==d&&(e=lb(e)),a=e,a===d&&(a=g,e=Aa(),e!==d?(c=w(),c!==d?(c=Y(),c!==d?(c=w(),c!==d?(c=I(),c!==d?(h=w(),h!==d?(h=Ba(),h!==d?(e=w(),e!==d?(e=B(),e!==d?(h=w(),h!==d?(h=Z(),h!==d?a=e=mb(c,e):(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=
d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d),a===d&&(a=g,e=Aa(),e!==d?(c=w(),c!==d?(c=Y(),c!==d?(c=w(),c!==d?(c=B(),c!==d?(h=w(),h!==d?(h=Z(),h!==d?a=e={type:"interval-period",period:"second",precision:c,secondary:null}:(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d),a===d&&(a=g,e=Aa(),e!==d&&(e={type:"interval-period",period:"second",precision:null,secondary:null}),a=e)))));return a}function L(){var b;b=g;b=yc();b!==d&&(b={type:"string",
value:"day"});b===d&&(b=g,b=zc(),b!==d&&(b={type:"string",value:"hour"}),b===d&&(b=g,b=Ac(),b!==d&&(b={type:"string",value:"minute"}),b===d&&(b=g,b=xc(),b!==d&&(b={type:"string",value:"month"}),b===d&&(b=g,b=wc(),b!==d&&(b={type:"string",value:"year"})))));return b}function B(){var b;b=V();b!==d&&(b=parseFloat(b));return b}function I(){var b;b=V();b!==d&&(b=parseFloat(b));return b}function C(){var b;b=J();b===d&&(b=S());return b}function J(){var a,c,e;a=g;39===b.charCodeAt(g)?(c=nb,g++):(c=d,0===
u&&f(ob));c===d&&(b.substr(g,2)===pb?(c=pb,g+=2):(c=d,0===u&&f(Yd)));if(c!==d){c=[];e=g;b.substr(g,2)===za?(e=za,g+=2):(e=d,0===u&&f(qb));e!==d&&(e="'");e===d&&(rb.test(b.charAt(g))?(e=b.charAt(g),g++):(e=d,0===u&&f(sb)));for(;e!==d;)c.push(e),e=g,b.substr(g,2)===za?(e=za,g+=2):(e=d,0===u&&f(qb)),e!==d&&(e="'"),e===d&&(rb.test(b.charAt(g))?(e=b.charAt(g),g++):(e=d,0===u&&f(sb)));c!==d?(39===b.charCodeAt(g)?(e=nb,g++):(e=d,0===u&&f(ob)),e!==d?a=c={type:"string",value:c.join("")}:(g=a,a=d)):(g=a,a=
d)}else g=a,a=d;return a}function yb(){var b,a,c;b=g;a=tb();a!==d?(a=w(),a!==d?(a=x(),a!==d?(c=w(),c!==d?(c=ub(),c!==d?(c=w(),c!==d?(c=x(),c!==d?b=a={type:"when_clause",operand:a,value:c}:(g=b,b=d)):(g=b,b=d)):(g=b,b=d)):(g=b,b=d)):(g=b,b=d)):(g=b,b=d)):(g=b,b=d);return b}function ua(){var b,a,c;b=g;a=tb();a!==d?(a=w(),a!==d?(a=x(),a!==d?(c=w(),c!==d?(c=ub(),c!==d?(c=w(),c!==d?(c=x(),c!==d?b=a={type:"when_clause",operand:a,value:c}:(g=b,b=d)):(g=b,b=d)):(g=b,b=d)):(g=b,b=d)):(g=b,b=d)):(g=b,b=d)):
(g=b,b=d);return b}function sc(){var a,c;a=g;var e,h;c=g;b.substr(g,4).toLowerCase()===Zd?(e=b.substr(g,4),g+=4):(e=d,0===u&&f($d));e!==d?(e=g,u++,h=A(),u--,h===d?e=void 0:(g=e,e=d),e!==d?c="ELSE":(g=c,c=d)):(g=c,c=d);c!==d?(c=w(),c!==d?(c=x(),c!==d?a={type:"else_clause",value:c}:(g=a,a=d)):(g=a,a=d)):(g=a,a=d);return a}function zb(){var a,c,e;a=V();a===d&&(a=g,45===b.charCodeAt(g)?(c=ac,g++):(c=d,0===u&&f(bc)),c===d&&(43===b.charCodeAt(g)?(c=Zb,g++):(c=d,0===u&&f($b))),c!==d?(e=V(),e!==d?a=c=c[0]+
e:(g=a,a=d)):(g=a,a=d));return a}function tc(){var a,c;a=g;46===b.charCodeAt(g)?(c=ae,g++):(c=d,0===u&&f(be));c!==d?(c=V(),c===d&&(c=null),c!==d?a="."+(null!=c?c:""):(g=a,a=d)):(g=a,a=d);return a}function pa(){var a,c,e;c=a=g;ce.test(b.charAt(g))?(e=b.charAt(g),g++):(e=d,0===u&&f(de));e!==d?(ee.test(b.charAt(g))?(e=b.charAt(g),g++):(e=d,0===u&&f(fe)),e===d&&(e=null),e!==d?c="e"+(null===e?"":e):(g=c,c=d)):(g=c,c=d);c!==d?(e=V(),e!==d?a=c+e:(g=a,a=d)):(g=a,a=d);return a}function V(){var b,a;b=[];a=
la();if(a!==d)for(;a!==d;)b.push(a),a=la();else b=d;b!==d&&(b=b.join(""));return b}function la(){var a;ge.test(b.charAt(g))?(a=b.charAt(g),g++):(a=d,0===u&&f(he));return a}function Ta(){var a,c,e;a=g;b.substr(g,2).toLowerCase()===ie?(c=b.substr(g,2),g+=2):(c=d,0===u&&f(je));c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="IN":(g=a,a=d)):(g=a,a=d);return a}function ea(){var a,c,e;a=g;b.substr(g,2).toLowerCase()===ke?(c=b.substr(g,2),g+=2):(c=d,0===u&&f(le));c!==d?(c=g,u++,e=A(),u--,e===d?
c=void 0:(g=c,c=d),c!==d?a="IS":(g=a,a=d)):(g=a,a=d);return a}function ba(){var a,c,e;a=g;b.substr(g,4).toLowerCase()===me?(c=b.substr(g,4),g+=4):(c=d,0===u&&f(ne));c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="LIKE":(g=a,a=d)):(g=a,a=d);return a}function X(){var a,c,e;a=g;b.substr(g,3).toLowerCase()===oe?(c=b.substr(g,3),g+=3):(c=d,0===u&&f(pe));c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="NOT":(g=a,a=d)):(g=a,a=d);return a}function ka(){var a,c,e;a=g;b.substr(g,3).toLowerCase()===
qe?(c=b.substr(g,3),g+=3):(c=d,0===u&&f(re));c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="AND":(g=a,a=d)):(g=a,a=d);return a}function ca(){var a,c,e;a=g;b.substr(g,2).toLowerCase()===se?(c=b.substr(g,2),g+=2):(c=d,0===u&&f(te));c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="OR":(g=a,a=d)):(g=a,a=d);return a}function ma(){var a,c,e;a=g;b.substr(g,7).toLowerCase()===ue?(c=b.substr(g,7),g+=7):(c=d,0===u&&f(ve));c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="BETWEEN":
(g=a,a=d)):(g=a,a=d);return a}function Yb(){var a,c,e;a=g;b.substr(g,4).toLowerCase()===we?(c=b.substr(g,4),g+=4):(c=d,0===u&&f(xe));c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="FROM":(g=a,a=d)):(g=a,a=d);return a}function uc(){var a,c,e;a=g;b.substr(g,4).toLowerCase()===ye?(c=b.substr(g,4),g+=4):(c=d,0===u&&f(ze));c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="TRIM":(g=a,a=d)):(g=a,a=d);return a}function vc(){var a,c,e;a=g;b.substr(g,8).toLowerCase()===Ae?(c=b.substr(g,
8),g+=8):(c=d,0===u&&f(Be));c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="INTERVAL":(g=a,a=d)):(g=a,a=d);return a}function wc(){var a,c,e;a=g;b.substr(g,4).toLowerCase()===Ce?(c=b.substr(g,4),g+=4):(c=d,0===u&&f(De));c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="YEAR":(g=a,a=d)):(g=a,a=d);return a}function xc(){var a,c,e;a=g;b.substr(g,5).toLowerCase()===Ee?(c=b.substr(g,5),g+=5):(c=d,0===u&&f(Fe));c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="MONTH":(g=a,a=
d)):(g=a,a=d);return a}function yc(){var a,c,e;a=g;b.substr(g,3).toLowerCase()===Ge?(c=b.substr(g,3),g+=3):(c=d,0===u&&f(He));c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="DAY":(g=a,a=d)):(g=a,a=d);return a}function zc(){var a,c,e;a=g;b.substr(g,4).toLowerCase()===Ie?(c=b.substr(g,4),g+=4):(c=d,0===u&&f(Je));c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="HOUR":(g=a,a=d)):(g=a,a=d);return a}function Ac(){var a,c,e;a=g;b.substr(g,6).toLowerCase()===Ke?(c=b.substr(g,6),g+=6):
(c=d,0===u&&f(Le));c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="MINUTE":(g=a,a=d)):(g=a,a=d);return a}function Aa(){var a,c,e;a=g;b.substr(g,6).toLowerCase()===Me?(c=b.substr(g,6),g+=6):(c=d,0===u&&f(Ne));c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="SECOND":(g=a,a=d)):(g=a,a=d);return a}function Ab(){var a,c,e;a=g;b.substr(g,4).toLowerCase()===Oe?(c=b.substr(g,4),g+=4):(c=d,0===u&&f(Pe));c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="CASE":(g=a,a=d)):(g=a,a=
d);return a}function Bb(){var a,c,e;a=g;b.substr(g,3).toLowerCase()===Qe?(c=b.substr(g,3),g+=3):(c=d,0===u&&f(Re));c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="END":(g=a,a=d)):(g=a,a=d);return a}function tb(){var a,c,e;a=g;b.substr(g,4).toLowerCase()===Se?(c=b.substr(g,4),g+=4):(c=d,0===u&&f(Te));c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="WHEN":(g=a,a=d)):(g=a,a=d);return a}function ub(){var a,c,e;a=g;b.substr(g,4).toLowerCase()===Ue?(c=b.substr(g,4),g+=4):(c=d,0===u&&
f(Ve));c!==d?(c=g,u++,e=A(),u--,e===d?c=void 0:(g=c,c=d),c!==d?a="THEN":(g=a,a=d)):(g=a,a=d);return a}function Ba(){var a;44===b.charCodeAt(g)?(a=We,g++):(a=d,0===u&&f(Xe));return a}function Y(){var a;40===b.charCodeAt(g)?(a=Ye,g++):(a=d,0===u&&f(Ze));return a}function Z(){var a;41===b.charCodeAt(g)?(a=$e,g++):(a=d,0===u&&f(af));return a}function w(){var a,b;a=[];for(b=vb();b!==d;)a.push(b),b=vb();return a}function vb(){var a;bf.test(b.charAt(g))?(a=b.charAt(g),g++):(a=d,0===u&&f(cf));return a}function Wa(a,
b,c,d){a={type:"binary_expr",operator:a,left:b,right:c};void 0!==d&&(a.escape=d);return a}function wa(a,b){for(var c=0;c<b.length;c++)a=Wa(b[c][1],a,b[c][3]);return a}p=void 0!==p?p:{};var d={},wb={start:m},xb=m,ad="!",bd=n("!",!1),Ua="\x3d",Va=n("\x3d",!1),Xa="\x3e\x3d",ed=n("\x3e\x3d",!1),fd="\x3e",gd=n("\x3e",!1),Ya="\x3c\x3d",hd=n("\x3c\x3d",!1),Za="\x3c\x3e",id=n("\x3c\x3e",!1),jd="\x3c",kd=n("\x3c",!1),$a="!\x3d",ld=n("!\x3d",!1),Zb="+",$b=n("+",!1),ac="-",bc=n("-",!1),md="*",nd=n("*",!1),od=
"/",pd=n("/",!1),Id=/^[A-Za-z_\x80-\uFFFF]/,Jd=c([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),Kd=/^[A-Za-z0-9_]/,Ld=c([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Md=/^[A-Za-z0-9_.\x80-\uFFFF]/,Nd=c([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),Od="@",Pd=n("@",!1),lb=function(a){return{type:"interval-period",period:a.value,precision:null,secondary:null}},mb=function(a,b){return{type:"interval-period",period:"second",precision:a,secondary:b}},nb="'",ob=n("'",!1),pb="N'",
Yd=n("N'",!1),za="''",qb=n("''",!1),rb=/^[^']/,sb=c(["'"],!0,!1),ae=".",be=n(".",!1),ge=/^[0-9]/,he=c([["0","9"]],!1,!1),ce=/^[eE]/,de=c(["e","E"],!1,!1),ee=/^[+\-]/,fe=c(["+","-"],!1,!1),ud="null",vd=n("NULL",!0),qd="true",rd=n("TRUE",!0),sd="false",td=n("FALSE",!0),ie="in",je=n("IN",!0),ke="is",le=n("IS",!0),me="like",ne=n("LIKE",!0),cd="escape",dd=n("ESCAPE",!0),oe="not",pe=n("NOT",!0),qe="and",re=n("AND",!0),se="or",te=n("OR",!0),ue="between",ve=n("BETWEEN",!0),we="from",xe=n("FROM",!0),Ed="for",
Fd=n("FOR",!0),Cd="substring",Dd=n("SUBSTRING",!0),Ad="extract",Bd=n("EXTRACT",!0),ye="trim",ze=n("TRIM",!0),Gd="position",Hd=n("POSITION",!0),yd="timestamp",zd=n("TIMESTAMP",!0),wd="date",xd=n("DATE",!0),Qd="leading",Rd=n("LEADING",!0),Sd="trailing",Td=n("TRAILING",!0),Ud="both",Vd=n("BOTH",!0),Wd="to",Xd=n("TO",!0),Ae="interval",Be=n("INTERVAL",!0),Ce="year",De=n("YEAR",!0),Ee="month",Fe=n("MONTH",!0),Ge="day",He=n("DAY",!0),Ie="hour",Je=n("HOUR",!0),Ke="minute",Le=n("MINUTE",!0),Me="second",Ne=
n("SECOND",!0),Oe="case",Pe=n("CASE",!0),Qe="end",Re=n("END",!0),Se="when",Te=n("WHEN",!0),Ue="then",Ve=n("THEN",!0),Zd="else",$d=n("ELSE",!0),We=",",Xe=n(",",!1),Ye="(",Ze=n("(",!1),$e=")",af=n(")",!1),bf=/^[ \t\n\r]/,cf=c([" ","\t","\n","\r"],!1,!1),Tc="`",Uc=n("`",!1),Vc=/^[^`]/,Wc=c(["`"],!0,!1),g=0,va=[{line:1,column:1}],W=0,Ja=[],u=0,sa;if("startRule"in p){if(!(p.startRule in wb))throw Error("Can't start parsing from rule \""+p.startRule+'".');xb=wb[p.startRule]}sa=xb();if(sa!==d&&g===b.length)return sa;
sa!==d&&g<b.length&&f({type:"end"});throw function(a,b,c){return new y(y.buildMessage(a,b),a,b,c)}(Ja,W<b.length?b.charAt(W):null,W<b.length?k(W,W+1):k(W,W));}}})},"esri/layers/graphics/data/projectionSupport":function(){define("require exports tslib ../../../core/Error ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(y,b,p,n,c,a,k,f,m){function q(a,
b){var c;if(!b)return null;if("x"in b){var e={x:0,y:0};a=a(b.x,b.y,l);e.x=a[0];e.y=a[1];null!=b.z&&(e.z=b.z);null!=b.m&&(e.m=b.m);return e}if("xmin"in b)return e={xmin:0,ymin:0,xmax:0,ymax:0},c=a(b.xmin,b.ymin,l),e.xmin=c[0],e.ymin=c[1],a=a(b.xmax,b.ymax,l),e.xmax=a[0],e.ymax=a[1],b.hasZ&&(e.zmin=b.zmin,e.zmax=b.zmax,e.hasZ=!0),b.hasM&&(e.mmin=b.mmin,e.mmax=b.mmax,e.hasM=!0),e;if("rings"in b)return{rings:x(b.rings,a),hasM:b.hasM,hasZ:b.hasZ};if("paths"in b)return{paths:x(b.paths,a),hasM:b.hasM,hasZ:b.hasZ};
if("points"in b)return{points:r(b.points,a),hasM:b.hasM,hasZ:b.hasZ}}function x(a,b){for(var c=[],e=0;e<a.length;e++)c.push(r(a[e],b));return c}function r(a,b){for(var c=[],e=0;e<a.length;e++){var f=a[e],h=b(f[0],f[1],[0,0]);c.push(h);2<f.length&&h.push(f[2]);3<f.length&&h.push(f[3])}return c}function v(a,b){return!f.isValid(a)||!f.isValid(b)||f.equals(a,b)||m.canProject(a,b)?!1:!0}Object.defineProperty(b,"__esModule",{value:!0});var l=[0,0];b.doesBrowserSupportProjection=function(b,c){return v(b,
c)?a.isSupported():!0};b.checkProjectionSupport=function(b,c){return p.__awaiter(this,void 0,void 0,function(){var e,f,h;return p.__generator(this,function(k){if(!c)return[2];if(Array.isArray(b)){e=0;for(f=b;e<f.length;e++)if(h=f[e],v(h.geometry&&h.geometry.spatialReference,c)){if(a.isSupported())return[2,a.load()];throw new n("feature-store:unsupported-query","projection not supported",{inSpatialReference:b,outSpatialReference:c});}return[2]}if(!v(b,c))return[2];if(a.isSupported())return[2,a.load()];
throw new n("feature-store:unsupported-query","projection not supported",{inSpatialReference:b,outSpatialReference:c});})})};var E=q.bind(null,m.lngLatToXY),F=q.bind(null,m.xyToLngLat);b.project=function(b,c,l){if(!b)return b;l||(l=c,c=b.spatialReference);return f.isValid(c)&&f.isValid(l)&&!f.equals(c,l)?m.canProject(c,l)?f.isWebMercator(l)?E(b):F(b):a.projectMany(k.jsonAdapter,[b],c,l,null)[0]:b};var D=new (function(){function b(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}
b.prototype.push=function(a,b,h){return p.__awaiter(this,void 0,void 0,function(){var e,k=this;return p.__generator(this,function(l){a&&a.length&&b&&h&&!f.equals(b,h)||c.resolve(a);e={geometries:a,inSpatialReference:b,outSpatialReference:h,resolve:null};this._jobs.push(e);return[2,c.create(function(a){e.resolve=a;null===k._timer&&(k._timer=setTimeout(k._process,10))})]})})};b.prototype._process=function(){this._timer=null;var b=this._jobs.shift();if(b){var c=b.geometries,h=b.inSpatialReference,l=
b.outSpatialReference,b=b.resolve;m.canProject(h,l)?f.isWebMercator(l)?b(c.map(E)):b(c.map(F)):b(a.projectMany(k.jsonAdapter,c,h,l,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return b}());b.projectMany=function(a,b,c){return p.__awaiter(this,void 0,void 0,function(){return p.__generator(this,function(e){return[2,D.push(a,b,c)]})})}})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["require","exports"],function(y,b){Object.defineProperty(b,"__esModule",
{value:!0});b.queryCapabilities={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,
supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports tslib ../../../core/MapUtils ../../../core/maybe ../../../core/promiseUtils ../../../core/SetUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./AttributesBuilder ./attributeSupport ./projectionSupport ./timeSupport ./utils".split(" "),
function(y,b,p,n,c,a,k,f,m,q,x,r,v,l,E){function F(a){return a.substr(24,12)+a.substr(19,4)+a.substr(16,2)+a.substr(14,2)+a.substr(11,2)+a.substr(9,2)+a.substr(6,2)+a.substr(4,2)+a.substr(2,2)+a.substr(0,2)}function D(a,b,c,f){if(c&&"esriFieldTypeDate"===c.type){var e=(new Date(a)).getTime(),h=(new Date(b)).getTime();if(!isNaN(e)&&!isNaN(h))return f?h-e:e-h}return"number"===typeof a&&"number"===typeof b?f?b-a:a-b:"string"===typeof a&&"string"===typeof b?(e=a.toUpperCase(),h=b.toUpperCase(),!c||"esriFieldTypeGUID"!==
c.type&&"esriFieldTypeGlobalID"!==c.type?f=(f?e>h:e<h)?-1:(f?e<h:e>h)?1:0:(a=F(e),h=F(h),f=(f?a>h:a<h)?-1:(f?a<h:a>h)?1:0),f):f?1:-1}Object.defineProperty(b,"__esModule",{value:!0});y=function(){function b(a,b,c){this.items=a;this.queryGeometry=b;this.definitionExpression=c.definitionExpression;this.geometryType=c.geometryType;this.hasM=c.hasM;this.hasZ=c.hasZ;this.objectIdField=c.objectIdField;this.spatialReference=c.spatialReference;this.fieldsIndex=c.fieldsIndex;this.timeInfo=c.timeInfo;this.featureAdapter=
c.featureAdapter}Object.defineProperty(b.prototype,"size",{get:function(){return this.items.length},enumerable:!0,configurable:!0});b.prototype.createQueryResponse=function(a){var b;b=a.outStatistics?a.outStatistics.some(function(a){return"exceedslimit"===a.statisticType})?this._createExceedsLimitQueryResponse(a):this._createStatisticsQueryResponse(a):this._createFeatureQueryResponse(a);a.returnQueryGeometry&&(m.isValid(a.outSR)&&!m.equals(this.queryGeometry.spatialReference,a.outSR)?b.queryGeometry=
E.cleanFromGeometryEngine(p.__assign({spatialReference:a.outSR},v.project(this.queryGeometry,this.queryGeometry.spatialReference,a.outSR))):b.queryGeometry=E.cleanFromGeometryEngine(p.__assign({spatialReference:a.outSR},this.queryGeometry)));return b};b.prototype.executeAttributesQuery=function(c){var e=r.getWhereClause(c.where,this.fieldsIndex);if(!e)return a.resolve(this);if(e.isStandardized){for(var f=0,h=[],k=0,l=this.items;k<l.length;k++){var m=l[k];e.testFeature(m,this.featureAdapter)&&(h[f++]=
m)}e=new b(h,this.queryGeometry,this);e.definitionExpression=c.where;return a.resolve(e)}return a.reject(new TypeError("Where clause is not standardized"))};b.prototype.executeObjectIdsQuery=function(c){if(!c.objectIds||!c.objectIds.length)return a.resolve(this);var e=k.SetFromValues(c.objectIds),f=this.featureAdapter.getObjectId;return a.resolve(new b(this.items.filter(function(a){return e.has(f(a))}),this.queryGeometry,this))};b.prototype.executeTimeQuery=function(e){e=l.getTimeOperator(this.timeInfo,
e.timeExtent,this.featureAdapter);if(!c.isSome(e))return a.resolve(this);e=this.items.filter(e);return a.resolve(new b(e,this.queryGeometry,this))};b.prototype.filterLatest=function(){for(var c=this.timeInfo,f=c.trackIdField,h=c.startTimeField,c=c.endTimeField||h,h=new Map,k=this.featureAdapter.getAttribute,l=0,m=this.items;l<m.length;l++){var q=m[l],p=k(q,f),r=k(q,c),x=h.get(p);(!x||r>k(x,c))&&h.set(p,q)}f=n.valuesOfMap(h);return a.resolve(new b(f,this.queryGeometry,this))};b.prototype.project=function(a){return p.__awaiter(this,
void 0,void 0,function(){var c,e,f,h=this;return p.__generator(this,function(k){switch(k.label){case 0:if(!a||m.equals(this.spatialReference,a))return[2,this];c=this.featureAdapter;return[4,v.projectMany(this.items.map(function(a){return E.getGeometry(h.geometryType,h.hasZ,h.hasM,c.getGeometry(a))}),this.spatialReference,a)];case 1:return e=k.sent(),f=e.map(function(a,b){return c.cloneWithGeometry(h.items[b],q.convertFromGeometry(a,h.hasZ,h.hasM))}),[2,new b(f,this.queryGeometry,{definitionExpression:this.definitionExpression,
geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:a,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})]}})})};b.prototype._sortFeatures=function(a,b,c){if(1<a.length&&b&&b.length){var e=function(b){b=b.split(" ");var e=b[0],h=f.fieldsIndex.get(e),k=b[1]&&"desc"===b[1].toLowerCase();a.sort(function(a,b){a=c(a,e,h);b=c(b,e,h);return D(a,b,h,k)})},f=this,h=0;for(b=b.reverse();h<b.length;h++)e(b[h])}};b.prototype._createFeatureQueryResponse=
function(a){var b=this,c=this.items,e=this.geometryType,h=this.hasM,k=this.hasZ,l=this.objectIdField,m=this.spatialReference,n=a.outFields,q=a.outSR,r=a.quantizationParameters,x=a.resultRecordCount,v=a.resultOffset,C=a.returnZ,J=a.returnM,y=!1;null!=x&&null!=v&&(x=v+x,y=c.length>x,c=c.slice(v,Math.min(c.length,x)));n=n&&(-1<n.indexOf("*")?p.__spreadArrays(this.fieldsIndex.fields):n.map(function(a){return b.fieldsIndex.get(a)}));return{exceededTransferLimit:y,features:this._createFeatures(a,c),fields:n,
geometryType:e,hasM:h&&J,hasZ:k&&C,objectIdFieldName:l,spatialReference:E.cleanFromGeometryEngine(q?q:m),transform:r&&f.toQuantizationTransform(r)||null}};b.prototype._createFeatures=function(a,b){var c=new x.default(a,this.featureAdapter,this.fieldsIndex),e=a.orderByFields,h=a.quantizationParameters,k=a.returnGeometry,l=a.returnCentroid,m=a.maxAllowableOffset,n=a.returnZ;a=a.returnM;var q=this.hasZ&&(void 0===n?!1:n),t=this.hasM&&(void 0===a?!1:a),n=[];a=0;if(k||l)if(h=f.toQuantizationTransform(h),
k&&!l)for(l=0;l<b.length;l++)k=b[l],n[a++]={attributes:c.getAttributes(k),geometry:E.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(k),m,h,q,t)};else if(!k&&l)for(m=0;m<b.length;m++)k=b[m],n[a++]={attributes:c.getAttributes(k),centroid:E.transformCentroid(this,this.featureAdapter.getCentroid(k,this),h)};else for(l=0;l<b.length;l++)k=b[l],n[a++]={attributes:c.getAttributes(k),centroid:E.transformCentroid(this,this.featureAdapter.getCentroid(k,this),h),geometry:E.getGeometry(this.geometryType,
this.hasZ,this.hasM,this.featureAdapter.getGeometry(k),m,h,q,t)};else for(m=0;m<b.length;m++)k=b[m],(q=c.getAttributes(k))&&(n[a++]={attributes:q});this._sortFeatures(n,e,function(a,b,e){return c.getFieldValue(a,b,e)});return n};b.prototype._createExceedsLimitQueryResponse=function(a){var b=!1,c=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,b=Number.POSITIVE_INFINITY,f=0;for(a=a.outStatistics;f<a.length;f++){var h=a[f];if("exceedslimit"===h.statisticType){c=null!=h.maxPointCount?h.maxPointCount:
Number.POSITIVE_INFINITY;e=null!=h.maxRecordCount?h.maxRecordCount:Number.POSITIVE_INFINITY;b=null!=h.maxVertexCount?h.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)b=this.items.length>c;else if(this.items.length>e)b=!0;else var c=this.hasZ?this.hasM?4:3:this.hasM?3:2,k=this.featureAdapter,b=this.items.reduce(function(a,b){b=k.getGeometry(b);return a+(b&&b.coords.length||0)},0)/c>b;return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",
sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(b)}}]}};b.prototype._createStatisticsQueryResponse=function(a){var b=this,c={attributes:{}},e=[],f=new Map,h=new Map,k=new Map,l=new Map,m=new x.default(a,this.featureAdapter,this.fieldsIndex),q=a.outStatistics,p=a.groupByFieldsForStatistics,r=a.having;a=a.orderByFields;for(var v=p&&p.length,C=!!v,J=C&&p[0],E=C&&!this.fieldsIndex.get(J),ua=0;ua<q.length;ua++){var y=q[ua],F=y.outStatisticFieldName,D=
y.statisticType,pa=y,V="exceedslimit"!==D?y.onStatisticField:void 0,la="percentile_disc"===D||"percentile_cont"===D,Ta=C&&1===v&&(V===J||E)&&"count"===D;if(C){if(!k.has(V)){for(var y=[],D=0,ea=p;D<ea.length;D++){var ba=this._getAttributeValues(m,ea[D],f);y.push(ba)}k.set(V,this._calculateUniqueValues(y))}var X=k.get(V),y=function(a){var c=X[a];a=c.count;var e=c.data,h=c.items,k=c.itemPositions,c=e.join(",");if(!r||m.validateItems(h,r)){var n=l.get(c)||{attributes:{}},h=null;if(Ta)h=a;else{var q=ka._getAttributeValues(m,
V,f);a=k.map(function(a){return q[a]});h=la&&"statisticParameters"in pa?ka._getPercentileValue(pa,a):ka._getStatisticValue(pa,a)}n.attributes[F]=h;p.forEach(function(a,c){return n.attributes[b.fieldsIndex.get(a)?a:"EXPR_"+(c+1)]=e[c]});l.set(c,n)}},ka=this,ca;for(ca in X)y(ca)}else ba=this._getAttributeValues(m,V,f),c.attributes[F]=la&&"statisticParameters"in pa?this._getPercentileValue(pa,ba):this._getStatisticValue(pa,ba,h);e.push({name:F,alias:F,type:"esriFieldTypeDouble"})}c=C?n.valuesOfMap(l):
[c];this._sortFeatures(c,a,function(a,b){return a.attributes[b]});return{fields:e,features:c}};b.prototype._getStatisticValue=function(a,b,c){var e=a.onStatisticField;a=a.statisticType;b=c&&c.has(e)?c.get(e):this._calculateStatistics(b);c&&c.set(e,b);return b["var"===a?"variance":a]};b.prototype._getPercentileValue=function(a,b){var c=a.statisticParameters,e=a.statisticType,f=c.value,h="desc"===c.orderBy,k=this.fieldsIndex.get(a.onStatisticField);a=p.__spreadArrays(b).sort(function(a,b){return D(a,
b,k,h)});return this._calculatePercentile(a,f,"percentile_disc"===e)};b.prototype._getAttributeValues=function(a,b,c){if(c.has(b))return c.get(b);var e=this.fieldsIndex.get(b),f=this.items.map(function(c){return a.getFieldValue(c,b,e)});c.set(b,f);return f};b.prototype._calculateStatistics=function(a){for(var b=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,f=null,e=null,h=null,k=null,l=[],m=0,n=0;n<a.length;n++){var q=a[n];"string"===typeof q?m++:null==q||isNaN(q)||(f+=q,b=Math.min(b,q),c=Math.max(c,
q),l.push(q),m++)}if(m){e=f/m;for(h=a=0;h<l.length;h++)q=l[h],a+=Math.pow(q-e,2);k=1<m?a/(m-1):0;h=Math.sqrt(k)}else c=b=null;return{avg:e,count:m,max:c,min:b,stddev:h,sum:f,variance:k}};b.prototype._calculateUniqueValues=function(a){for(var b={},c=this.items,f=c.length,e=0;e<f;e++){for(var h=c[e],k=[],l=0,m=a;l<m.length;l++)k.push(m[l][e]);l=k.join(",");null==b[l]?b[l]={count:1,data:k,items:[h],itemPositions:[e]}:(b[l].count++,b[l].items.push(h),b[l].itemPositions.push(e))}return b};b.prototype._calculatePercentile=
function(a,b,c){if(0===a.length)return null;if(0>=b)return a[0];if(1<=b)return a[a.length-1];var f=(a.length-1)*b,e=Math.floor(f);b=e+1;var f=f%1,e=a[e],h=a[b];return b>=a.length||c||"string"===typeof e||"string"===typeof h?e:e*(1-f)+h*f};return b}();b.default=y})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["require","exports","../../../core/maybe","./attributeSupport"],function(y,b,p,n){Object.defineProperty(b,"__esModule",{value:!0});y=function(){function b(a,b,c){this._fieldDataCache=
new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=a.returnDistinctValues;this.fieldsIndex=c;this.featureAdapter=b;if((a=a.outFields)&&-1===a.indexOf("*")){this.outFields=a;for(var f=b=0;f<a.length;f++){var k=a[f],p=n.getExpressionFromFieldName(k),r=this.fieldsIndex.get(p),p=r?null:n.getWhereClause(p,c),r=r?r.name:n.getAliasFromFieldName(k)||"FIELD_EXP_"+b++;this._fieldDataCache.set(k,{alias:r,clause:p})}}}b.prototype.getAttributes=function(a){a=this._processAttributesForOutFields(a);
return this._processAttributesForDistinctValues(a)};b.prototype.getFieldValue=function(a,b,c){var f=c?c.name:b,k=null;this._fieldDataCache.has(f)?k=this._fieldDataCache.get(f).clause:c||(k=n.getWhereClause(b,this.fieldsIndex),this._fieldDataCache.set(f,{alias:f,clause:k}));return c?this.featureAdapter.getAttribute(a,f):k.calculateValue(a,this.featureAdapter)};b.prototype.validateItem=function(a,b){this._fieldDataCache.has(b)||this._fieldDataCache.set(b,{alias:b,clause:n.getWhereClause(b,this.fieldsIndex)});
return this._fieldDataCache.get(b).clause.testFeature(a,this.featureAdapter)};b.prototype.validateItems=function(a,b){this._fieldDataCache.has(b)||this._fieldDataCache.set(b,{alias:b,clause:n.getWhereClause(b,this.fieldsIndex)});return this._fieldDataCache.get(b).clause.testSet(a,this.featureAdapter)};b.prototype._processAttributesForOutFields=function(a){var b=this.outFields;if(!b||!b.length)return this.featureAdapter.getAttributes(a);for(var c={},m=0;m<b.length;m++){var n=this._fieldDataCache.get(b[m]),
p=n.alias,n=n.clause;c[p]=n?n.calculateValue(a,this.featureAdapter):this.featureAdapter.getAttribute(a,p)}return c};b.prototype._processAttributesForDistinctValues=function(a){if(p.isNone(a)||!this.returnDistinctValues)return a;var b=this.outFields,c=[];if(b)for(var m=0;m<b.length;m++){var n=this._fieldDataCache.get(b[m]).alias;c.push(a[n])}else for(n in a)c.push(a[n]);b=(b||["*"]).join(",")+"\x3d"+c.join(",");c=this._returnDistinctMap.get(b)||0;this._returnDistinctMap.set(b,++c);return 1<c?null:
a};return b}();b.default=y})},"esri/layers/graphics/data/timeSupport":function(){define(["require","exports"],function(y,b){function p(a,b,c,m,n){if(null!=m&&null!=n&&m===n)return function(f){return m>=a.getAttribute(f,b)&&m<=a.getAttribute(f,c)};if(null!=m&&null!=n)return function(f){var k=a.getAttribute(f,b);f=a.getAttribute(f,c);return!(k>n||f<m)};if(null!=m)return function(b){return!(a.getAttribute(b,c)<m)};if(null!=n)return function(c){return!(a.getAttribute(c,b)>n)}}function n(a,b,c,m){if(null!=
c&&null!=m&&c===m)return function(f){return a.getAttribute(f,b)===c};if(null!=c&&null!=m)return function(f){return a.getAttribute(f,b)>=c&&a.getAttribute(f,b)<=m};if(null!=c)return function(f){return a.getAttribute(f,b)>=c};if(null!=m)return function(c){return a.getAttribute(c,b)<=m}}function c(){return function(){return!1}}Object.defineProperty(b,"__esModule",{value:!0});b.getTimeExtent=function(a,b){if(!a)return null;var c=b.featureAdapter,k=a.startTimeField,n=a.endTimeField,p=Number.POSITIVE_INFINITY,
r=Number.NEGATIVE_INFINITY;if(k&&n)b.forEach(function(a){var b=c.getAttribute(a,k);a=c.getAttribute(a,n);null==b||isNaN(b)||(p=Math.min(p,b));null==a||isNaN(a)||(r=Math.max(r,a))});else{var v=k||n;b.forEach(function(a){a=c.getAttribute(a,v);null==a||isNaN(a)||(p=Math.min(p,a),r=Math.max(r,a))})}return{start:p,end:r}};b.getTimeOperator=function(a,b,f){if(!b||!a)return null;var k=a.startTimeField;a=a.endTimeField;if(!k&&!a)return null;var q=b.start;b=b.end;return null===q&&null===b?null:void 0===q&&
void 0===b?c():k&&a?p(f,k,a,q,b):n(f,k||a,q,b)}})},"esri/layers/graphics/data/utils":function(){define("require exports tslib ../../../core/jsonMap ../../../core/maybe ../../../core/unitUtils ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../centroid ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./spatialQuerySupport".split(" "),function(y,b,p,n,c,a,k,f,m,q,x,r,
v,l,E){function F(a,b,c,f,e){void 0===f&&(f=a.hasZ);void 0===e&&(e=a.hasM);var h=a.hasZ&&f,k=a.hasM&&e;return c?(a=r.quantizeOptimizedGeometry(G,b,a.hasZ,a.hasM,"esriGeometryPoint",c,f,e),r.convertToPoint(a,h,k)):r.convertToPoint(b,h,k)}function D(a,e,n){return p.__awaiter(this,void 0,void 0,function(){var q,r,t,C,J,v;return p.__generator(this,function(p){switch(p.label){case 0:if(!a)return[2,null];q=a.where;a.where=q=q&&q.trim();if(!q||/^1 *= *1$/.test(q)||e&&e===q)a.where=null;return a.geometry?
[4,h(a)]:[2,a];case 1:return r=p.sent(),a.distance=0,a.units=null,"esriSpatialRelEnvelopeIntersects"===a.spatialRel&&(t=a.geometry.spatialReference,r=k.getGeometryExtent(r),r.spatialReference=t),a.geometry=r,[4,l.checkProjectionSupport(r.spatialReference,n)];case 2:return p.sent(),[4,m.normalizeCentralMeridian(f.fromJSON(r))];case 3:C=p.sent()[0];if(c.isNone(C))throw b.QUERY_ENGINE_EMPTY_RESULT;J=C.toJSON();return[4,l.project(J,J.spatialReference,n)];case 4:v=p.sent();if(!v)throw b.QUERY_ENGINE_EMPTY_RESULT;
v.spatialReference=n;a.geometry=v;return[2,a]}})})}function h(b){return p.__awaiter(this,void 0,void 0,function(){var c,f,h,k,m,n,r,t,v;return p.__generator(this,function(p){switch(p.label){case 0:c=b.geometry;f=b.distance;h=b.units;if(null==f||"vertexAttributes"in c)return[2,c];k=c.spatialReference;m=h?e.fromJSON(h):a.getUnitString(k);n=k&&(q.isGeographic(k)||q.isWebMercator(k));if(!n)return[3,1];t=c;return[3,3];case 1:return[4,l.checkProjectionSupport(k,q.WGS84).then(function(){return l.project(c,
q.WGS84)})];case 2:t=p.sent(),p.label=3;case 3:return r=t,[4,E.getGeodesicBufferOperator()];case 4:return v=p.sent(),[2,v(r.spatialReference,r,f,m)]}})})}Object.defineProperty(b,"__esModule",{value:!0});var e=new n.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});b.QUERY_ENGINE_EMPTY_RESULT=Object.freeze({});var t=new v.default,z=new v.default,
G=new v.default,P={esriGeometryPoint:r.convertToPoint,esriGeometryPolyline:r.convertToPolyline,esriGeometryPolygon:r.convertToPolygon,esriGeometryMultipoint:r.convertToMultipoint};b.transformCentroid=F;b.getCentroid=function(a,b,c){if("esriGeometryPolygon"!==a.geometryType||!b||!b.centroid&&!b.geometry)return null;b.centroid||(b.centroid=x.getCentroidOptimizedGeometry(new v.default,b.geometry,a.hasZ,a.hasM));return F(a,b.centroid,c)};b.getGeometry=function(a,b,c,f,e,h,k,l){void 0===k&&(k=b);void 0===
l&&(l=c);var m=b&&k,n=c&&l;f=f?"coords"in f?f:f.geometry:null;if(!f)return null;if(e)return b=r.generalizeOptimizedGeometry(z,f,b,c,a,e,k,l),h&&(b=r.quantizeOptimizedGeometry(G,b,m,n,a,h)),P[a](b,m,n);if(h)return b=r.quantizeOptimizedGeometry(G,f,b,c,a,h,k,l),P[a](b,m,n);r.removeZMValues(t,f,b,c,k,l);return P[a](t,m,n)};b.normalizeQuery=function(a,b,c){return p.__awaiter(this,void 0,void 0,function(){var f,e,h,k,l;return p.__generator(this,function(m){f=a.outFields;e=a.orderByFields;h=a.groupByFieldsForStatistics;
k=a.outStatistics;if(f)for(l=0;l<f.length;l++)f[l]=f[l].trim();if(e)for(l=0;l<e.length;l++)e[l]=e[l].trim();if(h)for(l=0;l<h.length;l++)h[l]=h[l].trim();if(k)for(l=0;l<k.length;l++)k[l].onStatisticField&&(k[l].onStatisticField=k[l].onStatisticField.trim());a.geometry&&!a.outSR&&(a.outSR=a.geometry.spatialReference);return[2,D(a,b,c)]})})};b.normalizeFilter=function(a,b,c){return p.__awaiter(this,void 0,void 0,function(){return p.__generator(this,function(f){return[2,D(a,b,c)]})})};b.normalizeQueryLike=
D;b.cleanFromGeometryEngine=function(a){return a&&A in a?JSON.parse(JSON.stringify(a,U)):a};var A="_geVersion",U=function(a,b){return a!==A?b:void 0}})},"esri/layers/graphics/centroid":function(){define(["require","exports"],function(y,b){function p(b,a,k,f,m,n){n=m?n?4:3:n?3:2;var c=k,p=k+n,q=0,l=0,y=k=0,F=0,D=0;for(--f;D<f;D++,c+=n,p+=n){var h=a[c],e=a[c+1],t=a[c+2],z=a[p],G=a[p+1],P=a[p+2],A=h*G-z*e,y=y+A,q=q+(h+z)*A,l=l+(e+G)*A;m&&(A=h*P-z*t,k+=(t+P)*A,F+=A);h<b[0]&&(b[0]=h);h>b[1]&&(b[1]=h);
e<b[2]&&(b[2]=e);e>b[3]&&(b[3]=e);m&&(t<b[4]&&(b[4]=t),t>b[5]&&(b[5]=t))}0<y&&(y*=-1);0<F&&(F*=-1);if(!y)return null;b=[q,l,.5*y];m&&(b[3]=k,b[4]=.5*F);return b}function n(b,a,k,f,m){m=f?m?4:3:m?3:2;for(var c=a,n=a+m,p=0,v=0,l=0,y=0,F=0,D=k-1;F<D;F++,c+=m,n+=m){var h=b[c],e=b[c+1],t=b[c+2],z=b[n],G=b[n+1],P=b[n+2],A;if(f){A=z-h;var U=G-e,S=P-t;A=Math.sqrt(A*A+U*U+S*S)}else A=z-h,U=G-e,A=Math.sqrt(A*A+U*U);A&&(p+=A,f?(h=[h+.5*(z-h),e+.5*(G-e),t+.5*(P-t)],v+=A*h[0],l+=A*h[1],y+=A*h[2]):(h=[h+.5*(z-
h),e+.5*(G-e)],v+=A*h[0],l+=A*h[1]))}return 0<p?f?[v/p,l/p,y/p]:[v/p,l/p]:0<k?f?[b[a],b[a+1],b[a+2]]:[b[a],b[a+1]]:null}Object.defineProperty(b,"__esModule",{value:!0});b.getCentroidOptimizedGeometry=function(b,a,k,f){if(!a||!a.lengths.length)return null;b.lengths.length&&(b.lengths.length=0);b.coords.length&&(b.coords.length=0);for(var c=b.coords,q=[],x=k?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:
[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],r=a.lengths,v=a.coords,l=k?f?4:3:f?3:2,y=0,F=0;F<r.length;F++){var D=r[F],h=p(x,v,y,D,k,f);h&&q.push(h);y+=D*l}q.sort(function(a,b){var c=a[2]-b[2];0===c&&k&&(c=a[4]-b[4]);return c});q.length&&(l=6*q[0][2],c[0]=q[0][0]/l,c[1]=q[0][1]/l,k&&(l=6*q[0][4],c[2]=0!==l?q[0][3]/l:0),c[0]<x[0]||c[0]>x[1]||c[1]<x[2]||c[1]>x[3]||k&&(c[2]<x[4]||c[2]>x[5]))&&(c.length=0);if(!c.length)if(a=a.lengths[0]?n(v,0,r[0],
k,f):null)c[0]=a[0],c[1]=a[1],k&&2<a.length&&(c[2]=a[2]);else return null;return b};b.lineCentroid=n})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports tslib ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./utils @dojo/framework/shim/Promise".split(" "),
function(y,b,p,n,c,a,k,f,m,q,x,r,v,l){function E(){return new Promise(function(a,b){y(["../../../geometry/geometryEngineJSON"],a,b)})}Object.defineProperty(b,"__esModule",{value:!0});var F={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",
esriSpatialRelRelation:null},D={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},h={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},e={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,
esriGeometryPolygon:!0,esriGeometryEnvelope:!1};b.importGeometryEngine=E;b.getGeodesicBufferOperator=function(){return E().then(function(a){return a.geodesicBuffer})};b.getSpatialQueryOperator=function(b,e,h,m,n){if(f.isPolygon(e)&&"esriGeometryPoint"===h&&("esriSpatialRelIntersects"===b||"esriSpatialRelContains"===b)){var p=x.convertFromPolygon(new r.default,e,!1,!1);return c.resolve(function(a){return q.polygonContainsPoint(p,!1,!1,a)})}if(f.isPolygon(e)&&"esriGeometryMultipoint"===h){var t=x.convertFromPolygon(new r.default,
e,!1,!1);if("esriSpatialRelContains"===b)return c.resolve(function(a){return q.polygonContainsMultipoint(t,!1,!1,a,m,n)})}if(f.isExtent(e)&&"esriGeometryPoint"===h&&("esriSpatialRelIntersects"===b||"esriSpatialRelContains"===b))return c.resolve(function(b){return a.extentContainsPoint(e,l.getGeometry(h,m,n,b))});if(f.isExtent(e)&&"esriGeometryMultipoint"===h&&"esriSpatialRelContains"===b)return c.resolve(function(b){return a.extentContainsMultipoint(e,l.getGeometry(h,m,n,b))});if(f.isExtent(e)&&"esriSpatialRelIntersects"===
b){var v=k.getExtentIntersector(h);return c.resolve(function(a){return v(e,l.getGeometry(h,m,n,a))})}return E().then(function(a){var c=a[F[b]].bind(null,e.spatialReference,e);return function(a){return c(l.getGeometry(h,m,n,a))}})};b.checkSpatialQuerySupport=function(a,b,c){return p.__awaiter(this,void 0,void 0,function(){var k,l;return p.__generator(this,function(p){k=a.spatialRel;l=a.geometry;if(!l)return[2];if(!0!==D[k])throw new n("feature-store:unsupported-query","Unsupported query spatial relationship",
{query:a});if(!m.isValid(l.spatialReference)||!m.isValid(c))return[2];if(!0!==h[f.getJsonType(l)])throw new n("feature-store:unsupported-query","Unsupported query geometry type",{query:a});if(!0!==e[b])throw new n("feature-store:unsupported-query","Unsupported layer geometry type",{query:a});return a.outSR?[2,v.checkProjectionSupport(a.geometry&&a.geometry.spatialReference,a.outSR)]:[2]})})};b.canQueryWithRBush=function(a){if(f.isExtent(a))return!0;if(f.isPolygon(a)){var b=0;for(a=a.rings;b<a.length;b++){var c=
a[b];if(5!==c.length||c[0][0]!==c[1][0]||c[0][0]!==c[4][0]||c[2][0]!==c[3][0]||c[0][1]!==c[3][1]||c[0][1]!==c[4][1]||c[1][1]!==c[2][1])return!1}return!0}return!1}})},"esri/layers/graphics/contains":function(){define(["require","exports"],function(y,b){function p(b,c,a,k,f){if(!b)return!1;c=c?a?4:3:a?3:2;a=b.coords;var m=!1,n=0,p=0;for(b=b.lengths;p<b.length;p++){for(var r=b[p],v=n,l=n,y=n+r*c;l<y;l+=c){v=l+c;v===y&&(v=n);var F=a[l],D=a[l+1],h=a[v],v=a[v+1];(D<f&&v>=f||v<f&&D>=f)&&F+(f-D)/(v-D)*(h-
F)<k&&(m=!m)}n+=r*c}return m}Object.defineProperty(b,"__esModule",{value:!0});b.polygonContainsPoint=function(b,c,a,k){return p(b,c,a,k.coords[0],k.coords[1])};b.polygonContainsMultipoint=function(b,c,a,k,f,m){f=f?m?4:3:m?3:2;m=k.coords;k=k.lengths;if(!k)return!1;for(var n=0,x=0;n<k.length;n++,x+=f)if(!p(b,c,a,m[x],m[x+1]))return!1;return!0};b.polygonContainsCoords=p})},"esri/layers/support/PromiseQueue":function(){define(["require","exports","../../core/promiseUtils"],function(y,b,p){Object.defineProperty(b,
"__esModule",{value:!0});y=function(){function b(){this._tasks=[]}Object.defineProperty(b.prototype,"length",{get:function(){return this._tasks.length},enumerable:!0,configurable:!0});b.prototype.push=function(a){var b=this;return p.create(function(c,k){return b._tasks.push(new n(c,k,a))})};b.prototype.unshift=function(a){var b=this;return p.create(function(c,k){return b._tasks.unshift(new n(c,k,a))})};b.prototype.process=function(){if(0===this._tasks.length)return!1;var a=this._tasks.shift();try{var b=
a.callback();b&&"then"in b&&"function"===typeof b.then?b.then(a.resolve,a.reject):a.resolve(b)}catch(f){a.reject(f)}return!0};b.prototype.cancelAll=function(){for(var a=p.createAbortError(),b=0,c=this._tasks;b<c.length;b++)c[b].reject(a);this._tasks.length=0};return b}();b.default=y;var n=function(){return function(b,a,k){this.resolve=b;this.reject=a;this.callback=k}}()})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["require","exports","../centroid","../OptimizedFeature",
"../OptimizedGeometry"],function(y,b,p,n,c){Object.defineProperty(b,"__esModule",{value:!0});b.optimizedFeatureQueryEngineAdapter={getObjectId:function(a){return a.objectId},getAttributes:function(a){return a.attributes},getAttribute:function(a,b){return a.attributes[b]},cloneWithGeometry:function(a,b){return new n.default(b,a.attributes,null,a.objectId)},getGeometry:function(a){return a.geometry},getCentroid:function(a,b){a.centroid||(a.centroid=p.getCentroidOptimizedGeometry(new c.default,a.geometry,
b.hasZ,b.hasM));return a.centroid}};b.default=b.optimizedFeatureQueryEngineAdapter})},"esri/layers/graphics/sources/csv/csv":function(){define(["require","exports","tslib"],function(y,b,p){function n(a,b,c){var f,k,l;return p.__generator(this,function(m){switch(m.label){case 0:f=0,m.label=1;case 1:if(!(f<=a.length))return[3,4];k=a.indexOf(b,f);l=a.substring(f,-1<k?k:void 0);f+=l.length+1;return c&&!l.trim()?[3,3]:[4,l];case 2:m.sent(),m.label=3;case 3:return[3,1];case 4:return[2]}})}function c(a,
b){return n(a,b,!1)}Object.defineProperty(b,"__esModule",{value:!0});var a=/^\s*"([\S\s]*)"\s*$/,k=/""/g,f=[","," ",";","|","\t"];b.readRows=function(a){return n(a,"\n",!0)};b.readRowParts=c;b.inferDelimiter=function(a){a=a.trim();for(var b=0,c="",k=0;k<f.length;k++){var m=f[k],l=a.split(m).length;l>b&&(b=l,c=m)}return""===c?null:c};b.parseRows=function(b,f,n){var m,q,l,y,x,D,h,e,t,z,G,P;return p.__generator(this,function(p){switch(p.label){case 0:q=m="",l=0,y=[],p.label=1;case 1:x=b.next();D=x.value;
if(h=x.done)return[2];e=c(D,n);a:for(;;){t=e.next();z=t.value;if(G=t.done)break a;m+=q+z;q="";p=l;for(var r=z,v=0,A=void 0,A=r.indexOf('"',0);0<=A;)v++,A=r.indexOf('"',A+1);l=p+v;if(0===l%2){if(0<l)if(P=a.exec(m))y.push(P[1].replace(k,'"'));else return y=[],m="",l=0,[3,1];else y.push(m);m="";l=0}else q=n}if(0!==l)return[3,3];p=y;r={};v=f.length;for(A=0;A<v;A++)r[f[A]]=p[A];return[4,r];case 2:return p.sent(),y=[],[3,4];case 3:q="\n",p.label=4;case 4:return[3,1];case 5:return[2]}})}})},"esri/layers/graphics/sources/support/clientSideDefaults":function(){define("require exports tslib ../../../../core/has ../../../../core/lang ../../../../symbols/support/defaultsJSON".split(" "),
function(y,b,p,n,c,a){Object.defineProperty(b,"__esModule",{value:!0});b.createDrawingInfo=function(b){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===b||"esriGeometryMultipoint"===b?a.defaultPointSymbolJSON:"esriGeometryPolyline"===b?a.defaultPolylineSymbolJSON:a.defaultPolygonSymbolJSON}}};b.createDefaultAttributesFunction=function(a,b){if(n("csp-restrictions"))return function(){var c;return p.__assign((c={},c[b]=null,c),a)};try{var c="this."+b+" \x3d null;",f;for(f in a)c+="this."+
f+" \x3d "+JSON.stringify(a[f])+";";var k=new Function(c);return function(){return new k}}catch(r){return function(){var c;return p.__assign((c={},c[b]=null,c),a)}}};b.createDefaultTemplate=function(a){void 0===a&&(a={});return[{name:"New Feature",description:"",prototype:{attributes:c.clone(a)}}]}})},"*noref":1}});
define("require exports tslib ../../../../geometry ../../../../request ../../../../core/Error ../../../../core/has ../../../../core/lang ../../../../core/number ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../geometry/projection ../../../../geometry/geometryAdapters/json ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/support/webMercatorUtils ../../OptimizedFeature ../../OptimizedGeometry ../../data/FeatureStore ../../data/projectionSupport ../../data/QueryEngine ../csv/csv ./clientSideDefaults ../../../support/FieldsIndex".split(" "),function(y,
b,p,n,c,a,k,f,m,q,x,r,v,l,E,F,D,h,e,t,z,G,P){Object.defineProperty(b,"__esModule",{value:!0});var A=G.createDrawingInfo("esriGeometryPoint"),U=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong"];b.csvLatitudeFieldNames="lat latitude y ycenter latitude83 latdecdeg point-y".split(" ");b.csvLongitudeFieldNames="lon lng long longitude x xcenter longitude83 longdecdeg point-x".split(" ");var S=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,
da=[0,0],ta=function(){return function(a,b){this.x=a;this.y=b}}(),L=function(){var a=m._parseInfo(),b=new RegExp("^"+a.regexp+"$"),c=new RegExp("["+a.group+"\\s\\xa0]","g"),f=a.factor;return function(e){e=b.exec(e);a.factor=f;if(!e)return NaN;var h=e[1];if(!e[1]){if(!e[2])return NaN;h=e[2];a.factor*=-1}h=h.replace(c,"").replace(a.decimal,".");return+h*a.factor}}(),B=function(){return"isInteger"in Number?Number.isInteger:function(a){return"number"===typeof a&&isFinite(a)&&Math.floor(a)===a}}();y=function(){function m(){this._queryEngine=
this._fieldsIndex=null}m.prototype.destroy=function(){this._queryEngine&&this._queryEngine&&this._queryEngine.destroy();this._fieldsIndex=this._queryEngine=null};m.prototype.load=function(a,b){void 0===b&&(b={});return p.__awaiter(this,void 0,void 0,function(){var c,e,f,h,k;return p.__generator(this,function(l){switch(l.label){case 0:return[4,q.all([this._fetch(a.url,b),this._checkProjection(b&&a.parsing&&a.parsing.spatialReference)])];case 1:return c=l.sent()[0],e=this._parse(c,a.parsing),this._queryEngine=
this._createQueryEngine(c,e),e.layerDefinition.extent=this._queryEngine.fullExtent,e.layerDefinition.timeInfo&&(f=this._queryEngine.timeExtent,h=f.start,k=f.end,e.layerDefinition.timeInfo.timeExtent=[h,k]),[2,e]}})})};m.prototype.applyEdits=function(){return p.__awaiter(this,void 0,void 0,function(){return p.__generator(this,function(b){throw new a("csv-source:editing-not-supported","applyEdits() is not supported on CSVLayer");})})};m.prototype.queryFeatures=function(a,b){void 0===a&&(a={});void 0===
b&&(b={});return p.__awaiter(this,void 0,void 0,function(){return p.__generator(this,function(c){return[2,this._queryEngine.executeQuery(a,b.signal)]})})};m.prototype.queryFeatureCount=function(a,b){void 0===a&&(a={});void 0===b&&(b={});return p.__awaiter(this,void 0,void 0,function(){return p.__generator(this,function(c){return[2,this._queryEngine.executeQueryForCount(a,b.signal)]})})};m.prototype.queryObjectIds=function(a,b){void 0===a&&(a={});void 0===b&&(b={});return p.__awaiter(this,void 0,void 0,
function(){return p.__generator(this,function(c){return[2,this._queryEngine.executeQueryForIds(a,b.signal)]})})};m.prototype.queryExtent=function(a,b){void 0===a&&(a={});void 0===b&&(b={});return p.__awaiter(this,void 0,void 0,function(){return p.__generator(this,function(c){return[2,this._queryEngine.executeQueryForExtent(a,b.signal)]})})};m.prototype._fetch=function(b,e){return p.__awaiter(this,void 0,void 0,function(){var f,h;return p.__generator(this,function(k){switch(k.label){case 0:if(!b)throw new a("csv-source:invalid-source",
"url not defined");f=x.urlToObject(b);return[4,c(f.path,{query:f.query,responseType:"text",signal:e.signal})];case 1:return h=k.sent(),[2,h.data]}})})};m.prototype._parse=function(b,c){void 0===c&&(c={});var e={columnDelimiter:c.columnDelimiter,layerDefinition:null,locationInfo:{latitudeFieldName:c.latitudeField,longitudeFieldName:c.longitudeField}},h=z.readRows(b),k=h.next().value;if(!k)throw new a("csv","CSV is empty",{csv:b});k=k.trim();if(!c.columnDelimiter){b=z.inferDelimiter(k);if(!b)throw new a("csv-source:invalid-delimiter",
"Unable to detect the delimiter from CSV");e.columnDelimiter=b}var k=k.split(e.columnDelimiter),l=e.layerDefinition={name:"csv",drawingInfo:A,geometryType:"esriGeometryPoint",objectIdField:null,fields:[],timeInfo:c.timeInfo,extent:{xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:c.spatialReference||{wkid:102100}}};if(!c.latitudeField||!c.longitudeField){b=this._inferLocationInfo(k);if(!c.longitudeField&&!b.longitudeFieldName||
!c.latitudeField&&!b.latitudeFieldName)throw new a("csv","Unable to identify latitudeField and/or longitudeField from CSV");e.locationInfo={longitudeFieldName:c.longitudeField||b.longitudeFieldName,latitudeFieldName:c.latitudeField||b.latitudeFieldName}}h=this._inferFields(h,e.columnDelimiter,k,e.locationInfo);if(c.fields&&c.fields.length){k=new Map;b=0;for(var m=c.fields;b<m.length;b++)c=m[b],k.set(c.name.toLowerCase(),c);for(b=0;b<h.length;b++)if(c=h[b],m=k.get(c.name.toLowerCase())){var n=c.name;
f.mixin(c,m);c.name=n}}l.fields=h;l.fields.some(function(a){return"esriFieldTypeOID"===a.type?(l.objectIdField=a.name,!0):!1})||(c={name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,nullable:!1},l.objectIdField=c.name,l.fields.unshift(c));this._fieldsIndex=new P(l.fields);l.timeInfo&&(c=l.timeInfo,c.startTimeField&&((h=this._fieldsIndex.get(c.startTimeField))?(c.startTimeField=h.name,h.type="esriFieldTypeDate"):c.startTimeField=null),c.endTimeField&&((h=this._fieldsIndex.get(c.endTimeField))?
(c.endTimeField=h.name,h.type="esriFieldTypeDate"):c.endTimeField=null),c.trackIdField&&(h=this._fieldsIndex.get(c.trackIdField),c.trackIdField=h?h.name:null),c.startTimeField||c.endTimeField||(l.timeInfo=null));return e};m.prototype._inferLocationInfo=function(a){var c=null,e=null;a.forEach(function(a){var f=a.toLowerCase(),h;h=b.csvLatitudeFieldNames.indexOf(f);-1===h||e||(e=a);h=b.csvLongitudeFieldNames.indexOf(f);-1===h||c||(c=a)});return{longitudeFieldName:c,latitudeFieldName:e}};m.prototype._inferFields=
function(a,b,c,e){var f=[];a=z.parseRows(a,c,b);var h=[];a:for(;10>h.length;){b=a.next();if(b.done)break a;h.push(b.value)}a=function(a){if(a===e.longitudeFieldName||a===e.latitudeFieldName)f.push({name:a,type:"esriFieldTypeDouble",alias:a});else{var b=h.map(function(b){return b[a]}),b=k._inferFieldType(b),c={name:a,type:null,alias:a};switch(b){case "integer":c.type="esriFieldTypeInteger";break;case "double":c.type="esriFieldTypeDouble";break;case "date":c.type="esriFieldTypeDate";c.length=36;break;
default:c.type="esriFieldTypeString",c.length=255}f.push(c)}};var k=this;for(b=0;b<c.length;b++)a(c[b]);return f};m.prototype._inferFieldType=function(a){var b=this;if(!a.length)return"string";var c=/[^+-.,0-9]/;return a.map(function(a){var e=!1;if(""!==a){if(c.test(a))e=!0;else{e=L(a);if(!isNaN(e))return/[.,]/.test(a)||!B(e)||214783647<e||-214783648>e?"double":"integer";if(-1===a.indexOf("E"))e=!0;else if(e=Number(a),isNaN(e))if(-1===a.indexOf(","))e=!0;else if(a=a.replace(",","."),e=Number(a),isNaN(e))e=
!0;else return"double";else return"double"}return e&&!/^[-]?\d*[.,]?\d*$/.test(a)&&b._isValidDate(new Date(a),a)?"date":"string"}}).reduce(function(a,b){if(void 0===a||a===b)return b;if("string"===a||"string"===b)return"string";if("double"===a||"double"===b)return"double"})};m.prototype._isValidDate=function(a,b){if(!a||"[object Date]"!==Object.prototype.toString.call(a)||isNaN(a.getTime()))return!1;a=!0;if(k("chrome")&&/\d+\W*$/.test(b)&&(b=b.match(/[a-zA-Z]{2,}/))){a=!1;for(var c=0;!a&&c<=b.length;)a=
!S.test(b[c]),c++;a=!a}return a};m.prototype._createQueryEngine=function(a,b){var c,e=b.locationInfo;c=e.latitudeFieldName;for(var f=e.longitudeFieldName,k=b.layerDefinition,e=k.objectIdField,m=k.fields,p=k.extent,q=k.timeInfo,k=[],y=[],x=new Set,A=new Set,C=[],B=0;B<m.length;B++){var G=m[B],I=G.name,G=G.type;"esriFieldTypeDate"===G?x.add(I):-1<U.indexOf(G)&&A.add(I);I!==e&&C.push(I)}m=0;a=z.readRows(a);a.next();a=z.parseRows(a,C,b.columnDelimiter);a:for(;;){B=a.next();C=B.value;if(B.done)break a;
B=this._parseCoordinateValue(C[c]);I=this._parseCoordinateValue(C[f]);if(null!=I&&null!=B&&!isNaN(B)&&!isNaN(I)){C[c]=B;C[f]=I;for(var J in C)J!==c&&J!==f&&(x.has(J)?(G=new Date(C[J]),C[J]=this._isValidDate(G,C[J])?G.getTime():null):A.has(J)&&(G=L(C[J]),isNaN(G)?C[J]=null:C[J]=G));C[e]=m;m++;k.push(new ta(I,B));y.push(C)}}if(!l.equals({wkid:4326},p.spatialReference))if(l.isWebMercator(p.spatialReference))for(J=0,f=k;J<f.length;J++)x=f[J],c=E.lngLatToXY(x.x,x.y,da),x.x=c[0],x.y=c[1];else k=r.projectMany(v.jsonAdapter,
k,n.SpatialReference.WGS84,p.spatialReference,null);c=new h.default({geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1});b=new t.default({fields:b.layerDefinition.fields,geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1,timeInfo:q,objectIdField:e,spatialReference:p.spatialReference||{wkid:4326},cacheSpatialQueries:!0,featureStore:c});p=[];for(q=0;q<k.length;q++)f=k[q],J=f.x,f=f.y,x=y[q],x[e]=q+1,p.push(new F.default(new D.default([],[J,f]),x,null,x[e]));c.addMany(p);return b};m.prototype._parseCoordinateValue=
function(a){if(null==a||""===a)return null;var b=L(a);if(isNaN(b)||181<Math.abs(b))b=parseFloat(a);return b};m.prototype._checkProjection=function(b){return p.__awaiter(this,void 0,void 0,function(){return p.__generator(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,e.checkProjectionSupport(l.WGS84,b)];case 1:return c.sent(),[3,3];case 2:throw c.sent(),new a("csv-layer","Projection not supported");case 3:return[2]}})})};return m}();b.default=y});