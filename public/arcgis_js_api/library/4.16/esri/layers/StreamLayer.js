// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../geometry ../PopupTemplate ../renderers ../request ../symbols ../core/deprecate ../core/Error ../core/global ../core/jsonMap ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ./Layer ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/TemporalLayer ./support/commonProperties ./support/featureReductionUtils ./support/Field ./support/FieldsIndex ./support/fieldUtils ./support/fieldUtils ./support/LabelClass ./support/labelingInfo ./support/PurgeOptions ../renderers/support/jsonUtils ../renderers/support/styleUtils ../support/popupUtils ../symbols/support/ElevationInfo ../symbols/support/jsonUtils ../tasks/support/Query".split(" "),
function(Y,Z,b,k,y,f,z,l,r,A,B,C,D,E,F,t,d,G,H,I,J,K,L,M,N,g,m,O,P,Q,u,R,S,v,n,T,U,V,w,W){var p=D.getLogger("esri.layers.StreamLayer"),X=new C.default({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"});return function(x){function a(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];c=x.apply(this,c)||this;c.copyright=null;c.definitionExpression=null;c.displayField=null;c.elevationInfo=null;c.featureReduction=null;
c.fields=null;c.geometryDefinition=null;c.geometryType=null;c.labelsVisible=!0;c.labelingInfo=null;c.legendEnabled=!0;c.objectIdField=null;c.operationalLayerType="ArcGISStreamLayer";c.popupEnabled=!0;c.popupTemplate=null;c.purgeOptions=new v;c.screenSizePerspectiveEnabled=!0;c.sourceJSON=null;c.spatialReference=k.SpatialReference.WGS84;c.type="stream";c.url=null;return c}b.__extends(a,x);a.prototype.normalizeCtorArgs=function(c,a){return"string"===typeof c?b.__assign({url:c},a):c};a.prototype.load=
function(c){var a=this;"WebSocket"in B||t.reject(new A("stream-layer:websocket-unsupported","WebSocket is not supported in this browser. StreamLayer will not have real-time connection with the stream service."));var b=E.isSome(c)?c.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Stream Service"]},c).catch(function(c){return c}).then(function(){return a._fetchService(b)}));return t.resolve(this)};Object.defineProperty(a.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},
enumerable:!0,configurable:!0});a.prototype.readFeatureReduction=function(c,a){return m.read(c,a)};a.prototype.writeWebSceneFeatureReduction=function(c,a,b,d){m.writeTarget(c,a,"layerDefinition.featureReduction",d)};Object.defineProperty(a.prototype,"fieldsIndex",{get:function(){return new P(this.fields)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maximumTrackPoints",{get:function(){r.deprecatedProperty(p,"maximumTrackPoints",{replacement:"purgeOptions.maxObservations",version:"4.15"});
return this.purgeOptions.maxObservations},set:function(c){r.deprecatedProperty(p,"maximumTrackPoints",{replacement:"purgeOptions.maxObservations",version:"4.15"});var a=this.purgeOptions.clone();a.maxObservations=c;this.purgeOptions=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderer",{set:function(a){Q.fixRendererFields(a,this.fields);this._set("renderer",a)},enumerable:!0,configurable:!0});a.prototype.readRenderer=function(a,b,d){b=b.layerDefinition||b;var c=b.drawingInfo&&
b.drawingInfo.renderer||void 0,h,e;if(c)(h=n.read(c,b,d)||void 0)||p.error("Failed to create renderer",{rendererDefinition:b.drawingInfo.renderer,layer:this,context:d});else if(b.defaultSymbol)w.read(b.defaultSymbol,b,d),b.types&&b.types.length?(h=new f.UniqueValueRenderer({defaultSymbol:e,field:b.typeIdField}),b.types.forEach(function(a){c.addUniqueValueInfo(a.id,w.read(a.symbol,a,d))})):h=new f.SimpleRenderer({symbol:e});else if("Table"!==b.type){switch(b.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":e=
new l.SimpleMarkerSymbol;break;case "esriGeometryPolyline":e=new l.SimpleLineSymbol;break;case "esriGeometryPolygon":e=new l.SimpleFillSymbol}h=e&&new f.SimpleRenderer({symbol:e})}return h};a.prototype.writeRenderer=function(a,b,d,q){n.writeTarget(a,b,d,q)};a.prototype.writeWebSceneRenderer=function(a,b,d,q){n.writeTarget(a,b,"layerDefinition.drawingInfo.renderer",q)};a.prototype.createPopupTemplate=function(a){return U.createPopupTemplate(this,a)};a.prototype.createQuery=function(){var a=new W;a.returnGeometry=
!0;a.outFields=["*"];a.where=this.definitionExpression||"1\x3d1";return a};a.prototype.getFieldDomain=function(a,b){if(!this.fields)return null;var c=null;this.fields.some(function(b){b.name===a&&(c=b.domain);return!!c});return c};a.prototype.getField=function(a){return this.fieldsIndex.get(a)};a.prototype._fetchService=function(a){return b.__awaiter(this,void 0,void 0,function(){var c;return b.__generator(this,function(d){switch(d.label){case 0:return this.sourceJSON?[3,2]:[4,z(this.parsedUrl.path,
{query:b.__assign({f:"json"},this.parsedUrl.query),responseType:"json",signal:a})];case 1:c=d.sent().data,this.sourceJSON=b.__assign(b.__assign({},c),{objectIdField:"__esri_stream_id__"}),d.label=2;case 2:return this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl}),u.fixRendererFields(this.renderer,this.fields),u.fixTimeInfoFields(this.timeInfo,this.fields),[2,T.loadStyleRenderer(this,{origin:"service"})]}})})};b.__decorate([d.property({type:String})],a.prototype,"copyright",void 0);b.__decorate([d.property({readOnly:!0,
dependsOn:["fields","title"]})],a.prototype,"defaultPopupTemplate",null);b.__decorate([d.property({type:String})],a.prototype,"definitionExpression",void 0);b.__decorate([d.property({type:String})],a.prototype,"displayField",void 0);b.__decorate([d.property({type:V})],a.prototype,"elevationInfo",void 0);b.__decorate([d.reader("featureReduction",["layerDefinition.featureReduction"])],a.prototype,"readFeatureReduction",null);b.__decorate([d.writer("web-scene","featureReduction",{"layerDefinition.featureReduction":{types:m.webSceneFeatureReductionTypes}})],
a.prototype,"writeWebSceneFeatureReduction",null);b.__decorate([d.property({type:[O]})],a.prototype,"fields",void 0);b.__decorate([d.property({readOnly:!0,dependsOn:["fields"]})],a.prototype,"fieldsIndex",null);b.__decorate([d.property({type:k.Extent})],a.prototype,"geometryDefinition",void 0);b.__decorate([d.property({type:["point","polygon","polyline","multipoint"],json:{read:{reader:X.read}}})],a.prototype,"geometryType",void 0);b.__decorate([d.property(g.labelsVisible)],a.prototype,"labelsVisible",
void 0);b.__decorate([d.property({type:[R],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:S.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],a.prototype,"labelingInfo",void 0);b.__decorate([d.property(g.legendEnabled)],a.prototype,"legendEnabled",void 0);b.__decorate([d.property({type:["show","hide"]})],a.prototype,"listMode",void 0);b.__decorate([d.property({type:G.Integer})],a.prototype,"maximumTrackPoints",null);b.__decorate([d.property({type:String})],
a.prototype,"objectIdField",void 0);b.__decorate([d.property({value:"ArcGISStreamLayer",type:["ArcGISStreamLayer"]})],a.prototype,"operationalLayerType",void 0);b.__decorate([d.property(g.popupEnabled)],a.prototype,"popupEnabled",void 0);b.__decorate([d.property({type:y,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],a.prototype,"popupTemplate",void 0);b.__decorate([d.property({type:v})],a.prototype,"purgeOptions",void 0);b.__decorate([d.property({types:f.rendererTypes,json:{origins:{service:{write:{target:"drawingInfo.renderer",
enabled:!1}}},write:{target:"layerDefinition.drawingInfo.renderer"}}})],a.prototype,"renderer",null);b.__decorate([d.reader("service","renderer",["drawingInfo.renderer","defaultSymbol","type"]),d.reader("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol","layerDefinition.type"])],a.prototype,"readRenderer",null);b.__decorate([d.writer("renderer")],a.prototype,"writeRenderer",null);b.__decorate([d.writer("web-scene","renderer",{"layerDefinition.drawingInfo.renderer":{types:f.webSceneRendererTypes}})],
a.prototype,"writeWebSceneRenderer",null);b.__decorate([d.property(g.screenSizePerspectiveEnabled)],a.prototype,"screenSizePerspectiveEnabled",void 0);b.__decorate([d.property({type:k.SpatialReference,json:{origins:{service:{read:{source:"spatialReference"}}}}})],a.prototype,"spatialReference",void 0);b.__decorate([d.property({json:{read:!1}})],a.prototype,"type",void 0);b.__decorate([d.property(g.url)],a.prototype,"url",void 0);return a=b.__decorate([d.subclass("esri.layers.StreamLayer")],a)}(N.TemporalLayer(M.ScaleRangeLayer(L.RefreshableLayer(I.ArcGISService(J.OperationalLayer(K.PortalLayer(F.MultiOriginJSONMixin(H))))))))});