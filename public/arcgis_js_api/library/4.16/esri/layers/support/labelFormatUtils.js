// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../core/Error ../../core/Logger ../../intl/date ../../intl/number ./FieldsIndex ./fieldUtils ./labelUtils ../../support/arcadeOnDemand @dojo/framework/shim/Promise".split(" "),function(t,f,p,u,v,g,w,x,h,y,z){function q(a,b,c,e){a=h.getField(e,a);if(!a)return b;if(null==c[a.name])return"";if(b=a.domain)if("codedValue"===b.type||"coded-value"===b.type){e=c[a.name];var d=0;for(b=b.codedValues;d<b.length;d++){var k=b[d];if(k.code===e)return k.name}}else if("range"===b.type&&
(e=+c[a.name],d="range"in b?b.range[1]:b.maxValue,("range"in b?b.range[0]:b.minValue)<=e&&e<=d))return b.name;c=c[a.name];"date"===a.type||"esriFieldTypeDate"===a.type?c=g.formatDate(c,g.convertDateFormatToIntlOptions("short-date")):h.isNumericField(a)&&(c=w.formatNumber(+c));return c?c:""}Object.defineProperty(f,"__esModule",{value:!0});var A=v.getLogger("esri.layers.support.labelFormatUtils"),r={type:"simple",evaluate:function(){return null}};f.createLabelFunction=function(a,b,c){return p.__awaiter(this,
void 0,void 0,function(){var e,d,k,f,l,n,g,h;return p.__generator(this,function(m){switch(m.label){case 0:if(!a||!a.symbol)return[2,r];e=a.where;d=a.getLabelExpression();return e?[4,new Promise(function(b,a){t(["../../core/sql/WhereClause"],b,a)})]:[3,2];case 1:return f=m.sent(),[3,3];case 2:f=null,m.label=3;case 3:return k=f,"arcade"!==d.type?[3,5]:[4,z.createLabelExpression(d.expression,c,b)];case 4:return n=m.sent(),l={type:"arcade",evaluate:function(b){try{var a=n.evaluate({$feature:n.repurposeFeature(b)});
if(null!=a)return a.toString()}catch(C){A.error(u("bad-arcade-expression","Encountered an error when evaluating label expression for feature",{feature:b,expression:d}))}return null},needsHydrationToEvaluate:function(){return null==y.getSingleFieldArcadeExpression(d.expression)}},[3,6];case 5:l={type:"simple",evaluate:function(a){var c=a&&a.attributes;return c?d.expression.replace(/{[^}]*}/g,function(a){return q(a.slice(1,-1),a,c,b)}):null}},m.label=6;case 6:if(e){try{g=k.WhereClause.create(e,new x(b))}catch(B){return[2,
r]}h=l.evaluate;l.evaluate=function(a){return g.testFeature(a)?h(a):null}}return[2,l]}})})};f.formatField=q});