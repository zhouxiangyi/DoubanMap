// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports ../../core/Error ../../core/urlUtils ../../geometry/Extent ../../geometry/SpatialReference".split(" "),function(J,n,G,H,x,t){function u(a){return I.some(function(d){var b=d[1];return a>=d[0]&&a<=b})}function A(a){var d=[];a.forEach(function(a){d.push(a);a.sublayers&&a.sublayers.length&&(d=d.concat(A(a.sublayers)),delete a.sublayers)});return d}function l(a,d){return(a=d&&d.getElementsByTagName(a))&&0<a.length?a[0]:null}function m(a,d,b){return(a=l(a,d))?a.textContent:b}function p(a,
d,b){if(!a)return null;var c=parseFloat(a.getAttribute("minx")),e=parseFloat(a.getAttribute("miny")),h=parseFloat(a.getAttribute("maxx"));a=parseFloat(a.getAttribute("maxy"));b?(b=isNaN(e)?-Number.MAX_VALUE:e,c=isNaN(c)?-Number.MAX_VALUE:c,e=isNaN(a)?Number.MAX_VALUE:a,h=isNaN(h)?Number.MAX_VALUE:h):(b=isNaN(c)?-Number.MAX_VALUE:c,c=isNaN(e)?-Number.MAX_VALUE:e,e=isNaN(h)?Number.MAX_VALUE:h,h=isNaN(a)?Number.MAX_VALUE:a);d=new t({wkid:d});return new x({xmin:b,ymin:c,xmax:e,ymax:h,spatialReference:d})}
function B(a,d){a=l(d,a);if(a=l("DCPType",a))if(a=l("HTTP",a))if(a=l("Get",a)){var b;if(b=(a=l("OnlineResource",a))?a.getAttribute("xlink:href"):null){b.indexOf("\x26")===b.length-1&&(b=b.substring(0,b.length-1));a=["service","request"];d=[];b=H.urlToObject(b);for(var c in b.query)b.query.hasOwnProperty(c)&&-1===a.indexOf(c.toLowerCase())&&d.push(c+"\x3d"+b.query[c]);return b.path+(d.length?"?"+d.join("\x26"):"")}}return null}function C(a,d){var b=a.getElementsByTagName("Operation");if(!b||!b.length)return a=
l(d,a).getElementsByTagName("Format"),Array.prototype.slice.call(a).map(function(a){return a.textContent});var c=[];Array.prototype.slice.call(b).forEach(function(a){a.getAttribute("name")===d&&(a=a.getElementsByTagName("Format"),Array.prototype.slice.call(a).forEach(function(a){c.push(a.textContent)}))});return c}function v(a,d,b){a:{for(var c=0;c<a.childNodes.length;c++){var e=a.childNodes[c];if(e.nodeType===Node.ELEMENT_NODE&&e.nodeName===d){a=e;break a}}a=null}if(!a)return b;a=a.textContent;if(null==
a||""===a)return b;a=Number(a);return isNaN(a)?b:a}function y(a,d,b){if(!a)return null;var c={id:b.idCounter++,fullExtents:[],parentLayerId:null,queryable:"1"===a.getAttribute("queryable"),spatialReferences:[],sublayers:null},e=l("LatLonBoundingBox",a),h=l("EX_GeographicBoundingBox",a),g=null;e&&(g=p(e,4326));h&&(g=new x(0,0,0,0,new t({wkid:4326})),g.xmin=parseFloat(m("westBoundLongitude",h,0)),g.ymin=parseFloat(m("southBoundLatitude",h,0)),g.xmax=parseFloat(m("eastBoundLongitude",h,0)),g.ymax=parseFloat(m("northBoundLatitude",
h,0)));e||h||(g=new x(-180,-90,180,90,new t({wkid:4326})));c.minScale=v(a,"MaxScaleDenominator",0);c.maxScale=v(a,"MinScaleDenominator",0);var n=-1<["1.0.0","1.1.0","1.1.1"].indexOf(d)?"SRS":"CRS";Array.prototype.slice.call(a.childNodes).forEach(function(a){if("Name"===a.nodeName)c.name=a.textContent||"";else if("Title"===a.nodeName)c.title=a.textContent||"";else if("Abstract"===a.nodeName)c.description=a.textContent||"";else if("BoundingBox"===a.nodeName){var e=a.getAttribute(n);if(e&&0===e.indexOf("EPSG:")){var f=
parseInt(e.substring(5),10);0===f||isNaN(f)||g||(g="1.3.0"===d?p(a,f,u(f)):p(a,f))}(f=e&&e.indexOf(":"))&&-1<f&&(f=parseInt(e.substring(f+1,e.length),10),0===f||isNaN(f)||(f=q[f]?q[f]:f),a="1.3.0"===d?p(a,f,u(f)):p(a,f),c.fullExtents.push(a))}else if(a.nodeName===n)a.textContent.split(" ").forEach(function(a){a=-1<a.indexOf(":")?parseInt(a.split(":")[1],10):parseInt(a,10);0===a||isNaN(a)||(q[a]&&(a=q[a]),-1===c.spatialReferences.indexOf(a)&&c.spatialReferences.push(a))});else if("Style"!==a.nodeName||
c.legendURL)"Layer"===a.nodeName&&(a=y(a,d,b))&&(a.parentLayerId=c.id,c.sublayers||(c.sublayers=[]),c.sublayers.push(a));else if(a=l("LegendURL",a))if(a=l("OnlineResource",a))c.legendURL=a.getAttribute("xlink:href")});c.extent=g&&g.toJSON();return c}Object.defineProperty(n,"__esModule",{value:!0});var I=[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,
2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],q={84:4326,83:4269,27:4267};n.parseCapabilities=
function(a){if(!a)return null;var d={idCounter:-1};"string"===typeof a&&(a=(new DOMParser).parseFromString(a,"text/xml"));var b=a.documentElement;if("ServiceExceptionReport"===b.nodeName){var c=Array.prototype.slice.call(b.childNodes).map(function(a){return a.textContent}).join("\r\n");throw new G("wmslayer:wms-capabilities-xml-is-not-valid","The server returned errors when the WMS capabilities were requested.",c);}var e=l("Layer",b);if(!e)return null;var h="WMS_Capabilities"===b.nodeName||"WMT_MS_Capabilities"===
b.nodeName?b.getAttribute("version"):"1.3.0",g=l("Service",b);a=m("Title",g,"")||m("Name",g,"");var n=m("AccessConstraints",g,""),p=m("Abstract",g,""),q=parseInt(m("MaxWidth",g,5E3),10),g=parseInt(m("MaxHeight",g,5E3),10),f=l("Capability",b),t=C(b,"GetMap"),u=B(b,"GetMap"),k=y(e,h,d),z=0,v;Array.prototype.slice.call(f.childNodes).forEach(function(a){"Layer"===a.nodeName&&(0===z?v=a:(1===z&&k.name&&(k.name="",k.sublayers.push(y(v,h,d))),k.sublayers.push(y(a,h,d))),z++)});if(!k)return null;var r,w,
e=k.fullExtents;(f=k.sublayers)||(f=[]);0===f.length&&f.push(k);r=k.extent;r||(r=new x(f[0].extent),k.extent=r.toJSON(),r=k.extent);w=k.spatialReferences;if(!w.length&&0<f.length){var D=function(a){var b=[];a.sublayers.forEach(function(a){!b.length&&a.spatialReferences.length&&(b=a.spatialReferences||D(a))});return b};f.forEach(function(a){w.length||(w=a.spatialReferences||D(a))})}var E=B(b,"GetFeatureInfo");E&&(b=C(b,"GetFeatureInfo"),-1<b.indexOf("text/html")?c="text/html":-1<b.indexOf("text/plain")&&
(c="text/plain"));if(!c){var F=function(a){a&&(a.queryable=!1,a.sublayers&&a.sublayers.forEach(function(a){F(a)}))};F(k)}b=A(f);return{copyright:n,description:p,extent:r,fullExtents:e,featureInfoFormat:c,featureInfoUrl:E,mapUrl:u,maxImageWidth:q,maxImageHeight:g,maxScale:k.maxScale||0,minScale:k.minScale||0,layers:b,spatialReferences:w,supportedImageFormatTypes:t,title:a,version:h}};n.coordsReversed=u;n.getPopupLayers=function(a){return a.length?a.filter(function(a){return a.popupEnabled&&a.name&&
a.queryable}).map(function(a){return a.name}).join(","):""}});