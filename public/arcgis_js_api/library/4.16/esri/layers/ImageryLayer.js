// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/mixins/ArcGISImageService":function(){define("require exports tslib ../../geometry ../../Graphic ../../rasterRenderers ../../request ../../core/Error ../../core/jsonMap ../../core/lang ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../support/commonProperties ../support/DimensionalDefinition ../support/ExportImageServiceParameters ../support/Field ../support/FieldsIndex ../support/imageryRendererUtils ../support/MosaicRule ../support/PixelBlock ../support/RasterFunction ../support/RasterInfo ../support/RasterJobHandler ../support/rasterFormats/RasterCodec ../../renderers/support/RasterSymbolizer ../../tasks/ImageServiceIdentifyTask ../../tasks/QueryTask ../../tasks/support/FeatureSet ../../tasks/support/ImageServiceIdentifyParameters ../../tasks/support/Query".split(" "),
function(D,q,e,r,d,k,l,b,a,g,m,c,t,B,f,h,n,p,A,v,u,E,x,w,y,z,C,F,H,N,K,I,G,J){function L(c){if(!c)return null;c=JSON.stringify(c).match(/"rasterFunction":"(.*?")/gi);return(c=null===c||void 0===c?void 0:c.map(function(c){return c.replace('"rasterFunction":"',"").replace('"',"")}))?c.join("/"):null}Object.defineProperty(q,"__esModule",{value:!0});var R=m.getLogger("esri.layers.mixins.ArcGISImageService"),P=a.strict()({RSP_NearestNeighbor:"nearest",RSP_BilinearInterpolation:"bilinear",RSP_CubicConvolution:"cubic",
RSP_Majority:"majority"}),S=a.strict()({esriNoDataMatchAny:"any",esriNoDataMatchAll:"all"}),U=a.strict()({U1:"u1",U2:"u2",U4:"u4",U8:"u8",S8:"s8",U16:"u16",S16:"s16",U32:"u32",S32:"s32",F32:"f32",F64:"f64",C64:"c64",C128:"c128",UNKNOWN:"unknown"});q.ArcGISImageService=function(m){return function(m){function a(){var a=null!==m&&m.apply(this,arguments)||this;a._functionRasterInfos={};a._rasterJobHandler={instance:null,refCount:0,connectionPromise:null};a._symbolizer=null;a._defaultServiceMosaicRule=
null;a.rasterAttributeTableFieldPrefix="Raster.";a.adjustAspectRatio=null;a.bandCount=null;a.bandIds=void 0;a.capabilities=null;a.compressionQuality=void 0;a.compressionTolerance=.01;a.copyright=null;a.definitionExpression=null;a.exportImageServiceParameters=null;a.rasterInfo=null;a.fields=null;a.fullExtent=null;a.hasMultidimensions=!1;a.imageMaxHeight=4100;a.imageMaxWidth=4100;a.interpolation=void 0;a.multidimensionalInfo=null;a.noData=null;a.noDataInterpretation=void 0;a.objectIdField=null;a.pixelSizeX=
null;a.pixelSizeY=null;a.pixelFilter=null;a.raster=void 0;a.viewId=void 0;a.renderer=null;a.rasterAttributeTable=null;a.rasterFunctionInfos=null;a.serviceDataType=null;a.spatialReference=null;a.pixelType=null;a.serviceRasterInfo=null;a.sourceJSON=null;a.url=null;a.version=null;return a}e.__extends(a,m);a.prototype.initialize=function(){this._set("exportImageServiceParameters",new A.ExportImageServiceParameters({layer:this}))};a.prototype.readDefaultServiceMosaicRule=function(a,c){return x.fromJSON(c)};
Object.defineProperty(a.prototype,"rasterFunctionNamesIndex",{get:function(){var a=new Map;if(!this.rasterFunctionInfos||1>this.rasterFunctionInfos.length)return a;this.rasterFunctionInfos.forEach(function(c){a.set(c.name.toLowerCase().replace(/ /gi,"_"),c.name)});return a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"queryTask",{get:function(){return new K({url:this.url})},enumerable:!0,configurable:!0});a.prototype.readBandIds=function(a,c){if(Array.isArray(a)&&0<a.length&&
a.every(function(a){return"number"===typeof a}))return a};a.prototype.readCapabilities=function(a,c){return this._readCapabilities(c)};a.prototype.writeCompressionQuality=function(a,c,b){null!=a&&"lerc"!==this.format&&(c[b]=a)};a.prototype.writeCompressionTolerance=function(a,c,b){"lerc"===this.format&&null!=a&&(c[b]=a)};Object.defineProperty(a.prototype,"fieldsIndex",{get:function(){return this.fields?new u(this.fields):null},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"format",
{get:function(){return this._get("format")||(null!=this.pixelFilter?"lerc":"jpgpng")},set:function(a){a&&-1<"png png8 png24 png32 jpg bmp jpgpng lerc tiff".split(" ").indexOf(a.toLowerCase())&&this._set("format",a.toLowerCase())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"mosaicRule",{set:function(a){a&&a.mosaicMethod&&(a=x.fromJSON(e.__assign(e.__assign({},a.toJSON()),{mosaicMethod:a.mosaicMethod,mosaicOperation:a.mosaicOperation})));this._set("mosaicRule",a)},enumerable:!0,
configurable:!0});a.prototype.readMosaicRule=function(a,c){return x.fromJSON(a||c.mosaicRule||c)};a.prototype.writeMosaicRule=function(a,c,b){a=this.mosaicRule;var m=this.definitionExpression;a?m&&m!==a.where&&(a=a.clone(),a.where=m):m&&(a=new x({where:m}));this._isValidCustomizedMosaicRule(a)&&(c[b]=a.toJSON())};a.prototype.writeNoData=function(a,c,b){null!=a&&"number"===typeof a&&(c[b]=a)};a.prototype.readObjectIdField=function(a,c){a||(a=(a=c.fields.filter(function(a){return"esriFieldTypeOID"===
a.type||"oid"===a.type}))&&a[0]&&a[0].name);return a};Object.defineProperty(a.prototype,"parsedUrl",{get:function(){return this.url?B.urlToObject(this.url):null},enumerable:!0,configurable:!0});a.prototype.readRenderer=function(a,c,b){a=k.read(c&&c.layerDefinition&&c.layerDefinition.drawingInfo&&c.layerDefinition.drawingInfo.renderer,b)||void 0;if(null!=a)return E.isSupportedRendererType(a)||R.warn("ArcGISImageService","Imagery layer doesn't support given renderer type."),a};Object.defineProperty(a.prototype,
"rasterFields",{get:function(){var a=this.rasterAttributeTableFieldPrefix||"Raster.",c=new v({name:"Raster.ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:"string"}),b=new v({name:"Raster.ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:"string"}),m=new v({name:"Raster.ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"string"}),f=this.fields?g.clone(this.fields):[];f.push(b);this.capabilities.operations.supportsQuery&&
this.fields&&0<this.fields.length&&f.push(c);10.4<=this.version&&this.rasterFunctionInfos&&this.rasterFunctionInfos.some(function(a){return"none"===a.name.toLowerCase()})&&f.push(m);this.rasterFunctionInfos&&this.rasterFunctionInfos.filter(function(a){return"none"!==a.name.toLowerCase()}).forEach(function(a){f.push(new v({name:"Raster.ServicePixelValue."+a.name,alias:a.name,domain:null,editable:!1,length:50,type:"string"}))});null==this.pixelFilter||"esriImageServiceDataTypeVector-UV"!==this.serviceDataType&&
"esriImageServiceDataTypeVector-MagDir"!==this.serviceDataType||(f.push(new v({name:"Raster.Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"double"})),f.push(new v({name:"Raster.Direction",alias:"Direction",domain:null,editable:!1,type:"double"})));(c=this.rasterInfo.attributeTable&&this.rasterInfo.attributeTable.fields||null)&&0<c.length&&(c=c.filter(function(a){return"esriFieldTypeOID"!==a.type&&"value"!==a.name.toLowerCase()}).map(function(c){var b=g.clone(c);b.name=a+c.name;return b}),
f=f.concat(c));return f},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderingRule",{set:function(a){a&&a.rasterFunction&&(a=y.fromJSON(e.__assign(e.__assign({},a.toJSON()),{rasterFunction:a.rasterFunction,rasterFunctionArguments:a.rasterFunctionArguments})));this._set("renderingRule",a)},enumerable:!0,configurable:!0});a.prototype.readRenderingRule=function(a,c){a=c.rasterFunctionInfos;return c.renderingRule||a&&a.length&&"None"!==a[0].name?y.fromJSON(c.renderingRule||{rasterFunctionInfos:c.rasterFunctionInfos}):
null};a.prototype.writeRenderingRule=function(a,c,b){this._isRFTJson(a)||(c[b]=a.toJSON())};a.prototype.readSpatialReference=function(a,c){return(a=a||c.extent.spatialReference)?r.SpatialReference.fromJSON(a):null};a.prototype.readPixelType=function(a){return U.fromJSON(a)||a};a.prototype.writePixelType=function(a,b,m){if(c.isNone(this.serviceRasterInfo)||this.pixelType!==this.serviceRasterInfo.pixelType)b[m]=U.toJSON(a)};a.prototype.readVersion=function(a,c){(a=c.currentVersion)||(a=c.hasOwnProperty("fields")||
c.hasOwnProperty("timeInfo")?10:9.3);return a};a.prototype.applyFilter=function(a){var c=a;this.pixelFilter&&(c=this._clonePixelData(a),this.pixelFilter(c));return c};a.prototype.applyRenderer=function(a,c){return e.__awaiter(this,void 0,void 0,function(){var b,m,f,h,g;return e.__generator(this,function(d){switch(d.label){case 0:b=a;if(this._isPicture()||!this.renderer||!this._symbolizer||this.pixelFilter)return[3,5];m=JSON.stringify(this._cachedRendererJson)!==JSON.stringify(this.renderer.toJSON());
f=this._rasterJobHandler.instance;h=this.bandIds;if(!f)return[3,4];if(!m)return[3,2];this._symbolizer.bind();return[4,f.updateSymbolizer(this._symbolizer,c)];case 1:d.sent(),this._cachedRendererJson=this.renderer.toJSON(),d.label=2;case 2:return[4,f.symbolize(e.__assign({bandIds:h},a),c)];case 3:return g=d.sent(),b={extent:a.extent,pixelBlock:g},[3,5];case 4:b={extent:a.extent,pixelBlock:this._symbolizer.symbolize(e.__assign({bandIds:h},a))},d.label=5;case 5:return[2,b]}})})};a.prototype.destroy=
function(){this._shutdownJobHandler()};a.prototype.increaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount++};a.prototype.decreaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount--;0>=this._rasterJobHandler.refCount&&this._shutdownJobHandler()};a.prototype.fetchImage=function(a,c,m,f){var h=this;void 0===f&&(f={});if(null==a||null==c||null==m)return t.reject(new b("imagery-layer:fetch-image","Insufficient parameters for requesting an image. A valid extent, width and height values are required."));
var g=this.renderer||this._symbolizer?this.generateRasterInfo(this.renderingRule,{signal:f.signal}):null;return t.when(g).then(function(b){b&&(h.rasterInfo=b);b={imageServiceParameters:h.getExportImageServiceParameters(a,c,m,f.timeExtent),imageProps:{extent:a,width:c,height:m,format:h.format},requestAsImageElement:f.requestAsImageElement&&!h.pixelFilter||!1,signal:f.signal};return h._requestArrayBuffer(b)})};a.prototype.fetchKeyProperties=function(a){a=a&&a.renderingRule&&a.renderingRule.toJSON();
return l(this.parsedUrl.path+"/keyProperties",{query:this._getQueryParams({renderingRule:10.3<=this.version&&a?JSON.stringify(a):null})}).then(function(a){return a.data})};a.prototype.fetchRasterAttributeTable=function(a){a=a&&a.renderingRule&&a.renderingRule.toJSON();return 10.1>this.version?t.reject(new b("#fetchRasterAttributeTable()","Failed to get rasterAttributeTable")):l(this.parsedUrl.path+"/rasterAttributeTable",{query:this._getQueryParams({renderingRule:10.3<=this.version&&a?JSON.stringify(a):
null})}).then(function(a){return I.fromJSON(a.data)})};a.prototype.getCatalogItemRasterInfo=function(a,c){return e.__awaiter(this,void 0,void 0,function(){var b,m,f,h,g;return e.__generator(this,function(d){switch(d.label){case 0:return b=l(this.parsedUrl.path+"/"+a+"/info",e.__assign({query:this._getQueryParams()},c)).then(function(a){return a.data}),m=l(this.parsedUrl.path+"/"+a+"/info/keyProperties",e.__assign({query:this._getQueryParams()},c)).then(function(a){return a.data}).catch(function(){}),
[4,t.all([b,m])];case 1:f=d.sent();if(!f[0])return[2,void 0];h=r.Extent.fromJSON(f[0].extent);g=f[0].statistics?f[0].statistics.map(function(a){return{min:a[0],max:a[1],avg:a[2],stddev:a[3]}}):null;return[2,new z({bandCount:f[0].bandCount,extent:h,spatialReference:h.sr,pixelSize:new r.Point({x:f[0].pixelSizeX,y:f[0].pixelSizeY,spatialReference:h.sr}),pixelType:f[0].pixelType.toLowerCase(),statistics:g,histograms:f[0].histograms,keyProperties:f[1]})]}})})};a.prototype.getCatalogItemICSInfo=function(a,
c){return e.__awaiter(this,void 0,void 0,function(){var b,m,f,h,g,d,n,w,p,B,v,u,x,y,A,k,z,E,C,F,H,V,N,M,K,J,G,q,I,P;return e.__generator(this,function(Q){switch(Q.label){case 0:return[4,l(this.parsedUrl.path+"/"+a+"/info/ics",e.__assign({query:this._getQueryParams()},c))];case 1:m=(b=Q.sent().data)&&b.ics;if(!m)return[2,void 0];f=null;Q.label=2;case 2:return Q.trys.push([2,4,,5]),[4,l(this.parsedUrl.path+"/"+a+"/info",e.__assign({query:this._getQueryParams()},c))];case 3:return h=Q.sent(),f=h.data.extent,
[3,5];case 4:return Q.sent(),[3,5];case 5:if(!f||!f.spatialReference)return[2,{ics:m,icsToPixelTransform:null,icsExtent:null,northDirection:null}];g=10.7<=this.version?l(this.parsedUrl.path+"/"+a+"/info/icstopixel",e.__assign({query:this._getQueryParams()},c)).then(function(a){return a.data}).catch(function(){return{}}):{};d=f.spatialReference;n={geometries:JSON.stringify({geometryType:"esriGeometryEnvelope",geometries:[f]}),inSR:d.wkid||d,outSR:"0:"+a};w=l(this.parsedUrl.path+"/project",e.__assign({query:this._getQueryParams(n)},
c)).then(function(a){return a.data}).catch(function(){return{}});p=5;B=(f.xmin+f.xmax)/2;v=(f.ymax-f.ymin)/(p+1);u=f.ymin+v;x=[];for(y=0;y<p;y++)x.push({x:B,y:u+v*y});A={geometries:JSON.stringify({geometryType:"esriGeometryPoint",geometries:x}),inSR:d.wkid||d,outSR:"0:"+a};k=l(this.parsedUrl.path+"/project",e.__assign({query:this._getQueryParams(A)},c)).then(function(a){return a.data}).catch(function(){return{}});return[4,t.all([g,w,k])];case 6:z=Q.sent();E=z[0].ipxf;null==E&&(C=m.geodataXform&&m.geodataXform.xf_0)&&
"topup"===C.name.toLowerCase()&&(E={affine:{name:"ics [sensor: Frame] to pixel (column, row) transformation",coefficients:C.coefficients,cellsizeRatio:0,type:"GeometricXform"}});if(F=r.Extent.fromJSON(z[1]&&z[1].geometries&&z[1].geometries[0]))F.spatialReference=new r.SpatialReference({wkid:0,imageCoordinateSystem:m});H=z[2].geometries?z[2].geometries.filter(function(a){return null!=a}):[];V=H.length;if(3>V)return[2,{ics:m,icsToPixelTransform:E,icsExtent:F,northDirection:null}];for(y=J=K=M=N=0;y<
V;y++)N+=H[y].x,M+=H[y].y,K+=H[y].x*H[y].x,J+=H[y].x*H[y].y;G=(V*J-N*M)/(V*K-N*N);q=0;I=H[p-1].x>H[0].x;P=H[p-1].y>H[0].y;Infinity===G?q=P?90:270:0===G?q=I?0:180:0<G?q=I?180*Math.atan(G)/Math.PI:180*Math.atan(G)/Math.PI+180:0>G&&(q=P?180+180*Math.atan(G)/Math.PI:360+180*Math.atan(G)/Math.PI);return[2,{ics:m,icsToPixelTransform:E,icsExtent:F,northDirection:q}]}})})};a.prototype.generateRasterInfo=function(a,b){return e.__awaiter(this,void 0,void 0,function(){var m,f;return e.__generator(this,function(h){switch(h.label){case 0:if((!a||
"none"===a.functionName.toLowerCase())&&c.isSome(this.serviceRasterInfo))return[2,this.serviceRasterInfo];m=L(a);if(this._functionRasterInfos[m])return[2,this._functionRasterInfos[m]];f=this._generateRasterInfo(a,b);this._functionRasterInfos[m]=f;h.label=1;case 1:return h.trys.push([1,3,,4]),[4,f];case 2:return[2,h.sent()];case 3:return h.sent(),this._functionRasterInfos[m]=null,[2,null];case 4:return[2]}})})};a.prototype.getExportImageServiceParameters=function(a,b,m,f){a=a.clone().shiftCentralMeridian();
var h=a.spatialReference;if(h.imageCoordinateSystem)var g=h.imageCoordinateSystem,d=g.id,g=g.referenceServiceName,h=null!=d?g?-1<this.parsedUrl.path.toLowerCase().indexOf("/"+g.toLowerCase()+"/")?"0:"+d:JSON.stringify({icsid:d,icsns:g}):"0:"+d:JSON.stringify({ics:h.imageCoordinateSystem});else h=h.wkid||JSON.stringify(h.toJSON());c.isSome(this.serviceRasterInfo)&&this.pixelType!==this.serviceRasterInfo.pixelType&&(this.exportImageServiceParameters.pixelType=this.pixelType);var d=this.exportImageServiceParameters.toJSON(),
g=d.bandIds,t=d.noData,n=d.mosaicRule,w=d.renderingRule;g instanceof Array&&0<g.length&&(d.bandIds=g.join(","));t instanceof Array&&0<t.length&&(d.noData=t.join(","));var p=this.timeInfo;n&&n.multidimensionalDefinition&&f&&p&&p.startField&&(n.multidimensionalDefinition=n.multidimensionalDefinition.filter(function(a){return a.dimensionName!==p.startField}));d.mosaicRule=n&&JSON.stringify(n);d.renderingRule=w&&JSON.stringify(w);g={};if(f)if(t=f.toJSON(),f=t.start,t=t.end,f&&t&&f===t)g.time=""+f;else if(null!=
f||null!=t)g.time=(null==f?"null":f)+","+(null==t?"null":t);return e.__assign(e.__assign({bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,bboxSR:h,imageSR:h,size:b+","+m},d),g)};a.prototype.queryRasters=function(a){return this.queryTask.execute(a)};a.prototype.queryVisibleRasters=function(a,c){var m=this;if(!a)return t.reject(new b("imagery-layer: query-visible-rasters","missing query parameter"));var f=c||{pixelSize:null,returnDomainValues:!1,returnTopmostRaster:!1,showNoDataRecords:!1};c=f.pixelSize;
var h=f.returnDomainValues,g=f.returnTopmostRaster,d=f.showNoDataRecords,n=!1,w=f=null,p=this.rasterFunctionNamesIndex;if(a.outFields&&(n=a.outFields.some(function(a){return-1===a.toLowerCase().indexOf("raster.servicepixelvalue")}),10.4<=this.version)){var v=a.outFields.filter(function(a){return-1<a.toLowerCase().indexOf("raster.servicepixelvalue")&&24<a.length}).map(function(a){a=a.slice(25);return[m._updateRenderingRulesFunctionName(a,p),a]}),f=v.map(function(a){return new y({functionName:a[0]})}),
w=v.map(function(a){return a[1]});0===f.length?this.renderingRule?(f.push(this.renderingRule),w.push(this.renderingRule.functionName)):f=null:this.renderingRule&&!f.some(function(a){return a.functionName===m.renderingRule.functionName})&&(f.push(this.renderingRule),w.push(this.renderingRule.functionName))}var B=!a.outSpatialReference||a.outSpatialReference.equals(this.spatialReference);c=this._getQueryParams({geometry:a.geometry,timeExtent:a.timeExtent,mosaicRule:this.exportImageServiceParameters.mosaicRule,
renderingRule:10.4>this.version?this.renderingRule:null,renderingRules:f,pixelSize:c,returnCatalogItems:n,returnGeometry:B,maxItemCount:g?1:null});delete c.f;var x=new G(c),u=new N({url:this.url}),l=this.generateRasterInfo(this.renderingRule);return t.create(function(c){l.then(function(){u.execute(x).then(function(f){var g=a.outFields;if(n&&!B&&f.catalogItems&&f.catalogItems.features&&0<f.catalogItems.features.length){var t=m.objectIdField||"ObjectId",p=f.catalogItems.features,v=p.map(function(a){return a.attributes&&
a.attributes[t]}),v=new J({objectIds:v,returnGeometry:!0,outSpatialReference:a.outSpatialReference,outFields:[t]});return m.queryRasters(v).then(function(b){b&&b.features&&0<b.features.length&&b.features.forEach(function(c){p.forEach(function(b){b.attributes[t]===c.attributes[t]&&(b.geometry=new r.Polygon(c.geometry),b.geometry.spatialReference=a.outSpatialReference)})});c(m._processVisibleRastersResponse(f,{returnDomainValues:h,templateRRFunctionNames:w,showNoDataRecords:d,templateFields:g}))}).catch(function(){throw new b("imagery-layer:query-visible-rasters",
"encountered error when querying visible rasters geometry");})}c(m._processVisibleRastersResponse(f,{returnDomainValues:h,templateRRFunctionNames:w,showNoDataRecords:d,templateFields:g}))}).catch(function(){throw new b("imagery-layer:query-visible-rasters","encountered error when querying visible rasters");})})})};a.prototype._fetchService=function(a){var f;return e.__awaiter(this,void 0,void 0,function(){var m,h,g,d,n,w,p,v=this;return e.__generator(this,function(B){switch(B.label){case 0:return(m=
this.sourceJSON)?[3,2]:[4,l(this.parsedUrl.path,{query:this._getQueryParams(),signal:a})];case 1:h=B.sent(),g=h.data,d=h.ssl,this.sourceJSON=m=g,d&&(this.url=this.url.replace(/^http:/i,"https:")),B.label=2;case 2:if(n=-1<(null===(f=m.capabilities)||void 0===f?void 0:f.toLowerCase().split(",").map(function(a){return a.trim()}).indexOf("tilesonly")))throw new b("imagery-layer:fetch-metadata","use ImageryTileLayer to open tiles-only image services");this.read(m,{origin:"service",url:this.parsedUrl});
c.isSome(this.serviceRasterInfo)&&!this.rasterInfo&&(this.rasterInfo=this.serviceRasterInfo);w=c.isSome(this.serviceRasterInfo)?t.resolve(this.serviceRasterInfo):this._fetchAuxiliaryRasterInfo({serviceInfo:m,signal:a}).then(function(a){v._set("serviceRasterInfo",a);return a});p=this.renderingRule&&"none"!==this.renderingRule.functionName.toLowerCase()?this.generateRasterInfo(this.renderingRule,{signal:a}):null;return[2,t.all([w,p]).then(function(a){a[1]?v._set("rasterInfo",a[1]):v._set("rasterInfo",
a[0]);v._configDefaultRenderer();v.watch("renderer",function(){return v._configDefaultRenderer()});v.watch("renderingRule",function(a){(v.renderer||v._symbolizer||v.popupEnabled&&v.popupTemplate)&&v.generateRasterInfo(a).then(function(a){a&&(v.rasterInfo=a)})});(a=c.isSome(v.serviceRasterInfo)&&v.serviceRasterInfo.multidimensionalInfo)&&v._updateMultidimensionalDefinition(a)})]}})})};a.prototype._initJobHandler=function(){return e.__awaiter(this,void 0,void 0,function(){var a,c=this;return e.__generator(this,
function(b){switch(b.label){case 0:if(null!=this._rasterJobHandler.connectionPromise)return[2,this._rasterJobHandler.connectionPromise];a=new C;this._rasterJobHandler.connectionPromise=a.initialize().then(function(){c._rasterJobHandler.instance=a},function(){return null});return[4,this._rasterJobHandler.connectionPromise];case 1:return b.sent(),[2]}})})};a.prototype._shutdownJobHandler=function(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy();this._rasterJobHandler.instance=
null;this._rasterJobHandler.connectionPromise=null;this._rasterJobHandler.refCount=0};a.prototype._isPicture=function(){return!this.format||-1<this.format.indexOf("jpg")||-1<this.format.indexOf("png")};a.prototype._configDefaultRenderer=function(){if(!this._isPicture()&&!this.pixelFilter){if(!this.bandIds&&3<=this.rasterInfo.bandCount){var a=E.getDefaultBandCombination(this.rasterInfo);!a||3===this.rasterInfo.bandCount&&0===a[0]&&1===a[1]&&2===a[2]||(this.bandIds=a)}this.renderer||(this.renderer=
E.createDefaultRenderer(this.rasterInfo,this.bandIds));this._symbolizer?(this._symbolizer.renderer=this.renderer,this._symbolizer.rasterInfo=this.rasterInfo):this._symbolizer=new H({renderer:this.renderer,rasterInfo:this.rasterInfo});this._symbolizer.bind()||(this._symbolizer=null)}};a.prototype._clonePixelData=function(a){return null==a?a:{extent:a.extent&&a.extent.clone(),pixelBlock:a.pixelBlock&&a.pixelBlock.clone()}};a.prototype._getQueryParams=function(a){return e.__assign({raster:this.raster,
viewId:this.viewId,f:"json"},a)};a.prototype._decodePixelBlock=function(a,c,b){return this._rasterJobHandler.instance?this._rasterJobHandler.instance.decode({data:a,options:c}):F.decode(a,c,b)};a.prototype._fetchAuxiliaryRasterInfo=function(a){var c=a&&a.serviceInfo;if(!c)return t.reject(new b("imagery-layer:fetch-metadata","valid serviceInfo is required"));var f=a.renderingRule?JSON.stringify(a.renderingRule.toJSON()):null,m=a.signal;a=c.hasRasterAttributeTable&&10.1<=this.version?l(this.parsedUrl.path+
"/rasterAttributeTable",{query:this._getQueryParams({renderingRule:10.1<=this.version?f:null}),signal:m}).then(function(a){return I.fromJSON(a.data)}).catch(function(){return null}):!1;var h=c.hasColormap&&10.1<=this.version?l(this.parsedUrl.path+"/colormap",{query:this._getQueryParams({renderingRule:10.6<=this.version?f:null}),signal:m}).then(function(a){return a.data&&a.data.colormap}):!1,g=c.hasHistograms&&10.1<=this.version?l(this.parsedUrl.path+"/histograms",{query:this._getQueryParams({renderingRule:10.1<=
this.version?f:null}),signal:m}).then(function(a){return a.data&&a.data.histograms}):!1,f=10.3<=this.version?l(this.parsedUrl.path+"/keyProperties",{query:this._getQueryParams({renderingRule:f}),signal:m}).then(function(a){return a.data}).catch(function(){}):!1,m=c.hasMultidimensions&&10.3<=this.version?l(this.parsedUrl.path+"/multidimensionalInfo",{query:this._getQueryParams(),signal:m}).then(function(a){return a.data&&a.data.multidimensionalInfo}):!1;return t.all([a,h,g,f,m]).then(function(a){var b=
null;if(c.minValues&&c.minValues.length===c.bandCount)for(var b=[],f=0;f<c.minValues.length;f++)b.push({min:c.minValues[f],max:c.maxValues[f],avg:c.meanValues[f],stddev:c.stdvValues[f]});var f=Math.ceil((c.extent.xmax-c.extent.xmin)/c.pixelSizeX-.1),m=Math.ceil((c.extent.ymax-c.extent.ymin)/c.pixelSizeY-.1),h=r.SpatialReference.fromJSON(c.spatialReference||c.extent.spatialReference);return new z({width:f,height:m,bandCount:c.bandCount,extent:r.Extent.fromJSON(c.extent),spatialReference:h,pixelSize:new r.Point({x:c.pixelSizeX,
y:c.pixelSizeY,spatialReference:h}),pixelType:c.pixelType.toLowerCase(),statistics:b,attributeTable:a[0]||null,colormap:a[1]||null,histograms:a[2]||null,keyProperties:a[3]||null,multidimensionalInfo:a[4]||null})})};a.prototype._requestArrayBuffer=function(a){var c=this,f=a.imageProps,m=a.signal;if(a.requestAsImageElement&&!this.pixelFilter&&f.format&&-1<f.format.indexOf("png"))return l(this.parsedUrl.path+"/exportImage",{responseType:"image",query:this._getQueryParams(e.__assign({f:"image"},a.imageServiceParameters)),
signal:m}).then(function(a){return{imageElement:a.data,params:f}});var h=this._initJobHandler();a=l(this.parsedUrl.path+"/exportImage",{responseType:"array-buffer",query:this._getQueryParams(e.__assign({f:"image"},a.imageServiceParameters)),signal:m});return t.all([a,h]).then(function(a){a=a[0].data;var h=f.format||"jpgpng",g=h;"bsq"!==g&&"bip"!==g&&(g=F.getFormat(a));if(!g)throw new b("imagery-layer:fetch-image","unsupported format signature "+String.fromCharCode.apply(null,new Uint8Array(a)));var g=
-1<h.indexOf("png")&&("png"===g||"jpg"===g),d={signal:m};return g?F.decode(a,e.__assign({useCanvas:!0},f),d).then(function(a){return{pixelData:{pixelBlock:a,extent:f.extent},params:f}}):c._decodePixelBlock(a,{width:f.width,height:f.height,planes:null,pixelType:null,noDataValue:null,format:h},d).then(function(a){return{pixelData:{pixelBlock:a,extent:f.extent},params:f}})})};a.prototype._generateRasterInfo=function(a,c){return e.__awaiter(this,void 0,void 0,function(){var b,f;return e.__generator(this,
function(m){switch(m.label){case 0:return[4,l(this.parsedUrl.path,e.__assign({query:this._getQueryParams({renderingRule:a})},c))];case 1:return b=m.sent().data,[4,this._fetchAuxiliaryRasterInfo(e.__assign({serviceInfo:b,renderingRule:a},c))];case 2:return f=m.sent(),[2,f]}})})};a.prototype._isValidCustomizedMosaicRule=function(a){return a&&JSON.stringify(a.toJSON())!==JSON.stringify(this._defaultServiceMosaicRule&&this._defaultServiceMosaicRule.toJSON())};a.prototype._updateMultidimensionalDefinition=
function(a){if(!this._isValidCustomizedMosaicRule(this.mosaicRule)){var c=a.variables[0].dimensions;a=[];for(var b in c)if(c.hasOwnProperty(b)){var f=c[b],m=f.extent,h=!0,g=[m[0]];f.hasRanges&&!0===f.hasRanges?(h=!1,g=[f.values[0]]):"stdz"===f.name.toLowerCase()&&Math.abs(m[1])<=Math.abs(m[0])&&(g=[m[1]]);a.push(new p({variableName:"",dimensionName:c[b].name,isSlice:h,values:g}))}0<a.length&&(this.mosaicRule=this.mosaicRule||new x,b=this.mosaicRule.multidimensionalDefinition,!b||b&&0>=b.length)&&
(this.mosaicRule.multidimensionalDefinition=a)}};a.prototype._formatAttributeValue=function(a,c){if("string"===typeof a&&(c=(c=this._getFieldInfo(this.popupTemplate&&this.popupTemplate.fieldInfos,c))&&c.format)){var b=void 0,f=void 0;return-1<a.trim().indexOf(",")?(b=",",this._formatDelimitedString(a,b,b+" ",c)):-1<a.trim().indexOf(" ")?(b=f=" ",this._formatDelimitedString(a,b,f,c)):this._formatNumberFromString(a,c)}return a};a.prototype._getFieldInfo=function(a,c){if(a&&a.length&&c){var b=c.toLowerCase(),
f=void 0;a.some(function(a){return!a.fieldName||a.fieldName.toLowerCase()!==b&&a.fieldName.toLowerCase()!==b.replace(/ /g,"_")?!1:(f=a,!0)});return f}};a.prototype._formatDelimitedString=function(a,c,b,f){var m=this;return a&&c&&b&&f?a.trim().split(c).map(function(a){return m._formatNumberFromString(a,f)}).join(b):a};a.prototype._formatNumberFromString=function(a,c){if(!a||!c)return a;var b=Number(a);return isNaN(b)?a:c.format(b)};a.prototype._processVisibleRastersResponse=function(a,b){b=b||{};var f=
a.value,m=b.templateRRFunctionNames,h=b.showNoDataRecords,g=b.returnDomainValues,t=b.templateFields;b=a.processedValues;var n=a.catalogItems&&a.catalogItems.features,w=a.properties&&a.properties.Values&&a.properties.Values.map(function(a){return a.replace(/ /gi,", ")})||[],v=this.objectIdField||"ObjectId";a="string"===typeof f&&-1<f.toLowerCase().indexOf("nodata");var p=[];!f||n||a||(n={},n[v]=0,n=new d(this.fullExtent,null,n),w=[f],n=[n]);if(!n)return[];this._updateResponseFieldNames(n,t);for(var B,
x,v=0;v<n.length;v++){t=n[v];if(null!=f&&!a){B=w[v];x=this.renderingRule&&b&&0<b.length&&m&&0<m.length&&-1<m.indexOf(this.renderingRule.functionName)?b[m.indexOf(this.renderingRule.functionName)]:f;if("nodata"===B.toLowerCase()&&!h)continue;t.attributes["Raster.ItemPixelValue"]=this._formatAttributeValue(B,"Raster.ItemPixelValue");t.attributes["Raster.ServicePixelValue"]=this._formatAttributeValue(x,"Raster.ServicePixelValue");this._updateFeatureWithMagDirValues(t,B);var u=this.fields&&0<this.fields.length;
x=this.renderingRule&&c.isSome(this.serviceRasterInfo)&&this.serviceRasterInfo.attributeTable?u?B:f:x;this.renderingRule||(x=u?B:f);this._updateFeatureWithRasterAttributeTableValues(t,x)}t.sourceLayer=this;g&&this._updateFeatureWithDomainValues(t);if(m&&b&&m.length===b.length)for(B=0;B<m.length;B++)u="Raster.ServicePixelValue."+m[B],t.attributes[u]=this._formatAttributeValue(b[B],u);p.push(n[v])}return p};a.prototype._updateFeatureWithRasterAttributeTableValues=function(a,b){var f=this,m=this.rasterInfo&&
this.rasterInfo.attributeTable||c.isSome(this.serviceRasterInfo)&&this.serviceRasterInfo.attributeTable,h=m&&m.features;if(h){var m=m.fields,g=m.map(function(a){return a.name}).filter(function(a){return"value"===a.toLowerCase()}),d=g&&g[0];if(d){var t=h.filter(function(a){return a.attributes[d]===(null!=b?parseInt(b,10):null)});t&&t[0]&&m.forEach(function(c){var b=f.rasterAttributeTableFieldPrefix+c.name;a.attributes[b]=f._formatAttributeValue(t[0].attributes[c.name],b)})}}};a.prototype._updateFeatureWithMagDirValues=
function(a,c){if(this.pixelFilter&&("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)){var b=c.replace(" ",",").split(",").map(function(a){return parseFloat(a)});c=b.map(function(a){return[a]});b=b.map(function(a){return{minValue:a,maxValue:a,noDataValue:null}});c=new w({height:1,width:1,pixelType:"f32",pixels:c,statistics:b});this.pixelFilter({pixelBlock:c,extent:new r.Extent(0,0,0,0,this.spatialReference)});a.attributes["Raster.Magnitude"]=
c.pixels[0][0];a.attributes["Raster.Direction"]=c.pixels[1][0]}};a.prototype._updateFeatureWithDomainValues=function(a){var c=this.fields&&this.fields.filter(function(a){return a.domain&&"coded-value"===a.domain.type});null!=c&&c.forEach(function(c){var b=a.attributes[c.name];if(null!=b){var f=c.domain.codedValues.filter(function(a){return a.code===b})[0];f&&(a.attributes[c.name]=f.name)}})};a.prototype._updateResponseFieldNames=function(a,c){if(c&&!(1>c.length)){var b=this.fieldsIndex;b&&a.forEach(function(a){if(a&&
a.attributes)for(var f=0;f<c.length;f++){var m=c[f];if(b.has(m)){var h=b.get(m).name;h!==m&&(a.attributes[m]=a.attributes[h],delete a.attributes[h])}}})}};a.prototype._updateRenderingRulesFunctionName=function(a,c){if(a&&!(1>a.length)){if("Raw"===a)return a.replace("Raw","None");var b=a.toLowerCase().replace(/ /gi,"_");return c.has(b)?c.get(b):a}};a.prototype._isRFTJson=function(a){return a.name&&a.arguments&&a.function&&a.hasOwnProperty("functionType")};a.prototype._readCapabilities=function(a){var c=
a.capabilities?a.capabilities.toLowerCase().split(",").map(function(a){return a.trim()}):["image","catalog"],b=a.currentVersion,f=a.advancedQueryCapabilities,m=a.maxRecordCount,h=-1<c.indexOf("image"),g="esriImageServiceDataTypeElevation"===a.serviceDataType,d=!!(a.spatialReference||a.extent&&a.extent.spatialReference);return{operations:{supportsComputeHistograms:h,supportsExportImage:h,supportsIdentify:h,supportsMeasure:-1<c.indexOf("mensuration")&&d,supportsDownload:-1<c.indexOf("download"),supportsQuery:-1<
c.indexOf("catalog")&&a.fields&&0<a.fields.length,supportsGetSamples:10.2<=b&&h,supportsProject:10.3<=b&&h,supportsComputeStatisticsHistograms:10.4<=b&&h,supportsQueryBoundary:10.6<=b&&h,supportsCalculateVolume:10.7<=b&&g,supportsComputePixelLocation:10.7<=b&&-1<c.indexOf("catalog")},query:{supportsStatistics:!(!f||!f.supportsStatistics),supportsOrderBy:!(!f||!f.supportsOrderBy),supportsDistinct:!(!f||!f.supportsDistinct),supportsPagination:!(!f||!f.supportsPagination),supportsStandardizedQueriesOnly:!(!f||
!f.useStandardizedQueries),maxRecordCount:m}}};e.__decorate([f.property()],a.prototype,"_functionRasterInfos",void 0);e.__decorate([f.property()],a.prototype,"_rasterJobHandler",void 0);e.__decorate([f.property()],a.prototype,"_symbolizer",void 0);e.__decorate([f.property()],a.prototype,"_defaultServiceMosaicRule",void 0);e.__decorate([f.reader("_defaultServiceMosaicRule",["defaultMosaicMethod"])],a.prototype,"readDefaultServiceMosaicRule",null);e.__decorate([f.property()],a.prototype,"_cachedRendererJson",
void 0);e.__decorate([f.property()],a.prototype,"rasterAttributeTableFieldPrefix",void 0);e.__decorate([f.property({readOnly:!0,dependsOn:["rasterFunctionInfos"]})],a.prototype,"rasterFunctionNamesIndex",null);e.__decorate([f.property({readOnly:!0,dependsOn:["url"]})],a.prototype,"queryTask",null);e.__decorate([f.property()],a.prototype,"adjustAspectRatio",void 0);e.__decorate([f.property({readOnly:!0}),f.aliasOf("serviceRasterInfo.bandCount")],a.prototype,"bandCount",void 0);e.__decorate([f.property({type:[h.Integer],
json:{write:!0}})],a.prototype,"bandIds",void 0);e.__decorate([f.reader("bandIds")],a.prototype,"readBandIds",null);e.__decorate([f.property({readOnly:!0,json:{read:!1}})],a.prototype,"capabilities",void 0);e.__decorate([f.reader("service","capabilities",["capabilities","currentVersion","serviceDataType"])],a.prototype,"readCapabilities",null);e.__decorate([f.property({type:Number})],a.prototype,"compressionQuality",void 0);e.__decorate([f.writer("compressionQuality")],a.prototype,"writeCompressionQuality",
null);e.__decorate([f.property({type:Number})],a.prototype,"compressionTolerance",void 0);e.__decorate([f.writer("compressionTolerance")],a.prototype,"writeCompressionTolerance",null);e.__decorate([f.property({json:{read:{source:"copyrightText"}}})],a.prototype,"copyright",void 0);e.__decorate([f.property({type:String,json:{read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],a.prototype,"definitionExpression",void 0);e.__decorate([f.property({readOnly:!0,
constructOnly:!0})],a.prototype,"exportImageServiceParameters",void 0);e.__decorate([f.property()],a.prototype,"rasterInfo",void 0);e.__decorate([f.property({readOnly:!0,type:[v]})],a.prototype,"fields",void 0);e.__decorate([f.property({readOnly:!0,dependsOn:["fields"]})],a.prototype,"fieldsIndex",null);e.__decorate([f.property({type:String,json:{write:!0}})],a.prototype,"format",null);e.__decorate([f.property({type:r.Extent})],a.prototype,"fullExtent",void 0);e.__decorate([f.property({readOnly:!0})],
a.prototype,"hasMultidimensions",void 0);e.__decorate([f.property({json:{read:{source:"maxImageHeight"}}})],a.prototype,"imageMaxHeight",void 0);e.__decorate([f.property({json:{read:{source:"maxImageWidth"}}})],a.prototype,"imageMaxWidth",void 0);e.__decorate([f.property({type:String,json:{read:{reader:P.read},write:{writer:P.write}}})],a.prototype,"interpolation",void 0);e.__decorate([f.property({type:x})],a.prototype,"mosaicRule",null);e.__decorate([f.reader("mosaicRule",["mosaicRule","defaultMosaicMethod"])],
a.prototype,"readMosaicRule",null);e.__decorate([f.writer("mosaicRule")],a.prototype,"writeMosaicRule",null);e.__decorate([f.property({readOnly:!0}),f.aliasOf("serviceRasterInfo.multidimensionalInfo")],a.prototype,"multidimensionalInfo",void 0);e.__decorate([f.property()],a.prototype,"noData",void 0);e.__decorate([f.writer("noData")],a.prototype,"writeNoData",null);e.__decorate([f.property({type:String,json:{read:{reader:S.read},write:{writer:S.write}}})],a.prototype,"noDataInterpretation",void 0);
e.__decorate([f.property({type:String,readOnly:!0,json:{read:{source:["fields"]}}})],a.prototype,"objectIdField",void 0);e.__decorate([f.reader("objectIdField")],a.prototype,"readObjectIdField",null);e.__decorate([f.property({readOnly:!0,dependsOn:["url"]})],a.prototype,"parsedUrl",null);e.__decorate([f.property({readOnly:!0}),f.aliasOf("serviceRasterInfo.pixelSize.x")],a.prototype,"pixelSizeX",void 0);e.__decorate([f.property({readOnly:!0}),f.aliasOf("serviceRasterInfo.pixelSize.y")],a.prototype,
"pixelSizeY",void 0);e.__decorate([f.property({type:Function})],a.prototype,"pixelFilter",void 0);e.__decorate([f.property()],a.prototype,"raster",void 0);e.__decorate([f.property()],a.prototype,"viewId",void 0);e.__decorate([f.property({types:k.rasterRendererTypes,json:{read:{source:"layerDefinition.drawingInfo.renderer"},write:{target:"layerDefinition.drawingInfo.renderer"}}})],a.prototype,"renderer",void 0);e.__decorate([f.reader("renderer")],a.prototype,"readRenderer",null);e.__decorate([f.property(n.opacityDrawingInfo)],
a.prototype,"opacity",void 0);e.__decorate([f.property({readOnly:!0}),f.aliasOf("serviceRasterInfo.attributeTable")],a.prototype,"rasterAttributeTable",void 0);e.__decorate([f.property({readOnly:!0,dependsOn:["fields","rasterInfo","capabilities"]})],a.prototype,"rasterFields",null);e.__decorate([f.property({readOnly:!0})],a.prototype,"rasterFunctionInfos",void 0);e.__decorate([f.property({type:y})],a.prototype,"renderingRule",null);e.__decorate([f.reader("renderingRule",["renderingRule","rasterFunctionInfos"])],
a.prototype,"readRenderingRule",null);e.__decorate([f.writer("renderingRule")],a.prototype,"writeRenderingRule",null);e.__decorate([f.property()],a.prototype,"serviceDataType",void 0);e.__decorate([f.property({readOnly:!0,type:r.SpatialReference})],a.prototype,"spatialReference",void 0);e.__decorate([f.reader("spatialReference",["spatialReference","extent"])],a.prototype,"readSpatialReference",null);e.__decorate([f.property()],a.prototype,"pixelType",void 0);e.__decorate([f.reader("pixelType")],a.prototype,
"readPixelType",null);e.__decorate([f.writer("pixelType")],a.prototype,"writePixelType",null);e.__decorate([f.property({constructOnly:!0,type:z})],a.prototype,"serviceRasterInfo",void 0);e.__decorate([f.property()],a.prototype,"sourceJSON",void 0);e.__decorate([f.property(n.url)],a.prototype,"url",void 0);e.__decorate([f.property({readOnly:!0})],a.prototype,"version",void 0);e.__decorate([f.reader("version",["currentVersion","fields","timeInfo"])],a.prototype,"readVersion",null);return a=e.__decorate([f.subclass("esri.layers.mixins.ArcGISImageService")],
a)}(m)}})},"esri/rasterRenderers":function(){define("require exports ./core/Warning ./renderers/ClassBreaksRenderer ./renderers/RasterColormapRenderer ./renderers/RasterShadedReliefRenderer ./renderers/RasterStretchRenderer ./renderers/UniqueValueRenderer".split(" "),function(D,q,e,r,d,k,l,b){function a(a,c){if(!a)return null;var b;b=a?g[a.type]||null:null;if(b)return b=new b,b.read(a,c),b;c&&c.messages&&a&&c.messages.push(new e("renderer:unsupported","Renderers of type '"+(a.type||"unknown")+"' are not supported",
{definition:a,context:c}));return null}Object.defineProperty(q,"__esModule",{value:!0});q.ClassBreaksRenderer=r;q.RasterColormapRenderer=d;q.RasterShadedReliefRenderer=k;q.RasterStretchRenderer=l;q.UniqueValueRenderer=b;q.rasterRendererTypes={key:"type",base:null,typeMap:{"unique-value":b,"class-breaks":r,"raster-colormap":d,"raster-stretch":l,"raster-shaded-relief":k}};var g={uniqueValue:b,classBreaks:r,rasterStretch:l,rasterColormap:d,rasterShadedRelief:k};q.read=a;q.fromJSON=function(b,c){return a(b,
c)}})},"esri/renderers/RasterColormapRenderer":function(){define("require exports tslib ../core/JSONSupport ../core/accessorSupport/decorators ./support/ColormapInfo ./support/colorRampUtils".split(" "),function(D,q,e,r,d,k,l){return function(b){function a(a){a=b.call(this,a)||this;a.colormapInfos=null;a.type="raster-colormap";return a}e.__extends(a,b);g=a;a.createFromColormap=function(a,c){function b(a){return c?c[a]||"":String(a[0])}if(!a)return null;var m=5===a[0].length;a=a.sort(function(a){return a[0][0]-
a[1][0]});m=m?a.map(function(a){return k.fromJSON({value:a[0],color:a.slice(1,5),label:b(a[0])})}):a.map(function(a){return k.fromJSON({value:a[0],color:a.slice(1,4).concat([255]),label:b(a[0])})});return new g({colormapInfos:m})};a.createFromColorramp=function(a){a=l.convertColorRampToColormap(a,256);return g.createFromColormap(a)};a.prototype.clone=function(){return new g({colormapInfos:this.colormapInfos.map(function(a){return a.toJSON()})})};a.prototype.extractColormap=function(){return this.colormapInfos.map(function(a){return[a.value,
a.color.r,a.color.g,a.color.b,1<a.color.a?a.color.a:255*a.color.a&255]}).sort(function(a,c){return a[0]-c[0]})};var g;e.__decorate([d.property({type:[k],json:{write:!0}})],a.prototype,"colormapInfos",void 0);e.__decorate([d.enumeration({rasterColormap:"raster-colormap"})],a.prototype,"type",void 0);return a=g=e.__decorate([d.subclass("esri.renderers.RasterColormapRenderer")],a)}(r.JSONSupport)})},"esri/renderers/support/ColormapInfo":function(){define("require exports tslib ../../Color ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(D,q,e,r,d,k){return function(d){function b(){var a=null!==d&&d.apply(this,arguments)||this;a.value=null;a.label=null;a.color=null;return a}e.__extends(b,d);e.__decorate([k.property({type:Number,json:{write:!0}})],b.prototype,"value",void 0);e.__decorate([k.property({type:String,json:{write:!0}})],b.prototype,"label",void 0);e.__decorate([k.property({type:r,json:{write:!0}})],b.prototype,"color",void 0);return b=e.__decorate([k.subclass("esri.renderers.support.ColormapInfo")],b)}(d.JSONSupport)})},
"esri/renderers/support/colorRampUtils":function(){define(["require","exports","../../Color","../../core/colorUtils"],function(D,q,e,r){function d(b,a){if(!b||!a||b.length!==a.length)return!1;for(var g=0;g<b.length;g++)if(b[g]>a[g]+2||b[g]<a[g]-2)return!1;return!0}function k(b,a,g){b=r.toLAB(b);a=r.toLAB(a);return r.toRGB({l:b.l*(1-g)+g*a.l,a:b.a*(1-g)+g*a.a,b:b.b*(1-g)+g*a.b})}function l(b,a){if(b){a=a?a:q.PREDEFINED_JSON_COLOR_RAMPS;var g=null,m;"algorithmic"===b.type?a.some(function(a){if(d(b.fromColor.toRgb(),
a.fromColor)&&d(b.toColor.toRgb(),a.toColor))return g=a.id,!0}):"multipart"===b.type&&a.some(function(a){if(b.colorRamps&&a.colorRamps&&b.colorRamps.length===a.colorRamps.length&&(m=b.colorRamps,!a.colorRamps.some(function(a,c){if(!d(m[c].fromColor.toRgb(),(new e(a.fromColor)).toRgb())||!d(m[c].toColor.toRgb(),(new e(a.toColor)).toRgb()))return!0}))){if(g)return!0;g=a.id}});return g}}Object.defineProperty(q,"__esModule",{value:!0});q.PREDEFINED_JSON_COLOR_RAMPS=[{id:"aspect_predefined",type:"multipart",
colorRamps:[{fromColor:[190,190,190],toColor:[255,45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,181,61],toColor:[255,254,52]},{fromColor:[255,254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:"blackToWhite_predefined",fromColor:[0,0,0],toColor:[255,255,255]},{id:"blueBright_predefined",
fromColor:[204,204,255],toColor:[0,0,224]},{id:"blueLightToDark_predefined",fromColor:[211,229,232],toColor:[46,100,140]},{id:"blueGreenBright_predefined",fromColor:[203,245,234],toColor:[48,207,146]},{id:"blueGreenLightToDark_predefined",fromColor:[216,242,237],toColor:[21,79,74]},{id:"brownLightToDark_predefined",fromColor:[240,236,170],toColor:[102,72,48]},{id:"brownToBlueGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,
255,191],toColor:[33,130,145]}]},{id:"brownToBlueGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[110,70,45],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:"coefficientBias_predefined",fromColor:[214,214,255],toColor:[0,57,148]},{id:"coldToHotDiverging_predefined",type:"multipart",colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:"conditionNumber_predefined",type:"multipart",colorRamps:[{fromColor:[0,
97,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,34,0]}]},{id:"cyanToPurple_predefined",type:"multipart",colorRamps:[{fromColor:[0,245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:"cyanLightToBlueDark_predefined",type:"multipart",colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:"distance_predefined",fromColor:[255,200,0],toColor:[0,0,255]},{id:"elevation1_predefined",type:"multipart",colorRamps:[{fromColor:[175,
240,233],toColor:[255,255,179]},{fromColor:[255,255,179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,186,3]},{fromColor:[252,186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:"elevation2_predefined",type:"multipart",colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},
{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,96,38],toColor:[150,150,181]},{fromColor:[150,150,181],toColor:[181,150,181]},{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:"errors_predefined",fromColor:[255,235,214],toColor:[196,10,10]},{id:"grayLightToDark_predefined",fromColor:[219,219,219],toColor:[69,69,69]},{id:"greenBright_predefined",fromColor:[204,255,204],toColor:[14,204,14]},{id:"greenLightToDark_predefined",fromColor:[220,245,233],toColor:[34,102,51]},{id:"greenToBlue_predefined",
type:"multipart",colorRamps:[{fromColor:[32,204,16],toColor:[0,242,242]},{fromColor:[0,242,242],toColor:[2,33,227]}]},{id:"orangeBright_predefined",fromColor:[255,235,204],toColor:[240,118,5]},{id:"orangeLightToDark_predefined",fromColor:[250,233,212],toColor:[171,65,36]},{id:"partialSpectrum_predefined",type:"multipart",colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,
173]}]},{id:"partialSpectrum1Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[135,38,38],toColor:[240,149,12]},{fromColor:[240,149,12],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:"partialSpectrum2Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,
13,97]}]},{id:"pinkToYellowGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[158,30,113],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[99,110,45]}]},{id:"pinkToYellowGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:"precipitation_predefined",type:"multipart",colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},
{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,0],toColor:[32,153,143]},{fromColor:[32,153,143],toColor:[11,44,122]}]},{id:"prediction_predefined",type:"multipart",colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:"purpleBright_predefined",fromColor:[255,204,255],toColor:[199,0,199]},{id:"purpleToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],
toColor:[20,122,11]}]},{id:"purpleToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[67,14,89],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[24,79,15]}]},{id:"purpleBlueBright_predefined",fromColor:[223,184,230],toColor:[112,12,242]},{id:"purpleBlueLightToDark_predefined",fromColor:[229,213,242],toColor:[93,44,112]},{id:"purpleRedBright_predefined",fromColor:[255,204,225],toColor:[199,0,99]},{id:"purpleRedLightToDark_predefined",fromColor:[250,215,246],toColor:[143,
17,57]},{id:"redBright_predefined",fromColor:[255,204,204],toColor:[219,0,0]},{id:"redLightToDark_predefined",fromColor:[255,224,224],toColor:[143,10,10]},{id:"redToBlueDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:"redToBlueDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:"redToGreen_predefined",
type:"multipart",colorRamps:[{fromColor:[245,0,0],toColor:[245,245,0]},{fromColor:[245,245,0],toColor:[0,245,0]}]},{id:"redToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:"redToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:"slope_predefined",type:"multipart",colorRamps:[{fromColor:[56,
168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},{id:"spectrumFullBright_predefined",type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:"spectrumFullDark_predefined",type:"multipart",colorRamps:[{fromColor:[153,0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:"spectrumFullLight_predefined",type:"multipart",
colorRamps:[{fromColor:[255,153,153],toColor:[255,255,153]},{fromColor:[255,255,153],toColor:[153,255,255]},{fromColor:[153,255,255],toColor:[153,153,255]}]},{id:"surface_predefined",type:"multipart",colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:"temperature_predefined",type:"multipart",colorRamps:[{fromColor:[255,252,255],toColor:[255,
0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,255,0]},{fromColor:[0,255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:"whiteToBlack_predefined",fromColor:[255,255,255],toColor:[0,0,0]},{id:"yellowToDarkRed_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:"yellowToGreenToDarkBlue_predefined",
type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[56,224,9]},{fromColor:[56,224,9],toColor:[26,147,171]},{fromColor:[26,147,171],toColor:[12,16,120]}]},{id:"yellowToRed_predefined",fromColor:[245,245,0],toColor:[255,0,0]},{id:"yellowGreenBright_predefined",fromColor:[236,252,204],toColor:[157,204,16]},{id:"yellowGreenLightToDark_predefined",fromColor:[215,240,175],toColor:[96,107,45]}];q.PREDEFINED_COLOR_RAMP_NAME_MAP={aspect_predefined:"Aspect",blackToWhite_predefined:"Black to White",
blueBright_predefined:"Blue Bright",blueLightToDark_predefined:"Blue Light to Dark",blueGreenBright_predefined:"Blue-Green Bright",blueGreenLightToDark_predefined:"Blue-Green Light to Dark",brownLightToDark_predefined:"Brown Light to Dark",brownToBlueGreenDivergingBright_predefined:"Brown to Blue Green Diverging, Bright",brownToBlueGreenDivergingDark_predefined:"Brown to Blue Green Diverging, Dark",coefficientBias_predefined:"Coefficient Bias",coldToHotDiverging_predefined:"Cold to Hot Diverging",
conditionNumber_predefined:"Condition Number",cyanToPurple_predefined:"Cyan to Purple",cyanLightToBlueDark_predefined:"Cyan-Light to Blue-Dark",distance_predefined:"Distance",elevation1_predefined:"Elevation #1",elevation2_predefined:"Elevation #2",errors_predefined:"Errors",grayLightToDark_predefined:"Gray Light to Dark",greenBright_predefined:"Green Bright",greenLightToDark_predefined:"Green Light to Dark",greenToBlue_predefined:"Green to Blue",orangeBright_predefined:"Orange Bright",orangeLightToDark_predefined:"Orange Light to Dark",
partialSpectrum_predefined:"Partial Spectrum",partialSpectrum1Diverging_predefined:"Partial Spectrum 1 Diverging",partialSpectrum2Diverging_predefined:"Partial Spectrum 2 Diverging",pinkToYellowGreenDivergingBright_predefined:"Pink to YellowGreen Diverging, Bright",pinkToYellowGreenDivergingDark_predefined:"Pink to YellowGreen Diverging, Dark",precipitation_predefined:"Precipitation",prediction_predefined:"Prediction",purpleBright_predefined:"Purple Bright",purpleToGreenDivergingBright_predefined:"Purple to Green Diverging, Bright",
purpleToGreenDivergingDark_predefined:"Purple to Green Diverging, Dark",purpleBlueBright_predefined:"Purple-Blue Bright",purpleBlueLightToDark_predefined:"Purple-Blue Light to Dark",purpleRedBright_predefined:"Purple-Red Bright",purpleRedLightToDark_predefined:"Purple-Red Light to Dark",redBright_predefined:"Red Bright",redLightToDark_predefined:"Red Light to Dark",redToBlueDivergingBright_predefined:"Red to Blue Diverging, Bright",redToBlueDivergingDark_predefined:"Red to Blue Diverging, Dark",redToGreen_predefined:"Red to Green",
redToGreenDivergingBright_predefined:"Red to Green Diverging, Bright",redToGreenDivergingDark_predefined:"Red to Green Diverging, Dark",slope_predefined:"Slope",spectrumFullBright_predefined:"Spectrum-Full Bright",spectrumFullDark_predefined:"Spectrum-Full Dark",spectrumFullLight_predefined:"Spectrum-Full Light",surface_predefined:"Surface",temperature_predefined:"Temperature",whiteToBlack_predefined:"White to Black",yellowToDarkRed_predefined:"Yellow to Dark Red",yellowToGreenToDarkBlue_predefined:"Yellow to Green to Dark Blue",
yellowToRed_predefined:"Yellow to Red",yellowGreenBright_predefined:"Yellow-Green Bright",yellowGreenLightToDark_predefined:"Yellow-Green Light to Dark"};q.getColorRampId=l;q.getColorRampName=function(b){return(b=l(b))?q.PREDEFINED_COLOR_RAMP_NAME_MAP[b]:null};q.convertColorRampToColormap=function(b,a){if(b&&a){for(var g="multipart"===b.type?b.colorRamps.length:1,m=[],c=[],d,B,f,h,n,p=0,l=0;l<g;l++)m[l]={start:null,end:null},m[l].start=p,m[l].end=p+1/g,p=m[l].end;g=function(g){h=g/a;m.forEach(function(m,
t){h>=m.start&&h<m.end&&(n=(h-m.start)/(m.end-m.start),"multipart"===b.type?(d=new e(b.colorRamps[t].fromColor),B=new e(b.colorRamps[t].toColor)):(d=new e(b.fromColor),B=new e(b.toColor)),f=k(d,B,n),0===g?c.push([g,d.r,d.g,d.b]):g===a-1?c.push([g,B.r,B.g,B.b]):(f=k(d,B,n),c.push([g,f.r,f.g,f.b])))})};for(l=0;l<a;l++)g(l);return c}}})},"esri/core/colorUtils":function(){define(["require","exports"],function(D,q){function e(a,c){var b=[],m,f;if(a[0].length!==c.length)throw"dimensions do not match";var h=
a.length,g=a[0].length,d=0;for(m=0;m<h;m++){for(f=d=0;f<g;f++)d+=a[m][f]*c[f];b.push(d)}return b}function r(b){b=[b.r/255,b.g/255,b.b/255].map(function(a){return.04045>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)});b=e(a,b);return{x:100*b[0],y:100*b[1],z:100*b[2]}}function d(a){a=e(g,[a.x/100,a.y/100,a.z/100]).map(function(a){return Math.min(1,Math.max(.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055,0))});return{r:Math.round(255*a[0]),g:Math.round(255*a[1]),b:Math.round(255*a[2])}}function k(a){a=[a.x/
95.047,a.y/100,a.z/108.883].map(function(a){return a>Math.pow(6/29,3)?Math.pow(a,1/3):1/3*Math.pow(29/6,2)*a+4/29});return{l:116*a[1]-16,a:500*(a[0]-a[1]),b:200*(a[1]-a[2])}}function l(a){var c=a.l;a=[(c+16)/116+a.a/500,(c+16)/116,(c+16)/116-a.b/200].map(function(a){return a>6/29?Math.pow(a,3):3*Math.pow(6/29,2)*(a-4/29)});return{x:95.047*a[0],y:100*a[1],z:108.883*a[2]}}function b(a){if("r"in a&&"g"in a&&"b"in a)return a;if("l"in a&&"c"in a&&"h"in a){var c=a.c,b=a.h;return d(l({l:a.l,a:c*Math.cos(b),
b:c*Math.sin(b)}))}if("l"in a&&"a"in a&&"b"in a)return d(l(a));if("x"in a&&"y"in a&&"z"in a)return d(a);if("h"in a&&"s"in a&&"v"in a){b=(a.h+360)%360/60;c=a.v/100*255;a=a.s/100*c;var g=a*(1-Math.abs(b%2-1));switch(Math.floor(b)){case 0:b={r:a,g:g,b:0};break;case 1:b={r:g,g:a,b:0};break;case 2:b={r:0,g:a,b:g};break;case 3:b={r:0,g:g,b:a};break;case 4:b={r:g,g:0,b:a};break;case 5:case 6:b={r:a,g:0,b:g};break;default:b={r:0,g:0,b:0}}b.r=Math.round(b.r+c-a);b.g=Math.round(b.g+c-a);b.b=Math.round(b.b+
c-a);return b}}Object.defineProperty(q,"__esModule",{value:!0});var a=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],g=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];q.toRGB=b;q.toHSV=function(a){if("h"in a&&"s"in a&&"v"in a)return a;var c=b(a);a=c.r;var g=c.g,c=c.b,m=Math.max(a,g,c),f=m-Math.min(a,g,c),h;0===f?h=0:m===a?h=(g-c)/f%6:m===g?h=(c-a)/f+2:m===c&&(h=(a-g)/f+4);0>h&&(h+=6);return{h:60*h,s:100*(0===f?0:f/m),v:100/255*m}};q.toLAB=function(a){return"l"in
a&&"a"in a&&"b"in a?a:k(r(b(a)))};q.toLCH=function(a){if(!("l"in a&&"c"in a&&"h"in a)){var c=k(r(b(a)));a=c.l;var g=c.a,m=c.b,c=Math.sqrt(g*g+m*m),g=Math.atan2(m,g),g=0<g?g:g+2*Math.PI;a={l:a,c:c,h:g}}return a};q.toXYZ=function(a){return"x"in a&&"y"in a&&"z"in a?a:r(b(a))};q.darken=function(a,c){a=k(r(a));a.l*=1-c;return d(l(a))}})},"esri/renderers/RasterShadedReliefRenderer":function(){define("require exports tslib ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ../tasks/support/colorRamps".split(" "),
function(D,q,e,r,d,k,l){return function(b){function a(a){a=b.call(this,a)||this;a.altitude=45;a.azimuth=315;a.colorRamp=null;a.hillshadeType="multi-directional";a.pixelSizePower=.664;a.pixelSizeFactor=.024;a.scalingType="none";a.type="raster-shaded-relief";a.zFactor=1;return a}e.__extends(a,b);g=a;a.prototype.readColorRamp=function(a){return l.fromJSON(a)};a.prototype.clone=function(){return new g({hillshadeType:this.hillshadeType,altitude:this.altitude,azimuth:this.azimuth,zFactor:this.zFactor,scalingType:this.scalingType,
pixelSizeFactor:this.pixelSizeFactor,pixelSizePower:this.pixelSizePower,colorRamp:d.clone(this.colorRamp)})};var g;e.__decorate([k.property({type:Number,json:{write:!0}})],a.prototype,"altitude",void 0);e.__decorate([k.property({type:Number,json:{write:!0}})],a.prototype,"azimuth",void 0);e.__decorate([k.property({types:l.types,json:{write:!0}})],a.prototype,"colorRamp",void 0);e.__decorate([k.reader("colorRamp")],a.prototype,"readColorRamp",null);e.__decorate([k.property({type:["traditional","multi-directional"],
json:{write:!0}})],a.prototype,"hillshadeType",void 0);e.__decorate([k.property({type:Number,json:{write:!0}})],a.prototype,"pixelSizePower",void 0);e.__decorate([k.property({type:Number,json:{write:!0}})],a.prototype,"pixelSizeFactor",void 0);e.__decorate([k.property({type:["none","adjusted"],json:{write:!0}})],a.prototype,"scalingType",void 0);e.__decorate([k.enumeration({rasterShadedRelief:"raster-shaded-relief"})],a.prototype,"type",void 0);e.__decorate([k.property({type:Number,json:{write:!0}})],
a.prototype,"zFactor",void 0);return a=g=e.__decorate([k.subclass("esri.renderers.RasterShadedReliefRenderer")],a)}(r.JSONSupport)})},"esri/renderers/RasterStretchRenderer":function(){define("require exports tslib ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./support/stretchRendererUtils ../tasks/support/colorRamps".split(" "),function(D,q,e,r,d,k,l,b){return function(a){function g(c){c=a.call(this,c)||this;c.colorRamp=null;c.computeGamma=!1;c.dynamicRangeAdjustment=!1;c.gamma=
[];c.maxPercent=null;c.minPercent=null;c.numberOfStandardDeviations=null;c.outputMax=null;c.outputMin=null;c.sigmoidStrengthLevel=null;c.statistics=[];c.histograms=null;c.useGamma=!1;c.stretchType="none";c.type="raster-stretch";return c}e.__extends(g,a);m=g;g.prototype.readColorRamp=function(a){if(a)return b.fromJSON(a)};g.prototype.writeStatistics=function(a,b,g){null==a||0===a.length?a=null:a[0]instanceof Array||(a=a.map(function(a){return[a.min,a.max,a.avg,a.stddev]}));b[g]=a};g.prototype.readStretchType=
function(a,b){a=b.stretchType;"number"===typeof a&&(a=l.stretchTypeFunctionEnum[a]);return l.stretchTypeJSONDict.read(a)};g.prototype.clone=function(){return new m({stretchType:this.stretchType,outputMin:this.outputMin,outputMax:this.outputMax,useGamma:this.useGamma,computeGamma:this.computeGamma,statistics:d.clone(this.statistics),gamma:d.clone(this.gamma),sigmoidStrengthLevel:this.sigmoidStrengthLevel,numberOfStandardDeviations:this.numberOfStandardDeviations,minPercent:this.minPercent,maxPercent:this.maxPercent,
colorRamp:d.clone(this.colorRamp),histograms:d.clone(this.histograms),dynamicRangeAdjustment:this.dynamicRangeAdjustment})};var m;e.__decorate([k.property({types:b.types,json:{write:!0}})],g.prototype,"colorRamp",void 0);e.__decorate([k.reader("colorRamp")],g.prototype,"readColorRamp",null);e.__decorate([k.property({type:Boolean,json:{write:!0}})],g.prototype,"computeGamma",void 0);e.__decorate([k.property({type:Boolean,json:{write:{target:"dra"},read:{source:"dra"}}})],g.prototype,"dynamicRangeAdjustment",
void 0);e.__decorate([k.property({type:[Number],json:{write:{allowNull:!0}}})],g.prototype,"gamma",void 0);e.__decorate([k.property({type:Number,json:{write:{allowNull:!0}}})],g.prototype,"maxPercent",void 0);e.__decorate([k.property({type:Number,json:{write:{allowNull:!0}}})],g.prototype,"minPercent",void 0);e.__decorate([k.property({type:Number,json:{write:{allowNull:!0}}})],g.prototype,"numberOfStandardDeviations",void 0);e.__decorate([k.property({type:Number,json:{read:{source:"max"},write:{target:"max",
allowNull:!0}}})],g.prototype,"outputMax",void 0);e.__decorate([k.property({type:Number,json:{read:{source:"min"},write:{target:"min",allowNull:!0}}})],g.prototype,"outputMin",void 0);e.__decorate([k.property({type:Number,json:{write:{allowNull:!0}}})],g.prototype,"sigmoidStrengthLevel",void 0);e.__decorate([k.property({json:{write:{allowNull:!0}}})],g.prototype,"statistics",void 0);e.__decorate([k.property()],g.prototype,"histograms",void 0);e.__decorate([k.writer("statistics")],g.prototype,"writeStatistics",
null);e.__decorate([k.property({type:Boolean,json:{write:!0}})],g.prototype,"useGamma",void 0);e.__decorate([k.property({type:l.stretchTypeJSONDict.apiValues,json:{type:l.stretchTypeJSONDict.jsonValues,write:l.stretchTypeJSONDict.write}})],g.prototype,"stretchType",void 0);e.__decorate([k.reader("stretchType",["stretchType"])],g.prototype,"readStretchType",null);e.__decorate([k.enumeration({rasterStretch:"raster-stretch"})],g.prototype,"type",void 0);return g=m=e.__decorate([k.subclass("esri.renderers.RasterStretchRenderer")],
g)}(r.JSONSupport)})},"esri/renderers/support/stretchRendererUtils":function(){define(["require","exports","../../core/jsonMap"],function(D,q,e){Object.defineProperty(q,"__esModule",{value:!0});q.stretchTypeJSONDict=new e.default({none:"none",standardDeviation:"standard-deviation",histogramEqualization:"histogram-equalization",minMax:"min-max",percentClip:"percent-clip",sigmoid:"sigmoid"});q.stretchTypeFunctionEnum={0:"none",3:"standardDeviation",4:"histogramEqualization",5:"minMax",6:"percentClip",
9:"sigmoid"}})},"esri/layers/support/DimensionalDefinition":function(){define("require exports tslib ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),function(D,q,e,r,d,k,l){return function(b){function a(a){a=b.call(this,a)||this;a.variableName=null;a.dimensionName=null;a.values=[];a.isSlice=!1;return a}e.__extends(a,b);g=a;a.prototype.clone=function(){return new g({variableName:this.variableName,dimensionName:this.dimensionName,
values:d.clone(this.values),isSlice:this.isSlice})};var g;e.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"variableName",void 0);e.__decorate([k.property({type:String,json:{write:!0}})],a.prototype,"dimensionName",void 0);e.__decorate([k.property({type:l.types.array(l.types.oneOf([l.types.native(Number),l.types.array(l.types.native(Number))])),json:{write:!0}})],a.prototype,"values",void 0);e.__decorate([k.property({type:Boolean,json:{write:!0}})],a.prototype,"isSlice",void 0);
return a=g=e.__decorate([k.subclass("esri.layers.support.DimensionalDefinition")],a)}(r.JSONSupport)})},"esri/layers/support/ExportImageServiceParameters":function(){define("require exports tslib ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators ./imageryRendererUtils ./MosaicRule".split(" "),function(D,q,e,r,d,k,l,b){Object.defineProperty(q,"__esModule",{value:!0});var a=new r.default({RSP_NearestNeighbor:"nearest",RSP_BilinearInterpolation:"bilinear",RSP_CubicConvolution:"cubic",
RSP_Majority:"majority"}),g=new r.default({esriNoDataMatchAny:"any",esriNoDataMatchAll:"all"});D=function(m){function c(){var a=null!==m&&m.apply(this,arguments)||this;a.layer=null;a.adjustAspectRatio=void 0;a.bandIds=void 0;a.compression=void 0;a.compressionQuality=void 0;a.compressionTolerance=.01;a.format=null;a.interpolation=null;a.noData=null;a.noDataInterpretation=void 0;a.pixelType=void 0;a.lercVersion=2;return a}e.__extends(c,m);c.prototype.writeAdjustAspectRatio=function(a,b,c){10.3>this.layer.version||
(b[c]=a)};c.prototype.writeCompressionQuality=function(a,b,c){this.format&&-1<this.format.toLowerCase().indexOf("jpg")&&null!=a&&(b[c]=a)};c.prototype.writeCompressionTolerance=function(a,b,c){"lerc"===this.format&&null!=a&&(b[c]=a)};c.prototype.writeLercVersion=function(a,b,c){"lerc"===this.format&&10.5<=this.layer.version&&(b[c]=a)};Object.defineProperty(c.prototype,"version",{get:function(){var a=this.layer;a.bandIds;a.format;a.compressionQuality;a.compressionTolerance;a.interpolation;a.noData;
a.noDataInterpretation;a.mosaicRule;a.renderingRule;a.adjustAspectRatio;a.pixelFilter;a.renderer;a.definitionExpression;return(this._get("version")||0)+1},set:function(a){this._set("version",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"mosaicRule",{get:function(){var a=this.layer,c=a.mosaicRule,a=a.definitionExpression;c?a&&a!==c.where&&(c=c.clone(),c.where=a):a&&(c=new b({where:a}));return c},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderingRule",
{get:function(){var a=this.layer,b=a.renderingRule,c=a.pixelFilter;(!a.format||-1<a.format.indexOf("jpg")||-1<a.format.indexOf("png"))&&!c&&(b=this.combineRendererWithRenderingRule());return b},enumerable:!0,configurable:!0});c.prototype.combineRendererWithRenderingRule=function(){var a=this.layer,b=a.rasterInfo,c=a.renderingRule,g=a.renderer;return g&&l.isSupportedRendererType(g)?l.combineRenderingRules(l.convertRendererToRenderingRule(g,{rasterAttributeTable:b.attributeTable,pixelType:b.pixelType,
convertColorRampToColormap:10.6>a.version,dataType:b.dataType}),c):c};e.__decorate([k.property()],c.prototype,"layer",void 0);e.__decorate([k.property({json:{write:!0}})],c.prototype,"adjustAspectRatio",void 0);e.__decorate([k.writer("adjustAspectRatio")],c.prototype,"writeAdjustAspectRatio",null);e.__decorate([k.property({json:{write:!0}}),k.aliasOf("layer.bandIds")],c.prototype,"bandIds",void 0);e.__decorate([k.property({json:{write:!0}})],c.prototype,"compression",void 0);e.__decorate([k.property({json:{write:!0}}),
k.aliasOf("layer.compressionQuality")],c.prototype,"compressionQuality",void 0);e.__decorate([k.writer("compressionQuality")],c.prototype,"writeCompressionQuality",null);e.__decorate([k.property({json:{write:!0}}),k.aliasOf("layer.compressionTolerance")],c.prototype,"compressionTolerance",void 0);e.__decorate([k.writer("compressionTolerance")],c.prototype,"writeCompressionTolerance",null);e.__decorate([k.property({json:{write:!0}}),k.aliasOf("layer.format")],c.prototype,"format",void 0);e.__decorate([k.property({type:String,
json:{read:{reader:a.read},write:{writer:a.write}}}),k.aliasOf("layer.interpolation")],c.prototype,"interpolation",void 0);e.__decorate([k.property({json:{write:!0}}),k.aliasOf("layer.noData")],c.prototype,"noData",void 0);e.__decorate([k.property({type:String,json:{read:{reader:g.read},write:{writer:g.write}}}),k.aliasOf("layer.noDataInterpretation")],c.prototype,"noDataInterpretation",void 0);e.__decorate([k.property({json:{write:!0}})],c.prototype,"pixelType",void 0);e.__decorate([k.property({json:{write:!0}})],
c.prototype,"lercVersion",void 0);e.__decorate([k.writer("lercVersion")],c.prototype,"writeLercVersion",null);e.__decorate([k.property({type:Number,dependsOn:"layer.adjustAspectRatio layer.bandIds layer.format layer.compressionQuality layer.compressionTolerance layer.definitionExpression layer.interpolation layer.noData layer.noDataInterpretation layer.mosaicRule layer.renderingRule layer.pixelFilter layer.renderer lercVersion pixelType".split(" ")})],c.prototype,"version",null);e.__decorate([k.property({dependsOn:["layer.mosaicRule",
"layer.definitionExpression"],json:{write:!0}})],c.prototype,"mosaicRule",null);e.__decorate([k.property({dependsOn:["layer.renderingRule","layer.renderer","layer.rasterInfo","layer.format"],json:{write:!0}})],c.prototype,"renderingRule",null);return c=e.__decorate([k.subclass("esri.layers.mixins.ExportImageServiceParameters")],c)}(d.JSONSupport);q.ExportImageServiceParameters=D})},"esri/layers/support/imageryRendererUtils":function(){define("require exports ../../rasterRenderers ../../core/arrayUtils ../../core/lang ./RasterFunction ../../renderers/support/colorRampUtils ../../renderers/support/stretchRendererUtils ../../tasks/support/MultipartColorRamp".split(" "),
function(D,q,e,r,d,k,l,b,a){function g(a){var b=a.Raster;return b&&"esri.layers.support.RasterFunction"===b.declaredClass?g(b.functionArguments):a}function m(a,b){var f=[],g=[],h=[],m=[],d=b.pixelType,n=(b=b.rasterAttributeTable)&&b.features,v=t(b);if(n&&Array.isArray(n)&&a.classBreakInfos)return a.classBreakInfos.forEach(function(b,c){var f=b.symbol.color,g;f.a&&n.forEach(function(h){g=h.attributes[a.field];(g>=b.minValue&&g<b.maxValue||c===a.classBreakInfos.length-1&&g>=b.minValue)&&m.push([h.attributes[v],
f.r,f.g,f.b])})}),d=d?c(m,d):m,b=new k,b.functionName="Colormap",b.functionArguments={},b.functionArguments.Colormap=d,b.variableName="Raster",b;a.classBreakInfos.forEach(function(a,b){var c=a.symbol&&a.symbol.color;c.a?(0===b?f.push(a.minValue,a.maxValue+1E-6):f.push(a.minValue+1E-6,a.maxValue+1E-6),g.push(b),m.push([b,c.r,c.g,c.b])):h.push(a.minValue,a.maxValue)});d=d?c(m,d):m;b=new k;b.functionName="Remap";b.functionArguments={InputRanges:f,OutputValues:g,NoDataRanges:h};b.variableName="Raster";
var p=new k;p.functionName="Colormap";p.functionArguments={Colormap:d,Raster:b};return p}function c(a,b){(b=h[String(b).toLowerCase()])&&a.push([Math.floor(b[0]-1),0,0,0],[Math.ceil(b[1]+1),0,0,0]);return a}function t(a){if(a)return(a=(a=a.fields)&&r.find(a,function(a){return a&&a.name&&"value"===a.name.toLowerCase()}))&&a.name}function B(a,b){var f=[],g=b.pixelType,h=(b=b.rasterAttributeTable)&&b.features,m=t(b),d=!1;a.uniqueValueInfos&&a.uniqueValueInfos.forEach(function(b){var c=b.symbol.color;
c.a&&(a.field!==m&&h?h&&h.forEach(function(g){String(g.attributes[a.field])===String(b.value)&&f.push([g.attributes[m],c.r,c.g,c.b])}):isNaN(b.value)?d=!0:f.push([b.value,c.r,c.g,c.b]))});if(d)return null;g=g&&0<f.length?c(f,g):f;b=new k;b.functionName="Colormap";b.functionArguments={};b.functionArguments.Colormap=g;b.variableName="Raster";return b}function f(a){var b=[];a.forEach(function(a){Array.isArray(a)?b.push(a):null!=a.min&&null!=a.max&&b.push([a.min,a.max,a.avg||0,a.stddev||0])});return b}
Object.defineProperty(q,"__esModule",{value:!0});var h={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767]},n={type:"multipart",colorRamps:[{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},p=a.fromJSON(l.PREDEFINED_JSON_COLOR_RAMPS[0]);q.isSupportedRendererType=function(a){return-1<["raster-stretch","unique-value","class-breaks","raster-shaded-relief"].indexOf(a.type)};q.combineRenderingRules=
function(a,b){if(!a||!b)return d.clone(a||b);a=d.clone(a);"none"!==b.functionName.toLowerCase()&&(g(a.functionArguments).Raster=b);return a};q.convertRendererToRenderingRule=function(a,g){g=g||{};switch(a.type){case "raster-stretch":var h=new k;h.functionName="Stretch";var d=A[b.stretchTypeJSONDict.toJSON(a.stretchType)],n=f(a.statistics),n={StretchType:d,Statistics:n,DRA:a.dynamicRangeAdjustment,UseGamma:a.useGamma,Gamma:a.gamma,ComputeGamma:a.computeGamma};null!=a.outputMin&&(n.Min=a.outputMin);
null!=a.outputMax&&(n.Max=a.outputMax);d===A.standardDeviation?(n.NumberOfStandardDeviations=a.numberOfStandardDeviations,h.outputPixelType="u8"):d===A.percentClip?(n.MinPercent=a.minPercent,n.MaxPercent=a.maxPercent,h.outputPixelType="u8"):d===A.minMax?h.outputPixelType="u8":d===A.sigmoid&&(n.SigmoidStrengthLevel=a.sigmoidStrengthLevel);h.functionArguments=n;h.variableName="Raster";if(a.colorRamp){var d=a.colorRamp,n=new k,p=l.getColorRampName(d);n.functionArguments=p?{colorRamp:p}:!g.convertColorRampToColormap||
"algorithmic"!==d.type&&"multipart"!==d.type?{colorRamp:a.colorRamp.toJSON()}:{Colormap:l.convertColorRampToColormap(d,256)};n.variableName="Raster";n.functionName="Colormap";n.functionArguments.Raster=h;a=n}else a=h;return a;case "class-breaks":return m(a,g);case "unique-value":return B(a,g);case "raster-colormap":return(a=a.extractColormap())&&0!==a.length?(a=(g=g.pixelType)?c(a,g):a,g=new k,g.functionName="Colormap",g.functionArguments={},g.functionArguments.Colormap=a,a=g):a=void 0,a;case "raster-shaded-relief":return"elevation"!==
g.dataType?a=new k:(g=new k,g.functionName="Hillshade",h="traditional"===a.hillshadeType?0:1,d="none"===a.scalingType?1:3,n={HillshadeType:h,SlopeType:d,ZFactor:a.zFactor},0===h&&(n.Azimuth=a.azimuth,n.Altitude=a.altitude),3===d&&(n.PSPower=a.pixelSizePower,n.PSZFactor=a.pixelSizeFactor),g.functionArguments=n,g.variableName="Raster",a.colorRamp&&(g.functionName="ShadedRelief",n.Colormap=l.convertColorRampToColormap(a.colorRamp,256)),a=g),a}};q.createDefaultRenderer=function(a,b){if(a){var c=a.attributeTable,
f=a.dataType,g=a.bandCount,h=a.pixelType,d=a.colormap,m=a.statistics,t=a.histograms;b&&0<b.length&&(m=m?b.map(function(a){return m[a]}):null,t=t?b.map(function(a){return t[a]}):null);var B,A,v,u,k,r;c&&(A=c.fields.filter(function(a){return"red"===a.name.toLowerCase()})[0],v=c.fields.filter(function(a){return"green"===a.name.toLowerCase()})[0],u=c.fields.filter(function(a){return"blue"===a.name.toLowerCase()})[0],r=c.fields.filter(function(a){return"value"===a.name.toLowerCase()})[0],k=c.fields.filter(function(a){return"classname"===
a.name.toLowerCase()||"class_name"===a.name.toLowerCase()})[0],k||(k=c.fields.filter(function(a){return"string"===a.type})[0])||(k=r));if(1===g&&0<(null===d||void 0===d?void 0:d.length)){var q;c&&A&&v&&u&&(q={},c.features.forEach(function(a){a=a.attributes;q[a[r.name]]=k?a[k.name]:a[r.name]}));B=e.RasterColormapRenderer.createFromColormap(d,q)}else if(1===g&&c){a=void 0;c=c.features;if(A&&v&&u&&k)a=c.map(function(a){return{value:a.attributes[k.name],label:a.attributes[k.name],symbol:{type:"esriSFS",
style:"esriSFSSolid",color:[a.attributes[A.name],a.attributes[v.name],a.attributes[u.name],255]}}});else{var R=l.convertColorRampToColormap(p,c.length);a=c.map(function(a,b){return{value:a.attributes[r.name],label:a.attributes[r.name],symbol:{color:R[b].slice(1,4),type:"esriSFS",style:"esriSFSSolid"}}})}a.sort(function(a,b){return a.value>b.value?1:-1});B=e.UniqueValueRenderer.fromJSON({field1:k.name,uniqueValueInfos:a})}B||(c=void 0,a=!1,B=d=b=void 0,"u8"===h&&"processed"===f?(c="none",m=1===g?[{min:0,
max:255}]:[{min:0,max:255},{min:0,max:255},{min:0,max:255}]):"u8"===h||"elevation"===f?(c="min-max",a=m?!1:!0):"scientific"===f?(c="min-max",a=m?!1:!0,b=n):t&&0<t.length?(c="percent-clip",B=d=.25):m?c="min-max":(c="percent-clip",a=!0),B=e.RasterStretchRenderer.fromJSON({stretchType:c,dra:a,colorRamp:b,min:0,max:255,statistics:a?null:m,histograms:a?null:t,maxPercent:d,minPercent:B}));return B}};q.getDefaultBandCombination=function(a){var b=a.bandCount;if(1===b)return null;if(2===b)return[0];a=a.keyProperties&&
a.keyProperties.BandProperties;var c,f,g,h,d;if(a&&a.length===b){for(var m=0;m<a.length;m++)a[m].BandName&&"red"===a[m].BandName.toLowerCase()&&(f=m),a[m].BandName&&"green"===a[m].BandName.toLowerCase()&&(g=m),a[m].BandName&&"blue"===a[m].BandName.toLowerCase()&&(h=m),a[m].BandName&&"nearinfrared"===a[m].BandName.toLowerCase()&&(d=m);void 0!==f&&void 0!==g&&void 0!==h?c=[f,g,h]:void 0!==f&&void 0!==g&&void 0!==d&&(c=[d,f,g])}!c&&3<b&&(c=[0,1,2]);return c};var A={none:0,standardDeviation:3,histogramEqualization:4,
minMax:5,percentClip:6,sigmoid:9}})},"esri/layers/support/RasterFunction":function(){define("require exports tslib ../../core/JSONSupport ../../core/lang ../../core/SetUtils ../../core/accessorSupport/decorators".split(" "),function(D,q,e,r,d,k,l){var b=k.SetFromValues(["Raster","Raster2","DEM","FillRaster"]),a=k.SetFromValues(["Rasters"]),g=function(a){return a&&a.rasterFunction?t.fromJSON(a):a},m=function(a){return a&&a instanceof t?a.toJSON():a},c;(function(a){a[a.MOSAIC=0]="MOSAIC";a[a.GROUP=
1]="GROUP";a[a.ITEM=2]="ITEM"})(c||(c={}));var t=function(t){function f(a){a=t.call(this,a)||this;a.functionArguments=null;a.functionName=null;a.outputPixelType="unknown";a.variableName=null;a.description=null;a.functionDefinition=null;a.thumbnail=null;return a}e.__extends(f,t);h=f;f.prototype.readFunctionArguments=function(c,f){c=f.arguments||f.rasterFunctionArguments;if(null==c)c=null;else{f={};for(var h=0,m=Object.keys(c);h<m.length;h++){var d=m[h];b.has(d)?f[d]=g(c[d]):a.has(d)&&Array.isArray(c[d])?
f[d]=c[d].map(g):f[d]=c[d]}c=f}return c};f.prototype.writeFunctionArguments=function(c,f,g){for(var h={},d=0,n=Object.keys(c);d<n.length;d++){var p=n[d];b.has(p)?h[p]=m(c[p]):a.has(p)&&Array.isArray(c[p])?h[p]=c[p].map(m):h[p]=m(c[p])}this.functionDefinition?f.arguments=h:f[g]=h};f.prototype.readFunctionName=function(a,b){a=b.rasterFunctionInfos;var c=b.name;return c?c:a&&a.length&&"None"!==a[0].name?a[0].name:b.rasterFunction};f.prototype.writeFunctionName=function(a,b,c){this.functionDefinition?
b.name=a:b[c]=a};f.prototype.readFunctionType=function(a){return c[a]};f.prototype.writeFunctionType=function(a,b,f){b[f]=c[a]};f.prototype.clone=function(){return new h({functionName:this.functionName,functionArguments:d.clone(this.functionArguments),outputPixelType:this.outputPixelType,variableName:this.variableName,name:this.functionName,description:this.description,functionType:this.functionType,functionDefinition:this.functionDefinition,thumbnail:this.thumbnail})};var h;e.__decorate([l.property({json:{type:Object,
write:{target:"rasterFunctionArguments"}}})],f.prototype,"functionArguments",void 0);e.__decorate([l.reader("functionArguments",["rasterFunctionArguments","arguments"])],f.prototype,"readFunctionArguments",null);e.__decorate([l.writer("functionArguments")],f.prototype,"writeFunctionArguments",null);e.__decorate([l.property({json:{type:String,write:{target:"rasterFunction"}}})],f.prototype,"functionName",void 0);e.__decorate([l.reader("functionName",["rasterFunction","rasterFunctionInfos","name"])],
f.prototype,"readFunctionName",null);e.__decorate([l.writer("functionName")],f.prototype,"writeFunctionName",null);e.__decorate([l.enumeration({C128:"c128",C64:"c64",F32:"f32",F64:"f64",S16:"s16",S32:"s32",S8:"s8",U1:"u1",U16:"u16",U2:"u2",U32:"u32",U4:"u4",U8:"u8",UNKNOWN:"unknown"},{ignoreUnknown:!1}),l.property({json:{default:"unknown"}})],f.prototype,"outputPixelType",void 0);e.__decorate([l.property({type:String,json:{read:!0,write:!0}})],f.prototype,"variableName",void 0);e.__decorate([l.property({type:String,
json:{read:!0,write:!0,origins:{"web-document":{read:!1,write:!1}}}})],f.prototype,"description",void 0);e.__decorate([l.property({json:{origins:{"web-document":{read:!1,write:!1}}}})],f.prototype,"functionType",void 0);e.__decorate([l.reader("functionType")],f.prototype,"readFunctionType",null);e.__decorate([l.writer("functionType")],f.prototype,"writeFunctionType",null);e.__decorate([l.property({type:Object,json:{read:{source:"function"},write:{target:"function"},origins:{"web-document":{read:!1,
write:!1}}}})],f.prototype,"functionDefinition",void 0);e.__decorate([l.property({type:String,json:{read:!0,write:!0,origins:{"web-document":{read:!1,write:!1}}}})],f.prototype,"thumbnail",void 0);return f=h=e.__decorate([l.subclass("esri.layers.support.RasterFunction")],f)}(r.JSONSupport);return t})},"esri/layers/support/MosaicRule":function(){define("require exports tslib ../../core/jsonMap ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../geometry/Point ./DimensionalDefinition ./RasterFunction".split(" "),
function(D,q,e,r,d,k,l,b,a,g){var m=r.strict()({MT_FIRST:"first",MT_LAST:"last",MT_MIN:"min",MT_MAX:"max",MT_MEAN:"mean",MT_BLEND:"blend",MT_SUM:"sum"}),c=r.strict()({esriMosaicNone:"none",esriMosaicCenter:"center",esriMosaicNadir:"nadir",esriMosaicViewpoint:"viewpoint",esriMosaicAttribute:"attribute",esriMosaicLockRaster:"lock-raster",esriMosaicNorthwest:"northwest",esriMosaicSeamline:"seamline"});return function(d){function t(a){a=d.call(this,a)||this;a.ascending=!0;a.itemRenderingRule=null;a.lockRasterIds=
null;a.method=null;a.multidimensionalDefinition=null;a.objectIds=null;a.operation=null;a.sortField=null;a.sortValue=null;a.viewpoint=null;a.where=null;return a}e.__extends(t,d);f=t;t.prototype.readAscending=function(a,b){return null!=b.ascending?b.ascending:null!=b.sortAscending?b.sortAscending:!0};t.prototype.readMethod=function(a,b){a=b.mosaicMethod||b.defaultMosaicMethod;switch(a?a.toLowerCase().replace("esrimosaic",""):""){case "byattribute":case "attribute":a="esriMosaicAttribute";break;case "lockraster":a=
"esriMosaicLockRaster";break;case "center":a="esriMosaicCenter";break;case "northwest":a="esriMosaicNorthwest";break;case "nadir":a="esriMosaicNadir";break;case "viewpoint":a="esriMosaicViewpoint";break;case "seamline":a="esriMosaicSeamline";break;case "none":a="esriMosaicNone";break;default:a="esriMosaicNone"}return c.fromJSON(a)};t.prototype.readOperation=function(a,b){a=b.mosaicOperation;b=b.mosaicOperator&&b.mosaicOperator.toLowerCase();b=a||(b?m.toJSON(b):null);return m.fromJSON(b)||"first"};
t.prototype.castSortValue=function(a){return null==a||"string"===typeof a||"number"===typeof a?a:""+a};t.prototype.clone=function(){return new f({ascending:this.ascending,itemRenderingRule:k.clone(this.itemRenderingRule),lockRasterIds:k.clone(this.lockRasterIds),method:this.method,multidimensionalDefinition:k.clone(this.multidimensionalDefinition),objectIds:k.clone(this.objectIds),operation:this.operation,sortField:this.sortField,sortValue:this.sortValue,viewpoint:k.clone(this.viewpoint),where:this.where})};
var f;e.__decorate([l.property({type:Boolean,json:{write:!0}})],t.prototype,"ascending",void 0);e.__decorate([l.reader("ascending",["ascending","sortAscending"])],t.prototype,"readAscending",null);e.__decorate([l.property({type:g,json:{write:!0}})],t.prototype,"itemRenderingRule",void 0);e.__decorate([l.property({type:[Number],json:{write:{overridePolicy:function(){return{enabled:"lock-raster"===this.method}}}}})],t.prototype,"lockRasterIds",void 0);e.__decorate([l.property({type:String,json:{type:c.jsonValues,
write:{target:"mosaicMethod",writer:c.write}}})],t.prototype,"method",void 0);e.__decorate([l.reader("method",["mosaicMethod","defaultMosaicMethod"])],t.prototype,"readMethod",null);e.__decorate([l.property({type:[a],json:{write:!0}})],t.prototype,"multidimensionalDefinition",void 0);e.__decorate([l.property({type:[Number],json:{read:{source:"fids"},write:{target:"fids"}}})],t.prototype,"objectIds",void 0);e.__decorate([l.property({json:{type:m.jsonValues,read:{reader:m.read},write:{target:"mosaicOperation",
writer:m.write}}})],t.prototype,"operation",void 0);e.__decorate([l.reader("operation",["mosaicOperation","mosaicOperator"])],t.prototype,"readOperation",null);e.__decorate([l.property({type:String,json:{write:{overridePolicy:function(){return{enabled:"attribute"===this.method}}}}})],t.prototype,"sortField",void 0);e.__decorate([l.property({type:[String,Number],json:{write:{allowNull:!0,overridePolicy:function(){return{enabled:"attribute"===this.method,allowNull:!0}}}}})],t.prototype,"sortValue",
void 0);e.__decorate([l.cast("sortValue")],t.prototype,"castSortValue",null);e.__decorate([l.property({type:b,json:{write:!0}})],t.prototype,"viewpoint",void 0);e.__decorate([l.property({type:String,json:{write:!0}})],t.prototype,"where",void 0);return t=f=e.__decorate([l.subclass("esri.layers.support.MosaicRule")],t)}(d.JSONSupport)})},"esri/layers/support/PixelBlock":function(){define("require exports tslib ../../core/compilerUtils ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/maybe ../../core/accessorSupport/decorators".split(" "),
function(D,q,e,r,d,k,l,b,a,g){var m=b.getLogger("esri.layers.support.PixelBlock");return function(b){function c(a){a=b.call(this,a)||this;a.width=null;a.height=null;a.pixelType="f32";a.validPixelCount=null;a.mask=null;a.maskIsAlpha=!1;a.pixels=null;a.statistics=null;return a}e.__extends(c,b);B=c;c.createEmptyBand=function(a,b){return new (B.getPixelArrayConstructor(a))(b)};c.getPixelArrayConstructor=function(a){var b;switch(a){case "u1":case "u2":case "u4":case "u8":b=Uint8Array;break;case "u16":b=
Uint16Array;break;case "u32":b=Uint32Array;break;case "s8":b=Int8Array;break;case "s16":b=Int16Array;break;case "s32":b=Int32Array;break;case "u32":b=Uint32Array;break;case "f32":b=Float32Array;break;case "f64":b=Float64Array;break;case "c64":case "c128":case "unknown":b=Float32Array;break;default:r.neverReached(a)}return b};c.prototype.castPixelType=function(a){if(!a)return"f32";a=a.toLowerCase();-1<["u1","u2","u4"].indexOf(a)?a="u8":-1==="unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").indexOf(a)&&
(a="f32");return a};c.prototype.getPlaneCount=function(){return this.pixels&&this.pixels.length};c.prototype.addData=function(a){if(!a.pixels||a.pixels.length!==this.width*this.height)throw new d("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(a.pixels);this.statistics.push(a.statistics||{minValue:null,maxValue:null})};c.prototype.getAsRGBA=
function(){var a=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(a);break;default:this._fillFrom8Bit(a)}return new Uint8ClampedArray(a)};c.prototype.getAsRGBAFloat=function(){var a=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(a);return a};c.prototype.updateStatistics=function(){var a=this;this.statistics=this.pixels.map(function(b){return a._calculateBandStatistics(b,
a.mask)});var b=this.mask,c=0;if(b)for(var g=0;g<b.length;g++)b[g]&&c++;else c=this.width*this.height;this.validPixelCount=c};c.prototype.clamp=function(a){if(a&&"f64"!==a&&"f32"!==a){var b;switch(a){case "u8":b=[0,255];break;case "u16":b=[0,65535];break;case "u32":b=[0,4294967295];break;case "s8":b=[-128,127];break;case "s16":b=[-32768,32767];break;case "s32":b=[-2147483648,2147483647];break;default:b=[-3.4*1E39,3.4*1E39]}var c=b[0];b=b[1];for(var g=this.pixels,f=this.width*this.height,d=g.length,
m,l,t,w=[],e=0;e<d;e++){t=B.createEmptyBand(a,f);m=g[e];for(var k=0;k<f;k++)l=m[k],t[k]=l>b?b:l<c?c:l;w.push(t)}this.pixels=w;this.pixelType=a}};c.prototype.extractBands=function(b){var c=this;if(a.isNone(b)||0===b.length||null==this.pixels||0===this.pixels.length)return this;var g=this.pixels.length,f=b.some(function(a){return a>=c.pixels.length}),g=g===b.length&&!b.some(function(a,b){return a!==b});return f||g?this:new B({pixelType:this.pixelType,width:this.width,height:this.height,mask:this.mask,
validPixelCount:this.validPixelCount,maskIsAlpha:this.maskIsAlpha,pixels:b.map(function(a){return c.pixels[a]}),statistics:this.statistics&&b.map(function(a){return c.statistics[a]})})};c.prototype.clone=function(){var a=new B({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});this.mask&&(a.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));var b,c=B.getPixelArrayConstructor(this.pixelType);
if(this.pixels&&0<this.pixels.length){a.pixels=[];var g=this.pixels[0].slice;for(b=0;b<this.pixels.length;b++)a.pixels[b]=g?this.pixels[b].slice(0,this.pixels[b].length):new c(this.pixels[b])}if(this.statistics)for(a.statistics=[],b=0;b<this.statistics.length;b++)a.statistics[b]=l.clone(this.statistics[b]);return a};c.prototype._fillFrom8Bit=function(a){var b=this.mask,c=this.maskIsAlpha,g=this.pixels;if(a&&g&&g.length){var f,d,l;f=d=l=g[0];3<=g.length?(d=g[1],l=g[2]):2===g.length&&(d=g[1]);a=new Uint32Array(a);
g=this.width*this.height;if(f.length!==g)m.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(b&&b.length===g)if(c)for(c=0;c<g;c++)b[c]&&(a[c]=b[c]<<24|l[c]<<16|d[c]<<8|f[c]);else for(c=0;c<g;c++)b[c]&&(a[c]=-16777216|l[c]<<16|d[c]<<8|f[c]);else for(c=0;c<g;c++)a[c]=-16777216|l[c]<<16|d[c]<<8|f[c]}else m.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};c.prototype._fillFromNon8Bit=function(a){var b=this.pixels,c=this.mask,g=this.statistics;
if(a&&b&&b.length){var f=this.pixelType,d=1,l=0,d=1;g&&0<g.length?(l=g.map(function(a){return a.minValue}).reduce(function(a,b){return Math.min(a,b)}),d=g.map(function(a){return a.maxValue-a.minValue}).reduce(function(a,b){return Math.max(a,b)}),d=255/d):(d=255,"s8"===f?(l=-128,d=127):"u16"===f?d=65535:"s16"===f?(l=-32768,d=32767):"u32"===f?d=4294967295:"s32"===f?(l=-2147483648,d=2147483647):"f32"===f?(l=-3.4*1E39,d=3.4*1E39):"f64"===f&&(l=-Number.MAX_VALUE,d=Number.MAX_VALUE),d=255/(d-l));a=new Uint32Array(a);
var f=this.width*this.height,t,e,g=t=e=b[0];if(g.length!==f)return m.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=b.length)if(t=b[1],3<=b.length&&(e=b[2]),c&&c.length===f)for(b=0;b<f;b++)c[b]&&(a[b]=-16777216|(e[b]-l)*d<<16|(t[b]-l)*d<<8|(g[b]-l)*d);else for(b=0;b<f;b++)a[b]=-16777216|(e[b]-l)*d<<16|(t[b]-l)*d<<8|(g[b]-l)*d;else if(c&&c.length===f)for(b=0;b<f;b++)t=(g[b]-l)*d,c[b]&&(a[b]=-16777216|t<<16|t<<8|t);else for(b=0;b<f;b++)t=(g[b]-l)*d,a[b]=-16777216|
t<<16|t<<8|t}else m.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};c.prototype._fillFrom32Bit=function(a){var b=this.pixels,c=this.mask;if(!a||!b||!b.length)return m.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");var g,f,d;g=f=d=b[0];3<=b.length?(f=b[1],d=b[2]):2===b.length&&(f=b[1]);var l=this.width*this.height;if(g.length!==l)return m.error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");var t=
0;if(c&&c.length===l)for(b=0;b<l;b++)a[t++]=g[b],a[t++]=f[b],a[t++]=d[b],a[t++]=c[b]&1;else for(b=0;b<l;b++)a[t++]=g[b],a[t++]=f[b],a[t++]=d[b],a[t++]=1};c.prototype._calculateBandStatistics=function(a,b){var c=Infinity,g=-Infinity,f=a.length,d,m=0;if(b)for(d=0;d<f;d++)b[d]&&(m=a[d],c=m<c?m:c,g=m>g?m:g);else for(d=0;d<f;d++)m=a[d],c=m<c?m:c,g=m>g?m:g;return{minValue:c,maxValue:g}};var B;e.__decorate([g.property({json:{write:!0}})],c.prototype,"width",void 0);e.__decorate([g.property({json:{write:!0}})],
c.prototype,"height",void 0);e.__decorate([g.property({json:{write:!0}})],c.prototype,"pixelType",void 0);e.__decorate([g.cast("pixelType")],c.prototype,"castPixelType",null);e.__decorate([g.property({json:{write:!0}})],c.prototype,"validPixelCount",void 0);e.__decorate([g.property({json:{write:!0}})],c.prototype,"mask",void 0);e.__decorate([g.property({json:{write:!0}})],c.prototype,"maskIsAlpha",void 0);e.__decorate([g.property({json:{write:!0}})],c.prototype,"pixels",void 0);e.__decorate([g.property({json:{write:!0}})],
c.prototype,"statistics",void 0);return c=B=e.__decorate([g.subclass("esri.layers.support.PixelBlock")],c)}(k.JSONSupport)})},"esri/layers/support/RasterInfo":function(){define("require exports tslib ../../core/JSONSupport ../../core/accessorSupport/decorators ../../geometry/Extent ../../tasks/support/FeatureSet".split(" "),function(D,q,e,r,d,k,l){return function(b){function a(a){a=b.call(this,a)||this;a.attributeTable=null;a.bandCount=null;a.colormap=null;a.extent=null;a.format=void 0;a.height=null;
a.width=null;a.histograms=null;a.keyProperties=null;a.multidimensionalInfo=null;a.noDataValue=null;a.pixelSize=null;a.pixelType=null;a.spatialReference=null;a.statistics=null;a.storageInfo=null;return a}e.__extends(a,b);Object.defineProperty(a.prototype,"dataType",{get:function(){var a=this.keyProperties&&this.keyProperties.DataType;return a?a.toLowerCase():"generic"},enumerable:!0,configurable:!0});e.__decorate([d.property({type:l,json:{write:!0}})],a.prototype,"attributeTable",void 0);e.__decorate([d.property({json:{write:!0}})],
a.prototype,"bandCount",void 0);e.__decorate([d.property({json:{write:!0}})],a.prototype,"colormap",void 0);e.__decorate([d.property({type:String,readOnly:!0})],a.prototype,"dataType",null);e.__decorate([d.property({type:k,json:{write:!0}})],a.prototype,"extent",void 0);e.__decorate([d.property({json:{write:!0}})],a.prototype,"format",void 0);e.__decorate([d.property({json:{write:!0}})],a.prototype,"height",void 0);e.__decorate([d.property({json:{write:!0}})],a.prototype,"width",void 0);e.__decorate([d.property({json:{write:!0}})],
a.prototype,"histograms",void 0);e.__decorate([d.property({json:{write:!0}})],a.prototype,"keyProperties",void 0);e.__decorate([d.property({json:{write:!0}})],a.prototype,"multidimensionalInfo",void 0);e.__decorate([d.property()],a.prototype,"noDataValue",void 0);e.__decorate([d.property({json:{write:!0}})],a.prototype,"pixelSize",void 0);e.__decorate([d.property({json:{write:!0}})],a.prototype,"pixelType",void 0);e.__decorate([d.property({json:{write:!0}})],a.prototype,"spatialReference",void 0);
e.__decorate([d.property({json:{write:!0}})],a.prototype,"statistics",void 0);e.__decorate([d.property({json:{write:!0}})],a.prototype,"storageInfo",void 0);return a=e.__decorate([d.subclass("esri.layers.support.RasterInfo")],a)}(r.JSONSupport)})},"esri/layers/support/RasterJobHandler":function(){define("require exports tslib ../../core/Error ../../core/promiseUtils ../../core/workers ./PixelBlock".split(" "),function(D,q,e,r,d,k,l){return function(){function b(){this._workerThread=null;this._destroyed=
!1}b.prototype.initialize=function(){return e.__awaiter(this,void 0,void 0,function(){var a;return e.__generator(this,function(b){switch(b.label){case 0:return[4,k.open("RasterWorker")];case 1:return a=b.sent(),this._destroyed?a.close():this._workerThread=a,[2]}})})};b.prototype.destroy=function(){this._destroyed=!0;this._workerThread&&(this._workerThread.close(),this._workerThread=null)};b.prototype.decode=function(a,b){return e.__awaiter(this,void 0,void 0,function(){var g;return e.__generator(this,
function(c){switch(c.label){case 0:if(!this._workerThread)throw new r("raster-jobhandler:no-connection","no available worker connection");return[4,this._workerThread.invoke("decode",a,b)];case 1:return g=c.sent(),[2,g?new l(g):null]}})})};b.prototype.symbolize=function(a,b){return e.__awaiter(this,void 0,void 0,function(){var g,c;return e.__generator(this,function(d){switch(d.label){case 0:if(!this._workerThread)throw new r("raster-jobhandler:no-connection","no available worker connection");g={extent:a.extent&&
a.extent.toJSON(),pixelBlock:a.pixelBlock.toJSON(),simpleStretchParams:a.simpleStretchParams,bandIds:a.bandIds};return[4,this._workerThread.invoke("symbolize",g,b)];case 1:return c=d.sent(),[2,c?new l(c):null]}})})};b.prototype.updateSymbolizer=function(a,b){return e.__awaiter(this,void 0,void 0,function(){var g;return e.__generator(this,function(c){switch(c.label){case 0:if(!this._workerThread)throw new r("raster-jobhandler:no-connection","no available worker connection");g=a&&a.renderer&&"raster-stretch"===
a.renderer.type&&a.renderer.histograms;return[4,d.all(this._workerThread.broadcast("updateSymbolizer",{symbolizerJSON:a.toJSON(),histograms:g},b))];case 1:return c.sent(),[2]}})})};b.prototype.stretch=function(a,b){return e.__awaiter(this,void 0,void 0,function(){var g,c;return e.__generator(this,function(d){switch(d.label){case 0:if(!this._workerThread)throw new r("raster-jobhandler:no-connection","no available worker connection");if(!a||!a.pixelBlock)return[2,null];g={srcPixelBlock:a.pixelBlock.toJSON(),
stretchParams:a.stretchParams};return[4,this._workerThread.invoke("stretch",g,b)];case 1:return c=d.sent(),[2,c?new l(c):null]}})})};b.prototype.mosaicAndTransform=function(a,b){return e.__awaiter(this,void 0,void 0,function(){var g,c;return e.__generator(this,function(d){switch(d.label){case 0:if(!this._workerThread)throw new r("raster-jobhandler:no-connection","no available worker connection");if(!(a&&a.srcPixelBlocks&&0<a.srcPixelBlocks.length))return[2,null];g=e.__assign(e.__assign({},a),{srcPixelBlocks:a.srcPixelBlocks.map(function(a){return a?
a.toJSON():null})});return[4,this._workerThread.invoke("mosaicAndTransform",g,b)];case 1:return c=d.sent(),[2,c?new l(c):null]}})})};return b}()})},"esri/layers/support/rasterFormats/RasterCodec":function(){define("require exports tslib ../../../core/Error ../PixelBlock ./ImageCanvasDecoder ./JpgPlus ./Lerc2Codec ./LercCodec ./Png ./Raw ./TiffDecoder".split(" "),function(D,q,e,r,d,k,l,b,a,g,m,c){function t(b,c){if(!E)throw new r("rasterCoded:decode","lerc decoder is not supported on big endian platform");
var g=c.width,f=c.height,m=c.pixelType,h=u(m),l=h.pixelTypeCtor;c=null==c.noDataValue?h.noDataValue:c.noDataValue;for(var h=0,n,t=0,e,w=b.byteLength-10;t<w;){var p=a.decode(b,{inputOffset:t,encodedMaskData:n,returnMask:0===h?!0:!1,returnEncodedMask:0===h?!0:!1,returnFileInfo:!0,pixelType:l,noDataValue:c});if(g&&f&&(p.width!==g||p.height!==f))throw new r("rasterCoded:decode","lerc decoded result has width or height different from specified in options");t=p.fileInfo.eofOffset;0===h&&(n=p.encodedMaskData,
e=new d({width:p.width,height:p.height,pixels:[],pixelType:m,mask:p.maskData,statistics:[]}));h++;e.addData({pixels:p.pixelData,statistics:{minValue:p.minValue,maxValue:p.maxValue,noDataValue:p.noDataValue}});10<w-t&&(p=String.fromCharCode.apply(null,new Uint8Array(b,t,10)),t=-1<t+p.indexOf("CntZ")?p.indexOf("CntZ"):0)}return e}function B(a,c){if(!E)throw new r("rasterCoded:decode","lerc decoder is not supported on big endian platform");var g=0,f=0,m=0,h,l,n,t=a.byteLength-10,e=[],p=c.width;for(c=
c.height;f<t;){l=b.decode(a,{inputOffset:f,maskData:h,returnFileInfo:!0});if(p&&c&&(l.width!==p||l.height!==c))throw new r("rasterCoded:decode","lerc2 decoded result has width or height different from what's specified in options");f=l.fileInfo.eofOffset;0===g&&(m=l.fileInfo.numValidPixel,h=l.maskData,n=new d({width:l.width,height:l.height,pixels:[],pixelType:l.fileInfo.pixelType,mask:l.maskData,statistics:[]}));l.fileInfo.mask&&0<l.fileInfo.mask.numBytes&&e.push(l.maskData);g++;n.addData({pixels:l.pixelData,
statistics:{minValue:l.minValue,maxValue:l.maxValue}});10<t-f&&(l=String.fromCharCode.apply(null,new Uint8Array(a,f,10)),f+=-1<l.indexOf("Lerc")?l.indexOf("Lerc"):0)}f=g=a=0;if(1<e.length){f=n.width*n.height;h=new Uint8Array(f);h.set(e[0]);for(a=1;a<e.length;a++)for(m=e[a],g=0;g<f;g++)h[g]&=m[g];for(g=m=0;g<f;g++)m+=h[g];n.mask=h}n.validPixelCount=m;return n}function f(a){a=c.decode(a);a=new d({width:a.width,height:a.height,pixels:a.pixels,pixelType:a.pixelType.toLowerCase(),mask:a.mask,statistics:null});
a.updateStatistics();return a}function h(a){a=l.decode(a);a=new d({width:a.width,height:a.height,pixels:a.pixels,pixelType:"U8",mask:a.mask,statistics:null});a.updateStatistics();return a}function n(a,b){a=new Uint8Array(a);var c=new g(a);a=b.width;var f=b.height;b=a*f;for(var c=c.decode(),m=0,h=0,h=new Uint8Array(b),m=0;m<b;m++)h[m]=c[4*m+3];f=new d({width:a,height:f,pixels:[],pixelType:"U8",mask:h,statistics:[]});for(m=0;3>m;m++){a=new Uint8Array(b);for(h=0;h<b;h++)a[h]=c[4*h+m];f.addData({pixels:a})}f.updateStatistics();
return f}function p(a,b,c){return e.__awaiter(this,void 0,void 0,function(){var g,f,m,h;return e.__generator(this,function(l){switch(l.label){case 0:return g=new k,f=e.__assign({applyJpegMask:!1},b),[4,g.decode(a,f,c)];case 1:return m=l.sent(),h=new d(m),h.updateStatistics(),[2,h]}})})}function A(a){if(null==a)throw new r("rasterCodec:decode","parameter encodeddata is required.");a=new Uint8Array(a,0,10);var b="";255===a[0]&&216===a[1]?b="jpg":137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]?b="png":67===
a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9]?b="lerc":76===a[0]&&101===a[1]&&114===a[2]&&99===a[3]&&50===a[4]&&32===a[5]?b="lerc2":73===a[0]&&73===a[1]&&42===a[2]&&0===a[3]||77===a[0]&&77===a[1]&&0===a[2]&&42===a[3]?b="tiff":-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error")&&(b="error");return b}function v(a){var b=null;switch(a){case "lerc":b=t;break;case "lerc2":b=B;break;case "jpg":b=h;break;case "png":b=n;break;
case "bsq":case "bip":b=function(b,c){var g=u(c.pixelType).pixelTypeCtor,f=m.decode;b=f(b,{width:c.width,height:c.height,pixelType:g,format:a});c=new d({width:c.width,height:c.height,pixels:b.pixels,pixelType:c.pixelType,mask:b.mask,statistics:null});c.updateStatistics();return c};break;case "tiff":b=f;break;case "error":b=function(){throw new r("rasterCodec:decode","input data contains error");};break;default:b=function(){throw new r("rasterCodec:decode","unsupported raster format");}}return b}function u(a){var b=
null,c=null;switch(a?a.toLowerCase():"f32"){case "u1":case "u2":case "u4":case "u8":c=Math.pow(2,8)-1;b=Uint8Array;break;case "u16":c=c||Math.pow(2,16)-1;b=Uint16Array;break;case "u32":c=c||Math.pow(2,32)-1;b=Uint32Array;break;case "s8":c=c||0-Math.pow(2,7);b=Int8Array;break;case "s16":c=c||0-Math.pow(2,15);b=Int16Array;break;case "s32":c=c||0-Math.pow(2,31);b=Int32Array;break;default:b=Float32Array}return{pixelTypeCtor:b,noDataValue:c}}var E=function(){var a=new ArrayBuffer(4),b=new Uint8Array(a);
(new Uint32Array(a))[0]=1;return 1===b[0]}();return function(){function a(){}a.getFormat=function(a){a=A(a);"lerc2"===a?a="lerc":"error"===a&&(a="");return a};a.decode=function(a,b,g){return e.__awaiter(this,void 0,void 0,function(){var f,m,h;return e.__generator(this,function(l){switch(l.label){case 0:if(null==a)throw new r("rasterCodec:decode","missing encodeddata parameter.");if(null==b||null==b.width||null==b.height)throw new r("rasterCodec:decode","requires width and height in options parameter.");
f=b.format&&b.format.toLowerCase();if("tiff"===f&&b.customOptions)return l=c.decodeTileOrStrip(a,b.customOptions),l=new d({width:l.width,height:l.height,pixels:l.pixels,pixelType:l.pixelType.toLowerCase(),mask:l.mask,statistics:null}),l.updateStatistics(),[2,l];if(!f||"bsq"!==f&&"bip"!==f)f=A(a);return!b.useCanvas||"jpg"!==f&&"png"!==f?[3,2]:[4,p(a,b,g)];case 1:return h=l.sent(),[3,3];case 2:m=v(f);b.isPoint&&(b=e.__assign({},b),b.width++,b.height++);h=m(a,b);if(b.isPoint){var n=h,t=void 0;void 0===
t&&(t=1);if(n){var k=n.pixels,B=n.width,w=n.mask;if(k&&0!==k.length){var u=k.length,x=B-1,y=n.height-1,z=[],F,C,H,E,q,N,D=d.getPixelArrayConstructor(n.pixelType);if(0===t){for(t=0;t<u;t++){E=k[t];q=new D(x*y);for(F=0;F<y;F++)for(H=F*B,C=0;C<x;C++)q[F*x+C]=E[H+C];z.push(q)}if(w)for(N=new Uint8Array(x*y),F=0;F<y;F++)for(H=F*B,C=0;C<x;C++)N[F*x+C]=w[H+C]}else{for(t=0;t<u;t++){E=k[t];q=new D(x*y);for(F=0;F<y;F++)for(H=F*B,C=0;C<x;C++)q[F*x+C]=(E[H+C]+E[H+C+1]+E[H+B+C]+E[H+B+C+1])/4;z.push(q)}if(w)for(N=
new Uint8Array(x*y),F=0;F<y;F++)for(H=F*B,C=0;C<x;C++)N[F*x+C]=Math.min.apply(null,[w[H+C],w[H+C+1],w[H+B+C],w[H+B+C+1]])}n.width=x;n.height=y;n.mask=N;n.pixels=z}}}l.label=3;case 3:return[2,h]}})})};return a}()})},"esri/layers/support/rasterFormats/ImageCanvasDecoder":function(){define("require exports ../../../core/Error ../../../core/promiseUtils ../../../core/promiseUtils ./Zlib".split(" "),function(D,q,e,r,d,k){return function(){function l(b){b&&(this.canvas=b.canvas,this.ctx=b.ctx||b.canvas&&
b.canvas.getContext("2d"))}l.getFormat=function(b){if(!b||10>b.byteLength)return"";b=new Uint8Array(b,0,10);var a="";255===b[0]&&216===b[1]?a="jpeg":137===b[0]&&80===b[1]&&78===b[2]&&71===b[3]&&(a="png");return a};l.prototype.decode=function(b,a,g){var m=this;if(!b||10>b.byteLength)throw new e("imagecanvasdecoder: decode","required a valid encoded data as input.");var c=l.getFormat(b);if(""===c)throw new e("imagecanvasdecoder: decode","encoded data format is not a supported format (jpeg or png).");
var t=a.width,B=a.height,f=a.applyJpegMask;if(f&&(!t||!B))throw new e("imagecanvasdecoder: decode","image width and height are needed to apply jpeg mask directly to canvas");return r.create(function(h,n){var e=null;"jpeg"===c&&f&&(e=l.getMask(b,a));var k=new Blob([new Uint8Array(b)],{type:"image/"+c}),v=URL.createObjectURL(k),u=new Image,E;u.src=v;u.onload=function(){URL.revokeObjectURL(v);if(r.isAborted(g))n(d.createAbortError());else{t=u.width;B=u.height;if(m.canvas){if(m.canvas.width!==t||m.canvas.height!==
B)m.canvas.width=t,m.canvas.height=B;m.ctx.clearRect(0,0,t,B)}else m.canvas=document.createElement("canvas"),m.canvas.width=t,m.canvas.height=B,m.ctx=m.canvas.getContext("2d");m.ctx.drawImage(u,0,0);var b=m.ctx.getImageData(0,0,t,B);E=b.data;var c;if(a.renderOnCanvas){if(e)for(c=0;c<e.length;c++)E[4*c+3]=e[c]?255:0;m.ctx.putImageData(b,0,0);h(null)}else{var b=t*B,f=new Uint8Array(b),l=new Uint8Array(b),p=new Uint8Array(b);if(e)for(c=0;c<b;c++)f[c]=E[4*c],l[c]=E[4*c+1],p[c]=E[4*c+2];else for(e=new Uint8Array(b),
c=0;c<b;c++)f[c]=E[4*c],l[c]=E[4*c+1],p[c]=E[4*c+2],e[c]=E[4*c+3];h({width:t,height:B,pixels:[f,l,p],mask:e,pixelType:"u8"})}}};u.onerror=function(){URL.revokeObjectURL(v);n("cannot load image")}})};l.getMask=function(b,a){var g=null;try{var d=new Uint8Array(b);b=0;var c=d.length-2;for(b=Math.ceil(d.length/2);b<c&&(255!==d[b]||217!==d[b+1]);b++);b+=2;if(b<d.length-1)for(var l=(new k(d.subarray(b))).getBytes(),g=new Uint8Array(a.width*a.height),d=a=0;d<l.length;d++)for(c=7;0<=c;c--)g[a++]=l[d]>>c&
1}catch(B){}return g};return l}()})},"esri/layers/support/rasterFormats/Zlib":function(){define([],function(){var D=function(){function q(){this.bufferLength=this.pos=0;this.eof=!1;this.buffer=null}q.prototype={ensureBuffer:function(e){var r=this.buffer,d=r?r.byteLength:0;if(e<d)return r;for(var k=512;k<e;)k<<=1;e=new Uint8Array(k);for(k=0;k<d;++k)e[k]=r[k];return this.buffer=e},getByte:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},
getBytes:function(e){var r=this.pos;if(e){this.ensureBuffer(r+e);for(e=r+e;!this.eof&&this.bufferLength<e;)this.readBlock();var d=this.bufferLength;e>d&&(e=d)}else{for(;!this.eof;)this.readBlock();e=this.bufferLength}this.pos=e;return this.buffer.subarray(r,e)},lookChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;
this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(e,r,d){for(var k=e+r;this.bufferLength<=k&&!this.eof;)this.readBlock();return new Stream(this.buffer,e,r,d)},skip:function(e){e||(e=1);this.pos+=e},reset:function(){this.pos=0}};return q}();return function(){function q(a){throw Error(a);}function e(a){var b=0,d=a[b++],c=a[b++];-1!=d&&-1!=c||q("Invalid header in flate stream");8!=(d&15)&&q("Unknown compression method in flate stream");0!=((d<<8)+c)%31&&q("Bad FCHECK in flate stream");
c&32&&q("FDICT bit set in flate stream");this.bytes=a;this.bytesPos=b;this.codeBuf=this.codeSize=0;D.call(this)}if(!self||!self.Uint32Array)return null;var r=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),k=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,
393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),l=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59E4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,
524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,
524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,
524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,
524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,
524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,
524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,
524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],b=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];e.prototype=Object.create(D.prototype);e.prototype.getBits=function(a){for(var b=
this.codeSize,d=this.codeBuf,c=this.bytes,l=this.bytesPos,e;b<a;)"undefined"==typeof(e=c[l++])&&q("Bad encoding in flate stream"),d|=e<<b,b+=8;this.codeBuf=d>>a;this.codeSize=b-=a;this.bytesPos=l;return d&(1<<a)-1};e.prototype.getCode=function(a){var b=a[0],d=a[1];a=this.codeSize;for(var c=this.codeBuf,l=this.bytes,e=this.bytesPos;a<d;){var f;"undefined"==typeof(f=l[e++])&&q("Bad encoding in flate stream");c|=f<<a;a+=8}d=b[c&(1<<d)-1];b=d>>16;d&=65535;(0==a||a<b||0==b)&&q("Bad encoding in flate stream");
this.codeBuf=c>>b;this.codeSize=a-b;this.bytesPos=e;return d};e.prototype.generateHuffmanTable=function(a){for(var b=a.length,d=0,c=0;c<b;++c)a[c]>d&&(d=a[c]);for(var l=1<<d,e=new Uint32Array(l),f=1,h=0,n=2;f<=d;++f,h<<=1,n<<=1)for(var p=0;p<b;++p)if(a[p]==f){for(var k=0,r=h,c=0;c<f;++c)k=k<<1|r&1,r>>=1;for(c=k;c<l;c+=n)e[c]=f<<16|p;++h}return[e,d]};e.prototype.readBlock=function(){function a(a,b,c,g,f){for(a=a.getBits(c)+g;0<a--;)b[h++]=f}var g=this.getBits(3);g&1&&(this.eof=!0);g>>=1;if(0==g){var m=
this.bytes,c=this.bytesPos,e;"undefined"==typeof(e=m[c++])&&q("Bad block header in flate stream");var B=e;"undefined"==typeof(e=m[c++])&&q("Bad block header in flate stream");B|=e<<8;"undefined"==typeof(e=m[c++])&&q("Bad block header in flate stream");g=e;"undefined"==typeof(e=m[c++])&&q("Bad block header in flate stream");(g|e<<8)!=(~B&65535)&&q("Bad uncompressed block length in flate stream");this.codeSize=this.codeBuf=0;e=this.bufferLength;g=this.ensureBuffer(e+B);this.bufferLength=B=e+B;for(var f=
e;f<B;++f){if("undefined"==typeof(e=m[c++])){this.eof=!0;break}g[f]=e}this.bytesPos=c}else{if(1==g)c=l,e=b;else if(2==g){g=this.getBits(5)+257;e=this.getBits(5)+1;for(var m=this.getBits(4)+4,c=Array(r.length),h=0;h<m;)c[r[h++]]=this.getBits(3);c=this.generateHuffmanTable(c);h=m=0;e=g+e;for(B=Array(e);h<e;)f=this.getCode(c),16==f?a(this,B,2,3,m):17==f?a(this,B,3,3,m=0):18==f?a(this,B,7,11,m=0):B[h++]=m=f;c=this.generateHuffmanTable(B.slice(0,g));e=this.generateHuffmanTable(B.slice(g,e))}else q("Unknown block type in flate stream");
B=(g=this.buffer)?g.length:0;for(f=this.bufferLength;;){var n=this.getCode(c);if(256>n)f+1>=B&&(g=this.ensureBuffer(f+1),B=g.length),g[f++]=n;else{if(256==n){this.bufferLength=f;break}var n=n-257,n=d[n],p=n>>16;0<p&&(p=this.getBits(p));m=(n&65535)+p;n=this.getCode(e);n=k[n];p=n>>16;0<p&&(p=this.getBits(p));n=(n&65535)+p;f+m>=B&&(g=this.ensureBuffer(f+m),B=g.length);for(p=0;p<m;++p,++f)g[f]=g[f-n]}}}};return e}()})},"esri/layers/support/rasterFormats/JpgPlus":function(){define(["require","exports",
"./Jpg","./Zlib"],function(D,q,e,r){return function(){function d(){}d.decode=function(d){var l=new Uint8Array(d),b=new e;b.parse(l);d=b.width;var a=b.height,g=b.numComponents,m=b.eof,b=b.getData(d,a,!0),c,t=d*a,k=0,f=0,h=0;if(m<l.length-1)for(l=(new r(l.subarray(m))).getBytes(),c=new Uint8Array(t),k=m=0;k<l.length;k++)for(h=7;0<=h;h--)c[m++]=l[k]>>h&1;l=null;if(1===g)l=[b,b,b];else{l=[];for(k=0;3>k;k++)g=new Uint8Array(t),l.push(g);for(f=h=0;f<t;f++)for(k=0;3>k;k++)l[k][f]=b[h++]}return{width:d,height:a,
pixels:l,mask:c}};return d}()})},"esri/layers/support/rasterFormats/Jpg":function(){define([],function(){var D=function(){function q(e){this.message="JPEG error: "+e}q.prototype=Error();q.prototype.name="JpegError";return q.constructor=q}();return function(){function q(){this.decodeTransform=null;this.colorTransform=-1}function e(b,a){for(var g=0,d=[],c,l,e=16;0<e&&!b[e-1];)e--;d.push({children:[],index:0});var f=d[0],h;for(c=0;c<e;c++){for(l=0;l<b[c];l++){f=d.pop();for(f.children[f.index]=a[g];0<
f.index;)f=d.pop();f.index++;for(d.push(f);d.length<=c;)d.push(h={children:[],index:0}),f.children[f.index]=h.children,f=h;g++}c+1<e&&(d.push(h={children:[],index:0}),f.children[f.index]=h.children,f=h)}return d[0].children}function r(b,a,g,d,c,e,r,f,h){function m(){if(0<H)return H--,F>>H&1;F=b[a++];if(255===F){var c=b[a++];if(c)throw new D("unexpected marker "+(F<<8|c).toString(16));}H=7;return F>>>7}function t(a){for(;;){a=a[m()];if("number"===typeof a)return a;if("object"!==typeof a)throw new D("invalid huffman sequence");
}}function B(a){for(var b=0;0<a;)b=b<<1|m(),a--;return b}function v(a){if(1===a)return 1===m()?1:-1;var b=B(a);return b>=1<<a-1?b:b+(-1<<a)+1}function u(a,b){var c=t(a.huffmanTableDC),c=0===c?0:v(c);a.blockData[b]=a.pred+=c;for(c=1;64>c;){var g=t(a.huffmanTableAC),f=g&15,g=g>>4;if(0===f){if(15>g)break;c+=16}else c+=g,a.blockData[b+l[c]]=v(f),c++}}function E(a,b){var c=t(a.huffmanTableDC),c=0===c?0:v(c)<<h;a.blockData[b]=a.pred+=c}function x(a,b){a.blockData[b]|=m()<<h}function w(a,b){if(0<q)q--;else for(var c=
e;c<=r;){var g=t(a.huffmanTableAC),f=g&15,g=g>>4;if(0===f){if(15>g){q=B(g)+(1<<g)-1;break}c+=16}else c+=g,a.blockData[b+l[c]]=v(f)*(1<<h),c++}}function y(a,b){for(var c=e,g=0,f;c<=r;){f=l[c];switch(K){case 0:g=t(a.huffmanTableAC);f=g&15;g>>=4;if(0===f)15>g?(q=B(g)+(1<<g),K=4):(g=16,K=1);else{if(1!==f)throw new D("invalid ACn encoding");I=v(f);K=g?2:3}continue;case 1:case 2:a.blockData[b+f]?a.blockData[b+f]+=m()<<h:(g--,0===g&&(K=2===K?3:0));break;case 3:a.blockData[b+f]?a.blockData[b+f]+=m()<<h:(a.blockData[b+
f]=I<<h,K=0);break;case 4:a.blockData[b+f]&&(a.blockData[b+f]+=m()<<h)}c++}4===K&&(q--,0===q&&(K=0))}var z=g.mcusPerLine,C=a,F=0,H=0,q=0,K=0,I,G=d.length,J,L,R,P,S;f=g.progressive?0===e?0===f?E:x:0===f?w:y:u;var U=0;g=1===G?d[0].blocksPerLine*d[0].blocksPerColumn:z*g.mcusPerColumn;for(var W,T;U<g;){var O=c?Math.min(g-U,c):g;for(L=0;L<G;L++)d[L].pred=0;q=0;if(1===G)for(J=d[0],S=0;S<O;S++)f(J,64*((J.blocksPerLine+1)*(U/J.blocksPerLine|0)+U%J.blocksPerLine)),U++;else for(S=0;S<O;S++){for(L=0;L<G;L++)for(J=
d[L],W=J.h,T=J.v,R=0;R<T;R++)for(P=0;P<W;P++)f(J,64*((J.blocksPerLine+1)*((U/z|0)*J.v+R)+(U%z*J.h+P)));U++}H=0;(J=k(b,a))&&J.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+J.invalid),a=J.offset);J=J&&J.marker;if(!J||65280>=J)throw new D("marker was not found");if(65488<=J&&65495>=J)a+=2;else break}(J=k(b,a))&&J.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+J.invalid),a=J.offset);return a-C}function d(b,a){b=a.blocksPerLine;for(var g=a.blocksPerColumn,
d=new Int16Array(64),c=0;c<g;c++)for(var l=0;l<b;l++){var e=64*((a.blocksPerLine+1)*c+l),f=d,h=a.quantizationTable,n=a.blockData,p=void 0,k=void 0,r=void 0,u=void 0,E=void 0,x=void 0,w=void 0,y=void 0,z=void 0,C=y=void 0,F=w=k=x=void 0,H=void 0,z=void 0;if(!h)throw new D("missing required Quantization Table.");for(var q=0;64>q;q+=8)z=n[e+q],y=n[e+q+1],C=n[e+q+2],x=n[e+q+3],k=n[e+q+4],w=n[e+q+5],F=n[e+q+6],H=n[e+q+7],z*=h[q],0===(y|C|x|k|w|F|H)?(z=5793*z+512>>10,f[q]=z,f[q+1]=z,f[q+2]=z,f[q+3]=z,f[q+
4]=z,f[q+5]=z,f[q+6]=z,f[q+7]=z):(y*=h[q+1],C*=h[q+2],x*=h[q+3],k*=h[q+4],w*=h[q+5],F*=h[q+6],H*=h[q+7],p=5793*z+128>>8,k=5793*k+128>>8,r=C,u=F,E=2896*(y-H)+128>>8,y=2896*(y+H)+128>>8,x<<=4,w<<=4,p=p+k+1>>1,k=p-k,z=3784*r+1567*u+128>>8,r=1567*r-3784*u+128>>8,u=z,E=E+w+1>>1,w=E-w,y=y+x+1>>1,x=y-x,p=p+u+1>>1,u=p-u,k=k+r+1>>1,r=k-r,z=2276*E+3406*y+2048>>12,E=3406*E-2276*y+2048>>12,y=z,z=799*x+4017*w+2048>>12,x=4017*x-799*w+2048>>12,w=z,f[q]=p+y,f[q+7]=p-y,f[q+1]=k+w,f[q+6]=k-w,f[q+2]=r+x,f[q+5]=r-x,
f[q+3]=u+E,f[q+4]=u-E);for(h=0;8>h;++h)z=f[h],y=f[h+8],C=f[h+16],x=f[h+24],k=f[h+32],w=f[h+40],F=f[h+48],H=f[h+56],0===(y|C|x|k|w|F|H)?(z=5793*z+8192>>14,z=-2040>z?0:2024<=z?255:z+2056>>4,n[e+h]=z,n[e+h+8]=z,n[e+h+16]=z,n[e+h+24]=z,n[e+h+32]=z,n[e+h+40]=z,n[e+h+48]=z,n[e+h+56]=z):(p=5793*z+2048>>12,k=5793*k+2048>>12,r=C,u=F,E=2896*(y-H)+2048>>12,y=2896*(y+H)+2048>>12,p=(p+k+1>>1)+4112,k=p-k,z=3784*r+1567*u+2048>>12,r=1567*r-3784*u+2048>>12,u=z,E=E+w+1>>1,w=E-w,y=y+x+1>>1,x=y-x,p=p+u+1>>1,u=p-u,k=
k+r+1>>1,r=k-r,z=2276*E+3406*y+2048>>12,E=3406*E-2276*y+2048>>12,y=z,z=799*x+4017*w+2048>>12,x=4017*x-799*w+2048>>12,w=z,z=p+y,H=p-y,y=k+w,F=k-w,C=r+x,w=r-x,x=u+E,k=u-E,z=16>z?0:4080<=z?255:z>>4,y=16>y?0:4080<=y?255:y>>4,C=16>C?0:4080<=C?255:C>>4,x=16>x?0:4080<=x?255:x>>4,k=16>k?0:4080<=k?255:k>>4,w=16>w?0:4080<=w?255:w>>4,F=16>F?0:4080<=F?255:F>>4,H=16>H?0:4080<=H?255:H>>4,n[e+h]=z,n[e+h+8]=y,n[e+h+16]=C,n[e+h+24]=x,n[e+h+32]=k,n[e+h+40]=w,n[e+h+48]=F,n[e+h+56]=H)}return a.blockData}function k(b,
a,g){var d=b.length-1;g=g<a?g:a;if(a>=d)return null;var c=b[a]<<8|b[a+1];if(65472<=c&&65534>=c)return{invalid:null,marker:c,offset:a};for(a=b[g]<<8|b[g+1];!(65472<=a&&65534>=a);){if(++g>=d)return null;a=b[g]<<8|b[g+1]}return{invalid:c.toString(16),marker:a,offset:g}}if(!self||!self.Uint8ClampedArray)return null;var l=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,
54,47,55,62,63]);q.prototype={parse:function(b){function a(){var a=b[c]<<8|b[c+1];c+=2;return a}function g(){var g=a(),g=c+g-2,f=k(b,g,c);f&&f.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+f.invalid),g=f.offset);g=b.subarray(c,g);c+=g.length;return g}function m(a){for(var b=Math.ceil(a.samplesPerLine/8/a.maxH),c=Math.ceil(a.scanLines/8/a.maxV),g=0;g<a.components.length;g++){C=a.components[g];var f=Math.ceil(Math.ceil(a.samplesPerLine/8)*C.h/a.maxH),d=Math.ceil(Math.ceil(a.scanLines/
8)*C.v/a.maxV);C.blockData=new Int16Array(64*c*C.v*(b*C.h+1));C.blocksPerLine=f;C.blocksPerColumn=d}a.mcusPerLine=b;a.mcusPerColumn=c}var c=0,t=null,B=null,f,h,n=[],p=[],A=[],v=a();if(65496!==v)throw new D("SOI not found");for(v=a();65497!==v;){var u,q;switch(v){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:u=g();65504===v&&74===u[0]&&70===u[1]&&73===u[2]&&70===
u[3]&&0===u[4]&&(t={version:{major:u[5],minor:u[6]},densityUnits:u[7],xDensity:u[8]<<8|u[9],yDensity:u[10]<<8|u[11],thumbWidth:u[12],thumbHeight:u[13],thumbData:u.subarray(14,14+3*u[12]*u[13])});65518===v&&65===u[0]&&100===u[1]&&111===u[2]&&98===u[3]&&101===u[4]&&(B={version:u[5]<<8|u[6],flags0:u[7]<<8|u[8],flags1:u[9]<<8|u[10],transformCode:u[11]});break;case 65499:for(var v=a()+c-2,x;c<v;){var w=b[c++],y=new Uint16Array(64);if(0===w>>4)for(u=0;64>u;u++)x=l[u],y[x]=b[c++];else if(1===w>>4)for(u=
0;64>u;u++)x=l[u],y[x]=a();else throw new D("DQT - invalid table spec");n[w&15]=y}break;case 65472:case 65473:case 65474:if(f)throw new D("Only single frame JPEGs supported");a();f={};f.extended=65473===v;f.progressive=65474===v;f.precision=b[c++];f.scanLines=a();f.samplesPerLine=a();f.components=[];f.componentIds={};u=b[c++];for(v=y=w=0;v<u;v++){x=b[c];q=b[c+1]>>4;var z=b[c+1]&15;w<q&&(w=q);y<z&&(y=z);q=f.components.push({h:q,v:z,quantizationId:b[c+2],quantizationTable:null});f.componentIds[x]=q-
1;c+=3}f.maxH=w;f.maxV=y;m(f);break;case 65476:x=a();for(v=2;v<x;){w=b[c++];y=new Uint8Array(16);for(u=q=0;16>u;u++,c++)q+=y[u]=b[c];z=new Uint8Array(q);for(u=0;u<q;u++,c++)z[u]=b[c];v+=17+q;(0===w>>4?A:p)[w&15]=e(y,z)}break;case 65501:a();h=a();break;case 65498:a();x=b[c++];u=[];for(var C,v=0;v<x;v++)w=f.componentIds[b[c++]],C=f.components[w],w=b[c++],C.huffmanTableDC=A[w>>4],C.huffmanTableAC=p[w&15],u.push(C);v=b[c++];x=b[c++];w=b[c++];v=r(b,c,f,u,h,v,x,w>>4,w&15);c+=v;break;case 65535:255!==b[c]&&
c--;break;default:if(255===b[c-3]&&192<=b[c-2]&&254>=b[c-2])c-=3;else throw new D("unknown marker "+v.toString(16));}v=a()}this.width=f.samplesPerLine;this.height=f.scanLines;this.jfif=t;this.eof=c;this.adobe=B;this.components=[];for(v=0;v<f.components.length;v++){C=f.components[v];if(t=n[C.quantizationId])C.quantizationTable=t;this.components.push({output:d(f,C),scaleX:C.h/f.maxH,scaleY:C.v/f.maxV,blocksPerLine:C.blocksPerLine,blocksPerColumn:C.blocksPerColumn})}this.numComponents=this.components.length},
_getLinearizedBlockData:function(b,a){var g=this.width/b,d=this.height/a,c,l,e,f,h,n,k=0,r,v=this.components.length,u=b*a*v,q=new Uint8ClampedArray(u),x=new Uint32Array(b);for(n=0;n<v;n++){c=this.components[n];l=c.scaleX*g;e=c.scaleY*d;k=n;r=c.output;f=c.blocksPerLine+1<<3;for(h=0;h<b;h++)c=0|h*l,x[h]=(c&4294967288)<<3|c&7;for(l=0;l<a;l++)for(c=0|l*e,c=f*(c&4294967288)|(c&7)<<3,h=0;h<b;h++)q[k]=r[c+x[h]],k+=v}if(a=this.decodeTransform)for(n=0;n<u;)for(b=c=0;c<v;c++,n++,b+=2)q[n]=(q[n]*a[b]>>8)+a[b+
1];return q},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0===this.colorTransform?!1:!0:1===this.colorTransform?!0:!1},_convertYccToRgb:function(b){for(var a,g,d,c=0,l=b.length;c<l;c+=3)a=b[c],g=b[c+1],d=b[c+2],b[c]=a-179.456+1.402*d,b[c+1]=a+135.459-.344*g-.714*d,b[c+2]=a-226.816+1.772*g;return b},_convertYcckToRgb:function(b){for(var a,g,d,c,l=0,e=0,f=b.length;e<f;e+=4)a=b[e],g=b[e+1],d=b[e+2],c=b[e+3],b[l++]=-122.67195406894+g*(-6.60635669420364E-5*
g+4.37130475926232E-4*d-5.4080610064599E-5*a+4.8449797120281E-4*c-.154362151871126)+d*(-9.57964378445773E-4*d+8.17076911346625E-4*a-.00477271405408747*c+1.53380253221734)+a*(9.61250184130688E-4*a-.00266257332283933*c+.48357088451265)+c*(-3.36197177618394E-4*c+.484791561490776),b[l++]=107.268039397724+g*(2.19927104525741E-5*g-6.40992018297945E-4*d+6.59397001245577E-4*a+4.26105652938837E-4*c-.176491792462875)+d*(-7.78269941513683E-4*d+.00130872261408275*a+7.70482631801132E-4*c-.151051492775562)+a*(.00126935368114843*
a-.00265090189010898*c+.25802910206845)+c*(-3.18913117588328E-4*c-.213742400323665),b[l++]=-20.810012546947+g*(-5.70115196973677E-4*g-2.63409051004589E-5*d+.0020741088115012*a-.00288260236853442*c+.814272968359295)+d*(-1.53496057440975E-5*d-1.32689043961446E-4*a+5.60833691242812E-4*c-.195152027534049)+a*(.00174418132927582*a-.00255243321439347*c+.116935020465145)+c*(-3.43531996510555E-4*c+.24165260232407);return b},_convertYcckToCmyk:function(b){for(var a,g,d,c=0,l=b.length;c<l;c+=4)a=b[c],g=b[c+
1],d=b[c+2],b[c]=434.456-a-1.402*d,b[c+1]=119.541-a+.344*g+.714*d,b[c+2]=481.816-a-1.772*g;return b},_convertCmykToRgb:function(b){for(var a,g,d,c,l=0,e=1/255,f=0,h=b.length;f<h;f+=4)a=b[f]*e,g=b[f+1]*e,d=b[f+2]*e,c=b[f+3]*e,b[l++]=255+a*(-4.387332384609988*a+54.48615194189176*g+18.82290502165302*d+212.25662451639585*c-285.2331026137004)+g*(1.7149763477362134*g-5.6096736904047315*d-17.873870861415444*c-5.497006427196366)+d*(-2.5217340131683033*d-21.248923337353073*c+17.5119270841813)-c*(21.86122147463605*
c+189.48180835922747),b[l++]=255+a*(8.841041422036149*a+60.118027045597366*g+6.871425592049007*d+31.159100130055922*c-79.2970844816548)+g*(-15.310361306967817*g+17.575251261109482*d+131.35250912493976*c-190.9453302588951)+d*(4.444339102852739*d+9.8632861493405*c-24.86741582555878)-c*(20.737325471181034*c+187.80453709719578),b[l++]=255+a*(.8842522430003296*a+8.078677503112928*g+30.89978309703729*d-.23883238689178934*c-14.183576799673286)+g*(10.49593273432072*g+63.02378494754052*d+50.606957656360734*
c-112.23884253719248)+d*(.03296041114873217*d+115.60384449646641*c-193.58209356861505)-c*(22.33816807309886*c+180.12613974708367);return b},getData:function(b,a,g){if(4<this.numComponents)throw new D("Unsupported color mode");b=this._getLinearizedBlockData(b,a);if(1===this.numComponents&&g){g=b.length;a=new Uint8ClampedArray(3*g);for(var d=0,c=0;c<g;c++){var l=b[c];a[d++]=l;a[d++]=l;a[d++]=l}return a}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(b);if(4===
this.numComponents){if(this._isColorConversionNeeded())return g?this._convertYcckToRgb(b):this._convertYcckToCmyk(b);if(g)return this._convertCmykToRgb(b)}return b}};return q}()})},"esri/layers/support/rasterFormats/Lerc2Codec":function(){define([],function(){var D={unstuff:function(e,d,k,l,b,a,g,m){var c=(1<<k)-1,t=0,r,f=0,h,n;e[e.length-1]<<=8*(4*e.length-Math.ceil(k*l/8));if(b)for(r=0;r<l;r++)0===f&&(n=e[t++],f=32),f>=k?(h=n>>>f-k&c,f-=k):(f=k-f,h=(n&c)<<f&c,n=e[t++],f=32-f,h+=n>>>f),d[r]=b[h];
else for(b=Math.ceil((m-a)/g),r=0;r<l;r++)0===f&&(n=e[t++],f=32),f>=k?(h=n>>>f-k&c,f-=k):(f=k-f,h=(n&c)<<f&c,n=e[t++],f=32-f,h+=n>>>f),d[r]=h<b?a+h*g:m},unstuffLUT:function(e,d,k,l,b,a){var g=(1<<d)-1,m=0,c=0,t=0,r=t=0,f,h=[];e[e.length-1]<<=8*(4*e.length-Math.ceil(d*k/8));for(var n=Math.ceil((a-l)/b),c=0;c<k;c++)0===t&&(f=e[m++],t=32),t>=d?(r=f>>>t-d&g,t-=d):(t=d-t,r=(f&g)<<t&g,f=e[m++],t=32-t,r+=f>>>t),h[c]=r<n?l+r*b:a;h.unshift(l);return h},unstuff2:function(e,d,k,l,b,a,g,m){var c=(1<<k)-1,t=0,
r,f=0,h=0,n,p,A;if(b)for(r=0;r<l;r++)0===f&&(p=e[t++],f=32,h=0),f>=k?(n=p>>>h&c,f-=k,h+=k):(A=k-f,n=p>>>h&c,p=e[t++],f=32-A,n|=(p&(1<<A)-1)<<k-A,h=A),d[r]=b[n];else for(b=Math.ceil((m-a)/g),r=0;r<l;r++)0===f&&(p=e[t++],f=32,h=0),f>=k?(n=p>>>h&c,f-=k,h+=k):(A=k-f,n=p>>>h&c,p=e[t++],f=32-A,n|=(p&(1<<A)-1)<<k-A,h=A),d[r]=n<b?a+n*g:m;return d},unstuffLUT2:function(e,d,k,l,b,a){for(var g=(1<<d)-1,m=0,c=0,t=0,r=0,f=0,h=0,n,p=[],A=Math.ceil((a-l)/b),c=0;c<k;c++)0===r&&(n=e[m++],r=32,h=0),r>=d?(f=n>>>h&g,
r-=d,h+=d):(t=d-r,f=n>>>h&g,n=e[m++],r=32-t,f|=(n&(1<<t)-1)<<d-t,h=t),p[c]=f<A?l+f*b:a;p.unshift(l);return p},originalUnstuff:function(e,d,k,l){var b=(1<<k)-1,a=0,g,m=0,c,t;e[e.length-1]<<=8*(4*e.length-Math.ceil(k*l/8));for(g=0;g<l;g++)0===m&&(t=e[a++],m=32),m>=k?(c=t>>>m-k&b,m-=k):(m=k-m,c=(t&b)<<m&b,t=e[a++],m=32-m,c+=t>>>m),d[g]=c;return d},originalUnstuff2:function(e,d,k,l){var b=(1<<k)-1,a=0,g,m=0,c=0,t,r,f;for(g=0;g<l;g++)0===m&&(r=e[a++],m=32,c=0),m>=k?(t=r>>>c&b,m-=k,c+=k):(f=k-m,t=r>>>c&
b,r=e[a++],m=32-f,t|=(r&(1<<f)-1)<<k-f,c=f),d[g]=t;return d}},q={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(e){for(var d=65535,k=65535,l=e.length,b=Math.floor(l/2),a=0;b;){var g=359<=b?359:b,b=b-g;do d+=e[a++]<<8,k+=d+=e[a++];while(--g);d=(d&65535)+(d>>>16);k=(k&65535)+(k>>>16)}l&1&&(k+=d+=e[a]<<8);return((k&65535)+(k>>>16)<<16|(d&65535)+(d>>>16))>>>0},readHeaderInfo:function(e,d){var k=d.ptr,l=new Uint8Array(e,k,6),b={};b.fileIdentifierString=String.fromCharCode.apply(null,l);if(0!==
b.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+b.fileIdentifierString;var k=k+6,l=new DataView(e,k,8),a=l.getInt32(0,!0);b.fileVersion=a;k+=4;3<=a&&(b.checksum=l.getUint32(4,!0),k+=4);l=new DataView(e,k,12);b.height=l.getUint32(0,!0);b.width=l.getUint32(4,!0);k+=8;4<=a?(b.numDims=l.getUint32(8,!0),k+=4):b.numDims=1;l=new DataView(e,k,40);b.numValidPixel=l.getUint32(0,!0);b.microBlockSize=l.getInt32(4,!0);b.blobSize=l.getInt32(8,!0);b.imageType=
l.getInt32(12,!0);b.maxZError=l.getFloat64(16,!0);b.zMin=l.getFloat64(24,!0);b.zMax=l.getFloat64(32,!0);k+=40;d.headerInfo=b;d.ptr=k;if(3<=a&&(e=this.computeChecksumFletcher32(new Uint8Array(e,k-(4<=a?52:48),b.blobSize-14)),e!==b.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(e,d){var k=d.headerInfo,l=this.getDataTypeArray(k.imageType),b=k.numDims*this.getDataTypeSize(k.imageType),a=this.readSubArray(e,d.ptr,l,b);e=this.readSubArray(e,d.ptr+b,l,b);d.ptr+=2*b;b=!0;for(d=0;d<
k.numDims;d++)if(a[d]!==e[d]){b=!1;break}k.minValues=a;k.maxValues=e;return b},readSubArray:function(e,d,k,l){if(k===Uint8Array)e=new Uint8Array(e,d,l);else{var b=new ArrayBuffer(l);(new Uint8Array(b)).set(new Uint8Array(e,d,l));e=new k(b)}return e},readMask:function(e,d){var k=d.ptr,l=d.headerInfo,b=l.width*l.height,a=l.numValidPixel,g=new DataView(e,k,4),l={};l.numBytes=g.getUint32(0,!0);k+=4;if((0===a||b===a)&&0!==l.numBytes)throw"invalid mask";if(0===a)a=new Uint8Array(Math.ceil(b/8)),l.bitset=
a,g=new Uint8Array(b),d.pixels.resultMask=g,k+=l.numBytes;else if(0<l.numBytes){a=new Uint8Array(Math.ceil(b/8));g=new DataView(e,k,l.numBytes);e=g.getInt16(0,!0);var m=2,c=0,t=0;do{if(0<e)for(;e--;)a[c++]=g.getUint8(m++);else for(t=g.getUint8(m++),e=-e;e--;)a[c++]=t;e=g.getInt16(m,!0);m+=2}while(m<l.numBytes);if(-32768!==e||c<a.length)throw"Unexpected end of mask RLE encoding";g=new Uint8Array(b);for(m=m=e=0;m<b;m++)m&7?(e=a[m>>3],e<<=m&7):e=a[m>>3],e&128&&(g[m]=1);d.pixels.resultMask=g;l.bitset=
a;k+=l.numBytes}d.ptr=k;d.mask=l;return!0},readDataOneSweep:function(e,d,k){var l=d.ptr,b=d.headerInfo,a=b.numDims,g=b.width*b.height,b=b.numValidPixel*q.getDataTypeSize(b.imageType)*a,m=d.pixels.resultMask;if(k===Uint8Array)e=new Uint8Array(e,l,b);else{var c=new ArrayBuffer(b);(new Uint8Array(c)).set(new Uint8Array(e,l,b));e=new k(c)}if(e.length===g*a)d.pixels.resultPixels=e;else{d.pixels.resultPixels=new k(g*a);var t=c=k=0,r=0;if(1<a)for(t=0;t<a;t++)for(r=t*g,c=0;c<g;c++)m[c]&&(d.pixels.resultPixels[r+
c]=e[k++]);else for(c=0;c<g;c++)m[c]&&(d.pixels.resultPixels[c]=e[k++])}d.ptr=l+b;return!0},readHuffmanTree:function(r,d){var k=this.HUFFMAN_LUT_BITS_MAX,l=new DataView(r,d.ptr,16);d.ptr+=16;if(2>l.getInt32(0,!0))throw"unsupported Huffman version";var b=l.getInt32(4,!0),a=l.getInt32(8,!0),l=l.getInt32(12,!0);if(a>=l)return!1;var g=new Uint32Array(l-a);q.decodeBits(r,d,g);var m=[],c,t,B;for(c=a;c<l;c++)t=c-(c<b?0:b),m[t]={first:g[c-a],second:null};c=r.byteLength-d.ptr;g=new ArrayBuffer(4*Math.ceil(c/
4));(new Uint8Array(g)).set(new Uint8Array(r,d.ptr,c));r=new Uint32Array(g);d=0;var f,g=0;f=r[0];for(c=a;c<l;c++)t=c-(c<b?0:b),B=m[t].first,0<B&&(m[t].second=f<<d>>>32-B,32-d>=B?(d+=B,32===d&&(d=0,g++,f=r[g])):(d+=B-32,g++,f=r[g],m[t].second|=f>>>32-d));var h=f=0,n=new e;for(c=0;c<m.length;c++)void 0!==m[c]&&(f=Math.max(f,m[c].first));var h=f>=k?k:f,k=[],p,A;for(c=a;c<l;c++)if(t=c-(c<b?0:b),B=m[t].first,0<B)if(a=[B,t],B<=h)for(t=m[t].second<<h-B,p=1<<h-B,B=0;B<p;B++)k[t|B]=a;else for(t=m[t].second,
p=n,--B;0<=B;B--)(A=t>>>B&1)?(p.right||(p.right=new e),p=p.right):(p.left||(p.left=new e),p=p.left),0!==B||p.val||(p.val=a[1]);return{decodeLut:k,numBitsLUTQick:h,numBitsLUT:f,tree:n,stuffedData:r,srcPtr:g,bitPos:d}},readHuffman:function(e,d,k){var l=d.headerInfo,b=l.numDims,a=d.headerInfo.height,g=d.headerInfo.width,m=g*a,c=this.readHuffmanTree(e,d);e=c.decodeLut;var t=c.tree,r=c.stuffedData,f=c.srcPtr,h=c.bitPos,n=c.numBitsLUTQick,c=c.numBitsLUT,p=0===d.headerInfo.imageType?128:0,A,v,u=d.pixels.resultMask,
q,x,w,y,z,C,F=0;0<h&&(f++,h=0);var H=r[f],N=1===d.encodeMode,K=new k(m*b),I=K,G;for(G=0;G<l.numDims;G++){1<b&&(I=new k(K.buffer,m*G,m),F=0);if(d.headerInfo.numValidPixel===g*a)for(w=z=0;w<a;w++)for(y=0;y<g;y++,z++){v=0;A=q=H<<h>>>32-n;32-h<n&&(A=q|=r[f+1]>>>64-h-n);if(e[A])v=e[A][1],h+=e[A][0];else for(A=q=H<<h>>>32-c,32-h<c&&(A=q|=r[f+1]>>>64-h-c),A=t,C=0;C<c;C++)if(A=(x=q>>>c-C-1&1)?A.right:A.left,!A.left&&!A.right){v=A.val;h=h+C+1;break}32<=h&&(h-=32,f++,H=r[f]);v-=p;N?(v=0<y?v+F:0<w?v+I[z-g]:
v+F,v&=255,F=I[z]=v):I[z]=v}else for(w=z=0;w<a;w++)for(y=0;y<g;y++,z++)if(u[z]){v=0;A=q=H<<h>>>32-n;32-h<n&&(A=q|=r[f+1]>>>64-h-n);if(e[A])v=e[A][1],h+=e[A][0];else for(A=q=H<<h>>>32-c,32-h<c&&(A=q|=r[f+1]>>>64-h-c),A=t,C=0;C<c;C++)if(A=(x=q>>>c-C-1&1)?A.right:A.left,!A.left&&!A.right){v=A.val;h=h+C+1;break}32<=h&&(h-=32,f++,H=r[f]);v-=p;N?(v=0<y&&u[z-1]?v+F:0<w&&u[z-g]?v+I[z-g]:v+F,v&=255,F=I[z]=v):I[z]=v}d.ptr=d.ptr+4*(f+1)+(0<h?4:0)}d.pixels.resultPixels=K},decodeBits:function(e,d,k,l,b){var a=
d.headerInfo,g=a.fileVersion,m=0,c=new DataView(e,d.ptr,5<=e.byteLength-d.ptr?5:e.byteLength-d.ptr),t=c.getUint8(0);m++;var r=t>>6,f=0===r?4:3-r,h=0<(t&32)?!0:!1,r=t&31,t=0;if(1===f)t=c.getUint8(m),m++;else if(2===f)t=c.getUint16(m,!0),m+=2;else if(4===f)t=c.getUint32(m,!0),m+=4;else throw"Invalid valid pixel count type";var f=2*a.maxZError,n,p;b=1<a.numDims?a.maxValues[b]:a.zMax;if(h){d.counter.lut++;h=c.getUint8(m);m++;a=Math.ceil((h-1)*r/8);n=Math.ceil(a/4);n=new ArrayBuffer(4*n);p=new Uint8Array(n);
d.ptr+=m;p.set(new Uint8Array(e,d.ptr,a));m=new Uint32Array(n);d.ptr+=a;for(c=0;h-1>>>c;)c++;a=Math.ceil(t*c/8);n=Math.ceil(a/4);n=new ArrayBuffer(4*n);p=new Uint8Array(n);p.set(new Uint8Array(e,d.ptr,a));e=new Uint32Array(n);d.ptr+=a;d=3<=g?D.unstuffLUT2(m,r,h-1,l,f,b):D.unstuffLUT(m,r,h-1,l,f,b);3<=g?D.unstuff2(e,k,c,t,d):D.unstuff(e,k,c,t,d)}else d.counter.bitstuffer++,c=r,d.ptr+=m,0<c&&(a=Math.ceil(t*c/8),n=Math.ceil(a/4),n=new ArrayBuffer(4*n),p=new Uint8Array(n),p.set(new Uint8Array(e,d.ptr,
a)),e=new Uint32Array(n),d.ptr+=a,3<=g?null==l?D.originalUnstuff2(e,k,c,t):D.unstuff2(e,k,c,t,!1,l,f,b):null==l?D.originalUnstuff(e,k,c,t):D.unstuff(e,k,c,t,!1,l,f,b))},readTiles:function(e,d,k){var l=d.headerInfo,b=l.width,a=l.height,g=l.microBlockSize,m=l.imageType,c=q.getDataTypeSize(m),t=Math.ceil(b/g),r=Math.ceil(a/g);d.pixels.numBlocksY=r;d.pixels.numBlocksX=t;for(var f=d.pixels.ptr=0,h=0,n=0,p=0,A=0,v=0,u=0,E=0,x=0,w=0,y=0,z=0,C=0,u=C=u=0,F,H=new k(g*g),N=a%g||g,K=b%g||g,I=l.numDims,G,J=d.pixels.resultMask,
L=d.pixels.resultPixels,R=5<=l.fileVersion?14:15,D=l.zMax,n=0;n<r;n++)for(A=n!==r-1?g:N,p=0;p<t;p++)for(v=p!==t-1?g:K,y=n*b*g+p*g,z=b-v,G=0;G<I;G++){1<I?(C=L,y=n*b*g+p*g,L=new k(d.pixels.resultPixels.buffer,b*a*G*c,b*a),D=l.maxValues[G]):C=null;u=e.byteLength-d.ptr;f=new DataView(e,d.ptr,Math.min(10,u));h={};u=0;E=f.getUint8(0);u++;F=5<=l.fileVersion?E&4:0;x=E>>6&255;w=E>>2&R;if(w!==(p*g>>3&R))throw"integrity issue";if(F&&0===G)throw"integrity issue";E&=3;if(3<E)throw d.ptr+=u,"Invalid block encoding ("+
E+")";if(2===E){if(F)if(J)for(f=0;f<A;f++)for(h=0;h<v;h++)J[y]&&(L[y]=C[y]),y++;else for(f=0;f<A;f++)for(h=0;h<v;h++)L[y]=C[y],y++;d.counter.constant++;d.ptr+=u}else if(0===E){if(F)throw"integrity issue";d.counter.uncompressed++;d.ptr+=u;C=A*v*c;u=e.byteLength-d.ptr;C=C<u?C:u;u=new ArrayBuffer(0===C%c?C:C+c-C%c);F=new Uint8Array(u);F.set(new Uint8Array(e,d.ptr,C));u=new k(u);C=0;if(J)for(f=0;f<A;f++){for(h=0;h<v;h++)J[y]&&(L[y]=u[C++]),y++;y+=z}else for(f=0;f<A;f++){for(h=0;h<v;h++)L[y++]=u[C++];
y+=z}d.ptr+=C*c}else if(x=q.getDataTypeUsed(F&&6>m?4:m,x),w=q.getOnePixel(h,u,x,f),u+=q.getDataTypeSize(x),3===E)if(d.ptr+=u,d.counter.constantoffset++,J)for(f=0;f<A;f++){for(h=0;h<v;h++)J[y]&&(L[y]=F?Math.min(D,C[y]+w):w),y++;y+=z}else for(f=0;f<A;f++){for(h=0;h<v;h++)L[y]=F?Math.min(D,C[y]+w):w,y++;y+=z}else if(d.ptr+=u,q.decodeBits(e,d,H,w,G),u=0,F)if(J)for(f=0;f<A;f++){for(h=0;h<v;h++)J[y]&&(L[y]=H[u++]+C[y]),y++;y+=z}else for(f=0;f<A;f++){for(h=0;h<v;h++)L[y]=H[u++]+C[y],y++;y+=z}else if(J)for(f=
0;f<A;f++){for(h=0;h<v;h++)J[y]&&(L[y]=H[u++]),y++;y+=z}else for(f=0;f<A;f++){for(h=0;h<v;h++)L[y++]=H[u++];y+=z}}},formatFileInfo:function(e){return{fileIdentifierString:e.headerInfo.fileIdentifierString,fileVersion:e.headerInfo.fileVersion,imageType:e.headerInfo.imageType,height:e.headerInfo.height,width:e.headerInfo.width,numValidPixel:e.headerInfo.numValidPixel,microBlockSize:e.headerInfo.microBlockSize,blobSize:e.headerInfo.blobSize,maxZError:e.headerInfo.maxZError,pixelType:q.getPixelType(e.headerInfo.imageType),
eofOffset:e.eofOffset,mask:e.mask?{numBytes:e.mask.numBytes}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,maxValue:e.headerInfo.zMax,minValue:e.headerInfo.zMin,noDataValue:e.noDataValue}}},constructConstantSurface:function(e){var d=e.headerInfo.zMax,k=e.headerInfo.numDims,l=e.headerInfo.height*e.headerInfo.width,b=0,a=0,g=0,m=e.pixels.resultMask,c=e.pixels.resultPixels;if(m)if(1<k)for(b=0;b<k;b++)for(g=b*l,d=e.headerInfo.maxValues[b],a=0;a<l;a++)m[a]&&(c[g+a]=d);else for(a=
0;a<l;a++)m[a]&&(c[a]=d);else if(1<k)for(b=0;b<k;b++)for(g=b*l,d=e.headerInfo.maxValues[b],a=0;a<l;a++)c[g+a]=d;else for(a=0;a<l;a++)c[a]=d},getDataTypeArray:function(e){switch(e){case 0:e=Int8Array;break;case 1:e=Uint8Array;break;case 2:e=Int16Array;break;case 3:e=Uint16Array;break;case 4:e=Int32Array;break;case 5:e=Uint32Array;break;case 6:e=Float32Array;break;case 7:e=Float64Array;break;default:e=Float32Array}return e},getPixelType:function(e){switch(e){case 0:e="S8";break;case 1:e="U8";break;
case 2:e="S16";break;case 3:e="U16";break;case 4:e="S32";break;case 5:e="U32";break;case 6:e="F32";break;case 7:e="F64";break;default:e="F32"}return e},isValidPixelValue:function(e,d){if(null==d)return!1;switch(e){case 0:e=-128<=d&&127>=d;break;case 1:e=0<=d&&255>=d;break;case 2:e=-32768<=d&&32767>=d;break;case 3:e=0<=d&&65536>=d;break;case 4:e=-2147483648<=d&&2147483647>=d;break;case 5:e=0<=d&&4294967296>=d;break;case 6:e=-3.4027999387901484E38<=d&&3.4027999387901484E38>=d;break;case 7:e=4.9E-324<=
d&&1.7976931348623157E308>=d;break;default:e=!1}return e},getDataTypeSize:function(e){var d=0;switch(e){case 0:case 1:d=1;break;case 2:case 3:d=2;break;case 4:case 5:case 6:d=4;break;case 7:d=8;break;default:d=e}return d},getDataTypeUsed:function(e,d){var k=e;switch(e){case 2:case 4:k=e-d;break;case 3:case 5:k=e-2*d;break;case 6:k=0===d?e:1===d?2:1;break;case 7:k=0===d?e:e-2*d+1;break;default:k=e}return k},getOnePixel:function(e,d,k,l){e=0;switch(k){case 0:e=l.getInt8(d);break;case 1:e=l.getUint8(d);
break;case 2:e=l.getInt16(d,!0);break;case 3:e=l.getUint16(d,!0);break;case 4:e=l.getInt32(d,!0);break;case 5:e=l.getUInt32(d,!0);break;case 6:e=l.getFloat32(d,!0);break;case 7:e=l.getFloat64(d,!0);break;default:throw"the decoder does not understand this pixel type";}return e}},e=function(e,d,k){this.val=e;this.left=d;this.right=k};return{decode:function(e,d){d=d||{};var k=d.noDataValue,l=0,b={};b.ptr=d.inputOffset||0;b.pixels={};if(q.readHeaderInfo(e,b)){var l=b.headerInfo,a=l.fileVersion,g=q.getDataTypeArray(l.imageType);
if(5<a)throw"unsupported lerc version 2."+a;q.readMask(e,b);l.numValidPixel===l.width*l.height||b.pixels.resultMask||(b.pixels.resultMask=d.maskData);var m=l.width*l.height;b.pixels.resultPixels=new g(m*l.numDims);b.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};if(0!==l.numValidPixel)if(l.zMax===l.zMin)q.constructConstantSurface(b);else if(4<=a&&q.checkMinMaxRanges(e,b))q.constructConstantSurface(b);else{var c=new DataView(e,b.ptr,2),t=c.getUint8(0);b.ptr++;if(t)q.readDataOneSweep(e,
b,g);else if(1<a&&1>=l.imageType&&1E-5>Math.abs(l.maxZError-.5)){c=c.getUint8(1);b.ptr++;b.encodeMode=c;if(2<c||4>a&&1<c)throw"Invalid Huffman flag "+c;c?q.readHuffman(e,b,g):q.readTiles(e,b,g)}else q.readTiles(e,b,g)}b.eofOffset=b.ptr;d.inputOffset?(e=b.headerInfo.blobSize+d.inputOffset-b.ptr,1<=Math.abs(e)&&(b.eofOffset=d.inputOffset+b.headerInfo.blobSize)):(e=b.headerInfo.blobSize-b.ptr,1<=Math.abs(e)&&(b.eofOffset=b.headerInfo.blobSize));e={width:l.width,height:l.height,pixelData:b.pixels.resultPixels,
minValue:l.zMin,maxValue:l.zMax,validPixelCount:l.numValidPixel,dimCount:l.numDims,dimStats:{minValues:l.minValues,maxValues:l.maxValues},maskData:b.pixels.resultMask};if(b.pixels.resultMask&&q.isValidPixelValue(l.imageType,k)){a=b.pixels.resultMask;for(l=0;l<m;l++)a[l]||(e.pixelData[l]=k);e.noDataValue=k}b.noDataValue=k;d.returnFileInfo&&(e.fileInfo=q.formatFileInfo(b));return e}},getBandCount:function(e){for(var d=0,k=0,l={ptr:0,pixels:{}};k<e.byteLength-58;)q.readHeaderInfo(e,l),k+=l.headerInfo.blobSize,
d++,l.ptr=k;return d}}})},"esri/layers/support/rasterFormats/LercCodec":function(){define(["../../../core/mathUtils"],function(D){var q={};q.defaultNoDataValue=D.clampFloat32(-Infinity);q.decode=function(r,d){var k;d=d||{};var l=d.inputOffset||0,b=d.encodedMaskData||null===d.encodedMaskData,a={},g=new Uint8Array(r,l,10);a.fileIdentifierString=String.fromCharCode.apply(null,g);if("CntZImage"!=a.fileIdentifierString.trim())throw"Unexpected file identifier string: "+a.fileIdentifierString;l+=10;g=new DataView(r,
l,24);a.fileVersion=g.getInt32(0,!0);a.imageType=g.getInt32(4,!0);a.height=g.getUint32(8,!0);a.width=g.getUint32(12,!0);a.maxZError=g.getFloat64(16,!0);l+=24;if(!b)if(g=new DataView(r,l,16),a.mask={},a.mask.numBlocksY=g.getUint32(0,!0),a.mask.numBlocksX=g.getUint32(4,!0),a.mask.numBytes=g.getUint32(8,!0),a.mask.maxValue=g.getFloat32(12,!0),l+=16,0<a.mask.numBytes){var b=new Uint8Array(Math.ceil(a.width*a.height/8)),g=new DataView(r,l,a.mask.numBytes),m=g.getInt16(0,!0),c=2,t=0;do{if(0<m)for(;m--;)b[t++]=
g.getUint8(c++);else for(var B=g.getUint8(c++),m=-m;m--;)b[t++]=B;m=g.getInt16(c,!0);c+=2}while(c<a.mask.numBytes);if(-32768!==m||t<b.length)throw"Unexpected end of mask RLE encoding";a.mask.bitset=b;l+=a.mask.numBytes}else 0===(a.mask.numBytes|a.mask.numBlocksY|a.mask.maxValue)&&(b=new Uint8Array(Math.ceil(a.width*a.height/8)),a.mask.bitset=b);g=new DataView(r,l,16);a.pixels={};a.pixels.numBlocksY=g.getUint32(0,!0);a.pixels.numBlocksX=g.getUint32(4,!0);a.pixels.numBytes=g.getUint32(8,!0);a.pixels.maxValue=
g.getFloat32(12,!0);l+=16;b=a.pixels.numBlocksX;g=a.pixels.numBlocksY;b+=0<a.width%b?1:0;m=g+(0<a.height%g?1:0);a.pixels.blocks=Array(b*m);c=1E9;for(B=t=0;B<m;B++)for(var f=0;f<b;f++){var h=0,g=new DataView(r,l,Math.min(10,r.byteLength-l)),n={};a.pixels.blocks[t++]=n;var p=g.getUint8(0);h++;n.encoding=p&63;if(3<n.encoding)throw"Invalid block encoding ("+n.encoding+")";if(2===n.encoding)l++,c=Math.min(c,0);else{if(0!==p&&2!==p){p>>=6;n.offsetType=p;if(2===p)n.offset=g.getInt8(1),h++;else if(1===p)n.offset=
g.getInt16(1,!0),h+=2;else if(0===p)n.offset=g.getFloat32(1,!0),h+=4;else throw"Invalid block offset type";c=Math.min(n.offset,c);if(1===n.encoding)if(p=g.getUint8(h),h++,n.bitsPerPixel=p&63,p>>=6,n.numValidPixelsType=p,2===p)n.numValidPixels=g.getUint8(h),h++;else if(1===p)n.numValidPixels=g.getUint16(h,!0),h+=2;else if(0===p)n.numValidPixels=g.getUint32(h,!0),h+=4;else throw"Invalid valid pixel count type";}l+=h;if(3!=n.encoding)if(0===n.encoding){g=(a.pixels.numBytes-1)/4;if(g!==Math.floor(g))throw"uncompressed block has invalid length";
h=new ArrayBuffer(4*g);p=new Uint8Array(h);p.set(new Uint8Array(r,l,4*g));h=new Float32Array(h);for(p=0;p<h.length;p++)c=Math.min(c,h[p]);n.rawData=h;l+=4*g}else 1===n.encoding&&(g=Math.ceil(n.numValidPixels*n.bitsPerPixel/8),h=new ArrayBuffer(4*Math.ceil(g/4)),p=new Uint8Array(h),p.set(new Uint8Array(r,l,g)),n.stuffedData=new Uint32Array(h),l+=g)}}a.pixels.minValue=c;a.eofOffset=l;r=null!=d.noDataValue?D.clampFloat32(d.noDataValue):q.defaultNoDataValue;var b=d.encodedMaskData,n=d.returnMask,g=0,
m=a.pixels.numBlocksX,c=a.pixels.numBlocksY,t=Math.floor(a.width/m),B=Math.floor(a.height/c),f=2*a.maxZError,b=b||(a.mask?a.mask.bitset:null),A,l=new (d.pixelType||Float32Array)(a.width*a.height);n&&b&&(A=new Uint8Array(a.width*a.height));for(var n=new Float32Array(t*B),v,u,h=0;h<=c;h++)if(p=h!==c?B:a.height%c,0!==p)for(var E=0;E<=m;E++){var x=E!==m?t:a.width%m;if(0!==x){var w=h*a.width*B+E*t,y=a.width-x,z=a.pixels.blocks[g],C,F;if(2>z.encoding){if(0===z.encoding)C=z.rawData;else{C=z.stuffedData;
F=z.bitsPerPixel;v=z.numValidPixels;u=z.offset;var H=f,N=n,K=a.pixels.maxValue,I=(1<<F)-1,G=0,J=void 0,L=0,R=void 0,P=void 0,S=Math.ceil((K-u)/H);C[C.length-1]<<=8*(4*C.length-Math.ceil(F*v/8));for(J=0;J<v;J++)0===L&&(P=C[G++],L=32),L>=F?(R=P>>>L-F&I,L-=F):(L=F-L,R=(P&I)<<L&I,P=C[G++],L=32-L,R+=P>>>L),N[J]=R<S?u+R*H:K;C=n}F=0}else k=2===z.encoding?0:z.offset;var U;if(b)for(u=0;u<p;u++){w&7&&(U=b[w>>3],U<<=w&7);for(v=0;v<x;v++)w&7||(U=b[w>>3]),U&128?(A&&(A[w]=1),l[w++]=2>z.encoding?C[F++]:k):(A&&(A[w]=
0),l[w++]=r),U<<=1;w+=y}else if(2>z.encoding)for(u=0;u<p;u++){for(v=0;v<x;v++)l[w++]=C[F++];w+=y}else for(u=0;u<p;u++)if(l.fill)l.fill(k,w,w+x),w+=x+y;else{for(v=0;v<x;v++)l[w++]=k;w+=y}if(1===z.encoding&&F!==z.numValidPixels)throw"Block and Mask do not match";g++}}k=A;A={width:a.width,height:a.height,pixelData:l,minValue:a.pixels.minValue,maxValue:a.pixels.maxValue,noDataValue:r};k&&(A.maskData=k);d.returnEncodedMask&&a.mask&&(A.encodedMaskData=a.mask.bitset?a.mask.bitset:null);if(d.returnFileInfo&&
(A.fileInfo=e(a),d.computeUsedBitDepths)){d=A.fileInfo;k=a.pixels.numBlocksX*a.pixels.numBlocksY;U={};for(C=0;C<k;C++)F=a.pixels.blocks[C],0===F.encoding?U.float32=!0:1===F.encoding?U[F.bitsPerPixel]=!0:U[0]=!0;a=Object.keys(U);d.bitDepths=a}return A};var e=function(e){return{fileIdentifierString:e.fileIdentifierString,fileVersion:e.fileVersion,imageType:e.imageType,height:e.height,width:e.width,maxZError:e.maxZError,eofOffset:e.eofOffset,mask:e.mask?{numBlocksX:e.mask.numBlocksX,numBlocksY:e.mask.numBlocksY,
numBytes:e.mask.numBytes,maxValue:e.mask.maxValue}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,numBytes:e.pixels.numBytes,maxValue:e.pixels.maxValue,minValue:e.pixels.minValue,noDataValue:this.noDataValue}}};return q})},"esri/layers/support/rasterFormats/Png":function(){define(["./Zlib"],function(D){return function(q){function e(d){var b,a,g,e;this.data=d;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(g=null;;){b=
this.readUInt32();e=d=void 0;e=[];for(d=0;4>d;++d)e.push(String.fromCharCode(this.data[this.pos++]));d=e.join("");switch(d){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};
break;case "PLTE":this.palette=this.read(b);break;case "fcTL":g&&this.animation.frames.push(g);this.pos+=4;g={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};d=this.readUInt16();b=this.readUInt16()||100;g.delay=1E3*d/b;g.disposeOp=this.data[this.pos++];g.blendOp=this.data[this.pos++];g.data=[];break;case "IDAT":case "fdAT":"fdAT"===d&&(this.pos+=4,b-=4);d=(null!=g?g.data:void 0)||this.imgData;for(e=0;0<=b?e<b:e>b;0<=b?++e:--e)d.push(this.data[this.pos++]);
break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=this.read(b);b=255-this.transparency.indexed.length;if(0<b)for(d=0;0<=b?d<b:d>b;0<=b?++d:--d)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(b)[0];break;case 2:this.transparency.rgb=this.read(b)}break;case "tEXt":e=this.read(b);b=e.indexOf(0);d=String.fromCharCode.apply(String,e.slice(0,b));this.text[d]=String.fromCharCode.apply(String,e.slice(b+1));break;case "IEND":g&&
this.animation.frames.push(g);a:{switch(this.colorType){case 0:case 3:case 4:g=1;break a;case 2:case 6:g=3;break a}g=void 0}this.colors=g;this.hasAlphaChannel=4===(a=this.colorType)||6===a;a=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*a;a:{switch(this.colors){case 1:a="DeviceGray";break a;case 3:a="DeviceRGB";break a}a=void 0}this.colorSpace=a;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=b}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");
}}var r,d,k;e.load=function(d,b,a){var g;"function"===typeof b&&(a=b);g=new XMLHttpRequest;g.open("GET",d,!0);g.responseType="arraybuffer";g.onload=function(){var d;d=new Uint8Array(g.response||g.mozResponseArrayBuffer);d=new e(d);"function"===typeof(null!=b?b.getContext:void 0)&&d.render(b);return"function"===typeof a?a(d):void 0};return g.send(null)};e.prototype.read=function(d){var b,a;a=[];for(b=0;0<=d?b<d:b>d;0<=d?++b:--b)a.push(this.data[this.pos++]);return a};e.prototype.readUInt32=function(){var d,
b,a,g;d=this.data[this.pos++]<<24;b=this.data[this.pos++]<<16;a=this.data[this.pos++]<<8;g=this.data[this.pos++];return d|b|a|g};e.prototype.readUInt16=function(){var d,b;d=this.data[this.pos++]<<8;b=this.data[this.pos++];return d|b};e.prototype.decodePixels=function(d){var b,a,g,e,c,l,k,f,h,n,p,A,v,u,q;null==d&&(d=this.imgData);if(0===d.length)return new Uint8Array(0);d=new D(d);d=d.getBytes();f=this.pixelBitlength/8;A=f*this.width;h=new Uint8Array(A*this.height);l=d.length;for(a=n=p=0;n<l;){switch(d[n++]){case 0:for(e=
b=0;b<A;e=b+=1)h[a++]=d[n++];break;case 1:for(e=v=0;v<A;e=v+=1)b=d[n++],c=e<f?0:h[a-f],h[a++]=(b+c)%256;break;case 2:for(e=c=0;c<A;e=c+=1)b=d[n++],g=(e-e%f)/f,v=p&&h[(p-1)*A+g*f+e%f],h[a++]=(v+b)%256;break;case 3:for(e=q=0;q<A;e=q+=1)b=d[n++],g=(e-e%f)/f,c=e<f?0:h[a-f],v=p&&h[(p-1)*A+g*f+e%f],h[a++]=(b+Math.floor((c+v)/2))%256;break;case 4:for(e=q=0;q<A;e=q+=1)b=d[n++],g=(e-e%f)/f,c=e<f?0:h[a-f],0===p?v=u=0:(v=h[(p-1)*A+g*f+e%f],u=g&&h[(p-1)*A+(g-1)*f+e%f]),k=c+v-u,e=Math.abs(k-c),g=Math.abs(k-v),
k=Math.abs(k-u),c=e<=g&&e<=k?c:g<=k?v:u,h[a++]=(b+c)%256;break;default:throw Error("Invalid filter algorithm: "+d[n-1]);}p++}return h};e.prototype.decodePalette=function(){var d,b,a,g,e,c,k,B,f;a=this.palette;c=this.transparency.indexed||[];e=new Uint8Array((c.length||0)+a.length);b=k=d=g=0;for(B=a.length;k<B;b=k+=3)e[g++]=a[b],e[g++]=a[b+1],e[g++]=a[b+2],e[g++]=null!=(f=c[d++])?f:255;return e};e.prototype.copyToImageData=function(d,b){var a,g,e,c,l,k,f;g=this.colors;f=null;a=this.hasAlphaChannel;
this.palette.length&&(f=null!=(e=this._decodedPalette)?e:this._decodedPalette=this.decodePalette(),g=4,a=!0);d=d.data||d;k=d.length;c=f||b;e=l=0;if(1===g)for(;e<k;)g=f?4*b[e/4]:l,l=c[g++],d[e++]=l,d[e++]=l,d[e++]=l,d[e++]=a?c[g++]:this.transparency.grayscale&&this.transparency.grayscale===l?0:255,l=g;else for(;e<k;)g=f?4*b[e/4]:l,d[e++]=c[g++],d[e++]=c[g++],d[e++]=c[g++],d[e++]=a?c[g++]:this.transparency.rgb&&this.transparency.rgb[1]===c[g-3]&&this.transparency.rgb[3]===c[g-2]&&this.transparency.rgb[5]===
c[g-1]?0:255,l=g};e.prototype.decode=function(){var d;d=new Uint8Array(this.width*this.height*4);this.copyToImageData(d,this.decodePixels());return d};k=(d=q.document&&q.document.createElement("canvas"))&&d.getContext("2d");r=function(e){k.width=e.width;k.height=e.height;k.clearRect(0,0,e.width,e.height);k.putImageData(e,0,0);e=new Image;e.src=d.toDataURL();return e};e.prototype.decodeFrames=function(d){var b,a,g,e,c,l,k;if(this.animation){l=this.animation.frames;k=[];b=e=0;for(c=l.length;e<c;b=++e)b=
l[b],a=d.createImageData(b.width,b.height),g=this.decodePixels(new Uint8Array(b.data)),this.copyToImageData(a,g),b.imageData=a,k.push(b.image=r(a));return k}};e.prototype.renderFrame=function(d,b){var a,g;g=this.animation.frames;a=g[b];g=g[b-1];0===b&&d.clearRect(0,0,this.width,this.height);1===(null!=g?g.disposeOp:void 0)?d.clearRect(g.xOffset,g.yOffset,g.width,g.height):2===(null!=g?g.disposeOp:void 0)&&d.putImageData(g.imageData,g.xOffset,g.yOffset);0===a.blendOp&&d.clearRect(a.xOffset,a.yOffset,
a.width,a.height);return d.drawImage(a.image,a.xOffset,a.yOffset)};e.prototype.animate=function(d){var b,a,g,e,c,l,k=this;a=0;l=this.animation;e=l.numFrames;g=l.frames;c=l.numPlays;return(b=function(){var f,h;f=a++%e;h=g[f];k.renderFrame(d,f);if(1<e&&a/e<c)return k.animation._timeout=setTimeout(b,h.delay)})()};e.prototype.stopAnimation=function(){var d;return clearTimeout(null!=(d=this.animation)?d._timeout:void 0)};e.prototype.render=function(d){var b;d._png&&d._png.stopAnimation();d._png=this;d.width=
this.width;d.height=this.height;d=d.getContext("2d");if(this.animation)return this.decodeFrames(d),this.animate(d);b=d.createImageData(this.width,this.height);this.copyToImageData(b,this.decodePixels());return d.putImageData(b,0,0)};return e}(this)})},"esri/layers/support/rasterFormats/Raw":function(){define(["require","exports"],function(D,q){var e=function(e){var d=1;switch(e){case Uint8Array:case Int8Array:d=1;break;case Uint16Array:case Int16Array:d=2;break;case Uint32Array:case Int32Array:case Float32Array:d=
4;break;case Float64Array:d=8}return d};return function(){function q(){}q.decode=function(d,k){var l=k.pixelType,b=[],a=k.width*k.height,g=Math.floor(d.byteLength/(k.width*k.height*e(k.pixelType))),m=k.bandIds,c=k.format;k=m&&m.length||Math.floor(d.byteLength/(k.width*k.height*e(k.pixelType)));var t=d.byteLength-d.byteLength%(a*e(l)),B=new l(d,0,a*g),f,h,n,p;if("bip"===c)for(c=0;c<k;c++){n=new l(a);p=m?m[c]:c;for(f=0;f<a;f++)n[f]=B[f*g+p];b.push(n)}else if("bsq"===c)for(c=0;c<k;c++)p=m?m[c]:c,b.push(B.subarray(p*
a,(p+1)*a));if(t<d.byteLength-1)if(d=d.slice(t),8*d.byteLength<a)h=null;else{d=new Uint8Array(d,0,Math.ceil(a/8));l=new Uint8Array(a);for(h=k=h=m=g=0;h<d.length-1;h++)for(m=d[h],k=7;0<=k;k--)l[g++]=m>>k&1;for(k=7;g<a-1;)m=d[d.length-1],l[g++]=m>>k&1,k--;h=l}return{pixels:b,mask:h}};return q}()})},"esri/layers/support/rasterFormats/TiffDecoder":function(){define("require exports tslib ../rasterDatasets/byteStreamUtils ./Jpg ./TiffTags ./Zlib".split(" "),function(D,q,e,r,d,k,l){function b(a,b){var c=
"unknown";3===a?c="f32":1===a?1===b?c="u1":2===b?c="u2":4===b?c="u4":8>=b?c="u8":16>=b?c="u16":32>=b&&(c="u32"):2===a&&(8>=b?c="s8":16>=b?c="s16":32>=b&&(c="s32"));return c}function a(a){var b=null;switch(a?a.toLowerCase():"f32"){case "u1":case "u2":case "u4":case "u8":b=Uint8Array;break;case "u16":b=Uint16Array;break;case "u32":b=Uint32Array;break;case "s8":b=Int8Array;break;case "s16":b=Int16Array;break;case "s32":b=Int32Array;break;default:b=Float32Array}return b}function g(a,b){return{x:b[0]*
a.x+b[1]*a.y+b[2],y:b[3]*a.x+b[4]*a.y+b[5]}}function m(a,b){return(a=a.get(b))&&a.values}function c(a,b){return(a=a.get(b))&&a.values[0]}function t(a,b,c,d,g,e){void 0===d&&(d=0);void 0===g&&(g=k.TIFF_TAGS);void 0===e&&(e=4);var f=(new DataView(a,c,2)).getUint16(0,b),h=4+2*e,m=2+f*h;if(c+m>a.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:m};var l=c+m+4<=a.byteLength?(new DataView(a,c+m,4)).getUint32(0,b):null;c+=2;for(var n=new Map,p,t,u,w,y,x,v=0;v<f;v++){p=new DataView(a,
c+h*v,h);t=p.getUint16(0,b);w=p.getUint16(2,b);u=k.getTagName(t,g);if(2===e)y=p.getUint16(4,b),x=p.getUint16(6,b);else if(4===e)y=p.getUint32(4,b),x=p.getUint32(8,b);else if(8===e)if(x=y=0,b)for(var A=0;8>A;A++)y+=p.getUint8(4+A)*Math.pow(2,8*A),x+=p.getUint8(12+A)*Math.pow(2,8*A);else for(A=0;8>A;A++)y+=p.getUint8(4+A)*Math.pow(2,8*(7-A)),x+=p.getUint8(12+A)*Math.pow(2,8*(7-A));p={id:t,type:w,valueCount:y,valueOffset:x,values:null};B(a,b,p,d);n.set(u,p)}return{success:!0,ifd:n,nextIFD:l,requiredBufferSize:m}}
function B(a,b,c,d,e){void 0===d&&(d=0);if(c.values)return!0;var g=c.type,f=c.valueCount,h=c.valueOffset,m=[],l=A[g],n=8*l,k=f*l,p=f*A[g]*8;if(32<p&&k>(e?a.byteLength:a?a.byteLength-h+d:0))return c.offlineOffsetSize=[h,k],c.values=null,!1;if(32>=p)if(b||(h>>>=32-p),1===f)m=[h];else for(a=0;a<f;a++)m.push(h<<n*a>>>32-n);else for(h-=d,e&&(h=0),n=h;n<h+k;n+=l){switch(g){case 1:f=(new DataView(a,n,1)).getUint8(0);break;case 2:f=(new DataView(a,n,1)).getUint8(0);break;case 3:f=(new DataView(a,n,2)).getUint16(0,
b);break;case 4:f=(new DataView(a,n,4)).getUint32(0,b);break;case 5:f=(new DataView(a,n,4)).getUint32(0,b)/(new DataView(a,n+4,4)).getUint32(0,b);break;case 6:f=(new DataView(a,n,1)).getInt8(0);break;case 7:f=(new DataView(a,n,1)).getUint8(0);break;case 8:f=(new DataView(a,n,2)).getInt16(0,b);break;case 9:f=(new DataView(a,n,4)).getInt32(0,b);break;case 10:f=(new DataView(a,n,4)).getInt32(0,b)/(new DataView(a,n+4,4)).getInt32(0,b);break;case 11:f=(new DataView(a,n,4)).getFloat32(0,b);break;case 12:f=
(new DataView(a,n,8)).getFloat64(0,b);break;default:f=null}m.push(f)}if(2===g){g="";h=m;m=[];for(a=0;a<h.length;a++)0===h[a]&&""!==g?(m.push(g),g=""):g+=String.fromCharCode(h[a]);""===g&&0!==m.length||m.push(g)}c.values=m;return!0}function f(a){var d=a[0],f=c(d,"TILEWIDTH"),e=c(d,"TILELENGTH"),h=c(d,"IMAGEWIDTH"),n=c(d,"IMAGELENGTH"),l=c(d,"BITSPERSAMPLE"),k=c(d,"SAMPLESPERPIXEL"),p=c(d,"SAMPLEFORMAT")||1,t=b(p,l),u=m(d,"PLANARCONFIGURATION")?2===m(d,"PLANARCONFIGURATION")[0]:!1,A=m(d,"GDAL_NODATA"),
v;null!=A&&("string"===typeof A[0]?(v=A.map(function(a){return parseFloat(a)}),v.some(function(a){return isNaN(a)})&&(v=null)):"number"===typeof A[0]&&(v=A));var x=c(d,"COMPRESSION")||1;switch(x){case 1:A="NONE";break;case 2:case 3:case 4:case 32771:A="CCITT";break;case 5:A="LZW";break;case 6:case 7:A="JPEG";break;case 32773:A="PACKBITS";break;case 8:case 32946:A="DEFLATE";break;case 34712:A="JPEG2000";break;default:A=String(x)}var B=!0,q="";1!==x&&6!==x&&8!==x&&32946!==x&&(B=!1,q+="unsupported tag compression "+
x);3<p&&(B=!1,q+="unsupported tag sampleFormat "+p);0!==l%8&&(B=!1,q+="unsupported tag bitsPerSample "+l);var l=c(d,"GEOASCIIPARAMS"),r;l&&(r=(r=l.split("|").filter(function(a){return-1<a.indexOf("ESRI PE String \x3d ")})[0])?r.replace("ESRI PE String \x3d ",""):"",r=0===r.indexOf("PROJCS")||0===r.indexOf("GEOGCS")?{wkid:null,wkt:r}:null);var l=m(d,"GEOTIEPOINTS"),p=m(d,"GEOPIXELSCALE"),x=m(d,"GEOTRANSMATRIX"),D=d.has("GEOKEYDIRECTORY")?d.get("GEOKEYDIRECTORY").data:null,d=!1;if(D){var d=2===c(D,
"GTRasterTypeGeoKey"),T=c(D,"GTModelTypeGeoKey");2===T?(D=c(D,"GeographicTypeGeoKey"),1024<D&&32766>D&&(r={wkid:D})):1===T&&(D=c(D,"ProjectedCSTypeGeoKey"),1024<D&&32766>D&&(r={wkid:D}))}var O,V;p&&l&&6<=l.length?(O=[p[0],0,l[3]-l[0]*p[0],0,-Math.abs(p[1]),l[4]-l[1]*p[1]],d&&(O[2]-=.5*O[0]+.5*O[1],O[5]-=.5*O[3]+.5*O[4])):x&&16===x.length&&(O=[x[0],x[1],x[3],x[4],x[5],x[7]]);if(O){V=[{x:0,y:n},{x:0,y:0},{x:h,y:n},{x:h,y:0}];d=void 0;p=l=Number.POSITIVE_INFINITY;D=x=Number.NEGATIVE_INFINITY;for(T=0;T<
V.length;T++)d=g(V[T],O),l=d.x>l?l:d.x,x=d.x<x?x:d.x,p=d.y>p?p:d.y,D=d.y<D?D:d.y;V={xmin:l,xmax:x,ymin:p,ymax:D,spatialReference:r}}O=a.filter(function(a){return 1===c(a,"NEWSUBFILETYPE")});var M,Q,X,Y;0<O.length&&(M=Math.round(Math.log(h/c(O[0],"IMAGEWIDTH"))/Math.LN2),Q=Math.round(Math.log(h/c(O[O.length-1],"IMAGEWIDTH"))/Math.LN2),X=c(O[O.length-1],"TILEWIDTH"),Y=c(O[O.length-1],"TILEHEIGHT"));X=0<Q?X||f:null;Y=0<Q?Y||e:null;var Z;f&&(Z=[{maxCol:Math.ceil(h/f)-1,maxRow:Math.ceil(n/e)-1,minRow:0,
minCol:0}],O.forEach(function(a){Z.push({maxCol:Math.ceil(c(a,"IMAGEWIDTH")/c(a,"TILEWIDTH"))-1,maxRow:Math.ceil(c(a,"IMAGELENGTH")/c(a,"TILELENGTH"))-1,minRow:0,minCol:0})}));a=c(a[0],"GDAL_METADATA");a=E(a);return{width:h,height:n,tileWidth:f,tileHeight:e,planes:k,isBSQ:u,pixelType:t,compression:A,noData:v,isSupported:B,message:q,extent:V,firstPyramidLevel:M,maximumPyramidLevel:Q,pyramidBlockWidth:X,pyramidBlockHeight:Y,tileBoundary:Z,metadata:a}}function h(a){var b=new DataView(a,0,8),c=b.getUint16(0,
!1),d=null;if(18761===c)d=!0;else if(19789===c)d=!1;else throw"unexpected endianess byte";if(42!==b.getUint16(2,d))throw"unexpected tiff identifier";c=b.getUint32(4,d);b=[];do if(c=n(a,d,c),c.success)b.push(c.ifd),c=c.nextIFD;else break;while(0<c);a=f(b);return e.__assign(e.__assign({},a),{littleEndian:d,ifds:b})}function n(a,b,c,d,g,f){void 0===d&&(d=0);void 0===g&&(g=k.TIFF_TAGS);void 0===f&&(f=4);c=t(a,b,c,d,g,f);var e,h=c.ifd;h&&(k.ifdTags.forEach(function(c,g){h.has(g)&&(e=h.get(g),e.data=t(a,
b,e.valueOffset-d,d,c).ifd)}),h.has("GEOKEYDIRECTORY")&&(e=h.get("GEOKEYDIRECTORY"),(g=e.values)&&4<g.length&&(g=g[0]+"."+g[1]+"."+g[2],e.data=t(a,b,e.valueOffset+6-d,d,k.GEO_KEYS,2).ifd,e.data&&e.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[g]}))),h.has("XMP")&&(e=h.get("XMP"),g=e.values,"number"===typeof g[0]&&7===e.type&&(e.values=[r.bytesToUTF8(new Uint8Array(g))])));return c}Object.defineProperty(q,"__esModule",{value:!0});var p=function(){var a=new ArrayBuffer(4),
b=new Uint8Array(a);(new Uint32Array(a))[0]=1;return 1===b[0]}(),A=[0,1,1,2,4,8,1,1,2,4,8,4,8],v=function(g,e,f,h,m){e=p===e;var n=c(f,"BITSPERSAMPLE"),k=c(f,"SAMPLEFORMAT")||1,n=b(k,n),k=c(f,"COMPRESSION")[0]||1;f=a(n);var t,u;1===k?(t=g.slice(h,h+m),u=new Uint8Array(t)):8===k||32946===k?(u=new Uint8Array(g,h,m),u=new l(u),g=u.getBytes(),t=new ArrayBuffer(g.length),u=new Uint8Array(t),u.set(g)):6===k&&(u=new Uint8Array(g,h,m),t=new d,t.parse(u),g=t.getData(t.width,t.height,!0),t=new ArrayBuffer(g.length),
u=new Uint8Array(t),u.set(g));if("u8"!==n&&"s8"!==n&&!e)switch(t=new ArrayBuffer(u.length),e=new Uint8Array(t),n){case "u16":case "s16":for(n=0;n<u.length;n+=2)e[n]=u[n+1],e[n+1]=u[n];break;case "u32":case "s32":case "f32":for(n=0;n<u.length;n+=4)e[n]=u[n+3],e[n+1]=u[n+2],e[n+2]=u[n+1],e[n+3]=u[n]}return new f(t)},u=function(a,b,c){if(!(a&&0<a.length&&b&&c))return null;for(var d,g,e,f=a[0].length,h=a.length,m=new Uint8Array(f),n=0;n<h;n++)if(d=a[n],g=b[n],e=c[n],0===n)for(var l=0;l<f;l++)m[l]=d[l]<
g||d[l]>e?0:1;else for(l=0;l<f;l++)m[l]&&(m[l]=d[l]<g||d[l]>e?0:1);return m},E=function(a){if(!a)return null;var b=a.match(/<Item(.*?)Item>/gi);if(!b||0===b.length)return null;a=new Map;for(var c,d,g,e,f=0;f<b.length;f++)c=b[f],d=c.slice(6,c.indexOf("\x3e")),g=c.indexOf("sample\x3d"),-1<g&&(e=c.slice(g+8,c.indexOf('"',g+8))),g=c.indexOf("name\x3d"),-1<g&&(d=c.slice(g+6,c.indexOf('"',g+6))),d&&(c=c.slice(c.indexOf("\x3e")+1,c.indexOf("\x3c/Item\x3e")).trim(),null!=e?a.has(d)?a.get(d)[e]=c:a.set(d,
[c]):a.set(d,c)),e=null;b=a.get("STATISTICS_MINIMUM");d=a.get("STATISTICS_MAXIMUM");c=a.get("STATISTICS_MEAN");g=a.get("STATISTICS_STDDEV");e=null;if(b&&d)for(e=[],f=0;f<b.length;f++)e.push({min:parseFloat(b[f]),max:parseFloat(d[f]),avg:c&&parseFloat(c[f]),stddev:g&&parseFloat(g[f])});d=a.get("BandName");c=a.get("WavelengthMin");g=a.get("WavelengthMax");b=null;if(d)for(b=[],f=0;f<d.length;f++)b.push({BandName:d[f],WavelengthMin:c&&parseFloat(c[f]),WavelengthMax:g&&parseFloat(g[f])});f=a.get("DataType");
return{statistics:e,bandProperties:b,dataType:f,rawMetadata:a}};q.parseFieldValues=B;q.getImageInfo=f;q.parseHeader=h;q.parseSignature=function(a){var b=new DataView(a,0,8),c=b.getUint16(0,!1);a=null;if(18761===c)a=!0;else if(19789===c)a=!1;else throw"unexpected endianess byte";if(42!==b.getUint16(2,a))throw"unexpected tiff identifier";b=b.getUint32(4,a);return{littleEndian:a,firstIFD:b}};q.parseIFD=n;q.decodeTileOrStrip=function(b,d){var g=d.headerInfo,e=d.ifd,f=v(b,g.littleEndian,e,d.offset||0,
d.size||b.byteLength);b=g.pixelType;for(var h=g.isBSQ,m=g.planes,n=a(b),l=f.length/m,k,p=[],t=0;t<m;t++){k=new n(l);if(h)k=f.slice(l*t,l*(t+1));else for(var A=0;A<l;A++)k[A]=f[A*m+t];p.push(k)}var f=c(e,"TILEWIDTH"),e=c(e,"TILELENGTH"),h=g.noData?g.noData[0]:null,g=(m=g.metadata?g.metadata.statistics:null)?m.map(function(a){return a.min}):null,m=m?m.map(function(a){return a.max}):null,B;if(null!=h)if(B=new Uint8Array(l),1E24<Math.abs(h))for(d=0;d<l;d++)B[d]=1E-6>Math.abs((p[0][d]-h)/h)?0:1;else for(d=
0;d<l;d++)B[d]=p[0][d]===h?0:1;else g&&m&&d.applyMinMaxConstraint&&(B=u(p,g,m));return{pixelType:b,width:f,height:e,pixels:p,mask:B,noDataValue:h}};q.decode=function(b,c){c=c||h(b);var g=c.ifds,e=c.noData;if(0===g.length)throw"no valid image file directory";g=g[0];e=e?e[0]:null;if(c.tileWidth){var f=m(g,"TILEOFFSETS");if(void 0===f)g=null;else{for(var n=m(g,"TILEBYTECOUNTS"),k=c.tileWidth,t=c.tileHeight,u=c.width,A=c.height,B=c.pixelType,q=c.isBSQ,r=c.planes,x=u*A,w=m(g,"BITSPERSAMPLE")[0],E=a(B),
D=[],W=0;W<r;W++)D.push(new E(x));var T,O,V,M,Q,X,Y,Z,x=Math.ceil(u/k);if(0===w%8)for(w=0;w<f.length;w++)for(T=Math.floor(w/x)*t,M=w%x*k,W=T*u+M,E=v(b,c.littleEndian,g,f[w],n[w]),X=0,Q=W,M=Math.min(k,u-M),Y=Math.min(t,A-T),T=0;T<r;T++)if(Z=D[T],q)for(O=0;O<Y;O++)for(Q=W+O*u,X=k*t*T+O*k,V=0;V<M;V++,Q++,X++)Z[Q]=E[X];else for(O=0;O<Y;O++)for(Q=W+O*u,X=O*k*r+T,V=0;V<M;V++,Q++,X+=r)Z[Q]=E[X];g={width:u,height:A,pixelType:B,pixels:D}}}else if(t=c,D=p===t.littleEndian,x=m(g,"STRIPOFFSETS"),void 0===x)g=
null;else{c=t.width;f=t.height;n=t.pixelType;t=t.planes;u=c*f;w=m(g,"BITSPERSAMPLE")[0];A=a(n);B=new A(u*t);E=m(g,"STRIPBYTECOUNTS");W=m(g,"ROWSPERSTRIP")[0];Q=m(g,"COMPRESSION")?m(g,"COMPRESSION")[0]:1;M=W;if(0===w%8)for(g=0;g<x.length;g++){X=g*W*c*t;M=(g+1)*W>f?f-g*W:W;if("u8"===n||"s8"===n||D)8===Q||32946===Q?(q=new Uint8Array(b,x[g],E[g]),q=new l(q),T=q.getBytes(),r=new ArrayBuffer(T.length),q=new Uint8Array(r),q.set(T),q.length!==M*c*t*w/8&&console.log("strip byte counts is different than expected")):
6===Q?(q=new Uint8Array(b,x[g],E[g]),r=new d,r.parse(q),M=r.getData(r.width,r.height,!0),r=new ArrayBuffer(M.length),q=new Uint8Array(r),q.set(M)):1===Q&&(E[g]!==M*c*t*w/8&&console.log("strip byte counts is different than expected"),r=b.slice(x[g],x[g]+E[g]));else switch(6===Q||8===Q||32946===Q?(q=new Uint8Array(b,x[g],E[g]),q=new l(q),q=q.getBytes(),r=new ArrayBuffer(q.length),k=new Uint8Array(r),q.length!==M*c*t*w/8&&console.log("strip byte counts is different than expected")):1===Q&&(E[g]!==M*
c*t*w/8&&console.log("strip byte counts is different than expected"),r=new ArrayBuffer(E[g]),q=new Uint8Array(b,x[g],E[g]),k=new Uint8Array(r)),n){case "u16":case "s16":for(M=0;M<q.length;M+=2)k[M]=q[M+1],k[M+1]=q[M];break;case "u32":case "s32":case "f32":for(M=0;M<q.length;M+=4)k[M]=q[M+3],k[M+1]=q[M+2],k[M+2]=q[M+1],k[M+3]=q[M]}M=new A(r);B.set(M,X)}q=[];if(1===t)q.push(B);else for(g=0;g<t;g++){k=new A(u);for(b=0;b<u;b++)k[b]=B[b*t+g];q.push(k)}g={width:c,height:f,pixelType:n,pixels:q}}if(null!==
e){g.mask=new Uint8Array(g.width*g.height);if(1E24<Math.abs(e))for(b=0;b<g.width*g.height;b++)g.mask[b]=1E-6>Math.abs((g.pixels[0][b]-e)/e)?0:1;else for(b=0;b<g.width*g.height;b++)g.mask[b]=g.pixels[0][b]===e?0:1;g.noDataValue=e}return g}})},"esri/layers/support/rasterDatasets/byteStreamUtils":function(){define(["require","exports"],function(D,q){Object.defineProperty(q,"__esModule",{value:!0});q.bytesToUTF8=function(e,q){for(var d=0,k="",l=0,b=0,a=e.length;d<a;)if(b=e[d++],l=b>>4,8>l?l=1:15===l?
(l=4,b=(b&7)<<18|(e[d++]&63)<<12|(e[d++]&63)<<6|e[d++]&63):14===l?(l=3,b=(b&15)<<12|(e[d++]&63)<<6|e[d++]&63):(l=2,b=(b&31)<<6|e[d++]&63),0!==b||q)k+=String.fromCharCode(b);return k}})},"esri/layers/support/rasterFormats/TiffTags":function(){define(["require","exports"],function(D,q){var e=function(){var d=[];d[254]="NEWSUBFILETYPE";d[255]="SUBFILETYPE";d[256]="IMAGEWIDTH";d[257]="IMAGELENGTH";d[258]="BITSPERSAMPLE";d[259]="COMPRESSION";d[262]="PHOTOMETRICINTERPRETATION";d[263]="THRESHHOLDING";d[264]=
"CELLWIDTH";d[265]="CELLLENGTH";d[266]="FILLORDER";d[269]="DOCUMENTNAME";d[270]="IMAGEDESCRIPTION";d[271]="MAKE";d[272]="MODEL";d[273]="STRIPOFFSETS";d[274]="ORIENTATION";d[277]="SAMPLESPERPIXEL";d[278]="ROWSPERSTRIP";d[279]="STRIPBYTECOUNTS";d[280]="MINSAMPLEVALUE";d[281]="MAXSAMPLEVALUE";d[282]="XRESOLUTION";d[283]="YRESOLUTION";d[284]="PLANARCONFIGURATION";d[285]="PAGENAME";d[286]="XPOSITION";d[287]="YPOSITION";d[288]="FREEOFFSETS";d[289]="FREEBYTECOUNTS";d[290]="GRAYRESPONSEUNIT";d[291]="GRAYRESPONSECURVE";
d[292]="T4OPTIONS";d[293]="T6OPTIONS";d[296]="RESOLUTIONUNIT";d[297]="PAGENUMBER";d[300]="COLORRESPONSEUNIT";d[301]="TRANSFERFUNCTION";d[305]="SOFTWARE";d[306]="DATETIME";d[315]="ARTIST";d[316]="HOSTCOMPUTER";d[317]="PREDICTOR";d[318]="WHITEPOINT";d[319]="PRIMARYCHROMATICITIES";d[320]="COLORMAP";d[321]="HALFTONEHINTS";d[322]="TILEWIDTH";d[323]="TILELENGTH";d[324]="TILEOFFSETS";d[325]="TILEBYTECOUNTS";d[326]="BADFAXLINES";d[327]="CLEANFAXDATA";d[328]="CONSECUTIVEBADFAXLINES";d[330]="SUBIFD";d[332]=
"INKSET";d[333]="INKNAMES";d[334]="NUMBEROFINKS";d[336]="DOTRANGE";d[337]="TARGETPRINTER";d[338]="EXTRASAMPLES";d[339]="SAMPLEFORMAT";d[340]="SMINSAMPLEVALUE";d[341]="SMAXSAMPLEVALUE";d[342]="TRANSFERRANGE";d[347]="JPEGTABLES";d[512]="JPEGPROC";d[513]="JPEGIFOFFSET";d[514]="JPEGIFBYTECOUNT";d[515]="JPEGRESTARTINTERVAL";d[517]="JPEGLOSSLESSPREDICTORS";d[518]="JPEGPOINTTRANSFORM";d[519]="JPEGQTABLES";d[520]="JPEGDCTABLES";d[521]="JPEGACTABLES";d[529]="YCBCRCOEFFICIENTS";d[530]="YCBCRSUBSAMPLING";d[531]=
"YCBCRPOSITIONING";d[532]="REFERENCEBLACKWHITE";d[700]="XMP";d[33550]="GEOPIXELSCALE";d[33922]="GEOTIEPOINTS";d[33432]="COPYRIGHT";d[42112]="GDAL_METADATA";d[42113]="GDAL_NODATA";d[50844]="RPCCOEFFICIENT";d[34264]="GEOTRANSMATRIX";d[34735]="GEOKEYDIRECTORY";d[34736]="GEODOUBLEPARAMS";d[34737]="GEOASCIIPARAMS";d[34665]="EXIFIFD";d[34853]="GPSIFD";d[40965]="INTEROPERABILITYIFD";return d}();D=function(){var d=[].concat(e);d[36864]="ExifVersion";d[40960]="FlashpixVersion";d[40961]="ColorSpace";d[42240]=
"Gamma";d[37121]="ComponentsConfiguration";d[37122]="CompressedBitsPerPixel";d[40962]="PixelXDimension";d[40963]="PixelYDimension";d[37500]="MakerNote";d[37510]="UserComment";d[40964]="RelatedSoundFile";d[36867]="DateTimeOriginal";d[36868]="DateTimeDigitized";d[36880]="OffsetTime";d[36881]="OffsetTimeOriginal";d[36882]="OffsetTimeDigitized";d[37520]="SubSecTime";d[37521]="SubSecTimeOriginal";d[37522]="SubSecTimeDigitized";d[37888]="Temperature";d[37889]="Humidity";d[37890]="Pressure";d[37891]="WaterDepth";
d[37892]="Acceleration";d[37893]="CameraElevationAngle";d[42016]="ImageUniqueID";d[42032]="CameraOwnerName";d[42033]="BodySerialNumber";d[42034]="LensSpecification";d[42035]="LensMake";d[42036]="LensModel";d[42037]="LensSerialNumber";d[33434]="ExposureTime";d[33437]="FNumber";d[34850]="ExposureProgram";d[34852]="SpectralSensitivity";d[34855]="PhotographicSensitivity";d[34856]="OECF";d[34864]="SensitivityType";d[34865]="StandardOutputSensitivity";d[34866]="RecommendedExposureIndex";d[34867]="ISOSpeed";
d[34868]="ISOSpeedLatitudeyyy";d[34869]="ISOSpeedLatitudezzz";d[37377]="ShutterSpeedValue";d[37378]="ApertureValue";d[37379]="BrightnessValue";d[37380]="ExposureBiasValue";d[37381]="MaxApertureValue";d[37382]="SubjectDistance";d[37383]="MeteringMode";d[37384]="LightSource";d[37385]="Flash";d[37386]="FocalLength";d[37396]="SubjectArea";d[41483]="FlashEnergy";d[41484]="SpatialFrequencyResponse";d[41486]="FocalPlaneXResolution";d[41487]="FocalPlaneYResolution";d[41488]="FocalPlaneResolutionUnit";d[41492]=
"SubjectLocation";d[41493]="ExposureIndex";d[41495]="SensingMethod";d[41728]="FileSource";d[41729]="SceneType";d[41730]="CFAPattern";d[41985]="CustomRendered";d[41986]="ExposureMode";d[41987]="WhiteBalance";d[41988]="DigitalZoomRatio";d[41989]="FocalLengthIn35mmFilm";d[41990]="SceneCaptureType";d[41991]="GainControl";d[41992]="Contrast";d[41993]="Saturation";d[41994]="Sharpness";d[41995]="DeviceSettingDescription";d[41996]="SubjectDistanceRange";return d}();q=function(){var d=[];d[1024]="GTModelTypeGeoKey";
d[1025]="GTRasterTypeGeoKey";d[1026]="GTCitationGeoKey";d[2048]="GeographicTypeGeoKey";d[2049]="GeogCitationGeoKey";d[2050]="GeogGeodeticDatumGeoKey";d[2051]="GeogPrimeMeridianGeoKey";d[2052]="GeogLinearUnitsGeoKey";d[2053]="GeogLinearUnitSizeGeoKey";d[2054]="GeogAngularUnitsGeoKey";d[2055]="GeogAngularUnitSizeGeoKey";d[2056]="GeogEllipsoidGeoKey";d[2057]="GeogSemiMajorAxisGeoKey";d[2058]="GeogSemiMinorAxisGeoKey";d[2059]="GeogInvFlatteningGeoKey";d[2061]="GeogPrimeMeridianLongGeoKey";d[2060]="GeogAzimuthUnitsGeoKey";
d[3072]="ProjectedCSTypeGeoKey";d[3073]="PCSCitationGeoKey";d[3074]="ProjectionGeoKey";d[3075]="ProjCoordTransGeoKey";d[3076]="ProjLinearUnitsGeoKey";d[3077]="ProjLinearUnitSizeGeoKey";d[3078]="ProjStdParallel1GeoKey";d[3079]="ProjStdParallel2GeoKey";d[3080]="ProjNatOriginLongGeoKey";d[3081]="ProjNatOriginLatGeoKey";d[3082]="ProjFalseEastingGeoKey";d[3083]="ProjFalseNorthingGeoKey";d[3084]="ProjFalseOriginLongGeoKey";d[3085]="ProjFalseOriginLatGeoKey";d[3086]="ProjFalseOriginEastingGeoKey";d[3087]=
"ProjFalseOriginNorthingGeoKey";d[3088]="ProjCenterLongGeoKey";d[3090]="ProjCenterEastingGeoKey";d[3091]="ProjCenterNorthingGeoKey";d[3092]="ProjScaleAtNatOriginGeoKey";d[3093]="ProjScaleAtCenterGeoKey";d[3094]="ProjAzimuthAngleGeoKey";d[3095]="ProjStraightVertPoleLongGeoKey";d[4096]="VerticalCSTypeGeoKey";d[4097]="VerticalCitationGeoKey";d[4098]="VerticalDatumGeoKey";d[4099]="VerticalUnitsGeoKey";return d}();var r=new Map;r.set("EXIFIFD",D);r.set("GPSIFD","GPSVersionID GPSLatitudeRef GPSLatitude GPSLongitudeRef GPSLongitude GPSAltitudeRef GPSAltitude GPSTimeStamp GPSSatellites GPSStatus GPSMeasureMode GPSDOP GPSSpeedRef GPSSpeed GPSTrackRef GPSTrack GPSImgDirectionRef GPSImgDirection GPSMapDatum GPSDestLatitudeRef GPSDestLatitude GPSDestLongitudeRef GPSDestLongitude GPSDestBearingRef GPSDestBearing GPSDestDistanceRef GPSDestDistance GPSProcessingMethod GPSAreaInformation GPSDateStamp GPSDifferential GPSHPositioningError".split(" "));
return{TIFF_TAGS:e,ifdTags:r,GEO_KEYS:q,getTagName:function(d,k){k=(k||e)[d];void 0===k&&(k="unknown"+String(d));return k}}})},"esri/renderers/support/RasterSymbolizer":function(){define("require exports tslib ../../rasterRenderers ../../core/colorUtils ../../core/JSONSupport ../../core/Logger ../../core/accessorSupport/decorators ../../layers/support/RasterInfo ../../layers/support/rasterFunctions/pixelUtils ../../layers/support/rasterFunctions/surfaceUtils ../support/colorRampUtils".split(" "),
function(D,q,e,r,d,k,l,b,a,g,m,c){var t=l.getLogger("esri.renderers.support.RasterSymbolizer");return function(l){function f(a){return l.call(this,a)||this}e.__extends(f,l);f.prototype.readRenderer=function(a,b,c){return r.read(a,c)};f.prototype.bind=function(){if(!this.renderer)return!1;this.lookup={rendererJson:{}};var a;switch(this.renderer.type){case "unique-value":a=this._updateUVRenderer(this.renderer);break;case "raster-colormap":a=this._updateColormapRenderer(this.renderer);break;case "raster-stretch":a=
this._updateStretchRenderer(this.renderer);break;case "class-breaks":a=this._updateClassBreaksRenderer(this.renderer);break;case "raster-shaded-relief":a=this._updateShadedReliefRenderer(this.renderer)}return a};f.prototype.symbolize=function(a){var b=a&&a.pixelBlock;if(!this.isValidPixelBlock(b))return b;if(a.simpleStretchParams&&"raster-stretch"===this.renderer.type)return this.simpleStretch(b,a.simpleStretchParams);try{3<b.pixels.length&&(b=g.extractBands(b,[0,1,2]));var c=void 0;switch(this.renderer.type){case "unique-value":case "raster-colormap":c=
this._symbolize_colormap(b);break;case "class-breaks":c=this._symbolize_classBreaks(b);break;case "raster-stretch":c=this._symbolize_stretch(b,a.bandIds);break;case "raster-shaded-relief":var d=a.extent,c=this._symbolize_shadedRelief(b,{isGCS:d.spatialReference.isGeographic,resolution:{x:(d.xmax-d.xmin)/b.width,y:(d.ymax-d.ymin)/b.height}})}return c}catch(v){return t.error("symbolize",v.message),b}};f.prototype.simpleStretch=function(a,b){if(!this.isValidPixelBlock(a))return a;try{return 3<a.pixels.length&&
(a=g.extractBands(a,[0,1,2])),g.stretch(a,b)}catch(p){return t.error("symbolize",p.message),a}};f.prototype.generateWebGLParameters=function(a){if(-1<["unique-value","raster-colormap","class-breaks"].indexOf(this.renderer.type)){var b=this.lookup.colormapLut;return{colormap:b.indexedColormap,colormapOffset:b.offset,type:"lut"}}var b=a.pixelBlock,c=a.isGCS,d=a.resolution;a=a.bandIds;return"raster-stretch"===this.renderer.type?this.generateStretchWebGLParams(b,this.renderer,a):"raster-shaded-relief"===
this.renderer.type?this.generateShadedReliefWebGLParams(this.renderer,c,d):null};f.prototype._isLUTChanged=function(a){if(!this.lookup||!this.lookup.rendererJson)return!0;if("colorRamp"in this.renderer){var b=this.renderer.colorRamp;if(a)return JSON.stringify(b.toJSON())!==JSON.stringify(this.lookup.rendererJson.colorRamp);a=e.__assign({},this.renderer.toJSON());b=e.__assign({},this.lookup.rendererJson);a.colorRamp=null;b.colorRamp=null}return JSON.stringify(this.renderer.toJSON())!==JSON.stringify(this.lookup.rendererJson)};
f.prototype._symbolize_colormap=function(a){return this._isLUTChanged()&&!this.bind()?a:g.colorize(a,this.lookup.colormapLut)};f.prototype._symbolize_classBreaks=function(a){var b=-1<["u8","u16","s8","s16"].indexOf(this.rasterInfo.pixelType);return this._isLUTChanged()&&!this.bind()?a:b?g.colorize(a,this.lookup.colormapLut):g.remapColor(a,this.lookup.remapLut)};f.prototype._symbolize_stretch=function(a,b){var c=this.rasterInfo,d=c.pixelType,f=c.bandCount,c=this.renderer,h=-1<["u8","u16","s8","s16"].indexOf(d),
m,l=c.gamma,n=c.useGamma;if(h){if(c.dynamicRangeAdjustment)h=this.getStretchCutoff(c,a,b),m=g.createStretchLUT(e.__assign(e.__assign({pixelType:d},h),{gamma:n?l:null}));else{if(this._isLUTChanged()&&(d=this.bind(),!d))return a;m=this.lookup?this.lookup.stretchLut:null}if(!m)return a;1<f&&(null===b||void 0===b?void 0:b.length)===a.pixels.length&&(null===m||void 0===m?void 0:m.lut.length)===f&&(m={lut:b.map(function(a){return m.lut[a]}),offset:m.offset});b=g.lookupPixels(a,m)}else h=this.getStretchCutoff(c,
a,b),b=g.stretch(a,e.__assign(e.__assign({},h),{gamma:n?l:null}));if(c.colorRamp){if(this._isLUTChanged(!0)&&(d=this.bind(),!d))return a;b=g.colorize(b,this.lookup.colormapLut)}return b};f.prototype._symbolize_shadedRelief=function(a,b){var c=this.renderer;b=e.__assign(e.__assign({},c.toJSON()),b);b=m.hillshade(a,b);if(!c.colorRamp||this._isLUTChanged(!0)&&!this.bind())return b;c=this.lookup?this.lookup.hsvMap:null;if(!c)return b;m.tintHillshade(b,a,c,this.rasterInfo.statistics[0]);return b};f.prototype._updateUVRenderer=
function(a){var b=this.rasterInfo,c=b.bandCount,d=b.attributeTable,e=b.statistics,b=-1<["u8","s8"].indexOf(b.pixelType)&&e&&null!=e[0].min&&null!=e[0].max;if(1!==c||!d&&!b)return!1;var f=a.field;if(!f)return!1;var h=[];if(d){var m=d.fields.filter(function(a){return"value"===a.name.toLowerCase()})[0];if(!m)return!1;d.features.forEach(function(b){var c=a.uniqueValueInfos.filter(function(a){return String(a.value)===String(b.attributes[f])})[0];(c=c&&c.symbol&&c.symbol.color)&&h.push([b.attributes[m.name],
c.r,c.g,c.b,1<c.a?c.a:Math.round(255*c.a)])})}else{if("value"!==f.toLowerCase())return!1;a.uniqueValueInfos.forEach(function(a){var b=a&&a.symbol&&a.symbol.color;b&&h.push([parseInt(a.value,10),b.r,b.g,b.b,1<b.a?b.a:Math.round(255*b.a)])})}if(0===h.length)return!1;c=g.createColormapLUT({colormap:h});this.lookup={rendererJson:a.toJSON(),colormapLut:c};return this.canRenderInWebGL=!0};f.prototype._updateColormapRenderer=function(a){var b=a.extractColormap();if(!b||0===b.length)return!1;b=g.createColormapLUT({colormap:b});
this.lookup={rendererJson:a.toJSON(),colormapLut:b};return this.canRenderInWebGL=!0};f.prototype._updateShadedReliefRenderer=function(a){if("elevation"!==this.rasterInfo.dataType)return!1;if(a.colorRamp){for(var b=c.convertColorRampToColormap(a.colorRamp,256),b=g.createColormapLUT({colormap:b}),e=[],f=b.indexedColormap,h=0;h<f.length;h+=4){var m=d.toHSV({r:f[h],g:f[h+1],b:f[h+2]});e.push([m.h/60,m.s/100,255*m.v/100])}this.lookup={rendererJson:a.toJSON(),colormapLut:b,hsvMap:e}}else this.lookup=null;
return this.canRenderInWebGL=!0};f.prototype._updateClassBreaksRenderer=function(a){var b=-1<["u8","u16","s8","s16"].indexOf(this.rasterInfo.pixelType),c=a.classBreakInfos;if(!c||0===c.length)return!1;var d=c.sort(function(a,b){return a.minValue-b.minValue}),c=d[d.length-1];if(!b)return b=d.map(function(a){return{value:a.minValue,mappedColor:[a.symbol.color.r,a.symbol.color.g,a.symbol.color.b,1<a.symbol.color.a?a.symbol.color.a:Math.round(255*a.symbol.color.a)]}}),b.push({value:c.maxValue,mappedColor:[c.symbol.color.g,
c.symbol.color.b,1<c.symbol.color.a?c.symbol.color.a:Math.round(255*c.symbol.color.a)]}),this.lookup={rendererJson:a.toJSON(),remapLut:b},this.canRenderInWebGL=!1,!0;var f=[],e,h=0;d.forEach(function(a){e=Math.ceil(a.minValue);h=Math.floor(a.maxValue);for(var b=e;b<h;b++)f.push([b,a.symbol.color.r,a.symbol.color.g,a.symbol.color.b,1<a.symbol.color.a?a.symbol.color.a:Math.round(255*a.symbol.color.a)])});f.push([c.maxValue,c.symbol.color.r,c.symbol.color.g,c.symbol.color.b,1<c.symbol.color.a?c.symbol.color.a:
Math.round(255*c.symbol.color.a)]);b=g.createColormapLUT({colormap:f,fillUnspecified:!1});this.lookup={rendererJson:a.toJSON(),colormapLut:b};return this.canRenderInWebGL=!0};f.prototype._updateStretchRenderer=function(a){if(!(a.statistics||this.rasterInfo.statistics||a.dynamicRangeAdjustment))return!1;var b=a.histograms||this.rasterInfo.histograms;if(!a.dynamicRangeAdjustment&&"percent-clip"===a.stretchType&&!b)return!1;var d=a.gamma,f=a.useGamma,b=a.colorRamp,h=this.rasterInfo.pixelType;if(!a.dynamicRangeAdjustment&&
-1<["u8","u16","s8","s16"].indexOf(h)){var m=this.getStretchCutoff(a),d=g.createStretchLUT(e.__assign(e.__assign({pixelType:h},m),{gamma:f?d:null}));this.lookup={rendererJson:a.toJSON(),stretchLut:d}}b&&(b=c.convertColorRampToColormap(b,256),this.lookup||(this.lookup={rendererJson:a.toJSON()}),this.lookup.colormapLut=g.createColormapLUT({colormap:b}),this.lookup.rendererJson=a.toJSON());return this.canRenderInWebGL=!0};f.prototype.getStretchCutoff=function(a,b,c){var d,f,e=a.stretchType;a.dynamicRangeAdjustment?
"min-max"===e&&b.statistics?d=b.statistics.map(function(a){return[a.minValue,a.maxValue,0,0]}):(f=g.estimateStatisticsHistograms(b),d=f.statistics,f=f.histograms):(d=a.statistics&&0<a.statistics.length?a.statistics:this.rasterInfo.statistics,f=a.histograms||this.rasterInfo.histograms);var h=d||f?(d||f).length:this.rasterInfo.bandCount;b=[];var m=[],l,k,n,t,p;d[0]instanceof Array||(d=d.map(function(a){return[a.min,a.max,a.avg,a.stddev]}));switch(e){case "none":for(e=0;e<h;e++)b[e]="u8"===this.rasterInfo.pixelType?
0:d?d[e][0]:0,m[e]="u8"===this.rasterInfo.pixelType?255:d?d[e][1]:255;break;case "min-max":for(e=0;e<h;e++)b[e]=d[e][0],m[e]=d[e][1];break;case "standard-deviation":for(e=0;e<h;e++)b[e]=d[e][2]-a.numberOfStandardDeviations*d[e][3],m[e]=d[e][2]+a.numberOfStandardDeviations*d[e][3],b[e]<d[e][0]&&(b[e]=d[e][0]),m[e]>d[e][1]&&(m[e]=d[e][1]);break;case "percent-clip":for(e=0;e<f.length;e++){d=f[e];n=new Uint32Array(d.size);k=d.counts;l=0;h=(d.max-d.min)/d.size;t=-.5===d.min&&1===h?.5:0;for(p=0;p<d.size;p++)l+=
k[p],n[p]=l;k=a.minPercent*l/100;for(p=0;p<d.size;p++)if(n[p]>k){b[e]=d.min+h*(p+t);break}k=(1-a.maxPercent/100)*l;for(p=d.size-2;0<=p;p--)if(n[p]<k){m[e]=d.min+h*(p+2-t);break}}break;default:for(e=0;e<h;e++)b[e]=d[e][0],m[e]=d[e][1]}return this.getSelectedBandCutoffs({minCutOff:b,maxCutOff:m,outMax:a.outputMax||255,outMin:a.outputMin||0},c)};f.prototype.getSelectedBandCutoffs=function(a,b){if(null==b||0===b.length)return a;var c=Math.max.apply(null,b),d=a.minCutOff,g=a.maxCutOff,e=a.outMin,f=a.outMax;
return d.length===b.length||d.length<=c?a:{minCutOff:b.map(function(a){return d[a]}),maxCutOff:b.map(function(a){return g[a]}),outMin:e,outMax:f}};f.prototype.generateStretchWebGLParams=function(a,b,c){var d=null,g=null,e=this.lookup&&this.lookup.colormapLut;b.colorRamp&&e&&(d=e.indexedColormap,g=e.offset);var e=b.gamma,f=!!(b.useGamma&&e&&e.some(function(a){return 1!==a})),h=this.getStretchCutoff(b,a,c);b=h.minCutOff;var m=h.maxCutOff,l=h.outMin,h=h.outMax;a&&a.pixels&&2===a.pixels.length&&(a=a.clone(),
a.statistics=[a.statistics[0]],a.pixels=[a.pixels[0]]);a=Math.min(3,c&&c.length||a&&a.getPlaneCount()||this.rasterInfo.bandCount);c=new Float32Array(a);var k=d||f?1:255,n;for(n=0;n<a;n++)c[n]=(h-l)/(m[n]-b[n])/k;var t=new Float32Array(a);if(f)for(n=0;n<a;n++)t[n]=1<e[n]?2<e[n]?6.5+Math.pow(e[n]-2,2.5):6.5+100*Math.pow(2-e[n],4):1;return{bandCount:a,outMin:l/k,outMax:h/k,minCutOff:b,maxCutOff:m,factor:c,useGamma:f,gamma:f?e:[1,1,1],gammaCorrection:f?t:[1,1,1],colormap:d,colormapOffset:g,type:"stretch"}};
f.prototype.generateShadedReliefWebGLParams=function(a,b,c){var d=null,g=null,f=this.lookup&&this.lookup.colormapLut;a.colorRamp&&f&&(d=f.indexedColormap,g=f.offset);b=e.__assign(e.__assign({},a.toJSON()),{isGCS:b,resolution:c});b=m.calculateHillshadeParams(b);c=this.rasterInfo.statistics[0];return e.__assign(e.__assign({},b),{minValue:c.min,maxValue:c.max,hillshadeType:"traditional"===a.hillshadeType?0:1,type:"hillshade",colormap:d,colormapOffset:g})};f.prototype.isValidPixelBlock=function(a){return!!(a&&
a.pixels&&0<a.pixels.length&&0!==a.validPixelCount)};e.__decorate([b.property({types:r.rasterRendererTypes,json:{write:!0}})],f.prototype,"renderer",void 0);e.__decorate([b.reader("renderer")],f.prototype,"readRenderer",null);e.__decorate([b.property({type:a,json:{write:!0}})],f.prototype,"rasterInfo",void 0);e.__decorate([b.property({json:{write:!0}})],f.prototype,"lookup",void 0);e.__decorate([b.property({})],f.prototype,"canRenderInWebGL",void 0);return f=e.__decorate([b.subclass("esri.renderers.support.RasterSymbolizer")],
f)}(k.JSONSupport)})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["require","exports","../PixelBlock"],function(D,q,e){function r(b,a){b=Math.min(Math.max(b,-100),100);a=Math.min(Math.max(a,-100),100);var d,e,c=new Uint8Array(256);for(d=0;256>d;d++)0<b&&100>b?e=(200*d-25500+510*a)/(2*(100-b))+128:0>=b&&-100<b?e=(200*d-25500+510*a)*(100+b)/2E4+128:100===b?(e=200*d-25500+256*(100-b)+510*a,e=0<e?255:0):-100===b&&(e=128),c[d]=255<e?255:0>e?0:e;return c}function d(b,a,d,e,c,l,k,
f){return{xmin:c<=d*b?0:c<d*b+b?c-d*b:b,ymin:l<=e*a?0:l<e*a+a?l-e*a:a,xmax:c+k<=d*b?0:c+k<d*b+b?c+k-d*b:b,ymax:l+f<=e*a?0:l+f<e*a+a?l+f-e*a:a}}function k(b,a,g,m){var c=b.filter(function(a){return l(a)})[0];if(null==c)return null;var k=m?m.width:a.width;m=m?m.height:a.height;var q=c.width,f=c.height,h=a.width/q;a=a.height/f;var n=g?g.x:0;g=g?g.y:0;var p=c.pixelType,A=e.getPixelArrayConstructor(p),v=c.pixels.length,c=[],u,r,x,w,y,z,C,F,H,D;for(y=0;y<v;y++){r=new A(k*m);for(z=0;z<a;z++)for(C=0;C<h;C++)if(x=
b[z*h+C])for(u=x.pixels[y],D=d(q,f,C,z,n,g,k,m),F=D.ymin;F<D.ymax;F++)for(x=(z*f+F-g)*k+(C*q-n),w=F*q,H=D.xmin;H<D.xmax;H++)r[x+H]=u[w+H];c.push(r)}var K;if(b.some(function(a){return null==a||a.mask&&0<a.mask.length}))for(K=new Uint8Array(k*m),z=0;z<a;z++)for(C=0;C<h;C++)if(A=(x=b[z*h+C])?x.mask:null,D=d(q,f,C,z,n,g,k,m),A)for(F=D.ymin;F<D.ymax;F++)for(x=(z*f+F-g)*k+(C*q-n),w=F*q,H=D.xmin;H<D.xmax;H++)K[x+H]=A[w+H];else if(x)for(F=D.ymin;F<D.ymax;F++)for(x=(z*f+F-g)*k+(C*q-n),w=F*q,H=D.xmin;H<D.xmax;H++)K[x+
H]=1;else for(F=D.ymin;F<D.ymax;F++)for(x=(z*f+F-g)*k+(C*q-n),w=F*q,H=D.xmin;H<D.xmax;H++)K[x+H]=0;b=new e({width:k,height:m,pixels:c,pixelType:p,mask:K});b.updateStatistics();return b}Object.defineProperty(q,"__esModule",{value:!0});var l=function(b){return b&&"esri.layers.support.PixelBlock"===b.declaredClass&&b.pixels&&0<b.pixels.length};q.extractBands=function(b,a){if(!a||!l(b))return b;var d=b.pixels.length;return a&&a.some(function(a){return a>=d})||1===d&&1===a.length&&0===a[0]||d===a.length&&
!a.some(function(a,b){return a!==b})?b:new e({pixelType:b.pixelType,width:b.width,height:b.height,mask:b.mask,validPixelCount:b.validPixelCount,maskIsAlpha:b.maskIsAlpha,pixels:a.map(function(a){return b.pixels[a]}),statistics:b.statistics&&a.map(function(a){return b.statistics[a]})})};q.createColormapLUT=function(b){if(b){var a=b.colormap;if(a&&0!==a.length){var a=a.sort(function(a,b){return a[0]-b[0]}),d=0;0>a[0][0]&&(d=a[0][0]);var e=Math.max(256,a[a.length-1][0]-d+1),c=new Uint8Array(4*e),l=[],
k=0,f=0,h=5===a[0].length;if(65536<e)return a.forEach(function(a){l[a[0]-d]=h?a.slice(1):a.slice(1).concat([255])}),{indexed2DColormap:l,offset:d,alphaSpecified:h};if(b.fillUnspecified)for(b=a[f],k=b[0]-d;k<e;k++)c[4*k]=b[1],c[4*k+1]=b[2],c[4*k+2]=b[3],c[4*k+3]=h?b[4]:255,k===b[0]-d&&(b=f===a.length-1?b:a[++f]);else for(k=0;k<a.length;k++)b=a[k],f=4*(b[0]-d),c[f]=b[1],c[f+1]=b[2],c[f+2]=b[3],c[f+3]=h?b[4]:255;return{indexedColormap:c,offset:d,alphaSpecified:h}}}};q.colorize=function(b,a){if(!l(b)||
!a&&(a.indexedColormap||a.indexed2DColormap))return b;var d=b.clone(),e=d.pixels,c=d.mask,k=d.width*d.height;if(1!==e.length)return b;var q=a.indexedColormap;b=a.indexed2DColormap;var f=a.offset;a=a.alphaSpecified;var h=q.length-1,n=0,e=e[0],p=new Uint8Array(e.length),A=new Uint8Array(e.length),v=new Uint8Array(e.length),u=0;if(q)if(c)for(n=0;n<k;n++)c[n]&&(u=4*(e[n]-f),u<f||u>h?c[n]=0:(p[n]=q[u],A[n]=q[u+1],v[n]=q[u+2],c[n]=q[u+3]));else{c=new Uint8Array(k);for(n=0;n<k;n++)u=4*(e[n]-f),u<f||u>h?
c[n]=0:(p[n]=q[u],A[n]=q[u+1],v[n]=q[u+2],c[n]=q[u+3]);d.mask=c}else if(c)for(n=0;n<k;n++)c[n]&&(q=b[e[n]],p[n]=q[0],A[n]=q[1],v[n]=q[2],c[n]=q[3]);else{c=new Uint8Array(k);for(n=0;n<k;n++)q=b[e[n]],p[n]=q[0],A[n]=q[1],v[n]=q[2],c[n]=q[3];d.mask=c}d.pixels=[p,A,v];d.statistics=null;d.pixelType="u8";d.maskIsAlpha=a;return d};q.estimateStatisticsHistograms=function(b){if(!l(b))return null;b.statistics||b.updateStatistics();var a=b.pixels,d=b.mask,e=b.pixelType,c=b.statistics;b=b.width*b.height;var k=
a.length,q,f,h,n,p,A=[],v=[],u,r,x;for(n=0;n<k;n++){u=new Uint32Array(256);x=a[n];if("u8"===e)if(q=-.5,f=255.5,d)for(p=0;p<b;p++)d[p]&&u[x[p]]++;else for(p=0;p<b;p++)u[x[p]]++;else{q=c[n].minValue;f=c[n].maxValue;h=(f-q)/256;r=new Uint32Array(257);if(d)for(p=0;p<b;p++)d[p]&&r[Math.floor((x[p]-q)/h)]++;else for(p=0;p<b;p++)r[Math.floor((x[p]-q)/h)]++;for(p=0;255>p;p++)u[p]=r[p];u[255]=r[255]+r[256]}A.push({min:q,max:f,size:256,counts:u});for(p=x=r=h=0;256>p;p++)h+=u[p],r+=p*u[p];r/=h;for(p=0;256>p;p++)x+=
u[p]*Math.pow(p-r,2);u=Math.sqrt(x/(h-1));h=(f-q)/256;p=(r+.5)*h+q;u*=h;v.push({min:q,max:f,avg:p,stddev:u})}return{statistics:v,histograms:A}};q.createStretchLUT=function(b){var a=b.minCutOff,d=b.maxCutOff,e=b.gamma,c=b.pixelType,l=b.outMin||0,k=b.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(c))return null;var f=a.length,h,n=0;"s8"===c?n=-127:"s16"===c&&(n=-32767);var p=256;-1<["u16","s16"].indexOf(c)&&(p=65536);for(var q=[],v=k-l,c=0;c<f;c++)q[c]=d[c]-a[c];h=e&&e.length>=f;var u=[];if(h)for(c=
0;c<f;c++)u[c]=1<e[c]?2<e[c]?6.5+Math.pow(e[c]-2,2.5):6.5+100*Math.pow(2-e[c],4):1;var E,x=[],w,y,z;if(h)for(c=0;c<f;c++){z=[];for(h=0;h<p;h++)w=h+n,E=(w-a[c])/q[c],y=1,1<e[c]&&(y-=Math.pow(1/v,E*u[c])),z[h]=w<d[c]&&w>a[c]?Math.floor(y*v*Math.pow(E,1/e[c]))+l:w>=d[c]?k:l;x[c]=z}else for(c=0;c<f;c++){z=[];for(h=0;h<p;h++)w=h+n,z[h]=w<=a[c]?l:w>=d[c]?k:Math.floor((w-a[c])/q[c]*v)+l;x[c]=z}if(null!=b.contrastOffset)for(b=r(b.contrastOffset,b.brightnessOffset),c=0;c<f;c++)for(z=x[c],h=0;h<p;h++)z[h]=
b[z[h]];return{lut:x,offset:n}};q.createContrastBrightnessLUT=r;q.stretch=function(b,a){if(!l(b))return null;b=b.clone();var d=b.pixels,e=b.mask,c=a.minCutOff,k=a.maxCutOff,q=a.gamma,f=a.outMin||0;a=a.outMax||255;var h=b.width*b.height,n=d.length,p,r,v,u,E,x=a-f,w=[];for(p=0;p<n;p++)w[p]=k[p]-c[p];r=q&&q.length>=n;var y=[];if(r)for(p=0;p<n;p++)y[p]=1<q[p]?2<q[p]?6.5+Math.pow(q[p]-2,2.5):6.5+100*Math.pow(2-q[p],4):1;if(r)if(null!=e)for(r=0;r<h;r++){if(e[r])for(p=0;p<n;p++)v=d[p][r],E=(v-c[p])/w[p],
u=1,1<q[p]&&(u-=Math.pow(1/x,E*y[p])),d[p][r]=v<k[p]&&v>c[p]?Math.floor(u*x*Math.pow(E,1/q[p]))+f:v>=k[p]?a:f}else for(r=0;r<h;r++)for(p=0;p<n;p++)v=d[p][r],E=(v-c[p])/w[p],u=1,1<q[p]&&(u-=Math.pow(1/x,E*y[p])),d[p][r]=v<k[p]&&v>c[p]?Math.floor(u*x*Math.pow(E,1/q[p]))+f:v>=k[p]?a:f;else if(null!=e)for(r=0;r<h;r++){if(e[r])for(p=0;p<n;p++)v=d[p][r],d[p][r]=v<k[p]&&v>c[p]?Math.floor((v-c[p])/w[p]*x)+f:v>=k[p]?a:f}else for(r=0;r<h;r++)for(p=0;p<n;p++)v=d[p][r],d[p][r]=v<k[p]&&v>c[p]?Math.floor((v-c[p])/
w[p]*x)+f:v>=k[p]?a:f;b.pixelType="u8";b.updateStatistics();return b};q.lookupPixels=function(b,a){if(!l(b))return null;var d=b.pixels,k=b.mask,c=b.width*b.height,t=d.length,q=a.lut;a=a.offset;var f,h;q&&1===q[0].length&&(q=d.map(function(){return q}));var n=[],p,r,v;if(a)if(null==k)for(f=0;f<t;f++){p=d[f];r=q[f];v=new Uint8Array(c);for(h=0;h<c;h++)v[h]=r[p[h]-a];n.push(v)}else for(f=0;f<t;f++){p=d[f];r=q[f];v=new Uint8Array(c);for(h=0;h<c;h++)k[h]&&(v[h]=r[p[h]-a]);n.push(v)}else if(null==k)for(f=
0;f<t;f++){p=d[f];r=q[f];v=new Uint8Array(c);for(h=0;h<c;h++)v[h]=r[p[h]];n.push(v)}else for(f=0;f<t;f++){p=d[f];r=q[f];v=new Uint8Array(c);for(h=0;h<c;h++)k[h]&&(v[h]=r[p[h]]);n.push(v)}b=new e({width:b.width,height:b.height,pixels:n,mask:k,pixelType:"u8"});b.updateStatistics();return b};q.remapColor=function(b,a){if(!l(b))return null;b=b.clone();var d=b.width*b.height,e=a.length,c=Math.floor(e/2),k=a[Math.floor(c)],q=b.pixels[0],f,h,n,p,r,v,u=!1,E=new Uint8Array(d),x=new Uint8Array(d),w=new Uint8Array(d),
y=b.mask,z=4===a[0].mappedColor.length;y||(y=new Uint8Array(d),y.fill(z?255:1),b.mask=y);for(r=0;r<d;r++)if(y[r]){f=q[r];u=!1;v=c;h=k;n=0;for(p=e-1;1<p-n;){if(f===h.value){u=!0;break}f>h.value?n=v:p=v;v=Math.floor((n+p)/2);h=a[Math.floor(v)]}u||(f===a[n].value?(h=a[n],u=!0):f===a[p].value?(h=a[p],u=!0):f<a[n].value?(u=!1,h=null):f>a[n].value&&(f<a[p].value?(h=a[n],u=!0):p===e-1?(u=!1,h=null):(h=a[p],u=!0)));u?(E[r]=h.mappedColor[0],x[r]=h.mappedColor[1],w[r]=h.mappedColor[2],y[r]=h.mappedColor[3]):
E[r]=x[r]=w[r]=y[r]=0}b.pixels=[E,x,w];b.mask=y;b.pixelType="u8";b.maskIsAlpha=z;return b};q.getClipBounds=d;q.mosaicPixelData=function(b,a){if(!b||0===b.length)return null;var d=b.filter(function(a){return a.pixelBlock})[0];if(!d)return null;var e=(d.extent.xmax-d.extent.xmin)/d.pixelBlock.width,c=(d.extent.ymax-d.extent.ymin)/d.pixelBlock.height,l=.01*Math.min(e,c),q=b.sort(function(a,b){return Math.abs(a.extent.ymax-b.extent.ymax)>l?b.extent.ymax-a.extent.ymax:Math.abs(a.extent.xmin-b.extent.xmin)>
l?a.extent.xmin-b.extent.xmin:0}),f=Math.min.apply(null,q.map(function(a){return a.extent.xmin})),h=Math.min.apply(null,q.map(function(a){return a.extent.ymin})),n=Math.max.apply(null,q.map(function(a){return a.extent.xmax})),p=Math.max.apply(null,q.map(function(a){return a.extent.ymax}));b={x:Math.round((a.xmin-f)/e),y:Math.round((p-a.ymax)/c)};f={width:Math.round((n-f)/e),height:Math.round((p-h)/c)};e={width:Math.round((a.xmax-a.xmin)/e),height:Math.round((a.ymax-a.ymin)/c)};if(Math.round(f.width/
d.pixelBlock.width)*Math.round(f.height/d.pixelBlock.height)!==q.length||0>b.x||0>b.y||f.width<e.width||f.height<e.height)return null;d=q.map(function(a){return a.pixelBlock});d=k(d,f,b,e);return{extent:a,pixelBlock:d}};q.mosaic=k;q.setValidBoundary=function(b,a,d){if(!l(b))return null;var e=b.width,c=b.height,g=a.x;a=a.y;var k=d.width+g;d=d.height+a;if(0>g||0>a||k>e||d>c||0===g&&0===a&&k===e&&d===c)return b;b.mask||(b.mask=new Uint8Array(e*c));for(var f=b.mask,h=0;h<c;h++)for(var n=h*e,p=0;p<e;p++)f[n+
p]=h<a||h>=d||p<g||p>=k?0:1;b.updateStatistics();return b};q.clip=function(b,a,d){if(!l(b))return null;var g=a.x,c=a.y,k=a.x+d.width;a=a.x+d.height;if(a===b.height&&k===b.width)return b;for(var q=b.pixels,f=b.mask,h=b.width,n=h*b.height,p=q.length,r=[],v=0;v<p;v++){for(var u=q[v],E=e.createEmptyBand(b.pixelType,n),x=0,w=c;w<=a;w++)for(var y=w*h,z=g;z<=k;z++)E[x++]=u[y+z];r.push(E)}var C;if(f)for(C=new Uint8Array(d.width*d.height),x=0,w=c;w<=a;w++)for(y=w*h,z=g;z<=k;z++)C[x++]=f[y+z];b=new e({width:d.width,
height:d.height,pixels:r,mask:C});b.updateStatistics();return b};q.approximateTransform=function(b,a,d,k){if(!l(b))return null;var c=b.pixels,g=b.mask,m=b.pixelType,f=b.width,h=b.height;b=e.getPixelArrayConstructor(m);var n=c.length,p=a.width,q=a.height;a=k.cols;var r=k.rows,u=Math.ceil(p/a),E=Math.ceil(q/r),x=!1;for(k=0;k<d.length;k+=3)-1===d[k]&&-1===d[k+1]&&-1===d[k+2]&&(x=!0);var w,y,z,C,F,D,N,K=new Float32Array(p*q),I=new Float32Array(p*q),G=0,J,L;for(k=0;k<E;k++)for(var R=0;R<u;R++){w=12*(k*
u+R);y=d[w];z=d[w+1];C=d[w+2];F=d[w+3];D=d[w+4];N=d[w+5];for(var P=0;P<r;P++){G=(k*r+P)*p+R*a;L=(P+.5)/r;for(var S=0;S<P;S++)J=(S+.5)/a,K[G+S]=Math.round((y*J+z*L+C)*f-.5),I[G+S]=Math.round((F*J+D*L+N)*h-.5)}w+=6;y=d[w];z=d[w+1];C=d[w+2];F=d[w+3];D=d[w+4];N=d[w+5];for(P=0;P<r;P++)for(G=(k*r+P)*p+R*a,L=(P+.5)/r,S=P;S<a;S++)J=(S+.5)/a,K[G+S]=Math.round((y*J+z*L+C)*f-.5),I[G+S]=Math.round((F*J+D*L+N)*h-.5)}d=function(a,b){for(var c=0;c<q;c++){w=c*p;for(var d=0;d<p;d++)a[w]=x&&(0>K[w]||0>I[w])?0:b[K[w]+
I[w]*f],w++}};h=[];for(k=0;k<n;k++)a=new b(p*q),d(a,c[k]),h.push(a);c=new e({width:p,height:q,pixelType:m,pixels:h});if(g)c.mask=new Uint8Array(p*q),d(c.mask,g);else if(x)for(c.mask=new Uint8Array(p*q),k=0;k<p*q;k++)c.mask[k]=0>K[k]||0>I[k]?0:1;c.updateStatistics();return c}})},"esri/layers/support/rasterFunctions/surfaceUtils":function(){define(["require","exports","../PixelBlock"],function(D,q,e){function r(d){var e=d.altitude,b=d.azimuth,a=d.hillshadeType,g=d.pixelSizePower,k=d.pixelSizeFactor,
c=d.scalingType,t=d.isGCS,q=d.resolution,f="multi-directional"===a?2*d.zFactor:d.zFactor,h=q.x,n=q.y;d=f/(8*h);var p=f/(8*n);t&&.001<f&&(d/=111E3,p/=111E3);"adjusted"===c&&(t?(d=111E3*h,p=111E3*n,d=(f+Math.pow(d,g)*k)/(8*d),p=(f+Math.pow(p,g)*k)/(8*p)):(d=(f+Math.pow(h,g)*k)/(8*h),p=(f+Math.pow(n,g)*k)/(8*n)));var r=(90-e)*Math.PI/180,e=Math.cos(r),v=(360-b+90)*Math.PI/180,b=Math.sin(r)*Math.cos(v),r=Math.sin(r)*Math.sin(v),g=[315,270,225,360,180,0],k=[60,60,60,60,60,90],f=new Float32Array([3,5,3,
2,1,4]),u=f.reduce(function(a,b){return a+b}),f=f.map(function(a){return a/u}),c="multi-directional"===a?g.length:1,t=new Float32Array(6),n=new Float32Array(6),h=new Float32Array(6);if("multi-directional"===a)for(var E=0;E<c;E++)e=k[E],b=g[E],r=(90-e)*Math.PI/180,e=Math.cos(r),v=(360-b+90)*Math.PI/180,b=Math.sin(r)*Math.cos(v),r=Math.sin(r)*Math.sin(v),t[E]=e,n[E]=b,h[E]=r;else t.fill(e),n.fill(b),h.fill(r);return{resolution:q,factor:[d,p],sinZcosA:b,sinZsinA:r,cosZ:e,sinZcosAs:n,sinZsinAs:h,cosZs:t,
weights:f,hillshadeType:["traditional","multi-directional"].indexOf(a)}}Object.defineProperty(q,"__esModule",{value:!0});var d=function(d){return d&&"esri.layers.support.PixelBlock"===d.declaredClass&&d.pixels&&0<d.pixels.length};q.calculateHillshadeParams=r;q.hillshade=function(k,l){if(!d(k))return k;var b=k.width,a=k.height,g=k.mask,m=new Uint8Array(b*a);g&&m.set(g);var c=r(l),t=c.factor,q=c.sinZcosA,f=c.sinZsinA,h=c.cosZ,n=c.sinZcosAs,p=c.sinZsinAs,A=c.cosZs,c=c.weights,v=t[0],t=t[1];l=l.hillshadeType;
for(var u=k.pixels[0],E=new Uint8Array(b*a),x,w,y,z,C,F,D,N,K=1;K<a-1;K++)for(var I=K*b,G=1;G<b-1;G++)if(g&&!g[I+G])E[I+G]=0;else{z=8;if(g&&(z=g[I-b+G-1]+g[I-b+G]+g[I-b+G+1]+g[I+G-1]+g[I+G+1]+g[I+b+G-1]+g[I+b+G]+g[I+b+G+1],7>z)){E[I+G]=0;m[I+G]=0;continue}7===z?(x=g[I-b+G-1]?u[I-b+G-1]:u[I+G],w=g[I-b+G]?u[I-b+G]:u[I+G],y=g[I-b+G+1]?u[I-b+G+1]:u[I+G],z=g[I+G-1]?u[I+G-1]:u[I+G],C=g[I+G+1]?u[I+G+1]:u[I+G],F=g[I+b+G-1]?u[I+b+G-1]:u[I+G],D=g[I+b+G]?u[I+b+G]:u[I+G],N=g[I+b+G+1]?u[I+b+G+1]:u[I+G]):(x=u[I-
b+G-1],w=u[I-b+G],y=u[I-b+G+1],z=u[I+G-1],C=u[I+G+1],F=u[I+b+G-1],D=u[I+b+G],N=u[I+b+G+1]);z=(y+C+C+N-(x+z+z+F))*v;x=(F+D+D+N-(x+w+w+y))*t;w=Math.sqrt(1+z*z+x*x);y=0;if("traditional"===l)F=255*(h+f*x-q*z)/w,0>F&&(F=0),y=F;else for(D=p.length,N=0;N<D;N++)F=255*(A[N]+p[N]*x-n[N]*z)/w,0>F&&(F=0),y+=F*c[N];E[I+G]=y&255}for(K=0;K<a;K++)E[K*b]=E[K*b+1],E[(K+1)*b-1]=E[(K+1)*b-2];for(K=1;K<b-1;K++)E[K]=E[K+b],E[K+(a-1)*b]=E[K+(a-2)*b];return new e({width:b,height:a,pixels:[E],mask:g?m:null,pixelType:"u8",
validPixelCount:k.validPixelCount,statistics:[{minValue:0,maxValue:255}]})};q.tintHillshade=function(e,l,b,a){if(d(e)&&d(l)){var g=a.min,k=e.pixels[0],c=l.mask;l=l.pixels[0];a=255.00001/(a.max-g);for(var t=new Uint8ClampedArray(l.length),q=new Uint8ClampedArray(l.length),f=new Uint8ClampedArray(l.length),h=b.length-1,n=0;n<l.length;n++)if(!c||0!==c[n]){var p=Math.floor((l[n]-g)*a),r=b[0>p?0:p>h?h:p],p=r[0],v=k[n],r=v*r[1],u=r*(1-Math.abs(p%2-1)),v=v-r;switch(Math.floor(p)){case 0:t[n]=r+v;q[n]=u+
v;f[n]=v;break;case 1:t[n]=u+v;q[n]=r+v;f[n]=v;break;case 2:t[n]=v;q[n]=r+v;f[n]=u+v;break;case 3:t[n]=v;q[n]=u+v;f[n]=r+v;break;case 4:t[n]=u+v;q[n]=v;f[n]=r+v;break;case 5:case 6:t[n]=r+v,q[n]=v,f[n]=u+v}}e.pixels=[t,q,f];e.updateStatistics()}}})},"esri/tasks/ImageServiceIdentifyTask":function(){define("require exports tslib ../request ../core/maybe ../core/accessorSupport/decorators ../geometry/support/normalizeUtils ./Task ./support/ImageServiceIdentifyResult".split(" "),function(D,q,e,r,d,k,
l,b,a){return function(b){function g(){return null!==b&&b.apply(this,arguments)||this}e.__extends(g,b);g.prototype.execute=function(b,g){var c=this;return l.normalizeCentralMeridian(b.geometry?[b.geometry]:[]).then(function(a){var f=b.toJSON();a=a&&a[0];d.isSome(a)&&(f.geometry=JSON.stringify(a.toJSON()));f=c._encode(e.__assign(e.__assign({f:"json"},c.parsedUrl.query),f));f=e.__assign(e.__assign({query:f},c.requestOptions),g);return r(c.parsedUrl.path+"/identify",f)}).then(function(b){return a.fromJSON(b.data)})};
return g=e.__decorate([k.subclass("esri.tasks.ImageServiceIdentifyTask")],g)}(b)})},"esri/tasks/support/ImageServiceIdentifyResult":function(){define("require exports tslib ../../core/JSONSupport ../../core/accessorSupport/decorators ../../geometry/Point ./FeatureSet".split(" "),function(D,q,e,r,d,k,l){return function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.catalogItemVisibilities=null;a.catalogItems=null;a.location=null;a.name=null;a.objectId=null;a.processedValues=null;a.properties=
null;a.value=null;return a}e.__extends(a,b);e.__decorate([d.property({json:{write:!0}})],a.prototype,"catalogItemVisibilities",void 0);e.__decorate([d.property({type:l,json:{write:!0}})],a.prototype,"catalogItems",void 0);e.__decorate([d.property({type:k,json:{write:!0}})],a.prototype,"location",void 0);e.__decorate([d.property({json:{write:!0}})],a.prototype,"name",void 0);e.__decorate([d.property({json:{write:!0}})],a.prototype,"objectId",void 0);e.__decorate([d.property({json:{write:!0}})],a.prototype,
"processedValues",void 0);e.__decorate([d.property({json:{write:!0}})],a.prototype,"properties",void 0);e.__decorate([d.property({json:{write:!0}})],a.prototype,"value",void 0);return a=e.__decorate([d.subclass("esri.tasks.support.ImageServiceIdentifyResult")],a)}(r.JSONSupport)})},"esri/tasks/support/ImageServiceIdentifyParameters":function(){define("require exports tslib ../../TimeExtent ../../core/JSONSupport ../../core/accessorSupport/decorators ../../geometry/Point ../../geometry/support/jsonUtils ../../layers/support/MosaicRule ../../layers/support/RasterFunction".split(" "),
function(D,q,e,r,d,k,l,b,a,g){return function(d){function c(){var a=null!==d&&d.apply(this,arguments)||this;a.geometry=null;a.renderingRules=null;a.pixelSize=null;a.returnGeometry=!0;a.returnCatalogItems=!0;a.returnPixelValues=!0;a.maxItemCount=null;a.timeExtent=null;a.raster=void 0;a.viewId=void 0;return a}e.__extends(c,d);c.prototype.writeGeometry=function(a,c,d){null!=a&&(c.geometryType=b.getJsonType(a),c[d]=JSON.stringify(a.toJSON()))};Object.defineProperty(c.prototype,"mosaicRule",{set:function(b){b&&
b.mosaicMethod&&(b=a.fromJSON(e.__assign(e.__assign({},b.toJSON()),{mosaicMethod:b.mosaicMethod,mosaicOperation:b.mosaicOperation})));this._set("mosaicRule",b)},enumerable:!0,configurable:!0});c.prototype.writeMosaicRule=function(a,b,c){null!=a&&(b[c]=JSON.stringify(a.toJSON()))};Object.defineProperty(c.prototype,"renderingRule",{set:function(a){a&&a.rasterFunction&&(a=g.fromJSON(e.__assign(e.__assign({},a.toJSON()),{rasterFunction:a.rasterFunction,rasterFunctionArguments:a.rasterFunctionArguments})));
this._set("renderingRule",a)},enumerable:!0,configurable:!0});c.prototype.writeRenderingRule=function(a,b,c){null!=a&&(b[c]=JSON.stringify(a.toJSON()))};c.prototype.writeRenderingRules=function(a,b,c){null!=a&&(b[c]=JSON.stringify(a.map(function(a){return a.toJSON()})))};c.prototype.writePixelSize=function(a,b,c){null!=a&&(b[c]=JSON.stringify(a.toJSON()))};c.prototype.writeTimeExtent=function(a,b,c){if(null!=a){var d=a.start?a.start.getTime():null;a=a.end?a.end.getTime():null;b[c]=null!=d?null!=a?
d+","+a:""+d:null}};e.__decorate([k.property({json:{write:!0}})],c.prototype,"geometry",void 0);e.__decorate([k.writer("geometry")],c.prototype,"writeGeometry",null);e.__decorate([k.property({type:a,json:{write:!0}})],c.prototype,"mosaicRule",null);e.__decorate([k.writer("mosaicRule")],c.prototype,"writeMosaicRule",null);e.__decorate([k.property({type:g,json:{write:!0}})],c.prototype,"renderingRule",null);e.__decorate([k.writer("renderingRule")],c.prototype,"writeRenderingRule",null);e.__decorate([k.property({type:[g],
json:{write:!0}})],c.prototype,"renderingRules",void 0);e.__decorate([k.writer("renderingRules")],c.prototype,"writeRenderingRules",null);e.__decorate([k.property({type:l,json:{write:!0}})],c.prototype,"pixelSize",void 0);e.__decorate([k.writer("pixelSize")],c.prototype,"writePixelSize",null);e.__decorate([k.property({type:Boolean,json:{write:!0}})],c.prototype,"returnGeometry",void 0);e.__decorate([k.property({type:Boolean,json:{write:!0}})],c.prototype,"returnCatalogItems",void 0);e.__decorate([k.property({type:Boolean,
json:{write:!0}})],c.prototype,"returnPixelValues",void 0);e.__decorate([k.property({type:Number,json:{write:!0}})],c.prototype,"maxItemCount",void 0);e.__decorate([k.property({type:r,json:{write:{target:"time"}}})],c.prototype,"timeExtent",void 0);e.__decorate([k.writer("timeExtent")],c.prototype,"writeTimeExtent",null);e.__decorate([k.property({json:{write:!0}})],c.prototype,"raster",void 0);e.__decorate([k.property({json:{write:!0}})],c.prototype,"viewId",void 0);return c=e.__decorate([k.subclass("esri.tasks.support.ImageServiceIdentifyParameters")],
c)}(d.JSONSupport)})},"*noref":1}});
define("require exports tslib ../PopupTemplate ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators ./Layer ./mixins/ArcGISImageService ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/TemporalLayer ./support/commonProperties ../support/popupUtils".split(" "),function(D,q,e,r,d,k,l,b,a,g,m,c,t,B,f,h,n,p){return function(a){function c(){for(var b=[],c=0;c<arguments.length;c++)b[c]=
arguments[c];b=a.apply(this,b)||this;b.legendEnabled=!0;b.isReference=null;b.operationalLayerType="ArcGISImageServiceLayer";b.popupEnabled=!0;b.popupTemplate=null;b.type="imagery";return b}e.__extends(c,a);c.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?e.__assign({url:a},b):a};c.prototype.load=function(a){var b=this,c=d.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},a).then(function(){return b._fetchService(c)},function(){return b._fetchService(c)}));
return l.resolve(this)};Object.defineProperty(c.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!0,configurable:!0});c.prototype.createPopupTemplate=function(a){var b=this.rasterFields,c=this.title,d=new Set,f=!1,g=!1;this.capabilities&&(g=(f=this.capabilities.operations.supportsQuery&&this.fields&&0<this.fields.length)&&("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType));var h=
new Set;f&&(h.add("raster.itempixelvalue"),g&&h.add("raster.magnitude").add("raster.direction"));for(f=0;f<b.length;f++){var g=b[f],k=g.name.toLowerCase();h.has(k)||-1<k.indexOf("raster.servicepixelvalue.")||d.add(g.name)}return p.createPopupTemplate({fields:b,title:c},e.__assign(e.__assign({},a),{visibleFieldNames:d}))};c.prototype.redraw=function(){this.emit("redraw")};e.__decorate([b.property(n.legendEnabled)],c.prototype,"legendEnabled",void 0);e.__decorate([b.property({type:["show","hide"]})],
c.prototype,"listMode",void 0);e.__decorate([b.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],c.prototype,"isReference",void 0);e.__decorate([b.property({type:["ArcGISImageServiceLayer"]})],c.prototype,"operationalLayerType",void 0);e.__decorate([b.property(n.popupEnabled)],c.prototype,"popupEnabled",void 0);e.__decorate([b.property({type:r,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],c.prototype,"popupTemplate",void 0);
e.__decorate([b.property({readOnly:!0,dependsOn:["fields","title"]})],c.prototype,"defaultPopupTemplate",null);e.__decorate([b.property({readOnly:!0,json:{read:!1}})],c.prototype,"type",void 0);return c=e.__decorate([b.subclass("esri.layers.ImageryLayer")],c)}(h.TemporalLayer(B.RefreshableLayer(f.ScaleRangeLayer(c.OperationalLayer(t.PortalLayer(g.ArcGISImageService(m.ArcGISService(k.MultiOriginJSONMixin(a)))))))))});