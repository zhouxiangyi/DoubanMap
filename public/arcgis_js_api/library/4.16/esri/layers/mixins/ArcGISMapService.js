// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../request ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),function(r,f,b,g,k,l,d,m,n,p){Object.defineProperty(f,"__esModule",{value:!0});f.ArcGISMapService=function(f){return function(f){function a(){var e=null!==f&&f.apply(this,arguments)||this;e.capabilities=void 0;e.copyright=null;e.fullExtent=null;e.legendEnabled=!0;e.spatialReference=
null;e.version=null;return e}b.__extends(a,f);a.prototype.readCapabilities=function(e,c){var a=c.capabilities&&c.capabilities.split(",").map(function(a){return a.toLowerCase().trim()});if(!a)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};e=this.type;var b=-1!==a.indexOf("query"),d=-1!==a.indexOf("map"),f=!!c.exportTilesAllowed,a=-1!==a.indexOf("tilemap"),h="tile"!==e&&!!c.supportsDynamicLayers,q="tile"!==e&&(!c.tileInfo||
h),g="tile"!==e&&(!c.tileInfo||h);return{operations:{supportsQuery:b,supportsExportMap:d,supportsExportTiles:f,supportsTileMap:a},exportMap:d?{supportsSublayersChanges:"tile"!==e,supportsDynamicLayers:h,supportsSublayerVisibility:q,supportsSublayerDefinitionExpression:g}:null,exportTiles:f?{maxExportTilesCount:+c.maxExportTilesCount}:null}};a.prototype.readVersion=function(a,c){(a=c.currentVersion)||(a=c.hasOwnProperty("capabilities")||c.hasOwnProperty("tables")?10:c.hasOwnProperty("supportedImageFormatTypes")?
9.31:9.3);return a};a.prototype.fetchSublayerInfo=function(a,c){return b.__awaiter(this,void 0,void 0,function(){return b.__generator(this,function(b){switch(b.label){case 0:return[4,this.fetchAllLayersAndTables(c)];case 1:return b.sent(),[2,this._allLayersAndTablesMap.get(a)]}})})};a.prototype.fetchAllLayersAndTables=function(a){return b.__awaiter(this,void 0,void 0,function(){var c,d=this;return b.__generator(this,function(b){switch(b.label){case 0:return[4,this.load(a)];case 1:return b.sent(),
this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=g(l.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json"}}).then(function(a){d._allLayersAndTablesMap=new Map;for(var b=0,c=a.data.layers;b<c.length;b++){var e=c[b];d._allLayersAndTablesMap.set(e.id,e)}return{result:a.data}},function(a){return{error:a}})),[4,this._allLayersAndTablesPromise];case 2:c=b.sent();k.throwIfAborted(a);if("result"in c)return[2,c.result];throw c.error;}})})};b.__decorate([d.property({readOnly:!0})],
a.prototype,"capabilities",void 0);b.__decorate([d.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],a.prototype,"readCapabilities",null);b.__decorate([d.property({json:{read:{source:"copyrightText"}}})],a.prototype,"copyright",void 0);b.__decorate([d.property({type:m})],a.prototype,"fullExtent",void 0);b.__decorate([d.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],a.prototype,"id",void 0);b.__decorate([d.property({type:Boolean,
json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],a.prototype,"legendEnabled",void 0);b.__decorate([d.property(p.popupEnabled)],a.prototype,"popupEnabled",void 0);b.__decorate([d.property({type:n})],a.prototype,"spatialReference",void 0);b.__decorate([d.property()],a.prototype,"version",void 0);b.__decorate([d.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],a.prototype,"readVersion",null);return a=b.__decorate([d.subclass("esri.layers.mixins.ArcGISMapService")],
a)}(f)}});