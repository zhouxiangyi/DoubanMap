// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../symbols ../../core/arrayUtils ../../core/Error ../../core/promiseUtils ../../intl/messages ../../layers/support/LabelClass ../../layers/support/LabelExpressionInfo ../heuristics/clusterMinSize ../support/clusterUtils ../../views/2d/layers/support/clusterUtils".split(" "),function(K,p,b,B,C,D,u,E,F,G,H,q,I){function J(f){return b.__awaiter(this,void 0,void 0,function(){var d,g,a,e;return b.__generator(this,function(c){switch(c.label){case 0:return d=f.layer,g=f.renderer,
a=f.view,[4,u.all([d.load(),a.when()])];case 1:return c.sent(),e=g||d.renderer,I.isClusterCompatibleRenderer(e)?[2,{layer:d,renderer:e,view:a}]:[2,u.reject(new D("clusters-label-schemes:invalid-parameters","'renderer' is not valid"))]}})})}function A(f){return b.__awaiter(this,void 0,void 0,function(){var d,g,a,e,c,r,h,l,m;return b.__generator(this,function(k){switch(k.label){case 0:d=f.renderer;g=f.view;a=f.statInfo;e=null===a||void 0===a?void 0:a.statisticType;c=a?q.getClusterField(a.attributeInfo,
e):q.clusterCountField;k=r="type"===e?q.getPredominantTypeExpression("unique-value"===d.type?d.uniqueValueInfos:[],c,f.noneValueLabel):'\n  $feature["'+c+'"];\n  var value \x3d $feature["'+c+'"];\n  var num \x3d Count(Text(Round(value)));\n  var label \x3d When(\n    num \x3c 4, Text(value, "#.#"),\n    num \x3d\x3d 4, Text(value / Pow(10, 3), "#.0k"),\n    num \x3c\x3d 6, Text(value / Pow(10, 3), "#k"),\n    num \x3d\x3d 7, Text(value / Pow(10, 6), "#.0m"),\n    num \x3e 7, Text(value / Pow(10, 6), "#m"),\n    Text(value, "#,###")\n  );\n  return label;\n  ';
var b=new B.TextSymbol({haloColor:"#373837",haloSize:"1px",color:"#f0f0f0",font:{family:"Noto Sans",size:"12px",weight:"bold"}});h=new F({symbol:b,deconflictionStrategy:"none",labelPlacement:"center-center",labelExpressionInfo:new G({expression:k})});l=a?"clusters-"+e+"-"+q.getClusterFieldHash(c,e):"clusters-count";m={name:l,labelingInfo:[h]};return[4,H(h.symbol,g)];case 1:return[2,(m.clusterMinSize=k.sent(),m.fieldName=c,m)]}})})}Object.defineProperty(p,"__esModule",{value:!0});p.getLabelSchemes=
function(f){return b.__awaiter(this,void 0,void 0,function(){var d,g,a,e,c,r,h,l,m,k,v,w,x,y;return b.__generator(this,function(b){switch(b.label){case 0:return[4,u.all([J(f),E.loadMessageBundle("esri/smartMapping/t9n/smartMapping")])];case 1:d=b.sent();g=d[0];a=g.renderer;e=g.layer;c=g.view;r=d[1];if(!a)return[2,null];h=null;l=[];for(var p=q.getStatisticInfos(e,a,!1),t=new Map,z=0;z<p.length;z++){var n=p[z];"size"===n.attributeInfo.vvType?t.set(n.statisticHash,n):t.has(n.statisticHash)||t.set(n.statisticHash,
n)}m=C.fromMapValues(t);k=0;v=m;b.label=2;case 2:if(!(k<v.length))return[3,5];w=v[k];return[4,A({renderer:a,view:c,statInfo:w,noneValueLabel:r.clusters.predominantNoneValue})];case 3:x=b.sent(),"size"===w.attributeInfo.vvType?h=x:l.push(x),b.label=4;case 4:return k++,[3,2];case 5:return[4,A({renderer:a,view:c})];case 6:return y=b.sent(),h?l.unshift(y):h=y,[2,{primaryScheme:h,secondarySchemes:l}]}})})}});