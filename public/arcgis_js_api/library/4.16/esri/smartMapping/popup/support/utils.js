// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.16/esri/copyright.txt for details.
//>>built
define("require exports tslib ../../../core/arrayUtils ../../../intl/messages ../../../intl/substitute ../../../layers/support/fieldUtils ../../../popup/content ../../../popup/ExpressionInfo ../../../popup/FieldInfo ../../../renderers/support/utils ../../../renderers/visualVariables/support/visualVariableUtils".split(" "),function(J,f,l,u,y,v,E,z,F,A,G,H){function B(a){return"hasVisualVariables"in a&&a.hasVisualVariables()?a.visualVariables.filter(function(a){return H.viewScaleRE.test(a.valueExpression)||
"target"in a&&"outline"===a.target?!1:!0}):[]}function k(a,c){var e=null;"popupTemplate"in a&&a.popupTemplate&&(e=a.popupTemplate.fieldInfos);var b=a.getField(c),g=null;e&&e.some(function(a){return a&&a.fieldName.toLowerCase()===b.name.toLowerCase()?(g=a.clone(),!0):!1});g||(a=-1<E.numericTypes.indexOf(b.type),c="integer"===b.type||"small-integer"===b.type,g=new A({fieldName:b.name,isEditable:b.editable,visible:!0,format:a?{places:c?0:2,digitSeparator:!0}:null}));g.label||(g.label=b.alias);return g}
function w(a){var c=a.expression,e=a.title;a=a.returnType;return new F({name:"expr"+I++,expression:c,title:e,returnType:a})}function x(a){return new A({fieldName:""+f.expressionFieldPrefix+a.name,visible:!0,format:"number"===a.returnType?{places:2,digitSeparator:!0}:null})}Object.defineProperty(f,"__esModule",{value:!0});var I=0;f.expressionFieldPrefix="expression/";f.getPrimaryVisualVariables=B;f.getFieldInfo=k;f.getExpressionInfo=w;f.getFieldInfoFromExpressionInfo=x;f.getFieldAndExpressionInfos=
function(a){return l.__awaiter(this,void 0,void 0,function(){var c,e,b,g,f,m,n,h,p,d,q,r,C,D,t;return l.__generator(this,function(l){switch(l.label){case 0:return[4,y.loadMessageBundle("esri/smartMapping/t9n/smartMapping")];case 1:c=l.sent();e=a.renderer;b=a.layer;g=a.normFieldExpressionTemplate;f=[];m=[];n=G.getAttributes(e,B);h=0;for(p=n;h<p.length;h++)d=p[h],"field"===d.type?f.push(k(b,d.field)):"normalized-field"===d.type?(q=b.getField(d.field),r=b.getField(d.normalizationField),C='\n      $feature["'+
q.name+'"];\n      $feature["'+r.name+'"];\n      '+("percentage"===g?'($feature["'+q.name+'"] / $feature["'+r.name+'"]) * 100;':'$feature["'+q.name+'"] / $feature["'+r.name+'"];')+"\n      ",D="percentage"===g?v.substitute(c.normFieldLabelAsPercent,{expression1:q.alias,expression2:r.alias}):v.substitute(c.normFieldLabel,{expression1:q.alias,expression2:r.alias}),t=w({type:"expression",expression:C,title:D,returnType:"number"}),f.push(x(t),k(b,d.field),k(b,d.normalizationField)),m.push(t)):"expression"===
d.type&&(t=w(d),f.push(x(t)),m.push(t));return[2,{fieldInfos:u.unique(f,function(a,b){return a.fieldName===b.fieldName}),expressionInfos:u.unique(m,function(a,b){return a.expression===b.expression})}]}})})};f.getContentFromFieldInfos=function(a,c){return l.__awaiter(this,void 0,void 0,function(){var e,b,g,k,m,n,h,p;return l.__generator(this,function(d){switch(d.label){case 0:return e=c.fieldInfos,b=c.expressionInfos,[4,y.loadMessageBundle("esri/smartMapping/t9n/smartMapping")];case 1:g=d.sent();if(2<
e.length)return[2,[new z.FieldsContent({fieldInfos:e})]];k=[];m=function(c){var e=c.fieldName;c=c.label;if(!c){var d=a.getField(e);if(d)c=d.alias||e;else if(b){var h=e.split(f.expressionFieldPrefix)[1];(d=b[u.findIndex(b,function(a){return a.name===h})])&&(c=d.title||d.name)}}k.push(new z.TextContent({text:v.substitute(g.fieldInfo,{fieldLabel:c,fieldValue:"{"+e+"}"})}))};n=0;for(h=e;n<h.length;n++)p=h[n],m(p);return[2,k]}})})};f.hasNormalizedField=function(a){return"normalizationField"in a&&a.normalizationField?
!0:"hasVisualVariables"in a&&a.hasVisualVariables()&&a.visualVariables.some(function(a){return!!("normalizationField"in a&&a.normalizationField)})}});